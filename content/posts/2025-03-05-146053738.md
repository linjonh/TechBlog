---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33343938383330342f:61727469636c652f64657461696c732f313436303533373338"
layout: post
title: "SpringBooté¡¹ç›®é›†æˆElasticSearch"
date: 2025-03-05 21:35:23 +08:00
description: "æ–‡ä¸­åªæ”¾äº†ä¸€äº›æ ¸å¿ƒçš„ä»£ç ä¸€äº›è°ƒç”¨æ•°æ®çš„ä»£ç å’ŒControllerçš„ä»£ç éƒ½æ²¡è´´ï¼Œéæ ¸å¿ƒéœ€è¦çš„å°ä¼™ä¼´å¯ä»¥å‰å¾€githubæ‹‰æºç çœ‹ä¸€ä¸‹ã€‚ğŸ¾æˆ‘æ˜¯ç¬‘å°æ«ï¼Œå…¨ç½‘çš†å¯æœçš„ã€ç¬‘å°æ«ã€‚"
keywords: "springbooté¡¹ç›®é›†æˆcoze"
categories: ['Springboot']
tags: ['åç«¯', 'Spring', 'Jenkins', 'Java', 'Elasticsearch', 'Boot']
artid: "146053738"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146053738
    alt: "SpringBooté¡¹ç›®é›†æˆElasticSearch"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146053738
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146053738
cover: https://bing.ee123.net/img/rand?artid=146053738
image: https://bing.ee123.net/img/rand?artid=146053738
img: https://bing.ee123.net/img/rand?artid=146053738
---

# SpringBooté¡¹ç›®é›†æˆElasticSearch

### 1. é¡¹ç›®èƒŒæ™¯

å¤„äºå¤±ä¸šæ‰¾å·¥ä½œçš„é˜¶æ®µï¼Œéšä¾¿å†™å†™å§~ æ²¡å•¥èƒŒæ™¯ï¼Œæ²¡å•¥æ„ä¹‰ï¼ŒJavaåç«¯è¶Šæ¥è¶Šå·äº†ã€‚ç¬¬ä¸€å­¦å†ä¸æ˜¯æœ¬ç§‘ï¼Œæ„Ÿè§‰çœŸçš„æ˜¯æ²¡æœ‰ä¸€ç‚¹è·¯å¯èµ°ã€‚

> **å¦‚æœæœ‰è·¯è¿‡çš„å°ä¼™ä¼´ï¼Œå¦‚æœèº«è¾¹è¿˜æœ‰å‘ä½ï¼Œä¸é™ç¬¬ä¸€å­¦å†çš„è¯ï¼Œéº»çƒ¦å¸®å¿™æä¸€ä¸‹ï¼éå¸¸æ„Ÿè°¢ï¼**

### 2. é¡¹ç›®ç¯å¢ƒ

è¯´ä¸‹é¡¹ç›®ç¯å¢ƒå§ï¼Œå°½é‡ä½¿ç”¨å’Œè‡ªå·±SpringBootåŒ¹é…çš„ç‰ˆæœ¬ï¼Œä¸ç„¶æ•´åˆçš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæœ‰å¾ˆå¤šçš„å‘~

![image-20250305195052710](https://i-blog.csdnimg.cn/img_convert/aad4bad1ce9ff5307cd436967ace554d.png)

æœ¬æ–‡ç¯å¢ƒå¦‚ä¸‹ï¼š

* `Springbootï¼š2.7.12`
* `JDKï¼š1.8`
* `elasticsearchï¼š7.17.3`

### 3. ä¸‹è½½å®‰è£…

è´´ä¸ªESä¸‹è½½é“¾æ¥ï¼Œwindowsç¯å¢ƒï¼š
<https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.3-windows-x86_64.zip>

ç„¶åè¿˜ä¸€ä¸ªï¼Œç›¸å½“äºESçš„å¯è§†åŒ–ç•Œé¢å§ï¼š
<https://github.com/mobz/elasticsearch-head>

windowsç¯å¢ƒä¸‹å¾ˆæ–¹ä¾¿ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œç®€å•è¯´è¯´éœ€è¦ä¿®æ”¹çš„åœ°æ–¹å§

#### 3.1 elasticsearché…ç½®

å®‰è£…å°±æ˜¯ä¸‹è½½è§£å‹ï¼Œå®˜ç½‘ä¸‹è½½é€Ÿåº¦å¾ˆå¿«ï¼Œä¸‹è½½å®Œç›´æ¥è§£å‹å°±è¡Œã€‚è§£å‹å®Œå¤§è‡´å¦‚ä¸‹ï¼š

![image-20250305200144883](https://i-blog.csdnimg.cn/img_convert/746cf69374e5639cf7176b05cc3a2669.png)

ç„¶åé…ç½®ä¸€ä¸‹ç¯å¢ƒå˜é‡ï¼Œ
`ES_HOME`
å’Œ
`ES_JAVA_HOME`
ï¼Œæ³¨æ„æ”¹æˆè‡ªå·±çš„è§£å‹ç›®å½•å“ˆ ~

```
ES_HOME: D:\software\elasticsearch-7.17.3
ES_JAVA_HOME: D:\software\elasticsearch-7.17.3\jdk

```

![image-20250305200437919](https://i-blog.csdnimg.cn/img_convert/3681c6776108359b1768173eab3a914e.png)

ç„¶åä¿®æ”¹ä¸‹
`/config`
ä¸‹çš„
`elasticsearch.yml`
æ–‡ä»¶ï¼Œæœ€åæ·»åŠ ä¸€ä¸‹å†…å®¹ï¼Œä¸ç„¶ä½¿ç”¨
`elasticsearch-head`
ä¼šæŠ¥è·¨åŸŸçš„é”™è¯¯

```
http.cors.enabled: true
http.cors.allow-origin: "*"

```

å¥½äº†ç„¶åç›´æ¥å‰å¾€
`/bin`
ç›®å½•ä¸‹ç›´æ¥åŒå‡»
`elasticsearch.bat`
æ–‡ä»¶å³å¯å¯åŠ¨ï¼Œé»˜è®¤9200ç«¯å£ã€‚

å¯åŠ¨åç›´æ¥å»æµè§ˆå™¨è¾“å…¥
`http://127.0.0.1:9200/`
ï¼Œè®¿é—®åˆ°ä¸‹é¢é¡µé¢ä»£è¡¨ESå¯åŠ¨æˆåŠŸã€‚

![image-20250305200943691](https://i-blog.csdnimg.cn/img_convert/3683f61123a6b005c899a3db343ca36e.png)

#### 3.2 elasticsearch-headé…ç½®

`elasticsearch-head`
ç›´æ¥åœ¨githubä¸Šæ‹‰ä»£ç å°±è¡Œã€‚

è¿™ä¸ªä¾èµ–nodeç¯å¢ƒï¼Œéœ€è¦ä½¿ç”¨npmä¸‹è½½ä¾èµ–ã€‚

è¿›å…¥åˆ°
`D:\software\elasticsearch-head`
ï¼Œå…ˆé€šè¿‡
`npm i`
å®‰è£…ä¾èµ–ï¼Œç„¶åé€šè¿‡
`npm run start`
å¯åŠ¨ã€‚

```
npm i
npm run start

```

å¯åŠ¨è®¿é—®
`http://127.0.0.1:9100/`
ï¼Œç‚¹å‡»äº†è¿æ¥ï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹ç•Œé¢ ï¼Œæˆ‘çš„æœ‰ç‚¹ä¸çº¯äº†ğŸ˜‚

![image-20250305201448537](https://i-blog.csdnimg.cn/img_convert/27fc642f51fcbb8fc02b2789e725b7c1.png)

### 4. SpringBoot é›†æˆEs

#### 4.1 æ·»åŠ ä¾èµ–

åœ¨Springbootä¸­pom.xmlä¸­æ·»åŠ ESä¾èµ–

```xml
 		<!-- å¼•å…¥ESä¾èµ– -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-elasticsearch</artifactId>
        </dependency>


```

#### 4.2 é¡¹ç›®ä½¿ç”¨

æˆ‘è¿™é‡Œç›´æ¥ç”¨äº†ç¬‘å°æ«ç½‘ç«™åšå®¢çš„å†…å®¹ï¼Œæ–¹ä¾¿åé¢æ¼”ç¤ºã€‚

é¦–å…ˆåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥å®šä¹‰å­˜å‚¨æ•°æ®çš„å¯¹è±¡ï¼Œå¯¹åº”ESä¸­çš„
`mappings`
ã€‚å¯¹è±¡å¦‚ä¸‹ï¼š

```java
package com.maple.es.bean;

import lombok.Data;
import org.springframework.data.annotation.Id;
import org.springframework.data.elasticsearch.annotations.Document;
import org.springframework.data.elasticsearch.annotations.Field;
import org.springframework.data.elasticsearch.annotations.FieldType;

import java.util.Date;
import java.util.List;

/**
 * @author ç¬‘å°æ« <https://www.xiaoxiaofeng.com/>
 * @date 2023/1/30
 */
@Data
@Document(indexName = "blog_title")
public class BlogDoc {

    @Id
    private Long id;

    @Field(type = FieldType.Long)
    private Long categoryId;

    @Field(type = FieldType.Text)
    private String title;

    @Field(type = FieldType.Text)
    private String content;

    @Field(type = FieldType.Keyword)
    private String description;

    @Field(type = FieldType.Keyword)
    private String keywords;

    @Field(type = FieldType.Keyword)
    private List<String> keywordList;

    private String status;

    @Field(type = FieldType.Integer)
    private Integer readNum;

    @Field(type = FieldType.Integer)
    private Integer collectNum;

    @Field(type = FieldType.Date)
    private Date createTime;
}


```

ESä¸­å¯¹è±¡ç±»å‹è¿™é‡Œåªæ¼”ç¤ºä¸€ä¸‹Stringã€æ•°å€¼å’Œæ—¶é—´ã€‚

![image-20250305203028700](https://i-blog.csdnimg.cn/img_convert/b847c889921cebfe64e72f0b355db8a0.png)

åˆ›å»º
`BlogRepository`
ç»§æ‰¿
`ElasticsearchRepository<BlogDoc, Long>`
æ¥å£ã€‚

å…¶ä¸­
`BlogDoc`
æ˜¯æˆ‘ä»¬ä¸Šé¢çš„å¯¹è±¡ã€‚Longå¯¹åº”æˆ‘ä»¬çš„ä¸»é”®ï¼Œæ ‡
`@Id`
çš„é‚£ä¸ªã€‚

ä½ å¯ä»¥åœ¨é‡Œé¢å®šä¹‰ä¸€äº›æ¥å£ï¼Œä¹Ÿå¯ä»¥ä¸å®šä¹‰ã€‚æˆ‘è¿™é‡Œåªç”¨åˆ°äº†ç»§æ‰¿çš„ç®€å•å¢åˆ æ¥å£ï¼ŒæŸ¥è¯¢ä½¿ç”¨
`ElasticsearchRestTemplate`
ã€‚

```java
package com.maple.es.repository;

import com.maple.es.bean.BlogDoc;
import org.springframework.data.elasticsearch.repository.ElasticsearchRepository;

public interface BlogRepository extends ElasticsearchRepository<BlogDoc, Long> {

}

```

ç›´æ¥ä¸Š
`BlogServiceImpl`
å§ ï¼Œè¯¦ç»†çš„æ³¨é‡Šéƒ½æ”¾åœ¨ä»£ç é‡Œäº†ï¼Œé€šä¹‰åƒé—®ç”Ÿæˆï¼Œå¤§ä½“æ‡‚ã€‚

æ ¸å¿ƒéƒ¨åˆ†çœ‹æŸ¥è¯¢
`getList`
æ–¹æ³•ï¼Œæ¶‰åŠåˆ°åˆ†é¡µäº†ï¼Œç®€å•å®šä¹‰äº†ä¸€ä¸ªåˆ†é¡µçš„å¯¹è±¡

Pageå¯¹è±¡

```java
package com.maple.es.bean;

import lombok.Data;

@Data
public class Page {

    private Integer page;

    private Integer size;

    private Long total;
}

```

ç®€å•çš„å°è£…ä¸€ä¸‹åˆ†é¡µå¯¹è±¡ã€è¯·æ±‚å‚æ•°å’Œè¿”å›ç»“æœçš„å¯¹è±¡

```java
package com.maple.es.bean;

import lombok.Data;

import java.util.List;

@Data
public class BlogPageDoc {

    private Page page;

    private BlogDoc query;

    private List<BlogDoc> result;
}


```

ã€æœ¬æ–‡é‡ç‚¹ã€‘Serviceå®ç°ç±»

```java
package com.maple.es.service.impl;

import com.baomidou.mybatisplus.core.toolkit.StringUtils;
import com.maple.es.bean.BlogDoc;
import com.maple.es.bean.BlogPageDoc;
import com.maple.es.bean.Page;
import com.maple.es.mapper.BlogMapper;
import com.maple.es.repository.BlogRepository;
import com.maple.es.service.BlogService;
import org.elasticsearch.index.query.BoolQueryBuilder;
import org.elasticsearch.index.query.QueryBuilders;
import org.elasticsearch.search.fetch.subphase.highlight.HighlightBuilder;
import org.elasticsearch.search.sort.SortBuilders;
import org.elasticsearch.search.sort.SortOrder;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.elasticsearch.core.ElasticsearchRestTemplate;
import org.springframework.data.elasticsearch.core.SearchHits;
import org.springframework.data.elasticsearch.core.mapping.IndexCoordinates;
import org.springframework.data.elasticsearch.core.query.NativeSearchQueryBuilder;
import org.springframework.data.elasticsearch.core.query.UpdateQuery;
import org.springframework.stereotype.Service;
import org.springframework.util.CollectionUtils;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Map;

@Service
public class BlogServiceImpl implements BlogService {

    @Autowired
    private BlogRepository blogRepository;

    @Autowired
    private ElasticsearchRestTemplate elasticsearchRestTemplate;

    @Autowired
    private BlogMapper blogTitleMapper;

    /**
     * åˆ›å»ºå•æ¡æ•°æ®
     * <p>
     * è¯¥æ–¹æ³•è´Ÿè´£å°†ç»™å®šçš„BlogDocå¯¹è±¡ä¿å­˜åˆ°ESä¸­
     *
     * @param blogBean ä»£è¡¨è¦åˆ›å»ºçš„åšå®¢æ–‡ç« çš„æ–‡æ¡£å¯¹è±¡
     */
    @Override
    public void createBlog(BlogDoc blogBean) {
        blogRepository.save(blogBean);
    }

    /**
     * æ›´æ–°åšå®¢æ–‡æ¡£
     * <p>
     * ä½¿ç”¨Elasticsearchçš„è„šæœ¬æ›´æ–°åŠŸèƒ½æ¥æ›´æ–°åšå®¢æ–‡æ¡£çš„æ ‡é¢˜å’Œå†…å®¹
     *
     * @param blogBean åŒ…å«è¦æ›´æ–°çš„åšå®¢ä¿¡æ¯çš„BlogDocå¯¹è±¡ï¼ŒåŒ…æ‹¬åšå®¢çš„æ ‡é¢˜ã€å†…å®¹å’ŒID
     */
    @Override
    public void updateBlog(BlogDoc blogBean) {

        // æ„å»ºæ›´æ–°è„šæœ¬ï¼Œç”¨äºæ›´æ–°Elasticsearchæ–‡æ¡£çš„æ ‡é¢˜å’Œå†…å®¹
        // ctx._source å›ºå®šå†™æ³•
        String script = "ctx._source.title = '" + blogBean.getTitle() + "';" +
                "ctx._source.content = '" + blogBean.getTitle() + "'";

        // æ„å»ºæ›´æ–°æŸ¥è¯¢å¯¹è±¡ï¼ŒæŒ‡å®šè¦æ›´æ–°çš„æ–‡æ¡£IDå’Œæ›´æ–°è„šæœ¬
        UpdateQuery build = UpdateQuery.builder(String.valueOf(blogBean.getId())).withScript(script).build();

        // æŒ‡å®šè¦æ›´æ–°çš„ç´¢å¼•åç§°
        IndexCoordinates indexCoordinates = IndexCoordinates.of("blog_title");

        // æ‰§è¡Œæ›´æ–°æ“ä½œï¼Œå¹¶è·å–æ›´æ–°å“åº”
        elasticsearchRestTemplate.update(build, indexCoordinates);
    }

    /**
     * åˆå§‹åŒ–æ•°æ®æ–¹æ³•
     * <p>
     * è¯¥æ–¹æ³•ç”¨äºä»æ•°æ®åº“ä¸­åŠ è½½åšå®¢æ ‡é¢˜çš„ç›¸å…³ä¿¡æ¯ï¼Œå¹¶å¤„ç†å…³é”®è¯å­—ç¬¦ä¸²ï¼Œä»¥ä¾¿äºåç»­çš„æœç´¢æˆ–å±•ç¤º
     * å®ƒé¦–å…ˆä»æ•°æ®åº“ä¸­é€‰æ‹©æ‰€æœ‰åšå®¢æ ‡é¢˜çš„ä¿¡æ¯ï¼Œç„¶åéå†è¿™äº›ä¿¡æ¯ï¼Œå°†æ¯ä¸ªåšå®¢æ ‡é¢˜çš„å…³é”®è¯å­—ç¬¦ä¸²
     * è½¬æ¢ä¸ºå…³é”®è¯åˆ—è¡¨ï¼Œæœ€åå°†å¤„ç†åçš„åšå®¢æ ‡é¢˜ä¿¡æ¯ä¿å­˜åˆ°åšå®¢ä»“åº“ä¸­
     */
    public void initData() {
        // ä»æ•°æ®åº“ä¸­é€‰æ‹©æ‰€æœ‰åšå®¢æ ‡é¢˜çš„ä¿¡æ¯
        List<BlogDoc> list = blogTitleMapper.selectTitleList();

        // éå†åšå®¢æ ‡é¢˜åˆ—è¡¨ï¼Œå¤„ç†æ¯ä¸ªåšå®¢æ ‡é¢˜çš„å…³é”®è¯
        for (BlogDoc blogTitleVo : list) {
            // å¦‚æœåšå®¢æ ‡é¢˜çš„å…³é”®è¯ä¸ä¸ºç©ºï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºå…³é”®è¯åˆ—è¡¨
            if (blogTitleVo.getKeywords() != null) {
                blogTitleVo.setKeywordList(Arrays.asList(blogTitleVo.getKeywords().split(",")));
            }
        }

        // å°†å¤„ç†åçš„åšå®¢æ ‡é¢˜åˆ—è¡¨ä¿å­˜åˆ°åšå®¢ä»“åº“ä¸­
        blogRepository.saveAll(list);
    }

    /**
     * åˆ é™¤æŒ‡å®šIDçš„åšå®¢
     *
     * @param id åšå®¢çš„å”¯ä¸€æ ‡è¯†ç¬¦
     */
    @Override
    public void deleteBlog(Long id) {
        blogRepository.deleteById(id);
    }

    @Override
    public BlogPageDoc getListBlogTitle(BlogPageDoc blogTitleVo) {
        return getList(blogTitleVo);
    }


    /**
     * æ ¹æ®æŸ¥è¯¢æ¡ä»¶å’Œåˆ†é¡µä¿¡æ¯è·å–åšå®¢åˆ—è¡¨
     *
     * @param blogPageDoc åŒ…å«æŸ¥è¯¢æ¡ä»¶å’Œåˆ†é¡µä¿¡æ¯çš„åšå®¢é¡µé¢æ–‡æ¡£
     * @return è¿”å›å¡«å……äº†æŸ¥è¯¢ç»“æœçš„åšå®¢é¡µé¢æ–‡æ¡£
     */
    private BlogPageDoc getList(BlogPageDoc blogPageDoc) {

        // è·å–æŸ¥è¯¢æ¡ä»¶
        BlogDoc blogDoc = blogPageDoc.getQuery();
        // è·å–åˆ†é¡µä¿¡æ¯
        Page page = blogPageDoc.getPage();

        // åˆ›å»ºé«˜äº®æ„å»ºå™¨
        HighlightBuilder highlightBuilder = new HighlightBuilder();

        // è®¾ç½®éœ€è¦é«˜äº®çš„å­—æ®µ
        highlightBuilder.field("title");
        highlightBuilder.field("description");
        // è®¾ç½®é«˜äº®æ˜¾ç¤ºçš„å‰ç¼€å’Œåç¼€
        highlightBuilder.preTags("<span style=\"font-color :red\">");
        highlightBuilder.postTags("</span>");

        // åˆ›å»ºå¸ƒå°”æŸ¥è¯¢æ„å»ºå™¨
        BoolQueryBuilder queryBuilders = QueryBuilders.boolQuery();
        // å¦‚æœæ ‡é¢˜å…³é”®å­—ä¸ä¸ºç©ºï¼Œåˆ™å¿…é¡»åŒ¹é…keywordListä¸­çš„å…³é”®å­—
        if (StringUtils.isNotBlank(blogDoc.getTitle())) {
            // listä¸­æœ‰ä¸€ä¸ªåŒ¹é…æˆåŠŸï¼Œå°±ä»£è¡¨æˆåŠŸï¼Œè™½ç„¶æŒ‡å®šäº†keywordListçš„ç±»å‹ï¼Œä½†æ˜¯åœ¨esä¸­è¿˜æ˜¯textï¼ˆä¸çŸ¥é“æ˜¯ä¸æ˜¯å“ªä¸ªåœ°æ–¹bugäº†ï¼Œæš‚æœªéªŒè¯ï¼‰ï¼Œæ‰€ä»¥æŒ‡å®škeywordList.keyword
            queryBuilders.must(QueryBuilders.termsQuery("keywordList.keyword", blogDoc.getKeywordList()));
        }
        // å¦‚æœç±»åˆ«IDä¸ä¸ºç©ºï¼Œåˆ™å¿…é¡»åŒ¹é…ç±»åˆ«ID
        if (blogDoc.getCategoryId() != null) {
            queryBuilders.must(QueryBuilders.termQuery("categoryId", blogDoc.getCategoryId()));
        }
        // å¦‚æœblogDocçš„é˜…è¯»æ•°é‡ä¸ä¸ºç©ºï¼Œåˆ™åœ¨æŸ¥è¯¢ä¸­æ·»åŠ é˜…è¯»æ•°é‡çš„èŒƒå›´æ¡ä»¶
        if (blogDoc.getReadNum() != null) {
            // æ„å»ºä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼Œç­›é€‰å‡ºé˜…è¯»æ•°é‡å¤§äºå½“å‰åšå®¢é˜…è¯»æ•°é‡çš„æ–‡æ¡£
            queryBuilders.must(QueryBuilders.rangeQuery("readNum").gt(blogDoc.getReadNum()));
        }
        // å¦‚æœæ ‡é¢˜ä¸ä¸ºç©ºï¼Œåˆ™åº”åŒ¹é…æ ‡é¢˜ã€æè¿°æˆ–å†…å®¹ä¸­çš„æ ‡é¢˜
        if (StringUtils.isNotBlank(blogDoc.getTitle())) {
            queryBuilders.should(QueryBuilders.matchQuery("title", blogDoc.getTitle()));
            queryBuilders.should(QueryBuilders.matchQuery("description", blogDoc.getTitle()));
            queryBuilders.should(QueryBuilders.matchQuery("content", blogDoc.getTitle()));
            // è®¾ç½®è‡³å°‘åº”åŒ¹é…çš„æ¡ä»¶æ•°
            queryBuilders.minimumShouldMatch(1);
        }
        // æ‰§è¡Œæœç´¢å¹¶è·å–ç»“æœ
        SearchHits<BlogDoc> searchHits = elasticsearchRestTemplate.search(new NativeSearchQueryBuilder()
                        .withQuery(queryBuilders) // è®¾ç½®æŸ¥è¯¢æ¡ä»¶
                        .withSorts(SortBuilders.fieldSort("readNum").order(SortOrder.DESC)) // è®¾ç½®æ’åºæ¡ä»¶
                        .withHighlightBuilder(highlightBuilder)  // è®¾ç½®é«˜äº®æ„å»ºå™¨
                        .withPageable(PageRequest.of(page.getPage() - 1, page.getSize()))  // è®¾ç½®åˆ†é¡µä¿¡æ¯
                        .build(),
                BlogDoc.class);
        // åˆ›å»ºç»“æœåˆ—è¡¨
        List<BlogDoc> result = new ArrayList<>();
        // è®¾ç½®æ€»è®°å½•æ•°
        page.setTotal(searchHits.getTotalHits());
        // éå†æœç´¢ç»“æœå¹¶å¤„ç†é«˜äº®æ˜¾ç¤º
        searchHits.getSearchHits().forEach(hits -> {
            BlogDoc blogTitle = hits.getContent();
            Map<String, List<String>> highlightFields = hits.getHighlightFields();

            // å¦‚æœæ ‡é¢˜çš„é«˜äº®å­—æ®µä¸ä¸ºç©ºï¼Œåˆ™æ›¿æ¢æ ‡é¢˜
            if (!CollectionUtils.isEmpty(highlightFields.get("title"))) {
                blogTitle.setTitle(hits.getHighlightFields().get("title").get(0));
            }
            // å¦‚æœæè¿°çš„é«˜äº®å­—æ®µä¸ä¸ºç©ºï¼Œåˆ™æ›¿æ¢æè¿°
            if (!CollectionUtils.isEmpty(highlightFields.get("description"))) {
                blogTitle.setDescription(hits.getHighlightFields().get("description").get(0));
            }
            // å°†å¤„ç†åçš„ç»“æœæ·»åŠ åˆ°åˆ—è¡¨ä¸­
            result.add(blogTitle);
        });
        // è®¾ç½®æŸ¥è¯¢ç»“æœ
        blogPageDoc.setResult(result);
        // è¿”å›å¡«å……äº†æŸ¥è¯¢ç»“æœçš„åšå®¢é¡µé¢æ–‡æ¡£
        return blogPageDoc;
    }
}

```

å¯ä»¥åœ¨
`elasticsearch-head`
çœ‹åˆ°å¯¹åº”çš„æ•°æ®ï¼Œè¿™é‡Œå°±ä¸ä¸€æ­¥ä¸€æ­¥æ¼”ç¤ºäº†

![image-20250305212410963](https://i-blog.csdnimg.cn/img_convert/85039bfd1a8f9bab3b6fd460e683d6ff.png)

### 5.ç»“è¯­

æ–‡ä¸­åªæ”¾äº†ä¸€äº›æ ¸å¿ƒçš„ä»£ç 

ä¸€äº›è°ƒç”¨æ•°æ®çš„ä»£ç å’ŒControllerçš„ä»£ç éƒ½æ²¡è´´ï¼Œéæ ¸å¿ƒ

éœ€è¦çš„å°ä¼™ä¼´å¯ä»¥å‰å¾€githubæ‹‰æºç çœ‹ä¸€ä¸‹ã€‚

æœ¬æ–‡æºç ï¼š
<https://github.com/hack-feng/maple-product/tree/main/maple-es>

> ğŸ¾æˆ‘æ˜¯ç¬‘å°æ«ï¼Œå…¨ç½‘çš†å¯æœçš„ã€
> [ç¬‘å°æ«](https://www.xiaoxiaofeng.com)
> ã€‘