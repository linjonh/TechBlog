---
layout: post
title: "SpringBoot项目集成ElasticSearch"
date: 2025-03-05 21:35:23 +0800
description: "文中只放了一些核心的代码一些调用数据的代码和Controller的代码都没贴，非核心需要的小伙伴可以前往github拉源码看一下。🐾我是笑小枫，全网皆可搜的【笑小枫。"
keywords: "springboot项目集成coze"
categories: ['Springboot']
tags: ['后端', 'Spring', 'Jenkins', 'Java', 'Elasticsearch', 'Boot']
artid: "146053738"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146053738
    alt: "SpringBoot项目集成ElasticSearch"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146053738
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146053738
cover: https://bing.ee123.net/img/rand?artid=146053738
image: https://bing.ee123.net/img/rand?artid=146053738
img: https://bing.ee123.net/img/rand?artid=146053738
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     SpringBoot项目集成ElasticSearch
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="1__0">
     </a>
     1. 项目背景
    </h3>
    <p>
     处于失业找工作的阶段，随便写写吧~ 没啥背景，没啥意义，Java后端越来越卷了。第一学历不是本科，感觉真的是没有一点路可走。
    </p>
    <blockquote>
     <p>
      <strong>
       如果有路过的小伙伴，如果身边还有坑位，不限第一学历的话，麻烦帮忙捞一下！非常感谢！
      </strong>
     </p>
    </blockquote>
    <h3>
     <a id="2___6">
     </a>
     2. 项目环境
    </h3>
    <p>
     说下项目环境吧，尽量使用和自己SpringBoot匹配的版本，不然整合的过程中可能会有很多的坑~
    </p>
    <p>
     <img alt="image-20250305195052710" src="https://i-blog.csdnimg.cn/img_convert/aad4bad1ce9ff5307cd436967ace554d.png"/>
    </p>
    <p>
     本文环境如下：
    </p>
    <ul>
     <li>
      <code>
       Springboot：2.7.12
      </code>
     </li>
     <li>
      <code>
       JDK：1.8
      </code>
     </li>
     <li>
      <code>
       elasticsearch：7.17.3
      </code>
     </li>
    </ul>
    <h3>
     <a id="3__18">
     </a>
     3. 下载安装
    </h3>
    <p>
     贴个ES下载链接，windows环境：
     <a href="https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.3-windows-x86_64.zip" rel="nofollow">
      https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.3-windows-x86_64.zip
     </a>
    </p>
    <p>
     然后还一个，相当于ES的可视化界面吧：
     <a href="https://github.com/mobz/elasticsearch-head">
      https://github.com/mobz/elasticsearch-head
     </a>
    </p>
    <p>
     windows环境下很方便，这里就不多说了，简单说说需要修改的地方吧
    </p>
    <h4>
     <a id="31_elasticsearch_26">
     </a>
     3.1 elasticsearch配置
    </h4>
    <p>
     安装就是下载解压，官网下载速度很快，下载完直接解压就行。解压完大致如下：
    </p>
    <p>
     <img alt="image-20250305200144883" src="https://i-blog.csdnimg.cn/img_convert/746cf69374e5639cf7176b05cc3a2669.png"/>
    </p>
    <p>
     然后配置一下环境变量，
     <code>
      ES_HOME
     </code>
     和
     <code>
      ES_JAVA_HOME
     </code>
     ，注意改成自己的解压目录哈 ~
    </p>
    <pre><code>ES_HOME: D:\software\elasticsearch-7.17.3
ES_JAVA_HOME: D:\software\elasticsearch-7.17.3\jdk
</code></pre>
    <p>
     <img alt="image-20250305200437919" src="https://i-blog.csdnimg.cn/img_convert/3681c6776108359b1768173eab3a914e.png"/>
    </p>
    <p>
     然后修改下
     <code>
      /config
     </code>
     下的
     <code>
      elasticsearch.yml
     </code>
     文件，最后添加一下内容，不然使用
     <code>
      elasticsearch-head
     </code>
     会报跨域的错误
    </p>
    <pre><code>http.cors.enabled: true
http.cors.allow-origin: "*"
</code></pre>
    <p>
     好了然后直接前往
     <code>
      /bin
     </code>
     目录下直接双击
     <code>
      elasticsearch.bat
     </code>
     文件即可启动，默认9200端口。
    </p>
    <p>
     启动后直接去浏览器输入
     <code>
      http://127.0.0.1:9200/
     </code>
     ，访问到下面页面代表ES启动成功。
    </p>
    <p>
     <img alt="image-20250305200943691" src="https://i-blog.csdnimg.cn/img_convert/3683f61123a6b005c899a3db343ca36e.png"/>
    </p>
    <h4>
     <a id="32_elasticsearchhead_54">
     </a>
     3.2 elasticsearch-head配置
    </h4>
    <p>
     <code>
      elasticsearch-head
     </code>
     直接在github上拉代码就行。
    </p>
    <p>
     这个依赖node环境，需要使用npm下载依赖。
    </p>
    <p>
     进入到
     <code>
      D:\software\elasticsearch-head
     </code>
     ，先通过
     <code>
      npm i
     </code>
     安装依赖，然后通过
     <code>
      npm run start
     </code>
     启动。
    </p>
    <pre><code>npm i
npm run start
</code></pre>
    <p>
     启动访问
     <code>
      http://127.0.0.1:9100/
     </code>
     ，点击了连接，可以看到以下界面 ，我的有点不纯了😂
    </p>
    <p>
     <img alt="image-20250305201448537" src="https://i-blog.csdnimg.cn/img_convert/27fc642f51fcbb8fc02b2789e725b7c1.png"/>
    </p>
    <h3>
     <a id="4_SpringBoot_Es_71">
     </a>
     4. SpringBoot 集成Es
    </h3>
    <h4>
     <a id="41__73">
     </a>
     4.1 添加依赖
    </h4>
    <p>
     在Springboot中pom.xml中添加ES依赖
    </p>
    <pre><code class="prism language-xml"> 		<span class="token comment">&lt;!-- 引入ES依赖 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-elasticsearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre>
    <h4>
     <a id="42__86">
     </a>
     4.2 项目使用
    </h4>
    <p>
     我这里直接用了笑小枫网站博客的内容，方便后面演示。
    </p>
    <p>
     首先创建一个对象，用来定义存储数据的对象，对应ES中的
     <code>
      mappings
     </code>
     。对象如下：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Id</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Document</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">FieldType</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author 笑小枫 &lt;https://www.xiaoxiaofeng.com/&gt;
 * @date 2023/1/30
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Document</span><span class="token punctuation">(</span>indexName <span class="token operator">=</span> <span class="token string">"blog_title"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlogDoc</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Long</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> categoryId<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Text</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Text</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Keyword</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Keyword</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> keywords<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Keyword</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keywordList<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Integer</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> readNum<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Integer</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> collectNum<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Date</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     ES中对象类型这里只演示一下String、数值和时间。
    </p>
    <p>
     <img alt="image-20250305203028700" src="https://i-blog.csdnimg.cn/img_convert/b847c889921cebfe64e72f0b355db8a0.png"/>
    </p>
    <p>
     创建
     <code>
      BlogRepository
     </code>
     继承
     <code>
      ElasticsearchRepository&lt;BlogDoc, Long&gt;
     </code>
     接口。
    </p>
    <p>
     其中
     <code>
      BlogDoc
     </code>
     是我们上面的对象。Long对应我们的主键，标
     <code>
      @Id
     </code>
     的那个。
    </p>
    <p>
     你可以在里面定义一些接口，也可以不定义。我这里只用到了继承的简单增删接口，查询使用
     <code>
      ElasticsearchRestTemplate
     </code>
     。
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>repository</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">BlogDoc</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">ElasticsearchRepository</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BlogRepository</span> <span class="token keyword">extends</span> <span class="token class-name">ElasticsearchRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BlogDoc</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

<span class="token punctuation">}</span>
</code></pre>
    <p>
     直接上
     <code>
      BlogServiceImpl
     </code>
     吧 ，详细的注释都放在代码里了，通义千问生成，大体懂。
    </p>
    <p>
     核心部分看查询
     <code>
      getList
     </code>
     方法，涉及到分页了，简单定义了一个分页的对象
    </p>
    <p>
     Page对象
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Page</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> page<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> size<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> total<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     简单的封装一下分页对象、请求参数和返回结果的对象
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlogPageDoc</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">Page</span> page<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">BlogDoc</span> query<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BlogDoc</span><span class="token punctuation">&gt;</span></span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     【本文重点】Service实现类
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>toolkit<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">BlogDoc</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">BlogPageDoc</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Page</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">BlogMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">BlogRepository</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">BlogService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>index<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">BoolQueryBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>index<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">QueryBuilders</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>search<span class="token punctuation">.</span>fetch<span class="token punctuation">.</span>subphase<span class="token punctuation">.</span>highlight<span class="token punctuation">.</span></span><span class="token class-name">HighlightBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>search<span class="token punctuation">.</span>sort<span class="token punctuation">.</span></span><span class="token class-name">SortBuilders</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>search<span class="token punctuation">.</span>sort<span class="token punctuation">.</span></span><span class="token class-name">SortOrder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">PageRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">ElasticsearchRestTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">SearchHits</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span></span><span class="token class-name">IndexCoordinates</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>core<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">NativeSearchQueryBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>core<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">UpdateQuery</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CollectionUtils</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlogServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BlogService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BlogRepository</span> blogRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ElasticsearchRestTemplate</span> elasticsearchRestTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BlogMapper</span> blogTitleMapper<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 创建单条数据
     * &lt;p&gt;
     * 该方法负责将给定的BlogDoc对象保存到ES中
     *
     * @param blogBean 代表要创建的博客文章的文档对象
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createBlog</span><span class="token punctuation">(</span><span class="token class-name">BlogDoc</span> blogBean<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        blogRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>blogBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 更新博客文档
     * &lt;p&gt;
     * 使用Elasticsearch的脚本更新功能来更新博客文档的标题和内容
     *
     * @param blogBean 包含要更新的博客信息的BlogDoc对象，包括博客的标题、内容和ID
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateBlog</span><span class="token punctuation">(</span><span class="token class-name">BlogDoc</span> blogBean<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">// 构建更新脚本，用于更新Elasticsearch文档的标题和内容</span>
        <span class="token comment">// ctx._source 固定写法</span>
        <span class="token class-name">String</span> script <span class="token operator">=</span> <span class="token string">"ctx._source.title = '"</span> <span class="token operator">+</span> blogBean<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"';"</span> <span class="token operator">+</span>
                <span class="token string">"ctx._source.content = '"</span> <span class="token operator">+</span> blogBean<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">;</span>

        <span class="token comment">// 构建更新查询对象，指定要更新的文档ID和更新脚本</span>
        <span class="token class-name">UpdateQuery</span> build <span class="token operator">=</span> <span class="token class-name">UpdateQuery</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>blogBean<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withScript</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 指定要更新的索引名称</span>
        <span class="token class-name">IndexCoordinates</span> indexCoordinates <span class="token operator">=</span> <span class="token class-name">IndexCoordinates</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"blog_title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 执行更新操作，并获取更新响应</span>
        elasticsearchRestTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>build<span class="token punctuation">,</span> indexCoordinates<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 初始化数据方法
     * &lt;p&gt;
     * 该方法用于从数据库中加载博客标题的相关信息，并处理关键词字符串，以便于后续的搜索或展示
     * 它首先从数据库中选择所有博客标题的信息，然后遍历这些信息，将每个博客标题的关键词字符串
     * 转换为关键词列表，最后将处理后的博客标题信息保存到博客仓库中
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 从数据库中选择所有博客标题的信息</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BlogDoc</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> blogTitleMapper<span class="token punctuation">.</span><span class="token function">selectTitleList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 遍历博客标题列表，处理每个博客标题的关键词</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BlogDoc</span> blogTitleVo <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 如果博客标题的关键词不为空，则将其转换为关键词列表</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>blogTitleVo<span class="token punctuation">.</span><span class="token function">getKeywords</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                blogTitleVo<span class="token punctuation">.</span><span class="token function">setKeywordList</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>blogTitleVo<span class="token punctuation">.</span><span class="token function">getKeywords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 将处理后的博客标题列表保存到博客仓库中</span>
        blogRepository<span class="token punctuation">.</span><span class="token function">saveAll</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 删除指定ID的博客
     *
     * @param id 博客的唯一标识符
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteBlog</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        blogRepository<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">BlogPageDoc</span> <span class="token function">getListBlogTitle</span><span class="token punctuation">(</span><span class="token class-name">BlogPageDoc</span> blogTitleVo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">getList</span><span class="token punctuation">(</span>blogTitleVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 根据查询条件和分页信息获取博客列表
     *
     * @param blogPageDoc 包含查询条件和分页信息的博客页面文档
     * @return 返回填充了查询结果的博客页面文档
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">BlogPageDoc</span> <span class="token function">getList</span><span class="token punctuation">(</span><span class="token class-name">BlogPageDoc</span> blogPageDoc<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">// 获取查询条件</span>
        <span class="token class-name">BlogDoc</span> blogDoc <span class="token operator">=</span> blogPageDoc<span class="token punctuation">.</span><span class="token function">getQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取分页信息</span>
        <span class="token class-name">Page</span> page <span class="token operator">=</span> blogPageDoc<span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建高亮构建器</span>
        <span class="token class-name">HighlightBuilder</span> highlightBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HighlightBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 设置需要高亮的字段</span>
        highlightBuilder<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        highlightBuilder<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置高亮显示的前缀和后缀</span>
        highlightBuilder<span class="token punctuation">.</span><span class="token function">preTags</span><span class="token punctuation">(</span><span class="token string">"&lt;span style=\"font-color :red\"&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        highlightBuilder<span class="token punctuation">.</span><span class="token function">postTags</span><span class="token punctuation">(</span><span class="token string">"&lt;/span&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建布尔查询构建器</span>
        <span class="token class-name">BoolQueryBuilder</span> queryBuilders <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果标题关键字不为空，则必须匹配keywordList中的关键字</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>blogDoc<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// list中有一个匹配成功，就代表成功，虽然指定了keywordList的类型，但是在es中还是text（不知道是不是哪个地方bug了，暂未验证），所以指定keywordList.keyword</span>
            queryBuilders<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termsQuery</span><span class="token punctuation">(</span><span class="token string">"keywordList.keyword"</span><span class="token punctuation">,</span> blogDoc<span class="token punctuation">.</span><span class="token function">getKeywordList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 如果类别ID不为空，则必须匹配类别ID</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>blogDoc<span class="token punctuation">.</span><span class="token function">getCategoryId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            queryBuilders<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">"categoryId"</span><span class="token punctuation">,</span> blogDoc<span class="token punctuation">.</span><span class="token function">getCategoryId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 如果blogDoc的阅读数量不为空，则在查询中添加阅读数量的范围条件</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>blogDoc<span class="token punctuation">.</span><span class="token function">getReadNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 构建一个范围查询，筛选出阅读数量大于当前博客阅读数量的文档</span>
            queryBuilders<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">rangeQuery</span><span class="token punctuation">(</span><span class="token string">"readNum"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span>blogDoc<span class="token punctuation">.</span><span class="token function">getReadNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 如果标题不为空，则应匹配标题、描述或内容中的标题</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>blogDoc<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            queryBuilders<span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span> blogDoc<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            queryBuilders<span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">,</span> blogDoc<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            queryBuilders<span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">,</span> blogDoc<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置至少应匹配的条件数</span>
            queryBuilders<span class="token punctuation">.</span><span class="token function">minimumShouldMatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 执行搜索并获取结果</span>
        <span class="token class-name">SearchHits</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BlogDoc</span><span class="token punctuation">&gt;</span></span> searchHits <span class="token operator">=</span> elasticsearchRestTemplate<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NativeSearchQueryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">withQuery</span><span class="token punctuation">(</span>queryBuilders<span class="token punctuation">)</span> <span class="token comment">// 设置查询条件</span>
                        <span class="token punctuation">.</span><span class="token function">withSorts</span><span class="token punctuation">(</span><span class="token class-name">SortBuilders</span><span class="token punctuation">.</span><span class="token function">fieldSort</span><span class="token punctuation">(</span><span class="token string">"readNum"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token class-name">SortOrder</span><span class="token punctuation">.</span><span class="token constant">DESC</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 设置排序条件</span>
                        <span class="token punctuation">.</span><span class="token function">withHighlightBuilder</span><span class="token punctuation">(</span>highlightBuilder<span class="token punctuation">)</span>  <span class="token comment">// 设置高亮构建器</span>
                        <span class="token punctuation">.</span><span class="token function">withPageable</span><span class="token punctuation">(</span><span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> page<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 设置分页信息</span>
                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">BlogDoc</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建结果列表</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BlogDoc</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置总记录数</span>
        page<span class="token punctuation">.</span><span class="token function">setTotal</span><span class="token punctuation">(</span>searchHits<span class="token punctuation">.</span><span class="token function">getTotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 遍历搜索结果并处理高亮显示</span>
        searchHits<span class="token punctuation">.</span><span class="token function">getSearchHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>hits <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">BlogDoc</span> blogTitle <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> highlightFields <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getHighlightFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 如果标题的高亮字段不为空，则替换标题</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>highlightFields<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                blogTitle<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>hits<span class="token punctuation">.</span><span class="token function">getHighlightFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 如果描述的高亮字段不为空，则替换描述</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>highlightFields<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                blogTitle<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span>hits<span class="token punctuation">.</span><span class="token function">getHighlightFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 将处理后的结果添加到列表中</span>
            result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>blogTitle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置查询结果</span>
        blogPageDoc<span class="token punctuation">.</span><span class="token function">setResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 返回填充了查询结果的博客页面文档</span>
        <span class="token keyword">return</span> blogPageDoc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     可以在
     <code>
      elasticsearch-head
     </code>
     看到对应的数据，这里就不一步一步演示了
    </p>
    <p>
     <img alt="image-20250305212410963" src="https://i-blog.csdnimg.cn/img_convert/85039bfd1a8f9bab3b6fd460e683d6ff.png"/>
    </p>
    <h3>
     <a id="5_418">
     </a>
     5.结语
    </h3>
    <p>
     文中只放了一些核心的代码
    </p>
    <p>
     一些调用数据的代码和Controller的代码都没贴，非核心
    </p>
    <p>
     需要的小伙伴可以前往github拉源码看一下。
    </p>
    <p>
     本文源码：
     <a href="https://github.com/hack-feng/maple-product/tree/main/maple-es">
      https://github.com/hack-feng/maple-product/tree/main/maple-es
     </a>
    </p>
    <blockquote>
     <p>
      🐾我是笑小枫，全网皆可搜的【
      <a href="https://www.xiaoxiaofeng.com" rel="nofollow">
       笑小枫
      </a>
      】
     </p>
    </blockquote>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33343938383330342f:61727469636c652f64657461696c732f313436303533373338" class_="artid" style="display:none">
 </p>
</div>


