---
layout: post
title: "SpringBooté¡¹ç›®é›†æˆElasticSearch"
date: 2025-03-05 21:35:23 +0800
description: "æ–‡ä¸­åªæ”¾äº†ä¸€äº›æ ¸å¿ƒçš„ä»£ç ä¸€äº›è°ƒç”¨æ•°æ®çš„ä»£ç å’ŒControllerçš„ä»£ç éƒ½æ²¡è´´ï¼Œéæ ¸å¿ƒéœ€è¦çš„å°ä¼™ä¼´å¯ä»¥å‰å¾€githubæ‹‰æºç çœ‹ä¸€ä¸‹ã€‚ğŸ¾æˆ‘æ˜¯ç¬‘å°æ«ï¼Œå…¨ç½‘çš†å¯æœçš„ã€ç¬‘å°æ«ã€‚"
keywords: "springbooté¡¹ç›®é›†æˆcoze"
categories: ['Springboot']
tags: ['åç«¯', 'Spring', 'Jenkins', 'Java', 'Elasticsearch', 'Boot']
artid: "146053738"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146053738
    alt: "SpringBooté¡¹ç›®é›†æˆElasticSearch"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146053738
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146053738
cover: https://bing.ee123.net/img/rand?artid=146053738
image: https://bing.ee123.net/img/rand?artid=146053738
img: https://bing.ee123.net/img/rand?artid=146053738
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     SpringBooté¡¹ç›®é›†æˆElasticSearch
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="1__0">
     </a>
     1. é¡¹ç›®èƒŒæ™¯
    </h3>
    <p>
     å¤„äºå¤±ä¸šæ‰¾å·¥ä½œçš„é˜¶æ®µï¼Œéšä¾¿å†™å†™å§~ æ²¡å•¥èƒŒæ™¯ï¼Œæ²¡å•¥æ„ä¹‰ï¼ŒJavaåç«¯è¶Šæ¥è¶Šå·äº†ã€‚ç¬¬ä¸€å­¦å†ä¸æ˜¯æœ¬ç§‘ï¼Œæ„Ÿè§‰çœŸçš„æ˜¯æ²¡æœ‰ä¸€ç‚¹è·¯å¯èµ°ã€‚
    </p>
    <blockquote>
     <p>
      <strong>
       å¦‚æœæœ‰è·¯è¿‡çš„å°ä¼™ä¼´ï¼Œå¦‚æœèº«è¾¹è¿˜æœ‰å‘ä½ï¼Œä¸é™ç¬¬ä¸€å­¦å†çš„è¯ï¼Œéº»çƒ¦å¸®å¿™æä¸€ä¸‹ï¼éå¸¸æ„Ÿè°¢ï¼
      </strong>
     </p>
    </blockquote>
    <h3>
     <a id="2___6">
     </a>
     2. é¡¹ç›®ç¯å¢ƒ
    </h3>
    <p>
     è¯´ä¸‹é¡¹ç›®ç¯å¢ƒå§ï¼Œå°½é‡ä½¿ç”¨å’Œè‡ªå·±SpringBootåŒ¹é…çš„ç‰ˆæœ¬ï¼Œä¸ç„¶æ•´åˆçš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæœ‰å¾ˆå¤šçš„å‘~
    </p>
    <p>
     <img alt="image-20250305195052710" src="https://i-blog.csdnimg.cn/img_convert/aad4bad1ce9ff5307cd436967ace554d.png"/>
    </p>
    <p>
     æœ¬æ–‡ç¯å¢ƒå¦‚ä¸‹ï¼š
    </p>
    <ul>
     <li>
      <code>
       Springbootï¼š2.7.12
      </code>
     </li>
     <li>
      <code>
       JDKï¼š1.8
      </code>
     </li>
     <li>
      <code>
       elasticsearchï¼š7.17.3
      </code>
     </li>
    </ul>
    <h3>
     <a id="3__18">
     </a>
     3. ä¸‹è½½å®‰è£…
    </h3>
    <p>
     è´´ä¸ªESä¸‹è½½é“¾æ¥ï¼Œwindowsç¯å¢ƒï¼š
     <a href="https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.3-windows-x86_64.zip" rel="nofollow">
      https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.3-windows-x86_64.zip
     </a>
    </p>
    <p>
     ç„¶åè¿˜ä¸€ä¸ªï¼Œç›¸å½“äºESçš„å¯è§†åŒ–ç•Œé¢å§ï¼š
     <a href="https://github.com/mobz/elasticsearch-head">
      https://github.com/mobz/elasticsearch-head
     </a>
    </p>
    <p>
     windowsç¯å¢ƒä¸‹å¾ˆæ–¹ä¾¿ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œç®€å•è¯´è¯´éœ€è¦ä¿®æ”¹çš„åœ°æ–¹å§
    </p>
    <h4>
     <a id="31_elasticsearch_26">
     </a>
     3.1 elasticsearché…ç½®
    </h4>
    <p>
     å®‰è£…å°±æ˜¯ä¸‹è½½è§£å‹ï¼Œå®˜ç½‘ä¸‹è½½é€Ÿåº¦å¾ˆå¿«ï¼Œä¸‹è½½å®Œç›´æ¥è§£å‹å°±è¡Œã€‚è§£å‹å®Œå¤§è‡´å¦‚ä¸‹ï¼š
    </p>
    <p>
     <img alt="image-20250305200144883" src="https://i-blog.csdnimg.cn/img_convert/746cf69374e5639cf7176b05cc3a2669.png"/>
    </p>
    <p>
     ç„¶åé…ç½®ä¸€ä¸‹ç¯å¢ƒå˜é‡ï¼Œ
     <code>
      ES_HOME
     </code>
     å’Œ
     <code>
      ES_JAVA_HOME
     </code>
     ï¼Œæ³¨æ„æ”¹æˆè‡ªå·±çš„è§£å‹ç›®å½•å“ˆ ~
    </p>
    <pre><code>ES_HOME: D:\software\elasticsearch-7.17.3
ES_JAVA_HOME: D:\software\elasticsearch-7.17.3\jdk
</code></pre>
    <p>
     <img alt="image-20250305200437919" src="https://i-blog.csdnimg.cn/img_convert/3681c6776108359b1768173eab3a914e.png"/>
    </p>
    <p>
     ç„¶åä¿®æ”¹ä¸‹
     <code>
      /config
     </code>
     ä¸‹çš„
     <code>
      elasticsearch.yml
     </code>
     æ–‡ä»¶ï¼Œæœ€åæ·»åŠ ä¸€ä¸‹å†…å®¹ï¼Œä¸ç„¶ä½¿ç”¨
     <code>
      elasticsearch-head
     </code>
     ä¼šæŠ¥è·¨åŸŸçš„é”™è¯¯
    </p>
    <pre><code>http.cors.enabled: true
http.cors.allow-origin: "*"
</code></pre>
    <p>
     å¥½äº†ç„¶åç›´æ¥å‰å¾€
     <code>
      /bin
     </code>
     ç›®å½•ä¸‹ç›´æ¥åŒå‡»
     <code>
      elasticsearch.bat
     </code>
     æ–‡ä»¶å³å¯å¯åŠ¨ï¼Œé»˜è®¤9200ç«¯å£ã€‚
    </p>
    <p>
     å¯åŠ¨åç›´æ¥å»æµè§ˆå™¨è¾“å…¥
     <code>
      http://127.0.0.1:9200/
     </code>
     ï¼Œè®¿é—®åˆ°ä¸‹é¢é¡µé¢ä»£è¡¨ESå¯åŠ¨æˆåŠŸã€‚
    </p>
    <p>
     <img alt="image-20250305200943691" src="https://i-blog.csdnimg.cn/img_convert/3683f61123a6b005c899a3db343ca36e.png"/>
    </p>
    <h4>
     <a id="32_elasticsearchhead_54">
     </a>
     3.2 elasticsearch-headé…ç½®
    </h4>
    <p>
     <code>
      elasticsearch-head
     </code>
     ç›´æ¥åœ¨githubä¸Šæ‹‰ä»£ç å°±è¡Œã€‚
    </p>
    <p>
     è¿™ä¸ªä¾èµ–nodeç¯å¢ƒï¼Œéœ€è¦ä½¿ç”¨npmä¸‹è½½ä¾èµ–ã€‚
    </p>
    <p>
     è¿›å…¥åˆ°
     <code>
      D:\software\elasticsearch-head
     </code>
     ï¼Œå…ˆé€šè¿‡
     <code>
      npm i
     </code>
     å®‰è£…ä¾èµ–ï¼Œç„¶åé€šè¿‡
     <code>
      npm run start
     </code>
     å¯åŠ¨ã€‚
    </p>
    <pre><code>npm i
npm run start
</code></pre>
    <p>
     å¯åŠ¨è®¿é—®
     <code>
      http://127.0.0.1:9100/
     </code>
     ï¼Œç‚¹å‡»äº†è¿æ¥ï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹ç•Œé¢ ï¼Œæˆ‘çš„æœ‰ç‚¹ä¸çº¯äº†ğŸ˜‚
    </p>
    <p>
     <img alt="image-20250305201448537" src="https://i-blog.csdnimg.cn/img_convert/27fc642f51fcbb8fc02b2789e725b7c1.png"/>
    </p>
    <h3>
     <a id="4_SpringBoot_Es_71">
     </a>
     4. SpringBoot é›†æˆEs
    </h3>
    <h4>
     <a id="41__73">
     </a>
     4.1 æ·»åŠ ä¾èµ–
    </h4>
    <p>
     åœ¨Springbootä¸­pom.xmlä¸­æ·»åŠ ESä¾èµ–
    </p>
    <pre><code class="prism language-xml"> 		<span class="token comment">&lt;!-- å¼•å…¥ESä¾èµ– --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-elasticsearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre>
    <h4>
     <a id="42__86">
     </a>
     4.2 é¡¹ç›®ä½¿ç”¨
    </h4>
    <p>
     æˆ‘è¿™é‡Œç›´æ¥ç”¨äº†ç¬‘å°æ«ç½‘ç«™åšå®¢çš„å†…å®¹ï¼Œæ–¹ä¾¿åé¢æ¼”ç¤ºã€‚
    </p>
    <p>
     é¦–å…ˆåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥å®šä¹‰å­˜å‚¨æ•°æ®çš„å¯¹è±¡ï¼Œå¯¹åº”ESä¸­çš„
     <code>
      mappings
     </code>
     ã€‚å¯¹è±¡å¦‚ä¸‹ï¼š
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Id</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Document</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">FieldType</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ç¬‘å°æ« &lt;https://www.xiaoxiaofeng.com/&gt;
 * @date 2023/1/30
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Document</span><span class="token punctuation">(</span>indexName <span class="token operator">=</span> <span class="token string">"blog_title"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlogDoc</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Long</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> categoryId<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Text</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Text</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Keyword</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Keyword</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> keywords<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Keyword</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keywordList<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Integer</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> readNum<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Integer</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> collectNum<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Date</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     ESä¸­å¯¹è±¡ç±»å‹è¿™é‡Œåªæ¼”ç¤ºä¸€ä¸‹Stringã€æ•°å€¼å’Œæ—¶é—´ã€‚
    </p>
    <p>
     <img alt="image-20250305203028700" src="https://i-blog.csdnimg.cn/img_convert/b847c889921cebfe64e72f0b355db8a0.png"/>
    </p>
    <p>
     åˆ›å»º
     <code>
      BlogRepository
     </code>
     ç»§æ‰¿
     <code>
      ElasticsearchRepository&lt;BlogDoc, Long&gt;
     </code>
     æ¥å£ã€‚
    </p>
    <p>
     å…¶ä¸­
     <code>
      BlogDoc
     </code>
     æ˜¯æˆ‘ä»¬ä¸Šé¢çš„å¯¹è±¡ã€‚Longå¯¹åº”æˆ‘ä»¬çš„ä¸»é”®ï¼Œæ ‡
     <code>
      @Id
     </code>
     çš„é‚£ä¸ªã€‚
    </p>
    <p>
     ä½ å¯ä»¥åœ¨é‡Œé¢å®šä¹‰ä¸€äº›æ¥å£ï¼Œä¹Ÿå¯ä»¥ä¸å®šä¹‰ã€‚æˆ‘è¿™é‡Œåªç”¨åˆ°äº†ç»§æ‰¿çš„ç®€å•å¢åˆ æ¥å£ï¼ŒæŸ¥è¯¢ä½¿ç”¨
     <code>
      ElasticsearchRestTemplate
     </code>
     ã€‚
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>repository</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">BlogDoc</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">ElasticsearchRepository</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BlogRepository</span> <span class="token keyword">extends</span> <span class="token class-name">ElasticsearchRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BlogDoc</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

<span class="token punctuation">}</span>
</code></pre>
    <p>
     ç›´æ¥ä¸Š
     <code>
      BlogServiceImpl
     </code>
     å§ ï¼Œè¯¦ç»†çš„æ³¨é‡Šéƒ½æ”¾åœ¨ä»£ç é‡Œäº†ï¼Œé€šä¹‰åƒé—®ç”Ÿæˆï¼Œå¤§ä½“æ‡‚ã€‚
    </p>
    <p>
     æ ¸å¿ƒéƒ¨åˆ†çœ‹æŸ¥è¯¢
     <code>
      getList
     </code>
     æ–¹æ³•ï¼Œæ¶‰åŠåˆ°åˆ†é¡µäº†ï¼Œç®€å•å®šä¹‰äº†ä¸€ä¸ªåˆ†é¡µçš„å¯¹è±¡
    </p>
    <p>
     Pageå¯¹è±¡
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Page</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> page<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> size<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> total<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     ç®€å•çš„å°è£…ä¸€ä¸‹åˆ†é¡µå¯¹è±¡ã€è¯·æ±‚å‚æ•°å’Œè¿”å›ç»“æœçš„å¯¹è±¡
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlogPageDoc</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">Page</span> page<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">BlogDoc</span> query<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BlogDoc</span><span class="token punctuation">&gt;</span></span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     ã€æœ¬æ–‡é‡ç‚¹ã€‘Serviceå®ç°ç±»
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>toolkit<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">BlogDoc</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">BlogPageDoc</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Page</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">BlogMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">BlogRepository</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>es<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">BlogService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>index<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">BoolQueryBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>index<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">QueryBuilders</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>search<span class="token punctuation">.</span>fetch<span class="token punctuation">.</span>subphase<span class="token punctuation">.</span>highlight<span class="token punctuation">.</span></span><span class="token class-name">HighlightBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>search<span class="token punctuation">.</span>sort<span class="token punctuation">.</span></span><span class="token class-name">SortBuilders</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>search<span class="token punctuation">.</span>sort<span class="token punctuation">.</span></span><span class="token class-name">SortOrder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">PageRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">ElasticsearchRestTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">SearchHits</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span></span><span class="token class-name">IndexCoordinates</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>core<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">NativeSearchQueryBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>core<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">UpdateQuery</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CollectionUtils</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlogServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BlogService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BlogRepository</span> blogRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ElasticsearchRestTemplate</span> elasticsearchRestTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BlogMapper</span> blogTitleMapper<span class="token punctuation">;</span>

    <span class="token comment">/**
     * åˆ›å»ºå•æ¡æ•°æ®
     * &lt;p&gt;
     * è¯¥æ–¹æ³•è´Ÿè´£å°†ç»™å®šçš„BlogDocå¯¹è±¡ä¿å­˜åˆ°ESä¸­
     *
     * @param blogBean ä»£è¡¨è¦åˆ›å»ºçš„åšå®¢æ–‡ç« çš„æ–‡æ¡£å¯¹è±¡
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createBlog</span><span class="token punctuation">(</span><span class="token class-name">BlogDoc</span> blogBean<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        blogRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>blogBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * æ›´æ–°åšå®¢æ–‡æ¡£
     * &lt;p&gt;
     * ä½¿ç”¨Elasticsearchçš„è„šæœ¬æ›´æ–°åŠŸèƒ½æ¥æ›´æ–°åšå®¢æ–‡æ¡£çš„æ ‡é¢˜å’Œå†…å®¹
     *
     * @param blogBean åŒ…å«è¦æ›´æ–°çš„åšå®¢ä¿¡æ¯çš„BlogDocå¯¹è±¡ï¼ŒåŒ…æ‹¬åšå®¢çš„æ ‡é¢˜ã€å†…å®¹å’ŒID
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateBlog</span><span class="token punctuation">(</span><span class="token class-name">BlogDoc</span> blogBean<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">// æ„å»ºæ›´æ–°è„šæœ¬ï¼Œç”¨äºæ›´æ–°Elasticsearchæ–‡æ¡£çš„æ ‡é¢˜å’Œå†…å®¹</span>
        <span class="token comment">// ctx._source å›ºå®šå†™æ³•</span>
        <span class="token class-name">String</span> script <span class="token operator">=</span> <span class="token string">"ctx._source.title = '"</span> <span class="token operator">+</span> blogBean<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"';"</span> <span class="token operator">+</span>
                <span class="token string">"ctx._source.content = '"</span> <span class="token operator">+</span> blogBean<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">;</span>

        <span class="token comment">// æ„å»ºæ›´æ–°æŸ¥è¯¢å¯¹è±¡ï¼ŒæŒ‡å®šè¦æ›´æ–°çš„æ–‡æ¡£IDå’Œæ›´æ–°è„šæœ¬</span>
        <span class="token class-name">UpdateQuery</span> build <span class="token operator">=</span> <span class="token class-name">UpdateQuery</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>blogBean<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withScript</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æŒ‡å®šè¦æ›´æ–°çš„ç´¢å¼•åç§°</span>
        <span class="token class-name">IndexCoordinates</span> indexCoordinates <span class="token operator">=</span> <span class="token class-name">IndexCoordinates</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"blog_title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ‰§è¡Œæ›´æ–°æ“ä½œï¼Œå¹¶è·å–æ›´æ–°å“åº”</span>
        elasticsearchRestTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>build<span class="token punctuation">,</span> indexCoordinates<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * åˆå§‹åŒ–æ•°æ®æ–¹æ³•
     * &lt;p&gt;
     * è¯¥æ–¹æ³•ç”¨äºä»æ•°æ®åº“ä¸­åŠ è½½åšå®¢æ ‡é¢˜çš„ç›¸å…³ä¿¡æ¯ï¼Œå¹¶å¤„ç†å…³é”®è¯å­—ç¬¦ä¸²ï¼Œä»¥ä¾¿äºåç»­çš„æœç´¢æˆ–å±•ç¤º
     * å®ƒé¦–å…ˆä»æ•°æ®åº“ä¸­é€‰æ‹©æ‰€æœ‰åšå®¢æ ‡é¢˜çš„ä¿¡æ¯ï¼Œç„¶åéå†è¿™äº›ä¿¡æ¯ï¼Œå°†æ¯ä¸ªåšå®¢æ ‡é¢˜çš„å…³é”®è¯å­—ç¬¦ä¸²
     * è½¬æ¢ä¸ºå…³é”®è¯åˆ—è¡¨ï¼Œæœ€åå°†å¤„ç†åçš„åšå®¢æ ‡é¢˜ä¿¡æ¯ä¿å­˜åˆ°åšå®¢ä»“åº“ä¸­
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ä»æ•°æ®åº“ä¸­é€‰æ‹©æ‰€æœ‰åšå®¢æ ‡é¢˜çš„ä¿¡æ¯</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BlogDoc</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> blogTitleMapper<span class="token punctuation">.</span><span class="token function">selectTitleList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// éå†åšå®¢æ ‡é¢˜åˆ—è¡¨ï¼Œå¤„ç†æ¯ä¸ªåšå®¢æ ‡é¢˜çš„å…³é”®è¯</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BlogDoc</span> blogTitleVo <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// å¦‚æœåšå®¢æ ‡é¢˜çš„å…³é”®è¯ä¸ä¸ºç©ºï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºå…³é”®è¯åˆ—è¡¨</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>blogTitleVo<span class="token punctuation">.</span><span class="token function">getKeywords</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                blogTitleVo<span class="token punctuation">.</span><span class="token function">setKeywordList</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>blogTitleVo<span class="token punctuation">.</span><span class="token function">getKeywords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// å°†å¤„ç†åçš„åšå®¢æ ‡é¢˜åˆ—è¡¨ä¿å­˜åˆ°åšå®¢ä»“åº“ä¸­</span>
        blogRepository<span class="token punctuation">.</span><span class="token function">saveAll</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * åˆ é™¤æŒ‡å®šIDçš„åšå®¢
     *
     * @param id åšå®¢çš„å”¯ä¸€æ ‡è¯†ç¬¦
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteBlog</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        blogRepository<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">BlogPageDoc</span> <span class="token function">getListBlogTitle</span><span class="token punctuation">(</span><span class="token class-name">BlogPageDoc</span> blogTitleVo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">getList</span><span class="token punctuation">(</span>blogTitleVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * æ ¹æ®æŸ¥è¯¢æ¡ä»¶å’Œåˆ†é¡µä¿¡æ¯è·å–åšå®¢åˆ—è¡¨
     *
     * @param blogPageDoc åŒ…å«æŸ¥è¯¢æ¡ä»¶å’Œåˆ†é¡µä¿¡æ¯çš„åšå®¢é¡µé¢æ–‡æ¡£
     * @return è¿”å›å¡«å……äº†æŸ¥è¯¢ç»“æœçš„åšå®¢é¡µé¢æ–‡æ¡£
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">BlogPageDoc</span> <span class="token function">getList</span><span class="token punctuation">(</span><span class="token class-name">BlogPageDoc</span> blogPageDoc<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">// è·å–æŸ¥è¯¢æ¡ä»¶</span>
        <span class="token class-name">BlogDoc</span> blogDoc <span class="token operator">=</span> blogPageDoc<span class="token punctuation">.</span><span class="token function">getQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–åˆ†é¡µä¿¡æ¯</span>
        <span class="token class-name">Page</span> page <span class="token operator">=</span> blogPageDoc<span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// åˆ›å»ºé«˜äº®æ„å»ºå™¨</span>
        <span class="token class-name">HighlightBuilder</span> highlightBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HighlightBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è®¾ç½®éœ€è¦é«˜äº®çš„å­—æ®µ</span>
        highlightBuilder<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        highlightBuilder<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®é«˜äº®æ˜¾ç¤ºçš„å‰ç¼€å’Œåç¼€</span>
        highlightBuilder<span class="token punctuation">.</span><span class="token function">preTags</span><span class="token punctuation">(</span><span class="token string">"&lt;span style=\"font-color :red\"&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        highlightBuilder<span class="token punctuation">.</span><span class="token function">postTags</span><span class="token punctuation">(</span><span class="token string">"&lt;/span&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// åˆ›å»ºå¸ƒå°”æŸ¥è¯¢æ„å»ºå™¨</span>
        <span class="token class-name">BoolQueryBuilder</span> queryBuilders <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¦‚æœæ ‡é¢˜å…³é”®å­—ä¸ä¸ºç©ºï¼Œåˆ™å¿…é¡»åŒ¹é…keywordListä¸­çš„å…³é”®å­—</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>blogDoc<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// listä¸­æœ‰ä¸€ä¸ªåŒ¹é…æˆåŠŸï¼Œå°±ä»£è¡¨æˆåŠŸï¼Œè™½ç„¶æŒ‡å®šäº†keywordListçš„ç±»å‹ï¼Œä½†æ˜¯åœ¨esä¸­è¿˜æ˜¯textï¼ˆä¸çŸ¥é“æ˜¯ä¸æ˜¯å“ªä¸ªåœ°æ–¹bugäº†ï¼Œæš‚æœªéªŒè¯ï¼‰ï¼Œæ‰€ä»¥æŒ‡å®škeywordList.keyword</span>
            queryBuilders<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termsQuery</span><span class="token punctuation">(</span><span class="token string">"keywordList.keyword"</span><span class="token punctuation">,</span> blogDoc<span class="token punctuation">.</span><span class="token function">getKeywordList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// å¦‚æœç±»åˆ«IDä¸ä¸ºç©ºï¼Œåˆ™å¿…é¡»åŒ¹é…ç±»åˆ«ID</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>blogDoc<span class="token punctuation">.</span><span class="token function">getCategoryId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            queryBuilders<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">"categoryId"</span><span class="token punctuation">,</span> blogDoc<span class="token punctuation">.</span><span class="token function">getCategoryId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// å¦‚æœblogDocçš„é˜…è¯»æ•°é‡ä¸ä¸ºç©ºï¼Œåˆ™åœ¨æŸ¥è¯¢ä¸­æ·»åŠ é˜…è¯»æ•°é‡çš„èŒƒå›´æ¡ä»¶</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>blogDoc<span class="token punctuation">.</span><span class="token function">getReadNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// æ„å»ºä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼Œç­›é€‰å‡ºé˜…è¯»æ•°é‡å¤§äºå½“å‰åšå®¢é˜…è¯»æ•°é‡çš„æ–‡æ¡£</span>
            queryBuilders<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">rangeQuery</span><span class="token punctuation">(</span><span class="token string">"readNum"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span>blogDoc<span class="token punctuation">.</span><span class="token function">getReadNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// å¦‚æœæ ‡é¢˜ä¸ä¸ºç©ºï¼Œåˆ™åº”åŒ¹é…æ ‡é¢˜ã€æè¿°æˆ–å†…å®¹ä¸­çš„æ ‡é¢˜</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>blogDoc<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            queryBuilders<span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span> blogDoc<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            queryBuilders<span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">,</span> blogDoc<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            queryBuilders<span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">,</span> blogDoc<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è®¾ç½®è‡³å°‘åº”åŒ¹é…çš„æ¡ä»¶æ•°</span>
            queryBuilders<span class="token punctuation">.</span><span class="token function">minimumShouldMatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// æ‰§è¡Œæœç´¢å¹¶è·å–ç»“æœ</span>
        <span class="token class-name">SearchHits</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BlogDoc</span><span class="token punctuation">&gt;</span></span> searchHits <span class="token operator">=</span> elasticsearchRestTemplate<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NativeSearchQueryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">withQuery</span><span class="token punctuation">(</span>queryBuilders<span class="token punctuation">)</span> <span class="token comment">// è®¾ç½®æŸ¥è¯¢æ¡ä»¶</span>
                        <span class="token punctuation">.</span><span class="token function">withSorts</span><span class="token punctuation">(</span><span class="token class-name">SortBuilders</span><span class="token punctuation">.</span><span class="token function">fieldSort</span><span class="token punctuation">(</span><span class="token string">"readNum"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token class-name">SortOrder</span><span class="token punctuation">.</span><span class="token constant">DESC</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// è®¾ç½®æ’åºæ¡ä»¶</span>
                        <span class="token punctuation">.</span><span class="token function">withHighlightBuilder</span><span class="token punctuation">(</span>highlightBuilder<span class="token punctuation">)</span>  <span class="token comment">// è®¾ç½®é«˜äº®æ„å»ºå™¨</span>
                        <span class="token punctuation">.</span><span class="token function">withPageable</span><span class="token punctuation">(</span><span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> page<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// è®¾ç½®åˆ†é¡µä¿¡æ¯</span>
                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">BlogDoc</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºç»“æœåˆ—è¡¨</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BlogDoc</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®æ€»è®°å½•æ•°</span>
        page<span class="token punctuation">.</span><span class="token function">setTotal</span><span class="token punctuation">(</span>searchHits<span class="token punctuation">.</span><span class="token function">getTotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// éå†æœç´¢ç»“æœå¹¶å¤„ç†é«˜äº®æ˜¾ç¤º</span>
        searchHits<span class="token punctuation">.</span><span class="token function">getSearchHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>hits <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">BlogDoc</span> blogTitle <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> highlightFields <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getHighlightFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// å¦‚æœæ ‡é¢˜çš„é«˜äº®å­—æ®µä¸ä¸ºç©ºï¼Œåˆ™æ›¿æ¢æ ‡é¢˜</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>highlightFields<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                blogTitle<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>hits<span class="token punctuation">.</span><span class="token function">getHighlightFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// å¦‚æœæè¿°çš„é«˜äº®å­—æ®µä¸ä¸ºç©ºï¼Œåˆ™æ›¿æ¢æè¿°</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>highlightFields<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                blogTitle<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span>hits<span class="token punctuation">.</span><span class="token function">getHighlightFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// å°†å¤„ç†åçš„ç»“æœæ·»åŠ åˆ°åˆ—è¡¨ä¸­</span>
            result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>blogTitle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®æŸ¥è¯¢ç»“æœ</span>
        blogPageDoc<span class="token punctuation">.</span><span class="token function">setResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è¿”å›å¡«å……äº†æŸ¥è¯¢ç»“æœçš„åšå®¢é¡µé¢æ–‡æ¡£</span>
        <span class="token keyword">return</span> blogPageDoc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     å¯ä»¥åœ¨
     <code>
      elasticsearch-head
     </code>
     çœ‹åˆ°å¯¹åº”çš„æ•°æ®ï¼Œè¿™é‡Œå°±ä¸ä¸€æ­¥ä¸€æ­¥æ¼”ç¤ºäº†
    </p>
    <p>
     <img alt="image-20250305212410963" src="https://i-blog.csdnimg.cn/img_convert/85039bfd1a8f9bab3b6fd460e683d6ff.png"/>
    </p>
    <h3>
     <a id="5_418">
     </a>
     5.ç»“è¯­
    </h3>
    <p>
     æ–‡ä¸­åªæ”¾äº†ä¸€äº›æ ¸å¿ƒçš„ä»£ç 
    </p>
    <p>
     ä¸€äº›è°ƒç”¨æ•°æ®çš„ä»£ç å’ŒControllerçš„ä»£ç éƒ½æ²¡è´´ï¼Œéæ ¸å¿ƒ
    </p>
    <p>
     éœ€è¦çš„å°ä¼™ä¼´å¯ä»¥å‰å¾€githubæ‹‰æºç çœ‹ä¸€ä¸‹ã€‚
    </p>
    <p>
     æœ¬æ–‡æºç ï¼š
     <a href="https://github.com/hack-feng/maple-product/tree/main/maple-es">
      https://github.com/hack-feng/maple-product/tree/main/maple-es
     </a>
    </p>
    <blockquote>
     <p>
      ğŸ¾æˆ‘æ˜¯ç¬‘å°æ«ï¼Œå…¨ç½‘çš†å¯æœçš„ã€
      <a href="https://www.xiaoxiaofeng.com" rel="nofollow">
       ç¬‘å°æ«
      </a>
      ã€‘
     </p>
    </blockquote>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33343938383330342f:61727469636c652f64657461696c732f313436303533373338" class_="artid" style="display:none">
 </p>
</div>


