---
layout: post
title: "unity-webgl导出嵌套html以及导入django"
date: 2025-03-12 11:24:05 +0800
description: "由于SendMessage只能传递一个参数，但是有的时候需要函数有两个参数或者多个参数比如这里需要传入xy轴两个坐标的值，我们在C sharp中和index.html写函数时要么以json格式传入，要么先合并字符串再在两个文件中解成两个参数。其中：‘fffw’是unity物体对象名称，RandomPos和ChangePos是unity C Sharp中写的公共函数，作用是改变物体的位置和随机改变物体的位置。是 iframe 元素的一个属性，它返回 iframe 内部窗口的。【2】应用到django框架。"
keywords: "unity webgl导出嵌套html以及导入django"
categories: ['未分类']
tags: ['游戏引擎', 'Webgl', 'Unity']
artid: "146199092"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146199092
    alt: "unity-webgl导出嵌套html以及导入django"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146199092
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146199092
cover: https://bing.ee123.net/img/rand?artid=146199092
image: https://bing.ee123.net/img/rand?artid=146199092
img: https://bing.ee123.net/img/rand?artid=146199092
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     unity webgl导出嵌套html以及导入django
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <a class="link-info" href="https://developer.unity.cn/projects/66545214edbc2a001ddb2a0b" rel="nofollow" title="参考：https://developer.unity.cn/projects/66545214edbc2a001ddb2a0b">
      参考：https://developer.unity.cn/projects/66545214edbc2a001ddb2a0b
     </a>
    </p>
    <h2>
     【1】嵌套html
    </h2>
    <h3>
     一、在unity导出webgl格式，方法见上
    </h3>
    <h3>
     二、新建html作为嵌套的父级，在子级html（webgl自带的index.html）实例化对象。
    </h3>
    <p>
     <img alt="" height="593" src="https://i-blog.csdnimg.cn/direct/9b5af3355a4b449ba11a2f9464e0bab8.png" width="1098"/>
    </p>
    <h3>
     三、在index.html中script标签中添加函数并暴露给外部html
    </h3>
    <pre><code class="language-javascript">function whe() {
        if (TestInstance) {
          TestInstance.SendMessage('fffw', 'RandomPos');
        }
      }
      function wht(x,y){
        if (TestInstance) {
          const data=x+","+y;
          TestInstance.SendMessage('fffw', 'ChangePos',data);
        }
      }
      window.whe=whe;
      window.wht=wht;</code></pre>
    <p>
     其中：‘fffw’是unity物体对象名称，RandomPos和ChangePos是unity C Sharp中写的公共函数，作用是改变物体的位置和随机改变物体的位置。
    </p>
    <h3>
     四、编译父级html主体框架样式并嵌套。
    </h3>
    <pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;Nested Unity WebGL with Button&lt;/title&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"&gt;
    &lt;script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-s1swLUYcLBqAXHj7nWZcBD03oDfaVT4TaOQEaQGnSa65SsyckDHTlfGcB8+LOLkz" crossorigin="anonymous"&gt;&lt;/script&gt;
    &lt;style&gt;
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        iframe {
            width: 80%;
            height: 80%;
            border: none;
        }
        button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"&gt;&lt;/script&gt;
&lt;script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"&gt;&lt;/script&gt;
    &lt;!-- 嵌入 Unity 的 index.html --&gt;
    &lt;iframe id="unity-iframe" src="index.html" allowfullscreen&gt;&lt;/iframe&gt;

    &lt;!-- 创建按钮 --&gt;
&lt;div class="d-flex"&gt;
&lt;div class="form-floating me-3"&gt;
  &lt;input type="text" class="form-control" id="x" placeholder="x坐标"&gt;
  &lt;label for="x"&gt;x坐标&lt;/label&gt;
&lt;/div&gt;
&lt;div class="form-floating"&gt;
  &lt;input type="text" class="form-control" id="y" placeholder="y坐标"&gt;
  &lt;label for="y"&gt;y坐标&lt;/label&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="d-flex"&gt;
    &lt;button onclick="runWht()" class="btn btn-primary d-inline me-2"&gt;执行 输入跳转&lt;/button&gt;
    &lt;button onclick="runWhe()" class="btn btn-success d-inline"&gt;执行 随机跳转&lt;/button&gt;
&lt;/div&gt;
&lt;script&gt;
        // 获取 iframe 元素
        const iframe = document.getElementById('unity-iframe');

        // 定义按钮点击事件
        function runWhe() {
            // 通过 iframe 的 contentWindow 访问 Unity 的 whe 函数
            if (iframe.contentWindow &amp;&amp; typeof iframe.contentWindow.whe === 'function') {
                iframe.contentWindow.whe(); // 调用 whe 函数
            } else {
                console.error('无法访问 whe 函数，请确保 Unity 已加载完成。');
            }
        }

        function runWht(){
            let x = parseFloat(document.getElementById('x').value);
            let y = parseFloat(document.getElementById('y').value);
            // 检查输入是否有效
            if (!x || !y) {
                console.error('请输入有效的 x 和 y 值。');
                return;
            }
            if (iframe.contentWindow &amp;&amp; typeof iframe.contentWindow.wht === 'function') {
                iframe.contentWindow.wht(x,y); // 调用 wht 函数
            } else {
                console.error('无法访问 wht 函数，请确保 Unity 已加载完成。');
            }
        }
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
    <p>
     其中：runwhe runwht用于执行暴露的函数，if用于：
    </p>
    <ol>
     <li>
      <p>
       <strong>
        <code>
         iframe.contentWindow
        </code>
        是否存在
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <code>
          iframe.contentWindow
         </code>
         是 iframe 元素的一个属性，它返回 iframe 内部窗口的
         <code>
          window
         </code>
         对象。如果 iframe 已经加载完成并且可以访问，
         <code>
          iframe.contentWindow
         </code>
         会返回一个有效的
         <code>
          window
         </code>
         对象；否则，它可能是
         <code>
          null
         </code>
         或
         <code>
          undefined
         </code>
         。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        <code>
         iframe.contentWindow.whe
        </code>
        是否是一个函数
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <code>
          typeof iframe.contentWindow.whe === 'function'
         </code>
         用于检查
         <code>
          whe
         </code>
         是否是一个函数。如果
         <code>
          whe
         </code>
         是 iframe 内部窗口中的一个函数，那么这个条件为
         <code>
          true
         </code>
         ；否则为
         <code>
          false
         </code>
         。
        </p>
       </li>
      </ul>
     </li>
    </ol>
    <p>
    </p>
    <p>
     <span style="color:#efedf6">
      <span style="background-color:#fe2c24">
       注意
      </span>
     </span>
     <span style="color:#b95514">
      <span style="background-color:#ffd900">
       ：由于SendMessage只能传递一个参数，但是有的时候需要函数有两个参数或者多个参数比如这里需要传入xy轴两个坐标的值，我们在C sharp中和index.html写函数时要么以json格式传入，要么先合并字符串再在两个文件中解成两个参数。
      </span>
     </span>
    </p>
    <p>
    </p>
    <p>
     <span style="background-color:null">
      <span style="color:#0d0016">
       tips：这里调用的函数都是从iframe窗口中调用的，要先获取窗口，再调用windows暴露函数（使用 iframe.contentWindow.wht(x,y); // 调用 wht 函数）
      </span>
     </span>
    </p>
    <h2>
     <span style="color:#0d0016">
      【2】应用到django框架
     </span>
    </h2>
    <p>
     将main.html放在templates模板文件夹里，将webgl自带的文件放在static文件夹里。
    </p>
    <p>
     <img alt="" height="317" src="https://i-blog.csdnimg.cn/direct/7d4244ef747842f69b3d4c3a367a0960.png" width="419"/>
    </p>
    <p>
     在settings.py中配置base 静态文件目录
    </p>
    <p>
     <img alt="" height="149" src="https://i-blog.csdnimg.cn/direct/9132cfde2b804c609b2d00609b5a0a11.png" width="537"/>
    </p>
    <p>
     修改main.html打开iframe的路径
    </p>
    <p>
     <img alt="" height="84" src="https://i-blog.csdnimg.cn/direct/67c4c20635db4325b79bcebfc9f92eb0.png" width="1004"/>
    </p>
    <p>
     开头加上加载静态文件load static
    </p>
    <p>
     <img alt="" height="406" src="https://i-blog.csdnimg.cn/direct/f927bf669ca0427a8d37c75ca0df17bc.png" width="954"/>
    </p>
    <p>
     效果：
    </p>
    <div class="video">
     <iframe allowfullscreen="true" data-mediaembed="csdn" frameborder="0" id="9SmurK8g-1741759165377" src="https://live.csdn.net/v/embed/468407" style="width:100%;height:100%;">
     </iframe>
     <p>
      2025-03-12 11-34-27
     </p>
    </div>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f37353234373534382f:61727469636c652f64657461696c732f313436313939303932" class_="artid" style="display:none">
 </p>
</div>


