---
layout: post
title: "工程化与框架系列34-前端重构技巧指南"
date: 2025-03-15 22:18:58 +0800
description: "工程化与框架之旅第三十四站"
keywords: "工程化与框架系列（34）--前端重构技巧指南"
categories: ['前端工程化与框架']
tags: ['重构', '状态模式', '前端']
artid: "146286624"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146286624
    alt: "工程化与框架系列34-前端重构技巧指南"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146286624
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146286624
cover: https://bing.ee123.net/img/rand?artid=146286624
image: https://bing.ee123.net/img/rand?artid=146286624
img: https://bing.ee123.net/img/rand?artid=146286624
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     工程化与框架系列（34）--前端重构技巧指南
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="__0">
     </a>
     前端重构技巧指南 🔄
    </h2>
    <h3>
     <a id="_2">
     </a>
     引言
    </h3>
    <p>
     前端重构是提高代码质量和可维护性的重要手段。本文将深入探讨前端重构的各种技巧，包括代码分析、重构策略、测试保障等方面，帮助开发者更好地进行代码重构。
    </p>
    <h3>
     <a id="_6">
     </a>
     重构概述
    </h3>
    <p>
     前端重构主要包括以下方面：
    </p>
    <ul>
     <li>
      <strong>
       代码分析
      </strong>
      ：代码质量、复杂度、依赖关系等
     </li>
     <li>
      <strong>
       重构策略
      </strong>
      ：设计模式、代码组织、性能优化等
     </li>
     <li>
      <strong>
       测试保障
      </strong>
      ：单元测试、集成测试、回归测试等
     </li>
     <li>
      <strong>
       工具支持
      </strong>
      ：静态分析、自动重构、代码生成等
     </li>
     <li>
      <strong>
       版本控制
      </strong>
      ：分支管理、代码审查、合并策略等
     </li>
    </ul>
    <h3>
     <a id="_16">
     </a>
     重构工具实现
    </h3>
    <h4>
     <a id="_18">
     </a>
     代码分析器
    </h4>
    <pre><code class="prism language-typescript"><span class="token comment">// 代码分析器类</span>
<span class="token keyword">class</span> <span class="token class-name">CodeAnalyzer</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> instance<span class="token operator">:</span> CodeAnalyzer<span class="token punctuation">;</span>
    <span class="token keyword">private</span> config<span class="token operator">:</span> AnalyzerConfig<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>config <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            maxComplexity<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            maxLength<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
            maxParams<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            maxDepth<span class="token operator">:</span> <span class="token number">3</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 获取单例实例</span>
    <span class="token keyword">static</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> CodeAnalyzer <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>CodeAnalyzer<span class="token punctuation">.</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            CodeAnalyzer<span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CodeAnalyzer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> CodeAnalyzer<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 分析代码复杂度</span>
    <span class="token function">analyzeComplexity</span><span class="token punctuation">(</span>code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> ComplexityReport <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parseCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> report<span class="token operator">:</span> ComplexityReport <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            cyclomaticComplexity<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">calculateCyclomaticComplexity</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">,</span>
            cognitiveComplexity<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">calculateCognitiveComplexity</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">,</span>
            maintainabilityIndex<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">calculateMaintainabilityIndex</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>
            halsteadMetrics<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">calculateHalsteadMetrics</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> report<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 分析代码结构</span>
    <span class="token function">analyzeStructure</span><span class="token punctuation">(</span>code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> StructureReport <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parseCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> report<span class="token operator">:</span> StructureReport <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            functions<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">analyzeFunctions</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">,</span>
            classes<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">analyzeClasses</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">,</span>
            dependencies<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">analyzeDependencies</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">,</span>
            imports<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">analyzeImports</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> report<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 分析代码问题</span>
    <span class="token function">analyzeIssues</span><span class="token punctuation">(</span>code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> IssueReport <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parseCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> report<span class="token operator">:</span> IssueReport <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            complexity<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkComplexityIssues</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">,</span>
            naming<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkNamingIssues</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">,</span>
            duplication<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkDuplication</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>
            antiPatterns<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkAntiPatterns</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> report<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 解析代码为AST</span>
    <span class="token keyword">private</span> <span class="token function">parseCode</span><span class="token punctuation">(</span>code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 使用解析器生成AST</span>
        <span class="token comment">// 这里应该使用实际的解析器，如esprima、@babel/parser等</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 计算圈复杂度</span>
    <span class="token keyword">private</span> <span class="token function">calculateCyclomaticComplexity</span><span class="token punctuation">(</span>ast<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> complexity <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 遍历AST，计算分支数量</span>
        <span class="token comment">// if, else, switch, case, &amp;&amp;, ||, ?:, for, while, do-while</span>
        
        <span class="token keyword">return</span> complexity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 计算认知复杂度</span>
    <span class="token keyword">private</span> <span class="token function">calculateCognitiveComplexity</span><span class="token punctuation">(</span>ast<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> complexity <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 遍历AST，根据嵌套层级和控制流计算复杂度</span>
        
        <span class="token keyword">return</span> complexity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 计算可维护性指标</span>
    <span class="token keyword">private</span> <span class="token function">calculateMaintainabilityIndex</span><span class="token punctuation">(</span>code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 基于Halstead体积、圈复杂度和代码行数计算</span>
        <span class="token keyword">const</span> halstead <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">calculateHalsteadMetrics</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> cyclomatic <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">calculateCyclomaticComplexity</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> loc <span class="token operator">=</span> code<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        
        <span class="token keyword">const</span> mi <span class="token operator">=</span> <span class="token number">171</span> <span class="token operator">-</span> 
                  <span class="token number">5.2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>halstead<span class="token punctuation">.</span>volume<span class="token punctuation">)</span> <span class="token operator">-</span>
                  <span class="token number">0.23</span> <span class="token operator">*</span> cyclomatic <span class="token operator">-</span>
                  <span class="token number">16.2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>loc<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  
        <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> mi<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 计算Halstead度量</span>
    <span class="token keyword">private</span> <span class="token function">calculateHalsteadMetrics</span><span class="token punctuation">(</span>ast<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> HalsteadMetrics <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 计算操作符和操作数的数量</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
            volume<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            difficulty<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            effort<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            time<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            bugs<span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 分析函数</span>
    <span class="token keyword">private</span> <span class="token function">analyzeFunctions</span><span class="token punctuation">(</span>ast<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> FunctionInfo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> functions<span class="token operator">:</span> FunctionInfo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 遍历AST，收集函数信息</span>
        <span class="token comment">// 包括名称、参数、复杂度、行数等</span>
        
        <span class="token keyword">return</span> functions<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 分析类</span>
    <span class="token keyword">private</span> <span class="token function">analyzeClasses</span><span class="token punctuation">(</span>ast<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> ClassInfo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> classes<span class="token operator">:</span> ClassInfo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 遍历AST，收集类信息</span>
        <span class="token comment">// 包括名称、方法、属性、继承关系等</span>
        
        <span class="token keyword">return</span> classes<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 分析依赖关系</span>
    <span class="token keyword">private</span> <span class="token function">analyzeDependencies</span><span class="token punctuation">(</span>ast<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> DependencyInfo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> dependencies<span class="token operator">:</span> DependencyInfo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 分析模块依赖关系</span>
        <span class="token comment">// 包括导入导出、类继承、函数调用等</span>
        
        <span class="token keyword">return</span> dependencies<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 分析导入语句</span>
    <span class="token keyword">private</span> <span class="token function">analyzeImports</span><span class="token punctuation">(</span>ast<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> ImportInfo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> imports<span class="token operator">:</span> ImportInfo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 分析import语句</span>
        <span class="token comment">// 包括模块名、导入成员等</span>
        
        <span class="token keyword">return</span> imports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 检查复杂度问题</span>
    <span class="token keyword">private</span> <span class="token function">checkComplexityIssues</span><span class="token punctuation">(</span>ast<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> Issue<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> issues<span class="token operator">:</span> Issue<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 检查函数复杂度</span>
        <span class="token comment">// 检查函数长度</span>
        <span class="token comment">// 检查参数数量</span>
        <span class="token comment">// 检查嵌套深度</span>
        
        <span class="token keyword">return</span> issues<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 检查命名问题</span>
    <span class="token keyword">private</span> <span class="token function">checkNamingIssues</span><span class="token punctuation">(</span>ast<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> Issue<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> issues<span class="token operator">:</span> Issue<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 检查命名规范</span>
        <span class="token comment">// 检查命名长度</span>
        <span class="token comment">// 检查命名冲突</span>
        
        <span class="token keyword">return</span> issues<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 检查代码重复</span>
    <span class="token keyword">private</span> <span class="token function">checkDuplication</span><span class="token punctuation">(</span>code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Issue<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> issues<span class="token operator">:</span> Issue<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 检查重复代码块</span>
        <span class="token comment">// 计算重复率</span>
        
        <span class="token keyword">return</span> issues<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 检查反模式</span>
    <span class="token keyword">private</span> <span class="token function">checkAntiPatterns</span><span class="token punctuation">(</span>ast<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> Issue<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> issues<span class="token operator">:</span> Issue<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 检查全局变量</span>
        <span class="token comment">// 检查魔法数字</span>
        <span class="token comment">// 检查硬编码</span>
        <span class="token comment">// 检查长函数</span>
        <span class="token comment">// 检查大类</span>
        
        <span class="token keyword">return</span> issues<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 重构管理器类</span>
<span class="token keyword">class</span> <span class="token class-name">RefactoringManager</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> analyzer<span class="token operator">:</span> CodeAnalyzer<span class="token punctuation">;</span>
    <span class="token keyword">private</span> history<span class="token operator">:</span> RefactoringHistory<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>analyzer <span class="token operator">=</span> CodeAnalyzer<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 提取函数</span>
    <span class="token function">extractFunction</span><span class="token punctuation">(</span>
        code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
        selection<span class="token operator">:</span> Selection<span class="token punctuation">,</span>
        newName<span class="token operator">:</span> <span class="token builtin">string</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 分析选中代码</span>
        <span class="token keyword">const</span> selectedCode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSelectedCode</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> selection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> dependencies <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">analyzeDependencies</span><span class="token punctuation">(</span>selectedCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 生成函数声明</span>
        <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">generateParameters</span><span class="token punctuation">(</span>dependencies<span class="token punctuation">.</span>inputs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> returnValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">generateReturnValue</span><span class="token punctuation">(</span>dependencies<span class="token punctuation">.</span>outputs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 创建新函数</span>
        <span class="token keyword">const</span> newFunction <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createFunction</span><span class="token punctuation">(</span>
            newName<span class="token punctuation">,</span>
            params<span class="token punctuation">,</span>
            selectedCode<span class="token punctuation">,</span>
            returnValue
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 替换原代码</span>
        <span class="token keyword">const</span> refactoredCode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">replaceCode</span><span class="token punctuation">(</span>
            code<span class="token punctuation">,</span>
            selection<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">generateFunctionCall</span><span class="token punctuation">(</span>newName<span class="token punctuation">,</span> params<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 记录重构历史</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">recordHistory</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            type<span class="token operator">:</span> <span class="token string">'extractFunction'</span><span class="token punctuation">,</span>
            timestamp<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            original<span class="token operator">:</span> code<span class="token punctuation">,</span>
            refactored<span class="token operator">:</span> refactoredCode
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> refactoredCode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 提取组件</span>
    <span class="token function">extractComponent</span><span class="token punctuation">(</span>
        code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
        selection<span class="token operator">:</span> Selection<span class="token punctuation">,</span>
        newName<span class="token operator">:</span> <span class="token builtin">string</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 分析选中代码</span>
        <span class="token keyword">const</span> selectedCode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSelectedCode</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> selection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> dependencies <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">analyzeDependencies</span><span class="token punctuation">(</span>selectedCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 生成组件属性</span>
        <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">generateProps</span><span class="token punctuation">(</span>dependencies<span class="token punctuation">.</span>inputs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 创建新组件</span>
        <span class="token keyword">const</span> newComponent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createComponent</span><span class="token punctuation">(</span>
            newName<span class="token punctuation">,</span>
            props<span class="token punctuation">,</span>
            selectedCode
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 替换原代码</span>
        <span class="token keyword">const</span> refactoredCode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">replaceCode</span><span class="token punctuation">(</span>
            code<span class="token punctuation">,</span>
            selection<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">generateComponentUsage</span><span class="token punctuation">(</span>newName<span class="token punctuation">,</span> props<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 记录重构历史</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">recordHistory</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            type<span class="token operator">:</span> <span class="token string">'extractComponent'</span><span class="token punctuation">,</span>
            timestamp<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            original<span class="token operator">:</span> code<span class="token punctuation">,</span>
            refactored<span class="token operator">:</span> refactoredCode
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> refactoredCode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 重命名标识符</span>
    <span class="token function">renameIdentifier</span><span class="token punctuation">(</span>
        code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
        oldName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
        newName<span class="token operator">:</span> <span class="token builtin">string</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 分析代码中的引用</span>
        <span class="token keyword">const</span> references <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findReferences</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> oldName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 验证新名称</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">validateNewName</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> newName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 替换所有引用</span>
        <span class="token keyword">let</span> refactoredCode <span class="token operator">=</span> code<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> ref <span class="token keyword">of</span> references<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            refactoredCode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">replaceCode</span><span class="token punctuation">(</span>
                refactoredCode<span class="token punctuation">,</span>
                ref<span class="token punctuation">,</span>
                newName
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// 记录重构历史</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">recordHistory</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            type<span class="token operator">:</span> <span class="token string">'renameIdentifier'</span><span class="token punctuation">,</span>
            timestamp<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            original<span class="token operator">:</span> code<span class="token punctuation">,</span>
            refactored<span class="token operator">:</span> refactoredCode
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> refactoredCode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 移动代码</span>
    <span class="token function">moveCode</span><span class="token punctuation">(</span>
        sourceCode<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
        targetCode<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
        selection<span class="token operator">:</span> Selection<span class="token punctuation">,</span>
        targetLocation<span class="token operator">:</span> Location
    <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> source<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> target<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 分析选中代码</span>
        <span class="token keyword">const</span> selectedCode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSelectedCode</span><span class="token punctuation">(</span>sourceCode<span class="token punctuation">,</span> selection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> dependencies <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">analyzeDependencies</span><span class="token punctuation">(</span>selectedCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 验证移动的可行性</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">validateMove</span><span class="token punctuation">(</span>dependencies<span class="token punctuation">,</span> targetCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 从源文件移除代码</span>
        <span class="token keyword">const</span> newSourceCode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">replaceCode</span><span class="token punctuation">(</span>
            sourceCode<span class="token punctuation">,</span>
            selection<span class="token punctuation">,</span>
            <span class="token string">''</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 添加到目标文件</span>
        <span class="token keyword">const</span> newTargetCode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">insertCode</span><span class="token punctuation">(</span>
            targetCode<span class="token punctuation">,</span>
            targetLocation<span class="token punctuation">,</span>
            selectedCode
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 记录重构历史</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">recordHistory</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            type<span class="token operator">:</span> <span class="token string">'moveCode'</span><span class="token punctuation">,</span>
            timestamp<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            original<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> source<span class="token operator">:</span> sourceCode<span class="token punctuation">,</span> target<span class="token operator">:</span> targetCode <span class="token punctuation">}</span><span class="token punctuation">,</span>
            refactored<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> source<span class="token operator">:</span> newSourceCode<span class="token punctuation">,</span> target<span class="token operator">:</span> newTargetCode <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
            source<span class="token operator">:</span> newSourceCode<span class="token punctuation">,</span>
            target<span class="token operator">:</span> newTargetCode
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 内联函数</span>
    <span class="token function">inlineFunction</span><span class="token punctuation">(</span>
        code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
        functionName<span class="token operator">:</span> <span class="token builtin">string</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 查找函数定义</span>
        <span class="token keyword">const</span> functionDef <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findFunctionDefinition</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> functionName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 分析函数调用</span>
        <span class="token keyword">const</span> calls <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findFunctionCalls</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> functionName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 替换每个调用</span>
        <span class="token keyword">let</span> refactoredCode <span class="token operator">=</span> code<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> call <span class="token keyword">of</span> calls<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> inlinedCode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">generateInlinedCode</span><span class="token punctuation">(</span>
                functionDef<span class="token punctuation">,</span>
                call
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            refactoredCode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">replaceCode</span><span class="token punctuation">(</span>
                refactoredCode<span class="token punctuation">,</span>
                call<span class="token punctuation">.</span>range<span class="token punctuation">,</span>
                inlinedCode
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// 移除函数定义</span>
        refactoredCode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">replaceCode</span><span class="token punctuation">(</span>
            refactoredCode<span class="token punctuation">,</span>
            functionDef<span class="token punctuation">.</span>range<span class="token punctuation">,</span>
            <span class="token string">''</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 记录重构历史</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">recordHistory</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            type<span class="token operator">:</span> <span class="token string">'inlineFunction'</span><span class="token punctuation">,</span>
            timestamp<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            original<span class="token operator">:</span> code<span class="token punctuation">,</span>
            refactored<span class="token operator">:</span> refactoredCode
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> refactoredCode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 提取接口</span>
    <span class="token function">extractInterface</span><span class="token punctuation">(</span>
        code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
        className<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
        interfaceName<span class="token operator">:</span> <span class="token builtin">string</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 分析类定义</span>
        <span class="token keyword">const</span> classDef <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findClassDefinition</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> className<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 提取公共方法和属性</span>
        <span class="token keyword">const</span> members <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">extractPublicMembers</span><span class="token punctuation">(</span>classDef<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 生成接口定义</span>
        <span class="token keyword">const</span> interfaceDef <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createInterface</span><span class="token punctuation">(</span>
            interfaceName<span class="token punctuation">,</span>
            members
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 添加接口实现</span>
        <span class="token keyword">const</span> refactoredCode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addInterfaceImplementation</span><span class="token punctuation">(</span>
            code<span class="token punctuation">,</span>
            className<span class="token punctuation">,</span>
            interfaceName
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 记录重构历史</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">recordHistory</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            type<span class="token operator">:</span> <span class="token string">'extractInterface'</span><span class="token punctuation">,</span>
            timestamp<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            original<span class="token operator">:</span> code<span class="token punctuation">,</span>
            refactored<span class="token operator">:</span> refactoredCode
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> refactoredCode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 获取重构历史</span>
    <span class="token function">getHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> RefactoringHistory<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 撤销重构</span>
    <span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> lastRefactoring <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lastRefactoring<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">return</span> <span class="token keyword">typeof</span> lastRefactoring<span class="token punctuation">.</span>original <span class="token operator">===</span> <span class="token string">'string'</span>
            <span class="token operator">?</span> lastRefactoring<span class="token punctuation">.</span>original
            <span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>lastRefactoring<span class="token punctuation">.</span>original<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 记录重构历史</span>
    <span class="token keyword">private</span> <span class="token function">recordHistory</span><span class="token punctuation">(</span>history<span class="token operator">:</span> RefactoringHistory<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 限制历史记录数量</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 其他辅助方法...</span>
<span class="token punctuation">}</span>

<span class="token comment">// 接口定义</span>
<span class="token keyword">interface</span> <span class="token class-name">AnalyzerConfig</span> <span class="token punctuation">{<!-- --></span>
    maxComplexity<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    maxLength<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    maxParams<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    maxDepth<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">ComplexityReport</span> <span class="token punctuation">{<!-- --></span>
    cyclomaticComplexity<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    cognitiveComplexity<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    maintainabilityIndex<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    halsteadMetrics<span class="token operator">:</span> HalsteadMetrics<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">StructureReport</span> <span class="token punctuation">{<!-- --></span>
    functions<span class="token operator">:</span> FunctionInfo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    classes<span class="token operator">:</span> ClassInfo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    dependencies<span class="token operator">:</span> DependencyInfo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    imports<span class="token operator">:</span> ImportInfo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">IssueReport</span> <span class="token punctuation">{<!-- --></span>
    complexity<span class="token operator">:</span> Issue<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    naming<span class="token operator">:</span> Issue<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    duplication<span class="token operator">:</span> Issue<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    antiPatterns<span class="token operator">:</span> Issue<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">HalsteadMetrics</span> <span class="token punctuation">{<!-- --></span>
    volume<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    difficulty<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    effort<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    time<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    bugs<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">FunctionInfo</span> <span class="token punctuation">{<!-- --></span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    params<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    complexity<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    lines<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    dependencies<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">ClassInfo</span> <span class="token punctuation">{<!-- --></span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    methods<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    properties<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    superClass<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    interfaces<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">DependencyInfo</span> <span class="token punctuation">{<!-- --></span>
    source<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    target<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    type<span class="token operator">:</span> <span class="token string">'import'</span> <span class="token operator">|</span> <span class="token string">'extend'</span> <span class="token operator">|</span> <span class="token string">'implement'</span> <span class="token operator">|</span> <span class="token string">'use'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">ImportInfo</span> <span class="token punctuation">{<!-- --></span>
    module<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    members<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    isDefault<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Issue</span> <span class="token punctuation">{<!-- --></span>
    type<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    location<span class="token operator">:</span> Location<span class="token punctuation">;</span>
    severity<span class="token operator">:</span> <span class="token string">'error'</span> <span class="token operator">|</span> <span class="token string">'warning'</span> <span class="token operator">|</span> <span class="token string">'info'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Selection</span> <span class="token punctuation">{<!-- --></span>
    start<span class="token operator">:</span> Location<span class="token punctuation">;</span>
    end<span class="token operator">:</span> Location<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Location</span> <span class="token punctuation">{<!-- --></span>
    line<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    column<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">RefactoringHistory</span> <span class="token punctuation">{<!-- --></span>
    type<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    timestamp<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    original<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> object<span class="token punctuation">;</span>
    refactored<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> object<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> analyzer <span class="token operator">=</span> CodeAnalyzer<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RefactoringManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 分析代码</span>
<span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
function calculateTotal(items) {
    let total = 0;
    for (const item of items) {
        total += item.price * item.quantity;
    }
    return total;
}
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> complexityReport <span class="token operator">=</span> analyzer<span class="token punctuation">.</span><span class="token function">analyzeComplexity</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Complexity Report:'</span><span class="token punctuation">,</span> complexityReport<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> structureReport <span class="token operator">=</span> analyzer<span class="token punctuation">.</span><span class="token function">analyzeStructure</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Structure Report:'</span><span class="token punctuation">,</span> structureReport<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> issueReport <span class="token operator">=</span> analyzer<span class="token punctuation">.</span><span class="token function">analyzeIssues</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Issue Report:'</span><span class="token punctuation">,</span> issueReport<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 提取函数</span>
<span class="token keyword">const</span> refactoredCode <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">extractFunction</span><span class="token punctuation">(</span>
    code<span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
        start<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> line<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> column<span class="token operator">:</span> <span class="token number">8</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        end<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> line<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> column<span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'calculateItemTotal'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Refactored Code:'</span><span class="token punctuation">,</span> refactoredCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="_619">
     </a>
     最佳实践与建议
    </h3>
    <ol>
     <li>
      <p>
       <strong>
        重构时机
       </strong>
      </p>
      <ul>
       <li>
        代码异味
       </li>
       <li>
        性能问题
       </li>
       <li>
        可维护性差
       </li>
       <li>
        扩展性不足
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        重构策略
       </strong>
      </p>
      <ul>
       <li>
        小步重构
       </li>
       <li>
        保持测试
       </li>
       <li>
        及时提交
       </li>
       <li>
        代码审查
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        重构模式
       </strong>
      </p>
      <ul>
       <li>
        提取方法
       </li>
       <li>
        移动代码
       </li>
       <li>
        重命名
       </li>
       <li>
        内联代码
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        工具支持
       </strong>
      </p>
      <ul>
       <li>
        IDE支持
       </li>
       <li>
        静态分析
       </li>
       <li>
        自动化测试
       </li>
       <li>
        版本控制
       </li>
      </ul>
     </li>
    </ol>
    <h3>
     <a id="_645">
     </a>
     总结
    </h3>
    <p>
     前端重构需要考虑以下方面：
    </p>
    <ol>
     <li>
      代码分析和评估
     </li>
     <li>
      重构策略和方法
     </li>
     <li>
      测试和质量保证
     </li>
     <li>
      工具和自动化支持
     </li>
     <li>
      团队协作和流程
     </li>
    </ol>
    <p>
     通过合理的重构实践，可以持续改善代码质量。
    </p>
    <h3>
     <a id="_657">
     </a>
     学习资源
    </h3>
    <ol>
     <li>
      重构模式指南
     </li>
     <li>
      代码质量标准
     </li>
     <li>
      重构工具教程
     </li>
     <li>
      测试最佳实践
     </li>
     <li>
      版本控制技巧
     </li>
    </ol>
    <hr/>
    <p>
     如果你觉得这篇文章有帮助，欢迎点赞收藏，也期待在评论区看到你的想法和建议！👇
    </p>
    <p>
     <em>
      <strong>
       终身学习，共同成长。
      </strong>
     </em>
    </p>
    <p>
     咱们下一期见
    </p>
    <p>
     💻
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f4368656e374368616e2f:61727469636c652f64657461696c732f313436323836363234" class_="artid" style="display:none">
 </p>
</div>


