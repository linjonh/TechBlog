---
layout: post
title: "2023-03-23音视频解混合demuxer为PCM和YUV420P,用go语言编写"
date: 2025-01-17 07:18:59 +0800
description: "该代码示例展示了如何使用Go语言结合ffmpeg库进行音视频解混合，将媒体文件中的音频解码为16bi"
keywords: "解码库demuxer不支持解码视频codec"
categories: ['音视频Golang相关', '福大大架构师每日一题']
tags: ['音视频', 'Pcm', 'Golang']
artid: "129740519"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=129740519
    alt: "2023-03-23音视频解混合demuxer为PCM和YUV420P,用go语言编写"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=129740519
featuredImagePreview: https://bing.ee123.net/img/rand?artid=129740519
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     2023-03-23：音视频解混合（demuxer）为PCM和YUV420P，用go语言编写。
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     2023-03-23：音视频解混合（demuxer）为PCM和YUV420P，用go语言编写。
    </p>
    <p>
     答案2023-03-23：
    </p>
    <p>
     大体步骤如下：
    </p>
    <p>
     1.打开媒体文件，并获取音频和视频流。
    </p>
    <p>
     2.对于每个流，找到对应的解码器、创建解码上下文并打开解码器。
    </p>
    <p>
     3.一帧一帧读取压缩的音频或视频数据AVPacket，并调用对应的解码器进行解码。
    </p>
    <p>
     4.对于音频：重采样成16bit 44100 PCM格式，并将数据写入输出文件或缓冲区。
    </p>
    <p>
     5.对于视频：转换成YUV420P格式，并将数据写入输出文件或缓冲区。
    </p>
    <p>
     6.清理已分配的资源。
    </p>
    <p>
     代码见github/moonfdd/ffmpeg-go库。
    </p>
    <p>
     执行命令：
    </p>
    <pre><code class="prism language-bash">go run ./examples/a23.video_demuxer_mp42yuvpcm/main.go
</code></pre>
    <p>
     代码参考
     <a href="https://feater.top/ffmpeg/ffmpeg-demuxer-video-to-pcm-and-yuv420p" rel="nofollow">
      23：音视频解混合（demuxer）为PCM和YUV420P
     </a>
     ，代码如下：
    </p>
    <pre><code class="prism language-go"><span class="token comment">// https://feater.top/ffmpeg/ffmpeg-demuxer-video-to-pcm-and-yuv420</span>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"os"</span>
	<span class="token string">"os/exec"</span>
	<span class="token string">"unsafe"</span>

	<span class="token string">"github.com/moonfdd/ffmpeg-go/ffcommon"</span>
	<span class="token string">"github.com/moonfdd/ffmpeg-go/libavcodec"</span>
	<span class="token string">"github.com/moonfdd/ffmpeg-go/libavdevice"</span>
	<span class="token string">"github.com/moonfdd/ffmpeg-go/libavformat"</span>
	<span class="token string">"github.com/moonfdd/ffmpeg-go/libavutil"</span>
	<span class="token string">"github.com/moonfdd/ffmpeg-go/libswresample"</span>
	<span class="token string">"github.com/moonfdd/ffmpeg-go/libswscale"</span>
<span class="token punctuation">)</span>

<span class="token comment">/*
 * 音频播放命令：ffplay -ar 44100 -ac 1 -f s16le -i out.pcm
 */</span>
<span class="token keyword">const</span> i44100 <span class="token operator">=</span> <span class="token number">22050</span>

<span class="token keyword">func</span> <span class="token function">avcodec_save_audio_file</span><span class="token punctuation">(</span>pFormatCtx <span class="token operator">*</span>libavformat<span class="token punctuation">.</span>AVFormatContext<span class="token punctuation">,</span> streamIndex ffcommon<span class="token punctuation">.</span>FInt<span class="token punctuation">,</span> fileName <span class="token builtin">string</span><span class="token punctuation">)</span> ffcommon<span class="token punctuation">.</span>FInt <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> pCodec <span class="token operator">*</span>libavcodec<span class="token punctuation">.</span>AVCodec
	<span class="token keyword">var</span> pCodecCtx <span class="token operator">*</span>libavcodec<span class="token punctuation">.</span>AVCodecContext
	codecpar <span class="token operator">:=</span> pFormatCtx<span class="token punctuation">.</span><span class="token function">GetStream</span><span class="token punctuation">(</span><span class="token function">uint32</span><span class="token punctuation">(</span>streamIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Codecpar

	<span class="token comment">//4.获取解码器（一）:音频</span>
	<span class="token comment">//根据索引拿到对应的流</span>
	pCodec <span class="token operator">=</span> libavcodec<span class="token punctuation">.</span><span class="token function">AvcodecFindDecoder</span><span class="token punctuation">(</span>codecpar<span class="token punctuation">.</span>CodecId<span class="token punctuation">)</span>
	<span class="token keyword">if</span> pCodec <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"can't decoder audio\n"</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//申请一个解码上下文</span>
	pCodecCtx <span class="token operator">=</span> pCodec<span class="token punctuation">.</span><span class="token function">AvcodecAllocContext3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> pCodecCtx <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"can't allocate a audio decoding context\n"</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//用流解码信息初始化编码参数</span>
	pCodecCtx<span class="token punctuation">.</span><span class="token function">AvcodecParametersToContext</span><span class="token punctuation">(</span>codecpar<span class="token punctuation">)</span>

	<span class="token comment">//没有此句会出现：Could not update timestamps for skipped samples</span>
	pCodecCtx<span class="token punctuation">.</span>PktTimebase <span class="token operator">=</span> pFormatCtx<span class="token punctuation">.</span><span class="token function">GetStream</span><span class="token punctuation">(</span><span class="token function">uint32</span><span class="token punctuation">(</span>streamIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>TimeBase

	<span class="token comment">//5.打开解码器</span>
	<span class="token keyword">if</span> pCodecCtx<span class="token punctuation">.</span><span class="token function">AvcodecOpen2</span><span class="token punctuation">(</span>pCodec<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"can't open codec\n"</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//	printf("--------------- File Information ----------------\n");</span>
	<span class="token comment">//	av_dump_format(pFormatCtx, 0, fileName, 0);</span>
	<span class="token comment">//	printf("-------------------------------------------------\n");</span>

	<span class="token comment">//编码数据</span>
	packet <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>libavcodec<span class="token punctuation">.</span>AVPacket<span class="token punctuation">)</span>
	<span class="token comment">//解压缩数据</span>
	frame <span class="token operator">:=</span> libavutil<span class="token punctuation">.</span><span class="token function">AvFrameAlloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">//frame-&gt;16bit 44100 PCM统一音频采样格式与采样率</span>
	swrCtx <span class="token operator">:=</span> libswresample<span class="token punctuation">.</span><span class="token function">SwrAlloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">//重采样设置选项-----------------------------------------------------------start</span>
	<span class="token comment">//输入的采样格式</span>
	inSampleFmt <span class="token operator">:=</span> pCodecCtx<span class="token punctuation">.</span>SampleFmt
	<span class="token comment">//输出的采样格式</span>
	<span class="token keyword">var</span> outSampleFmt libswresample<span class="token punctuation">.</span>AVSampleFormat <span class="token operator">=</span> libavutil<span class="token punctuation">.</span>AV_SAMPLE_FMT_S16
	<span class="token comment">//输入的采样率</span>
	inSampleRate <span class="token operator">:=</span> pCodecCtx<span class="token punctuation">.</span>SampleRate
	<span class="token comment">//输出的采样率</span>
	<span class="token keyword">var</span> outSampleRate ffcommon<span class="token punctuation">.</span>FInt <span class="token operator">=</span> i44100
	<span class="token comment">//输入的声道布局</span>
	<span class="token keyword">var</span> inChannelLayout ffcommon<span class="token punctuation">.</span>FUint64T <span class="token operator">=</span> pCodecCtx<span class="token punctuation">.</span>ChannelLayout
	<span class="token comment">//输出的声道布局：CHANNEL_IN_MONO为单声道，CHANNEL_IN_STEREO为双声道</span>
	<span class="token keyword">var</span> outChannelLayout ffcommon<span class="token punctuation">.</span>FUint64T <span class="token operator">=</span> libavutil<span class="token punctuation">.</span>AV_CH_LAYOUT_MONO

	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"inSampleFmt = %d, inSampleRate = %d, inChannelLayout = %d， name = %s\n"</span><span class="token punctuation">,</span> inSampleFmt<span class="token punctuation">,</span> inSampleRate<span class="token punctuation">,</span>
		inChannelLayout<span class="token punctuation">,</span> ffcommon<span class="token punctuation">.</span><span class="token function">StringFromPtr</span><span class="token punctuation">(</span>pCodec<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">)</span>

	swrCtx<span class="token punctuation">.</span><span class="token function">SwrAllocSetOpts</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>outChannelLayout<span class="token punctuation">)</span><span class="token punctuation">,</span> outSampleFmt<span class="token punctuation">,</span> outSampleRate<span class="token punctuation">,</span>
		<span class="token function">int64</span><span class="token punctuation">(</span>inChannelLayout<span class="token punctuation">)</span><span class="token punctuation">,</span> inSampleFmt<span class="token punctuation">,</span> inSampleRate<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">uintptr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	swrCtx<span class="token punctuation">.</span><span class="token function">SwrInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">//重采样设置选项-----------------------------------------------------------end</span>

	<span class="token comment">//获取输出的声道个数</span>
	outChannelNb <span class="token operator">:=</span> libavutil<span class="token punctuation">.</span><span class="token function">AvGetChannelLayoutNbChannels</span><span class="token punctuation">(</span>outChannelLayout<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"outChannelNb = %d\n"</span><span class="token punctuation">,</span> outChannelNb<span class="token punctuation">)</span>

	<span class="token comment">// 	 //存储PCM数据</span>
	outBuffer <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>libavutil<span class="token punctuation">.</span><span class="token function">AvMalloc</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> i44100<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token comment">// 	 FILE *fp = fopen(fileName, "wb");</span>
	fp<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span>

	<span class="token comment">//回到流的初始位置</span>
	pFormatCtx<span class="token punctuation">.</span><span class="token function">AvSeekFrame</span><span class="token punctuation">(</span>streamIndex<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> libavformat<span class="token punctuation">.</span>AVSEEK_FLAG_BACKWARD<span class="token punctuation">)</span>

	<span class="token comment">//6.一帧一帧读取压缩的音频数据AVPacket</span>
	<span class="token keyword">for</span> pFormatCtx<span class="token punctuation">.</span><span class="token function">AvReadFrame</span><span class="token punctuation">(</span>packet<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> packet<span class="token punctuation">.</span>StreamIndex <span class="token operator">==</span> <span class="token function">uint32</span><span class="token punctuation">(</span>streamIndex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">//解码AVPacket --&gt; AVFrame</span>
			ret <span class="token operator">:=</span> pCodecCtx<span class="token punctuation">.</span><span class="token function">AvcodecSendPacket</span><span class="token punctuation">(</span>packet<span class="token punctuation">)</span>
			<span class="token keyword">if</span> ret <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
				fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Decode error\n"</span><span class="token punctuation">)</span>
				<span class="token keyword">break</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">if</span> pCodecCtx<span class="token punctuation">.</span><span class="token function">AvcodecReceiveFrame</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
				swrCtx<span class="token punctuation">.</span><span class="token function">SwrConvert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>outBuffer<span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>i44100<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span><span class="token builtin">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>frame<span class="token punctuation">.</span>Data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> frame<span class="token punctuation">.</span>NbSamples<span class="token punctuation">)</span>
				<span class="token comment">//获取sample的size</span>
				outBufferSize <span class="token operator">:=</span> libavutil<span class="token punctuation">.</span><span class="token function">AvSamplesGetBufferSize</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">,</span> outChannelNb<span class="token punctuation">,</span> frame<span class="token punctuation">.</span>NbSamples<span class="token punctuation">,</span> outSampleFmt<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token comment">//写入文件</span>
				fp<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>ffcommon<span class="token punctuation">.</span><span class="token function">ByteSliceFromByteP</span><span class="token punctuation">(</span>outBuffer<span class="token punctuation">,</span> <span class="token function">int</span><span class="token punctuation">(</span>outBufferSize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		packet<span class="token punctuation">.</span><span class="token function">AvPacketUnref</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	fp<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	libavutil<span class="token punctuation">.</span><span class="token function">AvFrameFree</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>frame<span class="token punctuation">)</span>
	libavutil<span class="token punctuation">.</span><span class="token function">AvFree</span><span class="token punctuation">(</span><span class="token function">uintptr</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>outBuffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	libswresample<span class="token punctuation">.</span><span class="token function">SwrFree</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>swrCtx<span class="token punctuation">)</span>
	pCodecCtx<span class="token punctuation">.</span><span class="token function">AvcodecClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
 * 视频播放命令：ffplay -video_size 654x368 -i out.yuv
 */</span>
<span class="token keyword">func</span> <span class="token function">avcodec_save_video_file</span><span class="token punctuation">(</span>pFormatCtx <span class="token operator">*</span>libavformat<span class="token punctuation">.</span>AVFormatContext<span class="token punctuation">,</span> streamIndex ffcommon<span class="token punctuation">.</span>FInt<span class="token punctuation">,</span> fileName <span class="token builtin">string</span><span class="token punctuation">)</span> ffcommon<span class="token punctuation">.</span>FInt <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> pCodec <span class="token operator">*</span>libavcodec<span class="token punctuation">.</span>AVCodec
	<span class="token keyword">var</span> pCodecCtx <span class="token operator">*</span>libavcodec<span class="token punctuation">.</span>AVCodecContext
	codecpar <span class="token operator">:=</span> pFormatCtx<span class="token punctuation">.</span><span class="token function">GetStream</span><span class="token punctuation">(</span><span class="token function">uint32</span><span class="token punctuation">(</span>streamIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Codecpar

	<span class="token comment">//4.获取解码器（一）:音频</span>
	<span class="token comment">//根据索引拿到对应的流</span>
	pCodec <span class="token operator">=</span> libavcodec<span class="token punctuation">.</span><span class="token function">AvcodecFindDecoder</span><span class="token punctuation">(</span>codecpar<span class="token punctuation">.</span>CodecId<span class="token punctuation">)</span>
	<span class="token keyword">if</span> pCodec <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"can't decoder audio\n"</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//申请一个解码上下文</span>
	pCodecCtx <span class="token operator">=</span> pCodec<span class="token punctuation">.</span><span class="token function">AvcodecAllocContext3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> pCodecCtx <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"can't allocate a audio decoding context\n"</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//用流解码信息初始化编码参数</span>
	pCodecCtx<span class="token punctuation">.</span><span class="token function">AvcodecParametersToContext</span><span class="token punctuation">(</span>codecpar<span class="token punctuation">)</span>

	<span class="token comment">//没有此句会出现：Could not update timestamps for skipped samples</span>
	pCodecCtx<span class="token punctuation">.</span>PktTimebase <span class="token operator">=</span> pFormatCtx<span class="token punctuation">.</span><span class="token function">GetStream</span><span class="token punctuation">(</span><span class="token function">uint32</span><span class="token punctuation">(</span>streamIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>TimeBase

	<span class="token comment">//5.打开解码器</span>
	<span class="token keyword">if</span> pCodecCtx<span class="token punctuation">.</span><span class="token function">AvcodecOpen2</span><span class="token punctuation">(</span>pCodec<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"can't open codec\n"</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//	printf("--------------- File Information ----------------\n");</span>
	<span class="token comment">//	av_dump_format(pFormatCtx, 0, fileName, 0);</span>
	<span class="token comment">//	printf("-------------------------------------------------\n");</span>

	<span class="token comment">//编码数据</span>
	pPacket <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>libavcodec<span class="token punctuation">.</span>AVPacket<span class="token punctuation">)</span>
	<span class="token comment">//解压缩数据</span>
	pFrame <span class="token operator">:=</span> libavutil<span class="token punctuation">.</span><span class="token function">AvFrameAlloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	pFrameYUV <span class="token operator">:=</span> libavutil<span class="token punctuation">.</span><span class="token function">AvFrameAlloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	outBuffer <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>libavutil<span class="token punctuation">.</span><span class="token function">AvMalloc</span><span class="token punctuation">(</span>
		<span class="token function">uint64</span><span class="token punctuation">(</span>libavutil<span class="token punctuation">.</span><span class="token function">AvImageGetBufferSize</span><span class="token punctuation">(</span>libavutil<span class="token punctuation">.</span>AV_PIX_FMT_YUV420P<span class="token punctuation">,</span> pCodecCtx<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> pCodecCtx<span class="token punctuation">.</span>Height<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	libavutil<span class="token punctuation">.</span><span class="token function">AvImageFillArrays</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token builtin">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pFrameYUV<span class="token punctuation">.</span>Data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token builtin">int32</span><span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pFrameYUV<span class="token punctuation">.</span>Linesize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> outBuffer<span class="token punctuation">,</span>
		libavutil<span class="token punctuation">.</span>AV_PIX_FMT_YUV420P<span class="token punctuation">,</span> pCodecCtx<span class="token punctuation">.</span>Width<span class="token punctuation">,</span>
		pCodecCtx<span class="token punctuation">.</span>Height<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

	pImgConvertCtx <span class="token operator">:=</span> libswscale<span class="token punctuation">.</span><span class="token function">SwsGetContext</span><span class="token punctuation">(</span>pCodecCtx<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> pCodecCtx<span class="token punctuation">.</span>Height<span class="token punctuation">,</span> pCodecCtx<span class="token punctuation">.</span>PixFmt<span class="token punctuation">,</span>
		pCodecCtx<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> pCodecCtx<span class="token punctuation">.</span>Height<span class="token punctuation">,</span> libavutil<span class="token punctuation">.</span>AV_PIX_FMT_YUV420P<span class="token punctuation">,</span> libswscale<span class="token punctuation">.</span>SWS_BICUBIC<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>

	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"width = %d, height = %d, name = %s\n"</span><span class="token punctuation">,</span> pCodecCtx<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> pCodecCtx<span class="token punctuation">.</span>Height<span class="token punctuation">,</span> ffcommon<span class="token punctuation">.</span><span class="token function">StringFromPtr</span><span class="token punctuation">(</span>pCodec<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">)</span>

	fp<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span>

	<span class="token comment">//回到流的初始位置</span>
	pFormatCtx<span class="token punctuation">.</span><span class="token function">AvSeekFrame</span><span class="token punctuation">(</span>streamIndex<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> libavformat<span class="token punctuation">.</span>AVSEEK_FLAG_BACKWARD<span class="token punctuation">)</span>

	<span class="token comment">//6.一帧一帧读取压缩的视频数据AVPacket</span>
	<span class="token keyword">for</span> pFormatCtx<span class="token punctuation">.</span><span class="token function">AvReadFrame</span><span class="token punctuation">(</span>pPacket<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> pPacket<span class="token punctuation">.</span>StreamIndex <span class="token operator">==</span> <span class="token function">uint32</span><span class="token punctuation">(</span>streamIndex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">//解码AVPacket --&gt; AVFrame</span>
			ret <span class="token operator">:=</span> pCodecCtx<span class="token punctuation">.</span><span class="token function">AvcodecSendPacket</span><span class="token punctuation">(</span>pPacket<span class="token punctuation">)</span>
			<span class="token keyword">if</span> ret <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
				fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Decode error\n"</span><span class="token punctuation">)</span>
				<span class="token keyword">break</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">if</span> pCodecCtx<span class="token punctuation">.</span><span class="token function">AvcodecReceiveFrame</span><span class="token punctuation">(</span>pFrame<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
				pImgConvertCtx<span class="token punctuation">.</span><span class="token function">SwsScale</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span><span class="token builtin">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pFrame<span class="token punctuation">.</span>Data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">int32</span><span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pFrame<span class="token punctuation">.</span>Linesize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
					<span class="token function">uint32</span><span class="token punctuation">(</span>pCodecCtx<span class="token punctuation">.</span>Height<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span><span class="token builtin">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pFrameYUV<span class="token punctuation">.</span>Data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">int32</span><span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pFrameYUV<span class="token punctuation">.</span>Linesize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

				y_size <span class="token operator">:=</span> pCodecCtx<span class="token punctuation">.</span>Width <span class="token operator">*</span> pCodecCtx<span class="token punctuation">.</span>Height
				fp<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>ffcommon<span class="token punctuation">.</span><span class="token function">ByteSliceFromByteP</span><span class="token punctuation">(</span>pFrameYUV<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">int</span><span class="token punctuation">(</span>y_size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">//Y</span>
				fp<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>ffcommon<span class="token punctuation">.</span><span class="token function">ByteSliceFromByteP</span><span class="token punctuation">(</span>pFrameYUV<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">int</span><span class="token punctuation">(</span>y_size<span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//U</span>
				fp<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>ffcommon<span class="token punctuation">.</span><span class="token function">ByteSliceFromByteP</span><span class="token punctuation">(</span>pFrameYUV<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">int</span><span class="token punctuation">(</span>y_size<span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//V</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		pPacket<span class="token punctuation">.</span><span class="token function">AvPacketUnref</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	fp<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	libavutil<span class="token punctuation">.</span><span class="token function">AvFrameFree</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pFrame<span class="token punctuation">)</span>
	libavutil<span class="token punctuation">.</span><span class="token function">AvFrameFree</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pFrameYUV<span class="token punctuation">)</span>
	libavutil<span class="token punctuation">.</span><span class="token function">AvFree</span><span class="token punctuation">(</span><span class="token function">uintptr</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>outBuffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	pCodecCtx<span class="token punctuation">.</span><span class="token function">AvcodecClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	os<span class="token punctuation">.</span><span class="token function">Setenv</span><span class="token punctuation">(</span><span class="token string">"Path"</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span><span class="token function">Getenv</span><span class="token punctuation">(</span><span class="token string">"Path"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">";./lib"</span><span class="token punctuation">)</span>
	ffcommon<span class="token punctuation">.</span><span class="token function">SetAvutilPath</span><span class="token punctuation">(</span><span class="token string">"./lib/avutil-56.dll"</span><span class="token punctuation">)</span>
	ffcommon<span class="token punctuation">.</span><span class="token function">SetAvcodecPath</span><span class="token punctuation">(</span><span class="token string">"./lib/avcodec-58.dll"</span><span class="token punctuation">)</span>
	ffcommon<span class="token punctuation">.</span><span class="token function">SetAvdevicePath</span><span class="token punctuation">(</span><span class="token string">"./lib/avdevice-58.dll"</span><span class="token punctuation">)</span>
	ffcommon<span class="token punctuation">.</span><span class="token function">SetAvfilterPath</span><span class="token punctuation">(</span><span class="token string">"./lib/avfilter-56.dll"</span><span class="token punctuation">)</span>
	ffcommon<span class="token punctuation">.</span><span class="token function">SetAvformatPath</span><span class="token punctuation">(</span><span class="token string">"./lib/avformat-58.dll"</span><span class="token punctuation">)</span>
	ffcommon<span class="token punctuation">.</span><span class="token function">SetAvpostprocPath</span><span class="token punctuation">(</span><span class="token string">"./lib/postproc-55.dll"</span><span class="token punctuation">)</span>
	ffcommon<span class="token punctuation">.</span><span class="token function">SetAvswresamplePath</span><span class="token punctuation">(</span><span class="token string">"./lib/swresample-3.dll"</span><span class="token punctuation">)</span>
	ffcommon<span class="token punctuation">.</span><span class="token function">SetAvswscalePath</span><span class="token punctuation">(</span><span class="token string">"./lib/swscale-5.dll"</span><span class="token punctuation">)</span>

	genDir <span class="token operator">:=</span> <span class="token string">"./out"</span>
	<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Stat</span><span class="token punctuation">(</span>genDir<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> os<span class="token punctuation">.</span><span class="token function">IsNotExist</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			os<span class="token punctuation">.</span><span class="token function">Mkdir</span><span class="token punctuation">(</span>genDir<span class="token punctuation">,</span> <span class="token number">0777</span><span class="token punctuation">)</span> <span class="token comment">//  Everyone can read write and execute</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	inputFile <span class="token operator">:=</span> <span class="token string">"./resources/big_buck_bunny.mp4"</span>
	outAudioFile <span class="token operator">:=</span> <span class="token string">"./out/a23.pcm"</span>
	outVideoFile <span class="token operator">:=</span> <span class="token string">"./out/a23.yuv"</span>

	<span class="token keyword">var</span> videoStreamIndex ffcommon<span class="token punctuation">.</span>FInt <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
	<span class="token keyword">var</span> audioStreamIndex ffcommon<span class="token punctuation">.</span>FInt <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
	<span class="token keyword">var</span> i ffcommon<span class="token punctuation">.</span>FUnsignedInt <span class="token operator">=</span> <span class="token number">0</span>
	<span class="token keyword">var</span> pFormatCtx <span class="token operator">*</span>libavformat<span class="token punctuation">.</span>AVFormatContext

	<span class="token comment">//1.注册组件</span>
	libavdevice<span class="token punctuation">.</span><span class="token function">AvdeviceRegisterAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">//封装格式上下文</span>
	pFormatCtx <span class="token operator">=</span> libavformat<span class="token punctuation">.</span><span class="token function">AvformatAllocContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">//2.打开输入文件</span>
	<span class="token keyword">if</span> libavformat<span class="token punctuation">.</span><span class="token function">AvformatOpenInput</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pFormatCtx<span class="token punctuation">,</span> inputFile<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"can't open input file\n"</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//3.获取音视频信息</span>
	<span class="token keyword">if</span> pFormatCtx<span class="token punctuation">.</span><span class="token function">AvformatFindStreamInfo</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"can't find stream info\n"</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//音视频编码，找到对应的音视频流的索引位置</span>
	<span class="token comment">//找到音频流的索引</span>
	<span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pFormatCtx<span class="token punctuation">.</span>NbStreams<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> pFormatCtx<span class="token punctuation">.</span><span class="token function">GetStream</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>Codecpar<span class="token punctuation">.</span>CodecType <span class="token operator">==</span> libavutil<span class="token punctuation">.</span>AVMEDIA_TYPE_AUDIO <span class="token punctuation">{<!-- --></span>
			audioStreamIndex <span class="token operator">=</span> <span class="token function">int32</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
			<span class="token keyword">break</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//找到视频流的索引</span>
	<span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pFormatCtx<span class="token punctuation">.</span>NbStreams<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> pFormatCtx<span class="token punctuation">.</span><span class="token function">GetStream</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>Codecpar<span class="token punctuation">.</span>CodecType <span class="token operator">==</span> libavutil<span class="token punctuation">.</span>AVMEDIA_TYPE_VIDEO <span class="token punctuation">{<!-- --></span>
			videoStreamIndex <span class="token operator">=</span> <span class="token function">int32</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
			<span class="token keyword">break</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"audioStreamIndex = %d, videoStreamIndex = %d\n"</span><span class="token punctuation">,</span> audioStreamIndex<span class="token punctuation">,</span> videoStreamIndex<span class="token punctuation">)</span>

	<span class="token keyword">if</span> audioStreamIndex <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"can't find a audio stream\n"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"try to save audio stream\n"</span><span class="token punctuation">)</span>
		<span class="token function">avcodec_save_audio_file</span><span class="token punctuation">(</span>pFormatCtx<span class="token punctuation">,</span> audioStreamIndex<span class="token punctuation">,</span> outAudioFile<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> videoStreamIndex <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"can't find a video stream\n"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"try to save video stream\n"</span><span class="token punctuation">)</span>
		<span class="token function">avcodec_save_video_file</span><span class="token punctuation">(</span>pFormatCtx<span class="token punctuation">,</span> videoStreamIndex<span class="token punctuation">,</span> outVideoFile<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	libavformat<span class="token punctuation">.</span><span class="token function">AvformatCloseInput</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pFormatCtx<span class="token punctuation">)</span>

	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------"</span><span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> exec<span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">"./lib/ffplay.exe"</span><span class="token punctuation">,</span> <span class="token string">"-ar"</span><span class="token punctuation">,</span> <span class="token string">"22050"</span><span class="token punctuation">,</span> <span class="token string">"-ac"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"-f"</span><span class="token punctuation">,</span> <span class="token string">"s16le"</span><span class="token punctuation">,</span> <span class="token string">"-i"</span><span class="token punctuation">,</span> outAudioFile<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"play err = "</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> exec<span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">"./lib/ffplay.exe"</span><span class="token punctuation">,</span> <span class="token string">"-video_size"</span><span class="token punctuation">,</span> <span class="token string">"640*360"</span><span class="token punctuation">,</span> <span class="token string">"-i"</span><span class="token punctuation">,</span> outVideoFile<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"play err = "</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/39b980d3485f91b3fbf565e973f8e6b2.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34383530323036322f:61727469636c652f64657461696c732f313239373430353139" class_="artid" style="display:none">
 </p>
</div>


