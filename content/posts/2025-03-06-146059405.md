---
layout: post
title: "碰一碰发视频系统之写卡功能开发了,支持OEM"
date: 2025-03-06 09:33:28 +0800
description: "碰一碰发视频系统中的写卡功能开发涉及到硬件设备、软件框架以及通信协议等多个方面。通过深入理解 NFC 写卡技术原理，合理搭建开发环境，并准确实现代码逻辑，能够开发出高效、稳定的写卡功能。同时，在开发过程中要注重数据校验、标签兼容性和性能优化等问题，以提升整个系统的用户体验和可靠性。希望本文能为从事相关开发工作的技术人员提供有益的参考，助力碰一碰发视频系统的进一步发展和完善。"
keywords: "碰一碰发视频系统之写卡功能开发了，支持OEM"
categories: ['未分类']
tags: ['音视频', '线性代数', '矩阵']
artid: "146059405"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146059405
    alt: "碰一碰发视频系统之写卡功能开发了,支持OEM"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146059405
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146059405
cover: https://bing.ee123.net/img/rand?artid=146059405
image: https://bing.ee123.net/img/rand?artid=146059405
img: https://bing.ee123.net/img/rand?artid=146059405
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     碰一碰发视频系统之写卡功能开发了，支持OEM
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h3>
     一、引言
    </h3>
    <p>
     在碰一碰发视频系统中，NFC（Near Field Communication，近场通信）技术扮演着关键角色。其中，写卡功能是实现用户与系统便捷交互的重要环节，通过将特定的视频相关信息写入 NFC 标签，用户只需轻轻一碰，就能触发视频的播放或相关操作。本文将深入探讨碰一碰发视频系统中写卡功能的技术开发细节。
    </p>
    <p>
     <img alt="" height="720" src="https://i-blog.csdnimg.cn/direct/15e2e05c1b3f4e2aa4bbf6dfd188cd1f.jpeg" width="1280"/>
    </p>
    <h3>
     二、NFC 写卡技术原理
    </h3>
    <p>
     NFC 技术基于射频识别（RFID）技术发展而来，工作频率为 13.56MHz。在写卡过程中，主要涉及两个设备：NFC 读写器（如手机或专用读写设备）和 NFC 标签。当读写器靠近标签时，通过射频信号与标签进行通信。读写器向标签发送写命令及要写入的数据，标签接收到信号后，对数据进行校验和存储。
    </p>
    <p>
     <img alt="" height="1238" src="https://i-blog.csdnimg.cn/direct/55f827a8f52b4fc88ed33c8341702699.png" width="2280"/>
    </p>
    <p>
     NFC 标签通常分为只读标签、一次写入多次读取（WORM）标签和可读写标签。在碰一碰发视频系统中，一般使用可读写标签，常见的类型有 MIFARE Classic 系列等。这些标签内部有特定的存储结构，分为多个扇区，每个扇区又包含若干块，不同的块用于存储不同类型的数据，如密钥、用户数据等。写卡操作就是按照标签的存储结构，将视频相关信息准确写入对应的存储块中。
    </p>
    <h3>
     三、开发环境搭建
    </h3>
    <h4>
     （一）硬件准备
    </h4>
    <ol>
     <li>
      <strong>
       NFC 读写设备
      </strong>
      ：若使用手机作为读写器，确保手机支持 NFC 功能且已开启。对于更专业的开发场景，可选用专用的 NFC 读写器模块，如 PN532 模块。该模块可通过 SPI 或 I2C 接口与微控制器连接，方便进行开发。
     </li>
    </ol>
    <ol>
     <li>
      <strong>
       NFC 标签
      </strong>
      ：根据项目需求选择合适的可读写 NFC 标签。如 MIFARE Classic 1K 标签，它具有 1KB 的存储空间，分为 16 个扇区，每个扇区 4 个块，非常适合存储一些小型的视频索引信息、URL 链接等。
     </li>
    </ol>
    <h4>
     （二）软件准备
    </h4>
    <ol>
     <li>
      <strong>
       编程语言
      </strong>
      ：对于手机端开发，Android 平台可使用 Java 或 Kotlin 语言，iOS 平台则使用 Swift 或 Objective - C。如果是基于微控制器的专用读写器开发，可选用 C/C++ 语言。
     </li>
    </ol>
    <ol>
     <li>
      <strong>
       开发框架与库
      </strong>
      ：
     </li>
    </ol>
    <ul>
     <li>
      <ul>
       <li>
        <strong>
         Android
        </strong>
        ：使用 Android NFC 框架，该框架提供了一系列 API 来处理 NFC 相关的操作，如发现 NFC 标签、读写标签数据等。同时，可能需要引入一些第三方库来简化开发流程，如 NFC - Tools 库。
       </li>
      </ul>
     </li>
    </ul>
    <ul>
     <li>
      <ul>
       <li>
        <strong>
         iOS
        </strong>
        ：利用 Core NFC 框架，它允许 iOS 设备读取和写入符合 NFC 数据交换格式（NDEF）的标签。
       </li>
      </ul>
     </li>
    </ul>
    <ul>
     <li>
      <ul>
       <li>
        <strong>
         基于微控制器
        </strong>
        ：如果使用 Arduino 开发板与 PN532 模块结合，可使用 Arduino IDE，并安装 PN532 库，该库提供了丰富的函数来操作 PN532 模块进行 NFC 标签的读写。
       </li>
      </ul>
     </li>
    </ul>
    <h3>
     四、写卡功能代码实现
    </h3>
    <h4>
     （一）Android 平台代码示例（Java）
    </h4>
    <ol>
     <li>
      <strong>
       初始化 NFC 功能
      </strong>
     </li>
    </ol>
    <pre></pre>
    <p>
     <code>
      NfcManager nfcManager = (NfcManager) getSystemService(Context.NFC_SERVICE);
     </code>
    </p>
    <p>
     <code>
      NfcAdapter nfcAdapter = nfcManager.getDefaultAdapter();
     </code>
    </p>
    <p>
     <code>
      if (nfcAdapter == null) {
      <!-- -->
     </code>
    </p>
    <p>
     <code>
      // 设备不支持NFC功能
     </code>
    </p>
    <p>
     <code>
      Toast.makeText(this, "设备不支持NFC", Toast.LENGTH_SHORT).show();
     </code>
    </p>
    <p>
     <code>
      return;
     </code>
    </p>
    <p>
     <code>
      }
     </code>
    </p>
    <ol>
     <li>
      <strong>
       写入数据到 NFC 标签
      </strong>
     </li>
    </ol>
    <pre></pre>
    <p>
     <code>
      // 假设要写入的视频URL
     </code>
    </p>
    <p>
     <code>
      String videoUrl = "https://example.com/video1";
     </code>
    </p>
    <p>
     <code>
      NdefRecord record = NdefRecord.createUri(videoUrl);
     </code>
    </p>
    <p>
     <code>
      NdefMessage message = new NdefMessage(new NdefRecord[]{record});
     </code>
    </p>
    <p>
     <code>
      // 处理发现的NFC标签
     </code>
    </p>
    <p>
     <code>
      PendingIntent pendingIntent = PendingIntent.getActivity(this, 0, new Intent(this, getClass()).addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP), 0);
     </code>
    </p>
    <p>
     <code>
      IntentFilter[] intentFilters = new IntentFilter[]{new IntentFilter(NfcAdapter.ACTION_NDEF_DISCOVERED)};
     </code>
    </p>
    <p>
     <code>
      String[][] techLists = new String[][]{new String[]{Ndef.class.getName()}};
     </code>
    </p>
    <p>
     <code>
      nfcAdapter.enableForegroundDispatch(this, pendingIntent, intentFilters, techLists);
     </code>
    </p>
    <p>
     <code>
      @Override
     </code>
    </p>
    <p>
     <code>
      protected void onNewIntent(Intent intent) {
      <!-- -->
     </code>
    </p>
    <p>
     <code>
      super.onNewIntent(intent);
     </code>
    </p>
    <p>
     <code>
      if (NfcAdapter.ACTION_NDEF_DISCOVERED.equals(intent.getAction())) {
      <!-- -->
     </code>
    </p>
    <p>
     <code>
      Parcelable[] rawMsgs = intent.getParcelableArrayExtra(NfcAdapter.EXTRA_NDEF_MESSAGES);
     </code>
    </p>
    <p>
     <code>
      if (rawMsgs != null) {
      <!-- -->
     </code>
    </p>
    <p>
     <code>
      NdefMessage[] msgs = new NdefMessage[rawMsgs.length];
     </code>
    </p>
    <p>
     <code>
      for (int i = 0; i &lt; rawMsgs.length; i++) {
      <!-- -->
     </code>
    </p>
    <p>
     <code>
      msgs[i] = (NdefMessage) rawMsgs[i];
     </code>
    </p>
    <p>
     <code>
      }
     </code>
    </p>
    <p>
     <code>
      try {
      <!-- -->
     </code>
    </p>
    <p>
     <code>
      Tag tag = intent.getParcelableExtra(NfcAdapter.EXTRA_TAG);
     </code>
    </p>
    <p>
     <code>
      Ndef ndef = Ndef.get(tag);
     </code>
    </p>
    <p>
     <code>
      ndef.connect();
     </code>
    </p>
    <p>
     <code>
      ndef.writeNdefMessage(message);
     </code>
    </p>
    <p>
     <code>
      ndef.close();
     </code>
    </p>
    <p>
     <code>
      Toast.makeText(this, "数据写入成功", Toast.LENGTH_SHORT).show();
     </code>
    </p>
    <p>
     <code>
      } catch (Exception e) {
      <!-- -->
     </code>
    </p>
    <p>
     <code>
      e.printStackTrace();
     </code>
    </p>
    <p>
     <code>
      Toast.makeText(this, "数据写入失败", Toast.LENGTH_SHORT).show();
     </code>
    </p>
    <p>
     <code>
      }
     </code>
    </p>
    <p>
     <code>
      }
     </code>
    </p>
    <p>
     <code>
      }
     </code>
    </p>
    <p>
     <code>
      }
     </code>
    </p>
    <h4>
     （二）iOS 平台代码示例（Swift）
    </h4>
    <ol>
     <li>
      <strong>
       请求 NFC 权限并初始化
      </strong>
     </li>
    </ol>
    <pre></pre>
    <p>
     <code>
      import CoreNFC
     </code>
    </p>
    <p>
     <code>
      class ViewController: UIViewController, NFCNDEFReaderSessionDelegate {
      <!-- -->
     </code>
    </p>
    <p>
     <code>
      override func viewDidLoad() {
      <!-- -->
     </code>
    </p>
    <p>
     <code>
      super.viewDidLoad()
     </code>
    </p>
    <p>
     <code>
      let session = NFCNDEFReaderSession(delegate: self, queue: nil, invalidateAfterFirstRead: false)
     </code>
    </p>
    <p>
     <code>
      session.begin()
     </code>
    </p>
    <p>
     <code>
      }
     </code>
    </p>
    <p>
     <code>
      }
     </code>
    </p>
    <ol>
     <li>
      <strong>
       写入数据到 NFC 标签
      </strong>
     </li>
    </ol>
    <pre></pre>
    <p>
     <code>
      func readerSession(_ session: NFCNDEFReaderSession, didDetectNDEFs messages: [NFCNDEFMessage]) {
      <!-- -->
     </code>
    </p>
    <p>
     <code>
      let videoUrl = URL(string: "https://example.com/video1")!
     </code>
    </p>
    <p>
     <code>
      let urlRecord = NFCNDEFPayload.wellKnownTypeURIPayload(url: videoUrl)
     </code>
    </p>
    <p>
     <code>
      let newMessage = NFCNDEFMessage(records: [urlRecord])
     </code>
    </p>
    <p>
     <code>
      session.writeNDEF(newMessage, to: messages[0].readableNFCNDEFTag) { (error) in
     </code>
    </p>
    <p>
     <code>
      if let error = error {
      <!-- -->
     </code>
    </p>
    <p>
     <code>
      print("写入失败: \(error)")
     </code>
    </p>
    <p>
     <code>
      } else {
      <!-- -->
     </code>
    </p>
    <p>
     <code>
      print("数据写入成功")
     </code>
    </p>
    <p>
     <code>
      }
     </code>
    </p>
    <p>
     <code>
      }
     </code>
    </p>
    <p>
     <code>
      }
     </code>
    </p>
    <h4>
     （三）基于 Arduino 与 PN532 模块的 C/C++ 代码示例
    </h4>
    <ol>
     <li>
      <strong>
       引入库并初始化 PN532 模块
      </strong>
     </li>
    </ol>
    <pre></pre>
    <p>
     <code>
      #include &lt;PN532.h&gt;
     </code>
    </p>
    <p>
     <code>
      #include &lt;PN532_SPI.h&gt;
     </code>
    </p>
    <p>
     <code>
      #include &lt;PN532_NDEF.h&gt;
     </code>
    </p>
    <p>
     <code>
      PN532_SPI pn532spi(SPI, 10);
     </code>
    </p>
    <p>
     <code>
      PN532 nfc(pn532spi);
     </code>
    </p>
    <p>
     <code>
      void setup() {
      <!-- -->
     </code>
    </p>
    <p>
     <code>
      Serial.begin(9600);
     </code>
    </p>
    <p>
     <code>
      nfc.begin();
     </code>
    </p>
    <p>
     <code>
      uint32_t versiondata = nfc.getFirmwareVersion();
     </code>
    </p>
    <p>
     <code>
      if (!versiondata) {
      <!-- -->
     </code>
    </p>
    <p>
     <code>
      Serial.println("PN53x not found");
     </code>
    </p>
    <p>
     <code>
      while (1);
     </code>
    </p>
    <p>
     <code>
      }
     </code>
    </p>
    <p>
     <code>
      Serial.print("Found chip PN5"); Serial.println((versiondata&gt;&gt;24) &amp; 0xFF, HEX);
     </code>
    </p>
    <p>
     <code>
      Serial.print("Firmware ver. "); Serial.print((versiondata&gt;&gt;16) &amp; 0xFF, DEC);
     </code>
    </p>
    <p>
     <code>
      Serial.print('.'); Serial.println((versiondata&gt;&gt;8) &amp; 0xFF, DEC);
     </code>
    </p>
    <p>
     <code>
      nfc.SAMConfig();
     </code>
    </p>
    <p>
     <code>
      }
     </code>
    </p>
    <ol>
     <li>
      <strong>
       写入数据到 NFC 标签
      </strong>
     </li>
    </ol>
    <pre></pre>
    <p>
     <code>
      void loop() {
      <!-- -->
     </code>
    </p>
    <p>
     <code>
      String videoUrl = "https://example.com/video1";
     </code>
    </p>
    <p>
     <code>
      NDEFMessage message = NDEFMessage();
     </code>
    </p>
    <p>
     <code>
      NDEFUriRecord uriRecord(videoUrl.c_str());
     </code>
    </p>
    <p>
     <code>
      message.addRecord(uriRecord);
     </code>
    </p>
    <p>
     <code>
      if (nfc.tagWrite(message)) {
      <!-- -->
     </code>
    </p>
    <p>
     <code>
      Serial.println("数据写入成功");
     </code>
    </p>
    <p>
     <code>
      } else {
      <!-- -->
     </code>
    </p>
    <p>
     <code>
      Serial.println("数据写入失败");
     </code>
    </p>
    <p>
     <code>
      }
     </code>
    </p>
    <p>
     <code>
      delay(5000);
     </code>
    </p>
    <p>
     <code>
      }
     </code>
    </p>
    <h3>
     五、写卡功能的优化与注意事项
    </h3>
    <h4>
     （一）数据校验与纠错
    </h4>
    <p>
     在写入数据前，应对要写入的视频相关信息进行校验，确保数据的准确性和完整性。例如，对于视频 URL 链接，要检查其格式是否正确，是否能正常访问。同时，NFC 标签本身可能存在数据传输错误的情况，一些高级的 NFC 标签支持 CRC（循环冗余校验）等纠错机制。在写入数据时，应利用这些机制对数据进行校验和纠错，以提高数据写入的可靠性。
    </p>
    <h4>
     （二）标签兼容性处理
    </h4>
    <p>
     不同类型和厂家的 NFC 标签在存储结构和通信协议上可能存在细微差异。在开发写卡功能时，要充分考虑标签的兼容性问题。可以通过检测标签的类型和特性，动态调整写入数据的方式和格式。例如，对于某些标签，可能需要先进行扇区解锁或密钥验证等操作才能进行写入。
    </p>
    <h4>
     （三）性能优化
    </h4>
    <ol>
     <li>
      <strong>
       减少写入时间
      </strong>
      ：在写入大数据量时，写入时间可能会较长，影响用户体验。可以通过优化通信协议和数据传输方式来减少写入时间。例如，采用批量写入的方式，而不是逐字节写入。
     </li>
    </ol>
    <ol>
     <li>
      <strong>
       降低功耗
      </strong>
      ：对于使用电池供电的 NFC 读写设备，如手机或基于微控制器的便携设备，要注意降低功耗。在不进行写卡操作时，可将 NFC 模块设置为低功耗模式，减少电池消耗。
     </li>
    </ol>
    <h3>
     六、总结
    </h3>
    <p>
     碰一碰发视频系统中的写卡功能开发涉及到硬件设备、软件框架以及通信协议等多个方面。通过深入理解 NFC 写卡技术原理，合理搭建开发环境，并准确实现代码逻辑，能够开发出高效、稳定的写卡功能。同时，在开发过程中要注重数据校验、标签兼容性和性能优化等问题，以提升整个系统的用户体验和可靠性。希望本文能为从事相关开发工作的技术人员提供有益的参考，助力碰一碰发视频系统的进一步发展和完善。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f79756e6c756f68643137312f:61727469636c652f64657461696c732f313436303539343035" class_="artid" style="display:none">
 </p>
</div>


