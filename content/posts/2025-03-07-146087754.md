---
layout: post
title: "Android中的AsyncTask"
date: 2025-03-07 10:01:11 +0800
description: "AsyncTask是 Android 框架中的一个工具类，用于在后台线程中执行耗时操作，并在操作完成后更新UI界面。它简化了多线程编程中的很多复杂性，尤其是在需要与UI线程交互的场景中。然而，需要注意的是，从 Android 11（API 级别 30）开始，AsyncTask已被标记为过时（deprecated），Google 推荐使用 Kotlin 的协程（Coroutines）或者 Java 的并发工具类（如Executor）来替代它。"
keywords: "Android中的AsyncTask。"
categories: ['未分类']
tags: ['Android']
artid: "146087754"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146087754
    alt: "Android中的AsyncTask"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146087754
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146087754
cover: https://bing.ee123.net/img/rand?artid=146087754
image: https://bing.ee123.net/img/rand?artid=146087754
img: https://bing.ee123.net/img/rand?artid=146087754
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Android中的AsyncTask。
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p id="">
     <code>
      AsyncTask
     </code>
     是 Android 框架中的一个工具类，用于在后台线程中执行耗时操作，并在操作完成后更新UI界面。它简化了多线程编程中的很多复杂性，尤其是在需要与UI线程交互的场景中。然而，需要注意的是，从 Android 11（API 级别 30）开始，
     <code>
      AsyncTask
     </code>
     已被标记为过时（deprecated），Google 推荐使用 Kotlin 的协程（Coroutines）或者 Java 的并发工具类（如
     <code>
      Executor
     </code>
     ,
     <code>
      ThreadPoolExecutor
     </code>
     ）来替代它。
    </p>
    <h4>
     AsyncTask 的基本工作原理
    </h4>
    <ol>
     <li>
      <strong>
       子类化 AsyncTask
      </strong>
      ：你需要创建一个继承自
      <code>
       AsyncTask
      </code>
      的类，并指定三个泛型参数：
      <ul>
       <li>
        <code>
         Params
        </code>
        ：启动任务时传入的参数类型。
       </li>
       <li>
        <code>
         Progress
        </code>
        ：后台任务执行过程中发布的进度信息类型。
       </li>
       <li>
        <code>
         Result
        </code>
        ：后台任务执行完成后返回的结果类型。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       重写必要的方法
      </strong>
      ：
      <ul>
       <li>
        <code>
         onPreExecute()
        </code>
        ：在后台任务开始执行之前在主线程上调用，通常用于设置UI，比如显示一个进度条。
       </li>
       <li>
        <code>
         doInBackground(Params...)
        </code>
        ：在后台线程上调用，执行耗时操作。此方法需要返回
        <code>
         Result
        </code>
        类型的结果。
       </li>
       <li>
        <code>
         onProgressUpdate(Progress...)
        </code>
        ：在后台任务执行过程中，如果调用了
        <code>
         publishProgress(Progress...)
        </code>
        方法，这个方法会在主线程上被调用，用于更新UI显示进度。
       </li>
       <li>
        <code>
         onPostExecute(Result)
        </code>
        ：在后台任务执行完成后在主线程上调用，用于处理返回的结果并更新UI。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       执行任务
      </strong>
      ：通过调用
      <code>
       execute(Params...)
      </code>
      方法来启动任务。
     </li>
    </ol>
    <h4>
     示例代码
    </h4>
    <pre></pre>
    <p>
     <code>
      java复制代码
     </code>
    </p>
    <table>
     <tbody>
      <tr>
       <td>
       </td>
       <td>
        <code>
         public class DownloadFileTask extends AsyncTask&lt;String, Integer, Boolean&gt; {
         <!-- -->
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         @Override
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         protected void onPreExecute() {
         <!-- -->
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         super.onPreExecute();
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         // 显示进度条
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         }
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         @Override
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         protected Boolean doInBackground(String... urls) {
         <!-- -->
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         // 下载文件的耗时操作
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         // 可以使用 publishProgress() 发布进度信息
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         return true; // 返回下载是否成功
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         }
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         @Override
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         protected void onProgressUpdate(Integer... values) {
         <!-- -->
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         super.onProgressUpdate(values);
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         // 更新UI显示进度
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         }
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         @Override
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         protected void onPostExecute(Boolean result) {
         <!-- -->
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         super.onPostExecute(result);
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         // 根据下载结果更新UI
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         }
        </code>
       </td>
      </tr>
      <tr>
       <td>
       </td>
       <td>
        <code>
         }
        </code>
       </td>
      </tr>
     </tbody>
    </table>
    <h4>
     使用 AsyncTask 的注意事项
    </h4>
    <ul>
     <li>
      <strong>
       线程安全
      </strong>
      ：确保在
      <code>
       doInBackground()
      </code>
      方法中不访问UI元素。
     </li>
     <li>
      <strong>
       内存泄漏
      </strong>
      ：如果
      <code>
       Activity
      </code>
      或
      <code>
       Fragment
      </code>
      在任务完成前被销毁，可能会导致内存泄漏。使用弱引用或者取消任务可以避免这个问题。
     </li>
     <li>
      <strong>
       顺序执行
      </strong>
      ：默认情况下，
      <code>
       AsyncTask
      </code>
      的任务是顺序执行的。如果需要并行执行，可以使用
      <code>
       executeOnExecutor(Executor exec, Params... params)
      </code>
      方法，并传入
      <code>
       THREAD_POOL_EXECUTOR
      </code>
      。
     </li>
     <li>
      <strong>
       主线程更新UI
      </strong>
      ：所有的UI更新必须在
      <code>
       onPreExecute()
      </code>
      ,
      <code>
       onProgressUpdate()
      </code>
      , 或
      <code>
       onPostExecute()
      </code>
      方法中进行，这些方法都在主线程上执行。
     </li>
    </ul>
    <p id="">
     尽管
     <code>
      AsyncTask
     </code>
     提供了一种相对简单的方式来处理后台任务和UI更新，但由于其生命周期和线程管理的问题，Google 推荐在新的项目中采用更现代和灵活的并发处理方式，如 Kotlin 协程。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323430325f38353234363535322f:61727469636c652f64657461696c732f313436303837373534" class_="artid" style="display:none">
 </p>
</div>


