---
layout: post
title: "Kubernetes-的正式安装"
date: 2025-03-06 19:29:36 +0800
description: "软件路由器ikuai当然同一个仅主机模式 相当于在 同一个我们所谓的广播域内 所以相当于它们的几张网卡 是被连接起来的为了防止出现问题 我们可以把第二块网卡临时关闭一下。"
keywords: "Kubernetes 的正式安装"
categories: ['K']
tags: ['智能路由器']
artid: "146024247"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146024247
    alt: "Kubernetes-的正式安装"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146024247
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146024247
cover: https://bing.ee123.net/img/rand?artid=146024247
image: https://bing.ee123.net/img/rand?artid=146024247
img: https://bing.ee123.net/img/rand?artid=146024247
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Kubernetes 的正式安装
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     1.基础的网络结构说明
    </h2>
    <p>
     <img alt="" height="1075" src="https://i-blog.csdnimg.cn/direct/a0dc9050506e4e4f8333451f8047cd2f.png" width="2283"/>
    </p>
    <p>
     软件路由器
    </p>
    <p>
     ikuai
    </p>
    <p>
     <img alt="" height="1004" src="https://i-blog.csdnimg.cn/direct/ef2cf72921934e48997ea3657ab4b89a.png" width="2019"/>
    </p>
    <p>
     当然同一个仅主机模式 相当于在 同一个我们所谓的广播域内 所以相当于它们的几张网卡 是被连接起来的
    </p>
    <p>
     <img alt="" height="798" src="https://i-blog.csdnimg.cn/direct/b7849357913a473684e58ad37e29eaf3.png" width="1886"/>
    </p>
    <p>
     为了防止出现问题 我们可以把第二块网卡临时关闭一下
    </p>
    <p>
     <img alt="" height="1268" src="https://i-blog.csdnimg.cn/direct/bf107097ad4d4f5f8aba843425e7b446.png" width="1708"/>
    </p>
    <h2>
     2.准备路由器
    </h2>
    <p>
     ikuai
    </p>
    <p>
     <a href="https://www.ikuai8.com/" rel="nofollow" title="爱快 iKuai-商业场景网络解决方案提供商 (ikuai8.com)">
      爱快 iKuai-商业场景网络解决方案提供商 (ikuai8.com)
     </a>
    </p>
    <p>
     <img alt="" height="357" src="https://i-blog.csdnimg.cn/direct/89ddac550335486eaad1c8035915ccd6.png" width="1078"/>
    </p>
    <p>
     <img alt="" height="626" src="https://i-blog.csdnimg.cn/direct/42d581a86d6c4756b69f6fae3603f5a9.png" width="1516">
      测试环境用 32位就可以了 因为用不到那么高性能，完全浪费，但是生产环境必须64位
     </img>
    </p>
    <p>
     <img alt="" height="303" src="https://i-blog.csdnimg.cn/direct/086083d1c11d40e2b0954f5eaefd6217.png" width="739"/>
    </p>
    <p>
     <img alt="" height="805" src="https://i-blog.csdnimg.cn/direct/fe078d079de24e8a810f9b55073619da.png" width="1424">
      <img alt="" height="860" src="https://i-blog.csdnimg.cn/direct/712174bebee441a1a1963c0e6154929d.png" width="1368"/>
     </img>
    </p>
    <p>
     <img alt="" height="457" src="https://i-blog.csdnimg.cn/direct/8a1554a6a30f4d7fac50487eaa971f22.png" width="541"/>
     <img alt="" height="440" src="https://i-blog.csdnimg.cn/direct/ee5435c4de2f4743b9616641e237c40f.png" width="513"/>
    </p>
    <p>
     <img alt="" height="440" src="https://i-blog.csdnimg.cn/direct/3d7d2fa3ce6c41fca6b1984aa552ba19.png" width="513"/>
    </p>
    <p>
     <img alt="" height="440" src="https://i-blog.csdnimg.cn/direct/d198e707efa94a5091af215db52f6012.png" width="513"/>
    </p>
    <p>
     <img alt="" height="440" src="https://i-blog.csdnimg.cn/direct/3f1cf86d24394c0ba7a3c27eb7789f40.png" width="513"/>
    </p>
    <p>
     <img alt="" height="440" src="https://i-blog.csdnimg.cn/direct/7201d023c6674b718e5ddbc5e682589a.png" width="513"/>
    </p>
    <p>
     <img alt="" height="440" src="https://i-blog.csdnimg.cn/direct/753c7a641dfb4b63b314de2ad1799d98.png" width="513"/>
    </p>
    <p>
     <img alt="" height="440" src="https://i-blog.csdnimg.cn/direct/f8e205a07a5546c9a15199ccbaba21b5.png" width="513"/>
    </p>
    <p>
     <img alt="" height="440" src="https://i-blog.csdnimg.cn/direct/ec769de4a0764b1d925b672f2f9b9d95.png" width="513"/>
    </p>
    <p>
     <img alt="" height="440" src="https://i-blog.csdnimg.cn/direct/6c56b49e839e4d4dbe0c0632e198464d.png" width="513"/>
    </p>
    <p>
     <img alt="" height="805" src="https://i-blog.csdnimg.cn/direct/f8d7ed7df3f64cc18929aabb0f6afe5a.png" width="745"/>
    </p>
    <p>
     <img alt="" height="803" src="https://i-blog.csdnimg.cn/direct/7b94740367074021a0c59a467eee19fb.png" width="740"/>
    </p>
    <p>
    </p>
    <p>
     <img alt="" height="842" src="https://i-blog.csdnimg.cn/direct/c55d121b5c9c44a8b856e41859a7fcd9.png" width="765"/>
    </p>
    <p>
     <img alt="" height="805" src="https://i-blog.csdnimg.cn/direct/584431371c364057bd60de89918891aa.png" width="745"/>
    </p>
    <p>
     <img alt="" height="794" src="https://i-blog.csdnimg.cn/direct/f9397f19128b432c93af4f0227361fc8.png" width="1231"/>
    </p>
    <p>
     <img alt="" height="605" src="https://i-blog.csdnimg.cn/direct/188b9fadcacd4edd9ea5766f19c84360.png" width="1032"/>
     1  回车
    </p>
    <p>
     <img alt="" height="868" src="https://i-blog.csdnimg.cn/direct/ecf47c2da2284e61b214561c7c7dfeed.png" width="1718"/>
    </p>
    <p>
     需要配置一定的信息
    </p>
    <p>
     选择2 回车
    </p>
    <p>
     <img alt="" height="522" src="https://i-blog.csdnimg.cn/direct/660d61ed23d94efabc451da80bf4ad8d.png" width="1192"/>
    </p>
    <p>
     <img alt="" height="519" src="https://i-blog.csdnimg.cn/direct/92a19ab3ecc94d6cb8a774198d1e38e9.png" width="993"/>
     <img alt="" height="557" src="https://i-blog.csdnimg.cn/direct/cb8ba01a64024d6aa6fe1bf31564771c.png" width="1052"/>
     <img alt="" height="537" src="https://i-blog.csdnimg.cn/direct/73979be707374345af0c24361b31620b.png" width="985"/>
    </p>
    <p>
     esc 返回
    </p>
    <p>
     <img alt="" height="599" src="https://i-blog.csdnimg.cn/direct/65bea70b0c3f49d28f72474603b2cba5.png" width="1050"/>
     q 退出
    </p>
    <p>
     <img alt="" height="480" src="https://i-blog.csdnimg.cn/direct/b3effaae732044449ca6a33189ebb644.png" width="973"/>
    </p>
    <p>
     <img alt="" height="591" src="https://i-blog.csdnimg.cn/direct/5d9ea1ffe29449d6b638e51a73921970.png" width="1098"/>
     q 锁定 就可以离开这里了
    </p>
    <p>
     浏览器输入 192.168.72.200 默认重定向到这里
    </p>
    <p>
     <img alt="" height="824" src="https://i-blog.csdnimg.cn/direct/4d9feaa9e1c2438a99f38e9ee7b960e1.png" width="1705"/>
    </p>
    <p>
     用户名密码都是admin
    </p>
    <p>
     <img alt="" height="934" src="https://i-blog.csdnimg.cn/direct/cb32568b93de4fd6acf5d623c60d7627.png" width="1836"/>
     纯软件实现的路由器
    </p>
    <p>
     <img alt="" height="928" src="https://i-blog.csdnimg.cn/direct/46ef2b2a96f04cfc950ec9dd73aea3fd.png" width="1845"/>
    </p>
    <p>
     <img alt="" height="590" src="https://i-blog.csdnimg.cn/direct/3ee81f9537a644729964470b312d1526.png" width="1506"/>
     关闭
    </p>
    <p>
     <img alt="" height="831" src="https://i-blog.csdnimg.cn/direct/e4e4dc9bbb644422877bd24c4fdd8a49.png" width="1663"/>
    </p>
    <p>
     绑定外网网卡
    </p>
    <p>
     <img alt="" height="969" src="https://i-blog.csdnimg.cn/direct/d98091aa903844f6b5510cb2c67b6d3e.png" width="1865"/>
     把剩下的一块网卡进行绑定
    </p>
    <p>
     <img alt="" height="969" src="https://i-blog.csdnimg.cn/direct/29c6ebb0c7bd4b8e81685c254d8dddda.png" width="1865"/>
    </p>
    <p>
     默认是DHCP
    </p>
    <p>
     但在真实生产环境中我们都是通过 拨号 或者 静态固定IP去提供网络访问能力的
    </p>
    <p>
     <img alt="" height="969" src="https://i-blog.csdnimg.cn/direct/6ade177e8f4b4265999ff12693468bd2.png" width="1865"/>
     <img alt="" height="969" src="https://i-blog.csdnimg.cn/direct/f27944ab85db4285848105898d9d0a8e.png" width="1865"/>
    </p>
    <h2>
     3.配置虚拟机
    </h2>
    <h3>
     1.配置第一块仅主机网卡
    </h3>
    <pre><code class="language-bash">vi /etc/NetworkManager/system-connections/ens160.nmconnection</code></pre>
    <p>
     三台机器都改完
    </p>
    <p>
     address1=仅主机的ip/子网掩码位,网关路由器ip
    </p>
    <p>
     dns 域名 加一下
    </p>
    <p>
     <img alt="" height="520" src="https://i-blog.csdnimg.cn/direct/86b5c8370f30456da5e98b7090277a0d.png" width="665"/>
     <img alt="" height="806" src="https://i-blog.csdnimg.cn/direct/e703a2cee36349c7beffd952436ae1a7.png" width="1055"/>
    </p>
    <h3>
     <img alt="" height="811" src="https://i-blog.csdnimg.cn/direct/bf6af3e7e250442885a6363e8863b95b.png" width="1045"/>
     2.关闭第二块nat网卡
    </h3>
    <pre><code class="language-bash">vi /etc/NetworkManager/system-connections/ens192.nmconnection</code></pre>
    <p>
     <img alt="" height="633" src="https://i-blog.csdnimg.cn/direct/29861d3c766c43ea88ab80ca9d4e0aa9.png" width="1016"/>
    </p>
    <pre><code class="language-bash">autoconnect=false</code></pre>
    <p>
     三台主机配置完
    </p>
    <p>
     :wq 保存退出
    </p>
    <h3>
     3.重启
    </h3>
    <p>
     如果重启就不用执行下面三条命令了 三台机器都做
     <img alt="" height="301" src="https://i-blog.csdnimg.cn/direct/7ddf92c3a10349018d89585f940e5945.png" width="1096"/>
    </p>
    <p>
     先不重启在做完下面配置在重启
    </p>
    <h3>
     4.关闭swap分区
    </h3>
    <p>
     如果你的机器本身初始化出来就是为了安装kubernetes集群的 你在分区的时候就没必要分 swap 分区
    </p>
    <p>
     如果分了 那么怎么关闭
    </p>
    <p>
     下面就是关闭的方法
    </p>
    <pre><code class="language-bash">swapoff -a</code></pre>
    <p>
     相当于把开机自启的那个命令注释掉
    </p>
    <pre><code class="language-bash">sed -i 's:/dev/mapper/rl-swap:#/dev/mapper/rl-swap:g' /etc/fstab</code></pre>
    <p>
     <img alt="" height="176" src="https://i-blog.csdnimg.cn/direct/1c43bbd3883345bcaef283eefed7f122.png" width="670"/>
    </p>
    <p>
     不是永久执行的 执行上面第二条命令即可永久 生效
    </p>
    <h3>
     5.修改主机名
    </h3>
    <pre><code class="language-bash">hostnamectl set-hostname k8s-master01</code></pre>
    <pre><code class="language-bash">hostnamectl set-hostname k8s-node01</code></pre>
    <pre><code class="language-bash">hostnamectl set-hostname k8s-node02</code></pre>
    <p>
     设置域名
    </p>
    <pre><code class="language-bash">vi /etc/hosts</code></pre>
    <pre><code class="language-bash">192.168.72.11 k8s-master01 m1
192.168.72.12 k8s-node01 n1
192.168.72.13 k8s-node02 n2
192.168.72.14 harbor
</code></pre>
    <p>
     m1 位为简写
    </p>
    <p>
     n1 同理
    </p>
    <p>
     后面可能搭建 harbor 所以提前设置一下用到的域名
    </p>
    <p>
     <img alt="" height="556" src="https://i-blog.csdnimg.cn/direct/b3248087c98d47fab3b6362c6fcc607c.png" width="2143"/>
    </p>
    <p>
     嫌麻烦可以拷贝到另一台主机上
    </p>
    <h3>
     6.安装 ipvs
    </h3>
    <pre><code class="language-bash">yum install -y ipvsadm</code></pre>
    <h3>
     7.开启每个节点的路由转发
    </h3>
    <pre><code class="language-bash">echo 'net.ipv4.ip_forward=1' &gt;&gt; /etc/sysctl.conf</code></pre>
    <pre><code class="language-bash">sysctl -p</code></pre>
    <h3>
     8.安装epel 加载 bridge
    </h3>
    <pre><code class="language-bash">yum install -y epel-release</code></pre>
    <pre><code class="language-bash">yum install -y bridge-utils</code></pre>
    <h3>
     9.加载 br_netfilter 模块
    </h3>
    <pre><code class="language-bash">modprobe br_netfilter</code></pre>
    <pre><code class="language-bash">echo 'br_netfilter' &gt;&gt; /etc/modules-load.d/bridge.conf
echo 'net.bridge.bridge-nf-call-iptables=1' &gt;&gt; /etc/sysctl.conf
echo 'net.bridge.bridge-nf-call-ip6tables=1'&gt;&gt; /etc/sysctl.conf
</code></pre>
    <pre><code class="language-bash">sysctl -p</code></pre>
    <h3>
     10.安装docker
    </h3>
    <pre><code class="language-bash">yum -y install yum-utils device-mapper-persistent-data lvm2
</code></pre>
    <pre><code class="language-bash">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre>
    <pre><code class="language-bash">sudo yum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</code></pre>
    <h4>
     1.配置daemon.json
    </h4>
    <pre><code class="language-bash">sudo cat &lt;&lt;EOF &gt; /etc/docker/daemon.json
{
    "default-ipc-mode": "shareable",
    "data-root": "/data/docker",
    "exec-opts": ["native.cgroupdriver=systemd"],
    "log-driver": "json-file",
    "log-opts": {
        "max-size": "100m",
        "max-file": "100"
    },
    "insecure-registries": ["harbor.xinxainghf.com"],
    "registry-mirrors": [
          "https://hub.skillixx.com",
          "https://docker.m.daocloud.io",
          "https://noohub.ru",
          "https://huecker.io",
          "https://dockerhub.timeweb.cloud",
          "https://docker.rainbond.cc",
          "https://hpbe2ezf.mirror.aliyuncs.com",
          "https://kfp63jaj.mirror.aliyuncs.com"
     ]
}
EOF</code></pre>
    <pre><code class="language-bash">mkdir -p /etc/systemd/system/docker.service.d</code></pre>
    <h4>
     2.重启docker
    </h4>
    <pre><code class="language-bash">systemctl daemon-reload</code></pre>
    <pre><code class="language-bash">systemctl enable --now docker</code></pre>
    <h3>
     11.重启一下
    </h3>
    <pre><code class="language-bash">reboot</code></pre>
    <p>
     <img alt="" height="664" src="https://i-blog.csdnimg.cn/direct/6c5ad00e9823431592d9c088b53a1710.png" width="1866"/>
    </p>
    <p>
     完美运行
    </p>
    <h2>
     4.安装 cri-docker
    </h2>
    <p>
     讲解一下
    </p>
    <h3>
     CRI关系图
    </h3>
    <p>
     <img alt="" height="844" src="https://i-blog.csdnimg.cn/direct/e30176a81a8f4f64a454de4312935aeb.png" width="2207"/>
    </p>
    <p>
     kubernetes 想要移出docker 移出的是 中间的转化的关系 也就是 CRI语言转化为 OCRI
    </p>
    <p>
     但是docker 又有公司实现了 CRI 转化为 OCRI 名为 cri-docker
    </p>
    <h3 style="background-color:transparent">
     1.下载cri-docker
    </h3>
    <pre><code class="language-bash">wget https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.9/cri-dockerd-0.3.9.amd64.tgz
</code></pre>
    <pre><code class="language-bash">tar -xf cri-dockerd-0.3.9.amd64.tgz
</code></pre>
    <pre><code class="language-bash">mv ./cri-dockerd/cri-dockerd /usr/bin/
</code></pre>
    <pre><code class="language-bash">chmod a+x /usr/bin/cri-dockerd</code></pre>
    <h3>
     2.编写服务管理脚本
    </h3>
    <pre><code class="language-bash">cat &lt;&lt;"EOF" &gt; /usr/lib/systemd/system/cri-docker.service
[unit]
Description=CRI Interface for Docker Application Container Engine
Documentation=https://docs.mirantis.com
After=network-online.target firewalld.service docker.service
Wants=network-online.target
Requires=cri-docker.socket
[Service]
Type=notify
ExecStart=/usr/bin/cri-dockerd
--network-plugin=cni
--pod-infra-container-
image=registry.aliyuncs.com/google_containers/pause:3.8
ExecReload=/bin/kill -s HUP $MAINPID
TimeoutSec=O
RestartSec=2
Restart=always
StartLimitBurst=3
StartLimitInterval=60s
LimitNOFILE=infinity
LimitNPROC=infinity
LimitCORE=infinity
TasksMax=infinity
Delegate=yes
KillMode=process
[Install]
WantedBy=multi-user.target
EOF</code></pre>
    <p>
     用多少版本就几版本
    </p>
    <pre><code class="language-bash">docker pull registry.aliyuncs.com/google_containers/pause:3.8
</code></pre>
    <p>
    </p>
    <h3>
     3.添加cri-docker 套接字生成脚本
    </h3>
    <pre><code class="language-bash">cat &lt;&lt;"EOF" &gt; /usr/lib/systemd/system/cri-docker.socket
[unit]
Description=CRI Docker Socket for the API
Partof=cri-docker.service
[Socket]
Listenstream=%t/cri-dockerd.sock
SocketMode=0660
SocketUser=root
SocketGroup=docker
[Install]
WantedBy=sockets.target
EOF</code></pre>
    <h3>
     4.启动cri-docker服务
    </h3>
    <pre><code class="language-bash">sudo systemctl daemon-reload</code></pre>
    <pre><code class="language-bash">systemctl enable --now cri-docker</code></pre>
    <pre><code class="language-bash">systemctl is-active cri-docker</code></pre>
    <p>
     <img alt="" height="530" src="https://i-blog.csdnimg.cn/direct/34a815dfc3264d2c93e8b7e9f4d43642.png" width="950"/>
    </p>
    <h2>
     5.安装 kubeadm
    </h2>
    <h3>
     1.添加yum源
    </h3>
    <pre><code class="language-bash">cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://pkgs.k8s.io/core:/stable:/v1.29/rpm/
enabled=1
gpgcheck=1
gpgkey=https://pkgs.k8s.io/core:/stable:/v1.29/rpm/repodata/repomd.xml.key
exclude=kubelet kubeadm kubectl cri-tools kubernetes-cni
EOF</code></pre>
    <h3>
     2.安装kubeadm 1.29
    </h3>
    <pre><code class="language-bash">sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes</code></pre>
    <h3>
     3.设置开机自启
    </h3>
    <pre><code class="language-bash">sudo systemctl enable  kubelet</code></pre>
    <h3>
     4.初始化主节点
    </h3>
    <pre><code class="language-bash">kubeadm init --apiserver-advertise-address=192.168.72.11 --image-repository registry.aliyuncs.com/google_containers --kubernetes-version 1.29.14 --service-cidr=10.10.0.0/12 --pod-network-cidr=10.244.0.0/16 --ignore-preflight-errors=all --cri-socket unix:///var/run/cri-dockerd.sock </code></pre>
    <p>
     如果科学上网 可以不加
    </p>
    <p>
     --kubernetes-version 1.29.14
    </p>
    <p>
     --image-repository registry.aliyuncs.com/google_containers
    </p>
    <p>
     重要重要重要！！！
    </p>
    <p>
     一定要在三个节点都拉去 pause 镜像 他可能会用到两个版本的 我这里有 kubeadm config images list 指定的 3.9 但是 他初始化的时候用的 3.6所以最好两个版本都下 然后三个节点都要拉取镜像 要不然会有问题 ，经验 ！！！！！！！！！！
    </p>
    <p>
    </p>
    <pre><code class="language-bash"> mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config</code></pre>
    <h3>
     5.将另外两个节点加入集群
    </h3>
    <pre><code class="language-bash">kubeadm join 192.168.72.11:6443 --token c52o1r.gxeerfkrhsx0zen1 \
        --discovery-token-ca-cert-hash sha256:eb622ff0b73ad808efde62dd362daee34b00fa7f541cb227a907d86ee72f31a4 --cri-socket unix:///var/run/cri-dockerd.sock </code></pre>
    <p>
     --cri-socket unix:///var/run/cri-dockerd.sock 需要在命令指定套接字 为 docker
    </p>
    <p>
     <img alt="" height="241" src="https://i-blog.csdnimg.cn/direct/6bd358be2fcd49209f7bc004ec5113d8.png" width="1312"/>
    </p>
    <h4>
     1.检查是否加入
    </h4>
    <pre><code class="language-bash">kubectl get node</code></pre>
    <h4>
     <img alt="" height="72" src="https://i-blog.csdnimg.cn/direct/46db19438003410da733546b134235be.png" width="620"/>
    </h4>
    <h4>
     2.如果token过期后 需要重新创建
    </h4>
    <pre><code class="language-bash">kubeadm token create --print-join-command</code></pre>
    <h2>
     6.部署网络插件
    </h2>
    <h3>
     1.安装calico
    </h3>
    <p>
     <img alt="" height="37" src="https://i-blog.csdnimg.cn/direct/590fd9b01fba498996271cc59b04ffca.png" width="1082"/>
    </p>
    <p>
     准备好
    </p>
    <pre><code class="language-bash">unzip ./calico.zip
</code></pre>
    <p>
     <img alt="" height="40" src="https://i-blog.csdnimg.cn/direct/0cea653af2c044489ed06e418cf23f39.png" width="756"/>
    </p>
    <p>
     <img alt="" height="127" src="https://i-blog.csdnimg.cn/direct/900ecc6ba6d64dfc9801ca4c685790d3.png" width="1121"/>
     <img alt="" height="96" src="https://i-blog.csdnimg.cn/direct/d15ad2930a1342dab358c9c97c92ce4d.png" width="876"/>
     <img alt="" height="49" src="https://i-blog.csdnimg.cn/direct/a8c13a388b3641999cbf45384d547be5.png" width="855"/>
     这是calico运行所需要的所有的镜像
    </p>
    <h4>
     1.解压镜像
    </h4>
    <pre><code class="language-bash">tar -zxvf calico-images.tar.gz
</code></pre>
    <p>
     <img alt="" height="71" src="https://i-blog.csdnimg.cn/direct/3f6cdf796e0f4f53a54d58bb70374f7e.png" width="947"/>
    </p>
    <h4>
     2.加载镜像
    </h4>
    <p>
     这四个镜像每个节点都要导入
    </p>
    <pre><code class="language-bash">docker load -i calico-cni-v3.26.3.tar
</code></pre>
    <pre><code class="language-bash">docker load -i calico-node-v3.26.3.tar
</code></pre>
    <pre><code class="language-bash">docker load -i calico-kube-controllers-v3.26.3.tar
</code></pre>
    <pre><code class="language-bash">docker load -i calico-typha-v3.26.3.tar</code></pre>
    <p>
     传输到 n1 的设备 下 的 /root
    </p>
    <pre><code class="language-bash">scp -r calico-images root@n1:/root/
</code></pre>
    <p>
     <img alt="" height="220" src="https://i-blog.csdnimg.cn/direct/99c577a8031b49e8b38bfeb4d29fe27d.png" width="1455"/>
    </p>
    <h4>
     3.执行安装
    </h4>
    <p>
     把部署文件利用在集群上
    </p>
    <pre><code class="language-bash">kubectl apply -f calico-typha.yaml</code></pre>
    <p>
     这个文件需要改一些地方
    </p>
    <p>
     <img alt="" height="106" src="https://i-blog.csdnimg.cn/direct/1bb7ad43f9414647a615a8f4a2676c4c.png" width="833"/>
    </p>
    <p>
     关闭IPIP
    </p>
    <p>
     <img alt="" height="226" src="https://i-blog.csdnimg.cn/direct/58d1daf786754288bd61ce000022f0b9.png" width="1114"/>
    </p>
    <p>
     需要与前面创建集群的时候 那个 pod cidr一致
    </p>
    <p>
     <img alt="" height="458" src="https://i-blog.csdnimg.cn/direct/b080e4f519ba447fa8d023847de28ccb.png" width="2041"/>
    </p>
    <p>
     <img alt="" height="910" src="https://i-blog.csdnimg.cn/direct/628925e8fd404d08a11702170f09e9f1.png" width="2008"/>
     查看网络的 pod
    </p>
    <pre><code class="language-bash"> kubectl get pod -A
</code></pre>
    <p>
     需要 在子节点 装 pause 的镜像 没有就起不来 这是经验
    </p>
    <p>
     <img alt="" height="378" src="https://i-blog.csdnimg.cn/direct/9caadb6fe9154e60a72e86df266d5fc1.png" width="822"/>
    </p>
    <p>
     完美运行一个集群 三个节点
    </p>
    <h2>
     7.如果我们在安装集群时有多块网卡并且没有关闭
    </h2>
    <h3>
     1.固定网卡（可选）
    </h3>
    <h4>
     指定目标域名可达的网卡
    </h4>
    <p>
     <img alt="" height="763" src="https://i-blog.csdnimg.cn/direct/06e403cac53644489bb69b572b2444d2.png" width="2384"/>
    </p>
    <h4>
     匹配正则的网卡
    </h4>
    <p>
     <img alt="" height="610" src="https://i-blog.csdnimg.cn/direct/24bc0b1e62d7472c931f8794062cad57.png" width="2303"/>
    </p>
    <h4>
     忽略正则的网卡
    </h4>
    <p>
     <img alt="" height="603" src="https://i-blog.csdnimg.cn/direct/7e8a31d3adc7427593f12d3ec446847d.png" width="2229"/>
    </p>
    <h4>
     指定一个网段范围
    </h4>
    <p>
     <img alt="" height="688" src="https://i-blog.csdnimg.cn/direct/e88976122fb546caab08b590ea95408e.png" width="2393"/>
    </p>
    <h4>
     修改kube-proxy 模式为 ipvs
    </h4>
    <h4>
     <img alt="" height="292" src="https://i-blog.csdnimg.cn/direct/7e8647c51d264775b3faa5381968647b.png" width="2264"/>
    </h4>
    <p>
     这几种方式
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f35333337343839332f:61727469636c652f64657461696c732f313436303234323437" class_="artid" style="display:none">
 </p>
</div>


