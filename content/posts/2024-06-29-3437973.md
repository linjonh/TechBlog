---
layout: post
title: "微型嵌入式Web服务器的设计与实现"
date: 2024-06-29 20:12:11 +0800
description: "1 引言  随着计算机、网络通信和Internet技术的飞速发展和不断进"
keywords: "嵌入式网页服务器实现"
categories: ['网络']
tags: ['网络', '工作', '嵌入式', 'Web', 'Tcp', 'Internet']
artid: "3437973"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=3437973
    alt: "微型嵌入式Web服务器的设计与实现"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=3437973
featuredImagePreview: https://bing.ee123.net/img/rand?artid=3437973
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微型嵌入式Web服务器的设计与实现
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <font face="宋体">
     <strong>
      1 引言
     </strong>
     <p>
      随着计算机、网络通信和Internet技术的飞速发展和不断进步，嵌入式系统在家庭和工业应用广泛。
     </p>
     <p>
      如何将嵌入式系统和工业控制系统接人Internet，综合利用嵌入式系统资源，实现嵌入式系统的远程管理和控制，已成为关注的研究课题，而实现嵌入式系统的网络化则成为嵌入式系统的发展趋势。
     </p>
     <p>
      以太网以其成本低、速度快、应用普遍、有广泛的硬件和软件支持等优点为实现管理控制网络一体化提供可能，在现场设备内置WEB服务器，使现场设备具有网页发布功能，将Internet技术直接引入现场设备。
     </p>
     <p>
      本设计是基于ARM7的微型嵌入式Web服务器。目前市场上大部分以太网控制器的封装均超过80引脚，而ENC28J60是业界最小的以太网控制器，只有28引脚，这样既能提供相应功能，又大大简化相关设计，减小空间，其标准的SPI串行接口只需4条总线即可实现与单片机连接，有利于在小型系统上实现以太网功能。在研究和分析TCP／IP协议的基础上，合理简化TCP／IP协议，选择实现ARP、IP、ICMP、TCP和HTTP协议。
     </p>
     <p>
      <strong>
       2 系统硬件设计
      </strong>
     </p>
     <p>
      ENC28J60的硬件连接如图1所示。ENC28J60的硬件设计包括复位电路、时钟振荡器、网络变压器和其他外部元件以及LED配置单元模块。
     </p>
     <p align="center">
      <img height="350" src="http://image.mcuol.com/News/080902154549210.jpg" width="380"/>
     </p>
     <p>
      <br/>
      2.1复位电路
     </p>
     <p>
      当ENC28J60的RESET引脚为低电平时ENC28J60工作在复位模式。RESET引脚内部有弱上拉电阻，应外接一只10 kΩ的上拉电阻。
     </p>
     <p>
      2.2 时钟振荡器
     </p>
     <p>
      ENC28J60工作频率为25 MHz。在OSC1和OSC2引脚之间连接无源晶体振荡器。ENC28J60要求使用平行切割的晶体。本设计采用连接至OSC1引脚的外部25 MHz有源晶体振荡器驱动，此时3.3V的外部时钟连接OSC1引脚，OSC2引脚可使用一只接地电阻或断开OSC2引脚以减少系统噪声。
     </p>
     <p>
      2.3 网络变压器和其他外部元件
     </p>
     <p>
      实现以太网接口控制，还需多个标准外部元件：网络变压器、偏置电阻、储能电容和去耦电容。
     </p>
     <p>
      差分输入引脚(TPIN+／TPIN-)需用一个变比为1：1的网络变压器实现10BASET。差分输出引脚(TPOUT+／TPOUT-)需用一个变比为1：1、带中心抽头的脉冲变压器实现。变压器需具有2 kV或更高的隔离能力，以防止静电干扰。本设计采用Pulse公司的集成以太网隔离变压器H1102。
     </p>
     <p>
      差分输入／输出引脚都需串联2只49.7 Ω、精度为1％的电阻和1只0.01μF的电容，本设计采用并联两只100 Ω电阻获得49.7 Ω、精度为1％的电阻。
     </p>
     <p>
      所有的电源电压引脚必须连接至外部同一个33 V电源。同理，所有的接地必须连接至同一外部地。每个电源电压引脚和地之间应连接1只0.1μF的陶瓷去耦电容，该电容应尽可能地靠近电源电压引脚放置。
     </p>
     <p>
      2.4 LED配置
     </p>
     <p>
      LEDA引脚和LEDB引脚在复位时支持极性自动检测，既可直接驱动LED，又可灌电流驱动。复位时ENC28J60检测LED的连接，并按照PHLCON寄存器的默认设置驱动。本设计LEDB采用拉电流的方式点亮LED。复位时该位清零且PHY默认在半双工模式下工作。
     </p>
     <p>
      3 系统软件设计
     </p>
     <p>
      3.1 SPI接口
     </p>
     <p>
      ENC28J60与微控制器MCU的连接通过SPI接口实现，支持10 Mb／s。但ENC28J60只支持SPI模式00，即CPOL=0和CPHA=0。另外，在空闲状态时SPI端口要求SCK为低电平，且不支持时钟极性选择。以下为SPI接口初始化的源代码：
     </p>
     <p>
      <img height="85" src="http://image.mcuol.com/News/080902154557771.jpg" width="330"/>
     </p>
     <p>
      3.2 TCP／IP协议栈的实现
     </p>
     <p>
      考虑到单片机RAM存储空间的限制和具体应用要求，合理简化TCP／IP协议栈，选择实现ARP、IP、ICMP、TCP和HTTP协议。图2所示为精简的TCP／IP协议栈。
     </p>
     <div align="center">
      <img height="120" src="http://image.mcuol.com/News/080902154557912.jpg" width="160">
      </img>
     </div>
     <p>
      <br/>
      3.2.1 物理层接口的实现
     </p>
     <p>
      物理层接口为ENC28J60的驱动程序，硬件方面是用ENC28J60的电路实现电缆的物理链接、介质访问控制、帧的发送与接收等功能，而与上层协议接口即为驱动程序，实现发送与接收数据帧。以下是其两个函数原型：
      <br/>
      <img height="41" src="http://image.mcuol.com/News/080902154559333.jpg" width="260">
      </img>
     </p>
     <p>
      3.2.2 网络层协议的实现
     </p>
     <p>
      网络层的协议包括ARP、IP、ICMP协议。网络间连接需知双方物理地址，而ARP协议是地址解析协议，实现IP地址到物理地址的转化。网际协议(IP)负责将消息从一个主机传送到另一个主机。ICMP协议是Internet控制消息协议，用于IP主机、路由器之间传递控制消息。控制消息是指网络是否畅通、主机是否可达、路由是否可用等网络本身消息。图3所示是ping命令测试远程用户和设计的微型嵌人式Web服务器后的响应情况。
     </p>
     <div align="left">
      <img height="174" src="http://image.mcuol.com/News/080902154559434.jpg" width="320">
      </img>
     </div>
     <p>
      <br/>
      3.2.3 TCP、HTTP协议的实现
     </p>
     <p>
      传输控制协议(TCP)负责收集信息包，并且将其按适当的次序传输，接收端接收后再将其正确还原。传输协议同时保证了数据包在传送中准确无误。而HTTP是基于TCP协议的超文本传输协议，嵌人式Web服务器在与远程用户端建立TCP连接后发送网页数据，在HTTP协议发送流程中，由于TCP报文数据字段有长度限制，网页资源一股被分成若干段进行分段传送。在远程用户端打开IE浏览器，在地址栏输入嵌人式Web服务器的地址。
     </p>
    </font>
   </div>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f69747169616e677265:6e2f61727469636c652f64657461696c732f33343337393733" class_="artid" style="display:none">
 </p>
</div>


