---
layout: post
title: "llama源码学习model.py2SwiGLU激活函数"
date: 2025-03-11 21:11:08 +0800
description: "GLU：将输入分成两部分，一部分直接经过线性变换，另一部分经过sigmoidsigmoidsigmoid函数变换，然后将这两部分的输出逐点相乘GLUxWVBcσxWb⊗xVcGLUxWVBcσxWb⊗xVc$ \\sigma $ 是 $ sigmoid  $ 激活函数$ W, V $ 权重$ b, c $ 偏置$ SwiGLU $ 是 $ GLU $ 的一种变体，其中包含了GLUGLUGLU和Sw。"
keywords: "llama源码学习·model.py[2]SwiGLU激活函数"
categories: ['未分类']
tags: ['学习', 'Llama']
artid: "146189072"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146189072
    alt: "llama源码学习model.py2SwiGLU激活函数"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146189072
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146189072
cover: https://bing.ee123.net/img/rand?artid=146189072
image: https://bing.ee123.net/img/rand?artid=146189072
img: https://bing.ee123.net/img/rand?artid=146189072
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     llama源码学习·model.py[2]SwiGLU激活函数
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     一、激活函数的目的
    </h2>
    <p>
     激活函数的目的是为网络引入非线性，并使其能够学习并逼近复杂的数据模式
    </p>
    <h2>
     <a id="GLUGated_Linear_Unit_4">
     </a>
     二、介绍GLU（Gated Linear Unit）
    </h2>
    <p>
     <strong>
      GLU
     </strong>
     ：将输入分成两部分，一部分直接经过线性变换，另一部分经过
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        s 
        
       
         i 
        
       
         g 
        
       
         m 
        
       
         o 
        
       
         i 
        
       
         d 
        
       
      
        sigmoid
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;">
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0359em;">
          g
         </span>
         <span class="mord mathnormal">
          m
         </span>
         <span class="mord mathnormal">
          o
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mord mathnormal">
          d
         </span>
        </span>
       </span>
      </span>
     </span>
     函数变换，然后将这两部分的输出逐点相乘
    </p>
    <p>
     <span class="katex--display">
      <span class="katex-display">
       <span class="katex">
        <span class="katex-mathml">
         G 
         
        
          L 
         
        
          U 
         
        
          ( 
         
        
          x 
         
        
          , 
         
        
          W 
         
        
          , 
         
        
          V 
         
        
          , 
         
        
          B 
         
        
          , 
         
        
          c 
         
        
          ) 
         
        
          = 
         
        
          σ 
         
        
          ( 
         
        
          x 
         
        
          W 
         
        
          + 
         
        
          b 
         
        
          ) 
         
        
          ⊗ 
         
        
          ( 
         
        
          x 
         
        
          V 
         
        
          + 
         
        
          c 
         
        
          ) 
         
        
       
         GLU(x, W, V, B, c) = \sigma (xW + b) \otimes (xV + c)
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal">
           G
          </span>
          <span class="mord mathnormal" style="margin-right: 0.109em;">
           LU
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal">
           x
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.1667em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           W
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.1667em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.2222em;">
           V
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.1667em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0502em;">
           B
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.1667em;">
          </span>
          <span class="mord mathnormal">
           c
          </span>
          <span class="mclose">
           )
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0359em;">
           σ
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal">
           x
          </span>
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           W
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           +
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal">
           b
          </span>
          <span class="mclose">
           )
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           ⊗
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal">
           x
          </span>
          <span class="mord mathnormal" style="margin-right: 0.2222em;">
           V
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           +
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal">
           c
          </span>
          <span class="mclose">
           )
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <ul>
     <li>
      $ \sigma $ 是 $ sigmoid $ 激活函数
     </li>
     <li>
      $ W, V $ 权重
     </li>
     <li>
      $ b, c $ 偏置
     </li>
    </ul>
    <h3>
     <a id="GLU_14">
     </a>
     绘制GLU激活函数
    </h3>
    <pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># 定义GLU激活函数</span>
<span class="token keyword">class</span> <span class="token class-name">GLU</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        a<span class="token punctuation">,</span> b <span class="token operator">=</span> x<span class="token punctuation">.</span>chunk<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'a:'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token string">'b:'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
        <span class="token keyword">return</span> a <span class="token operator">*</span> F<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>b<span class="token punctuation">)</span>  <span class="token comment"># 应用sigmoid函数然后进行逐元素乘法(权重和偏置为1)</span>

<span class="token comment"># 实例化GLU模块</span>
glu <span class="token operator">=</span> GLU<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment"># torch.linspace(-3, 3, 100)：在-3到3中生成一个等距的一维数组，数量为100个</span>
<span class="token comment"># unsqueeze(-1)将原先 100 个元素 的一维数组，转换成 100*1 的二维数组</span>
<span class="token comment"># expand(-1, 2)  复制 100*1的单列，生成 100*2的两列</span>
x_range <span class="token operator">=</span> torch<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expand<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  

y_glu <span class="token operator">=</span> glu<span class="token punctuation">(</span>x_range<span class="token punctuation">)</span> <span class="token comment"># 得到经过GLU变换的结果</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x_range<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y_glu<span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'GLU Function'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Input value'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Output value'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'GLU Activation Function'</span><span class="token punctuation">)</span> 
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span> 
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/eb382567463143959fcbed367657bd27.png#pic_center"/>
    </p>
    <h2>
     <a id="Swish_55">
     </a>
     三、介绍Swish激活函数
    </h2>
    <p>
     $ SwiGLU $ 是 $ GLU $ 的一种变体，其中包含了
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        G 
        
       
         L 
        
       
         U 
        
       
      
        GLU
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal">
          G
         </span>
         <span class="mord mathnormal" style="margin-right: 0.109em;">
          LU
         </span>
        </span>
       </span>
      </span>
     </span>
     和
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        S 
        
       
         w 
        
       
         i 
        
       
         s 
        
       
         h 
        
       
      
        Swish
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0269em;">
          Sw
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mord mathnormal">
          h
         </span>
        </span>
       </span>
      </span>
     </span>
     激活函数。
    </p>
    <p>
     <span class="katex--display">
      <span class="katex-display">
       <span class="katex">
        <span class="katex-mathml">
         S 
         
        
          w 
         
        
          i 
         
        
          s 
         
         
         
           h 
          
         
           β 
          
         
        
          ( 
         
        
          x 
         
        
          ) 
         
        
          = 
         
        
          x 
         
        
          σ 
         
        
          ( 
         
        
          β 
         
        
          x 
         
        
          ) 
         
        
       
         Swish_{\beta}(x) = x \sigma(\beta x)
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0269em;">
           Sw
          </span>
          <span class="mord mathnormal">
           i
          </span>
          <span class="mord mathnormal">
           s
          </span>
          <span class="mord">
           <span class="mord mathnormal">
            h
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3361em;">
               <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight" style="margin-right: 0.0528em;">
                   β
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.2861em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal">
           x
          </span>
          <span class="mclose">
           )
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal">
           x
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0359em;">
           σ
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0528em;">
           β
          </span>
          <span class="mord mathnormal">
           x
          </span>
          <span class="mclose">
           )
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <ul>
     <li>
      $ \beta $ 是一个可学习参数
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">class</span> <span class="token class-name">Swish</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> beta<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x <span class="token operator">*</span> F<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>beta <span class="token operator">*</span> x<span class="token punctuation">)</span> 
swish <span class="token operator">=</span> Swish<span class="token punctuation">(</span><span class="token punctuation">)</span>
x_range <span class="token operator">=</span> torch<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
betas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">]</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token keyword">for</span> beta <span class="token keyword">in</span> betas<span class="token punctuation">:</span>
    y_swish <span class="token operator">=</span> swish<span class="token punctuation">(</span>x_range<span class="token punctuation">,</span> beta<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y_swish<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'beta=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>beta<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Input value'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Output value'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Swish Activation Function'</span><span class="token punctuation">)</span> 
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span> 
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/42d43baa4d3a45589fedc02583f6cb7b.png#pic_center"/>
    </p>
    <h2>
     <a id="SwiGLU_92">
     </a>
     四、介绍SwiGLU
    </h2>
    <p>
     将
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        G 
        
       
         L 
        
       
         U 
        
       
      
        GLU
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal">
          G
         </span>
         <span class="mord mathnormal" style="margin-right: 0.109em;">
          LU
         </span>
        </span>
       </span>
      </span>
     </span>
     中的激活函数
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        s 
        
       
         i 
        
       
         g 
        
       
         m 
        
       
         o 
        
       
         i 
        
       
         d 
        
       
      
        sigmoid
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;">
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0359em;">
          g
         </span>
         <span class="mord mathnormal">
          m
         </span>
         <span class="mord mathnormal">
          o
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mord mathnormal">
          d
         </span>
        </span>
       </span>
      </span>
     </span>
     改为
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        S 
        
       
         w 
        
       
         i 
        
       
         s 
        
       
         h 
        
       
      
        Swish
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0269em;">
          Sw
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mord mathnormal">
          h
         </span>
        </span>
       </span>
      </span>
     </span>
     就是
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        S 
        
       
         w 
        
       
         i 
        
       
         G 
        
       
         L 
        
       
         U 
        
       
      
        SwiGLU
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0269em;">
          Sw
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mord mathnormal">
          G
         </span>
         <span class="mord mathnormal" style="margin-right: 0.109em;">
          LU
         </span>
        </span>
       </span>
      </span>
     </span>
     激活函数。
    </p>
    <p>
     <span class="katex--display">
      <span class="katex-display">
       <span class="katex">
        <span class="katex-mathml">
         S 
         
        
          w 
         
        
          i 
         
        
          G 
         
        
          L 
         
        
          U 
         
        
          ( 
         
        
          x 
         
        
          , 
         
        
          W 
         
        
          , 
         
        
          V 
         
        
          , 
         
        
          B 
         
        
          , 
         
        
          c 
         
        
          ) 
         
        
          = 
         
        
          S 
         
        
          w 
         
        
          i 
         
        
          s 
         
         
         
           h 
          
         
           β 
          
         
        
          ( 
         
        
          x 
         
        
          W 
         
        
          + 
         
        
          b 
         
        
          ) 
         
        
          ⊗ 
         
        
          ( 
         
        
          x 
         
        
          V 
         
        
          + 
         
        
          c 
         
        
          ) 
         
        
       
         SwiGLU(x, W, V, B, c) = Swish_\beta(xW + b) \otimes (xV + c)
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0269em;">
           Sw
          </span>
          <span class="mord mathnormal">
           i
          </span>
          <span class="mord mathnormal">
           G
          </span>
          <span class="mord mathnormal" style="margin-right: 0.109em;">
           LU
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal">
           x
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.1667em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           W
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.1667em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.2222em;">
           V
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.1667em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0502em;">
           B
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.1667em;">
          </span>
          <span class="mord mathnormal">
           c
          </span>
          <span class="mclose">
           )
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0269em;">
           Sw
          </span>
          <span class="mord mathnormal">
           i
          </span>
          <span class="mord mathnormal">
           s
          </span>
          <span class="mord">
           <span class="mord mathnormal">
            h
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3361em;">
               <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mathnormal mtight" style="margin-right: 0.0528em;">
                  β
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.2861em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal">
           x
          </span>
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           W
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           +
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal">
           b
          </span>
          <span class="mclose">
           )
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           ⊗
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal">
           x
          </span>
          <span class="mord mathnormal" style="margin-right: 0.2222em;">
           V
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           +
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal">
           c
          </span>
          <span class="mclose">
           )
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token keyword">class</span> <span class="token class-name">SwiGLU</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        a<span class="token punctuation">,</span> b <span class="token operator">=</span> x<span class="token punctuation">.</span>chunk<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
        <span class="token keyword">return</span> a <span class="token operator">*</span> F<span class="token punctuation">.</span>silu<span class="token punctuation">(</span>b<span class="token punctuation">)</span>  <span class="token comment"># 使用Swish激活函数，F.silu就是Swish</span>

swiglu <span class="token operator">=</span> SwiGLU<span class="token punctuation">(</span><span class="token punctuation">)</span>
x_range <span class="token operator">=</span> torch<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment"># 创建一个范围为-3到3的线性空间</span>
y_swiglu <span class="token operator">=</span> swiglu<span class="token punctuation">(</span>x_range<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expand<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 应用 SwiGLU 函数，确保维度是偶数</span>


<span class="token comment"># 绘制 SwiGLU 函数的图像</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x_range<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y_swiglu<span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'SwiGLU Function'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Input value'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Output value'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'SwiGLU Activation Function'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4f12d20496c24bc086719bfba9c1848b.png#pic_center"/>
    </p>
    <h2>
     <a id="GLU__SwiGLU__129">
     </a>
     五、GLU 和 SwiGLU 的区别
    </h2>
    <p>
     仅为
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        G 
        
       
         L 
        
       
         U 
        
       
      
        GLU
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal">
          G
         </span>
         <span class="mord mathnormal" style="margin-right: 0.109em;">
          LU
         </span>
        </span>
       </span>
      </span>
     </span>
     使用
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        s 
        
       
         i 
        
       
         g 
        
       
         m 
        
       
         o 
        
       
         i 
        
       
         d 
        
       
      
        sigmoid
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;">
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0359em;">
          g
         </span>
         <span class="mord mathnormal">
          m
         </span>
         <span class="mord mathnormal">
          o
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mord mathnormal">
          d
         </span>
        </span>
       </span>
      </span>
     </span>
     ，
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        S 
        
       
         w 
        
       
         i 
        
       
         G 
        
       
         L 
        
       
         U 
        
       
      
        SwiGLU
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0269em;">
          Sw
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mord mathnormal">
          G
         </span>
         <span class="mord mathnormal" style="margin-right: 0.109em;">
          LU
         </span>
        </span>
       </span>
      </span>
     </span>
     使用
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        S 
        
       
         w 
        
       
         i 
        
       
         s 
        
       
         h 
        
       
      
        Swish
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0269em;">
          Sw
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mord mathnormal">
          h
         </span>
        </span>
       </span>
      </span>
     </span>
     。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f37323835313135332f:61727469636c652f64657461696c732f313436313839303732" class_="artid" style="display:none">
 </p>
</div>


