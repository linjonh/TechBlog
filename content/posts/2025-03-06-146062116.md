---
layout: post
title: "STM32-USART-串口发送接收"
date: 2025-03-06 13:11:44 +0800
description: "如果使用查询，那初始化到上一步就结束了，查询的流程是，在主函数里不断判断RXNE标志位，如果置1了，就说明收到数据了。串口发送--原文链接：https://blog.csdn.net/rxy0727/article/details/1460446498。总结：RXNE一旦置1，就会向NVIC申请中断，之后就可以在中断里接收数据。可以取下表的一个或者多个取值的组合作为该参数的值。如果使用中断，则还需要开启中断，配置NVIC.参数2：USART_FLAG。该参数用以使能或者失能指定的。参数1：USARTx。"
keywords: "STM32-USART-串口发送+接收"
categories: ['未分类']
tags: ['嵌入式硬件', '单片机', 'Stm']
artid: "146062116"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146062116
    alt: "STM32-USART-串口发送接收"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146062116
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146062116
cover: https://bing.ee123.net/img/rand?artid=146062116
image: https://bing.ee123.net/img/rand?artid=146062116
img: https://bing.ee123.net/img/rand?artid=146062116
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     STM32-USART-串口发送+接收
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <hr id="hr-toc" name="tableOfContents"/>
    <p>
    </p>
    <p>
    </p>
    <h2 id="%E4%B8%80%EF%BC%9A%E4%B8%B2%E5%8F%A3%E5%8F%91%E9%80%81" name="%E4%B8%80%EF%BC%9A%E4%B8%B2%E5%8F%A3%E5%8F%91%E9%80%81">
     一：串口发送
    </h2>
    <p>
     串口发送--原文链接：https://blog.csdn.net/rxy0727/article/details/1460446498
    </p>
    <h2 id="%E4%BA%8C%EF%BC%9A%E4%B8%B2%E5%8F%A3%E6%8E%A5%E6%94%B6%C2%A0" name="%E4%BA%8C%EF%BC%9A%E4%B8%B2%E5%8F%A3%E6%8E%A5%E6%94%B6%C2%A0">
     二：串口接收
    </h2>
    <ul>
     <li>
      在串口发送初始化部分上加上接收的部分
     </li>
     <li>
      首先是GPIO口，要使用RX引脚，在引脚定义表里可以知道，USART的RX复用在PA10引脚。所以要再初始化一下PA106
      <pre><code class="language-cpp">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_10; 
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz; 
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPU; //浮空输入
	GPIO_Init(GPIOA, &amp;GPIO_InitStructure); </code></pre>
      <p>
      </p>
     </li>
     <li>
      在USART_Mode中加上串口模式RX，就开启了同时发送和接收部分
      <pre><code class="language-cpp">    //配置USART
	USART_InitTypeDef USART_InitStructure; 
	USART_InitStructure.USART_BaudRate = 9600; 
	USART_InitStructure.USART_WordLength = USART_WordLength_8b; 
	USART_InitStructure.USART_StopBits = USART_StopBits_1; 
	USART_InitStructure.USART_Parity = USART_Parity_No; 
	USART_InitStructure.USART_HardwareFlowControl = USART_HardwareFlowControl_None; 
	USART_InitStructure.USART_Mode = USART_Mode_Tx | USART_Mode_Rx;  
	USART_Init(USART1, &amp;USART_InitStructure); </code></pre>
      <p>
      </p>
     </li>
    </ul>
    <h2 id="%C2%A0%20%E4%B8%89%EF%BC%9A%E4%B8%B2%E5%8F%A3%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95" name="%C2%A0%20%E4%B8%89%EF%BC%9A%E4%B8%B2%E5%8F%A3%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95">
     三：串口查询的两种方法
    </h2>
    <h3 id="1.%E6%9F%A5%E8%AF%A2" name="1.%E6%9F%A5%E8%AF%A2">
     1.查询
    </h3>
    <p>
     如果使用查询，那初始化到上一步就结束了，查询的流程是，在主函数里不断判断RXNE标志位，如果置1了，就说明收到数据了。再调用ReceiveData，读取DR寄存器。
    </p>
    <h4 id="%E5%87%BD%E6%95%B0%EF%BC%9A%C2%A0USART_%20GetFlagStatus" name="%E5%87%BD%E6%95%B0%EF%BC%9A%C2%A0USART_%20GetFlagStatus">
     函数：
     <span style="color:#000000">
      <strong>
      </strong>
     </span>
     <span style="color:#000000">
      <strong>
       USART_ GetFlagStatus
      </strong>
     </span>
    </h4>
    <p>
     <span style="color:#000000">
      函数功能
      <strong>
       ：
      </strong>
     </span>
     <span style="color:#000000">
      检查指定的
     </span>
     <span style="color:#000000">
      USART
     </span>
     <span style="color:#000000">
      标志位设置与否
     </span>
    </p>
    <p>
     <span style="color:#000000">
      参数1：USARTx
     </span>
     <span style="color:#000000">
      ：
     </span>
     <span style="color:#000000">
      x
     </span>
     <span style="color:#000000">
      可以是
     </span>
     <span style="color:#000000">
      1
     </span>
     <span style="color:#000000">
      ，
     </span>
     <span style="color:#000000">
      2
     </span>
     <span style="color:#000000">
      或者
     </span>
     <span style="color:#000000">
      3
     </span>
     <span style="color:#000000">
      ，来选择
     </span>
     <span style="color:#000000">
      USART
     </span>
     <span style="color:#000000">
      外设
     </span>
    </p>
    <p>
     <span style="color:#000000">
      参数2：USART_FLAG
     </span>
     <span style="color:#000000">
      ：待检查的
     </span>
     <span style="color:#000000">
      USART
     </span>
     <span style="color:#000000">
      标志位
     </span>
    </p>
    <p style="text-align:center">
     <span style="color:#000000">
      <img alt="" src="https://i-blog.csdnimg.cn/direct/0ca500a894e648f5bf9084409ae1ce1a.png"/>
     </span>
    </p>
    <p>
     <span style="color:#000000">
      <strong>
       由状态寄存器USART_SR可得，读DR可以自动清除标志位，所以不需要重新清除标志位
      </strong>
     </span>
    </p>
    <p>
     <img alt="" height="267" src="https://i-blog.csdnimg.cn/direct/a62cb47f555c49bdbd77097e49177185.png" width="1434">
     </img>
    </p>
    <h4 id="%E5%87%BD%E6%95%B0%EF%BC%9AUSART_%20ReceiveData%20%C2%A0" name="%E5%87%BD%E6%95%B0%EF%BC%9AUSART_%20ReceiveData%20%C2%A0">
     函数：
     <span style="color:#000000">
      USART_ ReceiveData
     </span>
    </h4>
    <p>
     函数功能：
     <span style="color:#000000">
      返回
     </span>
     <span style="color:#000000">
      USARTx
     </span>
     <span style="color:#000000">
      最近接收到的数据
     </span>
    </p>
    <p>
     <span style="color:#000000">
      参数：USARTx
     </span>
     <span style="color:#000000">
      ：
     </span>
     <span style="color:#000000">
      x
     </span>
     <span style="color:#000000">
      可以是
     </span>
     <span style="color:#000000">
      1
     </span>
     <span style="color:#000000">
      ，
     </span>
     <span style="color:#000000">
      2
     </span>
     <span style="color:#000000">
      或者
     </span>
     <span style="color:#000000">
      3
     </span>
     <span style="color:#000000">
      ，来选择
     </span>
     <span style="color:#000000">
      USART
     </span>
     <span style="color:#000000">
      外设
     </span>
    </p>
    <h4 id="%E4%BB%A3%E7%A0%81%EF%BC%9A%C2%A0" name="%E4%BB%A3%E7%A0%81%EF%BC%9A%C2%A0">
     代码：
    </h4>
    <pre><code class="language-cpp">while(1)
	{
		if(USART_GetFlagStatus(USART1, USART_FLAG_TXE) == SET)
		{
			//如果if成立
			RxData = USART_ReceiveData(USART1);
            OLED_ShowHexNum(1,1,RxData,2);
		}
		
	}</code></pre>
    <h4 id="%E7%BB%93%E6%9E%9C%3A%C2%A0" name="%E7%BB%93%E6%9E%9C%3A%C2%A0">
     结果:
    </h4>
    <p>
     <img alt="" height="297" src="https://i-blog.csdnimg.cn/direct/1afb2fd52cb54c54812be63611348648.png" width="1275"/>
    </p>
    <p>
     <img alt="" height="694" src="https://i-blog.csdnimg.cn/direct/f52ba35953f246df8d5be781c95ad7cc.jpeg" width="1280">
     </img>
    </p>
    <h3 id="2.%E4%B8%AD%E6%96%AD" name="2.%E4%B8%AD%E6%96%AD">
     2.中断
    </h3>
    <p>
     如果使用中断，则还需要开启中断，配置NVIC.
    </p>
    <h4 id="%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%BC%80%E5%90%AFRXNE%E6%A0%87%E5%BF%97%E4%BD%8D%E5%88%B0NVIC%E7%9A%84%E8%BE%93%E5%87%BA" name="%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%BC%80%E5%90%AFRXNE%E6%A0%87%E5%BF%97%E4%BD%8D%E5%88%B0NVIC%E7%9A%84%E8%BE%93%E5%87%BA">
     第一步：开启RXNE标志位到NVIC的输出
    </h4>
    <h5 id="%E5%87%BD%E6%95%B0USART_ITConfig" name="%E5%87%BD%E6%95%B0USART_ITConfig">
     <strong>
      <span style="color:#000000">
       函数
      </span>
     </strong>
     <strong>
      <span style="color:#000000">
       USART_ITConfig
      </span>
     </strong>
    </h5>
    <p>
     函数功能：
     <span style="color:#000000">
      使能或者失能指定的
     </span>
     <span style="color:#000000">
      USART
     </span>
     <span style="color:#000000">
      中断
     </span>
    </p>
    <p>
     参数1：
     <span style="color:#000000">
      USARTx
     </span>
     <span style="color:#000000">
      ：
     </span>
     <span style="color:#000000">
      x
     </span>
     <span style="color:#000000">
      可以是
     </span>
     <span style="color:#000000">
      1
     </span>
     <span style="color:#000000">
      ，
     </span>
     <span style="color:#000000">
      2
     </span>
     <span style="color:#000000">
      或者
     </span>
     <span style="color:#000000">
      3
     </span>
     <span style="color:#000000">
      ，来选择
     </span>
     <span style="color:#000000">
      USART
     </span>
     <span style="color:#000000">
      外设
     </span>
    </p>
    <p>
     <span style="color:#000000">
      参数2：USART_IT
     </span>
     <span style="color:#000000">
      ：待使能或者失能的
     </span>
     <span style="color:#000000">
      USART
     </span>
     <span style="color:#000000">
      中断源
     </span>
    </p>
    <div>
     <span style="color:#000000">
      输入参数
     </span>
     <span style="color:#000000">
      USART_IT
     </span>
     <span style="color:#000000">
      使能或者失能
     </span>
     <span style="color:#000000">
      USART
     </span>
     <span style="color:#000000">
      的中断。可以取下表的一个或者多个取值的组合作为该参数的值。
     </span>
    </div>
    <p>
     <img alt="" height="405" src="https://i-blog.csdnimg.cn/direct/882aeb602e114f209db73a44a22dac87.png" width="1326"/>
    </p>
    <p>
     代码：
    </p>
    <pre><code class="language-cpp">USART_ITConfig(USART1, USART_IT_RXNE ENABLE);</code></pre>
    <h4 id="%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E9%85%8D%E7%BD%AENVIC" name="%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E9%85%8D%E7%BD%AENVIC">
     第二步：配置NVIC
    </h4>
    <h5 id="%E5%87%BD%E6%95%B0NVIC_PriorityGroupConfig" name="%E5%87%BD%E6%95%B0NVIC_PriorityGroupConfig">
     <strong>
      <span style="color:#000000">
       函数
      </span>
     </strong>
     <strong>
      <span style="color:#000000">
       NVIC_PriorityGroupConfig
      </span>
     </strong>
    </h5>
    <p>
     函数功能：
     <span style="color:#000000">
      设置优先级分组：先占优先级和从优先级
     </span>
    </p>
    <p>
     <span style="color:#000000">
      参数：NVIC_PriorityGroup
     </span>
     <span style="color:#000000">
      ：优先级分组位长度
     </span>
    </p>
    <div>
     <span style="color:#000000">
      该参数设置优先级分组位长度，见下表
     </span>
    </div>
    <div>
     <img alt="" height="490" src="https://i-blog.csdnimg.cn/direct/88116efec3dd494098dae2e8d6c6b65d.png" width="1334">
     </img>
    </div>
    <h5 id="%E5%87%BD%E6%95%B0NVIC_Init%C2%A0%C2%A0" name="%E5%87%BD%E6%95%B0NVIC_Init%C2%A0%C2%A0">
     函数NVIC_Init
    </h5>
    <p>
     功能描述：
     <span style="color:#000000">
      根据
     </span>
     <span style="color:#000000">
      NVIC_InitStruct
     </span>
     <span style="color:#000000">
      中指定的参数初始化外设
     </span>
     <span style="color:#000000">
      NVIC
     </span>
     <span style="color:#000000">
      寄存器
     </span>
    </p>
    <p>
     NVIC的相关函数：
    </p>
    <ul>
     <li>
      <div>
       <strong>
        <span style="color:#000000">
         NVIC_IRQChannel
        </span>
       </strong>
      </div>
      <div>
       <span style="color:#000000">
        该参数用以使能或者失能指定的
       </span>
       <span style="color:#000000">
        IRQ
       </span>
       <span style="color:#000000">
        通道
       </span>
      </div>
     </li>
     <li>
      <div>
       <div>
        <strong>
         <span style="color:#000000">
          NVIC_IRQChannelPreemptionPriority
         </span>
        </strong>
       </div>
       <div>
        <span style="color:#000000">
         该参数设置了成员
        </span>
        <span style="color:#000000">
         NVIC_IRQChannel
        </span>
        <span style="color:#000000">
         中的先占优先级
        </span>
       </div>
      </div>
     </li>
    </ul>
    <h5 id="%E9%85%8D%E7%BD%AENVIC%E4%BB%A3%E7%A0%81%EF%BC%9A" name="%E9%85%8D%E7%BD%AENVIC%E4%BB%A3%E7%A0%81%EF%BC%9A">
     配置NVIC代码：
    </h5>
    <pre><code class="language-cpp">//配置NVIC
	
	NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);
	
	NVIC_InitTypeDef NVIC_InitStructure;
	NVIC_InitStructure.NVIC_IRQChannel = USART1_IRQn; 
	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 1; 
	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 1; 
	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE; 
	NVIC_InitStructure(&amp;NVIC_InitStructure); </code></pre>
    <p>
    </p>
    <p>
     总结：RXNE一旦置1，就会向NVIC申请中断，之后就可以在中断里接收数据
    </p>
    <h5 id="%E5%87%BD%E6%95%B0%E5%B0%81%E8%A3%85" name="%E5%87%BD%E6%95%B0%E5%B0%81%E8%A3%85">
     函数封装
    </h5>
    <pre><code class="language-cpp">uint8_t Serial_GetRxFlag(void)
{
	if(Serial_RxFlag == 1)
	{
		Serial_RxFlag=0;//读后自动清除功能
		return 1;
	}
	return 0;
}

uint8_t Serial_GetRxData(void)
{
	return Serial_RxData;
}

void USART1_IRQHandler(void)
{
	if(USART_GetITStatus(USART1, USART_IT_RXNE)== SET)
	{
		//如果置1了就进入if
		Serial_RxData = USART_ReceiveData(USART1);
		Serial_RxFlag = 1;//读完之后置一个自己的标志位
		USART_ClearITPendingBit(USART1, USART_IT_RXNE);//清除标志位
	}
}</code></pre>
    <p>
    </p>
    <p>
     主函数调用
    </p>
    <pre><code class="language-cpp">while(1)
	{
		if(Serial_GetRxFlag()==1)
		{
			//如果if成立
			RxData = Serial_GetRxData();
			Serial_SendByte(RxData);//数据回传
			OLED_ShowHexNum(1,1,RxData,8);
		}
		
	}</code></pre>
    <h5 id="%E7%BB%93%E6%9E%9C%EF%BC%9A" name="%E7%BB%93%E6%9E%9C%EF%BC%9A">
     结果：
    </h5>
    <p>
     <img alt="" height="845" src="https://i-blog.csdnimg.cn/direct/cc57bd5e38cc4e8280adf7738b574ec2.png" width="1257"/>
    </p>
    <h2 id="%E5%9B%9B%EF%BC%9A%E5%AD%A6%E4%B9%A0%E5%BF%83%E5%BE%97%C2%A0" name="%E5%9B%9B%EF%BC%9A%E5%AD%A6%E4%B9%A0%E5%BF%83%E5%BE%97%C2%A0">
     四：学习心得
    </h2>
    <p>
     在这个学习过程中，对USART通信有了更清楚的认识
    </p>
    <h4 id="USART%E7%9A%84%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95" name="USART%E7%9A%84%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95">
     USART的配置和使用方法
    </h4>
    <p>
     配置STM32的USART主要包括以下几个步骤：
    </p>
    <ol>
     <li>
      <strong>
       初始化
      </strong>
      ‌：设置波特率、数据位、停止位和校验方式。
     </li>
     <li>
      ‌
      <strong>
       发送数据
      </strong>
      ‌：通过
      <a href="https://www.baidu.com/s?rsv_dl=re_dqa_generate&amp;sa=re_dqa_generate&amp;wd=USART_SendData&amp;rsv_pq=8a25e295000f6d8a&amp;oq=STM32USART%E6%80%BB%E7%BB%93&amp;rsv_t=e93ciVXY4iDurE8ba1sPO1CobftixO7s0rW+CLVug0AKMR3Fm5VBcV/He/E&amp;tn=baidu&amp;ie=utf-8" rel="nofollow" title="USART_SendData">
       USART_SendData
      </a>
      函数发送数据，并等待发送缓冲区为空。
     </li>
     <li>
      ‌
      <strong>
       接收数据
      </strong>
      ‌：使用
      <a href="https://www.baidu.com/s?rsv_dl=re_dqa_generate&amp;sa=re_dqa_generate&amp;wd=USART_ReceiveData&amp;rsv_pq=8a25e295000f6d8a&amp;oq=STM32USART%E6%80%BB%E7%BB%93&amp;rsv_t=e93ciVXY4iDurE8ba1sPO1CobftixO7s0rW+CLVug0AKMR3Fm5VBcV/He/E&amp;tn=baidu&amp;ie=utf-8" rel="nofollow" title="USART_ReceiveData">
       USART_ReceiveData
      </a>
      函数接收数据，并处理接收到的数据。
     </li>
     <li>
      ‌
      <strong>
       中断处理
      </strong>
      ‌：配置中断源，处理接收和发送完成的中断事件。
     </li>
    </ol>
    <p>
     今天也是收获满满的一天，开心！！！
    </p>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f727879303732372f:61727469636c652f64657461696c732f313436303632313136" class_="artid" style="display:none">
 </p>
</div>


