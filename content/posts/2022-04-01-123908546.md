---
layout: post
title: "Unity游戏嵌入Android应用融合为一个应用"
date: 2022-04-01 21:52:42 +0800
description: "嵌入项目的AndroidStudio版本和Unity版本01 新建一个新的安卓项目项目里新建一个bu"
keywords: "android项目如何集成两个unity项目"
categories: ['游戏开发Unityc']
tags: ['Visualstudio', 'C']
artid: "123908546"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=123908546
    alt: "Unity游戏嵌入Android应用融合为一个应用"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=123908546
featuredImagePreview: https://bing.ee123.net/img/rand?artid=123908546
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Unity游戏嵌入Android应用(融合为一个应用)
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     嵌入项目的AndroidStudio版本和Unity版本
     <br/>
     Unity2019
     <br/>
     AndroidStudio2021
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1ebdc66f0b7a12a5e995e83b46711d70.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5ca47b043eb0fdc314c413f6d51dfbe6.png">
       <br/>
       01 新建一个新的安卓项目
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6087d06e7c7025233fa7de500eb75f7b.png">
        <br/>
        项目里新建一个button
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5f668047296630d3d8847afd5160de77.png">
         <br/>
         实现button的点击事件进入游戏
        </img>
       </img>
      </img>
     </img>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e4bbe94b9481b9de444d0be9b9aa4d84.png"/>
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>project_android</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">androidx<span class="token punctuation">.</span>appcompat<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">AppCompatActivity</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Bundle</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">Button</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token keyword">implements</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Button</span> button1<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>
        button1 <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>button1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//注册监听器</span>
        button1<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>view<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>button1<span class="token operator">:</span>
                <span class="token function">onClickButton1</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">onClickButton1</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"触发点击进入游戏的按钮事件"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     unity导出android工程
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f20c276b08b688bcf0d1005f5011ca2c.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/96905adb996b01a0d356dedb85cfbaeb.png"/>
     </img>
    </p>
    <p>
     导出的工程文件夹放入原生的安卓项目
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0ef1ce9c6e901d67494cd25cc788520f.png">
      <br/>
      放入如下代码
     </img>
    </p>
    <pre><code class="prism language-java">include '<span class="token operator">:</span>unityLibrary'
<span class="token function">project</span><span class="token punctuation">(</span>'<span class="token operator">:</span>unityLibrary'<span class="token punctuation">)</span><span class="token punctuation">.</span>projectDir<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>'<span class="token punctuation">.</span>\\<span class="token class-name">UnityAndroidProject</span>\\unityLibrary'<span class="token punctuation">)</span>

</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9d5c255b061be16a3904c39fadcf3ab2.png"/>
     <br/>
     放入如下代码
    </p>
    <pre><code class="prism language-java">implementation <span class="token function">project</span><span class="token punctuation">(</span>'<span class="token operator">:</span>unityLibrary'<span class="token punctuation">)</span>
implementation <span class="token function">fileTree</span><span class="token punctuation">(</span>dir<span class="token operator">:</span> <span class="token function">project</span><span class="token punctuation">(</span>'<span class="token operator">:</span>unityLibrary'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProjectDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token char">'\\libs'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token char">'*.jar'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/8f65db24f431c238cd2e9f4de6c3f24b.png"/>
     <br/>
     放入如下代码
    </p>
    <pre><code class="prism language-java">flatDir <span class="token punctuation">{<!-- --></span>
  dirs <span class="token string">"${project(':unityLibrary').projectDir}/libs"</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f562a1cf425b15a361b5e5f91467c48c.png"/>
    </p>
    <pre><code class="prism language-java">android<span class="token operator">:</span>process<span class="token operator">=</span><span class="token string">":UnityActivity"</span>

</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e04b155827fb6abdfed871b519da6ddd.png"/>
     <br/>
     项目里添加UnityGameActivity.java
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6c63919e0efeeb82f7a3bd25f2c66d13.png"/>
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>project_android</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Bundle</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Log</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">KeyEvent</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>unity3d<span class="token punctuation">.</span>player<span class="token punctuation">.</span></span><span class="token class-name">UnityPlayer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>unity3d<span class="token punctuation">.</span>player<span class="token punctuation">.</span></span><span class="token class-name">UnityPlayerActivity</span><span class="token punctuation">;</span>
<span class="token comment">//进入到这个类就进入了unity游戏画面</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnityGameActivity</span> <span class="token keyword">extends</span> <span class="token class-name">UnityPlayerActivity</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> TAG <span class="token operator">=</span> <span class="token string">"UnityGameActivity"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isFinish <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SendMessageToUnity</span><span class="token punctuation">(</span><span class="token string">"AndroidToUnityMessage"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">finishUnityGame</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"unity传给Android的信息: "</span><span class="token operator">+</span> str <span class="token punctuation">)</span><span class="token punctuation">;</span>
        isFinish <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment">//关闭unity游戏返回app</span>
        <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">SendMessageToUnity</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Android传给unity的信息: "</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//其中GameData是unity生成的gameobject，脚本要挂在上面。AndroidToUnity是unity里实现的方法。str是传过去的值。</span>
        <span class="token class-name">UnityPlayer<span class="token punctuation">.</span>UnitySendMessage</span><span class="token punctuation">(</span><span class="token string">"GameData"</span><span class="token punctuation">,</span> <span class="token string">"AndroidToUnity"</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"onResume: "</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"onPause: "</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isFinish<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            mUnityPlayer<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"onStop: "</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"onDestroy: "</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     需要配置，才能找到这个类
    </p>
    <pre><code class="prism language-java"><span class="token operator">&lt;</span>activity android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"com.example.project_android.UnityGameActivity"</span> android<span class="token operator">:</span>theme<span class="token operator">=</span><span class="token string">"@style/UnityThemeSelector"</span> android<span class="token operator">:</span>screenOrientation<span class="token operator">=</span><span class="token string">"landscape"</span> android<span class="token operator">:</span>launchMode<span class="token operator">=</span><span class="token string">"singleTask"</span> android<span class="token operator">:</span>configChanges<span class="token operator">=</span><span class="token string">"mcc|mnc|locale|touchscreen|keyboard|keyboardHidden|navigation|orientation|screenLayout|uiMode|screenSize|smallestScreenSize|fontScale|layoutDirection|density"</span> android<span class="token operator">:</span>hardwareAccelerated<span class="token operator">=</span><span class="token string">"false"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta<span class="token operator">-</span>data android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"unityplayer.UnityActivity"</span> android<span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">"true"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta<span class="token operator">-</span>data android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.notch_support"</span> android<span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">"true"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>activity<span class="token operator">&gt;</span>

</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/8cc31b48cac542703e0519133961ac66.png"/>
     <br/>
     unity的脚本加上可以接收信息的方法，脚本需要挂在GameData上
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1cc4bc3b9be566cdd26bfe72b19e4a17.png"/>
    </p>
    <pre><code class="prism language-csharp">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AndroidToUnity</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> str<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"Unity接收Android信息 = "</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//通过Newtonsoft.Json插件的JsonConvert.DeserializeObject方法，将json格式的string数据转换为model数据</span>
        <span class="token comment">//UnityDataModel unityDataModel = JsonConvert.DeserializeObject&lt;UnityDataModel&gt;(str);</span>
        <span class="token comment">//Debug.Log("unityDataModel.key1 = " + unityDataModel.key1);</span>
        <span class="token comment">//Debug.Log("unityDataModel.key2 = " + unityDataModel.key2);</span>


    <span class="token punctuation">}</span>
</code></pre>
    <p>
     完整代码
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Newtonsoft<span class="token punctuation">.</span>Json</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GameData</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">IOSToUnity</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> str<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"Unity接收IOS信息 = "</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//通过Newtonsoft.Json插件的JsonConvert.DeserializeObject方法，将json格式的string数据转换为model数据</span>
        <span class="token class-name">UnityDataModel</span> unityDataModel <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">DeserializeObject</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UnityDataModel<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"unityDataModel.key1 = "</span> <span class="token operator">+</span> unityDataModel<span class="token punctuation">.</span>key1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"unityDataModel.key2 = "</span> <span class="token operator">+</span> unityDataModel<span class="token punctuation">.</span>key2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AndroidToUnity</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> str<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"Unity接收Android信息 = "</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//通过Newtonsoft.Json插件的JsonConvert.DeserializeObject方法，将json格式的string数据转换为model数据</span>
        <span class="token comment">//UnityDataModel unityDataModel = JsonConvert.DeserializeObject&lt;UnityDataModel&gt;(str);</span>
        <span class="token comment">//Debug.Log("unityDataModel.key1 = " + unityDataModel.key1);</span>
        <span class="token comment">//Debug.Log("unityDataModel.key2 = " + unityDataModel.key2);</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">DontDestroyOnLoad</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     安卓端在button的点击事件里，加上启动unity游戏的方法
    </p>
    <pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">onClickButton1</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"触发点击进入游戏的按钮事件"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">startActivity</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">UnityGameActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     解决安装以上双图标问题
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/850154984057deaadf0dabc9a61c5e19.png"/>
     <br/>
     unity导出的android sdk 和 android studio导出的android sdk版本要一致
    </p>
    <p>
     解决：E/Unity: Failed to load 'libmain.so’问题，需要在unity做如下配置：E/Unity: Failed to load 'libmain.so’问题，需要在unity做如下配置
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5e4a96151a1ae6a9acc91ea989d384ae.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/dfb17b23a46ef07f3b4e9121453d75b8.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3d7a8d4d2eb7ff9db46bdfe9a861e9ea.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9d65425df66620753f613b95b9251889.png"/>
     <br/>
     游戏启动闪退问题解决
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1b4e31fbd171e1ec09ca95bd4be359b7.png"/>
    </p>
    <pre><code class="prism language-java"><span class="token operator">&lt;</span>string name<span class="token operator">=</span><span class="token string">"game_view_content_description"</span><span class="token operator">&gt;</span><span class="token class-name">Game</span> view<span class="token operator">&lt;</span><span class="token operator">/</span>string<span class="token operator">&gt;</span>

</code></pre>
    <p>
     Unity端结束游戏时发信息给安卓端
    </p>
    <p>
     核心代码
    </p>
    <pre><code class="prism language-csharp"><span class="token preprocessor property">#<span class="token directive keyword">if</span> UNITY_ANDROID</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">AndroidJavaClass</span> jc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AndroidJavaClass</span><span class="token punctuation">(</span><span class="token string">"com.unity3d.player.UnityPlayer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">AndroidJavaObject</span> overrideActivity <span class="token operator">=</span> jc<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetStatic</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>AndroidJavaObject<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">"currentActivity"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//AndroidToUnityMessage是发送给Android的信息，finishUnityGame是安卓端接收的方法</span>
                overrideActivity<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token string">"finishUnityGame"</span><span class="token punctuation">,</span> <span class="token string">"AndroidToUnityMessage"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
<span class="token preprocessor property">#<span class="token directive keyword">endif</span></span>

</code></pre>
    <p>
     安卓可以横屏且可以旋转的设置
    </p>
    <p>
     unity里的设置
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6d3c4280b9e3f9cd44facb2c38e7d653.png"/>
     <br/>
     AndroidStudio里的设置
    </p>
    <pre><code class="prism language-java"><span class="token operator">&lt;</span>activity android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"com.unity3d.player.UnityPlayerActivity"</span> android<span class="token operator">:</span>theme<span class="token operator">=</span><span class="token string">"@style/UnityThemeSelector"</span> android<span class="token operator">:</span>screenOrientation<span class="token operator">=</span><span class="token string">"sensorLandscape"</span> android<span class="token operator">:</span>launchMode<span class="token operator">=</span><span class="token string">"singleTask"</span> android<span class="token operator">:</span>configChanges<span class="token operator">=</span><span class="token string">"mcc|mnc|locale|touchscreen|keyboard|keyboardHidden|navigation|orientation|screenLayout|uiMode|screenSize|smallestScreenSize|fontScale|layoutDirection|density"</span> android<span class="token operator">:</span>hardwareAccelerated<span class="token operator">=</span><span class="token string">"false"</span><span class="token operator">&gt;</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34303538333232352f:61727469636c652f64657461696c732f313233393038353436" class_="artid" style="display:none">
 </p>
</div>


