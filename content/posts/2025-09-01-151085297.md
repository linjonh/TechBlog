---
layout: post
title: "å“åº”å¼ç¼–ç¨‹æ¡†æ¶Reactor9"
date: 2025-09-01T22:30:41+0800
description: "Reactoræ˜¯ä¸€ä¸ªåŸºäºReactive Streamsè§„èŒƒçš„å“åº”å¼ç¼–ç¨‹æ¡†æ¶ï¼Œæ—¨åœ¨é€šè¿‡éé˜»å¡ã€å¼‚æ­¥çš„æ–¹å¼å¤„ç†é«˜å¹¶å‘è¯·æ±‚ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½ã€‚å…¶æ ¸å¿ƒç±»å‹Monoå’ŒFluxåˆ†åˆ«å¤„ç†0/1å’Œ0-Nä¸ªå…ƒç´ çš„æµå¼æ•°æ®ï¼Œæä¾›ä¸°å¯Œçš„æ“ä½œç¬¦å¦‚mapã€filterç­‰å®ç°å£°æ˜å¼ç¼–ç¨‹ã€‚å…³é”®ç‰¹æ€§åŒ…æ‹¬èƒŒå‹æœºåˆ¶ï¼ˆé˜²æ­¢ç”Ÿäº§è€…è¿‡å¿«å¯¼è‡´æº¢å‡ºï¼‰ã€çµæ´»çš„çº¿ç¨‹è°ƒåº¦ï¼ˆsubscribeOn/publishOnåŒºåˆ†ä¸Šä¸‹æ¸¸çº¿ç¨‹æ§åˆ¶ï¼‰åŠå®Œå–„çš„é”™è¯¯å¤„ç†ï¼ˆé‡è¯•ã€é™çº§ç­‰ï¼‰ã€‚"
keywords: "å“åº”å¼ç¼–ç¨‹æ¡†æ¶Reactorã€9ã€‘"
categories: ['2025å¹´æŠ€æœ¯åˆ†äº«']
tags: ['ç½‘ç»œ', 'Tomcat', 'Spring', 'Python', 'Maven', 'Java', 'Hibernate']
artid: "151085297"
arturl: "https://blog.csdn.net/ldcigame/article/details/151085297"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=151085297
    alt: "å“åº”å¼ç¼–ç¨‹æ¡†æ¶Reactor9"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=151085297
featuredImagePreview: https://bing.ee123.net/img/rand?artid=151085297
cover: https://bing.ee123.net/img/rand?artid=151085297
image: https://bing.ee123.net/img/rand?artid=151085297
img: https://bing.ee123.net/img/rand?artid=151085297
---



# å“åº”å¼ç¼–ç¨‹æ¡†æ¶Reactorã€9ã€‘



## ä¸€ã€Reactoræ ¸å¿ƒç›®æ ‡

åœ¨é«˜å¹¶å‘ã€ä½å»¶è¿Ÿçš„ç°ä»£ç³»ç»Ÿä¸­ï¼Œ**é˜»å¡å¼ç¼–ç¨‹**ï¼ˆå¦‚ `synchronized`, `Thread.sleep()`ï¼‰ä¼šå¯¼è‡´çº¿ç¨‹èµ„æºè€—å°½ï¼Œç³»ç»Ÿååé‡æ€¥å‰§ä¸‹é™ã€‚

Reactor åŸºäº **Reactive Streams è§„èŒƒ**ï¼Œæä¾›äº†ä¸€å¥—**éé˜»å¡ã€å¼‚æ­¥ã€æ”¯æŒèƒŒå‹**çš„å“åº”å¼ç¼–ç¨‹æ¨¡å‹ï¼Œæ˜¯æ„å»ºé«˜æ€§èƒ½ã€é«˜å¹¶å‘ç³»ç»Ÿçš„åˆ©å™¨ã€‚

âœ… **æ ¸å¿ƒç›®æ ‡**ï¼šç”¨æ›´å°‘çš„çº¿ç¨‹å¤„ç†æ›´å¤šçš„è¯·æ±‚ã€‚

## äºŒã€Reactor æ ¸å¿ƒçŸ¥è¯†ç‚¹

### 2.1 å“åº”å¼ç¼–ç¨‹èŒƒå¼

å“åº”å¼ç¼–ç¨‹æ˜¯ä¸€ç§**åŸºäºæ•°æ®æµå’Œå˜åŒ–ä¼ æ’­**çš„ç¼–ç¨‹èŒƒå¼ã€‚ä¸€åˆ‡çš†ä¸ºæµï¼ˆStreamï¼‰ï¼Œä½ å¯ä»¥å¯¹æµè¿›è¡Œ**å£°æ˜å¼æ“ä½œ**ï¼ˆmap, filter, flatMap ç­‰ï¼‰ã€‚

```java
// å£°æ˜å¼ï¼šæˆ‘å…³å¿ƒâ€œåšä»€ä¹ˆâ€ï¼Œè€Œä¸æ˜¯â€œæ€ä¹ˆåšâ€
Flux.just(1, 2, 3)
    .map(x -> x * 2)
    .filter(x -> x > 3)
    .subscribe(System.out::println);
// è¾“å‡ºï¼š4, 6

```

### 2.2 æ ¸å¿ƒç±»å‹ï¼šMonoä¸Flux

| ç±»å‹ | å…ƒç´ æ•°é‡ | ç”¨é€” |
| --- | --- | --- |
| `Mono<T>` | 0 æˆ– 1 ä¸ª | å•ä¸ªç»“æœï¼ˆå¦‚ HTTP è¯·æ±‚ã€æ•°æ®åº“æŸ¥è¯¢ï¼‰ |
| `Flux<T>` | 0 åˆ° N ä¸ª | å¤šä¸ªç»“æœï¼ˆå¦‚åˆ—è¡¨ã€äº‹ä»¶æµï¼‰ |

```java
// âœ… Mono ç¤ºä¾‹
Mono<String> user = Mono.just("Alice");
Mono<Void> save = userRepository.save(userEntity); // æ— è¿”å›å€¼

// âœ… Flux ç¤ºä¾‹
Flux<String> users = Flux.just("Alice", "Bob", "Charlie");
Flux<Integer> numbers = Flux.range(1, 5); // 1,2,3,4,5

```

### 2.3 æ“ä½œç¬¦

Reactor æä¾›äº†ä¸°å¯Œçš„æ“ä½œç¬¦ï¼Œæ‰€æœ‰æ“ä½œç¬¦éƒ½æ˜¯**å†·æµ**ï¼ˆCold Streamï¼‰ï¼Œå³**è®¢é˜…æ—¶æ‰æ‰§è¡Œ**ã€‚

```java
import reactor.core.publisher.Flux;
import java.time.Duration;

public class OperatorsExample {
    public static void main(String[] args) throws InterruptedException {
        Flux.range(1, 10)
            .filter(n -> n % 2 == 0)                    // è¿‡æ»¤å¶æ•°
            .map(n -> "Item-" + n)                      // è½¬æ¢ä¸ºå­—ç¬¦ä¸²
            .delayElements(Duration.ofMillis(100))      // æ¯ 100ms å‘ä¸€ä¸ª
            .doOnNext(System.out::println)              // å‰¯ä½œç”¨ï¼šæ‰“å°
            .take(3)                                    // åªå–å‰ 3 ä¸ª
            .subscribe();

        Thread.sleep(500); // ç­‰å¾…è¾“å‡º
    }
}
// è¾“å‡ºï¼šItem-2, Item-4, Item-6

```

ğŸ” `delayElements` è¯æ˜äº†éé˜»å¡ç‰¹æ€§ï¼šä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹

### 2.4 èƒŒå‹ï¼ˆBackpressureï¼‰

**é—®é¢˜**ï¼šç”Ÿäº§è€…å¤ªå¿«ï¼Œæ¶ˆè´¹è€…å¤ªæ…¢ï¼Œå¯¼è‡´å†…å­˜æº¢å‡ºã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šèƒŒå‹ â€”â€” æ¶ˆè´¹è€…ä¸»åŠ¨æ§åˆ¶è¯·æ±‚çš„æ•°æ®é‡ã€‚

```java
Flux.range(1, 1000)
    .onBackpressureBuffer(100) // ç¼“å†²åŒºæœ€å¤š 100 ä¸ª
    .onBackpressureDrop(item -> System.out.println("ä¸¢å¼ƒ: " + item)) // è¶…å‡ºåˆ™ä¸¢å¼ƒ
    .subscribe(new BaseSubscriber<Integer>() {
        @Override
        protected void hookOnSubscribe(Subscription subscription) {
            request(10); // åˆå§‹è¯·æ±‚ 10 ä¸ª
        }

        @Override
        protected void hookOnNext(Integer value) {
            System.out.println("å¤„ç†: " + value);
            request(1); // å¤„ç†å®Œä¸€ä¸ªï¼Œå†è¦ä¸€ä¸ª
        }
    });

```

### 2.5 è°ƒåº¦ä¸çº¿ç¨‹æ¨¡å‹ï¼ˆæ ¸å¿ƒï¼ï¼‰

##### `subscribeOn` vs `publishOn`

```java
Flux.just("A", "B")
    .map(data -> {
        System.out.println("ä¸Šæ¸¸çº¿ç¨‹: " + Thread.currentThread().getName());
        return data + "-1";
    })
    .subscribeOn(Schedulers.boundedElastic()) // å½±å“ä¸Šæ¸¸æ‰§è¡Œçº¿ç¨‹
    .map(data -> {
        System.out.println("ä¸‹æ¸¸çº¿ç¨‹: " + Thread.currentThread().getName());
        return data + "-2";
    })
    .publishOn(Schedulers.parallel())         // åˆ‡æ¢ä¸‹æ¸¸æ‰§è¡Œçº¿ç¨‹
    .subscribe(result -> 
               System.out.println("è®¢é˜…çº¿ç¨‹: " + Thread.currentThread().getName() + " => " + result)
              );

```

ğŸ¯ **å…³é”®åŒºåˆ«**ï¼š

* `subscribeOn`ï¼š**å½±å“æ•´ä¸ªä¸Šæ¸¸**ï¼ˆä»æºå¤´åˆ°å½“å‰ä½ç½®ï¼‰
* `publishOn`ï¼š**åªå½±å“å…¶åçš„ä¸‹æ¸¸æ“ä½œ**

### 2.6 é”™è¯¯å¤„ç†

```java
Flux.just(1, 2, 3)
    .map(n -> {
        if (n == 2) throw new RuntimeException("å‡ºé”™äº†");
        return "Result-" + n;
    })
    .onErrorResume(e -> {
        System.err.println("æ•è·é”™è¯¯: " + e.getMessage());
        return Flux.just("Fallback-1", "Fallback-2");
    })
    .retry(2) // é‡è¯• 2 æ¬¡
    .subscribe(System.out::println);

```

## ä¸‰ã€åº•å±‚å®ç°åŸç†

### 3.1 å“åº”å¼æµåè®®ï¼ˆReactive Streamsï¼‰

Reactor å®ç°äº† `Publisher`, `Subscriber`, `Subscription`, `Processor` å››å¤§æ¥å£ã€‚

```java
public interface Publisher<T> {
    void subscribe(Subscriber<? super T> s);
}

public interface Subscriber<T> {
    void onSubscribe(Subscription s);
    void onNext(T t);
    void onError(Throwable t);
    void onComplete();
}

```

### 3.2 æ“ä½œç¬¦çš„é“¾å¼ç»“æ„

Flux.just







.filter







.map







.delayElements







.take







.subscribe

ğŸ” è®¢é˜…æ—¶ï¼Œé“¾è¡¨**é€†å‘å»ºç«‹è®¢é˜…å…³ç³»**ï¼Œä» `subscribe` å›æº¯åˆ°æºå¤´ã€‚

### 3.3 å¼‚æ­¥ä¸çº¿ç¨‹åˆ‡æ¢åŸç†

* `Schedulers` å°è£…äº† `ExecutorService`ã€‚
* `publishOn` å†…éƒ¨ä½¿ç”¨ `Queue` + `Worker` å®ç°çº¿ç¨‹åˆ‡æ¢ã€‚
* `subscribeOn` åœ¨æºå¤´å°±åˆ‡æ¢æ‰§è¡Œçº¿ç¨‹ã€‚

## å››ã€å…¸å‹åº”ç”¨åœºæ™¯

### 4.1 WebFlux å¾®æœåŠ¡ï¼ˆSpring ç”Ÿæ€ï¼‰

```java
@RestController
public class UserController {
    
    @GetMapping("/users/{id}")
    public Mono<User> getUser(@PathVariable String id) {
        return userService.findById(id); // éé˜»å¡è¿”å›
    }

    @GetMapping("/users")
    public Flux<User> getAllUsers() {
        return userService.findAll(); // æµå¼è¿”å›
    }
}

```

âœ… ä¼˜åŠ¿ï¼šé«˜å¹¶å‘ä¸‹å†…å­˜å ç”¨ä½ï¼Œååé‡é«˜ã€‚

### 4.2 å¼‚æ­¥æ•°æ®åº“è®¿é—®ï¼ˆR2DBCï¼‰

```java
@Repository
public class UserRepository {
    
    @Autowired
    private DatabaseClient client;

    public Mono<User> findById(String id) {
        return client.sql("SELECT * FROM users WHERE id = $1")
                     .bind(0, id)
                     .map(row -> User.from(row))
                     .one();
    }
}

```

âœ… æ›¿ä»£ JDBCï¼Œå®ç°çœŸæ­£çš„éé˜»å¡æ•°æ®åº“è®¿é—®ã€‚

### 4.3 å®æ—¶äº‹ä»¶æ¨é€ï¼ˆWebSocket / SSEï¼‰

```
@GetMapping(value = "/events", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
public Flux<String> streamEvents() {
    return eventBus
        .getEventFlux() // äº‹ä»¶æµ
        .map(event -> "Event: " + event.getData());
}

```

### 4.4 å¾®æœåŠ¡é—´é€šä¿¡

```java
WebClient client = WebClient.create("https://api.example.com");

Mono<User> user = client.get()
    .uri("/users/123")
    .retrieve()
    .bodyToMono(User.class); // éé˜»å¡è°ƒç”¨

```

âœ… æ›¿ä»£ `RestTemplate`ï¼Œå¼‚æ­¥éé˜»å¡ã€‚

## å››ã€å®è·µç»éªŒä¸æœ€ä½³å®æˆ˜

âœ… æ­£ç¡®å®è·µ

* **I/O æ“ä½œ** â†’ `Schedulers.boundedElastic()`
* **CPU è®¡ç®—** â†’ `Schedulers.parallel()`
* **é¿å…åœ¨ `map` ä¸­é˜»å¡**
* **ä½¿ç”¨ `StepVerifier` æµ‹è¯•å“åº”å¼æµ**

âŒ å¸¸è§é™·é˜±

| ä¼˜ç‚¹ | ç¼ºç‚¹ |
| --- | --- |
| âœ… é«˜å¹¶å‘ã€ä½å»¶è¿Ÿ | âŒ å­¦ä¹ æ›²çº¿é™¡å³­ |
| âœ… èµ„æºåˆ©ç”¨ç‡é«˜ï¼ˆçº¿ç¨‹å°‘ï¼‰ | âŒ è°ƒè¯•å›°éš¾ï¼ˆå¼‚æ­¥æ ˆï¼‰ |
| âœ… æ”¯æŒèƒŒå‹ï¼Œé˜²æ­¢ OOM | âŒ ä¸é˜»å¡åº“é›†æˆå¤æ‚ |
| âœ… ä¸ Spring æ·±åº¦é›†æˆ | âŒ å›¢é˜ŸæŠ€èƒ½è¦æ±‚é«˜ |

## äº”ã€æ€»ç»“

* Reactor æ˜¯ Java å“åº”å¼ç¼–ç¨‹çš„**äº‹å®æ ‡å‡†**ï¼Œå…¶æ ¸å¿ƒä»·å€¼åœ¨äºï¼š
* **éé˜»å¡å¼‚æ­¥**ï¼šæå‡ç³»ç»Ÿååé‡

  **èƒŒå‹æœºåˆ¶**ï¼šä¿éšœç³»ç»Ÿç¨³å®šæ€§

  **å£°æ˜å¼ç¼–ç¨‹**ï¼šä»£ç æ›´ç®€æ´ã€å¯è¯»
* **ä¸ Spring ç”Ÿæ€æ— ç¼é›†æˆ**

> ğŸš€ **é€‚ç”¨åœºæ™¯**ï¼šé«˜å¹¶å‘ Web æœåŠ¡ã€å®æ—¶ç³»ç»Ÿã€å¾®æœåŠ¡ã€äº‹ä»¶é©±åŠ¨æ¶æ„ã€‚
>
> âš ï¸ **ä¸é€‚ç”¨åœºæ™¯**ï¼šç®€å• CRUDã€ä½å¹¶å‘ã€å›¢é˜Ÿæ— å“åº”å¼ç»éªŒã€‚

æŒæ¡ Reactorï¼Œæ„å‘³ç€ä½ æŒæ¡äº†æ„å»ºç°ä»£é«˜æ€§èƒ½ç³»ç»Ÿçš„â€œ**æ ¸æ­¦å™¨**â€ã€‚ä½†åˆ‡è®°ï¼š**ä¸è¦ä¸ºäº†å“åº”å¼è€Œå“åº”å¼**ï¼Œé€‰æ‹©åˆé€‚çš„å·¥å…·è§£å†³åˆé€‚çš„é—®é¢˜



