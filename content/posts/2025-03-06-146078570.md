---
layout: post
title: "kafka单机部署实战"
date: 2025-03-06 19:46:29 +0800
description: "若已经格式化过后想修改，则先要删除这个目录/tmp/kraft-combined-logs（也可能是你自己修改后的数据目录）为consumer和producer创建登录验证文件，文件内容如下（如果是程序访问，如springboot访问，可以不配置）目录：/mnt/kafka/kafka_2.13-3.7.2/config。，文件目录位于：/kafka_2.13-3.7.2/config/1，如果需要公网访问，需要配置域名，kafka不接受ip访问。kafka启动文件，引入校验文件目录。"
keywords: "单机kafka"
categories: ['未分类']
tags: ['分布式', 'Zookeeper', 'Kafka']
artid: "146078570"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146078570
    alt: "kafka单机部署实战"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146078570
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146078570
cover: https://bing.ee123.net/img/rand?artid=146078570
image: https://bing.ee123.net/img/rand?artid=146078570
img: https://bing.ee123.net/img/rand?artid=146078570
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     kafka单机部署实战
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="kafka_1">
     </a>
     kafka单机部署实战
    </h2>
    <h3>
     <a id="1_3">
     </a>
     1，准备工作
    </h3>
    <blockquote>
     <p>
      <strong>
       本文以 kafka版本： kafka_2.13-3.7.2.gz，为示例；
      </strong>
     </p>
     <p>
      <strong>
       zookeeper版本：zookeeper-3.4.9.tar.gz，为示例；
      </strong>
     </p>
    </blockquote>
    <p>
     <strong>
      kafka下载官网地址
     </strong>
     ：https://kafka.apache.org/downloads
    </p>
    <p>
     <strong>
      zookeeper 下载官网地址
     </strong>
     ：https://zookeeper.apache.org/releases.html
    </p>
    <blockquote>
     <p>
      上传到服务器之后解压：
     </p>
    </blockquote>
    <pre><code class="prism language-sh"><span class="token comment">#解压命令示例：</span>
<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> kafka_2.13-3.7.2.gz

<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> zookeeper-3.4.9.tar.gz
</code></pre>
    <h3>
     <a id="2_28">
     </a>
     2，开始部署
    </h3>
    <h4>
     <a id="21_kafka_30">
     </a>
     2.1 配置用户密码连接kafka（可以跳过，无需配置）
    </h4>
    <p>
     <strong>
      进入目录 /kafka_2.13-3.7.2/config/
     </strong>
    </p>
    <pre><code>#进入kafka配置目录
sudo cd /kafka_2.13-3.7.2/config/
</code></pre>
    <h5>
     <a id="211___kafka_server_jaasconf_39">
     </a>
     2.1.1 创建文件 kafka_server_jaas.conf
    </h5>
    <blockquote>
     <p>
      创建文件 kafka_server_jaas.conf
     </p>
    </blockquote>
    <pre><code class="prism language-sh"><span class="token function">sudo</span> <span class="token function">vim</span> kafka_server_jaas.conf
KafkaServer <span class="token punctuation">{<!-- --></span>
	org.apache.kafka.common.security.plain.PlainLoginModule required
	<span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">"admin"</span>
    <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">"admin@123"</span>
    <span class="token assign-left variable">user_visitor</span><span class="token operator">=</span><span class="token string">"admin@123"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h5>
     <a id="212___kafka_client_jaasconf_55">
     </a>
     2.1.2 创建文件 kafka_client_jaas.conf
    </h5>
    <blockquote>
     <p>
      为consumer和producer创建登录验证文件，文件内容如下（如果是程序访问，如springboot访问，可以不配置）
     </p>
    </blockquote>
    <pre><code class="prism language-sh"><span class="token function">sudo</span> <span class="token function">vim</span> kafka_client_jaas.conf
KafkaClient <span class="token punctuation">{<!-- --></span>  
	org.apache.kafka.common.security.plain.PlainLoginModule required  
    <span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">"admin"</span>  
    <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">"admin@123"</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h5>
     <a id="213_consumerpropertiesproducerproperties_68">
     </a>
     2.1.3 配置consumer.properties和producer.properties
    </h5>
    <blockquote>
     <p>
      两个文件都在config目录下
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ff338e4e72da44899ce1497ba60be301.png"/>
     </p>
    </blockquote>
    <pre><code class="prism language-sh"><span class="token function">sudo</span> <span class="token function">vim</span>  consumer.properties

<span class="token comment">#末尾追加</span>
<span class="token assign-left variable">security.protocol</span><span class="token operator">=</span>SASL_PLAINTEXT
<span class="token assign-left variable">sasl.mechanism</span><span class="token operator">=</span>PLAIN

<span class="token function">sudo</span> <span class="token function">vim</span> producer.properties

<span class="token comment">#末尾追加</span>
<span class="token assign-left variable">security.protocol</span><span class="token operator">=</span>SASL_PLAINTEXT
<span class="token assign-left variable">sasl.mechanism</span><span class="token operator">=</span>PLAIN
</code></pre>
    <h5>
     <a id="214__binkafkaserverstartsh_89">
     </a>
     2.1.4 修改文件 bin/kafka-server-start.sh
    </h5>
    <blockquote>
     <p>
      kafka启动文件，引入校验文件目录
     </p>
    </blockquote>
    <pre><code class="prism language-sh"><span class="token comment">#编辑配置文件</span>
<span class="token function">sudo</span> <span class="token function">vim</span> /mnt/kafka/kafka_2.13-3.7.2/bin/kafka-server-start.sh

<span class="token comment">#在文件最上面加入：</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KAFKA_OPTS</span><span class="token operator">=</span><span class="token string">" -Djava.security.auth.login.config=/mnt/kafka/kafka_2.13-3.7.2/config/kafka_server_jaas.conf"</span>
</code></pre>
    <h5>
     <a id="214__binkafkaconsoleproducershkafkaconsoleconsumersh_101">
     </a>
     2.1.4 修改文件 /bin/kafka-console-producer.sh和kafka-console-consumer.sh
    </h5>
    <pre><code class="prism language-sh"><span class="token comment">#编辑配置文件</span>
<span class="token function">sudo</span> <span class="token function">vim</span> /mnt/kafka/kafka_2.13-3.7.2/bin/kafka-console-producer.sh

<span class="token comment">#在文件最上面加入：</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KAFKA_OPTS</span><span class="token operator">=</span><span class="token string">" -Djava.security.auth.login.config=/mnt/kafka/kafka_2.13-3.7.2/config/kafka_client_jaas.conf"</span>

<span class="token comment">#编辑配置文件</span>
<span class="token function">sudo</span> <span class="token function">vim</span> /mnt/kafka/kafka_2.13-3.7.2/bin/kafka-console-consumer.sh

<span class="token comment">#在文件最上面加入：</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KAFKA_OPTS</span><span class="token operator">=</span><span class="token string">" -Djava.security.auth.login.config=/mnt/kafka/kafka_2.13-3.7.2/config/kafka_client_jaas.conf"</span>
</code></pre>
    <h5>
     <a id="215_zookeeper_119">
     </a>
     2.1.5 zookeeper配置文件修改（可以跳过，无需配置）
    </h5>
    <blockquote>
     <p>
      如果kafka访问zookeeper也需要登录验证，则需要为zookeeper添加登录验证配置，如下:
     </p>
    </blockquote>
    <pre><code class="prism language-sh"><span class="token function">sudo</span> <span class="token function">vim</span> /mnt/kafka/kafka_2.13-3.7.2/config/zookeeper.properties

zookeeper <span class="token punctuation">{<!-- --></span>
        org.apache.kafka.common.security.plain.PlainLoginModule required
        <span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">"admin"</span>
        <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">"admin@123"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <blockquote>
     <p>
      注意：
      <code>
       kafka
      </code>
      启动运行内存要求比较高。由于我的测试服务器机器性能比较低，我使用
      <code>
       kraft
      </code>
      方式启动
     </p>
    </blockquote>
    <h4>
     <a id="21__137">
     </a>
     2.1 两种启动方式
    </h4>
    <h5>
     <a id="211_zookeeperkafka_139">
     </a>
     2.1.1 使用
     <code>
      zookeeper
     </code>
     方式启动：
     <code>
      kafka
     </code>
    </h5>
    <blockquote>
     <p>
      修改
      <code>
       kafka
      </code>
      配置文件:
      <code>
       server.properties
      </code>
      ，文件目录位于：/kafka_2.13-3.7.2/config/
     </p>
    </blockquote>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/3f036e94a1d64dd194d69de9e6d9bac1.png"/>
    </p>
    <pre><code class="prism language-sh"><span class="token comment">#进入命令模式，进行编辑：</span>
<span class="token function">sudo</span> <span class="token function">vim</span> server.properties

编辑重点部分如下：

<span class="token comment"># Kafka Broker的Listener的配置项,需要如下配置,不要填写IP，如果仅仅内网访问可以填写IP，且不用配置advertised.listeners</span>
<span class="token comment"># 需要修改内网方式</span>
<span class="token assign-left variable">listeners</span><span class="token operator">=</span>SASL_PLAINTEXT://<span class="token operator">&lt;</span>内网ip<span class="token operator">&gt;</span>:9092,CONTROLLER://<span class="token operator">&lt;</span>内网ip<span class="token operator">&gt;</span>:9093

<span class="token comment">#外网方式</span>
<span class="token comment">#listeners=SASL_PLAINTEXT://&lt;内网ip&gt;:9093,CONTROLLER://&lt;内网ip&gt;:9091,PUBLIC://&lt;域名&gt;:9092</span>


<span class="token comment">#kafkabroker注册zookeeper，外网可以通过这个配置进行访问kafka</span>
<span class="token comment"># 需要修改内网方式</span>
<span class="token assign-left variable">advertised.listeners</span><span class="token operator">=</span>SASL_PLAINTEXT://<span class="token operator">&lt;</span>内网ip<span class="token operator">&gt;</span>:9092
<span class="token comment">#外网方式</span>
<span class="token comment">#advertised.listeners=SASL_PLAINTEXT://&lt;内网ip&gt;:9093,PUBLIC://&lt;域名&gt;:9092</span>


<span class="token comment">#设置zookeeper监听地址</span>
<span class="token assign-left variable">zookeeper.connect</span><span class="token operator">=</span><span class="token operator">&lt;</span>内网ip<span class="token operator">&gt;</span>:2181

<span class="token comment">#设置你的kafka日志目录</span>
<span class="token assign-left variable">log.dirs</span><span class="token operator">=</span>/mnt/kafka/kafka_2.13-3.7.2/logs/

<span class="token comment">#使用的认证协议</span>
<span class="token assign-left variable">security.inter.broker.protocol</span><span class="token operator">=</span>SASL_PLAINTEXT
<span class="token comment">#SASL机制</span>
<span class="token assign-left variable">sasl.enabled.mechanisms</span><span class="token operator">=</span>PLAIN
<span class="token assign-left variable">sasl.mechanism.inter.broker.protocol</span><span class="token operator">=</span>PLAIN
<span class="token comment">#完成身份验证的类</span>
<span class="token assign-left variable">authorizer.class.name</span><span class="token operator">=</span>org.apache.kafka.metadata.authorizer.StandardAuthorizer

<span class="token comment">#如果没有找到ACL（访问控制列表）配置，则允许任何操作。</span>
<span class="token assign-left variable">allow.everyone.if.no.acl.found</span><span class="token operator">=</span>false
<span class="token comment">#需要开启设置超级管理员,设置admin用户为超级管理员</span>
<span class="token assign-left variable">super.users</span><span class="token operator">=</span>User:admin
 
</code></pre>
    <p>
     <strong>
      差异部分： 需要仔细对照；
     </strong>
    </p>
    <p>
     <strong>
      日志目录：需要创建；
     </strong>
    </p>
    <pre><code class="prism language-sh"><span class="token comment">#使用命令</span>
<span class="token function">sudo</span> <span class="token builtin class-name">cd</span> /mnt/kafka/kafka_2.13-3.7.2
<span class="token function">sudo</span> <span class="token function">mkdir</span> logs
</code></pre>
    <p>
     启动zookeeper，进入安装bin目录：
    </p>
    <pre><code class="prism language-sh"><span class="token comment"># 添加-daemon表示后台运行，这里我们学习过程不加这个参数，方便观察日志</span>
./zookeeper-server-start.sh <span class="token punctuation">[</span>-daemon<span class="token punctuation">]</span> /mnt/kafka/kafka_2.13-3.7.2/config/zookeeper.properties
</code></pre>
    <p>
     启动kafka，进入安装bin目录:
    </p>
    <pre><code class="prism language-sh">./kafka-server-start.sh <span class="token punctuation">[</span>-daemon<span class="token punctuation">]</span> /mnt/kafka/kafka_2.13-3.7.2/config/server.properties 
</code></pre>
    <h5>
     <a id="22___kraftkafka_218">
     </a>
     2.2 使用
     <code>
      kraft
     </code>
     方式启动：
     <code>
      kafka
     </code>
    </h5>
    <blockquote>
     <p>
      2.1.1 修改
      <code>
       kraft
      </code>
      配置文件:
      <code>
       server.properties
      </code>
     </p>
    </blockquote>
    <pre><code class="prism language-sh"><span class="token function">sudo</span> <span class="token function">vim</span> /mnt/kafka/kafka_2.13-3.7.2/config/kraft

<span class="token comment">#修改如下：</span>
<span class="token assign-left variable">process.roles</span><span class="token operator">=</span>broker,controller

<span class="token comment"># The node id associated with this instance's roles</span>
<span class="token assign-left variable">node.id</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token comment"># 需要修改</span>
<span class="token assign-left variable">controller.quorum.voters</span><span class="token operator">=</span><span class="token number">1</span>@10.78.2.230:9093

<span class="token comment"># 需要修改内网方式</span>
<span class="token assign-left variable">listeners</span><span class="token operator">=</span>SASL_PLAINTEXT://<span class="token operator">&lt;</span>内网ip<span class="token operator">&gt;</span>:9092,CONTROLLER://<span class="token operator">&lt;</span>内网ip<span class="token operator">&gt;</span>:9093

<span class="token comment">#外网方式</span>
<span class="token comment">#listeners=SASL_PLAINTEXT://&lt;内网ip&gt;:9093,CONTROLLER://&lt;内网ip&gt;:9091,PUBLIC://&lt;域名&gt;:9092</span>

<span class="token comment">#使用的认证协议</span>
<span class="token assign-left variable">security.inter.broker.protocol</span><span class="token operator">=</span>SASL_PLAINTEXT

<span class="token comment">#SASL机制</span>
<span class="token assign-left variable">sasl.enabled.mechanisms</span><span class="token operator">=</span>PLAIN
<span class="token assign-left variable">sasl.mechanism.inter.broker.protocol</span><span class="token operator">=</span>PLAIN

<span class="token comment">#完成身份验证的类</span>
<span class="token assign-left variable">authorizer.class.name</span><span class="token operator">=</span>org.apache.kafka.metadata.authorizer.StandardAuthorizer

<span class="token comment">#如果没有找到ACL（访问控制列表）配置，则允许任何操作。</span>
<span class="token assign-left variable">allow.everyone.if.no.acl.found</span><span class="token operator">=</span>true
<span class="token comment">#需要开启设置超级管理员, 开启以下命令</span>
<span class="token assign-left variable">super.users</span><span class="token operator">=</span>User:admin

<span class="token comment"># 需要修改内网方式</span>
<span class="token assign-left variable">advertised.listeners</span><span class="token operator">=</span>SASL_PLAINTEXT://<span class="token operator">&lt;</span>内网ip<span class="token operator">&gt;</span>:9092
<span class="token comment">#外网方式</span>
<span class="token comment">#advertised.listeners=SASL_PLAINTEXT://&lt;内网ip&gt;:9093,PUBLIC://&lt;域名&gt;:9092</span>

<span class="token comment"># 需要修改</span>
<span class="token assign-left variable">listener.security.protocol.map</span><span class="token operator">=</span>CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL,PUBLIC:PLAINTEXT


<span class="token comment">#需要修改</span>
<span class="token assign-left variable">log.dirs</span><span class="token operator">=</span>/mnt/kafka/kafka_2.13-3.7.2/logs/
</code></pre>
    <p>
     <strong>
      生成 uuid
     </strong>
    </p>
    <blockquote>
     <p>
      Kafka 需要一个唯一标识符（UUID）来进行存储管理。使用 kafka-storage.sh 脚本生成这个 UUID。也可以通过其它工具生成。然后用这个uuid格式化存储目录。若已经格式化过后想修改，则先要删除这个目录/tmp/kraft-combined-logs（也可能是你自己修改后的数据目录）
     </p>
    </blockquote>
    <pre><code class="prism language-sh"><span class="token punctuation">[</span>root@VM-20-7-centos kafka<span class="token punctuation">]</span><span class="token comment"># ./bin/kafka-storage.sh random-uuid</span>
nTtEGnZ1ThO0GiiTcbU0XA
<span class="token punctuation">[</span>root@VM-20-7-centos kafka<span class="token punctuation">]</span><span class="token comment"># ./bin/kafka-storage.sh format -t nTtEGnZ1ThO0GiiTcbU0XA -c config/kraft/server.properties</span>
<span class="token assign-left variable">metaPropertiesEnsemble</span><span class="token operator">=</span>MetaPropertiesEnsemble<span class="token punctuation">(</span>metadataLogDir<span class="token operator">=</span>Optional.empty, <span class="token assign-left variable">dirs</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span>/tmp/kraft-combined-logs: EMPTY<span class="token punctuation">}</span><span class="token punctuation">)</span>
Formatting /tmp/kraft-combined-logs with metadata.version <span class="token number">3.7</span>-IV4.
</code></pre>
    <p>
     启动kafka，进入安装bin目录:
    </p>
    <pre><code class="prism language-sh"><span class="token comment"># 添加-daemon表示后台运行，这里我们学习过程不加这个参数，方便观察日志</span>
./kafka-server-start.sh  <span class="token punctuation">[</span>-daemon<span class="token punctuation">]</span> /mnt/kafka/kafka_2.13-3.7.2/config/kraft/server.properties
</code></pre>
    <h3>
     <a id="3__295">
     </a>
     3 服务命令测试
    </h3>
    <blockquote>
     <p>
      进入安装bin目录
     </p>
    </blockquote>
    <pre><code class="prism language-sh"><span class="token comment"># 创建名为 test-topic 的主题名称，partitions分区为1，replication-factor副本数量为1</span>
<span class="token function">sudo</span> ./kafka-topics.sh <span class="token parameter variable">--create</span> <span class="token parameter variable">--topic</span> test-topic --bootstrap-server <span class="token operator">&lt;</span>ip地址<span class="token operator">&gt;</span>:9092 <span class="token parameter variable">--partitions</span> <span class="token number">1</span> --replication-factor <span class="token number">1</span>
Created topic test-topic.
 
<span class="token comment">#查看本地kafka内的主题列表</span>
<span class="token function">sudo</span> ./kafka-topics.sh --bootstrap-server <span class="token operator">&lt;</span>ip地址<span class="token operator">&gt;</span>:9092 <span class="token parameter variable">--list</span>
test-topic

<span class="token comment"># 创建一个主题为 test-topic 的生产者，下放就可以输入消息按回车发送</span>
<span class="token punctuation">[</span>root@VM-20-7-centos kafka<span class="token punctuation">]</span><span class="token comment"># bin/kafka-console-producer.sh --topic test-topic  --bootstrap-server &lt;ip地址&gt;:9092</span>
<span class="token operator">&gt;</span><span class="token number">123</span>
<span class="token operator">&gt;</span>
 
 
<span class="token comment"># 创建一个主题为 test-topic的消费者，屏幕会实时显示该主题内收到的消息，--from-beginning表示从第一条消息开始消费，若不带这个参数，则只能看到创建后产生的消息</span>
<span class="token punctuation">[</span>root@VM-20-7-centos kafka<span class="token punctuation">]</span><span class="token comment"># bin/kafka-console-consumer.sh --topic test-topic --from-beginning --bootstrap-server &lt;ip地址&gt;:9092</span>
<span class="token number">123</span>
</code></pre>
    <h3>
     <a id="4_sprinboot__kafka_321">
     </a>
     4 sprinboot 集成 kafka;
    </h3>
    <h5>
     <a id="41__applicationkafka_323">
     </a>
     4.1 配置 application-kafka文件
    </h5>
    <pre><code class="prism language-xml">spring:
  kafka:
    bootstrap-servers: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ip地址或者域名</span><span class="token punctuation">&gt;</span></span>:9092

    # 配置用户名密码
    properties:
      security:
        protocol: SASL_PLAINTEXT
      sasl:
        mechanism: PLAIN
        jaas:
          config: org.apache.kafka.common.security.scram.ScramLoginModule required username="admin" password="admin@123";

    producer:

      # 发生错误后，消息重发的次数。
      retries: 0

      #当有多个消息需要被发送到同一个分区时，生产者会把它们放在同一个批次里。该参数指定了一个批次可以使用的内存大小，按照字节数计算。
      batch-size: 16384

      # 设置生产者内存缓冲区的大小。
      buffer-memory: 33554432

      # 键的序列化方式
      key-serializer: org.apache.kafka.common.serialization.StringSerializer

      # 值的序列化方式
      value-serializer: org.apache.kafka.common.serialization.StringSerializer

      # acks=0 ： 生产者在成功写入消息之前不会等待任何来自服务器的响应。
      # acks=1 ： 只要集群的首领节点收到消息，生产者就会收到一个来自服务器成功响应。
      # acks=all ：只有当所有参与复制的节点全部收到消息时，生产者才会收到一个来自服务器的成功响应。
      acks: 1
    consumer:

      # 自动提交的时间间隔 在spring boot 2.X 版本中这里采用的是值的类型为Duration 需要符合特定的格式，如1S,1M,2H,5D
      auto-commit-interval: 1S

      # 该属性指定了消费者在读取一个没有偏移量的分区或者偏移量无效的情况下该作何处理：
      # latest（默认值）在偏移量无效的情况下，消费者将从最新的记录开始读取数据（在消费者启动之后生成的记录）
      # earliest ：在偏移量无效的情况下，消费者将从起始位置读取分区的记录
      auto-offset-reset: earliest

      # 是否自动提交偏移量，默认值是true,为了避免出现重复数据和数据丢失，可以把它设置为false,然后手动提交偏移量
      enable-auto-commit: false

      # 键的反序列化方式
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer

      # 值的反序列化方式
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
    listener:

      # 在侦听器容器中运行的线程数。
      concurrency: 5

      #listner负责ack，每调用一次，就立即commit
      ack-mode: manual_immediate
      missing-topics-fatal: false

</code></pre>
    <h5>
     <a id="42__391">
     </a>
     4.2 生产者
    </h5>
    <pre><code class="prism language-java"><span class="token comment">/**
 * 功能描述: 生产者
 *
 * @Author keLe
 * @Date 2025/2/12
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KafkaProducer</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">KafkaTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> kafkaTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"kafka send topic:{}, message: {}"</span><span class="token punctuation">,</span> topic<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        kafkaTemplate<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"kafka send topic:{}, success!"</span><span class="token punctuation">,</span> topic <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h5>
     <a id="43__418">
     </a>
     4.3 消费者
    </h5>
    <pre><code class="prism language-sh">/**
 * @Author keLe
 * @Date <span class="token number">2025</span>/2/12
 */
@Slf4j
@Component
public class KafkaConsumer <span class="token punctuation">{<!-- --></span>
 
	@KafkaListener<span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token string">"test-consumer-group"</span>,topics <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"test-topic"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	public void consume1<span class="token punctuation">(</span>ConsumerRecord<span class="token operator">&lt;</span>Object, Object<span class="token operator">&gt;</span> record<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		log.info<span class="token punctuation">(</span><span class="token string">"收到消息：topic={},partition={}, offset={}, key={}, value={}"</span>,record.topic<span class="token punctuation">(</span><span class="token punctuation">)</span>,record.partition<span class="token punctuation">(</span><span class="token punctuation">)</span>,
				record.offset<span class="token punctuation">(</span><span class="token punctuation">)</span>,record.key<span class="token punctuation">(</span><span class="token punctuation">)</span>,record.value<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
 
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="45__440">
     </a>
     4.5 测试接口
    </h5>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/api/kafka/demo/"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KafkaController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">KafkaProducer</span> kafkaProducer<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Anonymous</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/send"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        kafkaProducer<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">"test-topic"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"Message sent: "</span> <span class="token operator">+</span> msg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="5__461">
     </a>
     5 扩展
    </h3>
    <p>
     1，如果需要公网访问，需要配置域名，kafka不接受ip访问。
    </p>
    <p>
     2，开放端口9092。
    </p>
    <p>
     3，修改端口，需要修改以下文件如下：
    </p>
    <p>
     目录：/mnt/kafka/kafka_2.13-3.7.2/config
    </p>
    <p>
     1、service.
     <a href="https://so.csdn.net/so/search?q=properties&amp;spm=1001.2101.3001.7020">
      properties
     </a>
     port = 19092 不指定的话，按照默认9092
    </p>
    <p>
     2、connect-distributed.properties bootstrap.servers=localhost:19092
    </p>
    <p>
     3、producer.properties bootstrap.servers=localhost:19092
    </p>
    <p>
     4、connect-standalone.properties bootstrap.servers=localhost:19092
    </p>
    <p>
     5、consumer.properties bootstrap.servers=localhost:19092
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f4372617a795f43772f:61727469636c652f64657461696c732f313436303738353730" class_="artid" style="display:none">
 </p>
</div>


