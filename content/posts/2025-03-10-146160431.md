---
layout: post
title: "Linux-losetup循环设备"
date: 2025-03-10 18:06:14 +0800
description: "（类似于硬盘或分区）。通过循环设备，你可以将一个文件当作一个磁盘分区来使用，并对其中的文件系统进行挂载和访问。你说得对，我确实没有详细解释**循环设备（loop device）**的概念。循环设备是 Linux 内核提供的一种虚拟设备，它的作用是将一个。设备关联，并以只读模式访问。"
keywords: "Linux losetup循环设备"
categories: ['我的博客']
tags: ['Nuttx', 'Losetup', 'Linux']
artid: "146160431"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146160431
    alt: "Linux-losetup循环设备"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146160431
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146160431
cover: https://bing.ee123.net/img/rand?artid=146160431
image: https://bing.ee123.net/img/rand?artid=146160431
img: https://bing.ee123.net/img/rand?artid=146160431
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Linux losetup循环设备
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     好的，以下是命令的中文解释和使用步骤：
    </p>
    <h4>
     <a id="_2">
     </a>
     命令解释：
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        <code>
         losetup -r /dev/loop0 /system/app.bin
        </code>
       </strong>
       ：
      </p>
      <ul>
       <li>
        <code>
         losetup
        </code>
        是一个用于将文件与循环设备（loop device）关联的命令。
       </li>
       <li>
        <code>
         -r
        </code>
        选项表示将循环设备设置为只读模式。
       </li>
       <li>
        <code>
         /dev/loop0
        </code>
        是使用的循环设备。
       </li>
       <li>
        <code>
         /system/app.bin
        </code>
        是要与循环设备关联的文件。
       </li>
       <li>
        这条命令的作用是将
        <code>
         /system/app.bin
        </code>
        文件的内容通过
        <code>
         /dev/loop0
        </code>
        设备以只读方式访问。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        <code>
         mount -t romfs /dev/loop0 /resource/app
        </code>
       </strong>
       ：
      </p>
      <ul>
       <li>
        <code>
         mount
        </code>
        命令用于将文件系统挂载到某个目录（挂载点）。
       </li>
       <li>
        <code>
         -t romfs
        </code>
        指定要挂载的文件系统类型为
        <code>
         romfs
        </code>
        （一种常用于嵌入式系统的只读文件系统）。
       </li>
       <li>
        <code>
         /dev/loop0
        </code>
        是包含文件系统的循环设备。
       </li>
       <li>
        <code>
         /resource/app
        </code>
        是文件系统将要挂载到的目标目录。
       </li>
       <li>
        这条命令的作用是将
        <code>
         /dev/loop0
        </code>
        中的
        <code>
         romfs
        </code>
        文件系统挂载到
        <code>
         /resource/app
        </code>
        目录。
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_19">
     </a>
     使用步骤：
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        将文件关联到循环设备
       </strong>
       ：
      </p>
      <pre><code class="prism language-bash">losetup <span class="token parameter variable">-r</span> /dev/loop0 /system/app.bin
</code></pre>
      <p>
       这条命令将
       <code>
        /system/app.bin
       </code>
       文件与
       <code>
        /dev/loop0
       </code>
       设备关联，并以只读模式访问。
      </p>
     </li>
     <li>
      <p>
       <strong>
        挂载文件系统
       </strong>
       ：
      </p>
      <pre><code class="prism language-bash"><span class="token function">mount</span> <span class="token parameter variable">-t</span> romfs /dev/loop0 /resource/app
</code></pre>
      <p>
       这条命令将
       <code>
        /dev/loop0
       </code>
       中的
       <code>
        romfs
       </code>
       文件系统挂载到
       <code>
        /resource/app
       </code>
       目录。
      </p>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_34">
     </a>
     注意事项：
    </h4>
    <ul>
     <li>
      确保
      <code>
       /dev/loop0
      </code>
      设备可用且未被占用。如果已被占用，可以尝试使用其他循环设备（如
      <code>
       /dev/loop1
      </code>
      ）。
     </li>
     <li>
      挂载目标目录
      <code>
       /resource/app
      </code>
      必须存在。如果不存在，可以使用以下命令创建：
      <pre><code class="prism language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /resource/app
</code></pre>
     </li>
     <li>
      操作完成后，可以卸载文件系统并释放循环设备：
      <ul>
       <li>
        卸载文件系统：
        <pre><code class="prism language-bash"><span class="token function">umount</span> /resource/app
</code></pre>
       </li>
       <li>
        释放循环设备：
        <pre><code class="prism language-bash">losetup <span class="token parameter variable">-d</span> /dev/loop0
</code></pre>
       </li>
      </ul>
     </li>
     <li>
      这些命令通常需要 root 权限，因此可能需要使用
      <code>
       sudo
      </code>
      或以 root 用户身份运行。
     </li>
    </ul>
    <hr/>
    <p>
     你说得对，我确实没有详细解释**循环设备（loop device）**的概念。下面我来详细说明一下：
    </p>
    <hr/>
    <h4>
     <a id="Loop_Device_57">
     </a>
     <strong>
      循环设备（Loop Device）是什么？
     </strong>
    </h4>
    <p>
     循环设备是 Linux 内核提供的一种虚拟设备，它的作用是将一个
     <strong>
      普通文件
     </strong>
     模拟成一个
     <strong>
      块设备
     </strong>
     （类似于硬盘或分区）。通过循环设备，你可以将一个文件当作一个磁盘分区来使用，并对其中的文件系统进行挂载和访问。
    </p>
    <p>
     举个例子：
    </p>
    <ul>
     <li>
      如果你有一个包含文件系统的镜像文件（如
      <code>
       .img
      </code>
      或
      <code>
       .bin
      </code>
      文件），你可以通过循环设备将这个文件“虚拟”成一个磁盘分区，然后挂载它，访问其中的内容。
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_65">
     </a>
     <strong>
      循环设备的工作原理
     </strong>
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        文件作为存储介质
       </strong>
       ：
      </p>
      <ul>
       <li>
        循环设备可以将一个普通文件（如
        <code>
         /system/app.bin
        </code>
        ）当作存储介质。
       </li>
       <li>
        这个文件通常是一个文件系统镜像（例如
        <code>
         ext4
        </code>
        、
        <code>
         romfs
        </code>
        等文件系统的镜像）。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        虚拟块设备
       </strong>
       ：
      </p>
      <ul>
       <li>
        循环设备（如
        <code>
         /dev/loop0
        </code>
        ）会将该文件模拟成一个块设备。
       </li>
       <li>
        操作系统会像对待普通磁盘分区一样对待这个虚拟设备。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        挂载文件系统
       </strong>
       ：
      </p>
      <ul>
       <li>
        一旦文件被关联到循环设备，你就可以使用
        <code>
         mount
        </code>
        命令将其中的文件系统挂载到某个目录，访问其中的文件。
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_79">
     </a>
     <strong>
      为什么需要循环设备？
     </strong>
    </h4>
    <p>
     循环设备的主要用途包括：
    </p>
    <ol>
     <li>
      <p>
       <strong>
        挂载文件系统镜像
       </strong>
       ：
      </p>
      <ul>
       <li>
        例如，Android 系统中的应用或资源文件可能被打包成
        <code>
         .bin
        </code>
        或
        <code>
         .img
        </code>
        文件。通过循环设备，可以将这些文件挂载到系统中，访问其中的内容。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        创建虚拟磁盘
       </strong>
       ：
      </p>
      <ul>
       <li>
        你可以创建一个空文件，将其格式化为某种文件系统，然后通过循环设备挂载它，作为一个虚拟磁盘使用。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        测试和开发
       </strong>
       ：
      </p>
      <ul>
       <li>
        在开发和测试中，循环设备常用于模拟磁盘分区或文件系统，而无需实际的物理设备。
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_92">
     </a>
     <strong>
      循环设备的典型使用流程
     </strong>
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        创建或准备一个文件
       </strong>
       ：
      </p>
      <ul>
       <li>
        这个文件可以是一个文件系统镜像（如
        <code>
         .img
        </code>
        或
        <code>
         .bin
        </code>
        文件），也可以是一个空文件。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        关联文件到循环设备
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用
        <code>
         losetup
        </code>
        命令将文件关联到循环设备。例如：
        <pre><code class="prism language-bash">losetup /dev/loop0 /system/app.bin
</code></pre>
        这会将
        <code>
         /system/app.bin
        </code>
        文件关联到
        <code>
         /dev/loop0
        </code>
        设备。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        挂载文件系统
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用
        <code>
         mount
        </code>
        命令挂载循环设备中的文件系统。例如：
        <pre><code class="prism language-bash"><span class="token function">mount</span> <span class="token parameter variable">-t</span> romfs /dev/loop0 /resource/app
</code></pre>
        这会将
        <code>
         /dev/loop0
        </code>
        中的
        <code>
         romfs
        </code>
        文件系统挂载到
        <code>
         /resource/app
        </code>
        目录。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        访问文件
       </strong>
       ：
      </p>
      <ul>
       <li>
        挂载后，你可以像访问普通目录一样访问
        <code>
         /resource/app
        </code>
        中的文件。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        卸载和释放
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用完成后，卸载文件系统并释放循环设备：
        <pre><code class="prism language-bash"><span class="token function">umount</span> /resource/app
losetup <span class="token parameter variable">-d</span> /dev/loop0
</code></pre>
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_122">
     </a>
     <strong>
      举个例子
     </strong>
    </h4>
    <p>
     假设你有一个
     <code>
      romfs
     </code>
     文件系统镜像文件
     <code>
      /system/app.bin
     </code>
     ，你可以通过以下步骤访问其中的内容：
    </p>
    <ol>
     <li>
      将文件关联到循环设备：
      <pre><code class="prism language-bash">losetup /dev/loop0 /system/app.bin
</code></pre>
     </li>
     <li>
      挂载文件系统：
      <pre><code class="prism language-bash"><span class="token function">mount</span> <span class="token parameter variable">-t</span> romfs /dev/loop0 /resource/app
</code></pre>
     </li>
     <li>
      访问文件：
      <pre><code class="prism language-bash"><span class="token function">ls</span> /resource/app
</code></pre>
     </li>
     <li>
      卸载并释放：
      <pre><code class="prism language-bash"><span class="token function">umount</span> /resource/app
losetup <span class="token parameter variable">-d</span> /dev/loop0
</code></pre>
     </li>
    </ol>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031333331383031392f:61727469636c652f64657461696c732f313436313630343331" class_="artid" style="display:none">
 </p>
</div>


