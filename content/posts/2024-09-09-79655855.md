---
layout: post
title: "Android-上传图片到阿里云-OSS"
date: 2024-09-09 16:35:17 +0800
description: "本篇博客主要介绍的是将本地图片上传到服务器的方法技巧首先附上阿里云oss官网SDK介绍:点击打开链接"
keywords: "android oss asyncputobject 阿里云 上传图片 permission denied"
categories: ['未分类']
tags: ['无标签']
artid: "79655855"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=79655855
  alt: "Android-上传图片到阿里云-OSS"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=79655855
featuredImagePreview: https://bing.ee123.net/img/rand?artid=79655855
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Android 上传图片到阿里云 OSS
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <span style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">
      本篇博客主要介绍的是将本地图片上传到服务器的方法技巧
     </span>
    </p>
    <p>
     <span style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;">
      <span style="background-color:rgb(255,255,255);">
       首先附上阿里云oss官网SDK介绍:
       <a href="https://help.aliyun.com/document_detail/32042.html?spm=5176.87240.400427.46.DWMjov" rel="nofollow">
        点击打开链接
       </a>
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;">
      附上官方推荐的demo
      <a href="https://github.com/aliyun/aliyun-oss-android-sdk?spm=a2c4g.11186623.2.5.YCteNL">
       点击打开链接
      </a>
     </span>
    </p>
    <p>
     <span style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;">
      在app的build中配置oss :
      <span class="pln" style="color:rgb(0,0,0);font-family:'YaHei Consolas Hybrid', Consolas, 'Meiryo UI', 'Malgun Gothic', 'Segoe UI', 'Trebuchet MS', Helvetica, monospace, monospace;font-size:14px;text-align:left;white-space:pre-wrap;background-color:rgb(238,238,238);">
       <span class="hljs-keyword" style="font-weight:700;">
        compile
       </span>
      </span>
      <span class="str" style="color:rgb(0,136,0);font-family:'YaHei Consolas Hybrid', Consolas, 'Meiryo UI', 'Malgun Gothic', 'Segoe UI', 'Trebuchet MS', Helvetica, monospace, monospace;font-size:14px;text-align:left;white-space:pre-wrap;background-color:rgb(238,238,238);">
       <span class="hljs-string" style="color:rgb(136,0,0);">
        'com.aliyun.dpa:oss-android-sdk:+'
       </span>
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">
      技术相对简单，主要是将这些技术结合起来的例子并不多
     </span>
     <br/>
    </p>
    <p>
     <span style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;">
      <span style="background-color:rgb(255,255,255);">
       首先先初始化oss对象
      </span>
     </span>
    </p>
    <pre><code class="language-java">        // ACCESS_ID,ACCESS_KEY是在阿里云申请的
        OSSCredentialProvider credentialProvider = new OSSPlainTextAKSKCredentialProvider(ACCESS_ID, ACCESS_KEY);
        ClientConfiguration conf = new ClientConfiguration();
        conf.setConnectionTimeout(15 * 1000); // 连接超时，默认15秒
        conf.setSocketTimeout(15 * 1000); // socket超时，默认15秒
        conf.setMaxConcurrentRequest(8); // 最大并发请求数，默认5个
        conf.setMaxErrorRetry(2); // 失败后最大重试次数，默认2次

        // oss为全局变量，OSS_ENDPOINT是一个OSS区域地址
        oss = new OSSClient(getApplicationContext(), OSS_ENDPOINT, credentialProvider, conf);</code></pre>
    <br/>
    <p>
     oss上传图片分为同步和异步
    </p>
    <p>
     同步的方法
    </p>
    <pre><code class="language-java">// 构造上传请求

PutObjectRequest put = new PutObjectRequest("&lt;bucketName&gt;", "&lt;objectKey&gt;", "&lt;uploadFilePath&gt;");
// 文件元信息的设置是可选的
// ObjectMetadata metadata = new ObjectMetadata();
// metadata.setContentType("application/octet-stream"); // 设置 content-type
// metadata.setContentMD5(BinaryUtil.calculateBase64Md5(uploadFilePath)); // 校验 MD5
// put.setMetadata(metadata);
try {
PutObjectResult putResult = oss.putObject(put);
Log.d("PutObject", "UploadSuccess");
Log.d("ETag", putResult.getETag());
Log.d("RequestId", putResult.getRequestId());
} catch (ClientException e) {
// 本地异常如网络异常等
e.printStackTrace();
} catch (ServiceException e) {
// 服务异常
Log.e("RequestId", e.getRequestId());
Log.e("ErrorCode", e.getErrorCode());
Log.e("HostId", e.getHostId());
Log.e("RawMessage", e.getRawMessage());
}</code></pre>
<p>
此处这个 bucketName 是在阿里云平台上配置的 用来储存文件 可以设置私有公有等属性
</p>
<p>
objectKey 为文件的名字 用来从平台上查询图片
</p>
<p>
FilePath 为所选文件的 uri 路径
</p>
<p>
<br/>
</p>
<p>
异步上传的方法
</p>
<pre><code class="language-java">// 构造上传请求
PutObjectRequest put = new PutObjectRequest("&lt;bucketName&gt;", "&lt;objectKey&gt;", "&lt;uploadFilePath&gt;");
// 异步上传时可以设置进度回调
put.setProgressCallback(new OSSProgressCallback&lt;PutObjectRequest&gt;() {
@Override
public void onProgress(PutObjectRequest request, long currentSize, long totalSize) {
Log.d("PutObject", "currentSize: " + currentSize + " totalSize: " + totalSize);
}
});
OSSAsyncTask task = oss.asyncPutObject(put, new OSSCompletedCallback&lt;PutObjectRequest, PutObjectResult&gt;() {
@Override
public void onSuccess(PutObjectRequest request, PutObjectResult result) {
Log.d("PutObject", "UploadSuccess");
Log.d("ETag", result.getETag());
Log.d("RequestId", result.getRequestId());
}
@Override
public void onFailure(PutObjectRequest request, ClientException clientExcepion, ServiceException serviceException) {
// 请求异常
if (clientExcepion != null) {
// 本地异常如网络异常等
clientExcepion.printStackTrace();
}
if (serviceException != null) {
// 服务异常
Log.e("ErrorCode", serviceException.getErrorCode());
Log.e("RequestId", serviceException.getRequestId());
Log.e("HostId", serviceException.getHostId());
Log.e("RawMessage", serviceException.getRawMessage());
}
}
});
// task.cancel(); // 可以取消任务
// task.waitUntilFinished(); // 可以等待任务完成</code></pre>
<p>
一般上传成功时候 客户端需要把文件的 objectkey 传给后台 后台通过拼接然后把图片的 url 返回给我们
</p>

   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f736d616c6c7265647a69:2f61727469636c652f64657461696c732f3739363535383535" class_="artid" style="display:none">
 </p>
</div>
