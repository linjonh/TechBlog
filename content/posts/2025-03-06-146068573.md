---
layout: post
title: "Spring-Boot-缓存最佳实践从基础到生产的完整指南"
date: 2025-03-06 13:54:06 +0800
description: "在现代分布式系统中，缓存是提升系统性能的银弹。Spring Boot 通过 ​ 模块提供了开箱即用的缓存抽象，但如何根据业务需求实现灵活、可靠的缓存方案？本文将带您从零开始，逐步构建符合生产要求的缓存系统。pom.xml 依赖Nacos 配置（application.yml）启动类注解业务层使用二、进阶篇：多缓存引擎支持2.1 缓存类型切换配置选项对比Nacos 配置示例三、生产级特性实现3.1 方法级 TTL 控制实现方式1：语法约定语法约定TTL 解析实现实现方式2：自定义注"
keywords: "Spring Boot 缓存最佳实践：从基础到生产的完整指南"
categories: ['Springboot', 'Java']
tags: ['缓存', '后端', 'Spring', 'Redis', 'Boot']
artid: "146068573"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146068573
    alt: "Spring-Boot-缓存最佳实践从基础到生产的完整指南"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146068573
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146068573
cover: https://bing.ee123.net/img/rand?artid=146068573
image: https://bing.ee123.net/img/rand?artid=146068573
img: https://bing.ee123.net/img/rand?artid=146068573
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Spring Boot 缓存最佳实践：从基础到生产的完整指南
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-github-gist" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d331c2c55df04b2fa1234c91ceceb761.png"/>
    </p>
    <h2>
     <a id="Spring_Boot__2">
     </a>
     Spring Boot 缓存最佳实践：从基础到生产的完整指南
    </h2>
    <hr/>
    <h3>
     <a id="_6">
     </a>
     引言
    </h3>
    <p>
     在现代分布式系统中，缓存是提升系统性能的银弹。Spring Boot 通过
     <code>
      spring-boot-starter-cache
     </code>
     ​ 模块提供了开箱即用的缓存抽象，但如何根据业务需求实现灵活、可靠的缓存方案？本文将带您从零开始，逐步构建符合生产要求的缓存系统。
    </p>
    <hr/>
    <h3>
     <a id="5_12">
     </a>
     一、基础篇：5分钟快速接入
    </h3>
    <h4>
     <a id="11__14">
     </a>
     1.1 最小化配置
    </h4>
    <p>
     <strong>
      pom.xml 依赖
     </strong>
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-cache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     <strong>
      Nacos 配置（application.yml）
     </strong>
    </p>
    <pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> simple <span class="token comment"># 默认内存缓存</span>
</code></pre>
    <p>
     <strong>
      启动类注解
     </strong>
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableCaching</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      业务层使用
     </strong>
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span><span class="token string">"products"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Product</span> <span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 数据库查询逻辑</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_59">
     </a>
     二、进阶篇：多缓存引擎支持
    </h3>
    <h4>
     <a id="21__61">
     </a>
     2.1 缓存类型切换
    </h4>
    <p>
     <strong>
      配置选项对比
     </strong>
    </p>
    <table>
     <thead>
      <tr>
       <th>
        类型
       </th>
       <th>
        依赖
       </th>
       <th>
        适用场景
       </th>
       <th>
        特点
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        ​
        <code>
         simple
        </code>
        ​
       </td>
       <td>
        内置
       </td>
       <td>
        开发测试环境
       </td>
       <td>
        无过期策略
       </td>
      </tr>
      <tr>
       <td>
        ​
        <code>
         caffeine
        </code>
        ​
       </td>
       <td>
        com.github.ben-manes.caffeine
       </td>
       <td>
        高性能本地缓存
       </td>
       <td>
        支持多种过期策略
       </td>
      </tr>
      <tr>
       <td>
        ​
        <code>
         redis
        </code>
        ​
       </td>
       <td>
        spring-boot-starter-data-redis
       </td>
       <td>
        分布式生产环境
       </td>
       <td>
        支持持久化、集群
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     <strong>
      Nacos 配置示例
     </strong>
    </p>
    <pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> redis <span class="token comment"># 切换缓存引擎</span>
    
  <span class="token comment"># Redis 连接配置</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> redis.prod.cluster
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>REDIS_PASSWORD<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_87">
     </a>
     三、生产级特性实现
    </h3>
    <h4>
     <a id="31__TTL__89">
     </a>
     3.1 方法级 TTL 控制
    </h4>
    <h5>
     <a id="1_91">
     </a>
     实现方式1：语法约定
    </h5>
    <p>
     <strong>
      语法约定
     </strong>
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span><span class="token string">"热点数据#600"</span><span class="token punctuation">)</span> <span class="token comment">// 600秒过期</span>
<span class="token keyword">public</span> <span class="token class-name">HotData</span> <span class="token function">getHotData</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 业务逻辑</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      TTL 解析实现
     </strong>
    </p>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CacheConfig</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CacheManagerCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RedisCacheManager</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisCacheCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> manager <span class="token operator">-&gt;</span> manager<span class="token punctuation">.</span><span class="token function">setCacheDecorator</span><span class="token punctuation">(</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> config<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parts <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>parts<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Duration</span> ttl <span class="token operator">=</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RedisCacheWrapper</span><span class="token punctuation">(</span>parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span>ttl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RedisCacheWrapper</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="2AOP_120">
     </a>
     实现方式2：自定义注解+AOP切面
    </h5>
    <ul>
     <li>
      定义自定义注解
     </li>
    </ul>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">CacheCustomTtl</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">long</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 缓存时间（秒）</span>
    <span class="token keyword">long</span> <span class="token function">jitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 抖动范围（秒）</span>
	<span class="token comment">//....自定义其他逻辑</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      aop切面逻辑
     </li>
    </ul>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CacheTtlAspect</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"@annotation(cacheCustomTtl)"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">applyCustomTtl</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> joinPoint<span class="token punctuation">,</span> <span class="token class-name">CacheCustomTtl</span> cacheCustomTtl<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取原始缓存配置</span>
        <span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">MethodSignature</span><span class="token punctuation">)</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Cacheable</span> cacheable <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Cacheable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cacheNames <span class="token operator">=</span> cacheable<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 生成带自定义时间的缓存名称（例如: user#3600）</span>
        <span class="token class-name">String</span> newCacheName <span class="token operator">=</span> cacheNames<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"#"</span> <span class="token operator">+</span> cacheCustomTtl<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> modifiedCacheNames <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>newCacheName<span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 动态修改缓存名称</span>
        <span class="token class-name">Cacheable</span> modifiedCacheable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheableWrapper</span><span class="token punctuation">(</span>cacheable<span class="token punctuation">,</span> modifiedCacheNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">MethodSignature</span><span class="token punctuation">)</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Cacheable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 通过反射调用原方法（需使用动态代理或工具类）</span>
        <span class="token keyword">return</span> joinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 包装类用于动态修改注解属性</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CacheableWrapper</span> <span class="token keyword">implements</span> <span class="token class-name">Cacheable</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Cacheable</span> delegate<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cacheNames<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">CacheableWrapper</span><span class="token punctuation">(</span><span class="token class-name">Cacheable</span> delegate<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cacheNames<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>delegate <span class="token operator">=</span> delegate<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>cacheNames <span class="token operator">=</span> cacheNames<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> cacheNames<span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token comment">// 其他方法委托给原注解...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="32_Jitter_177">
     </a>
     3.2 随机抖动（Jitter）
    </h4>
    <p>
     <strong>
      防雪崩配置
     </strong>
    </p>
    <pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">jitter-range</span><span class="token punctuation">:</span> 60s <span class="token comment"># 最大抖动时间范围</span>
</code></pre>
    <p>
     <strong>
      抖动值生成逻辑
     </strong>
    </p>
    <pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token class-name">Duration</span> <span class="token function">applyJitter</span><span class="token punctuation">(</span><span class="token class-name">Duration</span> ttl<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">long</span> jitter <span class="token operator">=</span> <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextLong</span><span class="token punctuation">(</span>
        spring<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>jitter<span class="token operator">-</span>range<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ttl<span class="token punctuation">.</span><span class="token function">plusSeconds</span><span class="token punctuation">(</span>jitter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_200">
     </a>
     四、高级优化方案
    </h3>
    <h4>
     <a id="41__202">
     </a>
     4.1 多级缓存架构
    </h4>
    <div class="mermaid">
     <svg class="mermaid-svg" height="133" id="mermaid-svg-f749E03keHZeTstg" viewbox="0 0 636.3500366210938 133" width="636.3500366210938" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-f749E03keHZeTstg {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-f749E03keHZeTstg .error-icon{fill:#552222;}#mermaid-svg-f749E03keHZeTstg .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-f749E03keHZeTstg .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-f749E03keHZeTstg .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-f749E03keHZeTstg .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-f749E03keHZeTstg .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-f749E03keHZeTstg .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-f749E03keHZeTstg .marker{fill:#333333;stroke:#333333;}#mermaid-svg-f749E03keHZeTstg .marker.cross{stroke:#333333;}#mermaid-svg-f749E03keHZeTstg svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-f749E03keHZeTstg .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-f749E03keHZeTstg .cluster-label text{fill:#333;}#mermaid-svg-f749E03keHZeTstg .cluster-label span{color:#333;}#mermaid-svg-f749E03keHZeTstg .label text,#mermaid-svg-f749E03keHZeTstg span{fill:#333;color:#333;}#mermaid-svg-f749E03keHZeTstg .node rect,#mermaid-svg-f749E03keHZeTstg .node circle,#mermaid-svg-f749E03keHZeTstg .node ellipse,#mermaid-svg-f749E03keHZeTstg .node polygon,#mermaid-svg-f749E03keHZeTstg .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-f749E03keHZeTstg .node .label{text-align:center;}#mermaid-svg-f749E03keHZeTstg .node.clickable{cursor:pointer;}#mermaid-svg-f749E03keHZeTstg .arrowheadPath{fill:#333333;}#mermaid-svg-f749E03keHZeTstg .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-f749E03keHZeTstg .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-f749E03keHZeTstg .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-f749E03keHZeTstg .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-f749E03keHZeTstg .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-f749E03keHZeTstg .cluster text{fill:#333;}#mermaid-svg-f749E03keHZeTstg .cluster span{color:#333;}#mermaid-svg-f749E03keHZeTstg div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-f749E03keHZeTstg :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
       <g class="output">
        <g class="clusters">
        </g>
        <g class="edgePaths">
         <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;">
          <path class="path" d="M76,59.019999999999996L82.83333333333333,57.51666666666666C89.66666666666667,56.01333333333333,103.33333333333333,53.00666666666666,118.47018678160919,52.9498132183908C133.60704022988506,52.89295977011494,150.21408045977012,55.785919540229884,158.51760057471265,57.232399425287355L166.82112068965517,58.678879310344826" marker-end="url(#arrowhead72)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead72" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-A" id="L-B-A" style="opacity: 1;">
          <path class="path" d="M166.82112068965517,75.32112068965517L158.51760057471265,76.60093390804597C150.21408045977012,77.88074712643679,133.60704022988506,80.44037356321839,118.47018678160919,80.21685344827587C103.33333333333333,79.99333333333334,89.66666666666667,76.98666666666666,82.83333333333333,75.48333333333333L76,73.98" marker-end="url(#arrowhead73)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead73" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-C" id="L-B-C" style="opacity: 1;">
          <path class="path" d="M275.5,67L283.5833333333333,66.91666666666667C291.6666666666667,66.83333333333333,307.8333333333333,66.66666666666667,324.0833333333333,66.58333333333333C340.3333333333333,66.5,356.6666666666667,66.5,364.8333333333333,66.5L373,66.5" marker-end="url(#arrowhead74)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead74" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-C LE-D" id="L-C-D" style="opacity: 1;">
          <path class="path" d="M462.3499984741211,66.5L470.5166651407878,66.5C478.6833318074544,66.5,495.0166651407878,66.5,511.3499984741211,66.5C527.6833318074545,66.5,544.0166651407877,66.5,552.1833318074545,66.5L560.3499984741211,66.5" marker-end="url(#arrowhead75)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead75" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
        </g>
        <g class="edgeLabels">
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-B" id="L-L-A-B">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="translate(117,83)">
          <g class="label" transform="translate(-16,-13)">
           <rect height="26" rx="0" ry="0" width="32">
           </rect>
           <foreignobject height="26" width="32">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-A" id="L-L-B-A">
              命中
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="translate(324,66.5)">
          <g class="label" transform="translate(-24,-13)">
           <rect height="26" rx="0" ry="0" width="48">
           </rect>
           <foreignobject height="26" width="48">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-C" id="L-L-B-C">
              未命中
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="translate(511.3499984741211,66.5)">
          <g class="label" transform="translate(-24,-13)">
           <rect height="26" rx="0" ry="0" width="48">
           </rect>
           <foreignobject height="26" width="48">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-C' L-LE-D" id="L-L-C-D">
              未命中
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
        </g>
        <g class="nodes">
         <g class="node default" id="flowchart-A-40" style="opacity: 1;" transform="translate(42,66.5)">
          <rect class="label-container" height="46" rx="0" ry="0" width="68" x="-34" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-24,-13)">
            <foreignobject height="26" width="48">
             <div style="display: inline-block; white-space: nowrap;">
              业务层
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-B-41" style="opacity: 1;" transform="translate(216.5,66.5)">
          <polygon class="label-container" points="58.5,0 117,-58.5 58.5,-117 0,-58.5" transform="translate(-58.5,58.5)">
          </polygon>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-32,-13)">
            <foreignobject height="26" width="64">
             <div style="display: inline-block; white-space: nowrap;">
              本地缓存
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-C-45" style="opacity: 1;" transform="translate(417.67499923706055,66.5)">
          <rect class="label-container" height="46" rx="0" ry="0" width="89.3499984741211" x="-44.67499923706055" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-34.67499923706055,-13)">
            <foreignobject height="26" width="69.3499984741211">
             <div style="display: inline-block; white-space: nowrap;">
              Redis集群
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-D-47" style="opacity: 1;" transform="translate(594.3499984741211,66.5)">
          <rect class="label-container" height="46" rx="0" ry="0" width="68" x="-34" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-24,-13)">
            <foreignobject height="26" width="48">
             <div style="display: inline-block; white-space: nowrap;">
              数据库
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
       </g>
      </g>
     </svg>
    </div>
    <p>
     <strong>
      实现要点
     </strong>
    </p>
    <ul>
     <li>
      使用 Caffeine 作为一级缓存
     </li>
     <li>
      Redis 作为二级缓存
     </li>
     <li>
      自定义 CacheManager 实现分级策略
     </li>
    </ul>
    <p>
     <a href="https://blog.csdn.net/qq_40896997/article/details/146068785?spm=1001.2014.3001.5502">
      基于Spring Boot的多级缓存架构实现
     </a>
    </p>
    <h4>
     <a id="42__220">
     </a>
     4.2 监控与治理
    </h4>
    <p>
     <strong>
      Spring Boot Actuator 集成
     </strong>
    </p>
    <pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> caches<span class="token punctuation">,</span>health<span class="token punctuation">,</span>metrics
</code></pre>
    <p>
     <strong>
      关键监控指标
     </strong>
    </p>
    <ul>
     <li>
      ​
      <code>
       cache.gets
      </code>
      ​：缓存查询次数
     </li>
     <li>
      ​
      <code>
       cache.puts
      </code>
      ​：缓存写入次数
     </li>
     <li>
      ​
      <code>
       cache.removals
      </code>
      ​：缓存清除次数
     </li>
     <li>
      ​
      <code>
       cache.evictions
      </code>
      ​：缓存淘汰次数
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_241">
     </a>
     五、最佳实践总结
    </h3>
    <h4>
     <a id="51__243">
     </a>
     5.1 配置推荐
    </h4>
    <pre><code class="prism language-yaml"><span class="token comment"># 生产环境推荐配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">jitter-range</span><span class="token punctuation">:</span> 30s
    <span class="token key atrule">key-separator</span><span class="token punctuation">:</span> <span class="token string">"::"</span>
    
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">20</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">10</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">5</span>
</code></pre>
    <h4>
     <a id="52__261">
     </a>
     5.2 避坑指南
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        键设计原则
       </strong>
      </p>
      <ul>
       <li>
        使用业务语义明确的键命名（如
        <code>
         user:profile:{userId}
        </code>
        ​）
       </li>
       <li>
        避免使用可变对象作为键
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        缓存穿透防护
       </strong>
      </p>
      <pre><code class="prism language-java"><span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"users"</span><span class="token punctuation">,</span> unless <span class="token operator">=</span> <span class="token string">"#result == null"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 返回null时自动跳过缓存</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        版本兼容策略
       </strong>
      </p>
      <pre><code class="prism language-java"><span class="token annotation punctuation">@CachePut</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"products#3600"</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">"#product.id"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Product</span> <span class="token function">updateProduct</span><span class="token punctuation">(</span><span class="token class-name">Product</span> product<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 更新后自动刷新缓存</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="_286">
     </a>
     最后
    </h3>
    <p>
     根据业务场景灵活选择适合的缓存策略，从简单的内存缓存到复杂的分布式缓存体系，Spring Boot 的缓存抽象层始终提供一致的使用体验。记住：没有完美的缓存方案，只有最适合业务场景的缓存策略。
    </p>
    <p>
     ‍
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34303839363939372f:61727469636c652f64657461696c732f313436303638353733" class_="artid" style="display:none">
 </p>
</div>


