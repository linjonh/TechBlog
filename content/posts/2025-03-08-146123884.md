---
layout: post
title: "Django系列教程4实例项目任务管理小应用"
date: 2025-03-08 22:14:52 +0800
description: "本例中我们只讲述核心逻辑，不浪费时间在前端样式上。"
keywords: "Django系列教程（4）——实例项目任务管理小应用"
categories: ['Django']
tags: ['Django']
artid: "146123884"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146123884
    alt: "Django系列教程4实例项目任务管理小应用"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146123884
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146123884
cover: https://bing.ee123.net/img/rand?artid=146123884
image: https://bing.ee123.net/img/rand?artid=146123884
img: https://bing.ee123.net/img/rand?artid=146123884
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Django系列教程（4）——实例项目任务管理小应用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <hr id="hr-toc" name="tableOfContents"/>
    <p>
    </p>
    <p>
     本例中我们只讲述核心逻辑，不浪费时间在前端样式上。文末有GitHub源码地址，里面同时包含了函数视图和基于类的视图, 具体演示效果如下所示：
    </p>
    <p style="text-align:center">
     <img alt="" src="https://i-blog.csdnimg.cn/direct/4a01d1b2360242db8069023c4f105bf3.gif"/>
    </p>
    <p>
    </p>
    <h3 id="第一步创建tasks应用加入installed_apps" name="第一步创建tasks应用加入installed_apps">
     第一步：创建tasks应用，加入INSTALLED_APPS
    </h3>
    <p>
     本例假设你已经有了一个
     <code>
      mysite
     </code>
     的Django项目。我们首先使用
     <code>
      python manage.py startapp tasks
     </code>
     创建一个名为”tasks”的app，并把它计入到
     <code>
      settings.py
     </code>
     的INSTALLED_APPS中去。
    </p>
    <pre><code># mysite/settings.py
INSTALLED_APPS = [
     'django.contrib.admin',
     'django.contrib.auth',
     'django.contrib.contenttypes',
     'django.contrib.sessions',
     'django.contrib.messages',
     'django.contrib.staticfiles',
     'tasks',
 ]
</code></pre>
    <p>
     然后把app下的urls路径添加到项目文件夹的urls.py里去。
    </p>
    <pre><code> from django.contrib import admin
 from django.urls import path, include

 urlpatterns = [
     path('admin/', admin.site.urls),
     path('tasks/', include('tasks.urls'))
 ]
</code></pre>
    <h3 id="第二步创建task模型及其关联表单" name="第二步创建task模型及其关联表单">
     第二步：创建Task模型及其关联表单
    </h3>
    <p>
     我们的Task模型非常简单，仅包含name和status两个字段。我们还使用ModelForm类创建了TaskForm，我们在创建任务或更新任务时需要用到这个表单。
    </p>
    <pre><code># tasks/models.py
 from django.db import models

 class Status(models.TextChoices):
     UNSTARTED = 'u', "Not started yet"
     ONGOING = 'o', "Ongoing"
     FINISHED = 'f', "Finished"


 class Task(models.Model):
     name = models.CharField(verbose_name="Task name", max_length=65, unique=True)
     status = models.CharField(verbose_name="Task status", max_length=1, choices=Status.choices)

     def __str__(self):
         return self.name

 # tasks/forms.py
 from .models import Task
 from django import forms

 class TaskForm(forms.ModelForm):

     class Meta:
         model = Task
         fields = "__all__"
</code></pre>
    <h3 id="第三步编写路由urlconf及视图" name="第三步编写路由urlconf及视图">
     第三步：编写路由URLConf及视图
    </h3>
    <p>
     我们需要创建5个urls, 对应5个函数视图。这是因为对于Retrieve操作，我们需要编写两个函数视图，一个用户获取任务列表，一个用于获取任务详情。对于
     <code>
      task_detail
     </code>
     ,
     <code>
      task_update
     </code>
     和
     <code>
      task_delete
     </code>
     这个三个视图函数，我们还需要通过urls传递任务id或pk参数，否则它们不知道对哪个对象进行操作。
    </p>
    <pre><code># tasks/urls.py
 from django.urls import path, re_path
 from . import views

 # namespace
 app_name = 'tasks'

 urlpatterns = [
     # Create a task
     path('create/', views.task_create, name='task_create'),

     # Retrieve task list
     path('', views.task_list, name='task_list'),

     # Retrieve single task object
     re_path(r'^(?P&lt;pk&gt;\d+)/$', views.task_detail, name='task_detail'),

     # Update a task
     re_path(r'^(?P&lt;pk&gt;\d+)/update/$', views.task_update, name='task_update'),

     # Delete a task
     re_path(r'^(?P&lt;pk&gt;\d+)/delete/$', views.task_delete, name='task_delete'),
 ]
</code></pre>
    <p>
     下面5个函数视图代码是本应用的核心代码，请仔细阅读并去尝试理解每一行代码。
    </p>
    <pre><code># tasks/views.py

 from django.shortcuts import render, redirect, get_object_or_404
 from django.urls import reverse
 from .models import Task
 from .forms import TaskForm
 
 # Create a task
 def task_create(request):
     # 如果用户通过POST提交，通过request.POST获取提交数据
     if request.method == "POST":
         # 将用户提交数据与TaskForm表单绑定
         form = TaskForm(request.POST)
         # 表单验证，如果表单有效，将数据存入数据库
         if form.is_valid():
             form.save()
             # 跳转到任务清单
             return redirect(reverse("tasks:task_list"))
     else:
         # 否则空表单
         form = TaskForm()
     return render(request, "tasks/task_form.html", { "form": form, })

 # Retrieve task list
 def task_list(request):
     # 从数据库获取任务清单
     tasks = Task.objects.all()
     # 指定渲染模板并传递数据
     return render(request, "tasks/task_list.html", { "tasks": tasks,})

 # Retrieve a single task
 def task_detail(request, pk):
     # 从url里获取单个任务的pk值，然后查询数据库获得单个对象
     task = get_object_or_404(Task, pk=pk)
     return render(request, "tasks/task_detail.html", { "task": task, })

 # Update a single task
 def task_update(request, pk):
     # 从url里获取单个任务的pk值，然后查询数据库获得单个对象实例
     task_obj = get_object_or_404(Task, pk=pk)
     if request.method == 'POST':
         form = TaskForm(instance=task_obj, data=request.POST)
         if form.is_valid():
             form.save()
             return redirect(reverse("tasks:task_detail", args=[pk,]))
     else:
         form = TaskForm(instance=task_obj)
     return render(request, "tasks/task_form.html", { "form": form, "object": task_obj})


 # Delete a single task
 def task_delete(request, pk):
     # 从url里获取单个任务的pk值，然后查询数据库获得单个对象
     task_obj = get_object_or_404(Task, pk=pk)
     task_obj.delete() # 删除然后跳转
     return redirect(reverse("tasks:task_list"))
</code></pre>
    <h3 id="第四步编写模板" name="第四步编写模板">
     第四步：编写模板
    </h3>
    <p>
     虽然我们有5个urls，但我们只需要创建3个模板:
     <code>
      task_list.html
     </code>
     ,
     <code>
      task_detail.html
     </code>
     和
     <code>
      task_form.html。
     </code>
     最后一个模板由
     <code>
      task_create
     </code>
     和
     <code>
      task_update
     </code>
     视图函数共享。我们在模板中对实例对象进行判断，如果对象已存在则模板对于更新任务，否则是创建任务。task_delete视图不需要模板。
    </p>
    <pre><code>
 # tasks/templates/tasks/task_list.html
 &lt;!DOCTYPE html&gt;
 &lt;html lang="en"&gt;
 &lt;head&gt;
     &lt;meta charset="UTF-8"&gt;
     &lt;title&gt;Task List&lt;/title&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;h3&gt;Task List&lt;/h3&gt;
 {% for task in tasks %}
     &lt;p&gt;{<!-- -->{ forloop.counter }}. {<!-- -->{ task.name }} - {<!-- -->{ task.get_status_display }}
         (&lt;a href="{% url 'tasks:task_update' task.id %}"&gt;Update&lt;/a&gt; |
         &lt;a href="{% url 'tasks:task_delete' task.id %}"&gt;Delete&lt;/a&gt;)
     &lt;/p&gt;
 {% endfor %}
 &lt;p&gt; &lt;a href="{% url 'tasks:task_create' %}"&gt; + Add A New Task&lt;/a&gt;&lt;/p&gt;
 &lt;/body&gt;
 &lt;/html&gt;


 # tasks/templates/tasks/task_detail.html
 &lt;!DOCTYPE html&gt;
 &lt;html lang="en"&gt;
 &lt;head&gt;
     &lt;meta charset="UTF-8"&gt;
     &lt;title&gt;Task Detail&lt;/title&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;p&gt; Task Name: {<!-- -->{ task.name }} | &lt;a href="{% url 'tasks:task_update' task.id %}"&gt;Update&lt;/a&gt; |
     &lt;a href="{% url 'tasks:task_delete' task.id %}"&gt;Delete&lt;/a&gt;
 &lt;/p&gt;
 &lt;p&gt; Task Status: {<!-- -->{ task.get_status_display }} &lt;/p&gt;
 &lt;p&gt; &lt;a href="{% url 'tasks:task_list' %}"&gt;View All Tasks&lt;/a&gt; |
     &lt;a href="{% url 'tasks:task_create'%}"&gt;New Task&lt;/a&gt;
 &lt;/p&gt;
 &lt;/body&gt;
 &lt;/html&gt;


 # tasks/templates/tasks/task_form.html
 &lt;!DOCTYPE html&gt;
 &lt;html lang="en"&gt;
 &lt;head&gt;
     &lt;meta charset="UTF-8"&gt;
     &lt;title&gt;{% if object %}Edit Task {% else %} Create New Task {% endif %}&lt;/title&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;h3&gt;{% if object %}Edit Task {% else %} Create New Task {% endif %}&lt;/h3&gt;
     &lt;form action="" method="post" enctype="multipart/form-data"&gt;
         {% csrf_token %}
         {<!-- -->{ form.as_p }}
         &lt;p&gt;&lt;input type="submit" class="btn btn-success" value="Submit"&gt;&lt;/p&gt;
     &lt;/form&gt;
 &lt;/body&gt;
 &lt;/html&gt; 

</code></pre>
    <h3 id="第五步运行项目查看效果" name="第五步运行项目查看效果">
     第五步：运行项目，查看效果
    </h3>
    <p>
     运行如下命令，访问http://127.0.0.1:8000/tasks/就应该看到文初效果了。
    </p>
    <pre><code> python manage.py makemigrations
 python manage.py migrate
 python manage.py runserver
</code></pre>
    <h3 id="github源码地址" name="github源码地址">
     GitHub源码地址
    </h3>
    <p>
     本项目源码地址，里面同时包含了函数视图和基于类的视图。
    </p>
    <h3 id="小结" name="小结">
     小结
    </h3>
    <p>
     本例中我们使用了函数视图(functional-based views, FBV)编写了一个任务管理的CRUD小应用，后面我们将使用基于类的视图(class-based views, CBV)重写本例演示代码。
    </p>
    <p>
     接下来几章我们将详细介绍模型、视图、URL的配置以及模板的基础知识，欢迎关注。
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f68656c75646f6974312f:61727469636c652f64657461696c732f313436313233383834" class_="artid" style="display:none">
 </p>
</div>


