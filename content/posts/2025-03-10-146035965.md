---
layout: post
title: "QQuick3D-Camera的介绍"
date: 2025-03-10 21:30:40 +0800
description: "Camera类继承于 Node；Camera定义了怎样将一个3D场景（Scene）投影到2D的表面上；一个场景至少需要一个Camera来可视化其内容。Camera 可以像场景中任何节点一样，被定位和旋转；Camera节点的位置和方向决定了Camera在场景中的位置及其朝向;Camera的默认方向是，其前向矢量指向负Z轴，其上向矢量指向正Y轴。QQuick3D提供以下几种类型相机：** PerspectiveCamera**：透视投影相机，具有近大远小特点。"
keywords: "QQuick3D-Camera的介绍"
categories: ['Qml']
tags: ['Qt']
artid: "146035965"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146035965
    alt: "QQuick3D-Camera的介绍"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146035965
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146035965
cover: https://bing.ee123.net/img/rand?artid=146035965
image: https://bing.ee123.net/img/rand?artid=146035965
img: https://bing.ee123.net/img/rand?artid=146035965
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     QQuick3D-Camera的介绍
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="QQuick3DCamera_0">
     </a>
     QQuick3D-Camera的介绍
    </h2>
    <h3>
     <a id="Camera_2">
     </a>
     Camera的概述
    </h3>
    <ol>
     <li>
      <p>
       Camera类继承于 Node；Camera定义了怎样将一个3D场景（Scene）投影到2D的表面上；一个场景至少需要一个Camera来可视化其内容。
      </p>
     </li>
     <li>
      <p>
       Camera 可以像场景中任何节点一样，被定位和旋转；Camera节点的位置和方向决定了Camera在场景中的位置及其朝向;Camera的默认方向是，其前向矢量指向负Z轴，其上向矢量指向正Y轴。
      </p>
     </li>
     <li>
      <p>
       QQuick3D提供以下几种类型相机：
       <br/>
       ** PerspectiveCamera**：透视投影相机，具有近大远小特点
       <br/>
       <strong>
        OrthographicCamera
       </strong>
       ：正交投影相机，提供了一种平截头体线条平行的相机，使物体的感知比例不受其与相机距离的影响。这种相机的典型用例是CAD（计算机辅助设计）应用程序和制图
       <br/>
       <strong>
        FrustumCamera
       </strong>
       ：
       <br/>
       <strong>
        CustomCamera
       </strong>
       : 自定义相机，由用户自定义 投影矩阵
      </p>
     </li>
     <li>
      <p>
       属性
       <strong>
        frustumCullingEnabled : bool
       </strong>
       ：当此属性为真时，相机平截头体之外的对象将被剔除，这意味着它们不会传递给渲染器。默认情况下，此属性设置为false。对于所有或大多数对象都在相机平截头体内的场景，平截头体剔除是一种不必要的性能开销。但对于大部分位于相机视野之外的复杂场景，启用平截头体剔除可能会提高性能
      </p>
     </li>
     <li>
      <p>
       属性
       <strong>
        lookAtNode : Node
       </strong>
       : Node 非空时，当lookAtNode 观察节点位置发生变化时，相机的位置会跟随发生变化；默认值为null
      </p>
     </li>
     <li>
      <p>
       方法
       <strong>
        vector3d lookAt(vector3d scenePos)
       </strong>
       ：设置摄影机的旋转值，使其指向scenePos
      </p>
     </li>
     <li>
      <p>
       方法
       <strong>
        vector3d lookAt(QtQuick3D::Node node)
       </strong>
       ：设置摄影机的旋转值，使其指向节点
      </p>
     </li>
     <li>
      <p>
       方法
       <strong>
        vector3d mapFromViewport(vector3d viewportPos)
       </strong>
       ：将viewportPos从视口空间（viewPort Space）（2D）转换为全局场景空间（3D）。viewportPos的x和y值必须归一化，视口的左上角为[0,0]，右下角为[1,1]。z值被解释为距截头体近剪裁平面的距离（clipNear）。如果viewportPos无法成功映射到场景中的某个位置，则返回[0,0,0]的位置。
      </p>
     </li>
     <li>
      <p>
       方法
       <strong>
        vector3d mapToViewport(vector3d scenePos)
       </strong>
       ：将scenePos从全局场景空间（3D）转换到视口空间（2D）。返回的位置被归一化，视口的左上角为[0,0]，右下角为[1,1]。返回的z值将包含从截头体的近剪裁平面（clipANear）到场景坐标中scenePos的距离。如果距离为负，则该点位于相机后面。如果scenePos无法成功映射到视口中的某个位置，则返回[0,0,0]的位置
      </p>
     </li>
    </ol>
    <h4>
     <a id="Camera_19">
     </a>
     Camera的实例代码
    </h4>
    <p>
     注意 代码中 “teapot.mesh” 这个网格，Qt 官方实例中有提供。
    </p>
    <pre><code class="prism language-c">import QtQuick
import QtQuick<span class="token punctuation">.</span>Controls
import QtQuick<span class="token punctuation">.</span>Layouts
import QtQuick3D


<span class="token comment">//摄像机Demo</span>
Item <span class="token punctuation">{<!-- --></span>
    id<span class="token operator">:</span> root

    <span class="token comment">//场景需要 Model(mesh + Material)，  Light, Camera, 3个元素</span>
    Node<span class="token punctuation">{<!-- --></span>
        id<span class="token operator">:</span> rootSceneNode                   <span class="token comment">//3D场景的根节点</span>

        <span class="token comment">//平行光: 光源从无线远地方发射，类似于生活中太阳；平行光具有无限的范围，不会衰减；如果启用castsShadow，阴影将平行于灯光方向;</span>
        <span class="token comment">//平行光实际上没有位置，因此移动它没有任何效果。光将始终沿光的Z轴方向发射。沿X或Y轴旋转灯光将改变发光方向。</span>
        DirectionalLight <span class="token punctuation">{<!-- --></span>
            ambientColor<span class="token operator">:</span> Qt<span class="token punctuation">.</span><span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span>
            brightness<span class="token operator">:</span> <span class="token number">1.0</span>
            eulerRotation<span class="token punctuation">.</span>x<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">25</span>
        <span class="token punctuation">}</span>

        Model <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//Model 需要网格 + 材质</span>
            source<span class="token operator">:</span> <span class="token string">"qrc:/qt/qml/text/3DDemo/teapot.mesh"</span>
            y<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">100</span>
            scale<span class="token operator">:</span> Qt<span class="token punctuation">.</span><span class="token function">vector3d</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
            materials<span class="token operator">:</span> <span class="token punctuation">[</span>
                PrincipledMaterial <span class="token punctuation">{<!-- --></span>
                    baseColor<span class="token operator">:</span> <span class="token string">"#41cd52"</span>
                    metalness<span class="token operator">:</span> <span class="token number">0.0</span>
                    roughness<span class="token operator">:</span> <span class="token number">0.1</span>
                    opacity<span class="token operator">:</span> <span class="token number">1.0</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>

            <span class="token comment">//沿着Y轴旋转，在xz所在平台旋转</span>
            <span class="token comment">// PropertyAnimation on eulerRotation.y {<!-- --></span>
            <span class="token comment">//     loops: Animation.Infinite</span>
            <span class="token comment">//     duration: 5000</span>
            <span class="token comment">//     to: 0</span>
            <span class="token comment">//     from: -360</span>
            <span class="token comment">// }</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//</span>
        Node <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//使用节点给摄像机设置动画。</span>
            <span class="token comment">//Camera 做为Node 的子节点，可以通过Node节点的属性来定义相机的位置、旋转 之类属性；也会继承父节点的变换</span>
            <span class="token comment">//透视投影:主要涉及 近平面(clipNear)，远平面(clipFar)，视野角(fiedOfView)</span>
            id<span class="token operator">:</span> idCamPNode
            PerspectiveCamera <span class="token punctuation">{<!-- --></span>
                id<span class="token operator">:</span> cameraPerspectiveOne
                z<span class="token operator">:</span> <span class="token number">600</span>

                <span class="token comment">// onSceneRotationChanged: {<!-- --></span>
                <span class="token comment">//     console.log("onSceneRotationChanged = ",cameraPerspectiveOne.sceneRotation);</span>
                <span class="token comment">// }</span>

                <span class="token comment">// onScenePositionChanged: {<!-- --></span>
                <span class="token comment">//     console.log("onScenePositionChanged = ",cameraPerspectiveOne.scenePosition);</span>
                <span class="token comment">// }</span>

                <span class="token comment">// onSceneTransformChanged: {<!-- --></span>
                <span class="token comment">//     console.log("onSceneTransformChanged");</span>
                <span class="token comment">// }</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//</span>
            PropertyAnimation on eulerRotation<span class="token punctuation">.</span>y <span class="token punctuation">{<!-- --></span>
                loops<span class="token operator">:</span> Animation<span class="token punctuation">.</span>Infinite
                duration<span class="token operator">:</span> <span class="token number">5000</span>
                to<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">360</span>
                from<span class="token operator">:</span> <span class="token number">0</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    View3D<span class="token punctuation">{<!-- --></span>
        id<span class="token operator">:</span>idView3D
        anchors<span class="token punctuation">.</span>fill<span class="token operator">:</span> parent
        importScene<span class="token operator">:</span> rootSceneNode
        camera<span class="token operator">:</span> cameraPerspectiveOne


        MouseArea<span class="token punctuation">{<!-- --></span>
            anchors<span class="token punctuation">.</span>fill<span class="token operator">:</span> parent
            onClicked<span class="token operator">:</span><span class="token punctuation">(</span>mouse<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
              var viewPos <span class="token operator">=</span> Qt<span class="token punctuation">.</span><span class="token function">vector3d</span><span class="token punctuation">(</span>mouse<span class="token punctuation">.</span>x <span class="token operator">/</span>parent<span class="token punctuation">.</span>width<span class="token punctuation">,</span>mouse<span class="token punctuation">.</span>y<span class="token operator">/</span>parent<span class="token punctuation">.</span>height<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//同样的viewPos 因为Camera的位置在变化，造成映射到scene中值不一致</span>
              var scenePos <span class="token operator">=</span> cameraPerspectiveOne<span class="token punctuation">.</span><span class="token function">mapFromViewport</span><span class="token punctuation">(</span>viewPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"scenePos = "</span><span class="token punctuation">,</span>scenePos<span class="token punctuation">,</span> <span class="token string">" viewPos = "</span><span class="token punctuation">,</span>mouse<span class="token punctuation">.</span>x<span class="token punctuation">,</span>mouse<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031333132353130352f:61727469636c652f64657461696c732f313436303335393635" class_="artid" style="display:none">
 </p>
</div>


