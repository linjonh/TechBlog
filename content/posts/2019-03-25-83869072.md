---
layout: post
title: "微信小程序小程序之模板消息"
date: 2019-03-25 20:20:06 +0800
description: "在移动应用中，APP经常通过推送的方式将一些消息发送到用户的手机上。小程序基于微信内，为我们提供了一"
keywords: "小程序消息模板"
categories: ['微信小程序']
tags: ['微信小程序消息', '微信小程序模板消息', '微信小程序模板', '微信小程序服务通知']
artid: "83869072"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=83869072
    alt: "微信小程序小程序之模板消息"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=83869072
featuredImagePreview: https://bing.ee123.net/img/rand?artid=83869072
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【微信小程序】小程序之模板消息
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_2">
     </a>
     前言
    </h2>
    <br/>
    <p>
     在移动应用中，
     <code>
      App
     </code>
     经常通过推送的方式将一些消息发送到用户的手机上。小程序基于微信内，为我们提供了一整套的模板消息，使微信和小程序这个体系达到服务闭环的效果。
    </p>
    <br/>
    <p>
     <strong>
      一、消息模板在微信中显示
     </strong>
    </p>
    <p>
     1、服务通知:微信内消息模板推送的位置。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/09885eba7d214948a8ade345be9d3490.png"/>
    </p>
    <p>
     2、服务通知进入显示
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e5431ecd8b13439f85bed98a21ec0098.png"/>
    </p>
    <p>
     <strong>
      3、进入小程序查看
     </strong>
    </p>
    <p>
     可以跳转到小程序中指定的页面，这里需要在消息模板的参数中做配置，后面会说到。
    </p>
    <br/>
    <p>
     <strong>
      二、消息模板接入步骤
     </strong>
    </p>
    <p>
     直接按图操作，搜索到适合自己的小程序模板。如果没有的话点击申请，新增的小程序模板会有3-7天的审核时间。选择或者申请完成后，模板
     <code>
      ID
     </code>
     在接下来的开发中会使用到。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/69ebce9f1cfcc3eeebe29c16420e4d63.jpeg"/>
    </p>
    <br/>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4e22b243fef1dc83dcf27bd80c9ae7dd.jpeg"/>
    </p>
    <br/>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/81161c7ffa8890d60da3d7e06018b58d.jpeg"/>
    </p>
    <br/>
    <p>
     <strong>
      三、功能实现
     </strong>
    </p>
    <p>
     <strong>
      <a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/template-message/sendTemplateMessage.html" rel="nofollow">
       小程序消息发送官方文档地址
      </a>
     </strong>
    </p>
    <p>
     发送模板消息需要的参数，我选择的是将所需要的参数获取到，通过接口发送给后台，后台哥们去调用微信接口发送模板消息。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4c1a3e219cc20d230e64a8946f4b33db.jpeg"/>
    </p>
    <p>
     <strong>
      前端部分:
     </strong>
    </p>
    <p>
     参数1：
     <code>
      access_token
     </code>
     ，
     <code>
      touser
     </code>
     （
     <code>
      openid
     </code>
     ）
    </p>
    <p>
     这两个参数由后台获取，前端不做任何操作。
     <br/>
     <br/>
    </p>
    <p>
     参数2：
     <code>
      formId
     </code>
    </p>
    <p>
     <strong>
      注意：
     </strong>
    </p>
    <p>
     ①、在开发者工具中，同样的操作是无法获取到
     <code>
      formid
     </code>
     的，只有真机上才行。
     <br/>
     ②、通过对应的
     <code>
      errcode
     </code>
     找原因。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/bd7d78382622f63e141ed20dac3e86f0.png"/>
    </p>
    <p>
     <strong>
      前端页面代码部分：
     </strong>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d0992bb08dd2c437f3b95d3a9889f474.jpeg"/>
    </p>
    <p>
     通过表单标签以及给
     <code>
      button
     </code>
     设置表单类型来获取，当前用户的
     <code>
      formId
     </code>
    </p>
    <pre><code class="prism language-xml">
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">bindsubmit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>getFormId<span class="token punctuation">'</span></span> <span class="token attr-name">report-submit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>submit-btn<span class="token punctuation">'</span></span> <span class="token attr-name">form-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>submit<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
 
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/24e4f2b5806cb7401ca8f3ae9401a701.jpeg"/>
    </p>
    <p>
     这里获取到
     <code>
      formId
     </code>
     后，把数据发送到后台，后台通过
     <code>
      sendTemplateMessage
     </code>
     来进行模板消息的发送。
    </p>
    <pre><code class="prism language-javascript">
 <span class="token comment">//获取formId</span>
 <span class="token function-variable function">getFormId</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token comment">// 获取formid</span>
    <span class="token keyword">var</span> formId <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>formId<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pushReviews</span><span class="token punctuation">(</span>formId<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">//调用接口，把要推送的用户信息发送给后端</span>
  <span class="token function-variable function">pushReviews</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">formId</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//圈子id</span>
    params<span class="token punctuation">.</span>actId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>actId
    <span class="token comment">//被推送者id，当前登录用户</span>
    params<span class="token punctuation">.</span>toid <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'userId'</span><span class="token punctuation">)</span>
    <span class="token comment">//表单formid</span>
    params<span class="token punctuation">.</span>formId <span class="token operator">=</span> formId
    <span class="token comment">//模板id 上述申请模板id</span>
    params<span class="token punctuation">.</span>templateId <span class="token operator">=</span> <span class="token string">'56tvW0hUj1FxxxxYYYzzzzPWW2rf_Oo9M'</span>
    <span class="token comment">//卡片进入小程序路径</span>
    params<span class="token punctuation">.</span>page <span class="token operator">=</span> <span class="token string">'pages/xxxx/share-page/share-page?shareUserId='</span> <span class="token operator">+</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'userId'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&amp;actId="</span> <span class="token operator">+</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>actId
    <span class="token comment">//点评内容</span>
    params<span class="token punctuation">.</span>data <span class="token operator">=</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>dynamicComment<span class="token punctuation">.</span>content
    params<span class="token punctuation">.</span>emphasisKeyword <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token comment">//接口地址</span>
    <span class="token keyword">var</span> dataUrl <span class="token operator">=</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>laiSignBaseUrl <span class="token operator">+</span> <span class="token string">"xxxxxx/yyyyyy/push"</span>
    utils<span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">(</span>
      dataUrl<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
        params<span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
</code></pre>
    <br/>
    <h2>
     <a id="_141">
     </a>
     总结
    </h2>
    <p>
     ~~
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f71715f3137343730313635:2f61727469636c652f64657461696c732f3833383639303732" class_="artid" style="display:none">
 </p>
</div>


