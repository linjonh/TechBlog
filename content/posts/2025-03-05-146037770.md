---
layout: post
title: "AI实践基于TensorFlowKeras的CNN卷积神经网络简单实现手写数字识别的工程实践"
date: 2025-03-05 13:26:28 +0800
description: "本实现仅用35行核心代码完成端到端的CNN训练与验证，准确率达98%+。通过模块化设计、日志增强和可视化组件，展现了工业级代码的雏形。读者可在此基础上扩展更复杂的网络结构或部署功能。"
keywords: "cnn模型编程"
categories: ['人工智能']
tags: ['简单Cnn实现', '局部特征提取', '图像识别', '卷积神经网络', '人工智能', 'Tensorflow', 'Keras']
artid: "146037770"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146037770
    alt: "AI实践基于TensorFlowKeras的CNN卷积神经网络简单实现手写数字识别的工程实践"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146037770
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146037770
cover: https://bing.ee123.net/img/rand?artid=146037770
image: https://bing.ee123.net/img/rand?artid=146037770
img: https://bing.ee123.net/img/rand?artid=146037770
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【AI实践】基于TensorFlow/Keras的CNN（卷积神经网络）简单实现：手写数字识别的工程实践
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     深度神经网络系列文章
    </h3>
    <ul>
     <li>
      <a href="https://arbboter.blog.csdn.net/article/details/146044605" rel="nofollow">
       【AI深度学习网络】卷积神经网络（CNN）入门指南：从生物启发的原理到现代架构演进
      </a>
     </li>
     <li>
      <a href="https://arbboter.blog.csdn.net/article/details/146037770" rel="nofollow">
       【AI实践】基于TensorFlow/Keras的CNN（卷积神经网络）简单实现：手写数字识别的工程实践
      </a>
     </li>
    </ul>
    <h3>
     <a id="_4">
     </a>
     引言
    </h3>
    <p>
     在深度学习的广阔天地中，卷积神经网络（CNN）是计算机视觉领域的经典模型，卷积神经网络（CNN）凭借其强大的特征提取能力，成为了图像识别领域的中流砥柱。今天，就带大家深入剖析一个基于TensorFlow/Keras实现的简单CNN模型，看看它是如何在手写数字识别任务（MNIST数据集）中大显身手的。
    </p>
    <p>
     本文以MNIST手写数字识别任务为例，演示如何通过TensorFlow/Keras工程化实现一个轻量级CNN，代码包含完整的数据处理、模型训练与推理流程，并特别注重实际开发中的可维护性设计。
    </p>
    <h3>
     <a id="_9">
     </a>
     一、环境与工具
    </h3>
    <p>
     好的工程始于好的框架。在这个项目中，我们使用Python作为编程语言，借助TensorFlow/Keras库来构建CNN模型。
    </p>
    <p>
     <strong>
      环境与工具
     </strong>
    </p>
    <ul>
     <li>
      Python 3.8+
     </li>
     <li>
      TensorFlow 2.10+
     </li>
     <li>
      Matplotlib（可视化支持）
     </li>
    </ul>
    <p>
     为了使整个工程结构清晰、易于维护，我们将代码划分为多个功能模块。
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras <span class="token keyword">import</span> layers<span class="token punctuation">,</span> models
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> builtins
<span class="token keyword">import</span> datetime
</code></pre>
    <p>
     以上是项目的基本信息和依赖库的导入。
    </p>
    <h3>
     <a id="_28">
     </a>
     二、数据预处理
    </h3>
    <p>
     数据是模型的粮食，高质量的数据预处理是模型成功的关键。MNIST数据集是一个经典的手写数字数据集，包含了60000张训练图像和10000张测试图像，每张图像的大小为28x28像素。
    </p>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    主函数
    :return:
    """</span>
    <span class="token comment"># 1. 加载并预处理数据</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'加载并预处理数据'</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span>train_images<span class="token punctuation">,</span> train_labels<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>test_images<span class="token punctuation">,</span> test_labels<span class="token punctuation">)</span> <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>mnist<span class="token punctuation">.</span>load_data<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 归一化并调整形状（添加通道维度）</span>
    train_images <span class="token operator">=</span> train_images<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">60000</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">255</span>
    test_images <span class="token operator">=</span> test_images<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">255</span>

    <span class="token comment"># 转换标签为one-hot编码</span>
    train_labels <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>to_categorical<span class="token punctuation">(</span>train_labels<span class="token punctuation">)</span>
    test_labels <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>to_categorical<span class="token punctuation">(</span>test_labels<span class="token punctuation">)</span>
</code></pre>
    <p>
     在这里，我们首先加载了MNIST数据集，并对图像数据进行了归一化处理，将像素值从0-255的范围缩放到0-1之间。这样做的目的是为了加速模型的收敛。同时，我们还调整了图像的形状，添加了一个通道维度，以满足CNN模型的输入要求。对于标签数据，我们将其转换为one-hot编码格式，以便于模型的分类任务。
    </p>
    <p>
     MNIST加载的数据集的
     <code>
      train_images
     </code>
     为60000张像素大小为28x28，内容如下：
     <br/>
     <img alt="MNIST数据集" src="https://i-blog.csdnimg.cn/direct/120a43e780ac4fbcb8c083ddc5594113.png"/>
    </p>
    <p>
     其中
     <code>
      to_categorical
     </code>
     用于将
     <strong>
      整数类别标签
     </strong>
     转换为
     <strong>
      one-hot 编码
     </strong>
     ，而
     <code>
      one-hot
     </code>
     编码是一种方便计算机处理的二元编码，适用于多分类任务中标签的格式化处理。
    </p>
    <ul>
     <li>
      <strong>
       输入
      </strong>
      ：一维整数数组（如
      <code>
       [0, 2, 1, 2]
      </code>
      ）。
     </li>
     <li>
      <strong>
       输出
      </strong>
      ：二维矩阵，每一行对应一个样本的 one-hot 向量（如
      <code>
       [[1,0,0], [0,0,1], [0,1,0], [0,0,1]]
      </code>
      ）。
     </li>
     <li>
      入参
      <code>
       y
      </code>
      ：待转换的整数标签数组。
     </li>
     <li>
      入参
      <code>
       num_classes
      </code>
      （可选）：总类别数。若不指定，自动根据标签最大值推断（
      <code>
       max(y) + 1
      </code>
      ）。
     </li>
    </ul>
    <h3>
     <a id="_61">
     </a>
     三、模型构建
    </h3>
    <p>
     接下来，我们开始构建CNN模型。这个模型由几个基本的层组成：卷积层、池化层、展平层和全连接层。
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 2. 构建CNN模型</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'构建CNN模型'</span><span class="token punctuation">)</span>
    model <span class="token operator">=</span> models<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token comment"># 卷积层：32个3x3滤波器，激活函数ReLU</span>
        layers<span class="token punctuation">.</span>Conv2D<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">,</span> input_shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment"># 最大池化层：2x2窗口</span>
        layers<span class="token punctuation">.</span>MaxPooling2D<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment"># 展平层：将3D特征转换为1D向量</span>
        layers<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment"># 全连接层：128个神经元</span>
        layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment"># 输出层：10个类别（数字0-9）</span>
        layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'softmax'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     卷积层使用了32个3x3的滤波器，激活函数采用了
     <code>
      ReLU
     </code>
     （Rectified Linear Unit，修正线性单元，
     <code>
      f(x)=max(0,x)
     </code>
     ），它能够有效地解决梯度消失问题，加速模型的训练。最大池化层使用2x2的窗口，对特征图进行下采样，减少参数数量，提高模型的计算效率。展平层将三维的特征图转换为一维向量，以便于全连接层的处理。全连接层包含了128个神经元，最后的输出层有10个神经元，对应着10个数字类别，激活函数使用了softmax，用于多分类任务。
    </p>
    <h3>
     <a id="_84">
     </a>
     四、模型编译
    </h3>
    <p>
     在模型构建完成后，我们需要对其进行编译，指定优化器、损失函数以及评估指标。
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 3. 编译模型</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'编译模型'</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>optimizer<span class="token operator">=</span><span class="token string">'adam'</span><span class="token punctuation">,</span>
                  loss<span class="token operator">=</span><span class="token string">'categorical_crossentropy'</span><span class="token punctuation">,</span>
                  metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     这里我们选择了Adam优化器，它是一种自适应学习率的优化算法，能够根据模型的训练情况自动调整学习率。损失函数选择了 categorical_crossentropy，它适用于多分类问题。评估指标我们选择了准确率（accuracy），用于衡量模型的分类性能。
    </p>
    <h3>
     <a id="_98">
     </a>
     五、模型训练
    </h3>
    <p>
     现在，我们开始对模型进行训练。在训练过程中，我们指定了训练数据、标签、训练轮数（epochs）、批量大小（batch_size）以及验证集的比例。
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 4. 训练模型</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练模型...'</span><span class="token punctuation">)</span>
    history <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>
        train_images<span class="token punctuation">,</span> train_labels<span class="token punctuation">,</span>
        epochs<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
        batch_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>
        validation_split<span class="token operator">=</span><span class="token number">0.2</span>
    <span class="token punctuation">)</span>
</code></pre>
    <p>
     在这里，我们设置了训练轮数为2，批量大小为64，验证集的比例为0.2，即从训练数据中划分出20%的数据作为验证集，用于在训练过程中评估模型的性能，防止过拟合。
    </p>
    <p>
     <strong>
      参数选择依据
     </strong>
     ：
    </p>
    <ul>
     <li>
      <code>
       epochs=2
      </code>
      ：MNIST数据简单，2轮即可快速验证流程正确性
     </li>
     <li>
      <code>
       batch_size=64
      </code>
      ：在GPU显存允许范围内最大化批次提升训练速度
     </li>
    </ul>
    <h3>
     <a id="_118">
     </a>
     六、模型评估
    </h3>
    <p>
     训练完成后，我们需要对模型在测试集上的性能进行评估。
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 5. 评估模型</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'评估模型...'</span><span class="token punctuation">)</span>
    test_loss<span class="token punctuation">,</span> test_acc <span class="token operator">=</span> model<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span>test_images<span class="token punctuation">,</span> test_labels<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'\n测试准确率: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>test_acc<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre>
    <p>
     通过 model.evaluate 方法，我们可以得到测试集上的损失值和准确率。这能够让我们直观地了解模型在未见过的数据上的表现。
    </p>
    <h3>
     <a id="_131">
     </a>
     七、模型预测与可视化
    </h3>
    <p>
     最后，我们使用模型对测试集中的第一个样本进行预测，并将预测结果与真实标签进行比较，同时绘制图像。
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 取测试集第一个样本</span>
    test_image <span class="token operator">=</span> test_images<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    true_label <span class="token operator">=</span> test_labels<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token punctuation">)</span>
    prediction <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_image<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plot_prediction<span class="token punctuation">(</span>test_image<span class="token punctuation">,</span> true_label<span class="token punctuation">,</span> prediction<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">plot_prediction</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> true_label<span class="token punctuation">,</span> prediction<span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>image<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
    <span class="token comment"># 设置字体，支持中文显示</span>
    plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">"font.sans-serif"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"SimHei"</span><span class="token punctuation">]</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'真实: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>true_label<span class="token punctuation">}</span></span><span class="token string">, 预测: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>prediction<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     通过这个过程，我们可以直观地看到模型的预测结果是否正确，同时也能对模型的性能有一个更直观的感受。
    </p>
    <h3>
     <a id="_154">
     </a>
     八、完整代码
    </h3>
    <pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token comment"># @ProjectName: Ai</span>
<span class="token comment"># @Name: 20250305-CNN.py</span>
<span class="token comment"># @Auth: arbboter</span>
<span class="token comment"># @Date: 2025/3/5-9:44</span>
<span class="token comment"># @Desc: 使用Python和TensorFlow/Keras实现的简单卷积神经网络（CNN），用于手写数字识别（MNIST数据集），代码包含训练、评估和预测示例。</span>
<span class="token comment"># @Ver : 0.0.0.1</span>
<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras <span class="token keyword">import</span> layers<span class="token punctuation">,</span> models
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> builtins
<span class="token keyword">import</span> datetime

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    主函数
    :return:
    """</span>
    <span class="token comment"># 1. 加载并预处理数据</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'加载并预处理数据'</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span>train_images<span class="token punctuation">,</span> train_labels<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>test_images<span class="token punctuation">,</span> test_labels<span class="token punctuation">)</span> <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>mnist<span class="token punctuation">.</span>load_data<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 归一化并调整形状（添加通道维度）</span>
    train_images <span class="token operator">=</span> train_images<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">60000</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">255</span>
    test_images <span class="token operator">=</span> test_images<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">255</span>

    <span class="token comment"># 转换标签为one-hot编码</span>
    train_labels <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>to_categorical<span class="token punctuation">(</span>train_labels<span class="token punctuation">)</span>
    test_labels <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>to_categorical<span class="token punctuation">(</span>test_labels<span class="token punctuation">)</span>

    <span class="token comment"># 2. 构建CNN模型</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'构建CNN模型'</span><span class="token punctuation">)</span>
    model <span class="token operator">=</span> models<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token comment"># 卷积层：32个3x3滤波器，激活函数ReLU</span>
        layers<span class="token punctuation">.</span>Conv2D<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">,</span> input_shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment"># 最大池化层：2x2窗口</span>
        layers<span class="token punctuation">.</span>MaxPooling2D<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment"># 展平层：将3D特征转换为1D向量</span>
        layers<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment"># 全连接层：128个神经元</span>
        layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment"># 输出层：10个类别（数字0-9）</span>
        layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'softmax'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># 3. 编译模型</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'编译模型'</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>optimizer<span class="token operator">=</span><span class="token string">'adam'</span><span class="token punctuation">,</span>
                  loss<span class="token operator">=</span><span class="token string">'categorical_crossentropy'</span><span class="token punctuation">,</span>
                  metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># 4. 训练模型</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练模型...'</span><span class="token punctuation">)</span>
    history <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>
        train_images<span class="token punctuation">,</span> train_labels<span class="token punctuation">,</span>
        epochs<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
        batch_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>
        validation_split<span class="token operator">=</span><span class="token number">0.2</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># 5. 评估模型</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'评估模型...'</span><span class="token punctuation">)</span>
    test_loss<span class="token punctuation">,</span> test_acc <span class="token operator">=</span> model<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span>test_images<span class="token punctuation">,</span> test_labels<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'\n测试准确率: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>test_acc<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

    <span class="token comment"># 取测试集第一个样本</span>
    test_image <span class="token operator">=</span> test_images<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    true_label <span class="token operator">=</span> test_labels<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token punctuation">)</span>
    prediction <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_image<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plot_prediction<span class="token punctuation">(</span>test_image<span class="token punctuation">,</span> true_label<span class="token punctuation">,</span> prediction<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">plot_prediction</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> true_label<span class="token punctuation">,</span> prediction<span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>image<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
    <span class="token comment"># 设置字体，支持中文显示</span>
    plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">"font.sans-serif"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"SimHei"</span><span class="token punctuation">]</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'真实: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>true_label<span class="token punctuation">}</span></span><span class="token string">, 预测: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>prediction<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">hook_print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">my_print</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        old_print<span class="token punctuation">(</span><span class="token string">'['</span><span class="token punctuation">,</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">"] "</span><span class="token punctuation">)</span>
        old_print<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    old_print <span class="token operator">=</span> builtins<span class="token punctuation">.</span><span class="token keyword">print</span>
    builtins<span class="token punctuation">.</span><span class="token keyword">print</span> <span class="token operator">=</span> my_print

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    hook_print<span class="token punctuation">(</span><span class="token punctuation">)</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre>
    <h3>
     <a id="_250">
     </a>
     九、运作结果
    </h3>
    <p>
     <img alt="结果输出" src="https://i-blog.csdnimg.cn/direct/6d9182f9bf0c46438f5ca52d379346f7.png">
      <br/>
      注意：首次运行程序会自动下载训练和测试数据集，比较费时间。
     </img>
    </p>
    <h3>
     <a id="_254">
     </a>
     十、工程实践中的注意事项
    </h3>
    <p>
     在实际的工程实践中，我们需要注意以下几个方面：
    </p>
    <ol>
     <li>
      <p>
       数据预处理：数据的质量直接影响模型的性能。除了归一化和one-hot编码外，还可以考虑对数据进行增强，如旋转、平移、缩放等操作，以增加模型的泛化能力。
      </p>
     </li>
     <li>
      <p>
       模型结构：根据实际任务的需求，合理设计模型的结构。可以尝试增加卷积层的数量、调整滤波器的大小和数量，以及改变全连接层的神经元数量，以提高模型的性能。
      </p>
     </li>
     <li>
      <p>
       模型训练：选择合适的优化器、学习率和训练轮数。可以使用早停（early stopping）、学习率衰减等技巧，防止过拟合，提高模型的泛化能力。
      </p>
     </li>
     <li>
      <p>
       模型评估：除了准确率外，还可以考虑使用其他评估指标，如精确率（precision）、召回率（recall）、F1值等，从多个角度评估模型的性能。
      </p>
     </li>
     <li>
      <p>
       模型部署：在模型训练完成后，需要将其部署到实际的应用场景中。可以使用TensorFlow Serving等工具，将模型封装为API，供其他应用程序调用。
      </p>
     </li>
    </ol>
    <p>
     总之，基于TensorFlow/Keras实现的简单CNN模型，为我们提供了一种高效、便捷的手写数字识别解决方案。在实际的工程实践中，我们需要根据具体的需求和数据特点，灵活调整模型的结构和训练策略，以实现最佳的性能。
    </p>
    <h3>
     <a id="_270">
     </a>
     结语
    </h3>
    <p>
     本实现仅用35行核心代码完成端到端的CNN训练与验证，准确率达98%+。通过模块化设计、日志增强和可视化组件，展现了工业级代码的雏形。读者可在此基础上扩展更复杂的网络结构或部署功能。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031343136313836342f:61727469636c652f64657461696c732f313436303337373730" class_="artid" style="display:none">
 </p>
</div>


