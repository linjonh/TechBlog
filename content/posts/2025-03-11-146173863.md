---
layout: post
title: "logback希望特定的error日志写入到特定文件"
date: 2025-03-11 11:21:25 +0800
description: "1、可以看到<logger name=\"hzxLogger\" level=\"ERROR\" additivity=\"false\"> 同时 <appender name=\"hzxAppender\"  中也配置 <filter class=\"ch.qos.logback.classic.filter.LevelFilter\"></filter>  只过滤error级别的，是否存在重复配置。"
keywords: "logback append 添加 日志级别为 error 的"
categories: ['未分类']
tags: ['Logback']
artid: "146173863"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146173863
    alt: "logback希望特定的error日志写入到特定文件"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146173863
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146173863
cover: https://bing.ee123.net/img/rand?artid=146173863
image: https://bing.ee123.net/img/rand?artid=146173863
img: https://bing.ee123.net/img/rand?artid=146173863
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     logback希望特定的error日志写入到特定文件
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     1、增加appender
    </h2>
    <p>
     加了过滤器，限定只记录ERROR级别日志 。
    </p>
    <pre><code class="language-XML">&lt;appender name="hzxAppender" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;
        &lt;file&gt;${hzx_LOG_FILE}&lt;/file&gt;
        &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt;
            &lt;fileNamePattern&gt;${hzx_LOG_FILE}.%d{yyyy-MM-dd}.%i.log&lt;/fileNamePattern&gt;
            &lt;timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP"&gt;
                &lt;maxFileSize&gt;200MB&lt;/maxFileSize&gt;
            &lt;/timeBasedFileNamingAndTriggeringPolicy&gt;
            &lt;totalSizeCap&gt;2GB&lt;/totalSizeCap&gt;
            &lt;MaxHistory&gt;15&lt;/MaxHistory&gt;
            &lt;cleanHistoryOnStart&gt;true&lt;/cleanHistoryOnStart&gt;
        &lt;/rollingPolicy&gt;
        &lt;append&gt;true&lt;/append&gt;
        &lt;layout class="org.apache.skywalking.apm.toolkit.log.logback.v1.x.mdc.TraceIdMDCPatternLogbackLayout"&gt;
            &lt;Pattern&gt;${LOG_PATTERN}&lt;/Pattern&gt;
        &lt;/layout&gt;
        &lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt;
            &lt;level&gt;ERROR&lt;/level&gt;
            &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;
            &lt;onMismatch&gt;DENY&lt;/onMismatch&gt;
        &lt;/filter&gt;
    &lt;/appender&gt;</code></pre>
    <h2>
     2、限定只在 local环境下记录
    </h2>
    <p>
     且additivity = false，此时该日志将不会写入到其他文件。
    </p>
    <pre><code class="language-XML">&lt;!-- 本地 --&gt;
    &lt;springProfile name="local"&gt;
        &lt;root level="INFO"&gt;
            &lt;appender-ref ref="CONSOLE"/&gt;
            &lt;appender-ref ref="applicationAppender"/&gt;
            &lt;appender-ref ref="errorAppender"/&gt;
        &lt;/root&gt;
        &lt;logger name="hzxLogger" level="ERROR" additivity="false"&gt;
            &lt;appender-ref ref="hzxAppender"/&gt;
        &lt;/logger&gt;
    &lt;/springProfile&gt;</code></pre>
    <h2 style="background-color:transparent">
     3、代码中使用logger
    </h2>
    <pre><code class="language-java">@RestController
@Slf4j(topic = "hzxLogger")
public class TestController {<!-- --></code></pre>
    <p>
    </p>
    <p>
     扩展知识：
    </p>
    <p>
     1、可以看到&lt;logger name="hzxLogger" level="ERROR" additivity="false"&gt; 同时 &lt;appender name="hzxAppender"  中也配置 &lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt;
     <br/>
     &lt;level&gt;ERROR&lt;/level&gt;
     <br/>
     &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;
     <br/>
     &lt;onMismatch&gt;DENY&lt;/onMismatch&gt;
     <br/>
     &lt;/filter&gt;  只过滤error级别的，是否存在重复配置。
    </p>
    <h4>
     1. 两者的作用机制
    </h4>
    <h5>
     a. ​
     <strong>
      Logger 的
      <code>
       level="ERROR"
      </code>
     </strong>
    </h5>
    <ul>
     <li>
      ​
      <strong>
       作用层级
      </strong>
      ：在 Logger 级别过滤。
     </li>
     <li>
      ​
      <strong>
       效果
      </strong>
      ：只有 ​
      <strong>
       ERROR 及以上级别
      </strong>
      的日志事件会进入该 Logger，低于 ERROR 的日志（如 INFO、WARN）会被直接丢弃，不会传递给任何 Appender。
     </li>
    </ul>
    <h5>
     b. ​
     <strong>
      Appender 的 LevelFilter
     </strong>
    </h5>
    <ul>
     <li>
      ​
      <strong>
       作用层级
      </strong>
      ：在 Appender 级别过滤。
     </li>
     <li>
      ​
      <strong>
       效果
      </strong>
      ：即使日志事件通过了 Logger 的级别过滤，LevelFilter 会再次检查级别：
      <ul>
       <li>
        <code>
         ACCEPT
        </code>
        ERROR 级别的日志。
       </li>
       <li>
        <code>
         DENY
        </code>
        非 ERROR 级别的日志（但此时这些日志已经通过 Logger 的
        <code>
         level="ERROR"
        </code>
        过滤，实际不会到达这里）。
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     2. 是否冗余？
    </h4>
    <ul>
     <li>
      <p>
       ​
       <strong>
        在当前的配置中，这两个过滤是冗余的
       </strong>
       ：
      </p>
      <ul>
       <li>
        由于 Logger 的
        <code>
         level="ERROR"
        </code>
        已经确保只有 ERROR 级别的日志能进入 Appender，Appender 的 LevelFilter 实际上 ​
        <strong>
         永远不会遇到非 ERROR 日志
        </strong>
        ，因此
        <code>
         &lt;onMismatch&gt;DENY&lt;/onMismatch&gt;
        </code>
        是多余的。
       </li>
      </ul>
     </li>
     <li>
      <p>
       ​
       <strong>
        特殊情况
       </strong>
       ：
      </p>
      <ul>
       <li>
        如果 Logger 的
        <code>
         level
        </code>
        设置为低于 ERROR（如
        <code>
         INFO
        </code>
        ），则 Appender 的 LevelFilter 是必要的，用于进一步过滤出 ERROR 日志。
       </li>
       <li>
        如果 Logger 的
        <code>
         additivity="true"
        </code>
        （默认值），日志事件可能从父 Logger 传递过来，此时 LevelFilter 可能有意义。但你的配置中
        <code>
         additivity="false"
        </code>
        ，因此无需考虑这种情况。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       Logger 的
       <code>
        level
       </code>
      </strong>
      和 ​
      <strong>
       Appender 的 LevelFilter
      </strong>
      可以同时存在，但需根据场景决定是否需要双重过滤。
     </li>
     <li>
      在大多数情况下，优先使用 ​
      <strong>
       Logger 级别过滤
      </strong>
      ，保持配置简洁高效。
     </li>
    </ul>
    <hr/>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f747a737a687a782f:61727469636c652f64657461696c732f313436313733383633" class_="artid" style="display:none">
 </p>
</div>


