---
layout: post
title: "Squid代理服务器传统代理透明代理图文详解"
date: 2025-01-02 17:52:35 +0800
description: "这里写目录标题一、Squid代理服务器1、代理的工作机制2、代理的类型3、使用代理的好处二、安装Sq"
keywords: "squid"
categories: ['Squid']
tags: ['运维', 'Linux', 'Centos']
artid: "118490272"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=118490272
    alt: "Squid代理服务器传统代理透明代理图文详解"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=118490272
featuredImagePreview: https://bing.ee123.net/img/rand?artid=118490272
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Squid代理服务器（传统代理、透明代理）（图文详解）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      Squid代理服务器（传统代理、透明代理）（图文详解）
     </h4>
     <ul>
      <li>
       <a href="#Squid_1" rel="nofollow">
        一、Squid代理服务器
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1_3" rel="nofollow">
          1、代理的工作机制
         </a>
        </li>
        <li>
         <a href="#2_6" rel="nofollow">
          2、代理的类型
         </a>
        </li>
        <li>
         <a href="#3_17" rel="nofollow">
          3、使用代理的好处
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#Squid_21" rel="nofollow">
        二、安装Squid服务
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1Squid_29" rel="nofollow">
          1、编译安装Squid
         </a>
        </li>
        <li>
         <a href="#2_Squid__78" rel="nofollow">
          2、修改 Squid 的配置文件
         </a>
        </li>
        <li>
         <a href="#3Squid__99" rel="nofollow">
          3、Squid 的运行控制
         </a>
        </li>
        <li>
         <a href="#4_Squid__115" rel="nofollow">
          4、编写 Squid 服务脚本
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_179" rel="nofollow">
        三、构建传统代理服务器
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_180" rel="nofollow">
          环境配置
         </a>
        </li>
        <li>
         <a href="#1squid_188" rel="nofollow">
          1、squid服务器
         </a>
        </li>
        <li>
         <a href="#2web1_218" rel="nofollow">
          2、web1的配置
         </a>
        </li>
        <li>
         <a href="#3_234" rel="nofollow">
          3、客户端配置（添加代理）
         </a>
        </li>
        <li>
         <a href="#4_246" rel="nofollow">
          4、检测
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_265" rel="nofollow">
        四、构建透明代理服务器
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_266" rel="nofollow">
          环境配置
         </a>
        </li>
        <li>
         <a href="#_274" rel="nofollow">
          添加网卡
         </a>
        </li>
        <li>
         <a href="#1Squid_279" rel="nofollow">
          1、Squid服务器配置
         </a>
        </li>
        <li>
         <a href="#2_308" rel="nofollow">
          2、开启路由转发，实现本机中不同网段的地址转发
         </a>
        </li>
        <li>
         <a href="#3web1_325" rel="nofollow">
          3、web1服务器（添加一条静态路由）
         </a>
        </li>
        <li>
         <a href="#4win10100_341" rel="nofollow">
          4、客户端关闭代理，修改win10地址为100网段
         </a>
        </li>
        <li>
         <a href="#5_Squid__354" rel="nofollow">
          5、查看 Squid 访问日志的新增记录
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_372" rel="nofollow">
        总结
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1Squid_373" rel="nofollow">
          1、Squid代理服务器的作用
         </a>
        </li>
        <li>
         <a href="#2_378" rel="nofollow">
          2、代理的类型
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="Squid_1">
     </a>
     一、Squid代理服务器
    </h2>
    <ul>
     <li>
      Squid主要提供缓存加速、应用层过滤控制、web服务隐藏真实IP（安全性）的功能。
     </li>
    </ul>
    <h3>
     <a id="1_3">
     </a>
     1、代理的工作机制
    </h3>
    <ul>
     <li>
      代替客户机向网站请求数据，从而可以隐藏用户的真实IP地址。
     </li>
     <li>
      将获得的网页数据（静态 Web 元素）保存到缓存中并发送给客户机，以便下次请求相同的数据时快速响应。
     </li>
    </ul>
    <h3>
     <a id="2_6">
     </a>
     2、代理的类型
    </h3>
    <p>
     <mark>
      传统代理：
     </mark>
    </p>
    <ul>
     <li>
      适用于Internet，需在客户机指定代理服务器的地址和端口。
     </li>
    </ul>
    <p>
     <mark>
      透明代理：
     </mark>
    </p>
    <ul>
     <li>
      客户机不需指定代理服务器的地址和端口，而是通过默认路由、防火墙策略将Web访问重定向给代理服务器处理。
     </li>
    </ul>
    <p>
     <mark>
      反向代理：
     </mark>
    </p>
    <ul>
     <li>
      如果 Squid 反向代理服务器中缓存了该请求的资源，则将该请求的资源直接返回给客户端；否则反向代理服务器将向后台的 WEB 服务器请求资源，然后将请求的应答返回给客户端，同时也将该应答缓存（静态）在本地，供下一个请求者使用。
     </li>
    </ul>
    <h3>
     <a id="3_17">
     </a>
     3、使用代理的好处
    </h3>
    <ul>
     <li>
      提高web访问速度
     </li>
     <li>
      隐藏客户机的真实IP地址
     </li>
    </ul>
    <h2>
     <a id="Squid_21">
     </a>
     二、安装Squid服务
    </h2>
    <table>
     <thead>
      <tr>
       <th>
        服务器
       </th>
       <th>
        IP
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        Squid服务器
       </td>
       <td>
        192.168.80.72
       </td>
      </tr>
      <tr>
       <td>
        web服务器
       </td>
       <td>
        192.168.80.73
       </td>
      </tr>
      <tr>
       <td>
        客户机
       </td>
       <td>
        169.254.204.97
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="1Squid_29">
     </a>
     1、编译安装Squid
    </h3>
    <pre><code class="prism language-css">systemctl stop firewalld
systemctl disable firewalld
setenforce 0

yum -y install gcc gcc-c++ make
cd /opt
#上传squid-3.5.28.tar.gz软件包到/opt目录下
tar zxvf squid-3.5.28.tar.gz 
cd /opt/squid-3.5.28
./configure --prefix=/usr/local/squid \     #指定安装目录路径
--sysconfdir=/etc \                         #指定配置文件路径
--enable-arp-acl \                          #MAC地址管控，防止客户端使用IP欺骗
--enable-linux-netfilter \                  #使用内核过滤
--enable-linux-tproxy \                     #支持透明模式
--enable-async-io=100 \                     #异步IO，提升存储性能
--enable-err-language=<span class="token string">"Simplify_ Chinese"</span> \ #错误信息的显示语言
--enable-underscore \                       #允许URL中有下划线
--disable-poll \                            #关闭默认使用poll模式
--enable-gnuregex                           #使用GNU正则表达式


./configure --prefix=/usr/local/squid \
--sysconfdir=/etc \
--enable-arp-acl \
--enable-linux-netfilter \
--enable-linux-tproxy \
--enable-async-io=100 \
--enable-err-language=<span class="token string">"Simplify_Chinese"</span> \
--enable-underscore \
--disable-poll \
--enable-epoll \
--enable-gnurege

make -j4 &amp;&amp; make install

ln -s /usr/local/squid/sbin/* /usr/local/sbin
useradd -M -s /sbin/nologin squid
chown -R <span class="token property">squid</span><span class="token punctuation">:</span>squid /usr/local/squid/var/       #此目录用于存放缓存文件

</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0b9e1bc3b45a150ba46eff1db5874432.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d7489835b303e4d24cac7c4606fa1dad.png">
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7a9701feadbfe35dc9cb83adbbbc8ef0.png">
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d42508ee38d0d04cf146ae2c9e7663ea.png"/>
       </img>
      </img>
     </img>
    </p>
    <h3>
     <a id="2_Squid__78">
     </a>
     2、修改 Squid 的配置文件
    </h3>
    <pre><code class="prism language-css">vim /etc/squid.conf
......
-----56行--插入------
http_access allow all    #放在http_access deny all 之前，允许任意客户机使用代理服务，控制规则自上而下匹配
http_access deny all
http_port 3128           #用来指定代理服务监听的地址和端口<span class="token punctuation">(</span>默认的端口号为3128<span class="token punctuation">)</span>

-----61行--插入------
cache_effective_user squid     #添加，指定程序用户，用来设置初始化、运行时缓存的账号，否则启动不成功
cache_effective_group squid    #添加，指定账号基本组
coredump_dir /usr/local/squid/var/cache/squid   #指定缓存文件目录

</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/481610720e47d27ebe94f02e72940501.png"/>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9af05021d40e9bece5e011a723c1af9e.png"/>
    </p>
    <h3>
     <a id="3Squid__99">
     </a>
     3、Squid 的运行控制
    </h3>
    <pre><code class="prism language-css">squid -k parse    #检查配置文件语法是否正确
squid -k rec      #重新加载配置文件

#启动Squid， 第一次启动Squid服务时，会自动初始化缓存目录
squid -zX   #-z选项用来初始化缓存目录
squid      #启动squid 服务

netstat -natp | grep squid
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4f4274976c70dcd75527006af2eadf43.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/548bb8abdd3d19b75ffbd43486e990ff.png"/>
     </img>
    </p>
    <h3>
     <a id="4_Squid__115">
     </a>
     4、编写 Squid 服务脚本
    </h3>
    <pre><code class="prism language-css">vim /etc/init.d/squid

#!/bin/bash
#<span class="token property">chkconfig</span><span class="token punctuation">:</span> 2345 90 25
#2345是默认自启动级别，如是 - 代表任何级别都不自启动<span class="token punctuation">;</span> 90是启动优先级，25是停止优先级，优先级范围是0一100，数字越大，优先级越低。

PID=<span class="token string">"/usr/local/squid/var/run/squid.pid"</span>
CONF=<span class="token string">"/etc/squid.conf"</span>
CMD=<span class="token string">"/usr/local/squid/sbin/squid"</span>

case <span class="token string">"$1"</span> in
   start<span class="token punctuation">)</span>
     netstat -natp | grep squid &amp;&gt; /dev/null
     if [ $? -eq 0 ]
     then
       echo <span class="token string">"squid is running"</span>
       else
       echo <span class="token string">"正在启动 squid..."</span>
       $CMD
     fi
   <span class="token punctuation">;</span><span class="token punctuation">;</span>
   stop<span class="token punctuation">)</span>
     $CMD -k kill &amp;&gt; /dev/null
     rm -rf $PID &amp;&gt; /dev/null
   <span class="token punctuation">;</span><span class="token punctuation">;</span>
   status<span class="token punctuation">)</span>
     [ -f $PID ] &amp;&gt; /dev/null
        if [ $? -eq 0 ]
          then
            netstat -natp | grep squid
          else
            echo <span class="token string">"squid is not running"</span>
        fi
   <span class="token punctuation">;</span><span class="token punctuation">;</span>
   restart<span class="token punctuation">)</span>
      $0 stop &amp;&gt; /dev/null
      echo <span class="token string">"正在关闭 squid..."</span>
      $0 start &amp;&gt; /dev/null
      echo <span class="token string">"正在启动 squid..."</span>
   <span class="token punctuation">;</span><span class="token punctuation">;</span>
   reload<span class="token punctuation">)</span>
      $CMD -k reconfigure
   <span class="token punctuation">;</span><span class="token punctuation">;</span>
   check<span class="token punctuation">)</span>
      $CMD -k parse
   <span class="token punctuation">;</span><span class="token selector">;
   *)
      echo "用法：$0</span><span class="token punctuation">{<!-- --></span>start|stop|status|reload|check|restart<span class="token punctuation">}</span>"
   <span class="token punctuation">;</span><span class="token punctuation">;</span>
esac


chmod +x /etc/init.d/squid
chkconfig --add squid
chkconfig squid on
service squid restart
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1c6714b95027cb0efde827ad547db3a2.png"/>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4969e93bef40054687ecd0f646cb35ab.png"/>
    </p>
    <h2>
     <a id="_179">
     </a>
     三、构建传统代理服务器
    </h2>
    <h3>
     <a id="_180">
     </a>
     环境配置
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        主机
       </th>
       <th>
        操作系统
       </th>
       <th>
        IP地址
       </th>
       <th>
        软件、安装包、工具
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        Squid-Server
       </td>
       <td>
        CentOS7
       </td>
       <td>
        192.168.80.72
       </td>
       <td>
        squid-3.5.28.tar.gz
       </td>
      </tr>
      <tr>
       <td>
        Web1
       </td>
       <td>
        CentOS7
       </td>
       <td>
        192.168.80.73
       </td>
       <td>
        httpd
       </td>
      </tr>
      <tr>
       <td>
        客户机
       </td>
       <td>
        Windows
       </td>
       <td>
        169.254.204.97
       </td>
       <td>
        ——
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="1squid_188">
     </a>
     1、squid服务器
    </h3>
    <pre><code class="prism language-css">vim /etc/squid.conf 
......
http_access allow all
http_access deny all
http_port 3128
cache_effective_user squid
cache_effective_group squid

#63行插入
cache_mem 64 MB			            #指定缓存功能所使用的内存空间大小，便于保持访问较频繁的WEB对象，容量最好为4的倍数，单位为MB，建议设为物理内存的1/4
reply_body_max_size 10 MB			#允许用户下载的最大文件大小，以字节为单位，当下载超过指定大小的Web对象时，浏览器的报错页面中会出现“请求或访问太大”的提示默认设置0表示不进行限制
maximum_object_size 4096 KB			#允许保存到缓存空间的最大对象大小，以KB为单位，超过大小限制的文件将不被缓存，而是直接转发给用户

systemctl start squid
netstat -natp | grep squid

service squid restart或
systemctl restart squid

#修改防火墙规则
iptables -F
iptables -I INPUT -p tcp --dport 3128 -j ACCEPT
iptables -L INPUT
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2abaebba37dc855c4c216bdb7303ee97.png"/>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/dc5ab97b56164ff5e230254a7ead0a7b.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9a3da33242566b8032396937364f8177.png"/>
    </p>
    <h3>
     <a id="2web1_218">
     </a>
     2、web1的配置
    </h3>
    <p>
     <mark>
      Web1（192.168.80.73）
     </mark>
    </p>
    <pre><code class="prism language-css">systemctl stop firewalld.service
setenforce 0
yum -y install httpd
systemctl start httpd
netstat -natp | grep 80
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b44ae58ef67bf83325497cff2cbd6aa8.png"/>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9f9464ac02d16af6e0eacff1e8432de8.png"/>
    </p>
    <h3>
     <a id="3_234">
     </a>
     3、客户端配置（添加代理）
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/240db6a133e62d4bd1b200acb34a393e.png"/>
    </p>
    <pre><code class="prism language-css">谷歌浏览器：
设置--》高级--》系统--》打开代理设置--》设置代理
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e69a7750f467ac9ac734d1c4cd6075e1.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/aff174233c53df20acf422c2df8427cb.png"/>
    </p>
    <h3>
     <a id="4_246">
     </a>
     4、检测
    </h3>
    <p>
     <mark>
      在浏览器输入Web服务器IP地址访问，查看Web服务器访问日志，显示的是由代理服务器替客户机在访问。
     </mark>
    </p>
    <pre><code class="prism language-css"><span class="token property">http</span><span class="token punctuation">:</span>//192.168.80.73
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/40a1005efdc96e711a2c7fc240be3878.png"/>
    </p>
    <p>
     <mark>
      查看Web1访问日志的新增记录
     </mark>
    </p>
    <pre><code class="prism language-css">tail -f /var/log/httpd/access_log
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/39f711fdf20691a6e5ad034f1183a283.png"/>
    </p>
    <h2>
     <a id="_265">
     </a>
     四、构建透明代理服务器
    </h2>
    <h3>
     <a id="_266">
     </a>
     环境配置
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        主机
       </th>
       <th>
        操作系统
       </th>
       <th>
        IP地址
       </th>
       <th>
        服务、安装包、工具
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        Squid-Server
       </td>
       <td>
        CentOS7
       </td>
       <td>
        ens33：192.168.80.72、 ens37：12.0.0.1
       </td>
       <td>
        squid-3.5.28.tar.gz
       </td>
      </tr>
      <tr>
       <td>
        Web1
       </td>
       <td>
        CentOS7
       </td>
       <td>
        12.0.0.12
       </td>
       <td>
        httpd
       </td>
      </tr>
      <tr>
       <td>
        客户端
       </td>
       <td>
        Windows
       </td>
       <td>
        192.168.80.100
       </td>
       <td>
        ——
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2fb84b80d43ecb1ea4f3a3a214dc8d30.png"/>
    </p>
    <h3>
     <a id="_274">
     </a>
     添加网卡
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4469cbe4af0a85f3025e720ac1c636d0.png"/>
     <br/>
     <mark>
      ens33\ens37
     </mark>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e1e5aab12d0294060b1dfecf27928f46.png"/>
    </p>
    <h3>
     <a id="1Squid_279">
     </a>
     1、Squid服务器配置
    </h3>
    <pre><code class="prism language-css">cd /etc/sysconfig/network-scripts/
cp ifcfg-ens33 ifcfg-ens37
vim ifcfg-ens37

systemctl restart network
ifconfig 

#60行修改添加提供内网服务的IP地址，和支持透明代理选项 transparent
vim /etc/squid.conf
......
http_access allow all
http_access deny all

http_port 192.168.184.10<span class="token punctuation">:</span>3128 transparent

systemctl restart squid
netstat -natp | grep 3128
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6112547e44d4be0cab8b24d77bcfe036.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7d264d3a7a238e5ee4f170936ec99671.png"/>
    </p>
    <p>
     <img alt=":" src="https://i-blog.csdnimg.cn/blog_migrate/b841c3423bc05e6a477827c3421e4773.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/564e2a3362e5e6568e620718cbcd9895.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/48e122bb93bd10e64e132afde25ae028.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b569163ad0923abfa6e4162170a9b928.png"/>
    </p>
    <h3>
     <a id="2_308">
     </a>
     2、开启路由转发，实现本机中不同网段的地址转发
    </h3>
    <pre><code class="prism language-css">echo <span class="token string">'net.ipv4.ip_forward = 1'</span> &gt;&gt; /etc/sysctl.conf
sysctl -p

修改防火墙规则
iptables -F
iptables -t nat -F    #添加防火墙规则（将来源为100网段：80/443端口的流量重定向到3128端口）
iptables -t nat -I PREROUTING -i ens33 -s 192.168.184.0/24 -p tcp --dport 80 -j REDIRECT --to 3128	
iptables -t nat -I PREROUTING -i ens33 -s 192.168.184.0/24 -p tcp --dport 443 -j REDIRECT --to 3128    #若进行重启，则需要配置以下规则
iptables -I INPUT -p tcp --dport 3128 -j ACCEPT   #开启路由转发
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b01a7b0f98dc4739ad7251a4046d24c6.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f8648cfc6b9b640b7a0abaa9696ae96e.png"/>
    </p>
    <h3>
     <a id="3web1_325">
     </a>
     3、web1服务器（添加一条静态路由）
    </h3>
    <pre><code class="prism language-css">systemctl stop firewalld.service
setenforce 0
vim /etc/sysconfig/network-scripts/ifcfg-ens33
systemctl restart network
ifconfig
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d0ae8f3561c9122a0798ad56f5c7410a.png"/>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f94d9e0b2f93605eb6aa1d743d731bfc.png"/>
    </p>
    <h3>
     <a id="4win10100_341">
     </a>
     4、客户端关闭代理，修改win10地址为100网段
    </h3>
    <pre><code class="prism language-css">客户机测试（192.168.80.100）
关闭客户机的浏览器之前设置的代理服务器的功能后访问 <span class="token property">http</span><span class="token punctuation">:</span>//12.0.0.12

访问web1服务器
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/20a9a99c79ccb30f0d7bd7cd7b3c1122.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/924aec84adb415251f4aa494d796a2b1.png"/>
    </p>
    <h3>
     <a id="5_Squid__354">
     </a>
     5、查看 Squid 访问日志的新增记录
    </h3>
    <pre><code class="prism language-css">tail -f /usr/local/squid/var/logs/access.log
Squid代理服务器则是检测到客户机访问目标网站
</code></pre>
    <pre><code class="prism language-css">查看 Web 访问日志的新增记录，显示的是由代理服务器的外网口代替客户机在访问
tail -f /var/log/httpd/access_log

可以看到是代理服务器外网口12.0.0.100访问的12.0.0.12
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/368b2fac8b9e953a98127bd2b41d184f.png"/>
    </p>
    <h2>
     <a id="_372">
     </a>
     总结
    </h2>
    <h3>
     <a id="1Squid_373">
     </a>
     1、Squid代理服务器的作用
    </h3>
    <ul>
     <li>
      Squid主要提供缓存加速，提高web访问速度
     </li>
     <li>
      应用层过滤控制
     </li>
     <li>
      代替客户机向网站请求数据，从而可以隐藏用户的真实IP地址
     </li>
    </ul>
    <h3>
     <a id="2_378">
     </a>
     2、代理的类型
    </h3>
    <p>
     <mark>
      传统代理：
     </mark>
    </p>
    <ul>
     <li>
      适用于Internet，需在客户机指定代理服务器的地址和端口。
     </li>
    </ul>
    <p>
     <mark>
      透明代理：
     </mark>
    </p>
    <ul>
     <li>
      客户机不需指定代理服务器的地址和端口，而是通过默认路由、防火墙策略将Web访问重定向给代理服务器处理。
     </li>
    </ul>
    <p>
     <mark>
      反向代理：
     </mark>
    </p>
    <ul>
     <li>
      如果 Squid 反向代理服务器中缓存了该请求的资源，则将该请求的资源直接返回给客户端；
     </li>
     <li>
      否则反向代理服务器将向后台的 WEB 服务器请求资源，然后将请求的应答返回给客户端，同时也将该应答缓存（静态）在本地，供下一个请求者使用。
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34373835353436332f:61727469636c652f64657461696c732f313138343930323732" class_="artid" style="display:none">
 </p>
</div>


