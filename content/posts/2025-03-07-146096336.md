---
layout: post
title: "Golang学习笔记_46状态模式"
date: 2025-03-07 21:00:00 +0800
description: "状态模式是一种行为型设计模式，允许对象在其内部状态改变时改变自身行为，使对象表现如同改变了其类。其核心特点包括：•状态抽象化：将状态抽象为独立对象•行为动态化：运行时根据状态自动切换行为•条件解耦：消除复杂的条件判断语句。"
keywords: "Golang学习笔记_46——状态模式"
categories: ['Golang']
tags: ['设计模式', '笔记', '状态模式', '学习', 'Golang']
artid: "146096336"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146096336
    alt: "Golang学习笔记_46状态模式"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146096336
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146096336
cover: https://bing.ee123.net/img/rand?artid=146096336
image: https://bing.ee123.net/img/rand?artid=146096336
img: https://bing.ee123.net/img/rand?artid=146096336
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Golang学习笔记_46——状态模式
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <a href="https://blog.csdn.net/LuckyLay/article/details/146062560">
      Golang学习笔记_43——责任链模式
     </a>
     <br/>
     <a href="https://blog.csdn.net/LuckyLay/article/details/146063032">
      Golang学习笔记_44——命令模式
     </a>
     <br/>
     <a href="https://blog.csdn.net/LuckyLay/article/details/146096029">
      Golang学习笔记_45——备忘录模式
     </a>
    </p>
    <hr/>
    <p>
    </p>
    <p>
    </p>
    <hr/>
    <h3>
     <a id="_11">
     </a>
     一、核心概念
    </h3>
    <h4>
     <a id="1__12">
     </a>
     1. 定义
    </h4>
    <p>
     <strong>
      状态模式
     </strong>
     是一种
     <strong>
      行为型设计模式
     </strong>
     ，允许对象在其内部状态改变时改变自身行为，使对象表现如同改变了其类。其核心特点包括：
     <br/>
     •
     <strong>
      状态抽象化
     </strong>
     ：将状态抽象为独立对象
     <br/>
     •
     <strong>
      行为动态化
     </strong>
     ：运行时根据状态自动切换行为
     <br/>
     •
     <strong>
      条件解耦
     </strong>
     ：消除复杂的条件判断语句
    </p>
    <h4>
     <a id="2__18">
     </a>
     2. 解决的问题
    </h4>
    <p>
     •
     <strong>
      行为耦合
     </strong>
     ：对象行为与状态转换逻辑高度耦合
     <br/>
     •
     <strong>
      维护困难
     </strong>
     ：大量条件分支导致代码难以维护
     <br/>
     •
     <strong>
      扩展受限
     </strong>
     ：新增状态需修改现有条件判断结构
    </p>
    <h4>
     <a id="3__23">
     </a>
     3. 核心角色
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        角色
       </th>
       <th>
        作用
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        Context
       </td>
       <td>
        维护当前状态对象，定义客户端接口
       </td>
      </tr>
      <tr>
       <td>
        State
       </td>
       <td>
        定义状态行为的抽象接口
       </td>
      </tr>
      <tr>
       <td>
        ConcreteState
       </td>
       <td>
        实现特定状态下的具体行为逻辑
       </td>
      </tr>
     </tbody>
    </table>
    <h4>
     <a id="4__30">
     </a>
     4. 类图
    </h4>
    <p>
     <img alt="状态模式类图" src="https://i-blog.csdnimg.cn/direct/8f83aaa07e9b4de9b52bba5a29663b04.png"/>
    </p>
    <pre><code class="prism language-plantuml">@startuml
interface State {
    + Handle()
}

class ConcreteStateA {
    + Handle()
}

class ConcreteStateB {
    + Handle()
}

class Context {
    - state: State
    + SetState(s: State)
    + Request()
}

Context --&gt; State
State &lt;|-- ConcreteStateA
State &lt;|-- ConcreteStateB

note right of Context::Request
    委托当前状态对象处理请求
    实现行为动态切换
end note
@enduml
</code></pre>
    <h3>
     <a id="_64">
     </a>
     二、特点分析
    </h3>
    <p>
     <strong>
      优点
     </strong>
    </p>
    <ol>
     <li>
      <strong>
       消除条件判断
      </strong>
      ：通过多态代替条件分支
     </li>
     <li>
      <strong>
       提升扩展性
      </strong>
      ：新增状态不影响现有逻辑
     </li>
     <li>
      <strong>
       职责清晰化
      </strong>
      ：每个状态类专注自身行为
     </li>
    </ol>
    <p>
     <strong>
      缺点
     </strong>
    </p>
    <ol>
     <li>
      <strong>
       类膨胀风险
      </strong>
      ：状态数量较多时类数量激增
     </li>
     <li>
      <strong>
       转换复杂度
      </strong>
      ：状态间转换逻辑可能变得复杂
     </li>
     <li>
      <strong>
       内存开销
      </strong>
      ：需维护多个状态对象实例
     </li>
    </ol>
    <h3>
     <a id="_75">
     </a>
     三、适用场景
    </h3>
    <h4>
     <a id="1__76">
     </a>
     1. 电梯控制系统
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">type</span> ElevatorState <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">OpenDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">CloseDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> StopState <span class="token keyword">struct</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>StopState<span class="token punctuation">)</span> <span class="token function">OpenDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"开门中..."</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>StopState<span class="token punctuation">)</span> <span class="token function">CloseDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"门已关闭"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>StopState<span class="token punctuation">)</span> <span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"启动运行"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>StopState<span class="token punctuation">)</span> <span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"已处于停止状态"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="2__104">
     </a>
     2. 订单状态管理
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">type</span> OrderStatus <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">Confirm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">Cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">Ship</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> PaidStatus <span class="token keyword">struct</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>PaidStatus<span class="token punctuation">)</span> <span class="token function">Confirm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"订单已支付，无需重复确认"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>PaidStatus<span class="token punctuation">)</span> <span class="token function">Cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"发起退款流程"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>PaidStatus<span class="token punctuation">)</span> <span class="token function">Ship</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"开始发货处理"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="3__127">
     </a>
     3. 游戏角色状态
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">type</span> CharacterState <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">Move</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">Attack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">Defend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> NormalState <span class="token keyword">struct</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>NormalState<span class="token punctuation">)</span> <span class="token function">Move</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"正常移动速度"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>NormalState<span class="token punctuation">)</span> <span class="token function">Attack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"普通攻击力"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>NormalState<span class="token punctuation">)</span> <span class="token function">Defend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"标准防御姿势"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="Go_150">
     </a>
     四、Go语言实现示例
    </h3>
    <p>
     <img alt="代码示例类图" src="https://i-blog.csdnimg.cn/direct/0c2aadca2dea4c6fb1bb792af96a8d48.png"/>
    </p>
    <h4>
     <a id="_154">
     </a>
     完整实现代码
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">package</span> state_demo

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token comment">// State 接口</span>
<span class="token keyword">type</span> TrafficLightState <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">Change</span><span class="token punctuation">(</span>light <span class="token operator">*</span>TrafficLight<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 具体状态实现</span>
<span class="token keyword">type</span> RedState <span class="token keyword">struct</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>RedState<span class="token punctuation">)</span> <span class="token function">Change</span><span class="token punctuation">(</span>light <span class="token operator">*</span>TrafficLight<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"红灯亮30秒"</span><span class="token punctuation">)</span>
	light<span class="token punctuation">.</span><span class="token function">SetState</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>GreenState<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> GreenState <span class="token keyword">struct</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>GreenState<span class="token punctuation">)</span> <span class="token function">Change</span><span class="token punctuation">(</span>light <span class="token operator">*</span>TrafficLight<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"绿灯亮45秒"</span><span class="token punctuation">)</span>
	light<span class="token punctuation">.</span><span class="token function">SetState</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>YellowState<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> YellowState <span class="token keyword">struct</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>YellowState<span class="token punctuation">)</span> <span class="token function">Change</span><span class="token punctuation">(</span>light <span class="token operator">*</span>TrafficLight<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"黄灯亮5秒"</span><span class="token punctuation">)</span>
	light<span class="token punctuation">.</span><span class="token function">SetState</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>RedState<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Context 实现</span>
<span class="token keyword">type</span> TrafficLight <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	state TrafficLightState
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>TrafficLight<span class="token punctuation">)</span> <span class="token function">SetState</span><span class="token punctuation">(</span>s TrafficLightState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	t<span class="token punctuation">.</span>state <span class="token operator">=</span> s
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>TrafficLight<span class="token punctuation">)</span> <span class="token function">PerformChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	t<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">Change</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 客户端使用示例</span>
<span class="token keyword">func</span> <span class="token function">ExampleUsage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	light <span class="token operator">:=</span> <span class="token operator">&amp;</span>TrafficLight<span class="token punctuation">{<!-- --></span>state<span class="token punctuation">:</span> <span class="token operator">&amp;</span>RedState<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">}</span>

	light<span class="token punctuation">.</span><span class="token function">PerformChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 红灯 -&gt; 绿灯</span>
	light<span class="token punctuation">.</span><span class="token function">PerformChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 绿灯 -&gt; 黄灯</span>
	light<span class="token punctuation">.</span><span class="token function">PerformChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 黄灯 -&gt; 红灯</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_210">
     </a>
     执行结果
    </h4>
    <pre><code class="prism language-text">=== RUN   TestExampleUsage
红灯亮30秒
绿灯亮45秒
黄灯亮5秒
--- PASS: TestExampleUsage (0.00s)
PASS
</code></pre>
    <h3>
     <a id="_220">
     </a>
     五、高级应用
    </h3>
    <h4>
     <a id="1__221">
     </a>
     1. 状态机引擎
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">type</span> StateMachine <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	current State
	states  <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>State
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>sm <span class="token operator">*</span>StateMachine<span class="token punctuation">)</span> <span class="token function">Transition</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> next<span class="token punctuation">,</span> exists <span class="token operator">:=</span> sm<span class="token punctuation">.</span>states<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span> exists <span class="token punctuation">{<!-- --></span>
		sm<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		sm<span class="token punctuation">.</span>current <span class="token operator">=</span> next
		sm<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">Enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>sm <span class="token operator">*</span>StateMachine<span class="token punctuation">)</span> <span class="token function">AddState</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">,</span> state State<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	sm<span class="token punctuation">.</span>states<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> state
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="2__241">
     </a>
     2. 分布式状态管理
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">type</span> ClusterState <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	nodes <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>State
	lock  sync<span class="token punctuation">.</span>RWMutex
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>cs <span class="token operator">*</span>ClusterState<span class="token punctuation">)</span> <span class="token function">Sync</span><span class="token punctuation">(</span>nodeID <span class="token builtin">string</span><span class="token punctuation">,</span> state State<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	cs<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> cs<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	cs<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>nodeID<span class="token punctuation">]</span> <span class="token operator">=</span> state
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>cs <span class="token operator">*</span>ClusterState<span class="token punctuation">)</span> <span class="token function">Consensus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> State <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 实现分布式状态共识算法</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_259">
     </a>
     六、与其他模式对比
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        模式
       </th>
       <th>
        核心区别
       </th>
       <th>
        典型应用场景
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         策略模式
        </strong>
       </td>
       <td>
        主动选择算法 vs 被动状态转换
       </td>
       <td>
        支付方式选择
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         职责链模式
        </strong>
       </td>
       <td>
        请求传递链 vs 状态转换链
       </td>
       <td>
        审批流程处理
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         备忘录模式
        </strong>
       </td>
       <td>
        状态存储 vs 行为变更
       </td>
       <td>
        编辑器撤销功能
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="_266">
     </a>
     七、实现建议
    </h3>
    <ol>
     <li>
      <strong>
       接口设计优化
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">type</span> State <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">Enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token function">Exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> State
<span class="token punctuation">}</span>
</code></pre>
    <ol start="2">
     <li>
      <strong>
       状态共享机制
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">var</span> <span class="token punctuation">(</span>
	runningState <span class="token operator">=</span> <span class="token operator">&amp;</span>RunningState<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	stoppedState <span class="token operator">=</span> <span class="token operator">&amp;</span>StoppedState<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
    <ol start="3">
     <li>
      <strong>
       转换规则封装
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">type</span> TransitionRule <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	From  State
	Event <span class="token builtin">string</span>
	To    State
<span class="token punctuation">}</span>
</code></pre>
    <ol start="4">
     <li>
      <strong>
       状态持久化
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>State<span class="token punctuation">)</span> <span class="token function">MarshalJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
		Type <span class="token builtin">string</span> <span class="token string">`json:"type"`</span>
	<span class="token punctuation">}</span><span class="token punctuation">{<!-- --></span>
		Type<span class="token punctuation">:</span> reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_301">
     </a>
     八、典型应用
    </h3>
    <ol>
     <li>
      <strong>
       工业控制系统
      </strong>
      ：设备运行状态管理
     </li>
     <li>
      <strong>
       交易引擎
      </strong>
      ：订单生命周期管理
     </li>
     <li>
      <strong>
       AI决策系统
      </strong>
      ：智能体行为状态切换
     </li>
     <li>
      <strong>
       网络协议栈
      </strong>
      ：连接状态管理（TCP状态机）
     </li>
    </ol>
    <p>
     通过状态模式，可构建出具备清晰状态转换逻辑的业务系统。在Go语言中建议：
    </p>
    <ul>
     <li>
      使用接口组合实现状态层次结构
     </li>
     <li>
      结合channel实现异步状态转换
     </li>
     <li>
      利用sync.Pool优化高频状态对象
     </li>
     <li>
      采用代码生成技术自动构建状态机
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f4c75636b794c61792f:61727469636c652f64657461696c732f313436303936333336" class_="artid" style="display:none">
 </p>
</div>


