---
layout: post
title: "Go学习04-2-Gin框架-模板渲染会话中间件"
date: 2025-03-12 08:31:32 +0800
description: "【Go学习】04-2-Gin框架-模板渲染会话中间件"
keywords: "【Go学习】04-2-Gin框架-模板渲染会话中间件"
categories: ['宝Golang之路']
tags: ['模板', '学习', '中间件', 'Session', 'Golang', 'Gin', 'Cookie']
artid: "146195128"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146195128
    alt: "Go学习04-2-Gin框架-模板渲染会话中间件"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146195128
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146195128
cover: https://bing.ee123.net/img/rand?artid=146195128
image: https://bing.ee123.net/img/rand?artid=146195128
img: https://bing.ee123.net/img/rand?artid=146195128
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【Go学习】04-2-Gin框架-模板渲染会话中间件
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <hr/>
    <h2>
     <a id="_4">
     </a>
     模板渲染
    </h2>
    <p>
     模板是golang语言的一个标准库，使用场景很多，gin框架同样支持模板
    </p>
    <h3>
     <a id="_8">
     </a>
     基本使用
    </h3>
    <p>
     定义一个存放模板文件的
     <code>
      templates
     </code>
     文件夹
    </p>
    <p>
     创建helloworld/templates/index.tmpl
    </p>
    <pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>gin_templates<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
{<!-- -->{.title}}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     后端代码：
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"github.com/gin-gonic/gin"</span>
	<span class="token string">"net/http"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 模板解析</span>
	r<span class="token punctuation">.</span><span class="token function">LoadHTMLFiles</span><span class="token punctuation">(</span><span class="token string">"templates/index.tmpl"</span><span class="token punctuation">)</span>

	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/index"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// HTML请求</span>
		<span class="token comment">// 模板的渲染</span>
		c<span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> <span class="token string">"index.tmpl"</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"hello 模板"</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":9090"</span><span class="token punctuation">)</span> <span class="token comment">// 启动server</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_55">
     </a>
     多模板渲染
    </h3>
    <p>
     如果有多个模板，可以统一进行渲染
    </p>
    <pre><code class="prism language-go"><span class="token comment">// 模板解析,解析templates目录下的所有模板文件</span>
r<span class="token punctuation">.</span><span class="token function">LoadHTMLGlob</span><span class="token punctuation">(</span><span class="token string">"templates/**"</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     如果目录为
     <code>
      templates/post/index.tmpl
     </code>
     和
     <code>
      templates/user/index.tmpl
     </code>
     这种，可以
    </p>
    <pre><code class="prism language-go"><span class="token comment">// **/* 代表所有子目录下的所有文件</span>
router<span class="token punctuation">.</span><span class="token function">LoadHTMLGlob</span><span class="token punctuation">(</span><span class="token string">"templates/**/*"</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/3001ffd53b584f4b8f5edad8631ae268.png"/>
    </p>
    <h3>
     <a id="_74">
     </a>
     自定义模板函数
    </h3>
    <p>
     修改前端
    </p>
    <pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>gin_templates<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
{<!-- -->{.title | safe }}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     safe相当于给title又加了个函数
    </p>
    <pre><code class="prism language-go"><span class="token comment">// gin框架给模板添加自定义函数</span>
r<span class="token punctuation">.</span><span class="token function">SetFuncMap</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span>FuncMap<span class="token punctuation">{<!-- --></span>
    <span class="token string">"safe"</span><span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>str <span class="token builtin">string</span><span class="token punctuation">)</span> template<span class="token punctuation">.</span>HTML <span class="token punctuation">{<!-- --></span>
       <span class="token keyword">return</span> template<span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 模板解析,解析templates目录下的所有模板文件</span>
r<span class="token punctuation">.</span><span class="token function">LoadHTMLGlob</span><span class="token punctuation">(</span><span class="token string">"templates/**"</span><span class="token punctuation">)</span>

r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/index"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// HTML请求</span>
    <span class="token comment">// 模板的渲染</span>
    c<span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> <span class="token string">"index.tmpl"</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
       <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"&lt;a href='http://baidu.com'&gt;跳转到其他地方&lt;/a&gt;"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7f70308242fb4b07ba6478e9de37b618.png"/>
    </p>
    <h3>
     <a id="_117">
     </a>
     静态文件处理
    </h3>
    <p>
     创建helloworld/static/css/index.css
    </p>
    <pre><code class="prism language-css"><span class="token selector">body</span><span class="token punctuation">{<!-- --></span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> aqua<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     修改helloworld/templates/index/index.tmpl引入css
    </p>
    <pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>gin_templates<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/css/index.css<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
{<!-- -->{.title | safe }}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     静态文件映射
    </p>
    <pre><code class="prism language-go"><span class="token comment">// 加载静态文件</span>
r<span class="token punctuation">.</span><span class="token function">Static</span><span class="token punctuation">(</span><span class="token string">"/css"</span><span class="token punctuation">,</span> <span class="token string">"./static/css"</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     前端要/css，那么我们映射到./static/css下
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// gin框架给模板添加自定义函数</span>
	r<span class="token punctuation">.</span><span class="token function">SetFuncMap</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span>FuncMap<span class="token punctuation">{<!-- --></span>
		<span class="token string">"safe"</span><span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>str <span class="token builtin">string</span><span class="token punctuation">)</span> template<span class="token punctuation">.</span>HTML <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> template<span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token comment">// 模板解析,解析templates目录下的所有模板文件</span>
	r<span class="token punctuation">.</span><span class="token function">LoadHTMLGlob</span><span class="token punctuation">(</span><span class="token string">"templates/**/*"</span><span class="token punctuation">)</span>

	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/index"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// HTML请求</span>
		<span class="token comment">// 模板的渲染</span>
		c<span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> <span class="token string">"index.tmpl"</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"&lt;a href='http://baidu.com'&gt;跳转到其他地方&lt;/a&gt;"</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Static</span><span class="token punctuation">(</span><span class="token string">"/css"</span><span class="token punctuation">,</span> <span class="token string">"./static/css"</span><span class="token punctuation">)</span> <span class="token comment">// 静态文件处理</span>

	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":9090"</span><span class="token punctuation">)</span> <span class="token comment">// 启动server</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     这样我们就成功引入静态文件了
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/03fcd94401e147ceb0703776108215ad.png"/>
    </p>
    <h2>
     <a id="_184">
     </a>
     会话
    </h2>
    <p>
     会话控制涉及到cookie和session的使用
    </p>
    <h3>
     <a id="cookie_188">
     </a>
     cookie
    </h3>
    <ol>
     <li>
      HTTP是无状态协议，服务器不能记录浏览器的访问状态，也就是说服务器不能区分两次请求是否由同一个客户端发出
     </li>
     <li>
      Cookie就是解决HTTP协议无状态的方案之一
     </li>
     <li>
      Cookie实际上就是服务器保存在浏览器上的一段信息。浏览器有了Cookie之后，每次向服务器发送请求时都会同时将该信息发送给服务器，服务器收到请求后，就可以根据该信息处理请求
     </li>
     <li>
      Cookie由服务器创建，并发送给浏览器，最终由浏览器保存
     </li>
    </ol>
    <h4>
     <a id="cookie_195">
     </a>
     设置cookie
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Context<span class="token punctuation">)</span> <span class="token function">SetCookie</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value <span class="token builtin">string</span><span class="token punctuation">,</span> maxAge <span class="token builtin">int</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> domain <span class="token builtin">string</span><span class="token punctuation">,</span> secure<span class="token punctuation">,</span> httpOnly <span class="token builtin">bool</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     参数说明：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        参数名
       </th>
       <th>
        类型
       </th>
       <th>
        说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        name
       </td>
       <td>
        string
       </td>
       <td>
        cookie名字
       </td>
      </tr>
      <tr>
       <td>
        value
       </td>
       <td>
        string
       </td>
       <td>
        cookie值
       </td>
      </tr>
      <tr>
       <td>
        maxAge
       </td>
       <td>
        int
       </td>
       <td>
        有效时间，单位是秒，MaxAge=0 忽略MaxAge属性，MaxAge&lt;0 相当于删除cookie, 通常可以设置-1代表删除，MaxAge&gt;0 多少秒后cookie失效
       </td>
      </tr>
      <tr>
       <td>
        path
       </td>
       <td>
        string
       </td>
       <td>
        cookie路径
       </td>
      </tr>
      <tr>
       <td>
        domain
       </td>
       <td>
        string
       </td>
       <td>
        cookie作用域
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         secure
        </strong>
       </td>
       <td>
        <strong>
         bool
        </strong>
       </td>
       <td>
        <strong>
         Secure=true，那么这个cookie只能用https协议发送给服务器
        </strong>
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         httpOnly
        </strong>
       </td>
       <td>
        <strong>
         bool
        </strong>
       </td>
       <td>
        <strong>
         设置HttpOnly=true的cookie不能被js获取到
        </strong>
       </td>
      </tr>
     </tbody>
    </table>
    <pre><code class="prism language-go">r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/cookie"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 设置cookie</span>
    c<span class="token punctuation">.</span><span class="token function">SetCookie</span><span class="token punctuation">(</span><span class="token string">"site_cookie"</span><span class="token punctuation">,</span> <span class="token string">"cookievalue"</span><span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a62c1c50798141fe8e27a11054c7cdef.png"/>
    </p>
    <p>
     在前端也能在cookie找到我们设置的cookie
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ab5259550a5d44719bbd84eeb8e34751.png"/>
    </p>
    <h4>
     <a id="cookie_227">
     </a>
     读取cookie
    </h4>
    <p>
     因为我们刚刚设置了个key叫site_cookie，value叫cookievalue的cookie，时间使6分钟，我们可以读取出来
    </p>
    <pre><code class="prism language-go">r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/read"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 根据cookie名字读取cookie值</span>
    data<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Cookie</span><span class="token punctuation">(</span><span class="token string">"site_cookie"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
       c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/29554e3e26104b03975b2c477bbf2924.png"/>
    </p>
    <h4>
     <a id="cookie_248">
     </a>
     删除cookie
    </h4>
    <p>
     通过将cookie的MaxAge设置为-1, 达到删除cookie的目的。
    </p>
    <pre><code class="prism language-go">r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/del"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 设置cookie  MaxAge设置为-1，表示删除cookie</span>
    c<span class="token punctuation">.</span><span class="token function">SetCookie</span><span class="token punctuation">(</span><span class="token string">"site_cookie"</span><span class="token punctuation">,</span> <span class="token string">"cookievalue"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">"删除cookie"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="Session_260">
     </a>
     Session
    </h3>
    <p>
     在Gin框架中，我们可以依赖
     <a href="https://github.com/gin-contrib/sessions">
      gin-contrib/sessions
     </a>
     中间件处理session。
    </p>
    <p>
     支持cookie、redis、mongodb等等
    </p>
    <p>
     安装session包
    </p>
    <pre><code class="prism language-shell">go get github.com/gin-contrib/sessions
</code></pre>
    <p>
     但是这个包依赖个
     <code>
      github.com/chenzhuoyu/iasm
     </code>
     ，这个已经不更新了，我们替换成
     <code>
      github.com/cloudwego/iasm v0.2.0
     </code>
     ，所以在go.mod中添加
    </p>
    <pre><code class="prism language-go">replace github<span class="token punctuation">.</span>com<span class="token operator">/</span>chenzhuoyu<span class="token operator">/</span>iasm <span class="token operator">=</span><span class="token operator">&gt;</span> github<span class="token punctuation">.</span>com<span class="token operator">/</span>cloudwego<span class="token operator">/</span>iasm v0<span class="token punctuation">.</span><span class="token number">2.0</span>
</code></pre>
    <p>
     使用demo
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 创建基于cookie的存储引擎，secret 参数是用于加密的密钥</span>
	store <span class="token operator">:=</span> cookie<span class="token punctuation">.</span><span class="token function">NewStore</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"secret"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// 设置session中间件，参数mysession，指的是session的名字，也是cookie的名字</span>
	<span class="token comment">// store是前面创建的存储引擎，我们可以替换成其他存储引擎</span>
	r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>sessions<span class="token punctuation">.</span><span class="token function">Sessions</span><span class="token punctuation">(</span><span class="token string">"mysession"</span><span class="token punctuation">,</span> store<span class="token punctuation">)</span><span class="token punctuation">)</span>

	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 初始化session对象</span>
		session <span class="token operator">:=</span> sessions<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
		<span class="token comment">// 通过session.Get读取session值</span>
		<span class="token comment">// session是键值对格式数据，因此需要通过key查询数据</span>
		<span class="token keyword">if</span> session<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">"world"</span> <span class="token punctuation">{<!-- --></span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"没读到"</span><span class="token punctuation">)</span>
			<span class="token comment">// 设置session数据</span>
			session<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"world"</span><span class="token punctuation">)</span>
			session<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"hello"</span><span class="token punctuation">:</span> session<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <p>
       <code>
        cookie.NewStore([]byte("secret"))
       </code>
       创建了一个基于
       <strong>
        Cookie
       </strong>
       的
       <code>
        Session
       </code>
       存储引擎，
       <code>
        "secret"
       </code>
       是加密密钥。
      </p>
     </li>
     <li>
      <p>
       <code>
        sessions.Sessions("mysession", store)
       </code>
       注册
       <code>
        Session
       </code>
       中间件：
      </p>
      <ul>
       <li>
        <code>
         mysession
        </code>
        是
        <strong>
         SessionID 在 Cookie 里的 key
        </strong>
        。
       </li>
       <li>
        <code>
         store
        </code>
        指定存储引擎（这里是 Cookie）。
       </li>
      </ul>
     </li>
    </ul>
    <p>
     这样就相当于session存储在cookie里，cookie作为存储引擎
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1be771047cc946b4ad063a101e4048e7.png"/>
    </p>
    <p>
     我们访问http://localhost:8000/hello这样就能在cookie里找到保存着我们session的cookie了，不过我们一般选择redis作为我们的存储引擎，因为cookie一是不安全，二是可以被手动删除
    </p>
    <h4>
     <a id="Session_319">
     </a>
     多Session
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	store <span class="token operator">:=</span> cookie<span class="token punctuation">.</span><span class="token function">NewStore</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"secret"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	sessionNames <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">}</span>
	r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>sessions<span class="token punctuation">.</span><span class="token function">SessionsMany</span><span class="token punctuation">(</span>sessionNames<span class="token punctuation">,</span> store<span class="token punctuation">)</span><span class="token punctuation">)</span>

	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		sessionA <span class="token operator">:=</span> sessions<span class="token punctuation">.</span><span class="token function">DefaultMany</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span>
		sessionB <span class="token operator">:=</span> sessions<span class="token punctuation">.</span><span class="token function">DefaultMany</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">)</span>

		<span class="token keyword">if</span> sessionA<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">"world!"</span> <span class="token punctuation">{<!-- --></span>
			sessionA<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"world!"</span><span class="token punctuation">)</span>
			sessionA<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> sessionB<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">"world?"</span> <span class="token punctuation">{<!-- --></span>
			sessionB<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"world?"</span><span class="token punctuation">)</span>
			sessionB<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"a"</span><span class="token punctuation">:</span> sessionA<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"b"</span><span class="token punctuation">:</span> sessionB<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/06ab44b3a99a4b86b814e8d354e3d357.png"/>
    </p>
    <h4>
     <a id="redissession_354">
     </a>
     基于redis存储引擎的session
    </h4>
    <p>
     如果我们想将session数据保存到redis中，只要将session的存储引擎改成redis即可。
    </p>
    <p>
     使用redis作为存储引擎的例子：
    </p>
    <p>
     首先安装redis存储引擎的包
    </p>
    <pre><code class="prism language-shell">PS F:<span class="token punctuation">\</span>Code<span class="token punctuation">\</span>Golang<span class="token punctuation">\</span>TuLing<span class="token punctuation">\</span>workPath<span class="token punctuation">\</span>ginlearn<span class="token punctuation">\</span>helloworld<span class="token operator">&gt;</span> go get github.com/gin-contrib/sessions/redis
</code></pre>
    <p>
     编写程序
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 初始化基于redis的存储引擎</span>
	<span class="token comment">// 参数说明：</span>
	<span class="token comment">//    第1个参数 - redis最大的空闲连接数</span>
	<span class="token comment">//    第2个参数 - 数通信协议tcp或者udp</span>
	<span class="token comment">//    第3个参数 - redis地址, 格式，host:port</span>
	<span class="token comment">//    第4个参数 - redis密码</span>
	<span class="token comment">//    第5个参数 - session加密密钥</span>
	store<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> redis<span class="token punctuation">.</span><span class="token function">NewStore</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">"tcp"</span><span class="token punctuation">,</span> <span class="token string">"192.168.101.68:6379"</span><span class="token punctuation">,</span> <span class="token string">"redis"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"secret"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>sessions<span class="token punctuation">.</span><span class="token function">Sessions</span><span class="token punctuation">(</span><span class="token string">"mysession"</span><span class="token punctuation">,</span> store<span class="token punctuation">)</span><span class="token punctuation">)</span>

	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/incr"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		session <span class="token operator">:=</span> sessions<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
		<span class="token keyword">var</span> count <span class="token builtin">int</span>
		v <span class="token operator">:=</span> session<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"count"</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> v <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			count <span class="token operator">=</span> <span class="token number">0</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			count <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
			count<span class="token operator">++</span>
		<span class="token punctuation">}</span>
		session<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"count"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>
		session<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"count"</span><span class="token punctuation">:</span> count<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     运行查看redis
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9998bfcf3dd84aa9ad38488cf60c732c.png"/>
    </p>
    <p>
     这要这个session存在，那么刷新页面这个count就++
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f2fb69a2c2574329ab7ff00a0326c000.png"/>
    </p>
    <h2>
     <a id="_409">
     </a>
     中间件
    </h2>
    <p>
     在Gin框架中，
     <strong>
      中间件
     </strong>
     （Middleware）指的是可以拦截
     <strong>
      http请求-响应
     </strong>
     生命周期的特殊函数，在请求-响应生命周期中可以注册多个中间件，每个中间件执行不同的功能，一个中间执行完再轮到下一个中间件执行。
    </p>
    <p>
     <strong>
      中间件的常见应用场景如下：
     </strong>
    </p>
    <ul>
     <li>
      请求限速
     </li>
     <li>
      api接口签名处理
     </li>
     <li>
      权限校验
     </li>
     <li>
      统一错误处理
     </li>
    </ul>
    <p>
     Gin支持设置全局中间件和针对路由分组设置中间件，设置全局中间件意思就是会拦截所有请求，针对分组路由设置中间件，意思就是仅对这个分组下的路由起作用。
    </p>
    <h3>
     <a id="_422">
     </a>
     中间件使用
    </h3>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 通过use设置全局中间件</span>
    <span class="token comment">// 设置日志中间件，主要用于打印请求日志</span>
    r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>gin<span class="token punctuation">.</span><span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 设置Recovery中间件，主要用于拦截panic错误，不至于导致进程崩掉</span>
    r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>gin<span class="token punctuation">.</span><span class="token function">Recovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
       <span class="token function">panic</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"test error"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <p>
       <strong>
        r.Use(gin.Logger())
       </strong>
      </p>
      <pre><code>r.Use(gin.Logger())
</code></pre>
      <p>
       这个中间件用于记录请求日志。每次请求到来时，它会打印出请求的相关信息，比如请求方法、路径、状态码、响应时间等。它会帮助你快速追踪 API 的调用情况。
      </p>
     </li>
     <li>
      <p>
       <strong>
        gin.Recovery()
       </strong>
      </p>
      <pre><code>r.Use(gin.Recovery())
</code></pre>
      <p>
       这个中间件的作用是拦截
       <code>
        panic
       </code>
       错误，确保程序不会因为未处理的异常而崩溃。当程序发生
       <code>
        panic
       </code>
       时，它会捕获异常并恢复程序，返回 500 状态码的错误响应。这样可以避免服务器崩溃，并且确保返回一个友好的错误页面。
      </p>
     </li>
    </ul>
    <h3>
     <a id="_455">
     </a>
     自定义中间件
    </h3>
    <p>
     使用Use可以使用gin自带的中间件或者其他第三方中间件，也可以自己开发中间件
    </p>
    <p>
     自己实现中间件自然要返回
     <code>
      gin.HandlerFunc
     </code>
     ，这是个接口
    </p>
    <pre><code class="prism language-go"><span class="token keyword">type</span> HandlerFunc <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token operator">*</span>Context<span class="token punctuation">)</span>
</code></pre>
    <p>
     所以返回这个即可
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token comment">// 导入gin包</span>
<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"github.com/gin-gonic/gin"</span>
	<span class="token string">"log"</span>
	<span class="token string">"time"</span>
<span class="token punctuation">)</span>

<span class="token comment">// 自定义个日志中间件</span>
<span class="token keyword">func</span> <span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> gin<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		t <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token comment">// 可以通过上下文对象，设置一些依附在上下文对象里面的键/值数据</span>
		c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"example"</span><span class="token punctuation">,</span> <span class="token string">"12345"</span><span class="token punctuation">)</span>

		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"before action"</span><span class="token punctuation">)</span>

		<span class="token comment">// 在这里处理请求到达控制器函数之前的逻辑</span>

		<span class="token comment">// 调用下一个中间件，或者控制器处理函数，具体得看注册了多少个中间件。</span>
		c<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"after action"</span><span class="token punctuation">)</span>

		<span class="token comment">// 在这里可以处理请求返回给用户之前的逻辑</span>
		latency <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
		log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>latency<span class="token punctuation">)</span>

		<span class="token comment">// 例如，查询请求状态吗</span>
		status <span class="token operator">:=</span> c<span class="token punctuation">.</span>Writer<span class="token punctuation">.</span><span class="token function">Status</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 注册上面自定义的日志中间件</span>
	r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 查询我们之前在日志中间件，注入的键值数据</span>
		example <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">MustGet</span><span class="token punctuation">(</span><span class="token string">"example"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span>
		<span class="token comment">// it would print: "12345"</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token comment">// Listen and serve on 0.0.0.0:8080</span>
	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     响应如下：
    </p>
    <pre><code>[GIN-debug] Listening and serving HTTP on :8080
2025/03/11 20:13:24 before action
2025/03/11 20:13:24 12345
2025/03/11 20:13:24 after action
2025/03/11 20:13:24 27.1478ms
2025/03/11 20:13:24 200
</code></pre>
    <p>
     /test被拦截先执行logger然后再c.Next()时执行/test方法，然后进行logger的后续方法。
    </p>
    <p>
     如果有多个中间件（比如
     <code>
      Logger1
     </code>
     、
     <code>
      Logger2
     </code>
     和
     <code>
      Logger3
     </code>
     ）注册在 Gin 路由上，它们的执行顺序依然是由
     <code>
      r.Use()
     </code>
     注册的顺序决定的。即使是多个日志中间件，它们会按照你注册的顺序依次执行。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34353430303136372f:61727469636c652f64657461696c732f313436313935313238" class_="artid" style="display:none">
 </p>
</div>


