---
layout: post
title: "C实现AES-CBC加密工具类含完整源码及使用教程"
date: 2025-03-11 09:09:07 +0800
description: "AES作为全球公认的安全加密标准，广泛使用在​API通信加密、​API通信加密、用户隐私保护、跨平台数据交换、物联网设备通信"
keywords: "aes创建 c#"
categories: ['C']
tags: ['Cbc', 'C']
artid: "146169400"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146169400
    alt: "C实现AES-CBC加密工具类含完整源码及使用教程"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146169400
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146169400
cover: https://bing.ee123.net/img/rand?artid=146169400
image: https://bing.ee123.net/img/rand?artid=146169400
img: https://bing.ee123.net/img/rand?artid=146169400
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     C#实现AES-CBC加密工具类（含完整源码及使用教程）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     一、AES-CBC加密应用场景
    </h2>
    <p>
     AES（Advanced Encryption Standard）作为全球公认的安全加密标准，广泛使用在以下场景：
    </p>
    <ol>
     <li>
      <strong>
       API通信加密
      </strong>
      ：保护HTTP接口传输的敏感数据（如身份令牌、支付信息）
     </li>
     <li>
      <strong>
       文件安全存储
      </strong>
      ：加密本地配置文件、数据库连接字符串等
     </li>
     <li>
      <strong>
       用户隐私保护
      </strong>
      ：加密存储密码、身份证号等PII（个人身份信息）
     </li>
     <li>
      <strong>
       跨平台数据交换
      </strong>
      ：与Java/Python等其他语言实现的加密系统互通
     </li>
     <li>
      <strong>
       物联网设备通信
      </strong>
      ：保障设备与控制端的数据传输安全
     </li>
    </ol>
    <p>
     其中CBC模式（密码块链模式）通过引入初始化向量（IV），能有效防止相同明文生成相同密文的问题，安全性优于ECB模式。
    </p>
    <hr/>
    <h2>
     二、工具类完整实现代码
    </h2>
    <pre><code class="language-cs">using System;
using System.IO;
using System.Text;
using System.Security.Cryptography;

/// &lt;summary&gt;
/// AES-CBC加密工具类（128/192/256位密钥）
/// &lt;/summary&gt;
public static class AesCbcHelper
{
    /// &lt;summary&gt;
    /// AES加密（输出Base64字符串）
    /// &lt;/summary&gt;
    /// &lt;param name="plainText"&gt;明文&lt;/param&gt;
    /// &lt;param name="key"&gt;密钥（16/24/32字节）&lt;/param&gt;
    /// &lt;param name="iv"&gt;初始化向量（16字节）&lt;/param&gt;
    public static string Encrypt(string plainText, byte[] key, byte[] iv)
    {
        // 参数校验
        ValidateKeyAndIV(key, iv);
        
        using (Aes aesAlg = Aes.Create())
        {
            // 配置加密参数
            aesAlg.Key = key;
            aesAlg.IV = iv;
            aesAlg.Mode = CipherMode.CBC;     // 设置为CBC模式[4,9](@ref)
            aesAlg.Padding = PaddingMode.PKCS7; // 使用PKCS#7填充[3,6](@ref)

            // 创建加密器
            ICryptoTransform encryptor = aesAlg.CreateEncryptor();
            
            // 执行加密
            using (MemoryStream msEncrypt = new MemoryStream())
            {
                using (CryptoStream csEncrypt = new CryptoStream(msEncrypt, encryptor, CryptoStreamMode.Write))
                {
                    using (StreamWriter swEncrypt = new StreamWriter(csEncrypt))
                    {
                        swEncrypt.Write(plainText);
                    }
                    return Convert.ToBase64String(msEncrypt.ToArray());
                }
            }
        }
    }

    /// &lt;summary&gt;
    /// AES解密（输入Base64字符串）
    /// &lt;/summary&gt;
    public static string Decrypt(string cipherText, byte[] key, byte[] iv)
    {
        ValidateKeyAndIV(key, iv);
        
        using (Aes aesAlg = Aes.Create())
        {
            aesAlg.Key = key;
            aesAlg.IV = iv;
            aesAlg.Mode = CipherMode.CBC;
            aesAlg.Padding = PaddingMode.PKCS7;

            ICryptoTransform decryptor = aesAlg.CreateDecryptor();
            
            using (MemoryStream msDecrypt = new MemoryStream(Convert.FromBase64String(cipherText)))
            {
                using (CryptoStream csDecrypt = new CryptoStream(msDecrypt, decryptor, CryptoStreamMode.Read))
                {
                    using (StreamReader srDecrypt = new StreamReader(csDecrypt))
                    {
                        return srDecrypt.ReadToEnd();
                    }
                }
            }
        }
    }

    /// &lt;summary&gt;
    /// 密钥与IV校验
    /// &lt;/summary&gt;
    private static void ValidateKeyAndIV(byte[] key, byte[] iv)
    {
        if (!IsValidKeySize(key.Length))
            throw new ArgumentException("密钥长度应为16/24/32字节");
        
        if (iv.Length != 16)
            throw new ArgumentException("IV长度必须为16字节");
    }

    /// &lt;summary&gt;
    /// 验证密钥长度
    /// &lt;/summary&gt;
    private static bool IsValidKeySize(int keySize)
    {
        return keySize == 16 || keySize == 24 || keySize == 32; // 支持128/192/256位[9](@ref)
    }
}</code></pre>
    <hr/>
    <h2>
     三、使用教程（控制台示例）
    </h2>
    <pre><code class="language-cs">class Program
{
    static void Main()
    {
        try
        {
            // 原始数据
            string original = "CSDN开发者社区2023";
            
            // 生成密钥和IV（生产环境应从安全存储获取）
            byte[] key = Encoding.UTF8.GetBytes("ThisIsASecretKey16"); // 16字节密钥
            byte[] iv = Encoding.UTF8.GetBytes("16ByteInitVector");     // 16字节IV

            // 加密
            string encrypted = AesCbcHelper.Encrypt(original, key, iv);
            Console.WriteLine($"加密结果：{encrypted}");

            // 解密
            string decrypted = AesCbcHelper.Decrypt(encrypted, key, iv);
            Console.WriteLine($"解密结果：{decrypted}");
        }
        catch (CryptographicException ex)
        {
            Console.WriteLine($"加解密失败：{ex.Message}");
        }
    }
}</code></pre>
    <hr/>
    <h2>
     四、关键功能说明
    </h2>
    <h4>
    </h4>
    <h3>
     1. 参数验证机制
    </h3>
    <p>
     • 密钥长度强制校验（16/24/32字节）
    </p>
    <p>
     • IV长度必须为16字节
    </p>
    <p>
     • 自动处理Base64编解码
    </p>
    <h4>
    </h4>
    <h3>
     2. 安全增强特性
    </h3>
    <p>
     • 使用CBC模式防止模式攻击
    </p>
    <p>
     • 采用PKCS#7填充标准
    </p>
    <p>
     • 通过
     <code>
      using
     </code>
     语句确保资源释放
    </p>
    <h4>
    </h4>
    <h3>
     3. 异常处理建议
    </h3>
    <p>
     • 捕获
     <code>
      CryptographicException
     </code>
     处理加解密失败
    </p>
    <p>
     • 使用
     <code>
      ArgumentException
     </code>
     提示参数错误
    </p>
    <p>
     • 建议在生产环境中记录操作日志
    </p>
    <hr/>
    <h2>
     五、注意事项
    </h2>
    <ol>
     <li>
      <strong>
       密钥管理
      </strong>
      ：切勿硬编码密钥，应使用密钥管理系统（如Azure Key Vault）
     </li>
     <li>
      <strong>
       IV生成规则
      </strong>
      ：每次加密应生成随机IV（示例为演示固定值）
     </li>
     <li>
      <strong>
       性能优化
      </strong>
      ：对大数据流建议采用分块加密
     </li>
     <li>
      <strong>
       跨平台互通
      </strong>
      ：与其他语言对接需统一字符编码（推荐UTF-8）
     </li>
    </ol>
    <hr/>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f57616e674d696e675f582f:61727469636c652f64657461696c732f313436313639343030" class_="artid" style="display:none">
 </p>
</div>


