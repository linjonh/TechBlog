---
arturl_encode: "68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f37383631313031342f:61727469636c652f64657461696c732f313436313330323339"
layout: post
title: "数据库二三事14"
date: 2025-03-09 13:20:17 +08:00
description: "大容量：只对大容量数据进行最小记录，使日志正常不会被大容量加载操作填充，不受媒体故障危害，性能最佳，占日志空间最小，一般作为完整恢复的附加。顺序：还原最新完整库而不恢复库，有差异直接恢复差异库，从最后一次还原备份后创建第一个日志备份起依次还原，恢复库。包括纯日志备份（一段时间内），大容量操作日志备份（数据页备份）和结尾日志备份（可能损坏日志备份）oracle库：归纳常见故障为语句错误，进程失效，实例失效，网络失效，用户错误，介质失效。备份类型：sql支持库备份，文件备份，事务日志备份。"
keywords: "数据库二三事（14）"
categories: ['未分类']
tags: ['数据库']
artid: "146130239"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146130239
    alt: "数据库二三事14"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146130239
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146130239
cover: https://bing.ee123.net/img/rand?artid=146130239
image: https://bing.ee123.net/img/rand?artid=146130239
img: https://bing.ee123.net/img/rand?artid=146130239
---

# 数据库二三事（14）

备份与恢复数据库

备份具体内容包括数据库结构，对象与数据，造成数据丢失的原因有：

存储介质故障（硬件损耗）

用户操作错误（人工）

服务器故障（软硬都可能）

病毒侵害

自然灾害（天灾）等

恢复库包括介质故障修复和非介质故障修复

SQL Server备份恢复：

支持简单恢复模式，完整恢复模式，大容量日志恢复模式三种

简单：最大限度减少事务日志管理开销但库损坏时极大概率丢失数据（只用于测试开发数据库）

完整：记录所有事务，可恢复到故障点，支持还原单页

大容量：只对大容量数据进行最小记录，使日志正常不会被大容量加载操作填充，不受媒体故障危害，性能最佳，占日志空间最小，一般作为完整恢复的附加

语句：alter database 名字 set

recovery full/bulk\_logged/simple

备份内容及时间：

内容：用户数据，系统数据

时间：最好修改后立刻备份，用户库周期性备份

创库，创索引，清理日志后立刻备份

备份机制：

设备：物理存在的磁带硬盘文件，支持先建立备份设备再把库备份上和直接备份库到物理文件上两种方式

语句：sp\_addumpdevice 类型 名字 位置

返回0成功1失败

备份类型：sql支持库备份，文件备份，事务日志备份

库备份：包括完整备份和差异备份

完整是最基本且重要的备份，也是基础

差异是备份从最近完整备份之后库的全部变化内容，越小优势越大

差异库原则：完整备份后定期差异备份，控制差异备份不太大

文件备份：包括文件备份和差异文件备份（与库相同）

事务日志备份：仅用于完整备份与大容量备份

包括纯日志备份（一段时间内），大容量操作日志备份（数据页备份）和结尾日志备份（可能损坏日志备份）

常用策略：完整库适合库数据不大变化不多的备份

完整库＋日志：恢复到故障点

库＋日志＋差异库：备份恢复速度都较快丢失少

备份语句：backup database 名字

to 设备名

逻辑名

init：覆盖备份集，前面＋no为追加

skip：在覆盖前检查过期日期和时间

format：指定是否写入媒体表头

恢复机制：在数据库与数据文件级别下恢复

顺序：还原最新完整库而不恢复库，有差异直接恢复差异库，从最后一次还原备份后创建第一个日志备份起依次还原，恢复库

还原语句：restore database 名字

oracle库：归纳常见故障为语句错误，进程失效，实例失效，网络失效，用户错误，介质失效

主要分为逻辑备份与物理备份

exp/imp工具：进行导入导出，拥有用户模式，表模式，库模式

物理备份包括：用户管理备份，rman备份，第三方备份软件

rman包括组件：目标数据库，服务器会话，服务器进程，通道，恢复目录，媒体管理库

需要设置保留策略

增量备份：记录上一次备份后的改变

还有校验，恢复库，报告功能