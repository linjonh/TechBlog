---
layout: post
title: "alibaba-EasyExcel的使用说明"
date: 2025-03-11 02:38:59 +0800
description: "通过以上规则，你可以精准控制 Excel 解析的生命周期，确保数据处理的可靠性和高性能。：此方法在 EasyExcel 3.3+ 中默认空实现，需手动覆盖。：如果不覆盖此方法，默认会抛出异常并终止解析。：自定义异常处理逻辑（例如记录错误日志）。：收尾操作（例如关闭资源、提交事务）。：处理单行数据（例如保存到数据库）。：获取表头数据（例如动态列名）。时触发（例如数据类型不匹配）。：每解析成功一行数据后触发。：解析到 Excel 的。"
keywords: "alibaba EasyExcel的使用说明"
categories: ['未分类']
tags: ['运维', '容器', 'Docker']
artid: "146168117"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146168117
    alt: "alibaba-EasyExcel的使用说明"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146168117
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146168117
cover: https://bing.ee123.net/img/rand?artid=146168117
image: https://bing.ee123.net/img/rand?artid=146168117
img: https://bing.ee123.net/img/rand?artid=146168117
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     alibaba EasyExcel的使用说明
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h4>
     <a id="_1">
     </a>
     核心方法的执行顺序和规则
    </h4>
    <h5>
     <a id="1_invokeHead_3">
     </a>
     1.
     <strong>
      <code>
       invokeHead
      </code>
     </strong>
     （可选）
    </h5>
    <p>
     •
     <strong>
      触发条件
     </strong>
     ：解析到 Excel 的
     <strong>
      表头行
     </strong>
     （第一行）。
     <br/>
     •
     <strong>
      用途
     </strong>
     ：获取表头数据（例如动态列名）。
     <br/>
     •
     <strong>
      示例
     </strong>
     ：
    </p>
    <pre><code class="prism language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">invokeHead</span><span class="token punctuation">(</span>headMap<span class="token operator">:</span> Map<span class="token operator">&lt;</span>Int<span class="token punctuation">,</span> String<span class="token operator">&gt;</span><span class="token punctuation">,</span> context<span class="token operator">:</span> AnalysisContext<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"表头数据: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">headMap</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="2_invoke_13">
     </a>
     2.
     <strong>
      <code>
       invoke
      </code>
     </strong>
    </h5>
    <p>
     •
     <strong>
      触发条件
     </strong>
     ：每解析成功一行数据后触发。
     <br/>
     •
     <strong>
      用途
     </strong>
     ：处理单行数据（例如保存到数据库）。
     <br/>
     •
     <strong>
      注意
     </strong>
     ：此方法必须实现。
     <br/>
     •
     <strong>
      示例
     </strong>
     ：
    </p>
    <pre><code class="prism language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">invoke</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token punctuation">,</span> context<span class="token operator">:</span>AnalysisContext<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"处理数据: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">user</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="3_doAfterAllAnalysed_24">
     </a>
     3.
     <strong>
      <code>
       doAfterAllAnalysed
      </code>
     </strong>
    </h5>
    <p>
     •
     <strong>
      触发条件
     </strong>
     ：整个
     <strong>
      Sheet 解析完成
     </strong>
     后触发。
     <br/>
     •
     <strong>
      用途
     </strong>
     ：收尾操作（例如关闭资源、提交事务）。
     <br/>
     •
     <strong>
      注意
     </strong>
     ：此方法在 EasyExcel 3.3+ 中默认空实现，需手动覆盖。
     <br/>
     •
     <strong>
      示例
     </strong>
     ：
    </p>
    <pre><code class="prism language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">doAfterAllAnalysed</span><span class="token punctuation">(</span>context<span class="token operator">:</span>AnalysisContext<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"所有数据解析完成"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="4_onException_35">
     </a>
     4.
     <strong>
      <code>
       onException
      </code>
     </strong>
    </h5>
    <p>
     •
     <strong>
      触发条件
     </strong>
     ：解析过程中
     <strong>
      发生异常
     </strong>
     时触发（例如数据类型不匹配）。
     <br/>
     •
     <strong>
      用途
     </strong>
     ：自定义异常处理逻辑（例如记录错误日志）。
     <br/>
     •
     <strong>
      注意
     </strong>
     ：如果不覆盖此方法，默认会抛出异常并终止解析。
     <br/>
     •
     <strong>
      示例
     </strong>
     ：
    </p>
    <pre><code class="prism language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onException</span><span class="token punctuation">(</span>exception<span class="token operator">:</span> Exception<span class="token punctuation">,</span> context<span class="token operator">:</span>AnalysisContext<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"解析异常: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">exception<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">throw</span> exception <span class="token comment">// 可选择终止或忽略</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_49">
     </a>
     完整的执行流程图
    </h4>
    <p>
     以下是解析一个
     <strong>
      3 行数据
     </strong>
     （含表头）的 Excel 时的典型流程：
    </p>
    <pre><code class="prism language-kotlin">EasyExcel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> User<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">,</span> listener<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">doRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     流程步骤：
    </p>
    <ol>
     <li>
      <strong>
       <code>
        invokeHead
       </code>
      </strong>
      → 解析表头（如果覆盖了该方法）。
     </li>
     <li>
      <strong>
       <code>
        invoke
       </code>
      </strong>
      → 解析第一行数据。
     </li>
     <li>
      <strong>
       <code>
        invoke
       </code>
      </strong>
      → 解析第二行数据。
     </li>
     <li>
      <strong>
       <code>
        invoke
       </code>
      </strong>
      → 解析第三行数据。
     </li>
     <li>
      <strong>
       <code>
        doAfterAllAnalysed
       </code>
      </strong>
      → 整个 Sheet 解析完成。
     </li>
     <li>
      <strong>
       <code>
        onException
       </code>
      </strong>
      → 如果中间某行解析失败，会直接跳转到这里。
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_68">
     </a>
     高级场景：异常处理逻辑
    </h4>
    <p>
     如果某行数据解析失败（例如字段类型不匹配）：
    </p>
    <ol>
     <li>
      <strong>
       <code>
        onException
       </code>
      </strong>
      被触发，处理异常。
     </li>
     <li>
      <strong>
       <code>
        doAfterAllAnalysed
       </code>
      </strong>
      仍然会被调用（即使中途出错）。
     </li>
     <li>
      <strong>
       后续行解析终止
      </strong>
      （默认行为，可通过
      <code>
       context.interrupt()
      </code>
      显式控制）。
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="Kotlin__76">
     </a>
     Kotlin 代码实战示例
    </h4>
    <h5>
     <a id="_77">
     </a>
     监听器完整实现
    </h5>
    <pre><code class="prism language-kotlin"><span class="token keyword">class</span> UserDataListener <span class="token operator">:</span> ReadListener<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">invokeHead</span><span class="token punctuation">(</span>headMap<span class="token operator">:</span> Map<span class="token operator">&lt;</span>Int<span class="token punctuation">,</span> String<span class="token operator">&gt;</span><span class="token punctuation">,</span> context<span class="token operator">:</span> AnalysisContext<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"表头: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">headMap<span class="token punctuation">.</span>values</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">invoke</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token punctuation">,</span> context<span class="token operator">:</span> AnalysisContext<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"处理数据: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">user</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token comment">// 业务逻辑：保存到数据库等</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">doAfterAllAnalysed</span><span class="token punctuation">(</span>context<span class="token operator">:</span> AnalysisContext<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"解析完成，释放资源"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onException</span><span class="token punctuation">(</span>exception<span class="token operator">:</span> Exception<span class="token punctuation">,</span> context<span class="token operator">:</span> AnalysisContext<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"第 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">context<span class="token punctuation">.</span><span class="token function">readRowHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rowIndex</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 行解析失败: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">exception<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token comment">// 继续解析后续行（不抛出异常）</span>
        <span class="token comment">// context.interrupt() // 强制终止解析</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_101">
     </a>
     控制解析行为
    </h5>
    <p>
     •
     <strong>
      终止解析
     </strong>
     ：在
     <code>
      onException
     </code>
     中调用
     <code>
      context.interrupt()
     </code>
     。
     <br/>
     •
     <strong>
      忽略错误继续解析
     </strong>
     ：在
     <code>
      onException
     </code>
     中不抛出异常。
    </p>
    <hr/>
    <h4>
     <a id="_107">
     </a>
     性能优化建议
    </h4>
    <ol>
     <li>
      <strong>
       批量处理
      </strong>
      ：在
      <code>
       invoke
      </code>
      中不要逐条操作数据库，改为批量提交。
     </li>
     <li>
      <strong>
       内存控制
      </strong>
      ：通过
      <code>
       ReadCache
      </code>
      管理缓存数据（默认 100 条）。
     </li>
     <li>
      <strong>
       异步处理
      </strong>
      ：在
      <code>
       invoke
      </code>
      中将数据发送到队列，由后台线程处理。
     </li>
    </ol>
    <hr/>
    <p>
     通过以上规则，你可以精准控制 Excel 解析的生命周期，确保数据处理的可靠性和高性能。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f4c43593133332f:61727469636c652f64657461696c732f313436313638313137" class_="artid" style="display:none">
 </p>
</div>


