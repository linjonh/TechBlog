---
arturl_encode: "68747470733a2f2f626c6f67:2e6373646e2e6e65742f4e69636f6c61734c6561726e65722f:61727469636c652f64657461696c732f313135323639383431"
layout: post
title: "超详细图文介绍,华为桌面云解决方案"
date: 2025-01-06 09:45:00 +08:00
description: "前言华为FusionCloud桌面云解决方案是基于华为云平台的一种虚拟桌面应用，通过在云平台上部署华"
keywords: "云平台虚拟化技术宣传的图片"
categories: ['服务器', '云服务器', '云主机']
tags: ['阿里云', '腾讯云', '华为云', '云服务器', '云服务']
artid: "115269841"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=115269841
    alt: "超详细图文介绍,华为桌面云解决方案"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=115269841
featuredImagePreview: https://bing.ee123.net/img/rand?artid=115269841
---

# 超详细图文介绍，华为桌面云解决方案

## 前言

华为FusionCloud桌面云解决方案是基于
[华为云](https://l.gushuji.site/huawei)
平台的一种虚拟桌面应用，通过在云平台上部署华为桌面云软件，使终端用户通过瘦客户端或者其他设备来访问跨平台的整个客户桌面和应用。

## 桌面云概述

### 传统PC办公缺陷

* 数据安全漏洞
  + 数据在终端本地存储
  + 各种端口难以管控
  + 使用者行为难以约束
  + 电脑失窃导致数据丢失和信息泄露
* 后期运营维护开支巨大
  + 传统PC向员工发放消耗时间长
  + 终端故障现场维护，时间长、效率低
  + 软硬件多种多样，桌面标准化管理困难，不堪重负
  + 传统PC磁盘容易造成个人数据丢失，业务宕机，影响业务运行
* 固话不灵活，利用率低
  + 接入方式固定，影响办公效率
  + 不利于业务信息的有效整合与协同
  + 硬件标准化配置，无法灵活升级
  + 硬件资源固化，空闲时无法复用，资源利用率低下。
      
    ![传统PC办公缺陷](https://i-blog.csdnimg.cn/blog_migrate/520643e23b9a0cf10edd0aae8499b30c.png)

### 信息化时代核心诉求

核心诉求：提升IT系统效率以促进业务发展，保障信息资产安全。
  
![信息化时代核心诉求](https://i-blog.csdnimg.cn/blog_migrate/5b4eac915892b83216d801af23872f11.png)

### 桌面云优势

* 数据安全
  + 终端与数据隔离，防泄密
  + 高可靠性架构，防丢失
* 运维效率（远程协助）
  + 桌面标准化
  + 桌面快速发放，集中运维
* 灵活性
  + 资源按需调整
  + 移动办公
      
    ![桌面云优势](https://i-blog.csdnimg.cn/blog_migrate/49618e11cdfea8919df4b6e8d1dd3278.png)
      
    降低运维成本，但是建设成本可能会提高。
      
    ![桌面云优势](https://i-blog.csdnimg.cn/blog_migrate/b4d00e0a3249aac95ebd972868820d37.png)

### 桌面云应用场景

![桌面云应用场景](https://i-blog.csdnimg.cn/blog_migrate/764075ef06246b83e77a17e5f36fef5c.png)

#### 分支机构

* 简介
    
  企业中除了总部机构需要使用桌面云外，很多分支机构也需要使用桌面云，为了提高分支机构桌面云的用户体验，系统将分支机构桌面云部署在分支机构本地。
* 特点
  + 降低网络使用成本
  + 业务连续不中断
  + 集中运维和管理
      
    ![分支机构](https://i-blog.csdnimg.cn/blog_migrate/670e3ee615c6ed11004da7520dc34a7e.png)

#### 办公

* 简介
    
  企业使用桌面云进行正常的办公活动（如处理邮件、编辑文档等），同时提供多种安全方案，保证办公环境的信息安全。
* 特点
  + 减少投资，平滑过渡
  + 可靠的信息安全机制
  + 部署简单灵活
      
    ![办公](https://i-blog.csdnimg.cn/blog_migrate/e6c119d578a33528b45833f897e55a92.png)

## 华为桌面云解决方案架构

### 桌面云架构VDI与IDV

* VDI：虚拟桌面架构。特点是计算和数据都在云端，集中管理，集中运行。
* IDV：智能桌面虚拟化。特点是镜像集中管理，计算和数据还是在终端，集中管理，分散运行。
    
  ![桌面云架构](https://i-blog.csdnimg.cn/blog_migrate/93940b56f2732365d2db62061a6839b9.png)
    
  VDI与IDV的对比
    
  ![VDI与IDV对比](https://i-blog.csdnimg.cn/blog_migrate/4c7b2e9902592f55163fe446c9042366.png)

### FusionCloud桌面云解决方案逻辑架构

物理硬件上安装FusionSphere服务器虚拟化系统，
  
在服务器虚拟化系统上面安装FusionAccess的软件，
  
FusionAccess的软件根据提前制作好的模版，来发放用户桌面虚拟机，
  
让用户可以通过软件或者硬件的终端，来访问到自己的桌面，
  
管理通过管理维护系统来维护以上所有的内容。
  
![FusionCloud桌面云解决方案逻辑架构](https://i-blog.csdnimg.cn/blog_migrate/1fde65ab0acef97af0deb9f2736e142c.png)
  
**FusionAccess**
  
瘦客户端会跟FusionAccess里面的虚拟机运行HDP协议
  
![FusionCloud桌面云解决方案逻辑架构](https://i-blog.csdnimg.cn/blog_migrate/f185bb37c24401a4dc244959abe750a7.png)

### FusionSphere云平台架构

![FusionSphere云平台总体架构](https://i-blog.csdnimg.cn/blog_migrate/ed2976cc8fed897cb5488bd10a4c302e.png)

## 华为桌面云桌面类型

HDP（Huawei Desktop Protocol）华为自研的新一代云接入桌面协议，相对比于传统的桌面协议，它具备以下特点：

* 最大支持64条虚拟通道，每个虚拟通道可以承载不同的上层应用协议
* 可根据不同的应用类型采用不同的压缩算法，灵活使用服务器渲染及本地加速渲染
* 视频播放更清晰流畅
* 无损压缩算法
* 还原声音细节
* 丰富协议管理策略

### HDP总体架构

![HDP总体架构](https://i-blog.csdnimg.cn/blog_migrate/79baaa4ec6d1c224ced60e6f44421f5c.png)

### 常见桌面协议

* ICA/HDX
  + ICA（Citrix Independent Computing Architecture）是目前应用较多的虚拟桌面协议之一，ICA除了功能齐全之外，还有：
    - 广泛的移动终端支持
    - ICA的网络协议无关性，使其可以支持TCP/IP、NetBOIS和IPX/SPX
    - ICA不仅支持Citrix自家的虚拟化平台XenServer，还支持vSphere和Hyper-V
    - 性能上比较突出的特点是较低的带宽占用，在网络环境差（延迟高）的情况下也能正常使用。
  + HDX（High Definition Experience）作为ICA的增强版，尽量改善用户体验，包括音视频，多媒体和3D，HDX支持H.264。
* PCoIP（PC-over-IP）
    
  最初由加拿大公司Teradici开发，早期定位于高端图形设计，2008年VMware宣布和Teradici共同开发PCoIP，以改进自己的VDI解决方案VMware View。
  + PCoIP和硬件结合紧密，数据的编码和解码，图形的处理可以通过专门的硬件来完成，让CPU有精力来做其他的事情，也有专门集成了PCoIP显示芯片的显示器。
  + PCoIP是基于UDP协议的，UDP传输不可靠，但是UDP没有TCP三次握手复杂的校验和数据恢复，传输速度快，适合多媒体的传输。
  + 原生PCoIP协议没有串并口等外设的的重定向能力，但一些TC厂商通过额外的端口重定向插件弥补了这方面功能的不足。
* SPICE（Simple Protocol for Independent Computing Environment）
  + 一款开源虚拟桌面协议，最初由Qumranet开发，后来被Redhat收购并开源，经过几年的社区开发，SPICE协议不断成熟。
  + SPICE协议对于视频具有一定的优越性，其主要原因还是对于显示信息的压缩处理由KVM完成，避免了GuestOS内由于视频压缩对于CPU的过量消耗。SPICE协议采用无损压缩，所以清晰度较高，缺点是带宽较高，消耗的资源较大。
* RDP/RemoteFX
  + RDP（Remote Desktop Protocol）是微软的远程桌面协议，最初是由Citrix开发，支持的功能较少，且主要应用在Windows环境中，现在也有Mac下的RDP客户端和Linux下的RDP客户端rdesktop。经历多个版本的开发，RDP最新版也支持了打印机重定向，音频重定向，剪贴板共享等功能。
  + RemoteFX是RDP的增强版，提供了vGPU、视频支持、多点触控、USB重定向等功能。

### 常见桌面协议对比

![常见桌面协议对比](https://i-blog.csdnimg.cn/blog_migrate/e2bc69b4b3f303b17a62f103a86023d7.png)

### 桌面协议功能

#### 2D图形显示技术

* 桌面云要实现远程屏幕显示，要通过服务端侧的操作系统接口，抓取屏幕内容，再经过一定的处理后传送到客户端侧显示出来。
* HDP显示关键技术
  + 非自然图像采用无损压缩：自动识别整幅图像中的文字、Windows图框、线条等非自然图像，对非自然图像采用无损压缩；相片、图片等自然图像采用合适的压缩率进行有损压缩。
  + 重复图像数据不传输：自动识别图像中的未变化部分，只有变化的部分数据会传输，极大降低带宽。
  + 支持多种图像压缩算法：支持多种图像压缩算法，可以根据不同的图像特点和场景选择最优的压缩算法。
      
    ![2D图形显示技术](https://i-blog.csdnimg.cn/blog_migrate/6ce296b12a97795e03f9eb21766253a2.png)

#### 语音技术

* 通常桌面协议服务器端可以在虚拟机里面实现一个音频驱动，音频驱动会和Windows的音频子系统（音频引擎）进行交互。
* HDP语音关键技术
  + 高保真Music压缩算法：自动识别声音场景，VoIP场景下采用针对人声优化的电信语音算法，音乐场景采用专业的高保真音乐编码算法，极大提升音乐播放品质。
  + 自动降噪算法：VoIP启动自动降噪来压抑周边嘈杂音和背景声音，即使嘈杂环境也能通话自如。
  + 低延时：采用在TC端语音透传算法，减低语音在TC端由于缓冲带来的积累延迟，保障语音实时性。
  + 高音质：采用更高的声音采样率（默认采用44.1K的采样率，友商一般16K），避免音质源头损失。
  + 立体混音：支持“立体混音”，即虚拟机所有的输入声音饿输出声音的混合。
      
    ![语音技术](https://i-blog.csdnimg.cn/blog_migrate/f56e0a841fa228b51202c1d7d4aef68c.png)

#### 视频显示技术

目前在桌面云中，支持多媒体视频播放，通常有两种方式：

* 将服务器的多媒体视频播放图像重新进行视频编码处理，然后将视频编码数据传输到客户端进行解码播放显示。
* 视频重定向方式，通过捕获服务端播放器需要的视频编码流，直接将视频编码流发送到客户端进行解码播放显示。

HDP协议提供了支持4K视频播放的能力，该能力是通过把视频原始文件解封装后的音频数据包发送到客户端，在客户端直接使用音频数据包进行编码显示。

* 直接使用解封装后的音视频码流，可以降低网络带宽的压力
* 可以降低对服务端计算资源的消耗
* 可以充分应用客户端TC的能力实现4K视频的播放

HDP视频关键技术

* 视频场景智能识别：在Display Server能够自动识别是视频数据还是普通的GDI数据，对于视频数据，采用高效的H.264或MPEG2进行编码，并充分利用TC端硬件能力进行解码。
* 帧率动态调整：根据网络的质量动态调整视频播放的帧率，优先保证视频流畅度。
* 视频数据自适应：根据显示器的分辨率和播放器的窗口大小，自动调整视频数据流的大小，在播放器最小化时终止发数据，几乎没带宽，降低CPU消耗，提升用户体验。
* 多媒体重定向：充分利用TC的硬解码能力，支持断线自动重连播放，流量动态调整，最大支持4K视频播放，流畅度优于ICA。
* 强大的应用感知能力：对常用视频播放软件（flash）和图像处理软件（如Photoshop）进行针对性优化，比ICA更流畅。
    
  ![视频显示技术](https://i-blog.csdnimg.cn/blog_migrate/b8e0e10912206322b115ad68741bcc9c.png)

#### 外设重定向技术

在桌面云场景下，把TC/SC终端侧的外围设备，通过桌面云协议映射到远程桌面中，并能通过远程桌面使用这些外围设备的技术。基于外设技术实现的原理来分，主要有以下两种：

* 端口重定向：是指在远程桌面的操作系统中，针对端口底层协议进行重定向的技术；如USB端口重定向、串口重定向、并口重定向等。（端口下所有的数据信号都需要发给远端，需要远端为设备安装对应的驱动，优势：兼容性好，缺点：对带宽占用较高）
* 设备重定向：是指在远程桌面的操作系统中，针对设备应用协议进行重定向的技术；如摄像头重定向、TWAIN重定向等。（本地客户端可以将摄像头的画面进行捕获，再发给其他设备）

传统PC使用通用的USB设备总线来接入USB设备。
  
![外设重定向技术](https://i-blog.csdnimg.cn/blog_migrate/c52d3244eab4dd5d645cb9277c16b2a6.png)
  
在华为的FusionCompute里面，可以直接在虚拟机中安装USB驱动。
  
![外设重定向技术](https://i-blog.csdnimg.cn/blog_migrate/c4a5a03f68a21ef4568a1c5fe1dfc456.png)
  
摄像头建议使用外设重定向，中间的数据是经过压缩的，并且会尽量选择无损的算法，最大限度保证图形图像的质量。
  
![外设重定向技术](https://i-blog.csdnimg.cn/blog_migrate/d9ec86f589e688abce416af9469c34cf.png)

#### 3D图形显示技术

华为桌面云也推出了相应的解决方案（华为高清制图桌面），能支持多种高清制图软件，根据其3D显示实现原理，主要有如下几大类技术：

* GPU直通
* GPU硬件虚拟化
* 图形工作站纳管
    
  ![3D图形显示技术](https://i-blog.csdnimg.cn/blog_migrate/58249fb06e8eb0c96215bccb546c2b2d.png)

## 华为桌面云部署方案

### 硬件部署方案

华为桌面云解决方案硬件形态

* 桌面云一体机
* 标准桌面云
    
  ![硬件部署方案](https://i-blog.csdnimg.cn/blog_migrate/419dd48fa63f760f2d5912c434295742.png)

华为桌面云解决方案物理部署组网

* 管理网络（管理VRM，管理FusionAccess）
* 业务网络（真正用于传输桌面的流量的网络）
* 存储网络（给CNA的）
    
  ![硬件部署方案](https://i-blog.csdnimg.cn/blog_migrate/7a893a0d40d791d71b041adb28cdf7f5.png)

### 软件部署方案

先了解一些简单的概念：

* 现有IT系统：现有的IT环境，AD服务器、DNS服务器、DHCP服务器。
* 虚拟桌面资源池：用户所使用的云桌面的虚拟机。
* 虚拟应用资源池：应用虚拟化的虚拟机。
    
  用户通过HDA得到想要的画面，返回给HDP Client。
* HDP（Huawei Desktop Protocol）：华为桌面协议。

下面是一些较为复杂的概念：

* WI（Web Interface）：用户接口，用户在登陆到FusionAccess的时候，看到的画面就是由WI所提供。用户输入的用户名和密码，也都是在WI上完成的。
    
  可以发现WI是每个用户都需要用到的，所以需要很多WI来实现需求，那么如何分配资源呢，这就要用到负载均衡。
* 负载均衡分为虚拟负载均衡和硬件负载均衡：
  + vLB：虚拟负载均衡，它的负载均衡方式很简单：轮训。
  + SVN：硬件负载均衡，可以根据每一个WI的负载情况，进行更精确的分担。

那么用户如何连接到虚拟机里呢？
  
分为两种情况：

* 没有用户网关（不安全）
    
  这时候HDP可以直接和虚拟机进行通信。
    
  HDA：华为桌面代理，安装在虚拟机里面的一个工具。
* 有用户网关（软件硬件两种网关）
  + vAG（软件）与虚拟负载均衡一起部署
  + SVN（硬件）

FusionAccess桌面应用管理必选组件：

* HDC：华为桌面控制，有一个集群，用户桌面所有的信息都需要向HDC进行登记和注册，用户的查询也由HDC来进行。
* DB：数据库，HDC会把所有的数据都存放在数据库（DB）中。
* ITA：管理员管理数据所用的组件。
* License：许可服务器，用户登录需要查询授权。

可选组件：

* Backup Server：定期把配置和信息传到备份服务器上。
* TCM：TC Manager，管理瘦终端
    
  ![软件部署方案](https://i-blog.csdnimg.cn/blog_migrate/5d8c489dc3fa0d295d908d912e9ae2a8.png)
    
  ![FusionAccess软件架构](https://i-blog.csdnimg.cn/blog_migrate/e62d5ef1b4315bb94bba5738749725c4.png)

### 时钟同步方案

时钟同步是桌面云系统稳定运行的必备条件，如果时钟不同步，会导致桌面云系统管理混乱，时钟同步保证桌面云系统时钟、虚拟时钟一致：

* 当客户无提供外部时钟源，华为提供AD时，推荐采用AD通过管理平面从FusionCompute的主、备VRM所对应主机同步时间的方案。
* 当由客户提供稳定时钟源的时候，不管AD组件由客户提供还是华为提供，采用客户提供外部时钟源同步方案。

#### 无外部时钟源

![无外部时钟源](https://i-blog.csdnimg.cn/blog_migrate/ca13c6fce3ad363750d645b622794a81.png)

#### 客户提供AD

![客户提供AD](https://i-blog.csdnimg.cn/blog_migrate/8324b4cb38d483c63beb5dc591a8d500.png)

### 网关与负载均衡器部署方案

网关/负载均衡器功能介绍如下：

* 负载均衡器可通过vLB实现该功能，用于将用户的HTTP(S)请求分配到不同的WI能够对WI进行健康检查，确保所有的用户请求都能分配到可用的WI。
* 网关可通过vAG实现该功能，用于业务接入（桌面协议HDP的接入）和自助维护接入，对客户端的接入进行加密保护，提高系统安全性。

vAG、vLB可以进行主备部署，分别放到不同的服务器上。
  
![网关与负载均衡器部署方案](https://i-blog.csdnimg.cn/blog_migrate/fc18d61c3a416e5b675d4301c59e24ac.png)
  
多增加几个vAG，来形成用户集群，多个vAG之间可以起到负载均衡的作用，
  
![网关与负载均衡器部署方案](https://i-blog.csdnimg.cn/blog_migrate/176f3914124304ad65d79c2b40970442.png)
  
![网关与负载均衡器部署方案](https://i-blog.csdnimg.cn/blog_migrate/14dec94d6515632f47b64f4153873eb0.png)