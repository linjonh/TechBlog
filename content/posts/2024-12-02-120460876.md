---
layout: post
title: "易语言调用Python的一种方法通过Socket通信方式"
date: 2024-12-02 15:00:22 +0800
description: "易语言调用Python的一种方法（通过Socket通信方式）*问题的产生很多熟悉E语言的朋友大多是因"
keywords: "易语言调用python"
categories: ['易语言']
tags: ['网络通信', 'Python']
artid: "120460876"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=120460876
    alt: "易语言调用Python的一种方法通过Socket通信方式"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=120460876
featuredImagePreview: https://bing.ee123.net/img/rand?artid=120460876
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     易语言调用Python的一种方法（通过Socket通信方式）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="PythonSocket_0">
     </a>
     <em>
      易语言调用Python的一种方法（通过Socket通信方式）
     </em>
     *
    </h2>
    <h2>
     <a id="_3">
     </a>
     问题的产生
    </h2>
    <p>
     很多熟悉E语言的朋友大多是因为其开发效率高，函数使用方便。然而Python在数据处理，人工智能等领域的优势是易语言无法比拟的。python的pyqt库开发效率和打包体积尚不如易语言。把二者结合能极大提高开发效率和扩展开发能力。
     <br/>
     本文通过建立
     <strong>
      Socket通信方式
     </strong>
     实现E语言和python的连接，E语言作为服务端，python作为客户端，
     <strong>
      E语言程序通过发送固定格式的数据，python收到之后执行函数，最后发送数据返回给E语言
     </strong>
     ，实现调用。
    </p>
    <h3>
     <a id="_8">
     </a>
     易语言代码（服务端）
    </h3>
    <p>
     在这里插入代码片片
    </p>
    <pre><code class="prism language-.版本">.支持库 HPSocket_E
.支持库 spec

.程序集 窗口程序集_启动窗口
.程序集变量 监听器对象句柄, 整数型
.程序集变量 Socket对象句柄, 整数型
.程序集变量 TCP服务端, TCP服务端
.程序集变量 pythonID, 整数型

.子程序 _按钮1_被单击
.局部变量 a, 整数型


TCP服务端.发送数据 (Socket对象句柄, pythonID, “function1|” ＋ 到文本 (a))

.子程序 __启动窗口_将被销毁

' 销毁 Socket 对象
TCP服务端.销毁监听环境 (Socket对象句柄, 假)
Socket对象句柄 ＝ 0
' 销毁监听器对象
TCP服务端.销毁初始环境 (监听器对象句柄)
监听器对象句柄 ＝ 0


.子程序 __启动窗口_创建完毕
.局部变量 szBindAddress, 文本型

监听器对象句柄 ＝ TCP服务端.创建初始环境 ()
调试输出 (监听器对象句柄)
Socket对象句柄 ＝ TCP服务端.创建监听环境 (监听器对象句柄, 假)
调试输出 (Socket对象句柄)
TCP服务端.设置回调事件 (监听器对象句柄, , &amp;客户进入, , , &amp;数据到达, , )
szBindAddress ＝ “0.0.0.0”
.如果 (TCP服务端.启动 (Socket对象句柄, szBindAddress, 54321))
    调试输出 (“$ Server Start OK --&gt; (” ＋ szBindAddress ＋ “ : 54321)”)
.否则
    调试输出 (“$ Server Start Fail --&gt; ”)
.如果结束


.子程序 客户进入, 整数型, , 客户进入
.参数 pSender, 整数型
.参数 dwConnID, 整数型
.参数 soClient, 整数型

pythonID ＝ dwConnID
调试输出 (“客户进入！”, pSender, soClient)
返回 (#事件通知_成功)

.子程序 _按钮2_被单击

TCP服务端.发送数据 (Socket对象句柄, pythonID, “function2|2”)


.子程序 数据到达, 整数型, , 数据到达
.参数 pSender, 整数型
.参数 dwConnID, 整数型
.参数 pData, 整数型, , 数据指针 需通过指针到字节集获取数据
.参数 iLength, 整数型

调试输出 (指针到文本 (pData))


返回 (#事件通知_成功)





</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/aa2d9ed25e5bcbb43133aa1f7df6ac3b.png"/>
    </p>
    <h3>
     <a id="Python_88">
     </a>
     Python代码（客户端）
    </h3>
    <pre><code class="prism language-python">在这里插入代码片
```<span class="token keyword">from</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">import</span> ThreadPoolExecutor
<span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> pyefun <span class="token keyword">as</span> efun
<span class="token comment">#全局赋值--------------</span>
IP <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span>
SERVER_PORT <span class="token operator">=</span> <span class="token number">54321</span>
BUFLEN <span class="token operator">=</span> <span class="token number">1024</span>
Socket_客户端 <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">)</span>
Socket_客户端<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>IP<span class="token punctuation">,</span> SERVER_PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>
Arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token boolean">None</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">#全局赋值--------------</span>

<span class="token keyword">def</span> 返回结果到易语言<span class="token punctuation">(</span>c_Socket<span class="token punctuation">,</span>c_content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    c_Socket<span class="token punctuation">.</span>send<span class="token punctuation">(</span>c_content<span class="token punctuation">)</span>


<span class="token comment"># 定义功能函数---------------------------------------</span>
<span class="token keyword">def</span> <span class="token function">function1</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    efun<span class="token punctuation">.</span>延时<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    返回结果到易语言<span class="token punctuation">(</span>Socket_客户端<span class="token punctuation">,</span> a<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">None</span>
<span class="token keyword">def</span> <span class="token function">function2</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    efun<span class="token punctuation">.</span>延时<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    返回结果到易语言<span class="token punctuation">(</span>Socket_客户端<span class="token punctuation">,</span> a<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">None</span>
<span class="token keyword">def</span> <span class="token function">function3</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    efun<span class="token punctuation">.</span>延时<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    返回结果到易语言<span class="token punctuation">(</span>Socket_客户端<span class="token punctuation">,</span> a<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">None</span>
<span class="token comment"># 定义功能函数---------------------------------------</span>


pool <span class="token operator">=</span> ThreadPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token comment"># 创建一个包含n条线程的线程池</span>
<span class="token keyword">def</span> 投递任务<span class="token punctuation">(</span>c_FuncName<span class="token punctuation">,</span>c_value<span class="token punctuation">)</span><span class="token punctuation">:</span>
    BigBreak<span class="token operator">=</span><span class="token boolean">False</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> Arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> Arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>done<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                    Arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
            <span class="token keyword">if</span> Arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                <span class="token comment">#自己改动区域，添加函数时候在此修改函数名——————————————————</span>
                <span class="token keyword">if</span> c_FuncName<span class="token operator">==</span><span class="token string">"function1"</span><span class="token punctuation">:</span>
                    Arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> pool<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>function1<span class="token punctuation">,</span> c_value<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> c_FuncName<span class="token operator">==</span><span class="token string">"function2"</span><span class="token punctuation">:</span>
                    Arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> pool<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>function2<span class="token punctuation">,</span> c_value<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> c_FuncName <span class="token operator">==</span> <span class="token string">"function3"</span><span class="token punctuation">:</span>
                    Arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> pool<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>function3<span class="token punctuation">,</span> c_value<span class="token punctuation">)</span>
                <span class="token comment"># 自己改动区域，添加函数时候在此修改函数名——————————————————</span>
                BigBreak <span class="token operator">=</span> <span class="token boolean">True</span>
                <span class="token keyword">break</span>
        <span class="token keyword">if</span> BigBreak <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            BigBreak <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">break</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>c_value<span class="token punctuation">)</span>
        efun<span class="token punctuation">.</span>延时<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span><span class="token comment">#主函数</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        接收数据 <span class="token operator">=</span> Socket_客户端<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>BUFLEN<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>  <span class="token comment"># 这里是取回数据的意思</span>
        back_list<span class="token operator">=</span>efun<span class="token punctuation">.</span>分割文本<span class="token punctuation">(</span>接收数据<span class="token punctuation">,</span><span class="token string">"|"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token comment"># print(back_list[0],back_list[1])</span>
        投递任务<span class="token punctuation">(</span>back_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> back_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        back_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">""</span>
        back_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">""</span>
        efun<span class="token punctuation">.</span>延时<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span>
    pool<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span>





</code></pre>
    <h3>
     <a id="_168">
     </a>
     代码逻辑
    </h3>
    <p>
     通过这种通信方式，如果简单的执行python的函数，势必只能进行同步操作，所以在python中加入了线程池（50）条线程，可以达到异步执行函数的效果，最大限度的模拟真实调用。
    </p>
    <h3>
     <a id="_172">
     </a>
     遇到问题
    </h3>
    <p>
     在执行一般程序时，经过测试这种方式可以进行调用，并且稳定性很好，但是当线程池的所有线程全部占用时候，会出现python返回给E语言数据不一致的问题，这个问题暂时没有找到答案，如果有朋友解决了记得评论
    </p>
    <h3>
     <a id="_176">
     </a>
     所用工具
    </h3>
    <p>
     HP-Socket支持库5.4版本 百度能找到
     <a href="https://www.eyuyan.la/post/11777.html" rel="nofollow">
      https://www.eyuyan.la/post/11777.html
     </a>
     <br/>
     Python的pyefun库 、socket 库 自行pip
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031313738393338372f:61727469636c652f64657461696c732f313230343630383736" class_="artid" style="display:none">
 </p>
</div>


