---
layout: post
title: "Python-Flask-和数据库系统交互"
date: 2025-03-10 18:23:26 +0800
description: "全栈网页应用程序需要结构化数据的持久性，因此使用数据库的知识和经验是网页开发的先决条件。为了说明SQLAlchemy库在我们的网页应用程序中的使用，我们将创建一个简单的应用程序来添加、列出和删除数据库表中的学生对象。等ORM库的美妙之处在于，我们可以在 Python 中将数据库模式定义为 Python 类，在 ORM 术语中称为模型。要删除学生，首先，我们使用学生 ID 查询确切的学生实例。我们使用重定向到此 URL 的原因是，我们想在添加新学生后返回最新的学生列表，并重用我们已经实现的。"
keywords: "Python Flask 和数据库系统交互"
categories: ['未分类']
tags: ['数据库', 'Python', 'Flask']
artid: "146160777"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146160777
    alt: "Python-Flask-和数据库系统交互"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146160777
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146160777
cover: https://bing.ee123.net/img/rand?artid=146160777
image: https://bing.ee123.net/img/rand?artid=146160777
img: https://bing.ee123.net/img/rand?artid=146160777
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Python Flask 和数据库系统交互
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="Python_Flask__3">
     </a>
     Python Flask 和数据库系统交互
    </h2>
    <p>
     全栈网页应用程序需要结构化数据的持久性，因此使用数据库的知识和经验是网页开发的先决条件。Python 和Flask 可以与大多数SQL或无SQL数据库系统集成。Python本身附带了一个名为sqlite3的轻量级SQLite数据库。我们将使用SQLite，因为它不需要设置单独的数据库服务器，并且非常适合小规模应用程序。对于生产环境，我们必须使用其他数据库系统，如MySQL、MariaDB或PostgreSQL。为了访问数据库系统并与之交互，我们将使用Flask扩展之一FlaskSQLAlchemy。Flask-SQLAlchemy扩展基于Python的SQLAlchemy库，使该库可用于我们的网页应用程序。SQLAlchemy库提供了一个对象关系映射器（ORM），这意味着它将我们的数据库表映射到Python对象。ORM库的使用不仅加快了开发周期，而且提供了在不更改代码的情况下切换底层数据库系统的灵活性。因此，我们建议使用
     <code>
      SQLAlchemy
     </code>
     或类似的库来处理数据库系统。
    </p>
    <p>
     要从我们的应用程序与任何数据库系统交互，我们需要像往常一样创建Flask应用程序实例。下一步是使用数据库位置的URL（在SQLite3的情况下是一个文件）配置应用程序实例。创建应用程序实例后，我们将通过将其传递给应用程序实例来创建
     <code>
      SQLAlchemy
     </code>
     实例。使用 SQLite 等数据库时，我们只需在第一次初始化数据库。它可以从Python程序启动，但我们不赞成这种方法，以避免每次启动应用程序时都重置数据库。建议使用
     <code>
      SQLAlchemy
     </code>
     实例从命令行初始化数据库一次。在代码示例之后，我们将讨论初始化数据库的确切步骤。
    </p>
    <p>
     为了说明SQLAlchemy库在我们的网页应用程序中的使用，我们将创建一个简单的应用程序来添加、列出和删除数据库表中的学生对象。以下是应用程序的示例代码，用于初始化Flask应用程序和数据库实例（SQLAlchemy实例），以及创建
     <code>
      Student
     </code>
     类的
     <code>
      Model
     </code>
     对象：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 与数据库交互第一部分：创建和删除列表对象</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request<span class="token punctuation">,</span> redirect
<span class="token keyword">from</span> flask_sqlalchemy <span class="token keyword">import</span> SQLAlchemy

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SQLALCHEMY_DATABASE_URI'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'sqlite:///student.db'</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SQLALCHEMY_TRACK_MODIFICATIONS'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>
db <span class="token operator">=</span> SQLAlchemy<span class="token punctuation">(</span>app<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    grade <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'&lt;Student %r&gt;'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name
    
</code></pre>
    <p>
     一旦我们创建了
     <code>
      SQLAlchemy
     </code>
     实例
     <code>
      db
     </code>
     ，我们就可以使用数据库对象。
     <code>
      SQLAlchemy
     </code>
     等ORM库的美妙之处在于，我们可以在 Python 中将数据库模式定义为 Python 类，在 ORM 术语中称为模型。对于我们的代码示例，我们创建了一个类
     <code>
      Student
     </code>
     ，它继承自基类
     <code>
      db.Model
     </code>
     。在这个模型类中，我们定义了
     <code>
      id
     </code>
     、
     <code>
      name
     </code>
     和
     <code>
      grade
     </code>
     属性，这些属性将对应于
     <code>
      SQLite3
     </code>
     数据库实例中数据库表
     <code>
      Student
     </code>
     中的三列。对于每个属性，我们定义了它的数据类型，包括最大长度、是否有主键以及是否可以为空。这些额外的属性定义对于以优化的方式配置数据库表非常重要。
    </p>
    <p>
     在下面的代码片段中，我们将演示一个Python函数
     <code>
      list_students
     </code>
     ，用于从数据库中获取学生对象列表。此函数映射到示例网页应用程序的
     <code>
      /list
     </code>
     URL，它通过在查询实例上使用
     <code>
      all
     </code>
     方法（
     <code>
      db
     </code>
     实例的一个属性）从数据库表返回所有
     <code>
      Student
     </code>
     对象。请注意，查询实例及其方法可以从基类
     <code>
      db.Model
     </code>
     中获得：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 第二部分</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">list_students</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    students_list <span class="token operator">=</span> Student<span class="token punctuation">.</span>query<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'app.html'</span><span class="token punctuation">,</span> students<span class="token operator">=</span>students_list<span class="token punctuation">)</span>
</code></pre>
    <p>
     在下一个代码片段中，我们将编写一个函数（
     <code>
      add_student
     </code>
     ）将学生添加到数据库表中。此函数映射到
     <code>
      /add
     </code>
     URL，并期望使用
     <code>
      GET
     </code>
     方法将学生的姓名和成绩作为请求参数传递。要向数据库中添加新对象，我们将使用必要的属性值创建
     <code>
      Student
     </code>
     类的新实例，然后使用
     <code>
      db.Session
     </code>
     实例通过使用
     <code>
      add
     </code>
     函数添加到 ORM 层。
     <code>
      add
     </code>
     函数本身不会将实例添加到数据库中。我们将使用
     <code>
      commit
     </code>
     方法将其推送到数据库表中。一旦一个新的学生被添加到我们的数据库表中，我们就会将控制重定向到
     <code>
      /list
     </code>
     URL。我们使用重定向到此 URL 的原因是，我们想在添加新学生后返回最新的学生列表，并重用我们已经实现的
     <code>
      list_students
     </code>
     函数。
     <code>
      add_student
     </code>
     函数的完整代码如下：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 第三部分</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">'/add'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add_student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    fname <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token string">'fname'</span>
    lname <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'lname'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    grade <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'grade'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    student <span class="token operator">=</span> Student<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>fname<span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>lname<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> grade<span class="token operator">=</span>grade<span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>student<span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     在这个代码示例的最后一部分，我们将编写一个 Python 函数（
     <code>
      delete_student
     </code>
     ）从数据库表中删除一个学生。此函数映射到
     <code>
      /delete&lt;int:id&gt;
     </code>
     URL。请注意，我们希望客户端发送学生
     <code>
      id
     </code>
     （我们使用
     <code>
      /list
     </code>
     列表请求将其与学生列表一起发送）。要删除学生，首先，我们使用学生 ID 查询确切的学生实例。这是通过在查询实例上使用
     <code>
      filter_by
     </code>
     方法来实现的。一旦我们有了确切的
     <code>
      Student
     </code>
     实例，我们就使用
     <code>
      db.Session
     </code>
     的
     <code>
      delete
     </code>
     方法，然后提交更改。与
     <code>
      add_student
     </code>
     函数一样，我们将客户端重定向到
     <code>
      /list
     </code>
     URL，以向我们的
     <code>
      Jinja
     </code>
     模板返回最新的学生列表：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 第四部分</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">'/delete/&lt;int:id&gt;'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">delete_student</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    todelete <span class="token operator">=</span> Student<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>todelete<span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     为了在浏览器中显示学生列表，我们创建了一个简单的 Jinja 模板（
     <code>
      app.html
     </code>
     ）。
     <code>
      app.html
     </code>
     模板文件将以表格形式提供学生列表。值得注意的是，我们使用 Jinja
     <code>
      for
     </code>
     循环动态构建 HTML 表行，如下面的 Jinja 模板所示：
    </p>
    <pre><code class="prism language-HTML">&lt;!DOCTYPE html&gt;
&lt;body&gt;
  &lt;h2&gt;Students&lt;/h2&gt;
  {% if students|length &gt; 0 %}
  &lt;table&gt;
    &lt;thead&gt;
      &lt;tr&gt;
        &lt;th scope="col"&gt;SNo&lt;/th&gt;
        &lt;th scope="col"&gt;name&lt;/th&gt;
        &lt;th scope="col"&gt;grade&lt;/th&gt;
      &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
      {% for student in students %}
      &lt;tr&gt;
        &lt;th scope="row"&gt;{<!-- -->{student.id}}&lt;/th&gt;
        &lt;td&gt;{<!-- -->{student.name}}&lt;/td&gt;
        &lt;td&gt;{<!-- -->{student.grade}}&lt;/td&gt;
      &lt;/tr&gt;
      {% endfor %}
    &lt;/tbody&gt;
  &lt;/table&gt;
  {% endif %}
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
    <p>
     在启动此应用程序之前，我们应该一次性初始化数据库模式。这可以通过使用 Python 程序来实现，但我们必须确保代码只执行一次，或者只在数据库尚未初始化时执行。推荐的方法是使用 Python shell 手动执行此步骤。在 Python shell 中，我们可以从应用程序模块导入
     <code>
      db
     </code>
     实例，然后使用
     <code>
      db.create_all
     </code>
     方法根据程序中定义的模型类初始化数据库。以下是我们的应用程序用于数据库初始化的示例命令：
    </p>
    <pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> app5 <span class="token keyword">import</span> db
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> db<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     这些命令将在程序所在的同一目录中创建一个
     <code>
      student.db
     </code>
     文件。要重置数据库，我们可以删除
     <code>
      student.db
     </code>
     文件并重新运行初始化命令，也可以使用 Python shell 中的
     <code>
      db.drop_all
     </code>
     方法。
    </p>
    <p>
     我们可以使用 curl 实用程序或通过浏览器使用以下 URL 测试应用程序：
    </p>
    <pre><code>http://localhost:5000/list
http://localhost:5000/add?fname=John&amp;Lee=asif&amp;grade=9
http://localhost:5000/delete/&lt;id&gt;
</code></pre>
    <p>
     &lt;完&gt;
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e637364:6e2e6e65742f646f7768696c6570726f6772616d6d696e672f:61727469636c652f64657461696c732f313436313630373737" class_="artid" style="display:none">
 </p>
</div>


