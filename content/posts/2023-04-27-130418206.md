---
layout: post
title: ç½‘å®‰ç­‰ä¿-å›½äº§Linuxæ“ä½œç³»ç»Ÿé“¶æ²³éº’éºŸKylinOS-V10SP3å¸¸è§„é…ç½®ç³»ç»Ÿä¼˜åŒ–ä¸å®‰å…¨åŠ å›ºåŸºçº¿å®è·µæ–‡æ¡£...
date: 2023-04-27 18:08:19 +0800
categories: ['ç½‘ç»œå®‰å…¨æ”»é˜²ç­‰ä¿å®è·µ']
tags: ['é“¶æ²³éº’éºŸ', 'ç½‘ç»œå®‰å…¨', 'ç³»ç»Ÿå®‰å…¨', 'Linux', 'Kylinos']
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=130418206
    alt: ç½‘å®‰ç­‰ä¿-å›½äº§Linuxæ“ä½œç³»ç»Ÿé“¶æ²³éº’éºŸKylinOS-V10SP3å¸¸è§„é…ç½®ç³»ç»Ÿä¼˜åŒ–ä¸å®‰å…¨åŠ å›ºåŸºçº¿å®è·µæ–‡æ¡£...
artid: 130418206
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=130418206
featuredImagePreview: https://bing.ee123.net/img/rand?artid=130418206
---
<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ç½‘å®‰ç­‰ä¿-å›½äº§Linuxæ“ä½œç³»ç»Ÿé“¶æ²³éº’éºŸKylinOS-V10SP3å¸¸è§„é…ç½®ã€ç³»ç»Ÿä¼˜åŒ–ä¸å®‰å…¨åŠ å›ºåŸºçº¿å®è·µæ–‡æ¡£...
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <div id="js_content">
     <p style="text-align:center;">
      æ¬¢è¿å…³æ³¨ã€Œ
      <strong>
       <strong>
        å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—
       </strong>
      </strong>
      ã€å…¬ä¼—å·
     </p>
     <p style="text-align:center;">
      ç‚¹å‡» ğŸ‘‡
      <strong>
       ä¸‹æ–¹å¡ç‰‡
      </strong>
      å³å¯å…³æ³¨æˆ‘å“Ÿ!
     </p>
     <p style="text-align:center;">
      è®¾ä¸º
      <strong>
       ã€Œ
      </strong>
      <strong>
       æ˜Ÿæ ‡â­
      </strong>
      <strong>
       ã€
      </strong>
      æ¯å¤©å¸¦ä½ 
      <strong>
       åŸºç¡€å…¥é—¨
      </strong>
      åˆ°
      <strong>
       è¿›é˜¶å®è·µ
      </strong>
      å†åˆ°
      <strong>
       æ”¾å¼ƒå­¦ä¹ 
      </strong>
      ï¼
     </p>
     <p style="text-align:center;">
      <strong>
       â€œ
      </strong>
      <strong>
       èŠ±å¼€å ªæŠ˜ç›´é¡»æŠ˜ï¼Œè«å¾…æ— èŠ±ç©ºæŠ˜æ
      </strong>
      <strong>
       ã€‚
      </strong>
      <strong>
      </strong>
      <strong>
       â€
      </strong>
     </p>
     <hr/>
     <p style="text-align:center;">
      ä½œè€…ä¸»é¡µï¼š[Â https://www.weiyigeek.topÂ ]
     </p>
     <p style="text-align:center;">
      åšå®¢ï¼š[Â https://blog.weiyigeek.topÂ ]
     </p>
     <p style="text-align:center;">
      ä½œè€…ç­”ç–‘å­¦ä¹ äº¤æµç¾¤ï¼šè¯·å…³æ³¨å…¬ä¼—å·åå›å¤ã€
      <strong>
       å­¦ä¹ äº¤æµç¾¤
      </strong>
      ã€‘
     </p>
     <hr/>
     <p>
      <strong>
       æœ¬ç« ç›®å½•ï¼š
      </strong>
     </p>
     <p>
      <strong>
       0x00 å‰è¨€ç®€è¿°
      </strong>
     </p>
     <p>
      <strong>
       0x01 å¸¸è§„é…ç½®
      </strong>
     </p>
     <ul>
      <li>
       <ul>
        <li>
         <p>
          1.ä¸»æœºIPåœ°å€ä¸ç½‘å…³è®¾ç½®
         </p>
        </li>
        <li>
         <p>
          2.ä¸»æœºDNSé…ç½®
         </p>
        </li>
        <li>
         <p>
          3.é•œåƒæºé…ç½®
         </p>
        </li>
        <li>
         <p>
          4.å¸¸è§„è¿ç»´å·¥å…·å®‰è£…åŠç³»ç»Ÿå‡çº§
         </p>
        </li>
        <li>
         <p>
          5.ç³»ç»Ÿæ—¶é—´æ—¶åŒºåŒæ­¥é…ç½®
         </p>
        </li>
       </ul>
      </li>
     </ul>
     <p>
      <strong>
       0x02 ç³»ç»Ÿä¼˜åŒ–
      </strong>
     </p>
     <ul>
      <li>
       <ul>
        <li>
         <p>
          1.åˆ›å»ºswapç³»ç»Ÿåˆ†åŒºé…ç½®
         </p>
        </li>
        <li>
         <p>
          2.ç³»ç»Ÿèµ„æºå¥æŸ„æ•°ä¼˜åŒ–é…ç½®
         </p>
        </li>
        <li>
         <p>
          3.ç³»ç»Ÿå¸¸è§„å†…æ ¸å‚æ•°ä¼˜åŒ–é…ç½®
         </p>
        </li>
        <li>
         <p>
          4.ç³»ç»ŸæœåŠ¡ä¼˜åŒ–é…ç½®
         </p>
        </li>
       </ul>
      </li>
     </ul>
     <p>
      <strong>
       0x03 å®‰å…¨åŠ å›º
      </strong>
     </p>
     <ul>
      <li>
       <ul>
        <li>
         <p>
          1.è¿œç¨‹ç™»å½•ä¸»æœºæç¤ºä¿¡æ¯
         </p>
        </li>
        <li>
         <p>
          2.è¿œç¨‹ç™»å½•ä¸»æœºç³»ç»Ÿä¿¡æ¯
         </p>
        </li>
        <li>
         <p>
          3.è¿œç¨‹ç™»å½•sshdæœåŠ¡å®‰å…¨ç­–ç•¥é…ç½®
         </p>
        </li>
        <li>
         <p>
          4.ç³»ç»Ÿè´¦æˆ·å®‰å…¨ç­–ç•¥é…ç½®
         </p>
        </li>
        <li>
         <p>
          5.ç³»ç»Ÿè´¦æˆ·å¯†ç æ›´æ”¹åŠè¿‡æœŸç­–ç•¥é…ç½®
         </p>
        </li>
        <li>
         <p>
          6.ç³»ç»Ÿç”¨æˆ·å¯†ç å¤æ‚æ€§ç­–ç•¥é…ç½®
         </p>
        </li>
        <li>
         <p>
          7.ç³»ç»Ÿç”¨æˆ·ç™»å½•å¤±è´¥ç­–ç•¥é…ç½®
         </p>
        </li>
        <li>
         <p>
          8.ç³»ç»Ÿç”¨æˆ·su/sudoæƒé™ç­–ç•¥é…ç½®
         </p>
        </li>
        <li>
         <p>
          8.ç³»ç»Ÿæ–‡ä»¶æƒé™ç­–ç•¥é…ç½®
         </p>
        </li>
        <li>
         <p>
          9.ç³»ç»Ÿgrubå¼•å¯¼å®‰å…¨ç­–ç•¥é…ç½®
         </p>
        </li>
        <li>
         <p>
          10.ç³»ç»Ÿç”¨æˆ·å†å²å‘½ä»¤è®°å½•ç­–ç•¥é…ç½®
         </p>
        </li>
        <li>
         <p>
          11.ç³»ç»Ÿå®‰å…¨æ—¥å¿—äº‹ä»¶è®°å½•ç­–ç•¥é…ç½®
         </p>
        </li>
        <li>
         <p>
          12.ç³»ç»Ÿå®¡è®¡è§„åˆ™å®‰å…¨ç­–ç•¥é…ç½®
         </p>
        </li>
        <li>
         <p>
          13.é…ç½®ç¦ç”¨ç³»ç»Ÿéå¿…é¡»åˆ«åç­–ç•¥
         </p>
        </li>
        <li>
         <p>
          14.é…ç½®ç¦ç”¨æ¡Œé¢ç³»ç»Ÿç­–ç•¥
         </p>
        </li>
        <li>
         <p>
          15.é…ç½®ç¦ç”¨Ctrl+Alt+Delé‡å¯ç³»ç»Ÿ
         </p>
        </li>
        <li>
         <p>
          16.é…ç½®rmåˆ é™¤å›æ”¶ç«™ç­–ç•¥
         </p>
        </li>
        <li>
         <p>
          17.é…ç½®æ¸…é™¤ä¸´æ—¶æ–‡ä»¶ç­–ç•¥
         </p>
        </li>
        <li>
         <p>
          18.é…ç½®ç³»ç»Ÿé˜²ç«å¢™ç­–ç•¥
         </p>
        </li>
        <li>
         <p>
          19.é…ç½®é‡å¯æœåŠ¡å™¨ç­–ç•¥
         </p>
        </li>
       </ul>
      </li>
     </ul>
     <h3>
      0x00 å‰è¨€ç®€è¿°
     </h3>
     <p>
      æè¿°: éšç€å›½å®¶è¦æ±‚å„æ”¿åºœéƒ¨é—¨åŠäº‹ä¼ä¸šå•ä½æœåŠ¡å™¨ç³»ç»Ÿå›½äº§åŒ–ï¼Œè¶Šæ¥è¶Šå¤šçš„çš„ä¼ä¸šå•ä½é€æ­¥å¼•è¿›å›½äº§åŒ–Linuxæ“ä½œç³»ç»Ÿ(
      <code>
       å¤§è¶‹åŠ¿
      </code>
      )ï¼Œåœ¨ä¼—å¤šå›½äº§æ“ä½œç³»ç»Ÿä¸­
      <code>
       é“¶æ²³éº’éºŸï¼ˆKylinOSï¼‰ã€ä¸­ç§‘æ–¹å¾·ã€ç»Ÿä¿¡UOS
      </code>
      ï¼Œæ­¤ä¸‰å®¶æŒç»­ç‰ˆæœ¬è¿­ä»£è¶…15å¹´çš„å…¶ç”Ÿæ€å¸‚åœºåŠå æœ‰ç‡æœ€é«˜, é™¤æ­¤ä¹‹å¤–çº¢æ——Linuxã€å…±åˆ›Linuxã€å‡æ€ç£çŸ³ã€æ–°æ”¯ç‚¹ã€æ·±åº¦Linuxã€Start OSã€æ€æ™®æ“ä½œç³»ç»Ÿã€äº‘é’ˆOSã€é¸¿è’™OSã€YunOSã€OpenCloudOSç­‰å›½äº§æ“ä½œç³»ç»Ÿã€‚
     </p>
     <p>
      æ­¤å¤„ç”±äºæˆ‘ä»¬ä¼ä¸šä¸­æ˜¯è¯•ç”¨çš„é“¶æ²³éº’éºŸï¼ˆKylinOSï¼‰V10 SP3 ç‰ˆæœ¬çš„å›½äº§ç³»ç»Ÿï¼Œä¸ºäº†è¯•ç”¨è¯¥ç³»ç»Ÿæ˜¯å¦å¯ä»¥æ‰¿è½½ç°æœ‰ä¸šåŠ¡ï¼Œä»¥åŠæ»¡è¶³ç½‘ç»œå®‰å…¨ç­‰ä¿2.0ä¸»æœºå®‰å…¨é…ç½®è¦æ±‚ï¼Œé‚é’ˆå¯¹è¯¥ç³»ç»Ÿè¿›è¡Œå®‰å…¨åŠ å›ºåŠå¸¸è§„åˆå§‹åŒ–æ“ä½œï¼Œè®¾ç½®å®‰å…¨åŸºçº¿é•œåƒï¼Œä»¥ä¿è¯åŸºç¡€ä¸šåŠ¡è¿è¡Œç¯å¢ƒå®‰å…¨ã€‚
     </p>
     <p>
      è¿™é‡Œä½œè€…å°±ä¸åœ¨é’ˆå¯¹é“¶æ²³éº’éºŸï¼ˆKylinOSï¼‰çš„å›½äº§ç³»ç»Ÿè¿›è¡Œè¯¦ç»†ä»‹ç»ä¸ä¸‹è½½å®‰è£…è®²è§£ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥å‚ç…§ã€
      <strong>
       1.å›½äº§é“¶æ²³éº’éºŸV10æœåŠ¡å™¨æ“ä½œç³»ç»ŸåŸºç¡€çŸ¥è¯†ä¸å®‰è£…å®è·µ
      </strong>
      ã€‘(Â https://blog.weiyigeek.top/2023/3-21-725.htmlÂ ) æ­¤æ–‡ã€‚
     </p>
     <p>
      å¥½çš„åºŸè¯ä¸å¤šè¯´ï¼Œæ­¤å¤„æˆ‘å°†å…¶åˆ†ä¸ºä¸‰ä¸ªç« èŠ‚ï¼Œç¬¬ä¸€ä¸ªç« èŠ‚æ˜¯åˆå§‹åŒ–è¿ç»´å¸¸è§„é…ç½®ï¼Œç¬¬äºŒä¸ªç« èŠ‚æ˜¯ç³»ç»Ÿå†…æ ¸ä¼˜åŒ–ï¼Œç¬¬ä¸‰ä¸ªç« èŠ‚å®‰å…¨åŠ å›ºï¼Œæ­¤å¤„æˆ‘å·²ç»å°†å…¶å†™æˆshellè„šæœ¬å¯ä»¥ç›´æ¥è¿è¡ŒåŠ å›ºå¤§å¤§çš„èŠ‚çœäº†æˆ‘ä»¬è¿ç»´äººçš„æ—¶é—´ï¼Œæœ€åæˆ‘ä¼šå°†å®‰å…¨åŠ å›ºshellè„šæœ¬ï¼ˆ
      <strong>
       éƒ¨åˆ†é€‚ç”¨äºCentOS7æ“ä½œç³»ç»Ÿ
      </strong>
      ï¼‰æ”¾åœ¨æ–‡ç« æœ«å°¾, ä»¥ä¾›å„ä½çœ‹å‹ä½¿ç”¨å®è·µå‚è€ƒï¼Œè‹¥æœ‰é”™è¯¯æ¬¢è¿åœ¨ã€
      <strong>
       å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—
      </strong>
      ã€‘å…¬ä¼—å·ç•™è¨€ã€‚
     </p>
     <p>
      è‹¥éœ€è§‚çœ‹è§†é¢‘å®è·µæ¼”ç¤ºï¼Œè¯·åœ¨ã€
      <code>
       å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—
      </code>
      ã€‘å…¬ä¼—å·ä¸­å›å¤ã€
      <code>
       kylinoså®‰å…¨è„šæœ¬
      </code>
      ã€‘æˆ–ã€
      <code>
       10002
      </code>
      ã€‘å…³é”®å­—ã€‚
     </p>
     <p>
      æ¸©é¦¨æç¤º: åœ¨è¿›è¡Œæ“ä½œæ—¶è¯·æ³¨æ„å¤‡ä»½æ“ä½œæ–‡ä»¶ï¼Œä»¥ä¾¿äºå¼‚å¸¸æ—¶åŠæ—¶å›é€€ã€‚
     </p>
     <p>
      æ¸©é¦¨æç¤º: æ­¤å¤„ä¸ºäº†é˜²æ­¢ä¼¸æ‰‹å…šï¼Œä»¥åŠå°Šé‡ä½œè€…ç¼–å†™è„šæœ¬åŠå®è·µæˆæœï¼Œè±¡å¾æ€§çš„è®¾ç½®ä¸ºæ”¶è´¹æ–‡ç« ï¼Œå¸Œæœ›å¤§å®¶ç†è§£æ”¯æŒï¼
     </p>
     <p>
      å®Œæ•´åŸæ–‡:
      <a class="has-card" href="https://mp.weixin.qq.com/s/eBF_Q-WkiZHKGdEG1MODNQ" rel="nofollow" title="ç½‘å®‰ç­‰ä¿-å›½äº§Linuxæ“ä½œç³»ç»Ÿé“¶æ²³éº’éºŸKylinOS-V10SP3å¸¸è§„é…ç½®ã€ç³»ç»Ÿä¼˜åŒ–ä¸å®‰å…¨åŠ å›ºåŸºçº¿å®è·µæ–‡æ¡£">
       <span class="link-card-box">
        <span class="link-title">
         ç½‘å®‰ç­‰ä¿-å›½äº§Linuxæ“ä½œç³»ç»Ÿé“¶æ²³éº’éºŸKylinOS-V10SP3å¸¸è§„é…ç½®ã€ç³»ç»Ÿä¼˜åŒ–ä¸å®‰å…¨åŠ å›ºåŸºçº¿å®è·µæ–‡æ¡£
        </span>
        <span class="link-desc">
         éšç€å›½å®¶è¦æ±‚å„æ”¿åºœéƒ¨é—¨åŠäº‹ä¼ä¸šå•ä½æœåŠ¡å™¨ç³»ç»Ÿå›½äº§åŒ–ï¼Œè¶Šæ¥è¶Šå¤šçš„çš„ä¼ä¸šå•ä½é€æ­¥å¼•è¿›å›½äº§åŒ–Linuxæ“ä½œç³»ç»Ÿ(`å¤§è¶‹åŠ¿`)ï¼Œæ­¤å¤„æˆ‘å°†é’ˆå¯¹é“¶æ²³éº’éºŸå›½äº§æ“ä½œç³»ç»ŸKylinOS-V10SP3ç‰ˆæœ¬è¿›è¡Œå®‰å…¨åŠ å›ºåŠå¸¸è§„åˆå§‹åŒ–æ“ä½œï¼Œå¤åˆç­‰ä¿ä¸‰çº§ä¸»æœºå®‰å…¨è¦æ±‚ã€‚
        </span>
        <span class="link-link">
         <img alt="" class="link-link-icon" src="https://i-blog.csdnimg.cn/blog_migrate/aace7af9b4cf9ef918e2e8591ffc7a2b.png">
          https://mp.weixin.qq.com/s/eBF_Q-WkiZHKGdEG1MODNQ
         </img>
        </span>
       </span>
      </a>
     </p>
     <p style="text-align:center;">
      <img alt="e8ab7bb275f776a1754e130595a25cfc.jpeg" src="https://i-blog.csdnimg.cn/blog_migrate/03580bbd511c66c0e936287f60e16e1b.jpeg"/>
     </p>
     <hr/>
     <p>
      0x01 å¸¸è§„é…ç½®
     </p>
     <p>
      1.ä¸»æœºIPåœ°å€ä¸ç½‘å…³è®¾ç½®
     </p>
     <p>
      æè¿°: ä¸€å°æ–°å®‰è£…çš„ä¸»æœºå¿…é¡»é…ç½®IPåœ°å€æ‰èƒ½æ–¹ä¾¿æˆ‘ä»¬é€šè¿‡è¿œç¨‹è¿æ¥ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥è‚¯å®šæ˜¯æŠŠç½‘ç»œæ‰“é€šï¼Œä¸»è¦æ ¹æ®é…ç½®çš„IPåœ°å€ä¸ç½‘ç»œåœ°å€ç¯å¢ƒå˜é‡è¿›è¡Œå¯¹åº”è®¾ç½®ï¼Œä¾‹å¦‚ä¸‹è¿°éƒ¨åˆ†è„šæœ¬ç‰‡æ®µã€‚
     </p>
     <pre class="has"><code class="language-go"># Modify the IP/MASK and Gateway
VAR_NETINTERFACE=ens192
VAR_IP=192.168.4.201/24
VAR_GATEWAY=192.168.4.1

if [ ! -f /opt/init/ ];then 
  mkdir -vp /opt/init/
sudo tee /opt/init/network.sh &lt;&lt;'EOF'
#!/bin/bash
# @Author: WeiyiGeek
# @Description: Configure KylinOS / CentOS Linux Server Network
# @E-mail: master@weiyigeek.top
# @Blog: https://www.weiyigeek.top
if [[ $# -lt 4 ]];then
  echo "Usage: $0 NetInterface IP/NETMASK GATEWAY DNS"
  echo "Example: $0 ens192 192.168.12.12/24 192.168.12.1 223.6.6.6"
  echo "@Author: WeiyiGeek"
  echo "@Blog: https://blog.weiyigeek.top"
  exit
fi
echo "Setting Network interface card: ${1}, IP: ${2} , GATEWAY: ${3}"
CURRENT_IP=$(hostname -I | cut -f 1 -d " ")
CURRENT_GATEWAY=$(hostname -I | cut -f 1,2,3,4 -d ".")
CURRENT_FILE=/etc/sysconfig/network-scripts/ifcfg-${1}
CONFIG_IP=${2%%/*}
CONFIG_PREFIX=${2##*/}

echo "Original Network info: IP: ${CURRENT_IP} , GATEWAY: ${CURRENT_GATEWAY}"
echo "Setting Network interface card: ${1}, IP/NETMASK: ${2} , GATEWAY: ${3}, DNS: ${4}"

if [[ -f ${CURRENT_FILE} ]];then
  # å·²å­˜åœ¨ç½‘å¡é…ç½®æ–‡ä»¶çš„æƒ…å†µä¸‹
  egrep -q "^\s*ONBOOT=.*$" ${CURRENT_FILE} &amp;&amp; sed -ri "s/^\s*ONBOOT=.*$/ONBOOT=yes/" ${CURRENT_FILE}|| echo "ONBOOT=yes" &gt;&gt; ${CURRENT_FILE}
  egrep -q "^\s*BOOTPROTO=.*$" ${CURRENT_FILE} &amp;&amp; sed -ri "s/^\s*BOOTPROTO=.*$/BOOTPROTO=static/" ${CURRENT_FILE}|| echo "BOOTPROTO=static" &gt;&gt; ${CURRENT_FILE}
  egrep -q "^\s*IPADDR=.*$" ${CURRENT_FILE} &amp;&amp; sed -ri "s/^\s*IPADDR=.*$/IPADDR=${CONFIG_IP}/" ${CURRENT_FILE}|| echo "IPADDR=${CONFIG_IP}" &gt;&gt; ${CURRENT_FILE}
  egrep -q "^\s*PREFIX=.*$" ${CURRENT_FILE} &amp;&amp; sed -ri "s/^\s*PREFIX=.*$/PREFIX=${CONFIG_PREFIX}/" ${CURRENT_FILE}|| echo "PREFIX=${CONFIG_PREFIX}" &gt;&gt; ${CURRENT_FILE}
  egrep -q "^\s*GATEWAY=.*$" ${CURRENT_FILE} &amp;&amp; sed -ri "s/^\s*GATEWAY=.*$/GATEWAY=${3}/" ${CURRENT_FILE}|| echo "GATEWAY=${3}" &gt;&gt; ${CURRENT_FILE}
  egrep -q "^\s*DNS1=.*$" ${CURRENT_FILE} &amp;&amp; sed -ri "s/^\s*DNS1=.*$/DNS1=${4}/" ${CURRENT_FILE}|| echo "DNS1=${4}" &gt;&gt; ${CURRENT_FILE}
else
  nmcli dev show ${1}
  nmcli conn add connection.id ${1}-staic connection.interface-name ${1} connection.autoconnect yes type Ethernet ifname ${1} ipv4.method manual ipv4.address ${2} ipv4.gateway ${3} ipv4.dns ${4} ipv4.ignore-auto-dns true
fi
sudo nmcli c reload

read -t 5 -p "Heavy load network card, It is recommended to enter N during initialization (Y/N): " VERTIFY
if [[ ${VERIFY:="N"} == "Y" || ${VERIFY:="N"} == "y" ]]; then
  sudo nmcli c up ${1}
  sudo nmcli d reapply ${1}
else
  echo "Please reload the network card manually, run sudo nmcli d reapply ${1}."
fi
EOF

# æƒé™èµ‹äºˆ
sudo chmod +x /opt/init/network.sh
# è„šæœ¬æ‰§è¡Œ
/opt/init/network.sh ${VAR_NETINTERFACE} ${VAR_IP} ${VAR_GATEWAY} ${VAR_DNS_SERVER}</code></pre>
     <h4>
      2.ä¸»æœºDNSé…ç½®
     </h4>
     <p>
      æè¿°: å®ŒæˆIPåœ°å€çš„é…ç½®åï¼Œæˆ‘ä¾¿éœ€è¦ä¸ºä¸»æœºé…ç½®ç§æœ‰DNSæˆ–è€…å…¬å…±çš„DNSï¼Œä»¥ä¾¿å¯ä»¥è§£æå¤–éƒ¨åŸŸåã€‚
     </p>
     <pre class="has"><code class="language-go"># Show  Script Execute result (Y/N)
VAR_VERIFY_RESULT=Y
# Modify the DNS server
# DNSPod: 119.29.29.29      Alidns: 223.5.5.5 223.6.6.6
# Google: 8.8.8.8 8.8.4.4   Cloudflare: 1.1.1.1 1.0.0.1
# Baidu: 114.114.114.114
# Internal : Your intranet domain name resolution server
VAR_DNS_SERVER=( "223.5.5.5" "114.114.114.114"  "192.168.4.254")

local flag
# æ­¤å¤„é…ç½®çš„æ˜¯ç™¾åº¦IPV4 DNSä¸é˜¿é‡Œäº‘IPV6 DNS
sed -i -e "s/^#FallbackDNS=.*/FallbackDNS=114.114.114.114 2400:3200::1 2400:3200:baba::1/" -e "s/^#DNSSEC=.*/DNSSEC=allow-downgrade/" -e "s/^#DNSOverTLS=.*/DNSOverTLS=opportunistic/" /etc/systemd/resolved.conf

for dns in ${VAR_DNS_SERVER[@]};do 
  grep -q "${dns}" /etc/systemd/resolved.conf 
  if [ $? != 0 ];then  
    echo "nameserver ${dns}"
    sed -i "/#DNS=/i DNS=${dns}" /etc/systemd/resolved.conf;
  fi
done

systemctl restart systemd-resolved &amp;&amp; systemctl enable systemd-resolved

find /etc/resolv.conf -delete
ln -s /run/systemd/resolve/resolv.conf /etc/resolv.conf

if [[ ${VERIFY:="N"} == "Y" || ${VERIFY:="N"} == "y" ]]; then
  grep -Ev '^#|^$' /etc/resolv.conf | uniq
  echo
  grep -Ev '^#|^$' /etc/systemd/resolved.conf | uniq
fi</code></pre>
     <h4>
      3.é•œåƒæºé…ç½®
     </h4>
     <p>
      æè¿°: ä½¿ç”¨å›½å¤–çš„æ“ä½œç³»ç»Ÿï¼Œä¾‹å¦‚
      <code>
       CentOSã€Ubuntuã€Debianã€Alpine
      </code>
      ç­‰æ“ä½œç³»ç»Ÿï¼Œé€šå¸¸ä¸ºäº†åŠ å¿«Linuxç³»ç»Ÿä¸­ä¸‹è½½å®‰è£…è½¯ä»¶çš„é€Ÿåº¦ï¼Œæˆ‘ä»¬æ˜¯éœ€è¦é…ç½®è½¯ä»¶é•œåƒæºï¼Œæ­¤å¤„ç”±äºæˆ‘ä»¬æ˜¯å›½äº§æ“ä½œç³»ç»Ÿï¼Œå…¶è½¯ä»¶æ›´æ–°æºä¹Ÿè‚¯å®šæ˜¯åœ¨å›½å†…ï¼Œæ‰€ä»¥é€šå¸¸æ— éœ€è°ƒæ•´ã€‚
     </p>
     <p>
      ä½†æ­¤å¤„ä¸ºäº†é˜²æ­¢å°ä¼™ä¼´ä»¬æ›´æ”¹è¿‡è¯¥é•œåƒæºï¼Œæˆ‘ä¹Ÿå°†å„å‘è¡Œç‰ˆé•œåƒæºé…ç½®ç½—åˆ—å‡ºæ¥ã€‚
     </p>
     <pre class="has"><code class="language-go">local release
  cp /etc/yum.repos.d/kylin_x86_64.repo ${BACKUPDIR}
  # 1.æ ¹æ®ä¸»æœºå‘è¡Œç‰ˆè®¾ç½®
  # (Tercel) ç‰ˆæœ¬æ˜¯ éº’éºŸ V10 SP1 ç‰ˆæœ¬ï¼Œ
  # (Sword)  ç‰ˆæœ¬æ˜¯ éº’éºŸ V10 SP2 ç‰ˆæœ¬ï¼Œ
  # (Lance)  ç‰ˆæœ¬æ˜¯ éº’éºŸ V10 SP3 ç‰ˆæœ¬ï¼Œ
  release=$(grep -e "^VERSION=" /etc/os-release | cut -f 2 -d "=" | tr -d '[:punct:][:space:]')

if [ ${release} == "V10Lance" ];then
sudo tee /etc/yum.repos.d/kylin_x86_64.repo &lt;&lt;'EOF'
### Kylin Linux Advanced Server 10 (SP3) - os repo ###
[ks10-adv-os]
name = Kylin Linux Advanced Server 10 - Os
baseurl = https://update.cs2c.com.cn/NS/V10/V10SP3/os/adv/lic/base/$basearch/
gpgcheck = 1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-kylin
enabled = 1

[ks10-adv-updates]
name = Kylin Linux Advanced Server 10 - Updates
baseurl = https://update.cs2c.com.cn/NS/V10/V10SP3/os/adv/lic/updates/$basearch/
gpgcheck = 1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-kylin
enabled = 1

[ks10-adv-addons]
name = Kylin Linux Advanced Server 10 - Addons
baseurl = https://update.cs2c.com.cn/NS/V10/V10SP3/os/adv/lic/addons/$basearch/
gpgcheck = 1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-kylin
enabled = 0
EOF
  # echo "7" &gt; /etc/yum/vars/centos_version
  # wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
  elif [ ${release} == "V10Sword" ];then
    echo "æš‚æœªä½¿ç”¨éº’éºŸ V10 Sword SP2 ç‰ˆæœ¬ï¼Œè¯·è‡ªè¡Œç™¾åº¦æœç´¢,é•œåƒæº!"
  elif [ ${release} == "V10Tercel" ];then
    echo "æš‚æœªä½¿ç”¨éº’éºŸ V10 Tercel SP1 ç‰ˆæœ¬ï¼Œè¯·è‡ªè¡Œç™¾åº¦æœç´¢,é•œåƒæº!"
  else
    echo "æš‚æœªä½¿ç”¨éº’éºŸé™¤ V10 ä»¥å¤–çš„ç³»ç»Ÿç‰ˆæœ¬ï¼Œè¯·è‡ªè¡Œç™¾åº¦æœç´¢,é•œåƒæº!"
  fi
  sudo yum clean all -y &amp;&amp; sudo yum makecache

  read -t ${VAR_VERIFY_TIMEOUT} -p "Please input, Perform system software update and upgrade. (Y/N) : " VERIFY
  if [[ ${VERIFY:="N"} == "Y" || ${VERIFY:="N"} == "y" ]]; then
    sudo yum update -y &amp;&amp; sudo yum upgrade -y
  fi</code></pre>
     <p>
      PS: è™½ç„¶é“¶æ²³éº’éºŸï¼ˆKylinOSï¼‰V10 SP3 ç³»ç»Ÿä¸­å¯ä»¥ä½¿ç”¨CentOS7çš„é•œåƒæºï¼Œä½†æ˜¯å¹¶ä¸å»ºè®®è¿™æ ·å¦åˆ™åœ¨é•œåƒè½¯ä»¶æ›´æ–°å®‰è£…æ—¶ï¼Œå°†ä¼šå‡ºç°è«åé”™è¯¯ã€‚
     </p>
     <h4>
      4.å¸¸è§„è¿ç»´å·¥å…·å®‰è£…åŠç³»ç»Ÿå‡çº§
     </h4>
     <p>
      æè¿°: å®Œæˆè½¯ä»¶é•œåƒæºé…ç½®åæˆ‘ä»¬ä¾¿å¯è¿›è¡Œç³»ç»Ÿæ›´æ–°ä»¥åŠï¼Œå¸¸è§„çš„è¿ç»´å·¥å…·å®‰è£…äº†ã€‚
     </p>
     <pre class="has"><code class="language-go"># 1.ç³»ç»Ÿæ›´æ–°
echo "[-] ç³»ç»Ÿè½¯ä»¶æºæ›´æ–°."
sudo yum update &amp;&amp; sudo yum upgrade -y &amp;&amp; dnf repolist

# 2.å®‰è£…ç³»ç»Ÿæ‰€éœ€çš„å¸¸è§„è½¯ä»¶
echo "[-] å®‰è£…ç³»ç»Ÿæ‰€éœ€çš„å¸¸è§„è½¯ä»¶."
sudo dnf install -y gcc make
sudo dnf install -y nano vim git unzip unrar ftp wget ntpdate dos2unix net-tools tree htop sysstat psmisc bash-completion jq rpcbind dialog nfs-utils 

# è¡¥å……ï¼šä»£ç†æ–¹å¼è¿›è¡Œæ›´æ–°
# echo "proxy=http://127.0.0.1:8080/" &gt;&gt; /etc/yum.conf
# sudo yum clean all -y &amp;&amp; sudo yum update -y &amp;&amp; sudo yum upgrade -y
# sudo yum install -y è½¯ä»¶åŒ…</code></pre>
     <h4>
      5.ç³»ç»Ÿæ—¶é—´æ—¶åŒºåŒæ­¥é…ç½®
     </h4>
     <p>
      æè¿°: æ›´æ–°ç³»ç»ŸåŠå¯¹åº”å·¥å…·åï¼Œæˆ‘ä»¬éœ€è¦é’ˆå¯¹ç³»ç»Ÿæ—¶é—´æ—¶åŒºåšåŒæ­¥é…ç½®ï¼Œæ­¤æ­¥éª¤éå¸¸é‡è¦å¾€å¾€ä¼šå½±å“åº”ç”¨ç¨‹åºæ—¶é—´ï¼Œå»ºè®®åœ¨æœåŠ¡å™¨ä¸­å¿…é¡»è¿›è¡Œé…ç½®ã€‚
     </p>
     <pre class="has"><code class="language-go"># Show  Script Execute result (Y/N)
VAR_VERIFY_RESULT=Y
# Modify the NTP server 
# PS: "192.168.4.254" ä¸ºå†…éƒ¨NTPæœåŠ¡å™¨ï¼Œè‹¥éœ€è¦æ­å»ºNTPæœåŠ¡å™¨è¯·å‚è€ƒï¼Œæ­¤ç¯‡æ–‡ç« : https://blog.weiyigeek.top/2020/1-29-112.html
VAR_NTP_SERVER=( "ntp.aliyun.com" "ntp.tencent.com"  "192.168.10.254")

# å®‰è£…é…ç½® chrony æ—¶é—´åŒæ­¥æœåŠ¡å™¨
# æ–¹å¼1.å®‰è£… Chrony å®¢æˆ·ç«¯é…ç½®
if [[ $(rpm -qa | grep -c "chrony") -eq 0 ]];then
  dnf install -y chrony
fi
cp /etc/chrony.conf ${BACKUPDIR}
grep -E -q "^server" /etc/chrony.conf | sed -i 's/^server/# server/g' /etc/chrony.conf 
grep -E -q "^pool" /etc/chrony.conf | sed -i 's/^pool/# pool/g' /etc/chrony.conf 
for ntp in ${VAR_NTP_SERVER[@]};do 
  echo "ntp server =&gt; ${ntp}"
  if [[ ${ntp} =~ "ntp" ]];then
    echo "pool ${ntp} iburst maxsources 4" &gt;&gt; /etc/chrony.conf;
  else
    echo "pool ${ntp} iburst maxsources 1" &gt;&gt; /etc/chrony.conf;
  fi
done
systemctl enable chronyd.service &amp;&amp; systemctl restart chronyd.service

# chrony.conf é…ç½®ç¤ºä¾‹
# sudo tee /etc/chrony.conf &lt;&lt;'EOF'
# confdir /etc/conf.d
# server ntp.aliyun.com iburst maxsources 4
# server ntp.tencent.com iburst maxsources 4
# pool 192.168.10.254 iburst maxsources 1
# pool 192.168.12.254 iburst maxsources 2
# pool 192.168.4.254 iburst maxsources 3
# sourcedir /run/chrony-dhcp
# sourcedir /etc/sources.d
# keyfile /etc/chrony.keys
# driftfile /var/lib/chrony/chrony.drift
# ntsdumpdir /var/lib/chrony
# logdir /var/log/chrony
# maxupdateskew 100.0
# rtcsync
# makestep 1 3
# leapsectz right/UTC
# EOF

# æ–¹å¼2.ä½¿ç”¨ ntpdate å·¥å…·å®šæ—¶åŒæ­¥
# sudo ntpdate 192.168.10.254 || sudo ntpdate 192.168.12.254 || sudo ntpdate ntp1.aliyun.com

# æ–¹å¼3.ä½¿ç”¨ç³»ç»Ÿ systemd-timesyncd
# echo 'NTP=192.168.10.254 192.168.4.254' &gt;&gt; /etc/systemd/timesyncd.conf
# echo 'FallbackNTP=ntp.aliyun.com' &gt;&gt; /etc/systemd/timesyncd.conf
# systemctl restart systemd-timesyncd.service
if [[ ${VAR_VERIFY_RESULT} == "Y" ]];then systemctl status chronyd.service -l --no-pager;fi</code></pre>
     <p>
      ä¸»æœºæ—¶é—´åŒæ­¥æ ¡å‡†ä¸æ—¶åŒºè®¾ç½®
     </p>
     <pre class="has"><code class="language-go"># Modify the timezone
VAR_TIMEZONE=Asia/Shanghai

# 1.æ—¶åŒºè®¾ç½®
sudo timedatectl set-timezone ${VAR_TIMEZONE}
# sudo dpkg-reconfigure tzdata  # ä¿®æ”¹ç¡®è®¤
# sudo bash -c "echo 'Asia/Shanghai' &gt; /etc/timezone" # ä¸ä¸Šä¸€æ¡å‘½ä»¤ä¸€æ ·

# 2.å°†å½“å‰çš„ UTC æ—¶é—´å†™å…¥ç¡¬ä»¶æ—¶é’Ÿ (ç¡¬ä»¶æ—¶é—´é»˜è®¤ä¸ºUTC)
sudo timedatectl set-local-rtc 0

# 3.å¯ç”¨NTPæ—¶é—´åŒæ­¥ï¼š
sudo timedatectl set-ntp yes

# 4.æ ¡å‡†æ—¶é—´æœåŠ¡å™¨-æ—¶é—´åŒæ­¥(æ¨èä½¿ç”¨chronycè¿›è¡Œå¹³æ»‘åŒæ­¥)
sudo chronyc tracking

# 5.æ‰‹åŠ¨æ ¡å‡†-å¼ºåˆ¶æ›´æ–°æ—¶é—´
# chronyc -a makestep

# 6.ç³»ç»Ÿæ—¶é’ŸåŒæ­¥ç¡¬ä»¶æ—¶é’Ÿ
# sudo hwclock --systohc
sudo hwclock -w
echo "è®¾ç½®æ—¶é—´åŒæ­¥ä¸æ—¶åŒºå: $(date)"

# 7.é‡å¯ä¾èµ–äºç³»ç»Ÿæ—¶é—´çš„æœåŠ¡
sudo systemctl restart rsyslog.service crond.service</code></pre>
     <p>
      è„šæœ¬æ‰§è¡Œæ•ˆæœ:
     </p>
     <p style="text-align:center;">
      <img alt="128787958fc62ee459a07b2a088dec15.png" src="https://i-blog.csdnimg.cn/blog_migrate/792300b9e8315b45cfafb594d1f92bb1.png"/>
     </p>
     <hr/>
     <p>
      0x02 ç³»ç»Ÿä¼˜åŒ–
     </p>
     <h4>
      1.åˆ›å»ºswapç³»ç»Ÿåˆ†åŒºé…ç½®
     </h4>
     <p>
      æè¿°: å½“æœåŠ¡å™¨ç³»ç»Ÿå†…å­˜è¿‡å°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ’åˆ†ä¸€å—ç£ç›˜ç©ºé—´ä½œä¸ºswapäº¤æ¢åˆ†åŒºä»¥è¡¥å……å†…å­˜è¿‡å°ï¼Œæ— æ³•è¿è¡ŒæŸäº›ç¨‹åºï¼Œé€šå¸¸æƒ…å†µä¸‹ä¼šå‡ºç°åœ¨VPSä¸Šï¼Œé’ˆå¯¹äºä¼ä¸šä¸­çš„æœåŠ¡å™¨åŸºæœ¬éƒ½æ˜¯åœ¨64Gä»¥ä¸Šï¼Œè¯·æ ¹æ®ä¸šåŠ¡éœ€æ±‚åˆ’åˆ†ï¼Œæˆ‘ä»¬ç”±äºä½¿ç”¨äº†K8Säº‘åŸç”Ÿé€šå¸¸æƒ…å†µä¸‹éœ€è¦ç¦ç”¨SWAPäº¤æ¢åˆ†åŒºï¼Œä¸è¿‡æ­¤å¤„ä½œè€…è¿˜æ˜¯å°†æ–¹æ³•å…¶ç½—åˆ—å‡ºæ¥ä»¥ä¾›éœ€è¦çš„æœ‹å‹ä½¿ç”¨ã€‚
     </p>
     <pre class="has"><code class="language-go"># Show  Script Execute result (Y/N)
VAR_VERIFY_RESULT=Y
# Modify Script vertify timeout (unit s)
VAR_VERIFY_TIMEOUT=8

echo "[${COUNT}] Create system swap partition."
read -t ${VAR_VERIFY_TIMEOUT} -p "Please input, Create swap partition. (Y/N) : " VERIFY
if [[ ${VERIFY:="N"} == "Y" || ${VERIFY:="N"} == "y" ]]; then
    # 1.éªŒè¯å½“å‰å†…å­˜å¤§å°
  MEM=$(free -m | awk '/Mem:/{print $2}')
  if [ "$MEM" -le 1280 ]; then
    MEM_LEVEL=1G
  elif [ "$MEM" -gt 1280 ] &amp;&amp; [ "$MEM" -le 2500 ]; then
    MEM_LEVEL=2G
  elif [ "$MEM" -gt 2500 ] &amp;&amp; [ "$MEM" -le 3500 ]; then
    MEM_LEVEL=3G
  elif [ "$MEM" -gt 3500 ] &amp;&amp; [ "$MEM" -le 4500 ]; then
    MEM_LEVEL=4G
  elif [ "$MEM" -gt 4500 ] &amp;&amp; [ "$MEM" -le  8000 ]; then
    MEM_LEVEL=6G
  elif [ "$MEM" -gt 8000 ]; then
    MEM_LEVEL=8G
  fi

  # 2.æ ¹æ®å†…å­˜å¤§å°åˆ’åˆ†å¯¹åº”çš„swapåˆ†åŒºå¹¶è‡ªåŠ¨æŒ‚è½½
  if [ "$(free -m | awk '/Swap:/{print $2}')" == '0' ]; then
    fallocate -l "${MEM_LEVEL}" /swapfile
    chmod 600 /swapfile
    mkswap /swapfile &gt;/dev/null 2&gt;&amp;1
    swapon /swapfile
    sed -i "/swap/d" /etc/fstab
    echo "/swapfile swap swap defaults 0 0" &gt;&gt; /etc/fstab
  fi

  # 3.swapåˆ†åŒºå†…æ ¸å‚æ•°è°ƒæ•´
  egrep -q "^\s*vm.swappiness.*$" /etc/sysctl.conf &amp;&amp; sed -ri "s/^\s*vm.swappiness.*$/vm.swappiness = 10/" /etc/sysctl.conf || echo "vm.swappiness = 10" &gt;&gt; /etc/sysctl.conf
  egrep -q "^\s*vm.vfs_cache_pressure.*$" /etc/sysctl.conf &amp;&amp; sed -ri "s/^\s*vm.vfs_cache_pressure.*$/vm.vfs_cache_pressure = 501/" /etc/sysctl.conf || echo "vm.vfs_cache_pressure = 50" &gt;&gt; /etc/sysctl.conf

  sysctl -p &gt;/dev/null 2&gt;&amp;1

  if [[ $VAR_VERIFY_RESULT == "Y" ]]; then
    swapon --show 
    echo .
    free -h
    echo .
    grep -Ev '^#|^$' /etc/fstab | uniq
  fi
fi</code></pre>
     <h4>
     </h4>
     <h4>
      2.ç³»ç»Ÿèµ„æºå¥æŸ„æ•°ä¼˜åŒ–é…ç½®
     </h4>
     <p>
      æè¿°: ä¸ºäº†æé«˜ç³»ç»Ÿçš„é«˜å¹¶å‘ä»¥åŠé˜²æ­¢ç¨‹åºæŠ¥ Too many open file é”™è¯¯ï¼Œé€šå¸¸éœ€è¦é’ˆå¯¹ç³»ç»Ÿèµ„æºå¥æŸ„æ•°è¿›è¡Œä¼˜åŒ–é…ç½®ã€‚
     </p>
     <pre class="has"><code class="language-go">echo "[-] Linux ç³»ç»Ÿçš„æœ€å¤§è¿›ç¨‹æ•°å’Œæœ€å¤§æ–‡ä»¶æ‰“å¼€æ•°é™åˆ¶."
cp -a /etc/security/limits.conf ${BACKUPDIR}
egrep -q "^\s*ulimit -HSn\s+\w+.*$" /etc/profile &amp;&amp; sed -ri "s/^\s*ulimit -HSn\s+\w+.*$/ulimit -HSn 655350/" /etc/profile || echo "ulimit -HSn 655350" &gt;&gt; /etc/profile
egrep -q "^\s*ulimit -HSu\s+\w+.*$" /etc/profile &amp;&amp; sed -ri "s/^\s*ulimit -HSu\s+\w+.*$/ulimit -HSu 655350/" /etc/profile || echo "ulimit -HSu 655350" &gt;&gt; /etc/profile
if ! grep -qi "# OS Resources Limits Config" /etc/security/limits.conf; then
  sed -i 's/^# End of file*//' /etc/security/limits.conf
  {
    echo '# OS Resources Limits Config'
    echo '* soft nofile 655350'
    echo '* hard nofile 655350'
    echo '* soft nproc  unlimited'
    echo '* hard nproc  unlimited'
    echo '* soft core   unlimited'
    echo '* hard core   unlimited'
    echo '# End of file'
  } &gt;&gt; /etc/security/limits.conf
fi

if [[ $VAR_VERIFY_RESULT == "Y" ]]; then grep -Ev '^#|^$' /etc/security/limits.conf | uniq;fi</code></pre>
     <h4>
      3.ç³»ç»Ÿå¸¸è§„å†…æ ¸å‚æ•°ä¼˜åŒ–é…ç½®
     </h4>
     <p>
      æè¿°: æœåŠ¡å™¨å†…æ ¸å‚æ•°çš„ä¼˜åŒ–æœ‰åŠ©äºç³»ç»Ÿä»¥åŠåº”ç”¨ç¨‹åºæä¾›æ›´å¥½çš„æ€§èƒ½ï¼Œä½†æ˜¯é€šå¸¸éœ€è¦é’ˆå¯¹åº”ç”¨ç¨‹åºç‰¹ç‚¹ä»¥åŠåº”ç”¨åœºæ™¯è¿›è¡Œç›¸åº”é…ç½®ï¼Œä¸‹è¿°åªæ˜¯å¸¸è§„é…ç½®æœ‰ä¾§é‡ç‚¹çš„æœ‹å‹ä»¬ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚
     </p>
     <pre class="has"><code class="language-go"># Show  Script Execute result (Y/N)
VAR_VERIFY_RESULT=Y
# Modify Script vertify timeout (unit s)
VAR_VERIFY_TIMEOUT=8

# 1.ç³»ç»Ÿå†…æ ¸å‚æ•°çš„é…ç½®æ–‡ä»¶/etc/sysctl.conf
echo "[-] ç³»ç»Ÿå†…æ ¸å‚æ•°çš„ä¼˜åŒ–é…ç½® /etc/sysctl.conf"
# å¯ç”¨IPV4æ•°æ®åŒ…è½¬å‘ï¼ˆä¸šåŠ¡éœ€è¦ï¼‰
egrep -q "^(#)?net.ipv4.ip_forward.*" /etc/sysctl.conf &amp;&amp; sed -ri "s|^(#)?net.ipv4.ip_forward.*|net.ipv4.ip_forward = 1|g"  /etc/sysctl.conf || echo "net.ipv4.ip_forward = 1" &gt;&gt; /etc/sysctl.conf
# egrep -q "^(#)?net.bridge.bridge-nf-call-ip6tables.*" /etc/sysctl.conf &amp;&amp; sed -ri "s|^(#)?net.bridge.bridge-nf-call-ip6tables.*|net.bridge.bridge-nf-call-ip6tables = 1|g" /etc/sysctl.conf || echo "net.bridge.bridge-nf-call-ip6tables = 1" &gt;&gt; /etc/sysctl.conf 
# egrep -q "^(#)?net.bridge.bridge-nf-call-iptables.*" /etc/sysctl.conf &amp;&amp; sed -ri "s|^(#)?net.bridge.bridge-nf-call-iptables.*|net.bridge.bridge-nf-call-iptables = 1|g" /etc/sysctl.conf || echo "net.bridge.bridge-nf-call-iptables = 1" &gt;&gt; /etc/sysctl.conf
egrep -q "^(#)?net.ipv6.conf.all.disable_ipv6.*" /etc/sysctl.conf &amp;&amp; sed -ri "s|^(#)?net.ipv6.conf.all.disable_ipv6.*|net.ipv6.conf.all.disable_ipv6 = 1|g" /etc/sysctl.conf || echo "net.ipv6.conf.all.disable_ipv6 = 1" &gt;&gt; /etc/sysctl.conf
egrep -q "^(#)?net.ipv6.conf.default.disable_ipv6.*" /etc/sysctl.conf &amp;&amp; sed -ri "s|^(#)?net.ipv6.conf.default.disable_ipv6.*|net.ipv6.conf.default.disable_ipv6 = 1|g" /etc/sysctl.conf || echo "net.ipv6.conf.default.disable_ipv6 = 1" &gt;&gt; /etc/sysctl.conf
egrep -q "^(#)?net.ipv6.conf.lo.disable_ipv6.*" /etc/sysctl.conf &amp;&amp; sed -ri "s|^(#)?net.ipv6.conf.lo.disable_ipv6.*|net.ipv6.conf.lo.disable_ipv6 = 1|g" /etc/sysctl.conf || echo "net.ipv6.conf.lo.disable_ipv6 = 1" &gt;&gt; /etc/sysctl.conf
egrep -q "^(#)?net.ipv6.conf.all.forwarding.*" /etc/sysctl.conf &amp;&amp; sed -ri "s|^(#)?net.ipv6.conf.all.forwarding.*|net.ipv6.conf.all.forwarding = 1|g" /etc/sysctl.conf || echo "net.ipv6.conf.all.forwarding = 1"  &gt;&gt; /etc/sysctl.conf


# 2.ç³»ç»Ÿå†…æ ¸å‚æ•°æ‰©å±•ä¼˜åŒ–é…ç½®
if ! grep -qi "# OS Resources Limits Config" /etc/sysctl.conf; then
tee -a /etc/sysctl.conf &lt;&lt;'EOF'
# Configuration of system kernel parameters
# ç¦æ­¢ icmp é‡å®šå‘æŠ¥æ–‡
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
# å¿½ç•¥ icmp echo è¯·æ±‚å¹¿æ’­
net.ipv4.icmp_echo_ignore_broadcasts = 1
# ç¦æ­¢ icmp æºè·¯ç”±
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0

# ç¦æ­¢å‘é€é‡å®šå‘ (è‹¥éå¿…é¡»å»ºè®®è®¾ç½® 0)
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0

# ç¦æ­¢å¯¹ä¸»æœºè¿›è¡Œ IP ä¼ªè£…
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1 

# é™åˆ¶ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰çš„VMA(è™šæ‹Ÿå†…å­˜åŒºåŸŸ)çš„æ•°é‡
vm.max_map_count = 262144

# è®¾ç½®å†…å­˜åˆ†é…ç­–ç•¥ï¼Œä½¿ç”¨0è¡¨ç¤ºå†…æ ¸å°†æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜ã€‚
vm.overcommit_memory = 0

# è°ƒæ•´æå‡æœåŠ¡å™¨è´Ÿè½½èƒ½åŠ›ä¹‹å¤–,è¿˜èƒ½å¤Ÿé˜²å¾¡å°æµé‡çš„Dosã€CCå’ŒSYNæ”»å‡»
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_tw_reuse = 1
# net.ipv4.tcp_tw_recycle = 1
net.ipv4.tcp_fin_timeout = 60
net.ipv4.tcp_synack_retries = 1
net.ipv4.tcp_syn_retries = 1
net.ipv4.tcp_fastopen = 3

# ä¼˜åŒ–TCPçš„å¯ä½¿ç”¨ç«¯å£èŒƒå›´åŠæå‡æœåŠ¡å™¨å¹¶å‘èƒ½åŠ›(æ³¨æ„ä¸€èˆ¬æµé‡å°çš„æœåŠ¡å™¨ä¸Šæ²¡å¿…è¦è®¾ç½®å¦‚ä¸‹å‚æ•°)
net.ipv4.tcp_keepalive_time = 7200
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_max_tw_buckets = 16384
net.ipv4.ip_local_port_range = 1024 65535

# ä¼˜åŒ–æ ¸å¥—æ¥å­—TCPçš„ç¼“å­˜åŒº
net.core.netdev_max_backlog = 8192
net.core.somaxconn = 32768
net.core.rmem_max = 12582912
net.core.rmem_default = 6291456
net.core.wmem_max = 12582912
net.core.wmem_default = 6291456

# å†…å­˜ç¼“å­˜IOä¼˜åŒ–
vm.dirty_background_ratio = 5
vm.dirty_ratio = 10
EOF
fi
if [[ ${VAR_VERIFY_RESULT} == "Y" ]];then sysctl -p;fi</code></pre>
     <p>
      4.ç³»ç»ŸæœåŠ¡ä¼˜åŒ–é…ç½®
     </p>
     <p>
      æè¿°: é’ˆå¯¹æˆ‘ä»¬æ–°å®‰è£…çš„KylinOSæœåŠ¡å™¨ä¸­å¾€å¾€å­˜åœ¨è®¸å¤šéå¿…é¡»æœåŠ¡ï¼Œæ­¤å¤„æˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€æ±‚ç¦ç”¨ç›¸å…³æœåŠ¡ã€‚
     </p>
     <pre class="has"><code class="language-go"># 1.ç”¨äºå…³é—­ä¸ç¦ç”¨æŸäº›æœåŠ¡ç«¯å£
echo "[-] ç”¨äºå…³é—­ä¸ç¦ç”¨æŸäº›æœåŠ¡ç«¯å£ã€‚."
local VAR_APP_SERVICE VAR_SYSTEM_SERVICE
VAR_APP_SERVICE="telnet.socket printer sendmail nfs kshell lpd tftp ident time ntalk bootps klogin ypbind daytime nfslock echo discard chargen debug-shell.service"
VAR_SYSTEM_SERVICE="chargen-dgram daytime-stream echo-streamklogin tcpmux-server chargen-stream discard-dgram eklogin krb5-telnet tftp cvs discard-stream ekrb5-telnet kshell time-dgram daytime-dgram echo-dgram gssftp rsync time-stream"

for i in ${VAR_APP_SERVICE};do
  echo "Status and Disable APP ${i} Service!"
  # systemctl status ${i}
  systemctl stop ${i};systemctl disable ${i};
done

for i in ${VAR_SYSTEM_SERVICE};do
  echo "Status and Disable System ${i} Service!"
  # systemctl status ${i}
  systemctl stop ${i};systemctl disable ${i};
done

# 2.ç¦ç”¨çƒ¦äººçš„apporté”™è¯¯æŠ¥å‘Š
if [ -f /etc/default/apport ]; then
  cp /etc/default/apport ${BACKUPDIR}
  sed -i 's/enabled=.*/enabled=0/' /etc/default/apport
  systemctl stop apport.service
  systemctl disable apport.service
  systemctl mask apport.service &gt;/dev/null 2&gt;&amp;1
fi

read -t ${VAR_VERIFY_TIMEOUT} -p "Please input, is service verificating (Y/N) : " VERIFY
if [[ ${VERIFY:="N"} == "Y" || ${VERIFY:="N"} == "y" ]]; then
  systemctl status apport.service --no-pager
else
  log::success "[${COUNT}] This operation is completed!"
fi

# 3.éäº‘çš„ç¯å¢ƒä¸‹ç¦ç”¨æˆ–è€…å¸è½½å¤šä½™çš„cloud-initè½¯ä»¶åŠå…¶æœåŠ¡
sudo systemctl stop cloud-init.target cloud-init.service cloud-config.service cloud-init-local.service cloud-final.service
sudo systemctl disable cloud-init.target cloud-init.service cloud-config.service cloud-init-local.service cloud-final.service
sudo systemctl mask cloud-init.service cloud-config.service cloud-init-local.service cloud-final.service &gt;/dev/null 2&gt;&amp;1

# ç¦ç”¨ Ubuntu ä¸­çš„ cloud-init, åœ¨ /etc/cloud ç›®å½•ä¸‹åˆ›å»º cloud-init.disable æ–‡ä»¶(é‡å¯åç”Ÿæ•ˆ)
if [ ! -f /etc/cloud/cloud-init.disable ];then sudo touch /etc/cloud/cloud-init.disable;fi
read -t ${VAR_VERIFY_TIMEOUT} -p "Please input, is Remove cloud-init related files and their directories (Y/N) : " VERIFY
if [[ ${VERIFY:="N"} == "Y" || ${VERIFY:="N"} == "y" ]]; then
  sudo apt purge cloud-init -y
  sudo rm -rf /etc/cloud &amp;&amp; sudo rm -rf /var/lib/cloud/   
fi
sudo systemctl daemon-reload

# 4.åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ç¦ç”¨debug-shellæœåŠ¡
systemctl stop debug-shell.service
systemctl mask debug-shell.service &gt;/dev/null 2&gt;&amp;1
if [[ $VAR_VERIFY_RESULT == "Y" ]]; then
  systemctl status debug-shell.service --no-pager
fi</code></pre>
     <hr/>
     <p>
      0x03 å®‰å…¨åŠ å›º
     </p>
     <p>
      1.è¿œç¨‹ç™»å½•ä¸»æœºæç¤ºä¿¡æ¯
     </p>
     <p>
      æè¿°: é…ç½®æç¤ºä¿¡æ¯å¯ä»¥æç¤ºè¿ç»´äººå‘˜ä»¥åŠæ¶æ„äººå‘˜ï¼Œåœ¨éæƒé™æˆæƒæ—¶ç¦æ­¢è®¿é—®ã€‚
     </p>
     <pre class="has"><code class="language-go"># 1.è®¾ç½®SSHç™»å½•å‰è­¦å‘ŠBanneræç¤º
egrep -q "^\s*(banner|Banner)\s+\W+.*$" /etc/ssh/sshd_config &amp;&amp; sed -ri "s/^\s*(banner|Banner)\s+\W+.*$/Banner \/etc\/issue.net/" /etc/ssh/sshd_config || echo "Banner /etc/issue.net" &gt;&gt; /etc/ssh/sshd_config

sudo tee /etc/issue &lt;&lt;'EOF'
************************* [ å®‰å…¨ç™»é™† (Security Login) ] ************************
Authorized users only. All activity will be monitored and reported.By WeiyiGeek Security Center.
Author: WeiyiGeek
blog: https://blog.weiyigeek.top

EOF

sudo tee /etc/issue.net &lt;&lt;'EOF'
************************* [ å®‰å…¨ç™»é™† (Security Login) ] *************************
Authorized users only. All activity will be monitored and reported.By WeiyiGeek Security Center.
Author: WeiyiGeek
blog: https://blog.weiyigeek.top

EOF

# 2.æœ¬åœ°æ§åˆ¶å°ä¸SSHç™»å½•åæç¤ºè‡ªå®šä¹‰æç¤ºä¿¡æ¯
tee /etc/motd &lt;&lt;'EOF'
Welcome to KylinOS Private Cloud Computer Service!
If the server is abnormal, please add WX weiyigeeker (WeiyiGeek-Security-Center)

                   _ooOoo_
                  o8888888o
                  88" . "88
                  (| -_- |)
                  O\  =  /O
               ____/`---'\____
             .'  \\|     |//  `.
            /  \\|||  :  |||//  \
           /  _||||| -:- |||||-  \
           |   | \\\  -  /// |   |
           | \_|  ''\---/''  |   |
           \  .-\__  `-`  ___/-. /
         ___`. .'  /--.--\  `. . __
      ."" '&lt;  `.___\_&lt;|&gt;_/___.'  &gt;'"".
     | | :  `- \`.;`\ _ /`;.`/ - ` : | |
     \  \ `-.   \_ __\ /__ _/   .-` /  /
======`-.____`-.___\_____/___.-`____.-'======
                   `=---='
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
           ä½›ç¥–ä¿ä½‘       æ°¸ä¸æ­»æœº
           å¿ƒå¤–æ— æ³•       æ³•å¤–æ— å¿ƒ
EOF</code></pre>
     <p>
      è„šæœ¬æ‰§è¡Œæ•ˆæœ:
     </p>
     <p style="text-align:center;">
      <img alt="dad8be6d09bfaa499dac1170a7deea46.png" src="https://i-blog.csdnimg.cn/blog_migrate/98f84ae816e799cef0609478c7607cff.png"/>
     </p>
     <h4>
      2.è¿œç¨‹ç™»å½•ä¸»æœºç³»ç»Ÿä¿¡æ¯
     </h4>
     <p>
      æè¿°: åœ¨ç™»å½•åˆ°ç³»ç»ŸååŠæ—¶çš„æ˜¾ç¤ºæœåŠ¡å™¨ç³»ç»Ÿç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºç³»ç»Ÿèµ„æºä¿¡æ¯ã€ç™»å½•æ—¶é—´ã€å¤±è´¥ä¿¡æ¯ï¼Œä»¥åŠå„åˆ†åŒºç£ç›˜ä½¿ç”¨ç‡ã€‚
     </p>
     <p>
      è„šæœ¬æ‰§è¡Œæ•ˆæœ:
     </p>
     <p style="text-align:center;">
      <img alt="84836734b789220f4ca051307b1c795e.png" src="https://i-blog.csdnimg.cn/blog_migrate/a6440c39e884d56e9679c8c2d82c20c7.png"/>
     </p>
     <p style="text-align:left;">
      è„šæœ¬ç‰‡æ®µå¦‚ä¸‹ï¼š
     </p>
     <p style="text-align:left;">
      åç»­å®Œæ•´åŸæ–‡:
      <a class="has-card" href="https://mp.weixin.qq.com/s/eBF_Q-WkiZHKGdEG1MODNQ" rel="nofollow" title="ç½‘å®‰ç­‰ä¿-å›½äº§Linuxæ“ä½œç³»ç»Ÿé“¶æ²³éº’éºŸKylinOS-V10SP3å¸¸è§„é…ç½®ã€ç³»ç»Ÿä¼˜åŒ–ä¸å®‰å…¨åŠ å›ºåŸºçº¿å®è·µæ–‡æ¡£">
       <span class="link-card-box">
        <span class="link-title">
         ç½‘å®‰ç­‰ä¿-å›½äº§Linuxæ“ä½œç³»ç»Ÿé“¶æ²³éº’éºŸKylinOS-V10SP3å¸¸è§„é…ç½®ã€ç³»ç»Ÿä¼˜åŒ–ä¸å®‰å…¨åŠ å›ºåŸºçº¿å®è·µæ–‡æ¡£
        </span>
        <span class="link-desc">
         éšç€å›½å®¶è¦æ±‚å„æ”¿åºœéƒ¨é—¨åŠäº‹ä¼ä¸šå•ä½æœåŠ¡å™¨ç³»ç»Ÿå›½äº§åŒ–ï¼Œè¶Šæ¥è¶Šå¤šçš„çš„ä¼ä¸šå•ä½é€æ­¥å¼•è¿›å›½äº§åŒ–Linuxæ“ä½œç³»ç»Ÿ(`å¤§è¶‹åŠ¿`)ï¼Œæ­¤å¤„æˆ‘å°†é’ˆå¯¹é“¶æ²³éº’éºŸå›½äº§æ“ä½œç³»ç»ŸKylinOS-V10SP3ç‰ˆæœ¬è¿›è¡Œå®‰å…¨åŠ å›ºåŠå¸¸è§„åˆå§‹åŒ–æ“ä½œï¼Œå¤åˆç­‰ä¿ä¸‰çº§ä¸»æœºå®‰å…¨è¦æ±‚ã€‚
        </span>
        <span class="link-link">
         <img alt="" class="link-link-icon" src="https://i-blog.csdnimg.cn/blog_migrate/aace7af9b4cf9ef918e2e8591ffc7a2b.png">
          https://mp.weixin.qq.com/s/eBF_Q-WkiZHKGdEG1MODNQ
         </img>
        </span>
       </span>
      </a>
     </p>
    </div>
   </div>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
</div>


