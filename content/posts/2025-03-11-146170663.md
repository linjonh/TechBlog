---
layout: post
title: "Three.js-进阶灯光阴影关系和设置平行光阴影相机"
date: 2025-03-11 09:45:14 +0800
description: "长方体尺寸参数，一般比你要渲染的范围稍微大一些即可，过小阴影不显示或显示不完整，过大很多可能阴影偏模糊，你可以比较下面两个参数的阴影渲染差异。比如光线是从斜上方照射下来，模型y方向高度100左右，这时候y可以设置为100左右，xz也可以根据渲染范围先给个大概尺寸。其实平行光阴影范围的设置，你可以类比以前正投影机位置、长方体可视化空间的设置。渲染范围可以都先给个几百量级的值，不用精准，先设置，在微调。你可以比较测试两个不同的光源位置，对应阴影渲染效果。的位置，所以要根据渲染范围调整光源的位置。"
keywords: "Three.js 进阶(灯光阴影关系和设置、平行光、阴影相机)"
categories: ['Three']
tags: ['数码相机', '开发语言', 'Javascript']
artid: "146170663"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146170663
    alt: "Three.js-进阶灯光阴影关系和设置平行光阴影相机"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146170663
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146170663
cover: https://bing.ee123.net/img/rand?artid=146170663
image: https://bing.ee123.net/img/rand?artid=146170663
img: https://bing.ee123.net/img/rand?artid=146170663
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Three.js 进阶(灯光阴影关系和设置、平行光、阴影相机)
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <strong>
      本篇主要学习内容
     </strong>
     :
    </p>
    <ol>
     <li>
      灯光与阴影
     </li>
     <li>
      聚光灯
     </li>
     <li>
      点光源
     </li>
     <li>
      平行光
     </li>
     <li>
      阴影相机和阴影计算
     </li>
     <li>
      投射阴影接受阴影
     </li>
    </ol>
    <p>
     <strong>
      点赞 + 关注 + 收藏 = 学会了
     </strong>
    </p>
    <h4>
     <a id="1_12">
     </a>
     1.灯光与阴影
    </h4>
    <blockquote>
     <p>
      1、材质要满足能够对光有反应
      <br/>
      <br/>
      2、设置渲染器开启阴影计算 renderer.shadowMap.enabled=true
      <br/>
      <br/>
      3、设置光照投射阴影 directionalLight.castShadow = true
      <br/>
      <br/>
      4、设置物体投射阴影 sphere.castShadow = true
      <br/>
      <br/>
      5、设置物体接受阴影 plane.receiveShadow = true
      <br/>
     </p>
    </blockquote>
    <p>
     常见光源如下，入门时学习环境光和点光源:
    </p>
    <p>
     <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/direct/0d394b9007cd47eda29ac8f7d797e0a5.jpeg"/>
    </p>
    <h4>
     <a id="2_25">
     </a>
     2.聚光灯
    </h4>
    <p>
     <strong>
      SpotLight
     </strong>
     聚光源可以认为是一个沿着特定方向逐渐发散的光源，照射范围在三维空间中构成一个圆锥体。
     <br/>
     <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/direct/7377cfc15b284ed7b5af5470b7640e44.gif"/>
    </p>
    <pre><code class="prism language-js"><span class="token keyword">const</span> spotLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>SpotLight</span><span class="token punctuation">(</span><span class="token string">'#ffffff'</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
spotLight<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
spotLight<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
spotLight<span class="token punctuation">.</span>intensity <span class="token operator">=</span> <span class="token number">2</span>
<span class="token comment">// 设置阴影模糊度</span>
spotLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>radius <span class="token operator">=</span> <span class="token number">20</span>
<span class="token comment">// 设置阴影贴图的分辨率</span>
spotLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>mapSize<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span> <span class="token comment">//1024倍数</span>
spotLight<span class="token punctuation">.</span>target <span class="token operator">=</span> sphere
spotLight<span class="token punctuation">.</span>angle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">6</span>
<span class="token comment">// 从光源发出光最大距离的衰减程度</span>
spotLight<span class="token punctuation">.</span>distance <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">// 半影衰减百分比0-1</span>
spotLight<span class="token punctuation">.</span>penumbra <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">// 沿着光照距离的衰减程度</span>
spotLight<span class="token punctuation">.</span>decay <span class="token operator">=</span> <span class="token number">0</span>
</code></pre>
    <h4>
     <a id="3__50">
     </a>
     3. 点光源
    </h4>
    <p>
     <strong>
      PointLight
     </strong>
     可以类比为一个发光点，就像生活中一个灯泡以灯泡为中心向四周发射光线。
    </p>
    <p>
     <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/direct/0cb2ae5c90a746c381ad280d33fa9947.gif"/>
    </p>
    <pre><code class="prism language-js"><span class="token keyword">const</span> pointLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PointLight</span><span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
pointLight<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
pointLight<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token comment">// 设置阴影模糊度</span>
pointLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>radius <span class="token operator">=</span> <span class="token number">20</span>
<span class="token comment">// 设置阴影贴图的分辨率</span>
pointLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>mapSize<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span> <span class="token comment">//1024倍数</span>
<span class="token comment">// 从光源发出光最大距离的衰减程度</span>
pointLight<span class="token punctuation">.</span>distance <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">// 半影衰减百分比0-1</span>
pointLight<span class="token punctuation">.</span>penumbra <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">// 沿着光照距离的衰减程度</span>
pointLight<span class="token punctuation">.</span>decay <span class="token operator">=</span> <span class="token number">0</span>
</code></pre>
    <h4>
     <a id="4__73">
     </a>
     4. 平行光
    </h4>
    <p>
     <strong>
      DirectionalLight
     </strong>
     沿特定方向发射，自定义光源位置
    </p>
    <p>
     <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/direct/715a6ce59da147e081170a8646d40b25.gif"/>
    </p>
    <pre><code class="prism language-js"><span class="token keyword">const</span> directionalLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>DirectionalLight</span><span class="token punctuation">(</span><span class="token number">0xffffff</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
directionalLight<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
directionalLight<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token comment">// 设置阴影模糊度</span>
directionalLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>radius <span class="token operator">=</span> <span class="token number">20</span>
<span class="token comment">// 设置阴影贴图的分辨率</span>
directionalLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>mapSize<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">)</span> <span class="token comment">//1024倍数</span>
<span class="token comment">// 设置平行光头摄像机属性</span>
directionalLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>near <span class="token operator">=</span> <span class="token number">0.5</span> <span class="token comment">//近平面距离</span>
directionalLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>far <span class="token operator">=</span> <span class="token number">500</span> <span class="token comment">//远平面距离</span>
directionalLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token number">5</span> <span class="token comment">//Y轴正方向上的边界</span>
directionalLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>bottom <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">5</span> <span class="token comment">//Y轴下方向上的边界</span>
directionalLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">5</span> <span class="token comment">//X轴负方向上的边界</span>
directionalLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token number">5</span> <span class="token comment">//X轴正方向上的边界</span>
</code></pre>
    <p>
     <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/direct/0956cc12e431469a8fa97664a03df9ed.jpeg"/>
    </p>
    <h4>
     <a id="5_99">
     </a>
     5.阴影相机
    </h4>
    <h5>
     <a id="51shadowcamera_101">
     </a>
     5.1）设置相机
     <code>
      .shadow.camera
     </code>
     长方体范围
    </h5>
    <p>
     根据3D场景渲染范围，去设置
     <code>
      .shadow.camera
     </code>
     长方体尺寸参数，一般比你要渲染的范围稍微大一些即可，过小阴影不显示或显示不完整，过大很多可能阴影偏模糊，你可以比较下面两个参数的阴影渲染差异。
    </p>
    <pre><code>directionalLight.shadow.camera.left = -50*10;
directionalLight.shadow.camera.right = 50*10;
</code></pre>
    <pre><code>directionalLight.shadow.camera.left = -50*100;
directionalLight.shadow.camera.right = 50*100;
</code></pre>
    <h5>
     <a id="52__113">
     </a>
     5.2） 调节光源位置
    </h5>
    <p>
     光源位置影响平行光阴影相机
     <code>
      .shadow.camera
     </code>
     的位置，所以要根据渲染范围调整光源的位置。
    </p>
    <p>
     你可以比较测试两个不同的光源位置，对应阴影渲染效果。
    </p>
    <pre><code>directionalLight.position.set(100, 60, 50);
</code></pre>
    <pre><code>directionalLight.position.set(100*2, 60*2, 50*2);
</code></pre>
    <h5>
     <a id="53__125">
     </a>
     5.3） 确定阴影计算范围
    </h5>
    <p>
     其实平行光阴影范围的设置，你可以类比以前正投影机位置、长方体可视化空间的设置。
    </p>
    <ul>
     <li>
      1.先大概确定下3D场景中需要阴影计算范围，不用精确，有一个数量级就行，比如几百、几千。
     </li>
     <li>
      2.
      <code>
       .shadow.camera
      </code>
      的
      <code>
       .left
      </code>
      、
      <code>
       .right
      </code>
      、
      <code>
       .top
      </code>
      、
      <code>
       .bottom
      </code>
      、
      <code>
       .near
      </code>
      、
      <code>
       .far
      </code>
      属性定义的长方体空间
     </li>
     <li>
      3.
      <code>
       .shadow.camera
      </code>
      的位置(光源位置影响
      <code>
       .shadow.camera
      </code>
      的位置)
     </li>
    </ul>
    <p>
     需要阴影范围数量级：z方向尺寸1000左右，xy方向100左右。
    </p>
    <pre><code>for (let i = -3; i &lt; 4; i++) {
    const mesh2 = mesh.clone();
    // 设置产生投影的网格模型
    mesh2.castShadow = true;
    mesh2.position.z = 100 * i;
    group.add(mesh2);
}
</code></pre>
    <h5>
     <a id="54__143">
     </a>
     5.4） 根据尺寸数量级设置阴影渲染范围
    </h5>
    <p>
     比如光线是从斜上方照射下来，模型y方向高度100左右，这时候y可以设置为100左右，xz也可以根据渲染范围先给个大概尺寸。
    </p>
    <pre><code>directionalLight.position.set(100, 100, 100);
// 平行光默认从.position指向坐标原点
</code></pre>
    <p>
     光线方向，你可以改变xz坐标来调整
    </p>
    <pre><code>directionalLight.position.set(-100, 100, -100);
</code></pre>
    <p>
     渲染范围可以都先给个几百量级的值，不用精准，先设置，在微调。
    </p>
    <pre><code>// 设置三维场景计算阴影的范围
directionalLight.shadow.camera.left = -100;
directionalLight.shadow.camera.right = 100;
directionalLight.shadow.camera.top = 100;
directionalLight.shadow.camera.bottom = -100;
directionalLight.shadow.camera.near = 0.5;
directionalLight.shadow.camera.far = 100;
</code></pre>
    <h4>
     <a id="6__164">
     </a>
     6. 投射阴影接受阴影
    </h4>
    <h5>
     <a id="61_166">
     </a>
     6.1）开启场景阴影贴图
    </h5>
    <pre><code class="prism language-js">renderer<span class="token punctuation">.</span>shadowMap<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="62_173">
     </a>
     6.2）设置光照投射阴影
    </h5>
    <pre><code class="prism language-js"><span class="token keyword">const</span> directionalLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>DirectionalLight</span><span class="token punctuation">(</span><span class="token number">0xffffff</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
directionalLight<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
directionalLight<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
</code></pre>
    <h5>
     <a id="63_181">
     </a>
     6.3）接受投射阴影
    </h5>
    <pre><code class="prism language-js"><span class="token comment">// 定义一个球  几何体 材质  缺一不可！！！！</span>
<span class="token keyword">let</span> sphereGeometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>SphereGeometry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshStandardMaterial</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> sphere <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>sphereGeometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span>
<span class="token comment">//投射阴影</span>
sphere<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sphere<span class="token punctuation">,</span> <span class="token string">'sphere'</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sphere<span class="token punctuation">)</span>
</code></pre>
    <blockquote>
     <p>
      感谢：b站up主：
      <a href="https://link.juejin.cn/?target=https%3A%2F%2Fspace.bilibili.com%2F40018594" rel="nofollow" title="https://link.juejin.cn/?target=https%3A%2F%2Fspace.bilibili.com%2F40018594">
       老陈打码
      </a>
      以及
      <a href="https://link.juejin.cn/?target=http%3A%2F%2Fwww.webgl3d.cn%2Fpages%2Fb483f0%2F" rel="nofollow" title="https://link.juejin.cn/?target=http%3A%2F%2Fwww.webgl3d.cn%2Fpages%2Fb483f0%2F">
       threejs中文网
      </a>
      教学及参考文档
      <br/>
      <strong>
       到此threejs进阶学习结束，道阻且长，行则将至。与诸君共勉。
      </strong>
      ⭐️
     </p>
    </blockquote>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f796f6e675f73752f:61727469636c652f64657461696c732f313436313730363633" class_="artid" style="display:none">
 </p>
</div>


