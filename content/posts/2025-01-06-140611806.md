---
layout: post
title: "音视频开发教程RTMP服务器搭建"
date: 2025-01-06 20:54:26 +0800
description: "音视频开发教程：RTMP服务器搭建_rtmp服务器搭建"
keywords: "rtmp服务器搭建"
categories: ['音视频开发']
tags: ['音视频开发', '音视频', '流媒体服务器', 'Rtmp', 'C']
artid: "140611806"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=140611806
    alt: "音视频开发教程RTMP服务器搭建"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=140611806
featuredImagePreview: https://bing.ee123.net/img/rand?artid=140611806
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     音视频开发教程：RTMP服务器搭建
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     流媒体
    </h2>
    <h2>
     基本概念
    </h2>
    <p>
     流媒体（Streaming media），也叫做：流式媒体。
    </p>
    <ul>
     <li>
      是指将一连串的多媒体数据压缩后，经过互联网
      <strong>
       分段发送
      </strong>
      数据，在互联网上即时传输影音以供观赏的一种技术与过程
     </li>
     <li>
      此技术使得数据包可以像
      <strong>
       流水
      </strong>
      一样发送，如果不使用此技术，就必须得先
      <strong>
       下载整个
      </strong>
      媒体文件才能进行观看
     </li>
    </ul>
    <p>
     流媒体的一个非常典型、火爆的应用场景：直播。近几年，直播行业是蒸蒸日上。
    </p>
    <h2>
     直播架构
    </h2>
    <p>
     下面放几张图片，简单了解一下直播技术的基本架构。
    </p>
    <p>
     <img alt="" height="496" src="https://i-blog.csdnimg.cn/direct/812aa9358a1441e38d10f43d742aa6a8.png" width="1035"/>
    </p>
    <p>
     <img alt="" height="589" src="https://i-blog.csdnimg.cn/direct/015dae4292834da7a65d150d44c029e6.png" width="1164">
     </img>
    </p>
    <p>
     你可能会有个疑问：
     <strong>
      信令服务器
     </strong>
     是干嘛用的？用来处理分享端和观看端的一些信令指令，比如创建房间、加入房间等。
    </p>
    <p>
     <img alt="" height="830" src="https://i-blog.csdnimg.cn/direct/dc8bfcf9aa8c4b66a72c543aa0806f10.png" width="1200"/>
    </p>
    <p>
     <img alt="" height="457" src="https://i-blog.csdnimg.cn/direct/3911db66b1534bb0a2ea83d6751b9bd6.png" width="1089">
     </img>
    </p>
    <p>
     用文字总结一下基本流程是：
    </p>
    <ul>
     <li>
      分享端（比如主播） -&gt; 产生音视频 -&gt; 编码压缩音视频 -&gt;
      <strong>
       推流
      </strong>
      到服务器
     </li>
     <li>
      观看端（比如观众） -&gt; 从服务器
      <strong>
       拉流
      </strong>
      -&gt; 解码解压缩音视频 -&gt; 播放音视频
     </li>
    </ul>
    <h2>
     推拉流
    </h2>
    <ul>
     <li>
      推流：通过
      <strong>
       流媒体协议
      </strong>
      ，将音视频数据发送到流媒体服务器
     </li>
     <li>
      拉流：通过
      <strong>
       流媒体协议
      </strong>
      ，从流媒体服务器上拉取获得音视频数据
     </li>
    </ul>
    <h2>
     流媒体协议
    </h2>
    <p>
     常见的流媒体协议有：RTMP、HLS等。
    </p>
    <ul>
     <li>
      RTMP（
      <strong>
       R
      </strong>
      eal-
      <strong>
       T
      </strong>
      ime
      <strong>
       M
      </strong>
      essaging
      <strong>
       P
      </strong>
      rotocol）译为：实时消息传输协议，由Adobe公司出品默认基于TCP的1935端口
     </li>
     <li>
      HLS（
      <strong>
       H
      </strong>
      TTP
      <strong>
       L
      </strong>
      ive
      <strong>
       S
      </strong>
      treaming）基于HTTP的流媒体网络传输协议，苹果公司出品参考：RFC 8216
     </li>
    </ul>
    <p>
     本文主要介绍RTMP协议相关知识。
    </p>
    <h2>
     服务器环境
    </h2>
    <p>
     首先，要搭建好RTMP服务器环境，主要步骤如下：
    </p>
    <ul>
     <li>
      安装虚拟机VMWare或Parallels Desktop我这里安装的是VMWare
     </li>
     <li>
      在虚拟机上安装
      <strong>
       CentOS
      </strong>
      系统CentOS是Linux系统的一种，这里用
      <strong>
       7.6
      </strong>
      版本，建议跟我的版本保持一致
     </li>
     <li>
      在CentOS系统中安装
      <strong>
       nginx
      </strong>
      、
      <strong>
       nginx-rtmp-module
      </strong>
      nginx：一款高性能的开源web服务器nginx-rtmp-module：让nginx支持rtmp
     </li>
     <li>
      配置nginx
     </li>
     <li>
      启动nginx
     </li>
    </ul>
    <h2>
     安装CentOS
    </h2>
    <h2>
     下载CentOS
    </h2>
    <p>
     推荐网站：centoschina，上面有CentOS的各种版本，这里下载CentOS-7-x86_64-DVD-1810.iso，大小是4G多。
    </p>
    <h2>
     安装nginx
    </h2>
    <p>
     在nginx官网下载目前最新的稳定版：nginx-1.20.1.tar.gz。
    </p>
    <h2>
     安装nginx-rtmp-module
    </h2>
    <p>
     在nginx-rtmp-module的github下载目前最新的稳定版：v1.2.2.tar.gz。
    </p>
    <h2>
     配置nginx
    </h2>
    <h2>
     启动nginx
    </h2>
    <h2>
     一些步骤和命令整理
    </h2>
    <ul>
     <li>
      安装依赖
     </li>
    </ul>
    <pre><code>yum install -y gcc pcre pcre-devel zlib zlib-devel openssl openssl-devel</code></pre>
    <ul>
     <li>
      设置共享文件
     </li>
    </ul>
    <p>
     夹查看共享成功与否
    </p>
    <p>
     <em>
      vmware-hgfsclient
     </em>
    </p>
    <ul>
     <li>
      挂载到对应目录（这里放mnt）
     </li>
    </ul>
    <p>
     <em>
      vmhgfs-fuse .host:/共享目录名称 /mnt/目录名称
     </em>
    </p>
    <ul>
     <li>
      解压ngnix相关内容
     </li>
    </ul>
    <p>
     <em>
      cp 源 目标
     </em>
    </p>
    <p>
     <em>
      tar -zxvf 解压文件
     </em>
    </p>
    <ul>
     <li>
      进入nginx目录，执行configure进行配置
     </li>
    </ul>
    <pre><code>./configure --prefix=/usr/local/nginx --add-module=ngnix的rtmp模块目录 --with-http_ssl_module</code></pre>
    <ul>
     <li>
      修改nginx配置
     </li>
    </ul>
    <p>
     <em>
      vim conf/nginx.conf
     </em>
    </p>
    <pre><code>rtmp {      
    server {    
        listen 1935; # 端口
        chunk_size 4000;     
        application live { # 请求路径
            live on;     
        }   
    }   
}</code></pre>
    <ul>
     <li>
      配置PATH
     </li>
    </ul>
    <p>
     <em>
      export PATH=$PATH:/usr/local/nginx/sbin
     </em>
    </p>
    <ul>
     <li>
      启动nginx
     </li>
    </ul>
    <p>
     <em>
      nginx
     </em>
    </p>
    <ul>
     <li>
      查看
     </li>
    </ul>
    <p>
     端口占用：
     <em>
      lsof -i:1935
     </em>
    </p>
    <p>
     杀死进程：
     <em>
      kill -9 pid
     </em>
    </p>
    <ul>
     <li>
      如果远程连接不上rtmp服务器，有可能是因为防火墙把1935端口关掉了
     </li>
    </ul>
    <pre><code># 查看端口情况（返回no代表被关闭了）
firewall-cmd --query-port=1935/tcp
 
# 拿到zone名称（一般是public）
firewall-cmd --get-active-zones
 
# 打开端口
firewall-cmd --zone=public --add-port=1935/tcp --permanent
 
# 重启防火墙（再次查看端口情况，应该会返回yes了）
firewall-cmd --reload</code></pre>
    <ul>
     <li>
      ffmpeg推流
     </li>
    </ul>
    <pre><code>ffmpeg -i xx.mp4 -f flv rtmp://ip地址:1935/live/xx</code></pre>
    <ul>
     <li>
      ffmpeg拉流
     </li>
    </ul>
    <pre><code>ffplay rtmp://ip地址:1935/live/xx</code></pre>
    <blockquote>
     <p style="margin-left:0;text-align:center;">
      <span style="background-color:#FFFFFF;">
       <strong>
        <span style="background-color:#eef0f4;">
         <span style="color:#FF0000;">
          粉丝福利， 免费领取C++音视频学习资料包+学习路线大纲、技术视频/代码，内容包括（音视频开发，面试题，FFmpeg ，webRTC ，rtmp ，hls ，rtsp ，ffplay ，编解码，推拉流，srs）↓↓↓↓↓↓见下面↓↓文章底部点击免费领取↓↓
         </span>
        </span>
       </strong>
      </span>
     </p>
    </blockquote>
   </div>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f37333434333437382f:61727469636c652f64657461696c732f313430363131383036" class_="artid" style="display:none">
 </p>
</div>


