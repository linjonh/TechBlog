---
layout: post
title: "微信小程序监听键盘变化改变textarea位置"
date: 2024-12-25 18:02:24 +0800
description: "需求：做一个能够点击评论后自动弹起键盘并且在键盘上有一个textarea的输入框思路：先将texta"
keywords: "wx.onkeyboardheightchange"
categories: ['小程序', '前端']
tags: ['小程序', 'Javascript', 'Html', 'Html', 'Css']
artid: "106085255"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=106085255
    alt: "微信小程序监听键盘变化改变textarea位置"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=106085255
featuredImagePreview: https://bing.ee123.net/img/rand?artid=106085255
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微信小程序监听键盘变化改变textarea位置
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="textarea_0">
     </a>
     需求：做一个能够点击评论后自动弹起键盘并且在键盘上有一个textarea的输入框
    </h2>
    <p>
     思路：先将textarea隐藏起来，当点击评论后显示，这个时候，利用微信textarea的属性auto-focus自动聚焦，拉起键盘。然后将定位textarea的bottom修改为键盘高度,收起时监听键盘的高度，当高度等于0时，将textarea隐藏
    </p>
    <p>
     注意：小程序中textarea的bindkeyboardheightchange属性能够监听到键盘的高度，当键盘高度发生变化的时候触发事件，在ios系统中能够正常使用，但是在部分安卓手机中出现bug，点击键盘外空白出，键盘收起，但是事件并没有触发，后来发现用api能够解决这个问题，但是也要注意，这两个都会在键盘升起或者收下时调用多次，后来发现弹起时第一次的数据是错误的，在ios中是0，在安卓不是0不是键盘高度，高度要比键盘高度小一些，所以需要将第一次监听到的高度去掉
     <br/>
     <img alt="IMG_1549(20200512-203100).png" src="https://i-blog.csdnimg.cn/blog_migrate/5fb477e4580527225d4c350661157f52.png"/>
    </p>
    <p>
     部分代码
    </p>
    <pre><code class="prism language-javascript">onShow<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
wx<span class="token punctuation">.</span><span class="token function">onKeyboardHeightChange</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//监听键盘高度变化</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">keyBoardChange</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>，
</code></pre>
    <pre><code class="prism language-javascript"> <span class="token function">comment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
       showTextara<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//将textarea显示，聚焦自动拉起键盘，此时触发了onKeyboardHeightChange</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-javascript"><span class="token function">keyBoardChange</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//键盘高度改变时调用</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>first<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//弹起时第一次的数据是错误的，所以不需要修改keyBoardHeight</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        first<span class="token punctuation">:</span> <span class="token boolean">false</span>  <span class="token comment">//将first改为false表示不是第一次调用</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">let</span> keyBoardHeight <span class="token operator">=</span> height <span class="token operator">+</span> <span class="token string">'px'</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        keyBoardHeight <span class="token comment">//将键盘的高度设置到data中，后续可以通过它来修改定位textarea的bottom，使它弹起或者收起</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>keyBoardHeight <span class="token operator">===</span> <span class="token string">'0px'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            showTextara<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token comment">//键盘高度等于0时，隐藏textarea</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span> 
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34363030343433382f:61727469636c652f64657461696c732f313036303835323535" class_="artid" style="display:none">
 </p>
</div>


