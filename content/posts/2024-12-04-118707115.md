---
layout: post
title: "vMotion迁移报错提示目标主机不支持虚拟机的当前硬件要求"
date: 2024-12-04 21:42:22 +0800
description: "在vSphere 集群中将虚拟机通过vMotion迁移到新搭建的集群时遇到问题。报错信息目标主机不支"
keywords: "目标主机不支持虚拟机的当前硬件要求。 使用已启用增强型 vmotion 兼容性 (evc)"
categories: ['虚拟化技术', 'Vsphere']
tags: ['Vsphere', 'Vmware']
artid: "118707115"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=118707115
    alt: "vMotion迁移报错提示目标主机不支持虚拟机的当前硬件要求"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=118707115
featuredImagePreview: https://bing.ee123.net/img/rand?artid=118707115
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     vMotion迁移报错提示目标主机不支持虚拟机的当前硬件要求
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在vSphere 集群中将虚拟机通过
     <code>
      vMotion
     </code>
     迁移到新搭建的集群时遇到问题。
    </p>
    <h3>
     <a id="_3">
     </a>
     报错信息
    </h3>
    <pre><code class="prism language-text">目标主机不支持虚拟机当前的硬件要求。
使用启用了增强vMotion兼容性（EVC）的群集，在整个群集中创建一个统一的CPU功能集，或者使用每虚拟机EVC为虚拟机创建一个一致的CPU功能集，并允许虚拟机移动到能够支持这个CPU功能集的主机。
请参见知识库文章1003212了解集群EVC信息。
com.vmware.vim.vmfeature.cpuid.mdclear
</code></pre>
    <p>
     <img alt="cpuid.mdclear" src="https://i-blog.csdnimg.cn/blog_migrate/52e3d76e406e474fe03c26dcb6d14219.png#pic_center"/>
    </p>
    <p>
     看到这个报错信息首先考虑两个集群的CPU型号不一样或者是EVC模式有问题。
    </p>
    <p>
     检查客户的集群环境，集群信息如下：
    </p>
    <p>
     <code>
      vCenter
     </code>
     版本为：
     <code>
      vCenter Appliance 6.7 Update 2b (6.7.0.31100)
     </code>
     内部版本：
     <code>
      13843469
     </code>
    </p>
    <p>
     源集群
     <code>
      ESXi
     </code>
     版本：
     <code>
      VMware ESXi, 6.5.0, 13635690
     </code>
    </p>
    <p>
     目标集群
     <code>
      ESXi
     </code>
     版本：
     <code>
      VMware ESXi, 6.7.0, 13006603
     </code>
    </p>
    <p>
     服务器型号都是
     <code>
      H3C
     </code>
     的
     <code>
      R6900 G3
     </code>
     服务器。
    </p>
    <p>
     <code>
      CPU
     </code>
     型号：
     <code>
      Intel(R) Xeon(R) Gold 5118 CPU @ 2.30GHz
     </code>
    </p>
    <p>
     两个集群都没开EVC功能。
    </p>
    <p>
     经过检查判断此问题不是CPU 型号不一致或者EVC 模式导致的。
    </p>
    <h3>
     <a id="_33">
     </a>
     原因
    </h3>
    <p>
     通过查询
     <code>
      VMware KB
     </code>
     得知，出现此问题是为了缓解Intel CPU “微架构数据采样”(MDS) 漏洞而采取的补救错误，在
     <code>
      vCenter Server
     </code>
     和
     <code>
      ESXi
     </code>
     中启用
     <code>
      MD_CLEAR
     </code>
     硬件支持。在目标集群中由于ESXi 版本低，没有开启
     <code>
      MD_CLEAR
     </code>
     硬件支持。
    </p>
    <h3>
     <a id="_36">
     </a>
     解决
    </h3>
    <p>
     支持启用
     <code>
      MD_CLEAR
     </code>
     硬件支持的版本
    </p>
    <p>
     <code>
      vCenter 6.7
     </code>
     中在
     <code>
      6.7 U2a
     </code>
     版本修复的此问题，
     <br/>
     <code>
      ESXi 6.5
     </code>
     中在
     <code>
      ESXi650-201905001
     </code>
     内部版本
     <code>
      13635690
     </code>
     补丁中修复。
     <br/>
     <code>
      ESXi 6.7
     </code>
     中在
     <code>
      ESXi670-201905001
     </code>
     内部版本
     <code>
      13644319
     </code>
     补丁中修复。
    </p>
    <p>
     其他版本可查询
     <code>
      vmware
     </code>
     安全公告
     <a href="https://www.vmware.com/security/advisories/VMSA-2019-0008.html" rel="nofollow">
      VMSA-2019-0008
     </a>
    </p>
    <p>
     在我的环境中需要升级目标集群esxi的版本，由于一些其他第三方软件限制我将esxi版本升级到了ESXi670-201905001，经过vmotion验证，问题得到解决。
    </p>
    <blockquote>
     <p>
      <a href="https://kb.vmware.com/s/article/68024?lang=zh_cn" rel="nofollow">
       针对“微架构数据采样”(MDS)漏洞实施管理程序协助的客户机缓解措施
      </a>
      <br/>
      <a href="https://kb.vmware.com/s/article/2143832?lang=zh_cn" rel="nofollow">
       VMware ESXi/ESX 的内部版本号和版本对应关系
      </a>
      <br/>
      <a href="https://kb.vmware.com/s/article/2143838?lang=zh_cn" rel="nofollow">
       VMware vCenter Server 的内部版本号和版本对应关系
      </a>
     </p>
    </blockquote>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f7869616f5f78782f:61727469636c652f64657461696c732f313138373037313135" class_="artid" style="display:none">
 </p>
</div>


