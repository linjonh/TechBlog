---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f71796a31393932303730342f:61727469636c652f64657461696c732f313335343734333334"
layout: post
title: "MySQLç³»åˆ—Too-many-connections"
date: 2025-01-09 10:05:11 +0800
description: "æœ¬æ–‡ä»‹ç»äº†MySQLæŠ¥é”™08004:1040çš„å«ä¹‰ï¼Œå³è¿žæŽ¥æ•°è¿‡å¤šã€‚åŽŸå› å¯èƒ½æ˜¯max_connecti"
keywords: "mysqlé»˜è®¤æœ€å¤§è¿žæŽ¥æ•°"
categories: ['æ•°æ®åº“', 'S']
tags: ['æ•°æ®åº“', 'Mysql']
artid: "135474334"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=135474334
    alt: "MySQLç³»åˆ—Too-many-connections"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=135474334
featuredImagePreview: https://bing.ee123.net/img/rand?artid=135474334
---

# ã€MySQLç³»åˆ—ã€‘Too many connections

> ðŸ’ðŸ’ðŸ’æ¬¢è¿Žæ¥åˆ°æˆ‘çš„åšå®¢ï¼Œå¾ˆé«˜å…´èƒ½å¤Ÿåœ¨è¿™é‡Œå’Œæ‚¨è§é¢ï¼å¸Œæœ›æ‚¨åœ¨è¿™é‡Œå¯ä»¥æ„Ÿå—åˆ°ä¸€ä»½è½»æ¾æ„‰å¿«çš„æ°›å›´ï¼Œä¸ä»…å¯ä»¥èŽ·å¾—æœ‰è¶£çš„å†…å®¹å’ŒçŸ¥è¯†ï¼Œä¹Ÿå¯ä»¥ç•…æ‰€æ¬²è¨€ã€åˆ†äº«æ‚¨çš„æƒ³æ³•å’Œè§è§£ã€‚
>   
> ![img](https://i-blog.csdnimg.cn/blog_migrate/5b7d56665d406fee3159289ac61fa974.jpeg#pic_center)
>
> * æŽ¨è:
>   [kwan çš„é¦–é¡µ](https://qinyingjie.blog.csdn.net/?type=blog)
>   ,æŒç»­å­¦ä¹ ,ä¸æ–­æ€»ç»“,å…±åŒè¿›æ­¥,æ´»åˆ°è€å­¦åˆ°è€
> * å¯¼èˆª
>   + [æª€è¶Šå‰‘æŒ‡å¤§åŽ‚ç³»åˆ—](https://blog.csdn.net/qyj19920704/category_11763029.html)
>     :å…¨é¢æ€»ç»“ java æ ¸å¿ƒæŠ€æœ¯ç‚¹,å¦‚é›†åˆ,jvm,å¹¶å‘ç¼–ç¨‹ redis,kafka,Spring,å¾®æœåŠ¡,Netty ç­‰
>   + [å¸¸ç”¨å¼€å‘å·¥å…·ç³»åˆ—](https://blog.csdn.net/qyj19920704/category_11474211.html)
>     :ç½—åˆ—å¸¸ç”¨çš„å¼€å‘å·¥å…·,å¦‚ IDEA,Mac,Alfred,electerm,Git,typora,apifox ç­‰
>   + [æ•°æ®åº“ç³»åˆ—](https://blog.csdn.net/qyj19920704/category_11474265.html)
>     :è¯¦ç»†æ€»ç»“äº†å¸¸ç”¨æ•°æ®åº“ mysql æŠ€æœ¯ç‚¹,ä»¥åŠå·¥ä½œä¸­é‡åˆ°çš„ mysql é—®é¢˜ç­‰
>   + [æ‡’äººè¿ç»´ç³»åˆ—](https://blog.csdn.net/qyj19920704/category_7540627.html)
>     :æ€»ç»“å¥½ç”¨çš„å‘½ä»¤,è§£æ”¾åŒæ‰‹ä¸é¦™å—?èƒ½ç”¨ä¸€ä¸ªå‘½ä»¤å®Œæˆç»ä¸ç”¨ä¸¤ä¸ªæ“ä½œ
>   + [æ•°æ®ç»“æž„ä¸Žç®—æ³•ç³»åˆ—](https://blog.csdn.net/qyj19920704/category_11480075.html)
>     :æ€»ç»“æ•°æ®ç»“æž„å’Œç®—æ³•,ä¸åŒç±»åž‹é’ˆå¯¹æ€§è®­ç»ƒ,æå‡ç¼–ç¨‹æ€ç»´,å‰‘æŒ‡å¤§åŽ‚
>
> éžå¸¸æœŸå¾…å’Œæ‚¨ä¸€èµ·åœ¨è¿™ä¸ªå°å°çš„ç½‘ç»œä¸–ç•Œé‡Œå…±åŒæŽ¢ç´¢ã€å­¦ä¹ å’Œæˆé•¿ã€‚ðŸ’ðŸ’ðŸ’ âœ¨âœ¨ æ¬¢è¿Žè®¢é˜…æœ¬ä¸“æ  âœ¨âœ¨

#### åšå®¢ç›®å½•

* + [é—®é¢˜æè¿°](#_15)
  + [æŠ¥é”™ä¿¡æ¯](#_33)
  + [é”™è¯¯åŽŸå› ](#_40)
  + [è§£å†³æ–¹æ¡ˆ](#_50)
  + - [æŸ¥çœ‹ MySQL ç‰ˆæœ¬](#_MySQL__58)
    - [æŸ¥çœ‹å½“å‰ MySQL æœ€å¤§è¿žæŽ¥æ•°é™åˆ¶](#_MySQL__68)
    - [ç¡®å®šè¿žæŽ¥æ•°ä¸å¤ŸåŽŸå› ](#_78)
    - [ä¿®æ”¹æœ€å¤§è¿žæŽ¥æ•°](#_82)
    - [å‘½ä»¤è®¾ç½®](#_88)
    - [ä¿®æ”¹ my.cnf æ–‡ä»¶](#_mycnf__98)

### é—®é¢˜æè¿°

è§£å†³ MySQL æŠ¥é”™:

> Data source rejected establishment of connection, message from server: "Too many connectio\_MySQL

åœ¨åšé¡¹ç›®æ—¶ï¼Œåˆ›å»ºå¤šä¸ªæ•°æ®åº“è¿›è¡Œè¿žæŽ¥ï¼Œè¿™ä¸ªæŠ¥é”™ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼ŒMySQL è¿žæŽ¥æ•°ä¸å¤Ÿç”¨äº†

è¿™ä¸ªé”™è¯¯æ¶ˆæ¯æ¶‰åŠåˆ°æ•°æ®åº“è¿žæŽ¥æ–¹é¢çš„é—®é¢˜ï¼Œå…·ä½“æ¥è¯´æ˜¯å…³äºŽè¿žæŽ¥æ•°çš„é™åˆ¶ã€‚

1. **SQLStateï¼šâ€œ08004â€**
   ï¼šè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ SQL çŠ¶æ€ç ï¼Œé€šå¸¸è¡¨ç¤ºè¿žæŽ¥é”™è¯¯æˆ–æ•°æ®åº“ä¸å¯ç”¨ã€‚
2. **vendorCodeï¼š1040**
   ï¼šè¿™æ˜¯ç‰¹å®šäºŽæ•°æ®åº“ä¾›åº”å•†çš„é”™è¯¯ä»£ç ï¼Œè¿™é‡Œæ˜¯ MySQL æ•°æ®åº“çš„é”™è¯¯ä»£ç ã€‚åœ¨ MySQL ä¸­ï¼Œé”™è¯¯ä»£ç  1040 è¡¨ç¤ºè¿žæŽ¥æ•°è¿‡å¤šçš„é—®é¢˜ã€‚
3. **detailMessage**
   ï¼šè¿™æ˜¯è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼ŒæŒ‡å‡ºäº†å…·ä½“çš„é—®é¢˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨è¿”å›žçš„æ¶ˆæ¯æ˜¯ï¼šâ€œData source rejected establishment of connection, message from server: â€œToo many connectionsâ€â€ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯"æ•°æ®æºæ‹’ç»å»ºç«‹è¿žæŽ¥ï¼ŒæœåŠ¡å™¨æ¶ˆæ¯ï¼šè¿žæŽ¥å¤ªå¤š"ã€‚

è¿™ä¸ªé”™è¯¯å‘ç”Ÿåœ¨å°è¯•å»ºç«‹æ•°æ®åº“è¿žæŽ¥æ—¶ï¼Œä½†ç”±äºŽè¿žæŽ¥æ•°å·²ç»è¾¾åˆ°äº†æ•°æ®åº“æœåŠ¡å™¨çš„é™åˆ¶ï¼Œæ‰€ä»¥è¿žæŽ¥è¢«æ‹’ç»ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºæ•°æ®åº“æœåŠ¡å™¨åŒæ—¶å¤„ç†äº†å¤ªå¤šçš„è¿žæŽ¥è¯·æ±‚ï¼Œæˆ–è€…ç³»ç»Ÿé…ç½®è®¾ç½®äº†è¿žæŽ¥æ•°çš„ä¸Šé™ã€‚è§£å†³æ–¹æ³•é€šå¸¸åŒ…æ‹¬å¢žåŠ æ•°æ®åº“æœåŠ¡å™¨çš„æœ€å¤§è¿žæŽ¥æ•°é…ç½®ï¼Œä¼˜åŒ–æ•°æ®åº“è¿žæŽ¥çš„ä½¿ç”¨ï¼Œæˆ–è€…è°ƒæ•´åº”ç”¨ç¨‹åºçš„è¿žæŽ¥ç®¡ç†ç­–ç•¥ã€‚

### æŠ¥é”™ä¿¡æ¯

æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š

> â€œSQLStateâ€:â€œ08004â€,â€œvendorCodeâ€:1040,â€œdetailMessageâ€:
>   
> â€œData source rejected establishment of connection,message from server: â€œToo many connectionsâ€â€

### é”™è¯¯åŽŸå› 

**æ ¹æœ¬åŽŸå› æ˜¯ MySQL è¿žæŽ¥æ•°ä¸å¤Ÿç”¨äº†**

ä½†ä¹Ÿè¦åˆ†æƒ…å†µçœ‹ä¸ºä»€ä¹ˆä¸å¤Ÿç”¨äº†

**1. æ˜¯ MySQL çš„ max\_connections å±žæ€§é…ç½®å¤ªå°ï¼Ÿ**

**2. è¿˜æ˜¯æ˜¯å¤šæ¬¡ insert,update æ“ä½œæ²¡æœ‰å…³é—­ sessionï¼Ÿ**

### è§£å†³æ–¹æ¡ˆ

æˆ‘ä»¬è¦çŸ¥é“ï¼ŒMySQL ç‰ˆæœ¬çš„ä¸åŒï¼Œå¯è®¾ç½®çš„æœ€å¤§è¿žæŽ¥æ•°èŒƒå›´ä¹Ÿæ˜¯æœ‰æ‰€åŒºåˆ«çš„ï¼š

* MySQL5.5 ï½ž 5.7ï¼šé»˜è®¤çš„æœ€å¤§è¿žæŽ¥æ•°éƒ½æ˜¯ 151ï¼Œä¸Šé™ä¸ºï¼š100000
* MySQL5.0 ç‰ˆæœ¬ï¼šé»˜è®¤çš„æœ€å¤§è¿žæŽ¥æ•°ä¸º 100ï¼Œä¸Šé™ä¸º 16384
* MySQL8.0 ç‰ˆæœ¬: é»˜è®¤çš„æœ€å¤§è¿žæŽ¥æ•°æ˜¯ 151

#### æŸ¥çœ‹ MySQL ç‰ˆæœ¬

```sql
SELECT VERSION() ;

```

å¦‚ä¸‹ï¼Œæˆ‘è¿™é‡Œæ˜¯åŸºäºŽ MySQL 8.0.35ï¼Œé‚£ä¹ˆé»˜è®¤çš„æœ€å¤§è¿žæŽ¥æ•°åº”è¯¥æ˜¯ 151

![image-20240109100219341](https://i-blog.csdnimg.cn/blog_migrate/166e7887a09b36e528d4d4385bb43d06.png)

#### æŸ¥çœ‹å½“å‰ MySQL æœ€å¤§è¿žæŽ¥æ•°é™åˆ¶

```apl
show variables like 'max_connections';

```

![image-20240109100248972](https://i-blog.csdnimg.cn/blog_migrate/769ed42665373cc1e23d0b0c4601450d.png)

å½“å‰æœ€å¤§è¿žæŽ¥æ•°é™åˆ¶æ˜¯ 151ï¼Œæ˜¾ç¤º 1500,æ˜¯å› ä¸ºæˆ‘ä¿®æ”¹è¿‡äº†

#### ç¡®å®šè¿žæŽ¥æ•°ä¸å¤ŸåŽŸå› 

å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘çš„æƒ…å†µå½“å‰æ˜¯æœ€å¤§è¿žæŽ¥æ•°é™åˆ¶æ˜¯ 151ï¼Œåœ¨æ­¤ä¹‹å‰ä¾ç„¶
**åˆ›å»ºè¿‡åå‡ ä¸ªæ•°æ®åº“**
ï¼›åŒæ—¶æˆ‘åˆå†æ¬¡è‡ªè¡Œæ£€æŸ¥è¿‡ï¼Œæˆ‘è¿™é‡Œ
**ä¸å­˜åœ¨æœªå…³é—­ session çš„æ“ä½œ**
ï¼Œæ‰€ä»¥åŽŸå› æ˜¯ max\_connections å±žæ€§é…ç½®å¤ªå°

#### ä¿®æ”¹æœ€å¤§è¿žæŽ¥æ•°

ä¿®æ”¹ MySQL å®¢æˆ·ç«¯æœ€å¤§è¿žæŽ¥æ•°å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ï¼š

**ä¸€ç§æ˜¯ä½¿ç”¨å‘½ä»¤è®¾ç½®ï¼Œå¦ä¸€ç§æ˜¯ç›´æŽ¥ä¿®æ”¹ my.cnf æ–‡ä»¶**

#### å‘½ä»¤è®¾ç½®

ä½¿ç”¨å‘½ä»¤è®¾ç½®è¿™ç§æ–¹å¼æ˜¯ä¸´æ—¶ä¿®æ”¹ï¼Œåªèƒ½æ²»æ ‡ä¸èƒ½æ²»æœ¬ï¼Œåœ¨è¿™ä¸ª MySQL æœåŠ¡ä¸é‡å¯çš„æ¡ä»¶ä¸‹æ˜¯å¯ç”¨çš„ï¼Œè‹¥ MySQL é‡å¯ä¼šæ¢å¤åˆ° MySQL é»˜è®¤çš„è¿žæŽ¥æ•°ï¼ˆæˆ–è€…æ¢å¤åˆ° my.cnf æ–‡ä»¶ä¸­é…ç½®çš„æœ€å¤§è¿žæŽ¥æ•°ï¼‰ã€‚

ä½†ç”±äºŽæˆ‘æ˜¯åœ¨æµ‹è¯•ï¼Œæ— æ‰€è°“ï¼ŒMySQL é‡å¯åŽçš„è¿žæŽ¥æ•°

```sql
set global max_connections=1500;

```

#### ä¿®æ”¹ my.cnf æ–‡ä»¶

MySQL é‡å¯åŽä¼šä¼˜å…ˆä½¿ç”¨ my.cnf é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ï¼Œç”¨ä¸Šé¢å‘½ä»¤è®¾ç½®åŽï¼Œè‹¥é‡å¯ MySQL æœåŠ¡ï¼Œåˆ™è¿˜æ˜¯ä¼šå›žåˆ° my.cnf æ–‡ä»¶ä¸­é…ç½®çš„æœ€å¤§è¿žæŽ¥æ•°ï¼ˆæˆ–è€…é»˜è®¤å€¼ï¼‰ã€‚

```apl
# ä¿®æ”¹my.cnfæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹å±žæ€§
max_connections=1500

# ç„¶åŽé‡å¯mysqlæœåŠ¡
$ service mysqld restart

```

å†æ¬¡åŽ»åˆ›å»ºæ•°æ®åº“è¿žæŽ¥ï¼Œå°±æ²¡é—®é¢˜äº†ï¼

> è§‰å¾—æœ‰ç”¨çš„è¯ç‚¹ä¸ªèµž
> `ðŸ‘ðŸ»`
> å‘—ã€‚
>   
> â¤ï¸â¤ï¸â¤ï¸æœ¬äººæ°´å¹³æœ‰é™ï¼Œå¦‚æœ‰çº°æ¼ï¼Œæ¬¢è¿Žå„ä½å¤§ä½¬è¯„è®ºæ‰¹è¯„æŒ‡æ­£ï¼ðŸ˜„ðŸ˜„ðŸ˜„
>
> ðŸ’˜ðŸ’˜ðŸ’˜å¦‚æžœè§‰å¾—è¿™ç¯‡æ–‡å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿè¯·ç»™ä¸ªç‚¹èµžã€æ”¶è—ä¸‹å§ï¼Œéžå¸¸æ„Ÿè°¢!ðŸ‘ ðŸ‘ ðŸ‘
>
> ðŸ”¥ðŸ”¥ðŸ”¥Stay Hungry Stay Foolish é“é˜»ä¸”é•¿,è¡Œåˆ™å°†è‡³,è®©æˆ‘ä»¬ä¸€èµ·åŠ æ²¹å§ï¼ðŸŒ™ðŸŒ™ðŸŒ™
>
> ![img](https://i-blog.csdnimg.cn/blog_migrate/101469850485989da7dda6f53e80e19d.gif#pic_center)