---
layout: post
title: "vue3深入组件依赖注入"
date: 2025-03-10 11:40:48 +0800
description: "vue3深入组件——依赖注入"
keywords: "vue3深入组件——依赖注入"
categories: ['Vue']
tags: ['Vue']
artid: "146147618"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146147618
    alt: "vue3深入组件依赖注入"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146147618
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146147618
cover: https://bing.ee123.net/img/rand?artid=146147618
image: https://bing.ee123.net/img/rand?artid=146147618
img: https://bing.ee123.net/img/rand?artid=146147618
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     vue3深入组件——依赖注入
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h4>
     一、场景介绍：一般父子间信息传递是通过props，但是一个多层嵌套的组件，必须将其沿着组件逐级的传递下去，这就是
     <span style="color:#fe2c24">
      props的逐级透传。
     </span>
     <br/>
     <img alt="" height="177" src="https://i-blog.csdnimg.cn/direct/03f42890feaa4a018031fba2059ee5da.png" width="414">
      <br/>
     </img>
    </h4>
    <h4>
     二、
     <span style="color:#fe2c24">
      上述情况下，就需要用到
      <code>
       provide
      </code>
      和
      <code>
       inject；
      </code>
     </span>
     一个父组件相对于其所有的后代组件，会作为
     <strong>
      依赖提供者
     </strong>
     。任何后代的组件树，无论层级有多深，都可以
     <strong>
      注入
     </strong>
     由父组件提供给整条链路的依赖。
    </h4>
    <h5>
     <img alt="" height="196" src="https://i-blog.csdnimg.cn/direct/99318ecf48de4816946089fb26432ec9.png" width="433">
      <br/>
      1、为后代组件提供数据，需要使用Provide (提供)
     </img>
    </h5>
    <pre><code class="language-javascript">provide('name', 'Info')
第一个参数是注入名：可以是字符串也可以是symbol，后代通过注入名查找期望的值
第二个参数是提供的值，值可为任意类型，包括响应式的状态——ref
 
&lt;script setup&gt;
import {ref, provide } from 'vue'
const count =ref(0);
provide('key', count)
&lt;/script&gt;
//提供的响应式状态，使后代组件由此和提供者建立响应式联系




// 如果没有使用&lt;script setup&gt;,需在 setup() 同步调用
&lt;script&gt;
    import { provide } 'vue'
    setup(){
        provide(/*注入名*/'message',/*值*/ 'hello')
    }
&lt;/script&gt;</code></pre>
    <h5>
     2、应用层的provide：除了在一个组件中提供依赖，我们还可以在整个应用层面提供依赖：
    </h5>
    <pre><code class="language-javascript">import { createApp } from 'vue'

const app = createApp({})

app.provide(/* 注入名 */ 'message', /* 值 */ 'hello!')

// 在应用级别提供的数据在该应用内的所有组件中都可以注入</code></pre>
    <h4>
     二、
     <span style="color:#fe2c24">
      注入(inject)
     </span>
     ：要注入上层组件提供的数据，需使用
     <a href="https://cn.vuejs.org/api/composition-api-dependency-injection.html#inject" rel="nofollow" title="inject()">
      inject()
     </a>
     函数
    </h4>
    <pre><code class="language-javascript">&lt;script setup&gt;
    import { inject } from 'vue'
    const message = inject('message')
&lt;script&gt;

// 如果提供的是一个ref，注入进来的也是ref对象，不易自动解包为其内部的值，这使得注入方组件可以通过ref对象和提供方保持响应式链接

&lt;script&gt;
    import { inject } 'vue'
    setup(){
        const message = inject('message')
        return { message }
    }
&lt;/script&gt;</code></pre>
    <h6>
     2.1、注入默认值：如果注入名没有任何组件提供，会抛出一个运行时警告，如果注入一个值时，不必须有提供者，应该声明一个默认的，和 props 类似
    </h6>
    <pre><code class="language-javascript">// 如果没有祖先组件提供 "message"
// `value` 会是 "这是默认值"
const value = inject('message', '这是默认值')</code></pre>
    <p>
     有些情况默认值可能需要调用一个函数或者初始化一个类来获取，为了避免用不到默认值的情况下进行不必要的计算或者产生副作用，可以使用工厂函数，来创建默认值
    </p>
    <pre><code class="language-javascript">const value = inject('key', () =&gt; new ExpensiveClass(), true)</code></pre>
    <p>
     <span style="color:#fe2c24">
      <strong>
       第三个参数表示默认值应该被当作一个工厂函数。
      </strong>
     </span>
    </p>
    <h4>
     <span style="color:#0d0016">
      <strong>
       三、和响应式数据配合使用
      </strong>
     </span>
    </h4>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33333931313534312f:61727469636c652f64657461696c732f313436313437363138" class_="artid" style="display:none">
 </p>
</div>


