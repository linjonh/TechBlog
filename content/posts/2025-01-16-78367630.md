---
layout: post
title: "支付宝小程序-如何获取用户信息"
date: 2025-01-16 14:57:24 +0800
description: "需要在开放平台-开发者中心-我的应用-小程序-小程序详情-开发管理-功能列表中，添加功能【获取会员信"
keywords: "getauthcode"
categories: ['支付宝小程序']
tags: ['用户信息', '支付宝小程序']
artid: "78367630"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=78367630
    alt: "支付宝小程序-如何获取用户信息"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=78367630
featuredImagePreview: https://bing.ee123.net/img/rand?artid=78367630
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     支付宝小程序--如何获取用户信息
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p style="margin-top:0px; margin-bottom:25px; color:rgb(47,47,47); font-size:16px; word-break:break-word!important">
     需要在开放平台-开发者中心-我的应用-
     <a href="http://www.wxapp-union.com/" rel="nofollow noopener noreferrer" style="background-color:transparent; color:rgb(49,148,208)" target="_blank">
      小程序
     </a>
     -小程序详情-开发管理-功能列表中，添加功能【获取会员信息】。（不需要签约）状态为“已生效”，就可以拥有调用获取会员信息的权限。 接着编写获取会员信息的代码:
    </p>
    <p style="margin-top:0px; margin-bottom:25px; color:rgb(47,47,47); font-size:16px; word-break:break-word!important">
     1.如果只是在客户端上做展示用，则使用my.getAuthCode、my.getAuthUserInfo函数即可拿到用户昵称与用户头像。 小程序示例:
    </p>
    <pre class="hljs undefined" style='overflow:auto; font-family:Menlo,Monaco,Consolas,"Courier New",monospace; font-size:13px; padding:15px; margin-top:0px; margin-bottom:20px; line-height:1.42857; word-wrap:normal; color:rgb(101,123,131); background:rgb(246,246,246); border:1px solid rgb(204,204,204); word-break:break-word!important'><code style='font-family:Menlo,Monaco,Consolas,"Courier New",monospace; font-size:12px; background-color:transparent; padding:0px; border:none'>my.getAuthCode({

 scopes: 'auth_user',

 success: (res) =&gt; { //获取用户信息

 my.getAuthUserInfo({

 success: (res) =&gt; {

 my.alert(res.nickName); //获取的用户昵称

 my.alert(res.avatar); //获取的用户头像图片

 }

 });

 },

 });
</code></pre>
    <p style="margin-top:0px; margin-bottom:25px; color:rgb(47,47,47); font-size:16px; word-break:break-word!important">
     2.如果需要把信息存储到数据库中，则需要： 第一步：调用JSAPI：my.getAuthCode，获取authcode； 代码示例：
    </p>
    <pre class="hljs undefined" style='overflow:auto; font-family:Menlo,Monaco,Consolas,"Courier New",monospace; font-size:13px; padding:15px; margin-top:0px; margin-bottom:20px; line-height:1.42857; word-wrap:normal; color:rgb(101,123,131); background:rgb(246,246,246); border:1px solid rgb(204,204,204); word-break:break-word!important'><code style='font-family:Menlo,Monaco,Consolas,"Courier New",monospace; font-size:12px; background-color:transparent; padding:0px; border:none'>//获取用户信息

 my.getAuthCode({

 scopes: 'auth_user', //授权类型，默认auth_base(静默授权)，支持auth_base/auth_user(主动授权)

 success: (res) =&gt; {

 my.alert(res.authCode); //获取的autoCode授权码

 },

 });
</code></pre>
    <p style="margin-top:0px; margin-bottom:25px; color:rgb(47,47,47); font-size:16px; word-break:break-word!important">
     第二步：调用JSAPI：my.httpRequest，连接您自己的服务器；
    </p>
    <p style="margin-top:0px; margin-bottom:25px; color:rgb(47,47,47); font-size:16px; word-break:break-word!important">
     代码示例：
    </p>
    <pre class="hljs undefined" style='overflow:auto; font-family:Menlo,Monaco,Consolas,"Courier New",monospace; font-size:13px; padding:15px; margin-top:0px; margin-bottom:20px; line-height:1.42857; word-wrap:normal; color:rgb(101,123,131); background:rgb(246,246,246); border:1px solid rgb(204,204,204); word-break:break-word!important'><code style='font-family:Menlo,Monaco,Consolas,"Courier New",monospace; font-size:12px; background-color:transparent; padding:0px; border:none'>my.getAuthCode({

 scopes: 'auth_user', // 主动授权：auth_user，静默授权：auth_base

 success: (res) =&gt; {

 if (res.authCode) { // 认证成功

 // 调用自己的服务端接口，让服务端进行后端的授权认证，并且种session，需要解决跨域问题

 my.httpRequest({

 url: 'http://isv.com/auth', // 该url是自己的服务地址，实现的功能是服务端拿到authcode去开放平台进行token验证

 data: {

 authcode: res.authcode

 },

 success: () =&gt; { // 授权成功并且服务器端登录成功 },

 fail: () =&gt; { // 根据自己的业务场景来进行错误处理 },

 });[/size]

[size=3] [/size][size=2] }

 },

 });
</code></pre>
    <p style="margin-top:0px; margin-bottom:25px; color:rgb(47,47,47); font-size:16px; word-break:break-word!important">
     注意:使用my.httpRequest连接服务器需要解决跨域问题，需要在开放平台-开发者中心-我的应用-小程序-小程序详情-开发管理-设置中添加httpRequest域名白名单 第三步：在您的服务端，调用开放平台接口alipay.system.oauth.token，用authcode换取token； 以JAVA代码为例:
    </p>
    <pre class="hljs undefined" style='overflow:auto; font-family:Menlo,Monaco,Consolas,"Courier New",monospace; font-size:13px; padding:15px; margin-top:0px; margin-bottom:20px; line-height:1.42857; word-wrap:normal; color:rgb(101,123,131); background:rgb(246,246,246); border:1px solid rgb(204,204,204); word-break:break-word!important'><code style='font-family:Menlo,Monaco,Consolas,"Courier New",monospace; font-size:12px; background-color:transparent; padding:0px; border:none'>AlipayClient alipayClient = new DefaultAlipayClient("https://openapi.alipay.com/gateway.do", APP_ID, APP_PRIVATE_KEY, "json", CHARSET, ALIPAY_PUBLIC_KEY, "RSA2");

 AlipaySystemOauthTokenRequest request = new AlipaySystemOauthTokenRequest();

 request.setCode("2e4248c2f50b4653bf18ecee3466UC18");

 request.setGrantType("authorization_code");

 try {

 AlipaySystemOauthTokenResponse oauthTokenResponse = alipayClient.execute(request);

 System.out.println(oauthTokenResponse.getAccessToken());

 } catch (AlipayApiException e) {

 //处理异常

 e.printStackTrace();

 }
</code></pre>
    <p style="margin-top:0px; margin-bottom:25px; color:rgb(47,47,47); font-size:16px; word-break:break-word!important">
     第四步：在您的服务端拿到token后，继续调用开放平台接口alipay.user.info.share，用token换取用户信息。 以JAVA代码为例:
    </p>
    <pre class="hljs undefined" style='overflow:auto; font-family:Menlo,Monaco,Consolas,"Courier New",monospace; font-size:13px; padding:15px; margin-top:0px; margin-bottom:20px; line-height:1.42857; word-wrap:normal; color:rgb(101,123,131); background:rgb(246,246,246); border:1px solid rgb(204,204,204); word-break:break-word!important'><code style='font-family:Menlo,Monaco,Consolas,"Courier New",monospace; font-size:12px; background-color:transparent; padding:0px; border:none'>AlipayClient alipayClient = new DefaultAlipayClient("https://openapi.alipay.com/gateway.do","app_id","your private _key","json","GBK","alipay_public_key","RSA2");

 AlipayUserInfoShareRequest request = new AlipayUserInfoShareRequest();

 AlipayUserInfoShareResponse response = alipayClient.execute(request,accessToken);

 if(response.isSuccess()){

 System.out.println("调用成功");

 } else {

 System.out.println("调用失败");

 }
</code></pre>
    <p style="margin-top:0px; margin-bottom:25px; color:rgb(47,47,47); font-size:16px; word-break:break-word!important">
     第五步：把处理成功的状态反馈回JSAPI中，并在小程序中展示 具体请看【
     <a href="https://myapp.alipay.com/introduce/auth" rel="nofollow noopener noreferrer" style="background-color:transparent; color:rgb(49,148,208)" target="_blank">
      小程序文档用户授权
     </a>
     】
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f726f6c616e31393933:2f61727469636c652f64657461696c732f3738333637363330" class_="artid" style="display:none">
 </p>
</div>


