---
layout: post
title: "使用TensorFlow-2构建并训练卷积神经网络CNN模型"
date: 2025-03-11 08:38:18 +0800
description: "随着深度学习技术的快速发展，卷积神经网络（CNN）在图像识别、图像分类等领域取得了显著成果。本教学案例将引导学生使用TensorFlow 2框架构建并训练一个简单的CNN模型，用于MNIST手写数字分类任务。"
keywords: "使用TensorFlow 2构建并训练卷积神经网络（CNN）模型"
categories: ['未分类']
tags: ['信息可视化', 'Python', 'Matplotlib']
artid: "146169186"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146169186
    alt: "使用TensorFlow-2构建并训练卷积神经网络CNN模型"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146169186
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146169186
cover: https://bing.ee123.net/img/rand?artid=146169186
image: https://bing.ee123.net/img/rand?artid=146169186
img: https://bing.ee123.net/img/rand?artid=146169186
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     使用TensorFlow 2构建并训练卷积神经网络（CNN）模型
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h5>
     <a id="_0">
     </a>
     一、背景介绍
    </h5>
    <p>
     随着深度学习技术的快速发展，卷积神经网络（CNN）在图像识别、图像分类等领域取得了显著成果。本教学案例将引导学生使用TensorFlow 2框架构建并训练一个简单的CNN模型，用于MNIST手写数字分类任务。
    </p>
    <h5>
     <a id="_4">
     </a>
     二、输入数据
    </h5>
    <p>
     MNIST数据集是一个包含手写数字（0-9）的图像数据集，由60000张训练图像和10000张测试图像组成，每张图像为28x28像素的灰度图
     <sup>
      [8][9]
     </sup>
     。
    </p>
    <h5>
     <a id="_8">
     </a>
     三、步骤讲解
    </h5>
    <ol>
     <li>
      <p>
       <strong>
        环境设置
       </strong>
       ：
      </p>
      <ul>
       <li>
        确保已安装TensorFlow 2库，可以使用
        <code>
         pip install tensorflow
        </code>
        命令进行安装。
       </li>
       <li>
        导入必要的库，包括TensorFlow、NumPy等。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        数据准备
       </strong>
       ：
      </p>
      <ul>
       <li>
        加载MNIST数据集。
       </li>
       <li>
        对数据进行预处理，如归一化等。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        模型构建
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用TensorFlow的Keras API构建CNN模型。
       </li>
       <li>
        定义模型结构，包括卷积层、池化层、全连接层等。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        模型编译
       </strong>
       ：
      </p>
      <ul>
       <li>
        配置模型的损失函数、优化器和评估指标。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        模型训练
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用训练数据对模型进行训练。
       </li>
       <li>
        监控训练过程中的损失和准确率。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        模型评估
       </strong>
       ：
      </p>
      <ul>
       <li>
        在测试数据集上评估模型性能。
       </li>
       <li>
        输出测试准确率等指标。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        模型预测
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用训练好的模型对新的图像数据进行预测。
       </li>
      </ul>
     </li>
    </ol>
    <h5>
     <a id="_36">
     </a>
     四、代码讲解及注释
    </h5>
    <pre><code class="prism language-python"><span class="token comment"># 导入必要的库</span>
<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras <span class="token keyword">import</span> layers<span class="token punctuation">,</span> models
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># 加载MNIST数据集</span>
mnist <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>mnist
<span class="token punctuation">(</span>train_images<span class="token punctuation">,</span> train_labels<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>test_images<span class="token punctuation">,</span> test_labels<span class="token punctuation">)</span> <span class="token operator">=</span> mnist<span class="token punctuation">.</span>load_data<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 数据预处理：归一化</span>
train_images<span class="token punctuation">,</span> test_images <span class="token operator">=</span> train_images <span class="token operator">/</span> <span class="token number">255.0</span><span class="token punctuation">,</span> test_images <span class="token operator">/</span> <span class="token number">255.0</span>

<span class="token comment"># 构建CNN模型</span>
model <span class="token operator">=</span> models<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token comment"># 第一个卷积层，32个3x3的卷积核，激活函数为ReLU</span>
    layers<span class="token punctuation">.</span>Conv2D<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">,</span> input_shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># 最大池化层，2x2的池化窗口</span>
    layers<span class="token punctuation">.</span>MaxPooling2D<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># 第二个卷积层，64个3x3的卷积核，激活函数为ReLU</span>
    layers<span class="token punctuation">.</span>Conv2D<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># 最大池化层，2x2的池化窗口</span>
    layers<span class="token punctuation">.</span>MaxPooling2D<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># 将多维输入一维化，全连接层</span>
    layers<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># 全连接层，128个神经元，激活函数为ReLU</span>
    layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># 输出层，10个神经元（对应0-9数字），激活函数为Softmax</span>
    layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'softmax'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 打印模型摘要</span>
model<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 编译模型</span>
model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>optimizer<span class="token operator">=</span><span class="token string">'adam'</span><span class="token punctuation">,</span>
              loss<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>losses<span class="token punctuation">.</span>SparseCategoricalCrossentropy<span class="token punctuation">(</span>from_logits<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 训练模型</span>
history <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_images<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> train_labels<span class="token punctuation">,</span> epochs<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> 
                    validation_data<span class="token operator">=</span><span class="token punctuation">(</span>test_images<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> test_labels<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 评估模型</span>
test_loss<span class="token punctuation">,</span> test_acc <span class="token operator">=</span> model<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span>test_images<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> test_labels<span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nTest accuracy:'</span><span class="token punctuation">,</span> test_acc<span class="token punctuation">)</span>

<span class="token comment"># 可视化训练过程</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'accuracy'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'val_accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">'val_accuracy'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Epoch'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Accuracy'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'lower right'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 模型预测</span>
predictions <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_images<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 显示预测结果</span>
<span class="token keyword">def</span> <span class="token function">plot_image</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> predictions_array<span class="token punctuation">,</span> true_label<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    predictions_array<span class="token punctuation">,</span> true_label<span class="token punctuation">,</span> img <span class="token operator">=</span> predictions_array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> true_label<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> img<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>binary<span class="token punctuation">)</span>

    predicted_label <span class="token operator">=</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>predictions_array<span class="token punctuation">)</span>
    <span class="token keyword">if</span> predicted_label <span class="token operator">==</span> true_label<span class="token punctuation">:</span>
        color <span class="token operator">=</span> <span class="token string">'blue'</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        color <span class="token operator">=</span> <span class="token string">'red'</span>

    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"{} {:2.0f}% ({})"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>class_names<span class="token punctuation">[</span>predicted_label<span class="token punctuation">]</span><span class="token punctuation">,</span>
                                <span class="token number">100</span><span class="token operator">*</span>np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>predictions_array<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                class_names<span class="token punctuation">[</span>true_label<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                color<span class="token operator">=</span>color<span class="token punctuation">)</span>

<span class="token comment"># 显示前5张测试图像的预测结果</span>
num_rows <span class="token operator">=</span> <span class="token number">5</span>
num_cols <span class="token operator">=</span> <span class="token number">3</span>
num_images <span class="token operator">=</span> num_rows <span class="token operator">*</span> num_cols
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> num_cols<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> num_rows<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_images<span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span>num_rows<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> num_cols<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    plot_image<span class="token punctuation">(</span>i<span class="token punctuation">,</span> predictions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> test_labels<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> test_images<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="_130">
     </a>
     五、代码注释说明
    </h5>
    <ol>
     <li>
      <p>
       <strong>
        数据加载与预处理
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用
        <code>
         tf.keras.datasets.mnist
        </code>
        加载MNIST数据集。
       </li>
       <li>
        将图像数据归一化到[0, 1]范围内，以便模型更好地学习。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        模型构建
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用
        <code>
         Sequential
        </code>
        模型，通过堆叠层来构建CNN。
       </li>
       <li>
        定义了两个卷积层，每个卷积层后面跟一个最大池化层，用于提取图像特征。
       </li>
       <li>
        使用
        <code>
         Flatten
        </code>
        层将多维输入一维化，以便后续的全连接层处理。
       </li>
       <li>
        定义了一个全连接层和一个输出层，输出层使用Softmax激活函数进行多分类。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        模型编译
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用
        <code>
         Adam
        </code>
        优化器来优化模型参数。
       </li>
       <li>
        使用
        <code>
         SparseCategoricalCrossentropy
        </code>
        作为损失函数，适用于整数编码的类标签。
       </li>
       <li>
        指定评估指标为准确率。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        模型训练
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用
        <code>
         fit
        </code>
        方法对模型进行训练，指定训练集和验证集。
       </li>
       <li>
        设置训练轮次（epochs）为10。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        模型评估
       </strong>
       ：
      </p>
      <ul>
       <li>
        在测试集上评估模型性能，输出测试准确率。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        模型预测与可视化
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用训练好的模型对测试集进行预测。
       </li>
       <li>
        可视化部分测试图像的预测结果，包括真实标签和预测标签。
       </li>
      </ul>
     </li>
    </ol>
    <p>
     通过本案例，大家可以掌握使用TensorFlow 2构建并训练CNN模型的基本流程，包括数据准备、模型构建、模型编译、模型训练、模型评估和模型预测等步骤。
    </p>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e6373646e:2e6e65742f7869616f7361353231313233343535343332312f:61727469636c652f64657461696c732f313436313639313836" class_="artid" style="display:none">
 </p>
</div>


