---
layout: post
title: "蓝桥杯嵌入式真题试水一2021"
date: 2022-03-29 23:09:16 +0800
description: "关于蓝桥杯嵌入式2021年真题的一些个人理解！_蓝桥杯嵌入式难度大吗"
keywords: "蓝桥杯嵌入式难度大吗"
categories: ['蓝桥杯', '笔记']
tags: ['蓝桥杯', '嵌入式硬件']
artid: "123833980"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=123833980
    alt: "蓝桥杯嵌入式真题试水一2021"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=123833980
featuredImagePreview: https://bing.ee123.net/img/rand?artid=123833980
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     蓝桥杯嵌入式真题试水（一）——2021
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="STM32G431_0">
     </a>
     STM32G431嵌入式
    </h2>
    <p>
     蓝桥杯嵌入式真题试水（一）——2021
    </p>
    <hr/>
    <p>
     <code>
      提示：写完文章后，目录可以自动生成，如何生成可参考右边的帮助文档
     </code>
    </p>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#STM32G431_0" rel="nofollow">
        STM32G431嵌入式
       </a>
      </li>
      <li>
       <a href="#_11" rel="nofollow">
        前言
       </a>
      </li>
      <li>
       <a href="#2021_19" rel="nofollow">
        一、2021年试题
       </a>
      </li>
      <li>
       <a href="#_30" rel="nofollow">
        二、涉及到的模块
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1LEDLCD_31" rel="nofollow">
          1.按键，LED，LCD
         </a>
        </li>
        <li>
         <a href="#2UART_35" rel="nofollow">
          2.UART
         </a>
        </li>
        <li>
         <a href="#3PWM_37" rel="nofollow">
          3.PWM脉冲输出
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_43" rel="nofollow">
        三：题目分析
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1LCD_45" rel="nofollow">
          1.LCD显示（规范）
         </a>
        </li>
        <li>
         <a href="#2_46" rel="nofollow">
          2.按键功能
         </a>
        </li>
        <li>
         <a href="#3_53" rel="nofollow">
          3.串口功能
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_61" rel="nofollow">
        四：重点！
       </a>
      </li>
      <li>
       <a href="#_68" rel="nofollow">
        五：贴上代码
       </a>
      </li>
      <li>
       <a href="#_381" rel="nofollow">
        六：遇到的问题
       </a>
      </li>
      <li>
       <a href="#_388" rel="nofollow">
        七、总结
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <hr/>
    <h2>
     <a id="_11">
     </a>
     前言
    </h2>
    <p>
     最近在备赛蓝桥杯嵌入式，做了几套真题，现通过写博客来记录下自己踩过的一些坑和遇到的一些问题以及解决办法！
    </p>
    <hr/>
    <p>
     <code>
      提示：以下是本篇文章正文内容，下面案例可供参考
     </code>
    </p>
    <h2>
     <a id="2021_19">
     </a>
     一、2021年试题
    </h2>
    <p>
     <img alt="示例：pandas 是基于NumPy 的一种工具，该工具是为了解决数据分析任务而创建的。" src="https://i-blog.csdnimg.cn/blog_migrate/01de4e0f625d2be8b93df68768f75bf6.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d7fddb4b0dca6ad7ec33acfc6f95fed9.png">
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ccaf86ab7d264f5beaeafcf11658b327.png">
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e71052c0f1bff4cae5d21105472bed04.png"/>
       </img>
      </img>
     </img>
    </p>
    <h2>
     <a id="_30">
     </a>
     二、涉及到的模块
    </h2>
    <h3>
     <a id="1LEDLCD_31">
     </a>
     1.按键，LED，LCD
    </h3>
    <p>
     这些模块可以说是每年必考的，我们只需要在CUBEMX上配置好即可！
    </p>
    <h3>
     <a id="2UART_35">
     </a>
     2.UART
    </h3>
    <p>
     串口！这场试题让我对串口有了一个比较深的了解！
    </p>
    <h3>
     <a id="3PWM_37">
     </a>
     3.PWM脉冲输出
    </h3>
    <p>
     也是对Cubemx进行配置即可！（较为简单）
    </p>
    <p>
     我的配置：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/11deb6b3ad3344c5112826669ad890c0.png"/>
    </p>
    <h2>
     <a id="_43">
     </a>
     三：题目分析
    </h2>
    <hr/>
    <h3>
     <a id="1LCD_45">
     </a>
     1.LCD显示（规范）
    </h3>
    <h3>
     <a id="2_46">
     </a>
     2.按键功能
    </h3>
    <p>
     key1：实现对LCD屏幕交互的操作
     <br/>
     key2：对不同车型的停车费用进行修改，每次增加0.5
     <br/>
     key3：每次减少0.5
     <br/>
     key4：切换PA7端口的电平状态.即输出2KHZ，20%占空比的脉冲信号，或者持续低电平！
     <br/>
     <strong>
      注意！
     </strong>
     <br/>
     这里按键2，3只能在LCD修改界面才能起作用
    </p>
    <h3>
     <a id="3_53">
     </a>
     3.串口功能
    </h3>
    <p>
     1.波特率9600
     <br/>
     2.四个ASCII字符作为车辆编号——车牌
     <br/>
     3.串口发送规范
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/23c07b509ebb57090074e76e3aa1e553.png">
      <br/>
      4.串口输出规范
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/baa0b0fbb7937cf6541b194e2f69184a.png">
       <br/>
       <strong>
        5.当输入信息不规范时，串口应当发出Error！
       </strong>
      </img>
     </img>
    </p>
    <h2>
     <a id="_61">
     </a>
     四：重点！
    </h2>
    <p>
     1.一些细节！比如LCD初始状态，计费标准的初始状态，PA7端口的初始状态，还有性能要求！
     <br/>
     <strong>
      这里的性能要求我们给系统的主频要足够高！
     </strong>
     <br/>
     我一般给的80Mhz，这其实是不够的，在学长点拨之后，我认为可以给到120Mhz！
     <br/>
     2.根据题目需求，我们必须构建一个数据库，用来存储车辆入库的信息！
     <br/>
     可以通过构建一个如下结构体（仅供参考）
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/bcef9921f901697ef1d01f922d823184.png"/>
    </p>
    <h2>
     <a id="_68">
     </a>
     五：贴上代码
    </h2>
    <pre><code class="prism language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">uint8_t</span> type<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token class-name">uint8_t</span> num<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token class-name">uint8_t</span> year<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token class-name">uint8_t</span> month<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token class-name">uint8_t</span> day<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token class-name">uint8_t</span> hour<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token class-name">uint8_t</span> minute<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token class-name">uint8_t</span> second<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>	car_imformation<span class="token punctuation">;</span>

__IO <span class="token class-name">uint32_t</span> LCD_uwTick<span class="token punctuation">;</span><span class="token comment">//LCD进程减速变量</span>
__IO <span class="token class-name">uint32_t</span> KEY_uwTick<span class="token punctuation">;</span><span class="token comment">//KEY进程减速变量</span>
__IO <span class="token class-name">uint32_t</span> Uart_uwTick<span class="token punctuation">;</span><span class="token comment">//UART进程减速变量</span>
<span class="token class-name">uint8_t</span> LCD_DispString<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//LCD显示字符变量</span>
<span class="token class-name">uint8_t</span> key_value<span class="token punctuation">,</span>key_old<span class="token punctuation">,</span>key_up<span class="token punctuation">,</span>key_down<span class="token punctuation">;</span><span class="token comment">//按键变量</span>
<span class="token class-name">uint8_t</span> Interface <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span><span class="token comment">//lcd交互界面变量</span>
<span class="token keyword">float</span> CNBR <span class="token operator">=</span> <span class="token number">3.5</span><span class="token punctuation">,</span>VNBR <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">;</span><span class="token comment">//定义两种车型数量</span>
<span class="token class-name">uint16_t</span> IDLE <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span><span class="token comment">//空闲车位</span>
<span class="token class-name">uint8_t</span> state <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">,</span>led1<span class="token punctuation">,</span>led2<span class="token punctuation">;</span><span class="token comment">//PA7-&gt;IO口状态,灯的状态</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> rx_buffer<span class="token punctuation">;</span><span class="token comment">//</span>
<span class="token class-name">uint8_t</span> str<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//串口发送数据存储字符</span>
<span class="token class-name">uint8_t</span> rx_buf<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//接送数据存储</span>
<span class="token class-name">uint16_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//存储顺序</span>
<span class="token class-name">uint16_t</span> year<span class="token punctuation">,</span>month<span class="token punctuation">,</span>day<span class="token punctuation">,</span>hour<span class="token punctuation">,</span>minute<span class="token punctuation">,</span>seconds<span class="token punctuation">,</span>flag <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token class-name">uint16_t</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> money<span class="token punctuation">;</span><span class="token comment">//计费</span>
car_imformation in_car<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//已入库车辆数据库</span>
car_imformation ing_car<span class="token punctuation">;</span><span class="token comment">//将要进来的车的信息</span>



<span class="token keyword">void</span> <span class="token function">SystemClock_Config</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//系统时钟配置</span>
<span class="token keyword">void</span> <span class="token function">LCD_Proc</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//LCD进程函数</span>
<span class="token class-name">uint8_t</span> <span class="token function">KEY_Scan</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//按键扫描函数</span>
<span class="token keyword">void</span> <span class="token function">KEY_Proc</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//按键进程函数</span>
<span class="token keyword">void</span> <span class="token function">HAL_UART_RxCpltCallback</span><span class="token punctuation">(</span>UART_HandleTypeDef <span class="token operator">*</span>huart<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//串口中断开启函数</span>
<span class="token keyword">void</span> <span class="token function">UART_Proc</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//串口进程函数</span>
<span class="token keyword">void</span> <span class="token function">LED_Disp</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> ucled<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//LED点亮函数</span>
<span class="token keyword">_Bool</span> <span class="token function">PD_car</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">uint16_t</span> <span class="token function">_exist</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//判断是否在车库里</span>
<span class="token keyword">void</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span> d_str<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span><span class="token operator">*</span> s_str<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> locate<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从长字符串里边提取出一段给短字符串</span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
 
  <span class="token function">HAL_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">SystemClock_Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">MX_GPIO_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">MX_TIM17_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">MX_USART1_UART_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">LCD_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">LCD_Clear</span><span class="token punctuation">(</span>Black<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">LCD_SetBackColor</span><span class="token punctuation">(</span>Black<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">LCD_SetTextColor</span><span class="token punctuation">(</span>White<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">HAL_UART_Receive_IT</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">,</span><span class="token operator">&amp;</span>rx_buffer<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开启串口中断</span>
	
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
   <span class="token function">LCD_Proc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token function">KEY_Proc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token function">UART_Proc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//按键进程函数</span>
<span class="token keyword">void</span> <span class="token function">KEY_Proc</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>uwTick <span class="token operator">-</span> KEY_uwTick <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
		KEY_uwTick  <span class="token operator">=</span> uwTick<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>IDLE<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span> led1 <span class="token operator">=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>
	key_value <span class="token operator">=</span> <span class="token function">KEY_Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	key_down <span class="token operator">=</span> key_value <span class="token operator">&amp;</span> <span class="token punctuation">(</span>key_value <span class="token operator">^</span> key_old<span class="token punctuation">)</span><span class="token punctuation">;</span>
	key_up <span class="token operator">=</span> <span class="token operator">~</span>key_value <span class="token operator">&amp;</span> <span class="token punctuation">(</span>key_value <span class="token operator">^</span> key_old<span class="token punctuation">)</span><span class="token punctuation">;</span>
	key_old <span class="token operator">=</span> key_value<span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>key_down <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Interface <span class="token operator">^=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>
		<span class="token function">LCD_Clear</span><span class="token punctuation">(</span>Black<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
		
	<span class="token keyword">if</span><span class="token punctuation">(</span>key_down <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> Interface <span class="token operator">==</span> <span class="token number">0x01</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		CNBR <span class="token operator">+=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
		VNBR <span class="token operator">+=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>key_down <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> Interface <span class="token operator">==</span> <span class="token number">0x01</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		CNBR <span class="token operator">-=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
		VNBR <span class="token operator">-=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>key_down <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		state <span class="token operator">^=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>
		
		<span class="token keyword">if</span><span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token number">0x00</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span>GPIO_PIN_7<span class="token punctuation">,</span>GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span>
			led2 <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">HAL_TIM_PWM_Start</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>htim17<span class="token punctuation">,</span>TIM_CHANNEL_1<span class="token punctuation">)</span><span class="token punctuation">;</span>
			led2 <span class="token operator">=</span> <span class="token number">0x02</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>				
	<span class="token punctuation">}</span>
	<span class="token function">LED_Disp</span><span class="token punctuation">(</span>led1<span class="token operator">|</span>led2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//LCD进程函数</span>
<span class="token keyword">void</span> <span class="token function">LCD_Proc</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>uwTick <span class="token operator">-</span> LCD_uwTick <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
		LCD_uwTick  <span class="token operator">=</span> uwTick<span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>Interface <span class="token operator">==</span> <span class="token number">0x00</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>LCD_DispString<span class="token punctuation">,</span><span class="token string">"       Date"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">LCD_DisplayStringLine</span><span class="token punctuation">(</span>Line1<span class="token punctuation">,</span>LCD_DispString<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>LCD_DispString<span class="token punctuation">,</span><span class="token string">"   CNBR:%.2f"</span><span class="token punctuation">,</span>CNBR<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">LCD_DisplayStringLine</span><span class="token punctuation">(</span>Line3<span class="token punctuation">,</span>LCD_DispString<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>LCD_DispString<span class="token punctuation">,</span><span class="token string">"   VNBR:%.2f"</span><span class="token punctuation">,</span>VNBR<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">LCD_DisplayStringLine</span><span class="token punctuation">(</span>Line5<span class="token punctuation">,</span>LCD_DispString<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>LCD_DispString<span class="token punctuation">,</span><span class="token string">"   IDLE:%d"</span><span class="token punctuation">,</span>IDLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">LCD_DisplayStringLine</span><span class="token punctuation">(</span>Line7<span class="token punctuation">,</span>LCD_DispString<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>LCD_DispString<span class="token punctuation">,</span><span class="token string">"       Para"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">LCD_DisplayStringLine</span><span class="token punctuation">(</span>Line1<span class="token punctuation">,</span>LCD_DispString<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>LCD_DispString<span class="token punctuation">,</span><span class="token string">"   CNBR:%.2f"</span><span class="token punctuation">,</span>CNBR<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">LCD_DisplayStringLine</span><span class="token punctuation">(</span>Line3<span class="token punctuation">,</span>LCD_DispString<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>LCD_DispString<span class="token punctuation">,</span><span class="token string">"   VNBR:%.2f"</span><span class="token punctuation">,</span>VNBR<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">LCD_DisplayStringLine</span><span class="token punctuation">(</span>Line5<span class="token punctuation">,</span>LCD_DispString<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span> d_str<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span><span class="token operator">*</span> s_str<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> locate<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> length<span class="token punctuation">)</span><span class="token comment">//从长字符串里边提取出一段给短字符串</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">uint8_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		d_str<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> s_str<span class="token punctuation">[</span>locate <span class="token operator">+</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	d_str<span class="token punctuation">[</span>length<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//</span>
<span class="token keyword">void</span> <span class="token function">UART_Proc</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>uwTick <span class="token operator">-</span> Uart_uwTick <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
		Uart_uwTick  <span class="token operator">=</span> uwTick<span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//数据错误</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>str<span class="token punctuation">,</span><span class="token string">"Error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_UART_Transmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span><span class="token punctuation">)</span>str<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		flag <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token comment">//重置标志</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//数据正确</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//处理数据，将正在入库的车信息存入中转数据库</span>
		<span class="token function">substr</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>type<span class="token punctuation">,</span>rx_buf<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">substr</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>num<span class="token punctuation">,</span>rx_buf<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">substr</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>year<span class="token punctuation">,</span>rx_buf<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">substr</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>month<span class="token punctuation">,</span>rx_buf<span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">substr</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>day<span class="token punctuation">,</span>rx_buf<span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">substr</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>hour<span class="token punctuation">,</span>rx_buf<span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">substr</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>minute<span class="token punctuation">,</span>rx_buf<span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">substr</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>second<span class="token punctuation">,</span>rx_buf<span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isexist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment">//出去的车</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//计算车费</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>minute<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>in_car<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>minute<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>minute<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span>in_car<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>minute<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token operator">||</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>second<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>in_car<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>second<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span>in_car<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span>
				hour<span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span>
			hour <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>day<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>in_car<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>day<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>day<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span>in_car<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>day<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">+</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>hour<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>in_car<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>hour<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>hour<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span>in_car<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>hour<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>type<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'C'</span><span class="token punctuation">)</span>
					money <span class="token operator">=</span> hour<span class="token operator">*</span>CNBR<span class="token punctuation">;</span>
			<span class="token keyword">else</span> money <span class="token operator">=</span> hour<span class="token operator">*</span>VNBR<span class="token punctuation">;</span>
			
			<span class="token comment">//发送车费信息</span>
			<span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>str<span class="token punctuation">,</span><span class="token string">"%s:%s:%d:%.2f"</span><span class="token punctuation">,</span>ing_car<span class="token punctuation">.</span>type<span class="token punctuation">,</span>ing_car<span class="token punctuation">.</span>num<span class="token punctuation">,</span>hour<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">HAL_UART_Transmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">,</span>str<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			<span class="token comment">//将对应出去的车的车位置零</span>
			<span class="token keyword">for</span><span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>x<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span>x<span class="token operator">++</span><span class="token punctuation">)</span>
			in_car<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			IDLE<span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>IDLE<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//进来的车</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">for</span><span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>x<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>x<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>in_car<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//证明这个车位是空的</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">substr</span><span class="token punctuation">(</span>in_car<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token punctuation">,</span>rx_buf<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">substr</span><span class="token punctuation">(</span>in_car<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>num<span class="token punctuation">,</span>rx_buf<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">substr</span><span class="token punctuation">(</span>in_car<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>year<span class="token punctuation">,</span>rx_buf<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">substr</span><span class="token punctuation">(</span>in_car<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>month<span class="token punctuation">,</span>rx_buf<span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">substr</span><span class="token punctuation">(</span>in_car<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>day<span class="token punctuation">,</span>rx_buf<span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">substr</span><span class="token punctuation">(</span>in_car<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>hour<span class="token punctuation">,</span>rx_buf<span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">substr</span><span class="token punctuation">(</span>in_car<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>minute<span class="token punctuation">,</span>rx_buf<span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">substr</span><span class="token punctuation">(</span>in_car<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">,</span>rx_buf<span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			
			IDLE<span class="token operator">-=</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		flag <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token comment">//重置标志</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name">uint16_t</span> <span class="token function">_exist</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token comment">//判断是否在车库里</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ing_car<span class="token punctuation">.</span>type<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>in_car<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			<span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>ing_car<span class="token punctuation">.</span>num<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>in_car<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	
			<span class="token keyword">return</span> j<span class="token punctuation">;</span><span class="token comment">//将要出去的车</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">8</span><span class="token punctuation">;</span><span class="token comment">//将要进来的车</span>
<span class="token punctuation">}</span>

<span class="token comment">//按键扫描函数</span>
<span class="token class-name">uint8_t</span> <span class="token function">KEY_Scan</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">uint8_t</span> value<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">HAL_GPIO_ReadPin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_0<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
		value <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">HAL_GPIO_ReadPin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_1<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
		value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">HAL_GPIO_ReadPin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_2<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
		value <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">HAL_GPIO_ReadPin</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span>GPIO_PIN_0<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
		value <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
	
	<span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">HAL_UART_RxCpltCallback</span><span class="token punctuation">(</span>UART_HandleTypeDef <span class="token operator">*</span>huart<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	rx_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> rx_buffer<span class="token punctuation">;</span>
	i<span class="token operator">++</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token comment">//一组数据接受完了</span>
	<span class="token punctuation">{<!-- --></span>
		flag <span class="token operator">=</span> <span class="token function">PD_car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//判断数据是否符合规矩</span>
		i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//重置数据</span>
	<span class="token punctuation">}</span>

	<span class="token function">HAL_UART_Receive_IT</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">,</span><span class="token operator">&amp;</span>rx_buffer<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开启串口中断</span>
<span class="token punctuation">}</span>

<span class="token comment">//VNBR:A325:200202120000</span>
<span class="token keyword">_Bool</span> <span class="token function">PD_car</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'C'</span><span class="token operator">||</span>rx_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'V'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'N'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'R'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token string">'9'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token string">'9'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token string">'9'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token string">'9'</span><span class="token punctuation">)</span>
			<span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token string">'9'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token string">'9'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token string">'9'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token string">'9'</span><span class="token punctuation">)</span>
		<span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token string">'9'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token string">'9'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token string">'9'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token string">'9'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			year <span class="token operator">=</span> <span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			day <span class="token operator">=</span> <span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			month <span class="token operator">=</span> <span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			hour <span class="token operator">=</span> <span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			minute <span class="token operator">=</span> <span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			seconds <span class="token operator">=</span> <span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span><span class="token punctuation">(</span>rx_buf<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>day<span class="token operator">&gt;</span><span class="token number">31</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">(</span>month<span class="token operator">&gt;</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">(</span>hour<span class="token operator">&gt;</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">(</span>minute<span class="token operator">&gt;</span><span class="token number">59</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">(</span>seconds<span class="token operator">&gt;</span><span class="token number">59</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">LED_Disp</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> ucled<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//先关闭所有的灯</span>
	<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOC<span class="token punctuation">,</span>GPIO_PIN_8<span class="token operator">|</span>GPIO_PIN_9<span class="token operator">|</span>GPIO_PIN_10<span class="token operator">|</span>GPIO_PIN_11<span class="token operator">|</span>
	GPIO_PIN_12<span class="token operator">|</span>GPIO_PIN_13<span class="token operator">|</span>GPIO_PIN_14<span class="token operator">|</span>GPIO_PIN_15<span class="token punctuation">,</span>GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOD<span class="token punctuation">,</span>GPIO_PIN_2<span class="token punctuation">,</span>GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOD<span class="token punctuation">,</span>GPIO_PIN_2<span class="token punctuation">,</span>GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//点灯</span>
	<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOC<span class="token punctuation">,</span>ucled<span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">,</span>GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOD<span class="token punctuation">,</span>GPIO_PIN_2<span class="token punctuation">,</span>GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOD<span class="token punctuation">,</span>GPIO_PIN_2<span class="token punctuation">,</span>GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="_381">
     </a>
     六：遇到的问题
    </h2>
    <p>
     1.解题逻辑不够清晰！
     <br/>
     2.串口理解不够深刻！
     <br/>
     这里串口的配置老是忘记对端口进行选择，以至于每次配置完都是PC8,PC9，而参看产品手册可以知道实际上是PA9,PA10
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/947ba99a843b08433ef145be3566b8fc.png">
      <br/>
      3.代码的冗长，不够精简！
      <br/>
      对于串口接受这一段代码，完全可以接受22个字符再进入中断，不用一个个字符接受！而且在中断回调函数中，最好不要写太多的东西！
     </img>
    </p>
    <h2>
     <a id="_388">
     </a>
     七、总结
    </h2>
    <p>
     1.在拿到题目的第一时间，应该先对整体有个大概的把握，对细节有足够的关注！这样不至于在编写过程中出现逻辑混乱的问题！
    </p>
    <p>
     2.逻辑问题漏洞十足！这次因为一个isexist函数的返回值界定没注意，让我再次找了一个下午的bug，不断地调试，找问题！这也可能和我编程习惯有关系！主要逻辑部分喜欢全部写完再去调试，而不是一步一步调试！下次争取改正！
    </p>
    <p>
     3.对于串口部分，这次是吃了大亏的，这个串口助手本身就不够稳定！在调试过程中，USB线有一丢丢移动，都有可能会是的串口无法接发，这个问题曾经困扰我一个下午，一度怀疑自己串口代码写错了，但是经过检查，实在是没有问题，在休息过后重新插上发现又能用，实在难搞！
    </p>
    <p>
     整体来说，这一届的题目难度不算特别大，最主要的是对于串口收发数据的处理部分以及一些细节的初始状态！对于性能的要求，主频不要给太低就行，还有就是按键部分的响应时间，在减速函数部分给低点就行！
    </p>
    <p>
     <strong>
      以上纯属个人理解，第一次写博客，希望能够各位看官提出意见，相互交流学习！之后本人也会逐渐通过学习提高写博客的能力！冲！
     </strong>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f35313430363834362f:61727469636c652f64657461696c732f313233383333393830" class_="artid" style="display:none">
 </p>
</div>


