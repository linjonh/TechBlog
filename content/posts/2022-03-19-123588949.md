---
arturl_encode: "687474:70733a2f2f626c6f672e6373646e2e6e65742f46465f6c7a2f:61727469636c652f64657461696c732f313233353838393439"
layout: post
title: "WebRTC-å®ç°P2PéŸ³è§†é¢‘é€šè¯æ­å»ºstunturn-P2Pç©¿é€å’Œè½¬å‘æœåŠ¡å™¨"
date: 2022-03-19 13:41:34 +08:00
description: "WebRTC å®ç°P2PéŸ³è§†é¢‘é€šè¯â€”â€”æ­å»ºstun/trun P2Pç©¿é€å’Œè½¬å‘æœåŠ¡å™¨"
keywords: "WebRTC å®ç°P2PéŸ³è§†é¢‘é€šè¯â€”â€”æ­å»ºstun/turn P2Pç©¿é€å’Œè½¬å‘æœåŠ¡å™¨"
categories: ['æœªåˆ†ç±»']
tags: ['éŸ³è§†é¢‘', 'æœåŠ¡å™¨', 'Webrtc', 'P']
artid: "123588949"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=123588949
  alt: "WebRTC-å®ç°P2PéŸ³è§†é¢‘é€šè¯æ­å»ºstunturn-P2Pç©¿é€å’Œè½¬å‘æœåŠ¡å™¨"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=123588949
featuredImagePreview: https://bing.ee123.net/img/rand?artid=123588949
---

# WebRTC å®ç°P2PéŸ³è§†é¢‘é€šè¯â€”â€”æ­å»ºstun/turn P2Pç©¿é€å’Œè½¬å‘æœåŠ¡å™¨

## WebRTC å®ç°P2PéŸ³è§†é¢‘é€šè¯

### [WebRTC å®ç°P2PéŸ³è§†é¢‘é€šè¯â€”â€”æ­å»ºä¿¡ä»¤æœåŠ¡å™¨](https://blog.csdn.net/FF_lz/article/details/123531220)

### WebRTC å®ç°P2PéŸ³è§†é¢‘é€šè¯â€”â€”æ­å»ºstun/turn P2Pç©¿é€å’Œè½¬å‘æœåŠ¡å™¨

---

#### æ–‡ç« ç›®å½•

* [WebRTC å®ç°P2PéŸ³è§†é¢‘é€šè¯](#WebRTC_P2P_0)
* + [[WebRTC å®ç°P2PéŸ³è§†é¢‘é€šè¯â€”â€”æ­å»ºä¿¡ä»¤æœåŠ¡å™¨](https://blog.csdn.net/FF_lz/article/details/123531220)](#WebRTC_P2PhttpsblogcsdnnetFF_lzarticledetails123531220_1)
  + [WebRTC å®ç°P2PéŸ³è§†é¢‘é€šè¯â€”â€”æ­å»ºstun/turn P2Pç©¿é€å’Œè½¬å‘æœåŠ¡å™¨](#WebRTC_P2Pstunturn__P2P_2)
* [å‰è¨€](#_10)
* [ç¯å¢ƒï¼š](#_15)
* [ä¸€ã€å®‰è£…Coturn](#Coturn_18)
* [äºŒã€é…ç½®ç¯å¢ƒå˜é‡åŠCoturn](#Coturn_58)
* + - [1.é…ç½®ç¯å¢ƒå˜é‡](#1_59)
    - [2.é…ç½®Coturn](#2Coturn_73)
* [æ•ˆæœ](#_113)

---

## å‰è¨€

WebRTC å®ç°P2PéŸ³è§†é¢‘é€šè¯ç³»åˆ—è®°å½•äº†ä»é›¶->æ­å»ºä¿¡ä»¤æœåŠ¡å™¨->æ­å»ºstun/turn P2Pç©¿é€å’Œè½¬å‘æœåŠ¡å™¨->WebRTC P2PéŸ³è§†é¢‘é€šè¯ã€‚
  
WebRTC å®ç°P2PéŸ³è§†é¢‘é€šè¯â€”â€”æ­å»ºstun/turn P2Pç©¿é€å’Œè½¬å‘æœåŠ¡ æœ¬æ–‡å°†åœ¨å…¬ç½‘æœåŠ¡å™¨ä¸»æœºä¸Šä½¿ç”¨coturnæ­å»ºä¸€ä¸ªç©¿é€å’Œè½¬å‘æœåŠ¡å™¨ã€‚
  
Coturné›†æˆäº†stun+turnåè®®,å®ç°NATæ£€æµ‹ï¼Œç©¿é€å°±éœ€è¦é€šè¿‡stunåè®®ï¼Œ NATæ£€æµ‹æ— æ³•è¿›è¡Œç©¿è¶Šæ—¶å°±éœ€è¦é€šè¿‡turnæœåŠ¡è¿›è¡Œæµåª’ä½“çš„è½¬å‘äº†ï¼Œè€Œcoturnå°±æ˜¯å°†ä¸¤è€…åè®®è¿›è¡Œæ•´åˆå¹¶è¿›è¡Œæ‹©ä¼˜ä¼˜åŒ–ï¼Œ åœ¨WebRTCç«¯åˆ°ç«¯éŸ³è§†é¢‘ä¼ è¾“ stun/turn ç©¿é€å’Œè½¬å‘æ˜¯å¿…ä¸å¯å°‘çš„ (é™¤éè‡ªå·±å®ç°ä¸€ä¸ªæµåª’ä½“æœåŠ¡å™¨)ã€‚

## ç¯å¢ƒï¼š

1.å…¬ç½‘æœåŠ¡å™¨ä¸»æœºæˆ–å†…ç½‘ä¸»æœº(å†…ç½‘éªŒè¯ï¼Œéœ€è¦åœ¨åŒä¸€å†…ç½‘)ï¼Œåªæ˜¯ä¸´æ—¶åšéªŒè¯å¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘å®éªŒå®¤ï¼Œä¸¤å°æ—¶å…è´¹
[é˜¿é‡Œäº‘å®éªŒå®¤](https://developer.aliyun.com/adc/scenario/bd3fac7dfaaf4be3abbc1bb980907f70?spm=a2c6h.13858375.0.0.629079a9BqQXVI)
  
2.Ubuntu Ubuntu Server 20.04 LTS 64bit

## ä¸€ã€å®‰è£…Coturn

é€šè¿‡SSHè¿›å…¥æœåŠ¡å™¨ä¸»æœº

```powershell
ssh ç”¨æˆ·å@IPåœ°å€ ä¾‹å¦‚ï¼šssh root@192.168.1.1

```

æ‹‰å–coturnæºç  å¹¶è¿›å…¥

```powershell
git clone https://github.com/coturn/coturn 

```

æç¤º -bash: /usr/bin/git: No such file or directory æ—¶å°±éœ€è¦å®‰è£…ä¸€ä¸‹gitäº†

```powershell
apt install git

```

è¿›å…¥coturn ç›®å½•ä¸‹ï¼Œé…ç½®coturnå¹¶æŒ‡å®šâ€“prefixå®‰è£…è·¯å¾„

```powershell
cd coturn
./configure --prefix=/usr/local/coturn 

```

é…ç½®è¿‡ç¨‹ä¸­ç¢°åˆ°çš„é—®é¢˜

> ERROR: pkg-config not found
>   
> ![ç¤ºä¾‹ï¼špandas æ˜¯åŸºäºNumPy çš„ä¸€ç§å·¥å…·ï¼Œè¯¥å·¥å…·æ˜¯ä¸ºäº†è§£å†³æ•°æ®åˆ†æä»»åŠ¡è€Œåˆ›å»ºçš„ã€‚](https://i-blog.csdnimg.cn/blog_migrate/937800fb8af66873a8843ddc71b98493.png)
>   
> apt install pkg-config

> ERROR: OpenSSL Crypto development libraries are not installed properly in required location.
> ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/8ee31dfc844f1a7f6fdf840a570961ec.png)
>   
> apt install libssl-dev

> ERROR: Libevent2 development libraries are not installed properly in required location.
>   
> ERROR: may be you have just too old libevent tool - then you have to upgrade it.
> ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/d871f11b689cbdcabcb8f38118c03ec2.png)
>   
> apt install libevent-dev

å®‰è£…å¥½ç›¸å…³ä¾èµ–åº“ï¼Œåœ¨é‡æ–°./configure
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/a22db82dc0b72f9ccc9fb0b3e214bfaf.png)
  
é…ç½®æˆåŠŸåå°±å¯ä»¥ç¼–è¯‘ï¼Œå®‰è£…äº†

```powershell
make & make install

```

## äºŒã€é…ç½®ç¯å¢ƒå˜é‡åŠCoturn

#### 1.é…ç½®ç¯å¢ƒå˜é‡

ä¿®æ”¹bashrcé…ç½®æ–‡ä»¶

```powershell
vi ~/.bashrc 

```

æœ€æ–‡ä»¶æœ€åæ·»åŠ coturnçš„å®‰è£…è·¯å¾„

```powershell
export PATH=/usr/local/coturn/bin:$PATH:

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/71fcaa9b4ec5fee5789439dee5623146.png)
  
é‡æ–°åº”ç”¨bashrcé…ç½®æ–‡ä»¶

```powershell
source ~/.bashrc 

```

#### 2.é…ç½®Coturn

å…ˆåˆ›å»ºç”¨æˆ·ï¼Œå¯†ç å¹¶æŒ‡å®šåŸŸå

```powershell
turnadmin -a -u ç”¨æˆ·å -p å¯†ç  -r åŸŸåï¼ˆç»™è‡ªå·±çš„åŸŸåï¼‰
turnadmin -a -u test -p 123456 -r wenpipi

```

è¿›å…¥åˆ°/usr/local/coturn/etcç›®å½•ï¼Œæ‹·è´ä¸€ä»½turnserver.conf.default

```powershell
cd /usr/local/coturn/etc
cp turnserver.conf.default turnserver.conf

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/a2187ec72ced3f34cb7a7a24aca46a38.png)
  
ä¿®æ”¹æ‹·è´å‡ºæ¥çš„é…ç½®æ–‡ä»¶turnserver.conf

```powershell
vi turnserver.conf

```

ä¿®æ”¹ä¸‹é¢ğŸ‘‡å¯¹åº”çš„å€¼

```powershell
#ç›‘å¬ç«¯å£
#å…¬ç½‘ip
#ç”¨æˆ·å:å¯†ç 
#åŸŸåã€‚éœ€è¦è·Ÿåˆ›å»ºç”¨æˆ·ï¼Œå¯åŠ¨æ—¶çš„ç›¸åŒ
listening-port=3478 
external-ip=139.196.187.17 
user=test:123456
realm=wenpipi 

```

ä»¥ä¸Šé…ç½®å®Œæˆï¼Œå°±å¯ä»¥å¯åŠ¨turnserveräº†

```powershell
turnserver -o -a -f -v -r wenpipi

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/625428a5f71a2b7d447fcc00bda11c41.png)
  
æŸ¥çœ‹æ´»è·ƒç«¯å£ï¼Œå°±èƒ½çœ‹åˆ°å¯åŠ¨çš„turnserveræœåŠ¡äº†

```powershell
netstat -ntpl

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/d53738342c2f4b1f52cb5ea993687f69.png)

## æ•ˆæœ

é€šè¿‡webrtcæä¾›çš„æ£€æµ‹ç½‘ç«™è¿›è¡Œæ£€æµ‹:
[æ£€æµ‹åœ°å€https://webrtc.github.io/samples/src/content/peerconnection/trickle-ice/](https://webrtc.github.io/samples/src/content/peerconnection/trickle-ice/)
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/ca95de715d80c84bd2dce3ffbbea5025.png)

ä»¥ä¸Šæ­å»ºå¥½stun/turn P2Pç©¿é€å’Œè½¬å‘æœåŠ¡å™¨ï¼Œä¸‹ä¸€æ­¥å°±å¯ä»¥å®ç°WebRTCéŸ³è§†é¢‘é‡‡é›†ï¼Œåª’ä½“åå•†å¹¶ä¼ è¾“å•¦ã€‚