---
layout: post
title: "ESP32的IDF开发学习-驱动ov2640并显示在屏幕上"
date: 2025-03-14 16:22:33 +0800
description: "买的板子还送了一个0v2640的摄像头，今天尝试驱动这个摄像头，之前已经实现了屏幕的驱动了，现在实现一下驱动摄像头显示在屏幕上总的来说，驱动摄像头还是很简单的，下一节我将尝试将摄像头的画面通过TCP传输到电脑。"
keywords: "ESP32的IDF开发学习-驱动ov2640并显示在屏幕上"
categories: ['未分类']
tags: ['学习']
artid: "146260495"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146260495
    alt: "ESP32的IDF开发学习-驱动ov2640并显示在屏幕上"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146260495
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146260495
cover: https://bing.ee123.net/img/rand?artid=146260495
image: https://bing.ee123.net/img/rand?artid=146260495
img: https://bing.ee123.net/img/rand?artid=146260495
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ESP32的IDF开发学习-驱动ov2640并显示在屏幕上
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     关键词：ov2640 ESP32S3 LVGL esp32-camera
    </p>
    <hr/>
    <h3>
     <a id="_4">
     </a>
     前言
    </h3>
    <p>
     买的板子还送了一个0v2640的摄像头，今天尝试驱动这个摄像头，之前已经实现了屏幕的驱动了，现在实现一下驱动摄像头显示在屏幕上
    </p>
    <h3>
     <a id="_6">
     </a>
     下载组件
    </h3>
    <p>
     打开组件注册表，搜索camera组件，点击下载后编译
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/eff3f4615d2cca6c033a4368dd8b7863.png"/>
    </p>
    <h3>
     <a id="_10">
     </a>
     学习示例
    </h3>
    <pre><code class="prism language-c"><span class="token comment">/**
 * This example takes a picture every 5s and print its size on serial monitor.
 */</span>

<span class="token comment">// =============================== SETUP ======================================</span>

<span class="token comment">// 1. Board setup (Uncomment):</span>
<span class="token comment">// #define BOARD_WROVER_KIT</span>
<span class="token comment">// #define BOARD_ESP32CAM_AITHINKER</span>
<span class="token comment">// #define BOARD_ESP32S3_WROOM</span>

<span class="token comment">/**
 * 2. Kconfig setup
 *
 * If you have a Kconfig file, copy the content from
 *  https://github.com/espressif/esp32-camera/blob/master/Kconfig into it.
 * In case you haven't, copy and paste this Kconfig file inside the src directory.
 * This Kconfig file has definitions that allows more control over the camera and
 * how it will be initialized.
 */</span>

<span class="token comment">/**
 * 3. Enable PSRAM on sdkconfig:
 *
 * CONFIG_ESP32_SPIRAM_SUPPORT=y
 *
 * More info on
 * https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/kconfig.html#config-esp32-spiram-support
 */</span>

<span class="token comment">// ================================ CODE ======================================</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;esp_log.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;esp_system.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;nvs_flash.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/param.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"freertos/FreeRTOS.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"freertos/task.h"</span></span>

<span class="token comment">// support IDF 5.x</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">portTICK_RATE_MS</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">portTICK_RATE_MS</span> <span class="token expression">portTICK_PERIOD_MS</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"esp_camera.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BOARD_WROVER_KIT</span> <span class="token expression"><span class="token number">1</span></span></span>

<span class="token comment">// WROVER-KIT PIN Map</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">BOARD_WROVER_KIT</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_PWDN</span> <span class="token expression"><span class="token operator">-</span><span class="token number">1</span>  </span><span class="token comment">//power down is not used</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_RESET</span> <span class="token expression"><span class="token operator">-</span><span class="token number">1</span> </span><span class="token comment">//software reset will be performed</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_XCLK</span> <span class="token expression"><span class="token number">21</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_SIOD</span> <span class="token expression"><span class="token number">26</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_SIOC</span> <span class="token expression"><span class="token number">27</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D7</span> <span class="token expression"><span class="token number">35</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D6</span> <span class="token expression"><span class="token number">34</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D5</span> <span class="token expression"><span class="token number">39</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D4</span> <span class="token expression"><span class="token number">36</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D3</span> <span class="token expression"><span class="token number">19</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D2</span> <span class="token expression"><span class="token number">18</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D1</span> <span class="token expression"><span class="token number">5</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D0</span> <span class="token expression"><span class="token number">4</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_VSYNC</span> <span class="token expression"><span class="token number">25</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_HREF</span> <span class="token expression"><span class="token number">23</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_PCLK</span> <span class="token expression"><span class="token number">22</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">// ESP32Cam (AiThinker) PIN Map</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">BOARD_ESP32CAM_AITHINKER</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_PWDN</span> <span class="token expression"><span class="token number">32</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_RESET</span> <span class="token expression"><span class="token operator">-</span><span class="token number">1</span> </span><span class="token comment">//software reset will be performed</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_XCLK</span> <span class="token expression"><span class="token number">0</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_SIOD</span> <span class="token expression"><span class="token number">26</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_SIOC</span> <span class="token expression"><span class="token number">27</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D7</span> <span class="token expression"><span class="token number">35</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D6</span> <span class="token expression"><span class="token number">34</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D5</span> <span class="token expression"><span class="token number">39</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D4</span> <span class="token expression"><span class="token number">36</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D3</span> <span class="token expression"><span class="token number">21</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D2</span> <span class="token expression"><span class="token number">19</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D1</span> <span class="token expression"><span class="token number">18</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D0</span> <span class="token expression"><span class="token number">5</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_VSYNC</span> <span class="token expression"><span class="token number">25</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_HREF</span> <span class="token expression"><span class="token number">23</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_PCLK</span> <span class="token expression"><span class="token number">22</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token comment">// ESP32S3 (WROOM) PIN Map</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">BOARD_ESP32S3_WROOM</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_PWDN</span> <span class="token expression"><span class="token number">38</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_RESET</span> <span class="token expression"><span class="token operator">-</span><span class="token number">1</span>   </span><span class="token comment">//software reset will be performed</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_VSYNC</span> <span class="token expression"><span class="token number">6</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_HREF</span> <span class="token expression"><span class="token number">7</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_PCLK</span> <span class="token expression"><span class="token number">13</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_XCLK</span> <span class="token expression"><span class="token number">15</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_SIOD</span> <span class="token expression"><span class="token number">4</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_SIOC</span> <span class="token expression"><span class="token number">5</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D0</span> <span class="token expression"><span class="token number">11</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D1</span> <span class="token expression"><span class="token number">9</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D2</span> <span class="token expression"><span class="token number">8</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D3</span> <span class="token expression"><span class="token number">10</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D4</span> <span class="token expression"><span class="token number">12</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D5</span> <span class="token expression"><span class="token number">18</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D6</span> <span class="token expression"><span class="token number">17</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAM_PIN_D7</span> <span class="token expression"><span class="token number">16</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>TAG <span class="token operator">=</span> <span class="token string">"example:take_picture"</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">ESP_CAMERA_SUPPORTED</span></span>
<span class="token keyword">static</span> <span class="token class-name">camera_config_t</span> camera_config <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">.</span>pin_pwdn <span class="token operator">=</span> CAM_PIN_PWDN<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>pin_reset <span class="token operator">=</span> CAM_PIN_RESET<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>pin_xclk <span class="token operator">=</span> CAM_PIN_XCLK<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>pin_sccb_sda <span class="token operator">=</span> CAM_PIN_SIOD<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>pin_sccb_scl <span class="token operator">=</span> CAM_PIN_SIOC<span class="token punctuation">,</span>

    <span class="token punctuation">.</span>pin_d7 <span class="token operator">=</span> CAM_PIN_D7<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>pin_d6 <span class="token operator">=</span> CAM_PIN_D6<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>pin_d5 <span class="token operator">=</span> CAM_PIN_D5<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>pin_d4 <span class="token operator">=</span> CAM_PIN_D4<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>pin_d3 <span class="token operator">=</span> CAM_PIN_D3<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>pin_d2 <span class="token operator">=</span> CAM_PIN_D2<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>pin_d1 <span class="token operator">=</span> CAM_PIN_D1<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>pin_d0 <span class="token operator">=</span> CAM_PIN_D0<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>pin_vsync <span class="token operator">=</span> CAM_PIN_VSYNC<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>pin_href <span class="token operator">=</span> CAM_PIN_HREF<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>pin_pclk <span class="token operator">=</span> CAM_PIN_PCLK<span class="token punctuation">,</span>

    <span class="token comment">//XCLK 20MHz or 10MHz for OV2640 double FPS (Experimental)</span>
    <span class="token punctuation">.</span>xclk_freq_hz <span class="token operator">=</span> <span class="token number">20000000</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span>ledc_timer <span class="token operator">=</span> LEDC_TIMER_0<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>ledc_channel <span class="token operator">=</span> LEDC_CHANNEL_0<span class="token punctuation">,</span>

    <span class="token punctuation">.</span>pixel_format <span class="token operator">=</span> PIXFORMAT_RGB565<span class="token punctuation">,</span> <span class="token comment">//YUV422,GRAYSCALE,RGB565,JPEG</span>
    <span class="token punctuation">.</span>frame_size <span class="token operator">=</span> FRAMESIZE_QVGA<span class="token punctuation">,</span>    <span class="token comment">//QQVGA-UXGA, For ESP32, do not use sizes above QVGA when not JPEG. The performance of the ESP32-S series has improved a lot, but JPEG mode always gives better frame rates.</span>

    <span class="token punctuation">.</span>jpeg_quality <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token comment">//0-63, for OV series camera sensors, lower number means higher quality</span>
    <span class="token punctuation">.</span>fb_count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>       <span class="token comment">//When jpeg mode is used, if fb_count more than one, the driver will work in continuous mode.</span>
    <span class="token punctuation">.</span>fb_location <span class="token operator">=</span> CAMERA_FB_IN_PSRAM<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>grab_mode <span class="token operator">=</span> CAMERA_GRAB_WHEN_EMPTY<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token class-name">esp_err_t</span> <span class="token function">init_camera</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//initialize the camera</span>
    <span class="token class-name">esp_err_t</span> err <span class="token operator">=</span> <span class="token function">esp_camera_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>camera_config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!=</span> ESP_OK<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">ESP_LOGE</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Camera Init Failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> err<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> ESP_OK<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token keyword">void</span> <span class="token function">app_main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">ESP_CAMERA_SUPPORTED</span></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ESP_OK <span class="token operator">!=</span> <span class="token function">init_camera</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">ESP_LOGI</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Taking picture..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">camera_fb_t</span> <span class="token operator">*</span>pic <span class="token operator">=</span> <span class="token function">esp_camera_fb_get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// use pic-&gt;buf to access the image</span>
        <span class="token function">ESP_LOGI</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Picture taken! Its size was: %zu bytes"</span><span class="token punctuation">,</span> pic<span class="token operator">-&gt;</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">esp_camera_fb_return</span><span class="token punctuation">(</span>pic<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">vTaskDelay</span><span class="token punctuation">(</span><span class="token number">5000</span> <span class="token operator">/</span> portTICK_RATE_MS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
    <span class="token function">ESP_LOGE</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Camera support is not available for this chip"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     挺短的，短短188行代码，首先配置不同的开发版，根据开发板配置不同的引脚，同时需要打开PSRAM的支持，提高相机的性能
     <br/>
     初始化阶段需要配置相机的参数，初始化后进入循环，每5秒钟获取一次图片的参数，并将图片大小打印出来，其后释放图片
     <br/>
     下面是一下相关参数的配置
    </p>
    <blockquote>
     <p>
      <strong>
       <code>
        .xclk_freq_hz
       </code>
      </strong>
      这个参数是设置摄像头的时钟频率，默认20MHz，提高频率可以提高帧率
      <br/>
      <strong>
       <code>
        .pixel_format
       </code>
      </strong>
      配置输出的图像格式
      <br/>
      <code>
       PIXFORMAT_JPEG
      </code>
      : 压缩的 JPEG 格式（体积小，适合存储/传输）。
      <br/>
      <code>
       PIXFORMAT_RGB565
      </code>
      : 未压缩的 16 位颜色格式（适合实时处理，如显示屏输出）。
      <code>
       PIXFORMAT_YUV422
      </code>
      : YUV 颜色空间格式（某些图像处理算法需要）。
      <br/>
      <strong>
       <code>
        .frame_size
       </code>
      </strong>
      这个是配置输出的分辨率大小
      <br/>
      <code>
       FRAMESIZE_QQVGA
      </code>
      (160x120)
      <br/>
      <code>
       FRAMESIZE_QVGA
      </code>
      (320x240)
      <br/>
      <code>
       FRAMESIZE_SVGA
      </code>
      (800x600)
      <br/>
      <code>
       FRAMESIZE_UXGA
      </code>
      (1600x1200)
      <br/>
      <strong>
       <code>
        .jpeg_quality
       </code>
      </strong>
      这个参数是配置压缩质量，0为最高，63是最低
      <br/>
      <strong>
       <code>
        .fb_count
       </code>
      </strong>
      帧缓冲函数
      <br/>
      <strong>
       <code>
        fb_count = 1
       </code>
      </strong>
      : 单缓冲区模式（捕获一帧后必须手动释放）。
      <br/>
      <strong>
       <code>
        fb_count &gt; 1
       </code>
      </strong>
      : 双缓冲或多缓冲模式（驱动程序自动处理连续捕获）
      <br/>
      <strong>
       <code>
        .fb_location
       </code>
      </strong>
      帧缓冲区内存分配位置
      <br/>
      <code>
       CAMERA_FB_IN_PSRAM
      </code>
      : 优先使用 PSRAM（需硬件支持，适用于大分辨率）。
      <br/>
      <code>
       CAMERA_FB_IN_DRAM
      </code>
      : 使用片上 RAM（仅适用于小分辨率）。
      <br/>
      <strong>
       <code>
        .grab_mode
       </code>
      </strong>
      图像捕获触发模式
      <br/>
      <code>
       CAMERA_GRAB_WHEN_EMPTY
      </code>
      : 当帧缓冲区空闲时自动捕获新帧（稳定，避免数据冲突）。
      <code>
       CAMERA_GRAB_LATEST
      </code>
      : 始终保留最新一帧（适合实时性要求高的场景，但可能丢帧）
     </p>
    </blockquote>
    <p>
     由于我用的是ESP32-RAM，查看原理图
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/d95bd71c5b523d025b246636dcfcb59b.png">
      <br/>
      修改板子引脚，编译程序，下载
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/img_convert/f069766c19aa729e77f8e77a7283e9d3.png">
       <br/>
       能够顺利运行。
      </img>
     </img>
    </p>
    <h3>
     <a id="lvgl_229">
     </a>
     在lvgl上显示图片
    </h3>
    <p>
     我们都知道，在lvgl上显示的图片，都是将图片转化为c数组，而数组有一个描述符号
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/addf1f4909c37e0156ea3605c68bfa48.png">
      <br/>
      我们在显示图像的时候，也需要给图片创建一个描述符，让LVGL能够识别
     </img>
    </p>
    <pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">displayPicture</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">camera_fb_t</span> <span class="token operator">*</span>pic <span class="token operator">=</span> <span class="token function">esp_camera_fb_get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pic <span class="token operator">||</span> pic<span class="token operator">-&gt;</span>format <span class="token operator">!=</span> PIXFORMAT_RGB565<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pic<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">esp_camera_fb_return</span><span class="token punctuation">(</span>pic<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 动态创建LVGL图像描述符</span>
    img_dsc<span class="token punctuation">.</span>header<span class="token punctuation">.</span>always_zero <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    img_dsc<span class="token punctuation">.</span>header<span class="token punctuation">.</span>w <span class="token operator">=</span> <span class="token number">320</span><span class="token punctuation">;</span>          <span class="token comment">// 使用实际宽度</span>
    img_dsc<span class="token punctuation">.</span>header<span class="token punctuation">.</span>h <span class="token operator">=</span> <span class="token number">240</span><span class="token punctuation">;</span>         <span class="token comment">// 使用实际高度</span>
    img_dsc<span class="token punctuation">.</span>header<span class="token punctuation">.</span>cf <span class="token operator">=</span> LV_IMG_CF_TRUE_COLOR<span class="token punctuation">;</span> <span class="token comment">// 颜色格式为RGB565</span>
    img_dsc<span class="token punctuation">.</span>data <span class="token operator">=</span> pic<span class="token operator">-&gt;</span>buf<span class="token punctuation">;</span>
    img_dsc<span class="token punctuation">.</span>data_size <span class="token operator">=</span> <span class="token number">76800</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 数据大小,注意这里不能写错了</span>
    <span class="token function">ESP_LOGI</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Picture taken! Its size was: %zu bytes"</span><span class="token punctuation">,</span> pic<span class="token operator">-&gt;</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>img <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        img <span class="token operator">=</span> <span class="token function">lv_img_create</span><span class="token punctuation">(</span>scr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">lv_img_set_src</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token operator">&amp;</span>img_dsc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">lv_obj_set_height</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">lv_obj_set_width</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// 释放帧缓冲区</span>
    <span class="token function">esp_camera_fb_return</span><span class="token punctuation">(</span>pic<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     编译，然后下载
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/87f468379d9b5bd445bb2949a971a750.jpeg">
      <br/>
      就是这个画质很尴尬，不过240*240还要什么自行车
     </img>
    </p>
    <blockquote>
     <p>
      这里有个问题，在调用这个函数的时候，其实按理应该不能立刻释放这个指针，会造成lvgl崩坏的，原因是lvgl还在使用就不能释放，所以这里需要大家谨慎处理，根据项目需求实现目标
     </p>
    </blockquote>
    <h3>
     <a id="LVGL_267">
     </a>
     在LVGL上显示视频
    </h3>
    <p>
     既然显示图片可行，那显示视频应该也是可以的，因为视频就是一张张图片在以一定的间隔播放，所以下面修改函数实现
     <br/>
     首先我们把单缓冲区改为双缓冲区，剩下的函数不需要修改，只需要加while循环在freertos中调用即可
    </p>
    <pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">displayVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">camera_fb_t</span> <span class="token operator">*</span>pic <span class="token operator">=</span> <span class="token function">esp_camera_fb_get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pic <span class="token operator">||</span> pic<span class="token operator">-&gt;</span>format <span class="token operator">!=</span> PIXFORMAT_RGB565<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pic<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">esp_camera_fb_return</span><span class="token punctuation">(</span>pic<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 动态创建LVGL图像描述符</span>
        img_dsc<span class="token punctuation">.</span>header<span class="token punctuation">.</span>always_zero <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        img_dsc<span class="token punctuation">.</span>header<span class="token punctuation">.</span>w <span class="token operator">=</span> <span class="token number">320</span><span class="token punctuation">;</span>          <span class="token comment">// 使用实际宽度</span>
        img_dsc<span class="token punctuation">.</span>header<span class="token punctuation">.</span>h <span class="token operator">=</span> <span class="token number">240</span><span class="token punctuation">;</span>         <span class="token comment">// 使用实际高度</span>
        img_dsc<span class="token punctuation">.</span>header<span class="token punctuation">.</span>cf <span class="token operator">=</span> LV_IMG_CF_TRUE_COLOR<span class="token punctuation">;</span> <span class="token comment">// 颜色格式为RGB565</span>
        img_dsc<span class="token punctuation">.</span>data <span class="token operator">=</span> pic<span class="token operator">-&gt;</span>buf<span class="token punctuation">;</span>
        img_dsc<span class="token punctuation">.</span>data_size <span class="token operator">=</span> <span class="token number">76800</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 数据大小,注意这里不能写错了</span>
        <span class="token function">ESP_LOGI</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Picture taken! Its size was: %zu bytes"</span><span class="token punctuation">,</span> pic<span class="token operator">-&gt;</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>img <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            img <span class="token operator">=</span> <span class="token function">lv_img_create</span><span class="token punctuation">(</span>scr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">lv_img_set_src</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token operator">&amp;</span>img_dsc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lv_obj_set_height</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lv_obj_set_width</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 释放帧缓冲区</span>
        <span class="token function">vTaskDelay</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">/</span> portTICK_PERIOD_MS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">esp_camera_fb_return</span><span class="token punctuation">(</span>pic<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     编译下载，查看结果
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/40fbfda7b151c85a25f2e641e42ab1cd.gif">
      <br/>
      这个帧率真的难蚌，而且屏幕出现了花屏，这可能和数据不完整有关
     </img>
    </p>
    <h3>
     <a id="_305">
     </a>
     总结
    </h3>
    <p>
     总的来说，驱动摄像头还是很简单的，下一节我将尝试将摄像头的画面通过TCP传输到电脑
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f35333434303437372f:61727469636c652f64657461696c732f313436323630343935" class_="artid" style="display:none">
 </p>
</div>


