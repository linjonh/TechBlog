---
layout: post
title: "01-虚拟系统配置"
date: 2025-03-13 17:38:29 +0800
description: "2、财务部禁止访问Internet，研发部门只有部分员工可以访问Internet，行政部门全部可以访问互联网。1、只存在一个公网IP地址，公司内网所有部门都需要借用同一个接口访问外网。3、为三个部门的虚拟系统分配相同的资源类。pc1ip0.1访问100.1.1.1。c:已经有t_unt的安全策略。将0.1改为0.11。"
keywords: "01-虚拟系统配置"
categories: ['未分类']
tags: ['网络']
artid: "146237765"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146237765
    alt: "01-虚拟系统配置"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146237765
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146237765
cover: https://bing.ee123.net/img/rand?artid=146237765
image: https://bing.ee123.net/img/rand?artid=146237765
img: https://bing.ee123.net/img/rand?artid=146237765
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     01-虚拟系统配置
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     拓扑：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e92252ac581745c4acc36a6b36d63da5.jpeg#pic_center"/>
    </p>
    <p>
     [r1]interface GigabitEthernet 0/0/0
     <br/>
     [r1-GigabitEthernet0/0/0]ip address 12.0.0.2 24
    </p>
    <p>
     [r1]interface LoopBack 0
     <br/>
     [r1-LoopBack0]ip address 100.1.1.1 24
    </p>
    <p>
     fw：
    </p>
    <p>
     [fw]interface GigabitEthernet 0/0/0
     <br/>
     [fw-GigabitEthernet0/0/0]service-manage all permit
    </p>
    <p>
     [fw]interface GigabitEthernet 1/0/0
     <br/>
     [fw-GigabitEthernet1/0/0]ip address 12.0.0.1 24
    </p>
    <p>
     需求一
    </p>
    <p>
     安全策略要求：
    </p>
    <p>
     1、只存在一个公网IP地址，公司内网所有部门都需要借用同一个接口访问外网
    </p>
    <p>
     2、财务部禁止访问Internet，研发部门只有部分员工可以访问Internet，行政部门全部可以访问互联网
    </p>
    <p>
     3、为三个部门的虚拟系统分配相同的资源类
    </p>
    <p>
     启动虚拟系统
    </p>
    <p>
     [FW]vsys enable
    </p>
    <p>
     配置资源类
     <br/>
     1：
     <br/>
     [fw-resource-class-1]resource-item-limit session reserved-number 500 maximum 1000
     <br/>
     [fw-resource-class-1]resource-item-limit bandwidth 2 outbound
     <br/>
     [fw-resource-class-1]resource-item-limit policy reserved-number 200
     <br/>
     [fw-resource-class-1]resource-item-limit user reserved-number 100
     <br/>
     [fw]display resource global-resource
     <br/>
     2：
     <br/>
     同1
     <br/>
     3：
     <br/>
     同1
    </p>
    <p>
     创建虚拟系统
     <br/>
     [fw]vsys name vsysa
     <br/>
     [fw-vsys-vsysa]assign resource-class 1
     <br/>
     [fw-vsys-vsysa]assign interface GigabitEthernet 1/0/1
    </p>
    <p>
     [fw]vsys name vsysb
     <br/>
     [fw-vsys-vsysa]assign resource-class 2
     <br/>
     [fw-vsys-vsysa]assign interface GigabitEthernet 1/0/2
    </p>
    <p>
     [fw]vsys name vsysc
     <br/>
     [fw-vsys-vsysa]assign resource-class 3
     <br/>
     [fw-vsys-vsysa]assign interface GigabitEthernet 1/0/3
    </p>
    <p>
     管理员配置
     <br/>
     vsysa :
     <br/>
     [FW]switch vsys vsysa
     <br/>
     [FW-vsysa]aaa
     <br/>
     [FW-vsysa-aaa]manager-user admin@@vsysa
     <br/>
     [FW-vsysa-aaa-manager-user-admin@@vsysa]password
     <br/>
     Confirm Password:admin@123
     <br/>
     [FW-vsysa-aaa-manager-user-admin@@vsysa]level 15
     <br/>
     [FW-vsysa-aaa-manager-user-admin@@vsysa]service-type web telnet ssh
     <br/>
     [FW-vsysa-aaa-manager-user-admin@@vsysa]quit
     <br/>
     [FW-vsysa-aaa]bind manager-user admin@@vsysa role system-admin
    </p>
    <p>
     vsysb:
     <br/>
     [fw]switch vsys vsysb
     <br/>
     system-view
     <br/>
     [fw-vsysb]aaa
     <br/>
     [fw-vsysb-aaa]manager-user admin@@vsysb
     <br/>
     [fw-vsysb-aaa-manager-user-admin@@vsysb]password
     <br/>
     Enter Password:admin@123
     <br/>
     Confirm Password:admin@123
     <br/>
     [fw-vsysb-aaa-manager-user-admin@@vsysb]level 15
     <br/>
     [fw-vsysb-aaa-manager-user-admin@@vsysb]service-type web ssh telnet
     <br/>
     [fw-vsysc-aaa-manager-user-admin@@vsysb]q
     <br/>
     [fw-vsysb-aaa]bind manager-user admin@@vsysb role system-admin
    </p>
    <p>
     vsysc:
     <br/>
     [fw]switch vsys vsysc
     <br/>
     system-view
     <br/>
     [fw-vsysc]aaa
     <br/>
     [fw-vsysc-aaa]manager-user admin@@vsysc
     <br/>
     [fw-vsysc-aaa-manager-user-admin@@vsysc]password
     <br/>
     Enter Password:admin@123
     <br/>
     Confirm Password:admin@123
     <br/>
     [fw-vsysc-aaa-manager-user-admin@@vsysc]level 15
     <br/>
     [fw-vsysc-aaa-manager-user-admin@@vsysc]service-type web ssh telnet
     <br/>
     [fw-vsysc-aaa-manager-user-admin@@vsysc]q
     <br/>
     [fw-vsysc-aaa]bind manager-user admin@@vsysc role system-admin
    </p>
    <p>
     web：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2a96d218ee4c470d988c8ddc6aa205af.jpeg#pic_center">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4517da64fb154398aff7517f0dbb3372.jpeg#pic_center">
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/01a121390fad4e8782ac5e4b083dc2f2.jpeg#pic_center">
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1ec5bf288d0949a1b2dfc9ff03fa4390.jpeg#pic_center">
         <br/>
         <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/5b70af8cc94e4117ba47b797adaf6d2f.jpeg#pic_center"/>
        </img>
       </img>
      </img>
     </img>
    </p>
    <p>
     配置根虚拟接口ip
     <br/>
     fw
    </p>
    <p>
     [fw]interface Virtual-if0
     <br/>
     [fw-Virtual-if0]ip address 172.16.0.1 24
    </p>
    <p>
     区域划分
    </p>
    <p>
     [fw]firewall zone trust
     <br/>
     [fw-zone-trust]add interface Virtual-if 0
    </p>
    <p>
     [fw]firewall zone untrust
     <br/>
     [fw-zone-untrust]add interface GigabitEthernet 1/0/0
    </p>
    <p>
     静态路由：
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/af676b10059d42a3a758f8d644f56e46.jpeg#pic_center"/>
    </p>
    <p>
     安全策略
    </p>
    <p>
     [fw]security-policy
     <br/>
     [fw-policy-security]rule name t_to_internet
     <br/>
     [fw-policy-security-rule-t_to_internet]source-zone trust
     <br/>
     [fw-policy-security-rule-t_to_internet]destination-zone untrust
     <br/>
     [fw-policy-security-rule-t_to_internet]action permit
    </p>
    <p>
     nat策略
    </p>
    <p>
     [fw]nat-policy
     <br/>
     [fw-policy-nat]rule name 1
     <br/>
     [fw-policy-nat-rule-1]source-zone trust
     <br/>
     [fw-policy-nat-rule-1]destination-zone untrust
     <br/>
     [fw-policy-nat-rule-1]source-address 10.3.0.0 16
     <br/>
     [fw-policy-nat-rule-1]action source-nat easy-ip
    </p>
    <p>
     接口，缺省路由和区域划分：
    </p>
    <p>
     vsysa：
    </p>
    <p>
     接口ip：
     <br/>
     [fw]switch vsys vsysa
     <br/>
     system-view
    </p>
    <p>
     [fw-vsysa]interface GigabitEthernet 1/0/1
     <br/>
     [fw-vsysa-GigabitEthernet1/0/1]ip address 10.3.0.254 24
    </p>
    <p>
     [fw-vsysa]interface Virtual-if 1
     <br/>
     [fw-vsysa-Virtual-if1]ip address 172.16.1.1 24
    </p>
    <p>
     区域划分：
     <br/>
     [fw-vsysa]firewall zone trust
     <br/>
     [fw-vsysa-zone-trust]add interface GigabitEthernet 1/0/1
    </p>
    <p>
     [fw-vsysa]firewall zone untrust
     <br/>
     [fw-vsysa-zone-untrust]add interface Virtual-if 1
    </p>
    <p>
     缺省路由；
     <br/>
     [fw-vsysa]ip route-static 0.0.0.0 0 public
    </p>
    <p>
     地址组：
     <br/>
     [fw-vsysa]ip address-set 1 type object
     <br/>
     [fw-vsysa-object-address-set-1]address range 10.3.0.1 10.3.0.10
    </p>
    <p>
     安全策略：
     <br/>
     [fw-vsysa]security-policy
     <br/>
     [fw-vsysa-policy-security]rule name 1
     <br/>
     [fw-vsysa-policy-security-rule-1]source-zone trust
     <br/>
     [fw-vsysa-policy-security-rule-1]destination-zone untrust
     <br/>
     [fw-vsysa-policy-security-rule-1]source-address address-set 1
     <br/>
     [fw-vsysa-policy-security-rule-1]action permit
    </p>
    <p>
     vsysb：
    </p>
    <p>
     [fw]switch vsys vsysb
     <br/>
     system-view
    </p>
    <p>
     [fw-vsysb]interface GigabitEthernet 1/0/2
     <br/>
     [fw-vsysb-GigabitEthernet1/0/2]ip address 10.3.1.254 24
    </p>
    <p>
     [fw-vsysb]interface Virtual-if 2
     <br/>
     [fw-vsysb-Virtual-if2]ip address 172.16.1.1 24
    </p>
    <p>
     [fw-vsysb]firewall zone trust
     <br/>
     [fw-vsysb-zone-trust]add interface GigabitEthernet 1/0/2
    </p>
    <p>
     [fw-vsysb]firewall zone untrust
     <br/>
     [fw-vsysb-zone-untrust]add interface Virtual-if 2
    </p>
    <p>
     [fw-vsysb]ip route-static 0.0.0.0 0 public
    </p>
    <p>
     vsysc：
    </p>
    <p>
     [fw]switch vsys vsysc
    </p>
    <p>
     system-view
    </p>
    <p>
     [fw-vsysc]interface GigabitEthernet 1/0/3
     <br/>
     [fw-vsysc-GigabitEthernet1/0/3]ip address 10.3.2.254 24
    </p>
    <p>
     [fw-vsysc]interface Virtual-if 3
     <br/>
     [fw-vsysc-Virtual-if3]ip address 172.16.2.1 24
    </p>
    <p>
     [fw-vsysc]firewall zone trust
     <br/>
     [fw-vsysc-zone-trust]add interface GigabitEthernet 1/0/3
    </p>
    <p>
     [fw-vsysc]firewall zone untrust
     <br/>
     [fw-vsysc-zone-untrust]add interface Virtual-if 3
    </p>
    <p>
     [fw-vsysc]ip route-static 0.0.0.0 0 public
    </p>
    <p>
     [fw-vsysc]security-policy
     <br/>
     [fw-vsysc-policy-security]rule name 3
     <br/>
     [fw-vsysc-policy-security-rule-3]source-zone trust
     <br/>
     [fw-vsysc-policy-security-rule-3]destination-zone untrust
     <br/>
     [fw-vsysc-policy-security-rule-3]source-address 10.3.2.0 24
     <br/>
     [fw-vsysc-policy-security-rule-3]action permit
    </p>
    <p>
     测试：
    </p>
    <p>
     pc1ip0.1访问100.1.1.1
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1be976a83a9f46ffa6ba913ccb0e3df9.jpeg#pic_center"/>
    </p>
    <p>
     将0.1改为0.11
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4d1e10edc6dc4e38ac3cf4ddb7bd2d17.jpeg#pic_center"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ee01c88db43242f6b73141145d89b0a8.jpeg#pic_center"/>
    </p>
    <p>
     pc2ping100.1.1.1
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/b2cae1f6aea3470cb9f20509473d7dcc.jpeg#pic_center"/>
    </p>
    <p>
     pc3ping100.1.1.1
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4ce2a052338c4895a8adfee55cac161a.jpeg#pic_center"/>
    </p>
    <p>
     pc1 ping pc2
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/746dfc81b01c4f90af139cf5ea76d3b1.jpeg#pic_center"/>
    </p>
    <p>
     a:
     <br/>
     [fw-vsysa-policy-security]rule name a_to_b
     <br/>
     [fw-vsysa-policy-security-rule-a_to_b]source-zone trust
     <br/>
     [fw-vsysa-policy-security-rule-a_to_b]destination-zone untrust
     <br/>
     [fw-vsysa-policy-security-rule-a_to_b]source-address 10.3.0.0 24
     <br/>
     [fw-vsysa-policy-security-rule-a_to_b]destination-address 10.3.1.0 24
     <br/>
     [fw-vsysa-policy-security-rule-a_to_b]action permit
    </p>
    <p>
     [fw-vsysa-policy-security]rule move a_to_b before 1
    </p>
    <p>
     b:
     <br/>
     [fw-vsysb-policy-security]rule name 2
     <br/>
     [fw-vsysb-policy-security-rule-2]source-zone untrust
     <br/>
     [fw-vsysb-policy-security-rule-2]destination-zone trust
     <br/>
     [fw-vsysb-policy-security-rule-2]source-address 10.3.0.0 24
     <br/>
     [fw-vsysb-policy-security-rule-2]destination-address 10.3.1.0 24
     <br/>
     [fw-vsysb-policy-security-rule-2]action permit
    </p>
    <p>
     public：
     <br/>
     [fw]ip route-static 10.3.1.0 24 vpn-instance vsysb
     <br/>
     [fw]ip route-static vpn-instance vsysa 10.3.1.0 24 vpn-instance vsysb
    </p>
    <p>
     a_to_c
    </p>
    <p>
     根：
     <br/>
     [fw]ip route-static vpn-instance vsysa 10.3.2.0 24 vpn-instance vsysc
    </p>
    <p>
     a:
     <br/>
     [fw-policy-security]rule name a_to_c
     <br/>
     [fw-policy-security-rule-a_to_c]source-zone trust
     <br/>
     [fw-policy-security-rule-a_to_c]destination-zone untrust
     <br/>
     [fw-policy-security-rule-a_to_c]source-address 10.3.0.0 24
     <br/>
     [fw-policy-security-rule-a_to_c]destination-address 10.3.2.0 24
     <br/>
     [fw-policy-security-rule-a_to_c]action permit
    </p>
    <p>
     c:
     <br/>
     [fw-vsysc-policy-security]rule name 4
     <br/>
     [fw-vsysc-policy-security-rule-4]source-zone untrust
     <br/>
     [fw-vsysc-policy-security-rule-4]destination-zone trust
     <br/>
     [fw-vsysc-policy-security-rule-4]source-address 10.3.0.0 24
     <br/>
     [fw-vsysc-policy-security-rule-4]destination-address 10.3.2.0 24
     <br/>
     [fw-vsysc-policy-security-rule-4]action permit
     <br/>
     :15
    </p>
    <p>
     b_to_c
    </p>
    <p>
     根：
     <br/>
     [fw]ip route-static vpn-instance vsysb 10.3.2.0 24 vpn-instance vsysc
    </p>
    <p>
     b:
     <br/>
     [fw-vsysb-policy-security]rule name 3
     <br/>
     [fw-vsysb-policy-security-rule-3]source-zone trust
     <br/>
     [fw-vsysb-policy-security-rule-3]destination-zone untrust
     <br/>
     [fw-vsysb-policy-security-rule-3]source-address 10.3.1.0 24
     <br/>
     [fw-vsysb-policy-security-rule-3]destination-address 10.3.2.0 24
     <br/>
     [fw-vsysb-policy-security-rule-3]action permit
    </p>
    <p>
     c:
     <br/>
     [fw-vsysc-policy-security]rule name 5
     <br/>
     [fw-vsysc-policy-security-rule-5]source-zone untrust
     <br/>
     [fw-vsysc-policy-security-rule-5]destination-zone trust
     <br/>
     [fw-vsysc-policy-security-rule-5]source-address 10.3.1.0 24
     <br/>
     [fw-vsysc-policy-security-rule-5]destination-address 10.3.2.0 24
     <br/>
     [fw-vsysc-policy-security-rule-5]action permit
    </p>
    <p>
     ：
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/05612203506e4b018942912633eb86d2.jpeg#pic_center"/>
    </p>
    <p>
     b_to_a
    </p>
    <p>
     根：
     <br/>
     [fw]ip route-static vpn-instance vsysb 10.3.0.0 24 vpn-instance vsysa
    </p>
    <p>
     a:
     <br/>
     [fw-vsysa-policy-security]rule name b_to_a
     <br/>
     [fw-vsysa-policy-security-rule-b_to_a]source-zone untrust
     <br/>
     [fw-vsysa-policy-security-rule-b_to_a]destination-zone trust
     <br/>
     [fw-vsysa-policy-security-rule-b_to_a]source-address 10.3.1.0 24
     <br/>
     [fw-vsysa-policy-security-rule-b_to_a]destination-address 10.3.0.0 24
     <br/>
     [fw-vsysa-policy-security-rule-b_to_a]action permit
    </p>
    <p>
     b:
    </p>
    <p>
     [fw-vsysb-policy-security]rule name 4
     <br/>
     [fw-vsysb-policy-security-rule-4]source-zone trust
     <br/>
     [fw-vsysb-policy-security-rule-4]destination-zone untrust
     <br/>
     [fw-vsysb-policy-security-rule-4]source-address 10.3.1.0 24
     <br/>
     [fw-vsysb-policy-security-rule-4]destination-address 10.3.0.0 24
     <br/>
     [fw-vsysb-policy-security-rule-4]action permit
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/18015e27f7a84e8cb4ded00ae689f979.jpeg#pic_center"/>
    </p>
    <p>
     c_to_a
    </p>
    <p>
     根：
     <br/>
     [fw]ip route-static vpn-instance vsysc 10.3.0.0 24 vpn-instance vsysa
    </p>
    <p>
     a:
     <br/>
     [fw-vsysa-policy-security]rule name c_to_a
     <br/>
     [fw-vsysa-policy-security-rule-c_to_a]source-zone untrust
     <br/>
     [fw-vsysa-policy-security-rule-c_to_a]destination-zone trust
     <br/>
     [fw-vsysa-policy-security-rule-c_to_a]source-address 10.3.2.0 24
     <br/>
     [fw-vsysa-policy-security-rule-c_to_a]destination-address 10.3.0.0 24
     <br/>
     [fw-vsysa-policy-security-rule-c_to_a]action permit
    </p>
    <p>
     c:已经有t_unt的安全策略
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8f60487d33f9451d9984602462b3f682.jpeg#pic_center"/>
    </p>
    <p>
     c_to_b
    </p>
    <p>
     根：
     <br/>
     [fw]ip route-static vpn-instance vsysc 10.3.1.0 24 vpn-instance vsysb
    </p>
    <p>
     b:
     <br/>
     [fw-vsysb-policy-security]rule name 5
     <br/>
     [fw-vsysb-policy-security-rule-5]source-zone untrust
     <br/>
     [fw-vsysb-policy-security-rule-5]destination-zone trust
     <br/>
     [fw-vsysb-policy-security-rule-5]source-address 10.3.2.0 24
     <br/>
     [fw-vsysb-policy-security-rule-5]destination-address 10.3.1.0 24
     <br/>
     [fw-vsysb-policy-security-rule-5]action permit
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/03133db6da2440119272c2d8221cf2e0.jpeg#pic_center"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323230315f37353334333639352f:61727469636c652f64657461696c732f313436323337373635" class_="artid" style="display:none">
 </p>
</div>


