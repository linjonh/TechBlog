---
layout: post
title: "Proteus-仿真-STM32CubeMX-协同开发全教程从配置到仿真一步到位"
date: 2025-09-01T22:09:00+0800
description: "本文详细介绍了基于STM32F103R6芯片（Cortex-M3内核，32KB Flash）的开发流程，通过STM32CubeMX图形化配置和Proteus虚拟仿真实现零硬件开发。重点演示了LED闪烁和ADC采集两个典型案例，从工具准备（需安装STM32F1系列固件包和专用元件库）、CubeMX配置（包括GPIO和72MHz时钟设置）、Keil编程到Proteus电路搭建的全过程。特别强调STM32F103R6的BOOT0引脚必须接地、电源引脚需全部连接等关键注意事项，并提供了Flash优化、仿真加速等实用"
keywords: "Proteus 仿真 + STM32CubeMX 协同开发全教程：从配置到仿真一步到位"
categories: ['未分类']
tags: ['嵌入式硬件', '单片机', '仿真', 'Stm', 'Proteus', 'Adc']
artid: "151084604"
arturl: "https://blog.csdn.net/qq_29246181/article/details/151084604"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=151084604
    alt: "Proteus-仿真-STM32CubeMX-协同开发全教程从配置到仿真一步到位"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=151084604
featuredImagePreview: https://bing.ee123.net/img/rand?artid=151084604
cover: https://bing.ee123.net/img/rand?artid=151084604
image: https://bing.ee123.net/img/rand?artid=151084604
img: https://bing.ee123.net/img/rand?artid=151084604
---



# Proteus 仿真 + STM32CubeMX 协同开发全教程：从配置到仿真一步到位



为帮助你精准掌握「Proteus 仿真 + STM32CubeMX+STM32F103R6」的协同开发流程，本文将聚焦该芯片的特性，从工具适配、分步实操到进阶案例，用富文本格式清晰呈现细节，尤其适合新手入门 32 位单片机开发：

## **Proteus+STM32CubeMX 实战：STM32F103R6 从配置到仿真全指南**

STM32F103R6 作为**入门级 Cortex-M3 内核芯片**（32KB Flash+10KB RAM），性价比极高，搭配 STM32CubeMX 的图形化配置与 Proteus 的虚拟仿真，无需实物即可完成基础项目开发。本文以该芯片为核心，详解 “LED 闪烁”“ADC 采集” 两大典型案例，覆盖从配置到仿真的完整流程。

### 一、工具准备与适配说明（针对 STM32F103R6）

#### 1. 工具版本与资源包

| 工具 | 版本要求 | 关键适配操作 |
| --- | --- | --- |
| **STM32CubeMX** | 6.0+ | 需安装「STM32F1 Series」固件包（打开 CubeMX→Help→Manage Embedded Software Packs→搜索安装） |
| **Proteus** | 8.9+ | 必须安装「STM32F103R6 元件库」（百度搜索 “Proteus STM32F103R6 库”，解压后复制到 Proteus 的`LIBRARY`文件夹） |
| **Keil MDK** | 5.28+ | 安装「STM32F1xx Device Pack」（Keil→Pack Installer→搜索 “STM32F1” 安装） |

#### 2. STM32F103R6 核心参数（选型与配置依据）

* **内核**：ARM Cortex-M3，最高主频 72MHz
* **存储**：32KB Flash（程序存储）、10KB RAM（数据存储）
* **封装**：LQFP64（64 引脚，教程中统一以此为例）
* **关键外设**：1 个 12 位 ADC（10 通道）、2 个 UART、1 个 I2C、1 个 SPI、3 个通用定时器
* **供电**：2.0V~3.6V（Proteus 仿真中统一接 3.3V）

### 二、基础案例：STM32F103R6 控制 LED 闪烁（入门必练）

#### 步骤 1：STM32CubeMX 配置 STM32F103R6

##### （1）新建工程并选择芯片

1. 打开 STM32CubeMX→点击「Access to MCU Selector」
2. 搜索「STM32F103R6」→选择「STM32F103R6T6」（LQFP64 封装）→点击「Start Project」

##### （2）配置 GPIO 引脚（LED 接 PA0）

1. 左侧「Pinout & Configuration」→点击引脚图中的「PA0」→选择「GPIO_Output」
2. 右侧「Configuration」→「GPIO」→「PA0」参数设置：
   * Output Level：Low（初始低电平，LED 灭）
   * Output Type：Push-Pull（推挽输出）
   * Speed：Low（LED 控制无需高速）
   * Pull-up/Pull-down：No pull-up and no pull-down

##### （3）配置系统时钟（STM32F103R6 必设）

1. 左侧「RCC」→「High Speed Clock (HSE)」→勾选「Crystal/Ceramic Resonator」（外部 8MHz 晶振）
2. 右侧「Clock Configuration」→按下图配置（最终 HCLK=72MHz）：
   * HSE（8MHz）→ PLL Multiplier（×9）→ PLLCLK（72MHz）
   * APB1 Prescaler（/2）→ APB1 时钟 36MHz（不超过最大限制）
3. 点击「OK」保存配置

##### （4）生成 Keil 工程

1. 左侧「Project Manager」→「Project」：
   * Project Name：LED_Blink_R6
   * Project Location：选择英文路径（如`D:\STM32_Projects`）
   * Toolchain/IDE：MDK-ARM（Version 5）
2. 「Code Generator」→勾选「Generate peripheral initialization as a pair of .c/.h files per peripheral」
3. 点击「GENERATE CODE」→生成后点击「Open Project」打开 Keil

#### 步骤 2：Keil 编写 LED 闪烁代码（适配 STM32F103R6）

1. 在 Keil 工程左侧「Project」→展开「Src」→双击「main.c」
2. 在`main()`函数的`while(1)`循环中添加代码（利用 CubeMX 生成的 HAL 库函数）：

   c

   ```

   while (1)
   {
     /* 翻转PA0电平（LED亮灭切换） */
     HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_0);  
     HAL_Delay(1000);  // 延时1秒（HAL库自带毫秒级延时）
     /* USER CODE END 3 */
   }

   ```
3. 点击 Keil 工具栏「Build」（锤子图标）→确保编译无错误（0 Errors）
4. 配置 hex 输出：点击「Options for Target」（魔术棒）→「Output」→勾选「Create HEX File」→再次编译，在「Output」文件夹生成「LED_Blink_R6.hex」

#### 步骤 3：Proteus 搭建 STM32F103R6 虚拟电路

1. 打开 Proteus→新建工程→输入名称「STM32F103R6_LED」→选择「Create a schematic from scratch」
2. 点击右侧「元件库（P）」→搜索添加以下元件（适配 R6 芯片）：

| 元件名称 | 搜索关键词 | 参数 / 连接说明 |
| --- | --- | --- |
| STM32F103R6T6 | STM32F103R6T6 | 64 引脚封装，核心芯片 |
| 红色 LED | LED-RED | 长脚阳极，短脚阴极 |
| 电阻 | RES | 双击改值为 1kΩ（限流保护 LED） |
| 3.3V 电源 | POWER | 接 STM32 的 VDD 引脚（3.3V 供电） |
| 地 | GROUND | 接 STM32 的 VSS 引脚 |

1. 电路连线（**STM32F103R6 关键引脚必接**）：
   * STM32 引脚：VDD（1、17 脚）→ 3.3V POWER；VSS（16、32、48、64 脚）→ GROUND
   * STM32 PA0（4 脚）→ LED 阳极；LED 阴极→1kΩ 电阻→GROUND
   * **关键！** STM32 BOOT0（62 脚）→ GROUND（运行模式，否则无法启动程序）

#### 步骤 4：导入 hex 并仿真

1. 在 Proteus 中双击「STM32F103R6T6」芯片→「Program File」→浏览选择 Keil 生成的「LED_Blink_R6.hex」→点击「OK」
2. 点击 Proteus 底部「Play」按钮（▶）→观察效果：LED 每隔 1 秒闪烁一次，仿真成功！

### 三、进阶案例：STM32F103R6 ADC 采集电位器电压（外设实战）

#### 1. CubeMX 配置 ADC（PA1 作为 ADC 通道 1）

1. 打开 CubeMX 工程→左侧「Pinout & Configuration」→点击「PA1」→选择「ADC1_IN1」（ADC 通道 1）
2. 左侧「ADC」→「ADC1」→「Configuration」：
   * Mode：Independent ADC（独立模式）
   * Data Alignment：Right alignment（右对齐）
   * Scan Conversion Mode：Disabled（单通道采集）
   * Continuous Conversion Mode：Enabled（连续采集）
3. 生成 Keil 工程（命名为 ADC_R6）

#### 2. Keil 编写 ADC 采集代码

在`main.c`中添加 ADC 初始化与读取函数：

```

/* ADC句柄（CubeMX自动生成） */
ADC_HandleTypeDef hadc1;

/* 读取ADC值函数 */
uint16_t Get_ADC_Value(void)
{
  HAL_ADC_Start(&hadc1);  // 启动ADC
  HAL_ADC_PollForConversion(&hadc1, 50);  // 等待转换完成（超时50ms）
  return HAL_ADC_GetValue(&hadc1);  // 返回12位ADC值（0-4095）
}

/* main函数while循环 */
while (1)
{
  adc_value = Get_ADC_Value();
  voltage = (float)adc_value * 3.3f / 4095.0f;  // 计算电压（3.3V参考电压）
  HAL_Delay(500);
}

```

#### 3. Proteus 电路搭建（含 LCD1602 显示）

1. 新增元件：POT（电位器）、LCD1602、2 个 10kΩ 电阻（LCD 背光和对比度）
2. 连线：
   * PA1→POT 中间引脚；POT 两端分别接 3.3V 和 GROUND
   * STM32 PB0-PB7 接 LCD1602 D0-D7；PA2 接 RS；PA3 接 EN
3. 导入 hex 仿真：拖动电位器，LCD1602 实时显示 0-3.3V 电压值

### 四、STM32F103R6 专属问题排查

#### 1. 仿真无反应？

* ❌ **BOOT0 未接 GND**：STM32F103R6 的 BOOT0（62 脚）必须接地，否则处于 “下载模式” 无法运行程序
* ❌ **电源引脚未接全**：VDD（1、17 脚）需同时接 3.3V，VSS（16、32、48、64 脚）需同时接地
* ❌ **CubeMX 时钟未配置**：未启用 HSE 晶振会导致芯片主频异常，延时不准或无法工作

#### 2. Keil 编译报错 “Flash 容量不足”？

* STM32F103R6 仅 32KB Flash，若代码过大：① 删除工程中无用的外设初始化代码；② 关闭 Keil 的 “Debug Info”（Options→Output→取消勾选 Debug Information）

#### 3. Proteus 搜不到 STM32F103R6？

* 确认库文件已复制到 Proteus 的`LIBRARY`文件夹，重启软件后搜索 “STM32F103R6T6”（需完整型号）

### 五、STM32F103R6 开发技巧

1. **资源规划**：32KB Flash 适合编写中小型程序（如单外设控制），避免集成复杂算法
2. **外设优先级**：优先使用 UART、GPIO 等基础外设，ADC 采集建议用单通道连续模式（节省资源）
3. **仿真优化**：Proteus 中关闭 “Animation Speed” 的 “Real Time”（菜单栏 Debug→Animation Speed→取消勾选），可提升仿真流畅度

> **实操提示**：STM32F103R6 的引脚分布需特别注意（如 PA0 为 4 脚、BOOT0 为 62 脚），建议在 Proteus 中放大芯片图标查看引脚编号，避免接线错误。后续可拓展 “UART 串口通信”“I2C 温湿度采集” 等案例，逐步熟悉该芯片的外设用法！



