---
layout: post
title: "C20-bit-中的整数-2-的幂运算和-stdbit_cast由浅入深的探索"
date: 2025-03-14 00:00:00 +0800
description: "C++20 的<bit>头文件为开发者提供了强大的位操作功能，其中整数 2 的幂运算和是两个非常实用的工具。通过本文的示例，你可以快速掌握它们的用法，并将其应用于实际项目中。无论是处理底层数据结构，还是进行高效的位运算，这些功能都能显著提升你的开发效率。希望本文对你有所帮助！如果有任何问题或建议，欢迎在评论区留言讨论。"
keywords: "C++20 `＜bit＞` 中的整数 2 的幂运算和 `std::bit_cast`：由浅入深的探索"
categories: ['C']
tags: ['C']
artid: "146239403"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146239403
    alt: "C20-bit-中的整数-2-的幂运算和-stdbit_cast由浅入深的探索"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146239403
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146239403
cover: https://bing.ee123.net/img/rand?artid=146239403
image: https://bing.ee123.net/img/rand?artid=146239403
img: https://bing.ee123.net/img/rand?artid=146239403
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     C++20 `＜bit＞` 中的整数 2 的幂运算和 `std::bit_cast`：由浅入深的探索
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <img alt="寻找特定比例男程序员图片.png" src="https://i-blog.csdnimg.cn/img_convert/6d49a22d43014b121aa6c4334c4811c7.png"/>
    </p>
    <p>
    </p>
    <p>
    </p>
    <h5>
     <a id="_4">
     </a>
     引言
    </h5>
    <p>
     C++20 引入了
     <code>
      &lt;bit&gt;
     </code>
     头文件，为开发者提供了丰富的位操作功能，极大地简化了底层编程的复杂性。其中，整数 2 的幂运算和
     <code>
      std::bit_cast
     </code>
     是两个非常实用的功能。本文将通过示例代码，由浅入深地介绍它们的用法和应用场景。
    </p>
    <hr/>
    <h4>
     <a id="1__2__10">
     </a>
     1. 整数 2 的幂运算
    </h4>
    <p>
     C++20 在
     <code>
      &lt;bit&gt;
     </code>
     中提供了多个与整数 2 的幂相关的函数，例如
     <code>
      std::has_single_bit
     </code>
     、
     <code>
      std::bit_ceil
     </code>
     和
     <code>
      std::bit_floor
     </code>
     。这些函数可以帮助开发者高效地处理与 2 的幂相关的运算。
    </p>
    <h5>
     <a id="11__2_stdhas_single_bit_14">
     </a>
     1.1 检测是否为 2 的幂：
     <code>
      std::has_single_bit
     </code>
    </h5>
    <p>
     <code>
      std::has_single_bit
     </code>
     函数用于检测一个整数是否为 2 的幂。如果一个整数的二进制表示中只有一个位为 1，则该数为 2 的幂。
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bit&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">has_single_bit</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> i <span class="token operator">&lt;&lt;</span> <span class="token string">" 是 2 的幂"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> i <span class="token operator">&lt;&lt;</span> <span class="token string">" 不是 2 的幂"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     输出示例：
    </p>
    <pre><code>0 不是 2 的幂
1 是 2 的幂
2 是 2 的幂
3 不是 2 的幂
4 是 2 的幂
5 不是 2 的幂
6 不是 2 的幂
7 不是 2 的幂
8 是 2 的幂
9 不是 2 的幂
</code></pre>
    <h5>
     <a id="12__x__2_stdbit_ceil_48">
     </a>
     1.2 计算不小于 x 的最小 2 的幂：
     <code>
      std::bit_ceil
     </code>
    </h5>
    <p>
     <code>
      std::bit_ceil
     </code>
     函数用于计算不小于给定整数的最小 2 的幂。例如，
     <code>
      std::bit_ceil(5)
     </code>
     的结果是 8，因为 8 是不小于 5 的最小 2 的幂。
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bit&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bitset&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">auto</span> result <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">bit_ceil</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"bit_ceil("</span> <span class="token operator">&lt;&lt;</span> i <span class="token operator">&lt;&lt;</span> <span class="token string">") = "</span> <span class="token operator">&lt;&lt;</span> result <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     输出示例：
    </p>
    <pre><code>bit_ceil(0) = 0
bit_ceil(1) = 1
bit_ceil(2) = 2
bit_ceil(3) = 4
bit_ceil(4) = 4
bit_ceil(5) = 8
bit_ceil(6) = 8
bit_ceil(7) = 8
bit_ceil(8) = 8
bit_ceil(9) = 16
</code></pre>
    <h5>
     <a id="13__x__2_stdbit_floor_80">
     </a>
     1.3 计算不大于 x 的最大 2 的幂：
     <code>
      std::bit_floor
     </code>
    </h5>
    <p>
     <code>
      std::bit_floor
     </code>
     函数用于计算不大于给定整数的最大 2 的幂。例如，
     <code>
      std::bit_floor(5)
     </code>
     的结果是 4。
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bit&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bitset&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">auto</span> result <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">bit_floor</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"bit_floor("</span> <span class="token operator">&lt;&lt;</span> i <span class="token operator">&lt;&lt;</span> <span class="token string">") = "</span> <span class="token operator">&lt;&lt;</span> result <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     输出示例：
    </p>
    <pre><code>bit_floor(0) = 0
bit_floor(1) = 1
bit_floor(2) = 2
bit_floor(3) = 2
bit_floor(4) = 4
bit_floor(5) = 4
bit_floor(6) = 4
bit_floor(7) = 4
bit_floor(8) = 8
bit_floor(9) = 8
</code></pre>
    <hr/>
    <h4>
     <a id="2_stdbit_cast_114">
     </a>
     2.
     <code>
      std::bit_cast
     </code>
    </h4>
    <p>
     <code>
      std::bit_cast
     </code>
     是 C++20 中引入的一种类型转换方式，它允许开发者在不同类型的位模式之间进行无损转换。与传统的
     <code>
      reinterpret_cast
     </code>
     不同，
     <code>
      std::bit_cast
     </code>
     更安全，因为它不会改变对象的值，而是直接复制位模式。
    </p>
    <h5>
     <a id="21__118">
     </a>
     2.1 基本用法
    </h5>
    <p>
     <code>
      std::bit_cast
     </code>
     的语法如下：
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">To</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">From</span><span class="token operator">&gt;</span>
<span class="token keyword">constexpr</span> To <span class="token function">bit_cast</span><span class="token punctuation">(</span><span class="token keyword">const</span> From<span class="token operator">&amp;</span> src<span class="token punctuation">)</span> <span class="token keyword">noexcept</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     以下是一个将浮点数转换为整数的示例：
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bit&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">double</span> f <span class="token operator">=</span> <span class="token number">123.456</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> u <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">bit_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">uint64_t</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"bit_cast&lt;uint64_t&gt;("</span> <span class="token operator">&lt;&lt;</span> f <span class="token operator">&lt;&lt;</span> <span class="token string">") = 0x"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>hex <span class="token operator">&lt;&lt;</span> u <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    <span class="token keyword">auto</span> f2 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">bit_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"bit_cast&lt;double&gt;(0x"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>hex <span class="token operator">&lt;&lt;</span> u <span class="token operator">&lt;&lt;</span> <span class="token string">") = "</span> <span class="token operator">&lt;&lt;</span> f2 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     输出示例：
    </p>
    <pre><code>bit_cast&lt;uint64_t&gt;(123.456) = 0x405ed4ccccccccd
bit_cast&lt;double&gt;(0x405ed4ccccccccd) = 123.456
</code></pre>
    <h5>
     <a id="22__150">
     </a>
     2.2 实用场景：字节序列与结构体之间的转换
    </h5>
    <p>
     <code>
      std::bit_cast
     </code>
     还可以用于将字节序列转换为结构体，这对于处理二进制文件或网络数据非常有用。例如：
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bit&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;array&gt;</span></span>

<span class="token keyword">struct</span> <span class="token class-name">Vec3</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">float</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>array<span class="token operator">&lt;</span><span class="token keyword">uint8_t</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Vec3<span class="token punctuation">)</span><span class="token operator">&gt;</span> buffer <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0x3f</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    Vec3 vec <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">bit_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vec3<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Vec3: ("</span> <span class="token operator">&lt;&lt;</span> vec<span class="token punctuation">.</span>x <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> vec<span class="token punctuation">.</span>y <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> vec<span class="token punctuation">.</span>z <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     输出示例：
    </p>
    <pre><code>Vec3: (1.000000, 0.000000, 0.000000)
</code></pre>
    <hr/>
    <h4>
     <a id="3__180">
     </a>
     3. 总结
    </h4>
    <p>
     C++20 的
     <code>
      &lt;bit&gt;
     </code>
     头文件为开发者提供了强大的位操作功能，其中整数 2 的幂运算和
     <code>
      std::bit_cast
     </code>
     是两个非常实用的工具。通过本文的示例，你可以快速掌握它们的用法，并将其应用于实际项目中。无论是处理底层数据结构，还是进行高效的位运算，这些功能都能显著提升你的开发效率。
    </p>
    <p>
     希望本文对你有所帮助！如果有任何问题或建议，欢迎在评论区留言讨论。
    </p>
    <hr/>
    <h4>
     <a id="_188">
     </a>
     参考资料
    </h4>
    <p>
     <a href="https://blog.csdn.net/chenyijun/article/details/140108947">
      标准库标头 ＜bit＞（C++20）学习 - CSDN博客
     </a>
     <br/>
     <a href="https://cppreference.cn/w/cpp/numeric/bit_cast" rel="nofollow">
      std::bit_cast - cppreference.com - C++参考手册
     </a>
     <br/>
     <a href="https://runebook.dev/cn/docs/cpp/numeric/bit_ceil" rel="nofollow">
      C++ std::bit_ceil 简体中文 - Runebook.dev
     </a>
     <br/>
     <a href="https://blog.csdn.net/weixin_28931507/article/details/143686918">
      C++20中std::bit_cast函数的深入解析 - CSDN博客
     </a>
     <br/>
     <a href="https://runebook.dev/cn/docs/cpp/numeric/bit_floor" rel="nofollow">
      C++ std::bit_floor 简体中文 - Runebook.dev
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f5a5f6f696f69686f69692f:61727469636c652f64657461696c732f313436323339343033" class_="artid" style="display:none">
 </p>
</div>


