---
layout: post
title: "在-Axios-中设置代理"
date: 2025-03-10 21:21:24 +0800
description: "使用 Axios 为 HTTP、HTTPS 和 SOCKS 请求配置并使用代理，包括轮换代理和全局配置等进阶场景。"
keywords: "在 Axios 中设置代理"
categories: ['未分类']
tags: ['代理服务器', 'Socks', 'Server', 'Proxy', 'Https', 'Http', 'Axios', 'Api']
artid: "146162624"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146162624
    alt: "在-Axios-中设置代理"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146162624
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146162624
cover: https://bing.ee123.net/img/rand?artid=146162624
image: https://bing.ee123.net/img/rand?artid=146162624
img: https://bing.ee123.net/img/rand?artid=146162624
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     在 Axios 中设置代理
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     在 Axios 中设置代理
    </h2>
    <p style="text-align:center">
     <img alt="" src="https://i-blog.csdnimg.cn/direct/9a889855b960407e9e8449c582bfc0f5.png"/>
    </p>
    <h3>
     Axios 与代理
    </h3>
    <p>
     <a href="https://axios-http.com/" rel="nofollow" title="Axios">
      Axios
     </a>
     是 JavaScript 生态中最广泛使用的 HTTP 客户端之一。它基于 Promise，提供了易用、直观的 API，用于执行 HTTP 请求并处理自定义请求头、配置和 Cookie 等。
    </p>
    <p>
     通过为 Axios 请求设置代理，您可以隐藏自己的 IP 地址，从而让目标服务器更难以识别并阻止您的请求。
    </p>
    <h3>
     在 Axios 中使用代理
    </h3>
    <p>
     让我们来看看如何在 Axios 中设置 HTTP、HTTPS 或 SOCKS 代理。首先，安装
     <code>
      axios
     </code>
     ：
    </p>
    <pre><code>npm install axios
</code></pre>
    <p>
     在 Node.js 环境中，Axios 原生支持通过
     <a href="https://github.com/axios/axios#request-config" title="proxy">
      proxy
     </a>
     配置来使用 HTTP 和 HTTPS 代理。因此，如果您只需要在 Node.js 项目中使用 HTTP/HTTPS 代理，则无需额外操作。
    </p>
    <p>
     但若您要使用非 HTTP/S 协议的代理，就需要借助
     <a href="https://github.com/TooTallNate/proxy-agents" title="Proxy Agents">
      Proxy Agents
     </a>
     项目提供的
     <code>
      http.Agent
     </code>
     实现，它让 Axios 能够使用不同协议的代理：
    </p>
    <ul>
     <li>
      HTTP 和 HTTPS 代理:
      <a href="https://github.com/TooTallNate/proxy-agents/blob/main/packages/https-proxy-agent" title="https-proxy-agent">
       https-proxy-agent
      </a>
     </li>
     <li>
      SOCKS、SOCKS5 和 SOCKS4:
      <a href="https://github.com/TooTallNate/proxy-agents/blob/main/packages/socks-proxy-agent" title="socks-proxy-agent">
       socks-proxy-agent
      </a>
     </li>
     <li>
      PAC-*:
      <a href="https://github.com/TooTallNate/proxy-agents/blob/main/packages/pac-proxy-agent" title="pac-proxy-agent">
       pac-proxy-agent
      </a>
     </li>
    </ul>
    <h4>
     HTTP/HTTPS 代理
    </h4>
    <p>
     您的 HTTP/HTTPS 代理的 URL 通常形式如下：
    </p>
    <pre><code>"&lt;PROXY_PROTOCOL&gt;://&lt;PROXY_HOST&gt;:&lt;PROXY_PORT&gt;"
</code></pre>
    <ul>
     <li>
      <code>
       &lt;PROXY_PROTOCOL&gt;
      </code>
      ：对于 HTTP 代理是 "http"，对于 HTTPS 代理是 "https"。
     </li>
     <li>
      <code>
       &lt;PROXY_HOST&gt;
      </code>
      ：代理服务器的 IP 地址。
     </li>
     <li>
      <code>
       &lt;PROXY_PORT&gt;
      </code>
      ：代理服务器监听的端口号。
     </li>
    </ul>
    <p>
     例如，假设这是您的 HTTP 代理的地址：
    </p>
    <pre><code>"http://47.88.62.42:80"
</code></pre>
    <p>
     您可以在 Axios 中这样设置：
    </p>
    <pre><code>axios.get(targetURL, {
    proxy: {
        protocol: "http",
        host: "47.88.62.42",
        port: 80
    }
})
</code></pre>
    <p>
     要验证这个配置方式是否可行，可以获取一个免费 HTTP 或 HTTPS 代理地址，比如：
    </p>
    <pre><code>Protocol: HTTP; IP Address: 52.117.157.155; Port: 8002
</code></pre>
    <p>
     完整的代理地址就是
     <code>
      http://52.117.157.155:8002
     </code>
     。为了验证代理是否生效，您可以通过 HTTPBin 项目的
     <a href="https://httpbin.io/ip" rel="nofollow" title="/ip">
      /ip
     </a>
     接口测试请求。这个接口会返回请求的来源 IP，因此应该是代理服务器的 IP。
    </p>
    <p>
     Node.js 中的测试代码片段示例如下：
    </p>
    <pre><code>import axios from "axios"

async function testProxy() {
    // 使用 HTTP 代理进行请求
    const response = await axios.get("https://httpbin.io/ip", {
        proxy: {
            protocol: "http",
            host: "52.117.157.155",
            port: 8002
        }
    });

    // 打印结果
    console.log(response.data)
}

testProxy()
</code></pre>
    <p>
     运行脚本后，理想情况下会输出：
    </p>
    <pre><code>{ "origin": "52.117.157.155" }
</code></pre>
    <blockquote>
     <p>
      <strong>
       警告
      </strong>
      ：
      <br/>
      若您跟着示例代码直接运行，可能不会得到相同结果，因为免费代理服务通常不稳定、速度慢、容易出错，有的数据还可能被记录或解析，且通常时效很短。
     </p>
    </blockquote>
    <h4>
     SOCKS 代理
    </h4>
    <p>
     如果您尝试在
     <code>
      proxy
     </code>
     配置中将协议设置为 "socks"，会出现如下错误：
    </p>
    <pre><code>AssertionError [ERR_ASSERTION]: protocol mismatch

  // ...

  {

    generatedMessage: false,

    code: 'ERR_ASSERTION',

    actual: 'dada:',

    expected: 'http:',

    operator: '=='

}
</code></pre>
    <p>
     这是因为 Axios 并不原生支持 SOCKS 代理。为此，需要先安装
     <code>
      socks-proxy-agent
     </code>
     ：
    </p>
    <pre><code>npm install socks-proxy-agent
</code></pre>
    <p>
     该包允许您在进行 HTTP 或 HTTPS 请求时接入 SOCKS 代理。然后，引入
     <code>
      socks-proxy-agent
     </code>
     提供的 SOCKS 代理实现：
    </p>
    <pre><code>const SocksProxyAgent = require("socks-proxy-agent")
</code></pre>
    <p>
     或若您使用 ESM：
    </p>
    <pre><code>import { SocksProxyAgent } from "socks-proxy-agent"
</code></pre>
    <p>
     假设您的 SOCKS 代理地址是：
    </p>
    <pre><code>"socks://183.88.74.73:4153"
</code></pre>
    <blockquote>
     <p>
      <strong>
       注意
      </strong>
      ：
      <br/>
      代理协议可能是 “socks”、“socks5” 或者 “socks4”。
     </p>
    </blockquote>
    <p>
     将它存到某个变量里，并传给
     <code>
      SocksProxyAgent
     </code>
     构造函数：
    </p>
    <pre><code>const proxyURL = "socks://183.88.74.73:4153"
const proxyAgent = new SocksProxyAgent(proxyURL)
</code></pre>
    <p>
     <code>
      SocksProxyAgent()
     </code>
     会初始化一个
     <code>
      http.Agent
     </code>
     实例，让所有 HTTP/HTTPS 请求都走这个代理地址。
    </p>
    <p>
     在 Axios 中使用 SOCKS 代理可以这样做：
    </p>
    <pre><code>axios.get(targetURL, {
    httpAgent: proxyAgent,    
    httpsAgent: proxyAgent
})
</code></pre>
    <p>
     <code>
      httpAgent
     </code>
     和
     <code>
      httpsAgent
     </code>
     指定了在进行 HTTP/HTTPS 请求时应使用的自定义代理类。也就是说，Axios 发出的 HTTP 或 HTTPS 请求都会走这里指定的 SOCKS 代理。同理，您也可以使用
     <a href="https://www.npmjs.com/package/https-proxy-agent" rel="nofollow" title="https-proxy-agent">
      https-proxy-agent
     </a>
     来为 Axios 设置 HTTP/HTTPS 代理。
    </p>
    <p>
     示例如下：
    </p>
    <pre><code>import axios from "axios"
import { SocksProxyAgent } from "socks-proxy-agent"

async function testProxy() {
    // 将代理 URL 替换成您自己的 SOCKS 代理地址
    const proxyURL = "socks://183.88.74.73:4153"
    // 定义 HTTP/HTTPS 代理 agent
    const proxyAgent = new SocksProxyAgent(proxyURL)
    // 通过 SOCKS 代理发送请求
    const response = await axios.get("https://httpbin.io/ip", {
        httpAgent: proxyAgent,    
        httpsAgent: proxyAgent
    })

    // 打印结果
    console.log(response.data) // { "origin": "183.88.74.73" }
}

testProxy()
</code></pre>
    <p>
     如需更多关于在 Axios 中配置 SOCKS 代理的示例，可查看此链接：
     <br/>
     <a href="https://writech.run/blog/how-to-use-a-socks-proxy-in-axios-6c0355a2e013/" rel="nofollow" title="如何在 Axios 中使用 SOCKS 代理">
      如何在 Axios 中使用 SOCKS 代理
     </a>
    </p>
    <h3>
     Axios 代理：进阶用法
    </h3>
    <p style="text-align:center">
     <img alt="" src="https://i-blog.csdnimg.cn/direct/eac2b562740d4b8c8f827c3ea09f350f.png"/>
    </p>
    <h4>
     全局设置代理
    </h4>
    <p>
     如果您想在所有请求中都使用同一个代理，可以直接在 Axios 实例中进行全局设置：
    </p>
    <pre><code>const axiosInstance = axios.create({
    proxy: {
        protocol: "&lt;PROXY_PROTOCOL&gt;",
        host: "&lt;PROXY_HOST&gt;",
        port: "&lt;PROXY_PORT&gt;"
    },
    // 其他配置…
})
</code></pre>
    <p>
     或者，如果您使用了 Proxy Agents：
    </p>
    <pre><code>// 定义代理 agent ...

const axiosInstance = axios.create({
    httpAgent: proxyAgent,    
    httpsAgent: proxyAgent
})
</code></pre>
    <p>
     以下示例演示了如何全局使用 SOCKS 代理：
    </p>
    <pre><code>import { SocksProxyAgent } from "socks-proxy-agent";

const proxyURL = "socks://183.88.74.73:4153";

// 创建一个 SOCKS 代理 agent
const proxyAgent = new SocksProxyAgent(proxyURL);

// 创建一个 Axios 实例，全局应用该 SOCKS 代理
const axiosInstance = axios.create({
    httpAgent: proxyAgent, // 用于 HTTP 请求
    httpsAgent: proxyAgent, // 用于 HTTPS 请求
    // 其他配置...
});
</code></pre>
    <p>
     现在使用
     <code>
      axiosInstance
     </code>
     发出的所有请求都会自动走该代理。
    </p>
    <h4>
     在 Axios 中处理需要身份验证的代理
    </h4>
    <p>
     为了只允许付费用户使用高质量的代理，一些代理服务商会要求进行身份验证（用户名 + 密码）。若您不带用户名 / 密码地尝试连接到此类代理服务器，就会收到
     <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/407" rel="nofollow" title="407 Proxy Authentication Required">
      407 Proxy Authentication Required
     </a>
     错误。
    </p>
    <p>
     一般情况下，需要身份验证的代理地址格式如下：
    </p>
    <pre><code>[&lt;PROTOCOL&gt;://]&lt;USERNAME&gt;:&lt;PASSWORD&gt;@&lt;HOST&gt;[:&lt;PORT&gt;]
</code></pre>
    <p>
     例如，一个示例地址可能是：
    </p>
    <pre><code>http://admin:lK4w90MEe45YIkOpk@156.127.0.192:8391
</code></pre>
    <p>
     对应的要素分解如下：
    </p>
    <ul>
     <li>
      <code>
       &lt;PROTOCOL&gt;
      </code>
      :
      <code>
       http
      </code>
     </li>
     <li>
      <code>
       &lt;HOST&gt;
      </code>
      :
      <code>
       156.127.0.192
      </code>
     </li>
     <li>
      <code>
       &lt;PORT&gt;
      </code>
      :
      <code>
       8391
      </code>
     </li>
     <li>
      <code>
       &lt;USERNAME&gt;
      </code>
      :
      <code>
       admin
      </code>
     </li>
     <li>
      <code>
       &lt;PASSWORD&gt;
      </code>
      :
      <code>
       lK4w90MEe45YIkOpk
      </code>
     </li>
    </ul>
    <p>
     如果您使用 Axios 原生的
     <code>
      proxy
     </code>
     ，可以在
     <code>
      auth
     </code>
     字段中声明用户名和密码：
    </p>
    <pre><code>axios.get(targetURL, {
    proxy: {
        protocol: "http",
        host: "156.127.0.192",
        port: "8381",
        auth: {
            username: "admin",
            password: "lK4w90MEe45YIkOpk"
        }
    }
})
</code></pre>
    <p>
     若您是使用 Proxy Agents，可以通过以下两种方式处理代理验证：
    </p>
    <ol>
     <li>
      直接在代理 URL 中加入认证信息：
      <pre><code>var proxyAgent = new SocksProxyAgent("http://admin:[email protected]:8391")
</code></pre>
     </li>
     <li>
      通过
      <a href="https://nodejs.org/api/url.html" rel="nofollow" title="URL">
       URL
      </a>
      对象设置
      <code>
       username
      </code>
      和
      <code>
       password
      </code>
      ：
      <pre><code>const proxyOpts = new URL("http://156.127.0.192:8391")
proxyOpts.username = "admin"
proxyOpts.password = "lK4w90MEe45YIkOpk"

const proxyAgent = new SocksProxyAgent(proxyOpts)
</code></pre>
     </li>
    </ol>
    <p>
     对于
     <code>
      HttpsProxyAgent
     </code>
     也同理。
    </p>
    <h4>
     通过环境变量设置代理
    </h4>
    <p>
     另一个在 Axios 中全局配置代理的方式是通过环境变量：
    </p>
    <ul>
     <li>
      <code>
       HTTP_PROXY
      </code>
      : 用于 HTTP 请求的代理服务器地址。
     </li>
     <li>
      <code>
       HTTPS_PROXY
      </code>
      : 用于 HTTPS 请求的代理服务器地址。
     </li>
    </ul>
    <p>
     在 Linux 或 macOS 上，您可以这样设置：
    </p>
    <pre><code>export HTTP_PROXY="[&lt;PROTOCOL&gt;://]&lt;USERNAME&gt;:&lt;PASSWORD&gt;@&lt;HOST&gt;[:&lt;PORT&gt;]"
export HTTPS_PROXY="[&lt;PROTOCOL&gt;://]&lt;USERNAME&gt;:&lt;PASSWORD&gt;@&lt;HOST&gt;[:&lt;PORT&gt;]"
</code></pre>
    <p>
     当 Axios 检测到这些环境变量后，会读取相应的代理配置，包括身份验证所需的凭据。若您想忽略这些环境变量，可将
     <code>
      proxy
     </code>
     字段设置为
     <code>
      false
     </code>
     。也可以定义一个名为
     <code>
      NO_PROXY
     </code>
     的环境变量，以逗号分隔列出不需要走代理的域名。
    </p>
    <p>
     同样的机制也可用于
     <a href="https://www.bright.cn/blog/proxy-101/curl-with-proxies" rel="nofollow" title="通过 cURL 使用代理">
      通过 cURL 使用代理
     </a>
     。
    </p>
    <h4>
     实现轮换代理
    </h4>
    <p>
     为了防止目标站点因多次请求同一 IP 而对您的代理进行封锁，您可以让每次请求都使用不同的代理地址：
    </p>
    <ol>
     <li>
      定义一个包含多个代理信息的列表。
     </li>
     <li>
      在每次请求前随机（或按一定规则）从列表中选择一个代理。
     </li>
     <li>
      将选定的代理配置信息传给 Axios。
     </li>
    </ol>
    <p>
     这种方式需要您拥有一个可用的代理池，诸如 Bright Data 提供的
     <a href="https://www.bright.cn/solutions/rotating-proxies" rel="nofollow" title="轮换代理">
      轮换代理
     </a>
     就可以满足此需求。
    </p>
    <h3>
     结论
    </h3>
    <p>
     Bright Data 拥有全球领先的代理网络，为世界 500 强企业及超过 20,000 名客户提供服务。其全球代理网络覆盖多种类型：
    </p>
    <ul>
     <li>
      <a href="https://www.bright.cn/proxy-types/datacenter-proxies" rel="nofollow" title="数据中心代理">
       数据中心代理
      </a>
      – 超过 770,000 个数据中心 IP。
     </li>
     <li>
      <a href="https://www.bright.cn/proxy-types/residential-proxies" rel="nofollow" title="住宅代理">
       住宅代理
      </a>
      – 覆盖 195+ 个国家/地区、共 72M+ 个住宅 IP。
     </li>
     <li>
      <a href="https://www.bright.cn/proxy-types/isp-proxies" rel="nofollow" title="ISP 代理">
       ISP 代理
      </a>
      – 超过 700,000 个 ISP IP。
     </li>
     <li>
      <a href="https://www.bright.cn/proxy-types/mobile-proxies" rel="nofollow" title="移动代理">
       移动代理
      </a>
      – 超过 7M 个移动 IP。
     </li>
    </ul>
    <p>
     <a href="https://www.bright.cn/#popup-127701?utm_source=organic-social-cn&amp;utm_campaign=csdn" rel="nofollow" title="立即免费注册 Bright Data 账户">
      立即免费注册 Bright Data 账户
     </a>
     试用我们的代理服务器吧。
    </p>
   </div>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f7279616e64696e675f6272642f:61727469636c652f64657461696c732f313436313632363234" class_="artid" style="display:none">
 </p>
</div>


