---
layout: post
title: "Oracle-RAC-三种心跳机制"
date: 2025-03-12 08:58:30 +0800
description: "是集群节点间用于检测存活状态的核心机制，确保节点间的通信正常并避免脑裂（Split Brain）问题。在Oracle RAC（Real Application Clusters）中，"
keywords: "Oracle RAC 三种心跳机制"
categories: ['故障处理']
tags: ['数据库', 'Python', 'Oracle', 'Linux', 'Java', 'Database', 'C']
artid: "146195549"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146195549
    alt: "Oracle-RAC-三种心跳机制"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146195549
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146195549
cover: https://bing.ee123.net/img/rand?artid=146195549
image: https://bing.ee123.net/img/rand?artid=146195549
img: https://bing.ee123.net/img/rand?artid=146195549
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Oracle RAC 三种心跳机制
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在Oracle RAC（Real Application Clusters）中，
     <strong>
      心跳（Heartbeat）
     </strong>
     是集群节点间用于检测存活状态的核心机制，确保节点间的通信正常并避免脑裂（Split Brain）问题。以下是RAC的三种关键心跳机制及其作用：
    </p>
    <hr/>
    <h4>
     <a id="1_Network_Heartbeat_4">
     </a>
     <strong>
      1. 网络心跳（Network Heartbeat）
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       作用
      </strong>
      ：通过
      <strong>
       私有网络互联（Private Interconnect）
      </strong>
      实时检测节点间的通信状态。
     </li>
     <li>
      <strong>
       工作原理
      </strong>
      ：
      <ul>
       <li>
        每个节点周期性地（默认每秒）向其他节点发送心跳信号。
       </li>
       <li>
        若某个节点在指定时间（默认
        <code>
         misscount
        </code>
        参数为30秒）未收到其他节点的心跳，则认为该节点故障。
       </li>
       <li>
        <strong>
         关键组件
        </strong>
        ：依赖冗余的私有网络（如双网卡绑定）确保高可靠性。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       故障处理
      </strong>
      ：
      <ul>
       <li>
        若私有网络完全中断，集群可能触发节点驱逐（Node Eviction）或重启，防止脑裂。
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="2_Disk_Heartbeat_15">
     </a>
     <strong>
      2. 磁盘心跳（Disk Heartbeat）
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       作用
      </strong>
      ：通过
      <strong>
       Voting Disk
      </strong>
      检测节点是否存活。
     </li>
     <li>
      <strong>
       工作原理
      </strong>
      ：
      <ul>
       <li>
        每个节点定期向Voting Disk写入心跳信息（默认每1秒一次）。
       </li>
       <li>
        若某个节点无法在
        <code>
         disktimeout
        </code>
        时间（默认200秒）内访问Voting Disk，集群认为该节点故障。
       </li>
       <li>
        Voting Disk需存储在共享存储（如ASM、共享LUN）中，且推荐奇数个（至少3个）以容忍多数故障。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       故障处理
      </strong>
      ：
      <ul>
       <li>
        若多数Voting Disk不可用，集群可能无法达成共识，导致节点驱逐或集群宕机。
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="3_Local_Heartbeat_26">
     </a>
     <strong>
      3. 本地心跳（Local Heartbeat）
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       作用
      </strong>
      ：节点内部自检机制，确保本地进程健康。
     </li>
     <li>
      <strong>
       工作原理
      </strong>
      ：
      <ul>
       <li>
        集群守护进程（如
        <code>
         CSSD
        </code>
        ，Cluster Synchronization Services Daemon）监控本地节点的关键资源（如网络、存储）。
       </li>
       <li>
        若本地关键资源异常（如私有网络中断或存储访问失败），节点会主动终止自身以避免集群分裂。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       故障处理
      </strong>
      ：
      <ul>
       <li>
        节点自终止（Self-Termination）后，剩余节点重新组成集群。
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_36">
     </a>
     <strong>
      心跳机制的综合作用
     </strong>
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        避免脑裂
       </strong>
       ：
      </p>
      <ul>
       <li>
        当网络分区（Network Partition）发生时，心跳机制确保只有多数节点存活的分区能继续运行。
       </li>
       <li>
        若节点无法通过
        <strong>
         网络心跳
        </strong>
        和
        <strong>
         磁盘心跳
        </strong>
        达成多数一致，异常节点会被驱逐。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        故障检测与恢复
       </strong>
       ：
      </p>
      <ul>
       <li>
        快速检测节点故障，触发服务迁移（如TAF）或资源重新分配。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        参数配置
       </strong>
       ：
      </p>
      <ul>
       <li>
        <code>
         misscount
        </code>
        ：网络心跳的最大容忍丢失时间（默认30秒）。
       </li>
       <li>
        <code>
         disktimeout
        </code>
        ：磁盘心跳的最大容忍超时时间（默认200秒）。
       </li>
       <li>
        可通过
        <code>
         crsctl
        </code>
        命令调整（需谨慎操作）。
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_51">
     </a>
     <strong>
      常见问题
     </strong>
    </h4>
    <h5>
     <a id="Q1_Voting_Disk_52">
     </a>
     <strong>
      Q1: 如果私有网络中断，但Voting Disk正常，会发生什么？
     </strong>
    </h5>
    <ul>
     <li>
      RAC依赖网络心跳和磁盘心跳共同工作。若私有网络中断：
      <ul>
       <li>
        若仅单节点失联，其他节点通过Voting Disk判定其故障并驱逐。
       </li>
       <li>
        若网络分区导致多个节点失联，只有拥有多数Voting Disk的分区可以存活。
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="Q2_Voting_Disk_57">
     </a>
     <strong>
      Q2: Voting Disk为什么需要奇数个？
     </strong>
    </h5>
    <ul>
     <li>
      奇数个Voting Disk（如3或5）确保集群在分区时能形成“多数派”（如3个中的2个），避免平局导致的集群分裂。
     </li>
    </ul>
    <h5>
     <a id="Q3_RAC_60">
     </a>
     <strong>
      Q3: 如何监控RAC心跳状态？
     </strong>
    </h5>
    <ul>
     <li>
      使用命令：
      <pre><code class="prism language-sql">crsctl <span class="token keyword">check</span> cluster       <span class="token comment">-- 检查集群状态</span>
crsctl query css votedisk  <span class="token comment">-- 查看Voting Disk状态</span>
oifcfg getif              <span class="token comment">-- 查看网络接口配置</span>
</code></pre>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_70">
     </a>
     <strong>
      总结
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       网络心跳
      </strong>
      （私有网络）、
      <strong>
       磁盘心跳
      </strong>
      （Voting Disk）、
      <strong>
       本地心跳
      </strong>
      （自检）共同保障RAC的高可用性。
     </li>
     <li>
      心跳机制是RAC防脑裂和故障恢复的核心，需结合冗余网络、共享存储和合理参数配置。
     </li>
     <li>
      理解心跳机制对诊断集群故障（如节点驱逐、网络分区）至关重要。
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f53746f72795f626567696e732f:61727469636c652f64657461696c732f313436313935353439" class_="artid" style="display:none">
 </p>
</div>


