---
layout: post
title: "AF3-squeeze_featureså‡½æ•°è§£è¯»"
date: 2025-03-09 15:38:56 +0800
description: "AlphaFold3Â Â data_transforms æ¨¡å—çš„Â squeeze_featuresÂ å‡½æ•°çš„ä½œç”¨å»é™¤Â è›‹ç™½è´¨ç‰¹å¾å¼ é‡ä¸­ä¸å¿…è¦çš„å•ç»´åº¦ï¼ˆsingleton dimensionsï¼‰å’Œé‡å¤ç»´åº¦ï¼Œä»¥ä½¿å…¶é€‚é…Â AlphaFold3Â é¢„æœŸçš„è¾“å…¥æ ¼å¼ã€‚"
keywords: "AF3 squeeze_featureså‡½æ•°è§£è¯»"
categories: ['æœªåˆ†ç±»']
tags: ['ç”Ÿç‰©ä¿¡æ¯å­¦', 'æ·±åº¦å­¦ä¹ ', 'äººå·¥æ™ºèƒ½', 'Pytorch']
artid: "146133191"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146133191
    alt: "AF3-squeeze_featureså‡½æ•°è§£è¯»"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146133191
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146133191
cover: https://bing.ee123.net/img/rand?artid=146133191
image: https://bing.ee123.net/img/rand?artid=146133191
img: https://bing.ee123.net/img/rand?artid=146133191
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     AF3 squeeze_featureså‡½æ•°è§£è¯»
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     AlphaFold3
     <code>
      data_transforms æ¨¡å—çš„
     </code>
     squeeze_featuresÂ å‡½æ•°çš„ä½œç”¨
     <strong>
      å»é™¤
     </strong>
     <strong>
      è›‹ç™½è´¨ç‰¹å¾å¼ é‡ä¸­ä¸å¿…è¦çš„å•ç»´åº¦ï¼ˆsingleton dimensionsï¼‰å’Œé‡å¤ç»´åº¦
     </strong>
     ï¼Œä»¥ä½¿å…¶é€‚é…
     <strong>
      AlphaFold3
     </strong>
     é¢„æœŸçš„è¾“å…¥æ ¼å¼ã€‚
    </p>
    <h4>
     æºä»£ç ï¼š
    </h4>
    <pre><code>def squeeze_features(protein):
    """Remove singleton and repeated dimensions in protein features."""
    protein["aatype"] = torch.argmax(protein["aatype"], dim=-1)
    for k in [
        "domain_name",
        "msa",
        "num_alignments",
        "seq_length",
        "sequence",
        "superfamily",
        "deletion_matrix",
        "resolution",
        "between_segment_residues",
        "residue_index",
        "template_all_atom_mask",
    ]:
        if k in protein:
            final_dim = protein[k].shape[-1]
            if isinstance(final_dim, int) and final_dim == 1:
                if torch.is_tensor(protein[k]):
                    protein[k] = torch.squeeze(protein[k], dim=-1)
                else:
                    protein[k] = np.squeeze(protein[k], axis=-1)

    for k in ["seq_length", "num_alignments"]:
        if k in protein:
            protein[k] = protein[k][0]

    return protein
</code></pre>
    <h4>
     æºç è§£è¯»ï¼š
    </h4>
    <ul>
     <li>
      è¯¥å‡½æ•°æ¥æ”¶
      <code>
       protein
      </code>
      ï¼ˆä¸€ä¸ª
      <strong>
       åŒ…å«è›‹ç™½è´¨ç‰¹å¾çš„å­—å…¸
      </strong>
      ï¼‰ä½œä¸ºè¾“å…¥ã€‚
     </li>
     <li>
      ä¸»è¦ä»»åŠ¡ï¼š
      <ol>
       <li>
        <strong>
         å°† one-hot
         <code>
          aatype
         </code>
         è½¬æ¢ä¸ºç´¢å¼•è¡¨ç¤º
        </strong>
        ã€‚
       </li>
       <li>
        <strong>
         ç§»é™¤ shape ä¸º
         <code>
          (N, ..., 1)
         </code>
         çš„å•ç»´åº¦
        </strong>
        ã€‚
       </li>
       <li>
        <strong>
         æå–
         <code>
          seq_length
         </code>
         å’Œ
         <code>
          num_alignments
         </code>
         çš„å®é™…æ•°å€¼
        </strong>
        ã€‚
       </li>
      </ol>
     </li>
    </ul>
    <h5>
     Step 1: å¤„ç†
     <code>
      aatype
     </code>
    </h5>
    <pre><code>protein["aatype"] = torch.argmax(protein["aatype"], dim=-1)
</code></pre>
    <ul>
     <li>
      <strong>
       è¾“å…¥
       <code>
        aatype
       </code>
       ï¼ˆæ°¨åŸºé…¸ç±»å‹ï¼‰é€šå¸¸æ˜¯ one-hot ç¼–ç 
      </strong>
     </li>
     <li>
      é€šè¿‡
      <code>
       torch.argmax(..., dim=-1)
      </code>
      è·å–
      <strong>
       ç´¢å¼•
      </strong>
     </li>
     <li>
      <strong>
       ç›®çš„
      </strong>
      ï¼šç®€åŒ–
      <code>
       aatype
      </code>
      çš„æ•°æ®è¡¨ç¤ºï¼Œä½¿å…¶ç›´æ¥å­˜å‚¨æ°¨åŸºé…¸ç´¢å¼•ï¼Œè€Œä¸æ˜¯ one-hot çŸ©é˜µã€‚
     </li>
    </ul>
    <h5>
     Step 2: ç§»é™¤å•ç»´åº¦
    </h5>
    <pre><code>for k in [
    "domain_name",
    "msa",
    "num_alignments",
    "seq_length",
    "sequence",
    "superfamily",
    "deletion_matrix",
    "resolution",
    "between_segment_residues",
    "residue_index",
    "template_all_atom_mask",
]:
    if k in protein:
        final_dim = protein[k].shape[-1]  # è·å–æœ€åä¸€ç»´çš„å¤§å°
        if isinstance(final_dim, int) and final_dim == 1:
            if torch.is_tensor(protein[k]):
                protein[k] = torch.squeeze(protein[k], dim=-1)  # å»æ‰å•ç»´åº¦
            else:
                protein[k] = np.squeeze(protein[k], axis=-1)
</code></pre>
    <ul>
     <li>
      <strong>
       éå†å¤šä¸ª
       <code>
        protein
       </code>
       ç‰¹å¾å­—æ®µ
      </strong>
      ï¼Œæ£€æŸ¥å®ƒä»¬æ˜¯å¦å­˜åœ¨ã€‚
     </li>
     <li>
      <strong>
       å¦‚æœæœ€åä¸€ç»´
       <code>
        final_dim
       </code>
       ä¸º
       <code>
        1
       </code>
      </strong>
      ï¼Œè¯´æ˜è¿™ä¸ªç»´åº¦æ˜¯
      <strong>
       æ— æ„ä¹‰çš„å•ç»´åº¦
      </strong>
      ï¼Œéœ€è¦å»é™¤ï¼š
      <ul>
       <li>
        å¦‚æœæ˜¯
        <strong>
         PyTorch å¼ é‡
        </strong>
        ï¼ˆ
        <code>
         torch.Tensor
        </code>
        ï¼‰ï¼Œä½¿ç”¨
        <code>
         torch.squeeze(dim=-1)
        </code>
        ã€‚
       </li>
       <li>
        å¦‚æœæ˜¯
        <strong>
         NumPy æ•°ç»„
        </strong>
        ï¼Œä½¿ç”¨
        <code>
         np.squeeze(axis=-1)
        </code>
        ã€‚
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     Step 3: å¤„ç†
     <code>
      seq_length
     </code>
     å’Œ
     <code>
      num_alignments
     </code>
    </h5>
    <pre><code>for k in ["seq_length", "num_alignments"]:
    if k in protein:
        protein[k] = protein[k][0]
</code></pre>
    <p>
     <code>
      seq_length
     </code>
     å’Œ
     <code>
      num_alignments
     </code>
     å¯èƒ½æ˜¯
     <strong>
      åˆ—è¡¨æˆ–å¼ é‡
     </strong>
     ï¼Œä½†å®ƒä»¬çš„æ•°å€¼å…¶å®æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ•´æ•°ï¼Œå› æ­¤éœ€è¦è½¬æ¢æˆ
     <strong>
      æ ‡é‡å€¼
     </strong>
     ã€‚
    </p>
    <h5>
     <strong>
      ç»“è®º
     </strong>
    </h5>
    <p>
     1ï¸âƒ£
     <strong>
      è½¬æ¢
      <code>
       aatype
      </code>
     </strong>
     : ä»
     <strong>
      one-hot ç¼–ç 
     </strong>
     è½¬æ¢æˆ
     <strong>
      ç´¢å¼•è¡¨ç¤º
     </strong>
     ã€‚
     <br/>
     2ï¸âƒ£
     <strong>
      ç§»é™¤æ— ç”¨çš„å•ç»´åº¦
     </strong>
     : è®©
     <code>
      msa
     </code>
     ,
     <code>
      resolution
     </code>
     ,
     <code>
      deletion_matrix
     </code>
     ç­‰æ•°æ®ç¬¦åˆ AlphaFold3 é¢„æœŸæ ¼å¼ã€‚
     <br/>
     3ï¸âƒ£
     <strong>
      è½¬æ¢
      <code>
       seq_length
      </code>
      å’Œ
      <code>
       num_alignments
      </code>
      ä¸ºæ ‡é‡
     </strong>
     : ç¡®ä¿å®ƒä»¬ä¸ä¼šä»¥å¼ é‡å½¢å¼å­˜åœ¨ï¼Œè€Œæ˜¯æ•´æ•°ã€‚
    </p>
    <p>
     ğŸ’¡
     <strong>
      æœ€ç»ˆä½œç”¨ï¼šä¿è¯è¾“å…¥æ•°æ®çš„ç»´åº¦ç¬¦åˆ AlphaFold3 è®­ç»ƒæ—¶çš„è¾“å…¥è¦æ±‚ï¼Œæé«˜æ•°æ®å¤„ç†æ•ˆç‡ã€‚
     </strong>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f32373339303032332f:61727469636c652f64657461696c732f313436313333313931" class_="artid" style="display:none">
 </p>
</div>


