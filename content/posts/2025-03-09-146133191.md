---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f32373339303032332f:61727469636c652f64657461696c732f313436313333313931"
layout: post
title: "AF3-squeeze_featureså‡½æ•°è§£è¯»"
date: 2025-03-09 15:38:56 +0800
description: "AlphaFold3Â Â data_transforms æ¨¡å—çš„Â squeeze_featuresÂ å‡½æ•°çš„ä½œç”¨å»é™¤Â è›‹ç™½è´¨ç‰¹å¾å¼ é‡ä¸­ä¸å¿…è¦çš„å•ç»´åº¦ï¼ˆsingleton dimensionsï¼‰å’Œé‡å¤ç»´åº¦ï¼Œä»¥ä½¿å…¶é€‚é…Â AlphaFold3Â é¢„æœŸçš„è¾“å…¥æ ¼å¼ã€‚"
keywords: "AF3 squeeze_featureså‡½æ•°è§£è¯»"
categories: ['æœªåˆ†ç±»']
tags: ['ç”Ÿç‰©ä¿¡æ¯å­¦', 'æ·±åº¦å­¦ä¹ ', 'äººå·¥æ™ºèƒ½', 'Pytorch']
artid: "146133191"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146133191
    alt: "AF3-squeeze_featureså‡½æ•°è§£è¯»"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146133191
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146133191
cover: https://bing.ee123.net/img/rand?artid=146133191
image: https://bing.ee123.net/img/rand?artid=146133191
img: https://bing.ee123.net/img/rand?artid=146133191
---

# AF3 squeeze\_featureså‡½æ•°è§£è¯»

AlphaFold3
`data_transforms æ¨¡å—çš„`
squeeze\_featuresÂ å‡½æ•°çš„ä½œç”¨
**å»é™¤**
**è›‹ç™½è´¨ç‰¹å¾å¼ é‡ä¸­ä¸å¿…è¦çš„å•ç»´åº¦ï¼ˆsingleton dimensionsï¼‰å’Œé‡å¤ç»´åº¦**
ï¼Œä»¥ä½¿å…¶é€‚é…
**AlphaFold3**
é¢„æœŸçš„è¾“å…¥æ ¼å¼ã€‚

#### æºä»£ç ï¼š

```
def squeeze_features(protein):
    """Remove singleton and repeated dimensions in protein features."""
    protein["aatype"] = torch.argmax(protein["aatype"], dim=-1)
    for k in [
        "domain_name",
        "msa",
        "num_alignments",
        "seq_length",
        "sequence",
        "superfamily",
        "deletion_matrix",
        "resolution",
        "between_segment_residues",
        "residue_index",
        "template_all_atom_mask",
    ]:
        if k in protein:
            final_dim = protein[k].shape[-1]
            if isinstance(final_dim, int) and final_dim == 1:
                if torch.is_tensor(protein[k]):
                    protein[k] = torch.squeeze(protein[k], dim=-1)
                else:
                    protein[k] = np.squeeze(protein[k], axis=-1)

    for k in ["seq_length", "num_alignments"]:
        if k in protein:
            protein[k] = protein[k][0]

    return protein

```

#### æºç è§£è¯»ï¼š

* è¯¥å‡½æ•°æ¥æ”¶
  `protein`
  ï¼ˆä¸€ä¸ª
  **åŒ…å«è›‹ç™½è´¨ç‰¹å¾çš„å­—å…¸**
  ï¼‰ä½œä¸ºè¾“å…¥ã€‚
* ä¸»è¦ä»»åŠ¡ï¼š
  1. **å°† one-hot
     `aatype`
     è½¬æ¢ä¸ºç´¢å¼•è¡¨ç¤º**
     ã€‚
  2. **ç§»é™¤ shape ä¸º
     `(N, ..., 1)`
     çš„å•ç»´åº¦**
     ã€‚
  3. **æå–
     `seq_length`
     å’Œ
     `num_alignments`
     çš„å®é™…æ•°å€¼**
     ã€‚

##### Step 1: å¤„ç† `aatype`

```
protein["aatype"] = torch.argmax(protein["aatype"], dim=-1)

```

* **è¾“å…¥
  `aatype`
  ï¼ˆæ°¨åŸºé…¸ç±»å‹ï¼‰é€šå¸¸æ˜¯ one-hot ç¼–ç **
* é€šè¿‡
  `torch.argmax(..., dim=-1)`
  è·å–
  **ç´¢å¼•**
* **ç›®çš„**
  ï¼šç®€åŒ–
  `aatype`
  çš„æ•°æ®è¡¨ç¤ºï¼Œä½¿å…¶ç›´æ¥å­˜å‚¨æ°¨åŸºé…¸ç´¢å¼•ï¼Œè€Œä¸æ˜¯ one-hot çŸ©é˜µã€‚

##### Step 2: ç§»é™¤å•ç»´åº¦

```
for k in [
    "domain_name",
    "msa",
    "num_alignments",
    "seq_length",
    "sequence",
    "superfamily",
    "deletion_matrix",
    "resolution",
    "between_segment_residues",
    "residue_index",
    "template_all_atom_mask",
]:
    if k in protein:
        final_dim = protein[k].shape[-1]  # è·å–æœ€åä¸€ç»´çš„å¤§å°
        if isinstance(final_dim, int) and final_dim == 1:
            if torch.is_tensor(protein[k]):
                protein[k] = torch.squeeze(protein[k], dim=-1)  # å»æ‰å•ç»´åº¦
            else:
                protein[k] = np.squeeze(protein[k], axis=-1)

```

* **éå†å¤šä¸ª
  `protein`
  ç‰¹å¾å­—æ®µ**
  ï¼Œæ£€æŸ¥å®ƒä»¬æ˜¯å¦å­˜åœ¨ã€‚
* **å¦‚æœæœ€åä¸€ç»´
  `final_dim`
  ä¸º
  `1`**
  ï¼Œè¯´æ˜è¿™ä¸ªç»´åº¦æ˜¯
  **æ— æ„ä¹‰çš„å•ç»´åº¦**
  ï¼Œéœ€è¦å»é™¤ï¼š
  + å¦‚æœæ˜¯
    **PyTorch å¼ é‡**
    ï¼ˆ
    `torch.Tensor`
    ï¼‰ï¼Œä½¿ç”¨
    `torch.squeeze(dim=-1)`
    ã€‚
  + å¦‚æœæ˜¯
    **NumPy æ•°ç»„**
    ï¼Œä½¿ç”¨
    `np.squeeze(axis=-1)`
    ã€‚

##### Step 3: å¤„ç† `seq_length` å’Œ `num_alignments`

```
for k in ["seq_length", "num_alignments"]:
    if k in protein:
        protein[k] = protein[k][0]

```

`seq_length`
å’Œ
`num_alignments`
å¯èƒ½æ˜¯
**åˆ—è¡¨æˆ–å¼ é‡**
ï¼Œä½†å®ƒä»¬çš„æ•°å€¼å…¶å®æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ•´æ•°ï¼Œå› æ­¤éœ€è¦è½¬æ¢æˆ
**æ ‡é‡å€¼**
ã€‚

##### **ç»“è®º**

1ï¸âƒ£
**è½¬æ¢
`aatype`**
: ä»
**one-hot ç¼–ç **
è½¬æ¢æˆ
**ç´¢å¼•è¡¨ç¤º**
ã€‚
  
2ï¸âƒ£
**ç§»é™¤æ— ç”¨çš„å•ç»´åº¦**
: è®©
`msa`
,
`resolution`
,
`deletion_matrix`
ç­‰æ•°æ®ç¬¦åˆ AlphaFold3 é¢„æœŸæ ¼å¼ã€‚
  
3ï¸âƒ£
**è½¬æ¢
`seq_length`
å’Œ
`num_alignments`
ä¸ºæ ‡é‡**
: ç¡®ä¿å®ƒä»¬ä¸ä¼šä»¥å¼ é‡å½¢å¼å­˜åœ¨ï¼Œè€Œæ˜¯æ•´æ•°ã€‚

ğŸ’¡
**æœ€ç»ˆä½œç”¨ï¼šä¿è¯è¾“å…¥æ•°æ®çš„ç»´åº¦ç¬¦åˆ AlphaFold3 è®­ç»ƒæ—¶çš„è¾“å…¥è¦æ±‚ï¼Œæé«˜æ•°æ®å¤„ç†æ•ˆç‡ã€‚**