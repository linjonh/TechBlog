---
layout: post
title: "用TypeScript和library-needle来创建视频爬虫程序"
date: 2025-03-12 15:42:55 +0800
description: "使用 TypeScript 和 needle 库创建视频爬虫程序的过程可以按照以下步骤进行。needle 是一个轻量级的 HTTP 请求库，适用于进行网络请求。"
keywords: "用TypeScript和library needle来创建视频爬虫程序"
categories: ['未分类']
tags: ['爬虫', 'Typescript', 'Javascript']
artid: "146206939"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146206939
    alt: "用TypeScript和library-needle来创建视频爬虫程序"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146206939
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146206939
cover: https://bing.ee123.net/img/rand?artid=146206939
image: https://bing.ee123.net/img/rand?artid=146206939
img: https://bing.ee123.net/img/rand?artid=146206939
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     用TypeScript和library needle来创建视频爬虫程序
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     使用 TypeScript 和
     <code>
      needle
     </code>
     库创建视频爬虫程序的过程可以按照以下步骤进行。
     <code>
      needle
     </code>
     是一个轻量级的 HTTP 请求库，适用于进行网络请求。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/dfc1d3e4d4df49c096ae8cf26b70719f.png#pic_center"/>
    </p>
    <h4>
     <a id="_5">
     </a>
     步骤：
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        安装依赖
       </strong>
       ：
       <br/>
       你需要安装
       <code>
        needle
       </code>
       来发送 HTTP 请求，以及一些额外的库来帮助处理 HTML 数据（比如
       <code>
        cheerio
       </code>
       用于解析 HTML）。
      </p>
      <p>
       执行以下命令来安装依赖：
      </p>
      <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> needle cheerio
<span class="token function">npm</span> <span class="token function">install</span> --save-dev typescript @types/node
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        设置 TypeScript 配置
       </strong>
       ：
       <br/>
       在项目根目录下创建一个
       <code>
        tsconfig.json
       </code>
       文件：
      </p>
      <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"target"</span><span class="token operator">:</span> <span class="token string">"ES6"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"module"</span><span class="token operator">:</span> <span class="token string">"commonjs"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"skipLibCheck"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"forceConsistentCasingInFileNames"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        创建 TypeScript 文件
       </strong>
       ：
       <br/>
       创建一个 TypeScript 文件
       <code>
        videoScraper.ts
       </code>
       ，并编写代码。
      </p>
     </li>
    </ol>
    <h4>
     <a id="_36">
     </a>
     代码示例：
    </h4>
    <pre><code class="prism language-typescript"><span class="token keyword">import</span> needle <span class="token keyword">from</span> <span class="token string">'needle'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> cheerio <span class="token keyword">from</span> <span class="token string">'cheerio'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>

<span class="token comment">// 下载视频函数</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">downloadVideo</span><span class="token punctuation">(</span>videoUrl<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> filename<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">开始下载视频: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>videoUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">needle</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span> videoUrl<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> response_type<span class="token operator">:</span> <span class="token string">'buffer'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> videoData <span class="token operator">=</span> response<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
  
  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'downloads'</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">,</span> videoData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">视频已下载并保存为: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 抓取网页并提取视频链接</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">crawlAndDownloadVideos</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 请求网页内容</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">needle</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> html <span class="token operator">=</span> response<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
    
    <span class="token comment">// 使用 cheerio 解析 HTML 内容</span>
    <span class="token keyword">const</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 提取所有的视频链接，这里假设视频链接存放在 &lt;video&gt; 标签的 src 属性中</span>
    <span class="token keyword">const</span> videoUrls<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> element<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> videoUrl <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>videoUrl<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理相对路径的视频 URL</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>videoUrl<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">const</span> absoluteUrl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span>videoUrl<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">.</span>href<span class="token punctuation">;</span>
          videoUrls<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>absoluteUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
          videoUrls<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>videoUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建下载文件夹（如果没有的话）</span>
    <span class="token keyword">const</span> downloadDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'downloads'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>downloadDir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>downloadDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 下载所有视频</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> videoUrls<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> videoUrl <span class="token operator">=</span> videoUrls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> filename <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">video_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.mp4</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// 设置视频文件名</span>
      <span class="token keyword">await</span> <span class="token function">downloadVideo</span><span class="token punctuation">(</span>videoUrl<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'抓取过程中发生错误:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 主函数</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://example.com'</span><span class="token punctuation">;</span>  <span class="token comment">// 替换为你想抓取的网页</span>
<span class="token function">crawlAndDownloadVideos</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="_102">
     </a>
     代码说明：
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        <code>
         downloadVideo
        </code>
        函数
       </strong>
       ：
      </p>
      <ul>
       <li>
        此函数负责下载视频。它通过
        <code>
         needle
        </code>
        发送 GET 请求，并将响应数据（视频流）保存到本地文件系统。
       </li>
       <li>
        通过
        <code>
         needle('get', videoUrl, { response_type: 'buffer' })
        </code>
        获取视频流数据，然后使用
        <code>
         fs.writeFileSync
        </code>
        将其保存到本地文件系统。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        <code>
         crawlAndDownloadVideos
        </code>
        函数
       </strong>
       ：
      </p>
      <ul>
       <li>
        此函数发送请求以获取网页的 HTML 内容，并使用
        <code>
         cheerio
        </code>
        解析它。
       </li>
       <li>
        它从
        <code>
         &lt;video&gt;
        </code>
        标签中提取
        <code>
         src
        </code>
        属性，即视频文件的 URL。然后处理每个视频 URL，确保它是一个绝对路径，最后将其添加到
        <code>
         videoUrls
        </code>
        数组。
       </li>
       <li>
        对于每个视频链接，调用
        <code>
         downloadVideo
        </code>
        函数进行下载。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        <code>
         cheerio
        </code>
       </strong>
       ：
      </p>
      <ul>
       <li>
        <code>
         cheerio
        </code>
        用于解析网页并提取
        <code>
         &lt;video&gt;
        </code>
        标签的
        <code>
         src
        </code>
        属性。我们假设视频 URL 位于
        <code>
         &lt;video&gt;
        </code>
        标签中的
        <code>
         src
        </code>
        属性，如果网站的结构不同，你可能需要根据实际情况调整选择器。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        处理相对路径的 URL
       </strong>
       ：
      </p>
      <ul>
       <li>
        如果视频链接是相对路径，我们通过
        <code>
         new URL(videoUrl, url)
        </code>
        转换为绝对路径。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        视频保存
       </strong>
       ：
      </p>
      <ul>
       <li>
        视频被下载并保存到当前目录下的
        <code>
         downloads
        </code>
        文件夹。
       </li>
      </ul>
     </li>
    </ol>
    <h4>
     <a id="_122">
     </a>
     执行程序
    </h4>
    <ol>
     <li>
      <p>
       将上述代码保存为
       <code>
        videoScraper.ts
       </code>
       。
      </p>
     </li>
     <li>
      <p>
       通过 TypeScript 编译器将其编译为 JavaScript：
      </p>
      <pre><code class="prism language-bash">tsc videoScraper.ts
</code></pre>
     </li>
     <li>
      <p>
       运行编译后的 JavaScript 文件：
      </p>
      <pre><code class="prism language-bash"><span class="token function">node</span> videoScraper.js
</code></pre>
     </li>
    </ol>
    <h4>
     <a id="_137">
     </a>
     总结
    </h4>
    <p>
     这个爬虫程序会抓取指定网页中的视频资源，并将视频下载到本地。在本例中，视频链接被假设为存在于
     <code>
      &lt;video&gt;
     </code>
     标签的
     <code>
      src
     </code>
     属性中。你可以根据实际的网页结构调整
     <code>
      cheerio
     </code>
     选择器。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34343631373635312f:61727469636c652f64657461696c732f313436323036393339" class_="artid" style="display:none">
 </p>
</div>


