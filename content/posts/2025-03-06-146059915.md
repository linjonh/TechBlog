---
layout: post
title: "uniApp实战二仿今日相机水印功能"
date: 2025-03-06 09:49:43 +0800
description: "uniApp实战二：仿今日相机水印功能。"
keywords: "uniApp实战二：仿今日相机水印功能"
categories: ['Uniapp']
tags: ['数码相机', 'Javascript', 'App']
artid: "146059915"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146059915
    alt: "uniApp实战二仿今日相机水印功能"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146059915
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146059915
cover: https://bing.ee123.net/img/rand?artid=146059915
image: https://bing.ee123.net/img/rand?artid=146059915
img: https://bing.ee123.net/img/rand?artid=146059915
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     uniApp实战二：仿今日相机水印功能
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-github-gist" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="1_1">
     </a>
     1.最终效果预览
    </h2>
    <p>
     <img alt="image" src="https://i-blog.csdnimg.cn/img_convert/77ab30bfb0383d0dca73c2a675765983.png"/>
    </p>
    <h2>
     <a id="2_7">
     </a>
     2.页面实现
    </h2>
    <p>
     页面布局
    </p>
    <pre><code>&lt;view @click="handleTakePhotoNew"&gt;拍照&lt;/view&gt;
			&lt;view v-if="!snapSrc"&gt;
				&lt;canvas canvas-id="canvas" :style="{'width':cvWidth+'px','height':cvHeight+'px'}"&gt;
				&lt;/canvas&gt;
			&lt;/view&gt;
			&lt;view v-else&gt;
				&lt;image :style="{'width':cvWidth+'px','height':cvHeight+'px'}" mode="aspectFit" :src="snapSrc"&gt;
				&lt;/image&gt;
			&lt;/view&gt;
</code></pre>
    <p>
     data定义
    </p>
    <pre><code>data() {
			return {
				snapSrc: "",
				cvHeight: "",
				cvWidth: "",
				tKey: "时 间:",
				addKey: "地 点:",
			};
		},
</code></pre>
    <p>
     点击事件及方法
    </p>
    <pre><code>handleTakePhotoNew() {
				this.snapSrc = ""
				uni.chooseImage({
					count: 1,
					success: (res) =&gt; {
						const imgPath = res.tempFilePaths[0]
						this.getWaterImageNew(imgPath)
					}
				});

			},


			async getWaterImageNew(imgPath) {
				const {
					width,
					height
				} = await this.getImageSizeByUrl(imgPath);
				this.cvWidth = width
				this.cvHeight = height
				if (this.cvWidth &gt; 350) {
					let rad = this.cvWidth / 350
					this.cvWidth = this.cvWidth / rad
					this.cvHeight = this.cvHeight / rad
				}

				const obj = {
					url: imgPath,
					title: '日常巡检',
					time: '2025-03-03 22:22',
					address: "详细地址信息XXX",
					width: this.cvWidth,
					height: this.cvHeight
				}
				this.snapSrc = await this.imageAddWatermarksNew(obj)
			},


			async imageAddWatermarksNew(obj) {
				try {
					const waterUrl = await this.imgToCanvasNew(obj);
					return waterUrl
				} catch (error) {
					console.error(error);
				}
			},

			getImageSizeByUrl(url) {
				return new Promise((resolve, reject) =&gt; {
					uni.getImageInfo({
						src: url,
						success: function(res) {
							resolve({
								width: res.width,
								height: res.height,
							});
						},
						fail: function(err) {
							reject(new Error("getImageSizeByUrl load fail"));
						}
					})
				})
			},


			imgToCanvasNew(obj) {
				return new Promise((resolve, reject) =&gt; {
					const cWidth = obj.width &gt; 250 ? 200 : obj.width
					const cHeight = obj.width &gt; 250 ? 100 : obj.height
					const sNum = 5
					const fbottom = obj.height - sNum * 6;
					const halfH = sNum * 4;
					const ctx = uni.createCanvasContext("canvas");
					ctx.clearRect(0, 0, obj.width, obj.height);
					ctx.drawImage(obj.url, 0, 0, obj.width, obj.height);
					const grd = ctx.createLinearGradient(0, 0, cWidth, 0);
					grd.addColorStop(0, "#4169E1");
					grd.addColorStop(1, "#87CEFA");
					ctx.fillStyle = grd;
					ctx.fillRect(sNum * 2, fbottom - halfH * 4, cWidth, halfH * 2);
					ctx.font = "italic normal bold 25px arial";
					ctx.setFillStyle("#FFFFFF");
					ctx.setTextAlign('center')
					ctx.fillText(obj.title, cWidth / 2+sNum*2, fbottom - halfH * 2 - sNum * 2);
					ctx.fillStyle = "rgba(245,245,245,0.5)";
					ctx.fillRect(sNum * 2, fbottom - halfH * 2, cWidth, halfH * 2 + sNum);
					ctx.setTextAlign('start')
					ctx.setFontSize(sNum * 3);
					ctx.setFillStyle("#000000");
					ctx.fillText(this.tKey + obj.time, sNum * 3, fbottom - halfH);
					ctx.fillText(this.addKey + obj.address, sNum * 3, fbottom);
					setTimeout(() =&gt; {
						ctx.draw(false, async () =&gt; {
							uni.canvasToTempFilePath({
									canvasId: "canvas",
									fileType: "jpg",
									success: (res) =&gt; {
										resolve(res.tempFilePath)
									},
									fail: (err) =&gt; {
										reject(err);
									},
								},
								true
							);
						});
					}, 1000)
				});
			},
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f31363439373631372f:61727469636c652f64657461696c732f313436303539393135" class_="artid" style="display:none">
 </p>
</div>


