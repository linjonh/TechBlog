---
layout: post
title: "前端实现图片压缩干货总结"
date: 2025-01-09 15:50:53 +0800
description: "前文提要1. 使用HTML5的``元素2. 利用第三方库(推荐)3. gif图片压缩(拓展)注意事项"
keywords: "前端图片压缩"
categories: ['技术分享']
tags: ['面试', '图像处理', '前端', '人工智能']
artid: "141830105"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=141830105
    alt: "前端实现图片压缩干货总结"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=141830105
featuredImagePreview: https://bing.ee123.net/img/rand?artid=141830105
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     前端实现图片压缩(干货总结)
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      前端实现图片压缩方案总结
     </h4>
     <ul>
      <li>
       <ul>
        <li>
         <ul>
          <li>
           <a href="#_10" rel="nofollow">
            前文提要
           </a>
          </li>
          <li>
           <a href="#1_HTML5canvas_14" rel="nofollow">
            1. 使用HTML5的`&lt;canvas&gt;`元素
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#_18" rel="nofollow">
              步骤概述：
             </a>
            </li>
            <li>
             <a href="#_24" rel="nofollow">
              示例代码：
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#2__78" rel="nofollow">
            2. 利用第三方库(推荐)
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#_imagemagicadapter_89" rel="nofollow">
              使用 image-magic-adapter示例：
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#3_gif_165" rel="nofollow">
            3. gif图片压缩(拓展)
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#nodegif_179" rel="nofollow">
              node压缩gif实现如下:
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#_280" rel="nofollow">
            注意事项
           </a>
          </li>
         </ul>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <hr/>
    <p>
     ⚠️⚠️文前推荐一下👉
     <br/>
     <strong>
      前端必备工具推荐网站(图床、API和ChatAI、智能AI简历、AI思维导图神器等实用工具):
     </strong>
     <br/>
     站点入口：
     <a href="http://luckycola.com.cn/" rel="nofollow">
      http://luckycola.com.cn/
     </a>
    </p>
    <hr/>
    <h4>
     <a id="_10">
     </a>
     前文提要
    </h4>
    <p>
     在Web开发中，图片压缩是一个常见且重要的需求。随着高清图片和多媒体内容的普及，如何在保证图片质量的同时减少其文件大小，对于提升网页加载速度、优化用户体验至关重要。前端作为用户与服务器之间的桥梁，实现图片压缩的功能可以显著减轻服务器的负担，加快页面渲染速度。本文将探讨前端实现图片压缩的几种方法和技术。
    </p>
    <h4>
     <a id="1_HTML5canvas_14">
     </a>
     1. 使用HTML5的
     <code>
      &lt;canvas&gt;
     </code>
     元素
    </h4>
    <p>
     HTML5的
     <code>
      &lt;canvas&gt;
     </code>
     元素为前端图片处理提供了强大的能力。通过JavaScript操作
     <code>
      &lt;canvas&gt;
     </code>
     ，我们可以读取图片数据，对其进行处理（如缩放、裁剪、转换格式等），然后输出压缩后的图片。
    </p>
    <h5>
     <a id="_18">
     </a>
     步骤概述：
    </h5>
    <ol>
     <li>
      <strong>
       读取图片
      </strong>
      ：使用
      <code>
       FileReader
      </code>
      或
      <code>
       Image
      </code>
      对象加载图片。
     </li>
     <li>
      <strong>
       绘制到
       <code>
        &lt;canvas&gt;
       </code>
      </strong>
      ：将图片绘制到
      <code>
       &lt;canvas&gt;
      </code>
      上，通过调整
      <code>
       &lt;canvas&gt;
      </code>
      的尺寸或绘图参数来控制压缩效果。
     </li>
     <li>
      <strong>
       导出图片
      </strong>
      ：使用
      <code>
       canvas.toDataURL()
      </code>
      方法将
      <code>
       &lt;canvas&gt;
      </code>
      内容转换为Base64编码的图片，或使用
      <code>
       canvas.toBlob()
      </code>
      方法获取Blob对象，以便进一步处理或上传。
     </li>
    </ol>
    <h5>
     <a id="_24">
     </a>
     示例代码：
    </h5>
    <pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">compressImage</span><span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> quality<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 设置canvas的尺寸，这里可以根据需要调整</span>
            <span class="token keyword">const</span> <span class="token constant">MAX_WIDTH</span> <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> <span class="token constant">MAX_HEIGHT</span> <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> width <span class="token operator">=</span> img<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
            <span class="token keyword">let</span> height <span class="token operator">=</span> img<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>width <span class="token operator">&gt;</span> height<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>width <span class="token operator">&gt;</span> <span class="token constant">MAX_WIDTH</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    height <span class="token operator">*=</span> <span class="token constant">MAX_WIDTH</span> <span class="token operator">/</span> width<span class="token punctuation">;</span>
                    width <span class="token operator">=</span> <span class="token constant">MAX_WIDTH</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>height <span class="token operator">&gt;</span> <span class="token constant">MAX_HEIGHT</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    width <span class="token operator">*=</span> <span class="token constant">MAX_HEIGHT</span> <span class="token operator">/</span> height<span class="token punctuation">;</span>
                    height <span class="token operator">=</span> <span class="token constant">MAX_HEIGHT</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> width<span class="token punctuation">;</span>
            canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> height<span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 转换为压缩后的图片</span>
            canvas<span class="token punctuation">.</span><span class="token function">toBlob</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">blob</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">callback</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'image/jpeg'</span><span class="token punctuation">,</span> quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        img<span class="token punctuation">.</span>src <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> fileInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input[type="file"]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileInput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> file <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">compressImage</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">blob</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理压缩后的图片，如上传或显示</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="2__78">
     </a>
     2. 利用第三方库(推荐)
    </h4>
    <p>
     除了原生JavaScript和HTML5外，还有许多优秀的第三方库可以帮助我们更方便地实现图片压缩，如
     <code>
      image-magic-adapter、compressorjs
     </code>
     、
     <code>
      pica
     </code>
     等。这些库通常提供了更丰富的配置选项和更好的兼容性支持。
    </p>
    <p>
     <strong>
      特别推荐的库
     </strong>
     : image-magic-adapter
     <br/>
     这个三方库是国内开发者提供的,他集成许多图片处理能力,包括“图片压缩”、“图片格式转换”、“图片加水印”等等,非常方便,而且这个库还有官网也可以直接使用这些功能.
    </p>
    <p>
     <strong>
      库官网
     </strong>
     :
     <a href="https://www.npmjs.com/package/image-magic-adapter" rel="nofollow">
      https://www.npmjs.com/package/image-magic-adapter
     </a>
    </p>
    <p>
     <strong>
      在线图片处理工具官网
     </strong>
     :
     <a href="https://luckycola.com.cn/public/dist/imageTool.html" rel="nofollow">
      https://luckycola.com.cn/public/dist/imageTool.html
     </a>
    </p>
    <h5>
     <a id="_imagemagicadapter_89">
     </a>
     使用 image-magic-adapter示例：
    </h5>
    <pre><code class="prism language-javascript"><span class="token comment">// 引入image-magic-adapter</span>
<span class="token keyword">import</span> ImageMagicAdapter <span class="token keyword">from</span> <span class="token string">'image-magic-adapter'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> ImageCompressorCls <span class="token operator">=</span> ImageMagicAdapter<span class="token punctuation">.</span>ImageCompressorCls<span class="token punctuation">;</span>

<span class="token keyword">const</span> imageCompressor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImageCompressorCls</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 默认压缩质量</span>

 <span class="token comment">// -----------------------------------------图片压缩-----------------------------------------</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'quality'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> quality <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'quality'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            imageCompressor<span class="token punctuation">.</span>quality <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> quality<span class="token punctuation">;</span> <span class="token comment">// 更新压缩质量</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'更新后的压缩质量:'</span><span class="token punctuation">,</span> imageCompressor<span class="token punctuation">.</span>quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'compress'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> fileInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fileInput<span class="token punctuation">.</span>files<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'请上传图片'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">const</span> files <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>fileInput<span class="token punctuation">.</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> progress <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'progress'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> outputContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'outputContainer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> downloadButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'download'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> progressText <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'progressText'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            outputContainer<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
            downloadButton<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
            progress<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>
            progress<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            progressText<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
            <span class="token comment">// compressImages参数说明：</span>
            <span class="token comment">//  第一个参数: files：需要压缩的文件数组</span>
            <span class="token comment">//  第二个参数: callback：压缩完成后的回调函数</span>
            <span class="token comment">//  第三个参数: 若是压缩png/bmp格式，输出是否保留png/bmp格式，默认为true(建议设置为false)</span>
            <span class="token comment">// 注意:如果 第三个参数设置true压缩png/bmp格式后的输出的文件为原格式(png/bmp)且压缩效果不佳，就需要依赖设置scaleFactor来调整压缩比例(0-1);如果设置为false，输出为image/jpeg格式且压缩效果更好。</span>
            <span class="token comment">// 设置caleFactor为0-1，值越大，压缩比例越小，值越小，压缩比例越大(本质是改变图片的尺寸),例: imageCompressor.scaleFactor = 0.5;</span>
            <span class="token keyword">await</span> imageCompressor<span class="token punctuation">.</span><span class="token function">compressImages</span><span class="token punctuation">(</span>files<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">completed<span class="token punctuation">,</span> total</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">const</span> outputImg <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                outputImg<span class="token punctuation">.</span>src <span class="token operator">=</span> imageCompressor<span class="token punctuation">.</span>compressedImages<span class="token punctuation">[</span>completed <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                outputContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>outputImg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                progress<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">(</span>completed <span class="token operator">/</span> total<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
                progressText<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">已完成文件数: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>completed<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> / 总文件数: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>total<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>completed <span class="token operator">===</span> total<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    downloadButton<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'inline-block'</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            downloadButton<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>imageCompressor<span class="token punctuation">.</span>compressedImages<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    imageCompressor<span class="token punctuation">.</span><span class="token function">downloadZip</span><span class="token punctuation">(</span>imageCompressor<span class="token punctuation">.</span>compressedImages<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span>图片压缩Demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload<span class="token punctuation">"</span></span> <span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image/*<span class="token punctuation">"</span></span> <span class="token attr-name">multiple</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>quality<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>压缩比率：（比率越大压缩越大，图片质量越低）<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>quality<span class="token punctuation">"</span></span> <span class="token attr-name">min</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.9<span class="token punctuation">"</span></span> <span class="token attr-name">step</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.1<span class="token punctuation">"</span></span> <span class="token attr-name">required</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.5<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>compress<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>压缩图片<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>progress</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progress<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>progress</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progressText<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>outputContainer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>download<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>下载已压缩图片<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h4>
     <a id="3_gif_165">
     </a>
     3. gif图片压缩(拓展)
    </h4>
    <p>
     GIF（Graphics Interchange Format）图片是一种广泛使用的图像文件格式，特别适合用于显示索引颜色图像（如简单的图形、图标和某些类型的图片），同时也支持动画。尽管GIF图片本身可以具有压缩特性，但在前端和后端进行压缩处理时，存在几个关键考虑因素，这些因素可能导致在前端直接压缩GIF不如在后端处理更为有效或合理。
    </p>
    <p>
     <em>
      下面提供一个厚后端通过node实现gif压缩的方案:
     </em>
     <br/>
     1、下载imagemin、imagemin-gifsicle和image-size库
     <br/>
     2、注意依赖的库的版本,不然可能会报错
    </p>
    <pre><code class="prism language-json">	<span class="token string-property property">"image-size"</span><span class="token operator">:</span> <span class="token string">"^1.1.1"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"imagemin"</span><span class="token operator">:</span> <span class="token string">"7.0.1"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"imagemin-gifsicle"</span><span class="token operator">:</span> <span class="token string">"^7.0.0"</span><span class="token punctuation">,</span>
</code></pre>
    <h5>
     <a id="nodegif_179">
     </a>
     node压缩gif实现如下:
    </h5>
    <pre><code class="prism language-js">
<span class="token keyword">const</span> imagemin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'imagemin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> imageminGifsicle <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'imagemin-gifsicle'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sizeOf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'image-size'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 压缩 GIF colors[0-256]</span>
<span class="token keyword">const</span> <span class="token function-variable function">compressGifImgFn</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>inputBase64<span class="token punctuation">,</span> colors <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token function-variable function">successFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function-variable function">failFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>inputBase64<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            failFn <span class="token operator">&amp;&amp;</span> <span class="token function">failFn</span><span class="token punctuation">(</span><span class="token string">'inputBase64 无效'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// 获取输入 GIF 的尺寸</span>
        <span class="token keyword">const</span> originalSize <span class="token operator">=</span> <span class="token function">getBase64Size</span><span class="token punctuation">(</span>inputBase64<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Original Size:'</span><span class="token punctuation">,</span> originalSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 转换 Base64 为 Buffer</span>
        <span class="token keyword">const</span> inputBuffer <span class="token operator">=</span> <span class="token function">base64ToBuffer</span><span class="token punctuation">(</span>inputBase64<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> outputBuffer <span class="token operator">=</span> <span class="token keyword">await</span> imagemin<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span>inputBuffer<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token function">imageminGifsicle</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// interlaced的作用 是，是否对 GIF 进行隔行扫描</span>
                    <span class="token literal-property property">interlaced</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token comment">// optimizationLevel的作用是，设置压缩的质量，0-3</span>
                    <span class="token literal-property property">optimizationLevel</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                    <span class="token comment">// // progressive的作用是，是否对 GIF 进行渐进式压缩</span>
                    <span class="token comment">// progressive: true,</span>
                    <span class="token comment">// // palette的作用是，是否对 GIF 进行调色板优化</span>
                    <span class="token comment">// palette: true,</span>
                    <span class="token comment">// // colorspace的作用是，是否对 GIF 进行色彩空间转换</span>
                    <span class="token comment">// colorspace: true,</span>
                    colors
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 转换压缩后的 Buffer 为 Base64</span>
        <span class="token keyword">const</span> outputBase64 <span class="token operator">=</span> <span class="token function">bufferToBase64</span><span class="token punctuation">(</span>outputBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取压缩后 GIF 的尺寸</span>
        <span class="token keyword">const</span> compressedSize <span class="token operator">=</span> <span class="token function">getBase64Size</span><span class="token punctuation">(</span>outputBase64<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Compressed Size:'</span><span class="token punctuation">,</span> compressedSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 输出压缩后的 Base64 GIF</span>
        <span class="token comment">// console.log(outputBase64);</span>
        <span class="token keyword">let</span> gifCompressRes <span class="token operator">=</span>  <span class="token punctuation">{<!-- --></span>
            outputBase64<span class="token punctuation">,</span>
            compressedSize<span class="token punctuation">,</span>
            originalSize
        <span class="token punctuation">}</span>
        successFn <span class="token operator">&amp;&amp;</span> <span class="token function">successFn</span><span class="token punctuation">(</span>gifCompressRes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error compressing GIF:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        failFn <span class="token operator">&amp;&amp;</span> <span class="token function">failFn</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">// 将 Base64 字符串转换为 Buffer</span>
<span class="token keyword">function</span> <span class="token function">base64ToBuffer</span><span class="token punctuation">(</span><span class="token parameter">base64</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> base64Data <span class="token operator">=</span> base64<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 如果是 data URL, 删除前缀</span>
    <span class="token keyword">return</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>base64Data<span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 将 Buffer 转换为 Base64 字符串</span>
<span class="token keyword">function</span> <span class="token function">bufferToBase64</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">data:image/gif;base64,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//获取base64图片大小，返回kb数字</span>
<span class="token keyword">function</span> <span class="token function">getBase64Size</span><span class="token punctuation">(</span><span class="token parameter">base64url</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//把头部去掉</span>
        <span class="token keyword">let</span> str <span class="token operator">=</span> base64url<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'data:image/png;base64,'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 找到等号，把等号也去掉</span>
        <span class="token keyword">let</span> equalIndex <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> equalIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 原来的字符流大小，单位为字节</span>
        <span class="token keyword">let</span> strLength <span class="token operator">=</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token comment">// 计算后得到的文件流大小，单位为字节</span>
        <span class="token keyword">let</span> fileLength <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>strLength <span class="token operator">-</span> <span class="token punctuation">(</span>strLength <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 由字节转换为kb</span>
        <span class="token keyword">let</span> size <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        size <span class="token operator">=</span> <span class="token punctuation">(</span>fileLength <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> sizeStr <span class="token operator">=</span> size <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token comment">//转成字符串</span>
        <span class="token keyword">let</span> index <span class="token operator">=</span> sizeStr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取小数点处的索引</span>
        <span class="token keyword">let</span> dou <span class="token operator">=</span> sizeStr<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">//获取小数点后两位的值</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dou <span class="token operator">==</span> <span class="token string">"00"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//判断后两位是否为00，如果是则删除00                </span>
            <span class="token keyword">return</span> sizeStr<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">+</span> sizeStr<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> size<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'getBase64Size error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="_280">
     </a>
     注意事项
    </h4>
    <ul>
     <li>
      <strong>
       压缩质量与文件大小
      </strong>
      ：压缩质量越高，图片质量越好，但文件大小也越大；反之亦然。需要根据实际需求调整。
     </li>
     <li>
      <strong>
       兼容性
      </strong>
      ：虽然现代浏览器普遍支持
      <code>
       &lt;canvas&gt;
      </code>
      和Blob等特性，但在一些老旧浏览器上可能存在问题，需要做好兼容性处理。
     </li>
     <li>
      <strong>
       性能考虑
      </strong>
      ：对于大图片或高频率的图片处理，前端压缩可能会占用较多CPU资源，影响页面性能。
     </li>
    </ul>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34383839363431372f:61727469636c652f64657461696c732f313431383330313035" class_="artid" style="display:none">
 </p>
</div>


