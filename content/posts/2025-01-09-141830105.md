---
layout: post
title: "å‰ç«¯å®ç°å›¾ç‰‡å‹ç¼©å¹²è´§æ€»ç»“"
date: 2025-01-09 15:50:53 +0800
description: "å‰æ–‡æè¦1. ä½¿ç”¨HTML5çš„``å…ƒç´ 2. åˆ©ç”¨ç¬¬ä¸‰æ–¹åº“(æ¨è)3. gifå›¾ç‰‡å‹ç¼©(æ‹“å±•)æ³¨æ„äº‹é¡¹"
keywords: "å‰ç«¯å›¾ç‰‡å‹ç¼©"
categories: ['æŠ€æœ¯åˆ†äº«']
tags: ['é¢è¯•', 'å›¾åƒå¤„ç†', 'å‰ç«¯', 'äººå·¥æ™ºèƒ½']
artid: "141830105"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=141830105
    alt: "å‰ç«¯å®ç°å›¾ç‰‡å‹ç¼©å¹²è´§æ€»ç»“"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=141830105
featuredImagePreview: https://bing.ee123.net/img/rand?artid=141830105
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     å‰ç«¯å®ç°å›¾ç‰‡å‹ç¼©(å¹²è´§æ€»ç»“)
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      å‰ç«¯å®ç°å›¾ç‰‡å‹ç¼©æ–¹æ¡ˆæ€»ç»“
     </h4>
     <ul>
      <li>
       <ul>
        <li>
         <ul>
          <li>
           <a href="#_10" rel="nofollow">
            å‰æ–‡æè¦
           </a>
          </li>
          <li>
           <a href="#1_HTML5canvas_14" rel="nofollow">
            1. ä½¿ç”¨HTML5çš„`&lt;canvas&gt;`å…ƒç´ 
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#_18" rel="nofollow">
              æ­¥éª¤æ¦‚è¿°ï¼š
             </a>
            </li>
            <li>
             <a href="#_24" rel="nofollow">
              ç¤ºä¾‹ä»£ç ï¼š
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#2__78" rel="nofollow">
            2. åˆ©ç”¨ç¬¬ä¸‰æ–¹åº“(æ¨è)
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#_imagemagicadapter_89" rel="nofollow">
              ä½¿ç”¨ image-magic-adapterç¤ºä¾‹ï¼š
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#3_gif_165" rel="nofollow">
            3. gifå›¾ç‰‡å‹ç¼©(æ‹“å±•)
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#nodegif_179" rel="nofollow">
              nodeå‹ç¼©gifå®ç°å¦‚ä¸‹:
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#_280" rel="nofollow">
            æ³¨æ„äº‹é¡¹
           </a>
          </li>
         </ul>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <hr/>
    <p>
     âš ï¸âš ï¸æ–‡å‰æ¨èä¸€ä¸‹ğŸ‘‰
     <br/>
     <strong>
      å‰ç«¯å¿…å¤‡å·¥å…·æ¨èç½‘ç«™(å›¾åºŠã€APIå’ŒChatAIã€æ™ºèƒ½AIç®€å†ã€AIæ€ç»´å¯¼å›¾ç¥å™¨ç­‰å®ç”¨å·¥å…·):
     </strong>
     <br/>
     ç«™ç‚¹å…¥å£ï¼š
     <a href="http://luckycola.com.cn/" rel="nofollow">
      http://luckycola.com.cn/
     </a>
    </p>
    <hr/>
    <h4>
     <a id="_10">
     </a>
     å‰æ–‡æè¦
    </h4>
    <p>
     åœ¨Webå¼€å‘ä¸­ï¼Œå›¾ç‰‡å‹ç¼©æ˜¯ä¸€ä¸ªå¸¸è§ä¸”é‡è¦çš„éœ€æ±‚ã€‚éšç€é«˜æ¸…å›¾ç‰‡å’Œå¤šåª’ä½“å†…å®¹çš„æ™®åŠï¼Œå¦‚ä½•åœ¨ä¿è¯å›¾ç‰‡è´¨é‡çš„åŒæ—¶å‡å°‘å…¶æ–‡ä»¶å¤§å°ï¼Œå¯¹äºæå‡ç½‘é¡µåŠ è½½é€Ÿåº¦ã€ä¼˜åŒ–ç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦ã€‚å‰ç«¯ä½œä¸ºç”¨æˆ·ä¸æœåŠ¡å™¨ä¹‹é—´çš„æ¡¥æ¢ï¼Œå®ç°å›¾ç‰‡å‹ç¼©çš„åŠŸèƒ½å¯ä»¥æ˜¾è‘—å‡è½»æœåŠ¡å™¨çš„è´Ÿæ‹…ï¼ŒåŠ å¿«é¡µé¢æ¸²æŸ“é€Ÿåº¦ã€‚æœ¬æ–‡å°†æ¢è®¨å‰ç«¯å®ç°å›¾ç‰‡å‹ç¼©çš„å‡ ç§æ–¹æ³•å’ŒæŠ€æœ¯ã€‚
    </p>
    <h4>
     <a id="1_HTML5canvas_14">
     </a>
     1. ä½¿ç”¨HTML5çš„
     <code>
      &lt;canvas&gt;
     </code>
     å…ƒç´ 
    </h4>
    <p>
     HTML5çš„
     <code>
      &lt;canvas&gt;
     </code>
     å…ƒç´ ä¸ºå‰ç«¯å›¾ç‰‡å¤„ç†æä¾›äº†å¼ºå¤§çš„èƒ½åŠ›ã€‚é€šè¿‡JavaScriptæ“ä½œ
     <code>
      &lt;canvas&gt;
     </code>
     ï¼Œæˆ‘ä»¬å¯ä»¥è¯»å–å›¾ç‰‡æ•°æ®ï¼Œå¯¹å…¶è¿›è¡Œå¤„ç†ï¼ˆå¦‚ç¼©æ”¾ã€è£å‰ªã€è½¬æ¢æ ¼å¼ç­‰ï¼‰ï¼Œç„¶åè¾“å‡ºå‹ç¼©åçš„å›¾ç‰‡ã€‚
    </p>
    <h5>
     <a id="_18">
     </a>
     æ­¥éª¤æ¦‚è¿°ï¼š
    </h5>
    <ol>
     <li>
      <strong>
       è¯»å–å›¾ç‰‡
      </strong>
      ï¼šä½¿ç”¨
      <code>
       FileReader
      </code>
      æˆ–
      <code>
       Image
      </code>
      å¯¹è±¡åŠ è½½å›¾ç‰‡ã€‚
     </li>
     <li>
      <strong>
       ç»˜åˆ¶åˆ°
       <code>
        &lt;canvas&gt;
       </code>
      </strong>
      ï¼šå°†å›¾ç‰‡ç»˜åˆ¶åˆ°
      <code>
       &lt;canvas&gt;
      </code>
      ä¸Šï¼Œé€šè¿‡è°ƒæ•´
      <code>
       &lt;canvas&gt;
      </code>
      çš„å°ºå¯¸æˆ–ç»˜å›¾å‚æ•°æ¥æ§åˆ¶å‹ç¼©æ•ˆæœã€‚
     </li>
     <li>
      <strong>
       å¯¼å‡ºå›¾ç‰‡
      </strong>
      ï¼šä½¿ç”¨
      <code>
       canvas.toDataURL()
      </code>
      æ–¹æ³•å°†
      <code>
       &lt;canvas&gt;
      </code>
      å†…å®¹è½¬æ¢ä¸ºBase64ç¼–ç çš„å›¾ç‰‡ï¼Œæˆ–ä½¿ç”¨
      <code>
       canvas.toBlob()
      </code>
      æ–¹æ³•è·å–Blobå¯¹è±¡ï¼Œä»¥ä¾¿è¿›ä¸€æ­¥å¤„ç†æˆ–ä¸Šä¼ ã€‚
     </li>
    </ol>
    <h5>
     <a id="_24">
     </a>
     ç¤ºä¾‹ä»£ç ï¼š
    </h5>
    <pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">compressImage</span><span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> quality<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// è®¾ç½®canvasçš„å°ºå¯¸ï¼Œè¿™é‡Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´</span>
            <span class="token keyword">const</span> <span class="token constant">MAX_WIDTH</span> <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> <span class="token constant">MAX_HEIGHT</span> <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> width <span class="token operator">=</span> img<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
            <span class="token keyword">let</span> height <span class="token operator">=</span> img<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>width <span class="token operator">&gt;</span> height<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>width <span class="token operator">&gt;</span> <span class="token constant">MAX_WIDTH</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    height <span class="token operator">*=</span> <span class="token constant">MAX_WIDTH</span> <span class="token operator">/</span> width<span class="token punctuation">;</span>
                    width <span class="token operator">=</span> <span class="token constant">MAX_WIDTH</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>height <span class="token operator">&gt;</span> <span class="token constant">MAX_HEIGHT</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    width <span class="token operator">*=</span> <span class="token constant">MAX_HEIGHT</span> <span class="token operator">/</span> height<span class="token punctuation">;</span>
                    height <span class="token operator">=</span> <span class="token constant">MAX_HEIGHT</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> width<span class="token punctuation">;</span>
            canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> height<span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// è½¬æ¢ä¸ºå‹ç¼©åçš„å›¾ç‰‡</span>
            canvas<span class="token punctuation">.</span><span class="token function">toBlob</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">blob</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">callback</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'image/jpeg'</span><span class="token punctuation">,</span> quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        img<span class="token punctuation">.</span>src <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="token keyword">const</span> fileInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input[type="file"]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileInput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> file <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">compressImage</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">blob</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// å¤„ç†å‹ç¼©åçš„å›¾ç‰‡ï¼Œå¦‚ä¸Šä¼ æˆ–æ˜¾ç¤º</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="2__78">
     </a>
     2. åˆ©ç”¨ç¬¬ä¸‰æ–¹åº“(æ¨è)
    </h4>
    <p>
     é™¤äº†åŸç”ŸJavaScriptå’ŒHTML5å¤–ï¼Œè¿˜æœ‰è®¸å¤šä¼˜ç§€çš„ç¬¬ä¸‰æ–¹åº“å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´æ–¹ä¾¿åœ°å®ç°å›¾ç‰‡å‹ç¼©ï¼Œå¦‚
     <code>
      image-magic-adapterã€compressorjs
     </code>
     ã€
     <code>
      pica
     </code>
     ç­‰ã€‚è¿™äº›åº“é€šå¸¸æä¾›äº†æ›´ä¸°å¯Œçš„é…ç½®é€‰é¡¹å’Œæ›´å¥½çš„å…¼å®¹æ€§æ”¯æŒã€‚
    </p>
    <p>
     <strong>
      ç‰¹åˆ«æ¨èçš„åº“
     </strong>
     : image-magic-adapter
     <br/>
     è¿™ä¸ªä¸‰æ–¹åº“æ˜¯å›½å†…å¼€å‘è€…æä¾›çš„,ä»–é›†æˆè®¸å¤šå›¾ç‰‡å¤„ç†èƒ½åŠ›,åŒ…æ‹¬â€œå›¾ç‰‡å‹ç¼©â€ã€â€œå›¾ç‰‡æ ¼å¼è½¬æ¢â€ã€â€œå›¾ç‰‡åŠ æ°´å°â€ç­‰ç­‰,éå¸¸æ–¹ä¾¿,è€Œä¸”è¿™ä¸ªåº“è¿˜æœ‰å®˜ç½‘ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›åŠŸèƒ½.
    </p>
    <p>
     <strong>
      åº“å®˜ç½‘
     </strong>
     :
     <a href="https://www.npmjs.com/package/image-magic-adapter" rel="nofollow">
      https://www.npmjs.com/package/image-magic-adapter
     </a>
    </p>
    <p>
     <strong>
      åœ¨çº¿å›¾ç‰‡å¤„ç†å·¥å…·å®˜ç½‘
     </strong>
     :
     <a href="https://luckycola.com.cn/public/dist/imageTool.html" rel="nofollow">
      https://luckycola.com.cn/public/dist/imageTool.html
     </a>
    </p>
    <h5>
     <a id="_imagemagicadapter_89">
     </a>
     ä½¿ç”¨ image-magic-adapterç¤ºä¾‹ï¼š
    </h5>
    <pre><code class="prism language-javascript"><span class="token comment">// å¼•å…¥image-magic-adapter</span>
<span class="token keyword">import</span> ImageMagicAdapter <span class="token keyword">from</span> <span class="token string">'image-magic-adapter'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> ImageCompressorCls <span class="token operator">=</span> ImageMagicAdapter<span class="token punctuation">.</span>ImageCompressorCls<span class="token punctuation">;</span>

<span class="token keyword">const</span> imageCompressor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImageCompressorCls</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é»˜è®¤å‹ç¼©è´¨é‡</span>

 <span class="token comment">// -----------------------------------------å›¾ç‰‡å‹ç¼©-----------------------------------------</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'quality'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> quality <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'quality'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            imageCompressor<span class="token punctuation">.</span>quality <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> quality<span class="token punctuation">;</span> <span class="token comment">// æ›´æ–°å‹ç¼©è´¨é‡</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ›´æ–°åçš„å‹ç¼©è´¨é‡:'</span><span class="token punctuation">,</span> imageCompressor<span class="token punctuation">.</span>quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'compress'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> fileInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fileInput<span class="token punctuation">.</span>files<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'è¯·ä¸Šä¼ å›¾ç‰‡'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">const</span> files <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>fileInput<span class="token punctuation">.</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> progress <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'progress'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> outputContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'outputContainer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> downloadButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'download'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> progressText <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'progressText'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            outputContainer<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
            downloadButton<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
            progress<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>
            progress<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            progressText<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
            <span class="token comment">// compressImageså‚æ•°è¯´æ˜ï¼š</span>
            <span class="token comment">//  ç¬¬ä¸€ä¸ªå‚æ•°: filesï¼šéœ€è¦å‹ç¼©çš„æ–‡ä»¶æ•°ç»„</span>
            <span class="token comment">//  ç¬¬äºŒä¸ªå‚æ•°: callbackï¼šå‹ç¼©å®Œæˆåçš„å›è°ƒå‡½æ•°</span>
            <span class="token comment">//  ç¬¬ä¸‰ä¸ªå‚æ•°: è‹¥æ˜¯å‹ç¼©png/bmpæ ¼å¼ï¼Œè¾“å‡ºæ˜¯å¦ä¿ç•™png/bmpæ ¼å¼ï¼Œé»˜è®¤ä¸ºtrue(å»ºè®®è®¾ç½®ä¸ºfalse)</span>
            <span class="token comment">// æ³¨æ„:å¦‚æœ ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®trueå‹ç¼©png/bmpæ ¼å¼åçš„è¾“å‡ºçš„æ–‡ä»¶ä¸ºåŸæ ¼å¼(png/bmp)ä¸”å‹ç¼©æ•ˆæœä¸ä½³ï¼Œå°±éœ€è¦ä¾èµ–è®¾ç½®scaleFactoræ¥è°ƒæ•´å‹ç¼©æ¯”ä¾‹(0-1);å¦‚æœè®¾ç½®ä¸ºfalseï¼Œè¾“å‡ºä¸ºimage/jpegæ ¼å¼ä¸”å‹ç¼©æ•ˆæœæ›´å¥½ã€‚</span>
            <span class="token comment">// è®¾ç½®caleFactorä¸º0-1ï¼Œå€¼è¶Šå¤§ï¼Œå‹ç¼©æ¯”ä¾‹è¶Šå°ï¼Œå€¼è¶Šå°ï¼Œå‹ç¼©æ¯”ä¾‹è¶Šå¤§(æœ¬è´¨æ˜¯æ”¹å˜å›¾ç‰‡çš„å°ºå¯¸),ä¾‹: imageCompressor.scaleFactor = 0.5;</span>
            <span class="token keyword">await</span> imageCompressor<span class="token punctuation">.</span><span class="token function">compressImages</span><span class="token punctuation">(</span>files<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">completed<span class="token punctuation">,</span> total</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">const</span> outputImg <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                outputImg<span class="token punctuation">.</span>src <span class="token operator">=</span> imageCompressor<span class="token punctuation">.</span>compressedImages<span class="token punctuation">[</span>completed <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                outputContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>outputImg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                progress<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">(</span>completed <span class="token operator">/</span> total<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
                progressText<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">å·²å®Œæˆæ–‡ä»¶æ•°: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>completed<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> / æ€»æ–‡ä»¶æ•°: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>total<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>completed <span class="token operator">===</span> total<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    downloadButton<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'inline-block'</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            downloadButton<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>imageCompressor<span class="token punctuation">.</span>compressedImages<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    imageCompressor<span class="token punctuation">.</span><span class="token function">downloadZip</span><span class="token punctuation">(</span>imageCompressor<span class="token punctuation">.</span>compressedImages<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span>å›¾ç‰‡å‹ç¼©Demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload<span class="token punctuation">"</span></span> <span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image/*<span class="token punctuation">"</span></span> <span class="token attr-name">multiple</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>quality<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>å‹ç¼©æ¯”ç‡ï¼šï¼ˆæ¯”ç‡è¶Šå¤§å‹ç¼©è¶Šå¤§ï¼Œå›¾ç‰‡è´¨é‡è¶Šä½ï¼‰<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>quality<span class="token punctuation">"</span></span> <span class="token attr-name">min</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.9<span class="token punctuation">"</span></span> <span class="token attr-name">step</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.1<span class="token punctuation">"</span></span> <span class="token attr-name">required</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.5<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>compress<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>å‹ç¼©å›¾ç‰‡<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>progress</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progress<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>progress</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progressText<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>outputContainer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>download<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>ä¸‹è½½å·²å‹ç¼©å›¾ç‰‡<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h4>
     <a id="3_gif_165">
     </a>
     3. gifå›¾ç‰‡å‹ç¼©(æ‹“å±•)
    </h4>
    <p>
     GIFï¼ˆGraphics Interchange Formatï¼‰å›¾ç‰‡æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å›¾åƒæ–‡ä»¶æ ¼å¼ï¼Œç‰¹åˆ«é€‚åˆç”¨äºæ˜¾ç¤ºç´¢å¼•é¢œè‰²å›¾åƒï¼ˆå¦‚ç®€å•çš„å›¾å½¢ã€å›¾æ ‡å’ŒæŸäº›ç±»å‹çš„å›¾ç‰‡ï¼‰ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒåŠ¨ç”»ã€‚å°½ç®¡GIFå›¾ç‰‡æœ¬èº«å¯ä»¥å…·æœ‰å‹ç¼©ç‰¹æ€§ï¼Œä½†åœ¨å‰ç«¯å’Œåç«¯è¿›è¡Œå‹ç¼©å¤„ç†æ—¶ï¼Œå­˜åœ¨å‡ ä¸ªå…³é”®è€ƒè™‘å› ç´ ï¼Œè¿™äº›å› ç´ å¯èƒ½å¯¼è‡´åœ¨å‰ç«¯ç›´æ¥å‹ç¼©GIFä¸å¦‚åœ¨åç«¯å¤„ç†æ›´ä¸ºæœ‰æ•ˆæˆ–åˆç†ã€‚
    </p>
    <p>
     <em>
      ä¸‹é¢æä¾›ä¸€ä¸ªåšåç«¯é€šè¿‡nodeå®ç°gifå‹ç¼©çš„æ–¹æ¡ˆ:
     </em>
     <br/>
     1ã€ä¸‹è½½imageminã€imagemin-gifsicleå’Œimage-sizeåº“
     <br/>
     2ã€æ³¨æ„ä¾èµ–çš„åº“çš„ç‰ˆæœ¬,ä¸ç„¶å¯èƒ½ä¼šæŠ¥é”™
    </p>
    <pre><code class="prism language-json">	<span class="token string-property property">"image-size"</span><span class="token operator">:</span> <span class="token string">"^1.1.1"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"imagemin"</span><span class="token operator">:</span> <span class="token string">"7.0.1"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"imagemin-gifsicle"</span><span class="token operator">:</span> <span class="token string">"^7.0.0"</span><span class="token punctuation">,</span>
</code></pre>
    <h5>
     <a id="nodegif_179">
     </a>
     nodeå‹ç¼©gifå®ç°å¦‚ä¸‹:
    </h5>
    <pre><code class="prism language-js">
<span class="token keyword">const</span> imagemin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'imagemin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> imageminGifsicle <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'imagemin-gifsicle'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sizeOf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'image-size'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// å‹ç¼© GIF colors[0-256]</span>
<span class="token keyword">const</span> <span class="token function-variable function">compressGifImgFn</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>inputBase64<span class="token punctuation">,</span> colors <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token function-variable function">successFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function-variable function">failFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>inputBase64<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            failFn <span class="token operator">&amp;&amp;</span> <span class="token function">failFn</span><span class="token punctuation">(</span><span class="token string">'inputBase64 æ— æ•ˆ'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// è·å–è¾“å…¥ GIF çš„å°ºå¯¸</span>
        <span class="token keyword">const</span> originalSize <span class="token operator">=</span> <span class="token function">getBase64Size</span><span class="token punctuation">(</span>inputBase64<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Original Size:'</span><span class="token punctuation">,</span> originalSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è½¬æ¢ Base64 ä¸º Buffer</span>
        <span class="token keyword">const</span> inputBuffer <span class="token operator">=</span> <span class="token function">base64ToBuffer</span><span class="token punctuation">(</span>inputBase64<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> outputBuffer <span class="token operator">=</span> <span class="token keyword">await</span> imagemin<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span>inputBuffer<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token function">imageminGifsicle</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// interlacedçš„ä½œç”¨ æ˜¯ï¼Œæ˜¯å¦å¯¹ GIF è¿›è¡Œéš”è¡Œæ‰«æ</span>
                    <span class="token literal-property property">interlaced</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token comment">// optimizationLevelçš„ä½œç”¨æ˜¯ï¼Œè®¾ç½®å‹ç¼©çš„è´¨é‡ï¼Œ0-3</span>
                    <span class="token literal-property property">optimizationLevel</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                    <span class="token comment">// // progressiveçš„ä½œç”¨æ˜¯ï¼Œæ˜¯å¦å¯¹ GIF è¿›è¡Œæ¸è¿›å¼å‹ç¼©</span>
                    <span class="token comment">// progressive: true,</span>
                    <span class="token comment">// // paletteçš„ä½œç”¨æ˜¯ï¼Œæ˜¯å¦å¯¹ GIF è¿›è¡Œè°ƒè‰²æ¿ä¼˜åŒ–</span>
                    <span class="token comment">// palette: true,</span>
                    <span class="token comment">// // colorspaceçš„ä½œç”¨æ˜¯ï¼Œæ˜¯å¦å¯¹ GIF è¿›è¡Œè‰²å½©ç©ºé—´è½¬æ¢</span>
                    <span class="token comment">// colorspace: true,</span>
                    colors
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è½¬æ¢å‹ç¼©åçš„ Buffer ä¸º Base64</span>
        <span class="token keyword">const</span> outputBase64 <span class="token operator">=</span> <span class="token function">bufferToBase64</span><span class="token punctuation">(</span>outputBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–å‹ç¼©å GIF çš„å°ºå¯¸</span>
        <span class="token keyword">const</span> compressedSize <span class="token operator">=</span> <span class="token function">getBase64Size</span><span class="token punctuation">(</span>outputBase64<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Compressed Size:'</span><span class="token punctuation">,</span> compressedSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è¾“å‡ºå‹ç¼©åçš„ Base64 GIF</span>
        <span class="token comment">// console.log(outputBase64);</span>
        <span class="token keyword">let</span> gifCompressRes <span class="token operator">=</span>  <span class="token punctuation">{<!-- --></span>
            outputBase64<span class="token punctuation">,</span>
            compressedSize<span class="token punctuation">,</span>
            originalSize
        <span class="token punctuation">}</span>
        successFn <span class="token operator">&amp;&amp;</span> <span class="token function">successFn</span><span class="token punctuation">(</span>gifCompressRes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error compressing GIF:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        failFn <span class="token operator">&amp;&amp;</span> <span class="token function">failFn</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">// å°† Base64 å­—ç¬¦ä¸²è½¬æ¢ä¸º Buffer</span>
<span class="token keyword">function</span> <span class="token function">base64ToBuffer</span><span class="token punctuation">(</span><span class="token parameter">base64</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> base64Data <span class="token operator">=</span> base64<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// å¦‚æœæ˜¯ data URL, åˆ é™¤å‰ç¼€</span>
    <span class="token keyword">return</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>base64Data<span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// å°† Buffer è½¬æ¢ä¸º Base64 å­—ç¬¦ä¸²</span>
<span class="token keyword">function</span> <span class="token function">bufferToBase64</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">data:image/gif;base64,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//è·å–base64å›¾ç‰‡å¤§å°ï¼Œè¿”å›kbæ•°å­—</span>
<span class="token keyword">function</span> <span class="token function">getBase64Size</span><span class="token punctuation">(</span><span class="token parameter">base64url</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//æŠŠå¤´éƒ¨å»æ‰</span>
        <span class="token keyword">let</span> str <span class="token operator">=</span> base64url<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'data:image/png;base64,'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ‰¾åˆ°ç­‰å·ï¼ŒæŠŠç­‰å·ä¹Ÿå»æ‰</span>
        <span class="token keyword">let</span> equalIndex <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> equalIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// åŸæ¥çš„å­—ç¬¦æµå¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚</span>
        <span class="token keyword">let</span> strLength <span class="token operator">=</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token comment">// è®¡ç®—åå¾—åˆ°çš„æ–‡ä»¶æµå¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚</span>
        <span class="token keyword">let</span> fileLength <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>strLength <span class="token operator">-</span> <span class="token punctuation">(</span>strLength <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç”±å­—èŠ‚è½¬æ¢ä¸ºkb</span>
        <span class="token keyword">let</span> size <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        size <span class="token operator">=</span> <span class="token punctuation">(</span>fileLength <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> sizeStr <span class="token operator">=</span> size <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token comment">//è½¬æˆå­—ç¬¦ä¸²</span>
        <span class="token keyword">let</span> index <span class="token operator">=</span> sizeStr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è·å–å°æ•°ç‚¹å¤„çš„ç´¢å¼•</span>
        <span class="token keyword">let</span> dou <span class="token operator">=</span> sizeStr<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">//è·å–å°æ•°ç‚¹åä¸¤ä½çš„å€¼</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dou <span class="token operator">==</span> <span class="token string">"00"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//åˆ¤æ–­åä¸¤ä½æ˜¯å¦ä¸º00ï¼Œå¦‚æœæ˜¯åˆ™åˆ é™¤00                </span>
            <span class="token keyword">return</span> sizeStr<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">+</span> sizeStr<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> size<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'getBase64Size error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="_280">
     </a>
     æ³¨æ„äº‹é¡¹
    </h4>
    <ul>
     <li>
      <strong>
       å‹ç¼©è´¨é‡ä¸æ–‡ä»¶å¤§å°
      </strong>
      ï¼šå‹ç¼©è´¨é‡è¶Šé«˜ï¼Œå›¾ç‰‡è´¨é‡è¶Šå¥½ï¼Œä½†æ–‡ä»¶å¤§å°ä¹Ÿè¶Šå¤§ï¼›åä¹‹äº¦ç„¶ã€‚éœ€è¦æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ã€‚
     </li>
     <li>
      <strong>
       å…¼å®¹æ€§
      </strong>
      ï¼šè™½ç„¶ç°ä»£æµè§ˆå™¨æ™®éæ”¯æŒ
      <code>
       &lt;canvas&gt;
      </code>
      å’ŒBlobç­‰ç‰¹æ€§ï¼Œä½†åœ¨ä¸€äº›è€æ—§æµè§ˆå™¨ä¸Šå¯èƒ½å­˜åœ¨é—®é¢˜ï¼Œéœ€è¦åšå¥½å…¼å®¹æ€§å¤„ç†ã€‚
     </li>
     <li>
      <strong>
       æ€§èƒ½è€ƒè™‘
      </strong>
      ï¼šå¯¹äºå¤§å›¾ç‰‡æˆ–é«˜é¢‘ç‡çš„å›¾ç‰‡å¤„ç†ï¼Œå‰ç«¯å‹ç¼©å¯èƒ½ä¼šå ç”¨è¾ƒå¤šCPUèµ„æºï¼Œå½±å“é¡µé¢æ€§èƒ½ã€‚
     </li>
    </ul>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34383839363431372f:61727469636c652f64657461696c732f313431383330313035" class_="artid" style="display:none">
 </p>
</div>


