---
arturl_encode: "68747470733a2f:2f626c6f672e6373646e2e6e65742f414c69616e675365762f:61727469636c652f64657461696c732f313436313739343031"
layout: post
title: "Vue3ä¸­ä½¿ç”¨exceljså’Œfile-saverå®ç°Excelå¯¼å‡ºå«å›¾ç‰‡å¯¼å‡ºå®Œæ•´æ–¹æ¡ˆ"
date: 2025-03-11 15:43:39 +08:00
description: "å¼€ç®±å³ç”¨ï¼šå°è£…å®Œæ•´å·¥å…·å‡½æ•°çµæ´»é…ç½®ï¼šæ”¯æŒå¤šå›¾ç‰‡åˆ—ã€è‡ªå®šä¹‰æ ·å¼å¥å£®æ€§å¼ºï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶å»ºè®®æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚è°ƒæ•´å›¾ç‰‡å®šä½å‚æ•°å’Œæ ·å¼é…ç½®ï¼Œå¯¹äºå¤æ‚æŠ¥è¡¨å»ºè®®ç»“åˆåç«¯ç”Ÿæˆæ–¹æ¡ˆã€‚"
keywords: "Vue3ä¸­ä½¿ç”¨exceljså’Œfile-saverå®ç°Excelå¯¼å‡ºï¼ˆå«å›¾ç‰‡å¯¼å‡ºï¼‰å®Œæ•´æ–¹æ¡ˆ"
categories: ['æœªåˆ†ç±»']
tags: ['Excel']
artid: "146179401"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146179401
    alt: "Vue3ä¸­ä½¿ç”¨exceljså’Œfile-saverå®ç°Excelå¯¼å‡ºå«å›¾ç‰‡å¯¼å‡ºå®Œæ•´æ–¹æ¡ˆ"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146179401
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146179401
cover: https://bing.ee123.net/img/rand?artid=146179401
image: https://bing.ee123.net/img/rand?artid=146179401
img: https://bing.ee123.net/img/rand?artid=146179401
---

# Vue3ä¸­ä½¿ç”¨exceljså’Œfile-saverå®ç°Excelå¯¼å‡ºï¼ˆå«å›¾ç‰‡å¯¼å‡ºï¼‰å®Œæ•´æ–¹æ¡ˆ

### ğŸ“ é—®é¢˜èƒŒæ™¯

åœ¨Vue3é¡¹ç›®ä¸­ï¼Œå½“æˆ‘ä»¬éœ€è¦å°†åŒ…å«å›¾ç‰‡çš„æ•°æ®å¯¼å‡ºåˆ°Excelæ—¶ï¼Œå¸¸ç”¨çš„
`sheetjs/xlsx`
åº“å­˜åœ¨å±€é™æ€§ï¼š
**æ— æ³•ç›´æ¥å¯¼å‡ºå›¾ç‰‡åˆ°å•å…ƒæ ¼**
ã€‚æœ¬æ–‡å°†æä¾›å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œå°è£…å¯ç›´æ¥å¤ç”¨çš„å·¥å…·å‡½æ•°ã€‚

---

### ğŸ¯ è§£å†³æ–¹æ¡ˆ

#### æŠ€æœ¯é€‰å‹

ä½¿ç”¨
`exceljs`
+
`file-saver`
ç»„åˆï¼š

* `exceljs`
  ï¼šæ”¯æŒå›¾ç‰‡æ’å…¥çš„Excelæ“ä½œåº“
* `file-saver`
  ï¼šå‰ç«¯æ–‡ä»¶ä¿å­˜å·¥å…·

#### åŠŸèƒ½ç‰¹æ€§

âœ… æ”¯æŒå¤šå›¾ç‰‡åˆ—å¯¼å‡º
  
âœ… è‡ªåŠ¨è¯†åˆ«Base64å’ŒDataURLæ ¼å¼
  
âœ… ç²¾ç¡®æ§åˆ¶å›¾ç‰‡ä½ç½®
  
âœ… å¼‚å¸¸å¤„ç†ä¸æ€§èƒ½ä¼˜åŒ–

---

### ğŸ›  å®Œæ•´å®ç°ä»£ç 

#### æ­¥éª¤1ï¼šå®‰è£…ä¾èµ–

```bash
npm install exceljs file-saver

```

#### æ­¥éª¤2ï¼šåˆ›å»ºå·¥å…·æ–‡ä»¶

```javascript
// utils/excelExport.js
import ExcelJS from 'exceljs';
import { saveAs } from 'file-saver';

/**
 *
 * @param headers è¡¨å¤´ï¼Œ[è¡¨å¤´1,è¡¨å¤´2,...]          å¿…å¡«
 * @param tableData å†…å®¹ [data1,data2,...]       å¿…å¡«
 * @param imageIndex å›¾ç‰‡ä¸‹æ ‡åˆ— [0, 1, 2 , ...],     éå¿…å¡«
 * @returns {Promise<void>}
 */
export const exportToExcel = async (headers, tableData, imageIndex = []) => {
    const workbook = new ExcelJS.Workbook();
    const worksheet = workbook.addWorksheet('Sheet1');

    // æ·»åŠ è¡¨å¤´
    const headerRow = worksheet.addRow(headers);

    // è®¾ç½®è¡¨å¤´æ ·å¼
    headerRow.eachCell((cell) => {
        cell.font = {
            bold: true,
            color: { argb: 'FFFFFFFF' },
            size: 12
        };
        cell.fill = {
            type: 'pattern',
            pattern: 'solid',
            fgColor: { argb: 'FF007BFF' }
        };
        cell.alignment = {
            horizontal: 'center',
            vertical: 'middle'
        };
    });

    // è®¾ç½®åˆ—å®½
    headers.forEach((_, colIndex) => {
        let width = 20; // é»˜è®¤åˆ—å®½
        if (imageIndex.includes(colIndex)) {
            width = 30; // å›¾ç‰‡åˆ—æ›´å®½
        }
        worksheet.getColumn(colIndex + 1).width = width;
    });

    // å¤„ç†æ•°æ®è¡Œï¼ˆä¿®æ”¹ä¸ºå¼‚æ­¥ï¼‰
    for (let rowIdx = 0; rowIdx < tableData.length; rowIdx++) {
        const row = tableData[rowIdx];
        const dataRow = worksheet.addRow(row);

        if (imageIndex.length > 0) {
            // ä½¿ç”¨Promise.allå¤„ç†å¤šåˆ—å›¾ç‰‡
            await Promise.all(imageIndex.map(async (colIdx) => {
                const imgUrl = row[colIdx];
                if (!imgUrl) return;

                try {
                    const parsed = await parseImageData(imgUrl);
                    if (!parsed) return;

                    const imageId = workbook.addImage({
                        base64: parsed.base64,
                        extension: parsed.extension,
                    });

                    const colLetter = getExcelColumnLetter(colIdx);
                    const excelRow = rowIdx + 2;

                    worksheet.addImage(imageId, {
                        tl: { col: colIdx, row: excelRow - 1 },
                        br: { col: colIdx + 1, row: excelRow },
                        editAs: 'oneCell' // æ›´ç¨³å®šçš„å®šä½æ–¹å¼
                    });
                } catch (error) {
                    console.error(`å›¾ç‰‡å¤„ç†å¤±è´¥ï¼ˆè¡Œ${rowIdx + 1}åˆ—${colIdx + 1}ï¼‰:`, error);
                }
            }));
        }
    }

    // ç”Ÿæˆæ–‡ä»¶
    const buffer = await workbook.xlsx.writeBuffer();
    saveAs(new Blob([buffer]), `æ•°æ®å¯¼å‡º_${new Date().getTime()}.xlsx`);
};

// åˆ—ç´¢å¼•è½¬Excelå­—æ¯ï¼ˆå¦‚ï¼š0 -> A, 1 -> Bï¼‰
const getExcelColumnLetter = (column) => {
    let letter = '';
    let col = column + 1;
    while (col > 0) {
        const remainder = (col - 1) % 26;
        letter = String.fromCharCode(65 + remainder) + letter;
        col = Math.floor((col - 1) / 26);
    }
    return letter;
};

// æ–°å¢ï¼šå°†å›¾ç‰‡URLè½¬æ¢ä¸ºbase64
const urlToBase64 = async (url) => {
    try {
        const response = await fetch(url);
        const blob = await response.blob();
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.readAsDataURL(blob);
        });
    } catch (error) {
        console.error('å›¾ç‰‡è½¬æ¢å¤±è´¥:', error);
        return null;
    }
};

// ä¿®æ”¹åçš„è§£æå‡½æ•°
const parseImageData = async (imgData) => {
    if (!imgData) return null;

    // å¤„ç†URLæƒ…å†µ
    if (imgData.startsWith('http')) {
        const dataURL = await urlToBase64(imgData);
        if (!dataURL) return null;

        const [header, base64] = dataURL.split(';base64,');
        const extension = header.split('/')[1];
        return { base64, extension };
    }

    // åŸæœ‰å¤„ç†dataURLçš„é€»è¾‘
    if (imgData.startsWith('data:image')) {
        const [header, base64] = imgData.split(';base64,');
        if (!header || !base64) return null;
        const extension = header.split('/')[1];
        return { base64, extension };
    }

    return null;
};


```

---

### ğŸ“Œ ä½¿ç”¨ç¤ºä¾‹

#### Vue3ç»„ä»¶è°ƒç”¨

```html
<template>
  <button @click="handleExport">å¯¼å‡ºExcel</button>
</template>

<script setup>
import { exportDataToExcel } from '@/utils/excelExport';

const headers = ['åç§°', 'ä»·æ ¼', 'ä¸»å›¾'];
const tableData = [
  ['å•†å“A', 99.9, 'https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg'], 
  ['å•†å“B', 199.9, '']
];
const imageIndex = [2]; // ç¬¬ä¸‰åˆ—ä¸ºå›¾ç‰‡åˆ—

const handleExport = async () => {
  await exportDataToExcel(headers, tableData, imageIndex);
};
</script>

```

---

### âš™ï¸ æ‰©å±•é…ç½®

#### è®¾ç½®åˆ—å®½

```javascript
    headers.forEach((_, colIndex) => {
        let width = 20; // é»˜è®¤åˆ—å®½
        if (imageIndex.includes(colIndex)) {
            width = 30; // å›¾ç‰‡åˆ—æ›´å®½
        }
        worksheet.getColumn(colIndex + 1).width = width;
    });

```

#### è®¾ç½®è¡¨å¤´æ ·å¼

```javascript
headerRow.eachCell((cell) => {
        cell.font = {
            bold: true,
            color: { argb: 'FFFFFFFF' },
            size: 12
        };
        cell.fill = {
            type: 'pattern',
            pattern: 'solid',
            fgColor: { argb: 'FF007BFF' }
        };
        cell.alignment = {
            horizontal: 'center',
            vertical: 'middle'
        };
    });

```

---

### ğŸ“Œ å¯¼å‡ºæ ·å¼

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/a7c381fa237d4256a937f6d6fdf6aec6.png)

---

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **å›¾ç‰‡è§„èŒƒ**

   * å»ºè®®ä½¿ç”¨PNGæ ¼å¼
   * å•å›¾ç‰‡å°ºå¯¸ä¸è¶…è¿‡500x500px
   * Base64å­—ç¬¦ä¸²éœ€å®Œæ•´
2. **æ€§èƒ½å»ºè®®**

   * æ¨èæ•°æ®é‡ï¼š<1000è¡Œ
   * å•æ–‡ä»¶å›¾ç‰‡ï¼š<50å¼ 
   * å¤§æ–‡ä»¶å»ºè®®åˆ†é¡µå¯¼å‡º
3. **å¸¸è§é—®é¢˜**

   * å›¾ç‰‡ä¸æ˜¾ç¤ºï¼šæ£€æŸ¥Base64æ ¼å¼æ˜¯å¦æ­£ç¡®
   * ä½ç½®åç§»ï¼šè°ƒæ•´
     `tl`
     /
     `br`
     å®šä½å‚æ•°
   * å†…å­˜æº¢å‡ºï¼šåˆ†æ‰¹æ¬¡å¤„ç†æ•°æ®

---

### ğŸ“š å®ç°åŸç†

1. **åæ ‡è½¬æ¢**
     
   é€šè¿‡
   `getExcelColumnLetter`
   å‡½æ•°å°†æ•°å­—ç´¢å¼•è½¬æ¢ä¸ºExcelå­—æ¯åæ ‡
2. **å›¾ç‰‡å¤„ç†**

   * è‡ªåŠ¨å‰¥ç¦»DataURLå¤´ä¿¡æ¯
   * æ”¯æŒçº¯Base64ç›´æ¥ä½¿ç”¨
3. **å®šä½ç³»ç»Ÿ**

   ```javascript
   // tl: å·¦ä¸Šè§’å®šä½(top-left)
   // br: å³ä¸‹è§’å®šä½(bottom-right)
   { 
     tl: { col: 0, row: 0 }, // A1å•å…ƒæ ¼
     br: { col: 1, row: 1 }  // B2å•å…ƒæ ¼
   }

   ```

---

### ğŸ’¡ æ€»ç»“

æœ¬æ–‡æä¾›çš„æ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. **å¼€ç®±å³ç”¨**
   ï¼šå°è£…å®Œæ•´å·¥å…·å‡½æ•°
2. **çµæ´»é…ç½®**
   ï¼šæ”¯æŒå¤šå›¾ç‰‡åˆ—ã€è‡ªå®šä¹‰æ ·å¼
3. **å¥å£®æ€§å¼º**
   ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶

å»ºè®®æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚è°ƒæ•´å›¾ç‰‡å®šä½å‚æ•°å’Œæ ·å¼é…ç½®ï¼Œå¯¹äºå¤æ‚æŠ¥è¡¨å»ºè®®ç»“åˆåç«¯ç”Ÿæˆæ–¹æ¡ˆã€‚