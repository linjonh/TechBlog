---
layout: post
title: "React-Jest单元测试配置"
date: 2024-12-13 21:52:35 +0800
description: "1. 测试项目环境项目基于Ant design pro，antd 3.23.1，js。测试依赖：注意"
keywords: "jest alias"
categories: ['前端']
tags: ['单元测试', 'React', 'Javascript']
artid: "120917644"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=120917644
    alt: "React-Jest单元测试配置"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=120917644
featuredImagePreview: https://bing.ee123.net/img/rand?artid=120917644
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     React Jest单元测试配置
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="1__0">
     </a>
     1. 测试项目环境
    </h2>
    <p>
     项目基于Ant design pro，antd 3.23.1，js。
     <br/>
     测试依赖：
     <br/>
     <strong>
      注意版本
     </strong>
     ，以下几个是测试通过的，如果要更换版本，先查看或测试兼容性。
     <br/>
     <code>
      package.json
     </code>
     中添加开发环境依赖
    </p>
    <pre><code class="prism language-json"><span class="token string">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
	<span class="token string">"jest"</span><span class="token operator">:</span> <span class="token string">"^27.2.5"</span><span class="token punctuation">,</span>
  <span class="token string">"babel-jest"</span><span class="token operator">:</span> <span class="token string">"^27.2.5"</span><span class="token punctuation">,</span>
  <span class="token string">"@babel/core"</span><span class="token operator">:</span> <span class="token string">"^7.12.16"</span><span class="token punctuation">,</span>
  <span class="token string">"@babel/preset-env"</span><span class="token operator">:</span> <span class="token string">"^7.12.16"</span><span class="token punctuation">,</span>
  <span class="token string">"@babel/preset-react"</span><span class="token operator">:</span> <span class="token string">"^7.12.13"</span>
<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="2__14">
     </a>
     2. 相关配置
    </h2>
    <h3>
     <a id="21_jest__15">
     </a>
     2.1 jest 配置
    </h3>
    <p>
     配置项参考文档：
     <a href="https://jestjs.io/zh-Hans/docs/configuration" rel="nofollow">
      jest配置项
     </a>
    </p>
    <ol>
     <li>
      ​
      <code>
       rootDir
      </code>
      项目根目录，根据自己
      <code>
       jest-config.js
      </code>
      位置决定。
     </li>
     <li>
      ​
      <code>
       collectCoverage
      </code>
      是否进行覆盖测试，这里没有开启，覆盖测试相关以coverage打头的字段，详细查询配置项文档。
     </li>
     <li>
      <strong>
       <code>
        moduleNameMapper
       </code>
      </strong>
      配置，主要解决Cannot find module’@common/utils’ from ‘index.js’ 问题，webpack的resolve.alias设置了@**的别名，这里jest需要配置模块名称映射，将@
      <strong>
       这些名称映射到真正的文件上。
      </strong>
     </li>
     <li>
      ​
      <code>
       testMatch
      </code>
      配置测试文件格式，这里我配置的是任意路径下的
      <code>
       *.test.js
      </code>
      文件均为单元测试文件。
     </li>
     <li>
      <strong>
       <code>
        setupFiles
       </code>
      </strong>
      解决一些环境依赖问题，例如关于window（浏览器对象模型）的依赖，我在项目中使用了
      <strong>
       <code>
        localStorage
       </code>
      </strong>
      ，单元测试没有启用浏览器，因此会报错，
      <strong>
       <code>
        setupFiles
       </code>
      </strong>
      是在测试之前需要加载的代码，和Java单元测试之前装载spring环境一个道理。**
     </li>
     <li>
      <code>
       testUrl
      </code>
      项目开发环境运行地址。
     </li>
     <li>
      其余配置参考文档。
     </li>
    </ol>
    <pre><code class="prism language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  rootDir<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  collectCoverage<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  collectCoverageFrom<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'&lt;rootDir&gt;/src/**/*.{js,jsx,mjs}'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  coverageDirectory<span class="token operator">:</span> <span class="token string">'&lt;rootDir&gt;/test/coverage'</span><span class="token punctuation">,</span>
  coveragePathIgnorePatterns<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/node_modules/'</span><span class="token punctuation">,</span> <span class="token string">'&lt;rootDir&gt;/src/page/index.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  moduleNameMapper<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'^@/(.*)$'</span><span class="token operator">:</span> <span class="token string">'&lt;rootDir&gt;/src/$1'</span><span class="token punctuation">,</span>
    <span class="token string">'^@@/(.*)$'</span><span class="token operator">:</span> <span class="token string">'&lt;rootDir&gt;/src/.umi/$1'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  setupFiles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'&lt;rootDir&gt;/test/setup.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  testMatch<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"**/*.test.js?(x)"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  testURL<span class="token operator">:</span> <span class="token string">'http://localhost:8000'</span><span class="token punctuation">,</span>
  transform<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'^.+\\.(js|jsx|mjs)$'</span><span class="token operator">:</span> <span class="token string">'&lt;rootDir&gt;/node_modules/babel-jest'</span><span class="token punctuation">,</span>
    <span class="token string">'^.+\\.(css|less)$'</span><span class="token operator">:</span> <span class="token string">'&lt;rootDir&gt;/test/cssTransform.js'</span><span class="token punctuation">,</span>
    <span class="token string">'\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$'</span><span class="token operator">:</span> <span class="token string">'&lt;rootDir&gt;/test/fileTransform.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  transformIgnorePatterns<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'[/\\\\]node_modules[/\\\\].+\\.(js|jsx|mjs)$'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="22_jest_js_51">
     </a>
     2.2 jest 配置中的加载的js文件
    </h3>
    <p>
     以下文件位置参考
     <strong>
      2.1
     </strong>
     中的配置。
    </p>
    <ol>
     <li>
      测试运行前安装脚本
      <code>
       setup.js
      </code>
     </li>
    </ol>
    <pre><code class="prism language-javascript"><span class="token comment">/**
 * 配置单元测试localStorage
 */</span>
<span class="token keyword">const</span> localStorageMock <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  getItem<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  setItem<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  clear<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
global<span class="token punctuation">.</span>localStorage <span class="token operator">=</span> localStorageMock<span class="token punctuation">;</span>
</code></pre>
    <ol start="2">
     <li>
      防止样式解析错误影响单元测试
      <code>
       cssTransform
      </code>
     </li>
    </ol>
    <pre><code class="prism language-javascript"><span class="token comment">/**
 * 所有样式文件重定向，返回空
 */</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token string">'module.exports = {};'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">getCacheKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token string">'cssTransform'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <ol start="3">
     <li>
      忽略文件（图片、字体等）
      <code>
       fileTransform.js
      </code>
     </li>
    </ol>
    <pre><code class="prism language-javascript"><span class="token comment">/**
 * 忽略文件
 */</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">src<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">module.exports = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="23_babel__95">
     </a>
     2.3 babel 配置
    </h3>
    <p>
     项目根目录下创建
     <code>
      .babelrc
     </code>
     文件（也可在package.json中配置），内容如下：
     <br/>
     如果使用 env和react 会报
     <strong>
      找不到preset-react
     </strong>
     的错误。
    </p>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span> <span class="token string">"@babel/preset-react"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre>
    <h2>
     <a id="3__104">
     </a>
     3. 测试
    </h2>
    <h3>
     <a id="31__105">
     </a>
     3.1 工具文件
    </h3>
    <p>
     <code>
      utils.js
     </code>
     可以在文件中引入一些模块来充分测试。
    </p>
    <pre><code class="prism language-json"><span class="token comment">/**
 * 数字补0
 * @param val 整型数字
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fixedZero</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> val <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">0</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> val<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="32__116">
     </a>
     3.2 单元测试
    </h3>
    <p>
     <code>
      utils.test.js
     </code>
     也可以直接使用
     <code>
      console.log()
     </code>
     打印在控制台。
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> fixedZero<span class="token punctuation">,</span> isUrl <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/common/utils'</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'测试功能描述：自动填充数字（补0）'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'预期结果描述：10以上的数字不会补0'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fixedZero</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fixedZero</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fixedZero</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fixedZero</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fixedZero</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fixedZero</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'预期结果描述：个位数字前面补0，并以字符串输出'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fixedZero</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fixedZero</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fixedZero</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'02'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fixedZero</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'03'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fixedZero</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'04'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fixedZero</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'05'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fixedZero</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'06'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fixedZero</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'07'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fixedZero</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'08'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fixedZero</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'09'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f77697a6172645f72702f:61727469636c652f64657461696c732f313230393137363434" class_="artid" style="display:none">
 </p>
</div>


