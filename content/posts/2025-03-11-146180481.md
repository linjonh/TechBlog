---
layout: post
title: "C-WPF-串口通信"
date: 2025-03-11 15:38:09 +0800
description: "【代码】C# WPF 串口通信。"
keywords: "C# WPF 串口通信"
categories: ['Wpf', 'C']
tags: ['开发语言', 'Wpf', 'C']
artid: "146180481"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146180481
    alt: "C-WPF-串口通信"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146180481
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146180481
cover: https://bing.ee123.net/img/rand?artid=146180481
image: https://bing.ee123.net/img/rand?artid=146180481
img: https://bing.ee123.net/img/rand?artid=146180481
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     C# WPF 串口通信
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="_2">
     </a>
     安装依赖库
    </h2>
    <ul>
     <li>
      System.IO.Ports
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/91acc5f9ce094aaeb0f63cdd23a13fdc.png">
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/82f0faeacea64520b21eefb24e079db8.png"/>
      </img>
     </li>
    </ul>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Diagnostics</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>Ports</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Controls</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Data</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Documents</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Markup<span class="token punctuation">.</span>Localizer</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Media</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>Imaging</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Navigation</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Shapes</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">GasAlarmFactoryTools</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">struct</span> <span class="token class-name">TestInfoData</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> dev_uuid<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> dev_simcard<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> private_data<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> datetime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Interaction logic for MainWindow.xaml</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">MainWindow</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Window</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// TODO: 串口相关</span>
        <span class="token class-name">SerialPort</span> mSerialPort <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SerialPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Thread</span> recvThread<span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">long</span></span> recvTimems <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">// 用于计算串口接收完一帧数据</span>
        <span class="token class-name"><span class="token keyword">int</span></span> rxLen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 串口接收到的数据长度</span>
        <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> rxBuff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 串口数据接收缓存</span>
        <span class="token keyword">private</span> <span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> baudrateList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"4800"</span><span class="token punctuation">,</span>
            <span class="token string">"9600"</span><span class="token punctuation">,</span>
            <span class="token string">"19200"</span><span class="token punctuation">,</span>
            <span class="token string">"38400"</span><span class="token punctuation">,</span>
            <span class="token string">"57600"</span><span class="token punctuation">,</span>
            <span class="token string">"115200"</span><span class="token punctuation">,</span>
            <span class="token string">"256000"</span><span class="token punctuation">,</span>
            <span class="token string">"1000000"</span><span class="token punctuation">,</span>
            <span class="token string">"2000000"</span><span class="token punctuation">,</span>
            <span class="token string">"3000000"</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token function">MainWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">InitializeComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


            <span class="token comment">// 获取所有可用串口端口，并添加到comboBoxCOM</span>
            <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> ports <span class="token operator">=</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>Ports<span class="token punctuation">.</span>SerialPort<span class="token punctuation">.</span><span class="token function">GetPortNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            comboBoxComName<span class="token punctuation">.</span>ItemsSource <span class="token operator">=</span> ports<span class="token punctuation">;</span>
            comboBoxComName<span class="token punctuation">.</span>SelectedIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 默认选择索引</span>
            comboBoxBaudrate<span class="token punctuation">.</span>ItemsSource <span class="token operator">=</span> baudrateList<span class="token punctuation">;</span>    <span class="token comment">// 波特率设置combobox数据源</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 窗口关闭处理</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="e"&gt;&lt;/param&gt;</span>
        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnClosing</span><span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>ComponentModel<span class="token punctuation">.</span>CancelEventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"确定要退出吗？"</span><span class="token punctuation">,</span> <span class="token string">"确认"</span><span class="token punctuation">,</span> MessageBoxButton<span class="token punctuation">.</span>YesNo<span class="token punctuation">)</span> <span class="token operator">!=</span> MessageBoxResult<span class="token punctuation">.</span>Yes<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 用户选择“否”，取消关闭</span>
                e<span class="token punctuation">.</span>Cancel <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            mSerialPort<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//mTimer.Dispose();</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>recvThread <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>                
                recvThread<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnClosing</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">recvTimerCalback</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> obj<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Dispatcher<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// TODO: 处理接收到的数据</span>

            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">recvThreadTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>mSerialPort<span class="token punctuation">.</span>IsOpen<span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token class-name"><span class="token keyword">int</span></span> datalength <span class="token operator">=</span> mSerialPort<span class="token punctuation">.</span>BytesToRead<span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>datalength <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{<!-- --></span>
                            <span class="token comment">//Console.WriteLine("BytesToRead:" + datalength);</span>
                            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> datalength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                            <span class="token punctuation">{<!-- --></span>
                                recvTimems <span class="token operator">=</span> Environment<span class="token punctuation">.</span>TickCount<span class="token punctuation">;</span> <span class="token comment">// 更新串口数据接收时间</span>
                                <span class="token class-name"><span class="token keyword">byte</span></span> data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>mSerialPort<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                rxBuff<span class="token punctuation">[</span>rxLen<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>

                                <span class="token keyword">if</span> <span class="token punctuation">(</span>rxBuff<span class="token punctuation">.</span>Length <span class="token operator">==</span> rxLen<span class="token punctuation">)</span>
                                <span class="token punctuation">{<!-- --></span>
                                    rxLen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                                    Array<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span>rxBuff<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> rxBuff<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Error================"</span> <span class="token operator">+</span> rxBuff<span class="token punctuation">.</span>Length <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>

                                <span class="token comment">//Console.WriteLine(data.ToString("X2"));</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>

                        <span class="token function">recvTimerCalback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" ----------异常------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">btnOpenCloseCom_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mSerialPort<span class="token punctuation">.</span>IsOpen<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                mSerialPort<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                btnOpenCloseCom<span class="token punctuation">.</span>Content <span class="token operator">=</span> <span class="token string">"打开串口"</span><span class="token punctuation">;</span>
                btnOpenCloseCom<span class="token punctuation">.</span>Background <span class="token operator">=</span> Brushes<span class="token punctuation">.</span>Red<span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"关闭串口成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"关闭串口成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                comboBoxComName<span class="token punctuation">.</span>IsEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                comboBoxBaudrate<span class="token punctuation">.</span>IsEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                comboBoxDataBits<span class="token punctuation">.</span>IsEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                comboBoxStopBits<span class="token punctuation">.</span>IsEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                comboBoxParity<span class="token punctuation">.</span>IsEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                comboBoxHandshake<span class="token punctuation">.</span>IsEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// TODO: 串口默认设置</span>
                mSerialPort<span class="token punctuation">.</span>BaudRate <span class="token operator">=</span> <span class="token number">4800</span><span class="token punctuation">;</span> <span class="token comment">// 波特率</span>
                mSerialPort<span class="token punctuation">.</span>DataBits <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>   <span class="token comment">// 数据位</span>
                mSerialPort<span class="token punctuation">.</span>StopBits <span class="token operator">=</span> StopBits<span class="token punctuation">.</span>One<span class="token punctuation">;</span>    <span class="token comment">// 停止位</span>
                mSerialPort<span class="token punctuation">.</span>Parity <span class="token operator">=</span> Parity<span class="token punctuation">.</span>None<span class="token punctuation">;</span>   <span class="token comment">// 校验位</span>
                mSerialPort<span class="token punctuation">.</span>Handshake <span class="token operator">=</span> Handshake<span class="token punctuation">.</span>None<span class="token punctuation">;</span> <span class="token comment">// 流控位</span>
                <span class="token comment">// mSerialPort.ReadTimeout = 1500; // 读超时</span>
                <span class="token comment">// mSerialPort.Encoding = Encoding.UTF8; // 编码方式</span>
                <span class="token comment">// mSerialPort.RtsEnable = true;</span>
                <span class="token comment">// mSerialPort.DataReceived += SerialPort_DataReceived;</span>

                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"baudrate SelectedIndex:"</span> <span class="token operator">+</span> comboBoxBaudrate<span class="token punctuation">.</span>SelectedIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"baudrate SelectedValue:"</span> <span class="token operator">+</span> comboBoxBaudrate<span class="token punctuation">.</span>SelectedValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"baudrate Text:"</span> <span class="token operator">+</span> comboBoxBaudrate<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// TODO: 串口端口选择</span>
                mSerialPort<span class="token punctuation">.</span>PortName <span class="token operator">=</span> comboBoxComName<span class="token punctuation">.</span>SelectedItem<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// TODO: 设置串口波特率</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>comboBoxBaudrate<span class="token punctuation">.</span>SelectedIndex <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    mSerialPort<span class="token punctuation">.</span>BaudRate <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>comboBoxBaudrate<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">switch</span> <span class="token punctuation">(</span>comboBoxBaudrate<span class="token punctuation">.</span>SelectedValue<span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">case</span> <span class="token string">"4800"</span><span class="token punctuation">:</span>
                            mSerialPort<span class="token punctuation">.</span>BaudRate <span class="token operator">=</span> <span class="token number">4800</span><span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token keyword">case</span> <span class="token string">"9600"</span><span class="token punctuation">:</span>
                            mSerialPort<span class="token punctuation">.</span>BaudRate <span class="token operator">=</span> <span class="token number">9600</span><span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token keyword">case</span> <span class="token string">"19200"</span><span class="token punctuation">:</span>
                            mSerialPort<span class="token punctuation">.</span>BaudRate <span class="token operator">=</span> <span class="token number">19200</span><span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token keyword">case</span> <span class="token string">"38400"</span><span class="token punctuation">:</span>
                            mSerialPort<span class="token punctuation">.</span>BaudRate <span class="token operator">=</span> <span class="token number">38400</span><span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token keyword">case</span> <span class="token string">"57600"</span><span class="token punctuation">:</span>
                            mSerialPort<span class="token punctuation">.</span>BaudRate <span class="token operator">=</span> <span class="token number">57600</span><span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token keyword">case</span> <span class="token string">"115200"</span><span class="token punctuation">:</span>
                            mSerialPort<span class="token punctuation">.</span>BaudRate <span class="token operator">=</span> <span class="token number">115200</span><span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token keyword">case</span> <span class="token string">"256000"</span><span class="token punctuation">:</span>
                            mSerialPort<span class="token punctuation">.</span>BaudRate <span class="token operator">=</span> <span class="token number">256000</span><span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token keyword">case</span> <span class="token string">"1000000"</span><span class="token punctuation">:</span>
                            mSerialPort<span class="token punctuation">.</span>BaudRate <span class="token operator">=</span> <span class="token number">1000000</span><span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token keyword">case</span> <span class="token string">"2000000"</span><span class="token punctuation">:</span>
                            mSerialPort<span class="token punctuation">.</span>BaudRate <span class="token operator">=</span> <span class="token number">2000000</span><span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token keyword">case</span> <span class="token string">"3000000"</span><span class="token punctuation">:</span>
                            mSerialPort<span class="token punctuation">.</span>BaudRate <span class="token operator">=</span> <span class="token number">3000000</span><span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token keyword">default</span><span class="token punctuation">:</span>
                            MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"波特率设置有误！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// TODO: 串口数据位设置</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span>comboBoxDataBits<span class="token punctuation">.</span>SelectedIndex<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>DataBits <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>DataBits <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>DataBits <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>DataBits <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">default</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>DataBits <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// TODO: 串口停止位设置</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span>comboBoxStopBits<span class="token punctuation">.</span>SelectedIndex<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>StopBits <span class="token operator">=</span> StopBits<span class="token punctuation">.</span>One<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>StopBits <span class="token operator">=</span> StopBits<span class="token punctuation">.</span>OnePointFive<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>StopBits <span class="token operator">=</span> StopBits<span class="token punctuation">.</span>Two<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">default</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>StopBits <span class="token operator">=</span> StopBits<span class="token punctuation">.</span>One<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// TODO: 串口校验位设置</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span>comboBoxParity<span class="token punctuation">.</span>SelectedIndex<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>Parity <span class="token operator">=</span> Parity<span class="token punctuation">.</span>None<span class="token punctuation">;</span>   <span class="token comment">// 无校验</span>
                        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"无校验"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>Parity <span class="token operator">=</span> Parity<span class="token punctuation">.</span>Odd<span class="token punctuation">;</span>   <span class="token comment">// 奇校验</span>
                        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"奇校验"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>Parity <span class="token operator">=</span> Parity<span class="token punctuation">.</span>Even<span class="token punctuation">;</span>   <span class="token comment">// 偶校验</span>
                        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"偶校验"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>Parity <span class="token operator">=</span> Parity<span class="token punctuation">.</span>Mark<span class="token punctuation">;</span>   <span class="token comment">// 校验位1</span>
                        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"校验位1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token number">4</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>Parity <span class="token operator">=</span> Parity<span class="token punctuation">.</span>Space<span class="token punctuation">;</span>   <span class="token comment">// 校验位0</span>
                        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"校验位0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">default</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>Parity <span class="token operator">=</span> Parity<span class="token punctuation">.</span>None<span class="token punctuation">;</span>   <span class="token comment">// 无校验</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// TODO: 串口流控位设置</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span>comboBoxHandshake<span class="token punctuation">.</span>SelectedIndex<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>Handshake <span class="token operator">=</span> Handshake<span class="token punctuation">.</span>None<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>Handshake <span class="token operator">=</span> Handshake<span class="token punctuation">.</span>XOnXOff<span class="token punctuation">;</span>                        
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>Handshake <span class="token operator">=</span> Handshake<span class="token punctuation">.</span>RequestToSend<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>Handshake <span class="token operator">=</span> Handshake<span class="token punctuation">.</span>RequestToSendXOnXOff<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">default</span><span class="token punctuation">:</span>
                        mSerialPort<span class="token punctuation">.</span>Handshake <span class="token operator">=</span> Handshake<span class="token punctuation">.</span>None<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// TODO: 尝试打开串口</span>
                <span class="token keyword">try</span> 
                <span class="token punctuation">{<!-- --></span>
                    mSerialPort<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    btnOpenCloseCom<span class="token punctuation">.</span>Content <span class="token operator">=</span> <span class="token string">"关闭串口"</span><span class="token punctuation">;</span>
                    btnOpenCloseCom<span class="token punctuation">.</span>Background <span class="token operator">=</span> Brushes<span class="token punctuation">.</span>Green<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> 
                <span class="token punctuation">{<!-- --></span>
                    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>Message<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <pre><code class="prism language-csharp"><span class="token comment">// TODO: 串口写入数据  3个参数(buf, offset, len);</span>
mSerialPort<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{<!-- --></span> <span class="token number">0xAA</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x08</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0xB2</span><span class="token punctuation">,</span> <span class="token number">0x55</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031333432303432382f:61727469636c652f64657461696c732f313436313830343831" class_="artid" style="display:none">
 </p>
</div>


