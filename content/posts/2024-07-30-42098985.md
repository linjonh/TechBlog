---
layout: post
title: "在chromium源码中增加默认的搜索引擎"
date: 2024-07-30 19:19:44 +0800
description: "接下的文章会涉及对chromium源代码的修改，会从一些简单的方向修改chromium的功能。本篇文"
keywords: "修改chromium 源码 设置默认搜索引擎"
categories: ['Chromium']
tags: ['源代码', '浏览器', 'Chromium']
artid: "42098985"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=42098985
    alt: "在chromium源码中增加默认的搜索引擎"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=42098985
featuredImagePreview: https://bing.ee123.net/img/rand?artid=42098985
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     在chromium源码中增加默认的搜索引擎
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     接下的文章会涉及对chromium源代码的修改，会从一些简单的方向修改chromium的功能。本篇文章介绍如何在chromium中增加一个默认的搜索引擎。
    </p>
    <p>
     以增加我们国家的搜索引擎--中国搜索
     <a href="http://www.chinaso.com/" rel="nofollow noopener noreferrer" target="_blank">
      http://www.chinaso.com/
     </a>
     为例
    </p>
    <p>
     <img alt="" src="https://img-blog.csdn.net/20141223100944359"/>
    </p>
    <p>
     1、首先需要定义一下搜索引擎
    </p>
    <p>
     在src/chrome/browser/search_engines/prepopulated_engines.json文件中，定义了许多默认的搜索引擎，我们在该文件中，搜索
     <a href="http://www.sogou.com" rel="nofollow noopener noreferrer" target="_blank">
      www.sogou.com
     </a>
     ，参考sogou的定义，在该文件中增加一条chinaso的配置。
    </p>
    <p>
     name：“中国搜索”的utf8编码。
    </p>
    <p>
     keyword：上图配置中第二列关键字。
    </p>
    <p>
     favicon_url：网站图标，通常都会有，就在网站后边加个favicon.ico
    </p>
    <p>
     search_url：这个是关键，需要根据搜索站点的url格式，拼出一个搜索的url，当用户在地址栏输入query后，会用query替换{searchTerms}
    </p>
    <p>
     type：搜索引擎的type，按照例子造了一个。
    </p>
    <p>
     id：prepopulated_engines.json文件上边有说明，“The following unique IDs are available:11, 12, 14, 18, 19, 20..... “，随便选一个。
    </p>
    <pre><code class="language-plain">    "yandex_ua": {
      "name": "\u042f\u043d\u0434\u0435\u043a\u0441",
      "keyword": "yandex.ua",
      "favicon_url": "http://yandex.ua/favicon.ico",
      "search_url": "http://yandex.ua/yandsearch?text={searchTerms}",
      "suggest_url": "http://suggest.yandex.net/suggest-ff.cgi?part={searchTerms}",
      "type": "SEARCH_ENGINE_YANDEX",
      "id": 15
    },

    "chinaso": {
      "name": "\u4e2d\u56fd\u641c\u7d22",
      "keyword": "chinaso.com",
      "favicon_url": "http://www.chinaso.com/favicon.ico",
      "search_url": "http://www.chinaso.com/search/pagesearch.htm?q={searchTerms}",
      "type": "SEARCH_ENGINE_CHINASO",
      "id": 11
    },
    // UMA-only engines 

    // The following engines are not included in any of the country lists. They
    // are listed in |kAllEngines|, however, so that GetEngineType can find them
    // for UMA reporting purposes.</code></pre>
    <p>
     2、配置中文默认搜索引擎。
    </p>
    <p>
     在src\chrome\browser\search_engines\template_url_prepopulate_data.cc中修改
    </p>
    <p>
     在engines_CN中加入“chinaso“，就是prepopulated_engines.json定义的搜索引擎
    </p>
    <pre><code class="language-cpp">// China
const PrepopulatedEngine* engines_CN[] =
	{ &amp;chinaso, &amp;baidu, &amp;sogou, &amp;soso, &amp;google };</code></pre>
    <p>
     在kAllEngines中也加入“chinaso“，这个在GetEngineType函数中会用到。
    </p>
    <pre><code class="language-cpp">// A list of all the engines that we know about.

const PrepopulatedEngine* kAllEngines[] = {
  ......
  &amp;yahoo_vn,     &amp;yahoo_za,     &amp;yandex_ru,    &amp;yandex_tr,    &amp;yandex_ua,
  &amp;chinaso,
  // UMA-only engines:
  ......
}</code></pre>
    <p>
     3、增加一个搜索引擎类型
    </p>
    <p>
     src/chrome/browser/search_engines/search_engine_type.h
    </p>
    <p>
     在SearchEngineType的SEARCH_ENGINE_MAX之前，增加一项SEARCH_ENGINE_CHINASO
    </p>
    <p>
    </p>
    <p>
     重新编译后就能在设置-&gt;搜索中看到我们添加的默认搜索引擎。
    </p>
    <p>
    </p>
    <p>
     <br/>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f6c6a6d313938373435:2f61727469636c652f64657461696c732f3432303938393835" class_="artid" style="display:none">
 </p>
</div>


