---
layout: post
title: "前端跨域WebSocket如何实现跨域通信原理实践与安全指南"
date: 2025-03-06 11:12:31 +0800
description: "WebSocket通过基于Origin字段的握手验证机制，是跨域实时通信需要在服务器端严格校验来源，并结合反向代理、TLS加密等技术保障安全性对于需要高频双向数据交换的应用（如在线协作、实时监控），WebSocket的跨域能力将成为关键优势。"
keywords: "【前端跨域】WebSocket如何实现跨域通信？原理、实践与安全指南"
categories: ['Javascript']
tags: ['网络协议', '网络', '安全', '前端', 'Websocket', 'Tcp', 'Javascript']
artid: "146060049"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146060049
    alt: "前端跨域WebSocket如何实现跨域通信原理实践与安全指南"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146060049
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146060049
cover: https://bing.ee123.net/img/rand?artid=146060049
image: https://bing.ee123.net/img/rand?artid=146060049
img: https://bing.ee123.net/img/rand?artid=146060049
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【前端跨域】WebSocket如何实现跨域通信？原理、实践与安全指南
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在实时通信场景（如在线聊天、实时数据推送）中，WebSocket因其高效的双向通信能力成为首选技术
    </p>
    <p>
     然而，当客户端与服务器部署在不同源时，跨域问题同样可能阻碍WebSocket的连接
    </p>
    <h2>
     <a id="WebSocket_4">
     </a>
     一、WebSocket与跨域的关系
    </h2>
    <h3>
     <a id="WebSocket_5">
     </a>
     WebSocket的跨域限制
    </h3>
    <p>
     虽然WebSocket协议本身不受同源策略的直接限制，但浏览器在建立WebSocket连接时仍会校验跨域安全性：
    </p>
    <p>
     客户端发起WebSocket连接时，浏览器会在握手请求的HTTP头中自动添加
     <code>
      Origin
     </code>
     字段（如
     <code>
      Origin: https://client-domain.com
     </code>
     ）
    </p>
    <p>
     服务器必须显式验证
     <code>
      Origin
     </code>
     字段，决定是否允许该跨域连接。
    </p>
    <p>
     若服务器未做验证，恶意网站可能通过伪造
     <code>
      Origin
     </code>
     劫持WebSocket通信
    </p>
    <h3>
     <a id="CORS_14">
     </a>
     与CORS的区别
    </h3>
    <p>
     CORS：针对HTTP请求，依赖服务器设置响应头（如
     <code>
      Access-Control-Allow-Origin
     </code>
     ）
    </p>
    <p>
     WebSocket：在HTTP握手阶段完成跨域验证，无需额外响应头，但需服务器主动检查
     <code>
      Origin
     </code>
     字段
    </p>
    <h2>
     <a id="WebSocket_19">
     </a>
     二、WebSocket跨域的实现方式
    </h2>
    <h3>
     <a id="Origin_20">
     </a>
     服务器端验证Origin（核心步骤）
    </h3>
    <p>
     以Node.js的ws库为例，手动验证Origin字段：
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">const</span> WebSocket <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ws'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket<span class="token punctuation">.</span>Server</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">socket<span class="token punctuation">,</span> request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> origin <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>origin<span class="token punctuation">;</span>
  <span class="token keyword">const</span> allowedOrigins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://client-domain.com'</span><span class="token punctuation">,</span> <span class="token string">'https://trusted-site.com'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>allowedOrigins<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token number">1008</span><span class="token punctuation">,</span> <span class="token string">'Unauthorized origin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 拒绝非法来源</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 合法连接的处理逻辑</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Received:'</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="Nginx_43">
     </a>
     Nginx反向代理（生产环境推荐）
    </h3>
    <p>
     通过Nginx代理隐藏跨域细节，使浏览器认为WebSocket服务与前端同源：
    </p>
    <pre><code class="prism language-javascript">server <span class="token punctuation">{<!-- --></span>
  listen <span class="token number">80</span><span class="token punctuation">;</span>
  server_name client<span class="token operator">-</span>domain<span class="token punctuation">.</span>com<span class="token punctuation">;</span>

  location <span class="token operator">/</span>ws <span class="token punctuation">{<!-- --></span>
    proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>websocket<span class="token operator">-</span>server<span class="token operator">:</span><span class="token number">8080</span><span class="token punctuation">;</span>
    proxy_http_version <span class="token number">1.1</span><span class="token punctuation">;</span>
    proxy_set_header Upgrade $http_upgrade<span class="token punctuation">;</span>
    proxy_set_header Connection <span class="token string">"Upgrade"</span><span class="token punctuation">;</span>
    proxy_set_header Host $host<span class="token punctuation">;</span>
    proxy_set_header <span class="token constant">X</span><span class="token operator">-</span>Real<span class="token operator">-</span><span class="token constant">IP</span> $remote_addr<span class="token punctuation">;</span>
    proxy_set_header <span class="token constant">X</span><span class="token operator">-</span>Forwarded<span class="token operator">-</span>For $proxy_add_x_forwarded_for<span class="token punctuation">;</span>
    proxy_set_header Origin <span class="token string">""</span><span class="token punctuation">;</span> # 可选：覆盖Origin头以简化服务器验证
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     前端连接地址改为同源的ws://client-domain.com/ws，Nginx将请求转发至真实的WebSocket服务器。
    </p>
    <h3>
     <a id="_66">
     </a>
     前端代码示例
    </h3>
    <pre><code class="prism language-javascript"><span class="token keyword">const</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'wss://client-domain.com/ws'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

socket<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WebSocket连接已建立'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello Server!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'收到消息:'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

socket<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'连接错误:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h2>
     <a id="_85">
     </a>
     三、安全性考量
    </h2>
    <p>
     严格校验Origin字段
     <br/>
     避免使用通配符（如允许所有
     <code>
      Origin
     </code>
     ），防止跨站WebSocket劫持（
     <code>
      Cross-Site WebSocket Hijacking
     </code>
     ）。
    </p>
    <p>
     使用WSS协议（
     <code>
      WebSocket over TLS
     </code>
     ）
     <br/>
     加密通信防止中间人攻击，同时现代浏览器要求安全上下文（HTTPS页面）中才能使用WebSocket。
    </p>
    <p>
     身份验证与鉴权
    </p>
    <p>
     在握手阶段传递Token（如URL参数
     <code>
      wss://server.com/ws?token=xxx
     </code>
     ）。
    </p>
    <p>
     使用Cookie时需设置
     <code>
      SameSite
     </code>
     和
     <code>
      Secure
     </code>
     属性。
    </p>
    <h2>
     <a id="_98">
     </a>
     四、优缺点
    </h2>
    <h3>
     <a id="_100">
     </a>
     优点
    </h3>
    <ol>
     <li>
      原生支持双向实时通信，延迟低
     </li>
     <li>
      绕过传统HTTP跨域限制，适用复杂场景
     </li>
     <li>
      现代浏览器广泛兼容（IE10+）
     </li>
    </ol>
    <h3>
     <a id="_104">
     </a>
     缺点
    </h3>
    <ol>
     <li>
      需服务器主动验证Origin
     </li>
     <li>
      长连接可能增加服务器资源消耗
     </li>
     <li>
      需额外处理断线重连、心跳检测等逻辑
     </li>
    </ol>
    <h2>
     <a id="_110">
     </a>
     总结
    </h2>
    <p>
     WebSocket通过基于Origin字段的握手验证机制，是跨域实时通信
     <br/>
     需要在服务器端严格校验来源，并结合反向代理、TLS加密等技术保障安全性
    </p>
    <p>
     对于需要高频双向数据交换的应用（如在线协作、实时监控），WebSocket的跨域能力将成为关键优势
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f77756a69616e72656e6e2f:61727469636c652f64657461696c732f313436303630303439" class_="artid" style="display:none">
 </p>
</div>


