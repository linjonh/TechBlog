---
layout: post
title: "Nginx正向代理HTTPS配置指南仅供参考"
date: 2025-03-11 19:24:27 +0800
description: "Nginx正向代理HTTPS配置指南（仅供参考）"
keywords: "Nginx正向代理HTTPS配置指南（仅供参考）"
categories: ['运维']
tags: ['网络协议', '网络', '信息与通信', 'Tcp', 'Nginx', 'Https', 'Http']
artid: "146187065"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146187065
    alt: "Nginx正向代理HTTPS配置指南仅供参考"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146187065
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146187065
cover: https://bing.ee123.net/img/rand?artid=146187065
image: https://bing.ee123.net/img/rand?artid=146187065
img: https://bing.ee123.net/img/rand?artid=146187065
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Nginx正向代理HTTPS配置指南（仅供参考）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     要使用Nginx作为正向代理访问HTTPS网站，需通过
     <code>
      CONNECT
     </code>
     方法建立隧道。以下是操作详细步骤：
    </p>
    <hr/>
    <h4>
     <strong>
      1. 安装Nginx及依赖模块
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        需要模块
       </strong>
       ：
       <code>
        ngx_http_proxy_connect_module
       </code>
       （支持
       <code>
        CONNECT
       </code>
       方法）。
      </p>
     </li>
     <li>
      <p>
       <strong>
        安装方式
       </strong>
       ：需重新编译Nginx。
      </p>
     </li>
    </ul>
    <p>
     bash
    </p>
    <p>
     复制
    </p>
    <pre># 下载Nginx源码和模块
wget http://nginx.org/download/nginx-1.24.0.tar.gz
tar -zxvf nginx-1.24.0.tar.gz
cd nginx-1.24.0/

git clone https://github.com/chobits/ngx_http_proxy_connect_module.git

# 配置编译参数（确保原有参数不变，追加模块）
./configure \
  --add-module=./ngx_http_proxy_connect_module \
  --with-http_ssl_module  # 启用SSL支持

# 编译并安装
make &amp;&amp; sudo make install</pre>
    <hr/>
    <h4>
     <strong>
      2. 配置Nginx正向代理
     </strong>
    </h4>
    <p>
     编辑配置文件（如
     <code>
      /usr/local/nginx/conf/nginx.conf
     </code>
     ）：
    </p>
    <p>
     nginx
    </p>
    <p>
     复制
    </p>
    <pre>http {
    resolver 8.8.8.8;  # 配置DNS解析服务器

    server {
        listen 3128;  # 代理监听端口

        # 允许CONNECT方法（HTTPS默认端口443）
        proxy_connect;
        proxy_connect_allow 443;

        location / {
            # 正向代理核心配置
            proxy_pass http://$http_host$request_uri;
            proxy_set_header Host $http_host;

            # 可选：添加代理身份验证
            # auth_basic "Proxy Authentication Required";
            # auth_basic_user_file /path/to/htpasswd;
        }
    }
}</pre>
    <hr/>
    <h4>
     <strong>
      3. 启动/重载Nginx
     </strong>
    </h4>
    <p>
     bash
    </p>
    <p>
     复制
    </p>
    <pre># 检查配置语法
nginx -t

# 启动或重载配置
nginx -s reload</pre>
    <hr/>
    <h4>
     <strong>
      4. 客户端使用代理
     </strong>
    </h4>
    <h5>
     <strong>
      浏览器设置
     </strong>
    </h5>
    <ul>
     <li>
      <p>
       配置代理地址为
       <code>
        Nginx服务器IP:3128
       </code>
       ，协议选择HTTP（代理本身使用HTTP，但可代理HTTPS请求）。
      </p>
     </li>
    </ul>
    <h5>
     <strong>
      命令行测试（如curl）
     </strong>
    </h5>
    <p>
     bash
    </p>
    <p>
     复制
    </p>
    <pre>curl -x http://your_nginx_ip:3128 https://example.com</pre>
    <hr/>
    <h4>
     <strong>
      关键注意事项
     </strong>
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        防火墙
       </strong>
       ：确保代理端口（如
       <code>
        3128
       </code>
       ）开放。
      </p>
     </li>
     <li>
      <p>
       <strong>
        安全性
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         限制访问IP：通过
         <code>
          allow/deny
         </code>
         规则控制。
        </p>
       </li>
       <li>
        <p>
         启用认证：使用
         <code>
          auth_basic
         </code>
         设置用户名密码。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        日志调试
       </strong>
       ：检查
       <code>
        error.log
       </code>
       排查连接问题。
      </p>
     </li>
     <li>
      <p>
       <strong>
        CONNECT限制
       </strong>
       ：默认仅允许443端口，可通过
       <code>
        proxy_connect_allow
       </code>
       扩展。
      </p>
     </li>
    </ol>
    <hr/>
    <h4>
     <strong>
      常见问题
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        无法解析域名
       </strong>
       ：检查
       <code>
        resolver
       </code>
       配置是否正确。
      </p>
     </li>
     <li>
      <p>
       <strong>
        代理拒绝连接
       </strong>
       ：确认
       <code>
        proxy_connect
       </code>
       指令和端口权限。
      </p>
     </li>
     <li>
      <p>
       <strong>
        SSL证书警告
       </strong>
       ：正向代理不干预SSL握手，客户端需信任目标站点证书。
      </p>
     </li>
    </ul>
    <p>
     通过以上步骤，Nginx即可作为正向代理处理HTTPS流量。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f35373230323238342f:61727469636c652f64657461696c732f313436313837303635" class_="artid" style="display:none">
 </p>
</div>


