---
layout: post
title: "sqldef一款免费的数据库变更管理工具"
date: 2025-03-13 21:00:00 +0800
description: "sqldef 是一个用于管理数据库模式结构的工具，可以用于比较两个数据库中的表结构差异并且生成可执行的 DDL 脚本。"
keywords: "sqldef：一款免费的数据库变更管理工具"
categories: ['数据库']
tags: ['数据库']
artid: "146215846"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146215846
    alt: "sqldef一款免费的数据库变更管理工具"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146215846
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146215846
cover: https://bing.ee123.net/img/rand?artid=146215846
image: https://bing.ee123.net/img/rand?artid=146215846
img: https://bing.ee123.net/img/rand?artid=146215846
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     sqldef：一款免费的数据库变更管理工具
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night-eighties" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     应用程序的升级通常伴随着数据库表结构的变更，为了维护各种环境的数据库变更，我们通常需要引入 Liquibase 或者 Flyaway 这样的数据库版本控制工具。不过，这类工具通常需要绑定某种编程语言，例如 Java；这次我们介绍一个新的工具：sqldef。
    </p>
    <p>
     <a href="https://sqldef.github.io/" rel="nofollow">
      sqldef
     </a>
     是一个用于管理数据库模式结构的工具，可以用于比较两个数据库中的表结构差异并且生成可执行的 DDL 脚本。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/95c56d65d29e474891c1c78ec8d1b89d.gif#pic_center"/>
    </p>
    <p>
     sqldef 提供了命令行工具、WASM、NodeJS 等运行方式，支持的数据库包括 MySQL、PostgreSQL、SQLite 以及 SQL Server。
    </p>
    <h3>
     <a id="_8">
     </a>
     下载安装
    </h3>
    <p>
     sqldef 支持跨平台，包括 Linux、Windows、macOS。输入以下网址可以下载编译好的二进制文件：
    </p>
    <p>
     https://github.com/sqldef/sqldef/releases
    </p>
    <p>
     基于不同的操作系统和数据库下载对应的文件，例如 Windows 平台的 MySQL 数据库，文件名为 mysqldef_windows_amd64.zip。下载完成后解压得到可执行文件 mysqldef.exe。
    </p>
    <blockquote>
     <p>
      PostgreSQL 对应的文件名为 psqldef_xxx，SQLite 对应的文件名为 sqlite3def_xxx，SQL Server 对应的文件名为 mssqldef_xxx。
     </p>
    </blockquote>
    <h3>
     <a id="_19">
     </a>
     使用案例
    </h3>
    <p>
     下面我们以 MySQL 数据库为例，演示以下如何使用 mysqldef：
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 确保 mysql 客户端可以连接数据库</span>
PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>bell-<span class="token operator">&gt;</span> mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">-e</span> <span class="token string">"select 1;"</span>
Enter password: ********
+---+
<span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span>
+---+
<span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span>
+---+

<span class="token comment"># 使用 mysqldef 工具导出数据库 test 的表结构</span>
PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>bell-<span class="token operator">&gt;</span> .<span class="token punctuation">\</span>mysqldef.exe /u root /p xxxxxx /export <span class="token builtin class-name">test</span>
CREATE TABLE <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> <span class="token punctuation">(</span>
  <span class="token variable"><span class="token variable">`</span><span class="token function">id</span><span class="token variable">`</span></span> bigint unsigned NOT NULL AUTO_INCREMENT,
  <span class="token variable"><span class="token variable">`</span>name<span class="token variable">`</span></span> varchar<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> DEFAULT <span class="token string">'NA'</span>,
  PRIMARY KEY <span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span><span class="token function">id</span><span class="token variable">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token assign-left variable">ENGINE</span><span class="token operator">=</span>InnoDB DEFAULT <span class="token assign-left variable">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token assign-left variable">COLLATE</span><span class="token operator">=</span>utf8mb4_0900_ai_ci<span class="token punctuation">;</span>

<span class="token comment"># 保存表结构到文件</span>
PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>bell-<span class="token operator">&gt;</span> .<span class="token punctuation">\</span>mysqldef.exe /u root /p xxxxxx /export <span class="token builtin class-name">test</span> <span class="token operator">&gt;</span> mysql_test.sql
</code></pre>
    <p>
     其中，/u 用于指定用户名；/p 用户指定密码，需要将 xxxxxx 替换为实际值； /export 表示导出表结构；test 是数据库名称。更多的参数介绍可以通过帮助信息查看：
    </p>
    <pre><code class="prism language-bash">PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>bell-<span class="token operator">&gt;</span> .<span class="token punctuation">\</span>mysqldef.exe /help
Usage:
  C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>bell-<span class="token punctuation">\</span>mysqldef.exe <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> <span class="token punctuation">[</span>database<span class="token operator">|</span>current.sql<span class="token punctuation">]</span> <span class="token operator">&lt;</span> desired.sql

Application Options:
  /u, /user:user_name               MySQL user name <span class="token punctuation">(</span>default: root<span class="token punctuation">)</span>
  /p, /password:password            MySQL user password, overridden by <span class="token variable">$MYSQL_PWD</span>
  /h, /host:host_name               Host to connect to the MySQL server <span class="token punctuation">(</span>default: <span class="token number">127.0</span>.0.1<span class="token punctuation">)</span>
  /P, /port:port_num                Port used <span class="token keyword">for</span> the connection <span class="token punctuation">(</span>default: <span class="token number">3306</span><span class="token punctuation">)</span>
  /S, /socket:socket                The socket <span class="token function">file</span> to use <span class="token keyword">for</span> connection
      /ssl-mode:ssl_mode            SSL connection mode<span class="token punctuation">(</span>PREFERRED,REQUIRED,DISABLED<span class="token punctuation">)</span>. <span class="token punctuation">(</span>default: PREFERRED<span class="token punctuation">)</span>
      /ssl-ca:ssl_ca                File that contains list of trusted SSL Certificate Authorities
      /password-prompt              Force MySQL user password prompt
      /enable-cleartext-plugin      Enable/disable the <span class="token function">clear</span> text authentication plugin
      /file:sql_file                Read desired SQL from the file, rather than stdin <span class="token punctuation">(</span>default: -<span class="token punctuation">)</span>
      /dry-run                      Don't run DDLs but just show them
      /export                       Just dump the current schema to stdout
      /enable-drop-table            Enable destructive changes such as DROP <span class="token punctuation">(</span>enable only table drops<span class="token punctuation">)</span>
      /skip-view                    Skip managing views <span class="token punctuation">(</span>temporary feature, to be removed later<span class="token punctuation">)</span>
      /before-apply:                Execute the given string before applying the regular DDLs
      /config:                      YAML <span class="token function">file</span> to specify: target_tables, skip_tables, algorithm, lock
      /help                         Show this <span class="token builtin class-name">help</span>
      /version                      Show this version
</code></pre>
    <p>
     打开生成的 mysql_test.sql 文件，增加一个字段 created_at 和索引 index_name：
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'NA'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>created_at<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token comment">-- 增加一个字段</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_0900_ai_ci<span class="token punctuation">;</span>

<span class="token comment">-- 增加一个索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> user_name_idx <span class="token keyword">USING</span> <span class="token keyword">BTREE</span> <span class="token keyword">ON</span> test<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     然后就可以运行 mysqldef 比较修改前后的表结构差异：
    </p>
    <pre><code class="prism language-bash">PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>bell-<span class="token operator">&gt;</span> .<span class="token punctuation">\</span>mysqldef.exe /u root /p xxxxxx /dry-run /file mysql_test.sql <span class="token builtin class-name">test</span>
-- dry run --
ALTER TABLE <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> ADD COLUMN <span class="token variable"><span class="token variable">`</span>created_at<span class="token variable">`</span></span> datetime NOT NULL AFTER <span class="token variable"><span class="token variable">`</span>name<span class="token variable">`</span></span><span class="token punctuation">;</span>
CREATE INDEX user_name_idx USING BTREE ON test.<span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     其中，/dry-run 表示只显示要执行的 DDL，但是不会实际执行。
    </p>
    <p>
     我们去掉 /dry-run 参数，针对数据库执行差异 DDL：
    </p>
    <pre><code class="prism language-bash">PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>bell-<span class="token operator">&gt;</span> .<span class="token punctuation">\</span>mysqldef.exe /u root /p xxxxxx /file mysql_test.sql <span class="token builtin class-name">test</span>
-- Apply --
ALTER TABLE <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> ADD COLUMN <span class="token variable"><span class="token variable">`</span>created_at<span class="token variable">`</span></span> datetime NOT NULL AFTER <span class="token variable"><span class="token variable">`</span>name<span class="token variable">`</span></span><span class="token punctuation">;</span>
CREATE INDEX user_name_idx USING BTREE ON test.<span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     此时，数据库中已经应用了最新的 DDL，修改表结构。再次执行以上命令：
    </p>
    <pre><code class="prism language-bash">PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>bell-<span class="token operator">&gt;</span> .<span class="token punctuation">\</span>mysqldef.exe /u root /p root2024 /file mysql_test.sql <span class="token builtin class-name">test</span>
-- Nothing is modified --
</code></pre>
    <p>
     显示数据库结构没有更改。
    </p>
    <p>
     其他数据库的示例可以参考 GitHub 上的项目文档：
    </p>
    <p>
     https://github.com/sqldef/sqldef?tab=readme-ov-file
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f686f727365732f:61727469636c652f64657461696c732f313436323135383436" class_="artid" style="display:none">
 </p>
</div>


