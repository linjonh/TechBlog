---
layout: post
title: "linux下-jq-截取json文件信息"
date: 2025-03-09 16:59:29 +0800
description: "linux系统处理json文件，获取想要数据"
keywords: "linux下 jq 截取json文件信息"
categories: ['Linux', 'Json']
tags: ['运维', 'Linux', 'Json']
artid: "146132844"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146132844
    alt: "linux下-jq-截取json文件信息"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146132844
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146132844
cover: https://bing.ee123.net/img/rand?artid=146132844
image: https://bing.ee123.net/img/rand?artid=146132844
img: https://bing.ee123.net/img/rand?artid=146132844
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     linux下 jq 截取json文件信息
    </h1>
   </div>
   <div class="article-resource-info-box">
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <strong>
      背景
     </strong>
     ：通过‘登录名‘ 获取该对象的其他个人信息如名字。
    </p>
    <p>
     <strong>
      环境准备：
     </strong>
     麒麟操作系统V10 + jq安装包
    </p>
    <p>
     jq安装包获取方式：yum install jq  或 使用附件中的rpm 或 git自行下载
    </p>
    <p>
     <a href="https://github.com/stedolan/jq/releases/download/" title="https://github.com/stedolan/jq/releases/download/">
      https://github.com/stedolan/jq/releases/download/
     </a>
    </p>
    <p>
     <strong>
      实现过程介绍：
     </strong>
    </p>
    <p>
     （1）姓名文件（a.txt）包含登录名，以逗号为分割。
    </p>
    <p class="img-center">
     <img alt="" height="112" src="https://i-blog.csdnimg.cn/direct/cf022210b0e648199d1e82aee4bddf62.png" width="667"/>
    </p>
    <p>
     （2）json文件（ryxx.json）包含登录名（即a文件的信息）、中文姓名、年龄等相关信息。
    </p>
    <p class="img-center">
     <img alt="" height="472" src="https://i-blog.csdnimg.cn/direct/5ef3e882611e4c1db001ac15ea3d8d38.png" width="283"/>
    </p>
    <p>
     （3）将a文件中的人员信息获取其对应的真实姓名
    </p>
    <blockquote>
     <p>
      <strong>
       完整脚本1：
      </strong>
     </p>
     <p>
      #!/bin/bash
      <br/>
      logins=$(tr ',' '\n' &lt; /data/jqtest/a.txt | xargs -n1)
     </p>
     <p>
      for dlm in $logins;do
     </p>
     <p>
      name=$(jq -r --arg uid "$dlm" ' .[] | select ( .loginId == $uid ) | .name // "null" ' /data/jqtest/ryxx.json )
     </p>
     <p>
      if [ -n "$name" ];then
      <br/>
      echo "$dlm $name"
      <br/>
      fi
      <br/>
      done
     </p>
    </blockquote>
    <blockquote>
     <p>
      <strong>
       完整脚本2【改进登录名存在空格和重复登录名问题】：
      </strong>
     </p>
     <p>
      #!/bin/bash
      <br/>
      file_a="/data/jqtest/a.txt"
      <br/>
      file_json="/data/jqtest/ryxx.json"
      <br/>
      mapfile -t logins &lt; &lt;(tr ',' '\n' &lt; "$file_a")
     </p>
     <p>
      for dlm in "${logins[@]}"; do
      <br/>
      dlm_display="${dlm:-null}"  # 空值替换为 null
      <br/>
      name=$( jq -r --arg uid "$dlm"  ' ([.[] | select(.loginId == $uid) | .name] | first) // "null" ' "$file_json" )
      <br/>
      echo "$dlm_display $name"
      <br/>
      done
     </p>
    </blockquote>
    <blockquote>
     <p>
      <strong>
       各代码解释：
      </strong>
      <br/>
      logins=$(tr ',' '\n' &lt; /data/jqtest/a.txt | xargs -n1)
     </p>
     <p>
      <span style="color:#fe2c24">
       #将a文件的，替换为换行 xargs将换行分隔的每一行内容作为单独的参数传递给后续命令
      </span>
     </p>
     <p>
      <span style="color:#fe2c24">
       #for循环读取logins存储的每行数据
      </span>
     </p>
     <p>
      for dlm in $logins;do
     </p>
    </blockquote>
    <blockquote>
     <p>
      <span style="color:#fe2c24">
       #此处存在问题，a文件如存在空格会被错误分割，则可以以数组方式进行存储
      </span>
     </p>
     <p>
      <span style="color:#fe2c24">
       【 用法
      </span>
      ：
      <strong>
       mapfile -t  数组名 &lt; &lt;(输入命令)
      </strong>
      <span style="color:#fe2c24">
       】
      </span>
     </p>
     <p>
      mapfile -t logins &lt; &lt;(tr ',' '\n' &lt; /data/jqtest/a.txt)
      <br/>
      for dlm in "${logins[@]}"; do
     </p>
    </blockquote>
    <blockquote>
     <p>
      <span style="color:#fe2c24">
       # -z用于检查字符串是否为空，如果字符串长度为空，那么返回真。
      </span>
     </p>
     <p>
      <span style="color:#fe2c24">
       # −n是检查字符串是否非空，如果字符串长度不为空，那么返回真。
      </span>
     </p>
     <p>
     </p>
     <p>
      jq -r --arg uid "$dlm"  ' ([.[] | select(.loginId == $uid) | .name] | first) // "null" ' "$file_json"
     </p>
     <p>
     </p>
     <p>
      <span style="color:#fe2c24">
       #jq命令将文件中的参数传入jq命令脚本中，通过.[] 将数组展开，将对象传递给select进行判断，然后取其的name，如果name为空，通过//返回空
      </span>
     </p>
     <p>
     </p>
     <p>
      <span style="color:#fe2c24">
       -r：输出原始字符串（去除 JSON 引号）
      </span>
     </p>
     <p>
     </p>
     <p>
      <span style="color:#fe2c24">
       --arg： 动态传参，用于将外部变量传递给 jq 脚本。
      </span>
     </p>
     <p>
      <span style="color:#fe2c24">
       【用法：
      </span>
      <strong>
       jq --arg &lt;变量名&gt; &lt;值&gt; '&lt;jq脚本&gt;'
      </strong>
      <span style="color:#fe2c24">
       】如将 dlm 传给uid变量，通过jq脚本 判断json文件中.loginId 字段等于变量uid。
      </span>
     </p>
     <p>
     </p>
     <p>
      <span style="color:#fe2c24">
       .[] 的作用：展开数组元素，将 JSON 数组中的每个元素逐个提取出来，形成数据流。执行 jq '.[]' 后 如下：
      </span>
     </p>
     <p class="img-center">
      <img alt="" height="426" src="https://i-blog.csdnimg.cn/direct/78f4c1eeafd642b7a3b83249ee86aad0.png" width="174"/>
     </p>
     <p class="img-center">
      <img alt="" height="80" src="https://i-blog.csdnimg.cn/direct/8004cada971b49ecbbf0bde84cb9481e.png" width="147"/>
     </p>
     <p>
      <span style="color:#fe2c24">
       | first：first 是一个过滤器，用于 从输入流或数组中提取第一个元素。它的作用是提前终止处理，只保留第一个匹配的结果，常用于确保输出唯一性
      </span>
     </p>
     <p>
      <span style="color:#fe2c24">
       // null：如果name字段为空或false，则替换为null 。
      </span>
     </p>
     <p>
     </p>
     <p>
     </p>
     <p>
     </p>
    </blockquote>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f77616e676c6f6c61696e692f:61727469636c652f64657461696c732f313436313332383434" class_="artid" style="display:none">
 </p>
</div>


