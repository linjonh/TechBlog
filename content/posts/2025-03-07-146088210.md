---
layout: post
title: "从零开始学C语言文件操作理论与代码详解"
date: 2025-03-07 11:34:18 +0800
description: "从零开始学C语言文件操作：理论与代码详解，为什么要用文件，文件各种操作，文件结束判定，看了包会！！！"
keywords: "从零开始学C语言文件操作：理论与代码详解"
categories: ['C']
tags: ['语法', '文件操作', '开发语言', 'C']
artid: "146088210"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146088210
    alt: "从零开始学C语言文件操作理论与代码详解"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146088210
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146088210
cover: https://bing.ee123.net/img/rand?artid=146088210
image: https://bing.ee123.net/img/rand?artid=146088210
img: https://bing.ee123.net/img/rand?artid=146088210
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     从零开始学C语言文件操作：理论与代码详解
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     📝前言：
     <br/>
     本文主要讲解C语言中的基础文件操作
    </p>
    <blockquote>
     <p>
      🎬个人简介：努力学习ing
      <br/>
      📋个人专栏：
      <a href="https://blog.csdn.net/tan_run/category_12506809.html">
       C语言入门基础
      </a>
      <br/>
      🎀CSDN主页
      <a href="https://blog.csdn.net/tan_run?spm=1010.2135.3001.5421">
       愚润求学
      </a>
      <br/>
      🌄每日鸡汤：
      <strong>
       do it for joy and do it forever
      </strong>
     </p>
    </blockquote>
    <hr/>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="_12">
     </a>
     一、为什么要使用文件
    </h2>
    <p>
     在C语言编程中，我们编写的程序数据通常存储在电脑内存里。可一旦程序退出，内存就会回收这些数据，再次运行程序时，之前的数据就找不到了。为了能长久保存数据，我们就需要用到文件。文件可以把数据存储在磁盘上，即使程序关闭，数据依然存在，下次运行程序时还能读取使用。
    </p>
    <hr/>
    <h2>
     <a id="_16">
     </a>
     二、什么是文件
    </h2>
    <p>
     在程序设计里，文件分为
     <strong>
      程序文件
     </strong>
     和
     <strong>
      数据文件
     </strong>
     。程序文件包括
     <strong>
      源程序文件
     </strong>
     （后缀为.c）、
     <strong>
      目标文件
     </strong>
     （Windows环境后缀为.obj）和
     <strong>
      可执行程序
     </strong>
     （Windows环境后缀为.exe） 。而数据文件，简单来说，就是程序运行时读写的数据所在的文件，它的内容不一定是程序代码。比如，一个记录用户信息的文件，或者程序运行过程中生成的日志文件等。
    </p>
    <p>
     <strong>
      每个文件都要有一个独一无二的标识，方便我们识别和引用，这就是文件名
     </strong>
     。文件名由
     <strong>
      文件路径 + 文件名主干 + 文件后缀组
     </strong>
     成，像 “c:\code\test.txt” 就是一个完整的文件名。
    </p>
    <hr/>
    <h2>
     <a id="_22">
     </a>
     三、二进制文件和文本文件
    </h2>
    <p>
     根据数据的组织形式，
     <strong>
      数据文件分为文本文件和二进制文件
     </strong>
     。数据在内存中是
     <strong>
      以二进制形式存储
     </strong>
     的，如果直接把数据不加转换地输出到外存文件中，这个文件就是二进制文件。而如果要求数据在外存上
     <strong>
      以ASCII码的形式存储
     </strong>
     ，那在存储前就需要进行转换，以这种形式存储的文件就是
     <strong>
      文本文件
     </strong>
     。
    </p>
    <hr/>
    <h2>
     <a id="_26">
     </a>
     四、文件的打开和关闭
    </h2>
    <h3>
     <a id="_27">
     </a>
     （一）流和标准流
    </h3>
    <p>
     在C程序里，数据的输入输出操作涉及到各种外部设备，为了方便程序员操作，就引入了“流”的概念。程序的数据通过流来与外部设备进行交互。比如，从键盘输入数据，向屏幕输出数据，以及对文件的读写操作，都是通过流来实现的。
    </p>
    <p>
     C语言程序启动时，会默认打开3个流：
    </p>
    <ul>
     <li>
      <code>
       stdin
      </code>
      - 标准输入流，大多数情况下从键盘输入数据，
      <code>
       scanf
      </code>
      函数就是从标准输入流中读取数据的。
     </li>
     <li>
      <code>
       stdout
      </code>
      - 标准输出流，多数环境下输出到显示器界面，
      <code>
       printf
      </code>
      函数就是将信息输出到标准输出流。
     </li>
     <li>
      <code>
       stderr
      </code>
      - 标准错误流，通常也输出到显示器界面 。
     </li>
    </ul>
    <p>
     这三个流的类型都是
     <code>
      FILE*
     </code>
     ，也就是文件指针，C语言通过文件指针来管理流的各种操作。
    </p>
    <h3>
     <a id="_37">
     </a>
     （二）文件指针
    </h3>
    <p>
     在缓冲文件系统中，文件指针非常重要。每个被使用的文件在内存里都会开辟一个
     <strong>
      文件信息区
     </strong>
     ，用来存放文件的相关信息，像文件名、文件状态以及文件当前的位置等。这些信息保存在一个结构体变量中，这个结构体由系统声明，叫做
     <code>
      FILE
     </code>
     。不同的C编译器中，
     <code>
      FILE
     </code>
     类型包含的内容会有些差异，但大致相似。
    </p>
    <p>
     当我们打开一个文件时，系统会自动创建一个
     <code>
      FILE
     </code>
     结构的变量，并填充好相关信息，我们不用关心具体细节，只需要通过一个
     <code>
      FILE
     </code>
     指针来操作这个文件就可以了。比如：
    </p>
    <pre><code class="prism language-c">FILE<span class="token operator">*</span> pf<span class="token punctuation">;</span> 
</code></pre>
    <p>
     这里定义了一个文件指针变量
     <code>
      pf
     </code>
     ，它可以指向某个文件的文件信息区，通过这个指针就能访问对应的文件。
    </p>
    <h3>
     <a id="_45">
     </a>
     （三）文件的打开与关闭函数
    </h3>
    <p>
     在对文件进行读写操作之前，要先打开文件，使用完后要关闭文件。ANSI C规定用
     <code>
      fopen
     </code>
     函数打开文件，
     <code>
      fclose
     </code>
     函数关闭文件。
     <code>
      fopen
     </code>
     函数的原型是：
    </p>
    <pre><code class="prism language-c">FILE <span class="token operator">*</span> <span class="token function">fopen</span> <span class="token punctuation">(</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> filename<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> mode <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     其中，
     <code>
      filename
     </code>
     是要打开的文件名，
     <code>
      mode
     </code>
     是文件的打开模式。
     <code>
      fclose
     </code>
     函数的原型是：
    </p>
    <pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">fclose</span> <span class="token punctuation">(</span> FILE <span class="token operator">*</span> stream <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <code>
      stream
     </code>
     就是
     <code>
      fopen
     </code>
     函数返回的文件指针。
    </p>
    <p>
     文件的打开模式有很多种，常见的如下：
    </p>
    <p>
     <strong>
      模式大全表：
     </strong>
    </p>
    <table>
     <thead>
      <tr>
       <th>
        模式
       </th>
       <th>
        说明
       </th>
       <th>
        文件存在
       </th>
       <th>
        文件不存在
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        r
       </td>
       <td>
        只读（文本）
       </td>
       <td>
        打开
       </td>
       <td>
        失败
       </td>
      </tr>
      <tr>
       <td>
        w
       </td>
       <td>
        新建写入（清空内容）
       </td>
       <td>
        清空
       </td>
       <td>
        新建
       </td>
      </tr>
      <tr>
       <td>
        a
       </td>
       <td>
        追加写入
       </td>
       <td>
        追加
       </td>
       <td>
        新建
       </td>
      </tr>
      <tr>
       <td>
        r+
       </td>
       <td>
        读写（从开头）
       </td>
       <td>
        打开
       </td>
       <td>
        失败
       </td>
      </tr>
      <tr>
       <td>
        w+
       </td>
       <td>
        新建读写（清空内容）
       </td>
       <td>
        清空
       </td>
       <td>
        新建
       </td>
      </tr>
      <tr>
       <td>
        a+
       </td>
       <td>
        读写（追加写入）
       </td>
       <td>
        打开
       </td>
       <td>
        新建
       </td>
      </tr>
      <tr>
       <td>
        rb
       </td>
       <td>
        二进制只读
       </td>
       <td>
        打开
       </td>
       <td>
        失败
       </td>
      </tr>
      <tr>
       <td>
        wb
       </td>
       <td>
        二进制写入
       </td>
       <td>
        清空
       </td>
       <td>
        新建
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     下面是一个打开和关闭文件的示例代码：
    </p>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    FILE <span class="token operator">*</span> pFile<span class="token punctuation">;</span>
    pFile <span class="token operator">=</span> <span class="token function">fopen</span> <span class="token punctuation">(</span><span class="token string">"myfile.txt"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pFile<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">fputs</span> <span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">fclose</span> <span class="token punctuation">(</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     在这段代码中，我们以 “只写” 模式打开了
     <code>
      myfile.txt
     </code>
     文件，向文件中写入了 “test”，最后关闭了文件。
    </p>
    <hr/>
    <h3>
     <a id="_90">
     </a>
     五、文件的顺序读写
    </h3>
    <p>
     文件的顺序读写是指按照文件内容的先后顺序进行读写操作。C语言提供了一系列函数来实现文件的顺序读写（输入流即为所有输入流）：
    </p>
    <ul>
     <li>
      <code>
       fgetc
      </code>
      ：字符输入函数，用于从输入流中读取
      <strong>
       一个
      </strong>
      字符。
     </li>
     <li>
      <code>
       fputc
      </code>
      ：字符输出函数，向输出流中写入
      <strong>
       一个
      </strong>
      字符。
     </li>
     <li>
      <code>
       fgets
      </code>
      ：文本行输入函数，从输入流中读取
      <strong>
       一行
      </strong>
      文本。
     </li>
     <li>
      <code>
       fputs
      </code>
      ：文本行输出函数，向输出流中写入
      <strong>
       一行
      </strong>
      文本。
     </li>
     <li>
      <code>
       fscanf
      </code>
      ：格式化输入函数，
      <strong>
       按照指定格式
      </strong>
      从输入流中读取数据。
     </li>
     <li>
      <code>
       fprintf
      </code>
      ：格式化输出函数，
      <strong>
       按照指定格式
      </strong>
      向输出流中写入数据。
     </li>
     <li>
      <code>
       fread
      </code>
      ：二进制输入函数，用于从
      <strong>
       文件
      </strong>
      中读取二进制数据。
     </li>
     <li>
      <code>
       fwrite
      </code>
      ：二进制输出函数，向
      <strong>
       文件
      </strong>
      中写入二进制数据。
     </li>
    </ul>
    <p>
     下面是一个使用
     <code>
      fputc
     </code>
     和
     <code>
      fgetc
     </code>
     函数进行文件读写的示例：
    </p>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    FILE <span class="token operator">*</span>fp1<span class="token punctuation">,</span> <span class="token operator">*</span>fp2<span class="token punctuation">;</span>
    <span class="token keyword">char</span> ch<span class="token punctuation">;</span>
    <span class="token comment">// 以只写模式打开文件1</span>
    fp1 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"file1.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fp1 <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"无法打开文件1\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 向文件1中写入字符</span>
    <span class="token function">fputc</span><span class="token punctuation">(</span><span class="token char">'A'</span><span class="token punctuation">,</span> fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fputc</span><span class="token punctuation">(</span><span class="token char">'B'</span><span class="token punctuation">,</span> fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fputc</span><span class="token punctuation">(</span><span class="token char">'C'</span><span class="token punctuation">,</span> fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 以只读模式打开文件1</span>
    fp2 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"file1.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fp2 <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"无法打开文件1\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 从文件1中读取字符并输出</span>
    ch <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>ch <span class="token operator">!=</span> <span class="token constant">EOF</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c "</span><span class="token punctuation">,</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ch <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     在这个示例中，我们先以只写模式打开
     <code>
      file1.txt
     </code>
     文件，向里面写入了
     <code>
      A
     </code>
     、
     <code>
      B
     </code>
     、
     <code>
      C
     </code>
     三个字符，然后关闭文件。接着又以只读模式打开这个文件，使用
     <code>
      fgetc
     </code>
     函数逐个读取字符并输出到屏幕上。
    </p>
    <hr/>
    <h3>
     <a id="_142">
     </a>
     六、文件的随机读写
    </h3>
    <p>
     有时候，我们需要在文件中随机地读写数据，而不是按顺序读写。C语言提供了几个函数来实现文件的随机读写：
    </p>
    <ul>
     <li>
      <code>
       fseek
      </code>
      ：
      <strong>
       根据文件指针的位置和偏移量来定位文件指针
      </strong>
      。函数原型为
      <code>
       int fseek ( FILE * stream, long int offset, int origin );
      </code>
      ，
      <code>
       stream
      </code>
      是文件指针，
      <code>
       offset
      </code>
      是偏移量，
      <code>
       origin
      </code>
      是起始位置，取值可以是
      <code>
       SEEK_SET
      </code>
      （文件开头）、
      <code>
       SEEK_CUR
      </code>
      （当前位置）、
      <code>
       SEEK_END
      </code>
      （文件末尾）。
     </li>
     <li>
      <code>
       ftell
      </code>
      ：返回文件指针相对于起始位置的
      <strong>
       偏移量
      </strong>
      ，函数原型为
      <code>
       long int ftell ( FILE * stream );
      </code>
      。
     </li>
     <li>
      <code>
       rewind
      </code>
      ：让文件指针的位置回到文件的
      <strong>
       起始位置
      </strong>
      ，函数原型为
      <code>
       void rewind ( FILE * stream );
      </code>
      。
     </li>
    </ul>
    <p>
     下面是一个使用
     <code>
      fseek
     </code>
     函数的示例：
    </p>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    FILE <span class="token operator">*</span> pFile<span class="token punctuation">;</span>
    pFile <span class="token operator">=</span> <span class="token function">fopen</span> <span class="token punctuation">(</span> <span class="token string">"example.txt"</span> <span class="token punctuation">,</span> <span class="token string">"wb"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fputs</span> <span class="token punctuation">(</span> <span class="token string">"This is an apple."</span> <span class="token punctuation">,</span> pFile <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fseek</span> <span class="token punctuation">(</span> pFile <span class="token punctuation">,</span> <span class="token number">9</span> <span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fputs</span> <span class="token punctuation">(</span> <span class="token string">" sam"</span> <span class="token punctuation">,</span> pFile <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span> <span class="token punctuation">(</span> pFile <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     在这段代码中，我们先向
     <code>
      example.txt
     </code>
     文件中写入了 “This is an apple.”，然后使用
     <code>
      fseek
     </code>
     函数将文件指针
     <strong>
      移动到第9个字符的位置
     </strong>
     （
     <code>
      origin + offset
     </code>
     ），接着再写入 “ sam”。这样，文件的内容就变成了 “This is a sampple.” 。
    </p>
    <hr/>
    <h3>
     <a id="_165">
     </a>
     七、文件读取结束的判定
    </h3>
    <h4>
     <a id="feof_166">
     </a>
     （一）feof()函数
    </h4>
    <h4>
     <a id="1__167">
     </a>
     1. 文本文件的读取结束判定
    </h4>
    <p>
     <code>
      feof()
     </code>
     是C标准库中专门用于
     <strong>
      检测文件结束
     </strong>
     的函数。它的原型如下：
    </p>
    <pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">feof</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      <strong>
       返回值
      </strong>
      ：
      <ul>
       <li>
        非零值（true）：已到达文件末尾
       </li>
       <li>
        0（false）：未到达文件末尾
       </li>
      </ul>
     </li>
    </ul>
    <p>
     <strong>
      注意
     </strong>
     ：
     <code>
      feof()
     </code>
     只有在尝试
     <strong>
      读取超出文件末尾的数据后才会返回
      <code>
       true
      </code>
     </strong>
     。（也就是说，遇到错误停止时，如果没到末尾，也返回
     <code>
      false
     </code>
     ，这就会导致实际上已经结束了，但是
     <code>
      feof()
     </code>
     认为没有结束）因此，不能直接用
     <code>
      feof
     </code>
     函数的返回值来判断文件是否结束，通常需要结合其他函数使用。
    </p>
    <h4>
     <a id="_180">
     </a>
     （一）文本文件读取结束判定示例
    </h4>
    <p>
     对于文本文件，我们可以通过判断返回值是否为
     <code>
      EOF
     </code>
     （
     <code>
      fgetc
     </code>
     函数）或者
     <code>
      NULL
     </code>
     （
     <code>
      fgets
     </code>
     函数）来确定是否读取结束。例如：
    </p>
    <h5>
     <a id="1__fgetc__feof_183">
     </a>
     1. 使用 fgetc() 和 feof()
    </h5>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    FILE <span class="token operator">*</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"example.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"文件打开失败！\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">int</span> ch<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ch <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">EOF</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 读取字符</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出字符</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n已到达文件末尾\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n读取过程中发生错误\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="2__fgets__feof_210">
     </a>
     2. 使用 fgets() 和 feof()
    </h5>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    FILE <span class="token operator">*</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"example.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"文件打开失败！\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">fgets</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> fp<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 读取一行</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n已到达文件末尾\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n读取过程中发生错误\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="__240">
     </a>
     （二） 二进制文件的读取结束判定
    </h4>
    <h5>
     <a id="1__fread__242">
     </a>
     1. 使用 fread() 的返回值
    </h5>
    <p>
     <code>
      fread()
     </code>
     函数返回实际读取的数据项数量。
     <strong>
      如果返回值小于请求的数量，则可能到达文件末尾或发生错误。
     </strong>
    </p>
    <pre><code class="prism language-c"><span class="token class-name">size_t</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> size<span class="token punctuation">,</span> <span class="token class-name">size_t</span> count<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      <strong>
       返回值
      </strong>
      ：实际读取的数据项数量，返回值为 &lt; 0，到达末尾或错误
     </li>
    </ul>
    <p>
     <strong>
      示例：
     </strong>
    </p>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    FILE <span class="token operator">*</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"data.bin"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"文件打开失败！\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">int</span> buffer<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">size_t</span> itemsRead<span class="token punctuation">;</span>
    <span class="token comment">// read()返回值 &lt; 0 : 到达末尾 or 错误</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>itemsRead <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> itemsRead<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span> buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n已到达文件末尾\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n读取过程中发生错误\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_284">
     </a>
     （三）错误处理
    </h4>
    <ul>
     <li>
      除了检查文件结束，还应该检查是否发生了其他错误。可以使用
      <code>
       ferror()
      </code>
      函数：
     </li>
    </ul>
    <pre><code class="prism language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"读取过程中发生错误\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_294">
     </a>
     八、文件缓冲区
    </h3>
    <p>
     ANSI C标准采用“缓冲文件系统”来处理数据文件。在这种系统下，系统会自动在内存中
     <strong>
      为每个正在使用的文件开辟一块“文件缓冲区”
     </strong>
     。
    </p>
    <p>
     从内存向磁盘输出数据时，数据会先被送到内存中的缓冲区，等缓冲区装满后，才会一起被送到磁盘上。从磁盘向计算机读入数据时，先从磁盘文件中读取数据到内存缓冲区，装满缓冲区后，再逐个将数据送到程序数据区。缓冲区的大小由C编译系统决定。
    </p>
    <p>
     下面的代码展示了文件缓冲区的作用：
    </p>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    FILE<span class="token operator">*</span>pf <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">"abcdef"</span><span class="token punctuation">,</span> pf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"睡眠10秒-已经写数据了,打开test.txt文件,发现文件没有内容\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"刷新缓冲区\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fflush</span><span class="token punctuation">(</span>pf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"再睡眠10秒-此时,再次打开test.txt文件,文件有内容了\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>pf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     在这段代码中，我们向文件写入 “abcdef” 后，文件中并不会立即出现这些内容，因为
     <strong>
      数据先存放在缓冲区
     </strong>
     中。当我们调用
     <code>
      fflush
     </code>
     函数
     <strong>
      刷新缓冲区
     </strong>
     或者调用
     <code>
      fclose
     </code>
     函数（自动刷新缓冲区）关闭文件时，缓冲区的数据才会真正写入到文件中。
    </p>
    <hr/>
    <blockquote>
     <p>
      🌈我的分享也就到此结束啦🌈
      <br/>
      要是我的分享也能对你的学习起到帮助，那简直是太酷啦！
      <br/>
      若有不足，还请大家多多指正，我们一起学习交流！
      <br/>
      📢公主，王子：点赞👍→收藏⭐→关注🔍
      <br/>
      感谢大家的观看和支持！祝大家都能得偿所愿，天天开心！！！
     </p>
    </blockquote>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f74616e5f72756e2f:61727469636c652f64657461696c732f313436303838323130" class_="artid" style="display:none">
 </p>
</div>


