---
layout: post
title: "OllamaOpenWebUI本地部署大模型"
date: 2025-03-15 23:56:49 +0800
description: "Ollama是一个开源项目，用于在本地计算机上运行大型语言模型（LLMs）的工具，它的底层是使用Docker，所以支持类似Docker的构建方式，大模型就是它的镜像。它支持多种模型格式，包括但不限于GGUF，允许用户在没有高性能GPU或不希望使用云服务的情况下，利用个人计算机的资源来执行复杂的语言任务。Ollama极大简化了大模型私有部署步骤，使得大模型运行像Docker一样简单方便。"
keywords: "Ollama+OpenWebUI本地部署大模型"
categories: ['未分类']
tags: ['Openwebui', 'Ollama', 'Ollama']
artid: "139013622"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=139013622
    alt: "OllamaOpenWebUI本地部署大模型"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=139013622
featuredImagePreview: https://bing.ee123.net/img/rand?artid=139013622
cover: https://bing.ee123.net/img/rand?artid=139013622
image: https://bing.ee123.net/img/rand?artid=139013622
img: https://bing.ee123.net/img/rand?artid=139013622
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Ollama+OpenWebUI本地部署大模型
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="_2">
     </a>
     前言
    </h2>
    <p>
     Ollama是一个开源项目，用于在本地计算机上运行大型语言模型（LLMs）的工具，它的底层是使用Docker，所以支持类似Docker的构建方式，大模型就是它的镜像。它支持多种模型格式，包括但不限于GGUF，允许用户在没有高性能GPU或不希望使用云服务的情况下，利用个人计算机的资源来执行复杂的语言任务。
    </p>
    <h2>
     <a id="Ollama_5">
     </a>
     Ollama使用
    </h2>
    <h3>
     <a id="Ollama_6">
     </a>
     Ollama安装
    </h3>
    <p>
     根据自己的平台选择下载对应的工具，
     <a href="https://ollama.com/download" rel="nofollow">
      下载地址
     </a>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/80c0b09254a80bc63865937a5e94e597.png">
      <br/>
      右击使用管理员权限安装，成功后会弹出下面框。
      <br/>
      输入ollama list 可以查看本地有哪些模型
     </img>
    </p>
    <blockquote>
     <p>
      ollama list
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e29a5098bf1d6ce1da5e6f7e6dade601.png"/>
     </p>
    </blockquote>
    <p>
     想要查看支持哪些模型，可以点击官网
     <a href="https://ollama.com/library" rel="nofollow">
      中央仓库
     </a>
     ，支持的模型很多。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a70e18b7e0a44b28a388e056ef4f3d14.png"/>
    </p>
    <p>
     Ollama支持的参数：
    </p>
    <pre><code>Usage:
  ollama [flags]
  ollama [command]

Available Commands:
  serve       Start ollama
  create      Create a model from a Modelfile
  show        Show information for a model
  run         Run a model
  pull        Pull a model from a registry
  push        Push a model to a registry
  list        List models
  cp          Copy a model
  rm          Remove a model
  help        Help about any command

Flags:
  -h, --help      help for ollama
  -v, --version   Show version information
</code></pre>
    <h3>
     <a id="Ollama_40">
     </a>
     Ollama修改配置
    </h3>
    <p>
     在拉取Ollama 大模型之前，需要修改Ollma两个配置，直接在电脑环境变量中添加以下两个系统变量,一个是方便局域网法访问，一个是避免C盘被占用过大：
    </p>
    <ul>
     <li>
      OLLAMA_HOST：修改为0.0.0.0:11434，以便局域网访问
     </li>
     <li>
      OLLAMA_MODELS：默认为C盘，需要修改为其他磁盘。
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d06b0d5988f62dfa913a81474ab1fa68.png"/>
    </p>
    <p>
     退出重登Ollama，重新打开PowelShell窗口，输入本机的ip，返回running即为修改Ip成功 :
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/30b46f2fdcbef0061b70be388fdda8a5.png"/>
    </p>
    <h3>
     <a id="Ollama__51">
     </a>
     Ollama 拉取远程大模型
    </h3>
    <p>
     ollama pull以及ollama run都可以拉取大模型，run拉取后会直接运行大模型
    </p>
    <pre><code>ollama run codellama:7b
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/509e30614a285e83965d483e735a9833.png">
      <br/>
      <code>
       注意
      </code>
      ：可能会遇到以下类似的问题，大部分是网络环境问题。多试几次或者切换代理网络即可。
     </img>
    </p>
    <pre><code>Error: pull model manifest: Get "https://registry.ollama.ai/v2/library/codellama/manifests/7b": dial tcp: lookup registry.ollama.ai: no such host
</code></pre>
    <h3>
     <a id="Ollama__62">
     </a>
     Ollama 构建本地大模型
    </h3>
    <p>
     Ollama除了可以使用官方自带的模型，也可以使用我们已经量化好的gguf模型。在模型所在位置，新建个Modelfile，内容如下：
    </p>
    <pre><code>FROM ./llama-2-7b-chat.Q4_K_M.gguf

# set prompt template
TEMPLATE """[INST] &lt;&lt;SYS&gt;&gt;{<!-- -->{ .System }}&lt;&lt;/SYS&gt;&gt;

{<!-- -->{ .Prompt }} [/INST]
"""

# set parameters
PARAMETER stop "[INST]"
PARAMETER stop "[/INST]"
PARAMETER stop "&lt;&lt;SYS&gt;&gt;"
PARAMETER stop "&lt;&lt;/SYS&gt;&gt;"

# set system message
SYSTEM """
You are a helpful assistant.
"""
</code></pre>
    <p>
     使用PowerShell，切换到模型目录下，执行以下命令，构建模型
    </p>
    <pre><code>ollama create my-model2 -f .\Modelfile
</code></pre>
    <p>
     创建成功后：
    </p>
    <pre><code>ollama list
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2c3ea3f59cf7e72c46ea48d18a28976f.png"/>
    </p>
    <p>
     Ollama 下载的模型默认情况下都是经过量化的，如果要使用未经量化的模型，可以在
     <a href="https://huggingface.co/" rel="nofollow">
      huggingface
     </a>
     （Hugging Face 起初是NLP机器学习服务商，开源了非常出名的自然语言处理应用构建的 transformers 库。随着大模型流行，Hugging Face转向了机器学习的社区服务，类似于代码服务的github） 下载指定的模型，并使用上述方式进行运行。
    </p>
    <h3>
     <a id="Ollama__97">
     </a>
     Ollama 运行本地模型：
    </h3>
    <h4>
     <a id="_98">
     </a>
     命令行交互
    </h4>
    <pre><code>ollama run my-model2
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ee2481978be6b1a28ce80a2dcccc9e5d.png"/>
    </p>
    <h4>
     <a id="Api_103">
     </a>
     Api调用
    </h4>
    <p>
     Ollama run之后就可以直接使用api接口调用，调用方式POST:
     <br/>
     url:
    </p>
    <pre><code>http://127.0.0.1:11434/api/generate
</code></pre>
    <p>
     请求体,修改成你执行的model：
    </p>
    <pre><code>{
  "model": "codellama:7b",
  "prompt": "Why is the sky blue?",
    "format": "json",
  "stream": false
}
</code></pre>
    <p>
     返回数据：
    </p>
    <pre><code>{
    "model": "codellama:7b",
    "created_at": "2024-05-18T08:05:25.3502395Z",
    "response": "{\n\"The sky appears blue because of a phenomenon called Rayleigh scattering, which occurs when sunlight interacts with the Earth's atmosphere. When light travels through a medium, such as air or water, it encounters particles that can scatter it in different directions. In the case of the Earth's atmosphere, the tiny molecules of gases, such as nitrogen and oxygen, scatter shorter wavelengths of light (like blue and violet) more than longer wavelengths (like red and orange). This is known as the Rayleigh scattering effect.\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "done": false
}
</code></pre>
    <h4>
     <a id="Web__127">
     </a>
     Web 端调用
    </h4>
    <p>
     Ollama 如果想要在Web端使用，需要借助OpenWebUI 这个工具。OpenWebUI 是一个为大型语言模型（LLM）设计的开源Web界面，它提供了一个用户友好的交互方式来管理和运行这些模型。OpenWebUI 可以与不同的LLM运行程序集成，包括但不限于Ollama和OpenAI兼容的API
    </p>
    <p>
     推荐使用docker 启动OpenWebUI，如果你的Ollama与OpenWebUI部署在同一服务器上，则使用以下命令
    </p>
    <pre><code>docker run -d -p 3000:8080 --add-host=host.docker.internal:host-gateway -v open-webui:/app/backend/data --name ollama-web --restart always ghcr.io/open-webui/open-webui:main
</code></pre>
    <p>
     如果不是在同一机器，则加个参数OLLAMA_BASE_URL
    </p>
    <pre><code>docker run -d -p 3000:8080 -e OLLAMA_BASE_URL=http://10.11.24.27 -v open-webui:/app/backend/data --name ollama-web --restart always ghcr.io/open-webui/open-webui:main
</code></pre>
    <p>
     启动后输入
     <br/>
     http://localhost:3000/或者http://10.11.24.27:3000/会跳转到如下页面
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/862f844f12830361cff63dfab2e82145.png"/>
     <br/>
     点击注册，注册信息可以随意写，注册后跳转到该页面
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/48fc03b3b4142bd17718c6ecba31494c.png"/>
    </p>
    <p>
     选择模型后可以开始对话
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/385539951edecb536f97d21545bb4c43.png"/>
     <br/>
     OpenWebUI 也支持下载模型，点击setting 页面，输入模型qwen:0.5b
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a9438e52bc0e0598d43b1e3c3f686fa3.png"/>
     <br/>
     成功后会有提示
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c5988dae08774b2f70c54fcb3f5d869f.png"/>
     <br/>
     切换到qwen:0.5b问答。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b6f2d227c549e059484d0e08427090c4.png"/>
     <br/>
     整体来说OpenWebUI用起来会比较方便。
    </p>
    <h2>
     <a id="_157">
     </a>
     总结
    </h2>
    <p>
     Ollama极大简化了大模型私有部署步骤，使得大模型运行像Docker一样简单方便。Ollama 还提供Api的方式，集成Langchain等应用也就方便了很多，结合OpenWebUI可以体验类似ChatGpt的交互，方便使用。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f4c414e4e59383538382f:61727469636c652f64657461696c732f313339303133363232" class_="artid" style="display:none">
 </p>
</div>


