---
layout: post
title: "Tsfresh-TA-Lib-LightGBM-A-股市场量化投资策略实战入门"
date: 2025-03-16 20:25:30 +0800
description: "本文介绍了一个面向A股市场的量化投资策略实战项目，涵盖数据获取、特征提取、模型训练、策略制定与回测评估等环节，旨在为量化技术初学者提供一个系统的入门指南。"
keywords: "Tsfresh + TA-Lib + LightGBM ：A 股市场量化投资策略实战入门"
categories: ['金融科技', 'Python']
tags: ['量化技术', '策略开发', 'Tsfresh', 'Python', 'Lightgbm', 'Lib']
artid: "146300781"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146300781
    alt: "Tsfresh-TA-Lib-LightGBM-A-股市场量化投资策略实战入门"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146300781
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146300781
cover: https://bing.ee123.net/img/rand?artid=146300781
image: https://bing.ee123.net/img/rand?artid=146300781
img: https://bing.ee123.net/img/rand?artid=146300781
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Tsfresh + TA-Lib + LightGBM ：A 股市场量化投资策略实战入门
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="Tsfresh__TALib__LightGBM_A__0">
     </a>
     Tsfresh + TA-Lib + LightGBM ：A 股市场量化投资策略实战入门
    </h2>
    <blockquote>
     <p>
      本项目以 A 股市场为研究对象，通过量化技术对市场数据进行分析，构建量化投资策略，并利用历史数据回测验证策略的有效性。项目旨在为量化技术初学者提供一个系统的学习框架，帮助读者掌握从数据获取到策略评估的全流程操作。
      <br/>
      <em>
       文中内容仅限技术学习与代码实践参考，市场存在不确定性，技术分析需谨慎验证，不构成任何投资建议。适合量化新手建立系统认知，为策略开发打下基础。
      </em>
     </p>
    </blockquote>
    <p>
     ‼️ 学习基础知识推荐阅读
     <a href="https://blog.csdn.net/weixin_47339916/category_12907174.html">
      Python 金融科技 技术专栏 🚀
     </a>
     ：
    </p>
    <ul>
     <li>
      <a href="https://stock.blog.csdn.net/article/details/146287009" rel="nofollow">
       tsfresh：时间序列特征自动提取与应用 🔥
      </a>
     </li>
     <li>
      <a href="https://stock.blog.csdn.net/article/details/146275433" rel="nofollow">
       深入TA-Lib：量化技术指标详解 🔥
      </a>
     </li>
     <li>
      <a href="https://stock.blog.csdn.net/article/details/146050258" rel="nofollow">
       Pandas+PyArrow：股票数据存储 Parquet 入门指引 🔥
      </a>
     </li>
     <li>
      <a href="https://stock.blog.csdn.net/article/details/146264849" rel="nofollow">
       Dask：Python高效并行计算利器 🔥
      </a>
     </li>
    </ul>
    <h3>
     <a id="1__12">
     </a>
     1. 项目概述
    </h3>
    <h4>
     <a id="11__14">
     </a>
     1.1 项目目标
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        数据获取与存储
       </strong>
       <br/>
       使用 tushare 工具获取 A 股股票的历史日线数据，确保数据的准确性和完整性。借助 Dask 和 Parquet 技术进行数据存储，优化数据读写效率，为后续分析提供支持。
      </p>
     </li>
     <li>
      <p>
       <strong>
        特征提取与筛选
       </strong>
       <br/>
       利用 tsfresh 提取时间序列特征，从历史数据中挖掘与股票未来收益率相关的特征。通过相关性分析和特征筛选，确定对预测目标具有显著影响的特征集合。
      </p>
     </li>
     <li>
      <p>
       <strong>
        模型训练与优化
       </strong>
       <br/>
       基于筛选后的特征，使用 LightGBM 机器学习算法进行模型训练，并通过 Optuna 进行超参数优化。目标是构建一个能够有效预测股票未来收益率的模型。
      </p>
     </li>
     <li>
      <p>
       <strong>
        交易策略制定与回测评估
       </strong>
       <br/>
       根据模型预测结果，设计量化交易策略，并通过历史数据回测验证策略性能。优化策略的信号生成和买卖时机，计算策略评价指标（如夏普比率、最大回撤等），并绘制策略表现曲线。
      </p>
     </li>
     <li>
      <p>
       <strong>
        风险收益分析与策略优化
       </strong>
       <br/>
       分析策略的风险收益特征，结合回测结果优化策略参数。通过详细解读策略表现，帮助读者理解策略的优势与不足，为进一步优化提供方向。
      </p>
     </li>
    </ol>
    <h4>
     <a id="12__31">
     </a>
     1.2 项目意义
    </h4>
    <p>
     本项目旨在为量化技术初学者提供一个完整的实战案例，涵盖数据处理、特征工程、模型训练、策略回测和风险分析等关键环节。通过系统的学习和实践，读者可以掌握量化技术的基本方法，理解量化策略的构建过程，并为进一步深入研究打下坚实基础。
    </p>
    <h3>
     <a id="2__35">
     </a>
     2. 技术介绍
    </h3>
    <h4>
     <a id="21_Tushare_37">
     </a>
     2.1 Tushare
    </h4>
    <p>
     <strong>
      <code>
       Tushare
      </code>
     </strong>
     是一个免费且开源的金融数据接口库，它主要服务于Python开发者。通过Tushare，用户可以轻松获取股票、期货、外汇等多种类型的金融市场数据。其特点包括：
    </p>
    <ul>
     <li>
      <strong>
       丰富的数据源
      </strong>
      ：支持从A股到美股、港股等全球多个市场的数据。
     </li>
     <li>
      <strong>
       易于使用
      </strong>
      ：提供了简洁的API接口，方便用户快速上手。
     </li>
     <li>
      <strong>
       社区活跃
      </strong>
      ：拥有庞大的用户群体和活跃的社区支持，不断更新维护。
     </li>
     <li>
      <strong>
       文档详尽
      </strong>
      ：官方提供了详细的文档教程，帮助新手入门。
     </li>
    </ul>
    <h4>
     <a id="22_Tsfresh_46">
     </a>
     2.2 Tsfresh
    </h4>
    <p>
     <strong>
      <code>
       Tsfresh (Time Series Feature extraction based on scalable hypothesis tests)
      </code>
     </strong>
     是一个强大的时间序列特征提取工具，旨在自动识别出对于预测任务有用的特征。它的优势在于：
    </p>
    <ul>
     <li>
      <strong>
       自动化
      </strong>
      ：能够自动生成数百种可能对模型有用的特征，减少了手动选择特征的工作量。
     </li>
     <li>
      <strong>
       高效性
      </strong>
      ：利用并行处理技术提高特征提取的速度。
     </li>
     <li>
      <strong>
       灵活性
      </strong>
      ：不仅限于特定类型的时间序列数据，适用于多种场景下的数据分析。
     </li>
     <li>
      <strong>
       集成友好
      </strong>
      ：与Scikit-learn等流行机器学习库良好兼容。
     </li>
    </ul>
    <h4>
     <a id="23_Dask_55">
     </a>
     2.3 Dask
    </h4>
    <p>
     <strong>
      <code>
       Dask
      </code>
     </strong>
     是一种灵活的并行计算库，特别适合处理超出内存限制的大规模数据集。它的特性有：
    </p>
    <ul>
     <li>
      <strong>
       扩展性强
      </strong>
      ：既可以在单机上运行也可以部署在分布式集群中。
     </li>
     <li>
      <strong>
       动态调度
      </strong>
      ：根据任务需求智能调整资源分配。
     </li>
     <li>
      <strong>
       接口熟悉
      </strong>
      ：设计风格类似于Pandas和NumPy，降低了学习成本。
     </li>
     <li>
      <strong>
       生态系统丰富
      </strong>
      ：支持多种存储格式如HDF5、Parquet等，并与其他大数据框架（如Spark）具有良好的互操作性。
     </li>
    </ul>
    <h4>
     <a id="24_Parquet_64">
     </a>
     2.4 Parquet
    </h4>
    <p>
     <strong>
      <code>
       Parquet
      </code>
     </strong>
     是一种列式存储格式，广泛应用于大数据领域。相比于传统的行式存储，Parquet的优势在于：
    </p>
    <ul>
     <li>
      <strong>
       压缩效率高
      </strong>
      ：采用列式存储可以更有效地压缩相同类型的数据。
     </li>
     <li>
      <strong>
       查询速度快
      </strong>
      ：仅读取需要分析的列，避免了不必要的I/O开销。
     </li>
     <li>
      <strong>
       跨平台兼容
      </strong>
      ：被许多主流的大数据处理系统支持，如Apache Spark, Apache Hadoop等。
     </li>
     <li>
      <strong>
       元数据丰富
      </strong>
      ：文件内嵌入了详细的统计信息，便于进行预处理优化。
     </li>
    </ul>
    <h4>
     <a id="25_LightGBM_73">
     </a>
     2.5 LightGBM
    </h4>
    <p>
     <strong>
      <code>
       LightGBM
      </code>
     </strong>
     是由微软开发的一种基于梯度提升决策树算法的机器学习框架，以其实现速度和准确性著称。主要优点如下：
    </p>
    <ul>
     <li>
      <strong>
       高效性
      </strong>
      ：采用了GOSS (Gradient-based One-Side Sampling) 和 EFB (Exclusive Feature Bundling) 等创新技术来加速训练过程。
     </li>
     <li>
      <strong>
       内存占用小
      </strong>
      ：相较于其他同类算法，在处理大规模数据时更加节省内存。
     </li>
     <li>
      <strong>
       易于使用
      </strong>
      ：提供了Python、R等多个语言版本的支持，并且配置选项丰富。
     </li>
     <li>
      <strong>
       性能优越
      </strong>
      ：在多项基准测试中表现出色，特别是在分类问题上。
     </li>
    </ul>
    <h4>
     <a id="26_Optuna_82">
     </a>
     2.6 Optuna
    </h4>
    <p>
     <strong>
      <code>
       Optuna
      </code>
     </strong>
     是一款专为超参数优化设计的开源软件库，可以帮助研究人员或工程师更快地找到最优的模型配置。特色功能包括：
    </p>
    <ul>
     <li>
      <strong>
       简单易用
      </strong>
      ：只需几行代码即可启动搜索过程。
     </li>
     <li>
      <strong>
       灵活性高
      </strong>
      ：支持定义复杂的搜索空间以及自定义目标函数。
     </li>
     <li>
      <strong>
       可视化好
      </strong>
      ：内置了丰富的图表绘制功能，便于观察优化过程。
     </li>
     <li>
      <strong>
       多后端支持
      </strong>
      ：既可以单独运行也可以集成到现有的机器学习流水线中。
     </li>
    </ul>
    <h4>
     <a id="27_TALib_91">
     </a>
     2.7 TA-Lib
    </h4>
    <p>
     <strong>
      <code>
       TA-Lib (Technical Analysis Library)
      </code>
     </strong>
     是一个广泛使用的开源技术分析库，主要用于金融市场的技术指标计算。其特点包括：
    </p>
    <ul>
     <li>
      <strong>
       全面的技术指标
      </strong>
      ：提供了超过150种常用的技术分析指标，如移动平均线、MACD、RSI等。
     </li>
     <li>
      <strong>
       高性能
      </strong>
      ：底层实现是用C语言编写的，确保了计算速度。
     </li>
     <li>
      <strong>
       多语言支持
      </strong>
      ：除了原生的C语言外，还提供了Python、Java、C#等多种语言的绑定。
     </li>
     <li>
      <strong>
       易于集成
      </strong>
      ：可以很容易地与Pandas等数据处理库结合使用，适用于各种金融分析和交易策略开发。
     </li>
     <li>
      <strong>
       社区活跃
      </strong>
      ：拥有活跃的用户社区和丰富的文档资源，便于学习和使用。
     </li>
    </ul>
    <h3>
     <a id="3__101">
     </a>
     3. 项目结构
    </h3>
    <pre><code class="prism language-text">project_root/
├── data/
│   ├── raw_data.parquet
│   ├── selected_features.parquet
│   └── target.parquet
├── src/
│   ├── data_loader.py
│   ├── feature_engineering.py
│   ├── final_model.txt
│   ├── model_training.py
│   ├── strategy_backtesting.py
│   └── utils.py
├── README.md
└── requirements.txt
</code></pre>
    <h4>
     <a id="_120">
     </a>
     详细说明
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        <code>
         data/
        </code>
       </strong>
       ：存放数据文件的目录。
      </p>
      <ul>
       <li>
        <code>
         raw_data.parquet
        </code>
        ：从 Tushare 获取的原始股票历史日线数据。
       </li>
       <li>
        <code>
         selected_features.parquet
        </code>
        ：经过特征工程处理后选择的特征数据。
       </li>
       <li>
        <code>
         target.parquet
        </code>
        ：目标变量数据（未来收益率）。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        <code>
         src/
        </code>
       </strong>
       ：存放源代码文件的目录。
      </p>
      <ul>
       <li>
        <code>
         data_loader.py
        </code>
        ：用于从 Tushare 获取股票历史日线数据并保存为 Parquet 文件。
       </li>
       <li>
        <code>
         feature_engineering.py
        </code>
        ：用于提取时间序列特征并选择与目标变量相关的特征。
       </li>
       <li>
        <code>
         final_model.txt
        </code>
        ：训练好的 LightGBM 模型文件。
       </li>
       <li>
        <code>
         model_training.py
        </code>
        ：用于训练机器学习模型，并使用 Optuna 进行超参数优化。
       </li>
       <li>
        <code>
         strategy_backtesting.py
        </code>
        ：用于回测策略并评估策略性能。
       </li>
       <li>
        <code>
         utils.py
        </code>
        ：包含一些辅助函数，如计算未来收益率、技术指标等。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        <code>
         README.md
        </code>
       </strong>
       ：项目说明文档，包含项目概述、安装步骤、使用方法等信息。
      </p>
      <pre><code class="prism language-bash"><span class="token comment"># 安装项目依赖：</span>
pip <span class="token function">install</span> <span class="token parameter variable">-r</span> requirements.txt
<span class="token builtin class-name">cd</span> src
<span class="token comment"># 数据获取</span>
python data_loader.py
<span class="token comment"># 特征工程</span>
python feature_engineering.py
<span class="token comment"># 模型训练</span>
python model_training.py
<span class="token comment"># 策略回测</span>
python strategy_backtesting.py
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        <code>
         requirements.txt
        </code>
       </strong>
       ：项目依赖库列表，用于安装所需的 Python 包。
      </p>
      <pre><code class="prism language-text">tushare
tsfresh
lightgbm
optuna
pandas
numpy
scikit-learn
ta-lib
pyarrow
matplotlib
</code></pre>
     </li>
    </ul>
    <h3>
     <a id="3__166">
     </a>
     3. 代码实现
    </h3>
    <h4>
     <a id="31__data_loaderpy_168">
     </a>
     3.1 数据加载 (
     <code>
      data_loader.py
     </code>
     )
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># src/data_loader.py</span>
<span class="token keyword">import</span> tushare <span class="token keyword">as</span> ts

<span class="token keyword">def</span> <span class="token function">load_stock_data</span><span class="token punctuation">(</span>stock_code<span class="token punctuation">,</span> start_date<span class="token punctuation">,</span> end_date<span class="token punctuation">,</span> save_path<span class="token operator">=</span><span class="token string">"../data/raw_data.parquet"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    从Tushare API下载股票历史日线数据并保存。

    :param stock_code: 股票代码
    :param start_date: 开始日期
    :param end_date: 结束日期
    :param save_path: 保存路径
    """</span>
    <span class="token comment"># Tushare Pro API token</span>
    ts<span class="token punctuation">.</span>set_token<span class="token punctuation">(</span><span class="token string">"your_token"</span><span class="token punctuation">)</span>  <span class="token comment"># 设置 Tushare API 的访问令牌</span>
    pro <span class="token operator">=</span> ts<span class="token punctuation">.</span>pro_api<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 初始化 Tushare Pro API 客户端</span>

    df <span class="token operator">=</span> pro<span class="token punctuation">.</span>daily<span class="token punctuation">(</span>ts_code<span class="token operator">=</span>stock_code<span class="token punctuation">,</span> start_date<span class="token operator">=</span>start_date<span class="token punctuation">,</span> end_date<span class="token operator">=</span>end_date<span class="token punctuation">)</span>  <span class="token comment"># 获取指定股票在指定日期范围内的日线数据</span>
    df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 按交易日期排序</span>

    df<span class="token punctuation">.</span>to_parquet<span class="token punctuation">(</span>
        path<span class="token operator">=</span>save_path<span class="token punctuation">,</span>
        engine<span class="token operator">=</span><span class="token string">"pyarrow"</span><span class="token punctuation">,</span>
        compression<span class="token operator">=</span><span class="token string">"snappy"</span><span class="token punctuation">,</span>
        index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>  <span class="token comment"># 将数据保存为 Parquet 文件，使用 Snappy 压缩</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Data saved to </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>save_path<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 打印保存路径</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    load_stock_data<span class="token punctuation">(</span><span class="token string">"600519.SH"</span><span class="token punctuation">,</span> <span class="token string">"20200101"</span><span class="token punctuation">,</span> <span class="token string">"20240101"</span><span class="token punctuation">)</span>  <span class="token comment"># 贵州茅台（600519）</span>
</code></pre>
    <h4>
     <a id="32__feature_engineeringpy_203">
     </a>
     3.2 特征工程 (
     <code>
      feature_engineering.py
     </code>
     )
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># src/feature_engineering.py</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> talib
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestRegressor
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_selection <span class="token keyword">import</span> RFE<span class="token punctuation">,</span> SelectFromModel<span class="token punctuation">,</span> SelectKBest<span class="token punctuation">,</span> f_regression<span class="token punctuation">,</span> mutual_info_regression
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> Lasso
<span class="token keyword">from</span> tsfresh <span class="token keyword">import</span> extract_features
<span class="token keyword">from</span> tsfresh<span class="token punctuation">.</span>utilities<span class="token punctuation">.</span>dataframe_functions <span class="token keyword">import</span> impute

<span class="token keyword">from</span> utils <span class="token keyword">import</span> calculate_compound_returns<span class="token punctuation">,</span> calculate_future_return_class<span class="token punctuation">,</span> calculate_future_returns<span class="token punctuation">,</span> calculate_technical_indicator_changes

<span class="token keyword">def</span> <span class="token function">select_features_with_rfe</span><span class="token punctuation">(</span>features<span class="token punctuation">,</span> target<span class="token punctuation">,</span> n_features_to_select<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    使用递归特征消除选择特征
    """</span>
    estimator <span class="token operator">=</span> RandomForestRegressor<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>  <span class="token comment"># 初始化随机森林回归器</span>
    selector <span class="token operator">=</span> RFE<span class="token punctuation">(</span>estimator<span class="token punctuation">,</span> n_features_to_select<span class="token operator">=</span>n_features_to_select<span class="token punctuation">)</span>  <span class="token comment"># 初始化 RFE 选择器</span>
    selector <span class="token operator">=</span> selector<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>features<span class="token punctuation">,</span> target<span class="token punctuation">)</span>  <span class="token comment"># 训练 RFE 选择器</span>
    selected_features <span class="token operator">=</span> features<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> selector<span class="token punctuation">.</span>support_<span class="token punctuation">]</span>  <span class="token comment"># 选择特征</span>
    <span class="token keyword">return</span> selected_features

<span class="token keyword">def</span> <span class="token function">select_features_with_lasso</span><span class="token punctuation">(</span>features<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    使用LASSO回归选择特征
    """</span>
    lasso <span class="token operator">=</span> Lasso<span class="token punctuation">(</span>alpha<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>  <span class="token comment"># 初始化 LASSO 回归</span>
    lasso<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>features<span class="token punctuation">,</span> target<span class="token punctuation">)</span>  <span class="token comment"># 训练 LASSO 回归</span>
    model <span class="token operator">=</span> SelectFromModel<span class="token punctuation">(</span>lasso<span class="token punctuation">,</span> prefit<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 初始化特征选择器</span>
    selected_features <span class="token operator">=</span> model<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>features<span class="token punctuation">)</span>  <span class="token comment"># 选择特征</span>
    <span class="token keyword">return</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>selected_features<span class="token punctuation">,</span> columns<span class="token operator">=</span>features<span class="token punctuation">.</span>columns<span class="token punctuation">[</span>model<span class="token punctuation">.</span>get_support<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">add_technical_indicators</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    添加技术指标
    """</span>
    df<span class="token punctuation">[</span><span class="token string">"SMA_5"</span><span class="token punctuation">]</span> <span class="token operator">=</span> talib<span class="token punctuation">.</span>SMA<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeperiod<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># 5日简单移动平均</span>
    df<span class="token punctuation">[</span><span class="token string">"SMA_10"</span><span class="token punctuation">]</span> <span class="token operator">=</span> talib<span class="token punctuation">.</span>SMA<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeperiod<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># 10日简单移动平均</span>
    df<span class="token punctuation">[</span><span class="token string">"RSI"</span><span class="token punctuation">]</span> <span class="token operator">=</span> talib<span class="token punctuation">.</span>RSI<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeperiod<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>  <span class="token comment"># 14日相对强弱指数</span>
    df<span class="token punctuation">[</span><span class="token string">"MACD"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">"MACD_signal"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> _ <span class="token operator">=</span> talib<span class="token punctuation">.</span>MACD<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> fastperiod<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> slowperiod<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">,</span> signalperiod<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">)</span>  <span class="token comment"># MACD 指标</span>
    df<span class="token punctuation">[</span><span class="token string">"EMA_12"</span><span class="token punctuation">]</span> <span class="token operator">=</span> talib<span class="token punctuation">.</span>EMA<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeperiod<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>  <span class="token comment"># 12日指数移动平均</span>
    df<span class="token punctuation">[</span><span class="token string">"EMA_26"</span><span class="token punctuation">]</span> <span class="token operator">=</span> talib<span class="token punctuation">.</span>EMA<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeperiod<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">)</span>  <span class="token comment"># 26日指数移动平均</span>
    df<span class="token punctuation">[</span><span class="token string">"ATR"</span><span class="token punctuation">]</span> <span class="token operator">=</span> talib<span class="token punctuation">.</span>ATR<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">"high"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">"low"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeperiod<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>  <span class="token comment"># 14日平均真实波动幅度</span>
    df<span class="token punctuation">[</span><span class="token string">"ADX"</span><span class="token punctuation">]</span> <span class="token operator">=</span> talib<span class="token punctuation">.</span>ADX<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">"high"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">"low"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeperiod<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>  <span class="token comment"># 14日平均趋向指数</span>
    <span class="token keyword">return</span> df

<span class="token keyword">def</span> <span class="token function">add_time_window_features</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    添加时间窗口特征
    """</span>
    df<span class="token punctuation">[</span><span class="token string">"close_mean_5d"</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>window<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 5日收盘价均值</span>
    df<span class="token punctuation">[</span><span class="token string">"close_std_5d"</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>window<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 5日收盘价标准差</span>
    df<span class="token punctuation">[</span><span class="token string">"close_mean_10d"</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>window<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 10日收盘价均值</span>
    df<span class="token punctuation">[</span><span class="token string">"close_std_10d"</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>window<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 10日收盘价标准差</span>
    <span class="token keyword">return</span> df

<span class="token keyword">def</span> <span class="token function">add_manual_features</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    添加手工特征
    """</span>
    df<span class="token punctuation">[</span><span class="token string">"volume_change"</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"vol"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 成交量变化率</span>
    df<span class="token punctuation">[</span><span class="token string">"price_volatility"</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>window<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 5日价格波动率</span>
    df<span class="token punctuation">[</span><span class="token string">"price_momentum"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span> <span class="token operator">-</span> df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># 5日价格动量</span>
    <span class="token keyword">return</span> df

<span class="token keyword">def</span> <span class="token function">extract_and_select_features</span><span class="token punctuation">(</span>data_path<span class="token punctuation">,</span> target_variable<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    提取时间序列特征并选择与目标变量相关的特征。
    """</span>
    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_parquet<span class="token punctuation">(</span>data_path<span class="token punctuation">)</span>  <span class="token comment"># 读取 Parquet 文件</span>
    df<span class="token punctuation">[</span><span class="token string">"date"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">"trade_date"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">"%Y%m%d"</span><span class="token punctuation">)</span>  <span class="token comment"># 将交易日期转换为 datetime 格式</span>
    df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">"date"</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 按日期排序</span>

    df <span class="token operator">=</span> calculate_future_returns<span class="token punctuation">(</span>df<span class="token punctuation">,</span> days_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 计算多个时间窗口的未来收益率</span>
    df <span class="token operator">=</span> calculate_compound_returns<span class="token punctuation">(</span>df<span class="token punctuation">,</span> days<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># 计算复合收益率</span>
    df <span class="token operator">=</span> calculate_future_return_class<span class="token punctuation">(</span>df<span class="token punctuation">,</span> days<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># 计算分类目标</span>
    df <span class="token operator">=</span> calculate_technical_indicator_changes<span class="token punctuation">(</span>df<span class="token punctuation">,</span> indicator<span class="token operator">=</span><span class="token string">"RSI"</span><span class="token punctuation">,</span> period<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> days<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># 计算技术指标变化</span>
    df <span class="token operator">=</span> add_technical_indicators<span class="token punctuation">(</span>df<span class="token punctuation">)</span>  <span class="token comment"># 添加技术指标</span>
    df <span class="token operator">=</span> add_time_window_features<span class="token punctuation">(</span>df<span class="token punctuation">)</span>  <span class="token comment"># 添加时间窗口特征</span>
    df <span class="token operator">=</span> add_manual_features<span class="token punctuation">(</span>df<span class="token punctuation">)</span>  <span class="token comment"># 添加手工特征</span>

    df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 删除包含 NaN 值的行</span>
    df<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 添加 id 列</span>
    df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 设置 id 为索引</span>
    df<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 重置索引</span>

    target <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>df<span class="token punctuation">[</span>target_variable<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 提取目标变量</span>

    extracted_features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>df<span class="token punctuation">,</span> column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span> column_sort<span class="token operator">=</span><span class="token string">"date"</span><span class="token punctuation">,</span> column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">)</span>  <span class="token comment"># 提取时间序列特征</span>
    impute<span class="token punctuation">(</span>extracted_features<span class="token punctuation">)</span>  <span class="token comment"># 填充缺失值</span>

    selected_features <span class="token operator">=</span> select_features_with_lasso<span class="token punctuation">(</span>extracted_features<span class="token punctuation">,</span> target<span class="token punctuation">)</span>  <span class="token comment"># 选择特征</span>

    <span class="token keyword">return</span> selected_features<span class="token punctuation">,</span> target

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    features<span class="token punctuation">,</span> target <span class="token operator">=</span> extract_and_select_features<span class="token punctuation">(</span><span class="token string">"../data/raw_data.parquet"</span><span class="token punctuation">,</span> <span class="token string">"future_return_5d"</span><span class="token punctuation">)</span>  <span class="token comment"># 提取和选择特征</span>
    features<span class="token punctuation">.</span>to_parquet<span class="token punctuation">(</span><span class="token string">"../data/selected_features.parquet"</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>  <span class="token comment"># 保存特征</span>
    target<span class="token punctuation">.</span>to_parquet<span class="token punctuation">(</span><span class="token string">"../data/target.parquet"</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>  <span class="token comment"># 保存目标变量</span>
</code></pre>
    <h4>
     <a id="33__model_trainingpy_306">
     </a>
     3.3 模型训练 (
     <code>
      model_training.py
     </code>
     )
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># src/model_training.py</span>
<span class="token keyword">import</span> re
<span class="token keyword">import</span> lightgbm <span class="token keyword">as</span> lgb
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> optuna
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> mean_squared_error
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> KFold<span class="token punctuation">,</span> train_test_split
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler

<span class="token keyword">def</span> <span class="token function">clean_feature_names</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
    df<span class="token punctuation">.</span>columns <span class="token operator">=</span> <span class="token punctuation">[</span>re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r"[^a-zA-Z0-9_]"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> col<span class="token punctuation">)</span> <span class="token keyword">for</span> col <span class="token keyword">in</span> df<span class="token punctuation">.</span>columns<span class="token punctuation">]</span>  <span class="token comment"># 清理特征名称，去除特殊字符</span>
    <span class="token keyword">return</span> df

<span class="token keyword">def</span> <span class="token function">preprocess_data</span><span class="token punctuation">(</span>features<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">:</span>
    features <span class="token operator">=</span> features<span class="token punctuation">.</span>interpolate<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"linear"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>features<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 插值填充缺失值</span>
    scaler <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 初始化标准化器</span>
    features <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>scaler<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">,</span> columns<span class="token operator">=</span>features<span class="token punctuation">.</span>columns<span class="token punctuation">)</span>  <span class="token comment"># 标准化特征</span>
    <span class="token keyword">return</span> features<span class="token punctuation">,</span> target

<span class="token keyword">def</span> <span class="token function">objective</span><span class="token punctuation">(</span>trial<span class="token punctuation">,</span> X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> X_val<span class="token punctuation">,</span> y_val<span class="token punctuation">)</span><span class="token punctuation">:</span>
    params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"objective"</span><span class="token punctuation">:</span> <span class="token string">"regression"</span><span class="token punctuation">,</span>  <span class="token comment"># 目标函数</span>
        <span class="token string">"metric"</span><span class="token punctuation">:</span> <span class="token string">"mse"</span><span class="token punctuation">,</span>  <span class="token comment"># 评价指标</span>
        <span class="token string">"boosting_type"</span><span class="token punctuation">:</span> <span class="token string">"gbdt"</span><span class="token punctuation">,</span>  <span class="token comment"># 提升类型</span>
        <span class="token string">"num_leaves"</span><span class="token punctuation">:</span> trial<span class="token punctuation">.</span>suggest_int<span class="token punctuation">(</span><span class="token string">"num_leaves"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 叶子节点数</span>
        <span class="token string">"learning_rate"</span><span class="token punctuation">:</span> trial<span class="token punctuation">.</span>suggest_loguniform<span class="token punctuation">(</span><span class="token string">"learning_rate"</span><span class="token punctuation">,</span> <span class="token number">1e-5</span><span class="token punctuation">,</span> <span class="token number">1e-1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 学习率</span>
        <span class="token string">"max_depth"</span><span class="token punctuation">:</span> trial<span class="token punctuation">.</span>suggest_int<span class="token punctuation">(</span><span class="token string">"max_depth"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 最大深度</span>
        <span class="token string">"min_child_samples"</span><span class="token punctuation">:</span> trial<span class="token punctuation">.</span>suggest_int<span class="token punctuation">(</span><span class="token string">"min_child_samples"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 最小样本数</span>
        <span class="token string">"subsample"</span><span class="token punctuation">:</span> trial<span class="token punctuation">.</span>suggest_uniform<span class="token punctuation">(</span><span class="token string">"subsample"</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 子采样比例</span>
        <span class="token string">"colsample_bytree"</span><span class="token punctuation">:</span> trial<span class="token punctuation">.</span>suggest_uniform<span class="token punctuation">(</span><span class="token string">"colsample_bytree"</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 列采样比例</span>
        <span class="token string">"reg_alpha"</span><span class="token punctuation">:</span> trial<span class="token punctuation">.</span>suggest_loguniform<span class="token punctuation">(</span><span class="token string">"reg_alpha"</span><span class="token punctuation">,</span> <span class="token number">1e-5</span><span class="token punctuation">,</span> <span class="token number">1e2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># L1 正则化项</span>
        <span class="token string">"reg_lambda"</span><span class="token punctuation">:</span> trial<span class="token punctuation">.</span>suggest_loguniform<span class="token punctuation">(</span><span class="token string">"reg_lambda"</span><span class="token punctuation">,</span> <span class="token number">1e-5</span><span class="token punctuation">,</span> <span class="token number">1e2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># L2 正则化项</span>
    <span class="token punctuation">}</span>

    dtrain <span class="token operator">=</span> lgb<span class="token punctuation">.</span>Dataset<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> label<span class="token operator">=</span>y_train<span class="token punctuation">)</span>  <span class="token comment"># 创建训练数据集</span>
    dval <span class="token operator">=</span> lgb<span class="token punctuation">.</span>Dataset<span class="token punctuation">(</span>X_val<span class="token punctuation">,</span> label<span class="token operator">=</span>y_val<span class="token punctuation">)</span>  <span class="token comment"># 创建验证数据集</span>

    callbacks <span class="token operator">=</span> <span class="token punctuation">[</span>
        lgb<span class="token punctuation">.</span>early_stopping<span class="token punctuation">(</span>stopping_rounds<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> first_metric_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 早停回调</span>
        lgb<span class="token punctuation">.</span>log_evaluation<span class="token punctuation">(</span>period<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 禁用日志输出</span>
    <span class="token punctuation">]</span>

    model <span class="token operator">=</span> lgb<span class="token punctuation">.</span>train<span class="token punctuation">(</span>params<span class="token punctuation">,</span> dtrain<span class="token punctuation">,</span> valid_sets<span class="token operator">=</span><span class="token punctuation">[</span>dtrain<span class="token punctuation">,</span> dval<span class="token punctuation">]</span><span class="token punctuation">,</span> valid_names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"train"</span><span class="token punctuation">,</span> <span class="token string">"val"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> num_boost_round<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> callbacks<span class="token operator">=</span>callbacks<span class="token punctuation">)</span>  <span class="token comment"># 训练模型</span>

    y_pred <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_val<span class="token punctuation">)</span>  <span class="token comment"># 预测验证集</span>
    mse <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>  <span class="token comment"># 计算均方误差</span>

    <span class="token keyword">return</span> mse

<span class="token keyword">def</span> <span class="token function">train_model</span><span class="token punctuation">(</span>features_path<span class="token punctuation">,</span> target_path<span class="token punctuation">,</span> n_trials<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    features <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_parquet<span class="token punctuation">(</span>features_path<span class="token punctuation">)</span>  <span class="token comment"># 读取特征</span>
    target <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_parquet<span class="token punctuation">(</span>target_path<span class="token punctuation">)</span>  <span class="token comment"># 读取目标变量</span>

    features <span class="token operator">=</span> clean_feature_names<span class="token punctuation">(</span>features<span class="token punctuation">)</span>  <span class="token comment"># 清理特征名称</span>
    features<span class="token punctuation">,</span> target <span class="token operator">=</span> preprocess_data<span class="token punctuation">(</span>features<span class="token punctuation">,</span> target<span class="token punctuation">)</span>  <span class="token comment"># 预处理数据</span>

    X_train<span class="token punctuation">,</span> X_val<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_val <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>features<span class="token punctuation">,</span> target<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>  <span class="token comment"># 划分训练集和验证集</span>

    study <span class="token operator">=</span> optuna<span class="token punctuation">.</span>create_study<span class="token punctuation">(</span>direction<span class="token operator">=</span><span class="token string">"minimize"</span><span class="token punctuation">)</span>  <span class="token comment"># 创建 Optuna 研究</span>
    study<span class="token punctuation">.</span>optimize<span class="token punctuation">(</span><span class="token keyword">lambda</span> trial<span class="token punctuation">:</span> objective<span class="token punctuation">(</span>trial<span class="token punctuation">,</span> X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> X_val<span class="token punctuation">,</span> y_val<span class="token punctuation">)</span><span class="token punctuation">,</span> n_trials<span class="token operator">=</span>n_trials<span class="token punctuation">)</span>  <span class="token comment"># 优化超参数</span>

    best_params <span class="token operator">=</span> study<span class="token punctuation">.</span>best_params  <span class="token comment"># 获取最优参数</span>
    best_mse <span class="token operator">=</span> study<span class="token punctuation">.</span>best_value  <span class="token comment"># 获取最优 MSE</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Best MSE: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>best_mse<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 打印最优 MSE</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Best Parameters: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>best_params<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 打印最优参数</span>

    <span class="token keyword">return</span> best_params

<span class="token keyword">def</span> <span class="token function">train_final_model</span><span class="token punctuation">(</span>best_params<span class="token punctuation">,</span> features<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">:</span>
    features<span class="token punctuation">,</span> target <span class="token operator">=</span> preprocess_data<span class="token punctuation">(</span>features<span class="token punctuation">,</span> target<span class="token punctuation">)</span>  <span class="token comment"># 预处理数据</span>
    kf <span class="token operator">=</span> KFold<span class="token punctuation">(</span>n_splits<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>  <span class="token comment"># 初始化 K-Fold 交叉验证</span>
    mse_scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> train_index<span class="token punctuation">,</span> val_index <span class="token keyword">in</span> kf<span class="token punctuation">.</span>split<span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 进行交叉验证</span>
        X_train<span class="token punctuation">,</span> X_val <span class="token operator">=</span> features<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>train_index<span class="token punctuation">]</span><span class="token punctuation">,</span> features<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>val_index<span class="token punctuation">]</span>
        y_train<span class="token punctuation">,</span> y_val <span class="token operator">=</span> target<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>train_index<span class="token punctuation">]</span><span class="token punctuation">,</span> target<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>val_index<span class="token punctuation">]</span>
        dtrain <span class="token operator">=</span> lgb<span class="token punctuation">.</span>Dataset<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> label<span class="token operator">=</span>y_train<span class="token punctuation">)</span>  <span class="token comment"># 创建训练数据集</span>
        dval <span class="token operator">=</span> lgb<span class="token punctuation">.</span>Dataset<span class="token punctuation">(</span>X_val<span class="token punctuation">,</span> label<span class="token operator">=</span>y_val<span class="token punctuation">)</span>  <span class="token comment"># 创建验证数据集</span>
        callbacks <span class="token operator">=</span> <span class="token punctuation">[</span>
            lgb<span class="token punctuation">.</span>early_stopping<span class="token punctuation">(</span>stopping_rounds<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> first_metric_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 早停回调</span>
            lgb<span class="token punctuation">.</span>log_evaluation<span class="token punctuation">(</span>period<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 禁用日志输出</span>
        <span class="token punctuation">]</span>
        model <span class="token operator">=</span> lgb<span class="token punctuation">.</span>train<span class="token punctuation">(</span>best_params<span class="token punctuation">,</span> dtrain<span class="token punctuation">,</span> valid_sets<span class="token operator">=</span><span class="token punctuation">[</span>dtrain<span class="token punctuation">,</span> dval<span class="token punctuation">]</span><span class="token punctuation">,</span> valid_names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"train"</span><span class="token punctuation">,</span> <span class="token string">"val"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> num_boost_round<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> callbacks<span class="token operator">=</span>callbacks<span class="token punctuation">)</span>  <span class="token comment"># 训练模型</span>
        y_pred <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_val<span class="token punctuation">)</span>  <span class="token comment"># 预测验证集</span>
        mse <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>  <span class="token comment"># 计算均方误差</span>
        mse_scores<span class="token punctuation">.</span>append<span class="token punctuation">(</span>mse<span class="token punctuation">)</span>
    avg_mse <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>mse_scores<span class="token punctuation">)</span>  <span class="token comment"># 计算平均 MSE</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Final Model Average MSE: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>avg_mse<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 打印平均 MSE</span>
    <span class="token keyword">return</span> model

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    features_path <span class="token operator">=</span> <span class="token string">"../data/selected_features.parquet"</span>
    target_path <span class="token operator">=</span> <span class="token string">"../data/target.parquet"</span>

    best_params <span class="token operator">=</span> train_model<span class="token punctuation">(</span>features_path<span class="token punctuation">,</span> target_path<span class="token punctuation">,</span> n_trials<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment"># 训练模型并优化超参数</span>

    features <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_parquet<span class="token punctuation">(</span>features_path<span class="token punctuation">)</span>  <span class="token comment"># 读取特征</span>
    target <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_parquet<span class="token punctuation">(</span>target_path<span class="token punctuation">)</span>  <span class="token comment"># 读取目标变量</span>

    features <span class="token operator">=</span> clean_feature_names<span class="token punctuation">(</span>features<span class="token punctuation">)</span>  <span class="token comment"># 清理特征名称</span>

    final_model <span class="token operator">=</span> train_final_model<span class="token punctuation">(</span>best_params<span class="token punctuation">,</span> features<span class="token punctuation">,</span> target<span class="token punctuation">)</span>  <span class="token comment"># 训练最终模型</span>

    final_model<span class="token punctuation">.</span>save_model<span class="token punctuation">(</span><span class="token string">"final_model.txt"</span><span class="token punctuation">)</span>  <span class="token comment"># 保存模型</span>
</code></pre>
    <h4>
     <a id="34__strategy_backtestingpy_416">
     </a>
     3.4 策略回测 (
     <code>
      strategy_backtesting.py
     </code>
     )
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># strategy_backtesting.py</span>
<span class="token keyword">import</span> re
<span class="token keyword">import</span> lightgbm <span class="token keyword">as</span> lgb
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> mean_absolute_error<span class="token punctuation">,</span> mean_squared_error<span class="token punctuation">,</span> r2_score
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler

<span class="token keyword">def</span> <span class="token function">clean_feature_names</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
    df<span class="token punctuation">.</span>columns <span class="token operator">=</span> <span class="token punctuation">[</span>re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r"[^a-zA-Z0-9_]"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> col<span class="token punctuation">)</span> <span class="token keyword">for</span> col <span class="token keyword">in</span> df<span class="token punctuation">.</span>columns<span class="token punctuation">]</span>  <span class="token comment"># 清理特征名称，去除特殊字符</span>
    <span class="token keyword">return</span> df

<span class="token keyword">def</span> <span class="token function">preprocess_data</span><span class="token punctuation">(</span>features<span class="token punctuation">,</span> target<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    features <span class="token operator">=</span> features<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>features<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 填充缺失值</span>
    scaler <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 初始化标准化器</span>
    features <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>scaler<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">,</span> columns<span class="token operator">=</span>features<span class="token punctuation">.</span>columns<span class="token punctuation">)</span>  <span class="token comment"># 标准化特征</span>

    <span class="token keyword">if</span> target <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> features<span class="token punctuation">,</span> target
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> features

<span class="token keyword">def</span> <span class="token function">load_model</span><span class="token punctuation">(</span>model_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> lgb<span class="token punctuation">.</span>Booster<span class="token punctuation">(</span>model_file<span class="token operator">=</span>model_path<span class="token punctuation">)</span>  <span class="token comment"># 加载 LightGBM 模型</span>
    <span class="token keyword">return</span> model

<span class="token keyword">def</span> <span class="token function">backtest_strategy</span><span class="token punctuation">(</span>features<span class="token punctuation">,</span> target<span class="token punctuation">,</span> model<span class="token punctuation">,</span> threshold<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    features <span class="token operator">=</span> preprocess_data<span class="token punctuation">(</span>features<span class="token punctuation">)</span>  <span class="token comment"># 预处理特征</span>

    predictions <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>features<span class="token punctuation">)</span>  <span class="token comment"># 预测</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Predictions: Min=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>predictions<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">, Max=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>predictions<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">, Mean=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>predictions<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 打印预测值统计信息</span>

    mse <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>target<span class="token punctuation">,</span> predictions<span class="token punctuation">)</span>  <span class="token comment"># 计算均方误差</span>
    mae <span class="token operator">=</span> mean_absolute_error<span class="token punctuation">(</span>target<span class="token punctuation">,</span> predictions<span class="token punctuation">)</span>  <span class="token comment"># 计算平均绝对误差</span>
    r2 <span class="token operator">=</span> r2_score<span class="token punctuation">(</span>target<span class="token punctuation">,</span> predictions<span class="token punctuation">)</span>  <span class="token comment"># 计算 R² 分数</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Mean Squared Error (MSE): </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>mse<span class="token punctuation">:</span><span class="token format-spec">.6f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 打印均方误差</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Mean Absolute Error (MAE): </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>mae<span class="token punctuation">:</span><span class="token format-spec">.6f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 打印平均绝对误差</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"R² Score: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>r2<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 打印 R² 分数</span>

    signals <span class="token operator">=</span> <span class="token punctuation">(</span>predictions <span class="token operator">&gt;</span> threshold<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>  <span class="token comment"># 生成交易信号</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Signals: Sum=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>signals<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">, Count=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">len</span><span class="token punctuation">(</span>signals<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">, Non-zero count=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token punctuation">(</span>signals <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 打印信号统计信息</span>

    daily_returns <span class="token operator">=</span> target <span class="token operator">*</span> signals  <span class="token comment"># 计算每日收益</span>

    daily_returns_series <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>daily_returns<span class="token punctuation">)</span>  <span class="token comment"># 将每日收益转换为 Pandas Series</span>

    cumulative_returns <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> daily_returns_series<span class="token punctuation">)</span><span class="token punctuation">.</span>cumprod<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>  <span class="token comment"># 计算累积收益</span>

    total_return <span class="token operator">=</span> cumulative_returns<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment"># 计算总收益</span>

    sharpe_ratio <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token number">252</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>daily_returns_series<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> daily_returns_series<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 计算夏普比率</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Total Return: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>total_return<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 打印总收益</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Sharpe Ratio: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>sharpe_ratio<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 打印夏普比率</span>

    <span class="token keyword">return</span> cumulative_returns<span class="token punctuation">,</span> total_return<span class="token punctuation">,</span> sharpe_ratio

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    features_path <span class="token operator">=</span> <span class="token string">"../data/selected_features.parquet"</span>
    target_path <span class="token operator">=</span> <span class="token string">"../data/target.parquet"</span>

    features <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_parquet<span class="token punctuation">(</span>features_path<span class="token punctuation">)</span>  <span class="token comment"># 读取特征</span>
    target <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_parquet<span class="token punctuation">(</span>target_path<span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 读取目标变量</span>

    features <span class="token operator">=</span> clean_feature_names<span class="token punctuation">(</span>features<span class="token punctuation">)</span>  <span class="token comment"># 清理特征名称</span>

    model_path <span class="token operator">=</span> <span class="token string">"final_model.txt"</span>
    model <span class="token operator">=</span> load_model<span class="token punctuation">(</span>model_path<span class="token punctuation">)</span>  <span class="token comment"># 加载模型</span>

    cumulative_returns<span class="token punctuation">,</span> total_return<span class="token punctuation">,</span> sharpe_ratio <span class="token operator">=</span> backtest_strategy<span class="token punctuation">(</span>features<span class="token punctuation">,</span> target<span class="token punctuation">,</span> model<span class="token punctuation">,</span> threshold<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span>  <span class="token comment"># 回测策略</span>

    <span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>cumulative_returns<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"Cumulative Returns"</span><span class="token punctuation">)</span>  <span class="token comment"># 绘制累积收益曲线</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Cumulative Returns Over Time"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"Time"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Cumulative Returns"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="35__utilspy_504">
     </a>
     3.5 辅助函数 (
     <code>
      utils.py
     </code>
     )
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># src/utils.py</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> talib


<span class="token keyword">def</span> <span class="token function">calculate_future_returns</span><span class="token punctuation">(</span>df<span class="token punctuation">,</span> days_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    计算多个时间窗口的未来收益率。

    :param df: 包含收盘价的时间序列数据
    :param days_list: 未来天数列表
    :return: 包含未来收益率的DataFrame
    """</span>
    <span class="token keyword">for</span> days <span class="token keyword">in</span> days_list<span class="token punctuation">:</span>
        target_variable <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"future_return_</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>days<span class="token punctuation">}</span></span><span class="token string">d"</span></span>
        df<span class="token punctuation">[</span>target_variable<span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span>periods<span class="token operator">=</span><span class="token operator">-</span>days<span class="token punctuation">)</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span>days<span class="token punctuation">)</span>
    
    df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> df


<span class="token keyword">def</span> <span class="token function">calculate_compound_returns</span><span class="token punctuation">(</span>df<span class="token punctuation">,</span> days<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    计算复合收益率。
    :param df: 包含收盘价的时间序列数据
    :param days: 未来天数
    :return: 包含复合收益率的DataFrame
    """</span>
    target_variable <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"compound_return_</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>days<span class="token punctuation">}</span></span><span class="token string">d"</span></span>
    df<span class="token punctuation">[</span>target_variable<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token operator">-</span>days<span class="token punctuation">)</span> <span class="token operator">/</span> df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
    df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span>target_variable<span class="token punctuation">]</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> df


<span class="token keyword">def</span> <span class="token function">calculate_future_return_class</span><span class="token punctuation">(</span>df<span class="token punctuation">,</span> days<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    计算未来收益率并将其转换为分类目标。
    :param df: 包含收盘价的时间序列数据
    :param days: 未来天数
    :return: 包含分类目标的DataFrame
    """</span>
    target_variable <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"future_return_</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>days<span class="token punctuation">}</span></span><span class="token string">d"</span></span>
    df<span class="token punctuation">[</span>target_variable<span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span>periods<span class="token operator">=</span><span class="token operator">-</span>days<span class="token punctuation">)</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span>days<span class="token punctuation">)</span>

    <span class="token comment"># 将收益率转换为分类目标</span>
    df<span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>target_variable<span class="token punctuation">}</span></span><span class="token string">_class"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>
        df<span class="token punctuation">[</span>target_variable<span class="token punctuation">]</span><span class="token punctuation">,</span>
        bins<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span>np<span class="token punctuation">.</span>inf<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>inf<span class="token punctuation">]</span><span class="token punctuation">,</span>
        labels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"down"</span><span class="token punctuation">,</span> <span class="token string">"flat"</span><span class="token punctuation">,</span> <span class="token string">"up"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

    df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>target_variable<span class="token punctuation">}</span></span><span class="token string">_class"</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> df


<span class="token keyword">def</span> <span class="token function">calculate_technical_indicator_changes</span><span class="token punctuation">(</span>df<span class="token punctuation">,</span> indicator<span class="token operator">=</span><span class="token string">"RSI"</span><span class="token punctuation">,</span> period<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> days<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    计算技术指标的变化。
    :param df: 包含收盘价的时间序列数据
    :param indicator: 技术指标名称
    :param period: 技术指标的时间周期
    :param days: 未来天数
    :return: 包含技术指标变化的DataFrame
    """</span>
    <span class="token keyword">if</span> indicator <span class="token operator">==</span> <span class="token string">"RSI"</span><span class="token punctuation">:</span>
        df<span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>indicator<span class="token punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>period<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> talib<span class="token punctuation">.</span>RSI<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeperiod<span class="token operator">=</span>period<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> indicator <span class="token operator">==</span> <span class="token string">"MACD"</span><span class="token punctuation">:</span>
        macd<span class="token punctuation">,</span> signal<span class="token punctuation">,</span> _ <span class="token operator">=</span> talib<span class="token punctuation">.</span>MACD<span class="token punctuation">(</span>
            df<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> fastperiod<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> slowperiod<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">,</span> signalperiod<span class="token operator">=</span><span class="token number">9</span>
        <span class="token punctuation">)</span>
        df<span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>indicator<span class="token punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>period<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> macd <span class="token operator">-</span> signal
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Unsupported indicator: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>indicator<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    target_variable <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>indicator<span class="token punctuation">}</span></span><span class="token string">_change_</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>days<span class="token punctuation">}</span></span><span class="token string">d"</span></span>
    df<span class="token punctuation">[</span>target_variable<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
        df<span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>indicator<span class="token punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>period<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">]</span><span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span>periods<span class="token operator">=</span><span class="token operator">-</span>days<span class="token punctuation">)</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span>days<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span>target_variable<span class="token punctuation">]</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> df
</code></pre>
    <h3>
     <a id="4__590">
     </a>
     4. 关键技术参数说明
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        参数
       </th>
       <th>
        说明
       </th>
       <th>
        设置值
       </th>
       <th>
        注意事项
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         num_leaves
        </code>
       </td>
       <td>
        叶子节点数
       </td>
       <td>
        通常设置在 32 到 256 之间
       </td>
       <td>
        过多会导致过拟合，过少会导致欠拟合
       </td>
      </tr>
      <tr>
       <td>
        <code>
         learning_rate
        </code>
       </td>
       <td>
        学习率
       </td>
       <td>
        通常设置在 0.01 到 0.3 之间
       </td>
       <td>
        较小的学习率需要更多的迭代次数，较大的学习率可能导致不收敛
       </td>
      </tr>
      <tr>
       <td>
        <code>
         max_depth
        </code>
       </td>
       <td>
        最大深度
       </td>
       <td>
        通常设置在 3 到 15 之间
       </td>
       <td>
        过深会导致过拟合，过浅会导致欠拟合
       </td>
      </tr>
      <tr>
       <td>
        <code>
         min_child_samples
        </code>
       </td>
       <td>
        最小样本数
       </td>
       <td>
        通常设置在 5 到 100 之间
       </td>
       <td>
        过小会导致过拟合，过大可能导致欠拟合
       </td>
      </tr>
      <tr>
       <td>
        <code>
         subsample
        </code>
       </td>
       <td>
        子采样比例
       </td>
       <td>
        通常设置在 0.5 到 1.0 之间
       </td>
       <td>
        较小的比例可以减少过拟合，但会增加训练时间
       </td>
      </tr>
      <tr>
       <td>
        <code>
         colsample_bytree
        </code>
       </td>
       <td>
        列采样比例
       </td>
       <td>
        通常设置在 0.5 到 1.0 之间
       </td>
       <td>
        较小的比例可以减少过拟合，但会增加训练时间
       </td>
      </tr>
      <tr>
       <td>
        <code>
         reg_alpha
        </code>
       </td>
       <td>
        L1 正则化项
       </td>
       <td>
        通常设置在 0.0 到 1.0 之间
       </td>
       <td>
        较大的值可以减少过拟合，但可能降低模型性能
       </td>
      </tr>
      <tr>
       <td>
        <code>
         reg_lambda
        </code>
       </td>
       <td>
        L2 正则化项
       </td>
       <td>
        通常设置在 0.0 到 1.0 之间
       </td>
       <td>
        较大的值可以减少过拟合，但可能降低模型性能
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="5__603">
     </a>
     5. 策略评价指标
    </h3>
    <p>
     在量化投资策略的评估中，评价指标是衡量策略性能的关键工具。以下是一些常用的评价指标及其意义：
    </p>
    <h4>
     <a id="51__607">
     </a>
     5.1 预测准确性指标
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        均方误差 (MSE)
       </strong>
       ：衡量预测值与实际值之间的差异。较低的 MSE 表示模型预测更准确。计算公式为：
      </p>
      <p>
       <span class="katex--display">
        <span class="katex-display">
         <span class="katex">
          <span class="katex-mathml">
           MSE 
           
          
            = 
           
           
           
             1 
            
           
             n 
            
           
           
           
             ∑ 
            
            
            
              i 
             
            
              = 
             
            
              1 
             
            
           
             n 
            
           
          
            ( 
           
           
           
             y 
            
           
             i 
            
           
          
            − 
           
           
            
            
              y 
             
            
              ^ 
             
            
           
             i 
            
           
           
           
             ) 
            
           
             2 
            
           
          
         
           \text{MSE} = \frac{1}{n}\sum_{i=1}^{n}(y_i - \hat{y}_i)^2
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.6833em;">
            </span>
            <span class="mord text">
             <span class="mord">
              MSE
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
            <span class="mrel">
             =
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 2.9291em; vertical-align: -1.2777em;">
            </span>
            <span class="mord">
             <span class="mopen nulldelimiter">
             </span>
             <span class="mfrac">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 1.3214em;">
                 <span class="" style="top: -2.314em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mord mathnormal">
                    n
                   </span>
                  </span>
                 </span>
                 <span class="" style="top: -3.23em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="frac-line" style="border-bottom-width: 0.04em;">
                  </span>
                 </span>
                 <span class="" style="top: -3.677em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mord">
                    1
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 0.686em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="mclose nulldelimiter">
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.1667em;">
            </span>
            <span class="mop op-limits">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 1.6514em;">
                <span class="" style="top: -1.8723em; margin-left: 0em;">
                 <span class="pstrut" style="height: 3.05em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mtight">
                   <span class="mord mathnormal mtight">
                    i
                   </span>
                   <span class="mrel mtight">
                    =
                   </span>
                   <span class="mord mtight">
                    1
                   </span>
                  </span>
                 </span>
                </span>
                <span class="" style="top: -3.05em;">
                 <span class="pstrut" style="height: 3.05em;">
                 </span>
                 <span class="">
                  <span class="mop op-symbol large-op">
                   ∑
                  </span>
                 </span>
                </span>
                <span class="" style="top: -4.3em; margin-left: 0em;">
                 <span class="pstrut" style="height: 3.05em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mtight">
                   <span class="mord mathnormal mtight">
                    n
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 1.2777em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mopen">
             (
            </span>
            <span class="mord">
             <span class="mord mathnormal" style="margin-right: 0.0359em;">
              y
             </span>
             <span class="msupsub">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.3117em;">
                 <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mord mathnormal mtight">
                    i
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 0.15em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.2222em;">
            </span>
            <span class="mbin">
             −
            </span>
            <span class="mspace" style="margin-right: 0.2222em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 1.1141em; vertical-align: -0.25em;">
            </span>
            <span class="mord">
             <span class="mord accent">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.6944em;">
                 <span class="" style="top: -3em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord mathnormal" style="margin-right: 0.0359em;">
                   y
                  </span>
                 </span>
                 <span class="" style="top: -3em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="accent-body" style="left: -0.1944em;">
                   <span class="mord">
                    ^
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 0.1944em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="msupsub">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.3117em;">
                 <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mord mathnormal mtight">
                    i
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 0.15em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mclose">
             <span class="mclose">
              )
             </span>
             <span class="msupsub">
              <span class="vlist-t">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.8641em;">
                 <span class="" style="top: -3.113em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mord mtight">
                    2
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       <br/>
       其中，
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          y 
           
          
            i 
           
          
         
        
          y_i
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.625em; vertical-align: -0.1944em;">
           </span>
           <span class="mord">
            <span class="mord mathnormal" style="margin-right: 0.0359em;">
             y
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.3117em;">
                <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mathnormal mtight">
                   i
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.15em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       是实际值，
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          y 
            
           
             ^ 
            
           
          
            i 
           
          
         
        
          \hat{y}_i
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;">
           </span>
           <span class="mord">
            <span class="mord accent">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.6944em;">
                <span class="" style="top: -3em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord mathnormal" style="margin-right: 0.0359em;">
                  y
                 </span>
                </span>
                <span class="" style="top: -3em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="accent-body" style="left: -0.1944em;">
                  <span class="mord">
                   ^
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.1944em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.3117em;">
                <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mathnormal mtight">
                   i
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.15em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       是预测值，
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          n 
          
         
        
          n
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.4306em;">
           </span>
           <span class="mord mathnormal">
            n
           </span>
          </span>
         </span>
        </span>
       </span>
       是样本数量。
      </p>
     </li>
     <li>
      <p>
       <strong>
        平均绝对误差 (MAE)
       </strong>
       ：衡量预测值与实际值之间的绝对差异。较低的 MAE 表示模型预测更准确。计算公式为：
      </p>
      <p>
       <span class="katex--display">
        <span class="katex-display">
         <span class="katex">
          <span class="katex-mathml">
           MAE 
           
          
            = 
           
           
           
             1 
            
           
             n 
            
           
           
           
             ∑ 
            
            
            
              i 
             
            
              = 
             
            
              1 
             
            
           
             n 
            
           
          
            ∣ 
           
           
           
             y 
            
           
             i 
            
           
          
            − 
           
           
            
            
              y 
             
            
              ^ 
             
            
           
             i 
            
           
          
            ∣ 
           
          
         
           \text{MAE} = \frac{1}{n}\sum_{i=1}^{n}|y_i - \hat{y}_i|
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.6833em;">
            </span>
            <span class="mord text">
             <span class="mord">
              MAE
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
            <span class="mrel">
             =
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 2.9291em; vertical-align: -1.2777em;">
            </span>
            <span class="mord">
             <span class="mopen nulldelimiter">
             </span>
             <span class="mfrac">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 1.3214em;">
                 <span class="" style="top: -2.314em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mord mathnormal">
                    n
                   </span>
                  </span>
                 </span>
                 <span class="" style="top: -3.23em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="frac-line" style="border-bottom-width: 0.04em;">
                  </span>
                 </span>
                 <span class="" style="top: -3.677em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mord">
                    1
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 0.686em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="mclose nulldelimiter">
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.1667em;">
            </span>
            <span class="mop op-limits">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 1.6514em;">
                <span class="" style="top: -1.8723em; margin-left: 0em;">
                 <span class="pstrut" style="height: 3.05em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mtight">
                   <span class="mord mathnormal mtight">
                    i
                   </span>
                   <span class="mrel mtight">
                    =
                   </span>
                   <span class="mord mtight">
                    1
                   </span>
                  </span>
                 </span>
                </span>
                <span class="" style="top: -3.05em;">
                 <span class="pstrut" style="height: 3.05em;">
                 </span>
                 <span class="">
                  <span class="mop op-symbol large-op">
                   ∑
                  </span>
                 </span>
                </span>
                <span class="" style="top: -4.3em; margin-left: 0em;">
                 <span class="pstrut" style="height: 3.05em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mtight">
                   <span class="mord mathnormal mtight">
                    n
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 1.2777em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.1667em;">
            </span>
            <span class="mord">
             ∣
            </span>
            <span class="mord">
             <span class="mord mathnormal" style="margin-right: 0.0359em;">
              y
             </span>
             <span class="msupsub">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.3117em;">
                 <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mord mathnormal mtight">
                    i
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 0.15em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.2222em;">
            </span>
            <span class="mbin">
             −
            </span>
            <span class="mspace" style="margin-right: 0.2222em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 1em; vertical-align: -0.25em;">
            </span>
            <span class="mord">
             <span class="mord accent">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.6944em;">
                 <span class="" style="top: -3em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord mathnormal" style="margin-right: 0.0359em;">
                   y
                  </span>
                 </span>
                 <span class="" style="top: -3em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="accent-body" style="left: -0.1944em;">
                   <span class="mord">
                    ^
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 0.1944em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="msupsub">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.3117em;">
                 <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mord mathnormal mtight">
                    i
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 0.15em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mord">
             ∣
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       <br/>
       其中，
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          y 
           
          
            i 
           
          
         
        
          y_i
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.625em; vertical-align: -0.1944em;">
           </span>
           <span class="mord">
            <span class="mord mathnormal" style="margin-right: 0.0359em;">
             y
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.3117em;">
                <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mathnormal mtight">
                   i
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.15em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       是实际值，
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          y 
            
           
             ^ 
            
           
          
            i 
           
          
         
        
          \hat{y}_i
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;">
           </span>
           <span class="mord">
            <span class="mord accent">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.6944em;">
                <span class="" style="top: -3em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord mathnormal" style="margin-right: 0.0359em;">
                  y
                 </span>
                </span>
                <span class="" style="top: -3em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="accent-body" style="left: -0.1944em;">
                  <span class="mord">
                   ^
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.1944em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.3117em;">
                <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mathnormal mtight">
                   i
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.15em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       是预测值，
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          n 
          
         
        
          n
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.4306em;">
           </span>
           <span class="mord mathnormal">
            n
           </span>
          </span>
         </span>
        </span>
       </span>
       是样本数量。
      </p>
     </li>
     <li>
      <p>
       <strong>
        R² 分数
       </strong>
       ：衡量模型解释数据变异性的能力。较高的 R² 分数表示模型解释能力强。R² 的取值范围为 [0, 1]，值越接近 1 表示模型拟合效果越好。计算公式为：
      </p>
      <p>
       <span class="katex--display">
        <span class="katex-display">
         <span class="katex">
          <span class="katex-mathml">
           R 
            
           
             2 
            
           
          
            = 
           
          
            1 
           
          
            − 
           
           
            
             
             
               ∑ 
              
              
              
                i 
               
              
                = 
               
              
                1 
               
              
             
               n 
              
             
            
              ( 
             
             
             
               y 
              
             
               i 
              
             
            
              − 
             
             
              
              
                y 
               
              
                ^ 
               
              
             
               i 
              
             
             
             
               ) 
              
             
               2 
              
             
            
            
             
             
               ∑ 
              
              
              
                i 
               
              
                = 
               
              
                1 
               
              
             
               n 
              
             
            
              ( 
             
             
             
               y 
              
             
               i 
              
             
            
              − 
             
             
             
               y 
              
             
               ˉ 
              
             
             
             
               ) 
              
             
               2 
              
             
            
           
          
         
           R^2 = 1 - \frac{\sum_{i=1}^{n}(y_i - \hat{y}_i)^2}{\sum_{i=1}^{n}(y_i - \bar{y})^2}
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.8641em;">
            </span>
            <span class="mord">
             <span class="mord mathnormal" style="margin-right: 0.0077em;">
              R
             </span>
             <span class="msupsub">
              <span class="vlist-t">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.8641em;">
                 <span class="" style="top: -3.113em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mord mtight">
                    2
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
            <span class="mrel">
             =
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;">
            </span>
            <span class="mord">
             1
            </span>
            <span class="mspace" style="margin-right: 0.2222em;">
            </span>
            <span class="mbin">
             −
            </span>
            <span class="mspace" style="margin-right: 0.2222em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 2.4978em; vertical-align: -0.994em;">
            </span>
            <span class="mord">
             <span class="mopen nulldelimiter">
             </span>
             <span class="mfrac">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 1.5038em;">
                 <span class="" style="top: -2.3057em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mop">
                    <span class="mop op-symbol small-op" style="position: relative; top: 0em;">
                     ∑
                    </span>
                    <span class="msupsub">
                     <span class="vlist-t vlist-t2">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.8043em;">
                        <span class="" style="top: -2.4003em; margin-left: 0em; margin-right: 0.05em;">
                         <span class="pstrut" style="height: 2.7em;">
                         </span>
                         <span class="sizing reset-size6 size3 mtight">
                          <span class="mord mtight">
                           <span class="mord mathnormal mtight">
                            i
                           </span>
                           <span class="mrel mtight">
                            =
                           </span>
                           <span class="mord mtight">
                            1
                           </span>
                          </span>
                         </span>
                        </span>
                        <span class="" style="top: -3.2029em; margin-right: 0.05em;">
                         <span class="pstrut" style="height: 2.7em;">
                         </span>
                         <span class="sizing reset-size6 size3 mtight">
                          <span class="mord mtight">
                           <span class="mord mathnormal mtight">
                            n
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                       <span class="vlist-s">
                        ​
                       </span>
                      </span>
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.2997em;">
                        <span class="">
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="mopen">
                    (
                   </span>
                   <span class="mord">
                    <span class="mord mathnormal" style="margin-right: 0.0359em;">
                     y
                    </span>
                    <span class="msupsub">
                     <span class="vlist-t vlist-t2">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.3117em;">
                        <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
                         <span class="pstrut" style="height: 2.7em;">
                         </span>
                         <span class="sizing reset-size6 size3 mtight">
                          <span class="mord mathnormal mtight">
                           i
                          </span>
                         </span>
                        </span>
                       </span>
                       <span class="vlist-s">
                        ​
                       </span>
                      </span>
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.15em;">
                        <span class="">
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="mspace" style="margin-right: 0.2222em;">
                   </span>
                   <span class="mbin">
                    −
                   </span>
                   <span class="mspace" style="margin-right: 0.2222em;">
                   </span>
                   <span class="mord accent">
                    <span class="vlist-t vlist-t2">
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.5678em;">
                       <span class="" style="top: -3em;">
                        <span class="pstrut" style="height: 3em;">
                        </span>
                        <span class="mord mathnormal" style="margin-right: 0.0359em;">
                         y
                        </span>
                       </span>
                       <span class="" style="top: -3em;">
                        <span class="pstrut" style="height: 3em;">
                        </span>
                        <span class="accent-body" style="left: -0.1944em;">
                         <span class="mord">
                          ˉ
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="vlist-s">
                       ​
                      </span>
                     </span>
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.1944em;">
                       <span class="">
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="mclose">
                    <span class="mclose">
                     )
                    </span>
                    <span class="msupsub">
                     <span class="vlist-t">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.7401em;">
                        <span class="" style="top: -2.989em; margin-right: 0.05em;">
                         <span class="pstrut" style="height: 2.7em;">
                         </span>
                         <span class="sizing reset-size6 size3 mtight">
                          <span class="mord mtight">
                           2
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="" style="top: -3.23em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="frac-line" style="border-bottom-width: 0.04em;">
                  </span>
                 </span>
                 <span class="" style="top: -3.6897em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mop">
                    <span class="mop op-symbol small-op" style="position: relative; top: 0em;">
                     ∑
                    </span>
                    <span class="msupsub">
                     <span class="vlist-t vlist-t2">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.8043em;">
                        <span class="" style="top: -2.4003em; margin-left: 0em; margin-right: 0.05em;">
                         <span class="pstrut" style="height: 2.7em;">
                         </span>
                         <span class="sizing reset-size6 size3 mtight">
                          <span class="mord mtight">
                           <span class="mord mathnormal mtight">
                            i
                           </span>
                           <span class="mrel mtight">
                            =
                           </span>
                           <span class="mord mtight">
                            1
                           </span>
                          </span>
                         </span>
                        </span>
                        <span class="" style="top: -3.2029em; margin-right: 0.05em;">
                         <span class="pstrut" style="height: 2.7em;">
                         </span>
                         <span class="sizing reset-size6 size3 mtight">
                          <span class="mord mtight">
                           <span class="mord mathnormal mtight">
                            n
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                       <span class="vlist-s">
                        ​
                       </span>
                      </span>
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.2997em;">
                        <span class="">
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="mopen">
                    (
                   </span>
                   <span class="mord">
                    <span class="mord mathnormal" style="margin-right: 0.0359em;">
                     y
                    </span>
                    <span class="msupsub">
                     <span class="vlist-t vlist-t2">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.3117em;">
                        <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
                         <span class="pstrut" style="height: 2.7em;">
                         </span>
                         <span class="sizing reset-size6 size3 mtight">
                          <span class="mord mathnormal mtight">
                           i
                          </span>
                         </span>
                        </span>
                       </span>
                       <span class="vlist-s">
                        ​
                       </span>
                      </span>
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.15em;">
                        <span class="">
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="mspace" style="margin-right: 0.2222em;">
                   </span>
                   <span class="mbin">
                    −
                   </span>
                   <span class="mspace" style="margin-right: 0.2222em;">
                   </span>
                   <span class="mord">
                    <span class="mord accent">
                     <span class="vlist-t vlist-t2">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.6944em;">
                        <span class="" style="top: -3em;">
                         <span class="pstrut" style="height: 3em;">
                         </span>
                         <span class="mord mathnormal" style="margin-right: 0.0359em;">
                          y
                         </span>
                        </span>
                        <span class="" style="top: -3em;">
                         <span class="pstrut" style="height: 3em;">
                         </span>
                         <span class="accent-body" style="left: -0.1944em;">
                          <span class="mord">
                           ^
                          </span>
                         </span>
                        </span>
                       </span>
                       <span class="vlist-s">
                        ​
                       </span>
                      </span>
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.1944em;">
                        <span class="">
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                    <span class="msupsub">
                     <span class="vlist-t vlist-t2">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.3117em;">
                        <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
                         <span class="pstrut" style="height: 2.7em;">
                         </span>
                         <span class="sizing reset-size6 size3 mtight">
                          <span class="mord mathnormal mtight">
                           i
                          </span>
                         </span>
                        </span>
                       </span>
                       <span class="vlist-s">
                        ​
                       </span>
                      </span>
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.15em;">
                        <span class="">
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="mclose">
                    <span class="mclose">
                     )
                    </span>
                    <span class="msupsub">
                     <span class="vlist-t">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.8141em;">
                        <span class="" style="top: -3.063em; margin-right: 0.05em;">
                         <span class="pstrut" style="height: 2.7em;">
                         </span>
                         <span class="sizing reset-size6 size3 mtight">
                          <span class="mord mtight">
                           2
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 0.994em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="mclose nulldelimiter">
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       <br/>
       其中，
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          y 
           
          
            i 
           
          
         
        
          y_i
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.625em; vertical-align: -0.1944em;">
           </span>
           <span class="mord">
            <span class="mord mathnormal" style="margin-right: 0.0359em;">
             y
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.3117em;">
                <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mathnormal mtight">
                   i
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.15em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       是实际值，
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          y 
            
           
             ^ 
            
           
          
            i 
           
          
         
        
          \hat{y}_i
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;">
           </span>
           <span class="mord">
            <span class="mord accent">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.6944em;">
                <span class="" style="top: -3em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord mathnormal" style="margin-right: 0.0359em;">
                  y
                 </span>
                </span>
                <span class="" style="top: -3em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="accent-body" style="left: -0.1944em;">
                  <span class="mord">
                   ^
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.1944em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.3117em;">
                <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mathnormal mtight">
                   i
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.15em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       是模型的预测值，
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          y 
           
          
            ˉ 
           
          
         
        
          \bar{y}
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.7622em; vertical-align: -0.1944em;">
           </span>
           <span class="mord accent">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.5678em;">
               <span class="" style="top: -3em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="mord mathnormal" style="margin-right: 0.0359em;">
                 y
                </span>
               </span>
               <span class="" style="top: -3em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="accent-body" style="left: -0.1944em;">
                 <span class="mord">
                  ˉ
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.1944em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       是实际值的均值，
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          n 
          
         
        
          n
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.4306em;">
           </span>
           <span class="mord mathnormal">
            n
           </span>
          </span>
         </span>
        </span>
       </span>
       是样本数量。
      </p>
     </li>
    </ul>
    <h4>
     <a id="52__630">
     </a>
     5.2 风险与收益指标
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        夏普比率
       </strong>
       ：衡量单位风险的超额回报，越高越好。计算公式为：
      </p>
      <p>
       <span class="katex--display">
        <span class="katex-display">
         <span class="katex">
          <span class="katex-mathml">
           夏普比率 
           
          
            = 
           
           
            
             
             
               R 
              
             
               p 
              
             
            
              − 
             
             
             
               R 
              
             
               f 
              
             
            
            
            
              σ 
             
            
              p 
             
            
           
          
         
           \text{夏普比率} = \frac{R_p - R_f}{\sigma_p}
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.6833em;">
            </span>
            <span class="mord text">
             <span class="mord cjk_fallback">
              夏普比率
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
            <span class="mrel">
             =
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 2.3324em; vertical-align: -0.9721em;">
            </span>
            <span class="mord">
             <span class="mopen nulldelimiter">
             </span>
             <span class="mfrac">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 1.3603em;">
                 <span class="" style="top: -2.314em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mord">
                    <span class="mord mathnormal" style="margin-right: 0.0359em;">
                     σ
                    </span>
                    <span class="msupsub">
                     <span class="vlist-t vlist-t2">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.1514em;">
                        <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
                         <span class="pstrut" style="height: 2.7em;">
                         </span>
                         <span class="sizing reset-size6 size3 mtight">
                          <span class="mord mathnormal mtight">
                           p
                          </span>
                         </span>
                        </span>
                       </span>
                       <span class="vlist-s">
                        ​
                       </span>
                      </span>
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.2861em;">
                        <span class="">
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="" style="top: -3.23em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="frac-line" style="border-bottom-width: 0.04em;">
                  </span>
                 </span>
                 <span class="" style="top: -3.677em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mord">
                    <span class="mord mathnormal" style="margin-right: 0.0077em;">
                     R
                    </span>
                    <span class="msupsub">
                     <span class="vlist-t vlist-t2">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.1514em;">
                        <span class="" style="top: -2.55em; margin-left: -0.0077em; margin-right: 0.05em;">
                         <span class="pstrut" style="height: 2.7em;">
                         </span>
                         <span class="sizing reset-size6 size3 mtight">
                          <span class="mord mathnormal mtight">
                           p
                          </span>
                         </span>
                        </span>
                       </span>
                       <span class="vlist-s">
                        ​
                       </span>
                      </span>
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.2861em;">
                        <span class="">
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="mspace" style="margin-right: 0.2222em;">
                   </span>
                   <span class="mbin">
                    −
                   </span>
                   <span class="mspace" style="margin-right: 0.2222em;">
                   </span>
                   <span class="mord">
                    <span class="mord mathnormal" style="margin-right: 0.0077em;">
                     R
                    </span>
                    <span class="msupsub">
                     <span class="vlist-t vlist-t2">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.3361em;">
                        <span class="" style="top: -2.55em; margin-left: -0.0077em; margin-right: 0.05em;">
                         <span class="pstrut" style="height: 2.7em;">
                         </span>
                         <span class="sizing reset-size6 size3 mtight">
                          <span class="mord mathnormal mtight" style="margin-right: 0.1076em;">
                           f
                          </span>
                         </span>
                        </span>
                       </span>
                       <span class="vlist-s">
                        ​
                       </span>
                      </span>
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.2861em;">
                        <span class="">
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 0.9721em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="mclose nulldelimiter">
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       <br/>
       其中，
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          R 
           
          
            p 
           
          
         
        
          R_p
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.9694em; vertical-align: -0.2861em;">
           </span>
           <span class="mord">
            <span class="mord mathnormal" style="margin-right: 0.0077em;">
             R
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.1514em;">
                <span class="" style="top: -2.55em; margin-left: -0.0077em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mathnormal mtight">
                   p
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.2861em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       是策略的预期收益率，
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          R 
           
          
            f 
           
          
         
        
          R_f
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.9694em; vertical-align: -0.2861em;">
           </span>
           <span class="mord">
            <span class="mord mathnormal" style="margin-right: 0.0077em;">
             R
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.3361em;">
                <span class="" style="top: -2.55em; margin-left: -0.0077em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mathnormal mtight" style="margin-right: 0.1076em;">
                   f
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.2861em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       是无风险利率，
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          σ 
           
          
            p 
           
          
         
        
          \sigma_p
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.7167em; vertical-align: -0.2861em;">
           </span>
           <span class="mord">
            <span class="mord mathnormal" style="margin-right: 0.0359em;">
             σ
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.1514em;">
                <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mathnormal mtight">
                   p
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.2861em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       是策略收益率的标准差。较高的夏普比率表示策略在承担相同风险的情况下获得了更高的回报。
      </p>
     </li>
     <li>
      <p>
       <strong>
        累积收益
       </strong>
       ：反映策略的整体表现。通过计算策略在每个时间点的净值变化，绘制累积收益曲线。平滑上升的累积收益曲线表示策略表现良好，且波动较小。
      </p>
     </li>
     <li>
      <p>
       <strong>
        总收益
       </strong>
       ：反映策略的总体盈利能力，计算公式为：
      </p>
      <p>
       <span class="katex--display">
        <span class="katex-display">
         <span class="katex">
          <span class="katex-mathml">
           总收益 
           
          
            = 
           
           
            
            
              最终资产价值 
             
            
              − 
             
            
              初始资产价值 
             
            
           
             初始资产价值 
            
           
          
            × 
           
          
            100 
           
          
            % 
           
          
         
           \text{总收益} = \frac{\text{最终资产价值} - \text{初始资产价值}}{\text{初始资产价值}} \times 100\%
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.6833em;">
            </span>
            <span class="mord text">
             <span class="mord cjk_fallback">
              总收益
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
            <span class="mrel">
             =
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 2.0463em; vertical-align: -0.686em;">
            </span>
            <span class="mord">
             <span class="mopen nulldelimiter">
             </span>
             <span class="mfrac">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 1.3603em;">
                 <span class="" style="top: -2.314em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mord text">
                    <span class="mord cjk_fallback">
                     初始资产价值
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="" style="top: -3.23em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="frac-line" style="border-bottom-width: 0.04em;">
                  </span>
                 </span>
                 <span class="" style="top: -3.677em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mord text">
                    <span class="mord cjk_fallback">
                     最终资产价值
                    </span>
                   </span>
                   <span class="mspace" style="margin-right: 0.2222em;">
                   </span>
                   <span class="mbin">
                    −
                   </span>
                   <span class="mspace" style="margin-right: 0.2222em;">
                   </span>
                   <span class="mord text">
                    <span class="mord cjk_fallback">
                     初始资产价值
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 0.686em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="mclose nulldelimiter">
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.2222em;">
            </span>
            <span class="mbin">
             ×
            </span>
            <span class="mspace" style="margin-right: 0.2222em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 0.8056em; vertical-align: -0.0556em;">
            </span>
            <span class="mord">
             100%
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       <br/>
       较高的总收益表示策略盈利能力强。
      </p>
     </li>
     <li>
      <p>
       <strong>
        最大回撤 (MDD)
       </strong>
       ：衡量策略在选定周期内可能出现的最大损失。计算公式为：
      </p>
      <p>
       <span class="katex--display">
        <span class="katex-display">
         <span class="katex">
          <span class="katex-mathml">
           MDD 
           
          
            = 
           
          
            max 
           
          
            ⁡ 
           
           
           
             ( 
            
            
             
             
               高点净值 
              
             
               − 
              
             
               低点净值 
              
             
            
              高点净值 
             
            
           
             ) 
            
           
          
         
           \text{MDD} = \max\left(\frac{\text{高点净值} - \text{低点净值}}{\text{高点净值}}\right)
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.6833em;">
            </span>
            <span class="mord text">
             <span class="mord">
              MDD
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
            <span class="mrel">
             =
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 2.4em; vertical-align: -0.95em;">
            </span>
            <span class="mop">
             max
            </span>
            <span class="mspace" style="margin-right: 0.1667em;">
            </span>
            <span class="minner">
             <span class="mopen delimcenter" style="top: 0em;">
              <span class="delimsizing size3">
               (
              </span>
             </span>
             <span class="mord">
              <span class="mopen nulldelimiter">
              </span>
              <span class="mfrac">
               <span class="vlist-t vlist-t2">
                <span class="vlist-r">
                 <span class="vlist" style="height: 1.3603em;">
                  <span class="" style="top: -2.314em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="mord">
                    <span class="mord text">
                     <span class="mord cjk_fallback">
                      高点净值
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="" style="top: -3.23em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="frac-line" style="border-bottom-width: 0.04em;">
                   </span>
                  </span>
                  <span class="" style="top: -3.677em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="mord">
                    <span class="mord text">
                     <span class="mord cjk_fallback">
                      高点净值
                     </span>
                    </span>
                    <span class="mspace" style="margin-right: 0.2222em;">
                    </span>
                    <span class="mbin">
                     −
                    </span>
                    <span class="mspace" style="margin-right: 0.2222em;">
                    </span>
                    <span class="mord text">
                     <span class="mord cjk_fallback">
                      低点净值
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="vlist-s">
                  ​
                 </span>
                </span>
                <span class="vlist-r">
                 <span class="vlist" style="height: 0.686em;">
                  <span class="">
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="mclose nulldelimiter">
              </span>
             </span>
             <span class="mclose delimcenter" style="top: 0em;">
              <span class="delimsizing size3">
               )
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       <br/>
       较低的最大回撤表示策略抗风险能力较强。
      </p>
     </li>
     <li>
      <p>
       <strong>
        卡玛比率 (Calmar Ratio)
       </strong>
       ：衡量单位最大回撤的复合年化收益率，越高越好。计算公式为：
      </p>
      <p>
       <span class="katex--display">
        <span class="katex-display">
         <span class="katex">
          <span class="katex-mathml">
           卡玛比率 
           
          
            = 
           
           
           
             复合年化收益率 
            
           
             最大回撤 
            
           
          
         
           \text{卡玛比率} = \frac{\text{复合年化收益率}}{\text{最大回撤}}
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.6833em;">
            </span>
            <span class="mord text">
             <span class="mord cjk_fallback">
              卡玛比率
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
            <span class="mrel">
             =
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 2.0463em; vertical-align: -0.686em;">
            </span>
            <span class="mord">
             <span class="mopen nulldelimiter">
             </span>
             <span class="mfrac">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 1.3603em;">
                 <span class="" style="top: -2.314em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mord text">
                    <span class="mord cjk_fallback">
                     最大回撤
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="" style="top: -3.23em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="frac-line" style="border-bottom-width: 0.04em;">
                  </span>
                 </span>
                 <span class="" style="top: -3.677em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mord text">
                    <span class="mord cjk_fallback">
                     复合年化收益率
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 0.686em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="mclose nulldelimiter">
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </p>
     </li>
     <li>
      <p>
       <strong>
        胜率
       </strong>
       ：衡量策略在交易中盈利的频率，计算公式为：
      </p>
      <p>
       <span class="katex--display">
        <span class="katex-display">
         <span class="katex">
          <span class="katex-mathml">
           胜率 
           
          
            = 
           
           
           
             盈利交易次数 
            
           
             总交易次数 
            
           
          
            × 
           
          
            100 
           
          
            % 
           
          
         
           \text{胜率} = \frac{\text{盈利交易次数}}{\text{总交易次数}} \times 100\%
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.6833em;">
            </span>
            <span class="mord text">
             <span class="mord cjk_fallback">
              胜率
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
            <span class="mrel">
             =
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 2.0463em; vertical-align: -0.686em;">
            </span>
            <span class="mord">
             <span class="mopen nulldelimiter">
             </span>
             <span class="mfrac">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 1.3603em;">
                 <span class="" style="top: -2.314em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mord text">
                    <span class="mord cjk_fallback">
                     总交易次数
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="" style="top: -3.23em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="frac-line" style="border-bottom-width: 0.04em;">
                  </span>
                 </span>
                 <span class="" style="top: -3.677em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mord text">
                    <span class="mord cjk_fallback">
                     盈利交易次数
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 0.686em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="mclose nulldelimiter">
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.2222em;">
            </span>
            <span class="mbin">
             ×
            </span>
            <span class="mspace" style="margin-right: 0.2222em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 0.8056em; vertical-align: -0.0556em;">
            </span>
            <span class="mord">
             100%
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       <br/>
       较高的胜率表示策略在多数交易中能够获利。
      </p>
     </li>
    </ul>
    <h4>
     <a id="53__668">
     </a>
     5.3 如何判断是否达到了预期
    </h4>
    <ul>
     <li>
      <strong>
       MSE 和 MAE
      </strong>
      ：如果这两个指标低于预期阈值（如 MSE &lt; 0.05，MAE &lt; 0.1），则认为模型预测准确。
     </li>
     <li>
      <strong>
       R² 分数
      </strong>
      ：如果 R² 分数高于预期阈值（如 0.8 或更高），则认为模型解释能力强。
     </li>
     <li>
      <strong>
       夏普比率
      </strong>
      ：如果夏普比率高于预期阈值（如 1.0 或更高），则认为策略在承担相同风险的情况下获得了更高的回报。
     </li>
     <li>
      <strong>
       累积收益
      </strong>
      ：如果累积收益曲线平滑上升且没有大幅波动，则认为策略表现稳定。
     </li>
     <li>
      <strong>
       总收益
      </strong>
      ：如果总收益高于预期阈值（如 10% 或更高），则认为策略盈利能力强。
     </li>
     <li>
      <strong>
       最大回撤
      </strong>
      ：如果最大回撤低于预期阈值（如 10% 或更低），则认为策略抗风险能力较强。
     </li>
     <li>
      <strong>
       卡玛比率
      </strong>
      ：如果卡玛比率高于预期阈值（如 1.0 或更高），则认为策略在控制回撤方面表现良好。
     </li>
     <li>
      <strong>
       胜率
      </strong>
      ：如果胜率高于预期阈值（如 50% 或更高），则认为策略在多数交易中能够获利。
     </li>
    </ul>
    <blockquote>
     <p>
      <strong>
       风险提示与免责声明
      </strong>
      <br/>
      本文内容基于公开信息研究整理，不构成任何形式的投资建议。历史表现不应作为未来收益保证，市场存在不可预见的波动风险。投资者需结合自身财务状况及风险承受能力独立决策，并自行承担交易结果。作者及发布方不对任何依据本文操作导致的损失承担法律责任。市场有风险，投资须谨慎。
     </p>
    </blockquote>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34373333393931362f:61727469636c652f64657461696c732f313436333030373831" class_="artid" style="display:none">
 </p>
</div>


