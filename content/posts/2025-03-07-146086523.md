---
layout: post
title: "微信小程序uniapp开发微信小程序"
date: 2025-03-07 09:31:47 +0800
description: "下拉加载结束后，停止刷新。"
keywords: "uniapp+微信小程序中下拉刷新"
categories: ['未分类']
tags: ['微信小程序', 'Vue', 'App']
artid: "146086523"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146086523
    alt: "微信小程序uniapp开发微信小程序"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146086523
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146086523
cover: https://bing.ee123.net/img/rand?artid=146086523
image: https://bing.ee123.net/img/rand?artid=146086523
img: https://bing.ee123.net/img/rand?artid=146086523
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【微信小程序】uniapp开发微信小程序
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="uniapp_0">
     </a>
     uniapp开发微信小程序
    </h2>
    <h5>
     <a id="1___2">
     </a>
     1、上拉加载 下拉刷新
    </h5>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> onReachBottom<span class="token punctuation">,</span> onPullDownRefresh <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@dcloudio/uni-app'</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     配置允许下拉刷新：
    </p>
    <pre><code class="prism language-js"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"path"</span> <span class="token operator">:</span> <span class="token string">"pages/pet/pet"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"style"</span> <span class="token operator">:</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"navigationBarTitleText"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
        <span class="token comment">// 设置允许下拉刷新</span>
        <span class="token string-property property">"enablePullDownRefresh"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// 设置触底加载更多操作</span>
        <span class="token string-property property">"onReachBottomDistance"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        <span class="token comment">// 页面标题</span>
        <span class="token string-property property">"navigationBarTitleText"</span><span class="token operator">:</span> <span class="token string">"萌宠案例"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     下拉加载结束后，停止刷新
    </p>
    <pre><code class="prism language-js">uni<span class="token punctuation">.</span><span class="token function">stopPullDownRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="2_32">
     </a>
     2、设置加载更多
    </h5>
    <p>
     需要集成模块
    </p>
    <pre><code class="prism language-js"><span class="token operator">&lt;</span>uni<span class="token operator">-</span>load<span class="token operator">-</span>more status<span class="token operator">=</span><span class="token string">"loading"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>uni<span class="token operator">-</span>load<span class="token operator">-</span>more<span class="token operator">&gt;</span>
</code></pre>
    <h5>
     <a id="3_40">
     </a>
     3、图片大图预览
    </h5>
    <p>
     current: 当前第几张， urls:图片地址
    </p>
    <pre><code class="prism language-js">uni<span class="token punctuation">.</span><span class="token function">previewImage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 当前图片为第几张</span>
    <span class="token literal-property property">current</span><span class="token operator">:</span> index<span class="token punctuation">,</span>
    <span class="token comment">// 图片地址</span>
    <span class="token literal-property property">urls</span><span class="token operator">:</span> petList<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="4_53">
     </a>
     4、一键回顶部
    </h5>
    <p>
     一键回顶部
    </p>
    <pre><code class="prism language-js">uni<span class="token punctuation">.</span><span class="token function">pageScrollTo</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token literal-property property">scrollTop</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="5_64">
     </a>
     5、获取用户头像
    </h5>
    <pre><code class="prism language-js"><span class="token operator">&lt;</span>button open<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">"chooseAvatar"</span> @chooseavatar<span class="token operator">=</span><span class="token string">"getUserAvatar"</span><span class="token operator">&gt;</span>获取用户头像<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>

<span class="token comment">// 获取用户头像</span>
<span class="token function">getUserAvatar</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>avatarUrl <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>avatarUrl
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="6_75">
     </a>
     6、获取用户昵称
    </h5>
    <pre><code class="prism language-js"><span class="token operator">&lt;</span>input v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"wechatNickname"</span> placeholder<span class="token operator">-</span> style<span class="token operator">=</span><span class="token string">"color:#A1AABF;"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"passInput"</span> type<span class="token operator">=</span><span class="token string">"nickname"</span>
			<span class="token operator">:</span>border<span class="token operator">=</span><span class="token string">"false"</span> @change<span class="token operator">=</span><span class="token string">"getName"</span> placeholder<span class="token operator">=</span><span class="token string">"获取微信昵称"</span> <span class="token operator">:</span>clearable<span class="token operator">=</span><span class="token string">"false"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
			
<span class="token function">getName</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>wechatNickname <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
    <h5>
     <a id="7_86">
     </a>
     7、获取用户手机号
    </h5>
    <p>
     (测试号和企业账户可以直接获取,个人号无法使用)
    </p>
    <pre><code class="prism language-js"><span class="token operator">&lt;</span>button open<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">"getPhoneNumber"</span> @getphonenumber<span class="token operator">=</span><span class="token string">"ongetphonenumber"</span><span class="token operator">&gt;</span>一键获取手机号<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>

<span class="token keyword">async</span> <span class="token function">ongetphonenumber</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span>detail<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'获取手机号'</span><span class="token punctuation">)</span>
    <span class="token comment">// 判断是否授权成功</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>detail<span class="token punctuation">.</span>iv<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>  <span class="token punctuation">}</span>
        <span class="token comment">// 去后端请求获取真正的号码</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="8_104">
     </a>
     8、动态修改顶部导航文字
    </h5>
    <pre><code class="prism language-js"><span class="token comment">// 动态修改顶部导航</span>
uni<span class="token punctuation">.</span><span class="token function">setNavigationBarTitle</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	<span class="token literal-property property">title</span><span class="token operator">:</span> name
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="9url_113">
     </a>
     9、获取页面的url参数
    </h5>
    <pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> onLoad <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@dcloudio/uni-app'</span>

<span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="10_ifdef_123">
     </a>
     10、不同平台下，使用不同的代码 #ifdef
    </h5>
    <p>
     在css和js和template中都可以进行使用
    </p>
    <pre><code class="prism language-js"><span class="token comment">// #ifdef MP-TOUTIAO</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'这里是抖音的逻辑'</span><span class="token punctuation">)</span>
<span class="token comment">// #endif</span>


<span class="token comment">// #ifndef MP-TOUTIAO</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'这里是除了抖音以外的逻辑'</span><span class="token punctuation">)</span>
<span class="token comment">// #endnif</span>
</code></pre>
    <h5>
     <a id="11_138">
     </a>
     11、不同平台情况下，获取安全区域以及胶囊按钮高度
    </h5>
    <pre><code class="prism language-js"><span class="token keyword">let</span> <span class="token constant">SYSTEM_INFO</span> <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 安全区域</span>
<span class="token keyword">export</span> <span class="token keyword">let</span> <span class="token function-variable function">getStatusBarHeight</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">SYSTEM_INFO</span><span class="token punctuation">.</span>statusBarHeight <span class="token operator">||</span> <span class="token number">10</span>

<span class="token comment">// 胶囊按钮</span>

<span class="token keyword">export</span> <span class="token keyword">let</span> <span class="token function-variable function">getTitleBarHeight</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>uni<span class="token punctuation">.</span>getMenuButtonBoundingClientRect<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">let</span> <span class="token punctuation">{<!-- --></span>
			top<span class="token punctuation">,</span>
			height
		<span class="token punctuation">}</span> <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getMenuButtonBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>top <span class="token operator">-</span> <span class="token function">getStatusBarHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> height
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">50</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getNavBarHeight</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token function">getStatusBarHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">getTitleBarHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getIconLeft</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// #ifdef MP-TOUTIAO</span>
	<span class="token keyword">return</span> tt<span class="token punctuation">.</span><span class="token function">getCustomButtonBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>leftIcon<span class="token punctuation">.</span>width
	<span class="token comment">//  #endif</span>

	<span class="token comment">// #ifndef MP-TOUTIAO</span>
	<span class="token keyword">return</span> <span class="token number">0</span>
	<span class="token comment">// #endif</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="12_173">
     </a>
     12、开启朋友圈分享|分享给好友
    </h5>
    <p>
     需要在组件中实现两个方法
     <code>
      onShareAppMessage
     </code>
     ,
     <code>
      onShareTimeline
     </code>
    </p>
    <p>
     注意: 分享到朋友圈,未认证的账号无法使用,需要测试号或者认证后的账号
    </p>
    <pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>
    onShareAppMessage<span class="token punctuation">,</span>
    onShareTimeline
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@dcloudio/uni-app'</span>

<span class="token comment">// 分享给朋友 </span>
<span class="token function">onShareAppMessage</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'~咸虾米壁纸~'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 朋友圈</span>
<span class="token function">onShareTimeline</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'~咸虾米壁纸~'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">imageUrl</span><span class="token operator">:</span> <span class="token string">'/static/xxmLogo.png'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="13_201">
     </a>
     13、设置通屏
    </h5>
    <p>
     在pages.json中设置页面的
     <code>
      navigationStyle
     </code>
     属性为
     <code>
      custom
     </code>
    </p>
    <pre><code class="prism language-js"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"path"</span><span class="token operator">:</span> <span class="token string">"pages/index/index"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"style"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"navigationBarTitleText"</span><span class="token operator">:</span> <span class="token string">"推荐"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"navigationStyle"</span><span class="token operator">:</span> <span class="token string">"custom"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
    <h5>
     <a id="14_215">
     </a>
     14、图片保存到本地
    </h5>
    <pre><code class="prism language-js"><span class="token comment">// #ifdef  H5</span>
uni<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'请长按图片进行保存'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">showCancel</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// #endif</span>

<span class="token comment">// #ifndef H5</span>
<span class="token keyword">let</span> filePath <span class="token operator">=</span> <span class="token string">'https://cdn.qingnian8.com/public/xxmBizhi/20240914/1726307754431_8.jpg'</span>
uni<span class="token punctuation">.</span><span class="token function">getImageInfo</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">src</span><span class="token operator">:</span> filePath<span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        uni<span class="token punctuation">.</span><span class="token function">saveImageToPhotosAlbum</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">filePath</span><span class="token operator">:</span> res<span class="token punctuation">.</span>path<span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'保存成功'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">'none'</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// #endif</span>
</code></pre>
    <h5>
     <a id="15request_244">
     </a>
     15、request请求工具类
    </h5>
    <pre><code class="prism language-js"><span class="token keyword">const</span> baseURL <span class="token operator">=</span> <span class="token string">'https://tea.qingnian8.com'</span>

<span class="token keyword">const</span> httpInterceptor <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">invoke</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">let</span> token <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span>
		options<span class="token punctuation">.</span>header <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
			<span class="token punctuation">[</span><span class="token string">'access-key'</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'488957'</span><span class="token punctuation">,</span>
			<span class="token literal-property property">Authorization</span><span class="token operator">:</span> token<span class="token punctuation">,</span>
			<span class="token operator">...</span>options<span class="token punctuation">.</span>header
		<span class="token punctuation">}</span>
		options<span class="token punctuation">.</span>header<span class="token punctuation">[</span><span class="token string">'acess-key'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'488957'</span>
		options<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1000</span>
		options<span class="token punctuation">.</span>url <span class="token operator">=</span> baseURL <span class="token operator">+</span> options<span class="token punctuation">.</span>url
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 请求拦截器</span>
uni<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> httpInterceptor<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">request</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// uni.showLoading({<!-- --></span>
	<span class="token comment">// 	mask: true,</span>
	<span class="token comment">// 	title: "数据加载中...",</span>
	<span class="token comment">// });</span>
		
	uni<span class="token punctuation">.</span><span class="token function">showNavigationBarLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		uni<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
			<span class="token operator">...</span>options<span class="token punctuation">,</span>
            <span class="token comment">// 响应拦截器</span>
			<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 获取当前页面的栈</span>
				<span class="token keyword">const</span> pages <span class="token operator">=</span> <span class="token function">getCurrentPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pages<span class="token punctuation">,</span> <span class="token string">'=============='</span><span class="token punctuation">)</span>
				<span class="token comment">// 获取当前页面</span>
				<span class="token keyword">const</span> currentPage <span class="token operator">=</span> pages<span class="token punctuation">[</span>pages<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token comment">// 获取当前页面的路由</span>
				<span class="token keyword">const</span> currentRoute <span class="token operator">=</span> currentPage<span class="token punctuation">.</span>route<span class="token punctuation">;</span>
				<span class="token comment">// 定义401不需要登录的路由数组</span>
				<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"pages/index/index"</span><span class="token punctuation">]</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusCode <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>errCode <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>errCode <span class="token operator">===</span> <span class="token number">401</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>routes<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>currentRoute<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						uni<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
							<span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"温馨提示"</span><span class="token punctuation">,</span>
							<span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">"您还没有登录，是否去登录"</span><span class="token punctuation">,</span>
							<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
								<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>confirm<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
									uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
										<span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"/pages/login/login"</span><span class="token punctuation">,</span>
									<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
									uni<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
										<span class="token literal-property property">delta</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
									<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								<span class="token punctuation">}</span>
							<span class="token punctuation">}</span><span class="token punctuation">,</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>errCode <span class="token operator">===</span> <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
							<span class="token literal-property property">title</span><span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>errMsg<span class="token punctuation">,</span>
							<span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">'none'</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
						<span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
					<span class="token function">reject</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">// 响应失败</span>
			<span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
				uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span>
					<span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"网络错误, 换个网络试试"</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				uni<span class="token punctuation">.</span><span class="token function">hideNavigationBarLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> request
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e63:73646e2e6e65742f716975716975313632383438303530322f:61727469636c652f64657461696c732f313436303836353233" class_="artid" style="display:none">
 </p>
</div>


