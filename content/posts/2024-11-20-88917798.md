---
layout: post
title: "音视频pts计算"
date: 2024-11-20 20:03:45 +0800
description: "视频pts计算PTS（Presentation Time Stamp）：即显示时间戳，这个时间戳用来"
keywords: "vlc 视频流pts计算"
categories: ['C']
tags: ['无标签']
artid: "88917798"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=88917798
    alt: "音视频pts计算"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=88917798
featuredImagePreview: https://bing.ee123.net/img/rand?artid=88917798
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     音视频pts计算
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h4>
     <strong>
      视频pts计算
     </strong>
    </h4>
    <p>
     PTS（Presentation Time Stamp）：即显示时间戳，这个时间戳用来告诉播放器该在什么时候显示这一帧的数据。
     <br/>
     DTS（Decoding Time Stamp）：即解码时间戳，这个时间戳的意义在于告诉播放器该在什么时候解码这一帧的数据。
    </p>
    <p>
     需要注意的是：虽然 DTS、PTS 是用于指导播放端的行为，但它们是在编码的时候由编码器生成的。当视频流中没有 B 帧时，通常 DTS 和 PTS 的顺序是一致的。但如果有 B 帧时，就回到了我们前面说的问题：解码顺序和播放顺序不一致了。
    </p>
    <p>
     视频pts是每帧递增，假如fps是25帧的，时间基为fps的倒数1/25，那么pts递增+1即可。
    </p>
    <pre class="has"><code class="language-cpp"> //pts计算需要参考time_base， time_base代表的是时间单位，此处单位根据帧率，即25个单位一秒
      video_stream_-&gt;time_base = (AVRational) {1, 25};

      //对应到每秒25帧，即每帧一个单位，故pts计算是每帧加1
      - 第一帧：pts=1
      - 第二帧：pts=2
      - 第三帧：pts=3
      - 第n帧的pts = n * (（1 / timbase）/ fps);
      //算法即是通过time_base知道一秒有25个时间单位，帧率是25帧每秒，所以每个帧占一个时间单位</code></pre>
    <h4>
     <strong>
      音频pts计算
     </strong>
    </h4>
    <p>
     音频有采样率概念，8000，16000，32000， 44100， 48000 即每秒采样多少次，有多少个样本。
    </p>
    <h4>
     <strong>
      rtp时间戳
     </strong>
    </h4>
    <p>
     rtp中时间单位与采样率一致，以pcmu为例，每个rtp之间的时间相差160，每个rtp中pcmu长度为160.
     <br/>
     如果是AAC，AAC的frame_size＝1024，如果每帧一个包的话，每个rtp之间时间差为1024
    </p>
    <h4>
     <strong>
      文件时间戳
     </strong>
    </h4>
    <pre class="has"><code class="language-cpp">//以8000采样率示例，AAC编码，s16，单音频
   audio_stream_-&gt;time_base = (AVRational) { 1, 8000};

   AAC nb_samples ＝ 1024  frame_size＝1024

   即每秒有 8000/1024 个 AAC帧，每帧占用的时间单位根据tiem_base换算

   num = 8000/1024

   每帧时间单位 pts ＝ 8000*1/num 

   pts = n * (（1 / timbase）/ num);
   pts ＝ n * 1024</code></pre>
    <h4>
     <strong>
      总结
     </strong>
    </h4>
    <p>
     1、文件中计算音视频pts，都是根据每秒算出有多少个音视频帧， 然后根据time_base，算出每帧占有多少个时间单位，即为pts差值
     <br/>
     2、rtp传输中时间单位与采样率一致，传输多少个样本即为增加多少时间
     <br/>
     3、重点理解time_base是一种度量单位，pts是基于此种单位的数值计算
    </p>
    <h4>
     <strong>
      补充
     </strong>
    </h4>
    <p>
     1.IPB帧
     <br/>
     1）I帧关键帧，帧内压缩，包含完整的画面
     <br/>
     2）P帧差别帧，与上一个关键帧的差别，需要缓存上一帧才能得到完整画面
     <br/>
     3）B帧双向差别帧，与前后两帧的差别，需要缓存上一帧和下一帧才能得到完整画面
    </p>
    <p>
     2.判断帧的类型？
     <br/>
     AVFrame-&gt;pict_type
     <br/>
     AVPacket-&gt;flags &amp; AV_PKT_FLAG_KEY
    </p>
    <p>
     3.DTS和PTS
     <br/>
     DTS：Decoding Time stamp 解码时间戳
     <br/>
     PTS: Presentation Time Stamp 显示时间戳
    </p>
    <p>
     流    I P B
     <br/>
     DTS 1 2 3
     <br/>
     PTS 1 3 2
    </p>
    <p>
     4.FFmpeg中的时间单位
     <br/>
     time_base 时间单位（时间基）
     <br/>
     不同的结构体，有不同的时间单位
     <br/>
     AVStream *stream;
     <br/>
     time = stream-&gt;duration * stream-&gt;time_base;
    </p>
    <p>
     <br/>
     5.音视频同步的三种方案
     <br/>
     音频同步视频
     <br/>
     视频同步音频
     <br/>
     标准时间（视频已经播放了多长时间）
     <br/>
     <br/>
     原文：https://blog.csdn.net/gyj072001/article/details/78573339
    </p>
   </div>
  </div>
 </article>
 <p alt="6874:7470733a2f2f626c6f672e6373646e2e6e65742f6e5f666c79:2f61727469636c652f64657461696c732f3838393137373938" class_="artid" style="display:none">
 </p>
</div>


