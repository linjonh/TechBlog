---
layout: post
title: "STM32G431RBT6-3片上外设及其关系"
date: 2025-03-07 00:23:32 +0800
description: "STM32G431RBT6--(3)片上外设及其关系"
keywords: "stm32g431rbt6的高级定时器"
categories: ['Stm']
tags: ['嵌入式硬件', '单片机', 'Stm']
artid: "146071920"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146071920
    alt: "STM32G431RBT6-3片上外设及其关系"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146071920
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146071920
cover: https://bing.ee123.net/img/rand?artid=146071920
image: https://bing.ee123.net/img/rand?artid=146071920
img: https://bing.ee123.net/img/rand?artid=146071920
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     STM32G431RBT6--(3)片上外设及其关系
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     前边我们已经了解了STM32的内核，下面我们来介绍片上外设，对于这些外设，如果我们弄清楚一个单片机都有什么外设，弄清他们之间的关系，对于应用单片机有很大的帮助，我们以G431为例：
    </p>
    <p>
     <img alt="" height="3195" src="https://i-blog.csdnimg.cn/direct/41400495c205435084fd2caeef34aac3.png" width="893"/>
    </p>
    <p>
     这个表格描述了STM32G4系列都有什么，不难从其中看出STM32G431系列的外设，可以看出STM32G431外设还是有很多的，由于表格很清楚了，我就不在这赘述。对于这么多的外设，我们要弄清楚他们的关系， 这对我们学习很重要，比如你要用定时器，没有搞好他们的关系，你就不知道如何开启时钟，下边来简单介绍一下：
    </p>
    <p>
     <img alt="" height="1355" src="https://i-blog.csdnimg.cn/direct/4bf9b1b06ee047488ac7b3aa2153f726.png" width="1008">
     </img>
    </p>
    <p>
     这张图看起来很复杂，其实确实很复杂， 如果让你一点一点去看会感觉很烦，我们采用内核加总线的方法去看：
    </p>
    <p>
     <img alt="" height="1444" src="https://i-blog.csdnimg.cn/direct/b4a9eb79ec6d48c1830e6beefd2e564c.png" width="1159"/>
    </p>
    <h2 style="background-color:transparent">
     <strong>
      一、核心架构组成
     </strong>
    </h2>
    <ol>
     <li>
      <p>
       <strong>
        Cortex-M4 内核
       </strong>
      </p>
      <ul>
       <li>
        <p>
         最高主频170MHz，集成FPU（浮点运算单元）
        </p>
       </li>
       <li>
        <p>
         包含3条独立总线：
        </p>
        <ul>
         <li>
          <p>
           <strong>
            I-Bus
           </strong>
           ：指令总线（从Flash加载代码）
          </p>
         </li>
         <li>
          <p>
           <strong>
            D-Bus
           </strong>
           ：数据总线（访问数据空间）
          </p>
         </li>
         <li>
          <p>
           <strong>
            S-Bus
           </strong>
           ：系统总线（访问外设寄存器）
          </p>
         </li>
        </ul>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        总线系统
       </strong>
       （三级架构）
      </p>
      <pre>Cortex-M4内核
│
└─ **总线矩阵**（Bus Matrix）
   ├─ **AHB1域**（主系统总线）
   │   ├─ **APB1桥**（连接低速外设）
   │   └─ **APB2桥**（连接高速外设）
   ├─ **AHB2域**（专用外设总线）
   └─ **AHB3域**（可选扩展总线）</pre>
     </li>
    </ol>
    <h2>
     <strong>
      二、总线层级详细结构
     </strong>
    </h2>
    <h6>
     <strong>
      1. AHB总线矩阵
     </strong>
    </h6>
    <ul>
     <li>
      <p>
       <strong>
        主设备接口
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         Cortex-M4内核（通过D-Bus/S-Bus）
        </p>
       </li>
       <li>
        <p>
         DMA1/DMA2控制器
        </p>
       </li>
       <li>
        <p>
         硬件加速器（如HRTIM）
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        从设备接口
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <strong>
          AHB1域
         </strong>
         ：
        </p>
        <ul>
         <li>
          <p>
           <strong>
            SRAM1
           </strong>
           （16KB）
          </p>
         </li>
         <li>
          <p>
           <strong>
            Flash接口
           </strong>
           （128KB，支持双区架构）
          </p>
         </li>
         <li>
          <p>
           <strong>
            CRC计算单元
           </strong>
          </p>
         </li>
         <li>
          <p>
           <strong>
            系统配置模块
           </strong>
           （时钟、电源、复位控制器）
          </p>
         </li>
         <li>
          <p>
           <strong>
            APB桥
           </strong>
           （连接APB1/APB2总线）
          </p>
         </li>
        </ul>
       </li>
       <li>
        <p>
         <strong>
          AHB2域
         </strong>
         ：
        </p>
        <ul>
         <li>
          <p>
           <strong>
            GPIO端口
           </strong>
           （Port A-H）
          </p>
         </li>
         <li>
          <p>
           <strong>
            ADC1/2
           </strong>
           （12位模数转换器）
          </p>
         </li>
         <li>
          <p>
           <strong>
            DAC1/2
           </strong>
           （双通道数模转换器）
          </p>
         </li>
         <li>
          <p>
           <strong>
            RNG
           </strong>
           （真随机数生成器）
          </p>
         </li>
         <li>
          <p>
           <strong>
            AES加密模块
           </strong>
          </p>
         </li>
        </ul>
       </li>
      </ul>
     </li>
    </ul>
    <h6>
     <strong>
      2. APB总线扩展
     </strong>
    </h6>
    <ul>
     <li>
      <p>
       <strong>
        APB1总线
       </strong>
       （低速外设，通过AHB1-APB桥连接）：
      </p>
      <ul>
       <li>
        <p>
         <strong>
          定时器
         </strong>
         ：TIM2, TIM3, TIM4, TIM6, TIM7
        </p>
       </li>
       <li>
        <p>
         <strong>
          通信接口
         </strong>
         ：SPI2, I2C1, USART2
        </p>
       </li>
       <li>
        <p>
         <strong>
          系统外设
         </strong>
         ：RTC, WWDG, PWR
        </p>
       </li>
       <li>
        <p>
         <strong>
          最大频率
         </strong>
         ：170MHz（与AHB1同步）
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        APB2总线
       </strong>
       （高速外设，通过AHB1-APB桥连接）：
      </p>
      <ul>
       <li>
        <p>
         <strong>
          高级定时器
         </strong>
         ：TIM1, TIM8, HRTIM
        </p>
       </li>
       <li>
        <p>
         <strong>
          通信接口
         </strong>
         ：SPI1, USART1
        </p>
       </li>
       <li>
        <p>
         <strong>
          系统外设
         </strong>
         ：SYSCFG, EXTI
        </p>
       </li>
       <li>
        <p>
         <strong>
          最大频率
         </strong>
         ：170MHz
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h2>
     <strong>
      三、关键架构特性
     </strong>
    </h2>
    <ol>
     <li>
      <p>
       <strong>
        并行访问机制
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         DMA控制器与CPU可通过总线矩阵同时访问不同外设（如DMA传输ADC数据时，CPU可操作GPIO）
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        内存优化设计
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         Flash双区架构支持读写同步操作（程序执行时仍可擦写另一存储区）
        </p>
       </li>
       <li>
        <p>
         SRAM通过AHB1直连内核，实现零等待周期访问
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        外设速度分级
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         AHB2域外设（GPIO/DAC）支持170MHz全速操作
        </p>
       </li>
       <li>
        <p>
         APB外设可通过预分频器独立配置时钟
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        硬件加速器直连
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         AES/RNG/CRC等模块直接挂载AHB总线，规避APB带宽瓶颈
        </p>
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h2>
     <strong>
      四、典型数据路径示例
     </strong>
    </h2>
    <p>
     <strong>
      场景：ADC通过DMA传输数据到内存
     </strong>
    </p>
    <ol>
     <li>
      <p>
       <strong>
        ADC触发
       </strong>
       ：TIM1定时器通过APB2总线触发ADC采样
      </p>
     </li>
     <li>
      <p>
       <strong>
        DMA请求
       </strong>
       ：ADC通过AHB2总线向DMA控制器发送请求
      </p>
     </li>
     <li>
      <p>
       <strong>
        数据传输
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         DMA控制器通过AHB总线矩阵：
        </p>
        <ul>
         <li>
          <p>
           <strong>
            读路径
           </strong>
           ：AHB2 → ADC数据寄存器
          </p>
         </li>
         <li>
          <p>
           <strong>
            写路径
           </strong>
           ：AHB1 → SRAM1目标地址
          </p>
         </li>
        </ul>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        中断响应
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         DMA传输完成后，通过AHB总线矩阵触发NVIC中断
        </p>
       </li>
       <li>
        <p>
         CPU通过I-Bus从Flash加载中断服务程序
        </p>
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h2>
     <strong>
      五、常见错误修正说明
     </strong>
    </h2>
    <ol>
     <li>
      <p>
       <strong>
        总线层级
       </strong>
       ：APB1/APB2是AHB1通过桥接器扩展的次级总线，非AHB1的子分支
      </p>
     </li>
     <li>
      <p>
       <strong>
        外设归属
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         DAC/RNG/AES属于AHB2域（非APB总线）
        </p>
       </li>
       <li>
        <p>
         GPIO通过AHB2直接访问（无需APB桥）
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        系统配置
       </strong>
       ：时钟/电源控制器属于AHB1系统配置模块（非APB外设）
      </p>
     </li>
    </ol>
    <h2>
     <strong>
      总结
     </strong>
     ：
    </h2>
    <p>
     STM32G431通过Cortex-M4内核与多级总线架构的深度融合，构建了高效、灵活的硬件生态。其三级总线（系统总线-AHB-APB）的分层设计实现了资源解耦与并行访问，配合总线矩阵的智能仲裁机制，确保了内核、DMA与硬件加速器的高效协作。外设按性能需求精准划分至AHB2（高速直连）与APB（桥接扩展）域，结合Flash双区架构与SRAM零等待特性，显著提升了实时控制与数据处理的确定性。这种架构不仅为复杂应用（如数字电源、电机控制）提供了硬件级性能保障，更通过模块化设计降低了系统耦合度，体现了现代微控制器在性能与能效间的精密平衡。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f38303238343036382f:61727469636c652f64657461696c732f313436303731393230" class_="artid" style="display:none">
 </p>
</div>


