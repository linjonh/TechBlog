---
layout: post
title: "Spring-Boot-Security-实战指南从零开始构建安全可靠的应用"
date: 2025-03-13 16:38:15 +0800
description: "本文从零开始，介绍了如何在 Spring Boot 应用中集成 Spring Security，实现了用户认证和权限控制等核心安全功能。Spring Boot Security 功能强大，配置灵活，是构建安全可靠应用的强大后盾。下一步学习建议：官方文档是学习 Spring Security 最权威的资料。例如 OAuth2, JWT, LDAP 等。例如 ACL, RBAC 等。例如 CSRF 防护, HTTPS, 攻击防护等。希望这篇文章对您有所帮助！"
keywords: "springboot security 不使用表单"
categories: ['未分类']
tags: ['网络', '数据库', 'Spring', 'Boot']
artid: "146235230"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146235230
    alt: "Spring-Boot-Security-实战指南从零开始构建安全可靠的应用"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146235230
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146235230
cover: https://bing.ee123.net/img/rand?artid=146235230
image: https://bing.ee123.net/img/rand?artid=146235230
img: https://bing.ee123.net/img/rand?artid=146235230
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Spring Boot Security 实战指南：从零开始构建安全可靠的应用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="Spring_Boot_Security__1">
     </a>
     Spring Boot Security 实战指南：从零开始构建安全可靠的应用
    </h2>
    <p>
     <strong>
      摘要：
     </strong>
     网络安全至关重要，Spring Boot Security 提供了强大的安全框架，帮助我们轻松构建安全可靠的应用。本文将从零开始，手把手教你如何在 Spring Boot 应用中集成 Spring Security，实现用户认证、权限控制等核心安全功能，并结合代码示例，让你快速上手，打造坚如磐石的应用安全防线！
    </p>
    <hr/>
    <h3>
     <a id="1__7">
     </a>
     1. 引言：安全是应用开发的重中之重
    </h3>
    <p>
     在互联网时代，应用安全至关重要。 无论是用户数据泄露，还是恶意攻击入侵，都可能给企业和用户带来巨大损失。 Spring Boot Security 作为 Spring 全家桶中的安全模块，为我们提供了全方位的安全解决方案。
    </p>
    <p>
     <strong>
      Spring Boot Security 的优势：
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       强大而灵活：
      </strong>
      提供全面的安全特性，包括认证、授权、攻击防护等，同时又非常灵活可定制。
     </li>
     <li>
      <strong>
       易于集成：
      </strong>
      与 Spring Boot 无缝集成，配置简单，快速上手。
     </li>
     <li>
      <strong>
       基于 Spring 生态：
      </strong>
      充分利用 Spring 框架的优势，例如依赖注入、AOP 等，扩展性强。
     </li>
     <li>
      <strong>
       社区活跃：
      </strong>
      Spring 社区强大，文档完善，遇到问题容易找到解决方案。
     </li>
    </ul>
    <h3>
     <a id="2___Spring_Security__18">
     </a>
     2. 快速入门：引入 Spring Security 依赖
    </h3>
    <p>
     首先，我们需要在 Spring Boot 项目中引入 Spring Security 的依赖。 在
     <code>
      pom.xml
     </code>
     文件中添加以下依赖：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     引入依赖后，重启应用，你会发现
     <strong>
      所有接口都默认被 Spring Security 保护了
     </strong>
     ！ 访问任何接口都会跳转到登录页面，这就是 Spring Security 默认的安全策略。
    </p>
    <h3>
     <a id="3___31">
     </a>
     3. 用户认证：让应用识别用户身份
    </h3>
    <p>
     用户认证是安全的第一步，我们需要让应用识别用户身份。 Spring Security 提供了多种认证方式，最常用的是
     <strong>
      基于内存的用户认证
     </strong>
     和
     <strong>
      基于数据库的用户认证
     </strong>
     。
    </p>
    <h4>
     <a id="31___35">
     </a>
     3.1 基于内存的用户认证 (简单演示用)
    </h4>
    <p>
     在
     <code>
      application.properties
     </code>
     或
     <code>
      application.yml
     </code>
     中配置用户名和密码即可：
    </p>
    <p>
     <strong>
      application.properties:
     </strong>
    </p>
    <pre><code class="prism language-properties">spring.security.user.name=user
spring.security.user.password=password
</code></pre>
    <p>
     重启应用，再次访问接口，输入配置的用户名
     <code>
      user
     </code>
     和密码
     <code>
      password
     </code>
     即可登录。
     <strong>
      这种方式仅适用于简单演示或测试环境，不建议在生产环境中使用。
     </strong>
    </p>
    <h4>
     <a id="32___48">
     </a>
     3.2 基于数据库的用户认证 (生产环境推荐)
    </h4>
    <p>
     <strong>
      步骤 1：创建用户实体类
      <code>
       User
      </code>
     </strong>
    </p>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"users"</span><span class="token punctuation">)</span> <span class="token comment">// 数据库表名</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> unique <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token comment">// ... 省略 getter 和 setter ...</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      步骤 2：创建 UserRepository 接口
     </strong>
    </p>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">JpaRepository</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">User</span> <span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      步骤 3：创建 UserDetailsService 实现类
      <code>
       UserDetailsServiceImpl
      </code>
     </strong>
    </p>
    <p>
     <code>
      UserDetailsService
     </code>
     是 Spring Security 用于加载用户信息的接口，我们需要实现它，从数据库中读取用户信息。
    </p>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetails</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetailsService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UsernameNotFoundException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token class-name">UserBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>authority<span class="token punctuation">.</span></span><span class="token class-name">AuthorityUtils</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">UserRepository</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDetailsServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">(</span><span class="token string">"User not found: "</span> <span class="token operator">+</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">UserBuilder</span> builder <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span>User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// **生产环境密码需要加密存储！**</span>
        builder<span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token class-name">AuthorityUtils</span><span class="token punctuation">.</span><span class="token function">commaSeparatedStringToAuthorityList</span><span class="token punctuation">(</span><span class="token string">"ROLE_USER"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 默认角色</span>

        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      步骤 4：配置 Spring Security (WebSecurityConfigurerAdapter)
     </strong>
    </p>
    <p>
     创建一个配置类，继承
     <code>
      WebSecurityConfigurerAdapter
     </code>
     ，并配置
     <code>
      UserDetailsService
     </code>
     和密码编码器。
    </p>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">AuthenticationManagerBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">HttpSecurity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span></span><span class="token class-name">EnableWebSecurity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span></span><span class="token class-name">WebSecurityConfigurerAdapter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetailsService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>bcrypt<span class="token punctuation">.</span></span><span class="token class-name">BCryptPasswordEncoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>password<span class="token punctuation">.</span></span><span class="token class-name">PasswordEncoder</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDetailsService</span> userDetailsService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationManagerBuilder</span> auth<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        auth<span class="token punctuation">.</span><span class="token function">userDetailsService</span><span class="token punctuation">(</span>userDetailsService<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用 BCryptPasswordEncoder</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 密码加密器，**生产环境必须使用！**</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        http
            <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"/home"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 首页和 home 接口permitAll</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 其他所有请求都需要认证</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 启用默认登录页面</span>
                <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 启用默认登出功能</span>
                <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      重要提示：
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       生产环境密码必须加密存储！
      </strong>
      示例代码中使用了
      <code>
       BCryptPasswordEncoder
      </code>
      进行密码加密，这是生产环境的
      <strong>
       基本要求
      </strong>
      。 注册用户时，需要使用密码编码器对密码进行加密后再存储到数据库。
     </li>
     <li>
      <strong>
       数据库配置：
      </strong>
      你需要配置好数据库连接，并创建
      <code>
       users
      </code>
      表，并预先插入一些用户数据用于测试。
     </li>
    </ul>
    <p>
     重启应用，再次访问接口，Spring Security 将会从数据库中加载用户信息进行认证。
    </p>
    <h3>
     <a id="4___178">
     </a>
     4. 权限控制：细粒度控制用户访问权限
    </h3>
    <p>
     权限控制是在认证的基础上，进一步控制用户可以访问哪些资源。 Spring Security 提供了强大的权限控制机制。
    </p>
    <h4>
     <a id="41__182">
     </a>
     4.1 基于角色的权限控制
    </h4>
    <p>
     在
     <code>
      UserDetailsServiceImpl
     </code>
     中，我们已经为用户设置了默认角色
     <code>
      ROLE_USER
     </code>
     。 我们可以在
     <code>
      WebSecurityConfig
     </code>
     中基于角色进行权限控制：
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    http
        <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"/home"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/admin/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">"ADMIN"</span><span class="token punctuation">)</span> <span class="token comment">// /admin/** 路径需要 ADMIN 角色</span>
            <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <code>
      antMatchers("/admin/**").hasRole("ADMIN")
     </code>
     表示
     <code>
      /admin/**
     </code>
     开头的路径需要
     <code>
      ADMIN
     </code>
     角色才能访问。 你需要为用户设置角色信息，例如在
     <code>
      UserDetailsServiceImpl
     </code>
     中，可以根据数据库中的角色信息动态设置用户角色。
    </p>
    <h4>
     <a id="42___205">
     </a>
     4.2 基于表达式的权限控制 (更灵活)
    </h4>
    <p>
     Spring Security 还支持基于表达式的权限控制，更加灵活强大。 例如，可以使用
     <code>
      @PreAuthorize
     </code>
     注解在方法级别进行权限控制：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>access<span class="token punctuation">.</span>prepost<span class="token punctuation">.</span></span><span class="token class-name">PreAuthorize</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdminController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/admin/dashboard"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">"hasRole('ADMIN')"</span><span class="token punctuation">)</span> <span class="token comment">// 只有 ADMIN 角色才能访问</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">adminDashboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"Admin Dashboard"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/user/profile"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">"hasAnyRole('ADMIN', 'USER')"</span><span class="token punctuation">)</span> <span class="token comment">// ADMIN 或 USER 角色都可以访问</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"User Profile"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      需要在
      <code>
       WebSecurityConfig
      </code>
      中启用
      <code>
       @EnableGlobalMethodSecurity
      </code>
      注解，开启方法级别的安全控制：
     </strong>
    </p>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>method<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span></span><span class="token class-name">EnableGlobalMethodSecurity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span></span><span class="token class-name">EnableWebSecurity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span></span><span class="token class-name">WebSecurityConfigurerAdapter</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token annotation punctuation">@EnableGlobalMethodSecurity</span><span class="token punctuation">(</span>prePostEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// 启用方法级别的安全控制</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ... 其他配置 ...</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <code>
      @PreAuthorize
     </code>
     注解可以使用 SpEL 表达式进行更复杂的权限判断，例如：
    </p>
    <ul>
     <li>
      <code>
       hasRole('ADMIN')
      </code>
      : 判断用户是否具有
      <code>
       ADMIN
      </code>
      角色
     </li>
     <li>
      <code>
       hasAnyRole('ADMIN', 'USER')
      </code>
      : 判断用户是否具有
      <code>
       ADMIN
      </code>
      或
      <code>
       USER
      </code>
      角色
     </li>
     <li>
      <code>
       hasAuthority('READ_PRIVILEGE')
      </code>
      : 判断用户是否具有
      <code>
       READ_PRIVILEGE
      </code>
      权限
     </li>
     <li>
      <code>
       principal.username == #username
      </code>
      : 判断当前用户名是否与方法参数
      <code>
       username
      </code>
      相等
     </li>
    </ul>
    <h3>
     <a id="5__CSRF_HTTPS_254">
     </a>
     5. 更多安全特性：CSRF 防护、HTTPS、攻击防护
    </h3>
    <p>
     Spring Security 还提供了很多其他安全特性，例如：
    </p>
    <ul>
     <li>
      <strong>
       CSRF 防护 (默认启用):
      </strong>
      防止跨站请求伪造攻击。
     </li>
     <li>
      <strong>
       HTTPS 支持：
      </strong>
      配置 HTTPS，保障数据传输安全。
     </li>
     <li>
      <strong>
       攻击防护：
      </strong>
      防止常见的 Web 攻击，例如 XSS, SQL 注入等。
     </li>
     <li>
      <strong>
       Session 管理：
      </strong>
      管理用户会话，防止 Session 劫持等。
     </li>
    </ul>
    <p>
     这些特性可以进一步提升应用的安全性，具体配置可以参考 Spring Security 官方文档。
    </p>
    <h3>
     <a id="6__Spring_Boot_Security_265">
     </a>
     6. 总结：Spring Boot Security，安全开发的强大后盾
    </h3>
    <p>
     本文从零开始，介绍了如何在 Spring Boot 应用中集成 Spring Security，实现了用户认证和权限控制等核心安全功能。 Spring Boot Security 功能强大，配置灵活，是构建安全可靠应用的强大后盾。
    </p>
    <p>
     <strong>
      下一步学习建议：
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       深入学习 Spring Security 官方文档：
      </strong>
      官方文档是学习 Spring Security 最权威的资料。
     </li>
     <li>
      <strong>
       了解更多认证方式：
      </strong>
      例如 OAuth2, JWT, LDAP 等。
     </li>
     <li>
      <strong>
       学习更多权限控制策略：
      </strong>
      例如 ACL, RBAC 等。
     </li>
     <li>
      <strong>
       实践更多安全特性：
      </strong>
      例如 CSRF 防护, HTTPS, 攻击防护等。
     </li>
    </ul>
    <hr/>
    <p>
     <strong>
      希望这篇文章对您有所帮助！ 如果您在实践中遇到任何问题，欢迎在评论区交流。
     </strong>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f35323536383439312f:61727469636c652f64657461696c732f313436323335323330" class_="artid" style="display:none">
 </p>
</div>


