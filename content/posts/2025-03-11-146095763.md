---
layout: post
title: "C-委托使用详解"
date: 2025-03-11 19:00:00 +0800
description: "C# 委托使用详解"
keywords: "C# 委托使用详解"
categories: ['C']
tags: ['知识捡漏', '开发语言', 'C', 'C']
artid: "146095763"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146095763
    alt: "C-委托使用详解"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146095763
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146095763
cover: https://bing.ee123.net/img/rand?artid=146095763
image: https://bing.ee123.net/img/rand?artid=146095763
img: https://bing.ee123.net/img/rand?artid=146095763
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     C# 委托使用详解
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="httpsblogcsdnnetqq_39847278articledetails127617179_1">
     </a>
     <a href="https://blog.csdn.net/qq_39847278/article/details/127617179">
      总目录
     </a>
    </h2>
    <hr/>
    <h2>
     <a id="_6">
     </a>
     前言
    </h2>
    <p>
     在C#中，
     <strong>
      委托（Delegate）
     </strong>
     是一种类型安全的函数指针机制，它允许我们将方法作为参数传递给其他方法，或者将方法存储在变量中。委托在 C# 中有广泛的应用，特别是在事件处理、异步编程和回调机制中。本文将详细介绍 C# 中委托的定义、使用方法、高级特性以及最佳实践。
    </p>
    <hr/>
    <h2>
     <a id="_12">
     </a>
     一、什么是委托
    </h2>
    <h3>
     <a id="1__13">
     </a>
     1. 定义
    </h3>
    <ul>
     <li>
      委托是一种引用类型，表示对具有特定参数列表和返回类型的方法的引用。
     </li>
     <li>
      <strong>
       委托是一种特殊的类，它封装了一个或多个具有相同签名（返回类型和参数列表）的方法。它允许我们将方法作为参数传递给其他方法，或者将方法存储在变量中。
      </strong>
      委托可以看作是方法的“蓝图”，它定义了方法的签名（返回类型和参数列表），但不包含方法体。
     </li>
     <li>
      委托是一种类型安全的函数指针，用于封装对方法的引用。它允许将方法作为参数传递、存储在变量中，或通过多播机制调用多个方法。
     </li>
    </ul>
    <h3>
     <a id="2__18">
     </a>
     2. 特点
    </h3>
    <ul>
     <li>
      <strong>
       类型安全
      </strong>
      ：委托的签名（参数列表和返回类型）必须与目标方法签名完全匹配。
     </li>
     <li>
      <strong>
       面向对象
      </strong>
      ：委托本质上是继承自
      <code>
       System.MulticastDelegate
      </code>
      的类，支持多态和反射操作。
     </li>
     <li>
      <strong>
       动态调用
      </strong>
      ：运行时根据条件动态选择要调用的方法。
     </li>
     <li>
      <strong>
       多播能力
      </strong>
      ：支持多个方法的链式调用
     </li>
     <li>
      <strong>
       异步支持
      </strong>
      ：通过
      <code>
       BeginInvoke
      </code>
      /
      <code>
       EndInvoke
      </code>
      实现异步调用
     </li>
    </ul>
    <h3>
     <a id="3__26">
     </a>
     3. 委托定义语法
    </h3>
    <p>
     委托是一种引用类型，它指向具有特定参数列表和返回类型的方法。委托的定义语法如下：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name">ReturnType</span> <span class="token function">DelegateName</span><span class="token punctuation">(</span>Parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      <strong>
       <code>
        ReturnType
       </code>
      </strong>
      ：委托方法的返回类型。
     </li>
     <li>
      <strong>
       <code>
        Parameters
       </code>
      </strong>
      ：委托方法的参数列表。
     </li>
     <li>
      <strong>
       <code>
        DelegateName
       </code>
      </strong>
      ：委托的名称。
     </li>
    </ul>
    <h2>
     <a id="_38">
     </a>
     二、如何使用委托
    </h2>
    <h3>
     <a id="1__39">
     </a>
     1. 使用步骤
    </h3>
    <h4>
     <a id="1_40">
     </a>
     1）定义委托
    </h4>
    <ul>
     <li>
      定义委托的方式类似于定义方法
      <ul>
       <li>
        相较于定义方法，定义委托需要使用
        <code>
         delegate
        </code>
        关键字，且没有方法体。
       </li>
      </ul>
     </li>
     <li>
      委托本质上也是类，因此可定义的位置与类相同。
      <ul>
       <li>
        类可以定义在哪里，委托就可定义在哪里。
       </li>
      </ul>
     </li>
    </ul>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">MathOperationDelegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="2_50">
     </a>
     2）实例化委托
    </h4>
    <p>
     可以通过以下几种方式实例化委托：
    </p>
    <ul>
     <li>
      <strong>
       new 实例化
      </strong>
      ：通过
      <code>
       new
      </code>
      创建委托实例
     </li>
     <li>
      <strong>
       直接赋值
      </strong>
      ：直接赋值给某个方法
     </li>
     <li>
      <strong>
       匿名方法
      </strong>
      ：使用匿名方法
     </li>
     <li>
      <strong>
       Lambda 表达式
      </strong>
      ：使用 Lambda 表达式
     </li>
    </ul>
    <h5>
     <a id="1new__58">
     </a>
     方式1：new 实例化
    </h5>
    <pre><code class="prism language-csharp"><span class="token comment">// 实例化委托：new 实例化</span>
<span class="token class-name">MathOperationDelegate</span> mathOperation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MathOperationDelegate</span><span class="token punctuation">(</span>Add<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     通过new 创建委托实例，
     <strong>
      必须
     </strong>
     传入一个方法作为参数，否则会报错
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e4d1f25ead1348eaa8b0dd0bd90682b5.png"/>
    </p>
    <pre><code class="prism language-csharp"><span class="token comment">// 1. 定义委托</span>
<span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">MathOperationDelegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">// 3.实例化委托</span>
        <span class="token class-name">MathOperationDelegate</span> mathOperation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MathOperationDelegate</span><span class="token punctuation">(</span>Add<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token comment">// 2.定义委托对应的方法</span>
	<span class="token comment">// 注意：该方法的签名必须与定义的委托签名保持一致</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> num1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> num2<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="2_89">
     </a>
     方式2：直接赋值
    </h5>
    <p>
     C#2.0 提供一个更简单的给委托创建实例的方式，那就是直接赋值。
    </p>
    <pre><code class="prism language-csharp"> <span class="token comment">// 实例化委托:直接赋值，将Add 方法赋值给定义的委托</span>
<span class="token class-name">MathOperationDelegate</span> mathOperation <span class="token operator">=</span> Add<span class="token punctuation">;</span>
</code></pre>
    <pre><code class="prism language-csharp"><span class="token comment">// 1. 定义委托</span>
<span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">MathOperationDelegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 3.实例化委托:直接赋值，将Add 方法赋值给定义的委托</span>
        <span class="token class-name">MathOperationDelegate</span> mathOperation <span class="token operator">=</span> Add<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 2.定义委托对应的方法</span>
    <span class="token comment">// 注意：该方法的签名必须与定义的委托签名保持一致</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> num1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> num2<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="3_117">
     </a>
     方式3：匿名方法
    </h5>
    <p>
     从C# 2.0开始，可以使用匿名方法来创建委托实例。匿名方法是在创建委托实例时定义的方法体，不需要单独命名。
    </p>
    <pre><code class="prism language-csharp"><span class="token comment">// 实例化委托: 使用匿名方法，可在不定义命名方法的情况下直接编写方法体</span>
<span class="token class-name">MathOperationDelegate</span> mathOperation <span class="token operator">=</span> <span class="token keyword">delegate</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> num1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> num2<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
      <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2<span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <pre><code class="prism language-csharp"><span class="token comment">// 1. 定义委托</span>
<span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">MathOperationDelegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 2.实例化委托: 使用匿名方法，可在不定义命名方法的情况下直接编写方法体</span>
        <span class="token class-name">MathOperationDelegate</span> mathOperation <span class="token operator">=</span> <span class="token keyword">delegate</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> num1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> num2<span class="token punctuation">)</span> 
        <span class="token punctuation">{<!-- --></span> 
            <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2<span class="token punctuation">;</span> 
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="4Lambda__145">
     </a>
     方式4：Lambda 表达式
    </h5>
    <p>
     从C# 3.0开始，可以使用Lambda表达式来创建委托实例。Lambda表达式是一种更简洁的匿名方法语法。
    </p>
    <pre><code class="prism language-csharp"> <span class="token comment">// 实例化委托: 使用 Lambda 表达式</span>
 <span class="token class-name">MathOperationDelegate</span> mathOperation <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
</code></pre>
    <pre><code class="prism language-csharp"><span class="token comment">// 1. 定义委托</span>
<span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">MathOperationDelegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 2.实例化委托: 使用 Lambda 表达式</span>
        <span class="token class-name">MathOperationDelegate</span> mathOperation <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="3_166">
     </a>
     3）使用委托
    </h4>
    <p>
     通过调用委托，就可以间接的调用委托上对应的方法。
    </p>
    <h5>
     <a id="1_168">
     </a>
     方式1：调用委托变量
    </h5>
    <p>
     传入对应的参数，像调用方法一样调用委托。
    </p>
    <pre><code class="prism language-csharp"><span class="token function">mathOperation</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">MathOperationDelegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">MathOperationDelegate</span> mathOperation <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">mathOperation</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//输出：9</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="2Invoke__187">
     </a>
     方式2：Invoke 调用
    </h5>
    <p>
     使用
     <code>
      Invoke
     </code>
     方法，调用委托。使用
     <code>
      Invoke
     </code>
     调用委托，如果定义的委托没有参数，则invoke也没有参数，如果定义的委托没有返回值，则invoke也没有返回值。
    </p>
    <pre><code class="prism language-csharp">mathOperation<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">MathOperationDelegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">MathOperationDelegate</span> mathOperation <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>mathOperation<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//输出：9</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="2__209">
     </a>
     2. 示例
    </h3>
    <h4>
     <a id="1_211">
     </a>
     1）完整示例代码
    </h4>
    <pre><code class="prism language-csharp"><span class="token comment">// 1. 定义委托</span>
<span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">MathOperationDelegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 2.定义委托对应的方法</span>
    <span class="token comment">// 注意：该方法的签名必须与定义的委托签名保持一致</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> num1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> num2<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 3.实例化委托</span>

        <span class="token comment">// 实例化方式 1</span>
        <span class="token class-name">MathOperationDelegate</span> mathOperation1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MathOperationDelegate</span><span class="token punctuation">(</span>Add<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 实例化方式 2</span>
        <span class="token class-name">MathOperationDelegate</span> mathOperation2 <span class="token operator">=</span> Add<span class="token punctuation">;</span>

        <span class="token comment">// 实例化方式 3</span>
        <span class="token class-name">MathOperationDelegate</span> mathOperation3 <span class="token operator">=</span> <span class="token keyword">delegate</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> y<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 实例化方式 4</span>
        <span class="token class-name">MathOperationDelegate</span> mathOperation4 <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>

        <span class="token comment">//4. 调用委托</span>

        <span class="token comment">// 调用方式 1</span>
        <span class="token class-name"><span class="token keyword">var</span></span> reselt1 <span class="token operator">=</span> <span class="token function">mathOperation1</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>reselt1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//输出：9</span>

        <span class="token comment">// 调用方式 2</span>
        <span class="token class-name"><span class="token keyword">var</span></span> reselt2 <span class="token operator">=</span> mathOperation4<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>reselt2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//输出：9</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="2_258">
     </a>
     2）委托基本使用示例
    </h4>
    <pre><code class="prism language-csharp"><span class="token comment">// 1. 定义委托</span>
<span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">MathOperationDelegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 2. 实例化委托</span>
        <span class="token class-name">MathOperationDelegate</span> mathOperation <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>

        <span class="token comment">// 3. 调用委托</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>mathOperation<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//输出：9</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="3__277">
     </a>
     3. 为什么使用委托
    </h3>
    <ul>
     <li>
      <strong>
       解耦代码
      </strong>
      ：分离方法定义与调用逻辑，例如事件处理、异步回调。
     </li>
     <li>
      <strong>
       实现回调机制
      </strong>
      ：委托提供了灵活的回调机制，可以在方法执行完成时触发特定的操作。
     </li>
     <li>
      <strong>
       提高代码复用性
      </strong>
      ：通过委托，可以将通用的处理逻辑提取出来，减少重复代码。
     </li>
     <li>
      <strong>
       灵活性和扩展性
      </strong>
      ：委托允许你在运行时动态地指定要调用的方法，使得代码更加灵活和易于扩展。
     </li>
     <li>
      <strong>
       异步编程支持
      </strong>
      ：委托支持异步编程模型，使得你可以轻松地编写异步操作。
     </li>
     <li>
      <strong>
       支持事件驱动
      </strong>
      ：通过事件封装委托，实现发布-订阅模式
     </li>
    </ul>
    <h2>
     <a id="_291">
     </a>
     三、委托的特性
    </h2>
    <h3>
     <a id="1__293">
     </a>
     1. 多播委托
    </h3>
    <h4>
     <a id="1_294">
     </a>
     1）基本信息
    </h4>
    <p>
     委托可以关联多个方法，形成多播委托。多播委托通过
     <code>
      +=
     </code>
     或
     <code>
      -=
     </code>
     操作符来添加或移除关联方法，形成一个委托链。当调用这个委托链时，所有关联的方法按添加的顺序依次执行。
    </p>
    <h4>
     <a id="2_298">
     </a>
     2）多播委托特点
    </h4>
    <ul>
     <li>
      <strong>
       委托链
      </strong>
      ：多播委托可以看作是一个委托链，其中每个节点代表一个方法。
     </li>
     <li>
      <strong>
       操作符支持
      </strong>
      ：通过
      <code>
       +=
      </code>
      操作符添加方法，通过
      <code>
       -=
      </code>
      操作符移除方法。
     </li>
     <li>
      <strong>
       调用顺序
      </strong>
      ：当调用一个多播委托时，会按照它们被添加的顺序依次调用每个方法。
     </li>
     <li>
      <strong>
       返回值
      </strong>
      ：如果委托有返回值，只有最后一个方法的返回值会被保留，其他返回值会被丢弃。
     </li>
     <li>
      <strong>
       异常处理
      </strong>
      ：如果其中一个方法抛出异常，则后续的方法将不会被调用，除非使用特殊的方式处理异常（如捕获异常并继续执行）。
     </li>
    </ul>
    <h4>
     <a id="3_306">
     </a>
     3）使用示例
    </h4>
    <p>
     为了更好地理解多播委托的工作原理，我们来看一个具体的示例。
    </p>
    <p>
     首先，定义一个简单的委托类型，并编写几个方法：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>

<span class="token comment">// 定义一个委托类型</span>
<span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MathOperation</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Calculator</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Add: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">a</span><span class="token punctuation">}</span></span><span class="token string"> + </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">b</span><span class="token punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">a <span class="token operator">+</span> b</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Subtract</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Subtract: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">a</span><span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">b</span><span class="token punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">a <span class="token operator">-</span> b</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Multiply</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Multiply: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">a</span><span class="token punctuation">}</span></span><span class="token string"> * </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">b</span><span class="token punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">a <span class="token operator">*</span> b</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     接下来，我们将这些方法绑定到一个多播委托实例中，并依次调用它们：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Calculator</span> calculator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Calculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建委托实例并绑定方法</span>
        <span class="token class-name">MathOperation</span> operation <span class="token operator">=</span> calculator<span class="token punctuation">.</span>Add<span class="token punctuation">;</span>
        operation <span class="token operator">+=</span> calculator<span class="token punctuation">.</span>Subtract<span class="token punctuation">;</span>
        operation <span class="token operator">+=</span> calculator<span class="token punctuation">.</span>Multiply<span class="token punctuation">;</span>	<span class="token comment">//添加方法</span>
		operation <span class="token operator">-=</span> calculator<span class="token punctuation">.</span>Multiply<span class="token punctuation">;</span>	<span class="token comment">//移除方法</span>
        <span class="token comment">// 调用多播委托</span>
        <span class="token function">operation</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     当你运行上述代码时，输出将是：
    </p>
    <pre><code>Add: 5 + 3 = 8
Subtract: 5 - 3 = 2
</code></pre>
    <p>
     可以看到，方法
     <code>
      Add
     </code>
     、
     <code>
      Subtract
     </code>
     都被依次调用了，由于
     <code>
      Multiply
     </code>
     方法使用
     <code>
      -=
     </code>
     移除，所以没被调用 。
    </p>
    <h4>
     <a id="4_367">
     </a>
     4）获取委托链中的方法
    </h4>
    <p>
     有时你可能需要获取多播委托链中的所有方法，以便进行进一步的处理或调试。可以通过
     <code>
      GetInvocationList()
     </code>
     方法来实现这一点。
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Calculator</span> calculator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Calculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建委托实例并绑定方法</span>
        <span class="token class-name">MathOperation</span> operation <span class="token operator">=</span> calculator<span class="token punctuation">.</span>Add<span class="token punctuation">;</span>
        operation <span class="token operator">+=</span> calculator<span class="token punctuation">.</span>Subtract<span class="token punctuation">;</span>
        operation <span class="token operator">+=</span> calculator<span class="token punctuation">.</span>Multiply<span class="token punctuation">;</span>

        <span class="token comment">// 获取委托链中的所有方法</span>
        <span class="token class-name">Delegate<span class="token punctuation">[</span><span class="token punctuation">]</span></span> delegates <span class="token operator">=</span> operation<span class="token punctuation">.</span><span class="token function">GetInvocationList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">MathOperation</span> method <span class="token keyword">in</span> delegates<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Calling method: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">method<span class="token punctuation">.</span>Method<span class="token punctuation">.</span>Name</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">method</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     输出结果
    </p>
    <pre><code>Calling method: Add
Add: 5 + 3 = 8
Calling method: Subtract
Subtract: 5 - 3 = 2
Calling method: Multiply
Multiply: 5 * 3 = 15
</code></pre>
    <h4>
     <a id="5_404">
     </a>
     5）返回值处理
    </h4>
    <p>
     多播委托的返回值是最后一个被调用的方法的返回值。如果你希望获取所有方法的返回值，可以通过遍历委托链中的方法逐一调用并收集结果。
    </p>
    <p>
     假设我们有一个带返回值的委托类型：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">MathOperationWithReturn</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Calculator</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Subtract</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Multiply</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Calculator</span> calculator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Calculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建委托实例并绑定方法</span>
        <span class="token class-name">MathOperationWithReturn</span> operation <span class="token operator">=</span> calculator<span class="token punctuation">.</span>Add<span class="token punctuation">;</span>
        operation <span class="token operator">+=</span> calculator<span class="token punctuation">.</span>Subtract<span class="token punctuation">;</span>
        operation <span class="token operator">+=</span> calculator<span class="token punctuation">.</span>Multiply<span class="token punctuation">;</span>

        <span class="token comment">// 调用多播委托并获取最后一个方法的返回值</span>
        <span class="token class-name"><span class="token keyword">int</span></span> result <span class="token operator">=</span> <span class="token function">operation</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Last method's result: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">result</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 获取所有方法的返回值</span>
        <span class="token class-name">Delegate<span class="token punctuation">[</span><span class="token punctuation">]</span></span> delegates <span class="token operator">=</span> operation<span class="token punctuation">.</span><span class="token function">GetInvocationList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">MathOperationWithReturn</span> method <span class="token keyword">in</span> delegates<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">int</span></span> tempResult <span class="token operator">=</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">method<span class="token punctuation">.</span>Method<span class="token punctuation">.</span>Name</span><span class="token punctuation">}</span></span><span class="token string"> returned: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">tempResult</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     输出结果
    </p>
    <pre><code>Last method's result: 15
Add returned: 8
Subtract returned: 2
Multiply returned: 15
</code></pre>
    <h4>
     <a id="6_464">
     </a>
     6）异常处理
    </h4>
    <p>
     如果多播委托链中的某个方法抛出异常，默认情况下后续的方法将不会被调用。为了避免这种情况，可以在调用每个方法时捕获异常并继续执行。
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Calculator</span> calculator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Calculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建委托实例并绑定方法</span>
        <span class="token class-name">MathOperation</span> operation <span class="token operator">=</span> calculator<span class="token punctuation">.</span>Add<span class="token punctuation">;</span>
        operation <span class="token operator">+=</span> ThrowException<span class="token punctuation">;</span> <span class="token comment">// 这个方法会抛出异常</span>
        operation <span class="token operator">+=</span> calculator<span class="token punctuation">.</span>Multiply<span class="token punctuation">;</span>

        <span class="token comment">// 调用多播委托并处理异常</span>
        <span class="token function">InvokeAll</span><span class="token punctuation">(</span>operation<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ThrowException</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token string">"An exception occurred!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">InvokeAll</span><span class="token punctuation">(</span><span class="token class-name">MathOperation</span> operation<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Delegate<span class="token punctuation">[</span><span class="token punctuation">]</span></span> delegates <span class="token operator">=</span> operation<span class="token punctuation">.</span><span class="token function">GetInvocationList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">MathOperation</span> method <span class="token keyword">in</span> delegates<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Calling method: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">method<span class="token punctuation">.</span>Method<span class="token punctuation">.</span>Name</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">method</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Caught exception in </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">method<span class="token punctuation">.</span>Method<span class="token punctuation">.</span>Name</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">ex<span class="token punctuation">.</span>Message</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     输出结果
    </p>
    <pre><code>Calling method: Add
Add: 5 + 3 = 8
Calling method: ThrowException
Caught exception in ThrowException: An exception occurred!
Calling method: Multiply
Multiply: 5 * 3 = 15
</code></pre>
    <h3>
     <a id="2__519">
     </a>
     2. 泛型委托
    </h3>
    <h4>
     <a id="1_520">
     </a>
     1）自定义泛型委托
    </h4>
    <pre><code class="prism language-csharp"><span class="token comment">// 1. 定义委托</span>
<span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">MathOperationDelegate</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T</span> a<span class="token punctuation">,</span> <span class="token class-name">T</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 2. 实例化委托</span>
        <span class="token class-name">MathOperationDelegate<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> mathOperation1 <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
        <span class="token class-name">MathOperationDelegate<span class="token punctuation">&lt;</span><span class="token keyword">double</span><span class="token punctuation">&gt;</span></span> mathOperation2 <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">-</span> y<span class="token punctuation">;</span>

        <span class="token comment">// 3. 调用委托</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>mathOperation1<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//输出：9</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>mathOperation2<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token number">45.5</span><span class="token punctuation">,</span> <span class="token number">25.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//输出：20.4</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     建议：
     <code>
      C#
     </code>
     提供了一些内置的泛型委托类型，如
     <code>
      Func&lt;T&gt;
     </code>
     、
     <code>
      Action&lt;T&gt;
     </code>
     和
     <code>
      Predicate&lt;T&gt;
     </code>
     ，这些内置委托已经涵盖了大多数常见的场景。除非有特殊需求，否则建议直接使用这些内置委托，而不是重新定义新的委托类型。
    </p>
    <h4>
     <a id="2_541">
     </a>
     2）内置通用委托
    </h4>
    <p>
     C# 提供了一些内置的泛型委托类型，如
     <code>
      Func&lt;T&gt;
     </code>
     和
     <code>
      Action&lt;T&gt;
     </code>
     、
     <code>
      Predicate&lt;T&gt;
     </code>
     ，简化了委托的定义和使用。
    </p>
    <h5>
     <a id="_543">
     </a>
     对比表格
    </h5>
    <table>
     <thead>
      <tr>
       <th align="left">
        特性
       </th>
       <th align="left">
        <code>
         Action&lt;T&gt;
        </code>
        系列
       </th>
       <th align="left">
        <code>
         Func&lt;T&gt;
        </code>
        系列
       </th>
       <th align="left">
        <code>
         Predicate&lt;T&gt;
        </code>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        <strong>
         定义
        </strong>
       </td>
       <td align="left">
        表示一个
        <strong>
         没有返回值
        </strong>
        的委托
       </td>
       <td align="left">
        表示一个
        <strong>
         有返回值
        </strong>
        的委托
       </td>
       <td align="left">
        表示一个
        <strong>
         返回
         <code>
          bool
         </code>
        </strong>
        的委托
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         泛型参数数量
        </strong>
       </td>
       <td align="left">
        0到16个输入参数，
        <br/>
        无返回值
       </td>
       <td align="left">
        0到16个输入参数，
        <br/>
        最后一个表示返回值且只有一个
       </td>
       <td align="left">
        固定1个输入参数，
        <br/>
        返回布尔值
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         返回值类型
        </strong>
       </td>
       <td align="left">
        <code>
         void
        </code>
       </td>
       <td align="left">
        可以是任意类型
       </td>
       <td align="left">
        <code>
         bool
        </code>
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         使用场景
        </strong>
       </td>
       <td align="left">
        执行某些操作但不需要返回结果
       </td>
       <td align="left">
        执行某些计算或处理并返回结果
       </td>
       <td align="left">
        判断某个条件是否满足
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         常见用法
        </strong>
       </td>
       <td align="left">
        处理事件、执行副作用操作
       </td>
       <td align="left">
        计算、查询、转换等需要返回结果的操作
       </td>
       <td align="left">
        过滤集合元素、验证条件
       </td>
      </tr>
     </tbody>
    </table>
    <h5>
     <a id="ActionT__554">
     </a>
     <code>
      Action&lt;T&gt;
     </code>
     系列
    </h5>
    <ul>
     <li>
      <strong>
       定义
      </strong>
      ：
      <code>
       Action&lt;T&gt;
      </code>
      是一个不带返回值的委托类型，可以接受0到16个输入参数。
     </li>
     <li>
      <strong>
       泛型参数
      </strong>
      ：
      <code>
       Action
      </code>
      本身表示无参数的委托，
      <code>
       Action&lt;T&gt;
      </code>
      表示接受一个参数的委托，依此类推，最多可以接受16个参数。
     </li>
     <li>
      <strong>
       返回值
      </strong>
      ：
      <code>
       void
      </code>
      ，即没有返回值。
     </li>
     <li>
      <strong>
       典型应用
      </strong>
      ：
      <ul>
       <li>
        执行某些操作，如日志记录、文件写入等。
       </li>
       <li>
        处理事件回调函数。
       </li>
      </ul>
     </li>
    </ul>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//实例化方式 1</span>
        <span class="token class-name">Action</span> action <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action</span><span class="token punctuation">(</span>Show<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//实例化方式 2</span>
        action <span class="token operator">=</span> Show<span class="token punctuation">;</span>
        <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//实例化方式 3</span>
        action <span class="token operator">=</span> <span class="token keyword">delegate</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//实例化方式 4</span>

        <span class="token comment">// Action 无参数</span>
        <span class="token class-name">Action</span> log <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Logging..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Action&lt;T&gt; 单个参数</span>
        <span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> printMessage <span class="token operator">=</span> message <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printMessage</span><span class="token punctuation">(</span><span class="token string">"Hello, World!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Action&lt;T1, T2&gt; 多个参数</span>
        <span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> addAndPrint <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">addAndPrint</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="FuncT__601">
     </a>
     <code>
      Func&lt;T&gt;
     </code>
     系列
    </h5>
    <ul>
     <li>
      <strong>
       定义
      </strong>
      ：
      <code>
       Func&lt;T&gt;
      </code>
      是一个带有返回值的委托类型，可以接受0到16个输入参数，并且必须有一个返回值。
     </li>
     <li>
      <strong>
       泛型参数
      </strong>
      ：
      <code>
       Func&lt;TResult&gt;
      </code>
      表示无参数但有返回值的委托，
      <code>
       Func&lt;T, TResult&gt;
      </code>
      表示接受一个参数并返回结果的委托，依此类推，最多可以接受16个参数。
     </li>
     <li>
      <strong>
       返回值
      </strong>
      ：最后一个泛型参数指定返回值的类型。
     </li>
     <li>
      <strong>
       典型应用
      </strong>
      ：
      <ul>
       <li>
        执行计算、查询、转换等需要返回结果的操作。
       </li>
       <li>
        数据处理和映射。
       </li>
      </ul>
     </li>
    </ul>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Func&lt;TResult&gt; 无参数但有返回值</span>
        <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> getRandomNumber <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">getRandomNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Func&lt;T, TResult&gt; 单个参数</span>
        <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> square <span class="token operator">=</span> x <span class="token operator">=&gt;</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">square</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Func&lt;T1, T2, TResult&gt; 多个参数</span>
        <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword">add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="PredicateT_630">
     </a>
     <code>
      Predicate&lt;T&gt;
     </code>
    </h5>
    <ul>
     <li>
      <strong>
       定义
      </strong>
      ：
      <code>
       Predicate&lt;T&gt;
      </code>
      是一个返回布尔值的委托类型，专门用于判断某个条件是否满足。它只接受一个输入参数。
     </li>
     <li>
      <strong>
       泛型参数
      </strong>
      ：固定为一个参数类型。
     </li>
     <li>
      <strong>
       返回值
      </strong>
      ：
      <code>
       bool
      </code>
      ，用于表示条件是否成立。
     </li>
     <li>
      <strong>
       典型应用
      </strong>
      ：
      <ul>
       <li>
        集合过滤、元素验证等场景。
       </li>
       <li>
        条件判断。
       </li>
      </ul>
     </li>
    </ul>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> numbers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// Predicate&lt;T&gt; 判断数字是否大于3</span>
        <span class="token class-name">Predicate<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> isGreaterThanThree <span class="token operator">=</span> n <span class="token operator">=&gt;</span> n <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">;</span>

        <span class="token comment">// 使用 Find 方法查找第一个符合条件的元素</span>
        <span class="token class-name"><span class="token keyword">int</span></span> result <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>isGreaterThanThree<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: 4</span>

        <span class="token comment">// 使用 Where 方法过滤所有符合条件的元素</span>
        <span class="token class-name"><span class="token keyword">var</span></span> filteredNumbers <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token function">isGreaterThanThree</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> num <span class="token keyword">in</span> filteredNumbers<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: 4, 5</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <pre><code class="prism language-csharp"><span class="token class-name">Predicate<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> isGreaterThanThree <span class="token operator">=</span> n <span class="token operator">=&gt;</span> n <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">;</span>

<span class="token comment">// 使用 Find 方法查找第一个符合条件的元素</span>
<span class="token class-name"><span class="token keyword">int</span></span> result <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>isGreaterThanThree<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//等效于</span>
<span class="token class-name"><span class="token keyword">int</span></span> result <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token class-name"><span class="token keyword">var</span></span> filteredNumbers <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token function">isGreaterThanThree</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//等效于</span>
 <span class="token class-name"><span class="token keyword">var</span></span> filteredNumbers <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <code>
      Predicate&lt;T&gt;
     </code>
     在 此处
     <code>
      Find
     </code>
     和
     <code>
      Where
     </code>
     中的作用就是筛选出符合条件的数据。当数据符合条件，返回
     <code>
      true
     </code>
     ，将符合条件的数据返回或加入到新的序列中，返回新的序列。
    </p>
    <h4>
     <a id="3_678">
     </a>
     3）小结
    </h4>
    <ul>
     <li>
      <code>
       Action&lt;T&gt;
      </code>
      表示一个没有返回值的委托，
      <code>
       Action&lt;T&gt;
      </code>
      相当于是对所有 无返回值委托的进一步包装
     </li>
     <li>
      <code>
       Func&lt;T&gt;
      </code>
      表示一个有返回值的委托，
      <code>
       Func&lt;T&gt;
      </code>
      相当于是对所有 有返回值委托的进一步包装
     </li>
     <li>
      <code>
       Action&lt;T&gt;
      </code>
      和
      <code>
       Func&lt;T&gt;
      </code>
      内置委托基本已经涵盖了所有的委托使用场景，除非有特殊需求，否则建议直接使用这些内置委托，而不是重新定义新的委托类型。
     </li>
     <li>
      <code>
       Func&lt;T&gt;
      </code>
      表示一个返回
      <code>
       bool
      </code>
      的委托，
      <code>
       Func&lt;T&gt;
      </code>
      相当于是对所有 返回
      <code>
       bool
      </code>
      委托的进一步包装
     </li>
    </ul>
    <h3>
     <a id="3__683">
     </a>
     3. 异步委托
    </h3>
    <p>
     委托支持异步调用，可以使用
     <code>
      BeginInvoke
     </code>
     和
     <code>
      EndInvoke
     </code>
     方法进行异步操作。
    </p>
    <ul>
     <li>
      <code>
       BeginInvoke
      </code>
      开启一个线程去执行委托
     </li>
     <li>
      <code>
       BeginInvoke
      </code>
      和
      <code>
       EndInvoke
      </code>
      方法 仅 NetFamework支持 ，NetCore中更推荐
      <code>
       async/await
      </code>
     </li>
    </ul>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Reflection</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">MathOperation</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Calculator</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>MethodBase<span class="token punctuation">.</span><span class="token function">GetCurrentMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Subtract</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>MethodBase<span class="token punctuation">.</span><span class="token function">GetCurrentMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Calculator</span> calculator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Calculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MathOperation</span> operation <span class="token operator">=</span> calculator<span class="token punctuation">.</span>Add<span class="token punctuation">;</span>

        <span class="token comment">// 异步调用委托</span>
        <span class="token class-name">IAsyncResult</span> result <span class="token operator">=</span> operation<span class="token punctuation">.</span><span class="token function">BeginInvoke</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 在主线程继续执行其他操作</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Doing other work..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 等待异步调用完成并获取结果</span>
        <span class="token class-name"><span class="token keyword">int</span></span> sum <span class="token operator">=</span> operation<span class="token punctuation">.</span><span class="token function">EndInvoke</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Sum: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">sum</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: Sum: 8</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     运行结果：
    </p>
    <pre><code class="prism language-csharp">Doing other work<span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token class-name">Add</span>
Sum<span class="token punctuation">:</span> <span class="token number">8</span>
</code></pre>
    <p>
     如果是使用Invoke 方法同步执行：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Calculator</span> calculator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Calculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MathOperation</span> operation <span class="token operator">=</span> calculator<span class="token punctuation">.</span>Add<span class="token punctuation">;</span>

        <span class="token comment">// 同步调用委托</span>
        <span class="token class-name"><span class="token keyword">int</span></span> sum <span class="token operator">=</span> operation<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 继续执行其他操作</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Doing other work..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 输出结果</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Sum: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">sum</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: Sum: 8</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     结果如下
    </p>
    <pre><code class="prism language-csharp">Add
Doing other work<span class="token range operator">..</span><span class="token punctuation">.</span>
Sum<span class="token punctuation">:</span> <span class="token number">8</span>
</code></pre>
    <h2>
     <a id="_762">
     </a>
     四、委托的最佳实践
    </h2>
    <h4>
     <a id="1__763">
     </a>
     1. 优先使用内置委托
    </h4>
    <p>
     优先使用内置委托，减少冗余代码，提升可维护性。 C# 提供了
     <code>
      Action
     </code>
     和
     <code>
      Func
     </code>
     、
     <code>
      Predicate
     </code>
     类型，用于表示常见的委托类型。在大多数情况下，建议使用
     <code>
      Action
     </code>
     和
     <code>
      Func
     </code>
     类型，而不是自定义委托类型。
    </p>
    <h4>
     <a id="2__Lambda__766">
     </a>
     2. 使用 Lambda 表达式
    </h4>
    <p>
     Lambda 表达式提供了简洁的语法，用于表示匿名函数。在大多数情况下，建议使用 Lambda 表达式，而不是匿名委托或命名方法。
    </p>
    <h4>
     <a id="3__770">
     </a>
     3. 避免过度使用委托
    </h4>
    <p>
     虽然委托非常灵活，但在某些情况下，过度使用委托可能会导致代码难以阅读和维护。在设计代码时，应权衡委托的灵活性和代码的可读性。
    </p>
    <h4>
     <a id="5__774">
     </a>
     5. 避免复杂的委托链
    </h4>
    <p>
     虽然委托链功能强大，但过于复杂的委托链会使代码难以维护。尽量保持委托链简单明了。
    </p>
    <h4>
     <a id="4__779">
     </a>
     4. 注意线程安全性
    </h4>
    <p>
     在多线程环境中使用委托时，需要注意线程安全性问题。确保在访问共享资源时使用适当的同步机制。
    </p>
    <pre><code class="prism language-csharp"><span class="token comment">// 错误的委托调用方式</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnsafeInvoker</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">Action</span> Callback<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Callback <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// ❌ 非原子操作</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// ❌ 可能已被置空</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正确方式</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SafeDoWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name"><span class="token keyword">var</span></span> localCopy <span class="token operator">=</span> Callback<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>localCopy <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">localCopy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="5__808">
     </a>
     5. 合理选择委托或事件
    </h4>
    <p>
     需要解耦通知机制时用事件，动态调用方法时用委托。
    </p>
    <h4>
     <a id="6__811">
     </a>
     6. 注意闭包变量生命周期
    </h4>
    <p>
     避免意外捕获外部变量导致内存泄漏。
    </p>
    <h2>
     <a id="_815">
     </a>
     五、应用场景
    </h2>
    <h3>
     <a id="1__816">
     </a>
     1. 应用场景概览
    </h3>
    <ul>
     <li>
      <strong>
       事件处理
      </strong>
      ：委托常用于事件处理机制，使得对象可以订阅和触发事件。
     </li>
     <li>
      <strong>
       回调函数
      </strong>
      ：委托可以用来实现回调函数，使得一个方法可以在另一个方法完成后被调用。
     </li>
     <li>
      <strong>
       异步编程
      </strong>
      ：委托支持异步编程模型，使得你可以轻松地编写异步操作。
     </li>
     <li>
      <strong>
       多播委托
      </strong>
      ：委托可以封装多个方法，并按顺序调用这些方法。
     </li>
    </ul>
    <h3>
     <a id="2__822">
     </a>
     2. 应用场景示例
    </h3>
    <h4>
     <a id="1_823">
     </a>
     示例1：事件处理
    </h4>
    <p>
     委托是C#中事件处理的基础，委托常用于事件处理机制。以下是一个简单的事件处理示例：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Button</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 定义一个委托类型</span>
    <span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ClickEventHandler</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 定义一个事件</span>
    <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">ClickEventHandler</span> Click<span class="token punctuation">;</span>

    <span class="token comment">// 触发事件</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Click<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> EventArgs<span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Button</span> button <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 订阅事件</span>
        button<span class="token punctuation">.</span>Click <span class="token operator">+=</span> <span class="token punctuation">(</span>sender<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token punctuation">{<!-- --></span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Button clicked!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 触发事件</span>
        button<span class="token punctuation">.</span><span class="token function">OnClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: Button clicked!</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="2_861">
     </a>
     示例2：回调函数
    </h4>
    <p>
     委托可以用来实现回调函数，使得一个方法可以在另一个方法完成后被调用。
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskManager</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ExecuteTask</span><span class="token punctuation">(</span><span class="token class-name">Action</span> callback<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Executing task..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 模拟任务执行</span>
        System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Task completed."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 调用回调函数</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">TaskManager</span> taskManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TaskManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 定义回调函数</span>
        <span class="token class-name">Action</span> callback <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Callback executed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 执行任务并传递回调函数</span>
        taskManager<span class="token punctuation">.</span><span class="token function">ExecuteTask</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     输出结果：
    </p>
    <pre><code class="prism language-csharp">Executing task<span class="token range operator">..</span><span class="token punctuation">.</span>
Task completed<span class="token punctuation">.</span>
Callback executed<span class="token operator">!</span>
</code></pre>
    <h4>
     <a id="3__901">
     </a>
     示例3： 回调函数
    </h4>
    <p>
     委托可以用作回调函数，当某个操作完成时，调用委托来通知调用者。例如：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MyDelegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataLoader</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LoadData</span><span class="token punctuation">(</span><span class="token class-name">MyDelegate</span> callback<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 模拟数据加载</span>
        System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">"Data loaded successfully!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">DataLoader</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        loader<span class="token punctuation">.</span><span class="token function">LoadData</span><span class="token punctuation">(</span>DisplayMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DisplayMessage</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="4_931">
     </a>
     示例4：异步编程
    </h4>
    <p>
     委托支持异步编程模型，使得你可以轻松地编写异步操作。
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncOperation</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PerformOperation</span><span class="token punctuation">(</span><span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> operation<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Starting asynchronous operation..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> operation<span class="token punctuation">.</span><span class="token function">BeginInvoke</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 在主线程继续执行其他操作</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Doing other work..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 获取异步操作的结果</span>
        <span class="token class-name"><span class="token keyword">int</span></span> sum <span class="token operator">=</span> operation<span class="token punctuation">.</span><span class="token function">EndInvoke</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Result: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">sum</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">AsyncOperation</span> asyncOperation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AsyncOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 定义异步操作</span>
        <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> addFunc <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token punctuation">{<!-- --></span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Add Operation"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 执行异步操作</span>
        asyncOperation<span class="token punctuation">.</span><span class="token function">PerformOperation</span><span class="token punctuation">(</span>addFunc<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     运行结果：
    </p>
    <pre><code class="prism language-csharp">Starting asynchronous operation<span class="token range operator">..</span><span class="token punctuation">.</span>
Doing other work<span class="token range operator">..</span><span class="token punctuation">.</span>
Add <span class="token class-name">Operation</span>
Result<span class="token punctuation">:</span> <span class="token number">8</span>
</code></pre>
    <h4>
     <a id="5_977">
     </a>
     示例5：异步流水线处理
    </h4>
    <p>
     虽然委托支持使用
     <code>
      BeginInvoke
     </code>
     异步调用，但在现代C#中，推荐使用
     <code>
      async
     </code>
     和
     <code>
      await
     </code>
     来实现异步操作。这种方式更加直观和易于维护。
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">PipelineProcessingAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 定义下载数据的操作</span>
        <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> download <span class="token operator">=</span> <span class="token keyword">async</span> url <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟网络延迟</span>
            <span class="token keyword">return</span> <span class="token interpolation-string"><span class="token string">$"Data from </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">url</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 定义处理数据的操作</span>
        <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> process <span class="token operator">=</span> <span class="token keyword">async</span> data <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟处理时间</span>
            <span class="token keyword">return</span> data<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 定义保存结果的操作</span>
        <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Task<span class="token punctuation">&gt;</span></span> save <span class="token operator">=</span> <span class="token keyword">async</span> result <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟保存时间</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Saved: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">result</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 构建处理流水线</span>
        <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">ProcessPipeline</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> url<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">var</span></span> downloadedData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">download</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> processedData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">process</span><span class="token punctuation">(</span>downloadedData<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> <span class="token function">save</span><span class="token punctuation">(</span>processedData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 执行处理流水线</span>
        <span class="token keyword">await</span> <span class="token function">ProcessPipeline</span><span class="token punctuation">(</span><span class="token string">"http://example.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
	<span class="token comment">// NetFamework 下的写法</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>    	
        <span class="token function">PipelineProcessingAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetAwaiter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//输出：Saved: DATA FROM HTTP://EXAMPLE.COM</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     NetCore下的写法
    </p>
    <pre><code class="prism language-csharp">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">await</span> <span class="token function">PipelineProcessingAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//输出：Saved: DATA FROM HTTP://EXAMPLE.COM</span>
    <span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="6_1038">
     </a>
     示例6：动态方法选择器
    </h4>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommandDispatcher</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Action<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> _handlers 
        <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Action<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RegisterHandler</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> command<span class="token punctuation">,</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> handler<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        _handlers<span class="token punctuation">[</span>command<span class="token punctuation">]</span> <span class="token operator">=</span> handler<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Execute</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> command<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> parameter<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_handlers<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">var</span></span> handler<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">handler</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"未知命令: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">command</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="7_1065">
     </a>
     示例7：策略模式实现
    </h4>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentProcessor</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Func<span class="token punctuation">&lt;</span>Order<span class="token punctuation">,</span> PaymentResult<span class="token punctuation">&gt;</span></span> _paymentStrategy<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetPaymentStrategy</span><span class="token punctuation">(</span><span class="token class-name">Func<span class="token punctuation">&lt;</span>Order<span class="token punctuation">,</span> PaymentResult<span class="token punctuation">&gt;</span></span> strategy<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        _paymentStrategy <span class="token operator">=</span> strategy<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">PaymentResult</span> <span class="token function">Process</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> _paymentStrategy<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span> 
            <span class="token operator">??</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token string">"未设置支付策略"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
processor<span class="token punctuation">.</span><span class="token function">SetPaymentStrategy</span><span class="token punctuation">(</span>CreditCardStrategy<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> processor<span class="token punctuation">.</span><span class="token function">Process</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="8_1090">
     </a>
     示例8：动态方法调用
    </h4>
    <p>
     通过反射动态绑定委托，适用于插件化架构：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Reflection</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Utility</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Encrypt 方法接受一个字符串参数并返回加密后的字符串</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Encrypt</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> input<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 简单的加密逻辑（实际应用中应使用更安全的加密算法）</span>
        <span class="token class-name"><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> chars <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">ToCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> chars<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            chars<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">(</span>chars<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将每个字符编码值加1</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span></span><span class="token punctuation">(</span>chars<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取 Utility 类中的 Encrypt 方法</span>
        <span class="token class-name">MethodInfo</span> method <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Utility</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetMethod</span><span class="token punctuation">(</span><span class="token string">"Encrypt"</span><span class="token punctuation">,</span> BindingFlags<span class="token punctuation">.</span>Public <span class="token operator">|</span> BindingFlags<span class="token punctuation">.</span>Static<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"未能找到 Encrypt 方法。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 使用反射创建 Func&lt;string, string&gt; 委托实例</span>
        <span class="token class-name">Delegate</span> delegateInstance <span class="token operator">=</span> Delegate<span class="token punctuation">.</span><span class="token function">CreateDelegate</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>delegateInstance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"未能创建委托实例。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 将 delegateInstance 转换为 Func&lt;string, string&gt;</span>
        <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> encryptFunc <span class="token operator">=</span> <span class="token punctuation">(</span>Func<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>delegateInstance<span class="token punctuation">;</span>

        <span class="token comment">// 调用委托实例</span>
        <span class="token class-name"><span class="token keyword">string</span></span> originalText <span class="token operator">=</span> <span class="token string">"Hello, World!"</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> encryptedText <span class="token operator">=</span> <span class="token function">encryptFunc</span><span class="token punctuation">(</span>originalText<span class="token punctuation">)</span><span class="token punctuation">;</span>

        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"原始文本: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">originalText</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"加密后的文本: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">encryptedText</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="9_1146">
     </a>
     示例9：表达式树
    </h4>
    <pre><code class="prism language-csharp"><span class="token comment">// 传统匿名方法</span>
<span class="token class-name">MathOperation</span> sqrt <span class="token operator">=</span> <span class="token keyword">delegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">Sqrt</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Lambda表达式</span>
<span class="token class-name">MathOperation</span> sqrt <span class="token operator">=</span> x <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">Sqrt</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 表达式树（编译时转换为委托）</span>
<span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> expr <span class="token operator">=</span> x <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">Sqrt</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> compiled <span class="token operator">=</span> expr<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> expr <span class="token operator">=</span> x <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">Sqrt</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> compiled <span class="token operator">=</span> expr<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>compiled<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//输出：4</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="_1171">
     </a>
     结语
    </h2>
    <p>
     回到目录页：
     <a href="https://blog.csdn.net/qq_39847278/article/details/144340513">
      C#/.NET 知识汇总
     </a>
     <br/>
     希望以上内容可以帮助到大家，如文中有不对之处，还请批评指正。
    </p>
    <hr/>
    <p>
     参考资料：
     <br/>
     <a href="https://docs.microsoft.com/zh-cn/dotnet/csharp/programming-guide/events/" rel="nofollow">
      Microsoft Docs: 事件
     </a>
     <br/>
     <a href="https://docs.microsoft.com/zh-cn/dotnet/csharp/programming-guide/concepts/async/" rel="nofollow">
      Microsoft Docs: 异步编程
     </a>
     <br/>
     <a href="https://docs.microsoft.com/zh-cn/dotnet/csharp/programming-guide/delegates/" rel="nofollow">
      Microsoft Docs: 委托文档
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33393834373237382f:61727469636c652f64657461696c732f313436303935373633" class_="artid" style="display:none">
 </p>
</div>


