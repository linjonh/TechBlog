---
layout: post
title: "php区分线上环境和测试环境"
date: 2024-07-17 12:01:46 +0800
description: "一般我们在做开发的时候，程序都会运行在多个环境，起码会3个：开发环境、测试环境、生成环境三种环境的配"
keywords: "线上环境和调试环境有什么区别"
categories: ['计算机必备技能', 'Php']
tags: ['Php', 'Nginx', 'Apache']
artid: "122351850"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=122351850
    alt: "php区分线上环境和测试环境"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=122351850
featuredImagePreview: https://bing.ee123.net/img/rand?artid=122351850
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     php区分线上环境和测试环境
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <a href="https://jums.club/php-dist-prod-and-test/" rel="nofollow">
      原文
     </a>
     <br/>
     一般我们在做开发的时候，程序都会运行在多个环境，起码会3个：开发环境、测试环境、生成环境
     <br/>
     三种环境的配置信息是不一样的
     <br/>
     数据库配置不一样、debug级别不一样、日志记录级别不一样、缓存不一样，等等。
     <br/>
     但是我们用版本管理工具的时候，代码在三种环境下是一样的，所以，如何区分当前运行的是那个环境？
    </p>
    <ul>
     <li>
      方案1. 是使用.env文件，这个文件不会托管到版本库，每个运行环境都是独立配置的
     </li>
     <li>
      方案2. 准备多份配置文件，比如config.php、config-local.php，config.php托管在版本库，配个人都一样，config-local.php不托管在版本库，每个人独立配置，运行的时候config-local.php会覆盖config.php中的配置项，缺点是每次搭建环境都需要配置这个文件，比较繁琐。有些人会直接复制config.php为config-local.php，结果导致更改了config.php，其他开发人员不会生效。
     </li>
     <li>
      方案3. 使用系统环境变量
     </li>
    </ul>
    <h3>
     <a id="1_Apache_9">
     </a>
     1 Apache的环境变量设置
    </h3>
    <p>
     指令：
     <code>
      SetEnv RUNTIME_ENVIROMENT DEV
     </code>
    </p>
    <p>
     配置格式：
    </p>
    <pre><code>ServerAdmin admin@admin.com
DocumentRoot "/var/www/"
ServerName localhost
SetEnv RUNTIME_ENVIROMENT DEV
ErrorLog "logs/error.log"
CustomLog "logs/access.log" common
</code></pre>
    <h3>
     <a id="2_Nginx_24">
     </a>
     2 设置Nginx环境变量
    </h3>
    <p>
     指令：
     <code>
      fastcgi_param RUNTIME_ENVIROMENT 'DEV'
     </code>
    </p>
    <p>
     设置格式：
    </p>
    <p>
     在
     <code>
      fastcgi_params
     </code>
     文件中配置
    </p>
    <pre><code>fastcgi_param RUNTIME_ENVIROMENT 'DEV';
</code></pre>
    <p>
     在nginx.conf中配置
    </p>
    <pre><code>server {
    listen 80;
    root /var/www;
    index index.php;
    server_name localhost;

    location /
    {
    	index index.php;
    }

    location ~ .*\.(php|php5)?$ {
        fastcgi_pass 127.0.0.1:9000;
        fastcgi_index index.php;
        include fastcgi_params;  #需要在fastcgi_params文件中定义环境变量
        #或者
        #fastcgi_param RUNTIME_ENVIROMENT 'DEV';
    }
}
</code></pre>
    <h3>
     <a id="3_Linux_60">
     </a>
     3 Linux系统下的设置方式
    </h3>
    <p>
     在
     <code>
      /etc/environment
     </code>
     文件中添加环境变量
    </p>
    <p>
     命令：
     <code>
      vi /etc/environment
     </code>
    </p>
    <p>
     添加一行
     <code>
      RUNTIME_ENVIROMENT=DEV
     </code>
    </p>
    <p>
     貌似只在命令行环境生效
    </p>
    <h3>
     <a id="4_windowsIIS_70">
     </a>
     4 windows下IIS设置环境变量
    </h3>
    <h4>
     <a id="1_72">
     </a>
     1.我的电脑-》右键(选择我的属性)
    </h4>
    <p>
     [外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-wqFuRMUh-1641470982142)(https://jums.club/images/article2/f3cbe59dbac54b68654fb358d87a2182.png)]
    </p>
    <h4>
     <a id="2_76">
     </a>
     2.点击高级设置
    </h4>
    <p>
     <img alt="8547268d2ad7abcaa202a0378bcf8d2b.png" src="https://i-blog.csdnimg.cn/blog_migrate/c7df3f8545c345b506a86c8d7051a932.png"/>
    </p>
    <h4>
     <a id="3_80">
     </a>
     3.点击环境变量
    </h4>
    <p>
     <img alt="4cfb8718ac171455a00602614adb61cb.png" src="https://i-blog.csdnimg.cn/blog_migrate/a1a678da17669d846f1794ce75691acf.png"/>
    </p>
    <p>
     点击系统环境变量下面的新建按钮添加就可以了
    </p>
    <p>
     可能需要重启电脑才能生效
    </p>
    <p>
     使用方法
    </p>
    <p>
     在PHP中有两个调用方式：
    </p>
    <pre><code class="prism language-PHP">$env = getenv('RUNTIME_ENVIROMENT');
</code></pre>
    <p>
     还有超全局变量方式：
    </p>
    <pre><code class="prism language-php"><span class="token variable">$env</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'RUNTIME_ENVIROMENT'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     然后根据获取到的环境变量设置就可以了：
    </p>
    <pre><code class="prism language-PHP">defined('YII_ENV') or define('YII_ENV', $_SERVER['RUNTIME_ENVIROMENT'] ?? 'prod');
defined('YII_DEBUG') or define('YII_DEBUG', YII_ENV === 'dev' || YII_ENV === 'test');
</code></pre>
    <h3>
     <a id="Reference_109">
     </a>
     Reference
    </h3>
    <ul>
     <li>
      <a href="https://blog.csdn.net/weixin_30844865/article/details/115198811">
       https://blog.csdn.net/weixin_30844865/article/details/115198811
      </a>
     </li>
    </ul>
    <h3>
     <a id="_113">
     </a>
     写在最后
    </h3>
    <p>
     欢迎大家关注鄙人的公众号【麦田里的守望者zhg】，让我们一起成长，谢谢。
     <br/>
     [外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-ko3OUho2-1641470982162)(https://jums.club/images/wechataccount.jpg)]
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33333532313138342f:61727469636c652f64657461696c732f313232333531383530" class_="artid" style="display:none">
 </p>
</div>


