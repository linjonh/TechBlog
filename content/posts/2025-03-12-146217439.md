---
arturl_encode: "68747470:733a2f2f626c6f672e6373646e2e6e65742f6465666c61672f:61727469636c652f64657461696c732f313436323137343339"
layout: post
title: "ç¬¬J2å‘¨ResNet50V2ç®—æ³•å®ç°01Tensorflowç¡¬ç¼–ç ç‰ˆ"
date: 2025-03-12 23:04:28 +0800
description: "ä½¿ç”¨tensorflowå®ç°ResNetV50V2çš„ç½‘ç»œç»“æ„ã€‚æœ¬æ¬¡æ ¹æ®ç¬¬ä¸€å±‚çš„ç»†èŠ‚æ‰‹åŠ¨ç¡¬ç¼–ç ï¼Œæ²¡æœ‰ä»»ä½•çš„ä¼˜åŒ–ï¼Œåªä¸ºäº†æ›´å¥½çš„ç†è§£ç»†èŠ‚ã€‚ç»“æœä¸æ˜¯å¾ˆç†æƒ³ï¼Œç½‘ç»œç»“æ„åº”è¯¥è¿˜æœ‰ç‘•ç–µã€‚åç»­ä¼˜åŒ–ä»£ç è§£å†³æ‹Ÿåˆé—®é¢˜ã€‚"
keywords: "ç¬¬J2å‘¨ï¼šResNet50V2ç®—æ³•å®ç°01ï¼ˆTensorflowç¡¬ç¼–ç ç‰ˆï¼‰"
categories: ['äººå·¥æ™ºèƒ½å­¦ä¹ ']
tags: ['ç®—æ³•', 'äººå·¥æ™ºèƒ½', 'Tensorflow']
artid: "146217439"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146217439
    alt: "ç¬¬J2å‘¨ResNet50V2ç®—æ³•å®ç°01Tensorflowç¡¬ç¼–ç ç‰ˆ"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146217439
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146217439
cover: https://bing.ee123.net/img/rand?artid=146217439
image: https://bing.ee123.net/img/rand?artid=146217439
img: https://bing.ee123.net/img/rand?artid=146217439
---

# ç¬¬J2å‘¨ï¼šResNet50V2ç®—æ³•å®ç°01ï¼ˆTensorflowç¡¬ç¼–ç ç‰ˆï¼‰

> * **ğŸ¨ æœ¬æ–‡ä¸º
>   [ğŸ”—365å¤©æ·±åº¦å­¦ä¹ è®­ç»ƒè¥](https://mp.weixin.qq.com/s/Z9yL_wt7L8aPOr9Lqb1K3w)
>   ä¸­çš„å­¦ä¹ è®°å½•åšå®¢**
> * **ğŸ– åŸä½œè€…ï¼š
>   [KåŒå­¦å•Š](https://mtyjkh.blog.csdn.net/)**

#### **ç›®æ ‡**

ä½¿ç”¨tensorflowå®ç°ResNetV50V2çš„ç½‘ç»œç»“æ„ã€‚æœ¬æ¬¡æ ¹æ®ç¬¬ä¸€å±‚çš„ç»†èŠ‚æ‰‹åŠ¨ç¡¬ç¼–ç ï¼Œæ²¡æœ‰ä»»ä½•çš„ä¼˜åŒ–ï¼Œåªä¸ºäº†æ›´å¥½çš„ç†è§£ç»†èŠ‚ã€‚
  
ç›®å½•ç»“æ„ï¼š
  
![image.png](https://i-blog.csdnimg.cn/img_convert/fc7b4c57a8a59d7f8b5994ccf81b1dc1.png)

ç½‘ç»œç»“æ„å›¾è§æœ€å

#### **å…·ä½“å®ç°**

##### **ï¼ˆä¸€ï¼‰ç¯å¢ƒ**

*è¯­è¨€ç¯å¢ƒ*
ï¼šPython 3.10
  
*ç¼– è¯‘ å™¨:*
PyCharm
  
*æ¡† æ¶:*
Tensorflow

##### **ï¼ˆäºŒï¼‰å…·ä½“æ­¥éª¤**

**1. ResNet50V2çš„å®ç°**

```
from keras import layers  
from keras.layers import Input, Activation, BatchNormalization, Flatten, GlobalAveragePooling2D  
from keras.layers import Dense, Conv2D,MaxPooling2D,ZeroPadding2D  
from keras.models import Model  
  
  
# éä¼˜åŒ–ç‰ˆï¼Œç›´æ¥æŒ‰ç…§ResNet50V2çš„ç½‘ç»œç»“æ„ï¼Œå…ˆå†™å‡ºæ¥è®­ç»ƒã€‚  
  
def ResNet50V2(input_shape=[224, 224, 3], classes=1000):  
    # è¾“å…¥  
    img_input = Input(shape=input_shape)  
  
    # STAGE 0 ç¬¬ä¸€ä¸ªå·ç§¯å±‚å’Œæ± åŒ–å±‚  
    x = ZeroPadding2D((1,1), name='conv1_pad')(img_input)  
    x = Conv2D(64, (7,7), strides = (2,2), name = 'conv1')(x)  
    x = BatchNormalization(name = 'bn_conv1')(x)  
    x = Activation('relu')(x)  
    x = ZeroPadding2D((1,1))(x)  
    x = MaxPooling2D((3,3), strides = (2,2))(x)  
  
    # STAGE 1  
    # é¢„æ¿€æ´»  
    x1 = BatchNormalization(name = 'bn_stage1_conv2')(x)  
    x1 = Activation('relu')(x1)  
  
    x1 = Conv2D(64, (1,1), strides = (1,1), name = 'conv2')(x1)  
    x1 = BatchNormalization(name = 'bn_conv3')(x1)  
    x1 = Activation('relu')(x1)  
    x1 = ZeroPadding2D((1,1))(x1)  
    x1 = Conv2D(64, (3,3), strides = (1,1), name = 'conv3')(x1)  
  
    x1 = BatchNormalization(name = 'bn_conv4')(x1)  
    x1 = Activation('relu')(x1)  
    x1 = Conv2D(256, (1,1), strides = (1,1), name = 'conv4')(x1)  
  
    # å¯¹è¾“å…¥å¼ é‡è¿›è¡Œ1x1å·ç§¯ï¼Œä»¥åŒ¹é…è¾“å‡ºå¼ é‡çš„ç»´åº¦  
    shortcut = Conv2D(256, (1, 1), strides=(1, 1), name='conv5')(x)  
    # å°†å·ç§¯ç»“æœä¸è¾“å…¥å¼ é‡ç›¸åŠ ï¼Œå®ç°æ®‹å·®è¿æ¥  
    x1 = layers.add([x1, shortcut], name='add1')  
  
    # STAGE 2  
    x2 = BatchNormalization(name='bn1')(x1)  
    x2 = Activation('relu', name='relu4')(x2)  
    x2 = Conv2D(64, (1, 1), strides=(1, 1), name='conv6')(x2)  
    x2 = BatchNormalization(name='bn2')(x2)  
    x2 = Activation('relu', name='relu5')(x2)  
    x2 = ZeroPadding2D((1, 1), name='pad1')(x2)  
  
    x2 = Conv2D(64, (3, 3), strides=(1, 1), name='conv7')(x2)  
    x2 = BatchNormalization(name='bn3')(x2)  
    x2 = Activation('relu', name='relu6')(x2)  
  
    x2 = Conv2D(256, (1, 1), strides=(1, 1), name='conv8')(x2)  
  
    shortcut = Conv2D(256, (1, 1), strides=(1, 1), name='conv9')(x1)  
  
    x2 = layers.add([x2, shortcut], name='add2')  
  
    # STAGE 3  
    x3 = BatchNormalization(name='bn4')(x2)  
    x3 = Activation('relu', name='relu7')(x3)  
    x3 = Conv2D(64, (1, 1), strides=(1, 1), name='conv10')(x3)  
    x3 = BatchNormalization(name='bn5')(x3)  
    x3 = Activation('relu', name='relu8')(x3)  
    x3 = ZeroPadding2D((1, 1), name='pad2')(x3)  
  
    x3 = Conv2D(64, (3, 3), strides=(2, 2), name='conv11')(x3)  
    x3 = BatchNormalization(name='bn6')(x3)  
    x3 = Activation('relu', name='relu9')(x3)  
  
    x3 = Conv2D(256, (1, 1), strides=(1, 1), name='conv12')(x3)  
  
    shortcut = Conv2D(256, (1, 1), strides=(2, 2), name='conv13')(x2)  
    x3 = layers.add([x3, shortcut], name='add3')  
  
  
    # STAGE 4  
    x4 = BatchNormalization(name='bn7')(x3)  
    x4 = Activation('relu', name='relu10')(x4)  
  
    x4 = Conv2D(128, (1, 1), strides=(1, 1), name='conv14')(x4)  
    x4 = BatchNormalization(name='bn8')(x4)  
    x4 = Activation('relu', name='relu11')(x4)  
    x4 = ZeroPadding2D((1, 1), name='pad3')(x4)  
  
    x4 = Conv2D(128, (3, 3), strides=(1, 1), name='conv15')(x4)  
    x4 = BatchNormalization(name='bn9')(x4)  
    x4 = Activation('relu', name='relu12')(x4)  
  
    x4 = Conv2D(512, (1, 1), strides=(1, 1), name='conv16')(x4)  
  
    shortcut = Conv2D(512, (1, 1), strides=(1, 1), name='conv17')(x3)  
    x4 = layers.add([x4, shortcut], name='add4')  
  
    # STAGE 5  
    x5 = BatchNormalization(name='bn10')(x4)  
    x5 = Activation('relu', name='relu13')(x5)  
  
    x5 = Conv2D(128, (1, 1), strides=(1, 1), name='conv18')(x5)  
    x5 = BatchNormalization(name='bn11')(x5)  
    x5 = Activation('relu', name='relu14')(x5)  
    x5 = ZeroPadding2D((1, 1), name='pad4')(x5)  
  
    x5 = Conv2D(128, (3, 3), strides=(1, 1), name='conv19')(x5)  
    x5 = BatchNormalization(name='bn12')(x5)  
    x5 = Activation('relu', name='relu15')(x5)  
  
    x5 = Conv2D(512, (1, 1), strides=(1, 1), name='conv20')(x5)  
  
    shortcut = Conv2D(512, (1, 1), strides=(1, 1), name='conv21')(x4)  
    x5 = layers.add([x5, shortcut], name='add5')  
  
    # STAGE 6  
    x6 = BatchNormalization(name='bn13')(x5)  
    x6 = Activation('relu', name='relu16')(x6)  
  
    x6 = Conv2D(128, (1, 1), strides=(1, 1), name='conv22')(x6)  
    x6 = BatchNormalization(name='bn14')(x6)  
    x6 = Activation('relu', name='relu17')(x6)  
    x6 = ZeroPadding2D((1, 1), name='pad5')(x6)  
  
    x6 = Conv2D(128, (3, 3), strides=(1, 1), name='conv23')(x6)  
    x6 = BatchNormalization(name='bn15')(x6)  
    x6 = Activation('relu', name='relu18')(x6)  
    x6 = Conv2D(512, (1, 1), strides=(1, 1), name='conv24')(x6)  
    shortcut = Conv2D(512, (1, 1), strides=(1, 1), name='conv25')(x5)  
    x6 = layers.add([x6, shortcut], name='add6')  
  
    # STAGE 7  
    x7 = BatchNormalization(name='bn16')(x6)  
    x7 = Activation('relu', name='relu19')(x7)  
  
    x7 = Conv2D(128, (1, 1), strides=(1, 1), name='conv26')(x7)  
    x7 = BatchNormalization(name='bn17')(x7)  
    x7 = Activation('relu', name='relu20')(x7)  
    x7 = ZeroPadding2D((1, 1), name='pad6')(x7)  
  
    x7 = Conv2D(128, (3, 3), strides=(2, 2), name='conv27')(x7)  
    x7 = BatchNormalization(name='bn18')(x7)  
    x7 = Activation('relu', name='relu21')(x7)  
    x7 = Conv2D(512, (1, 1), strides=(1, 1), name='conv28')(x7)  
    # shortcut = MaxPooling2D(pool_size=(1, 1), strides=(2, 2), padding='valid', name='conv29')(x6)  
    shortcut = Conv2D(512, (1, 1), strides=(2, 2), name='conv30')(x6)  
    x7 = layers.add([x7, shortcut], name='add7')  
  
    # STAGE 8  
    x8 = BatchNormalization(name='bn19')(x7)  
    x8 = Activation('relu', name='relu22')(x8)  
    x8 = Conv2D(256, (1, 1), strides=(1, 1), name='conv31')(x8)  
    x8 = BatchNormalization(name='bn20')(x8)  
    x8 = Activation('relu', name='relu23')(x8)  
    x8 = ZeroPadding2D((1, 1), name='pad7')(x8)  
    x8 = Conv2D(256, (3, 3), strides=(1, 1), name='conv32')(x8)  
    x8 = BatchNormalization(name='bn21')(x8)  
    x8 = Activation('relu', name='relu24')(x8)  
    x8 = Conv2D(1024, (1, 1), strides=(1, 1), name='conv33')(x8)  
  
    shortcut = Conv2D(1024, (1, 1), strides=(1, 1), name='conv34')(x7)  
    x8 = layers.add([x8, shortcut], name='add8')  
  
    # STAGE 9  
    x9 = BatchNormalization(name='bn22')(x8)  
    x9 = Activation('relu', name='relu25')(x9)  
    x9 = Conv2D(256, (1, 1), strides=(1, 1), name='conv35')(x9)  
    x9 = BatchNormalization(name='bn23')(x9)  
    x9 = Activation('relu', name='relu26')(x9)  
    x9 = ZeroPadding2D((1, 1), name='pad8')(x9)  
    x9 = Conv2D(256, (3, 3), strides=(1, 1), name='conv36')(x9)  
    x9 = BatchNormalization(name='bn24')(x9)  
    x9 = Activation('relu', name='relu27')(x9)  
    x9 = Conv2D(1024, (1, 1), strides=(1, 1), name='conv37')(x9)  
    shortcut = Conv2D(1024, (1, 1), strides=(1, 1), name='conv38')(x8)  
    x9 = layers.add([x9, shortcut], name='add9')  
  
    # STAGE 10  
    x10 = BatchNormalization(name='bn25')(x9)  
    x10 = Activation('relu', name='relu28')(x10)  
    x10 = Conv2D(256, (1, 1), strides=(1, 1), name='conv39')(x10)  
    x10 = BatchNormalization(name='bn26')(x10)  
    x10 = Activation('relu', name='relu29')(x10)  
    x10 = ZeroPadding2D((1, 1), name='pad9')(x10)  
    x10 = Conv2D(256, (3, 3), strides=(1, 1), name='conv40')(x10)  
    x10 = BatchNormalization(name='bn27')(x10)  
    x10 = Activation('relu', name='relu30')(x10)  
    x10 = Conv2D(1024, (1, 1), strides=(1, 1), name='conv41')(x10)  
    shortcut = Conv2D(1024, (1, 1), strides=(1, 1), name='conv42')(x9)  
    x10 = layers.add([x10, shortcut], name='add10')  
  
    # STAGE 11  
    x11 = BatchNormalization(name='bn28')(x10)  
    x11 = Activation('relu', name='relu31')(x11)  
    x11 = Conv2D(256, (1, 1), strides=(1, 1), name='conv43')(x11)  
    x11 = BatchNormalization(name='bn29')(x11)  
    x11 = Activation('relu', name='relu32')(x11)  
    x11 = ZeroPadding2D((1, 1), name='pad10')(x11)  
    x11 = Conv2D(256, (3, 3), strides=(1, 1), name='conv44')(x11)  
    x11 = BatchNormalization(name='bn30')(x11)  
    x11 = Activation('relu', name='relu33')(x11)  
    x11 = Conv2D(1024, (1, 1), strides=(1, 1), name='conv45')(x11)  
    shortcut = Conv2D(1024, (1, 1), strides=(1, 1), name='conv46')(x10)  
    x11 = layers.add([x11, shortcut], name='add11')  
  
    # STAGE 12  
    x12 = BatchNormalization(name='bn31')(x11)  
    x12 = Activation('relu', name='relu34')(x12)  
    x12 = Conv2D(256, (1, 1), strides=(1, 1), name='conv47')(x12)  
    x12 = BatchNormalization(name='bn32')(x12)  
    x12 = Activation('relu', name='relu35')(x12)  
    x12 = ZeroPadding2D((1, 1), name='pad11')(x12)  
    x12 = Conv2D(256, (3, 3), strides=(2, 2), name='conv48')(x12)  
    x12 = BatchNormalization(name='bn33')(x12)  
    x12 = Activation('relu', name='relu36')(x12)  
    x12 = Conv2D(1024, (1, 1), strides=(1, 1), name='conv49')(x12)  
    shortcut = MaxPooling2D(pool_size=(1, 1), strides=(2, 2), padding='valid', name='conv50')(x11)  
    shortcut = Conv2D(1024, (1, 1), strides=(1, 1), name='conv51')(shortcut)  
    x12 = layers.add([x12, shortcut], name='add12')  
  
    # STAGE 13  
    x13 = BatchNormalization(name='bn34')(x12)  
    x13 = Activation('relu', name='relu37')(x13)  
    x13 = Conv2D(512, (1, 1), strides=(1, 1), name='conv52')(x13)  
    x13 = BatchNormalization(name='bn35')(x13)  
    x13 = Activation('relu', name='relu38')(x13)  
    x13 = ZeroPadding2D((1, 1), name='pad12')(x13)  
    x13 = Conv2D(512, (3, 3), strides=(1, 1), name='conv53')(x13)  
    x13 = BatchNormalization(name='bn36')(x13)  
    x13 = Activation('relu', name='relu39')(x13)  
    x13 = Conv2D(2048, (1, 1), strides=(1, 1), name='conv54')(x13)  
    shortcut = Conv2D(2048, (1, 1), strides=(1, 1), name='conv55')(x12)  
    x13 = layers.add([x13, shortcut], name='add13')  
  
    # STAGE 14  
    x14 = BatchNormalization(name='bn37')(x13)  
    x14 = Activation('relu', name='relu40')(x14)  
    x14 = Conv2D(512, (1, 1), strides=(1, 1), name='conv56')(x14)  
    x14 = BatchNormalization(name='bn38')(x14)  
    x14 = Activation('relu', name='relu41')(x14)  
    x14 = ZeroPadding2D((1, 1), name='pad13')(x14)  
    x14 = Conv2D(512, (3, 3), strides=(1, 1), name='conv57')(x14)  
    x14 = BatchNormalization(name='bn39')(x14)  
    x14 = Activation('relu', name='relu42')(x14)  
    x14 = Conv2D(2048, (1, 1), strides=(1, 1), name='conv58')(x14)  
    shortcut = Conv2D(2048, (1, 1), strides=(1, 1), name='conv59')(x13)  
    x14 = layers.add([x14, shortcut], name='add14')  
  
    # STAGE 15  
    x15 = BatchNormalization(name='bn40')(x14)  
    x15 = Activation('relu', name='relu43')(x15)  
    x15 = Conv2D(512, (1, 1), strides=(1, 1), name='conv60')(x15)  
    x15 = BatchNormalization(name='bn41')(x15)  
    x15 = Activation('relu', name='relu44')(x15)  
    x15 = ZeroPadding2D((1, 1), name='pad14')(x15)  
    x15 = Conv2D(512, (3, 3), strides=(1, 1), name='conv61')(x15)  
    x15 = BatchNormalization(name='bn42')(x15)  
    x15 = Activation('relu', name='relu45')(x15)  
    x15 = Conv2D(2048, (1, 1), strides=(1, 1), name='conv62')(x15)  
    shortcut = Conv2D(2048, (1, 1), strides=(1, 1), name='conv63')(x14)  
    x15 = layers.add([x15, shortcut], name='add15')  
  
    # STAGE 16  
    x16 = BatchNormalization(name='bn43')(x15)  
    x16 = Activation('relu', name='relu46')(x16)  
    x16 = GlobalAveragePooling2D()(x16)  
    x16 = Flatten()(x16)  
    x16 = Dense(classes, activation='softmax', name='fc1000')(x16)  
  
    model = Model(img_input, x16, name='ResNet50V2')  
  
    return model  
  
  
  
  
if __name__=='__main__':  
    model = ResNet50V2()  
    model.summary()

```

**2.è®­ç»ƒä»£ç **

```
import numpy as np  
import tensorflow as tf  
from models.ResNet50V2 import ResNet50V2  
from tensorflow.python.data import AUTOTUNE  
  
# è®¾ç½®GPU  
# è·å–å½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰å¯ç”¨çš„ç‰©ç†GPUè®¾å¤‡  
gpus = tf.config.list_physical_devices("GPU")  
  
# å¦‚æœç³»ç»Ÿä¸­å­˜åœ¨GPUè®¾å¤‡  
if gpus:  
    # è®¾ç½®ç¬¬ä¸€ä¸ªGPUè®¾å¤‡çš„å†…å­˜å¢é•¿æ¨¡å¼ä¸ºåŠ¨æ€å¢é•¿ï¼Œä»¥é¿å…ä¸€æ¬¡æ€§å ç”¨æ‰€æœ‰æ˜¾å­˜  
    tf.config.experimental.set_memory_growth(gpus[0], True)  
  
    # è®¾ç½®å½“å‰å¯è§çš„GPUè®¾å¤‡ä¸ºç¬¬ä¸€ä¸ªGPUï¼Œç¡®ä¿ç¨‹åºä»…ä½¿ç”¨è¯¥GPUè¿›è¡Œè®¡ç®—  
    tf.config.set_visible_devices([gpus[0]], "GPU")  
  
  
# å¯¼å…¥æ•°æ®  
import matplotlib.pyplot as plt  
import os, PIL, pathlib  
from tensorflow import keras  
from tensorflow.keras import layers, models  
  
# è®¾ç½®matplotlibçš„å­—ä½“ä¸ºSimHeiï¼Œä»¥æ”¯æŒä¸­æ–‡æ˜¾ç¤º  
plt.rcParams['font.sans-serif'] = ['SimHei']  
# è®¾ç½®matplotlibçš„è´Ÿå·æ˜¾ç¤ºä¸ºæ­£å¸¸ç¬¦å·ï¼Œé¿å…æ˜¾ç¤ºä¸ºæ–¹å—  
plt.rcParams['axes.unicode_minus'] = False  
  
# å®šä¹‰æ•°æ®ç›®å½•è·¯å¾„  
data_dir = "./data/bird_photos"  
# å°†è·¯å¾„è½¬æ¢ä¸ºpathlib.Pathå¯¹è±¡ï¼Œæ–¹ä¾¿åç»­æ“ä½œ  
data_dir = pathlib.Path(data_dir)  
  
# ä½¿ç”¨globæ–¹æ³•è·å–æ‰€æœ‰å­ç›®å½•ä¸‹çš„jpgæ–‡ä»¶ï¼Œå¹¶è®¡ç®—å…¶æ•°é‡  
image_count = len(list(data_dir.glob('*/*.jpg')))  
# æ‰“å°å›¾ç‰‡æ•°é‡  
print("å›¾ç‰‡æ•°é‡ï¼š",image_count)  
  
# æ•°æ®é¢„å¤„ç†  
# å®šä¹‰æ‰¹é‡å¤§å°å’Œå›¾åƒå°ºå¯¸  
batch_size = 8  
img_height = 224  
img_width = 224  
  
# ä½¿ç”¨ `tf.keras.preprocessing.image_dataset_from_directory` ä»æŒ‡å®šç›®å½•åŠ è½½è®­ç»ƒæ•°æ®é›†  
# å‚æ•°è¯´æ˜:  
# - data_dir: åŒ…å«å›¾åƒæ•°æ®çš„ç›®å½•è·¯å¾„  
# - validation_split: ç”¨äºéªŒè¯é›†çš„æ•°æ®æ¯”ä¾‹ï¼Œæ­¤å¤„ä¸º20%  
# - subset: æŒ‡å®šåŠ è½½çš„æ•°æ®å­é›†ï¼Œæ­¤å¤„ä¸ºè®­ç»ƒé›†  
# - seed: éšæœºç§å­ï¼Œç¡®ä¿æ•°æ®åˆ†å‰²çš„å¯é‡å¤æ€§  
# - image_size: å›¾åƒå°†è¢«è°ƒæ•´åˆ°çš„å°ºå¯¸ï¼Œæ­¤å¤„ä¸º224x224  
# - batch_size: æ¯ä¸ªæ‰¹æ¬¡çš„å›¾åƒæ•°é‡ï¼Œæ­¤å¤„ä¸º8  
train_ds = tf.keras.preprocessing.image_dataset_from_directory(  
    data_dir,  
    validation_split=0.2,  
    subset="training",  
    seed=123,  
    image_size=(img_height, img_width),  
    batch_size=batch_size)  
  
# ä½¿ç”¨ `tf.keras.preprocessing.image_dataset_from_directory` ä»æŒ‡å®šç›®å½•åŠ è½½éªŒè¯æ•°æ®é›†  
# å‚æ•°è¯´æ˜ä¸è®­ç»ƒé›†ç›¸åŒï¼Œä½† `subset` å‚æ•°æŒ‡å®šä¸ºéªŒè¯é›†  
val_ds = tf.keras.preprocessing.image_dataset_from_directory(  
    data_dir,  
    validation_split=0.2,  
    subset="validation",  
    seed=123,  
    image_size=(img_height, img_width),  
    batch_size=batch_size)  
  
# ä»è®­ç»ƒæ•°æ®é›†ä¸­è·å–ç±»åˆ«åç§°  
class_names = train_ds.class_names  
  
# æ‰“å°ç±»åˆ«åç§°  
print("ç±»åˆ«:", class_names)  
  
# å¯è§†åŒ–æ•°æ®  
# å¯è§†åŒ–è®­ç»ƒæ•°æ®é›†ä¸­çš„éƒ¨åˆ†å›¾åƒåŠå…¶å¯¹åº”çš„æ ‡ç­¾  
# è¯¥ä»£ç å—åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º10x5çš„å›¾å½¢çª—å£ï¼Œå¹¶åœ¨çª—å£ä¸­å±•ç¤ºè®­ç»ƒæ•°æ®é›†ä¸­çš„å‰8å¼ å›¾åƒåŠå…¶æ ‡ç­¾ã€‚  
  
plt.figure(figsize=(10, 5))  # åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º10x5çš„å›¾å½¢çª—å£  
plt.suptitle("è®­ç»ƒæ•°æ®é›†å¯è§†åŒ–")  # è®¾ç½®å›¾å½¢çš„æ ‡é¢˜ä¸º"è®­ç»ƒæ•°æ®é›†å¯è§†åŒ–"  
  
# ä»è®­ç»ƒæ•°æ®é›†ä¸­å–å‡ºä¸€æ‰¹æ•°æ®ï¼ˆimageså’Œlabelsï¼‰ï¼Œå¹¶å±•ç¤ºå…¶ä¸­çš„å‰8å¼ å›¾åƒ  
for images, labels in train_ds.take(1):  
    for i in range(8):  
        ax = plt.subplot(2, 4, i+1)  # åœ¨2è¡Œ4åˆ—çš„ç½‘æ ¼ä¸­åˆ›å»ºç¬¬i+1ä¸ªå­å›¾  
        plt.imshow(images[i].numpy().astype("uint8"))  # æ˜¾ç¤ºç¬¬iå¼ å›¾åƒï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºuint8ç±»å‹  
        plt.title(class_names[labels[i]])  # è®¾ç½®å­å›¾çš„æ ‡é¢˜ä¸ºå¯¹åº”çš„ç±»åˆ«åç§°  
        plt.axis("off")  # å…³é—­å­å›¾çš„åæ ‡è½´æ˜¾ç¤º  
  
# æ£€æŸ¥æ•°æ®  
"""  
éå†è®­ç»ƒæ•°æ®é›†ä¸­çš„æ‰¹æ¬¡ï¼Œå¹¶æ‰“å°å›¾åƒæ‰¹æ¬¡å’Œæ ‡ç­¾æ‰¹æ¬¡çš„å½¢çŠ¶ã€‚  
  
è¯¥ä»£ç ç‰‡æ®µä»è®­ç»ƒæ•°æ®é›† `train_ds` ä¸­è·å–ä¸€ä¸ªæ‰¹æ¬¡çš„æ•°æ®ï¼Œå¹¶æ‰“å°è¯¥æ‰¹æ¬¡ä¸­å›¾åƒå’Œæ ‡ç­¾çš„å½¢çŠ¶ã€‚  
`train_ds` æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œé€šå¸¸åŒ…å«å›¾åƒå’Œæ ‡ç­¾çš„æ‰¹æ¬¡æ•°æ®ã€‚  
  
ä»£ç æ‰§è¡Œæµç¨‹ï¼š  
1. ä» `train_ds` ä¸­è·å–ä¸€ä¸ªæ‰¹æ¬¡çš„å›¾åƒå’Œæ ‡ç­¾ã€‚  
2. æ‰“å°å›¾åƒæ‰¹æ¬¡çš„å½¢çŠ¶ã€‚  
3. æ‰“å°æ ‡ç­¾æ‰¹æ¬¡çš„å½¢çŠ¶ã€‚  
4. ä½¿ç”¨ `break` è¯­å¥æå‰é€€å‡ºå¾ªç¯ï¼Œä»…å¤„ç†ç¬¬ä¸€ä¸ªæ‰¹æ¬¡ã€‚  
"""  
for image_batch, labels_batch in train_ds:  
    # æ‰“å°å›¾åƒæ‰¹æ¬¡çš„å½¢çŠ¶ï¼Œé€šå¸¸ä¸º (batch_size, height, width, channels)    print(image_batch.shape)  
  
    # æ‰“å°æ ‡ç­¾æ‰¹æ¬¡çš„å½¢çŠ¶ï¼Œé€šå¸¸ä¸º (batch_size,)    print(labels_batch.shape)  
  
    # ä»…å¤„ç†ç¬¬ä¸€ä¸ªæ‰¹æ¬¡åé€€å‡ºå¾ªç¯  
    break  
  
# é…ç½®æ•°æ®é›†  
# è®¾ç½®è‡ªåŠ¨è°ƒä¼˜å‚æ•°ï¼Œç”¨äºä¼˜åŒ–æ•°æ®åŠ è½½å’Œé¢„å¤„ç†æ€§èƒ½  
AUTOTUNE = tf.data.AUTOTUNE  
  
# å¯¹è®­ç»ƒæ•°æ®é›†è¿›è¡Œä¼˜åŒ–å¤„ç†ï¼š  
# 1. `cache()`: å°†æ•°æ®é›†ç¼“å­˜åˆ°å†…å­˜æˆ–ç£ç›˜ï¼Œé¿å…åœ¨æ¯ä¸ªepoché‡å¤åŠ è½½æ•°æ®ï¼Œæé«˜è®­ç»ƒæ•ˆç‡ã€‚  
# 2. `shuffle(1000)`: å¯¹æ•°æ®é›†è¿›è¡Œéšæœºæ‰“ä¹±ï¼Œç¼“å†²åŒºå¤§å°ä¸º1000ï¼Œç¡®ä¿è®­ç»ƒæ•°æ®çš„éšæœºæ€§ã€‚  
# 3. `prefetch(buffer_size=AUTOTUNE)`: ä½¿ç”¨è‡ªåŠ¨è°ƒä¼˜çš„ç¼“å†²åŒºå¤§å°ï¼Œé¢„å–æ•°æ®ä»¥é‡å æ•°æ®åŠ è½½å’Œæ¨¡å‹è®­ç»ƒï¼Œæé«˜æ•´ä½“æ€§èƒ½ã€‚  
train_ds = train_ds.cache().shuffle(1000).prefetch(buffer_size=AUTOTUNE)  
  
# å¯¹éªŒè¯æ•°æ®é›†è¿›è¡Œä¼˜åŒ–å¤„ç†ï¼š  
# 1. `cache()`: å°†æ•°æ®é›†ç¼“å­˜åˆ°å†…å­˜æˆ–ç£ç›˜ï¼Œé¿å…åœ¨æ¯ä¸ªepoché‡å¤åŠ è½½æ•°æ®ï¼Œæé«˜éªŒè¯æ•ˆç‡ã€‚  
# 2. `prefetch(buffer_size=AUTOTUNE)`: ä½¿ç”¨è‡ªåŠ¨è°ƒä¼˜çš„ç¼“å†²åŒºå¤§å°ï¼Œé¢„å–æ•°æ®ä»¥é‡å æ•°æ®åŠ è½½å’Œæ¨¡å‹éªŒè¯ï¼Œæé«˜æ•´ä½“æ€§èƒ½ã€‚  
val_ds = val_ds.cache().prefetch(buffer_size=AUTOTUNE)  
  
# åˆå§‹åŒ–ä¸€ä¸ªResNet50V2æ¨¡å‹å®ä¾‹  
# å‚æ•°è¯´æ˜:  
#   - input_shape: è¾“å…¥å›¾åƒçš„å½¢çŠ¶ï¼Œæ ¼å¼ä¸º[height, width, channels]ï¼Œæ­¤å¤„ä¸º[224, 224, 3]ï¼Œè¡¨ç¤º224x224åƒç´ çš„RGBå›¾åƒ  
#   - classes: åˆ†ç±»ä»»åŠ¡çš„ç±»åˆ«æ•°é‡ï¼Œæ­¤å¤„ä¸ºclass_namesåˆ—è¡¨çš„é•¿åº¦ï¼Œè¡¨ç¤ºæ¨¡å‹å°†è¾“å‡ºå¯¹åº”ç±»åˆ«çš„æ¦‚ç‡  
model = ResNet50V2(classes=4)  
  
# æ‰“å°æ¨¡å‹çš„æ‘˜è¦ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¯ä¸€å±‚çš„åç§°ã€è¾“å‡ºå½¢çŠ¶å’Œå‚æ•°æ•°é‡  
model.summary()  
  
model.compile(  
    # ä½¿ç”¨Adamä¼˜åŒ–å™¨ï¼Œå­¦ä¹ ç‡åˆå§‹å€¼ä¸º0.001  
    optimizer=tf.keras.optimizers.Adam(learning_rate=0.001),  
    # è®¾ç½®æŸå¤±å‡½æ•°ä¸ºäº¤å‰ç†µæŸå¤±å‡½æ•°  
    loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True),  
    # è®¾ç½®æ€§èƒ½æŒ‡æ ‡åˆ—è¡¨ï¼Œå°†åœ¨æ¨¡å‹è®­ç»ƒæ—¶ç›‘æ§åˆ—è¡¨ä¸­çš„æŒ‡æ ‡  
    metrics=['accuracy']  
)  
  
# è®­ç»ƒæ¨¡å‹å¹¶è®°å½•è®­ç»ƒè¿‡ç¨‹ä¸­çš„å†å²æ•°æ®  
#  
# å‚æ•°:  
#   train_ds: è®­ç»ƒæ•°æ®é›†ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªtf.data.Datasetå¯¹è±¡ï¼ŒåŒ…å«è®­ç»ƒæ•°æ®ã€‚  
#   validation_data: éªŒè¯æ•°æ®é›†ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªtf.data.Datasetå¯¹è±¡ï¼Œç”¨äºåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¯„ä¼°æ¨¡å‹æ€§èƒ½ã€‚  
#   epochs: è®­ç»ƒçš„è½®æ•°ï¼Œå³æ¨¡å‹å°†éå†æ•´ä¸ªè®­ç»ƒæ•°æ®é›†çš„æ¬¡æ•°ã€‚  
#  
# è¿”å›å€¼:  
#   history: ä¸€ä¸ªHistoryå¯¹è±¡ï¼ŒåŒ…å«è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŸå¤±å’Œè¯„ä¼°æŒ‡æ ‡çš„å†å²è®°å½•ã€‚  
  
epochs = 10  
history = model.fit(  
    train_ds,  
    validation_data=val_ds,  
    epochs=epochs  
)  
  
# è¯„ä¼°æ¨¡å‹  
# è¯¥ä»£ç å—ç”¨äºç»˜åˆ¶æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­çš„å‡†ç¡®ç‡å’ŒæŸå¤±æ›²çº¿ï¼Œä»¥ä¾¿å¯è§†åŒ–æ¨¡å‹åœ¨è®­ç»ƒé›†å’ŒéªŒè¯é›†ä¸Šçš„è¡¨ç°ã€‚  
  
# ä»è®­ç»ƒå†å²è®°å½•ä¸­æå–è®­ç»ƒé›†å’ŒéªŒè¯é›†çš„å‡†ç¡®ç‡åŠæŸå¤±å€¼  
acc = history.history['accuracy']  
val_acc = history.history['val_accuracy']  
loss = history.history['loss']  
val_loss = history.history['val_loss']  
  
# ç”Ÿæˆä¸€ä¸ªèŒƒå›´ï¼Œè¡¨ç¤ºè®­ç»ƒçš„è½®æ•°ï¼ˆepochsï¼‰  
epochs_range = range(epochs)  
  
# åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º12x4çš„å›¾å½¢çª—å£  
plt.figure(figsize=(12, 4))  
  
# åœ¨å›¾å½¢çª—å£çš„ç¬¬ä¸€ä¸ªå­å›¾ä¸­ç»˜åˆ¶è®­ç»ƒé›†å’ŒéªŒè¯é›†çš„å‡†ç¡®ç‡æ›²çº¿  
plt.subplot(1, 2, 1)  
plt.plot(epochs_range, acc, label='Training Accuracy')  
plt.plot(epochs_range, val_acc, label='Validation Accuracy')  
plt.legend(loc='lower right')  # æ·»åŠ å›¾ä¾‹ï¼Œä½ç½®åœ¨å³ä¸‹è§’  
plt.title('Training and Validation Accuracy')  # è®¾ç½®å­å›¾æ ‡é¢˜  
  
# åœ¨å›¾å½¢çª—å£çš„ç¬¬äºŒä¸ªå­å›¾ä¸­ç»˜åˆ¶è®­ç»ƒé›†å’ŒéªŒè¯é›†çš„æŸå¤±æ›²çº¿  
plt.subplot(1, 2, 2)  
plt.plot(epochs_range, loss, label='Training Loss')  
plt.plot(epochs_range, val_loss, label='Validation Loss')  
plt.legend(loc='upper right')  # æ·»åŠ å›¾ä¾‹ï¼Œä½ç½®åœ¨å³ä¸Šè§’  
plt.title('Training and Validation Loss')  # è®¾ç½®å­å›¾æ ‡é¢˜  
  
# æ˜¾ç¤ºç»˜åˆ¶çš„å›¾å½¢  
plt.show()  
  
# é¢„æµ‹  
# è¯¥å‡½æ•°ç”¨äºå±•ç¤ºéªŒè¯æ•°æ®é›†ä¸­çš„å›¾ç‰‡ï¼Œå¹¶ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹å¯¹å›¾ç‰‡è¿›è¡Œé¢„æµ‹ï¼Œæ˜¾ç¤ºé¢„æµ‹ç»“æœã€‚  
# å‡½æ•°çš„ä¸»è¦æ­¥éª¤åŒ…æ‹¬ï¼š  
# 1. åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º10x5çš„å›¾å½¢çª—å£ã€‚  
# 2. è®¾ç½®å›¾å½¢çš„æ€»æ ‡é¢˜ä¸ºâ€œå›¾ç‰‡é¢„æµ‹â€ã€‚  
# 3. ä»éªŒè¯æ•°æ®é›†ä¸­å–å‡ºä¸€æ‰¹å›¾ç‰‡å’Œæ ‡ç­¾ã€‚  
# 4. å¯¹æ¯å¼ å›¾ç‰‡è¿›è¡Œé¢„æµ‹ï¼Œå¹¶åœ¨å­å›¾ä¸­æ˜¾ç¤ºå›¾ç‰‡å’Œé¢„æµ‹ç»“æœã€‚  
# 5. å…³é—­å­å›¾çš„åæ ‡è½´æ˜¾ç¤ºã€‚  
  
plt.figure(figsize=(10, 5))  # åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º10x5çš„å›¾å½¢çª—å£  
plt.suptitle("å›¾ç‰‡é¢„æµ‹")  # è®¾ç½®å›¾å½¢çš„æ€»æ ‡é¢˜ä¸ºâ€œå›¾ç‰‡é¢„æµ‹â€  
  
# ä»éªŒè¯æ•°æ®é›†ä¸­å–å‡ºä¸€æ‰¹å›¾ç‰‡å’Œæ ‡ç­¾  
for images, labels in val_ds.take(1):  
    # éå†å‰8å¼ å›¾ç‰‡ï¼Œå¹¶åœ¨å­å›¾ä¸­æ˜¾ç¤ºå›¾ç‰‡å’Œé¢„æµ‹ç»“æœ  
    for i in range(8):  
        ax = plt.subplot(2, 4, i+1)  # åˆ›å»º2è¡Œ4åˆ—çš„å­å›¾ï¼Œå¹¶é€‰æ‹©ç¬¬i+1ä¸ªå­å›¾  
        plt.imshow(images[i].numpy().astype("uint8"))  # æ˜¾ç¤ºç¬¬iå¼ å›¾ç‰‡  
  
        # å¯¹å›¾ç‰‡è¿›è¡Œé¢„æµ‹  
        img_array = tf.expand_dims(images[i], 0)  # æ‰©å±•å›¾ç‰‡çš„ç»´åº¦ä»¥é€‚åº”æ¨¡å‹è¾“å…¥  
        predictions = model.predict(img_array)  # ä½¿ç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹  
  
        # åœ¨å­å›¾æ ‡é¢˜ä¸­æ˜¾ç¤ºé¢„æµ‹ç»“æœ  
        plt.title(class_names[np.argmax(predictions)])  
  
        plt.axis("off")  # å…³é—­å­å›¾çš„åæ ‡è½´æ˜¾ç¤º

```

**ç»“æœ**
ï¼š

```
Model: "ResNet50V2"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 input_1 (InputLayer)           [(None, 224, 224, 3  0           []                               
                                )]                                                                
                                                                                                  
 conv1_pad (ZeroPadding2D)      (None, 226, 226, 3)  0           ['input_1[0][0]']                
                                                                                                  
 conv1 (Conv2D)                 (None, 110, 110, 64  9472        ['conv1_pad[0][0]']              
                                )                                                                 
                                                                                                  
 bn_conv1 (BatchNormalization)  (None, 110, 110, 64  256         ['conv1[0][0]']                  
                                )                                                                 
                                                                                                  
 activation (Activation)        (None, 110, 110, 64  0           ['bn_conv1[0][0]']               
                                )                                                                 
                                                                                                  
 zero_padding2d (ZeroPadding2D)  (None, 112, 112, 64  0          ['activation[0][0]']             
                                )                                                                 
                                                                                                  
 max_pooling2d (MaxPooling2D)   (None, 55, 55, 64)   0           ['zero_padding2d[0][0]']         
                                                                                                  
 bn_conv2 (BatchNormalization)  (None, 55, 55, 64)   256         ['max_pooling2d[0][0]']          
                                                                                                  
 activation_1 (Activation)      (None, 55, 55, 64)   0           ['bn_conv2[0][0]']               
                                                                                                  
 conv2 (Conv2D)                 (None, 55, 55, 64)   4160        ['activation_1[0][0]']           
                                                                                                  
 bn_conv3 (BatchNormalization)  (None, 55, 55, 64)   256         ['conv2[0][0]']                  
                                                                                                  
 activation_2 (Activation)      (None, 55, 55, 64)   0           ['bn_conv3[0][0]']               
                                                                                                  
 zero_padding2d_1 (ZeroPadding2  (None, 57, 57, 64)  0           ['activation_2[0][0]']           
 D)                                                                                               
                                                                                                  
 conv3 (Conv2D)                 (None, 55, 55, 64)   36928       ['zero_padding2d_1[0][0]']       
                                                                                                  
 bn_conv4 (BatchNormalization)  (None, 55, 55, 64)   256         ['conv3[0][0]']                  
                                                                                                  
 activation_3 (Activation)      (None, 55, 55, 64)   0           ['bn_conv4[0][0]']               
                                                                                                  
 conv4 (Conv2D)                 (None, 55, 55, 256)  16640       ['activation_3[0][0]']           
                                                                                                  
 conv5 (Conv2D)                 (None, 55, 55, 256)  16640       ['max_pooling2d[0][0]']          
                                                                                                  
 add1 (Add)                     (None, 55, 55, 256)  0           ['conv4[0][0]',                  
                                                                  'conv5[0][0]']                  
                                                                                                  
 bn1 (BatchNormalization)       (None, 55, 55, 256)  1024        ['add1[0][0]']                   
                                                                                                  
 relu4 (Activation)             (None, 55, 55, 256)  0           ['bn1[0][0]']                    
                                                                                                  
 conv6 (Conv2D)                 (None, 55, 55, 64)   16448       ['relu4[0][0]']                  
                                                                                                  
 bn2 (BatchNormalization)       (None, 55, 55, 64)   256         ['conv6[0][0]']                  
                                                                                                  
 relu5 (Activation)             (None, 55, 55, 64)   0           ['bn2[0][0]']                    
                                                                                                  
 pad1 (ZeroPadding2D)           (None, 57, 57, 64)   0           ['relu5[0][0]']                  
                                                                                                  
 conv7 (Conv2D)                 (None, 55, 55, 64)   36928       ['pad1[0][0]']                   
                                                                                                  
 bn3 (BatchNormalization)       (None, 55, 55, 64)   256         ['conv7[0][0]']                  
                                                                                                  
 relu6 (Activation)             (None, 55, 55, 64)   0           ['bn3[0][0]']                    
                                                                                                  
 conv8 (Conv2D)                 (None, 55, 55, 256)  16640       ['relu6[0][0]']                  
                                                                                                  
 conv9 (Conv2D)                 (None, 55, 55, 256)  65792       ['add1[0][0]']                   
                                                                                                  
 add2 (Add)                     (None, 55, 55, 256)  0           ['conv8[0][0]',                  
                                                                  'conv9[0][0]']                  
                                                                                                  
 bn4 (BatchNormalization)       (None, 55, 55, 256)  1024        ['add2[0][0]']                   
                                                                                                  
 relu7 (Activation)             (None, 55, 55, 256)  0           ['bn4[0][0]']                    
                                                                                                  
 conv10 (Conv2D)                (None, 55, 55, 64)   16448       ['relu7[0][0]']                  
                                                                                                  
 bn5 (BatchNormalization)       (None, 55, 55, 64)   256         ['conv10[0][0]']                 
                                                                                                  
 relu8 (Activation)             (None, 55, 55, 64)   0           ['bn5[0][0]']                    
                                                                                                  
 pad2 (ZeroPadding2D)           (None, 57, 57, 64)   0           ['relu8[0][0]']                  
                                                                                                  
 conv11 (Conv2D)                (None, 28, 28, 64)   36928       ['pad2[0][0]']                   
                                                                                                  
 bn6 (BatchNormalization)       (None, 28, 28, 64)   256         ['conv11[0][0]']                 
                                                                                                  
 relu9 (Activation)             (None, 28, 28, 64)   0           ['bn6[0][0]']                    
                                                                                                  
 conv12 (Conv2D)                (None, 28, 28, 256)  16640       ['relu9[0][0]']                  
                                                                                                  
 conv13 (Conv2D)                (None, 28, 28, 256)  65792       ['add2[0][0]']                   
                                                                                                  
 add3 (Add)                     (None, 28, 28, 256)  0           ['conv12[0][0]',                 
                                                                  'conv13[0][0]']                 
                                                                                                  
 bn7 (BatchNormalization)       (None, 28, 28, 256)  1024        ['add3[0][0]']                   
                                                                                                  
 relu10 (Activation)            (None, 28, 28, 256)  0           ['bn7[0][0]']                    
                                                                                                  
 conv14 (Conv2D)                (None, 28, 28, 128)  32896       ['relu10[0][0]']                 
                                                                                                  
 bn8 (BatchNormalization)       (None, 28, 28, 128)  512         ['conv14[0][0]']                 
                                                                                                  
 relu11 (Activation)            (None, 28, 28, 128)  0           ['bn8[0][0]']                    
                                                                                                  
 pad3 (ZeroPadding2D)           (None, 30, 30, 128)  0           ['relu11[0][0]']                 
                                                                                                  
 conv15 (Conv2D)                (None, 28, 28, 128)  147584      ['pad3[0][0]']                   
                                                                                                  
 bn9 (BatchNormalization)       (None, 28, 28, 128)  512         ['conv15[0][0]']                 
                                                                                                  
 relu12 (Activation)            (None, 28, 28, 128)  0           ['bn9[0][0]']                    
                                                                                                  
 conv16 (Conv2D)                (None, 28, 28, 512)  66048       ['relu12[0][0]']                 
                                                                                                  
 conv17 (Conv2D)                (None, 28, 28, 512)  131584      ['add3[0][0]']                   
                                                                                                  
 add4 (Add)                     (None, 28, 28, 512)  0           ['conv16[0][0]',                 
                                                                  'conv17[0][0]']                 
                                                                                                  
 bn10 (BatchNormalization)      (None, 28, 28, 512)  2048        ['add4[0][0]']                   
                                                                                                  
 relu13 (Activation)            (None, 28, 28, 512)  0           ['bn10[0][0]']                   
                                                                                                  
 conv18 (Conv2D)                (None, 28, 28, 128)  65664       ['relu13[0][0]']                 
                                                                                                  
 bn11 (BatchNormalization)      (None, 28, 28, 128)  512         ['conv18[0][0]']                 
                                                                                                  
 relu14 (Activation)            (None, 28, 28, 128)  0           ['bn11[0][0]']                   
                                                                                                  
 pad4 (ZeroPadding2D)           (None, 30, 30, 128)  0           ['relu14[0][0]']                 
                                                                                                  
 conv19 (Conv2D)                (None, 28, 28, 128)  147584      ['pad4[0][0]']                   
                                                                                                  
 bn12 (BatchNormalization)      (None, 28, 28, 128)  512         ['conv19[0][0]']                 
                                                                                                  
 relu15 (Activation)            (None, 28, 28, 128)  0           ['bn12[0][0]']                   
                                                                                                  
 conv20 (Conv2D)                (None, 28, 28, 512)  66048       ['relu15[0][0]']                 
                                                                                                  
 conv21 (Conv2D)                (None, 28, 28, 512)  262656      ['add4[0][0]']                   
                                                                                                  
 add5 (Add)                     (None, 28, 28, 512)  0           ['conv20[0][0]',                 
                                                                  'conv21[0][0]']                 
                                                                                                  
 bn13 (BatchNormalization)      (None, 28, 28, 512)  2048        ['add5[0][0]']                   
                                                                                                  
 relu16 (Activation)            (None, 28, 28, 512)  0           ['bn13[0][0]']                   
                                                                                                  
 conv22 (Conv2D)                (None, 28, 28, 128)  65664       ['relu16[0][0]']                 
                                                                                                  
 bn14 (BatchNormalization)      (None, 28, 28, 128)  512         ['conv22[0][0]']                 
                                                                                                  
 relu17 (Activation)            (None, 28, 28, 128)  0           ['bn14[0][0]']                   
                                                                                                  
 pad5 (ZeroPadding2D)           (None, 30, 30, 128)  0           ['relu17[0][0]']                 
                                                                                                  
 conv23 (Conv2D)                (None, 28, 28, 128)  147584      ['pad5[0][0]']                   
                                                                                                  
 bn15 (BatchNormalization)      (None, 28, 28, 128)  512         ['conv23[0][0]']                 
                                                                                                  
 relu18 (Activation)            (None, 28, 28, 128)  0           ['bn15[0][0]']                   
                                                                                                  
 conv24 (Conv2D)                (None, 28, 28, 512)  66048       ['relu18[0][0]']                 
                                                                                                  
 conv25 (Conv2D)                (None, 28, 28, 512)  262656      ['add5[0][0]']                   
                                                                                                  
 add6 (Add)                     (None, 28, 28, 512)  0           ['conv24[0][0]',                 
                                                                  'conv25[0][0]']                 
                                                                                                  
 bn16 (BatchNormalization)      (None, 28, 28, 512)  2048        ['add6[0][0]']                   
                                                                                                  
 relu19 (Activation)            (None, 28, 28, 512)  0           ['bn16[0][0]']                   
                                                                                                  
 conv26 (Conv2D)                (None, 28, 28, 128)  65664       ['relu19[0][0]']                 
                                                                                                  
 bn17 (BatchNormalization)      (None, 28, 28, 128)  512         ['conv26[0][0]']                 
                                                                                                  
 relu20 (Activation)            (None, 28, 28, 128)  0           ['bn17[0][0]']                   
                                                                                                  
 pad6 (ZeroPadding2D)           (None, 30, 30, 128)  0           ['relu20[0][0]']                 
                                                                                                  
 conv27 (Conv2D)                (None, 14, 14, 128)  147584      ['pad6[0][0]']                   
                                                                                                  
 bn18 (BatchNormalization)      (None, 14, 14, 128)  512         ['conv27[0][0]']                 
                                                                                                  
 relu21 (Activation)            (None, 14, 14, 128)  0           ['bn18[0][0]']                   
                                                                                                  
 conv28 (Conv2D)                (None, 14, 14, 512)  66048       ['relu21[0][0]']                 
                                                                                                  
 conv30 (Conv2D)                (None, 14, 14, 512)  262656      ['add6[0][0]']                   
                                                                                                  
 add7 (Add)                     (None, 14, 14, 512)  0           ['conv28[0][0]',                 
                                                                  'conv30[0][0]']                 
                                                                                                  
 bn19 (BatchNormalization)      (None, 14, 14, 512)  2048        ['add7[0][0]']                   
                                                                                                  
 relu22 (Activation)            (None, 14, 14, 512)  0           ['bn19[0][0]']                   
                                                                                                  
 conv31 (Conv2D)                (None, 14, 14, 256)  131328      ['relu22[0][0]']                 
                                                                                                  
 bn20 (BatchNormalization)      (None, 14, 14, 256)  1024        ['conv31[0][0]']                 
                                                                                                  
 relu23 (Activation)            (None, 14, 14, 256)  0           ['bn20[0][0]']                   
                                                                                                  
 pad7 (ZeroPadding2D)           (None, 16, 16, 256)  0           ['relu23[0][0]']                 
                                                                                                  
 conv32 (Conv2D)                (None, 14, 14, 256)  590080      ['pad7[0][0]']                   
                                                                                                  
 bn21 (BatchNormalization)      (None, 14, 14, 256)  1024        ['conv32[0][0]']                 
                                                                                                  
 relu24 (Activation)            (None, 14, 14, 256)  0           ['bn21[0][0]']                   
                                                                                                  
 conv33 (Conv2D)                (None, 14, 14, 1024  263168      ['relu24[0][0]']                 
                                )                                                                 
                                                                                                  
 conv34 (Conv2D)                (None, 14, 14, 1024  525312      ['add7[0][0]']                   
                                )                                                                 
                                                                                                  
 add8 (Add)                     (None, 14, 14, 1024  0           ['conv33[0][0]',                 
                                )                                 'conv34[0][0]']                 
                                                                                                  
 bn22 (BatchNormalization)      (None, 14, 14, 1024  4096        ['add8[0][0]']                   
                                )                                                                 
                                                                                                  
 relu25 (Activation)            (None, 14, 14, 1024  0           ['bn22[0][0]']                   
                                )                                                                 
                                                                                                  
 conv35 (Conv2D)                (None, 14, 14, 256)  262400      ['relu25[0][0]']                 
                                                                                                  
 bn23 (BatchNormalization)      (None, 14, 14, 256)  1024        ['conv35[0][0]']                 
                                                                                                  
 relu26 (Activation)            (None, 14, 14, 256)  0           ['bn23[0][0]']                   
                                                                                                  
 pad8 (ZeroPadding2D)           (None, 16, 16, 256)  0           ['relu26[0][0]']                 
                                                                                                  
 conv36 (Conv2D)                (None, 14, 14, 256)  590080      ['pad8[0][0]']                   
                                                                                                  
 bn24 (BatchNormalization)      (None, 14, 14, 256)  1024        ['conv36[0][0]']                 
                                                                                                  
 relu27 (Activation)            (None, 14, 14, 256)  0           ['bn24[0][0]']                   
                                                                                                  
 conv37 (Conv2D)                (None, 14, 14, 1024  263168      ['relu27[0][0]']                 
                                )                                                                 
                                                                                                  
 conv38 (Conv2D)                (None, 14, 14, 1024  1049600     ['add8[0][0]']                   
                                )                                                                 
                                                                                                  
 add9 (Add)                     (None, 14, 14, 1024  0           ['conv37[0][0]',                 
                                )                                 'conv38[0][0]']                 
                                                                                                  
 bn25 (BatchNormalization)      (None, 14, 14, 1024  4096        ['add9[0][0]']                   
                                )                                                                 
                                                                                                  
 relu28 (Activation)            (None, 14, 14, 1024  0           ['bn25[0][0]']                   
                                )                                                                 
                                                                                                  
 conv39 (Conv2D)                (None, 14, 14, 256)  262400      ['relu28[0][0]']                 
                                                                                                  
 bn26 (BatchNormalization)      (None, 14, 14, 256)  1024        ['conv39[0][0]']                 
                                                                                                  
 relu29 (Activation)            (None, 14, 14, 256)  0           ['bn26[0][0]']                   
                                                                                                  
 pad9 (ZeroPadding2D)           (None, 16, 16, 256)  0           ['relu29[0][0]']                 
                                                                                                  
 conv40 (Conv2D)                (None, 14, 14, 256)  590080      ['pad9[0][0]']                   
                                                                                                  
 bn27 (BatchNormalization)      (None, 14, 14, 256)  1024        ['conv40[0][0]']                 
                                                                                                  
 relu30 (Activation)            (None, 14, 14, 256)  0           ['bn27[0][0]']                   
                                                                                                  
 conv41 (Conv2D)                (None, 14, 14, 1024  263168      ['relu30[0][0]']                 
                                )                                                                 
                                                                                                  
 conv42 (Conv2D)                (None, 14, 14, 1024  1049600     ['add9[0][0]']                   
                                )                                                                 
                                                                                                  
 add10 (Add)                    (None, 14, 14, 1024  0           ['conv41[0][0]',                 
                                )                                 'conv42[0][0]']                 
                                                                                                  
 bn28 (BatchNormalization)      (None, 14, 14, 1024  4096        ['add10[0][0]']                  
                                )                                                                 
                                                                                                  
 relu31 (Activation)            (None, 14, 14, 1024  0           ['bn28[0][0]']                   
                                )                                                                 
                                                                                                  
 conv43 (Conv2D)                (None, 14, 14, 256)  262400      ['relu31[0][0]']                 
                                                                                                  
 bn29 (BatchNormalization)      (None, 14, 14, 256)  1024        ['conv43[0][0]']                 
                                                                                                  
 relu32 (Activation)            (None, 14, 14, 256)  0           ['bn29[0][0]']                   
                                                                                                  
 pad10 (ZeroPadding2D)          (None, 16, 16, 256)  0           ['relu32[0][0]']                 
                                                                                                  
 conv44 (Conv2D)                (None, 14, 14, 256)  590080      ['pad10[0][0]']                  
                                                                                                  
 bn30 (BatchNormalization)      (None, 14, 14, 256)  1024        ['conv44[0][0]']                 
                                                                                                  
 relu33 (Activation)            (None, 14, 14, 256)  0           ['bn30[0][0]']                   
                                                                                                  
 conv45 (Conv2D)                (None, 14, 14, 1024  263168      ['relu33[0][0]']                 
                                )                                                                 
                                                                                                  
 conv46 (Conv2D)                (None, 14, 14, 1024  1049600     ['add10[0][0]']                  
                                )                                                                 
                                                                                                  
 add11 (Add)                    (None, 14, 14, 1024  0           ['conv45[0][0]',                 
                                )                                 'conv46[0][0]']                 
                                                                                                  
 bn31 (BatchNormalization)      (None, 14, 14, 1024  4096        ['add11[0][0]']                  
                                )                                                                 
                                                                                                  
 relu34 (Activation)            (None, 14, 14, 1024  0           ['bn31[0][0]']                   
                                )                                                                 
                                                                                                  
 conv47 (Conv2D)                (None, 14, 14, 256)  262400      ['relu34[0][0]']                 
                                                                                                  
 bn32 (BatchNormalization)      (None, 14, 14, 256)  1024        ['conv47[0][0]']                 
                                                                                                  
 relu35 (Activation)            (None, 14, 14, 256)  0           ['bn32[0][0]']                   
                                                                                                  
 pad11 (ZeroPadding2D)          (None, 16, 16, 256)  0           ['relu35[0][0]']                 
                                                                                                  
 conv48 (Conv2D)                (None, 7, 7, 256)    590080      ['pad11[0][0]']                  
                                                                                                  
 bn33 (BatchNormalization)      (None, 7, 7, 256)    1024        ['conv48[0][0]']                 
                                                                                                  
 relu36 (Activation)            (None, 7, 7, 256)    0           ['bn33[0][0]']                   
                                                                                                  
 conv50 (MaxPooling2D)          (None, 7, 7, 1024)   0           ['add11[0][0]']                  
                                                                                                  
 conv49 (Conv2D)                (None, 7, 7, 1024)   263168      ['relu36[0][0]']                 
                                                                                                  
 conv51 (Conv2D)                (None, 7, 7, 1024)   1049600     ['conv50[0][0]']                 
                                                                                                  
 add12 (Add)                    (None, 7, 7, 1024)   0           ['conv49[0][0]',                 
                                                                  'conv51[0][0]']                 
                                                                                                  
 bn34 (BatchNormalization)      (None, 7, 7, 1024)   4096        ['add12[0][0]']                  
                                                                                                  
 relu37 (Activation)            (None, 7, 7, 1024)   0           ['bn34[0][0]']                   
                                                                                                  
 conv52 (Conv2D)                (None, 7, 7, 512)    524800      ['relu37[0][0]']                 
                                                                                                  
 bn35 (BatchNormalization)      (None, 7, 7, 512)    2048        ['conv52[0][0]']                 
                                                                                                  
 relu38 (Activation)            (None, 7, 7, 512)    0           ['bn35[0][0]']                   
                                                                                                  
 pad12 (ZeroPadding2D)          (None, 9, 9, 512)    0           ['relu38[0][0]']                 
                                                                                                  
 conv53 (Conv2D)                (None, 7, 7, 512)    2359808     ['pad12[0][0]']                  
                                                                                                  
 bn36 (BatchNormalization)      (None, 7, 7, 512)    2048        ['conv53[0][0]']                 
                                                                                                  
 relu39 (Activation)            (None, 7, 7, 512)    0           ['bn36[0][0]']                   
                                                                                                  
 conv54 (Conv2D)                (None, 7, 7, 2048)   1050624     ['relu39[0][0]']                 
                                                                                                  
 conv55 (Conv2D)                (None, 7, 7, 2048)   2099200     ['add12[0][0]']                  
                                                                                                  
 add13 (Add)                    (None, 7, 7, 2048)   0           ['conv54[0][0]',                 
                                                                  'conv55[0][0]']                 
                                                                                                  
 bn37 (BatchNormalization)      (None, 7, 7, 2048)   8192        ['add13[0][0]']                  
                                                                                                  
 relu40 (Activation)            (None, 7, 7, 2048)   0           ['bn37[0][0]']                   
                                                                                                  
 conv56 (Conv2D)                (None, 7, 7, 512)    1049088     ['relu40[0][0]']                 
                                                                                                  
 bn38 (BatchNormalization)      (None, 7, 7, 512)    2048        ['conv56[0][0]']                 
                                                                                                  
 relu41 (Activation)            (None, 7, 7, 512)    0           ['bn38[0][0]']                   
                                                                                                  
 pad13 (ZeroPadding2D)          (None, 9, 9, 512)    0           ['relu41[0][0]']                 
                                                                                                  
 conv57 (Conv2D)                (None, 7, 7, 512)    2359808     ['pad13[0][0]']                  
                                                                                                  
 bn39 (BatchNormalization)      (None, 7, 7, 512)    2048        ['conv57[0][0]']                 
                                                                                                  
 relu42 (Activation)            (None, 7, 7, 512)    0           ['bn39[0][0]']                   
                                                                                                  
 conv58 (Conv2D)                (None, 7, 7, 2048)   1050624     ['relu42[0][0]']                 
                                                                                                  
 conv59 (Conv2D)                (None, 7, 7, 2048)   4196352     ['add13[0][0]']                  
                                                                                                  
 add14 (Add)                    (None, 7, 7, 2048)   0           ['conv58[0][0]',                 
                                                                  'conv59[0][0]']                 
                                                                                                  
 bn40 (BatchNormalization)      (None, 7, 7, 2048)   8192        ['add14[0][0]']                  
                                                                                                  
 relu43 (Activation)            (None, 7, 7, 2048)   0           ['bn40[0][0]']                   
                                                                                                  
 conv60 (Conv2D)                (None, 7, 7, 512)    1049088     ['relu43[0][0]']                 
                                                                                                  
 bn41 (BatchNormalization)      (None, 7, 7, 512)    2048        ['conv60[0][0]']                 
                                                                                                  
 relu44 (Activation)            (None, 7, 7, 512)    0           ['bn41[0][0]']                   
                                                                                                  
 pad14 (ZeroPadding2D)          (None, 9, 9, 512)    0           ['relu44[0][0]']                 
                                                                                                  
 conv61 (Conv2D)                (None, 7, 7, 512)    2359808     ['pad14[0][0]']                  
                                                                                                  
 bn42 (BatchNormalization)      (None, 7, 7, 512)    2048        ['conv61[0][0]']                 
                                                                                                  
 relu45 (Activation)            (None, 7, 7, 512)    0           ['bn42[0][0]']                   
                                                                                                  
 conv62 (Conv2D)                (None, 7, 7, 2048)   1050624     ['relu45[0][0]']                 
                                                                                                  
 conv63 (Conv2D)                (None, 7, 7, 2048)   4196352     ['add14[0][0]']                  
                                                                                                  
 add15 (Add)                    (None, 7, 7, 2048)   0           ['conv62[0][0]',                 
                                                                  'conv63[0][0]']                 
                                                                                                  
 bn43 (BatchNormalization)      (None, 7, 7, 2048)   8192        ['add15[0][0]']                  
                                                                                                  
 relu46 (Activation)            (None, 7, 7, 2048)   0           ['bn43[0][0]']                   
                                                                                                  
 global_average_pooling2d (Glob  (None, 2048)        0           ['relu46[0][0]']                 
 alAveragePooling2D)                                                                              
                                                                                                  
 flatten (Flatten)              (None, 2048)         0           ['global_average_pooling2d[0][0]'
                                                                 ]                                
                                                                                                  
 fc1000 (Dense)                 (None, 4)            8196        ['flatten[0][0]']                
                                                                                                  
==================================================================================================
Total params: 35,969,668
Trainable params: 35,927,172
Non-trainable params: 42,496
__________________________________________________________________________________________________

```

![image.png](https://i-blog.csdnimg.cn/img_convert/c523b8a5b3c1c568c66ed4ed4e4e50c6.png)

##### **ï¼ˆä¸‰ï¼‰æ€»ç»“**

ç»“æœä¸æ˜¯å¾ˆç†æƒ³ï¼Œç½‘ç»œç»“æ„åº”è¯¥è¿˜æœ‰ç‘•ç–µã€‚åç»­ä¼˜åŒ–ä»£ç è§£å†³æ‹Ÿåˆé—®é¢˜ã€‚
  
resnet50v2çš„è¯¦ç»†ç½‘ç»œç»“æ„ï¼š
  
![resnet50v2.png](https://i-blog.csdnimg.cn/img_convert/d063e7244b18f06da70c20fc22646e62.png)