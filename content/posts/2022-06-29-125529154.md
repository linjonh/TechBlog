---
layout: post
title: "接口差异测试Diffy工具"
date: 2022-06-29 21:22:13 +0800
description: "实践过，放心阅读。接口差异测试——Diffy工具_diffy"
keywords: "Diffy,自动化测试,开源框架"
categories: ['服务端测试']
tags: ['测试工具', '后端']
artid: "125529154"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=125529154
    alt: "接口差异测试Diffy工具"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=125529154
featuredImagePreview: https://bing.ee123.net/img/rand?artid=125529154
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     接口差异测试——Diffy工具
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h3>
     一、Diffy工作原理
    </h3>
    <p>
     <a class="has-card" href="https://blog.csdn.net/jinjiangongzuoshi/article/details/106799081/" title="测试利器 | 一款开源的Diffy自动化测试框架：超详细实战教程讲解_狂师vs的博客-CSDN博客">
      <span class="link-card-box">
       <span class="link-title">
        测试利器 | 一款开源的Diffy自动化测试框架：超详细实战教程讲解_狂师vs的博客-CSDN博客
       </span>
       <span class="link-link">
        <img alt="" class="link-link-icon" src="https://i-blog.csdnimg.cn/blog_migrate/27812982629cca34770ca5338c8019c0.png">
         https://blog.csdn.net/jinjiangongzuoshi/article/details/106799081/
        </img>
       </span>
      </span>
     </a>
    </p>
    <h3>
     二、Diffy使用
    </h3>
    <ol>
     <li>
      <h4>
       克隆源码：
      </h4>
      <pre><code>git clone https://github.com/twitter/diffy.git</code></pre>
      <img alt="" height="152" src="https://i-blog.csdnimg.cn/blog_migrate/85461d88fc4f7136a617b2a0268b5aae.png" width="567"/>
     </li>
     <li>
      <h4>
       构建diffy-server.jar，依次执行以下两条命令
      </h4>
      <pre><code>cd diffy

./sbt assembly</code></pre>
      <ol>
       <li>
       </li>
      </ol>
     </li>
     <li>
      <h4>
       启动diffy服务
      </h4>
      <ol>
       <li>
        <strong>
         http接口启动diffy命令
        </strong>
        <pre><code>java -jar diffy-server.jar -candidate=localhost:8080 -master.primary=localhost:8081 -master.secondary=localhost:8082 -service.protocol=http
-serviceName=My-Service -proxy.port=:8880 -admin.port=:8881 -http.port=:8888 -rootUrl='localhost:8888'</code></pre>
       </li>
       <li>
        <span style="color:#fe2c24;">
         <strong>
          https接口启动diffy命令（亲测可用，搞了很久）
         </strong>
        </span>
        <pre><code>java -jar diffy-server.jar -candidate=www.baidu.test -master.primary=www.baidu.com -master.secondary=www.baidu.com -service.protocol=https -serviceName=My-Service -proxy.port=:9990 -admin.port=:9991 -http.port=:8888 -rootUrl='localhost:8888' -summary.email='123456@qq.com' -summary.delay="5" -allowHttpSideEffects=true -excludeHttpHeadersComparison='true'</code></pre>
       </li>
       <li>
        <h4>
         参数说明
        </h4>
        <table border="1" cellpadding="1" cellspacing="1" style="width:500px;">
         <thead>
          <tr>
           <th style="width:274px;">
            参数
           </th>
           <th style="width:225px;">
            说明
           </th>
          </tr>
         </thead>
         <tbody>
          <tr>
           <td style="width:274px;">
            -candidate=www.baidu.test
           </td>
           <td style="width:225px;">
            <p>
             待上线版本的ip
             <span style="color:#fe2c24;">
              或域名
             </span>
             。
            </p>
            <p>
             假如百度测试环境的host为www.baidu.test
            </p>
           </td>
          </tr>
          <tr>
           <td style="width:274px;">
            -master.primary=www.baidu.com
           </td>
           <td style="width:225px;">
            已上线版本的ip1或域名1
           </td>
          </tr>
          <tr>
           <td style="width:274px;">
            -master.secondary=www.baidu.com
           </td>
           <td style="width:225px;">
            已上线版本的ip2或域名2
           </td>
          </tr>
          <tr>
           <td style="width:274px;">
            -service.protocol=https
           </td>
           <td style="width:225px;">
            http协议或https协议
           </td>
          </tr>
          <tr>
           <td style="width:274px;">
            -serviceName=My-Service
           </td>
           <td style="width:225px;">
            服务名称。任意写
           </td>
          </tr>
          <tr>
           <td style="width:274px;">
            -proxy.port=:9990
           </td>
           <td style="width:225px;">
            代理端口。所有请求应从这个端口访问。如:curl localhost:9990/search/1
           </td>
          </tr>
          <tr>
           <td style="width:274px;">
            -admin.port=:9991
           </td>
           <td style="width:225px;">
           </td>
          </tr>
          <tr>
           <td style="width:274px;">
            -http.port=:8888
           </td>
           <td style="width:225px;">
            diffy报告端口。localhost:8888
           </td>
          </tr>
          <tr>
           <td style="width:274px;">
            -rootUrl='localhost:8888'
           </td>
           <td style="width:225px;">
            同上
           </td>
          </tr>
          <tr>
           <td style="width:274px;">
            -summary.email='123456@qq.com'
           </td>
           <td style="width:225px;">
            报告邮件收件地址
           </td>
          </tr>
          <tr>
           <td style="width:274px;">
            -summary.delay="5"
           </td>
           <td style="width:225px;">
           </td>
          </tr>
          <tr>
           <td style="width:274px;">
            -allowHttpSideEffects=true
           </td>
           <td style="width:225px;">
            diffy考虑到安全性，post、put、delete请求默认忽略。设置为true可使这些类型请求仍能正常代理发送
           </td>
          </tr>
          <tr>
           <td style="width:274px;">
            -excludeHttpHeadersComparison='true'
           </td>
           <td style="width:225px;">
            是否排除header的差异。一般设置为true。不同服务的header有所差别，可忽略
           </td>
          </tr>
          <tr>
           <td style="width:274px;">
           </td>
           <td style="width:225px;">
           </td>
          </tr>
         </tbody>
        </table>
       </li>
       <li>
        <h4>
         <span style="color:#fe2c24;">
          踩坑说明！！
         </span>
         ！
        </h4>
        <ol>
         <li>
          responseMode=primary：有一些文章里写到参数包含responseMode，但是执行时会报错：。报错信息里提示并没有该参数，去掉这一项就不会报错。
         </li>
         <li>
          excludeHttpHeadersComparison=false：此参数执行时报错：。解决方法：给false加上双引号，即excludeHttpHeadersComparison="false"
         </li>
        </ol>
       </li>
      </ol>
     </li>
     <li>
      <h4>
       diffy报告
      </h4>
      <ol>
       <li>
        <a class="link-info" href="http://localhost:8888" rel="nofollow" title="localhost:8888">
         localhost:8888
        </a>
        ，浏览器访问该地址，即可查看diffy报告。
       </li>
       <li>
        报告示例
       </li>
      </ol>
     </li>
    </ol>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f33373531383431332f:61727469636c652f64657461696c732f313235353239313534" class_="artid" style="display:none">
 </p>
</div>


