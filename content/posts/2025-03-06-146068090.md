---
layout: post
title: "unity-console日志双击响应事件扩展"
date: 2025-03-06 13:57:11 +0800
description: "1 对于项目中一些比较长的日志，比如前后端交互协议具体数据等，这些日志内容可能会比较长，在unity控制面板上查看不是十分方便，我们可以对双击事件进行扩展，将日志保存到一个文本中，然后用系统默认的文本查看工具查看这个日志2 项目中如果用到了lua，当我们在控制台输出lua文件的时候，能不能双击日志用我们的代码编辑器软件打开日志输出位置。"
keywords: "监听unity日志窗口 双击日志事件"
categories: ['未分类']
tags: ['Unity', 'Junit', 'Java']
artid: "146068090"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146068090
    alt: "unity-console日志双击响应事件扩展"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146068090
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146068090
cover: https://bing.ee123.net/img/rand?artid=146068090
image: https://bing.ee123.net/img/rand?artid=146068090
img: https://bing.ee123.net/img/rand?artid=146068090
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     unity console日志双击响应事件扩展
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     1 对于项目中一些比较长的日志，比如前后端交互协议具体数据等，这些日志内容可能会比较长，在unity控制面板上查看不是十分方便，我们可以对双击事件进行扩展，将日志保存到一个文本中，然后用系统默认的文本查看工具查看这个日志
     <br/>
     2 项目中如果用到了lua，当我们在控制台输出lua文件的时候，能不能双击日志用我们的代码编辑器软件打开日志输出位置
    </p>
    <h4>
     <a id="console_2">
     </a>
     console日志双击然后用记事本打开显示
    </h4>
    <p>
     我们先用 OnOpenAsset 特性，重写双击回调方法，这个方法返回false，会继续执行系统默认日志双击打开方法，返回true则会中断。
     <br/>
     我们想要的效果是用记事本打开这个特殊日志，但是不需要跳转到对应的代码输出位置
     <br/>
     首先我们先在lua里面把日志输出方法重写一下，在日志输出的时候，添加一个标签 “”,当我们检测到双击的日志信息包含这个标签，则用记事本打开这一段日志（我们也可以把一些特殊的日志先在代码中缓存，在这个时候调用缓存读取那些特殊的日志进行输出显示）
    </p>
    <pre><code class="prism language-lua"><span class="token keyword">function</span> <span class="token function">printLongLog</span><span class="token punctuation">(</span>fmt<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> logText <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>fmt<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> debugInfo <span class="token operator">=</span> debug<span class="token punctuation">.</span><span class="token function">getinfo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> str <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s\n&lt;open in file&gt;"</span><span class="token punctuation">,</span> logText<span class="token punctuation">,</span> 
                    debugInfo<span class="token punctuation">.</span>short_src<span class="token punctuation">,</span> debugInfo<span class="token punctuation">.</span>currentline<span class="token punctuation">)</span>
                    
    <span class="token keyword">local</span> logMessage <span class="token operator">=</span> <span class="token function">concatStrs</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> debug<span class="token punctuation">.</span><span class="token function">traceback</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    UnityEngine<span class="token punctuation">.</span>Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>logMessage<span class="token punctuation">)</span>
<span class="token keyword">end</span>

</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a7c9e65dcfd241fa8873f0d96d9821a7.png"/>
    </p>
    <p>
     然后再C#代码中监听这一段日志
    </p>
    <pre><code class="prism language-csharp"> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">OnOpenAsset</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">OnAsset</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> instanceID<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> line<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">string</span></span> assetPath <span class="token operator">=</span> AssetDatabase<span class="token punctuation">.</span><span class="token function">GetAssetPath</span><span class="token punctuation">(</span>instanceID<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> fileExtension <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">GetExtension</span><span class="token punctuation">(</span>assetPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name"><span class="token keyword">string</span></span> stackTrace <span class="token operator">=</span> <span class="token function">GetStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>stackTrace<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>stackTrace<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">"&lt;open in file&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//对于一些比较长的日志，添加标签&lt;open in file&gt;，双击的时候再文本中打开</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">openLog</span><span class="token punctuation">(</span>stackTrace<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
         <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
</code></pre>
    <p>
     获取console里面的日志
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">var</span></span> consoleWindowType <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">EditorWindow</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token string">"UnityEditor.ConsoleWindow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> fieldInfo <span class="token operator">=</span> consoleWindowType<span class="token punctuation">.</span><span class="token function">GetField</span><span class="token punctuation">(</span><span class="token string">"ms_ConsoleWindow"</span><span class="token punctuation">,</span> BindingFlags<span class="token punctuation">.</span>Static <span class="token operator">|</span> BindingFlags<span class="token punctuation">.</span>NonPublic<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> consoleWindowInstance <span class="token operator">=</span> fieldInfo<span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> consoleWindowInstance <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">object</span><span class="token punctuation">)</span>EditorWindow<span class="token punctuation">.</span>focusedWindow <span class="token operator">==</span> consoleWindowInstance<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            fieldInfo <span class="token operator">=</span> consoleWindowType<span class="token punctuation">.</span><span class="token function">GetField</span><span class="token punctuation">(</span><span class="token string">"m_ActiveText"</span><span class="token punctuation">,</span> BindingFlags<span class="token punctuation">.</span>Instance <span class="token operator">|</span> BindingFlags<span class="token punctuation">.</span>NonPublic<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> activeText <span class="token operator">=</span> fieldInfo<span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span>consoleWindowInstance<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> activeText<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <p>
     用记事本打开日志文件，我们先把日志信息保存在本地，然后调用系统方法打开这个文件
     <br/>
     这里用到了一个方法
     <strong>
      System.Diagnostics.Process.Start(fileName)
     </strong>
     ,参数是文件的完整路径，调用系统默认方式打开改文件
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">openLog</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> stackTrace<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">string</span></span> fileName <span class="token operator">=</span> <span class="token function">GetFileSaveName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> saveDirPath <span class="token operator">=</span> Application<span class="token punctuation">.</span>dataPath <span class="token operator">+</span> <span class="token string">"/../Debug"</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>saveDirPath<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span>saveDirPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name"><span class="token keyword">string</span></span> savePath <span class="token operator">=</span> saveDirPath <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> fileName<span class="token punctuation">;</span>
        File<span class="token punctuation">.</span><span class="token function">WriteAllText</span><span class="token punctuation">(</span>savePath<span class="token punctuation">,</span> stackTrace<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>Process<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>savePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetFileSaveName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">DateTime</span> currentTime <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> customFormat <span class="token operator">=</span> currentTime<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"yyyy_MM_dd_HH_mm_ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> fileName <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"debug_</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">customFormat</span><span class="token punctuation">}</span></span><span class="token string">.txt"</span></span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> fileName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="lualua_86">
     </a>
     双击打开lua日志然后用lua编辑器定位到日志输出位置
    </h4>
    <p>
     对于lua输出的日志，我们为了便于打开可以用类似上面的方法重新封装一个lua日志输出方法，然后通关特殊标签的进行确定lua文件的名称和对应的行号。也可以进行拆分lua堆栈数据取到lua代码名称和对应堆栈。
     <br/>
     添加标签方式的lua日志输出
    </p>
    <pre><code class="prism language-lua"><span class="token keyword">function</span> <span class="token function">print</span><span class="token punctuation">(</span>fmt<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> logText <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>fmt<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> debugInfo <span class="token operator">=</span> debug<span class="token punctuation">.</span><span class="token function">getinfo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> str <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s\n&lt;filePath&gt;%s&lt;/filePath&gt;&lt;line&gt;%s&lt;/line&gt;"</span><span class="token punctuation">,</span> logText<span class="token punctuation">,</span> 
                    debugInfo<span class="token punctuation">.</span>short_src<span class="token punctuation">,</span> debugInfo<span class="token punctuation">.</span>currentline<span class="token punctuation">)</span>
                    
    <span class="token keyword">local</span> logMessage <span class="token operator">=</span> <span class="token function">concatStrs</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> debug<span class="token punctuation">.</span><span class="token function">traceback</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    UnityEngine<span class="token punctuation">.</span>Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>logMessage<span class="token punctuation">)</span>
<span class="token keyword">end</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2358d66f314e4653827ff2e07d3385af.png"/>
    </p>
    <p>
     获取文件名称和行号
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">OpenLua</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> logText<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//获取lua文件路径</span>
        <span class="token class-name">Regex</span> regex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Regex</span><span class="token punctuation">(</span><span class="token string">@"&lt;filePath&gt;.*&lt;\/filePath&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Match</span> match <span class="token operator">=</span> regex<span class="token punctuation">.</span><span class="token function">Match</span><span class="token punctuation">(</span>logText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>match<span class="token punctuation">.</span>Success<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name"><span class="token keyword">string</span></span> filePath <span class="token operator">=</span> match<span class="token punctuation">.</span>Groups<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> length <span class="token operator">=</span> filePath<span class="token punctuation">.</span>Length <span class="token operator">-</span> <span class="token number">10</span> <span class="token operator">-</span> <span class="token number">11</span><span class="token punctuation">;</span> <span class="token comment">//去掉开头和结尾的字符串 &lt;filePath&gt;  &lt;/filePath&gt;</span>
        filePath <span class="token operator">=</span> filePath<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        filePath <span class="token operator">=</span> filePath<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>filePath<span class="token punctuation">.</span><span class="token function">EndsWith</span><span class="token punctuation">(</span><span class="token string">".lua"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            filePath <span class="token operator">=</span> filePath <span class="token operator">+</span> <span class="token string">".lua"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">//获取日志行号</span>
        <span class="token class-name">Regex</span> lineRegex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Regex</span><span class="token punctuation">(</span><span class="token string">@"&lt;line&gt;.*&lt;\/line&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        match <span class="token operator">=</span> lineRegex<span class="token punctuation">.</span><span class="token function">Match</span><span class="token punctuation">(</span>logText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>match<span class="token punctuation">.</span>Success<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name"><span class="token keyword">string</span></span> luaLineString <span class="token operator">=</span> match<span class="token punctuation">.</span>Groups<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
        luaLineString<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        length <span class="token operator">=</span> luaLineString<span class="token punctuation">.</span>Length <span class="token operator">-</span> <span class="token number">6</span> <span class="token operator">-</span> <span class="token number">7</span><span class="token punctuation">;</span>
        luaLineString <span class="token operator">=</span> luaLineString<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> luaLine <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>luaLineString<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">OpenFileAtLineExternal</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> luaLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/5145a1d49d2748c9beb2053caacbe939.png"/>
    </p>
    <p>
     对于系统默认输出日志，我们通关拆分字符串方式获取
    </p>
    <pre><code class="prism language-csharp"> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">OpenLuaDefault</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> logText<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">int</span></span> index <span class="token operator">=</span> logText<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token string">"stack traceback:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> temp <span class="token operator">=</span> logText<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> logText<span class="token punctuation">.</span>Length <span class="token operator">-</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> arr <span class="token operator">=</span> temp<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token char">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span>Length <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name"><span class="token keyword">string</span></span> filePath <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> luaLine <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filePath <span class="token operator">=</span> filePath <span class="token operator">+</span> <span class="token string">".lua"</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">OpenFileAtLineExternal</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> luaLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <p>
     有了文件名和行号，我们就可以通关调用VScode或者Idea编辑器软件，打开对应的文件并定位到指定的行
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OpenFileWith</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> fileName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> line<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">string</span></span> editorPath <span class="token operator">=</span> EditorUserSettings<span class="token punctuation">.</span><span class="token function">GetConfigValue</span><span class="token punctuation">(</span>EXTERNAL_EDITOR_PATH_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>Process</span> proc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>Process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proc<span class="token punctuation">.</span>StartInfo<span class="token punctuation">.</span>FileName <span class="token operator">=</span> editorPath<span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> projectRootPath <span class="token operator">=</span> EditorUserSettings<span class="token punctuation">.</span><span class="token function">GetConfigValue</span><span class="token punctuation">(</span>LUA_PROJECT_ROOT_FOLDER_PATH_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>projectRootPath<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">SetLuaProjectRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name"><span class="token keyword">string</span></span> procArgument <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>editorPath<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token string">"idea"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//idea</span>
        <span class="token punctuation">{<!-- --></span>
            procArgument <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"{0} --line {1} {2}"</span><span class="token punctuation">,</span> projectRootPath<span class="token punctuation">,</span> line<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>editorPath<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token string">"Code.exe"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// VSCode</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">string</span></span> filePath <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>projectRootPath<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            procArgument <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"-g {0}:{1}:0"</span><span class="token punctuation">,</span> filePath<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            procArgument <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"{0}:{1}:0"</span><span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        proc<span class="token punctuation">.</span>StartInfo<span class="token punctuation">.</span>Arguments <span class="token operator">=</span> procArgument<span class="token punctuation">;</span>
        proc<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_195">
     </a>
     完整代码
    </h4>
    <p>
     lua 日志方法
    </p>
    <pre><code class="prism language-lua"><span class="token keyword">function</span> <span class="token function">print</span><span class="token punctuation">(</span>fmt<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> logText <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>fmt<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> debugInfo <span class="token operator">=</span> debug<span class="token punctuation">.</span><span class="token function">getinfo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> str <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s\n&lt;filePath&gt;%s&lt;/filePath&gt;&lt;line&gt;%s&lt;/line&gt;"</span><span class="token punctuation">,</span> logText<span class="token punctuation">,</span> 
                    debugInfo<span class="token punctuation">.</span>short_src<span class="token punctuation">,</span> debugInfo<span class="token punctuation">.</span>currentline<span class="token punctuation">)</span>
                    
    <span class="token keyword">local</span> logMessage <span class="token operator">=</span> <span class="token function">concatStrs</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> debug<span class="token punctuation">.</span><span class="token function">traceback</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    UnityEngine<span class="token punctuation">.</span>Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>logMessage<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">printLongLog</span><span class="token punctuation">(</span>fmt<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> logText <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>fmt<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> debugInfo <span class="token operator">=</span> debug<span class="token punctuation">.</span><span class="token function">getinfo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> str <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s\n&lt;open in file&gt;"</span><span class="token punctuation">,</span> logText<span class="token punctuation">,</span> 
                    debugInfo<span class="token punctuation">.</span>short_src<span class="token punctuation">,</span> debugInfo<span class="token punctuation">.</span>currentline<span class="token punctuation">)</span>
                    
    <span class="token keyword">local</span> logMessage <span class="token operator">=</span> <span class="token function">concatStrs</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> debug<span class="token punctuation">.</span><span class="token function">traceback</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    UnityEngine<span class="token punctuation">.</span>Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>logMessage<span class="token punctuation">)</span>
<span class="token keyword">end</span>
</code></pre>
    <p>
     C#方法
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Reflection</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>RegularExpressions</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEditor</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEditor<span class="token punctuation">.</span>Callbacks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsoleTools</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> EXTERNAL_EDITOR_PATH_KEY <span class="token operator">=</span> <span class="token string">"mTv8"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> LUA_PROJECT_ROOT_FOLDER_PATH_KEY <span class="token operator">=</span> <span class="token string">"obUd"</span><span class="token punctuation">;</span>
    
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">OnOpenAsset</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">OnAsset</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> instanceID<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> line<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">string</span></span> assetPath <span class="token operator">=</span> AssetDatabase<span class="token punctuation">.</span><span class="token function">GetAssetPath</span><span class="token punctuation">(</span>instanceID<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> fileExtension <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">GetExtension</span><span class="token punctuation">(</span>assetPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// string fileName = Path.GetFileNameWithoutExtension(assetPath);</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>fileExtension <span class="token operator">!=</span> <span class="token string">".cs"</span> <span class="token operator">&amp;&amp;</span> fileExtension <span class="token operator">!=</span> <span class="token string">".lua"</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>

        <span class="token class-name"><span class="token keyword">string</span></span> stackTrace <span class="token operator">=</span> <span class="token function">GetStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>stackTrace<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>stackTrace<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">"&lt;open in file&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//对于一些比较长的日志，添加标签&lt;open in file&gt;，双击的时候再文本中打开</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">openLog</span><span class="token punctuation">(</span>stackTrace<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        

        <span class="token keyword">if</span> <span class="token punctuation">(</span>stackTrace<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">"stack traceback:"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//lua输出堆栈信息，会自带 “"stack traceback:” 这描述，这里用来筛选lua日志</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">bool</span></span> isOpenSuccess <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>stackTrace<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">"&lt;filePath&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                isOpenSuccess <span class="token operator">=</span> <span class="token function">OpenLua</span><span class="token punctuation">(</span>stackTrace<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                isOpenSuccess <span class="token operator">=</span> <span class="token function">OpenLuaDefault</span><span class="token punctuation">(</span>stackTrace<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> isOpenSuccess<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 通关日志堆栈获取日志信息</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">var</span></span> consoleWindowType <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">EditorWindow</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token string">"UnityEditor.ConsoleWindow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> fieldInfo <span class="token operator">=</span> consoleWindowType<span class="token punctuation">.</span><span class="token function">GetField</span><span class="token punctuation">(</span><span class="token string">"ms_ConsoleWindow"</span><span class="token punctuation">,</span> BindingFlags<span class="token punctuation">.</span>Static <span class="token operator">|</span> BindingFlags<span class="token punctuation">.</span>NonPublic<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> consoleWindowInstance <span class="token operator">=</span> fieldInfo<span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> consoleWindowInstance <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">object</span><span class="token punctuation">)</span>EditorWindow<span class="token punctuation">.</span>focusedWindow <span class="token operator">==</span> consoleWindowInstance<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            fieldInfo <span class="token operator">=</span> consoleWindowType<span class="token punctuation">.</span><span class="token function">GetField</span><span class="token punctuation">(</span><span class="token string">"m_ActiveText"</span><span class="token punctuation">,</span> BindingFlags<span class="token punctuation">.</span>Instance <span class="token operator">|</span> BindingFlags<span class="token punctuation">.</span>NonPublic<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> activeText <span class="token operator">=</span> fieldInfo<span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span>consoleWindowInstance<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> activeText<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 以文件个格式打开日志</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;param name="stackTrace"&gt;&lt;/param&gt;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">openLog</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> stackTrace<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">string</span></span> fileName <span class="token operator">=</span> <span class="token function">GetFileSaveName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> saveDirPath <span class="token operator">=</span> Application<span class="token punctuation">.</span>dataPath <span class="token operator">+</span> <span class="token string">"/../Debug"</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>saveDirPath<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span>saveDirPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name"><span class="token keyword">string</span></span> savePath <span class="token operator">=</span> saveDirPath <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> fileName<span class="token punctuation">;</span>
        File<span class="token punctuation">.</span><span class="token function">WriteAllText</span><span class="token punctuation">(</span>savePath<span class="token punctuation">,</span> stackTrace<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>Process<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>savePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetFileSaveName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">DateTime</span> currentTime <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> customFormat <span class="token operator">=</span> currentTime<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"yyyy_MM_dd_HH_mm_ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> fileName <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"debug_</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">customFormat</span><span class="token punctuation">}</span></span><span class="token string">.txt"</span></span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> fileName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetExternalEditorPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">string</span></span> path <span class="token operator">=</span> EditorUserSettings<span class="token punctuation">.</span><span class="token function">GetConfigValue</span><span class="token punctuation">(</span>EXTERNAL_EDITOR_PATH_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        path <span class="token operator">=</span> EditorUtility<span class="token punctuation">.</span><span class="token function">OpenFilePanel</span><span class="token punctuation">(</span>
            <span class="token string">"设置lua文件默认打开的编辑器软件路径（选择exe文件）"</span><span class="token punctuation">,</span>
            path<span class="token punctuation">,</span>
            <span class="token string">"exe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            EditorUserSettings<span class="token punctuation">.</span><span class="token function">SetConfigValue</span><span class="token punctuation">(</span>EXTERNAL_EDITOR_PATH_KEY<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"Set Editor Path: "</span> <span class="token operator">+</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> 
    
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetLuaProjectRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">string</span></span> path <span class="token operator">=</span> EditorUserSettings<span class="token punctuation">.</span><span class="token function">GetConfigValue</span><span class="token punctuation">(</span>LUA_PROJECT_ROOT_FOLDER_PATH_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        path <span class="token operator">=</span> EditorUtility<span class="token punctuation">.</span><span class="token function">OpenFolderPanel</span><span class="token punctuation">(</span>
            <span class="token string">"设置lua项目根目录位置"</span><span class="token punctuation">,</span>
            path<span class="token punctuation">,</span>
            <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            EditorUserSettings<span class="token punctuation">.</span><span class="token function">SetConfigValue</span><span class="token punctuation">(</span>LUA_PROJECT_ROOT_FOLDER_PATH_KEY<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"Set Editor Path: "</span> <span class="token operator">+</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">OpenLua</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> logText<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//获取lua文件路径</span>
        <span class="token class-name">Regex</span> regex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Regex</span><span class="token punctuation">(</span><span class="token string">@"&lt;filePath&gt;.*&lt;\/filePath&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Match</span> match <span class="token operator">=</span> regex<span class="token punctuation">.</span><span class="token function">Match</span><span class="token punctuation">(</span>logText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>match<span class="token punctuation">.</span>Success<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name"><span class="token keyword">string</span></span> filePath <span class="token operator">=</span> match<span class="token punctuation">.</span>Groups<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> length <span class="token operator">=</span> filePath<span class="token punctuation">.</span>Length <span class="token operator">-</span> <span class="token number">10</span> <span class="token operator">-</span> <span class="token number">11</span><span class="token punctuation">;</span> <span class="token comment">//去掉开头和结尾的字符串 &lt;filePath&gt;  &lt;/filePath&gt;</span>
        filePath <span class="token operator">=</span> filePath<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        filePath <span class="token operator">=</span> filePath<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>filePath<span class="token punctuation">.</span><span class="token function">EndsWith</span><span class="token punctuation">(</span><span class="token string">".lua"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            filePath <span class="token operator">=</span> filePath <span class="token operator">+</span> <span class="token string">".lua"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">//获取日志行号</span>
        <span class="token class-name">Regex</span> lineRegex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Regex</span><span class="token punctuation">(</span><span class="token string">@"&lt;line&gt;.*&lt;\/line&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        match <span class="token operator">=</span> lineRegex<span class="token punctuation">.</span><span class="token function">Match</span><span class="token punctuation">(</span>logText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>match<span class="token punctuation">.</span>Success<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name"><span class="token keyword">string</span></span> luaLineString <span class="token operator">=</span> match<span class="token punctuation">.</span>Groups<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
        luaLineString<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        length <span class="token operator">=</span> luaLineString<span class="token punctuation">.</span>Length <span class="token operator">-</span> <span class="token number">6</span> <span class="token operator">-</span> <span class="token number">7</span><span class="token punctuation">;</span>
        luaLineString <span class="token operator">=</span> luaLineString<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> luaLine <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>luaLineString<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">OpenFileAtLineExternal</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> luaLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 打开没有标签的日志对应的脚本</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;param name="logText"&gt;&lt;/param&gt;</span>
    <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">OpenLuaDefault</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> logText<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">int</span></span> index <span class="token operator">=</span> logText<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token string">"stack traceback:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> temp <span class="token operator">=</span> logText<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> logText<span class="token punctuation">.</span>Length <span class="token operator">-</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> arr <span class="token operator">=</span> temp<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token char">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span>Length <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name"><span class="token keyword">string</span></span> filePath <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> luaLine <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filePath <span class="token operator">=</span> filePath <span class="token operator">+</span> <span class="token string">".lua"</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">OpenFileAtLineExternal</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> luaLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 打开指定的文件</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;param name="fileName"&gt;文件名&lt;/param&gt;</span>
    <span class="token comment">/// &lt;param name="line"&gt;行号&lt;/param&gt;</span>
    <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">OpenFileAtLineExternal</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> fileName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> line<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">string</span></span> editorPath <span class="token operator">=</span> EditorUserSettings<span class="token punctuation">.</span><span class="token function">GetConfigValue</span><span class="token punctuation">(</span>EXTERNAL_EDITOR_PATH_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>editorPath<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>File<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>editorPath<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>   <span class="token comment">// 没有path就弹出面板设置</span>
            <span class="token function">SetExternalEditorPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">OpenFileWith</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OpenFileWith</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> fileName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> line<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">string</span></span> editorPath <span class="token operator">=</span> EditorUserSettings<span class="token punctuation">.</span><span class="token function">GetConfigValue</span><span class="token punctuation">(</span>EXTERNAL_EDITOR_PATH_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>Process</span> proc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>Process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proc<span class="token punctuation">.</span>StartInfo<span class="token punctuation">.</span>FileName <span class="token operator">=</span> editorPath<span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> projectRootPath <span class="token operator">=</span> EditorUserSettings<span class="token punctuation">.</span><span class="token function">GetConfigValue</span><span class="token punctuation">(</span>LUA_PROJECT_ROOT_FOLDER_PATH_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>projectRootPath<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">SetLuaProjectRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name"><span class="token keyword">string</span></span> procArgument <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>editorPath<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token string">"idea"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//idea</span>
        <span class="token punctuation">{<!-- --></span>
            procArgument <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"{0} --line {1} {2}"</span><span class="token punctuation">,</span> projectRootPath<span class="token punctuation">,</span> line<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>editorPath<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token string">"Code.exe"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// VSCode</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">string</span></span> filePath <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>projectRootPath<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            procArgument <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"-g {0}:{1}:0"</span><span class="token punctuation">,</span> filePath<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            procArgument <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"{0}:{1}:0"</span><span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        proc<span class="token punctuation">.</span>StartInfo<span class="token punctuation">.</span>Arguments <span class="token operator">=</span> procArgument<span class="token punctuation">;</span>
        proc<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
     
    
    
<span class="token punctuation">}</span>

</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031313438343031332f:61727469636c652f64657461696c732f313436303638303930" class_="artid" style="display:none">
 </p>
</div>


