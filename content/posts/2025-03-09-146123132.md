---
layout: post
title: "NFS实验"
date: 2025-03-09 14:13:53 +0800
description: "要设置NFS共享，需要至少两台 Linux/Unix 机器。下面使用两台服务器来演示 NFS 安装、配置及使用。"
keywords: "NFS实验"
categories: ['高级运维']
tags: ['云原生', 'Nfs', 'Linux']
artid: "146123132"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146123132
    alt: "NFS实验"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146123132
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146123132
cover: https://bing.ee123.net/img/rand?artid=146123132
image: https://bing.ee123.net/img/rand?artid=146123132
img: https://bing.ee123.net/img/rand?artid=146123132
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     NFS实验
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="1NFS_0">
     </a>
     1.NFS
    </h2>
    <h3>
     <a id="11__1">
     </a>
     1.1 案例
    </h3>
    <p>
     要设置NFS共享，需要至少两台 Linux/Unix 机器。下面使用两台服务器来演示 NFS 安装、配置及使用。
    </p>
    <table>
     <thead>
      <tr>
       <th>
        角色
       </th>
       <th>
        IP
       </th>
       <th>
        主机名
       </th>
       <th>
        系统
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        服务器
       </td>
       <td>
        192.168.88.113
       </td>
       <td>
        nfs-server
       </td>
       <td>
        RHEL9
       </td>
      </tr>
      <tr>
       <td>
        服务器
       </td>
       <td>
        192.168.88.114
       </td>
       <td>
        nfs-client
       </td>
       <td>
        RHEL9
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="12__8">
     </a>
     1.2 实现
    </h3>
    <h4>
     <a id="121__9">
     </a>
     1.2.1 克隆两台服务器
    </h4>
    <p>
     服务器端和客户端按照同样步骤克隆，只需要修改名字和存放位置即可
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/0f4cd7b59d414b3b845d54cb1ae0fad7.png">
      <br/>
      单击右键（红色框位置）→ 选择管理 → 克隆
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c3b230565b1442d982763473797bd547.png">
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8ab8a1a3d9de466ebdcb5d0fa29689c8.png">
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/dbe7bcc4893d4aa6b55dbbe137834cc7.png">
         <br/>
         <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a85999ef9352462bb7f9ca88f87a6327.png">
          <br/>
          修改名字和位置，点击完成即可
         </img>
        </img>
       </img>
      </img>
     </img>
    </p>
    <h4>
     <a id="122__18">
     </a>
     1.2.2 配置仓库
    </h4>
    <blockquote>
     <p>
      两台虚拟机中都要执行
     </p>
    </blockquote>
    <p>
     在nfs-server虚拟机上配置好本地仓库
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/yum.repos.d/dnf.repo</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/yum.repos.d/dnf.repo </span>
<span class="token punctuation">[</span>BaseOS<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>BaseOS
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>/mnt/BaseOS
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">[</span>AppStream<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>AppStream
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>/mnt/AppStream
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>

root@localhost ~<span class="token punctuation">]</span><span class="token comment"># yum repolist</span>
<span class="token comment">#用于显示已配置的 yum 软件仓库及其状态。</span>
<span class="token comment">#Repo-id: 仓库的唯一标识符。</span>
<span class="token comment">#Repo-name: 仓库的名称，通常比ID更具描述性。</span>
<span class="token comment">#Status: 表示仓库的状态，通常是启用(Enabled)或禁用(Disabled)。</span>
Updating Subscription Management repositories.
Unable to <span class="token builtin class-name">read</span> consumer identity

This system is not registered with an entitlement server. You can use <span class="token string">"rhc"</span> or <span class="token string">"subscription-manager"</span> to register.

repo <span class="token function">id</span>                                            repo name
AppStream                                          AppStream
BaseOS                                             BaseOS

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mount /dev/sr0 /mnt</span>
mount: /mnt: WARNING: <span class="token builtin class-name">source</span> write-protected, mounted read-only.
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ls /mnt</span>
AppStream  EULA              images      RPM-GPG-KEY-redhat-beta
BaseOS     extra_files.json  isolinux    RPM-GPG-KEY-redhat-release
EFI        GPL               media.repo

</code></pre>
    <p>
     然后将这个仓库复制到nfs-client虚拟机中
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># scp /etc/yum.repos.d/dnf.repo root@192.168.88.135:/etc/yum.repos.d/</span>
<span class="token comment"># scp: 发起安全复制请求的命令，基于SSH协议实现文件的安全传输。</span>
<span class="token comment"># /etc/yum.repos.d/dnf.repo: 这是要复制的源文件路径。在这个例子中，是从本地机器上的 /etc/yum.repos.d/ 目录复制名为 dnf.repo 的文件。</span>
<span class="token comment"># root@192.168.88.135: 指定目标主机的信息。</span>
<span class="token comment"># :/etc/yum.repos.d/: 这是目标路径，表示将文件复制到远程服务器上的 /etc/yum.repos.d/ 目录下。</span>

The authenticity of <span class="token function">host</span> <span class="token string">'192.168.88.135 (192.168.88.135)'</span> can<span class="token string">'t be established.
ED25519 key fingerprint is SHA256:Rp6b3SoxbEe3x+BcVICF5OXozv2NHqCe6x1Y5ma+r5k.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? y
Please type '</span><span class="token function">yes</span><span class="token string">', '</span>no<span class="token string">' or the fingerprint: yes
Warning: Permanently added '</span><span class="token number">192.168</span>.88.135<span class="token string">' (ED25519) to the list of known hosts.
root@192.168.88.135'</span>s password: 
dnf.repo                                                  <span class="token number">100</span>%  <span class="token number">113</span>    <span class="token number">41</span>.7KB/s   00:00   
</code></pre>
    <h4>
     <a id="123__78">
     </a>
     1.2.3 安装基本软件且设置主机名
    </h4>
    <blockquote>
     <p>
      两台系统都要执行
     </p>
    </blockquote>
    <p>
     选择查看 → 撰写 → 撰写栏，就可以在撰写栏中输入指令在两台虚拟机中同时执行
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9d46fa784ebb49e2834825b921328dd9.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/de26331f1ea54f9389cab31c21b325e4.png">
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/963252d53e504a6a999aab81236e6a6e.png"/>
      </img>
     </img>
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#  dnf install net-tools wget curl bash-completion vim -y</span>

</code></pre>
    <p>
     设置主机名，一台为nfs-server，另一台为nfs-client
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl hostname nfs-server</span>
</code></pre>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl hostname nfs-client</span>
</code></pre>
    <h4>
     <a id="124_ip_100">
     </a>
     1.2.4 设置ip
    </h4>
    <blockquote>
     <p>
      两台虚拟机都要执行，注意ip段要是自己的比如我的是88
     </p>
    </blockquote>
    <pre><code class="prism language-bash"><span class="token comment"># 配置服务器IP</span>
<span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># nmcli c modify ens160 ipv4.method manual ipv4.address 192.168.88.113/24 ipv4.dns 223.5.5.5 ipv4.gateway 192.168.88.2 connection.autoconnect yes</span>

<span class="token comment"># nmcli c modify ens160:c 是 connection 的缩写，表示您将要对一个网络连接进行操作。modify ens160 表示您希望修改名称或ID为 ens160 的网络连接配置。</span>
<span class="token comment"># ipv4.method manual:设置IPv4的配置方法为手动（manual），</span>
<span class="token comment"># ipv4.address 192.168.88.113/24:指定静态IPv4地址为 192.168.88.113，子网掩码为 /24（即255.255.255.0）。这意味着它位于192.168.88.0这个子网内。</span>
<span class="token comment"># ipv4.dns 223.5.5.5:配置首选DNS服务器的地址为 223.5.5.5。这是一个公共DNS服务地址，由阿里云提供，用于域名解析。选择这个DNS服务器是因为它能够提供稳定且快速的域名解析服务。</span>
<span class="token comment"># ipv4.gateway 192.168.88.2:设置默认网关的IP地址为 192.168.88.2。</span>
<span class="token comment"># connection.autoconnect yes:设置此连接在系统启动时自动连接，确保在网络服务启动时该网络接口能自动获取配置并连接到网络。</span>
<span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># nmcli c up ens160 #使用该命令连接端会断掉，需要重新连接</span>
<span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># ip a</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span> 
       valid_lft forever preferred_lft forever
<span class="token number">2</span>: ens160: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc mq state UP group default qlen <span class="token number">1000</span>
    link/ether 00:0c:29:37:20:d0 brd ff:ff:ff:ff:ff:ff
    altname enp3s0
    inet <span class="token number">192.168</span>.88.113/24 brd <span class="token number">192.168</span>.88.255 scope global noprefixroute ens160
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fe37:20d0/64 scope <span class="token function">link</span> noprefixroute 
       valid_lft forever preferred_lft forever


<span class="token comment"># 配置客户端IP</span>
<span class="token punctuation">[</span>root@nfs-client ~<span class="token punctuation">]</span><span class="token comment"># nmcli c modify ens160 ipv4.method manual ipv4.address 192.168.88.114/24 ipv4.dns 223.5.5.5 ipv4.gateway 192.168.88.2 connection.autoconnect yes</span>
<span class="token punctuation">[</span>root@nfs-client ~<span class="token punctuation">]</span><span class="token comment"># nmcli c up ens160</span>

</code></pre>
    <h4>
     <a id="125_nfs_135">
     </a>
     1.2.5 安装nfs服务
    </h4>
    <blockquote>
     <p>
      在两台系统中都要执行。
      <br/>
      要重新挂载
     </p>
    </blockquote>
    <pre><code class="prism language-bash"> <span class="token function">mount</span> /dev/sr0 /mnt
 dnf <span class="token function">install</span> nfs-utils <span class="token parameter variable">-y</span>
</code></pre>
    <h4>
     <a id="126__144">
     </a>
     1.2.6 启动服务
    </h4>
    <blockquote>
     <p>
      在两台系统中都要执行。
     </p>
    </blockquote>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable --now nfs-server</span>
Created symlink /etc/systemd/system/multi-user.target.wants/nfs-server.service → /usr/lib/systemd/system/nfs-server.service.

<span class="token comment">#查看服务是否启动成功</span>
<span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># systemctl status nfs-server</span>
● nfs-server.service - NFS server and services
     Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/nfs-server.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> preset: disabled<span class="token punctuation">)</span>
     Active: active <span class="token punctuation">(</span>exited<span class="token punctuation">)</span> since Sun <span class="token number">2025</span>-03-09 <span class="token number">11</span>:46:47 CST<span class="token punctuation">;</span> 2min 13s ago
       Docs: man:rpc.nfsd<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
             man:exportfs<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
    Process: <span class="token number">14283</span> <span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>/usr/sbin/exportfs <span class="token parameter variable">-r</span> <span class="token punctuation">(</span>code<span class="token operator">=</span>exited, <span class="token assign-left variable">status</span><span class="token operator">=</span><span class="token number">0</span>/SUCCESS<span class="token punctuation">)</span>
    Process: <span class="token number">14284</span> <span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/sbin/rpc.nfsd <span class="token punctuation">(</span>code<span class="token operator">=</span>exited, <span class="token assign-left variable">status</span><span class="token operator">=</span><span class="token number">0</span>/SUCCESS<span class="token punctuation">)</span>
    Process: <span class="token number">14303</span> <span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/bin/sh <span class="token parameter variable">-c</span> <span class="token keyword">if</span> systemctl <span class="token parameter variable">-q</span> is-active gssproxy<span class="token punctuation">;</span> <span class="token keyword">then</span> systemctl reload <span class="token operator">&gt;</span>
   Main PID: <span class="token number">14303</span> <span class="token punctuation">(</span>code<span class="token operator">=</span>exited, <span class="token assign-left variable">status</span><span class="token operator">=</span><span class="token number">0</span>/SUCCESS<span class="token punctuation">)</span>
        CPU: 41ms

Mar 09 <span class="token number">11</span>:46:47 nfs-server systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Starting NFS server and services<span class="token punctuation">..</span>.
Mar 09 <span class="token number">11</span>:46:47 nfs-server systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Finished NFS server and services.

<span class="token comment"># 查看端口</span>
<span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># netstat -lntup | grep 2049 </span>
<span class="token comment">#或者ss -lntup | grep 2049</span>
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:2049            <span class="token number">0.0</span>.0.0:*               LISTEN      -                   
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::2049                 :::*                    LISTEN      -                   
<span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># netstat -lntup | grep 111</span>
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:111             <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">1</span>/systemd           
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::111                  :::*                    LISTEN      <span class="token number">1</span>/systemd           
udp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:111             <span class="token number">0.0</span>.0.0:*                           <span class="token number">1</span>/systemd           
udp6       <span class="token number">0</span>      <span class="token number">0</span> :::111                  :::*                                <span class="token number">1</span>/systemd  

<span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># ps -ef |grep nfs</span>
<span class="token comment"># 用于显示与 NFS（网络文件系统）相关的进程信息</span>
root         <span class="token number">856</span>       <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">11</span>:52 ?        00:00:00 /usr/sbin/nfsdcld
root        <span class="token number">1255</span>       <span class="token number">2</span>  <span class="token number">0</span> <span class="token number">11</span>:52 ?        00:00:00 <span class="token punctuation">[</span>nfsd<span class="token punctuation">]</span>
root        <span class="token number">1256</span>       <span class="token number">2</span>  <span class="token number">0</span> <span class="token number">11</span>:52 ?        00:00:00 <span class="token punctuation">[</span>nfsd<span class="token punctuation">]</span>
root        <span class="token number">1257</span>       <span class="token number">2</span>  <span class="token number">0</span> <span class="token number">11</span>:52 ?        00:00:00 <span class="token punctuation">[</span>nfsd<span class="token punctuation">]</span>
root        <span class="token number">1258</span>       <span class="token number">2</span>  <span class="token number">0</span> <span class="token number">11</span>:52 ?        00:00:00 <span class="token punctuation">[</span>nfsd<span class="token punctuation">]</span>
root        <span class="token number">1259</span>       <span class="token number">2</span>  <span class="token number">0</span> <span class="token number">11</span>:52 ?        00:00:00 <span class="token punctuation">[</span>nfsd<span class="token punctuation">]</span>
root        <span class="token number">1260</span>       <span class="token number">2</span>  <span class="token number">0</span> <span class="token number">11</span>:52 ?        00:00:00 <span class="token punctuation">[</span>nfsd<span class="token punctuation">]</span>
root        <span class="token number">1261</span>       <span class="token number">2</span>  <span class="token number">0</span> <span class="token number">11</span>:52 ?        00:00:00 <span class="token punctuation">[</span>nfsd<span class="token punctuation">]</span>
root        <span class="token number">1262</span>       <span class="token number">2</span>  <span class="token number">0</span> <span class="token number">11</span>:52 ?        00:00:00 <span class="token punctuation">[</span>nfsd<span class="token punctuation">]</span>
root        <span class="token number">1598</span>    <span class="token number">1542</span>  <span class="token number">0</span> <span class="token number">12</span>:18 pts/0    00:00:00 <span class="token function">grep</span> <span class="token parameter variable">--color</span><span class="token operator">=</span>auto nfs

</code></pre>
    <h4>
     <a id="127__191">
     </a>
     1.2.7 放行防火墙
    </h4>
    <blockquote>
     <p>
      在两台系统中都要执行。
     </p>
    </blockquote>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --permanent --add-service=nfs</span>
success
<span class="token comment">#通过firewall-cmd工具向防火墙规则中永久添加NFS（Network File System，网络文件系统）服务。</span>
<span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --reload</span>
success
<span class="token comment">#重新加载防火墙配置的命令，使更改生效。</span>


<span class="token punctuation">[</span>root@nfs-client ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --permanent --add-service=nfs</span>
success
<span class="token punctuation">[</span>root@nfs-client ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --reload</span>
success
</code></pre>
    <p>
     验证是否放行成功firewall-cmd --list-all
    </p>
    <pre><code class="prism language-bash"><span class="token comment">#未加载防火墙之前</span>
<span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --list-all#显示当前防火墙配置详细信息</span>
public <span class="token punctuation">(</span>active<span class="token punctuation">)</span>
  target: default
  icmp-block-inversion: no
  interfaces: ens160
  sources: 
  services: cockpit dhcpv6-client <span class="token function">ssh</span>
  ports: 
  protocols: 
  forward: <span class="token function">yes</span>
  masquerade: no
  forward-ports: 
  source-ports: 
  icmp-blocks: 
  rich rules: 

<span class="token comment">#加载防火墙之后，在services栏多出了nfs</span>
<span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --list-all</span>
public <span class="token punctuation">(</span>active<span class="token punctuation">)</span>
  target: default
  icmp-block-inversion: no
  interfaces: ens160
  sources: 
  services: cockpit dhcpv6-client nfs <span class="token function">ssh</span>
  ports: 
  protocols: 
  forward: <span class="token function">yes</span>
  masquerade: no
  forward-ports: 
  source-ports: 
  icmp-blocks: 
  rich rules: 

</code></pre>
    <h4>
     <a id="128_Selinux_246">
     </a>
     1.2.8 关闭Selinux
    </h4>
    <blockquote>
     <p>
      在两台系统中都要执行。
     </p>
    </blockquote>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># getenforce</span>
Enforcing
<span class="token comment">#查询当前 SELinux 的运行模式。输出结果可能是 Enforcing, Permissive, 或者 Disabled，分别表示 SELinux 正在强制执行安全策略、仅记录违反行为而不阻止它们、或者SELinux 完全未启用。</span>
<span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># setenforce 0#临时有效，重启后无效</span>
<span class="token comment">#参数 0 表示将 SELinux 设置为 Permissive 模式，在 Permissive 模式下，SELinux 不会阻止任何行为，但会记录所有违反其策略的行为。</span>
<span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># getenforce</span>
Permissive

</code></pre>
    <p>
     未避免重启服务之后无效，要在/etc/selinux/config文件中修改，如下图所示：
    </p>
    <pre><code class="prism language-bash"><span class="token comment">#服务器端</span>
<span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/selinux/config</span>
<span class="token comment">#客户端</span>
<span class="token punctuation">[</span>root@nfs-client ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/selinux/config</span>

</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8cd4c96986f949eaac68a381c8e4adb0.png"/>
    </p>
    <h4>
     <a id="129_NFS_270">
     </a>
     1.2.9 配置NFS
    </h4>
    <p>
     <strong>
      在NFS服务端完成。
     </strong>
     <br/>
     1、首先创建一个用于存储文件目录
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># mkdir /nfs/data -p</span>
</code></pre>
    <p>
     2、将这个目录共享给客户端，编写 /etc/exports 文件，在文件中做如下的配置。
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/exports</span>
<span class="token comment"># vim 编辑器打开了位于 /etc/ 目录下的 exports 文件。这个文件用于定义哪些目录可以通过 NFS 共享给其他机器以及设置相关的共享选项。</span>
<span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/exports</span>
/nfs/data <span class="token number">192.168</span>.88.114<span class="token punctuation">(</span>rw<span class="token punctuation">)</span>
<span class="token comment">#/nfs/data: 这是要通过 NFS 共享的目录路径。在这个例子中，服务器上的 /nfs/data 目录将被共享。</span>
<span class="token comment">#192.168.88.114: 这是允许访问 NFS 共享资源的客户端的 IP 地址。只有来自这个 IP 地址的请求才会被允许访问共享的目录。</span>
<span class="token comment">#rw 表示读写权限，意味着指定的客户端既可以读取也可以写入共享目录的数据</span>
</code></pre>
    <p>
     3、暴露共享服务
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 配置好后，重启服务</span>
<span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart nfs-server</span>
<span class="token comment"># 然后暴露共享服务</span>
<span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># showmount -e 192.168.88.113</span>
Export list <span class="token keyword">for</span> <span class="token number">192.168</span>.88.113:
/nfs/data <span class="token number">192.168</span>.88.114
</code></pre>
    <p>
     <strong>
      在客户端完成。
     </strong>
     <br/>
     1、创建挂载目录
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs-client ~<span class="token punctuation">]</span><span class="token comment"># mkdir /data/nfs -p</span>

</code></pre>
    <p>
     2、将创建的目录挂载到服务端的共享目录
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs-client ~<span class="token punctuation">]</span><span class="token comment">#  mount -t nfs 192.168.88.113:/nfs/data /data/nfs</span>
<span class="token comment"># mount: 这是 Linux 系统中用于挂载文件系统的命令。</span>
<span class="token comment"># -t nfs: 这个选项指定了要挂载的文件系统的类型，在这里是指 NFS（Network File System）。它告诉 mount 命令接下来的参数将涉及 NFS 类型的挂载。</span>
<span class="token comment"># 192.168.88.113:/nfs/data: 这部分指定了 NFS 服务器的 IP 地址和需要挂载的共享目录路径。在这个例子中，192.168.88.113 是 NFS 服务器的地址，/nfs/data 是该服务器上已配置为可共享的目录。</span>
<span class="token comment"># /data/nfs: 这是本地客户端系统上的一个目录路径，作为挂载点。通过执行这条命令，NFS 服务器上的 /nfs/data 目录将会被挂载到这个位置，使得客户端可以通过访问 /data/nfs 来读取或写入 NFS 服务器上的数据。</span>
</code></pre>
    <p>
     3、查看是否挂载成功
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs-client ~<span class="token punctuation">]</span><span class="token comment"># df /data/nfs</span>
Filesystem               1K-blocks    Used Available Use% Mounted on
<span class="token number">192.168</span>.88.113:/nfs/data  <span class="token number">46587904</span> <span class="token number">1755648</span>  <span class="token number">44832256</span>   <span class="token number">4</span>% /data/nfs
<span class="token comment"># 命令用于显示文件系统的磁盘空间使用情况，特别是针对挂载在 /data/nfs 路径下的文件系统。</span>

</code></pre>
    <h4>
     <a id="1210__325">
     </a>
     1.2.10 功能测试
    </h4>
    <h5>
     <a id="12101__326">
     </a>
     1.2.10.1 测试客户端读
    </h5>
    <pre><code class="prism language-bash">在服务器端建立1.txt
<span class="token punctuation">[</span>root@nfs-server ~<span class="token punctuation">]</span><span class="token comment"># cd /nfs/data/</span>
<span class="token punctuation">[</span>root@nfs-server data<span class="token punctuation">]</span><span class="token comment"># ls</span>
<span class="token punctuation">[</span>root@nfs-server data<span class="token punctuation">]</span><span class="token comment"># touch 1.txt</span>
在客户端查看是否有1.txt，且有无内容
<span class="token punctuation">[</span>root@nfs-client ~<span class="token punctuation">]</span><span class="token comment"># ls /data/nfs/</span>
<span class="token number">1</span>.txt
<span class="token punctuation">[</span>root@nfs-client ~<span class="token punctuation">]</span><span class="token comment"># cat /data/nfs/1.txt</span>

在服务器端输入内容
<span class="token punctuation">[</span>root@nfs-server data<span class="token punctuation">]</span><span class="token comment"># echo 1.txt &gt; 1.txt</span>
在客户端查看
<span class="token punctuation">[</span>root@nfs-client ~<span class="token punctuation">]</span><span class="token comment"># cat /data/nfs/1.txt</span>
<span class="token number">1</span>.txt

</code></pre>
    <h5>
     <a id="12102__344">
     </a>
     1.2.10.2 测试客户端写
    </h5>
    <pre><code class="prism language-bash">客户端写入晚上好
<span class="token punctuation">[</span>root@nfs-client ~<span class="token punctuation">]</span><span class="token comment"># echo  good night &gt; /data/nfs/nihao.txt</span>
-bash: /data/nfs/nihao.txt: Permission denied

</code></pre>
    <ul>
     <li>
      <p>
       问题：我们在客户端写数据时，提示没有权限。如何解决呢？
      </p>
     </li>
     <li>
      <ul>
       <li>
        我们需要给服务端的共享目录设置权限。
       </li>
      </ul>
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs-server /<span class="token punctuation">]</span><span class="token comment"># chmod o+rw /nfs -R</span>
<span class="token comment"># -R这个选项表示递归地应用更改，即不仅改变指定目录本身的权限，还会对目录下的所有文件和子目录进行同样的权限修改。</span>
<span class="token punctuation">[</span>root@nfs-server data<span class="token punctuation">]</span><span class="token comment"># cd /</span>
<span class="token punctuation">[</span>root@nfs-server /<span class="token punctuation">]</span><span class="token comment"># cd /nfs</span>
<span class="token punctuation">[</span>root@nfs-server nfs<span class="token punctuation">]</span><span class="token comment"># ll -d /nfs</span>
drwxr-xrwx. <span class="token number">3</span> root root <span class="token number">18</span> Mar  <span class="token number">9</span> <span class="token number">12</span>:45 /nfs
三个为一组 rwx：所属用户的权限（有读、写和执行（搜索）权限）；r-w：所属用户组的权限（拥有读和执行权限，但没有写权限），rwx：其他用户权限
</code></pre>
    <p>
     在服务端设置好权限后，再在客户端执行如下的代码：
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs-client ~<span class="token punctuation">]</span><span class="token comment"># echo good night &gt; /data/nfs/nihao.txt</span>
</code></pre>
    <p>
     然后在服务端查看：
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs-server /<span class="token punctuation">]</span><span class="token comment"># cd /nfs/data</span>
<span class="token punctuation">[</span>root@nfs-server data<span class="token punctuation">]</span><span class="token comment"># ls</span>
<span class="token number">1</span>.txt  nihao.txt

</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f747431393132333635373138382f:61727469636c652f64657461696c732f313436313233313332" class_="artid" style="display:none">
 </p>
</div>


