---
arturl_encode: "68747470733a2f2f626c6f:672e6373646e2e6e65742f323330325f37373432363533332f:61727469636c652f64657461696c732f313436303738373234"
layout: post
title: "JVMå­¦ä¹ -ç±»æ–‡ä»¶ç»“æ„-ç±»åŠ è½½"
date: 2025-03-11 08:00:00 +0800
description: "ä½¿ç”¨åœºæ™¯æƒ³åŠ è½½é classpath éšæ„è·¯å¾„ä¸­çš„ç±»æ–‡ä»¶é€šè¿‡æ¥å£æ¥ä½¿ç”¨å®ç°ï¼Œå¸Œæœ›è§£è€¦æ—¶ï¼Œå¸¸ç”¨åœ¨æ¡†æ¶è®¾è®¡è¿™äº›ç±»å¸Œæœ›äºˆä»¥éš”ç¦»ï¼Œä¸åŒåº”ç”¨çš„åŒåç±»éƒ½å¯ä»¥åŠ è½½ï¼Œä¸å†²çªï¼Œå¸¸è§äº tomcat å®¹å™¨æ­¥éª¤ç»§æ‰¿ ClassLoader çˆ¶ç±»è¦éµä»åŒäº²å§”æ´¾æœºåˆ¶ï¼Œé‡å†™ ï¬ndClass æ–¹æ³•ä¸æ˜¯é‡å†™ loadClass æ–¹æ³•ï¼Œå¦åˆ™ä¸ä¼šèµ°åŒäº²å§”æ´¾æœºåˆ¶è¯»å–ç±»æ–‡ä»¶çš„å­—èŠ‚ç è°ƒç”¨çˆ¶ç±»çš„ deï¬neClass æ–¹æ³•æ¥åŠ è½½ç±»ä½¿ç”¨è€…è°ƒç”¨è¯¥ç±»åŠ è½½å™¨çš„ loadClass æ–¹æ³•ç ´ååŒäº²å§”æ´¾æ¨¡å¼ã€‚"
keywords: "JVMå­¦ä¹ -ç±»æ–‡ä»¶ç»“æ„ ç±»åŠ è½½"
categories: ['æœªåˆ†ç±»']
tags: ['å­¦ä¹ ', 'åç«¯', 'Jvm', 'Java']
artid: "146078724"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146078724
    alt: "JVMå­¦ä¹ -ç±»æ–‡ä»¶ç»“æ„-ç±»åŠ è½½"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146078724
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146078724
cover: https://bing.ee123.net/img/rand?artid=146078724
image: https://bing.ee123.net/img/rand?artid=146078724
img: https://bing.ee123.net/img/rand?artid=146078724
---

# JVMå­¦ä¹ -ç±»æ–‡ä»¶ç»“æ„ ç±»åŠ è½½

ç±»åŠ è½½å’Œå­—èŠ‚ç æŠ€æœ¯

![](https://i-blog.csdnimg.cn/direct/4f39eba4bf23446aa0152db3f139de90.png)

## ä¸€.ç±»æ–‡ä»¶ç»“æ„

#### ç¤ºä¾‹:

ä¸€ä¸ªç®€å•çš„ HelloWorld.java

`package cn.itcast.jvm.t5;

// HelloWorld ç¤ºä¾‹

public class HelloWorld {

public static void main(String[] args) {

System.out.println("hello world");

}

}`

* æ‰§è¡Œ javac -parameters -d . HellowWorld.javaï¼ˆåŠ ä¸Š -parameters ä¼šä¿ç•™æ–¹æ³•ä¸­çš„åç§°ä¿¡æ¯ï¼‰

#### ç¼–è¯‘ä¸º HelloWorld.class åæ˜¯è¿™ä¸ªæ ·å­çš„

`[root@localhost ~]# od -t xC HelloWorld.class

0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09

0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07

0000040 00 1c 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29

0000060 56 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e

0000100 75 6d 62 65 72 54 61 62 6c 65 01 00 12 4c 6f 63

0000120 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65 01

0000140 00 04 74 68 69 73 01 00 1d 4c 63 6e 2f 69 74 63

0000160 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c 6f

0000200 57 6f 72 6c 64 3b 01 00 04 6d 61 69 6e 01 00 16

0000220 28 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72

0000240 69 6e 67 3b 29 56 01 00 04 61 72 67 73 01 00 13

0000260 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69

0000300 6e 67 3b 01 00 10 4d 65 74 68 6f 64 50 61 72 61

0000320 6d 65 74 65 72 73 01 00 0a 53 6f 75 72 63 65 46

0000340 69 6c 65 01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64

0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d 0c 00 1e

0000400 00 1f 01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64

0000420 07 00 20 0c 00 21 00 22 01 00 1b 63 6e 2f 69 74

0000440 63 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c

0000460 6f 57 6f 72 6c 64 01 00 10 6a 61 76 61 2f 6c 61

0000500 6e 67 2f 4f 62 6a 65 63 74 01 00 10 6a 61 76 61

0000520 2f 6c 61 6e 67 2f 53 79 73 74 65 6d 01 00 03 6f

0000540 75 74 01 00 15 4c 6a 61 76 61 2f 69 6f 2f 50 72

0000560 69 6e 74 53 74 72 65 61 6d 3b 01 00 13 6a 61 76

0000600 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d

0000620 01 00 07 70 72 69 6e 74 6c 6e 01 00 15 28 4c 6a

0000640 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b

0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01

0000700 00 07 00 08 00 01 00 09 00 00 00 2f 00 01 00 01

0000720 00 00 00 05 2a b7 00 01 b1 00 00 00 02 00 0a 00

0000740 00 00 06 00 01 00 00 00 04 00 0b 00 00 00 0c 00

0000760 01 00 00 00 05 00 0c 00 0d 00 00 00 09 00 0e 00

0001000 0f 00 02 00 09 00 00 00 37 00 02 00 01 00 00 00

0001020 09 b2 00 02 12 03 b6 00 04 b1 00 00 00 02 00 0a

0001040 00 00 00 0a 00 02 00 00 00 06 00 08 00 07 00 0b

0001060 00 00 00 0c 00 01 00 00 00 09 00 10 00 11 00 00

0001100 00 12 00 00 00 05 01 00 10 00 00 00 01 00 13 00

0001120 00 00 02 00 14`

* ### æ ¹æ® JVM è§„èŒƒï¼Œç±»æ–‡ä»¶ç»“æ„å¦‚ä¸‹

  `ClassFile {

  u4 magic; //ï¼ˆé­”æœ¯ï¼‰

  u2 minor\_version;//(å°ç‰ˆæœ¬å·)

  u2 major\_version;//(ä¸»ç‰ˆæœ¬å·)

  u2 constant\_pool\_count;

  cp\_info constant\_pool[constant\_pool\_count-1];

  u2 access\_flags;//(è®¿é—®ä¿®é¥°)

  u2 this\_class;

  u2 super\_class;//(çˆ¶ç±»ä¿¡æ¯)

  u2 interfaces\_count;

  u2 interfaces[interfaces\_count];//(æ¥å£ä¿¡æ¯)

  u2 fields\_count;

  field\_info fields[fields\_count];//(ç±»ä¸­å˜é‡)

  u2 methods\_count;

  method\_info methods[methods\_count];//(ç±»çš„æ–¹æ³•ä¿¡æ¯)

  u2 attributes\_count;

  attribute\_info attributes[attributes\_count];//(ç±»çš„é™„åŠ å±æ€§ä¿¡æ¯)

  }`

  è§£é‡Šï¼šå‰é¢çš„u4ã€u2ä»£è¡¨çš„æ˜¯å­—èŠ‚æ•°

### 1ï¼‰é­”æœ¯ï¼ˆæ‰€æœ‰æ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ç‰¹å®šç±»å‹ç±»å‹ï¼‰

0~3 å­—èŠ‚ï¼Œè¡¨ç¤ºå®ƒæ˜¯å¦æ˜¯ã€classã€‘ç±»å‹çš„æ–‡ä»¶

0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09

### 2ï¼‰ç‰ˆæœ¬

4~7 å­—èŠ‚ï¼Œè¡¨ç¤ºç±»çš„ç‰ˆæœ¬ 00 34ï¼ˆ52ï¼‰ è¡¨ç¤ºæ˜¯ Java 8

0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09

### 3ï¼‰ **å¸¸é‡æ± **

| **Constant Type** | **Value** |
| --- | --- |
| CONSTANT\_Class | 7 |
| CONSTANT\_Fieldref | 9 |
| CONSTANT\_Methodrefï¼ˆæ–¹æ³•å¼•ç”¨çš„ä¿¡æ¯ï¼‰ | 10 |
| CONSTANT\_InterfaceMethodref | 11 |
| CONSTANT\_String | 8 |
| CONSTANT\_Integer | 3 |
| CONSTANT\_Float | 4 |
| CONSTANT\_Long | 5 |
| CONSTANT\_Double | 6 |
| CONSTANT\_NameAndType | 12 |
| CONSTANT\_Utf8 | 1 |
| CONSTANT\_MethodHandle | 15 |
| CONSTANT\_MethodType | 16 |
| CONSTANT\_InvokeDynamic | 18 |

8~9 å­—èŠ‚ï¼Œè¡¨ç¤ºå¸¸é‡æ± é•¿åº¦ï¼Œ00 23 ï¼ˆ35ï¼‰ è¡¨ç¤ºå¸¸é‡æ± æœ‰ #1~#34é¡¹ï¼Œæ³¨æ„ #0 é¡¹ä¸è®¡å…¥ï¼Œä¹Ÿæ²¡æœ‰å€¼

0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09

ç¬¬#1é¡¹ 0aï¼ˆ16è¿›åˆ¶è¡¨ç¤º10è¿›åˆ¶çš„10ï¼‰ è¡¨ç¤ºä¸€ä¸ª Method ä¿¡æ¯ï¼Œ00 06 å’Œ 00 15ï¼ˆ21ï¼‰ è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #6 å’Œ #21 é¡¹æ¥è·å¾—

è¿™ä¸ªæ–¹æ³•çš„ã€æ‰€å±ç±»ã€‘å’Œã€æ–¹æ³•åã€‘

0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09

ç¬¬#2é¡¹ 09 è¡¨ç¤ºä¸€ä¸ª Field ä¿¡æ¯ï¼Œ00 16ï¼ˆ22ï¼‰å’Œ 00 17ï¼ˆ23ï¼‰ è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #22 å’Œ # 23 é¡¹

æ¥è·å¾—è¿™ä¸ªæˆå‘˜å˜é‡çš„ã€æ‰€å±ç±»ã€‘å’Œã€æˆå‘˜å˜é‡åã€‘

0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09

0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07

ç¬¬#3é¡¹ 08 è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡åç§°ï¼Œ00 18ï¼ˆ24ï¼‰è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #24 é¡¹

0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07

ç¬¬#4é¡¹ 0a è¡¨ç¤ºä¸€ä¸ª Method ä¿¡æ¯ï¼Œ00 19ï¼ˆ25ï¼‰ å’Œ 00 1aï¼ˆ26ï¼‰ è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #25 å’Œ #26

é¡¹æ¥è·å¾—è¿™ä¸ªæ–¹æ³•çš„ã€æ‰€å±ç±»ã€‘å’Œã€æ–¹æ³•åã€‘

0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07ç¬¬#5é¡¹ 07 è¡¨ç¤ºä¸€ä¸ª Class ä¿¡æ¯ï¼Œ00 1bï¼ˆ27ï¼‰ è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #27 é¡¹

0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07

ç¬¬#6é¡¹ 07 è¡¨ç¤ºä¸€ä¸ª Class ä¿¡æ¯ï¼Œ00 1cï¼ˆ28ï¼‰ è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #28 é¡¹

0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07

0000040 00 1c 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29

ç¬¬#7é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 06 è¡¨ç¤ºé•¿åº¦ï¼Œ3c 69 6e 69 74 3e æ˜¯ã€ <init> ï¼ˆæ„é€ æ–¹æ³•ï¼‰ã€‘

0000040 00 1c 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29

ç¬¬#8é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 03 è¡¨ç¤ºé•¿åº¦ï¼Œ28 29 56 æ˜¯ã€()Vã€‘å…¶å®å°±æ˜¯è¡¨ç¤ºæ— å‚ã€æ— è¿”å›å€¼

0000040 00 1c 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29

0000060 56 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e

ç¬¬#9é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 04 è¡¨ç¤ºé•¿åº¦ï¼Œ43 6f 64 65 æ˜¯ã€Codeã€‘

0000060 56 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e

ç¬¬#10é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 0fï¼ˆ15ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œ4c 69 6e 65 4e 75 6d 62 65 72 54 61 62 6c 65

æ˜¯ã€LineNumberTableã€‘

0000060 56 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e

0000100 75 6d 62 65 72 54 61 62 6c 65 01 00 12 4c 6f 63

ç¬¬#11é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 12ï¼ˆ18ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œ4c 6f 63 61 6c 56 61 72 69 61 62 6c 65 54 61

62 6c 65æ˜¯ã€LocalVariableTableã€‘

0000100 75 6d 62 65 72 54 61 62 6c 65 01 00 12 4c 6f 63

0000120 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65 01

ç¬¬#12é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 04 è¡¨ç¤ºé•¿åº¦ï¼Œ74 68 69 73 æ˜¯ã€thisã€‘

0000120 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65 01

0000140 00 04 74 68 69 73 01 00 1d 4c 63 6e 2f 69 74 63

ç¬¬#13é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 1dï¼ˆ29ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€Lcn/itcast/jvm/t5/HelloWorld;ã€‘

0000140 00 04 74 68 69 73 01 00 1d 4c 63 6e 2f 69 74 63

0000160 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c 6f0000200 57 6f 72 6c 64 3b 01 00 04 6d 61 69 6e 01 00 16

ç¬¬#14é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 04 è¡¨ç¤ºé•¿åº¦ï¼Œ74 68 69 73 æ˜¯ã€mainã€‘

0000200 57 6f 72 6c 64 3b 01 00 04 6d 61 69 6e 01 00 16

ç¬¬#15é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 16ï¼ˆ22ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€([Ljava/lang/String;)Vã€‘å…¶å®å°±æ˜¯å‚æ•°ä¸º

å­—ç¬¦ä¸²æ•°ç»„ï¼Œæ— è¿”å›å€¼

0000200 57 6f 72 6c 64 3b 01 00 04 6d 61 69 6e 01 00 16

0000220 28 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72

0000240 69 6e 67 3b 29 56 01 00 04 61 72 67 73 01 00 13

ç¬¬#16é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 04 è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€argsã€‘

0000240 69 6e 67 3b 29 56 01 00 04 61 72 67 73 01 00 13

ç¬¬#17é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 13ï¼ˆ19ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€[Ljava/lang/String;ã€‘

0000240 69 6e 67 3b 29 56 01 00 04 61 72 67 73 01 00 13

0000260 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69

0000300 6e 67 3b 01 00 10 4d 65 74 68 6f 64 50 61 72 61

ç¬¬#18é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 10ï¼ˆ16ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€MethodParametersã€‘

0000300 6e 67 3b 01 00 10 4d 65 74 68 6f 64 50 61 72 61

0000320 6d 65 74 65 72 73 01 00 0a 53 6f 75 72 63 65 46

ç¬¬#19é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 0aï¼ˆ10ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€SourceFileã€‘

0000320 6d 65 74 65 72 73 01 00 0a 53 6f 75 72 63 65 46

0000340 69 6c 65 01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64

ç¬¬#20é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 0fï¼ˆ15ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€HelloWorld.javaã€‘

0000340 69 6c 65 01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64

0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d 0c 00 1e

ç¬¬#21é¡¹ 0c è¡¨ç¤ºä¸€ä¸ª ã€å+ç±»å‹ã€‘ï¼Œ00 07 00 08 å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #7 #8 ä¸¤é¡¹

0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d 0c 00 1e

ç¬¬#22é¡¹ 07 è¡¨ç¤ºä¸€ä¸ª Class ä¿¡æ¯ï¼Œ00 1dï¼ˆ29ï¼‰ å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #29 é¡¹

0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d 0c 00 1eç¬¬#23é¡¹ 0c è¡¨ç¤ºä¸€ä¸ª ã€å+ç±»å‹ã€‘ï¼Œ00 1eï¼ˆ30ï¼‰ 00 1f ï¼ˆ31ï¼‰å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #30 #31 ä¸¤é¡¹

0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d 0c 00 1e

0000400 00 1f 01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64

ç¬¬#24é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 0fï¼ˆ15ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€hello worldã€‘

0000400 00 1f 01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64

ç¬¬#25é¡¹ 07 è¡¨ç¤ºä¸€ä¸ª Class ä¿¡æ¯ï¼Œ00 20ï¼ˆ32ï¼‰ å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #32 é¡¹

0000420 07 00 20 0c 00 21 00 22 01 00 1b 63 6e 2f 69 74

ç¬¬#26é¡¹ 0c è¡¨ç¤ºä¸€ä¸ª ã€å+ç±»å‹ã€‘ï¼Œ00 21ï¼ˆ33ï¼‰ 00 22ï¼ˆ34ï¼‰å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #33 #34 ä¸¤é¡¹

0000420 07 00 20 0c 00 21 00 22 01 00 1b 63 6e 2f 69 74

ç¬¬#27é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 1bï¼ˆ27ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€cn/itcast/jvm/t5/HelloWorldã€‘

0000420 07 00 20 0c 00 21 00 22 01 00 1b 63 6e 2f 69 74

0000440 63 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c

0000460 6f 57 6f 72 6c 64 01 00 10 6a 61 76 61 2f 6c 61

ç¬¬#28é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 10ï¼ˆ16ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€java/lang/Objectã€‘

0000460 6f 57 6f 72 6c 64 01 00 10 6a 61 76 61 2f 6c 61

0000500 6e 67 2f 4f 62 6a 65 63 74 01 00 10 6a 61 76 61

ç¬¬#29é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 10ï¼ˆ16ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€java/lang/Systemã€‘

0000500 6e 67 2f 4f 62 6a 65 63 74 01 00 10 6a 61 76 61

0000520 2f 6c 61 6e 67 2f 53 79 73 74 65 6d 01 00 03 6f

ç¬¬#30é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 03 è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€outã€‘

0000520 2f 6c 61 6e 67 2f 53 79 73 74 65 6d 01 00 03 6f

0000540 75 74 01 00 15 4c 6a 61 76 61 2f 69 6f 2f 50 72

ç¬¬#31é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 15ï¼ˆ21ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€Ljava/io/PrintStream;ã€‘

0000540 75 74 01 00 15 4c 6a 61 76 61 2f 69 6f 2f 50 72

0000560 69 6e 74 53 74 72 65 61 6d 3b 01 00 13 6a 61 76
**Flag Name**

**Value**

**Interpretation**

ACC\_PUBLIC

0x0001

Declared public ; may be accessed from outside its

package.

ACC\_FINAL

0x0010

Declared final ; no subclasses allowed.

ACC\_SUPER

0x0020

Treat superclass methods specially when invoked by the

*invokespecial*
instruction.

ACC\_INTERFACE

0x0200

Is an interface, not a class.

ACC\_ABSTRACT

0x0400

Declared abstract ; must not be instantiated.

ACC\_SYNTHETIC

0x1000

Declared synthetic; not present in the source code.

ACC\_ANNOTATION

0x2000

Declared as an annotation type.

ACC\_ENUM

0x4000

Declared as an enum type.

ç¬¬#32é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 13ï¼ˆ19ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€java/io/PrintStreamã€‘

0000560 69 6e 74 53 74 72 65 61 6d 3b 01 00 13 6a 61 76

0000600 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d

ç¬¬#33é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 07 è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€printlnã€‘

0000620 01 00 07 70 72 69 6e 74 6c 6e 01 00 15 28 4c 6a

ç¬¬#34é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 15ï¼ˆ21ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€(Ljava/lang/String;)Vã€‘

0000620 01 00 07 70 72 69 6e 74 6c 6e 01 00 15 28 4c 6a

0000640 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b

0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01

### 4ï¼‰è®¿é—®æ ‡è¯†ä¸ç»§æ‰¿ä¿¡æ¯

21 è¡¨ç¤ºè¯¥ class æ˜¯ä¸€ä¸ªç±»ï¼Œå…¬å…±çš„

0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01

05 è¡¨ç¤ºæ ¹æ®å¸¸é‡æ± ä¸­ #5 æ‰¾åˆ°æœ¬ç±»å…¨é™å®šå

0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01

06 è¡¨ç¤ºæ ¹æ®å¸¸é‡æ± ä¸­ #6 æ‰¾åˆ°çˆ¶ç±»å…¨é™å®šå

0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01

è¡¨ç¤ºæ¥å£çš„æ•°é‡ï¼Œæœ¬ç±»ä¸º 0

0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01

## äºŒã€å­—èŠ‚ç æŒ‡ä»¤

### 1.javapå·¥å…·

java ä¸­æä¾›äº† javap å·¥å…·æ¥åç¼–è¯‘ class æ–‡ä»¶

```
javap -v D:Demo.class
```

### 2.å›¾è§£æ³•æ‰§è¡Œæµç¨‹

#### 1ï¼‰æºjavaä»£ç 

`package cn.itcast.jvm.t3.bytecode;

/\*\*

\* æ¼”ç¤º å­—èŠ‚ç æŒ‡ä»¤ å’Œ æ“ä½œæ•°æ ˆã€å¸¸é‡æ± çš„å…³ç³»

\*/

public class Demo3\_1 {

public static void main(String[] args) {

int a = 10;

int b = Short.MAX\_VALUE + 1;

int c = a + b;

System.out.println(c);

}

}`

#### 2ï¼‰é€æ­¥åˆ†æ -æ¡ˆä¾‹ä¸€

###### â‘ å¸¸é‡æ± è½½å…¥è¿è¡Œæ—¶å¸¸é‡æ± 

![](https://i-blog.csdnimg.cn/direct/f826fd4a1a844fb696215383e927916c.png)

###### â‘¡ **æ–¹æ³•å­—èŠ‚ç è½½å…¥æ–¹æ³•åŒº**

![](https://i-blog.csdnimg.cn/direct/ad4e9f3bb5a44909afde6d3d11ccfcae.png)

###### â‘¢ **main** **çº¿ç¨‹å¼€å§‹è¿è¡Œï¼Œåˆ†é…æ ˆå¸§å†…å­˜**

ï¼ˆæ“ä½œæ•°æ ˆçš„å®½åº¦æ˜¯å››ä¸ªå­—èŠ‚ï¼‰

ï¼ˆstack=2ï¼Œlocals=4ï¼‰ å¯¹åº”æ“ä½œæ•°æ ˆæœ‰ 2 ä¸ªç©ºé—´ï¼ˆæ¯ä¸ªç©ºé—´ 4 ä¸ªå­—èŠ‚ï¼‰ï¼Œå±€éƒ¨å˜é‡è¡¨ä¸­æœ‰ 4 ä¸ªæ§½ä½ã€‚

![](https://i-blog.csdnimg.cn/direct/5bd0b9eed42448f281c8a0a405335cc3.png)

###### â‘£ **æ‰§è¡Œå¼•æ“å¼€å§‹æ‰§è¡Œå­—èŠ‚ç **

ç„¶åæ‰§è¡Œå¼•æ“å¼€å§‹ä¸€è¡Œè¡Œè¯»å–æ–¹æ³•åŒºçš„ä»£ç ï¼Œæ‰§è¡Œ

1.ç¬¬ä¸€è¡Œ
**bipush 10**

å°†ä¸€ä¸ª byte å‹å…¥æ“ä½œæ•°æ ˆï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰ï¼Œç±»ä¼¼çš„æŒ‡ä»¤è¿˜æœ‰

sipush å°†ä¸€ä¸ª short å‹å…¥æ“ä½œæ•°æ ˆï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰

ldc å°†ä¸€ä¸ª int å‹å…¥æ“ä½œæ•°æ ˆ

ldc2\_w å°†ä¸€ä¸ª long å‹å…¥æ“ä½œæ•°æ ˆï¼ˆåˆ†ä¸¤æ¬¡å‹å…¥ï¼Œå› ä¸º long æ˜¯ 8 ä¸ªå­—èŠ‚ï¼‰

è¿™é‡Œå°çš„æ•°å­—éƒ½æ˜¯å’Œå­—èŠ‚ç æŒ‡ä»¤å­˜åœ¨ä¸€èµ·ï¼Œè¶…è¿‡ short èŒƒå›´çš„æ•°å­—å­˜å…¥äº†å¸¸é‡æ± 

![](https://i-blog.csdnimg.cn/direct/53eedc73ada9415d8d7897e757675ff4.png)

2.æ‰§è¡Œç¬¬äºŒè¡Œ
**istore\_1**

å°†æ“ä½œæ•°æ ˆé¡¶æ•°æ®å¼¹å‡ºï¼Œå­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„ slot 1

![](https://i-blog.csdnimg.cn/direct/240a705dfd7f4581b2385b89c0ec4c18.png)

3.
**ldc #3**

ä»å¸¸é‡æ± åŠ è½½ #3 æ•°æ®åˆ°æ“ä½œæ•°æ ˆ

**æ³¨æ„**
Short.MAX\_VALUE æ˜¯ 32767ï¼Œæ‰€ä»¥ 32768 = Short.MAX\_VALUE + 1 å®é™…æ˜¯åœ¨ç¼–è¯‘æœŸé—´è®¡ç®—

å¥½çš„

![](https://i-blog.csdnimg.cn/direct/fecf16a7d4554ed2a87765cdbf6dbf14.png)

4.
**istore\_2**

![](https://i-blog.csdnimg.cn/direct/1c220826859a4916b7377d92989003f8.png)

5.
**iload\_1**

![](https://i-blog.csdnimg.cn/direct/9ccecce2aa3a4419ac9c358d1602acbd.png)

6ã€
**iload\_2**

![](https://i-blog.csdnimg.cn/direct/0bef500411e846deb83938a33c58ef31.png)

7.
**iadd**

![](https://i-blog.csdnimg.cn/direct/2722d6d2d48249c2941af94bc6a8cb18.png)

8.
**istore\_3**

![](https://i-blog.csdnimg.cn/direct/0e7b82a9e060439c8846b6232c7242c7.png)

9ã€
**getstatic #4**

![](https://i-blog.csdnimg.cn/direct/21dbf9a903164229b05f78b7321f5e2e.png)

![](https://i-blog.csdnimg.cn/direct/e17d4895fb1e4f45a579145785f409b2.png)

10ã€
**iload\_3**

![](https://i-blog.csdnimg.cn/direct/a97181ae96004c1195c2f6ae7b7940a7.png)

11.
**invokevirtual #5**

æ‰¾åˆ°å¸¸é‡æ±  #5 é¡¹

å®šä½åˆ°æ–¹æ³•åŒº java/io/PrintStream.println:(I)V æ–¹æ³•

ç”Ÿæˆæ–°çš„æ ˆå¸§ï¼ˆåˆ†é… localsã€stackç­‰ï¼‰

ä¼ é€’å‚æ•°ï¼Œæ‰§è¡Œæ–°æ ˆå¸§ä¸­çš„å­—èŠ‚ç 

![](https://i-blog.csdnimg.cn/direct/2a47a51ba4f84a2792508dc3e39ba3c3.png)

#### 3ï¼‰é€æ­¥åˆ†æ -æ¡ˆä¾‹äºŒ

javaæºä»£ç 

`package cn.itcast.jvm.t3.bytecode;

/\*\*

\* ä»å­—èŠ‚ç è§’åº¦åˆ†æ a++ ç›¸å…³é¢˜ç›®

\*/

public class Demo3\_2 {

public static void main(String[] args) {

int a = 10;

int b = a++ + ++a + a--;

System.out.println(a);

System.out.println(b);

}

}`

åˆ†æï¼š

æ³¨æ„ iinc æŒ‡ä»¤ï¼ˆä»£ç ä¸­çš„++ï¼‰æ˜¯ç›´æ¥åœ¨å±€éƒ¨å˜é‡ slot ä¸Šè¿›è¡Œè¿ç®—ï¼ˆå³ç›´æ¥åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­æ‰§è¡Œçš„æ²¡æœ‰è¿›æ ˆï¼‰

a++ å’Œ ++a çš„åŒºåˆ«æ˜¯å…ˆæ‰§è¡Œ iload è¿˜æ˜¯ å…ˆæ‰§è¡Œ iinc

1.bipush 10 æŠŠ10å…ˆæ”¾å…¥æ“ä½œæ•°æ ˆä¸­

![](https://i-blog.csdnimg.cn/direct/3817a428490449009decafd0bf53499d.png)

2.istore 1 æŠŠ10å¼¹å‡ºæ¥ æ”¾å…¥1å·

ç„¶åå¼€å§‹æ‰§è¡Œi++ ,è¦å…ˆiload å†è‡ªå¢

iloadå…ˆæŠŠå€¼è¯»å…¥æ“ä½œæ•°æ ˆä¸­

![](https://i-blog.csdnimg.cn/direct/ae4a0a0254d9499a9d6038f91c2c4718.png)

æ‰§è¡Œè‡ªå¢ iinc ï¼Œæ­¤å‘½ä»¤æœ‰ä¸¤ä¸ªå‚æ•°ç¬¬ä¸€ä¸ªæ˜¯å¯¹é‚£ä¸ªæ§½ä½æ“ä½œç¬¬äºŒä¸ªè¡¨ç¤ºè‡ªå¢å‡ 

![](https://i-blog.csdnimg.cn/direct/0ef1dfda453e417f83c005a7782db75d.png)

iaddå‘½ä»¤åšåŠ æ³•ï¼ŒæŠŠæ ˆä¸­çš„ä¸¤ä¸ªæ•°å¼¹å‡º ç›¸åŠ å ç»“æœå†å‹å…¥å ä¸­

![](https://i-blog.csdnimg.cn/direct/ac5cd956361041e7bb988bb7f1ccddf2.png)

![](https://i-blog.csdnimg.cn/direct/0d203dd2471e41159efdbfab5cb3ac65.png)

![](https://i-blog.csdnimg.cn/direct/a4d275ff1b814b1eb1f7fb62c467b900.png)

### 3.æ¡ä»¶åˆ¤æ–­æŒ‡ä»¤

![](https://i-blog.csdnimg.cn/direct/fb5f2ea953e9477f8a6bc0fbb2996c1c.png)

å‡ ç‚¹è¯´æ˜ï¼š

byteï¼Œshortï¼Œchar éƒ½ä¼šæŒ‰ int æ¯”è¾ƒï¼Œå› ä¸ºæ“ä½œæ•°æ ˆéƒ½æ˜¯ 4 å­—èŠ‚

goto ç”¨æ¥è¿›è¡Œè·³è½¬åˆ°æŒ‡å®šè¡Œå·çš„å­—èŠ‚ç 

ä¾‹å­ï¼š

æºç ï¼š`public class Demo3\_3 {

public static void main(String[] args) {

int a = 0;

if(a == 0) {

a = 10;

} else {

a = 20;

}

}

}`

å­—èŠ‚ç ï¼š

`0: iconst\_0

1: istore\_1

2: iload\_1

3: ifne 12

6: bipush 10

8: istore\_1

9: goto 15

12: bipush 20

14: istore\_1

15: return`

### 4.å¾ªç¯æ§åˆ¶æŒ‡ä»¤

##### 1ï¼‰whileå¾ªç¯

ä¾‹ï¼š`public class Demo3\_4 {

public static void main(String[] args) {

int a = 0;

while (a < 10) {

a++;

}

}

}`

å­—èŠ‚ç ï¼š`0: iconst\_0

1: istore\_1

2: iload\_1

3: bipush 10

5: if\_icmpge 14

8: iinc 1, 1

11: goto 2

14: return`

##### 2ï¼‰do-whileå¾ªç¯

`public class Demo3\_5 {

public static void main(String[] args) {

int a = 0;

do {

a++;

} while (a < 10);

}

}`

å­—èŠ‚ç ï¼š`0: iconst\_0

1: istore\_1

2: iinc 1, 1

5: iload\_1

6: bipush 10

8: if\_icmplt 2

11: return`

##### 3ï¼‰forå¾ªç¯

`public class Demo3\_6 {

public static void main(String[] args) {

for (int i = 0; i < 10; i++) {

}

}

}`

å­—èŠ‚ç ï¼š

`0: iconst\_0

1: istore\_1

2: iload\_1

3: bipush 10

5: if\_icmpge 14

8: iinc 1, 1

11: goto 2

14: return`

æ³¨ï¼šwhileå’Œforå¾ªç¯çš„å­—èŠ‚ç ä¸€æ ·çš„

##### *\* ç»ƒä¹ * \*

è¯·ä»å­—èŠ‚ç è§’åº¦åˆ†æï¼Œä¸‹åˆ—ä»£ç è¿è¡Œçš„ç»“æœï¼š

`public class Demo3\_6\_1 {

public static void main(String[] args) {

int i = 0;

int x = 0;

while (i < 10) {

x = x++;

i++;

}

System.out.println(x);
**// ç»“æœæ˜¯ 0**

}

}`

### 5.æ„é€ æ–¹æ³•

#### 1ï¼‰cinit

<cinit>()V

ä»£ç ï¼š

`public class Demo3\_8\_1 {

static int i = 10;

static {

i = 20;

}

static {

i = 30;

}

}`

ç¼–è¯‘å™¨ä¼šæŒ‰ä»ä¸Šè‡³ä¸‹çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ static é™æ€ä»£ç å—å’Œé™æ€æˆå‘˜èµ‹å€¼çš„ä»£ç ï¼Œåˆå¹¶ä¸ºä¸€ä¸ªç‰¹æ®Šçš„æ–¹

æ³• <cinit>()V ï¼š

`0: bipush 10

2: putstatic #2 // Field i:I

5: bipush 20

7: putstatic #2 // Field i:I

10: bipush 30

12: putstatic #2 // Field i:I

15: return`

<cinit>()V æ–¹æ³•ä¼šåœ¨ç±»åŠ è½½çš„åˆå§‹åŒ–é˜¶æ®µè¢«è°ƒç”¨

#### 2ï¼‰init

<init>()V

ä»£ç ï¼š

`public class Demo3\_8\_2 {

private String a = "s1";

{

b = 20;

}

private int b = 10;

{

a = "s2";

}

public Demo3\_8\_2(String a, int b) {

this.a = a;

this.b = b;

}

public static void main(String[] args) {

Demo3\_8\_2 d = new Demo3\_8\_2("s3", 30);

System.out.println(d.a);

System.out.println(d.b);

}

}`

ç¼–è¯‘å™¨ä¼šæŒ‰ä»ä¸Šè‡³ä¸‹çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ {} ä»£ç å—å’Œæˆå‘˜å˜é‡èµ‹å€¼çš„ä»£ç ï¼Œå½¢æˆæ–°çš„æ„é€ æ–¹æ³•ï¼Œä½†åŸå§‹æ„

é€ æ–¹æ³•å†…çš„ä»£ç æ€»æ˜¯åœ¨æœ€å

`public cn.itcast.jvm.t3.bytecode.Demo3\_8\_2(java.lang.String, int);

descriptor: (Ljava/lang/String;I)V

flags: ACC\_PUBLIC

Code:

stack=2, locals=3, args\_size=3

0: aload\_0

1: invokespecial #1 // super.<init>()V

4: aload\_0

5: ldc #2 // <- "s1"

7: putfield #3 // -> this.a

10: aload\_0

11: bipush 20 // <- 20

13: putfield #4 // -> this.b

16: aload\_0

17: bipush 10 // <- 10

19: putfield #4 // -> this.b

22: aload\_0

23: ldc #5 // <- "s2"

25: putfield #3 // -> this.a

28: aload\_0 // ------------------------------

29: aload\_1 // <- slot 1(a) "s3" |

30: putfield #3 // -> this.a |

33: aload\_0 |

34: iload\_2 // <- slot 2(b) 30 |

35: putfield #4 // -> this.b --------------------

38: return

LineNumberTable: ...

LocalVariableTable:

Start Length Slot Name Signature

0 39 0 this Lcn/itcast/jvm/t3/bytecode/Demo3\_8\_2;

0 39 1 a Ljava/lang/String;

0 39 2 b I

MethodParameters: ...`

### 6.æ–¹æ³•è°ƒç”¨

ç¤ºä¾‹ä»£ç ï¼š

`public class Demo3\_9 {

public Demo3\_9() { }

private void test1() { }

private final void test2() { }

public void test3() { }

public static void test4() { }

public static void main(String[] args) {

Demo3\_9 d = new Demo3\_9();

d.test1();

d.test2();

d.test3();

d.test4();

Demo3\_9.test4();

}

}`

å¯¹åº”çš„å­—èŠ‚ç ï¼š

`0: new #2 // class cn/itcast/jvm/t3/bytecode/Demo3\_9

3: dup

4: invokespecial #3 // Method "<init>":()V

7: astore\_1

8: aload\_1

9: invokespecial #4 // Method test1:()V

12: aload\_1

13: invokespecial #5 // Method test2:()V

16: aload\_1

17: invokevirtual #6 // Method test3:()V

20: aload\_1

21: pop

22: invokestatic #7 // Method test4:()V

25: invokestatic #7 // Method test4:()V

28: return`

è§£é‡Šï¼šä¸åŒæ–¹æ³•åœ¨è°ƒç”¨æ—¶ï¼Œå¯¹åº”çš„è™šæ‹ŸæœºæŒ‡ä»¤æœ‰æ‰€åŒºåˆ«

* ç§æœ‰ã€æ„é€ ã€è¢« final ä¿®é¥°çš„æ–¹æ³•ï¼Œåœ¨è°ƒç”¨æ—¶éƒ½ä½¿ç”¨ invokespecial æŒ‡ä»¤
* æ™®é€šæˆå‘˜æ–¹æ³•åœ¨è°ƒç”¨æ—¶ï¼Œä½¿ç”¨ invokevirtual æŒ‡ä»¤ã€‚å› ä¸ºç¼–è¯‘æœŸé—´æ— æ³•ç¡®å®šè¯¥æ–¹æ³•çš„å†…å®¹ï¼Œåªæœ‰åœ¨è¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®š
* é™æ€æ–¹æ³•åœ¨è°ƒç”¨æ—¶ä½¿ç”¨ invokestatic æŒ‡ä»¤
* new æ˜¯åˆ›å»ºã€å¯¹è±¡ã€‘ï¼Œç»™å¯¹è±¡åˆ†é…å †å†…å­˜ï¼Œæ‰§è¡ŒæˆåŠŸä¼šå°†ã€å¯¹è±¡å¼•ç”¨ã€‘å‹å…¥æ“ä½œæ•°
* dup æ˜¯èµ‹å€¼æ“ä½œæ•°æ ˆæ ˆé¡¶çš„å†…å®¹ï¼Œæœ¬ä¾‹å³ä¸ºã€å¯¹è±¡å¼•ç”¨ã€‘ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä»½å¼•ç”¨å‘¢ï¼Œä¸€ä¸ªæ˜¯è¦é…
* åˆ invokespecial è°ƒç”¨è¯¥å¯¹è±¡çš„æ„é€ æ–¹æ³• "<init>":()V ï¼ˆä¼šæ¶ˆè€—æ‰æ ˆé¡¶ä¸€ä¸ªå¼•ç”¨ï¼‰ï¼Œå¦ä¸€ä¸ªè¦
* é…åˆ astore\_1 èµ‹å€¼ç»™å±€éƒ¨å˜é‡
* æœ€ç»ˆæ–¹æ³•ï¼ˆfinalï¼‰ï¼Œç§æœ‰æ–¹æ³•ï¼ˆprivateï¼‰ï¼Œæ„é€ æ–¹æ³•éƒ½æ˜¯ç”± invokespecial æŒ‡ä»¤æ¥è°ƒç”¨ï¼Œå±äºé™
* æ€ç»‘å®š
* æ™®é€šæˆå‘˜æ–¹æ³•æ˜¯ç”± invokevirtual è°ƒç”¨ï¼Œå±äºåŠ¨æ€ç»‘å®šï¼Œå³æ”¯æŒå¤šæ€
* æˆå‘˜æ–¹æ³•ä¸é™æ€æ–¹æ³•è°ƒç”¨çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œæ‰§è¡Œæ–¹æ³•å‰æ˜¯å¦éœ€è¦ã€å¯¹è±¡å¼•ç”¨ã€‘
* æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ d.test4(); æ˜¯é€šè¿‡ã€å¯¹è±¡å¼•ç”¨ã€‘è°ƒç”¨ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°åœ¨è°ƒç”¨
* invokestatic ä¹‹å‰æ‰§è¡Œäº† pop æŒ‡ä»¤ï¼ŒæŠŠã€å¯¹è±¡å¼•ç”¨ã€‘ä»æ“ä½œæ•°æ ˆå¼¹æ‰äº†ğŸ˜‚
* è¿˜æœ‰ä¸€ä¸ªæ‰§è¡Œ invokespecial çš„æƒ…å†µæ˜¯é€šè¿‡ super è°ƒç”¨çˆ¶ç±»æ–¹

### 7.å¤šæ€çš„åŸç†

å› ä¸ºæ™®é€šæˆå‘˜æ–¹æ³•éœ€è¦åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šå…·ä½“çš„å†…å®¹ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºéœ€è¦è°ƒç”¨ invokevirtual æŒ‡ä»¤ åœ¨æ‰§è¡Œ invokevirtual æŒ‡ä»¤æ—¶ï¼Œç»å†äº†ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤

å…ˆé€šè¿‡æ ˆå¸§ä¸­å¯¹è±¡çš„å¼•ç”¨æ‰¾åˆ°å¯¹è±¡ â€‹ åˆ†æå¯¹è±¡å¤´ï¼Œæ‰¾åˆ°å¯¹è±¡å®é™…çš„ Class â€‹ Class ç»“æ„ä¸­æœ‰ vtable â€‹ æŸ¥è¯¢ vtable æ‰¾åˆ°æ–¹æ³•çš„å…·ä½“åœ°å€ â€‹ æ‰§è¡Œæ–¹æ³•çš„å­—èŠ‚ç 

æ“ä½œï¼š

**1\***
\*ï¼‰è¿è¡Œä»£ç \*\*

åœåœ¨ System.in.read() æ–¹æ³•ä¸Šï¼Œè¿™æ—¶è¿è¡Œ jps è·å–è¿›ç¨‹ id

**2\***
\*ï¼‰è¿è¡Œ\*\*
**HSDB**
**å·¥å…·**

è¿›å…¥ JDK å®‰è£…ç›®å½•ï¼Œæ‰§è¡Œ

java -cp ./lib/sa-jdi.jar sun.jvm.hotspot.HSDB

è¿›å…¥å›¾å½¢ç•Œé¢ attach è¿›ç¨‹ id

### 8.å¼‚å¸¸å¤„ç†

#### 1ï¼‰ **try-catch**

ä»£ç ï¼š

`public class Demo3\_11\_1 {

public static void main(String[] args) {

int i = 0;

try {

i = 10;

} catch (Exception e) {

i = 20;

}

}

}`

å­—èŠ‚ç ï¼š

`public static void main(java.lang.String[]);

descriptor: ([Ljava/lang/String;)V

flags: ACC\_PUBLIC, ACC\_STATIC

Code:

stack=1, locals=3, args\_size=1

0: iconst\_0

1: istore\_1

2: bipush 10

4: istore\_1

5: goto 12

8: astore\_2

9: bipush 20

11: istore\_1

12: return

Exception table:

from to target type

2 5 8 Class java/lang/Exception

LineNumberTable: ...

LocalVariableTable:

Start Length Slot Name Signature

9 3 2 e Ljava/lang/Exception;

0 13 0 args [Ljava/lang/String;

2 11 1 i I

StackMapTable: ...

MethodParameters: ...

}`

å¯ä»¥çœ‹å‡ºå¤šå‡ºäº†ä¸€ä¸ªä¸ª Exception table çš„ç»“æ„ï¼Œ[from, to) æ˜¯å‰é—­åå¼€çš„æ£€æµ‹èŒƒå›´ï¼Œä¸€æ—¦è¿™ä¸ªèŒƒå›´å†…çš„å­—èŠ‚ç æ‰§è¡Œå‡ºç°å¼‚å¸¸ï¼Œåˆ™é€šè¿‡ type åŒ¹é…å¼‚å¸¸ç±»å‹ï¼Œå¦‚æœä¸€è‡´ï¼Œè¿›å…¥ target æ‰€æŒ‡ç¤ºè¡Œå·

8 è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ astore\_2 æ˜¯å°†å¼‚å¸¸å¯¹è±¡å¼•ç”¨å­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„ slot 2 ä½ç½®

#### 2ï¼‰ **å¤šä¸ª** **single-catch** **å—**

ä»£ç ï¼š

`public class Demo3\_11\_2 {

public static void main(String[] args) {

int i = 0;

try {å› ä¸ºå¼‚å¸¸å‡ºç°æ—¶ï¼Œåªèƒ½è¿›å…¥ Exception table ä¸­ä¸€ä¸ªåˆ†æ”¯ï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡è¡¨ slot 2 ä½ç½®è¢«å…±ç”¨

**multi-catch**
**çš„æƒ…å†µ**

i = 10;

} catch (ArithmeticException e) {

i = 30;

} catch (NullPointerException e) {

i = 40;

} catch (Exception e) {

i = 50;

}

}

}`

å­—èŠ‚ç ï¼š

`public static void main(java.lang.String[]);

descriptor: ([Ljava/lang/String;)V

flags: ACC\_PUBLIC, ACC\_STATIC

Code:

stack=1, locals=3, args\_size=1

0: iconst\_0

1: istore\_1

2: bipush 10

4: istore\_1

5: goto 26

8: astore\_2

9: bipush 30

11: istore\_1

12: goto 26

15: astore\_2

16: bipush 40

18: istore\_1

19: goto 26

22: astore\_2

23: bipush 50

25: istore\_1

26: return

Exception table:

from to target type

2 5 8 Class java/lang/ArithmeticException

2 5 15 Class java/lang/NullPointerException

2 5 22 Class java/lang/Exception

LineNumberTable: ...

LocalVariableTable:

Start Length Slot Name Signature

9 3 2 e Ljava/lang/ArithmeticException;

16 3 2 e Ljava/lang/NullPointerException;

23 3 2 e Ljava/lang/Exception;

0 27 0 args [Ljava/lang/String;

2 25 1 i I

StackMapTable: ...

MethodParameters: ...`

å› ä¸ºå¼‚å¸¸å‡ºç°æ—¶ï¼Œåªèƒ½è¿›å…¥ Exception table ä¸­ä¸€ä¸ªåˆ†æ”¯ï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡è¡¨ slot 2 ä½ç½®è¢«å…±ç”¨

#### 3ï¼‰finally

ä»£ç ï¼š

`public class Demo3\_11\_4 {

public static void main(String[] args) {

int i = 0;

try {

i = 10;

} catch (Exception e) {

i = 20;

} finally {

i = 30;

}

}

}`

å¯¹åº”å­—èŠ‚ç ï¼š

`public static void main(java.lang.String[]);

descriptor: ([Ljava/lang/String;)V

flags: ACC\_PUBLIC, ACC\_STATIC

Code:

stack=1, locals=4, args\_size=1

0: iconst\_0

1: istore\_1 // 0 -> i

2: bipush 10 // try --------------------------------------

4: istore\_1 // 10 -> i |

5: bipush 30 // finally |

7: istore\_1 // 30 -> i |

8: goto 27 // return -----------------------------------

11: astore\_2 // catch Exceptin -> e ----------------------

12: bipush 20 // |

14: istore\_1 // 20 -> i |

15: bipush 30 // finally |

17: istore\_1 // 30 -> i |

18: goto 27 // return -----------------------------------

21: astore\_3 // catch any -> slot 3 ----------------------

22: bipush 30 // finally |

24: istore\_1 // 30 -> i |

25: aload\_3 // <- slot 3 |

26: athrow // throw ------------------------------------

27: return

Exception table:

from to target type

2 5 11 Class java/lang/Exception

2 5 21 any // å‰©ä½™çš„å¼‚å¸¸ç±»å‹ï¼Œæ¯”å¦‚ Error

11 15 21 any // å‰©ä½™çš„å¼‚å¸¸ç±»å‹ï¼Œæ¯”å¦‚ Error

LineNumberTable: ...

LocalVariableTable:

Start Length Slot Name Signature

12 3 2 e Ljava/lang/Exception;

0 28 0 args [Ljava/lang/String;

2 26 1 i I

StackMapTable: ...

MethodParameters: ...`

æ¯ä¸ªåˆ†æ”¯éƒ½æ˜¯ä¸€ä¸ªï¼Œéƒ½ä¼šæ‰§è¡Œfinallyä¸­çš„ä»£ç ï¼Œè·Ÿåˆ†æ”¯ç»“æ„ç±»ä¼¼ã€‚try catch è¿˜æœ‰æœ¬èº«

å¯ä»¥çœ‹åˆ° finally ä¸­çš„ä»£ç è¢«å¤åˆ¶äº† 3 ä»½ï¼Œåˆ†åˆ«æ”¾å…¥ try æµç¨‹ï¼Œcatch æµç¨‹ä»¥åŠ catch å‰©ä½™çš„å¼‚å¸¸ç±»å‹æµ

ç¨‹

##### finallyé¢è¯•é¢˜1

é¢˜ç›®ï¼šä¸‹é¢çš„é¢˜ç›®è¾“å‡ºä»€ä¹ˆï¼Ÿ

`public class Demo3\_12\_2 {

public static void main(String[] args) {

int result = test();

System.out.println(result);

}

public static int test() {

try {

return 10;

} finally {

return 20;

}

}

}`

ç­”æ¡ˆ 20ï¼›

è§£é‡Šï¼šå¯¹åº”çš„å­—èŠ‚ç å¦‚ä¸‹

`public static int test();

descriptor: ()I

flags: ACC\_PUBLIC, ACC\_STATIC

Code:

stack=1, locals=2, args\_size=0

0: bipush 10 // <- 10 æ”¾å…¥æ ˆé¡¶

2: istore\_0 // 10 -> slot 0 (ä»æ ˆé¡¶ç§»é™¤äº†)

3: bipush 20 // <- 20 æ”¾å…¥æ ˆé¡¶

5: ireturn // è¿”å›æ ˆé¡¶ int(20)

6: astore\_1 // catch any -> slot 1

7: bipush 20 // <- 20 æ”¾å…¥æ ˆé¡¶

9: ireturn // è¿”å›æ ˆé¡¶ int(20)

Exception table:

from to target type

0 3 6 any

LineNumberTable: ...

StackMapTable: ...`

* ç”±äº finally ä¸­çš„ ireturn è¢«æ’å…¥äº†æ‰€æœ‰å¯èƒ½çš„æµç¨‹ï¼Œå› æ­¤è¿”å›ç»“æœè‚¯å®šä»¥ finally çš„ä¸ºå‡†
* è‡³äºå­—èŠ‚ç ä¸­ç¬¬ 2 è¡Œï¼Œä¼¼ä¹æ²¡å•¥ç”¨ï¼Œä¸”ç•™ä¸ªä¼ç¬”ï¼Œçœ‹ä¸‹ä¸ªä¾‹å­
* è·Ÿä¸Šä¾‹ä¸­çš„ finally ç›¸æ¯”ï¼Œå‘ç°æ²¡æœ‰ athrow äº†ï¼Œè¿™å‘Šè¯‰æˆ‘ä»¬ï¼šå¦‚æœåœ¨ finally ä¸­å‡ºç°äº† returnï¼Œä¼šåæ‰å¼‚å¸¸ğŸ˜±ğŸ˜±ğŸ˜±ï¼Œå¯ä»¥è¯•ä¸€ä¸‹ä¸‹é¢çš„ä»£ç ï¼š

  `public class Demo3\_12\_1 {

  public static void main(String[] args) {

  int result = test();

  System.out.println(result);

  }

  public static int test() {

  try {int i = 1/0;

  return 10;

  } finally {

  return 20;

  }

  }

  }`

  æ‰§è¡Œæ˜¯ä¸ä¼šå‡ºç°ä»»ä½•å¼‚å¸¸çš„

##### finallyé¢è¯•é¢˜1

é¢˜ç›®ï¼šä¸‹é¢çš„é¢˜ç›®è¾“å‡ºä»€ä¹ˆï¼Ÿ

`public class Demo3\_12\_2 {

public static void main(String[] args) {

int result = test();

System.out.println(result);

}

public static int test() {

int i = 10;

try {

return i;

} finally {

i = 20;

}

}

}`

ç­”æ¡ˆè¾“å‡º10

è§£æï¼šå¯¹åº”çš„å­—èŠ‚ç : `public static int test();

descriptor: ()I

flags: ACC\_PUBLIC, ACC\_STATIC

Code:

stack=1, locals=3, args\_size=0

0: bipush 10 // <- 10 æ”¾å…¥æ ˆé¡¶

2: istore\_0 // 10 -> i

3: iload\_0 // <- i(10)

4: istore\_1 // 10 -> slot 1ï¼Œæš‚å­˜è‡³ slot 1ï¼Œç›®çš„æ˜¯ä¸ºäº†å›ºå®šè¿”å›å€¼

5: bipush 20 // <- 20 æ”¾å…¥æ ˆé¡¶

7: istore\_0 // 20 -> i

8: iload\_1 // <- slot 1(10) è½½å…¥ slot 1 æš‚å­˜çš„å€¼

9: ireturn // è¿”å›æ ˆé¡¶çš„ int(10)

10: astore\_2

11: bipush 20

13: istore\_0

14: aload\_2

15: athrow

Exception table:

from to target type

3 5 10 any

LineNumberTable: ...

LocalVariableTable:

Start Length Slot Name Signature

3 13 0 i I

StackMapTable: ...`

### 9.synchronized

public class Demo3\_13 {

public static void main(String[] args) {

Object lock = new Object();

synchronized (lock) {

System.out.println("ok");

}

}

}

å¯¹åº”å­—èŠ‚ç ï¼š

`public static void main(java.lang.String[]);

descriptor: ([Ljava/lang/String;)V

flags: ACC\_PUBLIC, ACC\_STATIC

Code:

stack=2, locals=4, args\_size=1

0: new #2 // new Object

3: dup

4: invokespecial #1 // invokespecial <init>:()V

7: astore\_1 // lockå¼•ç”¨ -> lock

8: aload\_1 // <- lock ï¼ˆsynchronizedå¼€å§‹ï¼‰

9: dup

10: astore\_2 // lockå¼•ç”¨ -> slot 2

11: monitorenter // monitorenter(lockå¼•ç”¨)

12: getstatic #3 // <- System.out

15: ldc #4 // <- "ok"

17: invokevirtual #5 // invokevirtual println:

(Ljava/lang/String;)V

20: aload\_2 // <- slot 2(lockå¼•ç”¨)

21: monitorexit // monitorexit(lockå¼•ç”¨)

22: goto 30

25: astore\_3 // any -> slot 3

26: aload\_2 // <- slot 2(lockå¼•ç”¨)

27: monitorexit // monitorexit(lockå¼•ç”¨)

28: aload\_3

29: athrow

30: return

Exception table:

from to target type

12 22 25 any

25 28 25 any

LineNumberTable: ...

LocalVariableTable:

Start Length Slot Name Signature

0 31 0 args [Ljava/lang/String;

8 23 1 lock Ljava/lang/Object;

StackMapTable: ...

MethodParameters: ...`

æ–¹æ³•çº§åˆ«çš„ synchronized ä¸ä¼šåœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­æœ‰æ‰€ä½“ç°

## ä¸‰ã€ç¼–è¯‘æœŸé¢„å¤„ç†

æ‰€è°“çš„ è¯­æ³•ç³– ï¼Œå…¶å®å°±æ˜¯æŒ‡ java ç¼–è¯‘å™¨æŠŠ \*.java æºç ç¼–è¯‘ä¸º \*.class å­—èŠ‚ç çš„è¿‡ç¨‹ä¸­ï¼Œè‡ªåŠ¨ç”Ÿæˆ

å’Œè½¬æ¢çš„ä¸€äº›ä»£ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‡è½»ç¨‹åºå‘˜çš„è´Ÿæ‹…ï¼Œç®—æ˜¯ java ç¼–è¯‘å™¨ç»™æˆ‘ä»¬çš„ä¸€ä¸ªé¢å¤–ç¦åˆ©ï¼ˆç»™ç³–åƒ

å˜›ï¼‰

æ³¨æ„ï¼Œä»¥ä¸‹ä»£ç çš„åˆ†æï¼Œå€ŸåŠ©äº† javap å·¥å…·ï¼Œidea çš„åç¼–è¯‘åŠŸèƒ½ï¼Œidea æ’ä»¶ jclasslib ç­‰å·¥å…·ã€‚å¦å¤–ï¼Œ

ç¼–è¯‘å™¨è½¬æ¢çš„ç»“æœç›´æ¥å°±æ˜¯ class å­—èŠ‚ç ï¼Œåªæ˜¯ä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œç»™å‡ºäº† å‡ ä¹ç­‰ä»· çš„ java æºç æ–¹å¼ï¼Œå¹¶

ä¸æ˜¯ç¼–è¯‘å™¨è¿˜ä¼šè½¬æ¢å‡ºä¸­é—´çš„ java æºç ï¼Œåˆ‡è®°ã€‚

### 1. **é»˜è®¤æ„é€ å™¨**

public class Candy1 {

}

ç¼–è¯‘æˆclassåçš„ä»£ç ï¼š

public class Candy1 {

// è¿™ä¸ªæ— å‚æ„é€ æ˜¯ç¼–è¯‘å™¨å¸®åŠ©æˆ‘ä»¬åŠ ä¸Šçš„

public Candy1() {

super(); // å³è°ƒç”¨çˆ¶ç±» Object çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œå³è°ƒç”¨ java/lang/Object."

<init>":()V

}

}

### **2** . **è‡ªåŠ¨æ‹†è£…ç®±**

è¿™ä¸ªç‰¹æ€§æ˜¯ JDK 5 å¼€å§‹åŠ å…¥çš„ï¼Œ ä»£ç ç‰‡æ®µ1 ï¼š

`public class Candy2 {

public static void main(String[] args) {

Integer x = 1;

int y = x;

}

}`

è¿™æ®µä»£ç åœ¨ JDK 5 ä¹‹å‰æ˜¯æ— æ³•ç¼–è¯‘é€šè¿‡çš„ï¼Œå¿…é¡»æ”¹å†™ä¸º ä»£ç ç‰‡æ®µ2 :

`public class Candy2 {

public static void main(String[] args) {

Integer x = Integer.valueOf(1);

int y = x.intValue();

}

}`

### **3.** **æ³›å‹é›†åˆå–å€¼**

æ³›å‹ä¹Ÿæ˜¯åœ¨ JDK 5 å¼€å§‹åŠ å…¥çš„ç‰¹æ€§ï¼Œä½† java åœ¨ç¼–è¯‘æ³›å‹ä»£ç åä¼šæ‰§è¡Œ æ³›å‹æ“¦é™¤ çš„åŠ¨ä½œï¼Œå³æ³›å‹ä¿¡æ¯

åœ¨ç¼–è¯‘ä¸ºå­—èŠ‚ç ä¹‹åå°±ä¸¢å¤±äº†ï¼Œå®é™…çš„ç±»å‹éƒ½å½“åšäº† Object ç±»å‹æ¥å¤„ç†ï¼š

![](https://i-blog.csdnimg.cn/direct/c7259a8201404c36acae465876d91e2f.png)

![](https://i-blog.csdnimg.cn/direct/4bbe001fe92847a3a4d5c6aa4e80db1c.png)

### **4.** **å¯å˜å‚æ•°**

å¯å˜å‚æ•°ä¹Ÿæ˜¯ JDK 5 å¼€å§‹åŠ å…¥çš„æ–°ç‰¹æ€§ï¼š

`public class Candy4 {

public static void foo(String... args) {

String[] array = args; // ç›´æ¥èµ‹å€¼

System.out.println(array);

}

public static void main(String[] args) {

foo("hello", "world");

}

}`

å¯å˜å‚æ•° String... args å…¶å®æ˜¯ä¸€ä¸ª String[] args ï¼Œä»ä»£ç ä¸­çš„èµ‹å€¼è¯­å¥ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚

åŒæ · java ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸé—´å°†ä¸Šè¿°ä»£ç å˜æ¢ä¸ºï¼š

`public class Candy4 {

public static void foo(String[] args) {

String[] array = args; // ç›´æ¥èµ‹å€¼

System.out.println(array);

}

public static void main(String[] args) {

foo(new String[]{"hello", "world"});

}

}`

**æ³¨æ„**

å¦‚æœè°ƒç”¨äº† foo() åˆ™ç­‰ä»·ä»£ç ä¸º foo(new String[]{}) ï¼Œåˆ›å»ºäº†ä¸€ä¸ªç©ºçš„æ•°ç»„ï¼Œè€Œä¸ä¼šä¼ é€’

null è¿›å»

### 5. **foreach** **å¾ªç¯**

ä»æ˜¯ JDK 5 å¼€å§‹å¼•å…¥çš„è¯­æ³•ç³–ï¼Œæ•°ç»„çš„å¾ªç¯ï¼š

`public class Candy5\_1 {

public static void main(String[] args) {

int[] array = {1, 2, 3, 4, 5}; // æ•°ç»„èµ‹åˆå€¼çš„ç®€åŒ–å†™æ³•ä¹Ÿæ˜¯è¯­æ³•ç³–å“¦

for (int e : array) {

System.out.println(e);

}

}

}`

ä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢ä¸ºï¼š

`public class Candy5\_1 {

public Candy5\_1() {

}

public static void main(String[] args) {

int[] array = new int[]{1, 2, 3, 4, 5};

for(int i = 0; i < array.length; ++i) {

int e = array[i];

System.out.println(e);

}

}

}`

è€Œé›†åˆçš„å¾ªç¯ï¼š

`public class Candy5\_2 {

public static void main(String[] args) {

List<Integer> list = Arrays.asList(1,2,3,4,5);

for (Integer i : list) {

System.out.println(i);

}

}

}`

å®é™…è¢«ç¼–è¯‘å™¨è½¬æ¢ä¸ºå¯¹è¿­ä»£å™¨çš„è°ƒç”¨ï¼š

`public class Candy5\_2 {

public Candy5\_2() {

}

public static void main(String[] args) {

List<Integer> list = Arrays.asList(1, 2, 3, 4, 5);

Iterator iter = list.iterator();

while(iter.hasNext()) {

Integer e = (Integer)iter.next();

System.out.println(e);

}

}

}`

**æ³¨æ„**

foreach å¾ªç¯å†™æ³•ï¼Œèƒ½å¤Ÿé…åˆæ•°ç»„ï¼Œä»¥åŠæ‰€æœ‰å®ç°äº† Iterable æ¥å£çš„é›†åˆç±»ä¸€èµ·ä½¿ç”¨ï¼Œå…¶ä¸­

Iterable ç”¨æ¥è·å–é›†åˆçš„è¿­ä»£å™¨ï¼ˆ Iterator ï¼‰

### 6. **switch** - **å­—ç¬¦ä¸²**

ä» JDK 7 å¼€å§‹ï¼Œswitch å¯ä»¥ä½œç”¨äºå­—ç¬¦ä¸²å’Œæšä¸¾ç±»ï¼Œè¿™ä¸ªåŠŸèƒ½å…¶å®ä¹Ÿæ˜¯è¯­æ³•ç³–ï¼Œä¾‹å¦‚ï¼š

`public class Candy6\_1 {

public static void choose(String str) {

switch (str) {

case "hello": {

System.out.println("h");

break;

}

case "world": {

System.out.println("w");

break;

}

}

}

}`

**æ³¨æ„**

switch é…åˆ String å’Œæšä¸¾ä½¿ç”¨æ—¶ï¼Œå˜é‡ä¸èƒ½ä¸ºnullï¼ŒåŸå› åˆ†æå®Œè¯­æ³•ç³–è½¬æ¢åçš„ä»£ç åº”å½“è‡ªç„¶æ¸…

æ¥š

ä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢ä¸ºï¼š

`public class Candy6\_1 {

public Candy6\_1() {

}

public static void choose(String str) {

byte x = -1;

switch(str.hashCode()) {

case 99162322: // hello çš„ hashCode

if (str.equals("hello")) {x = 0;

}

break;

case 113318802: // world çš„ hashCode

if (str.equals("world")) {

x = 1;

}

}

switch(x) {

case 0:

System.out.println("h");

break;

case 1:

System.out.println("w");

}

}

}`

å¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œäº†ä¸¤é switchï¼Œç¬¬ä¸€éæ˜¯æ ¹æ®å­—ç¬¦ä¸²çš„ hashCode å’Œ equals å°†å­—ç¬¦ä¸²çš„è½¬æ¢ä¸ºç›¸åº”

byte ç±»å‹ï¼Œç¬¬äºŒéæ‰æ˜¯åˆ©ç”¨ byte æ‰§è¡Œè¿›è¡Œæ¯”è¾ƒã€‚

ä¸ºä»€ä¹ˆç¬¬ä¸€éæ—¶å¿…é¡»æ—¢æ¯”è¾ƒ hashCodeï¼Œåˆåˆ©ç”¨ equals æ¯”è¾ƒå‘¢ï¼ŸhashCode æ˜¯ä¸ºäº†æé«˜æ•ˆç‡ï¼Œå‡å°‘å¯

èƒ½çš„æ¯”è¾ƒï¼›è€Œ equals æ˜¯ä¸ºäº†é˜²æ­¢ hashCode å†²çª(ä¸¤ä¸ªå­—ç¬¦ä¸²çš„hashcodeå¯èƒ½ä¸€æ ·ï¼Œåœ¨è¿›å…¥ç”¨equalsè¿›è¡Œæ¯”è¾ƒ)ï¼Œä¾‹å¦‚ BM å’Œ C. è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„hashCodeå€¼éƒ½æ˜¯2123 .

### 7. **switch** - **æšä¸¾**

`enum Sex {

MALE, FEMALE

}`

`public class Candy7 {

public static void foo(Sex sex) {

switch (sex) {

case MALE:

System.out.println("ç”·"); break;

case FEMALE:

System.out.println("å¥³"); break;

}

}

}`

è½¬æ¢åä»£ç ï¼š

`public class Candy7 {

/\*\*

\* å®šä¹‰ä¸€ä¸ªåˆæˆç±»ï¼ˆä»… jvm ä½¿ç”¨ï¼Œå¯¹æˆ‘ä»¬ä¸å¯è§ï¼‰

\* ç”¨æ¥æ˜ å°„æšä¸¾çš„ ordinal ä¸æ•°ç»„å…ƒç´ çš„å…³ç³»

\* æšä¸¾çš„ ordinal è¡¨ç¤ºæšä¸¾å¯¹è±¡çš„åºå·ï¼Œä» 0 å¼€å§‹

\* å³ MALE çš„ ordinal()=0ï¼ŒFEMALE çš„ ordinal()=1

\*/

static class $MAP {

// æ•°ç»„å¤§å°å³ä¸ºæšä¸¾å…ƒç´ ä¸ªæ•°ï¼Œé‡Œé¢å­˜å‚¨caseç”¨æ¥å¯¹æ¯”çš„æ•°å­—

static int[] map = new int[2];

static {

map[Sex.MALE.ordinal()] = 1;

map[Sex.FEMALE.ordinal()] = 2;

}

}

public static void foo(Sex sex) {

int x = $MAP.map[sex.ordinal()];

switch (x) {

case 1:

System.out.println("ç”·");

break;

case 2:

System.out.println("å¥³");

break;

}

}

}`

### 8. **æšä¸¾ç±»**

JDK 7 æ–°å¢äº†æšä¸¾ç±»ï¼Œä»¥å‰é¢çš„æ€§åˆ«æšä¸¾ä¸ºä¾‹ï¼š

`enum Sex {

MALE, FEMALE

}`

è½¬æ¢åä»£ç ï¼š

`public final class Sex extends Enum<Sex> {

public static final Sex MALE;

public static final Sex FEMALE;

private static final Sex[] $VALUES;

static {

MALE = new Sex("MALE", 0);

FEMALE = new Sex("FEMALE", 1);

$VALUES = new Sex[]{MALE, FEMALE};

}

/\*\*

\* Sole constructor. Programmers cannot invoke this constructor.

\* It is for use by code emitted by the compiler in response to

\* enum type declarations.

\*

\* @param name - The name of this enum constant, which is the identifier

\* used to declare it.

\* @param ordinal - The ordinal of this enumeration constant (its position

\* in the enum declaration, where the initial constant is

assigned

\*/

private Sex(String name, int ordinal) {

super(name, ordinal);

}

public static Sex[] values() {

return $VALUES.clone();

}

public static Sex valueOf(String name) {

return Enum.valueOf(Sex.class, name);

}

}`

### 9. **try-with-resources**

JDK 7 å¼€å§‹æ–°å¢äº†å¯¹éœ€è¦å…³é—­çš„èµ„æºå¤„ç†çš„ç‰¹æ®Šè¯­æ³• try-with-resources`ï¼š

`try(èµ„æºå˜é‡ = åˆ›å»ºèµ„æºå¯¹è±¡){

} catch( ) {

}`

å…¶ä¸­èµ„æºå¯¹è±¡éœ€è¦å®ç° AutoCloseable æ¥å£ï¼Œä¾‹å¦‚ InputStream ã€ OutputStream ã€

Connection ã€ Statement ã€ ResultSet ç­‰æ¥å£éƒ½å®ç°äº† AutoCloseable ï¼Œä½¿ç”¨ try-with

resources å¯ä»¥ä¸ç”¨å†™ finally è¯­å¥å—ï¼Œç¼–è¯‘å™¨ä¼šå¸®åŠ©ç”Ÿæˆå…³é—­èµ„æºä»£ç ï¼Œä¾‹å¦‚ï¼š

`public class Candy9 {

public static void main(String[] args) {

try(InputStream is = new FileInputStream("d:\1.txt")) {

System.out.println(is);

} catch (IOException e) {

e.printStackTrace();

}

}

}`

ä¼šè¢«è½¬æ¢ä¸ºï¼š

`public class Candy9 {

public Candy9() {

}

public static void main(String[] args) {

try {

InputStream is = new FileInputStream("d:\1.txt");

Throwable t = null;

try {

System.out.println(is);

} catch (Throwable e1) {

// t æ˜¯æˆ‘ä»¬ä»£ç å‡ºç°çš„å¼‚å¸¸

t = e1;

throw e1;

} finally {

// åˆ¤æ–­äº†èµ„æºä¸ä¸ºç©º

if (is != null) {

// å¦‚æœæˆ‘ä»¬ä»£ç æœ‰å¼‚å¸¸

if (t != null) {

try {

is.close();

} catch (Throwable e2) {

// å¦‚æœ close å‡ºç°å¼‚å¸¸ï¼Œä½œä¸ºè¢«å‹åˆ¶å¼‚å¸¸æ·»åŠ 

t.addSuppressed(e2);

}

} else {

// å¦‚æœæˆ‘ä»¬ä»£ç æ²¡æœ‰å¼‚å¸¸ï¼Œclose å‡ºç°çš„å¼‚å¸¸å°±æ˜¯æœ€å catch å—ä¸­çš„ e

is.close();

}

}

}

} catch (IOException e) {

e.printStackTrace();

}

}

}`

ä¼šå¸®æˆ‘ä»¬è¿›è¡Œèµ„æºçš„é‡Šæ”¾ï¼Œè€Œä¸”é‡Šæ”¾æ›´è§„èŒƒï¼Œä¸ä¼šä¸¢å¤±å¼‚å¸¸ä¿¡æ¯

### **10** . **æ–¹æ³•é‡å†™æ—¶çš„æ¡¥æ¥æ–¹æ³•**

æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ–¹æ³•é‡å†™æ—¶å¯¹è¿”å›å€¼åˆ†ä¸¤ç§æƒ…å†µï¼š

* çˆ¶å­ç±»çš„è¿”å›å€¼å®Œå…¨ä¸€è‡´
* å­ç±»è¿”å›å€¼å¯ä»¥æ˜¯çˆ¶ç±»è¿”å›å€¼çš„å­ç±»ï¼ˆæ¯”è¾ƒç»•å£ï¼Œè§ä¸‹é¢çš„ä¾‹å­ï¼‰

`class A { public Number m() { return 1; } } class B extends A { @Override // å­ç±» m æ–¹æ³•çš„è¿”å›å€¼æ˜¯ Integer æ˜¯çˆ¶ç±» m æ–¹æ³•è¿”å›å€¼ Number çš„å­ç±» public Integer m() { return 2; } }`

å¯¹äºå­ç±»ï¼Œjava ç¼–è¯‘å™¨ä¼šåšå¦‚ä¸‹å¤„ç†ï¼š

`class B extends A { public Integer m() { return 2; } // æ­¤æ–¹æ³•æ‰æ˜¯çœŸæ­£é‡å†™äº†çˆ¶ç±» public Number m() æ–¹æ³• public synthetic bridge Number m() { // è°ƒç”¨ public Integer m() return m(); } }`

å…¶ä¸­æ¡¥æ¥æ–¹æ³•æ¯”è¾ƒç‰¹æ®Šï¼Œä»…å¯¹ java è™šæ‹Ÿæœºå¯è§ï¼Œå¹¶ä¸”ä¸åŸæ¥çš„ public Integer m() æ²¡æœ‰å‘½åå†²çªï¼Œå¯ä»¥ ç”¨ä¸‹é¢åå°„ä»£ç æ¥éªŒè¯ï¼š

`public static void main(String[] args) { for(Method m : B.class.getDeclaredMethods()) { System.out.println(m); } }`

ç»“æœï¼š

`public java.lang.Integer cn.ali.jvm.test.B.m() public java.lang.Number cn.ali.jvm.test.B.m()`

### 11. **åŒ¿åå†…éƒ¨ç±»**

æºä»£ç ï¼š

`public class Candy11 {

public static void main(String[] args) {

Runnable runnable = new Runnable() {

@Override

public void run() {

System.out.println("ok");

}

};

}

}`

è½¬æ¢åä»£ç ï¼š

`// é¢å¤–ç”Ÿæˆçš„ç±»

final class Candy11$1 implements Runnable {

Candy11$1() {

}

public void run() {

System.out.println("ok");

}

}`

`public class Candy11 {

public static void main(String[] args) {

Runnable runnable = new Candy11$1();

}

}`

å¼•ç”¨å±€éƒ¨å˜é‡çš„åŒ¿åå†…éƒ¨ç±»ï¼Œæºä»£ç ï¼š

![](https://i-blog.csdnimg.cn/direct/bbef956677fd428b83d1da351ddf9a8d.png)

**æ³¨æ„**

è¿™åŒæ—¶è§£é‡Šäº†ä¸ºä»€ä¹ˆåŒ¿åå†…éƒ¨ç±»å¼•ç”¨å±€éƒ¨å˜é‡æ—¶ï¼Œå±€éƒ¨å˜é‡å¿…é¡»æ˜¯ final çš„ï¼šå› ä¸ºåœ¨åˆ›å»º

Candy11$1 å¯¹è±¡æ—¶ï¼Œå°† x çš„å€¼èµ‹å€¼ç»™äº† Candy11$1 å¯¹è±¡çš„ val$x å±æ€§ï¼Œæ‰€ä»¥ x ä¸åº”è¯¥å†å‘ç”Ÿå˜

åŒ–äº†ï¼Œå¦‚æœå˜åŒ–ï¼Œé‚£ä¹ˆ val$x å±æ€§æ²¡æœ‰æœºä¼šå†è·Ÿç€ä¸€èµ·å˜åŒ–

## å››ã€ç±»åŠ è½½

### 1ï¼‰åŠ è½½

å°†ç±»çš„å­—èŠ‚ç è½½å…¥æ–¹æ³•åŒºï¼ˆ1.8åä¸ºå…ƒç©ºé—´ï¼Œåœ¨æœ¬åœ°å†…å­˜ä¸­ï¼‰ä¸­ï¼Œå†…éƒ¨é‡‡ç”¨ C++ çš„ instanceKlass æè¿° java ç±»ï¼Œå®ƒçš„é‡è¦ ï¬eld æœ‰ï¼š

* \_java\_mirror å³ java çš„ç±»é•œåƒï¼Œä¾‹å¦‚å¯¹ String æ¥è¯´ï¼Œå®ƒçš„é•œåƒç±»å°±æ˜¯ String.classï¼Œä½œç”¨æ˜¯æŠŠ klass æš´éœ²ç»™ java ä½¿ç”¨
* \_super å³çˆ¶ç±»
* \_ï¬elds å³æˆå‘˜å˜é‡
* \_methods å³æ–¹æ³•
* \_constants å³å¸¸é‡æ± 
* \_class\_loader å³ç±»åŠ è½½å™¨
* \_vtable è™šæ–¹æ³•è¡¨
* \_itable æ¥å£æ–¹æ³•

å¦‚æœè¿™ä¸ªç±»è¿˜æœ‰çˆ¶ç±»æ²¡æœ‰åŠ è½½ï¼Œå…ˆåŠ è½½çˆ¶ç±» åŠ è½½å’Œé“¾æ¥å¯èƒ½æ˜¯äº¤æ›¿è¿è¡Œçš„

![](https://i-blog.csdnimg.cn/direct/ca5f5c14fda346e1a2ddf95819c4c3a6.png)

* instanceKlassä¿å­˜åœ¨æ–¹æ³•åŒºã€‚JDK 8ä»¥åï¼Œæ–¹æ³•åŒºä½äºå…ƒç©ºé—´ä¸­ï¼Œè€Œå…ƒç©ºé—´åˆä½äºæœ¬åœ°å†…å­˜ä¸­
* \_java\_mirroråˆ™æ˜¯ä¿å­˜åœ¨å †å†…å­˜ä¸­
* InstanceKlasså’Œ\*.class(JAVAé•œåƒç±»)äº’ç›¸ä¿å­˜äº†å¯¹æ–¹çš„åœ°å€
* ç±»çš„å¯¹è±¡åœ¨å¯¹è±¡å¤´ä¸­ä¿å­˜äº†\*.classçš„åœ°å€ã€‚è®©å¯¹è±¡å¯ä»¥é€šè¿‡å…¶æ‰¾åˆ°æ–¹æ³•åŒºä¸­çš„instanceKlassï¼Œä»è€Œè·å–ç±»çš„å„ç§ä¿¡æ¯

  **æ³¨æ„**

  instanceKlass è¿™æ ·çš„ã€å…ƒæ•°æ®ã€‘æ˜¯å­˜å‚¨åœ¨æ–¹æ³•åŒºï¼ˆ1.8 åçš„å…ƒç©ºé—´å†…ï¼‰ï¼Œä½† \_java\_mirror

  æ˜¯å­˜å‚¨åœ¨å †ä¸­

  å¯ä»¥é€šè¿‡å‰é¢ä»‹ç»çš„ HSDB å·¥å…·æŸ¥çœ‹

### 2ï¼‰è¿æ¥

#### 2.1éªŒè¯

éªŒè¯ç±»æ˜¯å¦ç¬¦åˆ JVMè§„èŒƒï¼Œå®‰å…¨æ€§æ£€æŸ¥ ç”¨ UE ç­‰æ”¯æŒäºŒè¿›åˆ¶çš„ç¼–è¾‘å™¨ä¿®æ”¹ HelloWorld.class çš„é­”æ•°ï¼Œåœ¨æ§åˆ¶å°è¿è¡Œ

#### 2.2å‡†å¤‡

ä¸º static å˜é‡åˆ†é…ç©ºé—´ï¼Œè®¾ç½®é»˜è®¤å€¼

* static å˜é‡åœ¨ JDK 7 ä¹‹å‰å­˜å‚¨äº instanceKlass æœ«å°¾ï¼Œä» JDK 7 å¼€å§‹ï¼Œå­˜å‚¨äº \_java\_mirror æœ«å°¾
* static å˜é‡åˆ†é…ç©ºé—´å’Œèµ‹å€¼æ˜¯ä¸¤ä¸ªæ­¥éª¤ï¼Œåˆ†é…ç©ºé—´åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆï¼Œèµ‹å€¼åœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆ
* å¦‚æœ static å˜é‡æ˜¯ final çš„åŸºæœ¬ç±»å‹ï¼Œä»¥åŠå­—ç¬¦ä¸²å¸¸é‡ï¼Œé‚£ä¹ˆç¼–è¯‘é˜¶æ®µå€¼å°±ç¡®å®šäº†ï¼Œèµ‹å€¼åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆ
* å¦‚æœ static å˜é‡æ˜¯ final çš„ï¼Œä½†å±äºå¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆèµ‹å€¼ä¹Ÿä¼šåœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨

`public class Code\_22\_AnalysisTest {

```
public static void main(String[] args) throws ClassNotFoundException, IOException {
 Â   ClassLoader classLoader = Code_22_AnalysisTest.class.getClassLoader();
 Â   Class<?> c = classLoader.loadClass("cn.ali.jvm.test.C");
â€‹
 Â   // new C();
 Â   System.in.read();
}
```

}

class C { D d = new D(); }

class D {

}`

#### 2.3 **è§£æ**

å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨

`package cn.xxxde.jvm.load;

/\*\*

\* è§£æçš„å«ä¹‰

\*/

public class Load2 {

public static void main(String[] args) throws ClassNotFoundException,

IOException {

ClassLoader classloader = Load2.class.getClassLoader();

// loadClass æ–¹æ³•ä¸ä¼šå¯¼è‡´ç±»çš„è§£æå’Œåˆå§‹åŒ–

Class<?> c = classloader.loadClass("cn.itcast.jvm.t3.load.C");

// new C();

System.in.read();

}

}

class C {

D d = new D();

}

class D {

}`

### 3ï¼‰åˆå§‹åŒ–

<cinit>()v æ–¹æ³• åˆå§‹åŒ–å³è°ƒç”¨ <cinit>()V ï¼Œè™šæ‹Ÿæœºä¼šä¿è¯è¿™ä¸ªç±»çš„ã€æ„é€ æ–¹æ³•ã€çš„çº¿ç¨‹å®‰å…¨

å‘ç”Ÿçš„æ—¶æœº æ¦‚æ‹¬å¾—è¯´ï¼Œç±»åˆå§‹åŒ–æ˜¯ã€æ‡’æƒ°çš„ã€‘

* main æ–¹æ³•æ‰€åœ¨çš„ç±»ï¼Œæ€»ä¼šè¢«é¦–å…ˆåˆå§‹åŒ–
* é¦–æ¬¡è®¿é—®è¿™ä¸ªç±»çš„é™æ€å˜é‡æˆ–é™æ€æ–¹æ³•æ—¶
* å­ç±»åˆå§‹åŒ–ï¼Œå¦‚æœçˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå¼•å‘
* å­ç±»è®¿é—®çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–
* Class.forName
* new ä¼šå¯¼è‡´åˆå§‹åŒ–

ä¸ä¼šå¯¼è‡´ç±»åˆå§‹åŒ–çš„æƒ…å†µ

* è®¿é—®ç±»çš„ static final é™æ€å¸¸é‡ï¼ˆåŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ï¼‰ä¸ä¼šè§¦å‘åˆå§‹åŒ–
* ç±»å¯¹è±¡.class ä¸ä¼šè§¦å‘åˆå§‹åŒ–
* åˆ›å»ºè¯¥ç±»çš„æ•°ç»„ä¸ä¼šè§¦å‘åˆå§‹åŒ–

`public class Load1 { static { System.out.println("main init"); } public static void main(String[] args) throws ClassNotFoundException { // 1. é™æ€å¸¸é‡ï¼ˆåŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ï¼‰ä¸ä¼šè§¦å‘åˆå§‹åŒ– // System.out.println(B.b); // 2. ç±»å¯¹è±¡.class ä¸ä¼šè§¦å‘åˆå§‹åŒ– // System.out.println(B.class); // 3. åˆ›å»ºè¯¥ç±»çš„æ•°ç»„ä¸ä¼šè§¦å‘åˆå§‹åŒ– // System.out.println(new B[0]); // 4. ä¸ä¼šåˆå§‹åŒ–ç±» Bï¼Œä½†ä¼šåŠ è½½ Bã€A // ClassLoader cl = Thread.currentThread().getContextClassLoader(); // cl.loadClass("cn.ali.jvm.test.classload.B"); // 5. ä¸ä¼šåˆå§‹åŒ–ç±» Bï¼Œä½†ä¼šåŠ è½½ Bã€A // ClassLoader c2 = Thread.currentThread().getContextClassLoader(); // Class.forName("cn.ali.jvm.test.classload.B", false, c2);

```
 Â   // 1. é¦–æ¬¡è®¿é—®è¿™ä¸ªç±»çš„é™æ€å˜é‡æˆ–é™æ€æ–¹æ³•æ—¶
```

// System.out.println(A.a); // 2. å­ç±»åˆå§‹åŒ–ï¼Œå¦‚æœçˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå¼•å‘ // System.out.println(B.c); // 3. å­ç±»è®¿é—®çˆ¶ç±»é™æ€å˜é‡ï¼Œåªè§¦å‘çˆ¶ç±»åˆå§‹åŒ– // System.out.println(B.a); // 4. ä¼šåˆå§‹åŒ–ç±» Bï¼Œå¹¶å…ˆåˆå§‹åŒ–ç±» A // Class.forName("cn.ali.jvm.test.classload.B"); }

}

class A { static int a = 0; static { System.out.println("a init"); } } class B extends A { final static double b = 5.0; static boolean c = false; static { System.out.println("b init"); } }`

### 4ï¼‰ç»ƒä¹ 

![](https://i-blog.csdnimg.cn/direct/78d43908db404b2dad8bd89010fa4a4b.png)

## äº”ã€ç±»åŠ è½½å™¨ï¼ˆ *xxxde* eï¼‰

![](https://i-blog.csdnimg.cn/direct/4cd0e84d42fb4600b21396144f0f7389.png)

ä»ä¸‹å¾€ä¸Šè¯¢é—®ï¼Œä»ä¸Šå¾€ä¸‹åŠ è½½

### 1. **å¯åŠ¨ç±»åŠ è½½å™¨**

ç”¨ Bootstrap ç±»åŠ è½½å™¨åŠ è½½ç±»å¹¶æ‰§è¡Œï¼š

`package com.xxxde.jvm.t3.load;

public class F {

static {

System.out.println("bootstrap F init");

}

}`

`package com.xxxde.jvm.t3.load;

public class Load5\_1 {

public static void main(String[] args) throws ClassNotFoundException {

Class<?> aClass = Class.forName("cn.itcast.jvm.t3.load.F");

System.out.println(aClass.getClassLoader());

}

}`

è¾“å‡º

`D:\jvm>java -Xbootclasspath/a:. com.xxxde.jvm.t3.load.Load5

bootstrap F init

null`

è§£é‡Šï¼š

* -Xbootclasspath è¡¨ç¤ºè®¾ç½® bootclasspath
* å…¶ä¸­ /a:. è¡¨ç¤ºå°†å½“å‰ç›®å½•è¿½åŠ è‡³ bootclasspath ä¹‹å
* å¯ä»¥ç”¨è¿™ä¸ªåŠæ³•æ›¿æ¢æ ¸å¿ƒç±»

  + java -Xbootclasspath:<new bootclasspath>
  + java -Xbootclasspath/a:<è¿½åŠ è·¯å¾„>
  + java -Xbootclasspath/p:<è¿½åŠ è·¯å¾„>

### **2** **æ‰©å±•ç±»åŠ è½½å™¨**

å¦‚æœ classpath å’Œ JAVA\_HOME/jre/lib/ext ä¸‹æœ‰åŒåç±»ï¼ŒåŠ è½½æ—¶ä¼šä½¿ç”¨æ‹“å±•ç±»åŠ è½½å™¨åŠ è½½ã€‚å½“åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨å‘ç°æ‹“å±•ç±»åŠ è½½å™¨å·²å°†è¯¥åŒåç±»åŠ è½½è¿‡äº†ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŠ è½½ã€‚

### 3.åŒäº²å§”æ´¾æ¨¡å¼

åŒäº²å§”æ´¾æ¨¡å¼ï¼Œå³è°ƒç”¨ç±»åŠ è½½å™¨ClassLoader çš„ loadClass æ–¹æ³•æ—¶ï¼ŒæŸ¥æ‰¾ç±»çš„è§„åˆ™ã€‚

**æ³¨æ„**

è¿™é‡Œçš„åŒäº²ï¼Œç¿»è¯‘ä¸ºä¸Šçº§ä¼¼ä¹æ›´ä¸ºåˆé€‚ï¼Œå› ä¸ºå®ƒä»¬å¹¶æ²¡æœ‰ç»§æ‰¿å…³ç³»

loadClassæºç ï¼š

`protected Class<?> loadClass(String name, boolean resolve) throws ClassNotFoundException { synchronized (getClassLoadingLock(name)) { // é¦–å…ˆæŸ¥æ‰¾è¯¥ç±»æ˜¯å¦å·²ç»è¢«è¯¥ç±»åŠ è½½å™¨åŠ è½½è¿‡äº† Class<?> c = findLoadedClass(name); // å¦‚æœæ²¡æœ‰è¢«åŠ è½½è¿‡ if (c == null) { long t0 = System.nanoTime(); try { // çœ‹æ˜¯å¦è¢«å®ƒçš„ä¸Šçº§åŠ è½½å™¨åŠ è½½è¿‡äº† Extension çš„ä¸Šçº§æ˜¯Bootstarpï¼Œä½†å®ƒæ˜¾ç¤ºä¸ºnull if (parent != null) { c = parent.loadClass(name, false); } else { // çœ‹æ˜¯å¦è¢«å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½è¿‡ c = findBootstrapClassOrNull(name); } } catch (ClassNotFoundException e) { // ClassNotFoundException thrown if class not found // from the non-null parent class loader //æ•è·å¼‚å¸¸ï¼Œä½†ä¸åšä»»ä½•å¤„ç† }

```
 Â  Â  Â   if (c == null) {
 Â  Â  Â  Â  Â   // å¦‚æœè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°ï¼Œå…ˆè®©æ‹“å±•ç±»åŠ è½½å™¨è°ƒç”¨ findClass æ–¹æ³•å»æ‰¾åˆ°è¯¥ç±»ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼Œå°±æŠ›å‡ºå¼‚å¸¸
 Â  Â  Â  Â  Â   // ç„¶åè®©åº”ç”¨ç±»åŠ è½½å™¨å»æ‰¾ classpath ä¸‹æ‰¾è¯¥ç±»
 Â  Â  Â  Â  Â   long t1 = System.nanoTime();
 Â  Â  Â  Â  Â   c = findClass(name);
â€‹
 Â  Â  Â  Â  Â   // è®°å½•æ—¶é—´
 Â  Â  Â  Â  Â   sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);
 Â  Â  Â  Â  Â   sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);
 Â  Â  Â  Â  Â   sun.misc.PerfCounter.getFindClasses().increment();
 Â  Â  Â   }
 Â   }
 Â   if (resolve) {
 Â  Â  Â   resolveClass(c);
 Â   }
 Â   return c;
}
```

}`

### 4.è‡ªå®šä¹‰ç±»åŠ è½½å™¨

**ä½¿ç”¨åœºæ™¯**

* æƒ³åŠ è½½é classpath éšæ„è·¯å¾„ä¸­çš„ç±»æ–‡ä»¶
* é€šè¿‡æ¥å£æ¥ä½¿ç”¨å®ç°ï¼Œå¸Œæœ›è§£è€¦æ—¶ï¼Œå¸¸ç”¨åœ¨æ¡†æ¶è®¾è®¡
* è¿™äº›ç±»å¸Œæœ›äºˆä»¥éš”ç¦»ï¼Œä¸åŒåº”ç”¨çš„åŒåç±»éƒ½å¯ä»¥åŠ è½½ï¼Œä¸å†²çªï¼Œå¸¸è§äº tomcat å®¹å™¨

**æ­¥éª¤**

* ç»§æ‰¿ ClassLoader çˆ¶ç±»
* è¦éµä»åŒäº²å§”æ´¾æœºåˆ¶ï¼Œé‡å†™ ï¬ndClass æ–¹æ³•
* ä¸æ˜¯é‡å†™ loadClass æ–¹æ³•ï¼Œå¦åˆ™ä¸ä¼šèµ°åŒäº²å§”æ´¾æœºåˆ¶
* è¯»å–ç±»æ–‡ä»¶çš„å­—èŠ‚ç 
* è°ƒç”¨çˆ¶ç±»çš„ deï¬neClass æ–¹æ³•æ¥åŠ è½½ç±»
* ä½¿ç”¨è€…è°ƒç”¨è¯¥ç±»åŠ è½½å™¨çš„ loadClass æ–¹æ³•

**ç ´ååŒäº²å§”æ´¾æ¨¡å¼**

* åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬ä¸€æ¬¡â€œè¢«ç ´åâ€å…¶å®å‘ç”Ÿåœ¨åŒäº²å§”æ´¾æ¨¡å‹å‡ºç°ä¹‹å‰â€”â€”å³JDK1.2é¢ä¸–ä»¥å‰çš„â€œè¿œå¤â€æ—¶ä»£

  + å»ºè®®ç”¨æˆ·é‡å†™findClass()æ–¹æ³•ï¼Œåœ¨ç±»åŠ è½½å™¨ä¸­çš„loadClass()æ–¹æ³•ä¸­ä¹Ÿä¼šè°ƒç”¨è¯¥æ–¹æ³•
* åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬äºŒæ¬¡â€œè¢«ç ´åâ€æ˜¯ç”±è¿™ä¸ªæ¨¡å‹è‡ªèº«çš„ç¼ºé™·å¯¼è‡´çš„

  + å¦‚æœæœ‰åŸºç¡€ç±»å‹åˆè¦è°ƒç”¨å›ç”¨æˆ·çš„ä»£ç ï¼Œæ­¤æ—¶ä¹Ÿä¼šç ´ååŒäº²å§”æ´¾æ¨¡å¼
* åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬ä¸‰æ¬¡â€œè¢«ç ´åâ€æ˜¯ç”±äºç”¨æˆ·å¯¹ç¨‹åºåŠ¨æ€æ€§çš„è¿½æ±‚è€Œå¯¼è‡´çš„

  + è¿™é‡Œæ‰€è¯´çš„â€œåŠ¨æ€æ€§â€æŒ‡çš„æ˜¯ä¸€äº›éå¸¸â€œçƒ­â€é—¨çš„åè¯ï¼šä»£ç çƒ­æ›¿æ¢ï¼ˆHot Swapï¼‰ã€æ¨¡å—çƒ­éƒ¨ç½²ï¼ˆHot Deploymentï¼‰ç­‰

## å…­ã€è¿è¡ŒæœŸä¼˜åŒ–

### 1. **å³æ—¶ç¼–è¯‘**

#### 1.1 **åˆ†å±‚ç¼–è¯‘**

ç¤ºä¾‹ä»£ç ï¼š

`public class JIT1 {

public static void main(String[] args) {

for (int i = 0; i < 200; i++) {

long start = System.nanoTime();

for (int j = 0; j < 1000; j++) {

new Object();

}

long end = System.nanoTime();

System.out.printf("%d\t%d\n",i,(end - start));

}

}

}`

ç»“æœæ˜¯ï¼šåˆšå¼€å§‹æ˜¯5ä½æ•°åŸºæœ¬ä¸Šéƒ½å¤§äº50000ï¼Œåé¢æ…¢æ…¢å˜æˆä»¥ä¸€å¼€å¤´çš„å¤§æ¦‚50å·¦å³ï¼Œåœ¨130å¤šæ¬¡æ—¶å˜ä¸ºä¸‰ä½æ•°

è§£é‡Šï¼š

**JVM å°†æ‰§è¡ŒçŠ¶æ€åˆ†æˆäº† 5 ä¸ªå±‚æ¬¡ï¼š**

* 0 å±‚ï¼Œè§£é‡Šæ‰§è¡Œï¼ˆInterpreterï¼‰
* 1 å±‚ï¼Œä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼ˆä¸å¸¦ profilingï¼‰
* 2 å±‚ï¼Œä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼ˆå¸¦åŸºæœ¬çš„ profilingï¼‰
* 3 å±‚ï¼Œä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼ˆå¸¦å®Œå…¨çš„ profilingï¼‰
* 4 å±‚ï¼Œä½¿ç”¨ C2 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œ

profiling æ˜¯æŒ‡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ”¶é›†ä¸€äº›ç¨‹åºæ‰§è¡ŒçŠ¶æ€çš„æ•°æ®ï¼Œä¾‹å¦‚ã€æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°ã€‘ï¼Œã€å¾ªç¯çš„

å›è¾¹æ¬¡æ•°ã€‘ç­‰

**å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸è§£é‡Šå™¨çš„åŒºåˆ«**

* è§£é‡Šå™¨æ˜¯å°†å­—èŠ‚ç è§£é‡Šä¸ºæœºå™¨ç ï¼Œä¸‹æ¬¡å³ä½¿é‡åˆ°ç›¸åŒçš„å­—èŠ‚ç ï¼Œä»ä¼šæ‰§è¡Œé‡å¤çš„è§£é‡Š
* JIT æ˜¯å°†ä¸€äº›å­—èŠ‚ç ç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œå¹¶å­˜å…¥ Code Cacheï¼Œä¸‹æ¬¡é‡åˆ°ç›¸åŒçš„ä»£ç ï¼Œç›´æ¥æ‰§è¡Œï¼Œæ— éœ€
* å†ç¼–è¯‘
* è§£é‡Šå™¨æ˜¯å°†å­—èŠ‚ç è§£é‡Šä¸ºé’ˆå¯¹æ‰€æœ‰å¹³å°éƒ½é€šç”¨çš„æœºå™¨ç 
* JIT ä¼šæ ¹æ®å¹³å°ç±»å‹ï¼Œç”Ÿæˆå¹³å°ç‰¹å®šçš„æœºå™¨ç 

æ€»ï¼šå¯¹äºå æ®å¤§éƒ¨åˆ†çš„ä¸å¸¸ç”¨çš„ä»£ç ï¼Œæˆ‘ä»¬æ— éœ€è€—è´¹æ—¶é—´å°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œè€Œæ˜¯é‡‡å–è§£é‡Šæ‰§è¡Œçš„æ–¹å¼è¿

è¡Œï¼›å¦ä¸€æ–¹é¢ï¼Œå¯¹äºä»…å æ®å°éƒ¨åˆ†çš„çƒ­ç‚¹ä»£ç ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥å°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œä»¥è¾¾åˆ°ç†æƒ³çš„è¿è¡Œé€Ÿ

åº¦ã€‚ æ‰§è¡Œæ•ˆç‡ä¸Šç®€å•æ¯”è¾ƒä¸€ä¸‹ Interpreter < C1 < C2ï¼Œæ€»çš„ç›®æ ‡æ˜¯å‘ç°çƒ­ç‚¹ä»£ç ï¼ˆhotspotåç§°çš„ç”±

æ¥ï¼‰ï¼Œä¼˜åŒ–ä¹‹

åˆšæ‰çš„ä¸€ç§ä¼˜åŒ–æ‰‹æ®µç§°ä¹‹ä¸ºã€é€ƒé€¸åˆ†æã€‘ï¼Œå‘ç°æ–°å»ºçš„å¯¹è±¡æ˜¯å¦é€ƒé€¸ã€‚å¯ä»¥ä½¿ç”¨ -XX:-

DoEscapeAnalysis å…³é—­é€ƒé€¸åˆ†æï¼Œå†è¿è¡Œåˆšæ‰çš„ç¤ºä¾‹è§‚å¯Ÿç»“æœ

---

**é€ƒé€¸åˆ†æ**
é€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰ç®€å•æ¥è®²å°±æ˜¯ï¼ŒJava Hotspot è™šæ‹Ÿæœºå¯ä»¥åˆ†ææ–°åˆ›å»ºå¯¹è±¡çš„ä½¿ç”¨èŒƒå›´ï¼Œå¹¶å†³å®šæ˜¯å¦åœ¨ Java å †ä¸Šåˆ†é…å†…å­˜çš„ä¸€é¡¹æŠ€æœ¯

**é€ƒé€¸åˆ†æçš„ JVM å‚æ•°å¦‚ä¸‹ï¼š**

* å¼€å¯é€ƒé€¸åˆ†æï¼š-XX:+DoEscapeAnalysis
* å…³é—­é€ƒé€¸åˆ†æï¼š-XX:-DoEscapeAnalysis
* æ˜¾ç¤ºåˆ†æç»“æœï¼š-XX:+PrintEscapeAnalysis
* é€ƒé€¸åˆ†ææŠ€æœ¯åœ¨ Java SE 6u23+ å¼€å§‹æ”¯æŒï¼Œå¹¶é»˜è®¤è®¾ç½®ä¸ºå¯ç”¨çŠ¶æ€ï¼Œå¯ä»¥ä¸ç”¨é¢å¤–åŠ è¿™ä¸ªå‚æ•°

**å¯¹è±¡é€ƒé€¸çŠ¶æ€**

**å…¨å±€é€ƒé€¸ï¼ˆGlobalEscapeï¼‰**

* å³ä¸€ä¸ªå¯¹è±¡çš„ä½œç”¨èŒƒå›´é€ƒå‡ºäº†å½“å‰æ–¹æ³•æˆ–è€…å½“å‰çº¿ç¨‹ï¼Œæœ‰ä»¥ä¸‹å‡ ç§åœºæ™¯ï¼š

  + å¯¹è±¡æ˜¯ä¸€ä¸ªé™æ€å˜é‡
  + å¯¹è±¡æ˜¯ä¸€ä¸ªå·²ç»å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡
  + å¯¹è±¡ä½œä¸ºå½“å‰æ–¹æ³•çš„è¿”å›å€¼

**å‚æ•°é€ƒé€¸ï¼ˆArgEscapeï¼‰**

* å³ä¸€ä¸ªå¯¹è±¡è¢«ä½œä¸ºæ–¹æ³•å‚æ•°ä¼ é€’æˆ–è€…è¢«å‚æ•°å¼•ç”¨ï¼Œä½†åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ä¸ä¼šå‘ç”Ÿå…¨å±€é€ƒé€¸ï¼Œè¿™ä¸ªçŠ¶æ€æ˜¯é€šè¿‡è¢«è°ƒæ–¹æ³•çš„å­—èŠ‚ç ç¡®å®šçš„

**æ²¡æœ‰é€ƒé€¸**

* å³æ–¹æ³•ä¸­çš„å¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸

**é€ƒé€¸åˆ†æä¼˜åŒ–**

* é’ˆå¯¹ä¸Šé¢ç¬¬ä¸‰ç‚¹ï¼Œå½“ä¸€ä¸ªå¯¹è±¡æ²¡æœ‰é€ƒé€¸æ—¶ï¼Œå¯ä»¥å¾—åˆ°ä»¥ä¸‹å‡ ä¸ªè™šæ‹Ÿæœºçš„ä¼˜åŒ–

**é”æ¶ˆé™¤**
æˆ‘ä»¬çŸ¥é“çº¿ç¨‹åŒæ­¥é”æ˜¯éå¸¸ç‰ºç‰²æ€§èƒ½çš„ï¼Œå½“ç¼–è¯‘å™¨ç¡®å®šå½“å‰å¯¹è±¡åªæœ‰å½“å‰çº¿ç¨‹ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±ä¼šç§»é™¤è¯¥å¯¹è±¡çš„åŒæ­¥é” ä¾‹å¦‚ï¼ŒStringBuffer å’Œ Vector éƒ½æ˜¯ç”¨ synchronized ä¿®é¥°çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå®ƒä»¬éƒ½åªæ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸­ç”¨åˆ°ï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±ä¼šä¼˜åŒ–ç§»é™¤æ‰è¿™äº›é”æ“ä½œ é”æ¶ˆé™¤çš„ JVM å‚æ•°å¦‚ä¸‹ï¼š

* å¼€å¯é”æ¶ˆé™¤ï¼š-XX:+EliminateLocks
* å…³é—­é”æ¶ˆé™¤ï¼š-XX:-EliminateLocks

é”æ¶ˆé™¤åœ¨ JDK8 ä¸­éƒ½æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¹¶ä¸”é”æ¶ˆé™¤éƒ½è¦å»ºç«‹åœ¨é€ƒé€¸åˆ†æçš„åŸºç¡€ä¸Š

**æ ‡é‡æ›¿æ¢**
é¦–å…ˆè¦æ˜ç™½æ ‡é‡å’Œèšåˆé‡ï¼ŒåŸºç¡€ç±»å‹å’Œå¯¹è±¡çš„å¼•ç”¨å¯ä»¥ç†è§£ä¸ºæ ‡é‡ï¼Œå®ƒä»¬ä¸èƒ½è¢«è¿›ä¸€æ­¥åˆ†è§£ã€‚è€Œèƒ½è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡å°±æ˜¯èšåˆé‡ï¼Œæ¯”å¦‚ï¼šå¯¹è±¡ å¯¹è±¡æ˜¯èšåˆé‡ï¼Œå®ƒåˆå¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£æˆæ ‡é‡ï¼Œå°†å…¶æˆå‘˜å˜é‡åˆ†è§£ä¸ºåˆ†æ•£çš„å˜é‡ï¼Œè¿™å°±å«åšæ ‡é‡æ›¿æ¢ã€‚

è¿™æ ·ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸ï¼Œé‚£å‹æ ¹å°±ä¸ç”¨åˆ›å»ºå®ƒï¼Œåªä¼šåœ¨æ ˆæˆ–è€…å¯„å­˜å™¨ä¸Šåˆ›å»ºå®ƒç”¨åˆ°çš„æˆå‘˜æ ‡é‡ï¼ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ï¼Œä¹Ÿæå‡äº†åº”ç”¨ç¨‹åºæ€§èƒ½ æ ‡é‡æ›¿æ¢çš„ JVM å‚æ•°å¦‚ä¸‹ï¼š

* å¼€å¯æ ‡é‡æ›¿æ¢ï¼š-XX:+EliminateAllocations
* å…³é—­æ ‡é‡æ›¿æ¢ï¼š-XX:-EliminateAllocations
* æ˜¾ç¤ºæ ‡é‡æ›¿æ¢è¯¦æƒ…ï¼š-XX:+PrintEliminateAllocations

æ ‡é‡æ›¿æ¢åŒæ ·åœ¨ JDK8 ä¸­éƒ½æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¹¶ä¸”éƒ½è¦å»ºç«‹åœ¨é€ƒé€¸åˆ†æçš„åŸºç¡€ä¸Š

**æ ˆä¸Šåˆ†é…**
å½“å¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸æ—¶ï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥é€šè¿‡æ ‡é‡æ›¿æ¢åˆ†è§£æˆæˆå‘˜æ ‡é‡åˆ†é…åœ¨æ ˆå†…å­˜ä¸­ï¼Œå’Œæ–¹æ³•çš„ç”Ÿå‘½å‘¨æœŸä¸€è‡´ï¼Œéšç€æ ˆå¸§å‡ºæ ˆæ—¶é”€æ¯ï¼Œå‡å°‘äº† GC å‹åŠ›ï¼Œæé«˜äº†åº”ç”¨ç¨‹åºæ€§èƒ½

#### 1.2æ–¹æ³•å†…è”

å¦‚æœå‘ç°æŸæ®µæ˜¯çƒ­ç‚¹æ–¹æ³•ï¼Œå¹¶ä¸”é•¿åº¦ä¸å¤ªé•¿æ—¶ï¼Œä¼šè¿›è¡Œå†…è”ï¼Œæ‰€è°“çš„å†…è”å°±æ˜¯æŠŠæ–¹æ³•å†…ä»£ç æ‹·è´ã€

ç²˜è´´åˆ°è°ƒç”¨è€…çš„ä½ç½®è¿˜èƒ½å¤Ÿè¿›è¡Œå¸¸é‡æŠ˜å ï¼ˆconstant foldingï¼‰çš„ä¼˜åŒ–ã€‚

ä¾‹å¦‚ï¼š

![](https://i-blog.csdnimg.cn/direct/162c9e47f15c4dde8a55555650fb99e9.png)

åœ¨æ‰§è¡Œ200å·¦å³å æ—¶é—´ä¼šä¸º0

#### 1.3 **å­—æ®µä¼˜åŒ–**

### 2.åå°„ä¼˜åŒ–

```
public class Reflect1 {
 Â  public static void foo() {
 Â  Â   System.out.println("foo...");
 Â  }
â€‹
 Â  public static void main(String[] args) throws NoSuchMethodException, InvocationTargetException, IllegalAccessException {
 Â  Â   Method foo = Demo3.class.getMethod("foo");
 Â  Â   for(int i = 0; i<=16; i++) {
 Â  Â  Â  Â  foo.invoke(null);
 Â  Â   }
 Â  }
}
â€‹
```

foo.invoke å‰é¢ 0 ~ 15 æ¬¡è°ƒç”¨ä½¿ç”¨çš„æ˜¯ MethodAccessor çš„ NativeMethodAccessorImpl å®ç° invoke æ–¹æ³•æºç 

```
@CallerSensitive
public Object invoke(Object obj, Object... args)
 Â   throws IllegalAccessException, IllegalArgumentException,
 Â  Â  Â  InvocationTargetException
{
 Â   if (!override) {
 Â  Â  Â   if (!Reflection.quickCheckMemberAccess(clazz, modifiers)) {
 Â  Â  Â  Â  Â   Class<?> caller = Reflection.getCallerClass();
 Â  Â  Â  Â  Â   checkAccess(caller, clazz, obj, modifiers);
 Â  Â  Â   }
 Â   }
 Â   //MethodAccessoræ˜¯ä¸€ä¸ªæ¥å£ï¼Œæœ‰3ä¸ªå®ç°ç±»ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯æŠ½è±¡ç±»
 Â   MethodAccessor ma = methodAccessor; Â  Â  Â  Â  Â  Â  // read volatile
 Â   if (ma == null) {
 Â  Â  Â   ma = acquireMethodAccessor();
 Â   }
 Â   return ma.invoke(obj, args);
}
â€‹
```

![](https://i-blog.csdnimg.cn/direct/e1aea882eb0749718f2dd1a4187befd5.png)

ä¼šç”± DelegatingMehodAccessorImpl å»è°ƒç”¨ NativeMethodAccessorImpl NativeMethodAccessorImpl æºç 

```
class NativeMethodAccessorImpl extends MethodAccessorImpl {
 Â   private final Method method;
 Â   private DelegatingMethodAccessorImpl parent;
 Â   private int numInvocations;
â€‹
 Â   NativeMethodAccessorImpl(Method var1) {
 Â  Â  Â   this.method = var1;
 Â   }
    
    //æ¯æ¬¡è¿›è¡Œåå°„è°ƒç”¨ï¼Œä¼šè®©numInvocationä¸ReflectionFactory.inflationThresholdçš„å€¼ï¼ˆ15ï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶ä½¿ä½¿å¾—numInvocationçš„å€¼åŠ ä¸€
    //å¦‚æœnumInvocation>ReflectionFactory.inflationThresholdï¼Œåˆ™ä¼šè°ƒç”¨æœ¬åœ°æ–¹æ³•invoke0æ–¹æ³•
 Â   public Object invoke(Object var1, Object[] var2) throws IllegalArgumentException, InvocationTargetException {
 Â  Â  Â   if (++this.numInvocations > ReflectionFactory.inflationThreshold() && !ReflectUtil.isVMAnonymousClass(this.method.getDeclaringClass())) {
 Â  Â  Â  Â  Â   MethodAccessorImpl var3 = (MethodAccessorImpl)(new MethodAccessorGenerator()).generateMethod(this.method.getDeclaringClass(), this.method.getName(), this.method.getParameterTypes(), this.method.getReturnType(), this.method.getExceptionTypes(), this.method.getModifiers());
 Â  Â  Â  Â  Â   this.parent.setDelegate(var3);
 Â  Â  Â   }
â€‹
 Â  Â  Â   return invoke0(this.method, var1, var2);
 Â   }
â€‹
 Â   void setParent(DelegatingMethodAccessorImpl var1) {
 Â  Â  Â   this.parent = var1;
 Â   }
â€‹
 Â   private static native Object invoke0(Method var0, Object var1, Object[] var2);
}
â€‹
```

```
//ReflectionFactory.inflationThreshold()æ–¹æ³•çš„è¿”å›å€¼
private static int inflationThreshold = 15;
â€‹
```

* ä¸€å¼€å§‹ifæ¡ä»¶ä¸æ»¡è¶³ï¼Œå°±ä¼šè°ƒç”¨æœ¬åœ°æ–¹æ³• invoke0
* éšç€ numInvocation çš„å¢å¤§ï¼Œå½“å®ƒå¤§äº ReflectionFactory.inflationThreshold çš„å€¼ 16 æ—¶ï¼Œå°±ä¼šæœ¬åœ°æ–¹æ³•è®¿é—®å™¨æ›¿æ¢ä¸ºä¸€ä¸ªè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„è®¿é—®å™¨ï¼Œæ¥æé«˜æ•ˆç‡

  + è¿™æ—¶ä¼šä»åå°„è°ƒç”¨å˜ä¸ºæ­£å¸¸è°ƒç”¨ï¼Œå³ç›´æ¥è°ƒç”¨ Reflect1.foo()

    ![](https://i-blog.csdnimg.cn/direct/ebefdc8c03d645088b3e06aef405f8fa.png)

å·¥å…·ï¼š
[GitCode - å…¨çƒå¼€å‘è€…çš„å¼€æºç¤¾åŒº,å¼€æºä»£ç æ‰˜ç®¡å¹³å°](https://gitcode.com/gh_mirrors/ar/arthas?utm_source=highlight_word_gitcode&word=arthas&isLogin=1 "GitCode - å…¨çƒå¼€å‘è€…çš„å¼€æºç¤¾åŒº,å¼€æºä»£ç æ‰˜ç®¡å¹³å°")