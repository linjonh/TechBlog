---
layout: post
title: "可狱可囚的爬虫系列课程-18成都在售新房数据爬虫lxml-模块实战"
date: 2025-03-08 14:42:39 +0800
description: "上一篇文章中带大家学习了 lxml 模块以及 XPath 语法，本文针对某网新房数据编写爬虫进行实战。"
keywords: "可狱可囚的爬虫系列课程 18：成都在售新房数据爬虫（lxml 模块）实战"
categories: ['爬虫']
tags: ['爬虫', 'Python']
artid: "146116312"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146116312
    alt: "可狱可囚的爬虫系列课程-18成都在售新房数据爬虫lxml-模块实战"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146116312
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146116312
cover: https://bing.ee123.net/img/rand?artid=146116312
image: https://bing.ee123.net/img/rand?artid=146116312
img: https://bing.ee123.net/img/rand?artid=146116312
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     可狱可囚的爬虫系列课程 18：成都在售新房数据爬虫（lxml 模块）实战
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atelier-sulphurpool-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     上一篇文章中带大家学习了 lxml 模块以及 XPath 语法，本文针对某网新房数据编写爬虫进行实战。
    </p>
    <h3 id="OGukc">
     一、网页信息的获取
    </h3>
    <p>
     抓取地址：
     <a href="https://cd.fang.lianjia.com/loupan/" rel="nofollow">
      https://cd.fang.lianjia.com/loupan/
     </a>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/2829d1aa3ba6298a8c957fb286796678.png"/>
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> requests

Link <span class="token operator">=</span> <span class="token string">'https://cd.fang.lianjia.com/loupan/'</span>
Headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>Link<span class="token punctuation">,</span> headers<span class="token operator">=</span>Headers<span class="token punctuation">)</span>
<span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
    html_source <span class="token operator">=</span> response<span class="token punctuation">.</span>text
    <span class="token keyword">print</span><span class="token punctuation">(</span>html_source<span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'状态码：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>response<span class="token punctuation">.</span>status_code<span class="token punctuation">}</span></span><span class="token string">, 请检查'</span></span><span class="token punctuation">)</span>
</code></pre>
    <h3 id="lq3bZ">
     二、新房数据的抓取
    </h3>
    （1）当前页面所有在售新房获取
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/31390b31798544c1da188a92f8508ec8.png"/>
    </p>
    <pre><code class="prism language-python">root <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>html_source<span class="token punctuation">)</span>
<span class="token comment"># 找到所有房屋信息对应的 li 标签，构建 li 列表</span>
li_list <span class="token operator">=</span> root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/ul[@class="resblock-list-wrapper"]/li'</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     （2）部分房屋信息抓取
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/d438c65adacc245627350b3a51843bb9.png"/>
    </p>
    <pre><code class="prism language-python"><span class="token keyword">for</span> li <span class="token keyword">in</span> li_list<span class="token punctuation">:</span>
    <span class="token comment"># 经过分析，房屋名称信息较好获取，而要获得房屋面积单价则需要借助分支语法</span>
    house_name <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]/h2/a/text()'</span><span class="token punctuation">)</span>  <span class="token comment"># 房屋名称</span>
    house_unit_price <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[6]/div[1]/span[1]/text()|./div/div[6]/div[1]/span[2]/text()'</span><span class="token punctuation">)</span>  <span class="token comment"># 房屋面积单价</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>house_name<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>house_unit_price<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h3 id="mdhH3">
     三、完整代码
    </h3>
    爬虫代码的编写，除了要有扎实的基础知识外，还要善于分析网页内容。
    <pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree

Link <span class="token operator">=</span> <span class="token string">'https://cd.fang.lianjia.com/loupan/'</span>
Headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>Link<span class="token punctuation">,</span> headers<span class="token operator">=</span>Headers<span class="token punctuation">)</span>
<span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
    html_source <span class="token operator">=</span> response<span class="token punctuation">.</span>text
    root <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>html_source<span class="token punctuation">)</span>
    <span class="token comment"># 找到所有房屋信息对应的 li 标签，构建 li 列表</span>
    li_list <span class="token operator">=</span> root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/ul[@class="resblock-list-wrapper"]/li'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> li <span class="token keyword">in</span> li_list<span class="token punctuation">:</span>
        <span class="token comment"># 经过分析，房屋名称信息较好获取，而要获得房屋面积单价则需要借助分支语法</span>
        house_name <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]/h2/a/text()'</span><span class="token punctuation">)</span>  <span class="token comment"># 房屋名称</span>
        house_unit_price <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[6]/div[1]/span[1]/text()|./div/div[6]/div[1]/span[2]/text()'</span><span class="token punctuation">)</span>  <span class="token comment"># 房屋面积单价</span>
        house_price <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[6]/div[@class="second"]/text()'</span><span class="token punctuation">)</span>  <span class="token comment"># 价格区间</span>
        house_address <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>
            <span class="token string">'./div/div[2]/span[1]/text()|./div/div[2]/span[2]/text()|./div/div[2]/a/text()'</span><span class="token punctuation">)</span>  <span class="token comment"># 地理位置</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>house_name<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>house_unit_price<span class="token punctuation">)</span><span class="token punctuation">,</span> house_price<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>house_address<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'状态码：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>response<span class="token punctuation">.</span>status_code<span class="token punctuation">}</span></span><span class="token string">, 请检查'</span></span><span class="token punctuation">)</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34323738383736392f:61727469636c652f64657461696c732f313436313136333132" class_="artid" style="display:none">
 </p>
</div>


