---
layout: post
title: "dorisClickHouse"
date: 2025-03-08 20:01:57 +0800
description: "doris：ClickHouse"
keywords: "doris：ClickHouse"
categories: ['大数据']
tags: ['Doris']
artid: "146121697"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146121697
    alt: "dorisClickHouse"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146121697
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146121697
cover: https://bing.ee123.net/img/rand?artid=146121697
image: https://bing.ee123.net/img/rand?artid=146121697
img: https://bing.ee123.net/img/rand?artid=146121697
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     doris：ClickHouse
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     Doris JDBC Catalog 支持通过标准 JDBC 接口连接 ClickHouse 数据库。本文档介绍如何配置 ClickHouse 数据库连接。
    </p>
    <h3 id="使用须知">
     使用须知
     <a href="https://doris.apache.org/zh-CN/docs/lakehouse/database/clickhouse#%E4%BD%BF%E7%94%A8%E9%A1%BB%E7%9F%A5" rel="nofollow" title="​">
      ​
     </a>
    </h3>
    <p>
     要连接到 ClickHouse 数据库，您需要
    </p>
    <ul>
     <li>
      <p>
       ClickHouse 23.x 或更高版本 (低于此版本未经充分测试)。
      </p>
     </li>
     <li>
      <p>
       ClickHouse 数据库的 JDBC 驱动程序，您可以从
       <a href="https://mvnrepository.com/artifact/com.clickhouse/clickhouse-jdbc" rel="nofollow" title="Maven 仓库">
        Maven 仓库
       </a>
       下载最新或指定版本的 ClickHouse JDBC 驱动程序。
       <strong>
        推荐使用 ClickHouse JDBC Driver 0.4.6 版本。
       </strong>
      </p>
     </li>
     <li>
      <p>
       Doris 每个 FE 和 BE 节点和 ClickHouse 服务器之间的网络连接，默认端口为 8123。
      </p>
     </li>
    </ul>
    <h3 id="连接-clickhouse">
     连接 ClickHouse
     <a href="https://doris.apache.org/zh-CN/docs/lakehouse/database/clickhouse#%E8%BF%9E%E6%8E%A5-clickhouse" rel="nofollow" title="​">
      ​
     </a>
    </h3>
    <pre><code>CREATE CATALOG clickhouse PROPERTIES (
    "type"="jdbc",
    "user"="default",
    "password"="password",
    "jdbc_url" = "jdbc:clickhouse://example.net:8123/",
    "driver_url" = "clickhouse-jdbc-0.4.6-all.jar",
    "driver_class" = "com.clickhouse.jdbc.ClickHouseDriver"
)
</code></pre>
    <p>
    </p>
    <p>
     备注
    </p>
    <p>
     <code>
      jdbc_url
     </code>
     定义要传递给 ClickHouse JDBC 驱动程序的连接信息和参数。 支持的 URL 的参数可在
     <a href="https://clickhouse.com/docs/en/integrations/java#configuration" rel="nofollow" title="ClickHouse JDBC 驱动配置">
      ClickHouse JDBC 驱动配置
     </a>
     中找到。
    </p>
    <h4 id="连接安全">
     连接安全
     <a href="https://doris.apache.org/zh-CN/docs/lakehouse/database/clickhouse#%E8%BF%9E%E6%8E%A5%E5%AE%89%E5%85%A8" rel="nofollow" title="​">
      ​
     </a>
    </h4>
    <p>
     如果您使用数据源上安装的全局信任证书配置了 TLS，则可以通过将参数附加到在 jdbc_url 属性中设置的 JDBC 连接字符串来启用集群和数据源之间的 TLS。
    </p>
    <p>
     例如，通过将 ssl=true 参数添加到 jdbc_url 配置属性来启用 TLS：
    </p>
    <pre><code>"jdbc_url"="jdbc:clickhouse://example.net:8123/db?ssl=true"
</code></pre>
    <p>
    </p>
    <p>
     有关 TLS 配置选项的更多信息，请参阅
     <a href="https://clickhouse.com/docs/en/integrations/java#connect-to-clickhouse-with-ssl" rel="nofollow" title="Clickhouse JDBC 驱动程序文档 SSL 配置部分">
      Clickhouse JDBC 驱动程序文档 SSL 配置部分
     </a>
    </p>
    <h3 id="层级映射">
     层级映射
     <a href="https://doris.apache.org/zh-CN/docs/lakehouse/database/clickhouse#%E5%B1%82%E7%BA%A7%E6%98%A0%E5%B0%84" rel="nofollow" title="​">
      ​
     </a>
    </h3>
    <p>
     映射 ClickHouse 时，Doris 的一个 Database 对应于 ClickHouse 中的一个 Database。而 Doris 的 Database 下的 Table 则对应于 ClickHouse 中，该 Database 下的 Tables。即映射关系如下：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        Doris
       </th>
       <th>
        ClickHouse
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        Catalog
       </td>
       <td>
        ClickHouse Server
       </td>
      </tr>
      <tr>
       <td>
        Database
       </td>
       <td>
        Database
       </td>
      </tr>
      <tr>
       <td>
        Table
       </td>
       <td>
        Table
       </td>
      </tr>
     </tbody>
    </table>
    <h3 id="类型映射">
     类型映射
     <a href="https://doris.apache.org/zh-CN/docs/lakehouse/database/clickhouse#%E7%B1%BB%E5%9E%8B%E6%98%A0%E5%B0%84" rel="nofollow" title="​">
      ​
     </a>
    </h3>
    <h4 id="clickhouse-到-doris-类型映射">
     ClickHouse 到 Doris 类型映射
     <a href="https://doris.apache.org/zh-CN/docs/lakehouse/database/clickhouse#clickhouse-%E5%88%B0-doris-%E7%B1%BB%E5%9E%8B%E6%98%A0%E5%B0%84" rel="nofollow" title="​">
      ​
     </a>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        ClickHouse Type
       </th>
       <th>
        Doris Type
       </th>
       <th>
        Comment
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        Bool
       </td>
       <td>
        BOOLEAN
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        String
       </td>
       <td>
        STRING
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        Date/Date32
       </td>
       <td>
        DATE
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        DateTime/DateTime64
       </td>
       <td>
        DATETIME
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        Float32
       </td>
       <td>
        FLOAT
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        Float64
       </td>
       <td>
        DOUBLE
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        Int8
       </td>
       <td>
        TINYINT
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        Int16/UInt8
       </td>
       <td>
        SMALLINT
       </td>
       <td>
        Doris 没有 UNSIGNED 数据类型，所以扩大一个数量级
       </td>
      </tr>
      <tr>
       <td>
        Int32/UInt16
       </td>
       <td>
        INT
       </td>
       <td>
        Doris 没有 UNSIGNED 数据类型，所以扩大一个数量级
       </td>
      </tr>
      <tr>
       <td>
        Int64/Uint32
       </td>
       <td>
        BIGINT
       </td>
       <td>
        Doris 没有 UNSIGNED 数据类型，所以扩大一个数量级
       </td>
      </tr>
      <tr>
       <td>
        Int128/UInt64
       </td>
       <td>
        LARGEINT
       </td>
       <td>
        Doris 没有 UNSIGNED 数据类型，所以扩大一个数量级
       </td>
      </tr>
      <tr>
       <td>
        Int256/UInt128/UInt256
       </td>
       <td>
        STRING
       </td>
       <td>
        Doris 没有这个数量级的数据类型，采用 STRING 处理
       </td>
      </tr>
      <tr>
       <td>
        DECIMAL
       </td>
       <td>
        DECIMALV3/STRING
       </td>
       <td>
        将根据 DECIMAL 字段的（precision, scale) 选择用何种类型
       </td>
      </tr>
      <tr>
       <td>
        Enum/IPv4/IPv6/UUID
       </td>
       <td>
        STRING
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        Array
       </td>
       <td>
        ARRAY
       </td>
       <td>
        Array 内部类型适配逻辑参考上述类型
       </td>
      </tr>
      <tr>
       <td>
        Other
       </td>
       <td>
        UNSUPPORTED
       </td>
       <td>
       </td>
      </tr>
     </tbody>
    </table>
    <h3 id="查询优化">
     查询优化
     <a href="https://doris.apache.org/zh-CN/docs/lakehouse/database/clickhouse#%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96" rel="nofollow" title="​">
      ​
     </a>
    </h3>
    <h4 id="谓词下推">
     谓词下推
     <a href="https://doris.apache.org/zh-CN/docs/lakehouse/database/clickhouse#%E8%B0%93%E8%AF%8D%E4%B8%8B%E6%8E%A8" rel="nofollow" title="​">
      ​
     </a>
    </h4>
    <ol>
     <li>
      <p>
       当执行类似于
       <code>
        where dt = '2022-01-01'
       </code>
       这样的查询时，Doris 能够将这些过滤条件下推到外部数据源，从而直接在数据源层面排除不符合条件的数据，减少了不必要的数据获取和传输。这大大提高了查询性能，同时也降低了对外部数据源的负载。
      </p>
     </li>
     <li>
      <p>
       当变量
       <code>
        enable_ext_func_pred_pushdown
       </code>
       设置为 true，会将 where 之后的函数条件也下推到外部数据源。
      </p>
      <p>
       目前支持下推到 ClickHouse 的函数有：
      </p>
      <table>
       <thead>
        <tr>
         <th>
          Function
         </th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td>
          FROM_UNIXTIME
         </td>
        </tr>
        <tr>
         <td>
          UNIX_TIMESTAMP
         </td>
        </tr>
       </tbody>
      </table>
     </li>
    </ol>
    <h4 id="行数限制">
     行数限制
     <a href="https://doris.apache.org/zh-CN/docs/lakehouse/database/clickhouse#%E8%A1%8C%E6%95%B0%E9%99%90%E5%88%B6" rel="nofollow" title="​">
      ​
     </a>
    </h4>
    <p>
     如果在查询中带有 limit 关键字，Doris 会将 limit 下推到 ClickHouse，以减少数据传输量。
    </p>
    <h4 id="转义字符">
     转义字符
     <a href="https://doris.apache.org/zh-CN/docs/lakehouse/database/clickhouse#%E8%BD%AC%E4%B9%89%E5%AD%97%E7%AC%A6" rel="nofollow" title="​">
      ​
     </a>
    </h4>
    <p>
     Doris 会在下发到 ClickHouse 的查询语句中，自动在字段名与表名上加上转义符：("")，以避免字段名与表名与 ClickHouse 内部关键字冲突。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33363037303130342f:61727469636c652f64657461696c732f313436313231363937" class_="artid" style="display:none">
 </p>
</div>


