---
layout: post
title: "2025.3.9机器学习笔记文献阅读"
date: 2025-03-06 21:42:07 +0800
description: "洪水每年对全世界造成了巨大的损失，有效的洪水预警是重要防洪方式，但是现有洪水预测方法并不可靠，比如，传统的物理计算方法和数据驱动模型需大量水文和地貌数据，又因为极端洪水事件观测数据有限，这会导致模型的预测不准确。本论文基于时间序列GANs，探究其在洪水时间序列生成及预报中的作用，利用时间序列生成对抗网络进行洪水预测，应用TimeGAN和RTSGAN生成合成洪水时间序列。以中国西江流域为例，实验结果表明TimeGAN能准确高效模拟多站点洪水序列的时空相关性，RTSGAN在长序列时表现更优，且合成数据集可减少常"
keywords: "generative adversarial networks for synthetic reservoir inflow generation"
categories: ['未分类']
tags: ['笔记', '机器学习', '人工智能']
artid: "145981612"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=145981612
    alt: "2025.3.9机器学习笔记文献阅读"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=145981612
featuredImagePreview: https://bing.ee123.net/img/rand?artid=145981612
cover: https://bing.ee123.net/img/rand?artid=145981612
image: https://bing.ee123.net/img/rand?artid=145981612
img: https://bing.ee123.net/img/rand?artid=145981612
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     2025.3.9机器学习笔记：文献阅读
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="_1">
     </a>
     一、文献阅读
    </h2>
    <h3>
     <a id="_2">
     </a>
     题目信息
    </h3>
    <ul>
     <li>
      <strong>
       题目：
      </strong>
      Time-series generative adversarial networks for flood forecasting
     </li>
     <li>
      <strong>
       期刊：
      </strong>
      Journal of Hydrology
     </li>
     <li>
      <strong>
       作者：
      </strong>
      Peiyao Weng, Yu Tian, Yingfei Liu, Ying Zheng
     </li>
     <li>
      <strong>
       发表时间：
      </strong>
      2023/5/20
     </li>
     <li>
      <strong>
       文章链接：
      </strong>
      <a href="https://pdf.sciencedirectassets.com/271842/1-s2.0-S0022169423X00080/1-s2.0-S0022169423006443/main.pdf?X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJb%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLWVhc3QtMSJHMEUCIBOFtK93Xb8juBe00SDcHlI8WjIkLgrfBPF9MeZFCPsHAiEA2%2BMv%2FMXESsCoJb4zuXnkvoeWSanNa3hsbpwqg3vzGGUqvAUIzv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAFGgwwNTkwMDM1NDY4NjUiDKcA1VjU%2BCVi8PJxoCqQBfm3%2BGZ8HeyH7c4cqMQbBgy1xjh7NW3eSva3ABAwAf%2FWLuG3riQWSzu3eUdy11wWHwshfHR06hr4eYQfitP4WCiMuJjXdCevgAnS3EjzGoJlA%2FWDT%2FMoFtzTBE1V1N1G%2BC7UaaWDba7%2BASWJUFgYBggWf7wSHjsXpuFCitT27CATIjAJhZ4OXlbWHuzOPqEtwSq5dWQx9TKhaB3BpXCZNy4nTxxZ5HHbOWYYaqk7uY0UvzK2NI3na1vcPv1V4%2B4dEj4EnSbMKnfq%2FgfKdYqIeRj4O8hJEhPpmJqqUbiHG6goGHVT6geRH0hUvJn1GIkFiDVr3sLQMku1M3NnY%2BNs9tBqu6ICtO9WPP3LfVUYTU8ZI16PaV3QbqbSozc%2BQsoFE9HGWe%2Bvd0WYONltDeNRwY%2BCDt9X1TeDXMDgvGXHes2IIysIRDrxlEYVNnVfkM8hS33KFs3VSbAINgg%2B34e2u90u4lbAi9beeHLUzY%2BaH3MSSfIzG%2Fx0sHGSa9Wk1DVLig6VfHd5g5dmN%2BOooIlp%2BkKbcZG0v29Jd8hxAMCPOGd8jmxGSb9Q0kBJIkRypFqW8P8zxues21eZ%2FuMIjCsUQqpeJbmwfN6XwKlNtWenC4R5hnC6NCQIl0l2DKtHIUi1xKtQ5ePcqDhfISg3S4B%2BL4RWZwjxbibgwRbshzTtk8jgHJuyzGDNqXyoifQZOOcfiv5mEfQl2SS366TDk%2BimktVrLjIPObdtxRdVJf7Pm6F%2Fm4KA7fyzJ7dzXYFffVxWXa4s68Pgp9c4eGoSBfxay8PQmooWr9%2B3Y4DmMD4p4%2B4Okmiy0gYKFY2%2BJ7%2FqHPyNdfvHrOrw94YUlQod5JMBJuKkOdela3wOjHCiOgjewU2pMJXxlL4GOrEBmPBoZHpqcOWa9uBJ1bY60HyvfYBl%2BlDJH2Ed%2BikwXJeCkEOeeu8%2BACl08%2FboZjqwhXgc3KenD3G%2FPLUfHC37L3Ao5imLBDbi0MF5M5pk%2B2IWscF5mgbEUPICHegB9UZiWoPv139mtt%2F7GFRMrxE5x9W4fbTDtzHAkAcsrUEu7ov4MjhljS6h1l25RUDYPzKBjdv7Nf3XAIJJ7vSiYuSTDz2ZjnD41mF56VwlccWMlxib&amp;X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Date=20250303T060304Z&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Expires=300&amp;X-Amz-Credential=ASIAQ3PHCVTY4CAY6CN6%2F20250303%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Signature=3c084efbf973ed1be9a2dc2ba14b526188dfdc129fd504fb35b07d7708f0127a&amp;hash=7901a4909e9ccf7769c0501aabe533f25908761c84b9b933f6b17b5bcf9634c5&amp;host=68042c943591013ac2b2430a89b270f6af2c76d8dfd086a07176afe7c76c2c61&amp;pii=S0022169423006443&amp;tid=spdf-d24b26cc-557c-4961-b94a-b21448d74dc8&amp;sid=ed0ce5719dde1347418a57c36e243963e462gxrqa&amp;type=client&amp;tsoh=d3d3LnNjaWVuY2VkaXJlY3QuY29t&amp;rh=d3d3LnNjaWVuY2VkaXJlY3QuY29t&amp;ua=0e085b51045401070304&amp;rr=91a6edbaddbc20ee&amp;cc=hk" rel="nofollow">
       https://www.sciencedirect.com/science/article/pii/S0022169423006443?via%3Dihub
      </a>
     </li>
    </ul>
    <h3>
     <a id="_8">
     </a>
     摘要
    </h3>
    <p>
     洪水每年对全世界造成了巨大的损失，有效的洪水预警是重要防洪方式，但是现有洪水预测方法并不可靠，比如，传统的物理计算方法和数据驱动模型需大量水文和地貌数据，又因为极端洪水事件观测数据有限，这会导致模型的预测不准确。本论文基于时间序列GANs，探究其在洪水时间序列生成及预报中的作用，利用时间序列生成对抗网络进行洪水预测，应用TimeGAN和RTSGAN生成合成洪水时间序列。以中国西江流域为例，实验结果表明TimeGAN能准确高效模拟多站点洪水序列的时空相关性，RTSGAN在长序列时表现更优，且合成数据集可减少常规深度学习模型的预测误差。这种方法为解决洪水预报中数据稀缺问题提供了新思路，对提升洪水预报具有重要作用，有助于减少洪水造成的损失。
    </p>
    <h3>
     <a id="Abstract_10">
     </a>
     Abstract
    </h3>
    <p>
     Floods cause substantial losses worldwide each year, making effective flood warning systems a critical component of flood prevention. However, existing flood prediction methods are often unreliable. For instance, traditional physically-based computational approaches and data-driven models require extensive hydrological and geomorphological data. Moreover, the limited availability of observational data for extreme flood events often leads to inaccurate predictions. This paper investigates the application of time series Generative Adversarial Networks (GANs) in generating and forecasting flood time series. Specifically, we employ TimeGAN and RTSGAN to produce synthetic flood time series data. Using the Xijiang River Basin in China as a case study, experimental results demonstrate that TimeGAN can accurately and efficiently simulate the spatiotemporal correlations of multi-site flood sequences. RTSGAN, on the other hand, exhibits superior performance for longer sequences. Furthermore, the synthetic datasets generated by these models can reduce prediction errors in conventional deep learning approaches. This methodology offers a novel solution to the challenge of data scarcity in flood forecasting, significantly enhancing flood prediction accuracy and contributing to the mitigation of flood-related damages.
    </p>
    <h3>
     <a id="_12">
     </a>
     创新点
    </h3>
    <p>
     作者首次将时间序列GANs应用于洪水时间序列生成中，以提升洪水预报模型精度，其利用历史序列数据生成新数据，且无需预处理，生成的序列保留原始时间特征。
    </p>
    <h3>
     <a id="_14">
     </a>
     网络架构
    </h3>
    <p>
     在论文第3.1节“Flood generating model”中，提到在生成合成洪水数据之前，需要对原始洪水时间序列进行预处理。数据为洪水时间序列，包含多个洪水事件𝑘，特征维度 𝑛，时间步长𝑚，窗口大小𝑤，序列长度𝐿。将原始洪水时间序列通过滑动窗口的方式分割成三维数据，其表示为：
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        [ 
        
        
        
          ∑ 
         
         
         
           i 
          
         
           = 
          
         
           1 
          
         
        
          k 
         
        
        
        
          ( 
         
         
         
           L 
          
         
           i 
          
         
        
          − 
         
        
          w 
         
        
          + 
         
        
          1 
         
        
          ) 
         
        
       
         , 
        
       
         n 
        
       
         , 
        
       
         w 
        
       
         ] 
        
       
      
        [\sum_{i=1}^{k}\left(L_{i}-w+1\right), n, w]
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1.2887em; vertical-align: -0.2997em;">
         </span>
         <span class="mopen">
          [
         </span>
         <span class="mop">
          <span class="mop op-symbol small-op" style="position: relative; top: 0em;">
           ∑
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.989em;">
              <span class="" style="top: -2.4003em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                 <span class="mrel mtight">
                  =
                 </span>
                 <span class="mord mtight">
                  1
                 </span>
                </span>
               </span>
              </span>
              <span class="" style="top: -3.2029em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight" style="margin-right: 0.0315em;">
                  k
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.2997em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="minner">
          <span class="mopen delimcenter" style="top: 0em;">
           (
          </span>
          <span class="mord">
           <span class="mord mathnormal">
            L
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3117em;">
               <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   i
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           −
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0269em;">
           w
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           +
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mord">
           1
          </span>
          <span class="mclose delimcenter" style="top: 0em;">
           )
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mpunct">
          ,
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mord mathnormal">
          n
         </span>
         <span class="mpunct">
          ,
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0269em;">
          w
         </span>
         <span class="mclose">
          ]
         </span>
        </span>
       </span>
      </span>
     </span>
     <br/>
     窗口大小w决定每次处理的数据长度，论文中将小时尺度定为48小时每3小时一个时间步，则分为16个时间步；日尺度则为9天，则分为9个时间步；
     <br/>
     论文中“the sliding step 𝑚 is set to 1”，将步长m设为1，表示窗口每次滑动1个时间步，生成重叠窗口。
     <br/>
     举个例子：对于第𝑖个洪水事件，时间序列长度为
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        L 
         
        
          i 
         
        
       
      
        L_i
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal">
           L
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 i
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     ，设
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        L 
         
        
          i 
         
        
       
         = 
        
       
         100 
        
       
      
        L_i = 100
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal">
           L
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 i
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          =
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.6444em;">
         </span>
         <span class="mord">
          100
         </span>
        </span>
       </span>
      </span>
     </span>
     (洪水持续了100个小事)，窗口大小w=16，步长m=1，有三个特征，即n=3。
     <br/>
     则第一个窗口时间步1到16；第二个窗口时间步2到17；最后一个窗口时间步85到100。​
     <br/>
     总窗口数则为100−16+1=85，且一个窗口是一个二维矩阵[n,w]。
     <br/>
     所以这个三维矩阵表达为：
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        [ 
        
        
        
          ∑ 
         
         
         
           i 
          
         
           = 
          
         
           1 
          
         
        
          k 
         
        
        
        
          ( 
         
         
         
           L 
          
         
           i 
          
         
        
          − 
         
        
          w 
         
        
          + 
         
        
          1 
         
        
          ) 
         
        
       
         , 
        
       
         n 
        
       
         , 
        
       
         w 
        
       
         ] 
        
       
      
        [\sum_{i=1}^{k}\left(L_{i}-w+1\right), n, w]
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1.2887em; vertical-align: -0.2997em;">
         </span>
         <span class="mopen">
          [
         </span>
         <span class="mop">
          <span class="mop op-symbol small-op" style="position: relative; top: 0em;">
           ∑
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.989em;">
              <span class="" style="top: -2.4003em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                 <span class="mrel mtight">
                  =
                 </span>
                 <span class="mord mtight">
                  1
                 </span>
                </span>
               </span>
              </span>
              <span class="" style="top: -3.2029em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight" style="margin-right: 0.0315em;">
                  k
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.2997em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="minner">
          <span class="mopen delimcenter" style="top: 0em;">
           (
          </span>
          <span class="mord">
           <span class="mord mathnormal">
            L
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3117em;">
               <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   i
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           −
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0269em;">
           w
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           +
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mord">
           1
          </span>
          <span class="mclose delimcenter" style="top: 0em;">
           )
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mpunct">
          ,
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mord mathnormal">
          n
         </span>
         <span class="mpunct">
          ,
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0269em;">
          w
         </span>
         <span class="mclose">
          ]
         </span>
        </span>
       </span>
      </span>
     </span>
     = [85,3,16]
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e2e27fd85e7e4408821df4ee72d5e8b4.png">
      <br/>
      TimeGAN包含嵌入函数、恢复函数、序列生成器和序列鉴别器的生成模型，通过有监督损失和无监督损失的学习嵌入空间对抗性和联合训练，让模型得以同时学习编码特征、生成表示和跨时间迭代。有关于TimeGAN的知识点，我在之前的博客记录过，这里就不再赘述了，大家需要的话可以点击这个链接查看：
      <a href="https://blog.csdn.net/Zcymatics/article/details/145011621?spm=1001.2014.3001.5501">
       https://blog.csdn.net/Zcymatics/article/details/145011621?spm=1001.2014.3001.5501
      </a>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f79f9e7f0b5349c5b8d24ddb2b483544.png">
       <br/>
       接下来我们详细分析一下作者提到的RTSGAN，其全称为“Recurrent Time-Series Generative Adversarial Network”，它是TimeGAN的改进版本，专门用于生成高质量时间序列数据。
       <br/>
       其核心是通过
       <strong>
        结合WGAN 和自回归解码器
       </strong>
       ，克服了传统TimeGAN在长序列生成中的不稳定性和长序列信息捕捉能力弱问题。
       <br/>
       传统GAN使用的是JS散度或KL散度优化生成分布与真实分布的相似性。想要了解GAN可以去我这篇博客看一下原理：
       <a href="https://blog.csdn.net/Zcymatics/article/details/145011685?spm=1001.2014.3001.5501">
        https://blog.csdn.net/Zcymatics/article/details/145011685?spm=1001.2014.3001.5501
       </a>
       <br/>
       而WGAN使用
       <strong>
        Wasserstein距离
       </strong>
       替代JS散度，减少模式崩塌，提高训练稳定性。
      </img>
     </img>
    </p>
    <pre><code>模型坍塌是指模型在训练过程中逐渐失去多样性和泛化能力，导致性能严重退化甚至无法继续优化。
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a0d08ee189ff4b46a6e840f7e121db5a.jpeg">
      <br/>
      其损失函数被定义为：
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         L 
        
       
         = 
        
        
        
          E 
         
         
         
           r 
          
         
           ∼ 
          
          
          
            P 
           
          
            r 
           
          
         
        
       
         [ 
        
       
         D 
        
       
         ( 
        
       
         r 
        
       
         ) 
        
       
         ] 
        
       
         − 
        
        
        
          E 
         
         
          
          
            r 
           
          
            ^ 
           
          
         
           ∼ 
          
          
          
            P 
           
          
            g 
           
          
         
        
       
         [ 
        
       
         D 
        
       
         ( 
        
        
        
          r 
         
        
          ^ 
         
        
       
         ) 
        
       
         ] 
        
       
      
        L=E_{r \sim P_{r}}[D(r)]-E_{\hat{r} \sim P_{g}}[D(\hat{r})]
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6833em;">
          </span>
          <span class="mord mathnormal">
           L
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1.0001em; vertical-align: -0.2501em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.0576em;">
            E
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3283em;">
               <span class="" style="top: -2.55em; margin-left: -0.0576em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                   r
                  </span>
                  <span class="mrel mtight">
                   ∼
                  </span>
                  <span class="mord mtight">
                   <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                    P
                   </span>
                   <span class="msupsub">
                    <span class="vlist-t vlist-t2">
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.1645em;">
                       <span class="" style="top: -2.357em; margin-left: -0.1389em; margin-right: 0.0714em;">
                        <span class="pstrut" style="height: 2.5em;">
                        </span>
                        <span class="sizing reset-size3 size1 mtight">
                         <span class="mord mtight">
                          <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                           r
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="vlist-s">
                       ​
                      </span>
                     </span>
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.143em;">
                       <span class="">
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.2501em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mopen">
           [
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0278em;">
           D
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0278em;">
           r
          </span>
          <span class="mclose">
           )]
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           −
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1.0973em; vertical-align: -0.3473em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.0576em;">
            E
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3361em;">
               <span class="" style="top: -2.55em; margin-left: -0.0576em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord accent mtight">
                   <span class="vlist-t">
                    <span class="vlist-r">
                     <span class="vlist" style="height: 0.6944em;">
                      <span class="" style="top: -2.7em;">
                       <span class="pstrut" style="height: 2.7em;">
                       </span>
                       <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                        r
                       </span>
                      </span>
                      <span class="" style="top: -2.7em;">
                       <span class="pstrut" style="height: 2.7em;">
                       </span>
                       <span class="accent-body" style="left: -0.1944em;">
                        <span class="mord mtight">
                         ^
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="mrel mtight">
                   ∼
                  </span>
                  <span class="mord mtight">
                   <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                    P
                   </span>
                   <span class="msupsub">
                    <span class="vlist-t vlist-t2">
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.1645em;">
                       <span class="" style="top: -2.357em; margin-left: -0.1389em; margin-right: 0.0714em;">
                        <span class="pstrut" style="height: 2.5em;">
                        </span>
                        <span class="sizing reset-size3 size1 mtight">
                         <span class="mord mtight">
                          <span class="mord mathnormal mtight" style="margin-right: 0.0359em;">
                           g
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="vlist-s">
                       ​
                      </span>
                     </span>
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.2819em;">
                       <span class="">
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3473em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mopen">
           [
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0278em;">
           D
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord accent">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.6944em;">
              <span class="" style="top: -3em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="mord mathnormal" style="margin-right: 0.0278em;">
                r
               </span>
              </span>
              <span class="" style="top: -3em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="accent-body" style="left: -0.1944em;">
                <span class="mord">
                 ^
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose">
           )]
          </span>
         </span>
        </span>
       </span>
      </span>
      <br/>
      D是判别器
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         E 
         
         
         
           r 
          
         
           ∼ 
          
          
          
            P 
           
          
            r 
           
          
         
        
       
         [ 
        
       
         D 
        
       
         ( 
        
       
         r 
        
       
         ) 
        
       
         ] 
        
       
      
        E_{r \sim P_{r}}[D(r)]
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1.0001em; vertical-align: -0.2501em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.0576em;">
            E
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3283em;">
               <span class="" style="top: -2.55em; margin-left: -0.0576em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                   r
                  </span>
                  <span class="mrel mtight">
                   ∼
                  </span>
                  <span class="mord mtight">
                   <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                    P
                   </span>
                   <span class="msupsub">
                    <span class="vlist-t vlist-t2">
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.1645em;">
                       <span class="" style="top: -2.357em; margin-left: -0.1389em; margin-right: 0.0714em;">
                        <span class="pstrut" style="height: 2.5em;">
                        </span>
                        <span class="sizing reset-size3 size1 mtight">
                         <span class="mord mtight">
                          <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                           r
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="vlist-s">
                       ​
                      </span>
                     </span>
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.143em;">
                       <span class="">
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.2501em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mopen">
           [
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0278em;">
           D
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0278em;">
           r
          </span>
          <span class="mclose">
           )]
          </span>
         </span>
        </span>
       </span>
      </span>
      是真实样本𝑟通过𝐷的期望输出；
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         E 
         
         
          
          
            r 
           
          
            ^ 
           
          
         
           ∼ 
          
          
          
            P 
           
          
            g 
           
          
         
        
       
         [ 
        
       
         D 
        
       
         ( 
        
        
        
          r 
         
        
          ^ 
         
        
       
         ) 
        
       
         ] 
        
       
      
        E_{\hat{r} \sim P_{g}}[D(\hat{r})]
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1.0973em; vertical-align: -0.3473em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.0576em;">
            E
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3361em;">
               <span class="" style="top: -2.55em; margin-left: -0.0576em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord accent mtight">
                   <span class="vlist-t">
                    <span class="vlist-r">
                     <span class="vlist" style="height: 0.6944em;">
                      <span class="" style="top: -2.7em;">
                       <span class="pstrut" style="height: 2.7em;">
                       </span>
                       <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                        r
                       </span>
                      </span>
                      <span class="" style="top: -2.7em;">
                       <span class="pstrut" style="height: 2.7em;">
                       </span>
                       <span class="accent-body" style="left: -0.1944em;">
                        <span class="mord mtight">
                         ^
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="mrel mtight">
                   ∼
                  </span>
                  <span class="mord mtight">
                   <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                    P
                   </span>
                   <span class="msupsub">
                    <span class="vlist-t vlist-t2">
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.1645em;">
                       <span class="" style="top: -2.357em; margin-left: -0.1389em; margin-right: 0.0714em;">
                        <span class="pstrut" style="height: 2.5em;">
                        </span>
                        <span class="sizing reset-size3 size1 mtight">
                         <span class="mord mtight">
                          <span class="mord mathnormal mtight" style="margin-right: 0.0359em;">
                           g
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="vlist-s">
                       ​
                      </span>
                     </span>
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.2819em;">
                       <span class="">
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3473em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mopen">
           [
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0278em;">
           D
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord accent">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.6944em;">
              <span class="" style="top: -3em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="mord mathnormal" style="margin-right: 0.0278em;">
                r
               </span>
              </span>
              <span class="" style="top: -3em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="accent-body" style="left: -0.1944em;">
                <span class="mord">
                 ^
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose">
           )]
          </span>
         </span>
        </span>
       </span>
      </span>
      合成样本
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         r 
         
        
          ^ 
         
        
       
      
        \hat{r}
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6944em;">
          </span>
          <span class="mord accent">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.6944em;">
              <span class="" style="top: -3em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="mord mathnormal" style="margin-right: 0.0278em;">
                r
               </span>
              </span>
              <span class="" style="top: -3em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="accent-body" style="left: -0.1944em;">
                <span class="mord">
                 ^
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      通过𝐷的期望输出。
     </img>
    </p>
    <p>
     说完了Wasserstein距离，下面来说一下RTSGAN的另一个改进点：
     <br/>
     <strong>
      自回归编码器
     </strong>
     <br/>
     TimeGAN中，使用的是嵌入函数和恢复函数完成。其嵌入函数是逐时间步生成潜在序列𝐻，每个时间步都有一个对应的潜在表示
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        h 
         
        
          t 
         
        
       
      
        h_t
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8444em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal">
           h
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.2806em;">
              <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 t
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     ；其恢复函数从整个潜在序列𝐻
     <strong>
      一次性
     </strong>
     生成重建序列
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        X 
         
        
          ^ 
         
        
       
      
        \hat X
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.9468em;">
         </span>
         <span class="mord accent">
          <span class="vlist-t">
           <span class="vlist-r">
            <span class="vlist" style="height: 0.9468em;">
             <span class="" style="top: -3em;">
              <span class="pstrut" style="height: 3em;">
              </span>
              <span class="mord mathnormal" style="margin-right: 0.0785em;">
               X
              </span>
             </span>
             <span class="" style="top: -3.2523em;">
              <span class="pstrut" style="height: 3em;">
              </span>
              <span class="accent-body" style="left: -0.1667em;">
               <span class="mord">
                ^
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     。
     <br/>
     RTSGAN中使用的则是自回归编码器和解码器。编码器同样负责将时间序列X映射到潜在空间，但其目标是生成一个固定维度的潜在表示𝑟，而不是逐时间步的潜在序列𝐻；其解码器从潜在表示
     <strong>
      逐步
     </strong>
     生成时间序列（不是一次性输出），采用自回归方式生成每个时间步的输出。
     <br/>
     TimeGAN的一次性生成会导致长序列的时间相关性可能被削弱。RTSGAN中自回归解码器通过逐步生成的方式学习时间依赖性，每一步的生成依赖于前一步的输出，更加能够捕捉时间动态变化。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/5785c3226faf475d849b7fd974a06b6d.png">
      <br/>
      下图是论文工作的总体的流程图：
      <br/>
      首先数据经过预处理后给TimeGAN和RTSGAN生成数据，然后真实的训练数据和生成数据进入滑动窗口。滑动窗口将真实和合成数据分割成两个部分，为监督学习提供数据，真实数据为covariates，如
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         x 
         
         
         
           t 
          
         
           − 
          
         
           2 
          
         
        
          1 
         
        
       
         , 
        
        
        
          x 
         
         
         
           t 
          
         
           − 
          
         
           2 
          
         
        
          2 
         
        
       
         , 
        
        
        
          x 
         
         
         
           t 
          
         
           − 
          
         
           2 
          
         
        
          3 
         
        
       
      
        x_{t-2}^1, x_{t-2}^2, x_{t-2}^3
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1.1205em; vertical-align: -0.3064em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal">
            x
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.8141em;">
               <span class="" style="top: -2.4519em; margin-left: 0em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   t
                  </span>
                  <span class="mbin mtight">
                   −
                  </span>
                  <span class="mord mtight">
                   2
                  </span>
                 </span>
                </span>
               </span>
               <span class="" style="top: -3.063em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  1
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3064em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.1667em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal">
            x
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.8141em;">
               <span class="" style="top: -2.4519em; margin-left: 0em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   t
                  </span>
                  <span class="mbin mtight">
                   −
                  </span>
                  <span class="mord mtight">
                   2
                  </span>
                 </span>
                </span>
               </span>
               <span class="" style="top: -3.063em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  2
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3064em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.1667em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal">
            x
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.8141em;">
               <span class="" style="top: -2.4519em; margin-left: 0em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   t
                  </span>
                  <span class="mbin mtight">
                   −
                  </span>
                  <span class="mord mtight">
                   2
                  </span>
                 </span>
                </span>
               </span>
               <span class="" style="top: -3.063em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  3
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3064em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      ，绿色框为GAN生成数据y，如
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         y 
         
        
          t 
         
        
       
      
        y_t
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.625em; vertical-align: -0.1944em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.0359em;">
            y
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.2806em;">
               <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mathnormal mtight">
                  t
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      ，每个实例包含输入和输出。这些数据对供GBRT和LSTM训练。最后两个预测模型输出预测值与真实值对比，得出评估指标。
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4b54796ca76047418e72381ff3ca9c44.png"/>
     </img>
    </p>
    <h3>
     <a id="_45">
     </a>
     实验
    </h3>
    <p>
     本文围绕时间序列生成对抗网络在洪水预测中的应用展开实验，
     <br/>
     论文的
     <strong>
      评价指标
     </strong>
     如下图所示，其中比较陌生的有：
     <br/>
     1、皮尔逊相关系数，其用于衡量预测值与观测值的线性相关性，值越大越好（最大值为1）：
     <br/>
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        O 
        
       
         C 
        
       
         = 
        
        
         
          
          
            ∑ 
           
           
           
             i 
            
           
             = 
            
           
             1 
            
           
          
            n 
           
          
          
          
            ( 
           
           
           
             F 
            
           
             i 
            
           
          
            − 
           
           
           
             F 
            
           
             ˉ 
            
           
          
            ) 
           
          
          
          
            ( 
           
           
           
             O 
            
           
             i 
            
           
          
            − 
           
           
           
             O 
            
           
             ˉ 
            
           
          
            ) 
           
          
         
         
          
           
            
            
              ∑ 
             
             
             
               i 
              
             
               = 
              
             
               1 
              
             
            
              n 
             
            
            
             
             
               ( 
              
              
              
                F 
               
              
                i 
               
              
             
               − 
              
              
              
                F 
               
              
                ˉ 
               
              
             
               ) 
              
             
            
              2 
             
            
           
          
          
           
            
            
              ∑ 
             
             
             
               i 
              
             
               = 
              
             
               1 
              
             
            
              n 
             
            
            
             
             
               ( 
              
              
              
                O 
               
              
                i 
               
              
             
               − 
              
              
              
                O 
               
              
                ˉ 
               
              
             
               ) 
              
             
            
              2 
             
            
           
          
         
        
       
      
        O C=\frac{\sum_{i=1}^n\left(F_i-\bar{F}\right)\left(O_i-\bar{O}\right)}{\sqrt{\sum_{i=1}^n\left(F_i-\bar{F}\right)^2} \sqrt{\sum_{i=1}^n\left(O_i-\bar{O}\right)^2}}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0715em;">
          OC
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          =
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 2.3396em; vertical-align: -1.0296em;">
         </span>
         <span class="mord">
          <span class="mopen nulldelimiter">
          </span>
          <span class="mfrac">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 1.31em;">
              <span class="" style="top: -2.3041em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord sqrt mtight">
                  <span class="vlist-t vlist-t2">
                   <span class="vlist-r">
                    <span class="vlist" style="height: 1.2656em;">
                     <span class="svg-align" style="top: -3.7143em;">
                      <span class="pstrut" style="height: 3.7143em;">
                      </span>
                      <span class="mord mtight" style="padding-left: 1.4286em;">
                       <span class="mop mtight">
                        <span class="mop op-symbol small-op mtight" style="position: relative; top: 0em;">
                         ∑
                        </span>
                        <span class="msupsub">
                         <span class="vlist-t vlist-t2">
                          <span class="vlist-r">
                           <span class="vlist" style="height: 0.7047em;">
                            <span class="" style="top: -2.1786em; margin-left: 0em; margin-right: 0.0714em;">
                             <span class="pstrut" style="height: 2.5em;">
                             </span>
                             <span class="sizing reset-size3 size1 mtight">
                              <span class="mord mtight">
                               <span class="mord mathnormal mtight">
                                i
                               </span>
                               <span class="mrel mtight">
                                =
                               </span>
                               <span class="mord mtight">
                                1
                               </span>
                              </span>
                             </span>
                            </span>
                            <span class="" style="top: -2.8971em; margin-right: 0.0714em;">
                             <span class="pstrut" style="height: 2.5em;">
                             </span>
                             <span class="sizing reset-size3 size1 mtight">
                              <span class="mord mathnormal mtight">
                               n
                              </span>
                             </span>
                            </span>
                           </span>
                           <span class="vlist-s">
                            ​
                           </span>
                          </span>
                          <span class="vlist-r">
                           <span class="vlist" style="height: 0.3214em;">
                            <span class="">
                            </span>
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                       <span class="minner mtight">
                        <span class="minner mtight">
                         <span class="mopen sizing reset-size3 size6 mtight delimcenter" style="top: 0.075em;">
                          <span class="mtight">
                           (
                          </span>
                         </span>
                         <span class="mord mtight">
                          <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                           F
                          </span>
                          <span class="msupsub">
                           <span class="vlist-t vlist-t2">
                            <span class="vlist-r">
                             <span class="vlist" style="height: 0.3281em;">
                              <span class="" style="top: -2.357em; margin-left: -0.1389em; margin-right: 0.0714em;">
                               <span class="pstrut" style="height: 2.5em;">
                               </span>
                               <span class="sizing reset-size3 size1 mtight">
                                <span class="mord mathnormal mtight">
                                 i
                                </span>
                               </span>
                              </span>
                             </span>
                             <span class="vlist-s">
                              ​
                             </span>
                            </span>
                            <span class="vlist-r">
                             <span class="vlist" style="height: 0.143em;">
                              <span class="">
                              </span>
                             </span>
                            </span>
                           </span>
                          </span>
                         </span>
                         <span class="mbin mtight">
                          −
                         </span>
                         <span class="mord accent mtight">
                          <span class="vlist-t">
                           <span class="vlist-r">
                            <span class="vlist" style="height: 0.8201em;">
                             <span class="" style="top: -2.7em;">
                              <span class="pstrut" style="height: 2.7em;">
                              </span>
                              <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                               F
                              </span>
                             </span>
                             <span class="" style="top: -2.9523em;">
                              <span class="pstrut" style="height: 2.7em;">
                              </span>
                              <span class="accent-body" style="left: -0.1667em;">
                               <span class="mord mtight">
                                ˉ
                               </span>
                              </span>
                             </span>
                            </span>
                           </span>
                          </span>
                         </span>
                         <span class="mclose sizing reset-size3 size6 mtight delimcenter" style="top: 0.075em;">
                          <span class="mtight">
                           )
                          </span>
                         </span>
                        </span>
                        <span class="msupsub">
                         <span class="vlist-t">
                          <span class="vlist-r">
                           <span class="vlist" style="height: 1.1039em;">
                            <span class="" style="top: -3.1436em; margin-right: 0.0714em;">
                             <span class="pstrut" style="height: 2.5em;">
                             </span>
                             <span class="sizing reset-size3 size1 mtight">
                              <span class="mord mtight">
                               2
                              </span>
                             </span>
                            </span>
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                     <span class="" style="top: -3.2376em;">
                      <span class="pstrut" style="height: 3.7143em;">
                      </span>
                      <span class="hide-tail mtight" style="min-width: 1.02em; height: 1.8286em;">
                       <svg height="1.8286em" preserveaspectratio="xMinYMin slice" viewbox="0 0 400000 1296" width="400em">
                        <path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z">
                        </path>
                       </svg>
                      </span>
                     </span>
                    </span>
                    <span class="vlist-s">
                     ​
                    </span>
                   </span>
                   <span class="vlist-r">
                    <span class="vlist" style="height: 0.4766em;">
                     <span class="">
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="mord sqrt mtight">
                  <span class="vlist-t vlist-t2">
                   <span class="vlist-r">
                    <span class="vlist" style="height: 1.2656em;">
                     <span class="svg-align" style="top: -3.7143em;">
                      <span class="pstrut" style="height: 3.7143em;">
                      </span>
                      <span class="mord mtight" style="padding-left: 1.4286em;">
                       <span class="mop mtight">
                        <span class="mop op-symbol small-op mtight" style="position: relative; top: 0em;">
                         ∑
                        </span>
                        <span class="msupsub">
                         <span class="vlist-t vlist-t2">
                          <span class="vlist-r">
                           <span class="vlist" style="height: 0.7047em;">
                            <span class="" style="top: -2.1786em; margin-left: 0em; margin-right: 0.0714em;">
                             <span class="pstrut" style="height: 2.5em;">
                             </span>
                             <span class="sizing reset-size3 size1 mtight">
                              <span class="mord mtight">
                               <span class="mord mathnormal mtight">
                                i
                               </span>
                               <span class="mrel mtight">
                                =
                               </span>
                               <span class="mord mtight">
                                1
                               </span>
                              </span>
                             </span>
                            </span>
                            <span class="" style="top: -2.8971em; margin-right: 0.0714em;">
                             <span class="pstrut" style="height: 2.5em;">
                             </span>
                             <span class="sizing reset-size3 size1 mtight">
                              <span class="mord mathnormal mtight">
                               n
                              </span>
                             </span>
                            </span>
                           </span>
                           <span class="vlist-s">
                            ​
                           </span>
                          </span>
                          <span class="vlist-r">
                           <span class="vlist" style="height: 0.3214em;">
                            <span class="">
                            </span>
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                       <span class="minner mtight">
                        <span class="minner mtight">
                         <span class="mopen sizing reset-size3 size6 mtight delimcenter" style="top: 0.075em;">
                          <span class="mtight">
                           (
                          </span>
                         </span>
                         <span class="mord mtight">
                          <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                           O
                          </span>
                          <span class="msupsub">
                           <span class="vlist-t vlist-t2">
                            <span class="vlist-r">
                             <span class="vlist" style="height: 0.3281em;">
                              <span class="" style="top: -2.357em; margin-left: -0.0278em; margin-right: 0.0714em;">
                               <span class="pstrut" style="height: 2.5em;">
                               </span>
                               <span class="sizing reset-size3 size1 mtight">
                                <span class="mord mathnormal mtight">
                                 i
                                </span>
                               </span>
                              </span>
                             </span>
                             <span class="vlist-s">
                              ​
                             </span>
                            </span>
                            <span class="vlist-r">
                             <span class="vlist" style="height: 0.143em;">
                              <span class="">
                              </span>
                             </span>
                            </span>
                           </span>
                          </span>
                         </span>
                         <span class="mbin mtight">
                          −
                         </span>
                         <span class="mord accent mtight">
                          <span class="vlist-t">
                           <span class="vlist-r">
                            <span class="vlist" style="height: 0.8201em;">
                             <span class="" style="top: -2.7em;">
                              <span class="pstrut" style="height: 2.7em;">
                              </span>
                              <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                               O
                              </span>
                             </span>
                             <span class="" style="top: -2.9523em;">
                              <span class="pstrut" style="height: 2.7em;">
                              </span>
                              <span class="accent-body" style="left: -0.1667em;">
                               <span class="mord mtight">
                                ˉ
                               </span>
                              </span>
                             </span>
                            </span>
                           </span>
                          </span>
                         </span>
                         <span class="mclose sizing reset-size3 size6 mtight delimcenter" style="top: 0.075em;">
                          <span class="mtight">
                           )
                          </span>
                         </span>
                        </span>
                        <span class="msupsub">
                         <span class="vlist-t">
                          <span class="vlist-r">
                           <span class="vlist" style="height: 1.1039em;">
                            <span class="" style="top: -3.1436em; margin-right: 0.0714em;">
                             <span class="pstrut" style="height: 2.5em;">
                             </span>
                             <span class="sizing reset-size3 size1 mtight">
                              <span class="mord mtight">
                               2
                              </span>
                             </span>
                            </span>
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                     <span class="" style="top: -3.2376em;">
                      <span class="pstrut" style="height: 3.7143em;">
                      </span>
                      <span class="hide-tail mtight" style="min-width: 1.02em; height: 1.8286em;">
                       <svg height="1.8286em" preserveaspectratio="xMinYMin slice" viewbox="0 0 400000 1296" width="400em">
                        <path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z">
                        </path>
                       </svg>
                      </span>
                     </span>
                    </span>
                    <span class="vlist-s">
                     ​
                    </span>
                   </span>
                   <span class="vlist-r">
                    <span class="vlist" style="height: 0.4766em;">
                     <span class="">
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="" style="top: -3.23em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="frac-line" style="border-bottom-width: 0.04em;">
               </span>
              </span>
              <span class="" style="top: -3.6125em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mop mtight">
                  <span class="mop op-symbol small-op mtight" style="position: relative; top: 0em;">
                   ∑
                  </span>
                  <span class="msupsub">
                   <span class="vlist-t vlist-t2">
                    <span class="vlist-r">
                     <span class="vlist" style="height: 0.7385em;">
                      <span class="" style="top: -2.1786em; margin-left: 0em; margin-right: 0.0714em;">
                       <span class="pstrut" style="height: 2.5em;">
                       </span>
                       <span class="sizing reset-size3 size1 mtight">
                        <span class="mord mtight">
                         <span class="mord mathnormal mtight">
                          i
                         </span>
                         <span class="mrel mtight">
                          =
                         </span>
                         <span class="mord mtight">
                          1
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="" style="top: -2.931em; margin-right: 0.0714em;">
                       <span class="pstrut" style="height: 2.5em;">
                       </span>
                       <span class="sizing reset-size3 size1 mtight">
                        <span class="mord mathnormal mtight">
                         n
                        </span>
                       </span>
                      </span>
                     </span>
                     <span class="vlist-s">
                      ​
                     </span>
                    </span>
                    <span class="vlist-r">
                     <span class="vlist" style="height: 0.3214em;">
                      <span class="">
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="minner mtight">
                  <span class="mopen sizing reset-size3 size6 mtight delimcenter" style="top: 0.075em;">
                   <span class="mtight">
                    (
                   </span>
                  </span>
                  <span class="mord mtight">
                   <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                    F
                   </span>
                   <span class="msupsub">
                    <span class="vlist-t vlist-t2">
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.3281em;">
                       <span class="" style="top: -2.357em; margin-left: -0.1389em; margin-right: 0.0714em;">
                        <span class="pstrut" style="height: 2.5em;">
                        </span>
                        <span class="sizing reset-size3 size1 mtight">
                         <span class="mord mathnormal mtight">
                          i
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="vlist-s">
                       ​
                      </span>
                     </span>
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.143em;">
                       <span class="">
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="mbin mtight">
                   −
                  </span>
                  <span class="mord accent mtight">
                   <span class="vlist-t">
                    <span class="vlist-r">
                     <span class="vlist" style="height: 0.8201em;">
                      <span class="" style="top: -2.7em;">
                       <span class="pstrut" style="height: 2.7em;">
                       </span>
                       <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                        F
                       </span>
                      </span>
                      <span class="" style="top: -2.9523em;">
                       <span class="pstrut" style="height: 2.7em;">
                       </span>
                       <span class="accent-body" style="left: -0.1667em;">
                        <span class="mord mtight">
                         ˉ
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="mclose sizing reset-size3 size6 mtight delimcenter" style="top: 0.075em;">
                   <span class="mtight">
                    )
                   </span>
                  </span>
                 </span>
                 <span class="minner mtight">
                  <span class="mopen sizing reset-size3 size6 mtight delimcenter" style="top: 0.075em;">
                   <span class="mtight">
                    (
                   </span>
                  </span>
                  <span class="mord mtight">
                   <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                    O
                   </span>
                   <span class="msupsub">
                    <span class="vlist-t vlist-t2">
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.3281em;">
                       <span class="" style="top: -2.357em; margin-left: -0.0278em; margin-right: 0.0714em;">
                        <span class="pstrut" style="height: 2.5em;">
                        </span>
                        <span class="sizing reset-size3 size1 mtight">
                         <span class="mord mathnormal mtight">
                          i
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="vlist-s">
                       ​
                      </span>
                     </span>
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.143em;">
                       <span class="">
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="mbin mtight">
                   −
                  </span>
                  <span class="mord accent mtight">
                   <span class="vlist-t">
                    <span class="vlist-r">
                     <span class="vlist" style="height: 0.8201em;">
                      <span class="" style="top: -2.7em;">
                       <span class="pstrut" style="height: 2.7em;">
                       </span>
                       <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                        O
                       </span>
                      </span>
                      <span class="" style="top: -2.9523em;">
                       <span class="pstrut" style="height: 2.7em;">
                       </span>
                       <span class="accent-body" style="left: -0.1667em;">
                        <span class="mord mtight">
                         ˉ
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="mclose sizing reset-size3 size6 mtight delimcenter" style="top: 0.075em;">
                   <span class="mtight">
                    )
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 1.0296em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose nulldelimiter">
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     <br/>
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        F 
         
        
          i 
         
        
       
      
        F_i
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           F
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 i
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     为预测值；
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        O 
         
        
          i 
         
        
       
      
        O_i
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.0278em;">
           O
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 i
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     为观测值；
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        F 
         
        
          ˉ 
         
        
       
      
        \bar{F}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8201em;">
         </span>
         <span class="mord accent">
          <span class="vlist-t">
           <span class="vlist-r">
            <span class="vlist" style="height: 0.8201em;">
             <span class="" style="top: -3em;">
              <span class="pstrut" style="height: 3em;">
              </span>
              <span class="mord mathnormal" style="margin-right: 0.1389em;">
               F
              </span>
             </span>
             <span class="" style="top: -3.2523em;">
              <span class="pstrut" style="height: 3em;">
              </span>
              <span class="accent-body" style="left: -0.1667em;">
               <span class="mord">
                ˉ
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     与
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        O 
         
        
          ˉ 
         
        
       
      
        \bar{O}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8201em;">
         </span>
         <span class="mord accent">
          <span class="vlist-t">
           <span class="vlist-r">
            <span class="vlist" style="height: 0.8201em;">
             <span class="" style="top: -3em;">
              <span class="pstrut" style="height: 3em;">
              </span>
              <span class="mord mathnormal" style="margin-right: 0.0278em;">
               O
              </span>
             </span>
             <span class="" style="top: -3.2523em;">
              <span class="pstrut" style="height: 3em;">
              </span>
              <span class="accent-body" style="left: -0.1667em;">
               <span class="mord">
                ˉ
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     分别为预测和观测均值。
     <br/>
     2、平均绝对相对误差，计算预测值与观测值的相对偏差，值越小越好（0为最小值）：
     <br/>
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        A 
        
       
         A 
        
       
         R 
        
       
         E 
        
       
         = 
        
        
        
          1 
         
        
          n 
         
        
        
        
          ∑ 
         
         
         
           i 
          
         
           = 
          
         
           1 
          
         
        
          n 
         
        
        
        
          ∣ 
         
         
          
           
           
             F 
            
           
             i 
            
           
             p 
            
           
          
            − 
           
           
           
             O 
            
           
             i 
            
           
             p 
            
           
          
          
          
            O 
           
          
            i 
           
          
            p 
           
          
         
        
          ∣ 
         
        
       
      
        A A R E=\frac{1}{n} \sum_{i=1}^n\left|\frac{F_i^p-O_i^p}{O_i^p}\right|
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal">
          AA
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0576em;">
          RE
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          =
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1.8em; vertical-align: -0.65em;">
         </span>
         <span class="mord">
          <span class="mopen nulldelimiter">
          </span>
          <span class="mfrac">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.8451em;">
              <span class="" style="top: -2.655em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  n
                 </span>
                </span>
               </span>
              </span>
              <span class="" style="top: -3.23em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="frac-line" style="border-bottom-width: 0.04em;">
               </span>
              </span>
              <span class="" style="top: -3.394em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mtight">
                  1
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.345em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose nulldelimiter">
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mop">
          <span class="mop op-symbol small-op" style="position: relative; top: 0em;">
           ∑
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.8043em;">
              <span class="" style="top: -2.4003em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                 <span class="mrel mtight">
                  =
                 </span>
                 <span class="mord mtight">
                  1
                 </span>
                </span>
               </span>
              </span>
              <span class="" style="top: -3.2029em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 n
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.2997em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="minner">
          <span class="mopen">
           <span class="delimsizing mult">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 1.15em;">
               <span class="" style="top: -3.15em;">
                <span class="pstrut" style="height: 3.8em;">
                </span>
                <span class="" style="width: 0.333em; height: 1.8em;">
                 <svg height="1.800em" viewbox="0 0 333 1800" width="0.333em">
                  <path d="M145 15 v585 v600 v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v-600 v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v600 v585 h43z">
                  </path>
                 </svg>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.65em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mord">
           <span class="mopen nulldelimiter">
           </span>
           <span class="mfrac">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 1.0895em;">
               <span class="" style="top: -2.6361em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mtight">
                   <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                    O
                   </span>
                   <span class="msupsub">
                    <span class="vlist-t vlist-t2">
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.7912em;">
                       <span class="" style="top: -2.1777em; margin-left: -0.0278em; margin-right: 0.0714em;">
                        <span class="pstrut" style="height: 2.5em;">
                        </span>
                        <span class="sizing reset-size3 size1 mtight">
                         <span class="mord mathnormal mtight">
                          i
                         </span>
                        </span>
                       </span>
                       <span class="" style="top: -2.9837em; margin-right: 0.0714em;">
                        <span class="pstrut" style="height: 2.5em;">
                        </span>
                        <span class="sizing reset-size3 size1 mtight">
                         <span class="mord mathnormal mtight">
                          p
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="vlist-s">
                       ​
                      </span>
                     </span>
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.3223em;">
                       <span class="">
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="" style="top: -3.23em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="frac-line" style="border-bottom-width: 0.04em;">
                </span>
               </span>
               <span class="" style="top: -3.5356em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mtight">
                   <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                    F
                   </span>
                   <span class="msupsub">
                    <span class="vlist-t vlist-t2">
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.7912em;">
                       <span class="" style="top: -2.1777em; margin-left: -0.1389em; margin-right: 0.0714em;">
                        <span class="pstrut" style="height: 2.5em;">
                        </span>
                        <span class="sizing reset-size3 size1 mtight">
                         <span class="mord mathnormal mtight">
                          i
                         </span>
                        </span>
                       </span>
                       <span class="" style="top: -2.9837em; margin-right: 0.0714em;">
                        <span class="pstrut" style="height: 2.5em;">
                        </span>
                        <span class="sizing reset-size3 size1 mtight">
                         <span class="mord mathnormal mtight">
                          p
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="vlist-s">
                       ​
                      </span>
                     </span>
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.3223em;">
                       <span class="">
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="mbin mtight">
                   −
                  </span>
                  <span class="mord mtight">
                   <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                    O
                   </span>
                   <span class="msupsub">
                    <span class="vlist-t vlist-t2">
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.7912em;">
                       <span class="" style="top: -2.1777em; margin-left: -0.0278em; margin-right: 0.0714em;">
                        <span class="pstrut" style="height: 2.5em;">
                        </span>
                        <span class="sizing reset-size3 size1 mtight">
                         <span class="mord mathnormal mtight">
                          i
                         </span>
                        </span>
                       </span>
                       <span class="" style="top: -2.9837em; margin-right: 0.0714em;">
                        <span class="pstrut" style="height: 2.5em;">
                        </span>
                        <span class="sizing reset-size3 size1 mtight">
                         <span class="mord mathnormal mtight">
                          p
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="vlist-s">
                       ​
                      </span>
                     </span>
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.3223em;">
                       <span class="">
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.5895em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mclose nulldelimiter">
           </span>
          </span>
          <span class="mclose">
           <span class="delimsizing mult">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 1.15em;">
               <span class="" style="top: -3.15em;">
                <span class="pstrut" style="height: 3.8em;">
                </span>
                <span class="" style="width: 0.333em; height: 1.8em;">
                 <svg height="1.800em" viewbox="0 0 333 1800" width="0.333em">
                  <path d="M145 15 v585 v600 v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v-600 v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v600 v585 h43z">
                  </path>
                 </svg>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.65em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     <br/>
     𝑛为样本数；
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        F 
         
        
          i 
         
        
          p 
         
        
       
      
        F_i^p
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1.0592em; vertical-align: -0.2769em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           F
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.7823em;">
              <span class="" style="top: -2.4231em; margin-left: -0.1389em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 i
                </span>
               </span>
              </span>
              <span class="" style="top: -3.1809em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 p
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.2769em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     为预测值；
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        O 
         
        
          i 
         
        
          p 
         
        
       
      
        O_i^p
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1.0592em; vertical-align: -0.2769em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.0278em;">
           O
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.7823em;">
              <span class="" style="top: -2.4231em; margin-left: -0.0278em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 i
                </span>
               </span>
              </span>
              <span class="" style="top: -3.1809em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 p
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.2769em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     为观测值。
     <br/>
     3、预测区间覆盖概率，衡量观测值落入预测区间的比例，最佳值为1：
     <br/>
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        P 
        
       
         I 
        
       
         C 
        
       
         P 
        
       
         = 
        
        
        
          1 
         
        
          n 
         
        
        
        
          ∑ 
         
         
         
           i 
          
         
           = 
          
         
           1 
          
         
        
          n 
         
        
        
        
          ε 
         
        
          i 
         
        
       
         , 
        
        
        
        
          ε 
         
        
          i 
         
        
       
         = 
        
       
         1 
        
       
      
        P I C P=\frac{1}{n} \sum_{i=1}^n \varepsilon_i, \quad \varepsilon_i=1
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1389em;">
          P
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0785em;">
          I
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1389em;">
          CP
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          =
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1.1901em; vertical-align: -0.345em;">
         </span>
         <span class="mord">
          <span class="mopen nulldelimiter">
          </span>
          <span class="mfrac">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.8451em;">
              <span class="" style="top: -2.655em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  n
                 </span>
                </span>
               </span>
              </span>
              <span class="" style="top: -3.23em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="frac-line" style="border-bottom-width: 0.04em;">
               </span>
              </span>
              <span class="" style="top: -3.394em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mtight">
                  1
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.345em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose nulldelimiter">
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mop">
          <span class="mop op-symbol small-op" style="position: relative; top: 0em;">
           ∑
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.8043em;">
              <span class="" style="top: -2.4003em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                 <span class="mrel mtight">
                  =
                 </span>
                 <span class="mord mtight">
                  1
                 </span>
                </span>
               </span>
              </span>
              <span class="" style="top: -3.2029em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 n
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.2997em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal">
           ε
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 i
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mpunct">
          ,
         </span>
         <span class="mspace" style="margin-right: 1em;">
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal">
           ε
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 i
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          =
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.6444em;">
         </span>
         <span class="mord">
          1
         </span>
        </span>
       </span>
      </span>
     </span>
     if
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        O 
         
        
          i 
         
        
       
         ∈ 
        
        
        
          [ 
         
         
         
           L 
          
         
           i 
          
         
        
          , 
         
         
         
           U 
          
         
           i 
          
         
        
          ] 
         
        
       
      
        O_i \in\left[L_i, U_i\right]
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.0278em;">
           O
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 i
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          ∈
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="minner">
          <span class="mopen delimcenter" style="top: 0em;">
           [
          </span>
          <span class="mord">
           <span class="mord mathnormal">
            L
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3117em;">
               <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.1667em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.109em;">
            U
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3117em;">
               <span class="" style="top: -2.55em; margin-left: -0.109em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose delimcenter" style="top: 0em;">
           ]
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     , else 0
     <br/>
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        L 
         
        
          i 
         
        
       
      
        L_i
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal">
           L
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 i
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     与
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        U 
         
        
          i 
         
        
       
      
        U_i
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.109em;">
           U
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: -0.109em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 i
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     为预测区间的上下界。
     <br/>
     4、预测区间归一化平均宽度，评估预测区间的宽度，最佳值为0：
     <br/>
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        P 
        
       
         I 
        
       
         N 
        
       
         A 
        
       
         W 
        
       
         = 
        
        
        
          1 
         
         
         
           n 
          
         
           R 
          
         
        
        
        
          ∑ 
         
         
         
           i 
          
         
           = 
          
         
           1 
          
         
        
          n 
         
        
        
        
          ( 
         
         
         
           U 
          
         
           i 
          
         
        
          − 
         
         
         
           L 
          
         
           i 
          
         
        
          ) 
         
        
       
         , 
        
        
       
         R 
        
       
         = 
        
       
         max 
        
       
         ⁡ 
        
        
        
          ( 
         
         
         
           O 
          
         
           i 
          
         
        
          ) 
         
        
       
         − 
        
       
         min 
        
       
         ⁡ 
        
        
        
          ( 
         
         
         
           O 
          
         
           i 
          
         
        
          ) 
         
        
       
      
        PINAW =\frac{1}{n R} \sum_{i=1}^n\left(U_i-L_i\right), \quad R=\max \left(O_i\right)-\min \left(O_i\right)
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1389em;">
          P
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0785em;">
          I
         </span>
         <span class="mord mathnormal" style="margin-right: 0.109em;">
          N
         </span>
         <span class="mord mathnormal">
          A
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1389em;">
          W
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          =
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1.1901em; vertical-align: -0.345em;">
         </span>
         <span class="mord">
          <span class="mopen nulldelimiter">
          </span>
          <span class="mfrac">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.8451em;">
              <span class="" style="top: -2.655em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  n
                 </span>
                 <span class="mord mathnormal mtight" style="margin-right: 0.0077em;">
                  R
                 </span>
                </span>
               </span>
              </span>
              <span class="" style="top: -3.23em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="frac-line" style="border-bottom-width: 0.04em;">
               </span>
              </span>
              <span class="" style="top: -3.394em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mtight">
                  1
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.345em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose nulldelimiter">
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mop">
          <span class="mop op-symbol small-op" style="position: relative; top: 0em;">
           ∑
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.8043em;">
              <span class="" style="top: -2.4003em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                 <span class="mrel mtight">
                  =
                 </span>
                 <span class="mord mtight">
                  1
                 </span>
                </span>
               </span>
              </span>
              <span class="" style="top: -3.2029em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 n
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.2997em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="minner">
          <span class="mopen delimcenter" style="top: 0em;">
           (
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.109em;">
            U
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3117em;">
               <span class="" style="top: -2.55em; margin-left: -0.109em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           −
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal">
            L
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3117em;">
               <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose delimcenter" style="top: 0em;">
           )
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mpunct">
          ,
         </span>
         <span class="mspace" style="margin-right: 1em;">
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0077em;">
          R
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          =
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mop">
          max
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="minner">
          <span class="mopen delimcenter" style="top: 0em;">
           (
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.0278em;">
            O
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3117em;">
               <span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose delimcenter" style="top: 0em;">
           )
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          −
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mop">
          min
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="minner">
          <span class="mopen delimcenter" style="top: 0em;">
           (
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.0278em;">
            O
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3117em;">
               <span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose delimcenter" style="top: 0em;">
           )
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     <br/>
     R为观测值范围；
     <br/>
     5、覆盖宽度综合准则，平衡覆盖率和区间宽度，PICP低于𝜇时施加指数惩罚，0为最佳值：
     <br/>
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        C 
        
       
         W 
        
       
         C 
        
       
         = 
        
       
         P 
        
       
         I 
        
       
         N 
        
       
         A 
        
       
         W 
        
        
        
          ( 
         
        
          1 
         
        
          + 
         
        
          γ 
         
         
         
           e 
          
          
          
            η 
           
          
            ( 
           
          
            μ 
           
          
            − 
           
          
            P 
           
          
            I 
           
          
            C 
           
          
            P 
           
          
            ) 
           
          
         
        
          ) 
         
        
       
         , 
        
        
       
         γ 
        
       
         ( 
        
       
         P 
        
       
         I 
        
       
         C 
        
       
         P 
        
       
         ) 
        
       
         = 
        
       
         1 
        
       
      
        C W C=P I N A W\left(1+\gamma e^{\eta(\mu-P I C P)}\right), \quad \gamma(P I C P)=1
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0715em;">
          C
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1389em;">
          W
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0715em;">
          C
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          =
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1.238em; vertical-align: -0.35em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1389em;">
          P
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0785em;">
          I
         </span>
         <span class="mord mathnormal" style="margin-right: 0.109em;">
          N
         </span>
         <span class="mord mathnormal">
          A
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1389em;">
          W
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="minner">
          <span class="mopen delimcenter" style="top: 0em;">
           <span class="delimsizing size1">
            (
           </span>
          </span>
          <span class="mord">
           1
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           +
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0556em;">
           γ
          </span>
          <span class="mord">
           <span class="mord mathnormal">
            e
           </span>
           <span class="msupsub">
            <span class="vlist-t">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.888em;">
               <span class="" style="top: -3.063em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight" style="margin-right: 0.0359em;">
                   η
                  </span>
                  <span class="mopen mtight">
                   (
                  </span>
                  <span class="mord mathnormal mtight">
                   μ
                  </span>
                  <span class="mbin mtight">
                   −
                  </span>
                  <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                   P
                  </span>
                  <span class="mord mathnormal mtight" style="margin-right: 0.0785em;">
                   I
                  </span>
                  <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                   CP
                  </span>
                  <span class="mclose mtight">
                   )
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose delimcenter" style="top: 0em;">
           <span class="delimsizing size1">
            )
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mpunct">
          ,
         </span>
         <span class="mspace" style="margin-right: 1em;">
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0556em;">
          γ
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1389em;">
          P
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0785em;">
          I
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1389em;">
          CP
         </span>
         <span class="mclose">
          )
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          =
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.6444em;">
         </span>
         <span class="mord">
          1
         </span>
        </span>
       </span>
      </span>
     </span>
     if
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        P 
        
       
         I 
        
       
         C 
        
       
         P 
        
       
         &lt; 
        
       
         μ 
        
       
      
        P I C P&lt;\mu
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.7224em; vertical-align: -0.0391em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1389em;">
          P
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0785em;">
          I
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1389em;">
          CP
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          &lt;
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.625em; vertical-align: -0.1944em;">
         </span>
         <span class="mord mathnormal">
          μ
         </span>
        </span>
       </span>
      </span>
     </span>
     , else 0
     <br/>
     μ为期望覆盖率；𝜂为惩罚系数；
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/bb3f437f8f5b4c38b7ed3b1e7ca12fb6.png">
      <br/>
      <strong>
       结果如下：
      </strong>
      <br/>
      论文通过二维t-SNE和PCA两种降维方法对原始洪水时间序列、TimeGAN生成的合成序列以及RTSGAN生成的合成序列进行了可视化分析。结果表明，RTSGAN生成的合成序列在分布上与原始数据集更为接近，表现为数据点簇的形状和密度更贴近原始数据，而TimeGAN生成的序列分布则稍显分散，偏离原始数据的特征。此外，RTSGAN生成的数据点不仅更集中，还展现出更高的多样性。
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/3765d0b8351d4a4589584708277ad9bf.png">
       <br/>
       图6通过热图形式展示了原始数据集、TimeGAN和RTSGAN生成序列在不同时间滞后 𝜏 下的时间相关性对比。热图中，颜色深浅表示相关系数的大小，RTSGAN的热图模式与原始数据高度一致，尤其是在日尺度上，梧州站点的合成序列时间相关系数几乎完全重合原始数据。这表明RTSGAN能够精确再现洪水序列的时间依赖性，例如洪峰的到达时间和衰退过程。
       <br/>
       在小时尺度上，由于时间步长更小，序列长度增加，对模型捕捉长期依赖性的要求更高。RTSGAN依然表现出色，其热图显示的空间相关性和时间相关性均优于TimeGAN。这可能是由于RTSGAN的自回归解码器设计，能够逐步生成序列并保留长期依赖。RTSGAN训练时间更短。
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/215f472b4af64b1e9a795870d008d4fc.png"/>
       <br/>
       在多时间步预测任务中，论文比较了GBRT、LSTM、QRLSTM等模型的性能，图7展示了日尺度下各模型在T、T+1、T+2的评估指标箱线图，包括OC、AARE等。结果显示，LSTM在所有预测步长中的OC最高，AARE最低，且随着预测期从T到T+2增加，其优势逐渐扩大。例如，箱线图中LSTM的中位数OC值可能接近1，离群点较少，而其他模型的OC分布更分散，AARE更高。LSTM“三门”机制使LSTM能够有效捕捉洪水时间序列中的长期依赖关系。相比之下，GBRT基于窗口的特征提取更适合短期依赖，而QRLSTM在不确定性预测上虽有优势，但在点预测准确性上不如标准LSTM。
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/6f7374201dd84216a870ff719e894079.png"/>
       <br/>
       RTSGAN生成的合成数据集能显著提升基于窗口的GBRT模型性能，尤其在较长预测期。在24小时预测中，GBRT - RTSGAN在CC和NSE指标上分别比GBRT高2.08%和6.74%，RMSE降低，AARE减少56.52%。而TimeGAN对GBRT的改进效果有限且不稳定，其合成训练集甚至会导致误差范围增大。合成数据集对LSTM的有效性随预测期增加而急剧下降。
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/6737e95ee46f48909105b2555e94becd.png"/>
       <br/>
       SHAP分析用于解释模型预测中各特征的重要性，通过SHAP分析发现，GBRT和GBRT - RTSGAN模型使用几乎相同的影响因素进行预测，且形状值模式趋势一致；而GBRT - TimeGAN从T + 5步开始与GBRT的形状值模式差异较大。
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2a6988c485524be0b0ad484b6924319d.png"/>
       <br/>
       引入合成训练数据集可帮助QRLSTM模型获得更低的PINAW，但会降PICP，只有少数情况能在保持区间覆盖的同时减小区间宽度。图12结果显示，使用RTSGAN或TimeGAN的合成数据后，QRLSTM的PINAW降低，例如从0.15降至0.10，表明预测区间更窄、更精确。但是PICP从0.95降至0.85，说明部分观测值未被区间覆盖。这种权衡表明合成数据增强了模型的准确性，但牺牲了覆盖率。只有少数情况实现了PINAW降低的同时保持PICP接0.9。
       <br/>
       随着合成数据集数量增加，PINAW和PICP降低，模型的CWC下降。RTSGAN对PINAW的影响更大，表明可通过调节假样本数量使预测区间更灵活、易调整。尽管合成训练集在QRLSTM中表现不佳，但在洪水峰值处较窄的预测区间是可取的。
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7bc8f1d96b42428190f5f2767bdd526c.png"/>
      </img>
     </img>
    </p>
    <p>
     <strong>
      代码如下：
     </strong>
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np  
<span class="token keyword">import</span> torch  
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn  
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">as</span> optim  <span class="token comment"># 导入PyTorch的优化器模块</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> GradientBoostingRegressor  <span class="token comment"># 导入sklearn的GBRT模型</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> mean_squared_error  <span class="token comment"># 导入sklearn的均方误差计算函数</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt  

<span class="token comment"># 设置随机种子，确保结果可重复</span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
torch<span class="token punctuation">.</span>manual_seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>

<span class="token comment"># 定义数据参数</span>
n_samples <span class="token operator">=</span> <span class="token number">1755</span>  <span class="token comment"># 样本数量，参考论文小时尺度数据</span>
n_features <span class="token operator">=</span> <span class="token number">3</span>  <span class="token comment"># 特征数量（假设流量、降雨量等）</span>
seq_len <span class="token operator">=</span> <span class="token number">16</span>  <span class="token comment"># 序列长度（窗口大小，48小时，每3小时一个时间步）</span>

<span class="token comment"># 生成模拟洪水时间序列数据，假设数据服从正弦波+噪声的形式</span>
time_steps <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>seq_len<span class="token punctuation">)</span>  <span class="token comment"># 创建时间步数组</span>
data <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>n_samples<span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> n_features<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 初始化数据数组</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_samples<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> f <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_features<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 生成正弦波数据，模拟周期性洪水特征</span>
        data<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> f<span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">0.1</span> <span class="token operator">*</span> time_steps <span class="token operator">+</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> seq_len<span class="token punctuation">)</span>

<span class="token comment"># 将数据转换为PyTorch张量</span>
data <span class="token operator">=</span> torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment"># 转换为浮点张量，形状为[n_samples, seq_len, n_features]</span>

<span class="token comment"># 定义GRU网络类，作为TimeGAN的基础模块</span>
<span class="token keyword">class</span> <span class="token class-name">GRU</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">,</span> num_layers<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>GRU<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>hidden_dim <span class="token operator">=</span> hidden_dim  <span class="token comment"># 设置隐藏层维度</span>
        self<span class="token punctuation">.</span>num_layers <span class="token operator">=</span> num_layers  <span class="token comment"># 设置GRU层数</span>
        self<span class="token punctuation">.</span>gru <span class="token operator">=</span> nn<span class="token punctuation">.</span>GRU<span class="token punctuation">(</span>input_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">,</span> num_layers<span class="token punctuation">,</span> batch_first<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 定义GRU层</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 初始化隐藏状态</span>
        h0 <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>self<span class="token punctuation">.</span>num_layers<span class="token punctuation">,</span> x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>hidden_dim<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>x<span class="token punctuation">.</span>device<span class="token punctuation">)</span>
        <span class="token comment"># 前向传播</span>
        out<span class="token punctuation">,</span> _ <span class="token operator">=</span> self<span class="token punctuation">.</span>gru<span class="token punctuation">(</span>x<span class="token punctuation">,</span> h0<span class="token punctuation">)</span>
        <span class="token keyword">return</span> out

<span class="token comment"># 定义TimeGAN模型</span>
<span class="token keyword">class</span> <span class="token class-name">TimeGAN</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">,</span> num_layers<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>TimeGAN<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>hidden_dim <span class="token operator">=</span> hidden_dim  <span class="token comment"># 设置隐藏层维度</span>
        self<span class="token punctuation">.</span>input_dim <span class="token operator">=</span> input_dim  <span class="token comment"># 设置输入维度</span>

        <span class="token comment"># 嵌入函数（Embedding Function）</span>
        self<span class="token punctuation">.</span>embedder <span class="token operator">=</span> GRU<span class="token punctuation">(</span>input_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">,</span> num_layers<span class="token punctuation">)</span>  <span class="token comment"># 定义嵌入函数，使用GRU网络</span>
        <span class="token comment"># 恢复函数（Recovery Function）</span>
        self<span class="token punctuation">.</span>recovery <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_dim<span class="token punctuation">,</span> input_dim<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 线性层，将隐藏状态映射回输入维度</span>
            nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># Sigmoid激活，确保输出在[0, 1]范围内</span>
        <span class="token punctuation">)</span>
        <span class="token comment"># 生成器（Generator）</span>
        self<span class="token punctuation">.</span>generator <span class="token operator">=</span> GRU<span class="token punctuation">(</span>hidden_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">,</span> num_layers<span class="token punctuation">)</span>  <span class="token comment"># 定义生成器，使用GRU网络</span>
        self<span class="token punctuation">.</span>gen_output <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">)</span>  <span class="token comment"># 线性层，生成潜在表示</span>
        <span class="token comment"># 判别器（Discriminator）</span>
        self<span class="token punctuation">.</span>discriminator <span class="token operator">=</span> GRU<span class="token punctuation">(</span>hidden_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">,</span> num_layers<span class="token punctuation">)</span>  <span class="token comment"># 定义判别器，使用GRU网络</span>
        self<span class="token punctuation">.</span>dis_output <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_dim<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 线性层，输出判别结果</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 嵌入：将输入数据映射到潜在空间</span>
        h <span class="token operator">=</span> self<span class="token punctuation">.</span>embedder<span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment"># 通过嵌入函数生成潜在表示h</span>
        <span class="token comment"># 恢复：从潜在空间重建输入数据</span>
        x_tilde <span class="token operator">=</span> self<span class="token punctuation">.</span>recovery<span class="token punctuation">(</span>h<span class="token punctuation">)</span>  <span class="token comment"># 通过恢复函数重建数据</span>
        <span class="token keyword">return</span> h<span class="token punctuation">,</span> x_tilde

    <span class="token keyword">def</span> <span class="token function">generate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 生成器：从噪声生成潜在表示</span>
        h_hat <span class="token operator">=</span> self<span class="token punctuation">.</span>generator<span class="token punctuation">(</span>z<span class="token punctuation">)</span>  <span class="token comment"># 通过生成器生成潜在表示</span>
        h_hat <span class="token operator">=</span> self<span class="token punctuation">.</span>gen_output<span class="token punctuation">(</span>h_hat<span class="token punctuation">)</span>  <span class="token comment"># 映射到潜在空间</span>
        <span class="token comment"># 恢复：从生成的潜在表示生成数据</span>
        x_hat <span class="token operator">=</span> self<span class="token punctuation">.</span>recovery<span class="token punctuation">(</span>h_hat<span class="token punctuation">)</span>  <span class="token comment"># 通过恢复函数生成合成数据</span>
        <span class="token keyword">return</span> x_hat

<span class="token comment"># 设置模型参数</span>
input_dim <span class="token operator">=</span> n_features  <span class="token comment"># 输入维度（特征数）</span>
hidden_dim <span class="token operator">=</span> <span class="token number">24</span>  <span class="token comment"># 隐藏层维度，参考论文中的设置</span>
num_layers <span class="token operator">=</span> <span class="token number">3</span>  <span class="token comment"># GRU层数</span>

<span class="token comment"># 初始化TimeGAN模型</span>
timegan <span class="token operator">=</span> TimeGAN<span class="token punctuation">(</span>input_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">,</span> num_layers<span class="token punctuation">)</span>

<span class="token comment"># 定义损失函数</span>
mse_loss <span class="token operator">=</span> nn<span class="token punctuation">.</span>MSELoss<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 均方误差损失，用于自编码和监督损失</span>
bce_loss <span class="token operator">=</span> nn<span class="token punctuation">.</span>BCEWithLogitsLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 二元交叉熵损失，用于对抗损失</span>

<span class="token comment"># 定义优化器</span>
optimizer_E <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>timegan<span class="token punctuation">.</span>embedder<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">list</span><span class="token punctuation">(</span>timegan<span class="token punctuation">.</span>recovery<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span>  <span class="token comment"># 嵌入和恢复优化器</span>
optimizer_G <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>timegan<span class="token punctuation">.</span>generator<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">list</span><span class="token punctuation">(</span>timegan<span class="token punctuation">.</span>gen_output<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span>  <span class="token comment"># 生成器优化器</span>
optimizer_D <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>timegan<span class="token punctuation">.</span>discriminator<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">list</span><span class="token punctuation">(</span>timegan<span class="token punctuation">.</span>dis_output<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span>  <span class="token comment"># 判别器优化器</span>

<span class="token comment"># 训练TimeGAN</span>
num_epochs <span class="token operator">=</span> <span class="token number">100</span>  <span class="token comment"># 训练轮数</span>
batch_size <span class="token operator">=</span> <span class="token number">128</span>  <span class="token comment"># 批次大小</span>
<span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_samples<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取批次数据</span>
        batch_data <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> batch_size<span class="token punctuation">]</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> data<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> batch_size<span class="token punctuation">]</span>

        <span class="token comment"># 训练嵌入和恢复（自编码损失）</span>
        optimizer_E<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 清零梯度</span>
        h<span class="token punctuation">,</span> x_tilde <span class="token operator">=</span> timegan<span class="token punctuation">(</span>batch_data<span class="token punctuation">)</span>  <span class="token comment"># 前向传播，得到潜在表示和重建数据</span>
        recon_loss <span class="token operator">=</span> mse_loss<span class="token punctuation">(</span>x_tilde<span class="token punctuation">,</span> batch_data<span class="token punctuation">)</span>  <span class="token comment"># 计算自编码损失</span>
        recon_loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 反向传播</span>
        optimizer_E<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 更新参数</span>

        <span class="token comment"># 训练判别器</span>
        optimizer_D<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 清零梯度</span>
        real_h <span class="token operator">=</span> timegan<span class="token punctuation">.</span>embedder<span class="token punctuation">(</span>batch_data<span class="token punctuation">)</span>  <span class="token comment"># 嵌入真实数据</span>
        real_logit <span class="token operator">=</span> timegan<span class="token punctuation">.</span>dis_output<span class="token punctuation">(</span>timegan<span class="token punctuation">.</span>discriminator<span class="token punctuation">(</span>real_h<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 判别真实数据</span>
        z <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">)</span>  <span class="token comment"># 生成随机噪声</span>
        fake_x <span class="token operator">=</span> timegan<span class="token punctuation">.</span>generate<span class="token punctuation">(</span>z<span class="token punctuation">)</span>  <span class="token comment"># 生成合成数据</span>
        fake_h <span class="token operator">=</span> timegan<span class="token punctuation">.</span>embedder<span class="token punctuation">(</span>fake_x<span class="token punctuation">)</span>  <span class="token comment"># 嵌入合成数据</span>
        fake_logit <span class="token operator">=</span> timegan<span class="token punctuation">.</span>dis_output<span class="token punctuation">(</span>timegan<span class="token punctuation">.</span>discriminator<span class="token punctuation">(</span>fake_h<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 判别合成数据</span>
        d_loss <span class="token operator">=</span> bce_loss<span class="token punctuation">(</span>real_logit<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>real_logit<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> bce_loss<span class="token punctuation">(</span>fake_logit<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>fake_logit<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 计算判别器损失</span>
        d_loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 反向传播</span>
        optimizer_D<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 更新参数</span>

        <span class="token comment"># 训练生成器</span>
        optimizer_G<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 清零梯度</span>
        z <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">)</span>  <span class="token comment"># 生成随机噪声</span>
        fake_x <span class="token operator">=</span> timegan<span class="token punctuation">.</span>generate<span class="token punctuation">(</span>z<span class="token punctuation">)</span>  <span class="token comment"># 生成合成数据</span>
        fake_h <span class="token operator">=</span> timegan<span class="token punctuation">.</span>embedder<span class="token punctuation">(</span>fake_x<span class="token punctuation">)</span>  <span class="token comment"># 嵌入合成数据</span>
        fake_logit <span class="token operator">=</span> timegan<span class="token punctuation">.</span>dis_output<span class="token punctuation">(</span>timegan<span class="token punctuation">.</span>discriminator<span class="token punctuation">(</span>fake_h<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 判别合成数据</span>
        g_loss <span class="token operator">=</span> bce_loss<span class="token punctuation">(</span>fake_logit<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>fake_logit<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 计算生成器对抗损失</span>
        <span class="token comment"># 计算监督损失（使用真实数据监督生成器）</span>
        supervised_loss <span class="token operator">=</span> mse_loss<span class="token punctuation">(</span>fake_x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> fake_x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 监督损失：预测下一步</span>
        total_g_loss <span class="token operator">=</span> g_loss <span class="token operator">+</span> <span class="token number">0.1</span> <span class="token operator">*</span> supervised_loss  <span class="token comment"># 总生成器损失（对抗损失+监督损失）</span>
        total_g_loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 反向传播</span>
        optimizer_G<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 更新参数</span>

    <span class="token comment"># 打印损失</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Epoch </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>epoch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>num_epochs<span class="token punctuation">}</span></span><span class="token string">, Recon Loss: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>recon_loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">, D Loss: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>d_loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">, G Loss: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>total_g_loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 生成合成数据</span>
<span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    z <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>n_samples<span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">)</span>  <span class="token comment"># 生成随机噪声</span>
    synthetic_data_timegan <span class="token operator">=</span> timegan<span class="token punctuation">.</span>generate<span class="token punctuation">(</span>z<span class="token punctuation">)</span>  <span class="token comment"># 生成合成数据</span>
synthetic_data_timegan <span class="token operator">=</span> synthetic_data_timegan<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 转换为numpy数组</span>

<span class="token comment"># 定义RTSGAN模型</span>
<span class="token keyword">class</span> <span class="token class-name">RTSGAN</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">,</span> num_layers<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>RTSGAN<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>hidden_dim <span class="token operator">=</span> hidden_dim  <span class="token comment"># 设置隐藏层维度</span>
        self<span class="token punctuation">.</span>input_dim <span class="token operator">=</span> input_dim  <span class="token comment"># 设置输入维度</span>

        <span class="token comment"># 自回归编码器（Autoregressive Encoder）</span>
        self<span class="token punctuation">.</span>encoder <span class="token operator">=</span> GRU<span class="token punctuation">(</span>input_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">,</span> num_layers<span class="token punctuation">)</span>  <span class="token comment"># 定义编码器，使用GRU网络</span>
        self<span class="token punctuation">.</span>encoder_output <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_dim <span class="token operator">*</span> seq_len<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">)</span>  <span class="token comment"># 线性层，压缩为固定维度潜在表示</span>

        <span class="token comment"># 自回归解码器（Autoregressive Decoder）</span>
        self<span class="token punctuation">.</span>decoder <span class="token operator">=</span> GRU<span class="token punctuation">(</span>input_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">,</span> num_layers<span class="token punctuation">)</span>  <span class="token comment"># 定义解码器，使用GRU网络</span>
        self<span class="token punctuation">.</span>decoder_output <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_dim<span class="token punctuation">,</span> input_dim<span class="token punctuation">)</span>  <span class="token comment"># 线性层，生成输出数据</span>

        <span class="token comment"># 判别器（Critic for WGAN）</span>
        self<span class="token punctuation">.</span>critic <span class="token operator">=</span> GRU<span class="token punctuation">(</span>hidden_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">,</span> num_layers<span class="token punctuation">)</span>  <span class="token comment"># 定义判别器，使用GRU网络</span>
        self<span class="token punctuation">.</span>critic_output <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_dim<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 线性层，输出Wasserstein距离</span>

    <span class="token keyword">def</span> <span class="token function">encode</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 编码：将输入序列压缩为固定维度潜在表示</span>
        h <span class="token operator">=</span> self<span class="token punctuation">.</span>encoder<span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment"># 通过编码器生成隐藏状态</span>
        h <span class="token operator">=</span> h<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>h<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 展平隐藏状态</span>
        r <span class="token operator">=</span> self<span class="token punctuation">.</span>encoder_output<span class="token punctuation">(</span>h<span class="token punctuation">)</span>  <span class="token comment"># 压缩为固定维度潜在表示</span>
        <span class="token keyword">return</span> r

    <span class="token keyword">def</span> <span class="token function">decode</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 解码：从潜在表示生成序列</span>
        batch_size <span class="token operator">=</span> r<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 获取批次大小</span>
        <span class="token comment"># 初始化解码器输入</span>
        x_hat <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> self<span class="token punctuation">.</span>input_dim<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>r<span class="token punctuation">.</span>device<span class="token punctuation">)</span>  <span class="token comment"># 初始化生成序列</span>
        h <span class="token operator">=</span> r<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 将潜在表示扩展到序列长度</span>
        <span class="token comment"># 自回归解码</span>
        <span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>seq_len<span class="token punctuation">)</span><span class="token punctuation">:</span>
            h_t <span class="token operator">=</span> self<span class="token punctuation">.</span>decoder<span class="token punctuation">(</span>x_hat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span>t<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># 获取当前时间步的隐藏状态</span>
            x_hat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> t<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>decoder_output<span class="token punctuation">(</span>h_t<span class="token punctuation">)</span>  <span class="token comment"># 生成当前时间步的输出</span>
        <span class="token keyword">return</span> x_hat

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 前向传播：编码+解码</span>
        r <span class="token operator">=</span> self<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment"># 编码</span>
        x_tilde <span class="token operator">=</span> self<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>r<span class="token punctuation">)</span>  <span class="token comment"># 解码</span>
        <span class="token keyword">return</span> r<span class="token punctuation">,</span> x_tilde

<span class="token comment"># 初始化RTSGAN模型</span>
rtsgan <span class="token operator">=</span> RTSGAN<span class="token punctuation">(</span>input_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">,</span> num_layers<span class="token punctuation">)</span>

<span class="token comment"># 定义优化器</span>
optimizer_E <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>rtsgan<span class="token punctuation">.</span>encoder<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">list</span><span class="token punctuation">(</span>rtsgan<span class="token punctuation">.</span>decoder<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span>  <span class="token comment"># 编码器和解码器优化器</span>
optimizer_G <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>rtsgan<span class="token punctuation">.</span>decoder<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span>  <span class="token comment"># 生成器优化器</span>
optimizer_C <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>rtsgan<span class="token punctuation">.</span>critic<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">list</span><span class="token punctuation">(</span>rtsgan<span class="token punctuation">.</span>critic_output<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span>  <span class="token comment"># 判别器优化器</span>

<span class="token comment"># WGAN-GP的梯度惩罚</span>
<span class="token keyword">def</span> <span class="token function">gradient_penalty</span><span class="token punctuation">(</span>critic<span class="token punctuation">,</span> real<span class="token punctuation">,</span> fake<span class="token punctuation">)</span><span class="token punctuation">:</span>
    alpha <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>real<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>real<span class="token punctuation">.</span>device<span class="token punctuation">)</span>  <span class="token comment"># 随机插值系数</span>
    interpolates <span class="token operator">=</span> alpha <span class="token operator">*</span> real <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> alpha<span class="token punctuation">)</span> <span class="token operator">*</span> fake  <span class="token comment"># 插值数据</span>
    interpolates<span class="token punctuation">.</span>requires_grad_<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 允许计算梯度</span>
    critic_inter <span class="token operator">=</span> critic<span class="token punctuation">(</span>interpolates<span class="token punctuation">)</span>  <span class="token comment"># 判别插值数据</span>
    gradients <span class="token operator">=</span> torch<span class="token punctuation">.</span>autograd<span class="token punctuation">.</span>grad<span class="token punctuation">(</span>outputs<span class="token operator">=</span>critic_inter<span class="token punctuation">,</span> inputs<span class="token operator">=</span>interpolates<span class="token punctuation">,</span>
                                    grad_outputs<span class="token operator">=</span>torch<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>critic_inter<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    create_graph<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> retain_graph<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># 计算梯度</span>
    gradients <span class="token operator">=</span> gradients<span class="token punctuation">.</span>view<span class="token punctuation">(</span>gradients<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 展平梯度</span>
    gradient_norm <span class="token operator">=</span> gradients<span class="token punctuation">.</span>norm<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 计算梯度范数</span>
    gp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>gradient_norm <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 计算梯度惩罚</span>
    <span class="token keyword">return</span> gp

<span class="token comment"># 训练RTSGAN</span>
lambda_gp <span class="token operator">=</span> <span class="token number">10</span>  <span class="token comment"># 梯度惩罚系数，参考论文</span>
<span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_samples<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取批次数据</span>
        batch_data <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> batch_size<span class="token punctuation">]</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> data<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> batch_size<span class="token punctuation">]</span>

        <span class="token comment"># 训练编码器和解码器（自编码损失）</span>
        optimizer_E<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 清零梯度</span>
        r<span class="token punctuation">,</span> x_tilde <span class="token operator">=</span> rtsgan<span class="token punctuation">(</span>batch_data<span class="token punctuation">)</span>  <span class="token comment"># 前向传播，得到潜在表示和重建数据</span>
        recon_loss <span class="token operator">=</span> mse_loss<span class="token punctuation">(</span>x_tilde<span class="token punctuation">,</span> batch_data<span class="token punctuation">)</span>  <span class="token comment"># 计算自编码损失</span>
        recon_loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 反向传播</span>
        optimizer_E<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 更新参数</span>

        <span class="token comment"># 训练判别器（WGAN-GP）</span>
        optimizer_C<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 清零梯度</span>
        real_r <span class="token operator">=</span> rtsgan<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>batch_data<span class="token punctuation">)</span>  <span class="token comment"># 编码真实数据</span>
        real_h <span class="token operator">=</span> rtsgan<span class="token punctuation">.</span>critic<span class="token punctuation">(</span>real_r<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 判别真实数据</span>
        real_score <span class="token operator">=</span> rtsgan<span class="token punctuation">.</span>critic_output<span class="token punctuation">(</span>real_h<span class="token punctuation">)</span>  <span class="token comment"># 计算真实数据得分</span>
        z <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">)</span>  <span class="token comment"># 生成随机噪声</span>
        fake_x <span class="token operator">=</span> rtsgan<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>z<span class="token punctuation">)</span>  <span class="token comment"># 生成合成数据</span>
        fake_r <span class="token operator">=</span> rtsgan<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>fake_x<span class="token punctuation">)</span>  <span class="token comment"># 编码合成数据</span>
        fake_h <span class="token operator">=</span> rtsgan<span class="token punctuation">.</span>critic<span class="token punctuation">(</span>fake_r<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 判别合成数据</span>
        fake_score <span class="token operator">=</span> rtsgan<span class="token punctuation">.</span>critic_output<span class="token punctuation">(</span>fake_h<span class="token punctuation">)</span>  <span class="token comment"># 计算合成数据得分</span>
        gp <span class="token operator">=</span> gradient_penalty<span class="token punctuation">(</span>rtsgan<span class="token punctuation">.</span>critic<span class="token punctuation">,</span> real_r<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fake_r<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 计算梯度惩罚</span>
        c_loss <span class="token operator">=</span> fake_score<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> real_score<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> lambda_gp <span class="token operator">*</span> gp  <span class="token comment"># WGAN-GP损失</span>
        c_loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 反向传播</span>
        optimizer_C<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 更新参数</span>

        <span class="token comment"># 训练生成器</span>
        optimizer_G<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 清零梯度</span>
        z <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">)</span>  <span class="token comment"># 生成随机噪声</span>
        fake_x <span class="token operator">=</span> rtsgan<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>z<span class="token punctuation">)</span>  <span class="token comment"># 生成合成数据</span>
        fake_r <span class="token operator">=</span> rtsgan<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>fake_x<span class="token punctuation">)</span>  <span class="token comment"># 编码合成数据</span>
        fake_h <span class="token operator">=</span> rtsgan<span class="token punctuation">.</span>critic<span class="token punctuation">(</span>fake_r<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 判别合成数据</span>
        fake_score <span class="token operator">=</span> rtsgan<span class="token punctuation">.</span>critic_output<span class="token punctuation">(</span>fake_h<span class="token punctuation">)</span>  <span class="token comment"># 计算合成数据得分</span>
        g_loss <span class="token operator">=</span> <span class="token operator">-</span>fake_score<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 生成器损失（WGAN）</span>
        g_loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 反向传播</span>
        optimizer_G<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 更新参数</span>

    <span class="token comment"># 打印损失</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Epoch </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>epoch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>num_epochs<span class="token punctuation">}</span></span><span class="token string">, Recon Loss: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>recon_loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">, C Loss: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>c_loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">, G Loss: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>g_loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 生成合成数据</span>
<span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    z <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>n_samples<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">)</span>  <span class="token comment"># 生成随机噪声</span>
    synthetic_data_rtsgan <span class="token operator">=</span> rtsgan<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>z<span class="token punctuation">)</span>  <span class="token comment"># 生成合成数据</span>
synthetic_data_rtsgan <span class="token operator">=</span> synthetic_data_rtsgan<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 转换为numpy数组</span>

<span class="token comment"># 准备监督学习数据</span>
<span class="token keyword">def</span> <span class="token function">prepare_supervised_data</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> window_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    inputs<span class="token punctuation">,</span> targets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 初始化输入和目标列表</span>
    data <span class="token operator">=</span> data<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 展平数据，形状为[n_samples, seq_len * n_features]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">-</span> window_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        inputs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> window_size<span class="token punctuation">]</span><span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 提取输入窗口</span>
        targets<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">[</span>i <span class="token operator">+</span> window_size<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 提取目标（最后一个特征）</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>targets<span class="token punctuation">)</span>

<span class="token comment"># 准备真实数据和合成数据</span>
window_size <span class="token operator">=</span> <span class="token number">3</span>  <span class="token comment"># 窗口大小，参考图4</span>
real_inputs<span class="token punctuation">,</span> real_targets <span class="token operator">=</span> prepare_supervised_data<span class="token punctuation">(</span>data<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> window_size<span class="token punctuation">)</span>  <span class="token comment"># 准备真实数据</span>
syn_inputs_timegan<span class="token punctuation">,</span> syn_targets_timegan <span class="token operator">=</span> prepare_supervised_data<span class="token punctuation">(</span>synthetic_data_timegan<span class="token punctuation">,</span> window_size<span class="token punctuation">)</span>  <span class="token comment"># 准备TimeGAN合成数据</span>
syn_inputs_rtsgan<span class="token punctuation">,</span> syn_targets_rtsgan <span class="token operator">=</span> prepare_supervised_data<span class="token punctuation">(</span>synthetic_data_rtsgan<span class="token punctuation">,</span> window_size<span class="token punctuation">)</span>  <span class="token comment"># 准备RTSGAN合成数据</span>

<span class="token comment"># 混合真实和合成数据</span>
mixed_inputs <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">[</span>real_inputs<span class="token punctuation">,</span> syn_inputs_rtsgan<span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 混合真实和RTSGAN数据</span>
mixed_targets <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">[</span>real_targets<span class="token punctuation">,</span> syn_targets_rtsgan<span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 混合目标</span>

<span class="token comment"># 训练GBRT模型</span>
gbrt <span class="token operator">=</span> GradientBoostingRegressor<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>  <span class="token comment"># 初始化GBRT模型</span>
gbrt<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>mixed_inputs<span class="token punctuation">,</span> mixed_targets<span class="token punctuation">)</span>  <span class="token comment"># 训练GBRT模型</span>
gbrt_pred <span class="token operator">=</span> gbrt<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>real_inputs<span class="token punctuation">)</span>  <span class="token comment"># 使用真实数据预测</span>
gbrt_mse <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>real_targets<span class="token punctuation">,</span> gbrt_pred<span class="token punctuation">)</span>  <span class="token comment"># 计算均方误差</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"GBRT MSE: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>gbrt_mse<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 打印均方误差</span>

<span class="token comment"># 定义LSTM模型</span>
<span class="token keyword">class</span> <span class="token class-name">LSTM</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">,</span> num_layers<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>LSTM<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lstm <span class="token operator">=</span> nn<span class="token punctuation">.</span>LSTM<span class="token punctuation">(</span>input_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">,</span> num_layers<span class="token punctuation">,</span> batch_first<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 定义LSTM层</span>
        self<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_dim<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 定义全连接层</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        h0 <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>num_layers<span class="token punctuation">,</span> x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hidden_dim<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>x<span class="token punctuation">.</span>device<span class="token punctuation">)</span>  <span class="token comment"># 初始化隐藏状态</span>
        c0 <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>num_layers<span class="token punctuation">,</span> x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hidden_dim<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>x<span class="token punctuation">.</span>device<span class="token punctuation">)</span>  <span class="token comment"># 初始化单元状态</span>
        out<span class="token punctuation">,</span> _ <span class="token operator">=</span> self<span class="token punctuation">.</span>lstm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token punctuation">(</span>h0<span class="token punctuation">,</span> c0<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 前向传播</span>
        out <span class="token operator">=</span> self<span class="token punctuation">.</span>fc<span class="token punctuation">(</span>out<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 取最后一个时间步输出</span>
        <span class="token keyword">return</span> out

<span class="token comment"># 初始化LSTM模型</span>
lstm <span class="token operator">=</span> LSTM<span class="token punctuation">(</span>input_dim<span class="token operator">=</span>n_features <span class="token operator">*</span> <span class="token punctuation">(</span>window_size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hidden_dim<span class="token operator">=</span>hidden_dim<span class="token punctuation">,</span> num_layers<span class="token operator">=</span>num_layers<span class="token punctuation">)</span>

<span class="token comment"># 定义优化器和损失函数</span>
optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>lstm<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span>  <span class="token comment"># 定义优化器</span>
criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>MSELoss<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 定义损失函数</span>

<span class="token comment"># 准备LSTM输入数据</span>
lstm_inputs <span class="token operator">=</span> torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">(</span>mixed_inputs<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> window_size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> n_features<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 重塑输入数据</span>
lstm_targets <span class="token operator">=</span> torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">(</span>mixed_targets<span class="token punctuation">)</span>  <span class="token comment"># 转换目标数据</span>

<span class="token comment"># 训练LSTM模型</span>
<span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 清零梯度</span>
    outputs <span class="token operator">=</span> lstm<span class="token punctuation">(</span>lstm_inputs<span class="token punctuation">)</span>  <span class="token comment"># 前向传播</span>
    loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>outputs<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lstm_targets<span class="token punctuation">)</span>  <span class="token comment"># 计算损失</span>
    loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 反向传播</span>
    optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 更新参数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"LSTM Epoch </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>epoch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>num_epochs<span class="token punctuation">}</span></span><span class="token string">, Loss: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 打印损失</span>

<span class="token comment"># 使用LSTM预测</span>
<span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    lstm_pred <span class="token operator">=</span> lstm<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">(</span>real_inputs<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> window_size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> n_features<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 预测</span>
lstm_pred <span class="token operator">=</span> lstm_pred<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 转换为numpy数组</span>
lstm_mse <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>real_targets<span class="token punctuation">,</span> lstm_pred<span class="token punctuation">)</span>  <span class="token comment"># 计算均方误差</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"LSTM MSE: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>lstm_mse<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 打印均方误差</span>

<span class="token comment"># 可视化预测结果</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 设置画布大小</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>real_targets<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"True"</span><span class="token punctuation">)</span>  <span class="token comment"># 绘制真实值</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>gbrt_pred<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"GBRT Pred"</span><span class="token punctuation">)</span>  <span class="token comment"># 绘制GBRT预测值</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>lstm_pred<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"LSTM Pred"</span><span class="token punctuation">)</span>  <span class="token comment"># 绘制LSTM预测值</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 显示图例</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Flood Forecasting Results"</span><span class="token punctuation">)</span>  <span class="token comment"># 设置标题</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 显示图像</span>
</code></pre>
    <h3>
     <a id="_422">
     </a>
     结论
    </h3>
    <p>
     机器学习对洪水预报有着重要的作用，但极端洪水事件稀少、现场数据不足导致模型的性能并没有充分发挥出来。TimeGAN生成的数据能够保留洪水场景的复杂时空相关性，引入合成数据集也有助于提升机器学习预测精度。不过对LSTM的改进有限，TimeGAN对Transformer等深度学习模型的有效性也有待进一步探究。
    </p>
    <h3>
     <a id="_424">
     </a>
     不足以及展望
    </h3>
    <p>
     作者提出了本论文中的不足，作者认为TimeGAN对如LSTM等深度学习模型的改进效果有限，没有发挥出实际的作用。未建立TimeGAN损失函数与下游预报性能的关联性，缺乏了对用户自定义参数敏感性分析。
     <br/>
     关于对论文未来的展望，作者提出后续实验可建立TimeGAN损失函数与下游预报性能的直接联系。还需要考虑将天气信息作为洪水预报模型的重要输入变量，以提供长周期预报。此外，需要进一步探索生成的洪水场景在洪水风险管理中的各种应用。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f5a63796d61746963732f:61727469636c652f64657461696c732f313435393831363132" class_="artid" style="display:none">
 </p>
</div>


