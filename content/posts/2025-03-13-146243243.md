---
layout: post
title: "后端django-drfDjango-DRF-API-编写规范程序设计规则"
date: 2025-03-13 21:51:17 +0800
description: "为了确保 Django DRF 代码的可维护性、可扩展性和高质量，API 设计不仅要符合 RESTful 规范，还需要遵循一定的**程序设计规则**。以下是一些关键的编写规范，以保证代码的清晰性、可读性和稳定性。"
keywords: "【后端】【django drf】Django DRF API 编写规范（程序设计规则）"
categories: ['面试考题专栏前后端', '后端系统功能', 'Django']
tags: ['Sqlite', 'Python', 'Django']
artid: "146243243"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146243243
    alt: "后端django-drfDjango-DRF-API-编写规范程序设计规则"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146243243
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146243243
cover: https://bing.ee123.net/img/rand?artid=146243243
image: https://bing.ee123.net/img/rand?artid=146243243
img: https://bing.ee123.net/img/rand?artid=146243243
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【后端】【django drf】Django DRF API 编写规范（程序设计规则）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="Django_DRF_API__0">
     </a>
     Django DRF API 编写规范（程序设计规则）
    </h2>
    <p>
     为了确保 Django DRF 代码的可维护性、可扩展性和高质量，API 设计不仅要符合 RESTful 规范，还需要遵循一定的
     <strong>
      程序设计规则
     </strong>
     。以下是一些关键的编写规范，以保证代码的清晰性、可读性和稳定性。
    </p>
    <hr/>
    <h3>
     <a id="_6">
     </a>
     一、代码组织与结构
    </h3>
    <h4>
     <a id="_8">
     </a>
     （一）项目目录结构
    </h4>
    <p>
     建议遵循 Django 的最佳实践，将 API 代码模块化，保持清晰的层次结构：
    </p>
    <pre><code>my_project/
│── my_app/
│   │── models.py          # 数据模型
│   │── serializers.py     # 序列化器
│   │── views.py          # 视图
│   │── urls.py           # 路由
│   │── permissions.py    # 权限
│   │── paginations.py    # 分页
│   │── filters.py        # 过滤器
│   │── services.py       # 业务逻辑
│   └── tests/            # 单元测试
│── config/
│   │── settings.py       # 项目配置
│   │── urls.py           # 主路由
│── manage.py
</code></pre>
    <ul>
     <li>
      <strong>
       <code>
        models.py
       </code>
      </strong>
      ：定义数据库模型
     </li>
     <li>
      <strong>
       <code>
        serializers.py
       </code>
      </strong>
      ：定义数据序列化逻辑
     </li>
     <li>
      <strong>
       <code>
        views.py
       </code>
      </strong>
      ：编写 API 逻辑
     </li>
     <li>
      <strong>
       <code>
        permissions.py
       </code>
      </strong>
      ：自定义权限
     </li>
     <li>
      <strong>
       <code>
        paginations.py
       </code>
      </strong>
      ：自定义分页逻辑
     </li>
     <li>
      <strong>
       <code>
        filters.py
       </code>
      </strong>
      ：定义过滤器
     </li>
     <li>
      <strong>
       <code>
        services.py
       </code>
      </strong>
      ：封装业务逻辑，避免视图代码膨胀
     </li>
     <li>
      <strong>
       <code>
        tests/
       </code>
      </strong>
      ：单元测试，提高代码质量
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_38">
     </a>
     二、视图层规范
    </h3>
    <h4>
     <a id="_ViewSet_40">
     </a>
     （一）优先使用
     <code>
      ViewSet
     </code>
    </h4>
    <p>
     避免
     <code>
      APIView
     </code>
     ，尽可能使用
     <code>
      ModelViewSet
     </code>
     来减少代码重复：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>viewsets <span class="token keyword">import</span> ModelViewSet
<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> User
<span class="token keyword">from</span> <span class="token punctuation">.</span>serializers <span class="token keyword">import</span> UserSerializer

<span class="token keyword">class</span> <span class="token class-name">UserViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> UserSerializer
</code></pre>
    <p>
     如果
     <code>
      ViewSet
     </code>
     过重，可以拆分逻辑到
     <code>
      services.py
     </code>
     ，避免过多业务逻辑混杂在视图层。
    </p>
    <h4>
     <a id="_ViewSet__HTTP__53">
     </a>
     （二）限制
     <code>
      ViewSet
     </code>
     的 HTTP 方法
    </h4>
    <p>
     如果某个
     <code>
      ViewSet
     </code>
     只需要支持部分 HTTP 方法，应在
     <code>
      viewset
     </code>
     里限制：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">UserViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> UserSerializer
    http_method_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'post'</span><span class="token punctuation">,</span> <span class="token string">'patch'</span><span class="token punctuation">,</span> <span class="token string">'delete'</span><span class="token punctuation">]</span>
</code></pre>
    <hr/>
    <h3>
     <a id="Serializers_64">
     </a>
     三、序列化器（Serializers）规范
    </h3>
    <h4>
     <a id="_ModelSerializer_66">
     </a>
     （一）使用
     <code>
      ModelSerializer
     </code>
    </h4>
    <p>
     尽可能使用
     <code>
      ModelSerializer
     </code>
     ，减少重复代码：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers
<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> User

<span class="token keyword">class</span> <span class="token class-name">UserSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> User
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"username"</span><span class="token punctuation">,</span> <span class="token string">"email"</span><span class="token punctuation">,</span> <span class="token string">"created_at"</span><span class="token punctuation">]</span>
</code></pre>
    <h4>
     <a id="_serializersSerializer__78">
     </a>
     （二）避免
     <code>
      serializers.Serializer
     </code>
     直接定义字段
    </h4>
    <p>
     除非是特殊业务数据结构，否则不推荐手写字段：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># ❌ 不推荐</span>
<span class="token keyword">class</span> <span class="token class-name">CustomSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    email <span class="token operator">=</span> serializers<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     尽量使用
     <code>
      ModelSerializer
     </code>
     直接绑定模型，减少维护成本。
    </p>
    <h4>
     <a id="_validate_xxx_88">
     </a>
     （三）字段验证逻辑放在
     <code>
      validate_xxx
     </code>
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">UserSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> User
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"username"</span><span class="token punctuation">,</span> <span class="token string">"email"</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">validate_email</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">"spam"</span> <span class="token keyword">in</span> value<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> serializers<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token string">"Email contains spam content"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> value
</code></pre>
    <hr/>
    <h3>
     <a id="Services__103">
     </a>
     四、业务逻辑拆分（Services 层）
    </h3>
    <p>
     为了避免
     <code>
      views.py
     </code>
     代码过于庞大，建议将业务逻辑封装到
     <code>
      services.py
     </code>
     ：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># services.py</span>
<span class="token keyword">def</span> <span class="token function">create_user</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>email<span class="token operator">=</span>email<span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Email already exists"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">,</span> email<span class="token operator">=</span>email<span class="token punctuation">)</span>
</code></pre>
    <p>
     然后在
     <code>
      views.py
     </code>
     里调用：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> <span class="token punctuation">.</span>services <span class="token keyword">import</span> create_user

<span class="token keyword">class</span> <span class="token class-name">UserViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">def</span> <span class="token function">perform_create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
        create_user<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>validated_data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> serializer<span class="token punctuation">.</span>validated_data<span class="token punctuation">[</span><span class="token string">"email"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h3>
     <a id="Permissions_125">
     </a>
     五、权限控制（Permissions）
    </h3>
    <h4>
     <a id="_permissionspy__127">
     </a>
     （一）尽可能使用
     <code>
      permissions.py
     </code>
     单独管理权限
    </h4>
    <p>
     避免直接在
     <code>
      views.py
     </code>
     里写权限判断，而是使用 Django DRF 的
     <code>
      permissions
     </code>
     机制：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> BasePermission

<span class="token keyword">class</span> <span class="token class-name">IsAdminUserOrReadOnly</span><span class="token punctuation">(</span>BasePermission<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">has_permission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> request<span class="token punctuation">.</span>user <span class="token keyword">and</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>is_staff
</code></pre>
    <p>
     然后在
     <code>
      views.py
     </code>
     里使用：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">UserViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>IsAdminUserOrReadOnly<span class="token punctuation">]</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_146">
     </a>
     六、查询优化
    </h3>
    <h4>
     <a id="_select_related__prefetch_related_148">
     </a>
     （一）使用
     <code>
      select_related
     </code>
     和
     <code>
      prefetch_related
     </code>
    </h4>
    <p>
     避免 N+1 查询：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">UserViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token string">"profile"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_155">
     </a>
     （二）使用分页减少数据库压力
    </h4>
    <p>
     配置全局分页：
    </p>
    <pre><code class="prism language-python">REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'DEFAULT_PAGINATION_CLASS'</span><span class="token punctuation">:</span> <span class="token string">'rest_framework.pagination.PageNumberPagination'</span><span class="token punctuation">,</span>
    <span class="token string">'PAGE_SIZE'</span><span class="token punctuation">:</span> <span class="token number">10</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_166">
     </a>
     七、异常处理
    </h3>
    <h4>
     <a id="_168">
     </a>
     （一）全局异常处理
    </h4>
    <p>
     在
     <code>
      exception_handler.py
     </code>
     里统一管理异常：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> exception_handler

<span class="token keyword">def</span> <span class="token function">custom_exception_handler</span><span class="token punctuation">(</span>exc<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    response <span class="token operator">=</span> exception_handler<span class="token punctuation">(</span>exc<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
    <span class="token keyword">if</span> response <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        response<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"code"</span><span class="token punctuation">:</span> response<span class="token punctuation">.</span>status_code<span class="token punctuation">,</span>
            <span class="token string">"message"</span><span class="token punctuation">:</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"detail"</span><span class="token punctuation">,</span> <span class="token string">"An error occurred"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">return</span> response
</code></pre>
    <p>
     在
     <code>
      settings.py
     </code>
     里配置：
    </p>
    <pre><code class="prism language-python">REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'EXCEPTION_HANDLER'</span><span class="token punctuation">:</span> <span class="token string">'my_app.exception_handler.custom_exception_handler'</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="Tests_191">
     </a>
     八、单元测试（Tests）
    </h3>
    <h4>
     <a id="_API__193">
     </a>
     （一）测试 API 逻辑
    </h4>
    <p>
     编写
     <code>
      pytest
     </code>
     测试，确保 API 可用：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> pytest
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>test <span class="token keyword">import</span> APIClient

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span>
<span class="token keyword">def</span> <span class="token function">test_create_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    client <span class="token operator">=</span> APIClient<span class="token punctuation">(</span><span class="token punctuation">)</span>
    response <span class="token operator">=</span> client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"/api/users/"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"john"</span><span class="token punctuation">,</span> <span class="token string">"email"</span><span class="token punctuation">:</span> <span class="token string">"john@example.com"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">201</span>
</code></pre>
    <h4>
     <a id="_206">
     </a>
     （二）覆盖率标准
    </h4>
    <p>
     使用
     <code>
      pytest
     </code>
     运行测试，并确保代码覆盖率：
    </p>
    <pre><code class="prism language-bash">pytest <span class="token parameter variable">--cov</span><span class="token operator">=</span>my_app
</code></pre>
    <hr/>
    <h4>
     <a id="_214">
     </a>
     <strong>
      总结
     </strong>
    </h4>
    <ol>
     <li>
      <strong>
       遵循 Django 项目目录结构，保持模块化设计
      </strong>
      。
     </li>
     <li>
      <strong>
       使用
       <code>
        ViewSet
       </code>
       处理 API 逻辑，并限制 HTTP 方法
      </strong>
      。
     </li>
     <li>
      <strong>
       优先使用
       <code>
        ModelSerializer
       </code>
       ，避免重复字段定义
      </strong>
      。
     </li>
     <li>
      <strong>
       业务逻辑拆分到
       <code>
        services.py
       </code>
       ，避免
       <code>
        views.py
       </code>
       代码过重
      </strong>
      。
     </li>
     <li>
      <strong>
       权限控制统一放在
       <code>
        permissions.py
       </code>
       ，避免手写权限逻辑
      </strong>
      。
     </li>
     <li>
      <strong>
       使用
       <code>
        select_related
       </code>
       和
       <code>
        prefetch_related
       </code>
       进行查询优化
      </strong>
      。
     </li>
     <li>
      <strong>
       使用
       <code>
        custom_exception_handler
       </code>
       统一异常处理
      </strong>
      。
     </li>
     <li>
      <strong>
       编写
       <code>
        pytest
       </code>
       单元测试，确保代码稳定
      </strong>
      。
     </li>
    </ol>
    <p>
     通过这些规则，可以提升 Django DRF API 的可维护性、扩展性和高效性，使代码更加清晰易读。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f35393334343132372f:61727469636c652f64657461696c732f313436323433323433" class_="artid" style="display:none">
 </p>
</div>


