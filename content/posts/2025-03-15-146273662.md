---
layout: post
title: "rust-的Clone"
date: 2025-03-15 07:42:27 +0800
description: "编程语言中一个核心特质（trait）， 定义了类型如何安全、明确地创建其值的深拷贝（deep copy）。如果要想Item类的变量赋值后所有权继续有效，就需要Item类实现clone()。报错的意思是变量a的所有权已经被移动到b，所以println！下面用实例来演示Clone的作用，先看一下如下的代码，注意此代码编译不过。方案一：手动为Item类实现trait Clone。"
keywords: "rust 的Clone"
categories: ['未分类']
tags: ['开发语言', 'Rust']
artid: "146273662"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146273662
    alt: "rust-的Clone"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146273662
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146273662
cover: https://bing.ee123.net/img/rand?artid=146273662
image: https://bing.ee123.net/img/rand?artid=146273662
img: https://bing.ee123.net/img/rand?artid=146273662
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     rust 的Clone
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <code>
      Clone
     </code>
     是
     <a href="https://so.csdn.net/so/search?q=Rust&amp;spm=1001.2101.3001.7020" title="Rust">
      Rust
     </a>
     编程语言中一个核心特质（trait）， 定义了类型如何安全、明确地创建其值的深拷贝（deep copy）。
    </p>
    <p>
     下面用实例来演示Clone的作用，先看一下如下的代码，注意此代码编译不过。
    </p>
    <pre><code class="language-rust">#[derive(Debug)]
struct Item{
    value: i32,
}

fn main() {
    let a = Item{value:7};
    let b = a;
    println!("value a {:?}, value b {:?}", a, b);
}</code></pre>
    <p>
     编译报错：
    </p>
    <blockquote>
     <p>
      cargo run
      <br/>
      <br/>
      error[E0382]: borrow of moved value: `a`
      <br/>
      --&gt; src/main.rs:10:44
      <br/>
      |
      <br/>
      8  |     let a = Item{value:7};
      <br/>
      |         - move occurs because `a` has type `Item`, which does not implement the `Copy` trait
      <br/>
      9  |     let b = a;
      <br/>
      |             - value moved here
      <br/>
      10 |     println!("value a {:?}, value b {:?}", a, b);
      <br/>
      |                                            ^ value borrowed here after move
      <br/>
      |
      <br/>
      note: if `Item` implemented `Clone`, you could clone the value
      <br/>
      --&gt; src/main.rs:3:1
      <br/>
      |
      <br/>
      3  | struct Item{
      <!-- -->
      <br/>
      | ^^^^^^^^^^^ consider implementing `Clone` for this type
      <br/>
      ...
      <br/>
      9  |     let b = a;
      <br/>
      |             - you could clone this value
      <br/>
      = note: this error originates in the macro `$crate::format_args_nl` which comes from the expansion of the macro `println` (in Nightly builds, run with -Z macro-backtrace for more info)
     </p>
     <p>
      For more information about this error, try `rustc --explain E0382`.
      <br/>
     </p>
    </blockquote>
    <p>
     报错的意思是变量a的所有权已经被移动到b，所以println！无法再使用a。
    </p>
    <p>
     如果要想Item类的变量赋值后所有权继续有效，就需要Item类实现clone()。
    </p>
    <p>
     方案一：手动为Item类实现trait Clone
    </p>
    <pre><code class="language-rust">#[derive(Debug)]
struct Item{
    value: i32,
}

impl Clone for Item{
    fn clone(&amp;self) -&gt; Self{
        Item { value: self.value, }
    }
}

fn main() {
    let a = Item{value:7};
    let b = a.clone();
    println!("value a {:?}, value b {:?}", a, b);
}</code></pre>
    <p>
     编译运行：
    </p>
    <blockquote>
     <p>
      Running `target\debug\greeting.exe`
      <br/>
      value a Item { value: 7 }, value b Item { value: 7 }
     </p>
    </blockquote>
    <p>
     方案二：
    </p>
    <p>
     使用
     <strong>
      属性（Attribute）
     </strong>
    </p>
    <pre><code class="language-rust">#[derive(Debug, Clone)]
struct Item{
    value: i32,
}


fn main() {
    let a = Item{value:7};
    let b = a.clone();
    println!("value a {:?}, value b {:?}", a, b);
}</code></pre>
    <p>
     编译运行
    </p>
    <blockquote>
     <p>
      Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.01s
      <br/>
      Running `target\debug\greeting.exe`
      <br/>
      value a Item { value: 7 }, value b Item { value: 7 }
     </p>
    </blockquote>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f79696e68657a68616e7368656e2f:61727469636c652f64657461696c732f313436323733363632" class_="artid" style="display:none">
 </p>
</div>


