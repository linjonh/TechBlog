---
layout: post
title: "数字投屏叫号器-发射端python窗口定制"
date: 2025-03-07 19:07:27 +0800
description: "最终实现，处于桌面最前端，发送指令，可以完成，处理txt，和播报语音。本系列前章介绍，视频音频的形成和传输。本章节开始定制小窗口。集成运行，需要指定声卡为虚拟声卡。"
keywords: "数字投屏叫号器-发射端python窗口定制"
categories: ['电视盒', '日常小操作', 'Python']
tags: ['开发语言', 'Python']
artid: "146103020"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146103020
    alt: "数字投屏叫号器-发射端python窗口定制"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146103020
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146103020
cover: https://bing.ee123.net/img/rand?artid=146103020
image: https://bing.ee123.net/img/rand?artid=146103020
img: https://bing.ee123.net/img/rand?artid=146103020
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     数字投屏叫号器-发射端python窗口定制
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="video">
     <iframe allowfullscreen="true" data-mediaembed="csdn" frameborder="0" id="1Tp5TGOh-1741348905559" src="https://live.csdn.net/v/embed/467514" style="width:100%;height:100%;">
     </iframe>
     <p>
      窗口
     </p>
    </div>
    <p>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/145afa7769b7416c895139aa6bf60ba1.png"/>
    </p>
    <p>
     本系列前章介绍，
     <a href="https://blog.csdn.net/wjcroom/article/details/145891339">
      叫号器的显示端
     </a>
     ，完成了视频音频的形成和传输的介绍。本章节开始定制小窗口。
     <br/>
     最终实现，处于桌面最前端，发送指令，集合前篇即可完成：
    </p>
    <ul>
     <li>
      处理本地text.txt更新，随之被rtsp采集
      <br/>
      ffmpeg 参数：
      <code>
       -vf "drawtext=textfile=text.txt:reload=1:x=10:y=10:fontsize=20:fontcolor=red:fontfile=simhei.ttf"
      </code>
     </li>
     <li>
      播报语音 透过虚拟声卡发送到rtsp
      <br/>
      ffmpeg 参数：
      <code>
       -f dshow -i audio="CABLE Output (VB-Audio Virtual Cable)" -acodec aac -b:a 128k
      </code>
     </li>
    </ul>
    <p>
     集成运行的要点
    </p>
    <ol>
     <li>
      指定声卡为虚拟声卡。
     </li>
     <li>
      运行mediamtx免费的流媒体服务器，
     </li>
     <li>
      本网络有一台可接受投屏，并支持rtsp流的显示设备android推荐airReciever
     </li>
    </ol>
    <p>
     补充：
     <br/>
     ffmpeg进程需要常驻后台，有断开检测。重启后需要再次推送。
     <br/>
     推流 的python任务，需要检测播放状态。dlna是播放就结束。airplay是播放后等待。需要选择一种。
    </p>
    <p>
     主要窗体代码：
    </p>
    <pre><code class="prism language-bash"><span class="token function">import</span> tkinter as tk
<span class="token function">import</span> pyttsx3
from tkinter <span class="token function">import</span> messagebox

<span class="token function">import</span> asyncio
 
<span class="token comment"># 数值验证函数</span>
def say<span class="token punctuation">(</span>text<span class="token punctuation">)</span>:
        <span class="token assign-left variable">eng</span><span class="token operator">=</span>pyttsx3.init<span class="token punctuation">(</span><span class="token punctuation">)</span>
        eng.say<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
        eng.runAndWait<span class="token punctuation">(</span><span class="token punctuation">)</span>
        update_status<span class="token punctuation">(</span>f<span class="token string">"{saytext}-播放结束"</span><span class="token punctuation">)</span>

 

def validate_num_input<span class="token punctuation">(</span>text<span class="token punctuation">)</span>:
    <span class="token keyword">if</span> text <span class="token operator">==</span> <span class="token string">""</span><span class="token builtin class-name">:</span>  <span class="token comment"># 允许清空输入框</span>
        <span class="token builtin class-name">return</span> True
    try:
        int<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
        <span class="token builtin class-name">return</span> True
    except ValueError:
        <span class="token builtin class-name">return</span> False

<span class="token comment"># 数值操作函数</span>
def increase<span class="token punctuation">(</span><span class="token punctuation">)</span>:
    try:
        current <span class="token operator">=</span> int<span class="token punctuation">(</span>num_entry.get<span class="token punctuation">(</span><span class="token punctuation">))</span>
    except ValueError:
        current <span class="token operator">=</span> <span class="token number">0</span>
    num_entry.delete<span class="token punctuation">(</span><span class="token number">0</span>, tk.END<span class="token punctuation">)</span>
    num_entry.insert<span class="token punctuation">(</span><span class="token number">0</span>, str<span class="token punctuation">(</span>current + <span class="token number">1</span><span class="token punctuation">))</span>

def decrease<span class="token punctuation">(</span><span class="token punctuation">)</span>:
    try:
        current <span class="token operator">=</span> int<span class="token punctuation">(</span>num_entry.get<span class="token punctuation">(</span><span class="token punctuation">))</span>
    except ValueError:
        current <span class="token operator">=</span> <span class="token number">0</span>
    num_entry.delete<span class="token punctuation">(</span><span class="token number">0</span>, tk.END<span class="token punctuation">)</span>
    num_entry.insert<span class="token punctuation">(</span><span class="token number">0</span>, str<span class="token punctuation">(</span>current - <span class="token number">1</span><span class="token punctuation">))</span>

<span class="token comment"># 数据发送函数</span>
def send_data<span class="token punctuation">(</span><span class="token punctuation">)</span>:
    global saytext
    text <span class="token operator">=</span> text_entry.get<span class="token punctuation">(</span><span class="token punctuation">)</span>
    number <span class="token operator">=</span> num_entry.get<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token assign-left variable">saytext</span><span class="token operator">=</span>text.replace<span class="token punctuation">(</span><span class="token string">'n'</span>,number<span class="token punctuation">)</span>
    update_status<span class="token punctuation">(</span>f<span class="token string">"{saytext}-准备播放"</span><span class="token punctuation">)</span>
    
def update_status<span class="token punctuation">(</span>new_status<span class="token punctuation">)</span>:
        <span class="token comment"># 更新状态栏的文本内容</span>
        global status_bar
        status_bar.config<span class="token punctuation">(</span>text<span class="token operator">=</span>new_status<span class="token punctuation">)</span>
        <span class="token comment"># 刷新界面以立即显示更新</span>
        status_bar.update_idletasks<span class="token punctuation">(</span><span class="token punctuation">)</span>    
    
    <span class="token comment"># messagebox.showinfo(</span>
    <span class="token comment">#     "发送结果",</span>
    <span class="token comment">#     f"文本内容：{text}\n数字数值：{number}\n说出文本：{saytext}",</span>
        
    <span class="token comment">#     parent=root</span>
    <span class="token comment"># )</span>
 
<span class="token comment"># 创建主窗口</span>
root <span class="token operator">=</span> tk.Tk<span class="token punctuation">(</span><span class="token punctuation">)</span>
root.title<span class="token punctuation">(</span><span class="token string">"控制面板"</span><span class="token punctuation">)</span>
root.geometry<span class="token punctuation">(</span><span class="token string">"250x150"</span><span class="token punctuation">)</span>

<span class="token comment"># 输入验证注册</span>
validate_cmd <span class="token operator">=</span> root.register<span class="token punctuation">(</span>validate_num_input<span class="token punctuation">)</span>

<span class="token comment"># 控件创建</span>
tk.Label<span class="token punctuation">(</span>root, <span class="token assign-left variable">text</span><span class="token operator">=</span><span class="token string">"文本输入："</span><span class="token punctuation">)</span>.grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">column</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">padx</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">pady</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">sticky</span><span class="token operator">=</span><span class="token string">"w"</span><span class="token punctuation">)</span>
text_entry <span class="token operator">=</span> tk.Entry<span class="token punctuation">(</span>root<span class="token punctuation">)</span>
text_entry.grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">column</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">padx</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">pady</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">columnspan</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
default_text <span class="token operator">=</span> <span class="token string">"请n号就诊"</span>
text_entry.insert<span class="token punctuation">(</span>tk.END, default_text<span class="token punctuation">)</span>
tk.Label<span class="token punctuation">(</span>root, <span class="token assign-left variable">text</span><span class="token operator">=</span><span class="token string">"数字输入："</span><span class="token punctuation">)</span>.grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">column</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">padx</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">pady</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">sticky</span><span class="token operator">=</span><span class="token string">"w"</span><span class="token punctuation">)</span>
num_entry <span class="token operator">=</span> tk.Entry<span class="token punctuation">(</span>
    root,
    <span class="token assign-left variable">validate</span><span class="token operator">=</span><span class="token string">"key"</span>,
    <span class="token assign-left variable">validatecommand</span><span class="token operator">=</span><span class="token punctuation">(</span>validate_cmd, <span class="token string">"%P"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
num_entry.grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">column</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">padx</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">pady</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">columnspan</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
num_entry.insert<span class="token punctuation">(</span><span class="token number">0</span>, <span class="token string">"0"</span><span class="token punctuation">)</span>  <span class="token comment"># 设置初始值</span>

<span class="token comment"># 按钮区域</span>
button_frame <span class="token operator">=</span> tk.Frame<span class="token punctuation">(</span>root<span class="token punctuation">)</span>
button_frame.grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">column</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">columnspan</span><span class="token operator">=</span><span class="token number">3</span>, <span class="token assign-left variable">pady</span><span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
tk.Button<span class="token punctuation">(</span>button_frame, <span class="token assign-left variable">text</span><span class="token operator">=</span><span class="token string">"-"</span>, <span class="token assign-left variable">command</span><span class="token operator">=</span>decrease<span class="token punctuation">)</span>.pack<span class="token punctuation">(</span>side<span class="token operator">=</span><span class="token string">"left"</span>, <span class="token assign-left variable">padx</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
tk.Button<span class="token punctuation">(</span>button_frame, <span class="token assign-left variable">text</span><span class="token operator">=</span><span class="token string">"+"</span>, <span class="token assign-left variable">command</span><span class="token operator">=</span>increase<span class="token punctuation">)</span>.pack<span class="token punctuation">(</span>side<span class="token operator">=</span><span class="token string">"left"</span>, <span class="token assign-left variable">padx</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token assign-left variable">button</span><span class="token operator">=</span>tk.Button<span class="token punctuation">(</span>button_frame, <span class="token assign-left variable">text</span><span class="token operator">=</span><span class="token string">"发送"</span>, <span class="token assign-left variable">command</span><span class="token operator">=</span>send_data,bg<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">)</span>
button.pack<span class="token punctuation">(</span>side<span class="token operator">=</span><span class="token string">"left"</span>, <span class="token assign-left variable">padx</span><span class="token operator">=</span><span class="token number">1</span>,pady<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
 
status_bar <span class="token operator">=</span> tk.Label<span class="token punctuation">(</span>root, <span class="token assign-left variable">text</span><span class="token operator">=</span><span class="token string">"初始状态"</span><span class="token punctuation">)</span>
status_bar.grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">3</span>, <span class="token assign-left variable">column</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">padx</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">pady</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">sticky</span><span class="token operator">=</span><span class="token string">"w"</span><span class="token punctuation">)</span>
<span class="token comment"># 模拟一个异步函数</span>
<span class="token assign-left variable">saytext</span><span class="token operator">=</span>None
async def async_task<span class="token punctuation">(</span><span class="token punctuation">)</span>:
    global saytext
    <span class="token keyword">while</span> True:
    <span class="token comment">#    print("异步任务正在运行...")</span>
        await asyncio.sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> saytext:
            say<span class="token punctuation">(</span>saytext<span class="token punctuation">)</span>
            <span class="token assign-left variable">saytext</span><span class="token operator">=</span>None

<span class="token comment"># 将异步任务与 Tkinter 集成</span>
def run_async_task<span class="token punctuation">(</span>root<span class="token punctuation">)</span>:
    loop <span class="token operator">=</span> asyncio.get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    task <span class="token operator">=</span> loop.create_task<span class="token punctuation">(</span>async_task<span class="token punctuation">(</span><span class="token punctuation">))</span>

    def update<span class="token punctuation">(</span><span class="token punctuation">)</span>:
        loop.stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        loop.run_forever<span class="token punctuation">(</span><span class="token punctuation">)</span>
        root.after<span class="token punctuation">(</span><span class="token number">100</span>, update<span class="token punctuation">)</span>

    root.after<span class="token punctuation">(</span><span class="token number">100</span>, update<span class="token punctuation">)</span>

run_async_task<span class="token punctuation">(</span>root<span class="token punctuation">)</span>
root.wm_attributes<span class="token punctuation">(</span><span class="token string">"-topmost"</span>, <span class="token number">1</span><span class="token punctuation">)</span>
root.mainloop<span class="token punctuation">(</span><span class="token punctuation">)</span>


</code></pre>
    <p>
     <a href="https://player.bilibili.com/player.html?aid=114120821052827" rel="nofollow">
      bilibile com title-投屏器的发送端
     </a>
     视频来源
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f776a63726f6f6d2f:61727469636c652f64657461696c732f313436313033303230" class_="artid" style="display:none">
 </p>
</div>


