---
layout: post
title: "Docker认识且会基础操作"
date: 2025-03-07 21:00:42 +0800
description: "所有结论都需要反复测试！如果有错误欢迎指正！一起努力！如果喜欢的话，请点个赞吧就算鼓励我一下。"
keywords: "Docker（认识且会基础操作）"
categories: ['工作记录']
tags: ['运维', '容器', 'Docker']
artid: "145963689"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=145963689
    alt: "Docker认识且会基础操作"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=145963689
featuredImagePreview: https://bing.ee123.net/img/rand?artid=145963689
cover: https://bing.ee123.net/img/rand?artid=145963689
image: https://bing.ee123.net/img/rand?artid=145963689
img: https://bing.ee123.net/img/rand?artid=145963689
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Docker（认识且会基础操作）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-kimbie-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     前言
    </h2>
    <p>
     当然，
     <code>
      Docker
     </code>
     在
     <strong>
      运维
     </strong>
     的工作中也是不可或缺的！
     <br/>
     之前其实已经写了一篇
     <code>
      Docker
     </code>
     了，但是已经全忘了。害！
     <br/>
     该篇的目的是为了了解
     <code>
      Docker
     </code>
     基本操作，并且会用
     <code>
      Docker
     </code>
     。
    </p>
    <h2>
     <a id="_4">
     </a>
     参考文献
    </h2>
    <p>
     <a href="https://juejin.cn/book/6844733746462064654?scrollMenuIndex=1" rel="nofollow">
      开发者必备的 Docker 实践指南
     </a>
    </p>
    <p>
     <a href="https://www.bilibili.com/video/BV1og4y1q7M4/?spm_id_from=333.337.search-card.all.click&amp;vd_source=f367d9f0013f5dbf0a03f69af7f52825" rel="nofollow">
      【狂神说Java】Docker最新超详细版教程通俗易懂
     </a>
    </p>
    <h2>
     <a id="Docker_9">
     </a>
     <code>
      Docker
     </code>
     架构
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/65341001414047c5ad42dd0e61602b10.png"/>
    </p>
    <ul>
     <li>
      <code>
       Docker daemon
      </code>
      理解成
      <code>
       Docker
      </code>
      <strong>
       服务
      </strong>
      。
     </li>
    </ul>
    <p>
     <code>
      Docker
     </code>
     是一个
     <code>
      Client - Server
     </code>
     的结构系统，
     <code>
      Docker
     </code>
     的守护进程（
     <code>
      Docker daemon
     </code>
     ）运行在主机上，通过
     <code>
      Socket
     </code>
     从客户端访问。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e740283e8de742898602183d4d481058.png"/>
    </p>
    <ul>
     <li>
      <code>
       -H fd://
      </code>
      ：
      <code>
       Docker
      </code>
      默认通过
      <code>
       Unix
      </code>
      套接字（
      <code>
       /var/run/docker.sock
      </code>
      ）通信。
     </li>
     <li>
      <code>
       --containerd=/run/containerd/containerd.sock
      </code>
      ：使用
      <code>
       containerd
      </code>
      作为容器运行时。
     </li>
    </ul>
    <p>
     不知道大家是否学过
     <code>
      MySQL
     </code>
     ，连接到
     <code>
      MySQL
     </code>
     怎么做？
     <br/>
     <strong>
      服务器
     </strong>
     进程和
     <strong>
      客户端
     </strong>
     进程都运行在同一台操作系统为
     <code>
      类Unix
     </code>
     的机器上的话，
     <strong>
      可以使用
      <code>
       Unix
      </code>
      域套接字文件来进行进程间通信
     </strong>
     。
    </p>
    <blockquote>
     <p>
      <strong>
       不同进程间
      </strong>
      通过
      <strong>
       套接字文件
      </strong>
      通信。
     </p>
    </blockquote>
    <ul>
     <li>
      <code>
       Docker Client
      </code>
      <strong>
       客户端
      </strong>
      ，怎么理解呢？小黑框输入命令等待服务端响应。
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/fe82320166964229a207fe376e96150c.png"/>
    </p>
    <ul>
     <li>
      <code>
       Docker_HOST
      </code>
      <strong>
       服务端
      </strong>
      ，接收命令，做出反应。
     </li>
     <li>
      <strong>
       镜像
       <code>
        images
       </code>
       <strong>
        理解成
       </strong>
       类
      </strong>
      ，
      <strong>
       容器
       <code>
        Containers
       </code>
       <strong>
        就是
       </strong>
       对象
      </strong>
      。
     </li>
    </ul>
    <h2>
     <a id="Docker_36">
     </a>
     安装
     <code>
      Docker
     </code>
    </h2>
    <p>
     <code>
      CentOS8 CentOS9
     </code>
     都能用。
    </p>
    <p>
     <a href="https://www.docker.com/" rel="nofollow">
      官网地址
     </a>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/cdbfc26a51f44c62931c98258f67d5de.png">
      <br/>
      为什么是
      <code>
       Docker Engine
      </code>
      ，在
      <code>
       Docker Engine
      </code>
      包含着
      <code>
       docker daemon
      </code>
      和
      <code>
       docker CLI
      </code>
      。
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/cdd975606d0f4733b7e2d0b08136258f.png"/>
     </img>
    </p>
    <pre><code class="prism language-bash">dnf <span class="token parameter variable">-y</span> <span class="token function">install</span> dnf-plugins-core
dnf config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
dnf <span class="token function">install</span> docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
dnf makecache
</code></pre>
    <ul>
     <li>
      <code>
       docker-ce
      </code>
      docker引擎(
      <code>
       ce
      </code>
      社区版，
      <code>
       ee
      </code>
      企业版)
     </li>
     <li>
      <code>
       docker-ce-cli
      </code>
      docker引擎命令行程序
     </li>
     <li>
      <code>
       container.io
      </code>
      docker的运行环境
     </li>
     <li>
      <code>
       docker-buildx-plugin
      </code>
      构建镜像的插件工具
     </li>
     <li>
      <code>
       docker-compose
      </code>
      做批量工具一次性都安装
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token comment">#启动docker</span>
systemctl start <span class="token function">docker</span>
<span class="token comment">#判断是否安装成功，查看是否有版本。</span>
<span class="token function">docker</span> version
<span class="token function">docker</span> run hello-world
</code></pre>
    <p>
     启动不起来？
    </p>
    <pre><code class="prism language-bash"><span class="token comment">#关闭防火墙</span>
<span class="token comment">#一句话总结一下，如果关闭防火墙，就相当于对外暴露所有端口</span>
systemctl stop firewalld.service
systemctl disable firewalld.service

<span class="token comment">#配置镜像源</span>
<span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/docker
<span class="token function">sudo</span> <span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF
{	#修改镜像源
    "registry-mirrors": [
        "https://docker.1ms.run",
        "https://hub.rat.dev",
        "https://docker.1panel.live"
    ]
}
EOF</span>
<span class="token comment">#重启后台进程</span>
<span class="token function">sudo</span> systemctl daemon-reload
<span class="token comment">#重启docker</span>
<span class="token function">sudo</span> systemctl restart <span class="token function">docker</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/568312475f2740cd939e27476d20d430.png">
      <br/>
      查看安装的镜像
     </img>
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@CentOS8 /<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY    TAG       IMAGE ID       CREATED       SIZE
hello-world   latest    74cc54e27dc4   <span class="token number">5</span> weeks ago   <span class="token number">10</span>.1kB
</code></pre>
    <h2>
     <a id="Docker_96">
     </a>
     卸载
     <code>
      Docker
     </code>
    </h2>
    <pre><code class="prism language-bash"><span class="token comment">#卸载依赖</span>
<span class="token function">sudo</span> dnf remove docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras
<span class="token comment">#删除资源，资源一般都在lib目录下</span>
<span class="token function">sudo</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/docker
<span class="token function">sudo</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/containerd
</code></pre>
    <h2>
     <a id="Namespace_104">
     </a>
     <code>
      Namespace
     </code>
    </h2>
    <p>
     <strong>
      命名空间
     </strong>
     是
     <code>
      Linux
     </code>
     核心在
     <code>
      2.4
     </code>
     版本后逐渐引入的一项用于运行隔离的模块。
    </p>
    <p>
     <code>
      Linux
     </code>
     内核的
     <strong>
      命名空间
     </strong>
     ，就是能够将
     <strong>
      计算机资源
     </strong>
     进行切割划分，
     <strong>
      形成各自独立的空间
     </strong>
     。
    </p>
    <p>
     <code>
      Linux
     </code>
     的
     <code>
      PID Namespace
     </code>
     是资源隔离的核心机制之一。通过它，系统可以创建一个独立的进程运行环境，其中的进程编号（
     <code>
      PID
     </code>
     ）会从
     <code>
      1
     </code>
     开始重新计数，就像在一个全新的操作系统中运行一样。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4ff84f3379794147aa1cac8637328ad5.png">
      <br/>
      <strong>
       容器内的进程
      </strong>
      无法感知
      <strong>
       宿主机
      </strong>
      或
      <strong>
       其他容器
      </strong>
      的进程（例如容器内的
      <code>
       PID 44
      </code>
      进程，在宿主机中可能显示为
      <code>
       PID 1543
      </code>
      ）。
     </img>
    </p>
    <h2>
     <a id="Control_Groups_114">
     </a>
     <code>
      Control Groups
     </code>
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/15d5dbf850664fff81800a1f477d3cdc.png">
      <br/>
      <strong>
       资源控制组
      </strong>
      的作用就是
      <strong>
       控制计算机资源
      </strong>
      的。通过
      <code>
       CGroups
      </code>
      ，可以指定任意一个隔离环境对任意资源的占用值或占用率，这对于很多分布式使用场景来说是非常有用的功能。
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/3792f8f44e9a41808d86403f056871a6.png"/>
     </img>
    </p>
    <h2>
     <a id="RunDocker_119">
     </a>
     <code>
      Run
     </code>
     的流程和
     <code>
      Docker
     </code>
     原理
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e6d50a00779a42a79695d694d1764622.png"/>
    </p>
    <h2>
     <a id="_121">
     </a>
     镜像
    </h2>
    <pre><code class="prism language-bash"><span class="token comment">#显示docker的版本</span>
<span class="token function">docker</span> version 
<span class="token comment">#显示docker的系统信息</span>
<span class="token function">docker</span> info
<span class="token comment">#万能命令</span>
<span class="token function">docker</span> 命令 <span class="token parameter variable">--help</span>


<span class="token punctuation">[</span>root@CentOS8 ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY    TAG       IMAGE ID       CREATED       SIZE
hello-world   latest    74cc54e27dc4   <span class="token number">5</span> weeks ago   <span class="token number">10</span>.1kB
</code></pre>
    <ul>
     <li>
      <code>
       REPOSITORY
      </code>
      ：镜像的仓库源。
     </li>
     <li>
      <code>
       TAG
      </code>
      ：镜像的标签（说白了就是版本）。
     </li>
     <li>
      <code>
       IMAGE ID
      </code>
      ：镜像的
      <code>
       ID
      </code>
     </li>
     <li>
      <code>
       CREATED
      </code>
      ：镜像的创建时间
     </li>
     <li>
      <code>
       SIZE
      </code>
      ：镜像的大小
     </li>
    </ul>
    <pre><code class="prism language-bash">-a, <span class="token parameter variable">--all</span>    <span class="token comment">#列出所有镜像</span>
-q, <span class="token parameter variable">--quiet</span> <span class="token comment">#只显示镜像的ID</span>

<span class="token comment">#列出所有的docker镜像ID</span>
<span class="token punctuation">[</span>root@CentOS8 ~<span class="token punctuation">]</span><span class="token comment"># docker images -aq</span>
74cc54e27dc4
</code></pre>
    <p>
     拉取镜像，也就是下载镜像。
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@CentOS8 ~<span class="token punctuation">]</span><span class="token comment"># docker pull mysql</span>
Using default tag: latest <span class="token comment">#latest 代表着最新版</span>
latest: Pulling from library/mysql
43759093d4f6: Pull complete <span class="token comment"># 分层下载，docker images的核心 联合文件系统</span>
d255dceb9ed5: Pull complete
23d22e42ea50: Pull complete
431b106548a3: Pull complete
2be0d473cadf: Pull complete
f56a22f949f9: Pull complete
277ab5f6ddde: Pull complete
df1ba1ac457a: Pull complete
cc9646b08259: Pull complete
893b018337e2: Pull complete
Digest: sha256:146682692a3aa409eae7b7dc6a30f637c6cb49b6ca901c2cd160becc81127d3b <span class="token comment">#签名</span>
Status: Downloaded newer image <span class="token keyword">for</span> mysql:latest
docker.io/library/mysql:latest <span class="token comment">#真实地址</span>

<span class="token function">docker</span> pull mysql <span class="token operator">==</span> <span class="token function">docker</span> pull docker.io/library/mysql:latest

<span class="token comment">#指定版本下载</span>
<span class="token punctuation">[</span>root@CentOS8 ~<span class="token punctuation">]</span><span class="token comment"># docker pull mysql:5.7</span>
<span class="token number">5.7</span>: Pulling from library/mysql
20e4dcae4c69: Pull complete
1c56c3d4ce74: Pull complete
e9f03a1c24ce: Pull complete
68c3898c2015: Pull complete
6b95a940e7b6: Pull complete
90986bb8de6e: Pull complete
ae71319cb779: Pull complete
ffc89e9dfd88: Pull complete
43d05e938198: Pull complete
064b2d298fba: Pull complete
df9a4d85569b: Pull complete
Digest: sha256:4bc6bc963e6d8443453676cae56536f4b8156d78bae03c0145cbe47c2aad73bb
Status: Downloaded newer image <span class="token keyword">for</span> mysql:5.7
docker.io/library/mysql:5.7
</code></pre>
    <p>
     删除镜像
    </p>
    <pre><code class="prism language-bash"><span class="token comment">#删除单个镜像</span>
<span class="token function">docker</span> rmi mysql:5.7
<span class="token comment">#删除多个镜像</span>
<span class="token function">docker</span> rmi 镜像名 镜像名 镜像名
<span class="token comment">#删除所有docker镜像</span>
<span class="token function">docker</span> rmi <span class="token parameter variable">-f</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> images <span class="token parameter variable">-aq</span><span class="token variable">)</span></span>
</code></pre>
    <h2>
     <a id="_200">
     </a>
     容器
    </h2>
    <pre><code class="prism language-bash"><span class="token function">docker</span> pull centos
</code></pre>
    <p>
     新建容器并启动
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token punctuation">[</span>可选参数<span class="token punctuation">]</span> image

<span class="token comment">#参数说明</span>
<span class="token parameter variable">--name</span><span class="token operator">=</span><span class="token string">"Name"</span> 容器名字 tomcat01 tomcat02，用来区分容器。
<span class="token parameter variable">-d</span>            后台方式运行
<span class="token parameter variable">-it</span>           使用交互方式运行，进入容器查看内容
<span class="token parameter variable">-p</span>            指定容器的端口 <span class="token parameter variable">--p</span> <span class="token number">8080</span>:8080
<span class="token parameter variable">-P</span>            随机指定端口
</code></pre>
    <p>
     启动并进入容器
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-it</span> centos /bin/bash

<span class="token comment">#容器内和容器外是不是很相似</span>
<span class="token comment">#容器内就是centos环境，基础版本，很多命令都是不完善的。</span>
<span class="token punctuation">[</span>root@886344be63b1 /<span class="token punctuation">]</span><span class="token comment"># ls</span>
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
</code></pre>
    <p>
     列出所有运行的容器
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token function">ps</span> 
<span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-aq</span>
</code></pre>
    <p>
     退出容器
    </p>
    <pre><code class="prism language-bash"><span class="token builtin class-name">exit</span> 	     <span class="token comment">#直接容器停止并退出</span>
ctrl + P + Q <span class="token comment">#容器不停止退出</span>
</code></pre>
    <p>
     删除容器
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token function">rm</span> 容器ID               <span class="token comment"># 删除指定容器，不能删除正在运行的容器，如果要强制删除rm -f</span>
<span class="token function">docker</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-aq</span><span class="token variable">)</span></span> <span class="token comment"># 删除所有容器</span>
</code></pre>
    <p>
     后台启动容器
    </p>
    <pre><code class="prism language-bash"><span class="token comment">#命令 docker run -d 镜像名</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> centos
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ff33bf66387047898c69449cd53355dc.png"/>
     <br/>
     <code>
      docker ps
     </code>
     ，发现
     <code>
      centos
     </code>
     停止了。
     <br/>
     <code>
      docker
     </code>
     容器使用后台运行，就必须要有一个前台进程，
     <code>
      docker
     </code>
     发现没有应用，就会自动停止。
    </p>
    <pre><code class="prism language-bash"><span class="token comment">#前台运行状态</span>
<span class="token function">ping</span> baidu.com
<span class="token comment">#后台运行</span>
<span class="token function">nohup</span> <span class="token function">ping</span> baidu.com <span class="token operator">&amp;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/528f1443da70411f83026ce992f26a47.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/104474b9665e4c0e989b6b8bffbb2a54.png"/>
     <br/>
     此时停止前台运行容器，发现容器就停止了！
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/97c32afe5303472eaf0e7ab7cefa0144.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ce4243a4893643399ca7e521b8cd6138.png"/>
    </p>
    <p>
     <code>
      docker
     </code>
     容器使用后台运行，就必须要有一个前台进程，
     <code>
      docker
     </code>
     发现没有应用，就会自动停止。
     <br/>
     再看这句话，此时我没有任何一个窗口被前台进程所占用是否是理解错问题呢？
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/76f21395d013414397be3d56dd22d92f.png"/>
     <br/>
     <code>
      Nginx
     </code>
     在容器中通常以“
     <code>
      daemon off
     </code>
     ”方式运行，强制它保持在前台，这样
     <strong>
      主进程
     </strong>
     不会退出，
     <strong>
      容器
     </strong>
     持续运行。
    </p>
    <pre><code class="prism language-bash"><span class="token comment">#主进程：</span>
root        <span class="token number">1288</span>       <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">22</span>:28 ?        00:00:00 /usr/bin/dockerd <span class="token parameter variable">-H</span> fd:// <span class="token parameter variable">--containerd</span><span class="token operator">=</span>/run/containerd/containerd.sock
</code></pre>
    <p>
     进入当前
     <font color="red">
      <strong>
       正在运行
      </strong>
     </font>
     的容器
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> 容器id /bin/bash
</code></pre>
    <p>
     那么
     <code>
      centos
     </code>
     容器我们退出了它就关闭了，如果再次进入呢？
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@CentOS8 ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID   IMAGE                 COMMAND                  CREATED          STATUS                        PORTS                                                                                  NAMES
1df6775e71d5   centos                <span class="token string">"/bin/bash"</span>              <span class="token number">14</span> minutes ago   Exited <span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span> <span class="token number">2</span> seconds ago                                                                                           hardcore_nash
<span class="token punctuation">[</span>root@CentOS8 ~<span class="token punctuation">]</span><span class="token comment"># docker start 1df6775e71d5</span>
1df6775e71d5
<span class="token comment">#两种方式：</span>
<span class="token function">docker</span> attach 1df6775e71d5
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> 1df6775e71d5 /bin/bash
</code></pre>
    <p>
     从容器拷贝文件到主机上
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token function">cp</span> 容器id:容器内路径 目的主机路径

<span class="token function">docker</span> run <span class="token parameter variable">-it</span> centos /bin/bash
<span class="token punctuation">[</span>root@e2f90d4ed867 /<span class="token punctuation">]</span><span class="token comment"># cd /home/</span>
<span class="token punctuation">[</span>root@e2f90d4ed867 home<span class="token punctuation">]</span><span class="token comment"># touch test.txt</span>
<span class="token punctuation">[</span>root@e2f90d4ed867 home<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token punctuation">[</span>root@CentOS8 ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID   IMAGE          COMMAND       CREATED              STATUS                      PORTS     NAMES
e2f90d4ed867   centos         <span class="token string">"/bin/bash"</span>   About a minute ago   Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">20</span> seconds ago             bold_cerf

<span class="token function">docker</span> <span class="token function">cp</span> e2f90d4ed867:/home/test.txt /home
<span class="token builtin class-name">cd</span> /home 
<span class="token function">ls</span>
test.txt
</code></pre>
    <h2>
     <a id="_313">
     </a>
     日志，元数据，进程
    </h2>
    <p>
     <strong>
      查看日志
     </strong>
     (
     <font color="red">
      <strong>
       重点
      </strong>
     </font>
     )
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> logs <span class="token parameter variable">-f</span> 容器名
</code></pre>
    <p>
     查看容器中进程信息
     <code>
      ps
     </code>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 命令 dockers top 容器id</span>
<span class="token function">docker</span> <span class="token function">top</span> 容器id
</code></pre>
    <p>
     <strong>
      元数据
     </strong>
     (
     <font color="red">
      <strong>
       重点
      </strong>
     </font>
     )
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> inspect 容器名
</code></pre>
    <h2>
     <a id="Nginx_330">
     </a>
     部署
     <code>
      Nginx
     </code>
    </h2>
    <pre><code class="prism language-bash"><span class="token function">docker</span> pull nginx
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> nginx01 <span class="token parameter variable">-p</span> <span class="token number">3344</span>:80 nginx
</code></pre>
    <ul>
     <li>
      <code>
       -p
      </code>
      通过主机上的端口
      <code>
       3344
      </code>
      可以访问容器内
      <code>
       80
      </code>
      。
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f2948d3e68954614ab51de05dffe8de3.png"/>
     <br/>
     <strong>
      端口暴露
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a702d67b29f443ce8ac63b8bfcd67f45.png"/>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7d7a3a3a59df431095db55bb79ed1a13.png"/>
    </p>
    <h2>
     <a id="Tomcat_344">
     </a>
     部署
     <code>
      Tomcat
     </code>
    </h2>
    <pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--rm</span> tomcat:9.0
退出，会发现容器没了。
ctrl + C
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2430effcd8be41ceb51ccdebe72943f6.png"/>
    </p>
    <pre><code class="prism language-bash"><span class="token comment">#会发现没有tomcat容器了</span>
<span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span>
</code></pre>
    <pre><code class="prism language-bash"><span class="token function">docker</span> images

<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">3355</span>:8080 <span class="token parameter variable">--name</span> tomcat01 tomcat
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9c99479a8f104aa087c04911e3360992.png"/>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 发现问题：</span>
<span class="token comment"># Linux命令少了</span>
<span class="token comment"># 没有webapps，阿里云镜像的原因，默认最小的镜像，所有不必要的都剔除掉。</span>
<span class="token comment"># 保证最小可运行的环境</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> tomcat01 /bin/bash
<span class="token function">ls</span>
webapps
<span class="token builtin class-name">cd</span> webapps
<span class="token function">ls</span>

<span class="token builtin class-name">pwd</span>
/usr/local/tomcat

<span class="token function">cp</span> <span class="token parameter variable">-rf</span> webapps.dist/* webapps
再查看网站信息
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d8e0bf372aff48fc90fe1d8a37addef6.png"/>
    </p>
    <h2>
     <a id="ES__Kibana_383">
     </a>
     部署
     <code>
      ES + Kibana
     </code>
    </h2>
    <p>
     <code>
      es
     </code>
     是
     <code>
      elasticsearch6
     </code>
     搜索引擎，
     <code>
      kibana
     </code>
     是它的可视化操作界面
    </p>
    <pre><code class="prism language-bash"><span class="token comment">#es 暴露端口多，耗内存。</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> elasticsearch <span class="token parameter variable">-p</span> <span class="token number">9200</span>:9200 <span class="token parameter variable">-p</span> <span class="token number">9300</span>:9300 <span class="token parameter variable">-e</span> <span class="token string">"discovery.type=single-node"</span> elasticsearch:8.0.0

<span class="token comment">#查看CPU的状态</span>
<span class="token function">docker</span> stats 容器名
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1d7546e97156496aac75c7961d19fc64.png"/>
    </p>
    <pre><code class="prism language-bash">可以连接上

<span class="token punctuation">[</span>root@CentOS8 home<span class="token punctuation">]</span><span class="token comment"># curl -v localhost:9300</span>
* Rebuilt URL to: localhost:9300/
*   Trying ::1<span class="token punctuation">..</span>.
* TCP_NODELAY <span class="token builtin class-name">set</span>
* Connected to localhost <span class="token punctuation">(</span>::1<span class="token punctuation">)</span> port <span class="token number">9300</span> <span class="token punctuation">(</span><span class="token comment">#0)</span>
<span class="token operator">&gt;</span> GET / HTTP/1.1
<span class="token operator">&gt;</span> Host: localhost:9300
<span class="token operator">&gt;</span> User-Agent: curl/7.61.1
<span class="token operator">&gt;</span> Accept: */*
<span class="token operator">&gt;</span>
* Empty reply from server
* Connection <span class="token comment">#0 to host localhost left intact</span>
curl: <span class="token punctuation">(</span><span class="token number">52</span><span class="token punctuation">)</span> Empty reply from server
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2f2ded122de34377bd0985c577fc40ab.png"/>
    </p>
    <pre><code class="prism language-bash"><span class="token comment">#这个是JVM的知识</span>
<span class="token parameter variable">-ES_JAVA_OPT</span><span class="token operator">=</span><span class="token string">"-Xms64m -Xmx512m"</span>
<span class="token comment"># 运行容器（包含数据持久化和安全配置）</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--name</span> elasticsearch <span class="token punctuation">\</span>
  <span class="token parameter variable">-p</span> <span class="token number">9200</span>:9200 <span class="token punctuation">\</span>
  <span class="token parameter variable">-p</span> <span class="token number">9300</span>:9300 <span class="token punctuation">\</span>
  <span class="token parameter variable">-e</span> <span class="token string">"discovery.type=single-node"</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">-e</span> <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">"-Xms64m -Xmx512m"</span> <span class="token punctuation">\</span>
  elasticsearch:8.0.0
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9bd50822515c45cd933e2e810b69f469.png"/>
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@CentOS8 ~<span class="token punctuation">]</span><span class="token comment"># curl -v localhost:9300</span>
* Rebuilt URL to: localhost:9300/
*   Trying ::1<span class="token punctuation">..</span>.
* TCP_NODELAY <span class="token builtin class-name">set</span>
* Connected to localhost <span class="token punctuation">(</span>::1<span class="token punctuation">)</span> port <span class="token number">9300</span> <span class="token punctuation">(</span><span class="token comment">#0)</span>
<span class="token operator">&gt;</span> GET / HTTP/1.1
<span class="token operator">&gt;</span> Host: localhost:9300
<span class="token operator">&gt;</span> User-Agent: curl/7.61.1
<span class="token operator">&gt;</span> Accept: */*
<span class="token operator">&gt;</span>
* Empty reply from server
* Connection <span class="token comment">#0 to host localhost left intact</span>
curl: <span class="token punctuation">(</span><span class="token number">52</span><span class="token punctuation">)</span> Empty reply from server
</code></pre>
    <h2>
     <a id="_443">
     </a>
     联合文件系统
    </h2>
    <p>
     镜像到底是什么？
     <br/>
     镜像是一种轻量级，可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时、库、环境变量和配置文件。
     <br/>
     所有的应用，直接打包
     <code>
      docker
     </code>
     镜像，就可以直接跑起来。
     <br/>
     如何得到镜像：
    </p>
    <ul>
     <li>
      从远程仓库下载
     </li>
     <li>
      朋友拷贝给你
     </li>
     <li>
      自己制作一个镜像
      <code>
       DockerFile
      </code>
     </li>
    </ul>
    <p>
     先介绍一下
     <code>
      Git
     </code>
     控制版本
    </p>
    <ul>
     <li>
      第一步(层)：安装了
      <code>
       centos
      </code>
      。
     </li>
     <li>
      第二步(层)：安装了
      <code>
       docker
      </code>
      。
     </li>
     <li>
      第三步(层)：安装了
      <code>
       jdk
      </code>
      。
     </li>
    </ul>
    <p>
     <code>
      UnionFS
     </code>
     （
     <strong>
      联合文件系统
     </strong>
     ），它支持
     <strong>
      文件系统
     </strong>
     的修改作为一次提交来一层层的叠加。
     <br/>
     我们对一个项目的修改，只需要管增加的部分，增加的部分则是一层。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8035901f260b417599c4ffe68c8426d7.png"/>
    </p>
    <p>
     <code>
      dockers
     </code>
     的镜像实际上由一层一层的文件系统组成，这种层级的文件系统
     <code>
      UnionFS
     </code>
     。
     <br/>
     <code>
      bootfs
     </code>
     ：系统启动需要引导加载，主要包含
     <code>
      bootloader
     </code>
     和
     <code>
      kernel bootloader
     </code>
     主要是引导加载
     <code>
      kernel
     </code>
     ，
     <code>
      Linux
     </code>
     刚启动会加载
     <code>
      bootfs
     </code>
     。
    </p>
    <ul>
     <li>
      <strong>
       点火装置
      </strong>
      （
      <code>
       bootloader和kernel bootloader
      </code>
      ）：负责
      <strong>
       检查设备
      </strong>
      是否正常，然后
      <strong>
       点燃引擎
      </strong>
      ；
     </li>
     <li>
      <strong>
       火箭主体
      </strong>
      （
      <code>
       kernel内核
      </code>
      ）：相当于
      <strong>
       火箭的核心部分
      </strong>
      ，启动后就能带电脑飞起来。
     </li>
    </ul>
    <p>
     黑屏 -&gt; 加载 -&gt; 开机进入系统
     <br/>
     无论是什么镜像，
     <code>
      bootfs
     </code>
     是公用的！
     <br/>
     <code>
      Docker
     </code>
     容器直接复用
     <strong>
      宿主机的内核
     </strong>
     ，所以不用
     <strong>
      内核相关
     </strong>
     的，启动快占用少。
     <br/>
     <code>
      roofs
     </code>
     在
     <code>
      bootfs
     </code>
     之上，包含典型的
     <code>
      Linux
     </code>
     系统中的
     <code>
      /dev /proc /bin /etc
     </code>
     等标准目录和文件。
     <code>
      rootfs
     </code>
     就是各种不同的操作系统发行版，比如
     <code>
      Ubuntu
     </code>
     、
     <code>
      Centos
     </code>
     等等。
    </p>
    <blockquote>
     <p>
      <code>
       Docker
      </code>
      镜像都是
      <strong>
       只读
      </strong>
      ，当容器启动时，一个新的可写层被加载到镜像的顶部。
      <br/>
      这一层就是通常说的
      <strong>
       容器层
      </strong>
      ，容器之下的都叫
      <strong>
       镜像层
      </strong>
      。
     </p>
    </blockquote>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/db34c179730f456ba6df5f7ad60083bb.png"/>
    </p>
    <p>
     <strong>
      写时复制
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/87917272e76045eab231b8e62690cb80.png"/>
     <br/>
     <strong>
      容器
     </strong>
     修改的
     <code>
      /etc/passwd
     </code>
     是修改的是
     <strong>
      容器层
     </strong>
     ,
     <strong>
      镜像层
     </strong>
     是
     <strong>
      只读
     </strong>
     的这就是
     <strong>
      写时复制
     </strong>
     特性
    </p>
    <p>
     也就是
     <strong>
      镜像层
     </strong>
     里面的东西是不会变的变得只是你添加的东西所以你需要
     <code>
      -v
     </code>
     利用卷组保留数据。
    </p>
    <p>
     <strong>
      写时复制
     </strong>
     （
     <code>
      CoW
     </code>
     ） 是一种
     <strong>
      资源管理策略
     </strong>
     ，其核心逻辑是：在
     <strong>
      数据未被修改
     </strong>
     时，允许多个引用共享同一份
     <strong>
      原始数据
     </strong>
     ；当任一引用尝试修改数据时，系统才会为该引用创建
     <strong>
      独立的数据副本
     </strong>
     。此机制通过
     <strong>
      延迟复制
     </strong>
     操作，显著优化了
     <strong>
      资源利用率
     </strong>
     和
     <strong>
      性能
     </strong>
     。
    </p>
    <h2>
     <a id="_490">
     </a>
     容器数据卷
    </h2>
    <p>
     如果数据在容器中，那么删除容器，数据会丢失！需求！数据可以持久化
     <br/>
     <code>
      MySQL
     </code>
     ，容器删除了，删库跑路！需求：MySQL数据可以存储在本地！
     <br/>
     容器之间有一个数据共享的技术，
     <code>
      Docker
     </code>
     容器中产生的数据，同步到本地！
     <br/>
     这就是
     <strong>
      卷技术
     </strong>
     ！目录的挂载，将容器内的目录，挂载到
     <code>
      Linux
     </code>
     上面！
    </p>
    <blockquote>
     <p>
      总结一句话：容器的持久化和同步操作！容器间也是可以数据共享的！
     </p>
    </blockquote>
    <pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">-v</span> 主机目录:容器内目录
<span class="token comment"># 测试</span>
<span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">-v</span> /home/test:/home centos /bin/bash
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d68a28d237284bbb831326369517557f.png"/>
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span>
<span class="token function">docker</span> inspect 1df6775e71d5
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a9c23b4111dd4293b08cdb6748700a55.png"/>
     <br/>
     其实这怎么形容呢？是否看过
     <code>
      JOJO
     </code>
     的”恋人“那一集。
     <br/>
     也就是我操作
     <code>
      /home
     </code>
     目录下的东西，
     <code>
      /home/test
     </code>
     目录也会跟着改变。
     <br/>
     比如在
     <code>
      /home
     </code>
     目录下增加一个文件，
     <code>
      /home/test
     </code>
     也会增加一个同样的文件。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/0e8b536a860248ab8c2ec3c3da6969e2.png"/>
    </p>
    <h2>
     <a id="_513">
     </a>
     具名和匿名挂载
    </h2>
    <pre><code class="prism language-bash"><span class="token comment"># 匿名挂载</span>
<span class="token parameter variable">-v</span> 容器内路径 不指定主机目录
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">--name</span> nginx01 <span class="token parameter variable">-v</span> /etc/nginx nginx

<span class="token punctuation">[</span>root@CentOS8 ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span>
DRIVER    VOLUME NAME
<span class="token builtin class-name">local</span>     0338f9c041b34701c5ea638938801bdf2fd3261f9d6e11924528f5dcdd4ddfb2 <span class="token comment">#没有取名字为匿名卷</span>

<span class="token comment">#具名挂载</span>
<span class="token comment">#通过 -v 卷名:容器内路径</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">--name</span> nginx02 <span class="token parameter variable">-v</span> juming-nginx:/etc/nginx nginx
<span class="token punctuation">[</span>root@CentOS8 ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span>
DRIVER    VOLUME NAME
<span class="token builtin class-name">local</span>     juming-nginx <span class="token comment">#这里就有名字了</span>


<span class="token punctuation">[</span>root@CentOS8 ~<span class="token punctuation">]</span><span class="token comment"># docker volume inspect juming-nginx</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"CreatedAt"</span><span class="token builtin class-name">:</span> <span class="token string">"2025-03-04T16:51:22+08:00"</span>,
        <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,
        <span class="token string">"Labels"</span><span class="token builtin class-name">:</span> null,
        <span class="token comment">#此处为主机目录的地址</span>
        <span class="token string">"Mountpoint"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/volumes/juming-nginx/_data"</span>,
        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"juming-nginx"</span>,
        <span class="token string">"Options"</span><span class="token builtin class-name">:</span> null,
        <span class="token string">"Scope"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre>
    <blockquote>
     <p>
      所有的
      <code>
       docker
      </code>
      容器内的卷，没有指定目录的情况下都是在
      <code>
       /var/lib/docker/volumes/xxx/
      </code>
      。
     </p>
    </blockquote>
    <pre><code class="prism language-bash"><span class="token comment"># 如何确定是具名挂载还是匿名挂载，还是指定路径挂载。</span>
<span class="token parameter variable">-v</span> 容器内路径             <span class="token comment"># 匿名挂载</span>
<span class="token parameter variable">-v</span> 卷名:容器内路径        <span class="token comment"># 具名挂载</span>
<span class="token parameter variable">-v</span> /宿主机路径:容器内路径  <span class="token comment"># 指定路径挂载</span>
</code></pre>
    <p>
     扩展：
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 通过 -v 容器内路径：ro rw 改变读写权限</span>
ro <span class="token builtin class-name">readonly</span>  <span class="token comment">#只读</span>
rw readwrite <span class="token comment">#可读可写</span>
<span class="token comment"># 一旦这个设置了容器权限，容器对挂载出来的内容就有限定了。相对于容器来说</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">--name</span> nginx02 <span class="token parameter variable">-v</span> juming-nginx:/etc/nginx:ro nginx
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">--name</span> nginx02 <span class="token parameter variable">-v</span> juming-nginx:/etc/nginx:rw nginx

<span class="token comment">#这个目录只能从外部改变了，不能从内部改变了。</span>
<span class="token comment"># ro 只要看到 ro 就说明这个路径只能通过宿主机操作，容器内部无法操作。</span>
ro /etc/nginx
</code></pre>
    <p>
     测试一下
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">-v</span> /home/test:/home:ro centos /bin/bash

<span class="token punctuation">[</span>root@fcd193845507 home<span class="token punctuation">]</span><span class="token comment"># touch a.txt</span>
touch: cannot <span class="token function">touch</span> <span class="token string">'a.txt'</span><span class="token builtin class-name">:</span> Read-only <span class="token function">file</span> system
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/92ea11dc62314fd8921f8fbb38224c3e.png"/>
    </p>
    <h2>
     <a id="MySQL_579">
     </a>
     <code>
      MySQL
     </code>
     部署
    </h2>
    <p>
     这位大佬写的非常详细
     <br/>
     <a href="https://blog.csdn.net/donkor_/article/details/139879575">
      Docker部署MySQL 8.3.0（保姆级图文教程）
     </a>
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> pull mysql:8.3.0

<span class="token punctuation">[</span>root@CentOS8 ~<span class="token punctuation">]</span><span class="token comment"># docker images mysql:8.3.0</span>
REPOSITORY   TAG       IMAGE ID       CREATED         SIZE
mysql        <span class="token number">8.3</span>.0     6f343283ab56   <span class="token number">11</span> months ago   632MB

<span class="token function">mkdir</span> <span class="token parameter variable">-p</span>  /home/mysql/<span class="token punctuation">{<!-- --></span>conf,data,log<span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f04fc39783d9467695ef139d907a43c2.png"/>
    </p>
    <pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /home/mysql/conf
<span class="token function">vi</span> my.cnf

<span class="token punctuation">[</span>client<span class="token punctuation">]</span>
<span class="token comment">#设置客户端默认字符集utf8mb4</span>
default-character-set<span class="token operator">=</span>utf8mb4
<span class="token punctuation">[</span>mysql<span class="token punctuation">]</span>
<span class="token comment">#设置服务器默认字符集为utf8mb4</span>
default-character-set<span class="token operator">=</span>utf8mb4
<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token assign-left variable">default_authentication_plugin</span><span class="token operator">=</span>mysql_native_password
<span class="token comment">#配置服务器的服务号，具备日后需要集群做准备</span>
server-id <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment">#开启MySQL数据库的二进制日志，用于记录用户对数据库的操作SQL语句，具备日后需要集群做准备</span>
log-bin<span class="token operator">=</span>mysql-bin
<span class="token comment">#设置清理超过30天的日志，以免日志堆积造过多成服务器内存爆满。2592000秒等于30天的秒数</span>
binlog_expire_logs_seconds <span class="token operator">=</span> <span class="token number">2592000</span>
<span class="token comment">#解决MySQL8.0版本GROUP BY问题</span>
<span class="token assign-left variable">sql_mode</span><span class="token operator">=</span><span class="token string">'STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION'</span>
<span class="token comment">#允许最大的连接数</span>
<span class="token assign-left variable">max_connections</span><span class="token operator">=</span><span class="token number">1000</span>
<span class="token comment"># 禁用符号链接以防止各种安全风险</span>
symbolic-links<span class="token operator">=</span><span class="token number">0</span>
<span class="token comment"># 设置东八区时区</span>
default-time_zone <span class="token operator">=</span> <span class="token string">'+8:00'</span>
</code></pre>
    <p>
     启动容器
    </p>
    <pre><code class="prism language-bash"><span class="token comment">#\代表换行 </span>
<span class="token comment">#--privileged=true表示赋予容器权限修改宿主文件权利</span>
<span class="token comment">#--restart=always表示容器退出时总是重启</span>
<span class="token comment">#-e 是配置环境，MYSQL_ROOT_PASSWORD=a12bCd3_W45pUq6表示设置mysql的root用户密码</span>
<span class="token comment">#-d表示后台运行</span>
<span class="token comment">#可以多个-v 挂载日志、数据、配置文件。</span>
<span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">3306</span>:3306 <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> mysql <span class="token punctuation">\</span>
<span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /home/mysql/log:/var/log/mysql <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /home/mysql/data:/var/lib/mysql <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /home/mysql/conf/my.cnf:/etc/mysql/my.cnf <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>password<span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> mysql:8.3.0  

再开一个窗口

<span class="token punctuation">[</span>root@CentOS8 conf<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE         COMMAND                  CREATED         STATUS         PORTS                                                  NAMES
d837a375948f   mysql:8.3.0   <span class="token string">"docker-entrypoint.s…"</span>   <span class="token number">4</span> seconds ago   Up <span class="token number">3</span> seconds   <span class="token number">0.0</span>.0.0:3306-<span class="token operator">&gt;</span><span class="token number">3306</span>/tcp, :::3306-<span class="token operator">&gt;</span><span class="token number">3306</span>/tcp, <span class="token number">33060</span>/tcp   mysql
<span class="token punctuation">[</span>root@CentOS8 conf<span class="token punctuation">]</span><span class="token comment"># docker exec -it d837a375948f /bin/bash</span>

mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-ppassword</span>
use mysql<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> user,host from user<span class="token punctuation">;</span>
+------------------+-----------+
<span class="token operator">|</span> user             <span class="token operator">|</span> <span class="token function">host</span>      <span class="token operator">|</span>
+------------------+-----------+
<span class="token operator">|</span> root             <span class="token operator">|</span> %         <span class="token operator">|</span>
<span class="token operator">|</span> mysql.infoschema <span class="token operator">|</span> localhost <span class="token operator">|</span>
<span class="token operator">|</span> mysql.session    <span class="token operator">|</span> localhost <span class="token operator">|</span>
<span class="token operator">|</span> mysql.sys        <span class="token operator">|</span> localhost <span class="token operator">|</span>
<span class="token operator">|</span> root             <span class="token operator">|</span> localhost <span class="token operator">|</span>
+------------------+-----------+
<span class="token number">5</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>


ALTER <span class="token environment constant">USER</span> <span class="token string">'root'</span>@<span class="token string">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">'password'</span><span class="token punctuation">;</span>
flush privileges<span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ef5415dafa98498fb3a332da9a097718.png"/>
    </p>
    <h2>
     <a id="Docker_669">
     </a>
     <code>
      Docker
     </code>
     网络
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/123c9d75e3ac4dda92811f65d6bfe5db.png"/>
    </p>
    <pre><code class="prism language-bash"><span class="token comment">#-d    后台运行</span>
<span class="token comment">#-P    端口随机</span>
<span class="token comment">#-name 指定名字</span>
<span class="token comment">#运行tomcat镜像，生成容器。</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">--name</span> tomcat01 tomcat
</code></pre>
    <p>
     进入镜像
    </p>
    <pre><code class="prism language-bash"><span class="token comment">#进入容器内部</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> tomcat01 /bin/bash

<span class="token builtin class-name">cd</span> /etc

<span class="token comment">#可见操作系统版本是Ubuntu</span>
root@d9b71213acb7:/etc<span class="token comment"># cat os-release</span>
<span class="token assign-left variable">PRETTY_NAME</span><span class="token operator">=</span><span class="token string">"Ubuntu 24.04.1 LTS"</span>
<span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">"Ubuntu"</span>
<span class="token assign-left variable">VERSION_ID</span><span class="token operator">=</span><span class="token string">"24.04"</span>
<span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token string">"24.04.1 LTS (Noble Numbat)"</span>
<span class="token assign-left variable">VERSION_CODENAME</span><span class="token operator">=</span>noble
<span class="token assign-left variable">ID</span><span class="token operator">=</span>ubuntu
<span class="token assign-left variable">ID_LIKE</span><span class="token operator">=</span>debian
<span class="token assign-left variable">HOME_URL</span><span class="token operator">=</span><span class="token string">"https://www.ubuntu.com/"</span>
<span class="token assign-left variable">SUPPORT_URL</span><span class="token operator">=</span><span class="token string">"https://help.ubuntu.com/"</span>
<span class="token assign-left variable">BUG_REPORT_URL</span><span class="token operator">=</span><span class="token string">"https://bugs.launchpad.net/ubuntu/"</span>
<span class="token assign-left variable">PRIVACY_POLICY_URL</span><span class="token operator">=</span><span class="token string">"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"</span>
<span class="token assign-left variable">UBUNTU_CODENAME</span><span class="token operator">=</span>noble
<span class="token assign-left variable">LOGO</span><span class="token operator">=</span>ubuntu-logo

<span class="token comment">#让系统去官网检查所有软件的最新版本信息。</span>
<span class="token function">apt</span> update
<span class="token comment">#安装一个叫 iproute2 的软件包，这个包里全是管理网络的神器。</span>
<span class="token function">apt</span> <span class="token function">install</span> iproute2
</code></pre>
    <pre><code class="prism language-bash"><span class="token comment">#不进入容器也能查看到容器信息</span>
<span class="token comment">#发现容器启动的时候都会得到一个eth0@if5 ip地址，Docker分配的。</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> tomcat01 <span class="token function">ip</span> a
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span>
       valid_lft forever preferred_lft forever
<span class="token number">4</span>: eth0@if5: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
    inet <span class="token number">172.17</span>.0.2/16 brd <span class="token number">172.17</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever
</code></pre>
    <p>
     <code>
      Linux
     </code>
     是否能
     <code>
      ping
     </code>
     通
     <strong>
      容器内部
     </strong>
     ？
     <br/>
     <font color="red">
      <strong>
       能
      </strong>
     </font>
     ，因为一个
     <strong>
      容器
     </strong>
     就是一个
     <strong>
      进程
     </strong>
     。
    </p>
    <pre><code class="prism language-bash"><span class="token function">ping</span> <span class="token number">172.17</span>.0.2
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/fec2969879bb4072ab13fbc0c1863d02.png"/>
     <br/>
     <code>
      Linux
     </code>
     可以
     <code>
      ping
     </code>
     通
     <code>
      docker
     </code>
     容器内部。
    </p>
    <p>
     <code>
      docker0
     </code>
     的
     <code>
      ip
     </code>
     为
     <code>
      172.17.0.1
     </code>
     ，容器内
     <code>
      eho@if5
     </code>
     的
     <code>
      ip
     </code>
     为
     <code>
      172.17.0.2
     </code>
     。
     <br/>
     在
     <strong>
      同一个网段
     </strong>
     ，是可以相互
     <code>
      ping
     </code>
     通的，
     <code>
      docker0
     </code>
     就是
     <strong>
      虚拟交换机
     </strong>
     。
     <br/>
     <font color="red">
      <strong>
       桥接模式
      </strong>
     </font>
     ，使用的技术是
     <code>
      veth-pair
     </code>
     技术。
    </p>
    <p>
     启动了一个容器过后又多了一个网卡。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/14542ca5f26d4ac0b861ece9d899f7f6.png"/>
     <br/>
     再运行一个容器
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -P --name tomcat02 tomcat</span>
d5f3197160516df059bcd2e2cb3bf079daded118b31c5c073968db05eafb5760
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/01e02adfdf274f3783571be588f2c947.png"/>
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> tomcat02 /bin/bash
<span class="token builtin class-name">cd</span> /etc
root@d9b71213acb7:/etc<span class="token comment"># cat os-release</span>
<span class="token assign-left variable">PRETTY_NAME</span><span class="token operator">=</span><span class="token string">"Ubuntu 24.04.1 LTS"</span>
<span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">"Ubuntu"</span>
<span class="token assign-left variable">VERSION_ID</span><span class="token operator">=</span><span class="token string">"24.04"</span>
<span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token string">"24.04.1 LTS (Noble Numbat)"</span>
<span class="token assign-left variable">VERSION_CODENAME</span><span class="token operator">=</span>noble
<span class="token assign-left variable">ID</span><span class="token operator">=</span>ubuntu
<span class="token assign-left variable">ID_LIKE</span><span class="token operator">=</span>debian
<span class="token assign-left variable">HOME_URL</span><span class="token operator">=</span><span class="token string">"https://www.ubuntu.com/"</span>
<span class="token assign-left variable">SUPPORT_URL</span><span class="token operator">=</span><span class="token string">"https://help.ubuntu.com/"</span>
<span class="token assign-left variable">BUG_REPORT_URL</span><span class="token operator">=</span><span class="token string">"https://bugs.launchpad.net/ubuntu/"</span>
<span class="token assign-left variable">PRIVACY_POLICY_URL</span><span class="token operator">=</span><span class="token string">"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"</span>
<span class="token assign-left variable">UBUNTU_CODENAME</span><span class="token operator">=</span>noble
<span class="token assign-left variable">LOGO</span><span class="token operator">=</span>ubuntu-logo

<span class="token function">apt</span> update
<span class="token function">apt</span> <span class="token function">install</span> iproute2
</code></pre>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat02 ip a</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span>
       valid_lft forever preferred_lft forever
<span class="token number">6</span>: eth0@if7: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default
    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
    inet <span class="token number">172.17</span>.0.3/16 brd <span class="token number">172.17</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8d01439267c1419da5de86e3b0ba7f47.png"/>
     <br/>
     <strong>
      容器
     </strong>
     带来的
     <strong>
      网卡
     </strong>
     ，都是
     <strong>
      一对对
     </strong>
     的
     <br/>
     <code>
      veth-pair
     </code>
     就是一对的
     <strong>
      虚拟设备接口
     </strong>
     ，成对出现的，一端连着
     <strong>
      协议
     </strong>
     ，一端彼此相连。
     <br/>
     <code>
      veth-pair
     </code>
     充当一个桥梁，让
     <code>
      Linux
     </code>
     可以和容器通信，连接各种虚拟网络设备。
    </p>
    <p>
     <code>
      veth-pair
     </code>
     就像是给
     <strong>
      容器
     </strong>
     和
     <strong>
      宿主机
     </strong>
     之间“牵了一根网线”。这根“
     <strong>
      网线
     </strong>
     ”有两个头，一个插在
     <strong>
      容器
     </strong>
     的“
     <strong>
      网络插座
     </strong>
     ”（
     <strong>
      协议栈
     </strong>
     ）上，另一个插在
     <strong>
      宿主机
     </strong>
     的“
     <strong>
      网络插座
     </strong>
     ”上。只要
     <strong>
      数据
     </strong>
     从
     <strong>
      容器
     </strong>
     这头塞进去，
     <strong>
      宿主机
     </strong>
     那头就能直接收到；反过来
     <strong>
      宿主机
     </strong>
     发数据，
     <strong>
      容器
     </strong>
     也能收到。
    </p>
    <p>
     那么
     <code>
      tomcat01
     </code>
     和
     <code>
      tomcat02
     </code>
     是否能
     <code>
      ping
     </code>
     通呢？
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> tomcat02 /bin/bash
<span class="token function">apt</span> update
<span class="token function">apt</span> <span class="token function">install</span> iputils-ping
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d1151326fd5e47548d80256e4c83e494.png"/>
    </p>
    <blockquote>
     <p>
      容器和容器之间是可以互相
      <code>
       ping
      </code>
      通的。
     </p>
    </blockquote>
    <h2>
     <a id="Docker_797">
     </a>
     <code>
      Docker
     </code>
     网络模型图
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7ccd6c05fc874427aa2a49a992e59a12.png"/>
    </p>
    <p>
     所有的容器不指定网络的情况下，都是
     <code>
      docker0
     </code>
     路由的，
     <code>
      docker
     </code>
     会给容器分配一个默认可用
     <code>
      IP
     </code>
    </p>
    <p>
     <code>
      Docker
     </code>
     中的所有的网络接口都是虚拟的，虚拟的转发效率高！
    </p>
    <p>
     删除容器以后，网络就没了！
    </p>
    <h2>
     <a id="_806">
     </a>
     小结一下
    </h2>
    <p>
     <code>
      veth-pair
     </code>
     技术：
     <br/>
     每个
     <code>
      Docker
     </code>
     容器启动时，会创建一对虚拟网卡（
     <code>
      veth-pair
     </code>
     ），其中一端在容器内命名为
     <code>
      eth0
     </code>
     ，另一端连接到宿主机的
     <code>
      docker0
     </code>
     网桥（名称类似
     <code>
      veth*
     </code>
     ）。这对设备通过
     <code>
      Linux
     </code>
     内核协议栈直接联通，实现容器与宿主机之间的数据传输
    </p>
    <p>
     <code>
      docker0
     </code>
     网桥的作用：
     <br/>
     <code>
      docker0
     </code>
     是
     <code>
      Docker
     </code>
     默认创建的虚拟网桥，工作在二层（类似物理交换机），负责为容器分配IP（如
     <code>
      172.17.0.0/16
     </code>
     子网）并管理容器间的通信。
     <br/>
     容器间通信时，数据通过
     <code>
      docker0
     </code>
     直接转发，无需经过宿主机物理网卡。
    </p>
    <p>
     <strong>
      容器到宿主机的路径
     </strong>
     ：
     <br/>
     容器内部流量通过
     <code>
      eth0
     </code>
     →
     <code>
      veth-pair
     </code>
     →
     <code>
      docker0
     </code>
     网桥，再由宿主机内核的路由和
     <code>
      NAT
     </code>
     规则处理：
    </p>
    <p>
     <code>
      NAT
     </code>
     转换：
     <br/>
     当容器访问外网时，宿主机通过
     <code>
      iptables
     </code>
     的
     <code>
      MASQUERADE
     </code>
     规则将容器IP（如
     <code>
      172.17.0.2
     </code>
     ）转换为宿主机的物理网卡
     <code>
      IP
     </code>
     （如
     <code>
      192.168.1.100
     </code>
     ）。
     <br/>
     <strong>
      物理网卡转发
     </strong>
     ：
     <br/>
     转换后的流量通过宿主机的物理网卡（如
     <code>
      eth0
     </code>
     或
     <code>
      ens33
     </code>
     ）发送至
     <strong>
      外部网络
     </strong>
     。
     <br/>
     <strong>
      外网到容器的路径
     </strong>
     ：
     <br/>
     若需从外网访问容器（如通过端口映射），
     <code>
      Docker
     </code>
     会通过
     <code>
      iptables
     </code>
     的
     <code>
      DNAT
     </code>
     规则将宿主机物理网卡上的指定端口流量转发到容器IP和端口
    </p>
    <h2>
     <a id="_825">
     </a>
     自定义网络
    </h2>
    <pre><code class="prism language-bash"><span class="token function">docker</span> network <span class="token parameter variable">--help</span>

<span class="token comment">#查看所有的docker网络</span>
<span class="token function">docker</span> network <span class="token function">ls</span>
</code></pre>
    <p>
     网络模式
     <br/>
     <code>
      bridge
     </code>
     ：桥接（默认）
     <br/>
     <code>
      none
     </code>
     ：不配置网络
     <br/>
     <code>
      host
     </code>
     ：主机模式（和宿主机共享网络）
     <br/>
     <code>
      container
     </code>
     ：容器内网络连通！
    </p>
    <p>
     测试
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ac4f177a14f44465bf681a7c5a8d4297.png"/>
     <br/>
     <code>
      /16
     </code>
     子网：
     <br/>
     网络前缀占
     <code>
      16
     </code>
     位，主机部分占
     <code>
      16
     </code>
     位，可容纳
     <code>
      65,534
     </code>
     台设备，适合大型网络（如企业内网）。
     <br/>
     <code>
      /24
     </code>
     子网：
     <br/>
     网络前缀占
     <code>
      24
     </code>
     位，主机部分占
     <code>
      8
     </code>
     位，仅支持
     <code>
      254
     </code>
     台设备，适合小型网络（如家庭、小型办公室）。
    </p>
    <pre><code class="prism language-bash"><span class="token comment">#清空容器</span>
<span class="token function">docker</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-aq</span><span class="token variable">)</span></span>
<span class="token comment">#默认--net bridge 这就是docker01</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">--name</span> tomcat01 <span class="token parameter variable">--net</span> bridge tomcat

<span class="token comment">#docker0特点，默认，域名不能访问。</span>

<span class="token comment">#创建自定义网络</span>
<span class="token comment">#subnet 是子网 gateway 网关</span>
<span class="token function">docker</span> network create <span class="token parameter variable">--driver</span> bridge <span class="token parameter variable">--subnet</span> <span class="token number">10.1</span>.0.0/16 <span class="token parameter variable">--gateway</span> <span class="token number">10.1</span>.0.1 mynet
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/403083d9fe7340bfaf249fa09d2aeb82.png"/>
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> network inspect mynet
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/afccda1c045a4573a543f8f61b086c9d.png"/>
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">--name</span> tomcat-net-01 <span class="token parameter variable">--net</span> mynet tomcat
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">--name</span> tomcat-net-02 <span class="token parameter variable">--net</span> mynet tomcat
<span class="token function">docker</span> network inspect mynet
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/66f044f812b846e88c3586f80d7f8518.png"/>
    </p>
    <p>
     自定义网络的好处：
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> tomcat-net-01 /bin/bash
<span class="token function">apt</span> update
<span class="token function">apt</span> <span class="token function">install</span> iputils-ping
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> tomcat-net-02 /bin/bash
<span class="token function">apt</span> update
<span class="token function">apt</span> <span class="token function">install</span> iputils-ping

<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> tomcat-net-01 <span class="token function">ping</span> <span class="token number">10.1</span>.0.3
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> tomcat-net-01 <span class="token function">ping</span> tomcat-net-02
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a2ceb5ca7651436ea987e708e21ce413.png"/>
     <br/>
     自定义网络docker都已经维护好了对应的关系。
     <br/>
     单独启动的两个容器不在同一个网络命名空间，
     <code>
      DNS
     </code>
     无法解析名称，启动时将他们加到同一个网络通过
     <code>
      DNS
     </code>
     解析容器名就可以直接通信。
    </p>
    <h2>
     <a id="_888">
     </a>
     网络连通
    </h2>
    <pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">--name</span> tomcat-01 tomcat
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">--name</span> tomcat-02 tomcat
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/3190fe0165ef47d48f0465997fa881e4.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/b27d1fe418c540b79b03d784b45fb74b.png"/>
     <br/>
     红色的是不可能直接能通信的
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/eeb04a2d80d946848bddfca5eb3d2adb.png"/>
     <br/>
     那么我们的目的就是为了将容器连接到网络上
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> tomcat-01 /bin/bash
<span class="token function">apt</span> update
<span class="token function">apt</span> <span class="token function">install</span> iputils-ping

<span class="token comment">#容器连接网络</span>
<span class="token function">docker</span> network connect mynet tomcat-01
<span class="token function">docker</span> network inspect mynet
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c5eced02d5f3468f8fb105883fc97798.png"/>
    </p>
    <blockquote>
     <p>
      一个容器两个
      <code>
       IP
      </code>
      地址，直接解决这个问题，比如阿里云服务器一个公网一个内网，都可以连接到服务器。
     </p>
    </blockquote>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/974fcc76cad7443294d43d517c2256b7.png"/>
    </p>
    <p>
     假设跨网络操作，就需要
     <code>
      docker network connect
     </code>
     连通！
    </p>
    <h2>
     <a id="Redis_917">
     </a>
     <code>
      Redis
     </code>
     集群部署
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/09ebc7d05905436b8cf26d41e71b7fe5.png"/>
     <br/>
     创建网络
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> network create redis <span class="token parameter variable">--subnet</span> <span class="token number">172.38</span>.0.0/16
<span class="token function">docker</span> network <span class="token function">ls</span>
NETWORK ID     NAME      DRIVER    SCOPE
a96bd4671a05   redis     bridge    <span class="token builtin class-name">local</span>

<span class="token function">docker</span> network inspect redis


<span class="token comment">#循环创建六个节点</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">port</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">seq</span> <span class="token number">1</span> <span class="token number">6</span><span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token punctuation">\</span>
<span class="token keyword">do</span> <span class="token punctuation">\</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ./mydata/redis/node-<span class="token variable">${port}</span>/conf
<span class="token function">touch</span> ./mydata/redis/node-<span class="token variable">${port}</span>/conf/redis.conf
<span class="token comment">#配置Redis配置文件</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span>./mydata/redis/node-<span class="token variable">${port}</span>/conf/redis.conf</span>
port 6379
bind 0.0.0.0
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
cluster-announce-ip 172.38.0.1<span class="token variable">${port}</span>
cluster-announce-port 6379
cluster-announce-bus-port 16379
appendonly yes
EOF</span>
<span class="token keyword">done</span>


<span class="token punctuation">[</span>root@CentOS8 ~<span class="token punctuation">]</span><span class="token comment"># cd ./mydata/redis/</span>
<span class="token punctuation">[</span>root@CentOS8 redis<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">0</span>
drwxr-xr-x. <span class="token number">3</span> root root <span class="token number">18</span> Mar  <span class="token number">4</span> <span class="token number">16</span>:15 node-1
drwxr-xr-x. <span class="token number">3</span> root root <span class="token number">18</span> Mar  <span class="token number">4</span> <span class="token number">16</span>:15 node-2
drwxr-xr-x. <span class="token number">3</span> root root <span class="token number">18</span> Mar  <span class="token number">4</span> <span class="token number">16</span>:15 node-3
drwxr-xr-x. <span class="token number">3</span> root root <span class="token number">18</span> Mar  <span class="token number">4</span> <span class="token number">16</span>:15 node-4
drwxr-xr-x. <span class="token number">3</span> root root <span class="token number">18</span> Mar  <span class="token number">4</span> <span class="token number">16</span>:15 node-5
drwxr-xr-x. <span class="token number">3</span> root root <span class="token number">18</span> Mar  <span class="token number">4</span> <span class="token number">16</span>:15 node-6
</code></pre>
    <p>
     启动
     <code>
      Redis
     </code>
     容器
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># redis:5.0.9-alpine3.11 镜像名称</span>
<span class="token comment"># redis-server /etc/redis/redis.conf 启动 Redis 服务并加载自定义配置的核心指令。</span>
<span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">6371</span>:6379 <span class="token parameter variable">-p</span> <span class="token number">16371</span>:16379 <span class="token parameter variable">--name</span> redis-1 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mydata/redis/node-1/data:/data <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mydata/redis/node-1/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token parameter variable">--net</span> redis <span class="token parameter variable">--ip</span> <span class="token number">172.38</span>.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf

<span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">6372</span>:6379 <span class="token parameter variable">-p</span> <span class="token number">16372</span>:16379 <span class="token parameter variable">--name</span> redis-2 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mydata/redis/node-2/data:/data <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mydata/redis/node-2/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token parameter variable">--net</span> redis <span class="token parameter variable">--ip</span> <span class="token number">172.38</span>.0.12 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf

<span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">6373</span>:6379 <span class="token parameter variable">-p</span> <span class="token number">16373</span>:16379 <span class="token parameter variable">--name</span> redis-3 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mydata/redis/node-3/data:/data <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mydata/redis/node-3/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token parameter variable">--net</span> redis <span class="token parameter variable">--ip</span> <span class="token number">172.38</span>.0.13 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf

<span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">6374</span>:6379 <span class="token parameter variable">-p</span> <span class="token number">16374</span>:16379 <span class="token parameter variable">--name</span> redis-4 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mydata/redis/node-4/data:/data <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mydata/redis/node-4/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token parameter variable">--net</span> redis <span class="token parameter variable">--ip</span> <span class="token number">172.38</span>.0.14 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf

<span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">6375</span>:6379 <span class="token parameter variable">-p</span> <span class="token number">16375</span>:16379 <span class="token parameter variable">--name</span> redis-5 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mydata/redis/node-5/data:/data <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mydata/redis/node-5/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token parameter variable">--net</span> redis <span class="token parameter variable">--ip</span> <span class="token number">172.38</span>.0.15 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf

<span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">6376</span>:6379 <span class="token parameter variable">-p</span> <span class="token number">16376</span>:16379 <span class="token parameter variable">--name</span> redis-6 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mydata/redis/node-6/data:/data <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mydata/redis/node-6/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token parameter variable">--net</span> redis <span class="token parameter variable">--ip</span> <span class="token number">172.38</span>.0.16 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/76fb7e76f2694e6ea8070bc8c234aa2f.png"/>
     <br/>
     进入容器
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> redis-1 /bin/sh
</code></pre>
    <p>
     创建集群
    </p>
    <pre><code class="prism language-bash">redis-cli <span class="token parameter variable">--cluster</span> create <span class="token number">172.38</span>.0.11:6379 <span class="token number">172.38</span>.0.12:6379 <span class="token number">172.38</span>.0.13:6379 <span class="token number">172.38</span>.0.14:6379 <span class="token number">172.38</span>.0.15:6379 <span class="token number">172.38</span>.0.16:6379 --cluster-replicas <span class="token number">1</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/cf8649cf911a49a79dd86c69aad2dcb4.png"/>
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
成功！
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/5ebf4d1101a143d481b8b8594f90abce.png"/>
    </p>
    <h2>
     <a id="_1016">
     </a>
     总结
    </h2>
    <p>
     所有结论都需要反复测试！如果有错误欢迎指正！一起努力！
     <br/>
     如果喜欢的话，请点个赞吧就算鼓励我一下。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f61616262646e736d2f:61727469636c652f64657461696c732f313435393633363839" class_="artid" style="display:none">
 </p>
</div>


