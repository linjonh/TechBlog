---
layout: post
title: "使用-OpenSSL-和-Python-实现-AES-256-CBC-加密与解密安全密钥管理"
date: 2025-03-08 08:36:50 +0800
description: "使用 OpenSSL 和 Python 实现 AES-256-CBC 加密与解密, 在不加密的软件上也能安全传输你的加密消息!"
keywords: "没有aes-256-cfb插件"
categories: ['未分类']
tags: ['网络安全', '密码学', '安全', 'Python', 'Openssl']
artid: "146110362"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146110362
    alt: "使用-OpenSSL-和-Python-实现-AES-256-CBC-加密与解密安全密钥管理"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146110362
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146110362
cover: https://bing.ee123.net/img/rand?artid=146110362
image: https://bing.ee123.net/img/rand?artid=146110362
img: https://bing.ee123.net/img/rand?artid=146110362
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     使用 OpenSSL 和 Python 实现 AES-256-CBC 加密与解密（安全密钥管理）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     环境
    </h3>
    <ul>
     <li>
      OpenSSL
     </li>
     <li>
      Python
     </li>
    </ul>
    <h3>
     <a id="_OpenSSL__5">
     </a>
     使用 OpenSSL 加密
    </h3>
    <h4>
     <a id="1__AES__IV_7">
     </a>
     <strong>
      1. 生成 AES 密钥和 IV
     </strong>
    </h4>
    <p>
     <strong>
      强烈推荐使用方法一（Python
      <code>
       secrets
      </code>
      模块）
     </strong>
     ，因为它更安全。
    </p>
    <h5>
     <a id="_Python__secrets__11">
     </a>
     方法一: Python 的
     <code>
      secrets
     </code>
     模块（安全方式）
    </h5>
    <ul>
     <li>
      <p>
       <strong>
        不要使用 OpenSSL 的
        <code>
         rand
        </code>
        命令直接生成密钥和 IV 用于生产环境。
       </strong>
       尽管
       <code>
        openssl rand
       </code>
       可以生成随机数，但它可能不符合密码学安全的要求。
      </p>
     </li>
     <li>
      <p>
       <strong>
        推荐方法：
       </strong>
       使用更安全的随机数生成器，例如 Python 的
       <code>
        secrets
       </code>
       模块：
      </p>
      <pre><code class="prism language-python"><span class="token keyword">import</span> secrets
<span class="token keyword">import</span> binascii

<span class="token comment"># 生成 256 位 AES 密钥（32 字节）</span>
key <span class="token operator">=</span> secrets<span class="token punctuation">.</span>token_bytes<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
key_hex <span class="token operator">=</span> binascii<span class="token punctuation">.</span>hexlify<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 转换为十六进制字符串</span>

<span class="token comment"># 生成 128 位 IV（16 字节）</span>
iv <span class="token operator">=</span> secrets<span class="token punctuation">.</span>token_bytes<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
iv_hex <span class="token operator">=</span> binascii<span class="token punctuation">.</span>hexlify<span class="token punctuation">(</span>iv<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 转换为十六进制字符串</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"AES Key (Hex):"</span><span class="token punctuation">,</span> key_hex<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"IV (Hex):"</span><span class="token punctuation">,</span> iv_hex<span class="token punctuation">)</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        <code>
         secrets.token_bytes(nbytes)
        </code>
        ：
       </strong>
       生成
       <code>
        nbytes
       </code>
       个密码学安全的随机字节。
      </p>
     </li>
     <li>
      <p>
       <strong>
        <code>
         binascii.hexlify(data)
        </code>
        ：
       </strong>
       将字节数据转换为十六进制字符串。
      </p>
     </li>
     <li>
      <p>
       <strong>
        保存：
       </strong>
       将生成的密钥和 IV 安全地保存起来（例如，使用密码管理器）。
      </p>
     </li>
    </ul>
    <h5>
     <a id="__OpenSSL__rand__37">
     </a>
     方法二: 直接使用 OpenSSL 的
     <code>
      rand
     </code>
     命令(不推荐)
    </h5>
    <pre><code class="prism language-bash">openssl rand <span class="token parameter variable">-hex</span> <span class="token number">32</span>  <span class="token comment"># 生成 256 位 AES 密钥（32 字节）</span>
openssl rand <span class="token parameter variable">-hex</span> <span class="token number">16</span>  <span class="token comment"># 生成 128 位 IV（16 字节）</span>
</code></pre>
    <ul>
     <li>
      <strong>
       <code>
        openssl rand -hex &lt;长度&gt;
       </code>
       ：
      </strong>
      使用 OpenSSL 的随机数生成器生成指定长度的十六进制字符串。
     </li>
     <li>
      <strong>
       保存密钥和 IV：
      </strong>
      将生成的密钥和 IV 安全地保存起来（例如，存储在密码管理器中）。
     </li>
    </ul>
    <h4>
     <a id="2__47">
     </a>
     <strong>
      2. 加密
     </strong>
    </h4>
    <pre><code class="prism language-bash">openssl enc -aes-256-cbc <span class="token parameter variable">-pbkdf2</span> <span class="token parameter variable">-iter</span> <span class="token number">100000</span> <span class="token parameter variable">-in</span> plaintext.txt <span class="token parameter variable">-out</span> ciphertext.bin <span class="token parameter variable">-K</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> key.txt<span class="token variable">)</span></span> <span class="token parameter variable">-iv</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> iv.txt<span class="token variable">)</span></span>
</code></pre>
    <ul>
     <li>
      <strong>
       <code>
        -pbkdf2
       </code>
       ：
      </strong>
      使用 PBKDF2 密钥派生函数。
     </li>
     <li>
      <strong>
       <code>
        -iter 100000
       </code>
       ：
      </strong>
      设置迭代次数为 100000（建议至少 10000，可以根据需要调整）。
     </li>
     <li>
      <strong>
       <code>
        -K $(cat key.txt)
       </code>
       ：
      </strong>
      从文件
      <code>
       key.txt
      </code>
      中读取 AES 密钥（假设你已将密钥保存在
      <code>
       key.txt
      </code>
      文件中）。
     </li>
     <li>
      <strong>
       <code>
        -iv $(cat iv.txt)
       </code>
       ：
      </strong>
      从文件
      <code>
       iv.txt
      </code>
      中读取 IV（假设你已将 IV 保存在
      <code>
       iv.txt
      </code>
      文件中）。
     </li>
     <li>
      <strong>
       去掉了
       <code>
        -salt
       </code>
      </strong>
      : 当使用
      <code>
       -pbkdf2
      </code>
      的时候，不再需要
      <code>
       -salt
      </code>
      。
     </li>
     <li>
      <strong>
       为什么要从文件中读取密钥和 IV？
      </strong>
      <ul>
       <li>
        <strong>
         安全：
        </strong>
        避免将密钥和 IV 直接写在命令行中，防止泄露（例如，通过命令行历史记录）。
       </li>
       <li>
        <strong>
         方便：
        </strong>
        方便管理和重复使用密钥和 IV。
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="3_Base64__62">
     </a>
     <strong>
      3. Base64 编码
     </strong>
    </h4>
    <p>
     将密文转换为文本格式（用于生成条形码），需要进行 Base64 编码：
    </p>
    <pre><code class="prism language-bash">openssl base64 <span class="token parameter variable">-in</span> ciphertext.bin <span class="token parameter variable">-out</span> ciphertext.txt
</code></pre>
    <h4>
     <a id="4__70">
     </a>
     <strong>
      4. 生成条形码
     </strong>
    </h4>
    <ul>
     <li>
      使用在线条形码生成器（如
      <code>
       https://barcode.tec-it.com/en
      </code>
      ）将 Base64 编码后的密文生成条形码图片。
     </li>
     <li>
      选择条形码类型（如 Code 128），将 Base64 编码后的密文粘贴到输入框中，生成条形码图片。
     </li>
    </ul>
    <h3>
     <a id="_75">
     </a>
     安全传输密钥和密文
    </h3>
    <h4>
     <a id="1__77">
     </a>
     <strong>
      1. 安全传输密钥：
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       重要：
      </strong>
      密钥和 IV 的安全至关重要！绝对不要通过不安全的渠道（如微信、邮件 💀）直接发送。
     </li>
     <li>
      <strong>
       安全方案：
      </strong>
      <ul>
       <li>
        <strong>
         线下告知：
        </strong>
        如果条件允许，线下口头告知或使用纸条传递。
       </li>
       <li>
        <strong>
         加密通信工具：
        </strong>
        使用 Signal、Wire 等端到端加密的通信工具。
       </li>
       <li>
        <strong>
         密钥交换协议：
        </strong>
        如果对密码学有一定了解，可以使用 Diffie-Hellman 等密钥交换协议。
       </li>
       <li>
        <strong>
         密钥文件：
        </strong>
        可以将密钥和IV存放在一个文件中, 使用 GPG 加密后发送.
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="2__86">
     </a>
     <strong>
      2. 发送条形码：
     </strong>
    </h4>
    <ul>
     <li>
      将生成的条形码图片通过微信等方式发送给你的朋友。这步可以用微信了。😇
     </li>
    </ul>
    <h3>
     <a id="_90">
     </a>
     解密方式
    </h3>
    <h4>
     <a id="1__92">
     </a>
     <strong>
      1. 解密
     </strong>
    </h4>
    <pre><code class="prism language-bash">openssl enc <span class="token parameter variable">-d</span> -aes-256-cbc <span class="token parameter variable">-in</span> ciphertext.bin <span class="token parameter variable">-out</span> plaintext.txt <span class="token parameter variable">-K</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> key.txt<span class="token variable">)</span></span> <span class="token parameter variable">-iv</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> iv.txt<span class="token variable">)</span></span> <span class="token parameter variable">-pbkdf2</span> <span class="token parameter variable">-iter</span> <span class="token number">100000</span>
</code></pre>
    <ul>
     <li>
      <strong>
       注意：
      </strong>
      <ul>
       <li>
        解密命令与加密命令
        <strong>
         基本相同
        </strong>
        ，只是将
        <code>
         -enc
        </code>
        改为
        <code>
         -d
        </code>
        （表示解密）。
       </li>
       <li>
        <code>
         -pbkdf2
        </code>
        和
        <code>
         -iter
        </code>
        参数必须与加密时
        <strong>
         完全一致
        </strong>
        。
       </li>
       <li>
        <code>
         -K
        </code>
        和
        <code>
         -iv
        </code>
        参数仍然从文件中读取密钥和 IV。
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="2_Base64__103">
     </a>
     <strong>
      2. Base64 解码
     </strong>
    </h4>
    <pre><code class="prism language-bash">openssl base64 <span class="token parameter variable">-d</span> <span class="token parameter variable">-in</span> ciphertext.txt <span class="token parameter variable">-out</span> ciphertext.bin
</code></pre>
    <h3>
     <a id="_109">
     </a>
     <strong>
      完整的流程总结
     </strong>
    </h3>
    <ol>
     <li>
      <p>
       <strong>
        生成强密钥和 IV：
       </strong>
      </p>
      <ul>
       <li>
        使用 Python 的
        <code>
         secrets
        </code>
        模块。
       </li>
       <li>
        将密钥和 IV 保存到安全的文件中（例如，
        <code>
         key.txt
        </code>
        和
        <code>
         iv.txt
        </code>
        ）, 或者密码管理器中。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        加密：
       </strong>
      </p>
      <pre><code class="prism language-bash">openssl enc -aes-256-cbc <span class="token parameter variable">-pbkdf2</span> <span class="token parameter variable">-iter</span> <span class="token number">100000</span> <span class="token parameter variable">-in</span> plaintext.txt <span class="token parameter variable">-out</span> ciphertext.bin <span class="token parameter variable">-K</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> key.txt<span class="token variable">)</span></span> <span class="token parameter variable">-iv</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> iv.txt<span class="token variable">)</span></span>
</code></pre>
      <pre><code class="prism language-bash">openssl base64 <span class="token parameter variable">-in</span> ciphertext.bin <span class="token parameter variable">-out</span> ciphertext.txt
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        解密：
       </strong>
      </p>
      <pre><code class="prism language-bash">openssl enc <span class="token parameter variable">-d</span> -aes-256-cbc <span class="token parameter variable">-in</span> ciphertext.bin <span class="token parameter variable">-out</span> plaintext.txt <span class="token parameter variable">-K</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> key.txt<span class="token variable">)</span></span> <span class="token parameter variable">-iv</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> iv.txt<span class="token variable">)</span></span> <span class="token parameter variable">-pbkdf2</span> <span class="token parameter variable">-iter</span> <span class="token number">100000</span>
</code></pre>
      <pre><code class="prism language-bash">openssl base64 <span class="token parameter variable">-d</span> <span class="token parameter variable">-in</span> ciphertext.txt <span class="token parameter variable">-out</span> ciphertext.bin
</code></pre>
     </li>
    </ol>
    <p>
     注意安全, HAVE FUN! 👀
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f4b656972616b65652f:61727469636c652f64657461696c732f313436313130333632" class_="artid" style="display:none">
 </p>
</div>


