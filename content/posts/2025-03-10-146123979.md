---
layout: post
title: "MongoDB二-MongoDB命令详解"
date: 2025-03-10 11:34:13 +0800
description: "本文是 MongoDB 的操作指南，全面介绍了其在数据库、集合、文档、索引、用户权限管理等方面的操作。开篇点明 MongoDB 在数据管理领域的重要性，随后详细阐述各项操作。数据库操作涵盖切换、创建、查看和删除数据库；集合操作包括创建、查看和删除集合；文档操作涉及插入、更新、删除和查询，查询又分为基本查询、条件查询、数组查询等多种方式，并介绍了聚合操作和 Map - Reduce 操作。索引操作讲解了索引类型、创建、查看和删除方法。用户权限管理介绍了内置角色和权限，以及用户的创建、查看、修改和删除操作。"
keywords: "MongoDB（二） - MongoDB命令详解"
categories: ['Nosql']
tags: ['数据库', 'Mongodb']
artid: "146123979"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146123979
    alt: "MongoDB二-MongoDB命令详解"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146123979
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146123979
cover: https://bing.ee123.net/img/rand?artid=146123979
image: https://bing.ee123.net/img/rand?artid=146123979
img: https://bing.ee123.net/img/rand?artid=146123979
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     MongoDB（二） - MongoDB命令详解
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <hr/>
    <h2>
     <a id="_3">
     </a>
     前言
    </h2>
    <p>
     本文是 MongoDB 的操作指南，全面介绍了其在数据库、集合、文档、索引、用户权限管理等方面的操作。开篇点明 MongoDB 在数据管理领域的重要性，随后详细阐述各项操作。数据库操作涵盖切换、创建、查看和删除数据库；集合操作包括创建、查看和删除集合；文档操作涉及插入、更新、删除和查询，查询又分为基本查询、条件查询、数组查询等多种方式，并介绍了聚合操作和 Map - Reduce 操作。索引操作讲解了索引类型、创建、查看和删除方法。用户权限管理介绍了内置角色和权限，以及用户的创建、查看、修改和删除操作。此外，还介绍了帮助信息命令。本文旨在帮助读者系统掌握 MongoDB 操作，为实际应用提供有力支持。
    </p>
    <hr/>
    <h2>
     <a id="_9">
     </a>
     一、数据库操作
    </h2>
    <h3>
     <a id="1__11">
     </a>
     1. 切换/创建数据库
    </h3>
    <p>
     使用
     <code>
      use
     </code>
     命令切换/创建数据库的语法如下：
    </p>
    <pre><code class="prism language-cmd">use &lt;database_name&gt;
</code></pre>
    <p>
     <strong>
      示例
     </strong>
     ：切换到名为
     <code>
      db_demo1
     </code>
     的数据库。如果该数据库不存在，MongoDB 不会在执行这条命令时创建它，但当你第一次存储数据（如插入文档）时，MongoDB 会自动创建这个数据库。
    </p>
    <pre><code class="prism language-cmd">use db_demo1
</code></pre>
    <h3>
     <a id="2__24">
     </a>
     2. 查看数据库
    </h3>
    <h4>
     <a id="21__25">
     </a>
     2.1 查看所有数据库
    </h4>
    <pre><code class="prism language-cmd">show dbs
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f34ab8e67f474da7be4fc27b8e60e4e0.png"/>
    </p>
    <p>
     发现没有创建的数据库
     <code>
      db_demo1
     </code>
     ，是因为使用use命令创建的数据库中如果没有任何数据，
     <strong>
      没有数据的数据库可以理解为实际不存在
     </strong>
     。
    </p>
    <h4>
     <a id="22__35">
     </a>
     2.2 查看当前数据库
    </h4>
    <pre><code class="prism language-cmd">db
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/07258309c8ce4027b2469aa5160f7f88.png"/>
    </p>
    <h3>
     <a id="3__41">
     </a>
     3. 删除数据库
    </h3>
    <p>
     可以使用如下命令删除当前数据库。
    </p>
    <pre><code class="prism language-cmd">db.dropDatabase()
</code></pre>
    <p>
     删除当前数据库实际上只是把数据库中的数据清空，因为执行删除数据库命令后，再执行查看当前数据库的命令，依然显示当前数据库为删除之前的数据库。
    </p>
    <pre><code class="prism language-cmd">db
db.dropDatabase()
db
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/6769bf6bff894accb4b301662775223b.png"/>
    </p>
    <hr/>
    <h2>
     <a id="_56">
     </a>
     二、集合操作
    </h2>
    <h3>
     <a id="1__58">
     </a>
     1. 创建集合
    </h3>
    <p>
     创建集合语法如下：
    </p>
    <pre><code class="prism language-shell">db.createCollection<span class="token punctuation">(</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     创建集合
     <code>
      c_demo1
     </code>
     。
    </p>
    <pre><code class="prism language-shell">db.createCollection<span class="token punctuation">(</span><span class="token string">'c_demo1'</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8ebb396f67d940998d18af333c030f3f.png"/>
    </p>
    <h3>
     <a id="2__71">
     </a>
     2. 查看集合
    </h3>
    <p>
     查看当前数据库中的所有集合。
    </p>
    <pre><code class="prism language-shell">show collections
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a8659381100d4560b82a4376eb7be9e7.png"/>
    </p>
    <h3>
     <a id="3__80">
     </a>
     3. 删除集合
    </h3>
    <p>
     删除集合语法如下：
    </p>
    <pre><code class="prism language-shell">db.<span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span>.drop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     删除当前数据库中的集合
     <code>
      c_demo1
     </code>
     。
    </p>
    <pre><code class="prism language-shell">db.c_demo1.drop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/52020de4435a4eb78576426d3cce3c8f.png"/>
    </p>
    <hr/>
    <h2>
     <a id="_96">
     </a>
     三、文档操作
    </h2>
    <h3>
     <a id="1__97">
     </a>
     1. 插入文档
    </h3>
    <h4>
     <a id="11__98">
     </a>
     1.1 单文档插入
    </h4>
    <p>
     单文档插入语法如下：
    </p>
    <pre><code class="prism language-shell">db.<span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span>.insertOne<span class="token punctuation">(</span>
   <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>,
   <span class="token punctuation">{<!-- --></span>
     writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>,
     ordered: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <code>
       &lt;document&gt;
      </code>
      ：要插入的文档，是一个 JSON 对象。
     </li>
     <li>
      <code>
       writeConcern
      </code>
      ：可选参数，指定写入操作的确认级别，用于控制写入操作在复制集成员中的传播和确认方式。
     </li>
     <li>
      <code>
       ordered
      </code>
      ：可选参数，在批量插入时才会用到，对于 insertOne 无实际意义。
     </li>
    </ul>
    <p>
     <strong>
      示例
     </strong>
     ：切换到名为
     <code>
      db_demo2
     </code>
     的数据库。如果该数据库不存在，MongoDB 不会在执行这条命令时创建它，但当你第一次存储数据（如插入文档）时，MongoDB 会自动创建这个数据库。向集合
     <code>
      c_demo2
     </code>
     中插入一个新文档。
    </p>
    <pre><code class="prism language-shell">use db_demo2<span class="token punctuation">;</span>
db.c_demo2.insertOne<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    name: <span class="token string">"John"</span>,
    age: <span class="token number">30</span>,
    city: <span class="token string">"New York"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/fbf8dc7a120e4e4890784285c0300ef8.png"/>
    </p>
    <h4>
     <a id="12__128">
     </a>
     1.2 多文档插入
    </h4>
    <p>
     多文档插入语法如下：
    </p>
    <pre><code class="prism language-shell">db.<span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span>.insertMany<span class="token punctuation">(</span>
   <span class="token punctuation">[</span> <span class="token operator">&lt;</span>document <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>, <span class="token operator">&lt;</span>document <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>, <span class="token punctuation">..</span>. <span class="token punctuation">]</span>,
   <span class="token punctuation">{<!-- --></span>
     writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>,
     ordered: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      示例1
     </strong>
     ：向集合
     <code>
      c_demo2
     </code>
     中插入两个新文档。
    </p>
    <pre><code class="prism language-shell">db.c_demo2.insertMany<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span> name: <span class="token string">"Alice"</span>, age: <span class="token number">25</span>, city: <span class="token string">"Los Angeles"</span> <span class="token punctuation">}</span>,
    <span class="token punctuation">{<!-- --></span> name: <span class="token string">"Bob"</span>, age: <span class="token number">35</span>, city: <span class="token string">"Chicago"</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/3560b25f9d1c46eaa8b93e020cd7e085.png"/>
    </p>
    <p>
     <strong>
      示例2
     </strong>
     ：向集合
     <code>
      c_demo3
     </code>
     中插入嵌套文档或数组。
    </p>
    <pre><code class="prism language-shell">db.c_demo3.insertMany<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span> name: <span class="token string">"zhangsan"</span>, info: <span class="token punctuation">{<!-- --></span> age: <span class="token number">30</span>, address: <span class="token string">"yunnan"</span>, hight: <span class="token number">176</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>,
    <span class="token punctuation">{<!-- --></span> name: <span class="token string">"lisi"</span>, info: <span class="token punctuation">{<!-- --></span> age: <span class="token number">31</span>, address: <span class="token string">"guizhou"</span>, hight: <span class="token number">175</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>,
    <span class="token punctuation">{<!-- --></span> name: <span class="token string">"wangwu"</span>, scores: <span class="token punctuation">[</span><span class="token number">80</span>, <span class="token number">90</span>, <span class="token number">75</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/beaee408ace04abeafc39ca0fd475fc0.png"/>
    </p>
    <h3>
     <a id="2__164">
     </a>
     2. 更新文档
    </h3>
    <h4>
     <a id="21__165">
     </a>
     2.1 单文档更新
    </h4>
    <p>
     更新语法如下：
    </p>
    <pre><code class="prism language-shell">db.<span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span>.updateOne<span class="token punctuation">(</span>
   <span class="token operator">&lt;</span>filter<span class="token operator">&gt;</span>,
   <span class="token operator">&lt;</span>update<span class="token operator">&gt;</span>,
   <span class="token punctuation">{<!-- --></span>
     upsert: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>,
     writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>,
     collation: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>,
     arrayFilters: <span class="token punctuation">[</span> <span class="token operator">&lt;</span>filterdocument<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>, <span class="token punctuation">..</span>. <span class="token punctuation">]</span>,
     hint:  <span class="token operator">&lt;</span>document<span class="token operator">|</span>string<span class="token operator">&gt;</span> 
   <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <code>
       &lt;filter&gt;
      </code>
      ：用于筛选出需要更新的文档，类似于 SQL 中的 WHERE 子句。
     </li>
     <li>
      <code>
       &lt;update&gt;
      </code>
      ：指定更新操作，可使用更新操作符（如
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         s 
         
        
          e 
         
        
          t 
         
        
          、 
         
        
       
         set、
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6833em;">
          </span>
          <span class="mord mathnormal">
           se
          </span>
          <span class="mord mathnormal">
           t
          </span>
          <span class="mord cjk_fallback">
           、
          </span>
         </span>
        </span>
       </span>
      </span>
      inc 等）来修改文档的字段。
      <ul>
       <li>
        <code>
         $set
        </code>
        ：用于设置文档中指定字段的值。如果该字段不存在，则会创建该字段；如果字段已存在，则会更新其值。
       </li>
       <li>
        <code>
         $inc
        </code>
        ：用于对文档中指定的数字字段进行增量操作，即增加或减少该字段的值。该字段必须是数字类型，否则会报错。
       </li>
       <li>
        <code>
         $unset
        </code>
        ：用于从文档中删除指定的字段。
       </li>
       <li>
        <code>
         $push
        </code>
        ：用于向数组字段中添加一个元素。如果数组字段不存在，则会创建该数组字段并添加元素。
       </li>
       <li>
        <code>
         $pull
        </code>
        ：用于从数组字段中移除所有匹配指定值的元素。
       </li>
       <li>
        <code>
         $addToSet
        </code>
        ：用于向数组字段中添加一个元素，但只有当该元素不在数组中时才会添加，避免数组中出现重复元素。
       </li>
      </ul>
     </li>
     <li>
      <code>
       upsert
      </code>
      ：可选参数，布尔值。如果设置为 true，当没有匹配的文档时，会插入一个新文档；默认值为 false。
     </li>
     <li>
      <code>
       writeConcern
      </code>
      ：可选参数，指定写入操作的确认级别。
     </li>
     <li>
      <code>
       collation
      </code>
      ：可选参数，指定用于操作的排序规则。
     </li>
     <li>
      <code>
       arrayFilters
      </code>
      ：可选参数，用于过滤数组元素。
     </li>
     <li>
      <code>
       hint
      </code>
      ：可选参数，指定使用哪个索引进行查询
     </li>
    </ul>
    <p>
     <strong>
      示例
     </strong>
     ：将
     <code>
      c_demo2
     </code>
     文档中
     <code>
      name
     </code>
     为
     <code>
      Alice
     </code>
     的学生的
     <code>
      age
     </code>
     更新为
     <code>
      26
     </code>
     。
    </p>
    <pre><code class="prism language-shell">db.c_demo2.updateOne<span class="token punctuation">(</span>
  <span class="token punctuation">{<!-- --></span> <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"Alice"</span> <span class="token punctuation">}</span>,
  <span class="token punctuation">{<!-- --></span> <span class="token variable">$set</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token number">26</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a187c538342e435aa1124aa87d6bf23c.png"/>
    </p>
    <h4>
     <a id="22__205">
     </a>
     2.2 多文档更新
    </h4>
    <p>
     多文档更新语法如下：
    </p>
    <pre><code class="prism language-shell">db.<span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span>.updateMany<span class="token punctuation">(</span>
   <span class="token operator">&lt;</span>filter<span class="token operator">&gt;</span>,
   <span class="token operator">&lt;</span>update<span class="token operator">&gt;</span>,
   <span class="token punctuation">{<!-- --></span>
     upsert: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>,
     writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>,
     collation: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>,
     arrayFilters: <span class="token punctuation">[</span> <span class="token operator">&lt;</span>filterdocument<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>, <span class="token punctuation">..</span>. <span class="token punctuation">]</span>,
     hint:  <span class="token operator">&lt;</span>document<span class="token operator">|</span>string<span class="token operator">&gt;</span> 
   <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      示例
     </strong>
     ：将所有
     <code>
      age
     </code>
     大于 20 的数据的
     <code>
      name
     </code>
     设置为 new_name。
    </p>
    <pre><code class="prism language-shell">db.c_demo2.updateMany<span class="token punctuation">(</span>
  <span class="token punctuation">{<!-- --></span> <span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span> <span class="token variable">$gt</span><span class="token builtin class-name">:</span> <span class="token number">20</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>,
  <span class="token punctuation">{<!-- --></span> <span class="token variable">$set</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"new_name"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/0b1eedb062c6428cb3f69629d3b32e1c.png"/>
    </p>
    <h3>
     <a id="3__232">
     </a>
     3. 删除文档
    </h3>
    <h4>
     <a id="31__233">
     </a>
     3.1 单文档删除
    </h4>
    <p>
     删除集合中第一个匹配指定条件的文档。如果有多个文档满足条件，只会删除其中一个。
    </p>
    <p>
     单文档删除语法如下：
    </p>
    <pre><code class="prism language-shell">db.<span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span>.deleteOne<span class="token punctuation">(</span>
   <span class="token operator">&lt;</span>filter<span class="token operator">&gt;</span>,
   <span class="token punctuation">{<!-- --></span>
     writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      示例
     </strong>
     ：删除集合
     <code>
      c_demo2
     </code>
     中
     <code>
      name
     </code>
     为
     <code>
      new_name
     </code>
     的第一个文档。
    </p>
    <pre><code class="prism language-shell">db.c_demo2.deleteOne<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"new_name"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c4fe4d1074df4d3f910db2b624061259.png"/>
    </p>
    <h4>
     <a id="32__257">
     </a>
     3.2 多文档删除
    </h4>
    <p>
     删除集合中所有匹配指定条件的文档。
    </p>
    <p>
     多文档删除语法如下：
    </p>
    <pre><code class="prism language-shell">db.<span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span>.deleteMany<span class="token punctuation">(</span>
   <span class="token operator">&lt;</span>filter<span class="token operator">&gt;</span>,
   <span class="token punctuation">{<!-- --></span>
     writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      示例
     </strong>
     ：删除集合
     <code>
      c_demo2
     </code>
     中
     <code>
      age
     </code>
     大于 30 的所有文档。
    </p>
    <pre><code class="prism language-shell">db.c_demo2.deleteMany<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span> <span class="token variable">$gt</span><span class="token builtin class-name">:</span> <span class="token number">30</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c6e6ed47180d49dc83c19e16be407b73.png"/>
    </p>
    <hr/>
    <h2>
     <a id="__280">
     </a>
     四. 查询文档
    </h2>
    <h3>
     <a id="1__281">
     </a>
     1. 基本查询
    </h3>
    <p>
     基本查询是最基础的查询方式，通过指定文档的字段和值来筛选文档。
    </p>
    <p>
     查询语法如下：
    </p>
    <pre><code class="prism language-shell">db.<span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span>.find<span class="token punctuation">(</span><span class="token operator">&lt;</span>query<span class="token operator">&gt;</span>, <span class="token operator">&lt;</span>projection<span class="token operator">&gt;</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     或
    </p>
    <pre><code class="prism language-shell">db.<span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span>.find<span class="token punctuation">(</span><span class="token operator">&lt;</span>query<span class="token operator">&gt;</span>, <span class="token operator">&lt;</span>projection<span class="token operator">&gt;</span><span class="token punctuation">)</span>.pretty<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <code>
       &lt;query&gt;
      </code>
      ：一个文档对象，用于指定查询条件。
     </li>
     <li>
      <code>
       &lt;projection&gt;
      </code>
      ：可选参数，用于指定返回文档中要包含或排除的字段。
     </li>
     <li>
      <code>
       pretty()
      </code>
      ：用于美化查询结果。
     </li>
    </ul>
    <p>
     <strong>
      示例1
     </strong>
     ：查询集合
     <code>
      c_demo2
     </code>
     中
     <code>
      age
     </code>
     等于 30 的所有文档。
    </p>
    <pre><code class="prism language-shell">db.c_demo2.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/40ea6b65550e47e0a90824540ed4a786.png"/>
    </p>
    <p>
     <strong>
      示例2
     </strong>
     ：查询集合
     <code>
      c_demo2
     </code>
     中的所有文档。
    </p>
    <pre><code class="prism language-shell">db.c_demo2.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/10e9ec0cc1eb4787adda918e18cb41d2.png"/>
    </p>
    <h3>
     <a id="2__314">
     </a>
     2. 条件查询
    </h3>
    <p>
     MongoDB 条件查询操作符的介绍如下：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        操作符
       </th>
       <th>
        描述
       </th>
       <th>
        示例
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         $eq
        </code>
       </td>
       <td>
        匹配
        <code>
         等于
        </code>
        指定值的文档。
       </td>
       <td>
        <code>
         {age: {$eq: 28}}
        </code>
        将匹配
        <code>
         age
        </code>
        字段值为 28 的所有文档。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $ne
        </code>
       </td>
       <td>
        匹配
        <code>
         不等于
        </code>
        指定值的文档。
       </td>
       <td>
        <code>
         {age: {$ne: 28}}
        </code>
        将匹配
        <code>
         age
        </code>
        字段值不是 28 的所有文档。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $gt
        </code>
       </td>
       <td>
        匹配
        <code>
         大于
        </code>
        指定值的文档。
       </td>
       <td>
        <code>
         {age: {$gt: 28}}
        </code>
        将匹配
        <code>
         age
        </code>
        字段值大于 28 的所有文档。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $gte
        </code>
       </td>
       <td>
        匹配
        <code>
         大于或等于
        </code>
        指定值的文档。
       </td>
       <td>
        <code>
         {age: {$gte: 28}}
        </code>
        将匹配
        <code>
         age
        </code>
        字段值大于或等于 28 的所有文档。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $lt
        </code>
       </td>
       <td>
        匹配
        <code>
         小于
        </code>
        指定值的文档。
       </td>
       <td>
        <code>
         {age: {$lt: 28}}
        </code>
        将匹配
        <code>
         age
        </code>
        字段值小于 28 的所有文档。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $lte
        </code>
       </td>
       <td>
        匹配
        <code>
         小于或等于
        </code>
        指定值的文档。
       </td>
       <td>
        <code>
         {age: {$lte: 28}}
        </code>
        将匹配
        <code>
         age
        </code>
        字段值小于或等于 28 的所有文档。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $in
        </code>
       </td>
       <td>
        匹配字段值在指定数组内的文档。
       </td>
       <td>
        <code>
         {age: {$in: [20, 25, 30]}}
        </code>
        将匹配
        <code>
         age
        </code>
        字段值为 20、25 或 30 的所有文档。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $nin
        </code>
       </td>
       <td>
        匹配字段值不在指定数组内的文档。
       </td>
       <td>
        <code>
         {age: {$nin: [20, 25, 30]}}
        </code>
        将匹配
        <code>
         age
        </code>
        字段值不是 20、25 或 30 的所有文档。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $and
        </code>
       </td>
       <td>
        匹配满足所有条件的文档。
       </td>
       <td>
        <code>
         {$and: [{age: {$gt: 20}}, {age: {$lt: 30}}]}
        </code>
        将匹配
        <code>
         age
        </code>
        字段值大于 20 并且小于 30 的所有文档。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $or
        </code>
       </td>
       <td>
        匹配满足任一条件的文档。
       </td>
       <td>
        <code>
         {$or: [{age: 20}, {age: 30}]}
        </code>
        将匹配
        <code>
         age
        </code>
        字段值为 20 或者 30 的所有文档。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $not
        </code>
       </td>
       <td>
        匹配不符合条件的文档。这是一个用于逻辑否定的操作符。
       </td>
       <td>
        <code>
         {age: {$not: {$gt: 25}}}
        </code>
        将匹配
        <code>
         age
        </code>
        字段值不大于 25 的所有文档。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $nor
        </code>
       </td>
       <td>
        匹配不满足任何给定条件的文档。
       </td>
       <td>
        <code>
         {$nor: [{age: 20}, {age: 30}]}
        </code>
        将匹配
        <code>
         age
        </code>
        字段值既不是 20 也不是 30 的所有文档。
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     <strong>
      示例1
     </strong>
     ：查询集合
     <code>
      c_demo2
     </code>
     中
     <code>
      age
     </code>
     大于等于 25 的所有文档。
    </p>
    <pre><code class="prism language-shell">db.c_demo2.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span> <span class="token variable">$gte</span><span class="token builtin class-name">:</span> <span class="token number">25</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/978bc6b4a9ec4c2fa0dcfdee6fd8cbbc.png"/>
    </p>
    <p>
     <strong>
      示例2
     </strong>
     ：查询集合
     <code>
      c_demo2
     </code>
     中
     <code>
      age
     </code>
     大于 22 且小于 30 的所有文档。
    </p>
    <pre><code class="prism language-shell">db.c_demo2.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token variable">$and</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>age: <span class="token punctuation">{<!-- --></span><span class="token variable">$gt</span><span class="token builtin class-name">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{<!-- --></span>age: <span class="token punctuation">{<!-- --></span><span class="token variable">$lt</span><span class="token builtin class-name">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/40528f9b50e3423fa4f000c57e4c0bdd.png"/>
    </p>
    <h3>
     <a id="3__350">
     </a>
     3. 数组查询
    </h3>
    <p>
     当文档中包含数组字段时，可以使用特定的操作符进行数组查询，如
     <code>
      $elemMatch
     </code>
     和
     <code>
      $size
     </code>
     。
    </p>
    <p>
     <strong>
      示例1
     </strong>
     ：查询集合
     <code>
      c_demo3
     </code>
     中
     <code>
      scores
     </code>
     数组中至少有一个元素大于 85 的文档。
    </p>
    <pre><code class="prism language-shell">db.c_demo3.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token string">"scores"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span> <span class="token variable">$elemMatch</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span> <span class="token variable">$gt</span><span class="token builtin class-name">:</span> <span class="token number">85</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2cd3f999b3f24aa5a45af82466b1529c.png"/>
    </p>
    <p>
     <strong>
      示例2
     </strong>
     ：查询集合
     <code>
      c_demo3
     </code>
     中
     <code>
      scores
     </code>
     数组长度为 3 的文档。
    </p>
    <pre><code class="prism language-shell">db.c_demo3.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token string">"scores"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span> <span class="token variable">$size</span><span class="token builtin class-name">:</span> <span class="token number">3</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ae92ea817f59487095d0ed598ff69491.png"/>
    </p>
    <h3>
     <a id="4__370">
     </a>
     4. 投影
    </h3>
    <p>
     投影用于指定返回文档中要包含或排除的字段，默认情况下，
     <code>
      _id
     </code>
     字段会被返回。
    </p>
    <p>
     <strong>
      示例1
     </strong>
     ：
     <strong>
      包含指定字段
     </strong>
     ：查询集合
     <code>
      c_demo2
     </code>
     中
     <code>
      name
     </code>
     和
     <code>
      city
     </code>
     字段，排除
     <code>
      _id
     </code>
     字段。
    </p>
    <pre><code class="prism language-shell">db.c_demo2.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>, <span class="token punctuation">{<!-- --></span> <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">"city"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">"_id"</span><span class="token builtin class-name">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ed1aee801d70480bb304fa7d6ac5d5a8.png"/>
    </p>
    <p>
     <strong>
      示例2
     </strong>
     ：
     <strong>
      排除指定字段
     </strong>
     ：排除
     <code>
      _id
     </code>
     和
     <code>
      name
     </code>
     字段。
    </p>
    <pre><code class="prism language-shell">db.c_demo2.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>, <span class="token punctuation">{<!-- --></span> <span class="token string">"_id"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2e751afeee9141a3afb6f07cdebb9fd3.png"/>
    </p>
    <h3>
     <a id="5__390">
     </a>
     5. 其他查询
    </h3>
    <h4>
     <a id="51__391">
     </a>
     5.1 查询第一个匹配的文档
    </h4>
    <p>
     <code>
      findOne()
     </code>
     ：返回第一个匹配的文档，而不是所有匹配的文档。
    </p>
    <pre><code class="prism language-shell">db.c_demo2.findOne<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"new_name"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/cb206c9e6f864363a7203022332a042d.png"/>
    </p>
    <h4>
     <a id="52__400">
     </a>
     5.2 限制返回文档的数量
    </h4>
    <p>
     查询集合
     <code>
      c_demo2
     </code>
     的前两个文档。
    </p>
    <pre><code class="prism language-shell">db.c_demo2.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/0797b639d9274f358705ab6827de4e01.png"/>
    </p>
    <h4>
     <a id="53__409">
     </a>
     5.3 跳过指定数量的文档
    </h4>
    <p>
     查询集合
     <code>
      c_demo2
     </code>
     中跳过前3个文档的所有文档。
    </p>
    <pre><code class="prism language-shell">db.c_demo2.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.skip<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/0c6e3d8379ef4e11a4dde3b0323baf96.png"/>
    </p>
    <h4>
     <a id="54__418">
     </a>
     5.4 排序查询
    </h4>
    <p>
     <code>
      sort()
     </code>
     ：对查询结果进行排序，1 表示升序，-1 表示降序。
    </p>
    <p>
     查询集合
     <code>
      c_demo2
     </code>
     中的所有文档，并按
     <code>
      age
     </code>
     进行升序排序。
    </p>
    <pre><code class="prism language-shell">db.c_demo2.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>, <span class="token punctuation">{<!-- --></span> <span class="token string">"_id"</span><span class="token builtin class-name">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>.sort<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/26e4f148a76f421ba03047b18326a952.png"/>
    </p>
    <h4>
     <a id="55__428">
     </a>
     5.5 嵌套文档查询
    </h4>
    <p>
     <strong>
      示例1
     </strong>
     ：查询集合
     <code>
      c_demo3
     </code>
     中
     <code>
      name
     </code>
     为
     <code>
      zhangsan
     </code>
     ，且嵌套文档
     <code>
      info
     </code>
     中
     <code>
      age
     </code>
     为 30 和
     <code>
      address
     </code>
     为
     <code>
      yunnan
     </code>
     的第一个匹配的文档。
    </p>
    <pre><code class="prism language-shell">db.c_demo3.findOne<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"zhangsan"</span>, <span class="token string">"info.age"</span><span class="token builtin class-name">:</span> <span class="token number">30</span>, <span class="token string">"info.address"</span><span class="token builtin class-name">:</span> <span class="token string">"yunnan"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7ee556d7f95a436aa47ff0ebeee7c1a3.png"/>
    </p>
    <h4>
     <a id="56__437">
     </a>
     5.6 正则表达式查询
    </h4>
    <p>
     <strong>
      示例1
     </strong>
     ：查询集合
     <code>
      c_demo2
     </code>
     中
     <code>
      city
     </code>
     的值以
     <code>
      Los
     </code>
     开头的所有文档。
    </p>
    <pre><code class="prism language-shell">db.c_demo2.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token string">"city"</span><span class="token builtin class-name">:</span> /^Los/ <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1cd242e89a424e04a6960b8cd372cdf6.png"/>
    </p>
    <h3>
     <a id="6__447">
     </a>
     6. 聚合操作
    </h3>
    <h4>
     <a id="61__448">
     </a>
     6.1 聚合操作符
    </h4>
    <p>
     MongoDB 中常用的聚合操作符如下：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        操作符
       </th>
       <th>
        描述
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         $group
        </code>
       </td>
       <td>
        按指定字段分组，并可以执行聚合表达式来计算汇总值。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $limit
        </code>
       </td>
       <td>
        限制传递给下一个阶段的文档数量。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $match
        </code>
       </td>
       <td>
        过滤通过的文档，只传递符合指定条件的文档到下一个阶段。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $sort
        </code>
       </td>
       <td>
        对输入文档按指定字段排序。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $project
        </code>
       </td>
       <td>
        修改文档结构，包括重命名、增加或移除字段等。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $skip
        </code>
       </td>
       <td>
        忽略指定数量的文档。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $sum
        </code>
       </td>
       <td>
        计算数值字段的总和。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $avg
        </code>
       </td>
       <td>
        计算数值字段的平均值。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $min
        </code>
       </td>
       <td>
        找出数值字段的最小值。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $max
        </code>
       </td>
       <td>
        找出数值字段的最大值。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $push
        </code>
       </td>
       <td>
        将数组字段中的元素添加到输出文档中。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $first
        </code>
       </td>
       <td>
        返回数组中的第一个元素。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         $last
        </code>
       </td>
       <td>
        返回数组中的最后一个元素。
       </td>
      </tr>
     </tbody>
    </table>
    <h4>
     <a id="62__467">
     </a>
     6.2 聚合操作示例
    </h4>
    <p>
     在当前数据库中给集合
     <code>
      c_demo4
     </code>
     插入多个文档，用于演示聚合操作。
    </p>
    <pre><code class="prism language-shell">db.c_demo4.insertMany<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span> _id: <span class="token number">1</span>, category: <span class="token string">"A"</span>, value: <span class="token number">10</span> <span class="token punctuation">}</span>,
    <span class="token punctuation">{<!-- --></span> _id: <span class="token number">2</span>, category: <span class="token string">"B"</span>, value: <span class="token number">20</span> <span class="token punctuation">}</span>,
    <span class="token punctuation">{<!-- --></span> _id: <span class="token number">3</span>, category: <span class="token string">"A"</span>, value: <span class="token number">30</span> <span class="token punctuation">}</span>,
    <span class="token punctuation">{<!-- --></span> _id: <span class="token number">4</span>, category: <span class="token string">"B"</span>, value: <span class="token number">40</span> <span class="token punctuation">}</span>,
    <span class="token punctuation">{<!-- --></span> _id: <span class="token number">5</span>, category: <span class="token string">"C"</span>, value: <span class="token number">50</span> <span class="token punctuation">}</span>,
	<span class="token punctuation">{<!-- --></span> _id: <span class="token number">6</span>, category: <span class="token string">"A"</span>, value: <span class="token number">10</span> <span class="token punctuation">}</span>,
    <span class="token punctuation">{<!-- --></span> _id: <span class="token number">7</span>, category: <span class="token string">"B"</span>, value: <span class="token number">20</span> <span class="token punctuation">}</span>,
    <span class="token punctuation">{<!-- --></span> _id: <span class="token number">8</span>, category: <span class="token string">"A"</span>, value: <span class="token number">30</span> <span class="token punctuation">}</span>,
    <span class="token punctuation">{<!-- --></span> _id: <span class="token number">9</span>, category: <span class="token string">"B"</span>, value: <span class="token number">40</span> <span class="token punctuation">}</span>,
    <span class="token punctuation">{<!-- --></span> _id: <span class="token number">10</span>, category: <span class="token string">"C"</span>, value: <span class="token number">50</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7806134e2fd64d6daa39829e85b49f92.png"/>
    </p>
    <p>
     <strong>
      示例 1
     </strong>
     : 使用
     <code>
      $group
     </code>
     计算每个类别的总和，
     <strong>
      _id 用于指定分组字段
     </strong>
     。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>c_demo4<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">$group</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">"$category"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">totalValue</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">$sum</span><span class="token operator">:</span> <span class="token string">"$value"</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/be759b6340594b769e12f10ce44ded8c.png"/>
    </p>
    <p>
     <strong>
      示例 2
     </strong>
     : 使用
     <code>
      $match
     </code>
     过滤特定类别的文档。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>c_demo4<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">$match</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">category</span><span class="token operator">:</span> <span class="token string">"A"</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1c5b7e7879804b69bbc7099c62a395b8.png"/>
    </p>
    <p>
     <strong>
      示例 3
     </strong>
     : 使用
     <code>
      $sort
     </code>
     对文档排序。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>c_demo4<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">$sort</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7947ff06370b4d5bb42554a735528a14.png"/>
    </p>
    <p>
     <strong>
      示例 4
     </strong>
     : 使用
     <code>
      $project
     </code>
     修改文档结构。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>c_demo4<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">$project</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token literal-property property">category</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ba436f5c272445a8b87caa12ec51c613.png"/>
    </p>
    <p>
     <strong>
      示例 5
     </strong>
     : 使用
     <code>
      $skip
     </code>
     和
     <code>
      $limit
     </code>
     分页查询。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>c_demo4<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">$skip</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">$limit</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/41877a85a3b749908aa4fc47906fbe64.png"/>
    </p>
    <p>
     <strong>
      示例 6
     </strong>
     : 使用
     <code>
      $avg
     </code>
     计算平均值，_id 为 null 表示不分组，即把整个集合视为一个单一的组。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>c_demo4<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">$group</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token literal-property property">averageValue</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">$avg</span><span class="token operator">:</span> <span class="token string">"$value"</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c8e4bc4a4e50485fb9aa17ad44f2494a.png"/>
    </p>
    <p>
     <strong>
      示例 7
     </strong>
     : 使用
     <code>
      $min
     </code>
     和
     <code>
      $max
     </code>
     找出最小值和最大值。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>c_demo4<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">$group</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token literal-property property">minValue</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">$min</span><span class="token operator">:</span> <span class="token string">"$value"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">maxValue</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">$max</span><span class="token operator">:</span> <span class="token string">"$value"</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d3a597f0d956496395963c955f07240f.png"/>
    </p>
    <p>
     <strong>
      示例 8
     </strong>
     : 使用
     <code>
      $push
     </code>
     收集数组中的元素。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>c_demo4<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">$group</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">"$category"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">values</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">$push</span><span class="token operator">:</span> <span class="token string">"$value"</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/5572d2abfeae4ffc9fde7e645b02570c.png"/>
    </p>
    <p>
     <strong>
      示例 9
     </strong>
     : 使用
     <code>
      $first
     </code>
     和
     <code>
      $last
     </code>
     返回数组中的第一个和最后一个元素。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>c_demo4<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">$group</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">"$category"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">firstValue</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">$first</span><span class="token operator">:</span> <span class="token string">"$value"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">lastValue</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">$last</span><span class="token operator">:</span> <span class="token string">"$value"</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/6e759a16264041ecb47194bca245aa3e.png"/>
    </p>
    <h4>
     <a id="63_MapReduce_641">
     </a>
     6.3 Map-Reduce操作
    </h4>
    <p>
     MongoDB使用Map-Reduce来处理复杂的数据分析任务。
    </p>
    <h5>
     <a id="631_MongoDBMapReduce_644">
     </a>
     6.3.1 MongoDB中Map-Reduce操作介绍
    </h5>
    <p>
     Map-Reduce在MongoDB中是一种用于处理和聚合数据的强大工具，尤其适用于需要对大量数据进行复杂分析的场景。下面是对MongoDB中Map-Reduce操作语法的介绍。
    </p>
    <p>
     <strong>
      基本概念
     </strong>
     ：
    </p>
    <ol>
     <li>
      <strong>
       Map函数
      </strong>
      ：负责处理输入文档，并为每个输入文档调用一次
      <code>
       emit(key, value)
      </code>
      函数生成键值对。
     </li>
     <li>
      <strong>
       Reduce函数
      </strong>
      ：接收Map阶段输出的一个键和该键对应的值列表，并将这些值归约为一个单一的输出值。
     </li>
     <li>
      <strong>
       Finalize函数（可选）
      </strong>
      ：在所有Map和Reduce操作完成后，可以使用此函数对结果进行最后的修改或格式化。
     </li>
    </ol>
    <p>
     <strong>
      Map-Reduce操作语法结构如下
     </strong>
     ：
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">mapReduce</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">/* map function */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> values</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">/* reduce function */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">out</span><span class="token operator">:</span> <span class="token comment">/* 输出选项 */</span><span class="token punctuation">,</span>
        <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token comment">/* 可选：过滤条件 */</span><span class="token punctuation">,</span>
        <span class="token literal-property property">sort</span><span class="token operator">:</span> <span class="token comment">/* 可选：排序 */</span><span class="token punctuation">,</span>
        <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token comment">/* 可选：限制返回的文档数 */</span><span class="token punctuation">,</span>
        <span class="token literal-property property">finalize</span><span class="token operator">:</span> <span class="token comment">/* 可选：finalize函数 */</span><span class="token punctuation">,</span>
        <span class="token literal-property property">scope</span><span class="token operator">:</span> <span class="token comment">/* 可选：定义全局变量 */</span><span class="token punctuation">,</span>
        <span class="token literal-property property">jsMode</span><span class="token operator">:</span> <span class="token comment">/* 可选：优化内存使用 */</span><span class="token punctuation">,</span>
        <span class="token literal-property property">verbose</span><span class="token operator">:</span> <span class="token comment">/* 可选：是否输出详细信息 */</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      参数说明
     </strong>
     ：
    </p>
    <ul>
     <li>
      <strong>
       map
      </strong>
      ：必需，指定Map函数。这个函数会遍历每个文档，并调用
      <code>
       emit(key, value)
      </code>
      产生键值对。
     </li>
     <li>
      <strong>
       reduce
      </strong>
      ：必需，指定Reduce函数。这个函数接收Map阶段产生的键和对应的值数组，并将其归约为单个值。
     </li>
     <li>
      <strong>
       out
      </strong>
      ：必需，指定Map-Reduce操作的结果如何输出。可以是：
      <ul>
       <li>
        <code>
         {inline: 1}
        </code>
        ：结果直接返回，适用于小数据集。
       </li>
       <li>
        <code>
         "collectionName"
        </code>
        ：结果存储在一个指定的集合中。
       </li>
       <li>
        <code>
         {"replace": "collectionName"}
        </code>
        、
        <code>
         {"merge": "collectionName"}
        </code>
        、
        <code>
         {"reduce": "collectionName"}
        </code>
        ：分别表示替换、合并、减少到指定集合。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       query
      </strong>
      ：可选，用于筛选输入文档的条件。
     </li>
     <li>
      <strong>
       sort
      </strong>
      ：可选，用于对输入文档进行排序。
     </li>
     <li>
      <strong>
       limit
      </strong>
      ：可选，限制传递给Map函数的文档数量。
     </li>
     <li>
      <strong>
       finalize
      </strong>
      ：可选，最终处理函数，在所有Map和Reduce操作完成后应用。
     </li>
     <li>
      <strong>
       scope
      </strong>
      ：可选，可以在JavaScript函数中使用的全局变量。
     </li>
     <li>
      <strong>
       jsMode
      </strong>
      ：可选，通过尽量减少BSON和JS之间的转换来提高性能。
     </li>
     <li>
      <strong>
       verbose
      </strong>
      ：可选，设置为true时，提供详细的执行统计信息。
     </li>
    </ul>
    <p>
     <strong>
      注意事项
     </strong>
     ：
    </p>
    <ul>
     <li>
      Map和Reduce函数必须是纯函数，即相同的输入总是产生相同的输出。
     </li>
     <li>
      Reduce函数的输出格式应该与Map函数的
      <code>
       emit
      </code>
      格式兼容，以便于可能的多次归约。
     </li>
     <li>
      对于较大的数据集，考虑使用Aggregation Pipeline作为替代方案，因为它通常更高效且易于使用。
     </li>
    </ul>
    <h5>
     <a id="632_MapReduce_694">
     </a>
     6.3.2 Map-Reduce操作示例
    </h5>
    <p>
     在当前数据库中给集合
     <code>
      orders
     </code>
     插入多个文档，用于演示Map-Reduce操作。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>orders<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"_id"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string-property property">"customer"</span> <span class="token operator">:</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string-property property">"amount"</span> <span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"_id"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string-property property">"customer"</span> <span class="token operator">:</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string-property property">"amount"</span> <span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"_id"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string-property property">"customer"</span> <span class="token operator">:</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string-property property">"amount"</span> <span class="token operator">:</span> <span class="token number">75</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"_id"</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string-property property">"customer"</span> <span class="token operator">:</span> <span class="token string">"Charlie"</span><span class="token punctuation">,</span> <span class="token string-property property">"amount"</span> <span class="token operator">:</span> <span class="token number">150</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"_id"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string-property property">"customer"</span> <span class="token operator">:</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string-property property">"amount"</span> <span class="token operator">:</span> <span class="token number">200</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/43fdb41d73804738b7ac801173085fde.png"/>
    </p>
    <p>
     <strong>
      示例
     </strong>
     ：
    </p>
    <p>
     <strong>
      定义Map函数
     </strong>
     ：这个函数会遍历每个文档，并为每个客户发出一个键值对，其中键是客户名，值是订单金额。
     <br/>
     <strong>
      定义Reduce函数
     </strong>
     ：这个函数接收Map阶段输出的键和对应的值列表，并计算总和。
     <br/>
     <strong>
      执行Map-Reduce
     </strong>
     ：使用上面定义的Map和Reduce函数执行Map-Reduce操作，并将结果存储在一个新的集合
     <code>
      order_totals
     </code>
     中。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>orders<span class="token punctuation">.</span><span class="token function">mapReduce</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token function">emit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>customer<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> values</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">out</span><span class="token operator">:</span> <span class="token string">"order_totals"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e159822fcf9f4ab7b3672fe8843a36c9.png"/>
    </p>
    <p>
     <strong>
      查看结果
     </strong>
     ：执行完上述操作后，可以通过查询新集合
     <code>
      order_totals
     </code>
     来查看每个客户的订单总额。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>order_totals<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/86c840c3526040349267cadb4649abb9.png"/>
    </p>
    <hr/>
    <h2>
     <a id="_741">
     </a>
     五、索引操作
    </h2>
    <h3>
     <a id="1_MongoDB_743">
     </a>
     1. MongoDB索引介绍
    </h3>
    <p>
     MongoDB中的索引是为了提高查询性能而设计的数据结构。通过为集合中的一个或多个字段创建索引，可以显著加快查询速度。然而，值得注意的是，虽然索引加速了读取操作，但它们也增加了写入操作（如插入和更新）的成本，并占用额外的存储空间。
    </p>
    <h3>
     <a id="2_MongoDB_747">
     </a>
     2. MongoDB索引类型
    </h3>
    <p>
     MongoDB支持多种类型的索引，以满足不同的需求：
    </p>
    <ul>
     <li>
      <strong>
       单字段索引
      </strong>
      ：在单个字段上创建的索引。
     </li>
     <li>
      <strong>
       复合索引
      </strong>
      ：包含多个字段的索引。
     </li>
     <li>
      <strong>
       多键索引
      </strong>
      ：用于数组字段上的索引。
     </li>
     <li>
      <strong>
       文本索引
      </strong>
      ：支持对字符串内容进行全文搜索。
     </li>
     <li>
      <strong>
       地理空间索引
      </strong>
      ：包括
      <code>
       2dsphere
      </code>
      和
      <code>
       2d
      </code>
      索引，支持基于地理位置的数据查询。
     </li>
     <li>
      <strong>
       哈希索引
      </strong>
      ：主要用于支持分片键的哈希分片。
     </li>
    </ul>
    <h3>
     <a id="3__758">
     </a>
     3. 创建索引
    </h3>
    <p>
     创建索引语法如下：
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span> keys<span class="token punctuation">,</span> options <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      <code>
       keys
      </code>
      ：指定要索引的一个或多个字段以及每个字段的索引类型（1表示升序，-1表示降序）。对于复合索引，你可以传递一个包含多个键值对的对象。
     </li>
     <li>
      <code>
       options
      </code>
      ：（可选）一个文档，用于指定索引的行为和属性，如唯一性、背景构建等。
     </li>
    </ul>
    <p>
     <strong>
      创建示例数据
     </strong>
     ：下面以一个名为
     <code>
      students
     </code>
     的集合为例，演示如何创建索引。首先，创建一些示例数据：
    </p>
    <pre><code class="prism language-javascript">use db_school<span class="token punctuation">;</span>

db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token literal-property property">scores</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token string">"Beijing"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token literal-property property">scores</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token string">"Shanghai"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"Charlie"</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token literal-property property">scores</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token string">"Guangzhou"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f267d5509ce041899893a39dfae280ab.png"/>
    </p>
    <p>
     <strong>
      示例1
     </strong>
     ：为
     <code>
      name
     </code>
     字段创建一个升序索引。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/40744eac244f40569578ca6bc41ca3e4.png"/>
    </p>
    <ul>
     <li>
      <p>
       <strong>
        “numIndexesBefore”: 1
       </strong>
       ：这表示在创建新索引之前，集合中已经存在的索引数量。由于MongoDB默认会在
       <code>
        _id
       </code>
       字段上自动创建一个索引，所以这里显示的是1。
      </p>
     </li>
     <li>
      <p>
       <strong>
        “numIndexesAfter”: 2
       </strong>
       ：这表明在成功创建新索引之后，集合中现在总共有的索引数量。因为刚刚为
       <code>
        name
       </code>
       字段创建了一个新的升序索引，所以索引总数从1增加到了2。
      </p>
     </li>
     <li>
      <p>
       <strong>
        “createdCollectionAutomatically”: false
       </strong>
       ：这个字段指示是否因为创建索引而自动创建了集合。在这个例子中，值为
       <code>
        false
       </code>
       ，意味着集合
       <code>
        students
       </code>
       在执行此操作之前已经存在，并非因创建索引而自动创建的。
      </p>
     </li>
     <li>
      <p>
       <strong>
        “ok”: 1
       </strong>
       ：这是一个状态标识符，表明操作成功完成。如果出现错误，这个字段的值会是
       <code>
        0
       </code>
       ，并且通常会有额外的错误信息来描述问题所在。
      </p>
     </li>
    </ul>
    <p>
     <strong>
      示例2
     </strong>
     ：在
     <code>
      age
     </code>
     和
     <code>
      scores
     </code>
     字段上创建一个复合索引。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">scores</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7a3fb9cf6f424b0eb63292ab6eafe78d.png"/>
    </p>
    <h3>
     <a id="4__810">
     </a>
     4. 查看索引
    </h3>
    <p>
     查看索引语法如下：
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">getIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      示例
     </strong>
     ：查看
     <code>
      students
     </code>
     集合中已经存在的索引。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">getIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/5a471d3100cc41e09da66004965501e5.png"/>
    </p>
    <h3>
     <a id="5__825">
     </a>
     5. 删除索引
    </h3>
    <h4>
     <a id="51__826">
     </a>
     5.1 删除单个索引
    </h4>
    <p>
     删除单个索引语法如下：
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">dropIndex</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>index<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">writeConcern</span><span class="token operator">:</span> <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      <code>
       &lt;index&gt;
      </code>
      ：可以是索引的名称（字符串类型），也可以是索引的键模式（文档类型）。索引名通常是 MongoDB 自动生成的，例如 { field1: 1, field2: -1 } 索引的默认名称可能是 field1_1_field2_-1。
     </li>
     <li>
      <code>
       writeConcern
      </code>
      ：可选参数，指定写入操作的确认级别，用于控制写入操作在复制集成员中的传播和确认方式。
     </li>
    </ul>
    <p>
     <strong>
      示例1
     </strong>
     ：删除名为
     <code>
      name_1
     </code>
     的索引。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">dropIndex</span><span class="token punctuation">(</span><span class="token string">"name_1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8c561bba9d0e4cc7a3c777091f9bcf1f.png"/>
    </p>
    <ul>
     <li>
      <strong>
       “nIndexesWas”: 3
      </strong>
      ：这表示在执行删除操作之前，集合中总共有3个索引。
     </li>
     <li>
      <strong>
       “ok”: 1
      </strong>
      ：这是一个状态标识符，表明操作成功完成。
     </li>
    </ul>
    <p>
     <strong>
      示例2
     </strong>
     ：删除为
     <code>
      age
     </code>
     和
     <code>
      scores
     </code>
     字段创建的复合索引。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">dropIndex</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">scores</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ac77f4e471d043f8816c86244b460aeb.png"/>
    </p>
    <h4>
     <a id="52__860">
     </a>
     5.2 删除多个索引
    </h4>
    <p>
     删除多个索引语法如下：
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">dropIndexes</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>indexes<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">writeConcern</span><span class="token operator">:</span> <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      示例1
     </strong>
     ：删除除
     <code>
      _id
     </code>
     索引之外的所有索引。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">dropIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     或
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">dropIndexes</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      示例2
     </strong>
     ：
     <br/>
     分别为
     <code>
      name
     </code>
     和
     <code>
      age
     </code>
     字段创建升序索引。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     根据索引名称删除
     <code>
      name
     </code>
     和
     <code>
      age
     </code>
     字段的升序索引。
    </p>
    <pre><code class="prism language-javascript">db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">dropIndexes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"age_1"</span><span class="token punctuation">,</span> <span class="token string">"name_1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ac7273458dfc4703876015a96a89a35b.png"/>
    </p>
    <hr/>
    <h2>
     <a id="_894">
     </a>
     六、用户和权限管理
    </h2>
    <h3>
     <a id="1__895">
     </a>
     1. 内置角色及相关权限
    </h3>
    <p>
     MongoDB内置了多种角色，用于提供不同层次和类型的权限管理。
    </p>
    <p>
     以下概述了一些常用的内置角色及其描述：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        角色名称
       </th>
       <th>
        描述
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         read
        </strong>
       </td>
       <td>
        允许用户读取指定数据库中的所有非系统集合的数据。
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         readWrite
        </strong>
       </td>
       <td>
        包括
        <code>
         read
        </code>
        角色的所有权限，并允许在所有非系统集合上进行插入、更新和删除操作。
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         dbAdmin
        </strong>
       </td>
       <td>
        提供执行管理任务的能力，如模式管理（索引创建和删除）、统计信息收集等，但不包括用户和角色管理。
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         userAdmin
        </strong>
       </td>
       <td>
        允许管理当前数据库的用户和角色，包括创建用户、修改密码以及分配角色。拥有此角色的用户可以赋予自己任何权限。
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         clusterAdmin
        </strong>
       </td>
       <td>
        提供最高的集群管理操作权限，包括添加和移除节点、查看集群状态等。它包含其他集群管理角色，如
        <code>
         clusterManager
        </code>
        、
        <code>
         clusterMonitor
        </code>
        和
        <code>
         hostManager
        </code>
        。
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         readAnyDatabase
        </strong>
       </td>
       <td>
        类似于
        <code>
         read
        </code>
        角色，但是作用范围扩展到了所有的数据库（除了
        <code>
         local
        </code>
        和
        <code>
         config
        </code>
        ）。需要在
        <code>
         admin
        </code>
        数据库中授予。
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         readWriteAnyDatabase
        </strong>
       </td>
       <td>
        类似于
        <code>
         readWrite
        </code>
        角色，但是作用范围扩展到了所有的数据库（除了
        <code>
         local
        </code>
        和
        <code>
         config
        </code>
        ）。需要在
        <code>
         admin
        </code>
        数据库中授予。
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         userAdminAnyDatabase
        </strong>
       </td>
       <td>
        类似于
        <code>
         userAdmin
        </code>
        角色，但是作用范围扩展到了所有的数据库。允许管理所有数据库中的用户和角色。需要在
        <code>
         admin
        </code>
        数据库中授予。
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         dbAdminAnyDatabase
        </strong>
       </td>
       <td>
        类似于
        <code>
         dbAdmin
        </code>
        角色，但是作用范围扩展到了所有的数据库。需要在
        <code>
         admin
        </code>
        数据库中授予。
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         root
        </strong>
       </td>
       <td>
        超级用户角色，拥有对整个系统的完全控制权，包括对所有资源的访问权限。仅适用于
        <code>
         admin
        </code>
        数据库。
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="2__913">
     </a>
     2. 创建用户
    </h3>
    <p>
     创建用户语法如下：
    </p>
    <pre><code class="prism language-shell">db.createUser<span class="token punctuation">(</span>
    <span class="token punctuation">{<!-- --></span>
        user: <span class="token string">"&lt;username&gt;"</span>,
        pwd:  <span class="token string">"&lt;password&gt;"</span>,
        customData: <span class="token punctuation">{<!-- --></span> <span class="token operator">&lt;</span>any information<span class="token operator">&gt;</span> <span class="token punctuation">}</span>,
        roles: <span class="token punctuation">[</span>
           <span class="token punctuation">{<!-- --></span> role: <span class="token string">"&lt;role&gt;"</span>, db: <span class="token string">"&lt;database&gt;"</span> <span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token string">"&lt;role&gt;"</span>,
           <span class="token punctuation">..</span>.
        <span class="token punctuation">]</span>,
        mechanisms: <span class="token punctuation">[</span> <span class="token string">"&lt;SCRAM-SHA-1&gt;"</span> <span class="token operator">|</span> <span class="token string">"&lt;SCRAM-SHA-256&gt;"</span>, <span class="token punctuation">..</span>. <span class="token punctuation">]</span>,
        passwordDigestor: <span class="token string">"&lt;server|client&gt;"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <code>
       user
      </code>
      ：指定要创建的用户名，是一个字符串类型。
     </li>
     <li>
      <code>
       pwd
      </code>
      ：指定用户的密码，可以是字符串或 PasswordPrompt() 函数（用于交互式输入密码）。
     </li>
     <li>
      <code>
       customData
      </code>
      ：可选参数，用于存储与用户相关的自定义数据，是一个文档对象。
     </li>
     <li>
      <code>
       roles
      </code>
      ：指定用户被授予的角色，可以是一个角色数组。每个角色可以是一个文档对象 { role: “”, db: “” }，表示在指定数据库上的角色；也可以是一个简单的角色名称字符串。
     </li>
     <li>
      <code>
       mechanisms
      </code>
      ：可选参数，指定认证机制，如 “SCRAM-SHA-1” 或 “SCRAM-SHA-256”。
     </li>
     <li>
      <code>
       passwordDigestor
      </code>
      ：可选参数，指定密码摘要器，值可以是 “server” 或 “client”。
     </li>
    </ul>
    <p>
     <strong>
      示例1
     </strong>
     ：在单个数据库中创建用户。
     <br/>
     在
     <code>
      db_school
     </code>
     数据库中创建一个具有
     <code>
      readWrite
     </code>
     角色的用户
     <code>
      user_school
     </code>
     。
    </p>
    <pre><code class="prism language-shell">use db_school<span class="token punctuation">;</span>
db.createUser<span class="token punctuation">(</span>
    <span class="token punctuation">{<!-- --></span>
        user: <span class="token string">"user_school"</span>,
        pwd: <span class="token string">"123456"</span>,
        roles: <span class="token punctuation">[</span> <span class="token punctuation">{<!-- --></span> role: <span class="token string">"readWrite"</span>, db: <span class="token string">"db_school"</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ec23bd7c7cb143babe30927b041ce46a.png"/>
    </p>
    <p>
     <strong>
      示例2
     </strong>
     ：创建具有多个角色和跨数据库权限的用户。
     <br/>
     创建一个名为
     <code>
      user_admin
     </code>
     的用户，该用户在
     <code>
      db_school
     </code>
     数据库具有
     <code>
      readWrite
     </code>
     角色，在
     <code>
      admin
     </code>
     数据库具有
     <code>
      userAdminAnyDatabase
     </code>
     角色。
    </p>
    <pre><code class="prism language-shell">use admin<span class="token punctuation">;</span>
db.createUser<span class="token punctuation">(</span>
    <span class="token punctuation">{<!-- --></span>
        user: <span class="token string">"user_admin"</span>,
        pwd: <span class="token string">"123456"</span>,
        roles: <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span> role: <span class="token string">"readWrite"</span>, db: <span class="token string">"db_school"</span> <span class="token punctuation">}</span>,
            <span class="token punctuation">{<!-- --></span> role: <span class="token string">"userAdminAnyDatabase"</span>, db: <span class="token string">"admin"</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ff55db6afaeb4e95b57ca11c86570d8d.png"/>
    </p>
    <p>
     <strong>
      示例3
     </strong>
     ：使用自定义数据创建用户。
     <br/>
     为用户 customuser 添加了一个 contact 字段作为自定义数据，该用户对 testdb 数据库只有只读权限
     <br/>
     创建一个名为
     <code>
      customuser
     </code>
     的用户，并为用户
     <code>
      customuser
     </code>
     添加一个
     <code>
      contact
     </code>
     字段作为自定义数据，该用户对
     <code>
      testdb
     </code>
     数据库只有只读权限。
    </p>
    <pre><code class="prism language-shell">use testdb<span class="token punctuation">;</span>
db.createUser<span class="token punctuation">(</span>
    <span class="token punctuation">{<!-- --></span>
        user: <span class="token string">"customuser"</span>,
        pwd: <span class="token string">"123456"</span>,
        customData: <span class="token punctuation">{<!-- --></span> contact: <span class="token string">"customuser@example.com"</span> <span class="token punctuation">}</span>,
        roles: <span class="token punctuation">[</span> <span class="token punctuation">{<!-- --></span> role: <span class="token string">"read"</span>, db: <span class="token string">"testdb"</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d70660b1ef284a44bfcbc78bf27c1b14.png"/>
    </p>
    <h3>
     <a id="3__990">
     </a>
     3. 查看用户
    </h3>
    <p>
     <strong>
      查看单个用户信息语法如下：
     </strong>
    </p>
    <pre><code class="prism language-shell">db.getUser<span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>,
    <span class="token punctuation">{<!-- --></span>
        showCredentials: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>,
        showPrivileges: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>,
        showAuthenticationRestrictions: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <code>
       &lt;username&gt;
      </code>
      ：要查看信息的用户的名称，是一个字符串类型。
     </li>
     <li>
      <code>
       showCredentials
      </code>
      ：可选参数，布尔值。如果设置为 true，则会显示用户的认证凭证信息；默认值为 false。
     </li>
     <li>
      <code>
       showPrivileges
      </code>
      ：可选参数，布尔值。如果设置为 true，则会显示用户的权限信息；默认值为 false。
     </li>
     <li>
      <code>
       showAuthenticationRestrictions
      </code>
      ：可选参数，布尔值。如果设置为 true，则会显示用户的认证限制信息；默认值为 false。
     </li>
    </ul>
    <p>
     <strong>
      查看所有用户信息语法如下：
     </strong>
    </p>
    <pre><code class="prism language-shell">db.getUsers<span class="token punctuation">(</span>
    <span class="token punctuation">{<!-- --></span>
        showCredentials: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>,
        showPrivileges: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>,
        showAuthenticationRestrictions: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      示例1
     </strong>
     ：查看
     <code>
      db_school
     </code>
     数据库中名为
     <code>
      user_school
     </code>
     的用户信息。
    </p>
    <pre><code class="prism language-shell">use db_school<span class="token punctuation">;</span>
db.getUser<span class="token punctuation">(</span><span class="token string">"user_school"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/debe0e3c9a304c30b2011ba6a0df634d.png"/>
    </p>
    <p>
     <strong>
      示例2
     </strong>
     ：查看
     <code>
      db_school
     </code>
     数据库中用户名为
     <code>
      user_school
     </code>
     的认证凭证信息和权限信息。
    </p>
    <pre><code class="prism language-shell">use db_school<span class="token punctuation">;</span>
db.getUser<span class="token punctuation">(</span><span class="token string">"user_school"</span>, <span class="token punctuation">{<!-- --></span> showCredentials: true, showPrivileges: <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      示例3
     </strong>
     ：查看
     <code>
      admin
     </code>
     数据库中的所有用户信息。
    </p>
    <pre><code class="prism language-shell">use admin<span class="token punctuation">;</span>
db.getUsers<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     或
    </p>
    <pre><code class="prism language-shell">use admin<span class="token punctuation">;</span>
show <span class="token function">users</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/fe48e2d7eaa74729b1f0015b19429fc3.png"/>
    </p>
    <h3>
     <a id="4__1049">
     </a>
     4. 修改用户
    </h3>
    <h4>
     <a id="41__1050">
     </a>
     4.1 修改用户信息
    </h4>
    <p>
     修改用户信息语法如下：
    </p>
    <pre><code class="prism language-shell">db.updateUser<span class="token punctuation">(</span>
    <span class="token string">"&lt;username&gt;"</span>,
    <span class="token punctuation">{<!-- --></span>
        customData: <span class="token punctuation">{<!-- --></span> <span class="token operator">&lt;</span>new_custom_data<span class="token operator">&gt;</span> <span class="token punctuation">}</span>,
        roles: <span class="token punctuation">[</span> <span class="token punctuation">{<!-- --></span> role: <span class="token string">"&lt;role&gt;"</span>, db: <span class="token string">"&lt;database&gt;"</span> <span class="token punctuation">}</span>, <span class="token punctuation">..</span>. <span class="token punctuation">]</span>, // 可选，用于同时更新角色
        pwd: <span class="token string">"&lt;new_password&gt;"</span> // 可选，用于同时更新密码
    <span class="token punctuation">}</span>,
    <span class="token punctuation">{<!-- --></span>
        writeConcern: <span class="token punctuation">{<!-- --></span> <span class="token operator">&lt;</span>write_concern_options<span class="token operator">&gt;</span> <span class="token punctuation">}</span> // 可选，写入关注选项
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <code>
       &lt;username&gt;
      </code>
      ：要修改自定义数据的用户的名称，是一个字符串类型。
     </li>
     <li>
      <code>
       customData: { &lt;newCustomData&gt; }
      </code>
      ：新的自定义数据，是一个文档对象。
     </li>
     <li>
      <code>
       roles
      </code>
      ：可选参数，用于更新用户的角色列表。
     </li>
     <li>
      <code>
       pwd
      </code>
      ：可选参数，用于同时更新用户的密码。
     </li>
     <li>
      <code>
       writeConcern
      </code>
      ：可选参数，指定写入操作的确认级别。
     </li>
    </ul>
    <p>
     <strong>
      示例
     </strong>
     ：将
     <code>
      testdb
     </code>
     数据库中
     <code>
      customuser
     </code>
     用户的自定义数据修改为 { contact: “newcontact@example.com” }。
    </p>
    <pre><code class="prism language-shell">use testdb<span class="token punctuation">;</span>
db.updateUser<span class="token punctuation">(</span>
    <span class="token string">"customuser"</span>,
    <span class="token punctuation">{<!-- --></span>
        customData: <span class="token punctuation">{<!-- --></span> contact: <span class="token string">"newcontact@example.com"</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="42__1083">
     </a>
     4.2 修改用户密码
    </h4>
    <p>
     修改用户密码语法如下：
    </p>
    <pre><code class="prism language-shell">db.changeUserPassword<span class="token punctuation">(</span><span class="token string">"&lt;username&gt;"</span>, <span class="token string">"&lt;new_password&gt;"</span><span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <code>
       username
      </code>
      ：要修改密码的用户的名称。
     </li>
     <li>
      <code>
       new_password
      </code>
      ：用户的新密码。
     </li>
    </ul>
    <p>
     <strong>
      示例
     </strong>
     ：将
     <code>
      testdb
     </code>
     数据库中用户
     <code>
      customuser
     </code>
     的密码修改为
     <code>
      newSecurePass
     </code>
     。
    </p>
    <pre><code class="prism language-shell">use testdb<span class="token punctuation">;</span>
db.changeUserPassword<span class="token punctuation">(</span><span class="token string">"customuser"</span>, <span class="token string">"newSecurePass"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="43__1097">
     </a>
     4.3 修改用户角色
    </h4>
    <h5>
     <a id="431__1098">
     </a>
     4.3.1 添加用户角色
    </h5>
    <p>
     <strong>
      添加角色语法如下：
     </strong>
    </p>
    <pre><code class="prism language-shell">db.grantRolesToUser<span class="token punctuation">(</span>
    <span class="token string">"&lt;username&gt;"</span>,
    <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span> role: <span class="token string">"&lt;role&gt;"</span>, db: <span class="token string">"&lt;database&gt;"</span> <span class="token punctuation">}</span>,
        <span class="token punctuation">..</span>.
    <span class="token punctuation">]</span>,
    <span class="token punctuation">{<!-- --></span>
        writeConcern: <span class="token punctuation">{<!-- --></span> <span class="token operator">&lt;</span>write_concern_options<span class="token operator">&gt;</span> <span class="token punctuation">}</span> // 可选，写入关注选项
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      示例
     </strong>
     ：为
     <code>
      testdb
     </code>
     数据库中的用户
     <code>
      customuser
     </code>
     添加
     <code>
      readWrite
     </code>
     角色。
    </p>
    <pre><code class="prism language-shell">use testdb<span class="token punctuation">;</span>
db.grantRolesToUser<span class="token punctuation">(</span>
    <span class="token string">"customuser"</span>,
    <span class="token punctuation">[</span> <span class="token punctuation">{<!-- --></span> role: <span class="token string">"readWrite"</span>, db: <span class="token string">"testdb"</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h5>
     <a id="432__1123">
     </a>
     4.3.2 撤销用户角色
    </h5>
    <p>
     <strong>
      撤销角色语法如下：
     </strong>
    </p>
    <pre><code class="prism language-shell">db.revokeRolesFromUser<span class="token punctuation">(</span>
    <span class="token string">"&lt;username&gt;"</span>,
    <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span> role: <span class="token string">"&lt;role&gt;"</span>, db: <span class="token string">"&lt;database&gt;"</span> <span class="token punctuation">}</span>,
        <span class="token punctuation">..</span>.
    <span class="token punctuation">]</span>,
    <span class="token punctuation">{<!-- --></span>
        writeConcern: <span class="token punctuation">{<!-- --></span> <span class="token operator">&lt;</span>write_concern_options<span class="token operator">&gt;</span> <span class="token punctuation">}</span> // 可选，写入关注选项
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      示例
     </strong>
     ：撤销
     <code>
      testdb
     </code>
     数据库中用户
     <code>
      customuser
     </code>
     的
     <code>
      readWrite
     </code>
     角色。
    </p>
    <pre><code class="prism language-shell">use testdb<span class="token punctuation">;</span>
db.revokeRolesFromUser<span class="token punctuation">(</span>
    <span class="token string">"customuser"</span>,
    <span class="token punctuation">[</span> <span class="token punctuation">{<!-- --></span> role: <span class="token string">"readWrite"</span>, db: <span class="token string">"testdb"</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="5__1146">
     </a>
     5. 删除用户
    </h3>
    <p>
     删除用户语法如下：
    </p>
    <pre><code class="prism language-shell">db.dropUser<span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>,
    <span class="token punctuation">{<!-- --></span>
        writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      示例
     </strong>
     ：删除数据库
     <code>
      testdb
     </code>
     中的
     <code>
      customuser
     </code>
     用户。
    </p>
    <pre><code class="prism language-shell">use testdb<span class="token punctuation">;</span>
db.dropUser<span class="token punctuation">(</span><span class="token string">"customuser"</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     执行结果如下图所示：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/addafaee75f74e9593d59ebc9b7b66ed.png"/>
    </p>
    <hr/>
    <h2>
     <a id="_1168">
     </a>
     七、帮助信息命令
    </h2>
    <h3>
     <a id="1__1169">
     </a>
     1. 查看命令帮助信息
    </h3>
    <p>
     <code>
      help
     </code>
     命令可以查看一些基本的命令列表。这包括集合操作、数据库操作等。
    </p>
    <pre><code class="prism language-shell"><span class="token builtin class-name">help</span>
</code></pre>
    <h3>
     <a id="2__1176">
     </a>
     2. 查看数据库帮助信息
    </h3>
    <p>
     <code>
      db.help()
     </code>
     命令会显示与数据库相关的命令列表。
    </p>
    <pre><code class="prism language-shell">db.help<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="3__1183">
     </a>
     3. 查看集合帮助信息
    </h3>
    <p>
     <code>
      db.collection.help()
     </code>
     命令会显示与集合相关的命令列表。
    </p>
    <pre><code class="prism language-shell">db.collection.help<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f7a6373323331323835323636352f:61727469636c652f64657461696c732f313436313233393739" class_="artid" style="display:none">
 </p>
</div>


