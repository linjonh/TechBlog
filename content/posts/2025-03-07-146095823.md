---
layout: post
title: "使用kolla-ansible单点部署openstack云平台"
date: 2025-03-07 15:38:37 +0800
description: "项目三：云基础架构平台部署【学习目标】【知识目标】1. 学习 OpenStack 的多种部署方式。2. 学习 Kolla-ansible 概念。3. 学习 Ansible 概念。【技能目标】1. 掌握 Kolla-ansible 部署模式搭建云平台的技能。2. 具备 OpenStack 云平台部署的能力。3. 掌握云平台扩容的方法。【素养目标】1. 激发创新思维与探索精神，促进科学态度的形成。2. 培育诚信为本的道德品质，树立忠诚可靠的行为准则。"
keywords: "使用kolla-ansible单点部署openstack云平台"
categories: ['私有云']
tags: ['自动化', 'Python', 'Pip', 'Openstack', 'Ansible', 'Ansible']
artid: "146095823"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146095823
    alt: "使用kolla-ansible单点部署openstack云平台"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146095823
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146095823
cover: https://bing.ee123.net/img/rand?artid=146095823
image: https://bing.ee123.net/img/rand?artid=146095823
img: https://bing.ee123.net/img/rand?artid=146095823
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     使用kolla-ansible单点部署openstack云平台
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <hr id="hr-toc" name="tableOfContents"/>
    <p>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     项目三：
     <strong>
      <span style="color:black">
       云基础架构平台部署
      </span>
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     【学习目标】
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     【知识目标】
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     1. 学习 OpenStack 的多种部署方式。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     2. 学习 Kolla-ansible 概念。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     3. 学习 Ansible 概念。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     【技能目标】
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     1. 掌握 Kolla-ansible 部署模式搭建云平台的技能。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     2. 具备 OpenStack 云平台部署的能力。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     3. 掌握云平台扩容的方法。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     【素养目标】
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     1. 激发创新思维与探索精神，促进科学态度的形成。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     2. 培育诚信为本的道德品质，树立忠诚可靠的行为准则。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     3. 塑造精益求精的工作态度，追求严谨细致的职业风范。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     【项目实施】
    </p>
    <h2 id="%E4%BB%BB%E5%8A%A1%203.1%20%E4%BA%91%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA" name="%E4%BB%BB%E5%8A%A1%203.1%20%E4%BA%91%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA" style="background-color:transparent; margin-left:0px; margin-right:0px; text-align:justify">
     任务 3.1 云基础环境构建
    </h2>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     在本项目实践中，编者将逐步演示如何利用 Kolla-Ansible 工具从零开始搭
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     建单节点 OpenStack 环境，为实际私有云平台建设提供实践参考。
    </p>
    <h3 id="3.1.1%20%E8%A7%84%E5%88%92%E8%8A%82%E7%82%B9" name="3.1.1%20%E8%A7%84%E5%88%92%E8%8A%82%E7%82%B9" style="margin-left:0px; margin-right:0px; text-align:justify">
     3.1.1 规划节点
    </h3>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     单节点部署 OpenStack 云平台，各节点主机名和 IP 地规划见表 3-1。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     表 3-1 各节点主机名和 IP 地址规划列表（单节点部署模式下）
    </p>
    <table border="1" cellspacing="0">
     <tbody>
      <tr>
       <td style="border-color:black; vertical-align:top; width:106.5pt">
        <p style="margin-left:0; margin-right:0; text-align:center">
         <strong>
          IP
         </strong>
        </p>
       </td>
       <td style="border-color:black; vertical-align:top; width:106.5pt">
        <p style="margin-left:0; margin-right:0; text-align:center">
         <strong>
          192.168.100.10
         </strong>
        </p>
       </td>
       <td style="border-color:black; vertical-align:top; width:106.55pt">
        <p style="margin-left:0; margin-right:0; text-align:center">
         <strong>
          192.168.143.129
         </strong>
        </p>
       </td>
       <td style="border-color:black; vertical-align:top; width:106.55pt">
        <p style="margin-left:0; margin-right:0; text-align:center">
         <strong>
          192.168.104.200
         </strong>
        </p>
       </td>
      </tr>
      <tr>
       <td style="border-color:black; vertical-align:top; width:106.5pt">
        <p style="margin-left:0; margin-right:0; text-align:center">
         <strong>
          网卡
         </strong>
        </p>
       </td>
       <td style="vertical-align:top; width:106.5pt">
        <p style="margin-left:0; margin-right:0; text-align:center">
         <strong>
          仅主机
         </strong>
        </p>
       </td>
       <td style="vertical-align:top; width:106.55pt">
        <p style="margin-left:0; margin-right:0; text-align:center">
         <strong>
          Nat
         </strong>
        </p>
       </td>
       <td style="vertical-align:top; width:106.55pt">
        <p style="margin-left:0; margin-right:0; text-align:center">
         <strong>
          桥接
         </strong>
        </p>
       </td>
      </tr>
      <tr>
       <td style="border-color:black; vertical-align:top; width:106.5pt">
        <p style="margin-left:0; margin-right:0; text-align:center">
         <strong>
          作用
         </strong>
        </p>
       </td>
       <td style="vertical-align:top; width:106.5pt">
        <p style="margin-left:0; margin-right:0; text-align:center">
         <strong>
          管理网络
         </strong>
        </p>
       </td>
       <td style="vertical-align:top; width:106.55pt">
        <p style="margin-left:0; margin-right:0; text-align:center">
         <strong>
          数据网络
         </strong>
        </p>
       </td>
       <td style="vertical-align:top; width:106.55pt">
        <p style="margin-left:0; margin-right:0; text-align:center">
         <strong>
          外部网络
         </strong>
        </p>
       </td>
      </tr>
     </tbody>
    </table>
    <p style="margin-left:0; margin-right:0; text-align:center">
    </p>
    <h3 id="3.1.2%20%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87" name="3.1.2%20%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87" style="margin-left:0px; margin-right:0px; text-align:left">
     <strong>
      <span style="color:black">
       3.1.2
      </span>
     </strong>
     <strong>
      <span style="color:black">
       环境准备
      </span>
     </strong>
    </h3>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     在物理机上申请一台安装 openEuler-22.09 操作系统的虚拟机作为 OpenStack all-in-one
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     节点，处理器处勾选“虚拟化 IntelVT-x/EPT 或 AMD-V/RVI(V)”。
     <strong>
      all-in-one
     </strong>
     <strong>
      节点类型为
     </strong>
     <strong>
     </strong>
     <strong>
      8
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <strong>
      vCPU
     </strong>
     <strong>
      、
     </strong>
     <strong>
      12 GB
     </strong>
     <strong>
      内存、
     </strong>
     <strong>
      100 GB
     </strong>
     <strong>
      系统硬盘
     </strong>
     。需要给虚拟机设置三个网络接口，网络接口 1 设置为
     <strong>
      外部网络
     </strong>
     ，其网卡
     <strong>
      使用
     </strong>
     <strong>
      NAT
     </strong>
     <strong>
      模式
     </strong>
     ，主要作为该节点的
     <strong>
      数据网络
     </strong>
     ，在集群部署完成后创建的云主机便使用的是网络接口 1 的网卡，网络接口 2 设置为
     <strong>
      内部网络
     </strong>
     ，其网卡使用
     <strong>
      仅主机模式
     </strong>
     ，作为
     <strong>
      该节点的通信和管理使用
     </strong>
     ；网络接口3 设置为
     <strong>
      外部网络，
     </strong>
     其网卡使用
     <strong>
      桥接模式，
     </strong>
     为本节点提供下包等等服务
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <img alt="" height="731" src="https://i-blog.csdnimg.cn/direct/118d84985c4e4a959a5747f5c6379f62.png" width="748"/>
    </p>
    <h3 id="3.1.3%20%E7%B3%BB%E7%BB%9F%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83%E8%AE%BE%E7%BD%AE" name="3.1.3%20%E7%B3%BB%E7%BB%9F%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83%E8%AE%BE%E7%BD%AE" style="margin-left:0px; margin-right:0px; text-align:left">
     <strong>
      <span style="color:black">
       3.1.3
      </span>
     </strong>
     <strong>
      <span style="color:black">
       系统基本环境设置
      </span>
     </strong>
    </h3>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <strong>
      <span style="color:black">
       1.
      </span>
     </strong>
     <strong>
      <span style="color:black">
       修改主机名
      </span>
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@localhost ~]# hostnamectl set-hostname controller
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@localhost ~]#  bash
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]#
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <strong>
      <span style="color:black">
       2.
      </span>
     </strong>
     <strong>
      <span style="color:black">
       更新系统软件包
      </span>
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     配置华为源
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     参考华为官方镜像网站：
     <a href="https://mirrors.huaweicloud.com/mirrorDetail/5ebe3408c8ac54047fe607f0?mirrorName=openeuler&amp;catalog=os" rel="nofollow" title="华为开源镜像站_软件开发服务_华为云">
      华为开源镜像站_软件开发服务_华为云
     </a>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       sed -i 's|http://repo.openeuler.org/| https://repo.huaweicloud.com/|g' /etc/yum.repos.d/openEuler.repo
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     all-in-one 节点更新系统软件包，以获得最新的功能支持。
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# dnf -y update &amp;&amp; dnf -y upgrade
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# reboot
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       3.
      </span>
      <span style="color:black">
       修改网卡地址
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      按照规划节点的
     </span>
     <span style="color:black">
      IP
     </span>
     <span style="color:black">
      规划，配置
     </span>
     <span style="color:black">
      all-in-one
     </span>
     <span style="color:black">
      节点的静态
     </span>
     <span style="color:black">
      IP
     </span>
     <span style="color:black">
      地址，修改以下示例配置中的
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      参数。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@localhost ~]# ip a
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     这里由于是做完写的文档，后续nat网卡会被neutron组件服务占用，所以这里没有ip，正常是有的
     <img alt="" height="399" src="https://i-blog.csdnimg.cn/direct/9656729f49194bc3a9bdcd003a9e0c1a.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@localhost ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens160
      </span>
     </span>
     <img alt="" height="528" src="https://i-blog.csdnimg.cn/direct/5b3f2550290147cebb9c3af32e400eb2.png" width="833"/>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@localhost ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens224
      </span>
     </span>
     <img alt="" height="224" src="https://i-blog.csdnimg.cn/direct/e7f9494a137e4b9197620a9f1a06bff6.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     [root@localhost ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens256
     <img alt="" height="316" src="https://i-blog.csdnimg.cn/direct/a47cbe32623842388754b219cdcf9d14.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      载入网卡配置并启动相应的网卡。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# nmcli c reload
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# nmcli c up ens160
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# nmcli c up ens224
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# nmcli c up ens256
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <h3 id="3.1.4%20%E5%AE%89%E8%A3%85%20Ansible%20%E5%92%8C%20Kolla-ansible" name="3.1.4%20%E5%AE%89%E8%A3%85%20Ansible%20%E5%92%8C%20Kolla-ansible" style="background-color:transparent; margin-left:0px; margin-right:0px; text-align:left">
     <strong>
      <span style="color:black">
       3.1.4
      </span>
     </strong>
     <strong>
      <span style="color:black">
       安装
      </span>
     </strong>
     <strong>
      <span style="color:black">
       Ansible
      </span>
     </strong>
     <strong>
      <span style="color:black">
       和
      </span>
     </strong>
     <strong>
      <span style="color:black">
       Kolla-ansible
      </span>
     </strong>
    </h3>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      为了可以使用
     </span>
     <span style="color:black">
      pip3
     </span>
     <span style="color:black">
      安装和管理
     </span>
     <span style="color:black">
      Python3
     </span>
     <span style="color:black">
      软件包，安装
     </span>
     <span style="color:black">
      pip3
     </span>
     <span style="color:black">
      。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# dnf -y install python3-pip
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      使用镜像源来加速
     </span>
     <span style="color:black">
      pip
     </span>
     <span style="color:black">
      安装包的下载速度。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# mkdir .pip
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# cat &lt;&lt; EFO &gt; .pip/pip.conf
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [global]
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       index-url = https://pypi.tuna.tsinghua.edu.cn/simple
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [install]
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       trusted-host=pypi.tuna.tsinghua.edu.cn
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       EFO
      </span>
     </span>
     <img alt="" height="172" src="https://i-blog.csdnimg.cn/direct/f85a62b65e83430a84c07e673ef129b3.png" width="764"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      更新
     </span>
     <span style="color:black">
      Python3
     </span>
     <span style="color:black">
      中的
     </span>
     <span style="color:black">
      pip
     </span>
     <span style="color:black">
      工具到最新版本，保证
     </span>
     <span style="color:black">
      pip
     </span>
     <span style="color:black">
      工具的可用性和安全性。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]#  pip3 install --ignore-installed --upgrade pip
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      使用以下命令安装
     </span>
     <span style="color:black">
      Ansible
     </span>
     <span style="color:black">
      ，并查看所安装的版本号。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]#  pip3 install -U 'ansible&gt;=4,&lt;6'
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]#  ansible --version
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     Ansible的版本会直接影响后续安装kolla-ansible的版本
     <img alt="" height="186" src="https://i-blog.csdnimg.cn/direct/9f77706bdf4b452d85aeca316d2bbc19.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      安装
     </span>
     <span style="color:black">
      Kolla-ansible
     </span>
     <span style="color:black">
      和
     </span>
     <span style="color:black">
      Kolla-ansible
     </span>
     <span style="color:black">
      环境必需的依赖项。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# dnf -y install git python3-devel libffi-devel gcc openssl-devel python3-libselinux
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# dnf -y install openstack-kolla-ansible
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# kolla-ansible --version
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       14.2.0
      </span>
     </span>
     <img alt="" height="81" src="https://i-blog.csdnimg.cn/direct/243f653ef0a8480084253c6aa8088b19.png" width="663"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      创建
     </span>
     <span style="color:black">
      Kolla-ansible
     </span>
     <span style="color:black">
      配置文件目录。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# mkdir -p /etc/kolla/{globals.d,config}
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     kolla目录所有者和所属组均设置为root用户
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# chown $USER:$USER /etc/kolla
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      将
     </span>
     <span style="color:black">
      inventory
     </span>
     <span style="color:black">
      文件复制到
     </span>
     <span style="color:black">
      /etc/ansible
     </span>
     <span style="color:black">
      目录。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# mkdir /etc/ansible
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# cp /usr/share/kolla-ansible/ansible/inventory/* /etc/ansible
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      随着
     </span>
     <span style="color:black">
      Kolla-ansible
     </span>
     <span style="color:black">
      版本的更迭，
     </span>
     <span style="color:black">
      Yoga
     </span>
     <span style="color:black">
      版本已经被删除，这里
      <strong>
       直接使用master版本即可
      </strong>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      执行以下命令进行修改。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@localhost ~]# cd /usr/share/kolla-ansible
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@localhost kolla-ansible]# ls
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       ansible  requirements.yml  setup.cfg
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     此文件用于拉取ansible-collection-kolla仓库，以下载python依赖以及ansible依赖
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@localhost kolla-ansible]# vi requirements.yml
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@localhost kolla-ansible]# cat requirements.yml
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       ---
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       collections:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - name: https://opendev.org/openstack/ansible-collection-kolla
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       type: git
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:red">
       version: master
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     安装 Ansible Galaxy 的依赖项，
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# pip3 install cryptography==38.0.4
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# kolla-ansible install-deps
      </span>
     </span>
    </p>
    <h3 id="3.1.5%20Ansible%20%E8%BF%90%E8%A1%8C%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96" name="3.1.5%20Ansible%20%E8%BF%90%E8%A1%8C%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96" style="margin-left:0px; margin-right:0px; text-align:justify">
     3.1.5 Ansible 运行配置优化
    </h3>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      在使用
     </span>
     <span style="color:black">
      Kolla-ansible
     </span>
     <span style="color:black">
      部署
     </span>
     <span style="color:black">
      OpenStack
     </span>
     <span style="color:black">
      时，它会执行大量的命令和任务，因此对
     </span>
     <span style="color:black">
      Ansible
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      进行调优可以加快执行速度，具体的优化如下。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# cat /etc/ansible/ansible.cfg
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [defaults]
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       #SSH
      </span>
      <span style="color:black">
       服务关闭密钥检测
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       host_key_checking=False
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       #
      </span>
      <span style="color:black">
       如果不使用
      </span>
      <span style="color:black">
       sudo
      </span>
      <span style="color:black">
       ，建议开启
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       pipelining=True
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       #
      </span>
      <span style="color:black">
       执行任务的并发数
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       forks=100
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       timeout=800
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       #
      </span>
      <span style="color:black">
       禁用警告
      </span>
      <span style="color:black">
       #
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       devel_warning = False
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       deprecation_warnings=False
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       #
      </span>
      <span style="color:black">
       显示每个任务花费的时间
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       callback_whitelist = profile_tasks
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       25
      </span>
      <span style="color:black">
       #
      </span>
      <span style="color:black">
       记录
      </span>
      <span style="color:black">
       Ansible
      </span>
      <span style="color:black">
       的输出，相对路径表示
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       log_path= wxic_cloud.log
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       #
      </span>
      <span style="color:black">
       主机清单文件
      </span>
      <span style="color:black">
       ,
      </span>
      <span style="color:black">
       相对路径表示
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       inventory = yoga_all-in-one
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       #
      </span>
      <span style="color:black">
       命令执行环境，也可更改为
      </span>
      <span style="color:black">
       /bin/bash
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       executable = /bin/sh
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       remote_port = 22
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       remote_user = root
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       #
      </span>
      <span style="color:black">
       默认输出的详细程度
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       #
      </span>
      <span style="color:black">
       可选值
      </span>
      <span style="color:black">
       0
      </span>
      <span style="color:black">
       、
      </span>
      <span style="color:black">
       1
      </span>
      <span style="color:black">
       、
      </span>
      <span style="color:black">
       2
      </span>
      <span style="color:black">
       、
      </span>
      <span style="color:black">
       3
      </span>
      <span style="color:black">
       、
      </span>
      <span style="color:black">
       4
      </span>
      <span style="color:black">
       等
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       #
      </span>
      <span style="color:black">
       值越高输出越详细
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       verbosity = 0
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       show_custom_stats = True
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       interpreter_python = auto_legacy_silent
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [colors]
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       #
      </span>
      <span style="color:black">
       成功的任务绿色显示
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       ok = green
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       #
      </span>
      <span style="color:black">
       跳过的任务使用亮灰色显示
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       skip = bright gray
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       #
      </span>
      <span style="color:black">
       警告使用亮紫色显示
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       warn = bright purple
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [privilege_escalation]
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       become_user = root
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [galaxy]
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       display_progress = True
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      修改好以后，可以使用
     </span>
     <span style="color:black">
      ansible-config view
     </span>
     <span style="color:black">
      命令查看。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# ansible-config view
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [defaults]
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       #SSH
      </span>
      <span style="color:black">
       服务关闭密钥检测
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       host_key_checking=False
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       … … …
      </span>
     </span>
     <img alt="" height="731" src="https://i-blog.csdnimg.cn/direct/e465d489b76e4dc7ba6c1091e9129ab4.png" width="713"/>
    </p>
    <h3 id="3.1.6%20Kolla-ansible%20%E7%8E%AF%E5%A2%83%E5%88%9D%E5%A7%8B%E9%85%8D%E7%BD%AE" name="3.1.6%20Kolla-ansible%20%E7%8E%AF%E5%A2%83%E5%88%9D%E5%A7%8B%E9%85%8D%E7%BD%AE" style="background-color:transparent; margin-left:0px; margin-right:0px; text-align:left">
     <strong>
      <span style="color:black">
       3.1.6 Kolla-ansible
      </span>
     </strong>
     <strong>
      <span style="color:black">
       环境初始配置
      </span>
     </strong>
    </h3>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      1.
     </span>
     <span style="color:black">
      修改主机清单文件
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      进入
     </span>
     <span style="color:black">
      /etc/ansible
     </span>
     <span style="color:black">
      目录，将提供的主机清单
     </span>
     <span style="color:black">
      all-in-one
     </span>
     <span style="color:black">
      文件过滤掉注释和空行，覆盖到
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      yoga_all-in-one
     </span>
     <span style="color:black">
      文件。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# cd /etc/ansible/
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ansible]# awk '!/^#/ &amp;&amp; !/^$/' all-in-one &gt; yoga_all-in-one
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      2.
     </span>
     <span style="color:black">
      检查主机清单文件是否配置正确
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      使用以下命令测试主机能否连通。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# ansible -m ping all
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       localhost | SUCCESS =&gt; {
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "ansible_facts": {
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "discovered_interpreter_python": "/usr/bin/python3.10"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       },
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "changed": false,
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "ping": "pong"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       }
      </span>
     </span>
     <img alt="" height="181" src="https://i-blog.csdnimg.cn/direct/3e58c00bb850495896bcf05ea297d008.png" width="864"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      3.
     </span>
     <span style="color:black">
      配置
     </span>
     <span style="color:black">
      OpenStack
     </span>
     <span style="color:black">
      各服务组件的密码
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      在使用
     </span>
     <span style="color:black">
      Kolla-ansible
     </span>
     <span style="color:black">
      部署
     </span>
     <span style="color:black">
      OpenStack Yoga
     </span>
     <span style="color:black">
      平台时 ，各个服务 组件的密码 存储在
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      /etc/kolla/passwords.yml
     </span>
     <span style="color:black">
      文件中，此文件默认所有的密码是空白的，必须手动或者通过运行
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      随机密码生成器来填写，在部署时建议使用随机密码生成器来生成各个服务的密码，命令
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      如下。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# kolla-genpwd
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      #
     </span>
     <span style="color:black">
      修改
     </span>
     <span style="color:black">
      Horizon
     </span>
     <span style="color:black">
      界面登录密码为
     </span>
     <span style="color:black">
      wxic@2024
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# sed -i 's/keystone_admin_password: .*/keystone_admin_password: wxic@2024/g' /etc/kolla/passwords.yml
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      #
     </span>
     <span style="color:black">
      验证修改结果
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# grep keystone_admin /etc/kolla/passwords.yml
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       keystone_admin_password: wxic@2024
      </span>
     </span>
     <img alt="" height="65" src="https://i-blog.csdnimg.cn/direct/74e93093ba024ddc9f9e251f91eb0cbf.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      4.
     </span>
     <span style="color:black">
      编辑
     </span>
     <span style="color:black">
      globals.yml
     </span>
     <span style="color:black">
      文件
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      本次部署
     </span>
     <span style="color:black">
      all-in-one
     </span>
     <span style="color:black">
      时只安装了
     </span>
     <span style="color:black">
      OpenStack
     </span>
     <span style="color:black">
      的核心组件，在
     </span>
     <span style="color:black">
      globals.yml
     </span>
     <span style="color:black">
      指定参数
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      enable_openstack_core: "yes"
     </span>
     <span style="color:black">
      ，安装
     </span>
     <span style="color:black">
      Glance
     </span>
     <span style="color:black">
      、
     </span>
     <span style="color:black">
      Keystone
     </span>
     <span style="color:black">
      、
     </span>
     <span style="color:black">
      Neutron
     </span>
     <span style="color:black">
      、
     </span>
     <span style="color:black">
      Nova
     </span>
     <span style="color:black">
      、
     </span>
     <span style="color:black">
      Heat
     </span>
     <span style="color:black">
      和
     </span>
     <span style="color:black">
      Horizon
     </span>
     <span style="color:black">
      服
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      务，其中要注意一个选项是
     </span>
     <span style="color:black">
      kolla_internal_vip_address
     </span>
     <span style="color:black">
      的地址，因为本次
     </span>
     <span style="color:black">
      Haproxy
     </span>
     <span style="color:black">
      和
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      keepalived
     </span>
     <span style="color:black">
      都未启用，故该地址为
     </span>
     <span style="color:black">
      ens224
     </span>
     <span style="color:black">
      网卡的地址（本次部署使用
     </span>
     <span style="color:black">
      192.168.100.10
     </span>
     <span style="color:black">
      ），部
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      署完成后使用该地址登录
     </span>
     <span style="color:black">
      Horizon
     </span>
     <span style="color:black">
      。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# cd /etc/kolla/
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]#/etc/kolla# cp globals.yml{,_bak}
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]#vi /etc/kolla/globals.yml
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       ---
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       docker_kernel_memory: 0
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       docker_registry: "quay.nju.edu.cn"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       kolla_base_distro: "ubuntu"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       kolla_install_type: "source"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       openstack_release: "yoga"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       kolla_internal_vip_address: "192.168.100.10"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       kolla_sysctl_conf_path: /etc/sysctl.conf
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       docker_client_timeout: 120
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       network_interface: "ens224"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       network_address_family: "ipv4"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       neutron_external_interface: "ens160"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       neutron_plugin_agent: "openvswitch"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       neutron_ipam_driver: "internal"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       openstack_region_name: "RegionWxic"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       openstack_logging_debug: "False"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       enable_openstack_core: "yes"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       glance_backend_file: "yes"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       nova_compute_virt_type: "kvm"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       nova_console: "novnc"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       enable_haproxy: "no"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       enable_keepalived: "no"
      </span>
     </span>
     <img alt="" height="573" src="https://i-blog.csdnimg.cn/direct/ffe873cb8de644af89794938d51e79b3.png" width="681"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      在
     </span>
     <span style="color:black">
      /etc/kolla/config/
     </span>
     <span style="color:black">
      目录自定义
     </span>
     <span style="color:black">
      Neutron
     </span>
     <span style="color:black">
      服务的一些配置，这将在部署集群时使用自定
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      义的配置覆盖掉默认的配置。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# cd /etc/kolla/config/
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller config]# mkdir neutron
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:blue">
       [root@controller config]# cat &lt;&lt; MXD &gt; neutron/dhcp_agent.ini
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [DEFAULT]
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       dnsmasq_dns_servers = 8.8.8.8,223.6.6.6,119.29.29.29
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       MXD
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:blue">
       [root@controller config]# cat &lt;&lt; MXD &gt; neutron/ml2_conf.ini
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [ml2]
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       tenant_network_types = flat,vxlan,vlan
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [ml2_type_vlan]
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       network_vlan_ranges = provider:10:1000
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [ml2_type_flat]
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       flat_networks = provider
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       MXD
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:blue">
       [root@controller config]# cat &lt;&lt; MXD &gt; neutron/openvswitch_agent.ini
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [securitygroup]
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       firewall_driver = openvswitch
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [ovs]
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       bridge_mappings = provider:br-ex
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       MXD
      </span>
     </span>
     <img alt="" height="492" src="https://i-blog.csdnimg.cn/direct/92f953b8c3804e1fbb8112006e6e3bec.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <h3 id="3.1.7%20%E9%83%A8%E7%BD%B2%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83" name="3.1.7%20%E9%83%A8%E7%BD%B2%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83" style="margin-left:0px; margin-right:0px; text-align:left">
     <strong>
      <span style="color:black">
       3.1.7
      </span>
     </strong>
     <strong>
      <span style="color:black">
       部署集群环境
      </span>
     </strong>
    </h3>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      在
     </span>
     <span style="color:black">
      all-in-one
     </span>
     <span style="color:black">
      节点安装
     </span>
     <span style="color:black">
      OpenStack CLI
     </span>
     <span style="color:black">
      客户端。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# dnf -y install python3-openstackclient
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      为了使部署的
     </span>
     <span style="color:black">
      all-in-one
     </span>
     <span style="color:black">
      节点网络路由正常工作，需要在
     </span>
     <span style="color:black">
      Linux
     </span>
     <span style="color:black">
      系统中启用
     </span>
     <span style="color:black">
      IP
     </span>
     <span style="color:black">
      转发功能，
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      修改所有节点的
     </span>
     <span style="color:black">
      /etc/sysctl.conf
     </span>
     <span style="color:black">
      文件，并配置在系统启动时自动加载
     </span>
     <span style="color:black">
      br_netfilter
     </span>
     <span style="color:black">
      模块，具体
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      操作如下。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      将这三项添加到/etc/sysctl.conf中，有则修改，无则添加
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       net.ipv4.ip_forward=1
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       net.bridge.bridge-nf-call-ip6tables=1
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       net.bridge.bridge-nf-call-iptables=1
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      #
     </span>
     <span style="color:black">
      临时加载模块，重启后失效
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# modprobe br_netfilter
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      #
     </span>
     <span style="color:black">
      重新加载配置
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# sysctl -p /etc/sysctl.conf
      </span>
     </span>
     <img alt="" height="631" src="https://i-blog.csdnimg.cn/direct/5311a56af05541f49d34e40fcda20b58.png" width="719"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      #
     </span>
     <span style="color:black">
      创建
     </span>
     <span style="color:black">
      yoga.service
     </span>
     <span style="color:black">
      文件，设置系统开机自动加载
     </span>
     <span style="color:black">
      br_netfilter
     </span>
     <span style="color:black">
      模块
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# cat &lt;&lt; MXD &gt; /usr/lib/systemd/system/yoga.service
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [Unit]
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       Description=Load br_netfilter and sysctl settings for OpenStack
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [Service]
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       Type=oneshot
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       RemainAfterExit=yes
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       ExecStart=/sbin/modprobe br_netfilter
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       ExecStart=/usr/sbin/sysctl -p
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [Install]
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       WantedBy=multi-user.target
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       MXD
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# systemctl enable --now yoga.service
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       Created symlink /etc/systemd/system/multi-user.target.wants/yoga.service →
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       /lib/systemd/system/yoga.service.
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      在
     </span>
     <span style="color:black">
      all-in-one
     </span>
     <span style="color:black">
      节点使用命令安装
     </span>
     <span style="color:black">
      OpenStack
     </span>
     <span style="color:black">
      集群所需要的基础依赖项和修改一些配置文
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      件，如安装
     </span>
     <span style="color:black">
      Docker
     </span>
     <span style="color:black">
      和修改 Hosts 文件等。
     </span>
     <img alt="" height="321" src="https://i-blog.csdnimg.cn/direct/a0a4c5d38daf4ee188236deb9eb1476c.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# kolla-ansible bootstrap-servers
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <img alt="" height="270" src="https://i-blog.csdnimg.cn/direct/ff86970674bb4c6fbcba193c364e9ee6.png" width="864"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      执行结果和用时（单节点部署模式下使用命令安装基础依赖项和配置文件）
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <strong>
      <em>
       解决执行命令报错，未安装docker
      </em>
     </strong>
     <strong>
      <em>
       的问题
      </em>
     </strong>
    </p>
    <ol>
     <li style="text-align:left">
      <strong>
       <em>
        思考为什仫会失败呢
       </em>
      </strong>
     </li>
    </ol>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <strong>
      <em>
       查看/etc/yum.repo
      </em>
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <strong>
       <em>
        <span style="color:black">
         [root@controller ~]# ls /etc/yum.repos.d/
        </span>
       </em>
      </strong>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <strong>
       <em>
        <span style="color:black">
         backup.repo  docker.repo
        </span>
       </em>
      </strong>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <strong>
      <em>
       发现已经配置了docker
      </em>
     </strong>
     <strong>
      <em>
       的源，尝试手动部署发现docker
      </em>
     </strong>
     <strong>
      <em>
       用不了
      </em>
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <strong>
      <em>
       猜测应该是kolla-ansible
      </em>
     </strong>
     <strong>
      <em>
       默认配置的docker
      </em>
     </strong>
     <strong>
      <em>
       不适配欧拉系统
      </em>
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      配置centos7 的docker源
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# vi $HOME/.ansible/collections/ansible_collections/openstack/kolla/roles/docker/tasks/repo-RedHat.yml
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       ---
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - name: Ensure yum repos directory exists
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       file:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       path: /etc/yum.repos.d/
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       state: directory
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       recurse: true
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       become: true
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - name: Enable docker yum repository
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       yum_repository:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       name: docker
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       description: Docker main Repository
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       baseurl: "
      </span>
      <span style="color:red">
       https://mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable
      </span>
      <span style="color:black">
       "
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       gpgcheck: "
      </span>
      <span style="color:red">
       true
      </span>
      <span style="color:black">
       "
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       gpgkey: "
      </span>
      <span style="color:red">
       https://mirrors.aliyun.com/docker-ce/linux/centos/gpg
      </span>
      <span style="color:black">
       "
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       # NOTE(yoctozepto): required to install containerd.io due to runc being a
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       # modular package in CentOS 8 see:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       # https://
      </span>
      <span style="color:blue">
       bugzilla.redhat.com/show_bug.cgi?id=1734081
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       module_hotfixes: true
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       become: true
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - name: Install docker rpm gpg key
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       rpm_key:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       state: present
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       key: "{
       <!-- -->
       { docker_yum_gpgkey }}"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       become: true
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       when: docker_yum_gpgcheck | bool
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       rm -rf /etc/yum.repos.d/docker.repo
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     再次尝试部署
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# kolla-ansible bootstrap-servers
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     查看docker信息
     <img alt="" height="717" src="https://i-blog.csdnimg.cn/direct/aa74732ee4f648f7a3fc8a171356d791.png" width="666"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      Docker
     </span>
     <span style="color:black">
      默认的镜像拉取地址在国外，在国内拉取镜像速度就比较慢，可以修改国内镜
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      像地址来加速镜像的拉取，编辑
     </span>
     <span style="color:black">
      all-in-one
     </span>
     <span style="color:black">
      节点
     </span>
     <span style="color:black">
      /etc/docker/daemon.json
     </span>
     <span style="color:black">
      文件，添加
     </span>
     <span style="color:black">
      registry-
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      mirrors
     </span>
     <span style="color:black">
      部分的内容，下面给出
     </span>
     <span style="color:black">
      all-in-one
     </span>
     <span style="color:black">
      节点修改的示例。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# cat /etc/docker/daemon.json
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       {
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "bridge": "none",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "default-ulimits": {
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "nofile": {
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "hard": 1048576,
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "name": "nofile",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "soft": 1048576
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       }
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       },
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "ip-forward": false,
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "iptables": false,
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "registry-mirrors": [
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://dockerhub.icu",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://docker.chenby.cn",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://docker.1panel.live",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://docker.awsl9527.cn",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://docker.anyhub.us.kg",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://dhub.kubesre.xyz",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://docker.registry.cyou",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://docker-cf.registry.cyou",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://dockercf.jsdelivr.fyi",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://docker.jsdelivr.fyi",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://dockertest.jsdelivr.fyi",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://mirror.aliyuncs.com",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://dockerproxy.com",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://mirror.baidubce.com",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://docker.m.daocloud.io",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://docker.nju.edu.cn",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://docker.mirrors.sjtug.sjtu.edu.cn",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://docker.mirrors.ustc.edu.cn",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://mirror.iscas.ac.cn",
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       "https://docker.rainbond.c"
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       ]
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       }
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# systemctl daemon-reload
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# systemctl restart docker
      </span>
     </span>
     <img alt="" height="176" src="https://i-blog.csdnimg.cn/direct/39e53455f4c44f1487d7a17d69079805.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      在
     </span>
     <span style="color:black">
      all-in-one
     </span>
     <span style="color:black">
      节点进行部署前检查，
     </span>
     <span style="color:black">
      openEuler22.09
     </span>
     <span style="color:black">
      系统执行过程中如果出现
     </span>
     <span style="color:black">
      "openEuler
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      release NA version 22.09 is not supported. Supported releases are: 20.03"
     </span>
     <span style="color:black">
      提示，不必理会继续接
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      下来的操作，不会影响后面的部署。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# kolla-ansible prechecks
      </span>
     </span>
     <img alt="" height="247" src="https://i-blog.csdnimg.cn/direct/9cdd3ac2ac1a44259b452e3c7efdfc51.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      在
     </span>
     <span style="color:black">
      all-in-one
     </span>
     <span style="color:black">
      节点使用以下命令下载
     </span>
     <span style="color:black">
      OpenStack
     </span>
     <span style="color:black">
      集群
     </span>
     <span style="color:black">
      all-in-one
     </span>
     <span style="color:black">
      节点所需要的全部镜像，
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      执行结果和用时如图
     </span>
     <span style="color:black">
      3-4
     </span>
     <span style="color:black">
      所示。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# docker pull 99cloud/skyline:latest
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# kolla-ansible pull
      </span>
     </span>
     <img alt="" height="315" src="https://i-blog.csdnimg.cn/direct/24d609f1010248b38848f61b6539dcec.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <img alt="" height="166" src="https://i-blog.csdnimg.cn/direct/23ce4936e62649c48e7e8e3ab8c03921.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      在
     </span>
     <span style="color:black">
      all-in-one
     </span>
     <span style="color:black">
      节点执行以下命令部署
     </span>
     <span style="color:black">
      OpenStack
     </span>
     <span style="color:black">
      集群，
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# kolla-ansible deploy
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="228" src="https://i-blog.csdnimg.cn/direct/ec04f17cc42e444bbe532c5f37de0cf7.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      执行结果和用时（单节点部署模式下部署
     </span>
     <span style="color:black">
      OpenStack
     </span>
     <span style="color:black">
      集群）
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      上述步骤完成后，
     </span>
     <span style="color:black">
      OpenStack
     </span>
     <span style="color:black">
      集群部署结束，所有的服务已经启动并正常运行，输入
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      globals.yml
     </span>
     <span style="color:black">
      文件中定义的
     </span>
     <span style="color:black">
      kolla_internal_vip_address
     </span>
     <span style="color:black">
      地址在浏览器登录
     </span>
     <span style="color:black">
      Horizon
     </span>
     <span style="color:black">
      界面，用户
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      名为
     </span>
     <span style="color:black">
      admin
     </span>
     <span style="color:black">
      ，密码为
     </span>
     <span style="color:black">
      passwords.yml
     </span>
     <span style="color:black">
      文件中
     </span>
     <span style="color:black">
      keystone_admin_password
     </span>
     <span style="color:black">
      的值
     </span>
     <span style="color:black">
      wxic@2024
     </span>
     <span style="color:black">
      ，单
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      节点部署模式下的 Horizon 登录和概览界面
     </span>
     <img alt="" height="476" src="https://i-blog.csdnimg.cn/direct/8b343ce750bb4802b054a1b8b47587e8.png" width="865"/>
     <img alt="" height="429" src="https://i-blog.csdnimg.cn/direct/a79b520fbba74453b87d949a50b2bcde.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      Horizon
     </span>
     <span style="color:black">
      概览界面（单节点部署模式）
     </span>
    </p>
    <h3 id="3.1.8%20OpenStackCLI%20%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BE%E7%BD%AE" name="3.1.8%20OpenStackCLI%20%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BE%E7%BD%AE" style="margin-left:0px; margin-right:0px; text-align:left">
     <strong>
      <span style="color:black">
       3.1.8 OpenStackCLI
      </span>
     </strong>
     <strong>
      <span style="color:black">
       客户端设置
      </span>
     </strong>
    </h3>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      OpenStack
     </span>
     <span style="color:black">
      集群部署完成 后，客户端执行命令则需要 生成
     </span>
     <span style="color:black">
      clouds.yaml
     </span>
     <span style="color:black">
      和
     </span>
     <span style="color:black">
      admin-
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      openrc.sh
     </span>
     <span style="color:black">
      文件，这些是管理员（
     </span>
     <span style="color:black">
      admin
     </span>
     <span style="color:black">
      ）用户的凭据，执行以下命令，执行结果和用时如
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      图
     </span>
     <span style="color:black">
      3-8
     </span>
     <span style="color:black">
      所示。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      3334
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# kolla-ansible post-deploy
      </span>
     </span>
     <img alt="" height="261" src="https://i-blog.csdnimg.cn/direct/dcb0da63192c4df59e8991cc2ea54494.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      执行以下命令，将生成的文件移动到
     </span>
     <span style="color:black">
      /etc/openstack
     </span>
     <span style="color:black">
      目录下，并在
     </span>
     <span style="color:black">
      /etc/profile.d/
     </span>
     <span style="color:black">
      目录编写
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      /openstack-yoga.sh
     </span>
     <span style="color:black">
      脚本。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# mkdir /etc/openstack
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# mv /etc/kolla/admin-openrc.sh /etc/openstack/
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# cat &lt;&lt; MXD &gt; /etc/profile.d/openstack-yoga.sh
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       #!/usr/bin/env bash
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       source /etc/openstack/admin-openrc.sh
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       MXD
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      #
     </span>
     <span style="color:black">
      重启终端后便可以正常使用
     </span>
     <span style="color:black">
      openstack
     </span>
     <span style="color:black">
      命令
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# logout
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      使用
     </span>
     <span style="color:black">
      OpenStack
     </span>
     <span style="color:black">
      相关命令验证客户端是否可以正常使用和服务是否正常启动，
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# openstack service list
      </span>
     </span>
     <img alt="" height="336" src="https://i-blog.csdnimg.cn/direct/df8ad5a07eae4de798b358a488cb9fa3.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# openstack compute service list
      </span>
     </span>
     <img alt="" height="138" src="https://i-blog.csdnimg.cn/direct/a24d180a497e488b93da378fc2ece06e.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# openstack network agent list
      </span>
     </span>
     <img alt="" height="132" src="https://i-blog.csdnimg.cn/direct/95d281f6049d4142a689e49bc3cff15c.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      可以发现，所有命令都可以正常使用，并且服务状态正常，下面查看本次部署
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      OpenStack
     </span>
     <span style="color:black">
      版本的详细信息，包括各个组件的版本号，如下所示。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# openstack version show
      </span>
     </span>
     <img alt="" height="418" src="https://i-blog.csdnimg.cn/direct/1bf89760fbc74f62bb1c83f905800726.png" width="865"/>
    </p>
    <h3 id="3.1.9%20%E5%AE%89%E8%A3%85%20Skyline%20%E6%9C%8D%E5%8A%A1" name="3.1.9%20%E5%AE%89%E8%A3%85%20Skyline%20%E6%9C%8D%E5%8A%A1" style="margin-left:0px; margin-right:0px; text-align:left">
     <strong>
      <span style="color:black">
       3.1.9
      </span>
     </strong>
     <strong>
      <span style="color:black">
       安装
      </span>
     </strong>
     <strong>
      <span style="color:black">
       Skyline
      </span>
     </strong>
     <strong>
      <span style="color:black">
       服务
      </span>
     </strong>
    </h3>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      是新一代的
     </span>
     <span style="color:black">
      OpenStack
     </span>
     <span style="color:black">
      管理界面，由九州云于
     </span>
     <span style="color:black">
      2021
     </span>
     <span style="color:black">
      年
     </span>
     <span style="color:black">
      9
     </span>
     <span style="color:black">
      月捐献给
     </span>
     <span style="color:black">
      OpenStack
     </span>
     <span style="color:black">
      社
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      区。同年
     </span>
     <span style="color:black">
      12
     </span>
     <span style="color:black">
      月末，
     </span>
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      孵化完成，成为
     </span>
     <span style="color:black">
      OpenStack
     </span>
     <span style="color:black">
      正式项目。
     </span>
     <span style="color:black">
      2022
     </span>
     <span style="color:black">
      年，
     </span>
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      开发团
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      队完成了
     </span>
     <span style="color:black">
      OpenStack
     </span>
     <span style="color:black">
      的代码重构，并增加了对
     </span>
     <span style="color:black">
      Octavia
     </span>
     <span style="color:black">
      、
     </span>
     <span style="color:black">
      Manila
     </span>
     <span style="color:black">
      、
     </span>
     <span style="color:black">
      Swift
     </span>
     <span style="color:black">
      、
     </span>
     <span style="color:black">
      Barbican
     </span>
     <span style="color:black">
      、
     </span>
     <span style="color:black">
      Zun
     </span>
     <span style="color:black">
      、
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      Trove
     </span>
     <span style="color:black">
      等社区模块的支持。
     </span>
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      团队也通过企业微信群与社区开发者、社区用户进行了
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      很多轮的互动讨论。
     </span>
     <span style="color:black">
      2022
     </span>
     <span style="color:black">
      年
     </span>
     <span style="color:black">
      10
     </span>
     <span style="color:black">
      月
     </span>
     <span style="color:black">
      5
     </span>
     <span style="color:black">
      日，
     </span>
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      第一个正式版本随
     </span>
     <span style="color:black">
      OpenStack Yoga
     </span>
     <span style="color:black">
      正式发
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      布。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      不仅提供了
     </span>
     <span style="color:black">
      OpenStack
     </span>
     <span style="color:black">
      基础服务（如计算、存储、网络的操作界面），也支持
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      许多增值服务（如文件存储、对象存储、负载均衡、数据库等服务）。一旦完成部署，
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      不依赖任何插件就能迅速调用各种云服务接口，满足企业级的生产需求。云上的虚
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      拟机、容器、
     </span>
     <span style="color:black">
      K8s
     </span>
     <span style="color:black">
      集群、
     </span>
     <span style="color:black">
      RDS
     </span>
     <span style="color:black">
      （
     </span>
     <span style="color:black">
      Relational Database Service
     </span>
     <span style="color:black">
      ，关系数据库服务）数据库、负
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      载均衡等各种资源，都能在
     </span>
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      的平台上完成全生命周期管理。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      Skyline 1.0.0
     </span>
     <span style="color:black">
      版本已完成表
     </span>
     <span style="color:black">
      3-2
     </span>
     <span style="color:black">
      中组件的对接，并支持完整的图形化操作界面。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      表
     </span>
     <span style="color:black">
      3-2 Skyline 1.0.0
     </span>
     <span style="color:black">
      组件说明
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="517" src="https://i-blog.csdnimg.cn/direct/706112d715b448d78baa22baaff6561b.png" width="589"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      1.
     </span>
     <span style="color:black">
      创建
     </span>
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      服务的数据库
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      在
     </span>
     <span style="color:black">
      MariaDB
     </span>
     <span style="color:black">
      容器中创建
     </span>
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      服务的数据库并赋予远程访问权限，命令及执行结果
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      如下所示。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      #
     </span>
     <span style="color:black">
      查询数据库登录密码
     </span>
     <span style="color:black">
      38
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# grep ^database /etc/kolla/passwords.yml
      </span>
     </span>
     <img alt="" height="80" src="https://i-blog.csdnimg.cn/direct/e3ed541394de49a1bda4fc246e71e5a8.png" width="731"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      #
     </span>
     <span style="color:black">
      查询运行数据库服务的容器
     </span>
     <span style="color:black">
      ID
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]#  docker container ls -f name=mariadb --format='{
       <!-- -->
       {.ID}}'
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       24200bbea954
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      #
     </span>
     <span style="color:black">
      进入数据库容器创建
     </span>
     <span style="color:black">
      S
     </span>
     <span style="color:black">
      kyline
     </span>
     <span style="color:black">
      服务的数据库并赋予远程访问权限
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <strong>
       <span style="color:black">
        [root@controller ~]# docker exec -it 24200bbea954 sh
       </span>
      </strong>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <strong>
       <span style="color:black">
        (mariadb)[mysql@controller /]$ mysql -uroot -p3HxaoYzygz9p3zOKQeFlClBBKUzbu6hskgPXnHU7
       </span>
      </strong>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       Welcome to the MariaDB monitor. Commands end with ; or \g.
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       Your MariaDB connection id is 30361
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       Server version: 10.6.11-MariaDB-1:10.6.11+maria~deb11-log mariadb.org binary
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       distribution
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       MariaDB [(none)]&gt;
       <strong>
        CREATE DATABASE skyline DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci
       </strong>
      </span>
      <strong>
       <span style="color:black">
        ；
       </span>
      </strong>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       Query OK, 1 row affected (0.004 sec)
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       MariaDB [(none)]&gt;
       <strong>
        GRANT ALL PRIVILEGES ON skyline. * TO'skyline'@'localhost' IDENTIFIED BY 'mariadb_yoga';
       </strong>
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       Query OK, 0 rows affected (0.006 sec)
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       MariaDB [(none)]&gt;
       <strong>
        GRANT ALL PRIVILEGES ON skyline. * TO 'skyline'@' %' IDENTIFIED BY 'mariadb_yoga';
       </strong>
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       Query OK, 0 rows affected (0.005 sec)
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       MariaDB [(none)]&gt;
       <strong>
        flush privileges;
       </strong>
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       Query OK, 0 rows affected (0.005 sec)
      </span>
     </span>
     <img alt="" height="447" src="https://i-blog.csdnimg.cn/direct/857a308675264bda9dbc253447da77df.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      2.
     </span>
     <span style="color:black">
      创建
     </span>
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      用户并添加
     </span>
     <span style="color:black">
      admin
     </span>
     <span style="color:black">
      角色
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      创建
     </span>
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      服务的新用户
     </span>
     <span style="color:black">
      skyline
     </span>
     <span style="color:black">
      ，密码为
     </span>
     <span style="color:black">
      wxic@yoga
     </span>
     <span style="color:black">
      ，在默认域
     </span>
     <span style="color:black">
      default
     </span>
     <span style="color:black">
      中创建，并
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      向
     </span>
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      用户分配
     </span>
     <span style="color:black">
      admin
     </span>
     <span style="color:black">
      角色。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# openstack user create --domain default --password wxic@yoga
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       skyline
      </span>
     </span>
     <img alt="" height="201" src="https://i-blog.csdnimg.cn/direct/0b327294c47846d8ab74d5ae31ee35df.png" width="764"/>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# openstack role add --project service --user skyline admin
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      3.
     </span>
     <span style="color:black">
      修改
     </span>
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      服务配置文件
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      创建
     </span>
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      服务需要的配置文件目录和日志文件目录。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# mkdir -p /etc/skyline /var/log/skyline /var/lib/skyline /var/log/nginx
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      在
     </span>
     <span style="color:black">
      /etc/skyline
     </span>
     <span style="color:black">
      目 录 创 建 并 修 改
     </span>
     <span style="color:black">
      skyline.yaml
     </span>
     <span style="color:black">
      配 置 文 件 ， 该 示 例 文 件 最 新 版 可 在
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      OpenStack
     </span>
     <span style="color:black">
      官方帮助文档的
     </span>
     <span style="color:black">
      settings
     </span>
     <span style="color:black">
      界面找到，修改
     </span>
     <span style="color:black">
      skyline.yaml
     </span>
     <span style="color:black">
      配置文件中的如下几项内
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      容。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      ①
     </span>
     <span style="color:black">
      database_url
     </span>
     <span style="color:black">
      ：定义数据库名称和远程连接地址。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      ②
     </span>
     <span style="color:black">
      debug
     </span>
     <span style="color:black">
      ：是否启用
     </span>
     <span style="color:black">
      debug
     </span>
     <span style="color:black">
      功能。建议不启用，启用之后会产生大量的日志文件，非开
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      发人员没有必要启用。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      ③
     </span>
     <span style="color:black">
      log_dir
     </span>
     <span style="color:black">
      ：定义日志存放目录（上面步骤中创建的
     </span>
     <span style="color:black">
      /var/log/skyline
     </span>
     <span style="color:black">
      目录）。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      ④
     </span>
     <span style="color:black">
      keystone_url
     </span>
     <span style="color:black">
      ：
     </span>
     <span style="color:black">
      Keystone
     </span>
     <span style="color:black">
      服务的认证地址。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      ⑤
     </span>
     <span style="color:black">
      default_region
     </span>
     <span style="color:black">
      ：集群区域名。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      ⑥
     </span>
     <span style="color:black">
      system_user_password
     </span>
     <span style="color:black">
      ：已创建的
     </span>
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      用户的密码。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      #
     </span>
     <span style="color:black">
      查询
     </span>
     <span style="color:black">
      keystone
     </span>
     <span style="color:black">
      内部服务端点地址
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# openstack endpoint list --interface internal \
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       --service keystone -f value -c URL
      </span>
     </span>
     <img alt="" height="109" src="https://i-blog.csdnimg.cn/direct/1f9cec3408b6404b85aa59d8e7e1c89f.png" width="619"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      #
     </span>
     <span style="color:black">
      创建配置文件
     </span>
     <span style="color:black">
      skyline.yam
     </span>
     <span style="color:black">
      l
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# vi /etc/skyline/skyline.yaml
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       default:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       access_token_expire: 3600
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       access_token_renew: 1800
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       cors_allow_origins: []
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      # MySQL
     </span>
     <span style="color:black">
      连接地址及密码
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       database_url: mysql://skyline:mariadb_yoga@192.168.233.100:3306/skyline
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       debug: false
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       log_dir: /var/log/skyline
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       log_file: skyline_wxic.log
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       prometheus_basic_auth_password: 'wxic@yoga'
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       prometheus_basic_auth_user: ''
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       prometheus_enable_basic_auth: false
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       prometheus_endpoint: http://192.168.233.100:9091
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       secret_key: aCtmgbcUqYUy_HNVg5BDXCaeJgJQzHJXwqbXr0Nmb2o
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       session_name: session
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       ssl_enabled: true
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       openstack:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       base_domains:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - heat_user_domain
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      #
     </span>
     <span style="color:black">
      修改默认区域
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       default_region: RegionWxic
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       enforce_new_defaults: true
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       extension_mapping:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       floating-ip-port-forwarding: neutron_port_forwarding
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       fwaas_v2: neutron_firewall
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       qos: neutron_qos
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       vpnaas: neutron_vpn
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       interface_type: public
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      # keystone
     </span>
     <span style="color:black">
      认证地址
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       keystone_url: http://192.168.233.100:5000/v3/
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       nginx_prefix: /api/openstack
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       reclaim_instance_interval: 604800
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       service_mapping:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       baremetal: ironic
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       compute: nova
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       container: zun
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       container-infra: magnum
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       database: trove
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       identity: keystone
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       image: glance
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       key-manager: barbican
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       load-balancer: octavia
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       network: neutron
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       object-store: swift
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       orchestration: heat
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       placement: placement
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       sharev2: manilav2
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       volumev3: cinder
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       sso_enabled: false
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       sso_protocols:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - openid
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # 修改 region 名
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       sso_region: RegionWxic
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       system_admin_roles:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - admin
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - system_admin
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       system_project: service
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       system_project_domain: Default
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       system_reader_roles:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - system_reader
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       system_user_domain: Default
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       system_user_name: skyline
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       # skyline
      </span>
      <span style="color:black">
       用户密码
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       system_user_password: 'wxic@yoga'
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       setting:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       base_settings:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - flavor_families
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - gpu_models
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - usb_models
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       flavor_families:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - architecture: x86_architecture
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       categories:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - name: general_purpose
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       properties: []
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - name: compute_optimized
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       properties: []
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - name: memory_optimized
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       properties: []
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - name: high_clock_speed
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       properties: []
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - architecture: heterogeneous_computing
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       categories:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - name: compute_optimized_type_with_gpu
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       properties: []
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - name: visualization_compute_optimized_type_with_gpu
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       properties: []
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       gpu_models:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - nvidia_t4
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       usb_models:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       - usb_c
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      4.
     </span>
     <span style="color:black">
      运行
     </span>
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      服务
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      运行初始化引导容器生成数据库
     </span>
     <span style="color:black">
      Skyline
     </span>
     <span style="color:black">
      的表结构，并查看日志以验证数据库是否正常
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="color:black">
      连接和表结构的创建。
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# docker run -d --name skyline_bootstrap \
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       -e KOLLA_BOOTSTRAP="" \
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       -v /etc/skyline/skyline.yaml:/etc/skyline/skyline.yaml \
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       -v /var/log:/var/log \
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       --net=host 99cloud/skyline:latest
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # 查看 skyline_bootstrap 容器的日志
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# docker logs -f skyline_bootstrap
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <strong>
      <em>
       1.
      </em>
     </strong>
     <strong>
      <em>
       日志报错解决
      </em>
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     这里我出现了报错
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1045, "Access denied for user 'skyline'@'controller' (using password: YES)")
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       (Background on this error at: https://sqlalche.me/e/20/e3q8)
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       make: *** [Makefile:119: db_sync] Error 1
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     这里凡是接触过数据库的应该可以看出是数据库没有连上
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     先进行测试为什仫没有连上
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     进入mysql容器
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# docker  exec -it --name mariadb 24200bbea954
      </span>
     </span>
     <img alt="" height="49" src="https://i-blog.csdnimg.cn/direct/c7e80cc14cec410ba0d3d500a29e0ea6.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     然后进行远程连接测试
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       (mariadb)[mysql@controller /]$ mysql -h 192.168.100.10 -u skyline -p
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       Enter password:
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:red">
       ERROR 1045 (28000): Access denied for user 'luo'@'controller' (using password: YES)
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     可以看到没有成功，当时我就在想会不会权限没给到skyline用户
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     登录root查询权限
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       MariaDB [(none)]&gt; SHOW GRANTS FOR 'skyline'@'%';
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       ERROR 1141 (42000): There is no such grant defined for user 'skyline' on host '%'
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     发现他没有权限，于是设权限允许所有主机连接，不再像前面那样只允许本地主机连接
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       CREATE USER 'skyline'@'%' IDENTIFIED BY 'mariadb_yoga';
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       GRANT ALL PRIVILEGES ON *.* TO 'skyline'@'%';
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     再次查询
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       SHOW GRANTS FOR 'skyline'@'%';
      </span>
     </span>
     <img alt="" height="125" src="https://i-blog.csdnimg.cn/direct/f90369d103974ddd967a56392e41b0ab.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     可以看到已经具有所有权限
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     再次查看 skyline_bootstrap 容器的日志
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# docker logs -f skyline_bootstrap
      </span>
     </span>
     <img alt="" height="217" src="https://i-blog.csdnimg.cn/direct/442feae8dae54cc5b8fece52aedb416b.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     skyline_bootstrap容器的作用是生成 Skyline 服务的数据库的表结构，经查询，生成了alembic_version、revoked_token、settings 三张表结构，查询结果如下所示。
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       show tables;
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <img alt="" height="278" src="https://i-blog.csdnimg.cn/direct/971d4a89c6dc455298bf561428afe2e8.png" width="425"/>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       describe alembic_version;
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <img alt="" height="236" src="https://i-blog.csdnimg.cn/direct/d7594b9f2a02475e962163e06ec67871.png" width="730"/>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       describe revoked_token;
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <img alt="" height="248" src="https://i-blog.csdnimg.cn/direct/d08b21adc9d94a5893c4bb6a912a4190.png" width="709"/>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       describe settings;
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <img alt="" height="223" src="https://i-blog.csdnimg.cn/direct/c28425116c224610aa08636a23af5264.png" width="711"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     表结构创建成功后，删除数据库初始化引导容器 skyline_bootstrap。
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# docker rm -f skyline_bootstrap skyline_bootstrap
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     运行 skyline-apiserver 服务容器 skyline，设置重启策略为 always，并挂载配置文件和日志目录的数据卷，将容器的网络连接设置为主机的网络。
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# docker run -d --name skyline --restart=always \
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       -v /etc/skyline/skyline.yaml:/etc/skyline/skyline.yaml \
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       -v /var/log:/var/log \
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       -e LISTEN_ADDRESS=192.168.100.10:9942 \
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       --net=host 99cloud/skyline:latest
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # 查询容器运行日志
    </p>
    <p style="margin-left:0; margin-right:0">
     <span style="background-color:#cfcdcd">
      <span style="color:black">
       [root@controller ~]# docker logs -f skyline
      </span>
     </span>
     <img alt="" height="464" src="https://i-blog.csdnimg.cn/direct/863bb45da1084a8195d7a3d9fdd36681.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     Skyline 服务组件安装结束，在浏览器访问 http://192.168.100.10:9942 地址便可以看到如图 3-9 所示的 Skyline 登录界面，输入用户名和密码登录后，可看到如图3-10 所示的Skyline 首页界面。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     这里可以使用
     <strong>
      admin管理员登录
     </strong>
     也可使用
     <strong>
      skyline用户登录
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="534" src="https://i-blog.csdnimg.cn/direct/e7aba26198c84c57bbb05729b95f1cf2.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="541" src="https://i-blog.csdnimg.cn/direct/2a904eab4b194f61b489feb619620055.png" width="865"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f4c434c5f31382f:61727469636c652f64657461696c732f313436303935383233" class_="artid" style="display:none">
 </p>
</div>


