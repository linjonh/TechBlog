---
layout: post
title: "js-使用-Web-Workers-来实现一个精确的倒计时,即使ios手机锁屏或页面进入后台,倒计时也不会暂停"
date: 2025-03-11 18:50:38 +0800
description: "【代码】js 使用 Web Workers 来实现一个精确的倒计时，即使ios手机锁屏或页面进入后台，倒计时也不会暂停。"
keywords: "js 使用 Web Workers 来实现一个精确的倒计时，即使ios手机锁屏或页面进入后台，倒计时也不会暂停。"
categories: ['未分类']
tags: ['开发语言', '前端', 'Javascript']
artid: "146176989"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146176989
    alt: "js-使用-Web-Workers-来实现一个精确的倒计时,即使ios手机锁屏或页面进入后台,倒计时也不会暂停"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146176989
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146176989
cover: https://bing.ee123.net/img/rand?artid=146176989
image: https://bing.ee123.net/img/rand?artid=146176989
img: https://bing.ee123.net/img/rand?artid=146176989
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     js 使用 Web Workers 来实现一个精确的倒计时，即使ios手机锁屏或页面进入后台，倒计时也不会暂停。
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/b3cf0dc2bb484a04ba0dcab8300d8be6.png">
      ## 效果如上
     </img>
    </p>
    <pre><code class="prism language-html"><span class="token comment">&lt;!-- 将 main.js 和 worker.js 放在同一个目录下，然后在 HTML 文件中引入 main.js --&gt;</span>

<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Web Worker 倒计时<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Web Worker 倒计时示例<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>打开控制台查看倒计时日志。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <pre><code class="prism language-javascript"><span class="token comment">// main.js</span>
<span class="token comment">//主线程负责启动 Web Worker，并接收 Web Worker 发送的消息（例如倒计时的剩余时间）。</span>
<span class="token keyword">function</span> <span class="token function">padZero</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token string">'0'</span> <span class="token operator">+</span> num<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">String</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 创建一个新的 Web Worker</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'worker.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 向 Worker 发送消息，启动倒计时</span>
worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">'start'</span><span class="token punctuation">,</span> <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">60</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 60秒倒计时</span>

<span class="token comment">// 监听 Worker 发送的消息</span>
worker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> duration <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>timeLeft<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>duration <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'倒计时结束！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> hours <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>duration <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> remainMin <span class="token operator">=</span> duration <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> mins <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>remainMin <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> sec <span class="token operator">=</span> remainMin <span class="token operator">%</span> <span class="token number">60</span>
      <span class="token keyword">const</span> showTime<span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token function">padZero</span><span class="token punctuation">(</span>hours<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token function">padZero</span><span class="token punctuation">(</span>mins<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token function">padZero</span><span class="token punctuation">(</span>sec<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'剩余时间:'</span><span class="token punctuation">,</span> showTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 如果需要停止倒计时，可以发送停止消息</span>
<span class="token comment">// worker.postMessage({ action: 'stop' });</span>
</code></pre>
    <pre><code class="prism language-javascript"><span class="token comment">// worker.js 负责执行倒计时逻辑，并将剩余时间发送回主线程</span>

<span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token comment">// 监听主线程发送的消息</span>
self<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> action<span class="token punctuation">,</span> duration <span class="token punctuation">}</span> <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">===</span> <span class="token string">'start'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 记录倒计时开始的时间</span>
        <span class="token keyword">let</span> startTime <span class="token operator">=</span> duration<span class="token punctuation">;</span>

        <span class="token comment">// 使用 setInterval 每秒更新一次剩余时间</span>
        timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> elapsed <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span> <span class="token comment">// 已过去的时间</span>
            <span class="token keyword">const</span> timeLeft <span class="token operator">=</span> startTime <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 剩余时间</span>
            startTime<span class="token operator">=</span>timeLeft
            <span class="token keyword">if</span> <span class="token punctuation">(</span>timeLeft <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 清除定时器</span>
                self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">timeLeft</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通知主线程倒计时结束</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> timeLeft <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送剩余时间给主线程</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 每秒更新一次</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">===</span> <span class="token string">'stop'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 如果收到停止消息，清除定时器</span>
        <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="vue_87">
     </a>
     vue的实现
    </h3>
    <pre><code class="prism language-javascript">      <span class="token comment">// // 将 worker.js 转换为 Blob URL</span>
      <span class="token comment">// const blob = new Blob([workerCode], { type: 'application/javascript' });</span>
      <span class="token comment">// const workerURL = URL.createObjectURL(blob);</span>
      <span class="token comment">// // 初始化 Web Worker</span>
      <span class="token comment">// this.worker = new Worker(workerURL);</span>
      
      <span class="token comment">// // 监听 Web Worker 发送的消息</span>
      <span class="token comment">// this.worker.onmessage = (event) =&gt; {<!-- --></span>
      <span class="token comment">//   const timeLeft = event.data.timeLeft;</span>
      <span class="token comment">//   this.duration=timeLeft</span>
      <span class="token comment">//   if (timeLeft &lt;= 0) {<!-- --></span>
      <span class="token comment">//     this.setTime()</span>
      <span class="token comment">//     this.back("0")</span>
      <span class="token comment">//   } else {<!-- --></span>
      <span class="token comment">//     this.setTime()</span>
      <span class="token comment">//   }</span>
      <span class="token comment">// };</span>
      <span class="token comment">// this.startCountdown()</span>
</code></pre>
    <pre><code class="prism language-javascript"><span class="token comment">// worker.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> workerCode <span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
let myTimer = null;

// 监听主线程发送的消息
self.onmessage = function (event) {
    const { action, duration } = event.data;

    if (action === 'start') {
        // 记录倒计时开始的时间
        let startTime = duration;

        // 使用 setInterval 每秒更新一次剩余时间
        myTimer = setInterval(() =&gt; {
            const timeLeft = startTime -1; // 剩余时间
            startTime=timeLeft
            if (timeLeft &lt;= 0) {
                clearInterval(myTimer); // 清除定时器
                self.postMessage({ timeLeft: 0 }); // 通知主线程倒计时结束
            } else {
                self.postMessage({ timeLeft }); // 发送剩余时间给主线程
            }
        }, 1000); // 每秒更新一次
    } else if (action === 'stop') {
        // 如果收到停止消息，清除定时器
        clearInterval(myTimer);
    }
};
</span><span class="token template-punctuation string">`</span></span>

</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f79616e6d6569323031372f:61727469636c652f64657461696c732f313436313736393839" class_="artid" style="display:none">
 </p>
</div>


