---
layout: post
title: "android13打基础-保存用户免得下次重新登录逻辑"
date: 2025-03-08 18:00:21 +0800
description: "【代码】android13打基础: 保存用户免得下次重新登录逻辑。"
keywords: "android13打基础: 保存用户免得下次重新登录逻辑"
categories: ['未分类']
tags: ['微信']
artid: "146119782"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146119782
    alt: "android13打基础-保存用户免得下次重新登录逻辑"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146119782
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146119782
cover: https://bing.ee123.net/img/rand?artid=146119782
image: https://bing.ee123.net/img/rand?artid=146119782
img: https://bing.ee123.net/img/rand?artid=146119782
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     android13打基础: 保存用户免得下次重新登录逻辑
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="SP_0">
     </a>
     使用SP来做
    </h2>
    <ul>
     <li>
      创建LoginUser.kt
     </li>
    </ul>
    <pre><code class="prism language-kotlin"><span class="token comment">// 登录用户需要Email</span>
<span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">LoginUser</span><span class="token punctuation">(</span>
    <span class="token keyword">val</span> email<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">val</span> password<span class="token operator">:</span> String<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      创建假数据FakeLoginUser.kt
     </li>
    </ul>
    <pre><code class="prism language-kotlin">
<span class="token keyword">object</span> FakeLoginUser <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">val</span> fake_login_user_items <span class="token operator">=</span> <span class="token function">arrayListOf</span><span class="token punctuation">(</span>
        <span class="token function">LoginUser</span><span class="token punctuation">(</span>
            email <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"1690544550@qq.com"</span></span><span class="token punctuation">,</span>
            password <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"123"</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token function">LoginUser</span><span class="token punctuation">(</span>
            email <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"13266263124@139.com"</span></span><span class="token punctuation">,</span>
            password <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"123"</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token function">LoginUser</span><span class="token punctuation">(</span>
            email <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"17876215013@139.com"</span></span><span class="token punctuation">,</span>
            password <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"123"</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      创建登录退出SP常量
     </li>
    </ul>
    <pre><code class="prism language-kotlin"><span class="token comment">// 提供给登录退出使用的SP常量</span>
<span class="token keyword">object</span> LoginLogoutCons <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">val</span> is_logged_in<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"is_logged_in"</span></span>
    <span class="token keyword">val</span> email<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"email"</span></span>
    <span class="token keyword">val</span> user_prefs <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"user_prefs"</span></span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      处理界面逻辑1: 登录
     </li>
    </ul>
    <pre><code class="prism language-java">    <span class="token comment">// 持有sp对象</span>
    <span class="token keyword">private</span> <span class="token class-name">SharedPreferences</span> sharedPreferences<span class="token punctuation">;</span>

<span class="token comment">// 再一些初始化和声明周期函数上</span>
	   <span class="token comment">// 获取SharedPreferences实例</span>
        sharedPreferences <span class="token operator">=</span> <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token class-name">LoginLogoutCons</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">.</span><span class="token function">getUser_prefs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">MODE_PRIVATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 检查是否已经登录</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isLoggedIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 如果已登录，跳转到主界面，这里是再Fragment做的，所以是getActivity()</span>
            <span class="token function">startActivity</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ContainerActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
	
	<span class="token comment">// 没有的话，处理登录按钮的逻辑，对应处理输入框的逻辑</span>
	<span class="token comment">// 。。。省略代码</span>
	<span class="token comment">// 跳转登录前，保存状态信息,调用此函数</span>
	    <span class="token comment">// 保存登录状态</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">saveLoginStatus</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> isLoggedIn<span class="token punctuation">,</span> <span class="token class-name">String</span> oneValue<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SharedPreferences<span class="token punctuation">.</span>Editor</span> editor <span class="token operator">=</span> sharedPreferences<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        editor<span class="token punctuation">.</span><span class="token function">putBoolean</span><span class="token punctuation">(</span><span class="token class-name">LoginLogoutCons</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">.</span><span class="token function">is_logged_in</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> isLoggedIn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// todo: 这个value用来处理登录</span>
        editor<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token class-name">LoginLogoutCons</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> oneValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        editor<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


 <span class="token comment">// 使用sharedpreference来处理登录状态</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isLoggedIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> sharedPreferences<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">LoginLogoutCons</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">.</span><span class="token function">is_logged_in</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre>
    <ul>
     <li>
      处理界面逻辑1: 退出
     </li>
    </ul>
    <pre><code class="prism language-java">	<span class="token comment">// 持有SP对象</span>
	   <span class="token keyword">private</span> <span class="token class-name">SharedPreferences</span> sharedPreferences<span class="token punctuation">;</span>

<span class="token comment">// 在一些生命周期函数</span>
	  <span class="token comment">// 获取SharedPreferences实例</span>
        sharedPreferences <span class="token operator">=</span> <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token class-name">LoginLogoutCons</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">.</span><span class="token function">getUser_prefs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">MODE_PRIVATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 检查是否已经登录</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sharedPreferences<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">LoginLogoutCons</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">.</span><span class="token function">is_logged_in</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 如果未登录，跳转到登录页面</span>
            <span class="token function">startActivity</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">LoginActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        binding<span class="token punctuation">.</span>btnLogout<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>v <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



  <span class="token comment">// 处理退出登录按钮</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 清除登录状态和用户信息</span>
        <span class="token class-name">SharedPreferences<span class="token punctuation">.</span>Editor</span> editor <span class="token operator">=</span> sharedPreferences<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        editor<span class="token punctuation">.</span><span class="token function">putBoolean</span><span class="token punctuation">(</span><span class="token class-name">LoginLogoutCons</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">.</span><span class="token function">is_logged_in</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        editor<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token class-name">LoginLogoutCons</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        editor<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 跳转到登录页面，并结束当前活动</span>
        <span class="token function">startActivity</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SplashActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">XToastUtils</span><span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">"退出登录成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="SP_110">
     </a>
     记得初始化SP对象
    </h2>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f36393038363535322f:61727469636c652f64657461696c732f313436313139373832" class_="artid" style="display:none">
 </p>
</div>


