---
layout: post
title: "SpringBoot深入剖析-Spring-Boot-自动装配原理附源码与实战"
date: 2025-03-09 15:32:20 +0800
description: "Bean而在 Spring Boot 中，这些 Bean可以不写，Spring Boot 会自动装配合适的 Bean。例如，添加依赖后，Spring Boot 会自动配置DataSource但我们从未在代码中显式定义它！假设我们希望 Spring Boot在项目启动时自动装配一个自定义的 HelloService，而无需手动配置 Bean，我们可以按照以下步骤实现。如果不想让某些自动配置生效，可以使用exclude或者在Spring Boot 通过和加载中的自动配置类。自动配置类使用。"
keywords: "【SpringBoot】深入剖析 Spring Boot 自动装配原理（附源码与实战）"
categories: ['原理分析', 'Springboot']
tags: ['原理分析', 'Spring', 'Boot']
artid: "146133130"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146133130
    alt: "SpringBoot深入剖析-Spring-Boot-自动装配原理附源码与实战"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146133130
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146133130
cover: https://bing.ee123.net/img/rand?artid=146133130
image: https://bing.ee123.net/img/rand?artid=146133130
img: https://bing.ee123.net/img/rand?artid=146133130
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【SpringBoot】深入剖析 Spring Boot 自动装配原理（附源码与实战）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_Spring_Boot__0">
     </a>
     深入剖析 Spring Boot 自动装配原理（附源码与实战）
    </h2>
    <p>
     Spring Boot 的**自动装配（Auto Configuration）
     <strong>
      是其核心特性之一，使得开发者无需手动配置复杂的 Bean，即可快速构建应用。但
     </strong>
     Spring Boot 是如何实现自动装配的？它的底层原理是什么？我们又该如何自定义自动装配？**本文将从源码入手，深入剖析 Spring Boot 的自动装配原理，并通过代码实战加深理解。
    </p>
    <hr/>
    <h3>
     <a id="1__6">
     </a>
     1. 什么是自动装配？
    </h3>
    <p>
     在传统的 Spring 项目中，我们需要手动配置 Bean，例如 XML 或 Java 配置：
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HikariDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     而在 Spring Boot 中，这些 Bean
     <strong>
      可以不写
     </strong>
     ，Spring Boot 会自动装配合适的 Bean。例如，添加
     <code>
      spring-boot-starter-data-jpa
     </code>
     依赖后，Spring Boot 会自动配置
     <code>
      DataSource
     </code>
     ，
     <strong>
      但我们从未在代码中显式定义它！
     </strong>
    </p>
    <hr/>
    <h3>
     <a id="2__21">
     </a>
     2. 自动装配的底层原理
    </h3>
    <p>
     Spring Boot 的自动装配基于**
     <code>
      @EnableAutoConfiguration
     </code>
     **，该注解的核心逻辑如下：
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@AutoConfigurationPackage</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// 导入自动装配选择器</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableAutoConfiguration</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="21_EnableAutoConfiguration__36">
     </a>
     2.1
     <code>
      @EnableAutoConfiguration
     </code>
     做了什么？
    </h4>
    <ol>
     <li>
      <strong>
       <code>
        @AutoConfigurationPackage
       </code>
      </strong>
      ：自动扫描并注册包路径下的组件。
     </li>
     <li>
      <strong>
       <code>
        @Import(AutoConfigurationImportSelector.class)
       </code>
      </strong>
      ：加载所有自动配置类。
     </li>
    </ol>
    <p>
     其中，
     <strong>
      <code>
       AutoConfigurationImportSelector
      </code>
     </strong>
     是 Spring Boot 自动装配的核心，负责加载
     <code>
      META-INF/spring.factories
     </code>
     里的自动配置类。
    </p>
    <hr/>
    <h3>
     <a id="3_Spring_Boot__45">
     </a>
     3. Spring Boot 如何加载自动配置类？
    </h3>
    <h4>
     <a id="31_AutoConfigurationImportSelector__47">
     </a>
     3.1
     <code>
      AutoConfigurationImportSelector
     </code>
     源码分析
    </h4>
    <p>
     <code>
      AutoConfigurationImportSelector
     </code>
     通过
     <code>
      getAutoConfigurationEntry()
     </code>
     方法加载所有自动配置类：
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">AutoConfigurationEntry</span> <span class="token function">getAutoConfigurationEntry</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">AnnotationMetadata</span> annotationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> configurations <span class="token operator">=</span> <span class="token function">getCandidateConfigurations</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">,</span> metadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
    configurations <span class="token operator">=</span> <span class="token function">removeDuplicates</span><span class="token punctuation">(</span>configurations<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AutoConfigurationEntry</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     其中，
     <code>
      getCandidateConfigurations()
     </code>
     方法会加载
     <code>
      spring.factories
     </code>
     文件：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCandidateConfigurations</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">AutoConfigurationMetadata</span> autoConfigurationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token class-name">SpringFactoriesLoader</span><span class="token punctuation">.</span><span class="token function">loadFactoryNames</span><span class="token punctuation">(</span><span class="token function">getSpringFactoriesLoaderFactoryClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="32_springfactories__68">
     </a>
     3.2
     <code>
      spring.factories
     </code>
     文件
    </h4>
    <p>
     Spring Boot 的
     <code>
      spring-boot-autoconfigure.jar
     </code>
     包含
     <code>
      META-INF/spring.factories
     </code>
     ，里面定义了所有的自动装配类。例如：
    </p>
    <pre><code>org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\
org.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration,\
org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration
</code></pre>
    <p>
     这意味着：
     <strong>
      Spring Boot 会自动加载
      <code>
       DataSourceAutoConfiguration
      </code>
      、
      <code>
       HibernateJpaAutoConfiguration
      </code>
      等自动配置类。
     </strong>
    </p>
    <hr/>
    <h3>
     <a id="4__83">
     </a>
     4. 代码实战：自定义自动装配
    </h3>
    <p>
     假设我们希望 Spring Boot
     <strong>
      在项目启动时自动装配一个自定义的 HelloService
     </strong>
     ，而无需手动配置 Bean，我们可以按照以下步骤实现。
    </p>
    <h4>
     <a id="41__HelloService_87">
     </a>
     4.1 定义
     <code>
      HelloService
     </code>
    </h4>
    <p>
     首先，创建一个简单的服务类：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"Hello, Spring Boot AutoConfiguration!"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="42__99">
     </a>
     4.2 创建自动配置类
    </h4>
    <p>
     在
     <code>
      com.example.config
     </code>
     包下创建
     <code>
      HelloServiceAutoConfiguration
     </code>
     ，使用
     <code>
      @Configuration
     </code>
     和
     <code>
      @ConditionalOnMissingBean
     </code>
     ，确保仅在没有用户手动定义
     <code>
      HelloService
     </code>
     时才进行装配：
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServiceAutoConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@ConditionalOnMissingBean</span>
    <span class="token keyword">public</span> <span class="token class-name">HelloService</span> <span class="token function">helloService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HelloService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="43__springfactories_115">
     </a>
     4.3 注册到
     <code>
      spring.factories
     </code>
    </h4>
    <p>
     在
     <code>
      resources/META-INF/spring.factories
     </code>
     文件中，加入：
    </p>
    <pre><code>org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.example.config.HelloServiceAutoConfiguration
</code></pre>
    <p>
     这样，Spring Boot 启动时，会自动加载
     <code>
      HelloServiceAutoConfiguration
     </code>
     ，并装配
     <code>
      HelloService
     </code>
     。
    </p>
    <h4>
     <a id="44__125">
     </a>
     4.4 测试自动装配
    </h4>
    <p>
     创建 Spring Boot 启动类：
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutoConfigDemoApplication</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigDemoApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HelloService</span> helloService <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">HelloService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>helloService<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     运行后，输出：
    </p>
    <pre><code>Hello, Spring Boot AutoConfiguration!
</code></pre>
    <p>
     <strong>
      这证明我们的
      <code>
       HelloService
      </code>
      已经被 Spring Boot 自动装配！
     </strong>
    </p>
    <hr/>
    <h3>
     <a id="5__150">
     </a>
     5. 自动装配的排除与自定义
    </h3>
    <h4>
     <a id="51__152">
     </a>
     5.1 排除特定的自动配置
    </h4>
    <p>
     如果不想让某些自动配置生效，可以使用
     <code>
      exclude
     </code>
     ：
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyApplication</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     或者在
     <code>
      application.properties
     </code>
     中排除：
    </p>
    <pre><code>spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
</code></pre>
    <h4>
     <a id="52__168">
     </a>
     5.2 查看已加载的自动配置
    </h4>
    <p>
     Spring Boot 提供
     <code>
      spring-boot-actuator
     </code>
     依赖，可以使用
     <code>
      /actuator/beans
     </code>
     查看已加载的自动配置 Bean：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     然后访问：
    </p>
    <pre><code>http://localhost:8080/actuator/beans
</code></pre>
    <p>
     可以看到当前应用加载了哪些自动装配的 Bean。
    </p>
    <hr/>
    <h3>
     <a id="6__189">
     </a>
     6. 总结
    </h3>
    <ol>
     <li>
      <strong>
       Spring Boot 通过
       <code>
        @EnableAutoConfiguration
       </code>
       和
       <code>
        AutoConfigurationImportSelector
       </code>
       加载
       <code>
        spring.factories
       </code>
       中的自动配置类。
      </strong>
     </li>
     <li>
      <strong>
       自动配置类使用
       <code>
        @ConditionalOnMissingBean
       </code>
       等注解，确保只有在必要时才进行装配。
      </strong>
     </li>
     <li>
      <strong>
       可以自定义自动装配组件，让 Spring Boot 在启动时自动加载自定义 Bean。
      </strong>
     </li>
     <li>
      <strong>
       可以使用
       <code>
        exclude
       </code>
       配置排除特定的自动装配类，避免不必要的 Bean 加载。
      </strong>
     </li>
    </ol>
    <p>
     Spring Boot 的自动装配机制极大地简化了 Spring 应用的开发，同时提供了足够的扩展性，使开发者能够轻松地自定义和管理 Bean 配置。希望本文能帮助你深入理解 Spring Boot 自动装配的底层原理！🚀
    </p>
    <hr/>
    <p>
     📌
     <strong>
      你学会了吗？
     </strong>
     欢迎在评论区留言交流！🔥
    </p>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f5072696e63653134303637382f:61727469636c652f64657461696c732f313436313333313330" class_="artid" style="display:none">
 </p>
</div>


