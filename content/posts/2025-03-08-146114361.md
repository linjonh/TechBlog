---
layout: post
title: "数据库二三事13"
date: 2025-03-08 13:38:51 +0800
description: "系统故障：软故障，因为软件意外导致非正常终止，影响所有事物，导致易失性存储器内容丢失，需要回滚所有未完成事务结果。介质故障：硬故障，因为物理意义意外导致数据库数据丢失，采用备份（有局限性）和双物理存储设备，双系统方式进行保存。差量存储，对最近一次库完全转储以来的变化进行转储，比完全速度快空间小，比增量恢复快但速度慢，占空间多。恢复步骤：找最后一个检查点记录，得到此时事物清单，建立undo，redo队列，正向扫描。四大类故障：事务内部故障，系统故障，介质故障，计算机病毒故障。"
keywords: "数据库二三事（13）"
categories: ['未分类']
tags: ['数据库']
artid: "146114361"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146114361
    alt: "数据库二三事13"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146114361
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146114361
cover: https://bing.ee123.net/img/rand?artid=146114361
image: https://bing.ee123.net/img/rand?artid=146114361
img: https://bing.ee123.net/img/rand?artid=146114361
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     数据库二三事（13）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     故障管理
    </p>
    <p>
     四大类故障：事务内部故障，系统故障，介质故障，计算机病毒故障
    </p>
    <p>
     事物内部：分为预期与非预期故障，需要强制回滚事物恢复状态，自动完成且透明
    </p>
    <p>
     系统故障：软故障，因为软件意外导致非正常终止，影响所有事物，导致易失性存储器内容丢失，需要回滚所有未完成事务结果
    </p>
    <p>
     介质故障：硬故障，因为物理意义意外导致数据库数据丢失，采用备份（有局限性）和双物理存储设备，双系统方式进行保存
    </p>
    <p>
     病毒：杀死程序或备份文件
    </p>
    <p>
     恢复重点：建立冗余数据并进行恢复
    </p>
    <p>
    </p>
    <p>
     数据转储：即备份
    </p>
    <p>
     静态转储：不运行其他事物，不存取，修改（一致性），降低可用性
    </p>
    <p>
     动态转储：允许存取修改，不保证一致性
    </p>
    <p>
    </p>
    <p>
     转储机制：完全转储（所有数据），占用多但恢复时间短
    </p>
    <p>
     增量存储，只复制上次转储变化的文件与数据块，需时短需空间小但数据只能和完全转储配合，恢复比完全长
    </p>
    <p>
     差量存储，对最近一次库完全转储以来的变化进行转储，比完全速度快空间小，比增量恢复快但速度慢，占空间多
    </p>
    <p>
     结合使用：完全＋增量，差量
    </p>
    <p>
    </p>
    <p>
     日志文件：记录修改操作，帮助恢复
    </p>
    <p>
     具体作用：事务故障恢复，系统故障恢复，动态转储，静态转储
    </p>
    <p>
     undo与redo：前者反向扫描，找到回滚事务并逆操作直到遇到开始记录，后者正向扫描到提交记录
    </p>
    <p>
     事务仅需undo，系统故障先undo再redo
    </p>
    <p>
    </p>
    <p>
     格式与内容：两种格式：以记录/数据块为单位
    </p>
    <p>
     前者包括开始结束两个标记及所有修改操作，后者包括标识和数据块
    </p>
    <p>
    </p>
    <p>
     登记原则：次序严格按并行事务执行的时间次序，必须先写日志再写库，保证可再现性和正确性
    </p>
    <p>
    </p>
    <p>
     检查点：最大程度减少数据库完全恢复必须执行的日志部分
    </p>
    <p>
     内容包括清单与最后日志地址
    </p>
    <p>
     恢复步骤：找最后一个检查点记录，得到此时事物清单，建立undo，redo队列，正向扫描
    </p>
    <p>
    </p>
    <p>
     硬件容错方案：硬件部分对数据库进行保护
    </p>
    <p>
     磁盘保护技术：raid系统（廉价冗余磁盘阵列），保证个别驱动器失效时数据仍然可访问
    </p>
    <p>
     主要由镜像冗余和校验冗余保证
    </p>
    <p>
     分级：raid0，1，5，10等
    </p>
    <p>
     0：数据分块并行写入，提高速度但介质故障时数据无法恢复
    </p>
    <p>
     1：硬盘互为镜像，可靠性提高但利用率低，写速度不变
    </p>
    <p>
     5：比0多加一个奇偶校验和
    </p>
    <p>
     10：0，1结合
    </p>
    <p>
     raid可分为软（件）raid与硬（件）raid，后者较多因为其性能更强
    </p>
    <p>
    </p>
    <p>
     容错技术：保证服务器可靠性，一般使用两台相同的服务器，共享存储设备
    </p>
    <p>
     接管过程：正常用主，主出事就转用副
    </p>
    <p>
     脑裂：主副都没事但检测系统故障导致判定主出事导致互抢资源（现在运用多种检测方式）
    </p>
    <p>
    </p>
    <p>
     数据库镜像与容灾：
    </p>
    <p>
     镜像：提高数据库可用性保证互相监管，提供完整冗余，提高可用性
    </p>
    <p>
     分为双机互备援模式与双机热备份模式
    </p>
    <p>
     前者两台工作机后者一工作一备份
    </p>
    <p>
     工作方式：互补，可用于并发
    </p>
    <p>
    </p>
    <p>
     SQL数据库镜像只用于错误回复，可引入见证服务器（判定恢复）
    </p>
    <p>
     两种镜像运行模式：高安全性，高性能
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f37383631313031342f:61727469636c652f64657461696c732f313436313134333631" class_="artid" style="display:none">
 </p>
</div>


