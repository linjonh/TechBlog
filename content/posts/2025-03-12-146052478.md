---
layout: post
title: "DeepseekåŸºç¡€ç¯‡-v3åŸºæœ¬æ¶æ„"
date: 2025-03-12 21:12:04 +0800
description: "DeepSeek-V3 æ˜¯ä¸€æ¬¾é‡‡ç”¨ Mixture-of-Expertsï¼ˆMoEï¼‰æ¶æ„çš„å¤§å‹ï¼š61 å±‚ï¼š7168ï¼š18432ï¼š128ï¼š129280ï¼š163840è¯¥æ¨¡å‹é€šè¿‡ç²¾ç»†çš„æ¶æ„è®¾è®¡ï¼Œå®ç°äº†åœ¨è®¡ç®—æ•ˆç‡å’Œæ€§èƒ½ä¸Šçš„å¹³è¡¡ã€‚"
keywords: "ã€DeepseekåŸºç¡€ç¯‡ã€‘--v3åŸºæœ¬æ¶æ„"
categories: ['Deepseek']
tags: ['æ¶æ„']
artid: "146052478"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146052478
    alt: "DeepseekåŸºç¡€ç¯‡-v3åŸºæœ¬æ¶æ„"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146052478
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146052478
cover: https://bing.ee123.net/img/rand?artid=146052478
image: https://bing.ee123.net/img/rand?artid=146052478
img: https://bing.ee123.net/img/rand?artid=146052478
---

# ã€DeepseekåŸºç¡€ç¯‡ã€‘--v3åŸºæœ¬æ¶æ„

* * *

è®ºæ–‡åœ°å€ï¼š<https://arxiv.org/pdf/2412.19437>

DeepSeek-V3 æ˜¯ä¸€æ¬¾é‡‡ç”¨ Mixture-of-
Expertsï¼ˆMoEï¼‰æ¶æ„çš„å¤§å‹[è¯­è¨€æ¨¡å‹](https://so.csdn.net/so/search?q=%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B&spm=1001.2101.3001.7020
"è¯­è¨€æ¨¡å‹")ï¼Œå…¶æ ¸å¿ƒå‚æ•°é…ç½®å¦‚ä¸‹ï¼š[ã€å¤§æ¨¡å‹ç†è®ºç¯‡ã€‘--Mixture of Expertsæ¶æ„-
CSDNåšå®¢](https://blog.csdn.net/qq_58602552/article/details/146072460?spm=1001.2014.3001.5501
"ã€å¤§æ¨¡å‹ç†è®ºç¯‡ã€‘--Mixture of Expertsæ¶æ„-CSDNåšå®¢")

  * **æ¨¡å‹å±‚æ•°** ï¼š61 å±‚

  * **éšè—å±‚ç»´åº¦** ï¼š7168

  * **å‰é¦ˆç½‘ç»œç»´åº¦** ï¼š18432

  * **æ³¨æ„åŠ›å¤´æ•°** ï¼š128

  * **è¯æ±‡è¡¨å¤§å°** ï¼š129280

  * **æœ€å¤§ä½ç½®åµŒå…¥** ï¼š163840

è¯¥æ¨¡å‹é€šè¿‡ç²¾ç»†çš„æ¶æ„è®¾è®¡ï¼Œå®ç°äº†åœ¨è®¡ç®—æ•ˆç‡å’Œæ€§èƒ½ä¸Šçš„å¹³è¡¡ã€‚

## MOEå‚æ•°

> å‚æ•°| æè¿°  
> ---|---  
> MoE å±‚é¢‘ç‡| 1--æ¯ä¸€å±‚éƒ½æ˜¯ MoE å±‚  
> å…±äº«ä¸“å®¶æ•°| 1  
> è·¯ç”±ä¸“å®¶æ•°| 256  
> æ¯ä¸ª Token é€‰æ‹©çš„ä¸“å®¶æ•°| 8  
> MoE ä¸“å®¶å‰é¦ˆç½‘ç»œç»´åº¦| 2048  
> æ€» MoE å±‚æ•°| 58 å±‚ï¼ˆç¬¬ 4 å±‚è‡³ç¬¬ 61 å±‚ï¼‰  
> æ¯å±‚ä¸“å®¶æ€»æ•°| 257 ä¸ªï¼ˆ1 ä¸ªå…±äº«ä¸“å®¶ + 256 ä¸ªè·¯ç”±ä¸“å®¶ï¼‰  
> æ¨¡å‹æ€»ä¸“å®¶æ•°| 14,906 ä¸ªï¼ˆ257 ä¸ªä¸“å®¶ Ã— 58 å±‚ï¼‰  
> æ¯å±‚æ´»è·ƒä¸“å®¶| 9 ä¸ªï¼ˆ1 ä¸ªå…±äº«ä¸“å®¶ + 8 ä¸ªè·¯ç”±ä¸“å®¶ï¼‰  
> æ•´ä¸ªæ¨¡å‹çš„æ´»è·ƒä¸“å®¶| 522 ä¸ªï¼ˆ9 ä¸ªæ´»è·ƒä¸“å®¶ Ã— 58 å±‚ï¼‰  
> è®¡ç®—æ•ˆç‡é«˜| æ¯ä¸ª Token åªéœ€è®¡ç®—å°‘é‡ä¸“å®¶ï¼Œé™ä½äº†è®¡ç®—æˆæœ¬  
> å‚æ•°åˆ©ç”¨ç‡é«˜| æ€»å‚æ•°é‡ 6,710 äº¿ï¼Œå®é™…è®¡ç®—çš„æ¿€æ´»å‚æ•°ä»…çº¦ 370 äº¿  
> ä¸“å®¶ä¸“ç²¾åŒ–| è·¯ç”±æœºåˆ¶ä½¿å¾—ä¸“å®¶ä¸“æ³¨äºç‰¹å®šç‰¹å¾ï¼Œæé«˜æ¨¡å‹æ€§èƒ½  
> è·¯ç”±ä¸“å®¶ï¼ˆRouted Expertsï¼‰|  
> \- é€‰æ‹©æ€§æ¿€æ´»| æŒ‰éœ€æ¿€æ´»ï¼Œåˆ©ç”¨é—¨æ§æœºåˆ¶ï¼ˆå¦‚åŸºäºäº²å’Œåº¦åˆ†æ•°çš„ Top-K é€‰æ‹©ï¼‰å†³å®šå“ªäº›ä¸“å®¶å¤„ç†å½“å‰ Token  
> \- ä¸“ç²¾åŒ–å¤„ç†| æ¯ä¸ªè·¯ç”±ä¸“å®¶æ“…é•¿å¤„ç†ç‰¹å®šç±»å‹çš„è¾“å…¥æˆ–ç‰¹å¾ï¼Œå®ç°ä¸“ç²¾åŒ–  
> \- ç¨€ç–è®¡ç®—| ä»…æ¿€æ´»éƒ¨åˆ†ä¸“å®¶ï¼Œæé«˜è®¡ç®—æ•ˆç‡  
> \- è´Ÿè½½å‡è¡¡| ç¡®ä¿ä¸åŒä¸“å®¶åœ¨ä¸åŒè¾“å…¥ä¸Šå‡è¡¡è¢«æ¿€æ´»ï¼Œé¿å…è¿‡è½½  
> å…±äº«ä¸“å®¶ï¼ˆShared Expertsï¼‰|  
> \- å…¨å±€å‚ä¸| å§‹ç»ˆå‚ä¸æ‰€æœ‰è¾“å…¥çš„å¤„ç†ï¼Œè´¡çŒ®é€šç”¨çŸ¥è¯†  
> \- ä¿ƒè¿›æ³›åŒ–| æ•æ‰æ•°æ®ä¸­çš„æ™®éæ¨¡å¼ï¼Œå‡å°‘è¿‡æ‹Ÿåˆé£é™©  
> \- æé«˜ç¨³å®šæ€§| æä¾›ç¨³å®šçš„åŸºç¡€ï¼Œå³ä½¿è·¯ç”±æœºåˆ¶ä¸å®Œç¾æ—¶ï¼Œä¹Ÿèƒ½æœ‰å¯é çš„è¾“å‡º  
  
## 1.åŸºæœ¬æ¶æ„

DeepSeek-V3æ¨¡å‹çš„æ¶æ„ï¼ŒåŒ…æ‹¬

  1. åŸºæœ¬æ¶æ„ã€
  2. å¤šå¤´æ½œåœ¨æ³¨æ„åŠ›æœºåˆ¶(MLA)ã€
  3. DeepSeekMoE
  4. å¤štokené¢„æµ‹(MTP)è®­ç»ƒç›®æ ‡ã€‚

DeepSeek-V3çš„æ¶æ„è®¾è®¡åœ¨é«˜æ•ˆæ¨ç†å’Œç»æµé«˜æ•ˆçš„è®­ç»ƒä¹‹é—´å–å¾—äº†è‰¯å¥½çš„å¹³è¡¡ï¼Œå¹¶é€šè¿‡å¼•å…¥è¾…åŠ©æŸå¤±å…è´¹è´Ÿè½½å‡è¡¡ç­–ç•¥å’Œå¤štokené¢„æµ‹è®­ç»ƒç›®æ ‡ï¼Œè¿›ä¸€æ­¥æå‡äº†æ¨¡å‹çš„æ€§èƒ½ã€‚

> DeepSeek-V3æ¨¡å‹æ¶æ„çš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼šé‡‡ç”¨Multi-head Latent Attention (MLA)
> ä»¥æé«˜æ¨ç†æ•ˆç‡ï¼Œé‡‡ç”¨DeepSeekMoEä»¥é™ä½è®­ç»ƒæˆæœ¬ã€‚æ­¤å¤–ï¼Œè¿˜å¼•å…¥äº†å¤štokené¢„æµ‹(MTP)è®­ç»ƒç›®æ ‡ï¼Œä»¥æå‡æ¨¡å‹æ€§èƒ½ã€‚

![](https://i-blog.csdnimg.cn/direct/2512571877a14b48adee9d84640fc436.png)

### 1.1. ******Multi-Head Latent Attentionå¤šå¤´æ½œåœ¨æ³¨æ„åŠ›******

![](https://i-blog.csdnimg.cn/direct/efba5fa10f914212a3d87ad288b709cf.png)

  * >>æ ¸å¿ƒæ€æƒ³ï¼šé€šè¿‡ä½ç§©è”åˆå‹ç¼©æ³¨æ„åŠ›é”®å’Œå€¼æ¥å‡å°‘æ¨ç†è¿‡ç¨‹ä¸­çš„é”®å€¼ç¼“å­˜ (KV cache)ã€‚
  * >> å…·ä½“æ–¹æ³•ï¼šå¯¹æ³¨æ„åŠ›é”®å’Œå€¼è¿›è¡Œä½ç§©å‹ç¼©ï¼Œç”Ÿæˆå‹ç¼©çš„æ½œåœ¨å‘é‡ (![](https://i-blog.csdnimg.cn/direct/fbfd1536f06f4f888028df39e29b16fa.png))ã€‚ å¯¹æ³¨æ„åŠ›æŸ¥è¯¢ä¹Ÿè¿›è¡Œä½ç§©å‹ç¼©ï¼Œç”Ÿæˆå‹ç¼©çš„æ½œåœ¨å‘é‡ (![](https://i-blog.csdnimg.cn/direct/c85ac32009684c6398ee70da36e5eb5e.png))ã€‚ åˆ©ç”¨æ—‹è½¬ä½ç½®ç¼–ç  (RoPE) ç”Ÿæˆè§£è€¦çš„é”®å’ŒæŸ¥è¯¢ (![](https://i-blog.csdnimg.cn/direct/c6d1713a915b475c852cb001cb746456.png), ![](https://i-blog.csdnimg.cn/direct/1fc5690c1c1144faaa1ac9816569f606.png))ã€‚æœ€ç»ˆå°†æŸ¥è¯¢ã€é”®å’Œå€¼ç»“åˆèµ·æ¥ç”Ÿæˆæœ€ç»ˆçš„æ³¨æ„åŠ›è¾“å‡º (![](https://i-blog.csdnimg.cn/direct/06ee80378634406b84549a3320916f58.png))ã€‚
  * >> ä¼˜åŠ¿ï¼šä»…éœ€ç¼“å­˜å‹ç¼©çš„æ½œåœ¨å‘é‡å’Œè§£è€¦çš„é”®/æŸ¥è¯¢ï¼Œæ˜¾è‘—å‡å°‘äº†KVç¼“å­˜ï¼ŒåŒæ—¶ä¿æŒäº†ä¸æ ‡å‡†å¤šå¤´æ³¨æ„åŠ› (MHA) ç›¸å½“çš„æ€§èƒ½ã€‚

å…·ä½“å‚æ•°ï¼š

![](https://i-blog.csdnimg.cn/direct/45240297d95d46b59dbde9a2ce8f5e8d.png)

> ![](https://i-blog.csdnimg.cn/direct/273f275264c54f0b8a735d358e57ea00.png)
> ![](https://i-blog.csdnimg.cn/direct/c222d635df53483ab4ac373174407812.png)

å¯¹ äº æ³¨ æ„ åŠ› æŸ¥ è¯¢ ï¼Œ æˆ‘ ä»¬ ä¹Ÿ æ‰§ è¡Œ ä½ ç§© å‹ ç¼© ï¼Œ è¿™ å¯ ä»¥ åœ¨ è®­ ç»ƒ æœŸ é—´ å‡ å°‘ æ¿€ æ´» å†… å­˜ï¼š

![](https://i-blog.csdnimg.cn/direct/1d35f9b628834614885d9e9a5122f2ac.png)  
  
> ![](https://i-blog.csdnimg.cn/direct/f7eaeca380c6407b9bac7afcb9a5e4be.png)
>
> ![](https://i-blog.csdnimg.cn/direct/cdf635c1d30745e89ebdfd4af0c9c539.png)

æœ€ ç»ˆ ï¼Œ æ³¨ æ„ åŠ› æŸ¥ è¯¢
![](https://i-blog.csdnimg.cn/direct/265774d4f489476abcac220f720adf5f.png)ã€ é”®
ï¼ˆ![](https://i-blog.csdnimg.cn/direct/894b14f0c11e4182afffe2c1539e2d46.png)ï¼‰ å’Œ
å€¼ (![](https://i-blog.csdnimg.cn/direct/f28f796081734861896fc244074a335f.png)
) è¢« ç»„ åˆ èµ· æ¥ ä»¥ ç”Ÿ æˆ æœ€ ç»ˆ çš„ æ³¨ æ„ åŠ› è¾“ å‡º **u** T : ã€‚

![](https://i-blog.csdnimg.cn/direct/ad42564004304dbe824f8dffb8344459.png)

### 1.2.æ— è¾…åŠ©æŸå¤±è´Ÿè½½å‡è¡¡çš„ DeepSeekMoE

![](https://i-blog.csdnimg.cn/direct/74b732428e154679b18ba800cf39ae42.png)

å¯¹äºå‰é¦ˆç½‘ç»œï¼ˆFFNsï¼‰ï¼ŒDeepSeek-V3 é‡‡ç”¨ DeepSeekMoE æ¶æ„ï¼ˆDai et al., 2024ï¼‰ã€‚ä¸ GShardï¼ˆLepikhin
et al., 2021ï¼‰ç­‰ä¼ ç»Ÿ MoE æ¶æ„ç›¸æ¯”ï¼ŒDeepSeekMoE ä½¿ç”¨æ›´ç»†ç²’åº¦çš„ä¸“å®¶ï¼ˆexpertsï¼‰ï¼Œå¹¶å°†éƒ¨åˆ†ä¸“å®¶éš”ç¦»ä¸ºå…±äº«ä¸“å®¶ã€‚è®¾ ä¸ºç¬¬ ğ‘¡
ä¸ª token çš„ FFN è¾“å…¥ï¼Œæˆ‘ä»¬è®¡ç®—å…¶ FFN
è¾“å‡º![](https://i-blog.csdnimg.cn/direct/74c2710c16fe4bef92c3c716c743e7c6.png)
å¦‚ä¸‹ï¼š

![](https://i-blog.csdnimg.cn/direct/8a62817868b44044a7fa887ce8665919.png)

> ![](https://i-blog.csdnimg.cn/direct/6070bc62d7ca413a82047ed045f80b6d.png)

**æ—  è¾… åŠ© æŸ å¤± çš„ è´Ÿ è½½ å‡ è¡¡ï¼š**

å¯¹äº MoE æ¨¡å‹ï¼Œä¸“å®¶è´Ÿè½½çš„ä¸å‡è¡¡ä¼šå¯¼è‡´è·¯ç”±å´©æºƒï¼ˆShazeer et al.,
2017ï¼‰ï¼Œå¹¶åœ¨ä¸“å®¶å¹¶è¡Œçš„åœºæ™¯ä¸­é™ä½è®¡ç®—æ•ˆç‡ã€‚ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆé€šå¸¸ä¾èµ–äºè¾…åŠ©æŸå¤±ï¼ˆFedus et al., 2021ï¼›Lepikhin et al.,
2021ï¼‰æ¥é¿å…è´Ÿè½½ä¸å‡è¡¡ã€‚ç„¶è€Œï¼Œè¿‡å¤§çš„è¾…åŠ©æŸå¤±ä¼šæŸå®³æ¨¡å‹çš„æ€§èƒ½ï¼ˆWang et al.,
2024aï¼‰ã€‚ä¸ºäº†åœ¨è´Ÿè½½å‡è¡¡å’Œæ¨¡å‹æ€§èƒ½ä¹‹é—´å®ç°æ›´å¥½çš„å¹³è¡¡ï¼Œæˆ‘ä»¬å¼€åˆ›äº†ä¸€ç§æ— è¾…åŠ©æŸå¤±çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆWang et al.,
2024aï¼‰ï¼Œä»¥ç¡®ä¿è´Ÿè½½å‡è¡¡ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªä¸“å®¶å¼•å…¥ä¸€ä¸ªåç½®é¡¹![](https://i-blog.csdnimg.cn/direct/19982a0af5a5461384ad875ab0d89edb.png)
ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°å¯¹åº”çš„äº²å’Œåº¦åˆ†æ•°
![](https://i-blog.csdnimg.cn/direct/0ac9a6ee42c144d095ea69ceeb87ad47.png)ä¸­ï¼Œä»¥ç¡®å®š
top-K è·¯ç”±ï¼š

![](https://i-blog.csdnimg.cn/direct/0b7a035038504cd2bf44cd32ca87ba8c.png)

> æ³¨æ„ï¼Œåç½®é¡¹ä»…ç”¨äºè·¯ç”±ã€‚é—¨æ§å€¼ï¼ˆgating valueï¼‰ï¼Œå³å°†ä¸ FFN
> è¾“å‡ºç›¸ä¹˜çš„å€¼ï¼Œä»ç„¶æ¥è‡ªäºåŸå§‹çš„äº²å’Œåº¦åˆ†æ•°![](https://i-blog.csdnimg.cn/direct/e1b36ec056334a5f9d7b9ec6636a4dc2.png)
> ã€‚ åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šæŒç»­ç›‘æ§æ¯ä¸ªè®­ç»ƒæ­¥éª¤ä¸­æ•´ä¸ªæ‰¹æ¬¡çš„ä¸“å®¶è´Ÿè½½ã€‚åœ¨æ¯ä¸ªæ­¥éª¤ç»“æŸæ—¶ï¼Œå¦‚æœå¯¹åº”çš„ä¸“å®¶è¶…è½½ï¼Œæˆ‘ä»¬å°†åç½®é¡¹å‡å°‘
> ğ›¾ï¼›å¦‚æœå¯¹åº”çš„ä¸“å®¶è´Ÿè½½ä¸è¶³ï¼Œæˆ‘ä»¬å°†å…¶å¢åŠ  ğ›¾ï¼Œå…¶ä¸­ ğ›¾ æ˜¯ä¸€ä¸ªè¶…å‚æ•°ï¼Œç§°ä¸ºåç½®æ›´æ–°é€Ÿåº¦ï¼ˆbias update
> speedï¼‰ã€‚é€šè¿‡è¿™ç§åŠ¨æ€è°ƒæ•´ï¼ŒDeepSeek-V3
> åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¿æŒä¸“å®¶è´Ÿè½½å¹³è¡¡ï¼Œå¹¶ä¸”ç›¸æ¯”äºä»…é€šè¿‡çº¯è¾…åŠ©æŸå¤±æ¥é¼“åŠ±è´Ÿè½½å¹³è¡¡çš„æ¨¡å‹ï¼Œèƒ½å¤Ÿå®ç°æ›´å¥½çš„æ€§èƒ½ã€‚

** äº’ è¡¥ åº åˆ— çº§ è¾… åŠ© æŸ å¤±ï¼š**å°½ç®¡ DeepSeek-V3
ä¸»è¦ä¾èµ–äºæ— è¾…åŠ©æŸå¤±ç­–ç•¥æ¥å®ç°è´Ÿè½½å¹³è¡¡ï¼Œä½†ä¸ºäº†é˜²æ­¢å•ä¸ªåºåˆ—å†…éƒ¨å‡ºç°æç«¯çš„ä¸å¹³è¡¡ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨äº†ä¸€ä¸ªäº’è¡¥çš„åºåˆ—çº§å¹³è¡¡æŸå¤±ï¼š

![](https://i-blog.csdnimg.cn/direct/1d016e2c7b2749cc9fec94cca025fece.png)

  1. å¹³è¡¡å› å­ ğ›¼ æ˜¯ä¸€ä¸ªè¶…å‚æ•°ï¼Œå¯¹äº DeepSeek-V3 æ¥è¯´å°†èµ‹äºˆä¸€ä¸ªæå°çš„å€¼ï¼›
  2. 1(Â·) è¡¨ç¤ºæŒ‡ç¤ºå‡½æ•°ï¼›
  3. ğ‘‡ è¡¨ç¤ºåºåˆ—ä¸­çš„æ ‡è®°æ•°ã€‚åºåˆ—çº§å¹³è¡¡æŸå¤±é¼“åŠ±æ¯ä¸ªåºåˆ—çš„ä¸“å®¶è´Ÿè½½ä¿æŒå¹³è¡¡ã€‚

![](https://i-blog.csdnimg.cn/direct/f312660b43ec40f9904b31cb81362eec.png)

å¤š æ ‡ è®° é¢„ æµ‹ ï¼ˆ MTPï¼‰ å® ç° æ–¹ å¼ çš„ ç¤º æ„ å›¾ ã€‚ åœ¨ æ¯ ä¸ª æ·± åº¦ ï¼Œ æˆ‘ ä»¬ ä¸º æ¯ ä¸ª æ ‡ è®° çš„ é¢„ æµ‹ ä¿ ç•™ å®Œ æ•´ çš„ å› 
æœ é“¾ ã€‚

> èŠ‚ç‚¹é™åˆ¶è·¯ç”±ï¼šä¸ DeepSeek-V2 ä½¿ç”¨çš„è®¾å¤‡é™åˆ¶è·¯ç”±ç±»ä¼¼ï¼ŒDeepSeek-V3
> ä¹Ÿä½¿ç”¨äº†ä¸€ç§å—é™è·¯ç”±æœºåˆ¶ï¼Œä»¥é™åˆ¶è®­ç»ƒè¿‡ç¨‹ä¸­çš„é€šä¿¡æˆæœ¬ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬ç¡®ä¿æ¯ä¸ªæ ‡è®°æœ€å¤šåªä¼šå‘é€åˆ° ğ‘€ ä¸ªèŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹æ˜¯æ ¹æ®åˆ†å¸ƒåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ä¸“å®¶çš„å‰
> ä¸ªäº²å’Œåº¦åˆ†æ•°çš„æ€»å’Œæ¥é€‰æ‹©çš„ã€‚åœ¨è¿™ä¸ªçº¦æŸä¸‹ï¼Œæˆ‘ä»¬çš„ MoE è®­ç»ƒæ¡†æ¶å‡ ä¹å¯ä»¥å®ç°å®Œå…¨çš„è®¡ç®—-é€šä¿¡é‡å ã€‚
>
> æ— Tokenä¸¢å¼ƒï¼šç”±äºæœ‰æ•ˆçš„è´Ÿè½½å¹³è¡¡ç­–ç•¥ï¼ŒDeepSeek-V3 åœ¨æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹ä¸­ä¿æŒè‰¯å¥½çš„è´Ÿè½½å¹³è¡¡ã€‚å› æ­¤ï¼ŒDeepSeek-V3
> åœ¨è®­ç»ƒæœŸé—´ä¸ä¼šä¸¢å¼ƒä»»ä½•Tokenã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å®æ–½äº†ç‰¹å®šçš„éƒ¨ç½²ç­–ç•¥ï¼Œä»¥ç¡®ä¿æ¨ç†è¿‡ç¨‹ä¸­çš„è´Ÿè½½å¹³è¡¡ï¼Œå› æ­¤ DeepSeek-V3
> åœ¨æ¨ç†è¿‡ç¨‹ä¸­ä¹Ÿä¸ä¼šä¸¢å¼ƒTokenã€‚

* * *

## 2.å¤šæ ‡è®°é¢„æµ‹

å—åˆ° Gloeckle ç­‰äººï¼ˆ2024ï¼‰çš„å¯å‘ï¼Œæˆ‘ä»¬ä¸º DeepSeek-V3
è®¾å®šäº†ä¸€ä¸ªå¤šæ ‡è®°é¢„æµ‹ï¼ˆMTPï¼‰ç›®æ ‡ï¼Œå°†é¢„æµ‹èŒƒå›´æ‰©å±•åˆ°æ¯ä¸ªä½ç½®çš„å¤šä¸ªæœªæ¥æ ‡è®°ã€‚ä¸€æ–¹é¢ï¼ŒMTP ç›®æ ‡å¯ä»¥å¯†é›†åŒ–è®­ç»ƒä¿¡å·ï¼Œå¯èƒ½æé«˜æ•°æ®æ•ˆç‡ã€‚å¦ä¸€æ–¹é¢ï¼ŒMTP
å¯ä»¥ä½¿æ¨¡å‹é¢„å…ˆè§„åˆ’å…¶è¡¨ç¤ºï¼Œä»¥ä¾¿æ›´å¥½åœ°é¢„æµ‹æœªæ¥çš„æ ‡è®°ã€‚å›¾ 3 å±•ç¤ºäº†æˆ‘ä»¬çš„ MTP å®ç°ã€‚ä¸ Gloeckle ç­‰äººï¼ˆ2024ï¼‰é€šè¿‡ç‹¬ç«‹è¾“å‡ºå¤´å¹¶è¡Œé¢„æµ‹ ğ·
ä¸ªé¢å¤–æ ‡è®°ä¸åŒï¼Œæˆ‘ä»¬ä¾æ¬¡é¢„æµ‹é¢å¤–çš„æ ‡è®°ï¼Œå¹¶åœ¨æ¯ä¸ªé¢„æµ‹æ·±åº¦ä¿æŒå®Œæ•´çš„å› æœé“¾æ¡ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† MTP å®ç°çš„ç»†èŠ‚ã€‚

### 2.1. **MTP æ¨¡å—**

MTP å®ç°ä½¿ç”¨ ğ· ä¸ªé¡ºåºæ¨¡å—æ¥é¢„æµ‹ ğ· ä¸ªé¢å¤–çš„æ ‡è®°ã€‚ç¬¬ ğ‘˜ ä¸ª MTP æ¨¡å—ç”±ä¸€ä¸ªå…±äº«åµŒå…¥å±‚ Emb(Â·)ã€ä¸€ä¸ªå…±äº«è¾“å‡ºå¤´ OutHead(Â·)ã€ä¸€ä¸ª
Transformer å— TRMğ‘˜ (Â·) å’Œä¸€ä¸ªæŠ•å½±çŸ©é˜µ ğ‘€ğ‘˜
âˆˆ![](https://i-blog.csdnimg.cn/direct/5e44ec5a697b4cb583c41a772d68562d.png)
ç»„æˆã€‚å¯¹äºç¬¬ ğ‘– ä¸ªè¾“å…¥æ ‡è®° ï¼Œåœ¨ç¬¬ ğ‘˜ ä¸ªé¢„æµ‹æ·±åº¦ï¼Œæˆ‘ä»¬é¦–å…ˆå°†ç¬¬ ğ‘– ä¸ªæ ‡è®°åœ¨ç¬¬ (ğ‘˜âˆ’1) æ·±åº¦çš„è¡¨ç¤º âˆˆ
![](https://i-blog.csdnimg.cn/direct/484cedccd98d4025af2e4bd1f97f1e2a.png)ä¸ç¬¬
(ğ‘–+ğ‘˜)
ä¸ªæ ‡è®°çš„åµŒå…¥![](https://i-blog.csdnimg.cn/direct/71e6873c0afc4fa7a496618481deaba1.png)ç»“åˆï¼Œå¹¶è¿›è¡Œçº¿æ€§æŠ•å½±ï¼š

![](https://i-blog.csdnimg.cn/direct/546d6dc90ee443f4b38f07d9c7021bde.png)

> å…¶ä¸­ï¼Œ[Â·; Â·] è¡¨ç¤ºæ‹¼æ¥æ“ä½œã€‚ç‰¹åˆ«åœ°ï¼Œå½“ ğ‘˜ = 1
> æ—¶ï¼Œ![h^{k-1}_{i}](https://latex.csdn.net/eq?h%5E%7Bk-1%7D_%7Bi%7D)æŒ‡çš„æ˜¯ç”±ä¸»æ¨¡å‹ç»™å‡ºçš„è¡¨ç¤ºã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºæ¯ä¸ª
> MTP æ¨¡å—ï¼Œå®ƒçš„åµŒå…¥å±‚ä¸ä¸»æ¨¡å‹å…±äº«ã€‚ç»„åˆåçš„
> ![h'^{k}_{i}](https://latex.csdn.net/eq?h%27%5E%7Bk%7D_%7Bi%7D) ä½œä¸º
> Transformer å—ç¬¬ ğ‘˜ æ·±åº¦çš„è¾“å…¥ï¼Œä»¥ç”Ÿæˆå½“å‰æ·±åº¦çš„è¾“å‡ºè¡¨ç¤º
> ![h^{k}_{i}](https://latex.csdn.net/eq?h%5E%7Bk%7D_%7Bi%7D)ï¼š
>
> ![](https://i-blog.csdnimg.cn/direct/99ca5ec4c3a6424d9590999ffb88f215.png)

å…¶ä¸­ï¼Œğ‘‡ è¡¨ç¤ºè¾“å…¥åºåˆ—çš„é•¿åº¦ï¼Œğ‘–:ğ‘— è¡¨ç¤ºåˆ‡ç‰‡æ“ä½œï¼ˆåŒ…æ‹¬å·¦å³è¾¹ç•Œï¼‰ã€‚æœ€åï¼Œä»¥
![h^{k}_{i}](https://latex.csdn.net/eq?h%5E%7Bk%7D_%7Bi%7D) ä½œä¸ºè¾“å…¥ï¼Œå…±äº«çš„è¾“å‡ºå¤´å°†è®¡ç®—ç¬¬ ğ‘˜
ä¸ªé™„åŠ é¢„æµ‹ token çš„æ¦‚ç‡åˆ†å¸ƒ
![p^{k}_{i+1+k}](https://latex.csdn.net/eq?p%5E%7Bk%7D_%7Bi&plus;1&plus;k%7D)
âˆˆ ![\\mathbb{R}^{V}](https://latex.csdn.net/eq?%5Cmathbb%7BR%7D%5E%7BV%7D)ï¼Œå…¶ä¸­
ğ‘‰ æ˜¯è¯æ±‡è¡¨çš„å¤§å°ï¼š

![](https://i-blog.csdnimg.cn/direct/d7bcd90e91ff4417aa8d4d88c27a9011.png)

è¾“å‡ºå¤´ OutHead(Â·) å°†è¡¨ç¤ºæ˜ å°„åˆ° logitsï¼Œå¹¶éšååº”ç”¨ Softmax(Â·) å‡½æ•°æ¥è®¡ç®—ç¬¬ ğ‘˜ ä¸ªé™„åŠ  token çš„é¢„æµ‹æ¦‚ç‡ã€‚åŒæ—¶ï¼Œå¯¹äºæ¯ä¸ª
MTP æ¨¡å—ï¼Œå®ƒçš„è¾“å‡ºå¤´ä¸ä¸»æ¨¡å‹å…±äº«ã€‚æˆ‘ä»¬ä¿æŒé¢„æµ‹çš„å› æœé“¾çš„åŸåˆ™ä¸ EAGLE (Li et al., 2024b) ç±»ä¼¼ï¼Œä½†å®ƒçš„ä¸»è¦ç›®æ ‡æ˜¯æ¨æµ‹è§£ç 
(Leviathan et al., 2023; Xia et al., 2023)ï¼Œè€Œæˆ‘ä»¬åˆ©ç”¨ MTP æ¥æ”¹è¿›è®­ç»ƒã€‚

MTP
è®­ç»ƒç›®æ ‡ã€‚åœ¨æ¯ä¸ªé¢„æµ‹æ·±åº¦ï¼Œæˆ‘ä»¬è®¡ç®—äº¤å‰ç†µæŸå¤±![](https://i-blog.csdnimg.cn/direct/b01d523aca064b40a01f72bdbbe62e2c.png)
ï¼š

![](https://i-blog.csdnimg.cn/direct/fadd10af19d54a859f7c83c80ad3e630.png)

å…¶ä¸­ï¼Œğ‘‡ è¡¨ç¤ºè¾“å…¥åºåˆ—çš„é•¿åº¦ï¼Œ![t_{i}](https://latex.csdn.net/eq?t_%7Bi%7D) è¡¨ç¤ºç¬¬ ğ‘–
ä¸ªä½ç½®çš„çœŸå®æ ‡è®°ï¼Œ![p^{k}_{i}\[t_{i}\]](https://latex.csdn.net/eq?p%5E%7Bk%7D_%7Bi%7D%5Bt_%7Bi%7D%5D)
è¡¨ç¤ºç»™å®š ğ‘˜-th MTP æ¨¡å—çš„é¢„æµ‹æ¦‚ç‡ã€‚æœ€åï¼Œæˆ‘ä»¬è®¡ç®—æ‰€æœ‰æ·±åº¦çš„ MTP æŸå¤±çš„å¹³å‡å€¼ï¼Œå¹¶å°†å…¶ä¹˜ä»¥ä¸€ä¸ªæƒé‡å› å­ ğœ†ï¼Œå¾—åˆ°æœ€ç»ˆçš„ MTP æŸå¤±
LMTPï¼Œè¯¥æŸå¤±ä½œä¸º DeepSeek-V3 çš„é™„åŠ è®­ç»ƒç›®æ ‡ï¼š

![](https://i-blog.csdnimg.cn/direct/3497e29a1f124bc081d31719f3df6ee1.png)

> MTP åœ¨æ¨ç†ä¸­çš„åº”ç”¨ã€‚æˆ‘ä»¬çš„ MTP ç­–ç•¥ä¸»è¦æ—¨åœ¨æå‡ä¸»æ¨¡å‹çš„æ€§èƒ½ï¼Œå› æ­¤ï¼Œåœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¸¢å¼ƒ MTP
> æ¨¡å—ï¼Œä¸»æ¨¡å‹å¯ä»¥ç‹¬ç«‹ä¸”æ­£å¸¸åœ°è¿è¡Œã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†è¿™äº› MTP æ¨¡å—é‡æ–°ç”¨äºæ¨æµ‹è§£ç ï¼Œä»¥è¿›ä¸€æ­¥æå‡ç”Ÿæˆçš„å»¶è¿Ÿè¡¨ç°ã€‚



