---
layout: post
title: "HTML5-drag-API实现列表拖拽排序"
date: 2025-03-16 22:12:53 +0800
description: "本文主要研究拖拽API以实现列表排序，以及移动端实现。"
keywords: "HTML5 drag API实现列表拖拽排序"
categories: ['业务']
tags: ['前端']
artid: "146301205"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146301205
    alt: "HTML5-drag-API实现列表拖拽排序"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146301205
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146301205
cover: https://bing.ee123.net/img/rand?artid=146301205
image: https://bing.ee123.net/img/rand?artid=146301205
img: https://bing.ee123.net/img/rand?artid=146301205
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     HTML5 drag API实现列表拖拽排序
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <blockquote>
     <p>
      拖拽API（Drag and Drop API）是HTML5提供的一组功能，使得在网页上实现拖放操作变得更加简单和强大。这个API允许开发者为网页元素添加拖拽功能，用户可以通过鼠标将元素拖动并放置到指定的目标区域。
     </p>
    </blockquote>
    <h3>
     <a id="_1">
     </a>
     事件类型
    </h3>
    <ul>
     <li>
      dragstart：事件主体是被拖放元素，在开始拖放被拖放元素时触发。
     </li>
     <li>
      darg：事件主体是被拖放元素，在正在拖放被拖放元素时触发。
     </li>
     <li>
      dragenter：事件主体是目标元素，在被拖放元素进入某元素时触发。
     </li>
     <li>
      dragover：事件主体是目标元素，在被拖放在某元素内移动时触发。
     </li>
     <li>
      dragleave：事件主体是目标元素，在被拖放元素移出目标元素是触发。
     </li>
     <li>
      drop：事件主体是目标元素，在目标元素完全接受被拖放元素时触发。
     </li>
     <li>
      dragend：事件主体是被拖放元素，在整个拖放操作结束时触发。
     </li>
    </ul>
    <h3>
     <a id="Draggable_10">
     </a>
     Draggable属性
    </h3>
    <p>
     HTML元素可以通过设置
     <code>
      draggable
     </code>
     属性为
     <code>
      true
     </code>
     来启用拖动。例如：
    </p>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">draggable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>可拖动的元素<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h3>
     <a id="DataTransfer_15">
     </a>
     DataTransfer对象
    </h3>
    <p>
     这些事件中的
     <code>
      event
     </code>
     对象包含一个
     <code>
      dataTransfer
     </code>
     属性，用于存储和传递拖拽的数据。例如，可以使用
     <code>
      dataTransfer.setData
     </code>
     和
     <code>
      dataTransfer.getData
     </code>
     方法来设置和获取拖拽的数据。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/32cdb60ed05f44feaa5a5c3683ceebee.png"/>
    </p>
    <h3>
     <a id="_18">
     </a>
     列表拖拽排序
    </h3>
    <h4>
     <a id="_19">
     </a>
     演示
    </h4>
    <p>
    </p>
    <div class="video">
     <iframe allowfullscreen="true" data-mediaembed="csdn" frameborder="0" id="WC7EBHPh-1742133668536" src="https://live.csdn.net/v/embed/469176" style="width:100%;height:100%;">
     </iframe>
     <p>
      列表拖拽排序
     </p>
    </div>
    <p>
    </p>
    <h4>
     <a id="_23">
     </a>
     完整代码
    </h4>
    <p>
     index.css
    </p>
    <pre><code class="prism language-css"><span class="token selector">.list</span> <span class="token punctuation">{<!-- --></span>
     <span class="token property">padding</span><span class="token punctuation">:</span> 24px 5%<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.list .list-item</span> <span class="token punctuation">{<!-- --></span>
    <span class="token property">cursor</span><span class="token punctuation">:</span> move<span class="token punctuation">;</span>
    <span class="token property">user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> royalblue<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 16px 24px<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
    <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.list-item.moving</span> <span class="token punctuation">{<!-- --></span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> #ccc<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     index.html
    </p>
    <pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">doctype</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./index.css<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">draggable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">draggable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">draggable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">draggable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">draggable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./index.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     index.js
    </p>
    <pre><code class="prism language-js"><span class="token keyword">const</span> list <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> source<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleDragStart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
   <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
       e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'moving'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置拖拽样式</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    source <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
   e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>effectAllowed <span class="token operator">=</span> <span class="token string">'move'</span><span class="token punctuation">;</span> <span class="token comment">// 设置鼠标样式</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleDragEnter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>source<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> target <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">===</span> list <span class="token operator">||</span> target <span class="token operator">===</span> source<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 如果进入的元素是父元素或者是被拖动元素则不处理</span>
    <span class="token keyword">const</span> sourceIndex <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// children是类数组，对象类型</span>
    <span class="token keyword">const</span> targetIndex <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sourceIndex <span class="token operator">&lt;</span> targetIndex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 向下拖</span>
        list<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将目标元素插入到被拖拽元素之前</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 向上拖</span>
        list<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将被拖拽元素插入到目标元素之前</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleDragEnd</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'moving'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 移除拖拽样式</span>
    source <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

list<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'dragstart'</span><span class="token punctuation">,</span> handleDragStart<span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'dragenter'</span><span class="token punctuation">,</span> handleDragEnter<span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'dragend'</span><span class="token punctuation">,</span> handleDragEnd<span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'dragover'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 目标元素默认不允许被其他元素进入，被拖拽元素会回到原来位置，需要阻止此默认行为</span>
</code></pre>
    <h3>
     <a id="_Drag_APIDrag_and_Drop_API_103">
     </a>
     移动端对 Drag API（Drag and Drop API）的支持
    </h3>
    <p>
     <strong>
      支持较差，原因如下：
     </strong>
    </p>
    <ol>
     <li>
      <p>
       <strong>
        原生支持有限
       </strong>
      </p>
      <ul>
       <li>
        移动端的触摸事件（
        <code>
         touchstart
        </code>
        、
        <code>
         touchmove
        </code>
        、
        <code>
         touchend
        </code>
        ）与鼠标事件不同，很多浏览器不会触发
        <code>
         dragstart
        </code>
        、
        <code>
         dragover
        </code>
        、
        <code>
         drop
        </code>
        等拖拽相关的事件。
       </li>
       <li>
        iOS 的 Safari 以及 Android 浏览器大多数情况下
        <strong>
         不支持
        </strong>
        <code>
         Drag API
        </code>
        ，特别是在 WebView 内。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        触摸事件冲突
       </strong>
      </p>
      <ul>
       <li>
        触摸屏幕时，系统会优先触发
        <code>
         touch
        </code>
        事件，而非
        <code>
         drag
        </code>
        事件，导致
        <code>
         Drag API
        </code>
        无法正常工作。
       </li>
       <li>
        例如，在 iOS 上，
        <code>
         touchmove
        </code>
        会默认滚动页面，而不会触发
        <code>
         drag
        </code>
        相关的事件。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        性能和交互体验
       </strong>
      </p>
      <ul>
       <li>
        在移动端，拖拽操作通常由
        <strong>
         手势
        </strong>
        代替，比如滑动、长按拖动等。
       </li>
       <li>
        例如，
        <strong>
         HTML5
         <code>
          Draggable
         </code>
         属性
        </strong>
        在桌面端可以生效，但在移动端一般不会响应
        <code>
         dragstart
        </code>
        事件。
       </li>
      </ul>
     </li>
    </ol>
    <h4>
     <a id="_118">
     </a>
     解决方案：
    </h4>
    <p>
     如果想在移动端实现拖拽效果，推荐使用：
    </p>
    <ol>
     <li>
      <p>
       <strong>
        Touch Events
       </strong>
       代替
       <code>
        Drag API
       </code>
      </p>
      <ul>
       <li>
        监听
        <code>
         touchstart
        </code>
        、
        <code>
         touchmove
        </code>
        、
        <code>
         touchend
        </code>
        事件，手动计算元素位置并移动。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        第三方库
       </strong>
       （更方便）
      </p>
      <ul>
       <li>
        <a href="https://github.com/SortableJS/Sortable">
         SortableJS
        </a>
        （支持 PC 和移动端）
       </li>
       <li>
        <a href="https://interactjs.io/" rel="nofollow">
         Interact.js
        </a>
        （提供更丰富的拖拽交互）
       </li>
      </ul>
     </li>
    </ol>
    <h4>
     <a id="_127">
     </a>
     示例代码：
    </h4>
    <p>
     如果你想在移动端实现拖拽，建议使用
     <code>
      touchmove
     </code>
     事件，例如：
    </p>
    <p>
    </p>
    <div class="csdn-video-box" data-report-view='{"spm":"3001.10261","extra":{"id":"Xodv2C9S-1742133957696"}}'>
     <iframe allowfullscreen="true" data-mediaembed="csdn" frameborder="0" id="Xodv2C9S-1742133957696" src="https://live.csdn.net/v/embed/469198">
     </iframe>
     <p>
      移动端拖拽
     </p>
    </div>
    <p>
    </p>
    <pre><code class="prism language-js"><span class="token keyword">const</span> item <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"draggable"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> offsetX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 记录触摸点相对元素左上角的偏移</span>
<span class="token keyword">let</span> offsetY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

item<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"touchstart"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> touch <span class="token operator">=</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 获取元素当前位置</span>
    <span class="token keyword">let</span> rect <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 计算触摸点相对元素左上角的偏移</span>
    offsetX <span class="token operator">=</span> touch<span class="token punctuation">.</span>clientX <span class="token operator">-</span> rect<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
    offsetY <span class="token operator">=</span> touch<span class="token punctuation">.</span>clientY <span class="token operator">-</span> rect<span class="token punctuation">.</span>top<span class="token punctuation">;</span>

    <span class="token comment">// 使元素绝对定位</span>
    item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">"absolute"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

item<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"touchmove"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 阻止滚动</span>

    <span class="token keyword">let</span> touch <span class="token operator">=</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 计算元素的新位置，保持触摸点在元素内的相对位置</span>
    <span class="token keyword">let</span> newLeft <span class="token operator">=</span> touch<span class="token punctuation">.</span>clientX <span class="token operator">-</span> offsetX<span class="token punctuation">;</span>
    <span class="token keyword">let</span> newTop <span class="token operator">=</span> touch<span class="token punctuation">.</span>clientY <span class="token operator">-</span> offsetY<span class="token punctuation">;</span>

    item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> newLeft <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span>
    item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> newTop <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     这样可以在移动端实现类似拖拽的效果，而不依赖
     <code>
      Drag API
     </code>
     。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34343730343734302f:61727469636c652f64657461696c732f313436333031323035" class_="artid" style="display:none">
 </p>
</div>


