---
layout: post
title: "C设计模式第二十三篇观察者模式Observer"
date: 2025-03-12 09:47:25 +0800
description: "事件驱动的订阅通知机制"
keywords: "​【C++设计模式】第二十三篇：观察者模式（Observer）"
categories: ['C']
tags: ['设计模式', '观察者模式', 'C']
artid: "146196315"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146196315
    alt: "C设计模式第二十三篇观察者模式Observer"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146196315
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146196315
cover: https://bing.ee123.net/img/rand?artid=146196315
image: https://bing.ee123.net/img/rand?artid=146196315
img: https://bing.ee123.net/img/rand?artid=146196315
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ​【C++设计模式】第二十三篇：观察者模式（Observer）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <code>
      注意：复现代码时，确保 VS2022 使用 C++17/20 标准以支持现代特性。
     </code>
    </p>
    <h3>
     <a id="_2">
     </a>
     事件驱动的订阅通知机制
    </h3>
    <hr/>
    <h3>
     <a id="1__4">
     </a>
     1. 模式定义与用途
    </h3>
    <h4>
     <a id="_5">
     </a>
     核心思想
    </h4>
    <ul>
     <li>
      ​
      <strong>
       观察者模式
      </strong>
      ：定义一种
      <strong>
       一对多依赖关系
      </strong>
      ，当一个对象（主题）状态改变时，所有依赖它的对象（观察者）​
      <strong>
       自动收到通知并更新
      </strong>
      。
      <br/>
      ​-
      <strong>
       关键用途
      </strong>
      ：
      <br/>
      1.​
      <strong>
       解耦发布者与订阅者
      </strong>
      ：主题无需知道观察者的具体实现。
      <br/>
      ​2.
      <strong>
       实时通知
      </strong>
      ：支持动态添加或移除观察者。
      <br/>
      ​3.
      <strong>
       事件驱动架构
      </strong>
      ：适用于GUI事件处理、数据监控、消息队列等场景。
     </li>
    </ul>
    <h4>
     <a id="_11">
     </a>
     经典场景
    </h4>
    <ul>
     <li>
      股票价格变动通知多个交易终端。
     </li>
     <li>
      用户界面控件状态同步（如按钮点击触发面板更新）。
     </li>
     <li>
      传感器数据监控与报警系统。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="2__16">
     </a>
     2. 模式结构解析
    </h3>
    <h4>
     <a id="UML_17">
     </a>
     UML类图
    </h4>
    <pre><code class="prism language-plaintext">+---------------------+          +---------------------+  
|       Subject        |          |      Observer       |  
+---------------------+          +---------------------+  
| + attach(o: Observer)|          | + update(): void    |  
| + detach(o: Observer)|          +---------------------+  
| + notify()           |                    ^  
+---------------------+                    |  
          ^                                |  
          |                        +-------+-------+  
          |                        |               |  
+---------------------+    +-------------------+ +-------------------+  
|    ConcreteSubject  |    | ConcreteObserverA | | ConcreteObserverB |  
+---------------------+    +-------------------+ +-------------------+  
| + getState()        |    | + update()        | | + update()        |  
| + setState()        |    +-------------------+ +-------------------+  
+---------------------+  
</code></pre>
    <h4>
     <a id="_36">
     </a>
     角色说明
    </h4>
    <ol>
     <li>
      <code>
       Subject
      </code>
      ：主题接口，管理观察者列表，提供订阅/取消订阅方法。
     </li>
     <li>
      ​
      <code>
       ConcreteSubject
      </code>
      ：具体主题，存储状态并在状态变化时通知观察者。
     </li>
     <li>
      <code>
       Observer
      </code>
      ：观察者接口，定义更新方法
      <code>
       update()
      </code>
      。
     </li>
     <li>
      <code>
       ConcreteObserver
      </code>
      ：具体观察者，实现更新逻辑。
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="3_C_42">
     </a>
     3. 现代C++实现示例
    </h3>
    <h4>
     <a id="_43">
     </a>
     场景：股票价格变动通知系统
    </h4>
    <h5>
     <a id="1_44">
     </a>
     ​步骤1：定义主题与观察者接口
    </h5>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;memory&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unordered_set&gt;</span>  </span>

<span class="token comment">// 前向声明  </span>
<span class="token keyword">class</span> <span class="token class-name">StockObserver</span><span class="token punctuation">;</span>  

<span class="token comment">// 主题接口  </span>
<span class="token keyword">class</span> <span class="token class-name">StockSubject</span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">StockSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>  
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">attach</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>StockObserver<span class="token operator">&gt;</span> observer<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">detach</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>StockObserver<span class="token operator">&gt;</span> observer<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  

<span class="token comment">// 观察者接口  </span>
<span class="token keyword">class</span> <span class="token class-name">StockObserver</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> std<span class="token double-colon punctuation">::</span><span class="token class-name">enable_shared_from_this</span><span class="token operator">&lt;</span><span class="token class-name">StockObserver</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">StockObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>  
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
</code></pre>
    <h5>
     <a id="2_71">
     </a>
     步骤2：实现具体主题（股票）
    </h5>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Stock</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">StockSubject</span></span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token function">Stock</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> symbol<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">symbol_</span><span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">price_</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>  

    <span class="token keyword">void</span> <span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        price_ <span class="token operator">=</span> price<span class="token punctuation">;</span>  
        <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token keyword">void</span> <span class="token function">attach</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>StockObserver<span class="token operator">&gt;</span> observer<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>  
        observers_<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token keyword">void</span> <span class="token function">detach</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>StockObserver<span class="token operator">&gt;</span> observer<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>  
        observers_<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> observer <span class="token operator">:</span> observers_<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            observer<span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span>price_<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  

<span class="token keyword">private</span><span class="token operator">:</span>  
    std<span class="token double-colon punctuation">::</span>string symbol_<span class="token punctuation">;</span>  
    <span class="token keyword">double</span> price_<span class="token punctuation">;</span>  
    std<span class="token double-colon punctuation">::</span>unordered_set<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>StockObserver<span class="token operator">&gt;&gt;</span> observers_<span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
</code></pre>
    <h5>
     <a id="3_103">
     </a>
     步骤3：实现具体观察者（交易终端）​
    </h5>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">TradingTerminal</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">StockObserver</span></span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token function">TradingTerminal</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">name_</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>  

    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"终端 ["</span> <span class="token operator">&lt;&lt;</span> name_ <span class="token operator">&lt;&lt;</span> <span class="token string">"] 收到报价: $"</span> <span class="token operator">&lt;&lt;</span> price <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>price <span class="token operator">&gt;</span> alertThreshold_<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"警告：价格超过阈值！\n"</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  

    <span class="token keyword">void</span> <span class="token function">setAlertThreshold</span><span class="token punctuation">(</span><span class="token keyword">double</span> threshold<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        alertThreshold_ <span class="token operator">=</span> threshold<span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

<span class="token keyword">private</span><span class="token operator">:</span>  
    std<span class="token double-colon punctuation">::</span>string name_<span class="token punctuation">;</span>  
    <span class="token keyword">double</span> alertThreshold_ <span class="token operator">=</span> <span class="token number">100.0</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
</code></pre>
    <h5>
     <a id="4_126">
     </a>
     步骤4：客户端代码
    </h5>
    <pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token comment">// 创建股票与观察者  </span>
    <span class="token keyword">auto</span> appleStock <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>Stock<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">"AAPL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">auto</span> terminal1 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>TradingTerminal<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">"终端1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">auto</span> terminal2 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>TradingTerminal<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">"终端2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    terminal2<span class="token operator">-&gt;</span><span class="token function">setAlertThreshold</span><span class="token punctuation">(</span><span class="token number">150.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token comment">// 订阅股票价格  </span>
    appleStock<span class="token operator">-&gt;</span><span class="token function">attach</span><span class="token punctuation">(</span>terminal1<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    appleStock<span class="token operator">-&gt;</span><span class="token function">attach</span><span class="token punctuation">(</span>terminal2<span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token comment">// 更新价格并触发通知  </span>
    appleStock<span class="token operator">-&gt;</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token number">120.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token comment">/* 输出：  
        终端 [终端1] 收到报价: $120.5  
        警告：价格超过阈值！  
        终端 [终端2] 收到报价: $120.5  
    */</span>  

    <span class="token comment">// 取消订阅终端2  </span>
    appleStock<span class="token operator">-&gt;</span><span class="token function">detach</span><span class="token punctuation">(</span>terminal2<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    appleStock<span class="token operator">-&gt;</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token number">160.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token comment">/* 输出：  
        终端 [终端1] 收到报价: $160  
        警告：价格超过阈值！  
    */</span>  
<span class="token punctuation">}</span>  
</code></pre>
    <hr/>
    <h3>
     <a id="4__158">
     </a>
     4. 应用场景示例
    </h3>
    <h4>
     <a id="1GUI_159">
     </a>
     场景1：GUI事件处理
    </h4>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token keyword">void</span> <span class="token function">addListener</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>ButtonListener<span class="token operator">&gt;</span> listener<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        listeners_<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token keyword">void</span> <span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token comment">// 触发点击事件  </span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> listener <span class="token operator">:</span> listeners_<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            listener<span class="token operator">-&gt;</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  

<span class="token keyword">private</span><span class="token operator">:</span>  
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>ButtonListener<span class="token operator">&gt;&gt;</span> listeners_<span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  

<span class="token keyword">class</span> <span class="token class-name">LoggingListener</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">ButtonListener</span></span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"按钮被点击，记录日志\n"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
</code></pre>
    <h4>
     <a id="2_186">
     </a>
     场景2：气象站数据监控
    </h4>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">WeatherStation</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Subject</span></span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token keyword">void</span> <span class="token function">setTemperature</span><span class="token punctuation">(</span><span class="token keyword">double</span> temp<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        temperature_ <span class="token operator">=</span> temp<span class="token punctuation">;</span>  
        <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  

<span class="token keyword">class</span> <span class="token class-name">PhoneApp</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Observer</span></span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">double</span> temp<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"手机APP更新温度: "</span> <span class="token operator">&lt;&lt;</span> temp <span class="token operator">&lt;&lt;</span> <span class="token string">"°C\n"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
</code></pre>
    <hr/>
    <h3>
     <a id="5__206">
     </a>
     5. 优缺点分析
    </h3>
    <table>
     <thead>
      <tr>
       <th align="left">
        ​优点
       </th>
       <th align="left">
        ​缺点
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        松耦合设计，主题与观察者独立演化
       </td>
       <td align="left">
        观察者可能收到不相关通知（需过滤逻辑）
       </td>
      </tr>
      <tr>
       <td align="left">
        支持动态订阅机制
       </td>
       <td align="left">
        链式触发可能导致性能问题（级联更新）
       </td>
      </tr>
      <tr>
       <td align="left">
        简化事件分发逻辑
       </td>
       <td align="left">
        需注意内存泄漏（观察者未正确注销）
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h3>
     <a id="6__213">
     </a>
     6. 调试与优化策略
    </h3>
    <h4>
     <a id="VS2022_214">
     </a>
     调试技巧（VS2022）​
    </h4>
    <h5>
     <a id="1__215">
     </a>
     1. ​验证通知触发：
    </h5>
    <ul>
     <li>
      在
      <code>
       notify()
      </code>
      方法中设置断点，检查观察者列表是否正确更新。
     </li>
    </ul>
    <h5>
     <a id="2__217">
     </a>
     2. 跟踪观察者状态：
    </h5>
    <ul>
     <li>
      使用
      <strong>
       ​内存诊断工具
      </strong>
      确保观察者对象在注销后被正确释放。
     </li>
    </ul>
    <h4>
     <a id="_219">
     </a>
     ​性能优化
    </h4>
    <h5>
     <a id="1__220">
     </a>
     1. 批量通知：
    </h5>
    <ul>
     <li>
      合并多次状态变更，延迟发送通知（如防抖处理）。
     </li>
    </ul>
    <pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">Stock</span><span class="token double-colon punctuation">::</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    price_ <span class="token operator">=</span> price<span class="token punctuation">;</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>needNotify_<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 防抖逻辑  </span>
        <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        needNotify_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
</code></pre>
    <h5>
     <a id="2__232">
     </a>
     2. 异步通知：
    </h5>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;future&gt;</span>  </span>
<span class="token keyword">void</span> <span class="token class-name">Stock</span><span class="token double-colon punctuation">::</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    std<span class="token double-colon punctuation">::</span><span class="token function">async</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>launch<span class="token double-colon punctuation">::</span>async<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> observer <span class="token operator">:</span> observers_<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            observer<span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span>price_<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e637364:6e2e6e65742f4a7569637941637469766547696c626572742f:61727469636c652f64657461696c732f313436313936333135" class_="artid" style="display:none">
 </p>
</div>


