---
layout: post
title: "DOCKER模式部署GITLAB"
date: 2025-03-07 14:08:05 +0800
description: "首次登录用户 root，密码存储在：/etc/gitlab/config/initial_root_password，24小时后将被清理，所以要立即修改密码。下载地址https://download.docker.com/linux/ubuntu/dists/noble/pool/stable/amd64/external_url 'http://gitlab.yourdomain.com'  # 外部访问地址。将SSL证书放入 ~/gitlab/config/ssl。"
keywords: "DOCKER模式部署GITLAB"
categories: ['未分类']
tags: ['容器', 'Gitlab', 'Docker']
artid: "146094462"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146094462
    alt: "DOCKER模式部署GITLAB"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146094462
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146094462
cover: https://bing.ee123.net/img/rand?artid=146094462
image: https://bing.ee123.net/img/rand?artid=146094462
img: https://bing.ee123.net/img/rand?artid=146094462
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     DOCKER模式部署GITLAB
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="text-align:justify">
     1.系统准备
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     服务器操作系统 ubuntu 24.04 mini安装
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     1.1 更新系统
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # apt update &amp;&amp; sudo apt upgrade -y
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     1.2 安装必要工具
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # apt install -y curl wget nano
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     2. 安装Docker和Docker Compose
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     2.1 安装Docker
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # curl -fsSL https://get.docker.com | sudo sh
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     执行失败，反复多次，无果。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="38" src="https://i-blog.csdnimg.cn/direct/1634a9041158498fac01b894a6faa6ca.png" width="576"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     尝试直接安装docker-ce及相关组件
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # apt install -y docker-ce docker-ce-cli containerd.io
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     仍报错
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="221" src="https://i-blog.csdnimg.cn/direct/3541328cdb824ed288be5bee5e70aef9.png" width="554"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     手动下载安装包,一共6个deb文件。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     下载地址https://download.docker.com/linux/ubuntu/dists/noble/pool/stable/amd64/
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     containerd.io_1.7.25-1_amd64.deb
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     docker-buildx-plugin_0.21.1-1~ubuntu.24.04~noble_amd64.deb
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     docker-ce-cli_28.0.1-1~ubuntu.24.04~noble_amd64.deb
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     docker-ce-rootless-extras_28.0.1-1~ubuntu.24.04~noble_amd64.deb
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     docker-ce_28.0.1-1~ubuntu.24.04~noble_amd64.deb
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     docker-compose-plugin_2.33.1-1~ubuntu.24.04~noble_amd64.deb
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     将下载的包文件上传到服务器，执行本地安装
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # dpkg -i ./*.deb
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # usermod -aG docker $USER
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # newgrp docker  # 或重新登录终端使权限生效
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     3. 配置GitLab持久化存储
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     3.1 创建数据目录
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # mkdir -p ~/gitlab/{config,logs,data}
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     4. 编写Docker Compose文件
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     4.1 创建 docker-compose.yml
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # nano ~/gitlab/docker-compose.yml
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     4.2 输入以下内容
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     services:
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     gitlab:
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     image: gitlab/gitlab-ce:latest
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     container_name: gitlab
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     restart: always
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     hostname: 'gitlab.yourdomain.com'  # 改为你的域名或IP
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     environment:
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     GITLAB_OMNIBUS_CONFIG: |
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     external_url 'http://gitlab.yourdomain.com'  # 外部访问地址
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     gitlab_rails['time_zone'] = 'Asia/Shanghai'  # 时区设置
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # 邮箱配置（可选）
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # gitlab_rails['smtp_enable'] = true
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # gitlab_rails['smtp_address'] = "smtp.example.com"
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     ports:
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     - "80:80"
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     - "443:443"
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     - "22:22"
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     volumes:
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     - ./config:/etc/gitlab
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     - ./logs:/var/log/gitlab
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     - ./data:/var/opt/gitlab
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     shm_size: '256m'  # 共享内存大小
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     5. 启动GitLab容器
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # cd ~/gitlab
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # docker compose up -d
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="101" src="https://i-blog.csdnimg.cn/direct/b5a6fb80760c46aa95014ef625088fa1.png" width="554"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     22端口冲突了，修改docker-compose.yml，将"22:22"改为"2222:22"
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     再次运行
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # docker compose up -d
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     成功
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # docker logs -f gitlab  # 监控启动日志
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     6. 防火墙配置（如启用UFW）
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     sudo ufw allow 80/tcp
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     sudo ufw allow 443/tcp
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     sudo ufw allow 2222/tcp
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     sudo ufw reload
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     7. 访问GitLab
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     打开浏览器访问 http://your-server-ip
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     首次登录用户 root，密码存储在：/etc/gitlab/config/initial_root_password，24小时后将被清理，所以要立即修改密码。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     进入gitlab后提示："Check your sign-up restrictions"，点击"Deactivate"，禁止其他人注册账号
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     8.HTTPS配置
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     将SSL证书放入 ~/gitlab/config/ssl
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     修改 external_url 为 https://gitlab.yourdomain.com
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     在 GITLAB_OMNIBUS_CONFIG 添加：
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     nginx['ssl_certificate'] = "/etc/gitlab/ssl/fullchain.pem"
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     nginx['ssl_certificate_key'] = "/etc/gitlab/ssl/privkey.pem"
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     9. 常用命令
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     启动服务       docker compose up -d
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     停止服务       docker compose down
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     更新GitLab    docker compose pull &amp;&amp; docker compose up -d
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     备份数据       docker exec -t gitlab gitlab-backup create
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     10. 故障排查
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     502错误：通常因资源不足，建议分配至少4GB内存。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     启动缓慢：检查宿主机磁盘IO性能。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     附：备份与恢复
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     备份
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     docker exec -t gitlab gitlab-backup create
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     恢复
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     docker exec -t gitlab gitlab-backup restore BACKUP=备份文件名
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f6c696f6e5f7a6a672f:61727469636c652f64657461696c732f313436303934343632" class_="artid" style="display:none">
 </p>
</div>


