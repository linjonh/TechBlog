---
layout: post
title: "DHCP中继实验"
date: 2025-03-14 16:59:16 +0800
description: "用于跨子网或跨 VLAN 的环境中，帮助客户端通过路由器或三层交换机将 DHCP 请求转发到远程 DHCP 服务器。"
keywords: "DHCP中继实验"
categories: ['未分类']
tags: ['网络安全', '网络协议', '网络']
artid: "146261620"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146261620
    alt: "DHCP中继实验"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146261620
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146261620
cover: https://bing.ee123.net/img/rand?artid=146261620
image: https://bing.ee123.net/img/rand?artid=146261620
img: https://bing.ee123.net/img/rand?artid=146261620
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     DHCP中继实验
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="DHCP_0">
     </a>
     DHCP中继实验
    </h2>
    <h4>
     <a id="DHCP__2">
     </a>
     <strong>
      DHCP 中继实验简介
     </strong>
    </h4>
    <p>
     <strong>
      DHCP 中继（DHCP Relay）
     </strong>
     用于跨子网或跨 VLAN 的环境中，帮助客户端通过路由器或三层交换机将 DHCP 请求转发到远程 DHCP 服务器。
     <br/>
     <strong>
      实验目标
     </strong>
     ：验证 DHCP 中继代理的功能，实现不同子网间的动态 IP 分配。
    </p>
    <hr/>
    <h4>
     <a id="_9">
     </a>
     <strong>
      实验原理
     </strong>
    </h4>
    <h5>
     <a id="_11">
     </a>
     <strong>
      核心问题
     </strong>
    </h5>
    <ul>
     <li>
      DHCP 请求（Discover/Request）以
      <strong>
       广播形式
      </strong>
      发送，但广播包默认无法跨越路由器或三层设备。
     </li>
     <li>
      <strong>
       中继代理
      </strong>
      的作用是将客户端的广播请求转换为
      <strong>
       单播
      </strong>
      ，并转发至指定 DHCP 服务器。
     </li>
    </ul>
    <h5>
     <a id="_16">
     </a>
     <strong>
      工作流程
     </strong>
    </h5>
    <ol>
     <li>
      客户端发送广播请求
      <ul>
       <li>
        客户端在子网 A（如
        <code>
         192.168.1.0/24
        </code>
        ）广播
        <code>
         DHCP Discover
        </code>
        。
       </li>
      </ul>
     </li>
     <li>
      中继代理接收并转发
      <ul>
       <li>
        中继代理（配置在路由器或三层交换机上）捕获广播包，将其封装为单播报文：
        <ul>
         <li>
          修改目标 IP 为 DHCP 服务器地址（如
          <code>
           10.0.0.100
          </code>
          ）。
         </li>
         <li>
          在报文头插入中继代理的 IP 地址（
          <code>
           giaddr
          </code>
          字段），供服务器识别客户端所在子网。
         </li>
        </ul>
       </li>
      </ul>
     </li>
     <li>
      服务器响应
      <ul>
       <li>
        服务器根据
        <code>
         giaddr
        </code>
        判断客户端子网，从对应地址池分配 IP，通过单播返回
        <code>
         DHCP Offer
        </code>
        给中继代理。
       </li>
      </ul>
     </li>
     <li>
      中继代理转发响应
      <ul>
       <li>
        中继代理将响应报文广播回客户端子网，完成地址分配。
       </li>
      </ul>
     </li>
    </ol>
    <h3>
     <a id="_31">
     </a>
     实验拓扑
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/46591db78d3148f1bfe290387932053a.png"/>
    </p>
    <h3>
     <a id="_38">
     </a>
     实验需求
    </h3>
    <ol>
     <li>
      按照图示配置IP地址
     </li>
     <li>
      配置DHCP_server路由器为DHCP服务器，能够跨网段为
      <code>
       192.168.2.0/24
      </code>
      网段自动分配IP地址。要求分配DNS地址为
      <code>
       202.103.24.68
      </code>
      和
      <code>
       202.103.0.117
      </code>
     </li>
     <li>
      PC3获取IP地址后，能够访问到
      <code>
       192.168.1.1
      </code>
     </li>
    </ol>
    <h3>
     <a id="_46">
     </a>
     实验步骤
    </h3>
    <h6>
     <a id="1DHCP_serverIP_48">
     </a>
     1.给DHCP_server和中继路由器配置IP地址
    </h6>
    <pre><code class="prism language-powershell">在DHCP_server上
&lt;H3C&gt;system-view 
System View: <span class="token keyword">return</span> to User View with Ctrl+Z<span class="token punctuation">.</span>
<span class="token namespace">[H3C]</span>sysname DHCP_server
<span class="token namespace">[DHCP_server]</span>int g0/0
<span class="token namespace">[DHCP_server-GigabitEthernet0/0]</span>ip address 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1 24
<span class="token namespace">[DHCP_server-GigabitEthernet0/0]</span>display ip interface brief
<span class="token operator">*</span>down: administratively down
<span class="token punctuation">(</span>s<span class="token punctuation">)</span>: spoofing  <span class="token punctuation">(</span>l<span class="token punctuation">)</span>: loopback
Interface           Physical Protocol IP address/Mask    VPN instance Description  
GE0/0               up       up       192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1/24     <span class="token operator">--</span>           <span class="token operator">--</span>
GE0/1               down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
GE0/2               down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
GE5/0               down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
GE5/1               down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
GE6/0               down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
GE6/1               down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
Ser1/0              down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
Ser2/0              down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
Ser3/0              down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
Ser4/0              down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
<span class="token namespace">[DHCP_server-GigabitEthernet0/0]</span>
</code></pre>
    <pre><code class="prism language-powershell">在中继路由器上
&lt;H3C&gt;system-view 
System View: <span class="token keyword">return</span> to User View with Ctrl+Z<span class="token punctuation">.</span>
<span class="token namespace">[H3C]</span>sysname 中继路由器
<span class="token punctuation">[</span>中继路由器<span class="token punctuation">]</span>int g0/0
<span class="token punctuation">[</span>中继路由器<span class="token operator">-</span>GigabitEthernet0/0<span class="token punctuation">]</span>ip address 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>2 24
<span class="token punctuation">[</span>中继路由器<span class="token operator">-</span>GigabitEthernet0/0<span class="token punctuation">]</span>int g0/1
<span class="token punctuation">[</span>中继路由器<span class="token operator">-</span>GigabitEthernet0/1<span class="token punctuation">]</span>ip address 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>2<span class="token punctuation">.</span>254 24
<span class="token punctuation">[</span>中继路由器<span class="token operator">-</span>GigabitEthernet0/1<span class="token punctuation">]</span>display ip interface brief
<span class="token operator">*</span>down: administratively down
<span class="token punctuation">(</span>s<span class="token punctuation">)</span>: spoofing  <span class="token punctuation">(</span>l<span class="token punctuation">)</span>: loopback
Interface           Physical Protocol IP address/Mask    VPN instance Description  
GE0/0               up       up       192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>2/24     <span class="token operator">--</span>           <span class="token operator">--</span>
GE0/1               down     down     192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>2<span class="token punctuation">.</span>254/24   <span class="token operator">--</span>           <span class="token operator">--</span>
GE0/2               down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
GE5/0               down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
GE5/1               down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
GE6/0               down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
GE6/1               down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
Ser1/0              down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
Ser2/0              down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
Ser3/0              down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
Ser4/0              down     down     <span class="token operator">--</span>                 <span class="token operator">--</span>           <span class="token operator">--</span>
<span class="token punctuation">[</span>中继路由器<span class="token operator">-</span>GigabitEthernet0/1<span class="token punctuation">]</span>
</code></pre>
    <h6>
     <a id="2R1DHCP1921682024IP_104">
     </a>
     2.
     <strong>
      配置R1为DHCP服务器，能够跨网段为192.168.2.0/24网段自动分配IP地址
     </strong>
    </h6>
    <h6>
     <a id="DHCPPCIPpcIPDHCPDHCP_server1921682024DHCP1921682024g01IP1921682254DHCPIPDHCPDHCP1921682024DHCP_serverDHCP_serverPC3DHCP_server1921682024_106">
     </a>
     注：默认情况下，DHCP只能为和本机处于同一网段的PC客户端分配IP地址。而我们现在却要求去跨网段给pc机分配IP地址，就需要配置DHCP中继来实现，在DHCP_server上创建的地址池必须要宣告192.168.2.0/24网段。DHCP分配的网关地址应该是192.168.2.0/24网段的真实网关，那根据上述拓扑可知，网关就是中继路由器的g0/1接口，IP地址为192.168.2.254，DHCP的IP地址请求和应答报文都是广播形式发送，默认情况下，是无法穿越路由器的，所以需要在中继路由器上开启DHCP中继功能，使DHCP报文能够跨网段转发，另外，192.168.2.0/24网段对DHCP_server来说，是非直连网段，要使DHCP_server和PC3连通，DHCP_server上必须具有到达192.168.2.0/24网段的路由信息
    </h6>
    <pre><code class="prism language-powershell">在DHCP_server
<span class="token namespace">[DHCP_server]</span>dhcp enable 
<span class="token namespace">[DHCP_server]</span>dhcp server ip-pool 1
<span class="token namespace">[DHCP_server-dhcp-pool-1]</span>network 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>2<span class="token punctuation">.</span>0 mask 255<span class="token punctuation">.</span>255<span class="token punctuation">.</span>255<span class="token punctuation">.</span>0
<span class="token namespace">[DHCP_server-dhcp-pool-1]</span>gateway-list 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>2<span class="token punctuation">.</span>254
<span class="token namespace">[DHCP_server-dhcp-pool-1]</span>dns-list 202<span class="token punctuation">.</span>103<span class="token punctuation">.</span>24<span class="token punctuation">.</span>68 202<span class="token punctuation">.</span>103<span class="token punctuation">.</span>0<span class="token punctuation">.</span>117
<span class="token namespace">[DHCP_server-dhcp-pool-1]</span>
</code></pre>
    <h6>
     <a id="3DHCPg01DHCPDHCPIP_120">
     </a>
     3.
     <strong>
      在中继路由器上开启DHCP功能，并在连接客户端的接口（g0/1）上开启DHCP中继功能，并指定DHCP服务器的IP地址
     </strong>
    </h6>
    <pre><code class="prism language-powershell"><span class="token punctuation">[</span>中继路由器<span class="token punctuation">]</span>dhcp enable 
<span class="token punctuation">[</span>中继路由器<span class="token punctuation">]</span>interface g0/1
<span class="token punctuation">[</span>中继路由器<span class="token operator">-</span>GigabitEthernet0/1<span class="token punctuation">]</span>dhcp <span class="token function">select</span> relay 
<span class="token punctuation">[</span>中继路由器<span class="token operator">-</span>GigabitEthernet0/1<span class="token punctuation">]</span>dhcp relay server-address 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1
<span class="token punctuation">[</span>中继路由器<span class="token operator">-</span>GigabitEthernet0/1<span class="token punctuation">]</span>
</code></pre>
    <h6>
     <a id="4R1R1DHCPPC3_132">
     </a>
     4.
     <strong>
      在R1上配置默认路由，使R1的DHCP协议报文能够到达PC3
     </strong>
    </h6>
    <pre><code class="prism language-powershell">在DHCP_server上
<span class="token namespace">[DHCP_server]</span>ip route-static 0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0 0 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>2   <span class="token operator">/</span><span class="token operator">/</span>配置默认路由
<span class="token namespace">[DHCP_server]</span>
</code></pre>
    <h6>
     <a id="5PC3Ping_19216811Ping_142">
     </a>
     5.
     <strong>
      在PC3上Ping 192.168.1.1，确认可以Ping通
     </strong>
    </h6>
    <pre><code class="prism language-powershell">在pc3上
&lt;H3C&gt;ping 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1
Ping 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1 <span class="token punctuation">(</span>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1<span class="token punctuation">)</span>: 56 <span class="token keyword">data</span> bytes<span class="token punctuation">,</span> press CTRL_C to <span class="token keyword">break</span>
56 bytes <span class="token keyword">from</span> 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1: icmp_seq=0 ttl=254 time=0<span class="token punctuation">.</span>703 ms
56 bytes <span class="token keyword">from</span> 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1: icmp_seq=1 ttl=254 time=0<span class="token punctuation">.</span>678 ms
56 bytes <span class="token keyword">from</span> 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1: icmp_seq=2 ttl=254 time=0<span class="token punctuation">.</span>556 ms
56 bytes <span class="token keyword">from</span> 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1: icmp_seq=3 ttl=254 time=0<span class="token punctuation">.</span>733 ms
56 bytes <span class="token keyword">from</span> 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1: icmp_seq=4 ttl=254 time=0<span class="token punctuation">.</span>633 ms

<span class="token operator">--</span><span class="token operator">-</span> Ping statistics <span class="token keyword">for</span> 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1 <span class="token operator">--</span><span class="token operator">-</span>
5 packet<span class="token punctuation">(</span>s<span class="token punctuation">)</span> transmitted<span class="token punctuation">,</span> 5 packet<span class="token punctuation">(</span>s<span class="token punctuation">)</span> received<span class="token punctuation">,</span> 0<span class="token punctuation">.</span>0% packet loss
round-trip min/avg/max/std-dev = 0<span class="token punctuation">.</span>556/0<span class="token punctuation">.</span>661/0<span class="token punctuation">.</span>733/0<span class="token punctuation">.</span>062 ms
&lt;H3C&gt;<span class="token operator">%</span>Mar 14 16:55:09:206 2025 H3C PING/6/PING_STATISTICS: Ping statistics <span class="token keyword">for</span> 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1: 5 packet<span class="token punctuation">(</span>s<span class="token punctuation">)</span> transmitted<span class="token punctuation">,</span> 5 packet<span class="token punctuation">(</span>s<span class="token punctuation">)</span> received<span class="token punctuation">,</span> 0<span class="token punctuation">.</span>0% packet loss<span class="token punctuation">,</span> round-trip min/avg/max/std-dev = 0<span class="token punctuation">.</span>556/0<span class="token punctuation">.</span>661/0<span class="token punctuation">.</span>733/0<span class="token punctuation">.</span>062 ms<span class="token punctuation">.</span>

</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f36343530353735322f:61727469636c652f64657461696c732f313436323631363230" class_="artid" style="display:none">
 </p>
</div>


