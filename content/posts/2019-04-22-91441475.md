---
layout: post
title: "声网视频通话,视频直播小程序-SDK-初体验-掘金技术征文"
date: 2019-04-22 01:19:56 +0800
description: "声网 Agora 小程序 SDK 支持微信小程序实现功能, 并能与声网其他 SDK 进行互通：音视频"
keywords: "agoraminiappsdk"
categories: ['未分类']
tags: ['网络', '移动开发', '人工智能']
artid: "91441475"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=91441475
  alt: "声网视频通话,视频直播小程序-SDK-初体验-掘金技术征文"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=91441475
featuredImagePreview: https://bing.ee123.net/img/rand?artid=91441475
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     声网视频通话，视频直播小程序 SDK 初体验 | 掘金技术征文
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <div class="article-content">
     <p>
      声网 Agora 小程序 SDK 支持微信小程序实现功能, 并能与声网其他 SDK 进行互通：
     </p>
     <ul>
      <li>
       音视频通话
      </li>
      <li>
       音视频直播
      </li>
     </ul>
     <p>
      视频通话 SDK 可实现一对一单聊、多人群聊，同时具备纯语音通话和视频通话功能。
     </p>
     <p>
      视频通话和视频互动直播不同。视频通话，不分主播和观众，所有用户都可自由发言，默认流畅和低延时优先，画质稍低，典型场景如多人视频会议；互动直播，用户区分主播和观众，只有主播可以自由发言，默认高画质优先，典型场景如互动课堂。
     </p>
     <p>
      主要功能包括伴奏混音、基础美颜、屏幕共享、修改音视频原始数据和自定义视频源和渲染器等。
     </p>
     <p>
      关键特性如下图所示：
     </p>
     <p>
     </p>
     <figure>
      <figcaption>
      </figcaption>
     </figure>
     <p>
     </p>
     <p>
      视频通话支持 iOS、Android、Windows、macOS、Linux、Web、小程序，并支持平台间互通，具体的兼容性要求见下表。
     </p>
     <p>
      详细的产品概述可以直接看声网开发者中心视频通话的产品概述部分：
      <a href="https://link.juejin.im?target=https%3A%2F%2Fdocs.agora.io%2Fcn%2FVideo%2Fproduct_video%3Fplatform%3DAll%2520Platforms" rel="nofollow">
       docs.agora.io/cn/Video/pr…
      </a>
     </p>
     <p>
      本文主要是介绍一下视频通话，视频直播小程序 SDK 初体验。
     </p>
     <h3 class="heading">
      实现场景
     </h3>
     <p>
      结合微信小程序，能实现如下场景：
     </p>
     <ul>
      <li>
       线上课堂：1 对 1 及 1 对多线上小班课，老师、学生实时互动
      </li>
      <li>
       在线医疗：突破医疗资源的地域限制，实现多方视频会诊，降低诊断成本
      </li>
      <li>
       高端客服：对高价值的 VIP 客户提供远程视频服务，1 对 1 实时交流
      </li>
      <li>
       远程报警：一键报警，通过实时视频通信，为警方提供一手现场情况
      </li>
      <li>
       银行开户：实时视频认证，清晰画质、超低延时、隐私保护，提升开户效率
      </li>
     </ul>
     <h3 class="heading">
      技术方案
     </h3>
     <p>
      小程序连麦的声网实现架构图如下所示：
     </p>
     <p>
     </p>
     <figure>
      <figcaption>
      </figcaption>
     </figure>
     <p>
     </p>
     <p>
      从上面这个小程序连麦实现架构图中我们可以看出：
     </p>
     <ol>
      <li>
       在大网边缘节点部署协议转换服务对小程序端发出的 RTMP 流进行转换；
      </li>
      <li>
       将转化后的 UDP 传输到 Agora SD-RTN 上；
      </li>
      <li>
       通过 Agora SD-RTN 与 Agora 其他平台 SDK 实现音视频互通。
      </li>
     </ol>
     <h3 class="heading">
      小程序 SDK 初体验
     </h3>
     <h4 class="heading">
      首先要准备好本地的开发环境：
     </h4>
     <ol>
      <li>
       确保本地已安装微信开发者工具
      </li>
      <li>
       确保有一个支持 live-pusher 和 live-player 组件的微信公众平台账号。只有特定行业的认证企业账号才可使用这两个组件。详情请点击这里
      </li>
      <li>
       确保在微信公众平台账号的开发设置中，给予以下域名请求权限：
      </li>
     </ol>
     <ul>
      <li>
       <a href="https://link.juejin.im?target=https%3A%2F%2Fminiapp.agoraio.cn" rel="nofollow">
        miniapp.agoraio.cn
       </a>
      </li>
      <li>
       <a href="https://link.juejin.im?target=https%3A%2F%2Funi-webcollector.agora.io" rel="nofollow">
        uni-webcollector.agora.io
       </a>
      </li>
      <li>
       wss://miniapp.agoraio.cn
      </li>
     </ul>
     <p>
      一开始我在做本地测试的时候没有认真看官方文档，没有为上述域名设置请求权限，调了好久。
     </p>
     <h4 class="heading">
      运行 Demo 程序
     </h4>
     <ol>
      <li>
       <p>
        在 Agora.io 注册账号，并创建自己的测试项目，获取 App ID。如需获取 Token 或 Channel Key，请启用 App Certificate
       </p>
      </li>
      <li>
       <p>
        下载示例程序代码
       </p>
      </li>
      <li>
       <p>
        打开 utils 文件夹，在 config.js 文件中填入获取到的 App ID：
       </p>
      </li>
     </ol>
     <pre><code class="hljs bash copyable">const APPID = <span class="hljs-string">""</span>;

<span class="hljs-keyword">if</span>(APPID === <span class="hljs-string">""</span>){
wx.showToast({
title: `请在config.js中提供正确的appid`,
icon: <span class="hljs-string">'none'</span>,
duration: 5000
});
}

module.exports = {
APPID: APPID
}
<span class="copy-code-btn">复制代码</span></code></pre>
<ol start="4">
<li>
<p>
下载 Agora Miniapp SDK，并将 SDK 重新命名为 “mini-app-sdk-production.js"
</p>
</li>
<li>
<p>
将更名后的 "mini-app-sdk-production.js" 文件保存在本示例程序的 lib 文件夹下
</p>
</li>
<li>
<p>
启动微信开发者工具并导入该示例程序
</p>
</li>
<li>
<p>
输入频道名，加入频道。邀请你的朋友加入同一个频道，就可以开始视频互通了。
</p>
</li>
</ol>
<h4 class="heading">
注意
</h4>
<p>
如果启用了 App Certificate，还需要在服务端生成 Token 或 Dynamic Key 用于鉴权。将生成的 Token 或 Dynamic Key 填入如下方法中：
</p>
<pre><code class="hljs bash copyable">//...
client.join(&lt;your key/access token here&gt;, channel, uid, () =&gt; {
//...
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 class="heading">
在线体验
</h3>
<p>
除了 SDK，声网也提供了在线体验小程序 Demo。
</p>
<p>
在 Android 或 iOS 上打开微信 App, 扫描识别下面的二维码，即可快速体验 Agora 小程序解决方案。
</p>
<p>
</p>
<figure>
<figcaption>
</figcaption>
</figure>
<p>
</p>
<p>
在小程序界面上输入你想要进入的房间名，点击 加入房间 即可进入小程序频道。
</p>
<p>
其他用户在自己的小程序上输入相同的房间名，点击 加入房间，即可进入相同的频道，实现通话。
</p>
<p>
你还可以点击屏幕上的按钮，依次体验 静音、切换摄像头、美颜 等功能。
</p>
<p>
前文也说过，视频通话支持 iOS、Android、Windows、macOS、Linux、Web、小程序，并支持平台间互通。可以说做得很完善了，用起来还是很方便的，给团队赞一个。
</p>
<hr/>
<p>
<strong>
<a href="https://juejin.im/post/5ca1fa9ff265da30b6219179" rel="nofollow">
Agora SDK 使用体验征文大赛 | 掘金技术征文，征文活动正在进行中
</a>
</strong>
</p>
</div>
<p>
转载于:https://juejin.im/post/5cbd16afe51d456e2e656d51
</p>

   </div>
  </div>
  <div id="recommendDown">
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f67:2e6373646e2e6e65742f77656978696e5f3333373239313936:2f61727469636c652f64657461696c732f3931343431343735" class_="artid" style="display:none">
 </p>
</div>
