---
layout: post
title: "51单片机程序实验16.DS1302时钟"
date: 2025-03-11 13:20:12 +0800
description: "DS1302是达拉斯公司生产的时钟芯片，其具体特点如下：①具有涓流充电的充电方式，涓流充电通过小电流持续充电来补偿电池的自放电损失，可以有效延长电池使用寿命，保持高饱和度的电量状态。且有主电源和备用电源双电源管脚，避免断电后时钟数据损失。②具有时钟、日历功能，可以计算2100年之前的时间信息，有闰年调整功能。③工作电压为3.0~5.5V，在2.0V时电流为300nA，功耗极低。④具有单字节传送和多字节传送字符组两种读写方式。⑤具有DIP和SIOC两种封装方式，本实验板载为SIOC封装，体积非常小。"
keywords: "【51单片机】程序实验16.DS1302时钟"
categories: ['51单片机']
tags: ['嵌入式硬件', 'Mongodb', '51单片机']
artid: "146176383"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146176383
    alt: "51单片机程序实验16.DS1302时钟"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146176383
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146176383
cover: https://bing.ee123.net/img/rand?artid=146176383
image: https://bing.ee123.net/img/rand?artid=146176383
img: https://bing.ee123.net/img/rand?artid=146176383
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【51单片机】程序实验16.DS1302时钟
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <blockquote>
     <p>
      主要参考学习资料：B站【普中官方】51单片机手把手教学视频
     </p>
     <p>
      开发资料下载链接：http://www.prechin.cn/gongsixinwen/208.html
     </p>
     <p>
      单片机套装：普中STC51单片机开发板A4标准版套餐7
     </p>
    </blockquote>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="DS1302_7">
     </a>
     DS1302时钟芯片介绍
    </h2>
    <h3>
     <a id="DS1302_9">
     </a>
     DS1302简介
    </h3>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/direct/e5139d161a0c44d99a0801c38d35b22f.png"/>
    </p>
    <p>
     DS1302是达拉斯公司生产的时钟芯片，其具体特点如下：
    </p>
    <p>
     ①具有涓流充电的充电方式，涓流充电通过小电流持续充电来补偿电池的自放电损失，可以有效延长电池使用寿命，保持高饱和度的电量状态。且有主电源和备用电源双电源管脚，避免断电后时钟数据损失。
    </p>
    <p>
     ②具有时钟、日历功能，可以计算2100年之前的时间信息，有闰年调整功能。
    </p>
    <p>
     ③工作电压为3.0~5.5V，在2.0V时电流为300nA，功耗极低。
    </p>
    <p>
     ④具有单字节传送和多字节传送字符组两种读写方式。
    </p>
    <p>
     ⑤具有DIP和SIOC两种封装方式，本实验板载为SIOC封装，体积非常小。
    </p>
    <p>
     ⑥通过三线制SPI串行接口与单片机通信，分别为复位信号线（使能线）、I/O数据线和时钟线，而标准的SPI分别由MISO和MOSI来实现数据的输出和输入。
    </p>
    <p>
     ⑦兼容TTL电平，可以直接跟单片机IO口连接。
    </p>
    <p>
     ⑧工作温度范围为-40℃~85℃。
    </p>
    <p>
     DS1302八个管脚的功能如下：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        名称
       </th>
       <th>
        功能
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        VCC2/VCC1
       </td>
       <td>
        主电源/备用电源
       </td>
      </tr>
      <tr>
       <td>
        X1/X2
       </td>
       <td>
        外部晶振管脚，提供晶振源
       </td>
      </tr>
      <tr>
       <td>
        CE
       </td>
       <td>
        使能管脚，高电平时芯片工作
       </td>
      </tr>
      <tr>
       <td>
        I/O
       </td>
       <td>
        串行数据输入输出引脚
       </td>
      </tr>
      <tr>
       <td>
        SCLK
       </td>
       <td>
        时钟引脚
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="DS1302_42">
     </a>
     DS1302使用
    </h3>
    <p>
     DS1302的使用分为两步：①从中读取时间②将读取到的时间转换到数码管或液晶显示
    </p>
    <h4>
     <a id="_46">
     </a>
     控制寄存器
    </h4>
    <p>
     控制寄存器用于存放DS1302的控制命令，对DS1302的读写进行控制。
    </p>
    <table>
     <thead>
      <tr>
       <th>
        7
       </th>
       <th>
        6
       </th>
       <th>
        5
       </th>
       <th>
        4
       </th>
       <th>
        3
       </th>
       <th>
        2
       </th>
       <th>
        1
       </th>
       <th>
        0
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        1
       </td>
       <td>
        RAM/CK
       </td>
       <td>
        A4
       </td>
       <td>
        A3
       </td>
       <td>
        A2
       </td>
       <td>
        A1
       </td>
       <td>
        A0
       </td>
       <td>
        RD/WR
       </td>
      </tr>
     </tbody>
    </table>
    <ul>
     <li>
      RAM/CK：设置操作对象，1为RAM，0为内部寄存器。
     </li>
     <li>
      A0~A4：操作对象的操作地址位。
     </li>
     <li>
      RD/WR：设置读写方向，1为读操作，2为写操作。
     </li>
    </ul>
    <p>
     以下是内部寄存器和RAM的地址表：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/direct/6135e4fe4a9f48598ca5b883c9fa2ba8.png"/>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/direct/8b15284a1be04530bd59d1733bfdcfa9.png"/>
    </p>
    <h4>
     <a id="_67">
     </a>
     日历/时钟寄存器
    </h4>
    <p>
     DS1302共有12个寄存器，其中7个与日历/时钟功能相关，它们的数据以BCD码格式存入。
    </p>
    <p>
     BCD码用4位二进制位来表示1位十进制位中的0~9，表示两位数时高八位表示十位，低八位表示个位，在处理二进制数据时通过整除16提取十位，对16取余提取个位。
    </p>
    <p>
     各个寄存器各个位的功能如下表所示：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/direct/c66197ebe13a4c4dbf6997756caa2177.png"/>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/direct/e6ddaa2e08db4332b0cd2e72e4f63dbc.png"/>
    </p>
    <p>
     特别说明：
    </p>
    <ul>
     <li>
      秒寄存器D7为DS1302运行标志位，0为工作状态，1为停止工作。
     </li>
     <li>
      小时寄存器D7为时间格式位，1为12小时制，0为24小时制,。D5和D6在12小时制下，D5区分AM/PM，D6存储小时的十位0/1；在24小时制下，D5和D6共同存储小时的十位0/1/2。
     </li>
     <li>
      写保护寄存器D7为写保护位，1开启写保护，0关闭写保护。
     </li>
     <li>
      慢充电寄存器控制涓流充电方式，很少用到，不作深入介绍。
     </li>
    </ul>
    <h4>
     <a id="_88">
     </a>
     读写时序
    </h4>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/direct/a1c9ce9408554fcea7aa94fa8b79cfd6.png"/>
    </p>
    <p>
     DS1302的数据传输方式和DS18B20相同，先传低位后传高位。
    </p>
    <p>
     在读写操作过程中，CE必须保持高电平。读写操作完成后设置CE为低电平，等待下一次操作。
    </p>
    <p>
     在时钟产生上升沿时数据一位一位由低到高进行写入，先写入控制命令，随后读字节在控制命令发送完成后的第一个下降沿开始读取，而写字节在控制命令发送完成后的第一个上升沿继续写入数据。
    </p>
    <p>
     在进行写操作前，需先将写保护寄存器的WP位设置为0，写完后再设置为1。写和读的时候数据都以BCD码格式传输。
    </p>
    <h2>
     <a id="_101">
     </a>
     硬件设计
    </h2>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/direct/b8d98491137e4c438e3a496b01b720a3.png"/>
    </p>
    <h2>
     <a id="16_DS1302_106">
     </a>
     实验16 DS1302时钟
    </h2>
    <p>
     实现功能：数码管显示电子时钟时分秒，格式为“XX-XX-XX”。
    </p>
    <p>
     数码管驱动沿用自实验14
    </p>
    <h3>
     <a id="DS1302_112">
     </a>
     DS1302驱动
    </h3>
    <p>
     <strong>
      ds1302.h
     </strong>
    </p>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_ds1302_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_ds1302_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"public.h"</span></span>

<span class="token comment">//定义复位线、时钟线和数据线管脚</span>
sbit DS1302_RST <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span>
sbit DS1302_CLK <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>
sbit DS1302_IO <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span>

<span class="token comment">//定义存储秒分时日月周年的数组</span>
<span class="token keyword">extern</span> u8 gDS1302_TIME<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">ds1302_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">ds1302_read_time</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre>
    <p>
     <strong>
      ds1302.c
     </strong>
    </p>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ds1302.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"intrins.h"</span></span>

<span class="token comment">//存储秒分时日月周年地址读写的命令</span>
u8 gWRITE_RTC_ADDR<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0x82</span><span class="token punctuation">,</span> <span class="token number">0x84</span><span class="token punctuation">,</span> <span class="token number">0x86</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0x8a</span><span class="token punctuation">,</span> <span class="token number">0x8c</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
u8 gREAD_RTC_ADDR<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0x81</span><span class="token punctuation">,</span> <span class="token number">0x83</span><span class="token punctuation">,</span> <span class="token number">0x85</span><span class="token punctuation">,</span> <span class="token number">0x87</span><span class="token punctuation">,</span> <span class="token number">0x89</span><span class="token punctuation">,</span> <span class="token number">0x8b</span><span class="token punctuation">,</span> <span class="token number">0x8d</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//存储秒分时日月周年的数组</span>
<span class="token comment">//赋值作为初始化的时间，以2025年星期二3月11日11点45分14秒为例</span>
u8 gDS1302_TIME<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0x14</span><span class="token punctuation">,</span> <span class="token number">0x45</span><span class="token punctuation">,</span> <span class="token number">0x11</span><span class="token punctuation">,</span> <span class="token number">0x11</span><span class="token punctuation">,</span> <span class="token number">0x03</span><span class="token punctuation">,</span> <span class="token number">0x02</span><span class="token punctuation">,</span> <span class="token number">0x25</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//写字节函数</span>
<span class="token keyword">void</span> <span class="token function">ds1302_write_byte</span><span class="token punctuation">(</span>u8 addr<span class="token punctuation">,</span> u8 dat<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//循环控制变量</span>
	u8 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">//复位并将时钟设为低电平</span>
	DS1302_RST <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	DS1302_CLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	DS1302_RST <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token comment">//由低到高写入地址</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//IO管脚准备好最低位信号</span>
		DS1302_IO <span class="token operator">=</span> addr <span class="token operator">&amp;</span> <span class="token number">0x01</span><span class="token punctuation">;</span>
		<span class="token comment">//次低位移至最低位</span>
		addr <span class="token operator">&gt;&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token comment">//产生上升沿使信号写入</span>
		DS1302_CLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		DS1302_CLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//由低到高写入数据</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		DS1302_IO <span class="token operator">=</span> dat <span class="token operator">&amp;</span> <span class="token number">0x01</span><span class="token punctuation">;</span>
		dat <span class="token operator">&gt;&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		DS1302_CLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		DS1302_CLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//拉低复位线等待下次操作</span>
	DS1302_RST <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//读字节函数</span>
u8 <span class="token function">ds1302_read_byte</span><span class="token punctuation">(</span>u8 addr<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//循环控制变量</span>
	u8 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">//一位存储变量</span>
	u8 temp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">//一字节存储变量</span>
	u8 value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">//复位并拉低时钟</span>
	DS1302_RST <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	DS1302_CLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	DS1302_RST <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token comment">//写入地址</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		DS1302_IO <span class="token operator">=</span> addr <span class="token operator">&amp;</span> <span class="token number">0x01</span><span class="token punctuation">;</span>
		addr <span class="token operator">&gt;&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		DS1302_CLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		DS1302_CLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//由低到高读取数据</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//存储一位</span>
		temp <span class="token operator">=</span> DS1302_IO<span class="token punctuation">;</span>
		<span class="token comment">//将字节整体右移一位并将新数据移到最高位后放入</span>
		value <span class="token operator">=</span> <span class="token punctuation">(</span>temp<span class="token operator">&lt;&lt;</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>value<span class="token operator">&gt;&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		DS1302_CLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//产生下降沿读取下一位</span>
		DS1302_CLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//拉低复位线等待下次操作</span>
	DS1302_RST <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">//如果板载P3.4没有外接上拉电阻需要手动产生上升沿脉冲</span>
	DS1302_CLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	DS1302_IO <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	DS1302_IO <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//返回读取到的字节</span>
	<span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//时间初始化函数</span>
<span class="token keyword">void</span> <span class="token function">ds1302_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//循环控制变量</span>
	u8 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">//将写保护寄存器的写保护位置零以关闭写保护</span>
	<span class="token function">ds1302_write_byte</span><span class="token punctuation">(</span><span class="token number">0x8e</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">7</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//将寄存器地址与时间数据一一对应写入</span>
		<span class="token function">ds1302_write_byte</span><span class="token punctuation">(</span>gWRITE_RTC_ADDR<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> gDS1302_TIME<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//打开写保护</span>
	<span class="token function">ds1302_write_byte</span><span class="token punctuation">(</span><span class="token number">0x8e</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//时间读取函数</span>
<span class="token comment">//由于函数不便返回数组，因此直接用开头定义好的数组存储</span>
<span class="token keyword">void</span> <span class="token function">ds1302_read_time</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//循环控制变量</span>
	u8 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">7</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//将对应寄存器地址的时间数据读取到数组</span>
		gDS1302_TIME<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">ds1302_read_byte</span><span class="token punctuation">(</span>gREAD_RTC_ADDR<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_269">
     </a>
     主函数
    </h3>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"public.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"smg.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ds1302.h"</span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//存储数码管显示段码值数组</span>
	u8 time_buf<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token comment">//时间初始化</span>
	<span class="token function">ds1302_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//读取时间</span>
		<span class="token function">ds1302_read_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//八位数码管依次存储时分秒的十位和个位，中间用杠隔开</span>
		<span class="token comment">//BCD码整除16提取十位，对16取余提取个位</span>
		time_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> gseg_code<span class="token punctuation">[</span>gDS1302_TIME<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		time_buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> gseg_code<span class="token punctuation">[</span>gDS1302_TIME<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">%</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		time_buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x40</span><span class="token punctuation">;</span>
		time_buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> gseg_code<span class="token punctuation">[</span>gDS1302_TIME<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		time_buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> gseg_code<span class="token punctuation">[</span>gDS1302_TIME<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">%</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		time_buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x40</span><span class="token punctuation">;</span>
		time_buf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> gseg_code<span class="token punctuation">[</span>gDS1302_TIME<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		time_buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> gseg_code<span class="token punctuation">[</span>gDS1302_TIME<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">%</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token comment">//显示在数码管上</span>
		<span class="token function">seg_display</span><span class="token punctuation">(</span>time_buf<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f6d6f6a696e323030352f:61727469636c652f64657461696c732f313436313736333833" class_="artid" style="display:none">
 </p>
</div>


