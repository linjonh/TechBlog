---
layout: post
title: "java中调用dll文件的两种方法"
date: 2024-12-27 20:55:26 +0800
description: "本文介绍了两种在Java中调用本地代码的方法：JNA是一个强大的框"
keywords: "stdcalllibrary"
categories: ['未分类']
tags: ['无标签']
artid: "19076557"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=19076557
    alt: "java中调用dll文件的两种方法"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=19076557
featuredImagePreview: https://bing.ee123.net/img/rand?artid=19076557
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     java中调用dll文件的两种方法
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <span style="font-size:18px">
      一中是用JNA方法，另外是用JNative方法，两种都是转载来的，
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      JNA地址：
      <a href="http://blog.csdn.net/shendl/article/details/3589676" rel="noopener noreferrer" target="_blank">
       http://blog.csdn.net/shendl/article/details/3589676
      </a>
      JNative地址：
      <a href="http://www.jb51.net/article/35232.htm" rel="nofollow noopener noreferrer" target="_blank">
       http://www.jb51.net/article/35232.htm
      </a>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      JNA方法：
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <span style="white-space:pre">
      </span>
     </span>
    </p>
    <h2>
     <span style="color:rgb(54,95,145)">
      <span style="font-size:18px">
       介绍
      </span>
     </span>
    </h2>
    <p>
    </p>
    <p>
     <span style="font-size:18px">
      给大家介绍一个最新的访问本机代码的Java框架—JNA。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      JNA(Java Native Access)框架是一个开源的Java框架，是SUN公司主导开发的，建立在经典的JNI的基础之上的一个框架。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      JNA项目地址：
      <span style="color:rgb(255,153,0)">
       <u>
        <span style="color:rgb(128,0,128)">
         <a href="https://jna.dev.java.net/" rel="nofollow noopener noreferrer" style="color:rgb(255,153,0)" target="_blank">
          https://jna.dev.java.net/
         </a>
        </span>
       </u>
      </span>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      非常强大、易用，功能上类似与.NET的P/Invoke。
     </span>
    </p>
    <h2>
     <span style="font-size:18px">
      <a name="t1" style="color:rgb(255,153,0)" target="_blank">
      </a>
      <span style="color:rgb(54,95,145)">
       不堪回首的
      </span>
      JNI
     </span>
    </h2>
    <p>
     <span style="font-size:18px">
      我们知道，使用JNI调用.dll/.so共享类库是非常非常麻烦和痛苦的。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      如果有一个现有的.dll/.so文件，如果使用JNI技术调用，我们首先需要另外使用C语言写一个.dll/.so共享库，使用SUN规定的数据结构替代C语言的数据结构，调用已有的  dll/so中公布的函数。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      然后再在Java中载入这个适配器dll/so，再编写Java   native函数作为dll中函数的代理。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      经过2个繁琐的步骤才能在Java中调用本地代码。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      因此，很少有Java程序员愿意编写调用dll/.so库中的原生函数的java程序。这也使Java语言在客户端上乏善可陈。可以说JNI是Java的一大弱点！
     </span>
    </p>
    <h2>
     <span style="font-size:18px">
      <a name="t2" style="color:rgb(255,153,0)" target="_blank">
      </a>
      <span style="color:rgb(54,95,145)">
       .NET
      </span>
      平台上强大的P/Invoke
     </span>
    </h2>
    <p>
     <span style="font-size:18px">
      而在.NET平台上，强大的P/Invoke技术使我们Java程序员非常羡慕。使用P/Invoke技术，只需要使用编写一个.NET函数，再加上一个声明的标注，就可以直接调用dll中的函数。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      不需要你再使用C语言编写dll来适配。
     </span>
    </p>
    <h2>
     <span style="font-size:18px">
      <a name="t3" style="color:rgb(255,153,0)" target="_blank">
      </a>
      <span style="color:rgb(54,95,145)">
       不逊于
      </span>
      P/Invoke的JNA
     </span>
    </h2>
    <p>
     <span style="font-size:18px">
      现在，不需要再羡慕.NET的P/Invoke机制了。JNA把对dll/.so共享库的调用减少到了和P/Invoke相同的程度。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      使用JNA，不需要再编写适配用的.dll/.so，只需要在Java中编写一个接口和一些代码，作为.dll/.so的代理，就可以在Java程序中调用dll/so。
     </span>
    </p>
    <h3>
     <span style="font-size:18px">
      <a name="t4" style="color:rgb(255,153,0)" target="_blank">
      </a>
      <span style="color:rgb(79,129,189)">
       JNA
      </span>
      快速启动
     </span>
    </h3>
    <p>
     <span style="font-size:18px">
      现在让我们直接进入JNA的世界。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      你只需要下载一个jar包，就可以使用JNA的强大功能方便地调用动态链接库中的C函数。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      1，下载jna.jar。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      在这里
      <span style="color:rgb(255,153,0)">
       <u>
        <span style="color:rgb(128,0,128)">
         <a href="https://jna.dev.java.net/servlets/ProjectDocumentList?folderID=7408&amp;expandFolder=7408&amp;folderID=0" rel="nofollow noopener noreferrer" style="color:rgb(255,153,0)" target="_blank">
          https://jna.dev.java.net/servlets/ProjectDocumentList?folderID=7408&amp;expandFolder=7408&amp;folderID=0
         </a>
        </span>
       </u>
      </span>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <span style="color:#ff0000">
       ps:这个地址好像是不能下载，我在其他下载了,地址为：
       <a href="http://jarfiles.pandaidea.com/jna.html" rel="nofollow noopener noreferrer" target="_blank">
        http://jarfiles.pandaidea.com/jna.html
       </a>
      </span>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      2，现在你已经可以使用JNA了。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      为了方便你参考JNA的java类库，我制作了《JNA3.09API参考手册》，是CHM格式的。你可以到这里下载
      <span style="color:rgb(255,153,0)">
       <u>
        <span style="color:rgb(128,0,128)">
         <a href="http://download.csdn.net/source/900438" rel="noopener noreferrer" style="color:rgb(255,153,0)" target="_blank">
          http://download.csdn.net/source/900438
         </a>
        </span>
       </u>
      </span>
     </span>
    </p>
    <h4>
     <span style="font-size:18px">
      <a name="t5" style="color:rgb(255,153,0)" target="_blank">
      </a>
      <span style="color:rgb(79,129,189)">
       JNA
      </span>
      例子
     </span>
    </h4>
    <h5>
     <span style="font-size:18px">
      <a name="t6" style="color:rgb(255,153,0)" target="_blank">
      </a>
      <span style="color:rgb(79,129,189)">
       例子
      </span>
      1
     </span>
    </h5>
    <p>
     <span style="font-size:18px">
      现在让我们运行一个JNA程序，感受它的强大威力。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      1，在Java项目中引入jna.jar包。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      2，创建一个类：
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      import com.sun.jna.Library;
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      import com.sun.jna.Native;
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      import com.sun.jna.Platform;
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      /** Simple example of native library declaration and usage. */
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      public class HelloWorld {
      <!-- -->
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      public interface CLibrary extends Library {
      <!-- -->
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      CLibrary INSTANCE = (CLibrary)
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      Native.loadLibrary((Platform.isWindows() ? "msvcrt" : "c"),
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      CLibrary.class);
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      void printf(String format, Object... args);
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      }
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      public static void main(String[] args) {
      <!-- -->
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      CLibrary.INSTANCE.printf("Hello, World/n");
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      for (int i=0;i &lt; args.length;i++) {
      <!-- -->
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      CLibrary.INSTANCE.printf("Argument %d: %s/n", i, args[i]);
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      }
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      }
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      }
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      3，执行，可以看到控制台中打印出了
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      Hello, World
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      但是，请注意，这个程序实际上是使用msvcrt.dll这个C运行时库中的printf函数打印出上面这些字符的。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      看，多简单，不需要写一行C代码，就可以直接在Java中调用外部动态链接库中的函数！
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <h5>
     <span style="font-size:18px">
      <a name="t7" style="color:rgb(255,153,0)" target="_blank">
      </a>
      <span style="color:rgb(79,129,189)">
       例子
      </span>
      2
     </span>
    </h5>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      上面那个例子使用了操作系统自带的动态链接库，现在我们再自己写一个动态链接库试试。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      1，在VS中选择C++语言，然后选择创建一个Win32程序。 选择dll类型。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      2，发布的C函数是：
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <span style="color:blue">
       #define
      </span>
      MYLIBAPI
      <span style="color:blue">
       extern
      </span>
      <span style="color:rgb(163,21,21)">
       "C"
      </span>
      <span style="color:blue">
       __declspec
      </span>
      (
      <span style="color:blue">
       dllexport
      </span>
      )
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      MYLIBAPI
      <span style="color:blue">
       void
      </span>
      say(
      <span style="color:blue">
       wchar_t
      </span>
      * pValue);
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      这个函数的实现是：
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <span style="color:blue">
       void
      </span>
      say(
      <span style="color:blue">
       wchar_t
      </span>
      * pValue){
      <!-- -->
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      std::wcout.imbue(std::locale(
      <span style="color:rgb(163,21,21)">
       "chs"
      </span>
      ));
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      std::wcout&lt;&lt;L
      <span style="color:rgb(163,21,21)">
       "上帝说："
      </span>
      &lt;&lt;pValue&lt;&lt;std::endl;
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      }
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      它需要传入一个Unicode编码的字符数组。然后在控制台上打印出一段中文字符。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      3，生成dll。然后把生成的dll文件复制到Eclipse项目中，放在项目下面。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      4，在Eclipse中编写以下代码：
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      import com.sun.jna.Library;
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      import com.sun.jna.Native;
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      import com.sun.jna.WString;
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      /**
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      * @author 沈东良 Edward Shen shendl_s@hotmail.com
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      * 2008-11-23 下午05:07:14
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      *TestDll1.dll
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      */
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      public class TestDll1Service {
      <!-- -->
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      public interface TestDll1 extends Library {
      <!-- -->
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      /**
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      * 当前路径是在项目下，而不是bin输出目录下。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      */
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      TestDll1 INSTANCE = (TestDll1)Native.loadLibrary("TestDll1", TestDll1.class);
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      public void say(WString value);
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      }
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      /**
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      *
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      */
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      public TestDll1Service() {
      <!-- -->
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      // TODO Auto-generated constructor stub
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      }
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      /**
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      * @param args
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      */
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      public static void main(String[] args) {
      <!-- -->
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      // TODO Auto-generated method stub
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      TestDll1.INSTANCE.say(new WString("Hello World!"));
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      System.out.println("HHEEH我我们无法万恶");
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      }
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      }
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      5，执行这个Java类。可以看到控制台下如下输出：
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      上帝说：Hello World!
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      HHEEH我我们无法万恶
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      6，上面一行是C语言使用C++的std::wcout输出的。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      下面一行是Java语言输出的。
     </span>
    </p>
    <h2>
     <span style="font-size:18px">
      <a name="t8" style="color:rgb(255,153,0)" target="_blank">
      </a>
      <span style="color:rgb(54,95,145)">
       JNA
      </span>
      技术解密
     </span>
    </h2>
    <h3>
     <span style="font-size:18px">
      <a name="t9" style="color:rgb(255,153,0)" target="_blank">
      </a>
      <span style="color:rgb(79,129,189)">
       JNA
      </span>
      工作原理
     </span>
    </h3>
    <p>
     <span style="font-size:18px">
      JNA是建立在JNI技术基础之上的一个Java类库，它使您可以方便地使用java直接访问动态链接库中的函数。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      原来使用JNI，你必须手工用C写一个动态链接库，在C语言中映射Java的数据类型。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      JNA中，它提供了一个动态的C语言编写的转发器，可以自动实现Java和C的数据类型映射。你不再需要编写C动态链接库。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      当然，这也意味着，使用JNA技术比使用JNI技术调用动态链接库会有些微的性能损失。可能速度会降低几倍。但影响不大。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <h3>
     <span style="font-size:18px">
      <a name="t10" style="color:rgb(255,153,0)" target="_blank">
      </a>
      <span style="color:rgb(79,129,189)">
       JNA
      </span>
      技术难点
     </span>
    </h3>
    <p>
     <span style="font-size:18px">
      1，当前路径是在项目下，而不是bin输出目录下。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      2，数据结构的对应关系：
     </span>
    </p>
    <h5>
     <span style="font-size:18px">
      <a name="t11" style="color:rgb(255,153,0)" target="_blank">
      </a>
      <span style="color:rgb(79,129,189)">
       Java—C
      </span>
      和操作系统数据类型的对应表
     </span>
    </h5>
    <div align="center">
     <table border="1" cellpadding="0" width="100%">
      <tbody>
       <tr>
        <td>
         <p>
          <strong>
           <span style="font-size:18px">
            Java Type
           </span>
          </strong>
         </p>
        </td>
        <td>
         <p>
          <strong>
           <span style="font-size:18px">
            C Type
           </span>
          </strong>
         </p>
        </td>
        <td>
         <p>
          <strong>
           <span style="font-size:18px">
            Native Representation
           </span>
          </strong>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <span style="font-size:18px">
           boolean
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           int
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           32-bit integer (customizable)
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <span style="font-size:18px">
           byte
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           char
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           8-bit integer
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <span style="font-size:18px">
           char
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           wchar_t
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           platform-dependent
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <span style="font-size:18px">
           short
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           short
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           16-bit integer
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <span style="font-size:18px">
           int
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           int
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           32-bit integer
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <span style="font-size:18px">
           long
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           long long, __int64
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           64-bit integer
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <span style="font-size:18px">
           float
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           float
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           32-bit floating point
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <span style="font-size:18px">
           double
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           double
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           64-bit floating point
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <span style="font-size:18px">
           <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/nio/Buffer.html" rel="nofollow noopener noreferrer" style="color:rgb(255,153,0)" target="_blank" title="class or interface in java.nio">
            <code>
             <span style="color:blue">
              <u>
               Buffer
              </u>
             </span>
            </code>
           </a>
           <br/>
           <a href="http://blog.csdn.net/shendl/article/details/3589676" rel="noopener noreferrer" style="color:rgb(255,153,0)" target="_blank" title="class in com.sun.jna">
            <code>
             <span style="color:blue">
              <u>
               Pointer
              </u>
             </span>
            </code>
           </a>
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           pointer
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           platform-dependent (32- or 64-bit pointer to memory)
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <span style="font-size:18px">
           &lt;T&gt;[] (array of primitive type)
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           pointer
           <br/>
           array
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           32- or 64-bit pointer to memory (argument/return)
           <br/>
           contiguous memory (struct member)
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td colspan="3">
         <p>
          <span style="font-size:18px">
           除了上面的类型，JNA还支持常见的数据类型的映射。
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/String.html" rel="nofollow noopener noreferrer" style="color:rgb(255,153,0)" target="_blank" title="class or interface in java.lang">
           <code>
            <span style="color:blue">
             <u>
              <span style="font-size:18px">
               String
              </span>
             </u>
            </span>
           </code>
          </a>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           char*
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           NUL-terminated array (native encoding or
           <code>
            jna.encoding
           </code>
           )
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <a href="http://blog.csdn.net/shendl/article/details/3589676" rel="noopener noreferrer" style="color:rgb(255,153,0)" target="_blank" title="class in com.sun.jna">
           <code>
            <span style="color:blue">
             <u>
              <span style="font-size:18px">
               WString
              </span>
             </u>
            </span>
           </code>
          </a>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           wchar_t*
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           NUL-terminated array (unicode)
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/String.html" rel="nofollow noopener noreferrer" style="color:rgb(255,153,0)" target="_blank" title="class or interface in java.lang">
           <code>
            <span style="color:blue">
             <u>
              <span style="font-size:18px">
               String[]
              </span>
             </u>
            </span>
           </code>
          </a>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           char**
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           NULL-terminated array of C strings
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <a href="http://blog.csdn.net/shendl/article/details/3589676" rel="noopener noreferrer" style="color:rgb(255,153,0)" target="_blank" title="class in com.sun.jna">
           <code>
            <span style="color:blue">
             <u>
              <span style="font-size:18px">
               WString[]
              </span>
             </u>
            </span>
           </code>
          </a>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           wchar_t**
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           NULL-terminated array of wide C strings
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <a href="http://blog.csdn.net/shendl/article/details/3589676" rel="noopener noreferrer" style="color:rgb(255,153,0)" target="_blank" title="class in com.sun.jna">
           <code>
            <span style="color:blue">
             <u>
              <span style="font-size:18px">
               Structure
              </span>
             </u>
            </span>
           </code>
          </a>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           struct*
           <br/>
           struct
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           pointer to struct (argument or return) (
           <a href="http://blog.csdn.net/shendl/article/details/3589676" rel="noopener noreferrer" style="color:rgb(255,153,0)" target="_blank" title="interface in com.sun.jna">
            <code>
             <span style="color:blue">
              <u>
               or explicitly
              </u>
             </span>
            </code>
           </a>
           )
           <br/>
           struct by value (member of struct) (
           <a href="http://blog.csdn.net/shendl/article/details/3589676" rel="noopener noreferrer" style="color:rgb(255,153,0)" target="_blank" title="interface in com.sun.jna">
            <code>
             <span style="color:blue">
              <u>
               or explicitly
              </u>
             </span>
            </code>
           </a>
           )
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <a href="http://blog.csdn.net/shendl/article/details/3589676" rel="noopener noreferrer" style="color:rgb(255,153,0)" target="_blank" title="class in com.sun.jna">
           <code>
            <span style="color:blue">
             <u>
              <span style="font-size:18px">
               Union
              </span>
             </u>
            </span>
           </code>
          </a>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           union
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           same as
           <code>
            Structure
           </code>
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <a href="http://blog.csdn.net/shendl/article/details/3589676" rel="noopener noreferrer" style="color:rgb(255,153,0)" target="_blank" title="class in com.sun.jna">
           <code>
            <span style="color:blue">
             <u>
              <span style="font-size:18px">
               Structure[]
              </span>
             </u>
            </span>
           </code>
          </a>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           struct[]
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           array of structs, contiguous in memory
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <a href="http://blog.csdn.net/shendl/article/details/3589676" rel="noopener noreferrer" style="color:rgb(255,153,0)" target="_blank" title="interface in com.sun.jna">
           <code>
            <span style="color:blue">
             <u>
              <span style="font-size:18px">
               Callback
              </span>
             </u>
            </span>
           </code>
          </a>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           &lt;T&gt; (*fp)()
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           function pointer (Java or native)
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <a href="http://blog.csdn.net/shendl/article/details/3589676" rel="noopener noreferrer" style="color:rgb(255,153,0)" target="_blank" title="interface in com.sun.jna">
           <code>
            <span style="color:blue">
             <u>
              <span style="font-size:18px">
               NativeMapped
              </span>
             </u>
            </span>
           </code>
          </a>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           varies
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           depends on definition
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <a href="http://blog.csdn.net/shendl/article/details/3589676" rel="noopener noreferrer" style="color:rgb(255,153,0)" target="_blank" title="class in com.sun.jna">
           <code>
            <span style="color:blue">
             <u>
              <span style="font-size:18px">
               NativeLong
              </span>
             </u>
            </span>
           </code>
          </a>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           long
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           platform-dependent (32- or 64-bit integer)
          </span>
         </p>
        </td>
       </tr>
       <tr>
        <td>
         <p>
          <a href="http://blog.csdn.net/shendl/article/details/3589676" rel="noopener noreferrer" style="color:rgb(255,153,0)" target="_blank" title="class in com.sun.jna">
           <code>
            <span style="color:blue">
             <u>
              <span style="font-size:18px">
               PointerType
              </span>
             </u>
            </span>
           </code>
          </a>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           pointer
          </span>
         </p>
        </td>
        <td>
         <p>
          <span style="font-size:18px">
           same as
           <code>
            Pointer
           </code>
          </span>
         </p>
        </td>
       </tr>
      </tbody>
     </table>
    </div>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <h3>
     <span style="font-size:18px">
      <a name="t12" style="color:rgb(255,153,0)" target="_blank">
      </a>
      <span style="color:rgb(79,129,189)">
       JNA
      </span>
      编程过程
     </span>
    </h3>
    <p>
     <span style="font-size:18px">
      JNA把一个dll/.so文件看做是一个Java接口。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      Dll是C函数的集合、容器，这正和接口的概念吻合。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      我们定义这样一个接口，
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      public interface TestDll1 extends Library {
      <!-- -->
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      /**
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      * 当前路径是在项目下，而不是bin输出目录下。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      */
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      TestDll1 INSTANCE = (TestDll1)Native.loadLibrary("TestDll1", TestDll1.class);
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      public void say(WString value);
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      }
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      如果dll是以stdcall方式输出函数，那么就继承StdCallLibrary。否则就继承默认的Library接口。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      接口内部需要一个公共静态常量：instance。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      TestDll1 INSTANCE = (TestDll1)Native.loadLibrary("TestDll1", TestDll1.class);
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      通过这个常量，就可以获得这个接口的实例，从而使用接口的方法。也就是调用外部dll的函数！
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      注意：
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      1，Native.loadLibrary()函数有2个参数：
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      1，dll或者.so文件的名字，但不带后缀名。这符合JNI的规范，因为带了后缀名就不可以跨操作系统平台了。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      搜索dll的路径是：
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      1）项目的根路径
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      2）操作系统的全局路径、
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      3）path指定的路径。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      2，第二个参数是本接口的Class类型。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      JNA通过这个Class类型，根据指定的dll/.so文件，动态创建接口的实例。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      2，接口中你只需要定义你需要的函数或者公共变量，不需要的可以不定义。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      public void say(WString value);
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      参数和返回值的类型，应该和dll中的C函数的类型一致。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      这是JNA，甚至所有跨平台调用的难点。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      这里，C语言的函数参数是：
      <span style="color:blue">
       wchar_t
      </span>
      *。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      JNA中对应的Java类型是WStirng。
     </span>
    </p>
    <h2>
     <span style="font-size:18px">
      <a name="t13" style="color:rgb(255,153,0)" target="_blank">
      </a>
      <span style="color:rgb(54,95,145)">
       所有跨平台、跨语言调用的难点
      </span>
     </span>
    </h2>
    <p>
     <span style="font-size:18px">
      有过跨语言、跨平台开发的程序员都知道，跨平台、语言调用的难点，就是不同语言之间数据类型不一致造成的问题。绝大部分跨平台调用的失败，都是这个问题造成的。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      关于这一点，不论何种语言，何种技术方案，都无法解决这个问题。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      这需要程序员的仔细开发和设计。这是程序员的责任。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <h4>
     <span style="font-size:18px">
      <a name="t14" style="color:rgb(255,153,0)" target="_blank">
      </a>
      <span style="color:rgb(79,129,189)">
       常见的跨平台调用有：
      </span>
     </span>
    </h4>
    <p>
     <span style="font-size:18px">
      1，Java调用C语言编写的dll、.so动态链接库中的函数。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      2，.NET通过P/Invoke调用C语言编写的dll、.so动态链接库中的函数。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      3，通过WEBService，在C,C++,Java,.NET等种种语言间调用。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      WebService传递的是xml格式的数据。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      即使是强大的P/Invoke或者WebService，在遇到复杂的数据类型和大数据量的传递时，还是会碰到很大的困难。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <h4>
     <span style="font-size:18px">
      <a name="t15" style="color:rgb(255,153,0)" target="_blank">
      </a>
      <span style="color:rgb(79,129,189)">
       因为，一种语言的复杂的数据类型，很难用另一种语言来表示。这就是跨平台调用问题的本质。
      </span>
     </span>
    </h4>
    <p>
     <span style="font-size:18px">
      如，WEBService调用中，很多语言，如Java，.NET都有自动实现的Java/.NET类型和XML类型之间的映射的类库或者工具。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      但是，在现实的编程环境中，如果类型非常复杂，那么这些自动转换工具常常力不从心。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      要么Object-XML映射错误。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      要么映射掉大量的内存。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      因此，我个人对这些Object-XML映射框架相当不感冒。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      我现在使用WEBService，都是直接手工使用xml处理工具提取xml中的数据构建对象。或者反过来，手工根据Object中的属性值构建xml数据。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      Java和C语言之间的调用问题，也是如此。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      Java要调用C语言的函数，那么就必须严格按照C语言要求的内存数量提供Java格式的数据。要用Java的数据类型完美模拟C语言的数据类型。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      JNA已经提供了大量的类型匹配C语言的数据类型。
     </span>
    </p>
    <h4>
     <span style="font-size:18px">
      <a name="t16" style="color:rgb(255,153,0)" target="_blank">
      </a>
      <span style="color:rgb(79,129,189)">
       跨平台、跨语言调用的第一原则：就是尽量使用基本、简单的数据类型，尽量少跨语言、平台传递数据！
      </span>
     </span>
    </h4>
    <p>
     <span style="font-size:18px">
      只有你才能拯救你自己。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      如果在你的程序中，有复杂的数据类型和庞大的跨平台数据传递。那么你必须另外写一些Façade接口，把需要传递的数据类型简化，把需要传递的数据量简化。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      否则，不论是实现的难度还是程序的性能都很难提高。
     </span>
    </p>
    <h2>
     <span style="font-size:18px">
      <a name="t17" style="color:rgb(255,153,0)" target="_blank">
      </a>
      <span style="color:rgb(54,95,145)">
       JNI
      </span>
      还是不能废
     </span>
    </h2>
    <p>
     <span style="font-size:18px">
      我们已经见识了JNA的强大。JNI和它相比是多么的简陋啊！
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      但是，有些需求还是必须求助于JNI。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      JNA是建立在JNI技术基础之上的一个框架。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      使用JNI技术，不仅可以实现Java访问C函数，也可以实现C语言调用Java代码。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      而JNA只能实现Java访问C函数，作为一个Java框架，自然不能实现C语言调用Java代码。此时，你还是需要使用JNI技术。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      JNI是JNA的基础。是Java和C互操作的技术基础。
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <span style="color:#ff0000">
       JNative方法：
      </span>
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <strong>
      <span style="font-size:18px">
       下截JNative组件
      </span>
     </strong>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      <a href="http://jnative.sourceforge.net/" rel="nofollow noopener noreferrer" style="color:rgb(0,102,153); text-decoration:none" target="_blank">
       jnative.sourceforge.net/
      </a>
      到这里下载JNative开源项目,我下载的是1.3.2
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px; color:#ff0000">
      注意：这个地址好像也不行，重新下了个，地址：
      <a href="http://download.csdn.net/detail/jimmy609/6912611" rel="noopener noreferrer" target="_blank">
       http://download.csdn.net/detail/jimmy609/6912611
      </a>
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      解压JNative-&lt;st1:chsdate isrocdate="False" islunardate="False" day="30" month="12" year="1899"&gt;1.3.2&lt;/st1:chsdate&gt;.zip
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      获得三个文件，分别是：JNativeCpp.dll，libJNativeCpp.so，JNative.jar 。
      <br/>
      JNativeCpp.dll Windows下用的，拷贝到windows / system32目录下；
      <br/>
      libJNativeCpp.so Linux下的，拷贝到系统目录下；
      <br/>
      JNative.jar　这是一个扩展包，导入工程LIB中或将其拷贝到jdk\jre\lib\ext 下，系统会自动加载。
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <strong>
      <span style="font-size:18px">
       •使用说明
      </span>
     </strong>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      我的项目将使用JNative组件调用一个测试应用服务器状态的TestAppSvr.dll文件,Dll文件中包含一个TestConnect()方法,返回一个整形的结果(1或0)
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      首先配置好JNative组件的windows环境:
      <br/>
      将Native要用到JNativeCpp.dll放在系统盘的\WINDOWS\system32下
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      将JNative.jar导入工程中,新建一个调用类:
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      java 代码
      <br/>
     </span>
    </p>
    <div class="codetitle" style="border-left-color:rgb(0,153,204); border-left-width:1px; border-left-style:solid; padding:0px 3px; margin:3px auto 0px; width:600px; background-color:rgb(242,246,251); clear:both; border-top-color:rgb(0,153,204); border-top-width:1px; border-top-style:solid; border-right-color:rgb(0,153,204); border-right-width:1px; border-right-style:solid; line-height:25px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif">
     <span style="float:right">
      <u>
       <span style="font-size:18px">
        复制代码
       </span>
      </u>
     </span>
     <span style="font-size:18px">
      代码如下:
     </span>
    </div>
    <div class="codebody" id="code38744" style="border:1px solid rgb(0,153,204); padding:0px 3px 0px 5px; margin:0px auto 3px; width:598px; background-color:rgb(221,237,251); clear:both; line-height:25px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif">
     <span style="font-size:18px">
      <br/>
      package com.tvjody;
      <br/>
      <br/>
      import java.io.File;
      <br/>
      import java.io.FileOutputStream;
      <br/>
      import java.io.IOException;
      <br/>
      import java.io.InputStream;
      <br/>
      <br/>
      import org.xvolks.jnative.JNative;
      <br/>
      import org.xvolks.jnative.Type;
      <br/>
      import org.xvolks.jnative.exceptions.NativeException;
      <br/>
      <br/>
      public class AppSvrTestConnect {
      <br/>
      <br/>
      public AppSvrTestConnect() {
      <br/>
      <br/>
      }
      <br/>
      <br/>
      /**
      <br/>
      * 测试应用服务器连接状态
      <br/>
      *
      <br/>
      *  TestConnect
      <br/>
      * @param ip 应用服务器IP
      <br/>
      * @param port 端口
      <br/>
      * @param intrcpt  是否采用数据压缩方式 1 :true 0:false
      <br/>
      * @return int 1 :成功 0:失败
      <br/>
      * @throws NativeException
      <br/>
      * @throws IllegalAccessException
      <br/>
      */
      <br/>
      private static final int TestConnect(String ip, int port, int intrcpt)throws NativeException, IllegalAccessException {
      <br/>
      JNative n = null;
      <br/>
      try {
      <br/>
      n = new JNative("TestAppSvr.dll", "TestConnect");
      <br/>
      n.setRetVal(Type.INT);
      <br/>
      int i = 0;
      <br/>
      n.setParameter(i++, Type.STRING, ip);
      <br/>
      n.setParameter(i++, Type.INT, "" + port);
      <br/>
      n.setParameter(i++, Type.INT, "" + intrcpt);
      <br/>
      n.invoke();
      <br/>
      return Integer.parseInt(n.getRetVal());
      <br/>
      } finally {
      <br/>
      if (n != null)
      <br/>
      n.dispose();
      <br/>
      }
      <br/>
      }
      <br/>
      /**
      <br/>
      * 指定Dll文件路径,动态加载本地链接库,测试应用服务器连接状态
      <br/>
      * setDllPath
      <br/>
      * @param path Dll文件的路径,不包含DLL名称 例如：windows - d:\test\test\ unix - root/test/test/
      <br/>
      * @param ip 应用服务器IP
      <br/>
      * @param port 端口
      <br/>
      * @param intrcpt  是否采用数据压缩方式 1 :true 0:false
      <br/>
      * @return int 1 :成功 0:失败
      <br/>
      * @throws NativeException
      <br/>
      * @throws IllegalAccessException
      <br/>
      */
      <br/>
      public static final int TestConnectFromDllPath(String path,String ip, int port, int intrcpt) throws NativeException, IllegalAccessException{
      <br/>
      path += "TestAppSvr.dll";
      <br/>
      System.load(path);
      <br/>
      return TestConnect(ip,port,intrcpt);
      <br/>
      }
      <br/>
      /**
      <br/>
      * Dll文件放在JRE\bin目录下面，ClassLoader就能通过System.loadLibrary()动态加载本地链接库
      <br/>
      * TestConnectFromDllPath
      <br/>
      * @param ip 应用服务器IP
      <br/>
      * @param port 端口
      <br/>
      * @param intrcpt  是否采用数据压缩方式 1 :true 0:false
      <br/>
      * @return int 1 :成功 0:失败
      <br/>
      * @throws NativeException
      <br/>
      * @throws IllegalAccessException
      <br/>
      */
      <br/>
      public static final int TestConnectFromDllPath(String ip, int port, int intrcpt) throws NativeException, IllegalAccessException{
      <br/>
      System.loadLibrary("TestAppSvr");
      <br/>
      return TestConnect(ip,port,intrcpt);
      <br/>
      }
      <br/>
      }
      <br/>
     </span>
    </div>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      这个类实现了一个静态私有方法,用来调用Dll文件中的方法返回结果
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      private static final int TestConnect(String ip, int port, int intrcpt)
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      两个静态公共方法,分两种方式装载DLL文件
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      public static final int TestConnectFromDllPath(String path,String ip, int port, int intrcpt)  //通过DLL文件的路径
      <br/>
      public static final int TestConnectFromDllPath(String ip, int port, int intrcpt) //通过ClassLoader             然后新建一个类,调用AppSvrTestConnect.java,实现方法一调用,我是将TestAppSvr.dll文件与Demo.java放在一个目录下 ,所以得到Demo.java的路径后就可以得到TestAppSvr.dll的路径,调用AppSvrTestConnect.TestConnectFromDllPath()方法后就能返回正确的信息.方法二是已经将TestAppSvr.dll放在了Jre\bin目录下,在JVM的Classloader的时候会自动加载,然后通过System.loadLibrary("TestAppSvr")就可以装配DLL文件.
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      java 代码
      <br/>
     </span>
    </p>
    <div class="codetitle" style="border-left-color:rgb(0,153,204); border-left-width:1px; border-left-style:solid; padding:0px 3px; margin:3px auto 0px; width:600px; background-color:rgb(242,246,251); clear:both; border-top-color:rgb(0,153,204); border-top-width:1px; border-top-style:solid; border-right-color:rgb(0,153,204); border-right-width:1px; border-right-style:solid; line-height:25px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif">
     <span style="float:right">
      <u>
       <span style="font-size:18px">
        复制代码
       </span>
      </u>
     </span>
     <span style="font-size:18px">
      代码如下:
     </span>
    </div>
    <div class="codebody" id="code30458" style="border:1px solid rgb(0,153,204); padding:0px 3px 0px 5px; margin:0px auto 3px; width:598px; background-color:rgb(221,237,251); clear:both; line-height:25px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif">
     <span style="font-size:18px">
      <br/>
      public class Demo {
      <br/>
      public int getInfo() throws NativeException, IllegalAccessException{
      <br/>
      <br/>
      String path=getClass().getResource(File.separator).getPath();
      <br/>
      path = path.substring(1,path.length());
      <br/>
      System.out.println(path);   //得到DLL文件的路径
      <br/>
      <br/>
      String ip = "192.168.0.48"; //服务器IP
      <br/>
      int port = 221;             //端口
      <br/>
      int intrcpt = 1;            //数据压缩方式传送,1为采用;0为不采用
      <br/>
      //方法1 传入Dll文件的路径
      <br/>
      //int info = AppSvrTestConnect.TestConnectFromDllPath(path, ip, port, intrcpt);
      <br/>
      <br/>
      //方法2 Dll文件已经放在JRE\bin目录下面
      <br/>
      int info = AppSvrTestConnect.TestConnectFromDllPath(ip, port, intrcpt);
      <br/>
      <br/>
      //1为成功，0为失败
      <br/>
      if (info == 1)
      <br/>
      System.out.println("应用服务器可用。");
      <br/>
      else
      <br/>
      System.out.println("应用服务器不可用，请检查IP地址和端口是否正确。");
      <br/>
      <br/>
      return info;
      <br/>
      }
      <br/>
     </span>
    </div>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      System.loadLibrary():装载Windows\System32下或jre\bin或Tomcat\bin目录下的本地链接库
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      System.load():根据具体的目录来加截本地链接库,必须是绝对路径
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      •备注
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      上面的示例工程,因为是例子,所以没有大多的设计,只是实现了装载DLL文件,调用DLL文件方法,返回信息.
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      JNative的详细说明,请参考JNative的源程序和例子.
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; padding-top:5px; padding-bottom:5px; color:rgb(51,51,51); font-family:Arial,Tahoma,Verdana,sans-serif; line-height:25px; background-color:rgb(247,252,255)">
     <span style="font-size:18px">
      注意JVM只允许一个默认的ClassLoader来load native library，同时并不提供专门的API来unload一个loaded native library,所以在项目调试的时候,独立启动Web Server.
     </span>
    </p>
    <span style="font-size:18px">
     <br/>
    </span>
    <p>
     <br/>
    </p>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f6a696d6d79363039:2f61727469636c652f64657461696c732f3139303736353537" class_="artid" style="display:none">
 </p>
</div>


