---
arturl_encode: "68747470733a2f2f:626c6f672e6373646e2e6e65742f777577656e73686571752f:61727469636c652f64657461696c732f313436323538313936"
layout: post
title: "logparser日志分析详解-"
date: 2025-03-14 15:11:20 +0800
description: "这里单独说一下EXTRACT_TOKEN()函数，这个函数需要传入三个参数，第一个参数为字段名；查询语法与SQL语句一样，所以较容易上手，这里以windows系统日志为例。通常不会这么查询，因为有些信息是用不到的，会影响排查速度所以需要筛选字段来查看。如果要进一步的过滤，如指定IP或者事件ID，我们可以采用以下方式来查询。本期无人投稿，欢迎大家投稿，投稿可获得无问社区AI大模型的使用红包哦！通过excel表格可以更加灵活的查找与筛选我们所需要的数据。Kerberos身份认证请求（TGT）"
keywords: "logparser日志分析详解 "
categories: ['未分类']
tags: ['网络安全', 'Web']
artid: "146258196"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146258196
    alt: "logparser日志分析详解-"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146258196
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146258196
cover: https://bing.ee123.net/img/rand?artid=146258196
image: https://bing.ee123.net/img/rand?artid=146258196
img: https://bing.ee123.net/img/rand?artid=146258196
---

# logparser日志分析详解

无问社区-官网：http://www.wwlib.cn

本期无人投稿，欢迎大家投稿，投稿可获得无问社区AI大模型的使用红包哦！

无问社区：网安文章沉浸式免费看！

无问AI大模型不懂的问题随意问！

全网网安资源智能搜索只等你来！

#### **0** **1 工具介绍**

Logparser是微软的一款日志分析工具，使用方便功能强大。
  
支持的日志类型：
  
IISW3C,NCSA,IIS,IISODBC,BIN,IISMSID,HTTPERR,URLSCAN,CSV,TSV,W3C,XML,EVT, ETW,NETMON, REG, ADS, TEXTLINE, TEXTWORD, FS,COM
  
可输出的文件类型
  
CSV, TSV, XML, DATAGRID, CHART, SYSLOG,NEUROVIEW, NAT, W3C, IIS, SQL, TPL, NULL

#### **0** **2 工具演示**

查询语法与SQL语句一样，所以较容易上手，这里以windows系统日志为例。

![图片](https://i-blog.csdnimg.cn/img_convert/30c0950c1c4d2b069e829235774d34fb.png)

Windows日志ID说明

|  |  |
| --- | --- |
| 4624 | 登录失败 |
| 4625 | 登录成功 |
| 4768 | Kerberos身份认证请求（TGT） |
| 4769 | Kerberos服务票据请求 |
| 4776 | NTLM身份验证 |
| 4720 | 创建用户 |
| 4726 | 删除用户 |
| 4672 | 授予特殊权限 |

查询所有日志字段：



```
logparser -i:evt -o:DATAGRID "select * from S.evtx"
```

![图片](https://i-blog.csdnimg.cn/img_convert/00ac5e40864c98af58f2607d98bbf6f2.png)

通常不会这么查询，因为有些信息是用不到的，会影响排查速度所以需要筛选字段来查看。



```
logparser -i:evt -o:DATAGRID "select TimeGenerated,TimeWritten,EventType,Strings from S.evtx"
```

![图片](https://i-blog.csdnimg.cn/img_convert/32370da1740a3bbcd05787d0744109b6.png)



```
logparser -i:evt -o:DATAGRID "select TimeGenerated,TimeWritten,EventType,Strings from S.evtx where TimeGenerated>timestamp('2021-12-01','yyyy-MM-dd')"
```

![图片](https://i-blog.csdnimg.cn/img_convert/ab8b212b31d967b9f4c6a72a2c700658.png)

如果要进一步的过滤，如指定IP或者事件ID，我们可以采用以下方式来查询。
  
指定IP地址查询：



```
logparser -i:evt -o:DATAGRID "select EXTRACT_TOKEN(strings,19,'|') as LoginIp,EXTRACT_TOKEN(strings,17,'|') as ProcessName,message from dd.evtx where TimeGenerated>timestamp('2022-02-05','yyyy-MM-dd') and EXTRACT_TOKEN(strings,19,'|')='IP地址'"
```

![图片](https://i-blog.csdnimg.cn/img_convert/4b000153c03779b29c0a0c43a6a0c926.png)

指定事件ID查询：



```
logparser -i:evt -o:DATAGRID "select * from S.evtx where eventid=4625"
```

![图片](https://i-blog.csdnimg.cn/img_convert/612dc14bedce2d0a6e7263ec71e54cd7.png)

这里单独说一下EXTRACT\_TOKEN()函数，这个函数需要传入三个参数，第一个参数为字段名；第二个参数为分割后的列数，列数从0开始排序；第三列为分隔符。
  
  
为了方便操作，我们也可以将查询结果导出到CSV文件中



```
logparser -i:evt -o:CSV "select EXTRACT_TOKEN(strings,19,'|') as LoginIp,EXTRACT_TOKEN(strings,17,'|') as ProcessName,message from dd.evtx where TimeGenerated>timestamp('2022-02-05','yyyy-MM-dd') and EXTRACT_TOKEN(strings,19,'|')='172.16.219.56'" > 5.csv
```

![图片](https://i-blog.csdnimg.cn/img_convert/b974d6ddbc80c9c5c2392ef9a13fd491.png)

通过excel表格可以更加灵活的查找与筛选我们所需要的数据。