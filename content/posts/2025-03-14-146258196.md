---
layout: post
title: "logparser日志分析详解-"
date: 2025-03-14 15:11:20 +0800
description: "这里单独说一下EXTRACT_TOKEN()函数，这个函数需要传入三个参数，第一个参数为字段名；查询语法与SQL语句一样，所以较容易上手，这里以windows系统日志为例。通常不会这么查询，因为有些信息是用不到的，会影响排查速度所以需要筛选字段来查看。如果要进一步的过滤，如指定IP或者事件ID，我们可以采用以下方式来查询。本期无人投稿，欢迎大家投稿，投稿可获得无问社区AI大模型的使用红包哦！通过excel表格可以更加灵活的查找与筛选我们所需要的数据。Kerberos身份认证请求（TGT）"
keywords: "logparser日志分析详解 "
categories: ['未分类']
tags: ['网络安全', 'Web']
artid: "146258196"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146258196
    alt: "logparser日志分析详解-"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146258196
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146258196
cover: https://bing.ee123.net/img/rand?artid=146258196
image: https://bing.ee123.net/img/rand?artid=146258196
img: https://bing.ee123.net/img/rand?artid=146258196
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     logparser日志分析详解
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     无问社区-官网：http://www.wwlib.cn
    </p>
    <p>
     本期无人投稿，欢迎大家投稿，投稿可获得无问社区AI大模型的使用红包哦！
    </p>
    <p style="text-align:center">
     无问社区：网安文章沉浸式免费看！
    </p>
    <p style="text-align:center">
     无问AI大模型不懂的问题随意问！
    </p>
    <p style="text-align:center">
     全网网安资源智能搜索只等你来！
    </p>
    <h4>
     <strong>
      0
     </strong>
     <strong>
      1 工具介绍
     </strong>
    </h4>
    <p>
     Logparser是微软的一款日志分析工具，使用方便功能强大。
     <br/>
     支持的日志类型：
     <br/>
     IISW3C,NCSA,IIS,IISODBC,BIN,IISMSID,HTTPERR,URLSCAN,CSV,TSV,W3C,XML,EVT, ETW,NETMON, REG, ADS, TEXTLINE, TEXTWORD, FS,COM
     <br/>
     可输出的文件类型
     <br/>
     CSV, TSV, XML, DATAGRID, CHART, SYSLOG,NEUROVIEW, NAT, W3C, IIS, SQL, TPL, NULL
    </p>
    <p>
    </p>
    <p>
    </p>
    <h4>
     <strong>
      0
     </strong>
     <strong>
      2 工具演示
     </strong>
    </h4>
    <p>
     查询语法与SQL语句一样，所以较容易上手，这里以windows系统日志为例。
    </p>
    <p style="text-align:center">
    </p>
    <p class="img-center">
     <img alt="图片" class="js_insertlocalimg rich_pages wxw-img" height="861" src="https://i-blog.csdnimg.cn/img_convert/30c0950c1c4d2b069e829235774d34fb.png" width="772"/>
    </p>
    <p style="text-align:left">
     Windows日志ID说明
    </p>
    <p style="text-align:left">
    </p>
    <table>
     <tbody>
      <tr>
       <td style="border-color:windowtext; vertical-align:top">
        <p style="text-align:left">
         4624
        </p>
       </td>
       <td style="border-color:windowtext; vertical-align:top">
        <p style="text-align:left">
         登录失败
        </p>
       </td>
      </tr>
      <tr>
       <td style="border-color:currentcolor windowtext windowtext; vertical-align:top">
        <p style="text-align:left">
         4625
        </p>
       </td>
       <td style="border-color:currentcolor windowtext windowtext; vertical-align:top">
        <p style="text-align:left">
         登录成功
        </p>
       </td>
      </tr>
      <tr>
       <td style="border-color:currentcolor windowtext windowtext; vertical-align:top">
        <p style="text-align:left">
         4768
        </p>
       </td>
       <td style="border-color:currentcolor windowtext windowtext; vertical-align:top">
        <p style="text-align:left">
         Kerberos身份认证请求（TGT）
        </p>
       </td>
      </tr>
      <tr>
       <td style="border-color:currentcolor windowtext windowtext; vertical-align:top">
        <p style="text-align:left">
         4769
        </p>
       </td>
       <td style="border-color:currentcolor windowtext windowtext; vertical-align:top">
        <p style="text-align:left">
         Kerberos服务票据请求
        </p>
       </td>
      </tr>
      <tr>
       <td style="border-color:currentcolor windowtext windowtext; vertical-align:top">
        <p style="text-align:left">
         4776
        </p>
       </td>
       <td style="border-color:currentcolor windowtext windowtext; vertical-align:top">
        <p style="text-align:left">
         NTLM身份验证
        </p>
       </td>
      </tr>
      <tr>
       <td style="border-color:currentcolor windowtext windowtext; vertical-align:top">
        <p style="text-align:left">
         4720
        </p>
       </td>
       <td style="border-color:currentcolor windowtext windowtext; vertical-align:top">
        <p style="text-align:left">
         创建用户
        </p>
       </td>
      </tr>
      <tr>
       <td style="border-color:currentcolor windowtext windowtext; vertical-align:top">
        <p style="text-align:left">
         4726
        </p>
       </td>
       <td style="border-color:currentcolor windowtext windowtext; vertical-align:top">
        <p style="text-align:left">
         删除用户
        </p>
       </td>
      </tr>
      <tr>
       <td style="border-color:currentcolor windowtext windowtext; vertical-align:top">
        <p style="text-align:left">
         4672
        </p>
       </td>
       <td style="border-color:currentcolor windowtext windowtext; vertical-align:top">
        <p style="text-align:left">
         授予特殊权限
        </p>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     查询所有日志字段：
    </p>
    <ul>
    </ul>
    <pre class="code-snippet__js"><code>logparser -i:evt -o:DATAGRID "select * from S.evtx"</code></pre>
    <p style="text-align:center">
    </p>
    <p class="img-center">
     <img alt="图片" class="js_insertlocalimg rich_pages wxw-img" height="154" src="https://i-blog.csdnimg.cn/img_convert/00ac5e40864c98af58f2607d98bbf6f2.png" width="1080"/>
    </p>
    <p>
     通常不会这么查询，因为有些信息是用不到的，会影响排查速度所以需要筛选字段来查看。
    </p>
    <ul>
    </ul>
    <pre class="code-snippet__js"><code>logparser -i:evt -o:DATAGRID "select TimeGenerated,TimeWritten,EventType,Strings from S.evtx"</code></pre>
    <p style="text-align:center">
    </p>
    <p class="img-center">
     <img alt="图片" class="js_insertlocalimg rich_pages wxw-img" height="196" src="https://i-blog.csdnimg.cn/img_convert/32370da1740a3bbcd05787d0744109b6.png" width="1080"/>
    </p>
    <p>
    </p>
    <ul>
    </ul>
    <pre class="code-snippet__js"><code>logparser -i:evt -o:DATAGRID "select TimeGenerated,TimeWritten,EventType,Strings from S.evtx where TimeGenerated&gt;timestamp('2021-12-01','yyyy-MM-dd')"</code></pre>
    <p style="text-align:center">
    </p>
    <p class="img-center">
     <img alt="图片" class="js_insertlocalimg rich_pages wxw-img" height="201" src="https://i-blog.csdnimg.cn/img_convert/ab8b212b31d967b9f4c6a72a2c700658.png" width="1080"/>
    </p>
    <p>
     如果要进一步的过滤，如指定IP或者事件ID，我们可以采用以下方式来查询。
     <br/>
     指定IP地址查询：
    </p>
    <ul>
    </ul>
    <pre class="code-snippet__js"><code>logparser -i:evt -o:DATAGRID "select EXTRACT_TOKEN(strings,19,'|') as LoginIp,EXTRACT_TOKEN(strings,17,'|') as ProcessName,message from dd.evtx where TimeGenerated&gt;timestamp('2022-02-05','yyyy-MM-dd') and EXTRACT_TOKEN(strings,19,'|')='IP地址'"</code></pre>
    <p style="text-align:center">
    </p>
    <p class="img-center">
     <img alt="图片" class="js_insertlocalimg rich_pages wxw-img" height="140" src="https://i-blog.csdnimg.cn/img_convert/4b000153c03779b29c0a0c43a6a0c926.png" width="1080"/>
    </p>
    <p>
     指定事件ID查询：
    </p>
    <ul>
    </ul>
    <pre class="code-snippet__js"><code>logparser -i:evt -o:DATAGRID "select * from S.evtx where eventid=4625"</code></pre>
    <p style="text-align:center">
    </p>
    <p class="img-center">
     <img alt="图片" class="js_insertlocalimg rich_pages wxw-img" height="151" src="https://i-blog.csdnimg.cn/img_convert/612dc14bedce2d0a6e7263ec71e54cd7.png" width="1080"/>
    </p>
    <p>
    </p>
    <p>
     这里单独说一下EXTRACT_TOKEN()函数，这个函数需要传入三个参数，第一个参数为字段名；第二个参数为分割后的列数，列数从0开始排序；第三列为分隔符。
     <br/>
     <br/>
     为了方便操作，我们也可以将查询结果导出到CSV文件中
    </p>
    <ul>
    </ul>
    <pre class="code-snippet__js"><code>logparser -i:evt -o:CSV "select EXTRACT_TOKEN(strings,19,'|') as LoginIp,EXTRACT_TOKEN(strings,17,'|') as ProcessName,message from dd.evtx where TimeGenerated&gt;timestamp('2022-02-05','yyyy-MM-dd') and EXTRACT_TOKEN(strings,19,'|')='172.16.219.56'" &gt; 5.csv</code></pre>
    <p style="text-align:center">
    </p>
    <p class="img-center">
     <img alt="图片" class="js_insertlocalimg rich_pages wxw-img" height="571" src="https://i-blog.csdnimg.cn/img_convert/b974d6ddbc80c9c5c2392ef9a13fd491.png" width="820"/>
    </p>
    <p>
    </p>
    <p>
     通过excel表格可以更加灵活的查找与筛选我们所需要的数据。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f777577656e73686571752f:61727469636c652f64657461696c732f313436323538313936" class_="artid" style="display:none">
 </p>
</div>


