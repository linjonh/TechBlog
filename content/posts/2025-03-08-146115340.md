---
arturl_encode: "68747470733a2f2f626c:6f672e6373646e2e6e65742f5072696e63653134303637382f:61727469636c652f64657461696c732f313436313135333430"
layout: post
title: "HeadFirstç³»åˆ—ä¹‹HeadFirstè®¾è®¡æ¨¡å¼ç¬¬18å¤©ä¹‹è‡é‡æ¨¡å¼Flyweight-Patternä¼˜åŒ–èµ„æºçš„ç§˜å¯†æ­¦å™¨"
date: 2025-03-08 13:48:54 +08:00
description: "åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œå½“ç³»ç»Ÿéœ€è¦åˆ›å»ºå¤§é‡ç›¸ä¼¼å¯¹è±¡æ—¶ï¼Œå†…å­˜å ç”¨å’Œæ€§èƒ½é—®é¢˜å°±ä¼šæµ®å‡ºæ°´é¢ã€‚ï¼Œè¿™æ˜¯ä¸€ç§ä¼˜åŒ–å¯¹è±¡å¤ç”¨çš„ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œæ—¨åœ¨å‡å°‘å¯¹è±¡åˆ›å»ºçš„å†…å­˜å¼€é”€ã€‚æœ¬æ–‡å°†æ·±å…¥å‰–æè‡é‡æ¨¡å¼çš„æ ¸å¿ƒå†…å®¹ï¼Œå¹¶ç»“åˆã€‚å¦‚æœæ¯æ£µæ ‘éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¯¹è±¡ï¼Œå¹¶å­˜å‚¨æ‰€æœ‰å±æ€§ï¼Œé‚£ä¹ˆã€‚ï¼šå¦‚æœå¯¹è±¡çš„å¤–éƒ¨çŠ¶æ€è¿‡å¤šï¼Œæ¨¡å¼çš„ä¼˜åŠ¿å°±ä¼šå‡å°‘ã€‚æœºåˆ¶å¤ç”¨å­—ç¬¦ä¸²å¯¹è±¡ï¼Œé¿å…é‡å¤åˆ›å»ºã€‚ï¼šé¿å…é‡å¤åˆ›å»ºå¯¹è±¡ï¼Œä¼˜åŒ–èµ„æºåˆ©ç”¨ã€‚ï¼šé€šè¿‡å¯¹è±¡å…±äº«ï¼Œé™ä½å†…å­˜æ¶ˆè€—ã€‚å¤ç”¨å°æ•´æ•°ï¼Œå‡å°‘å¯¹è±¡åˆ›å»ºã€‚ï¼šå…±äº«å¯¹è±¡éœ€è¦è€ƒè™‘å¹¶å‘è®¿é—®ã€‚ï¼šéœ€è¦ç®¡ç†å¯¹è±¡æ± å’Œå·¥å‚ã€‚ï¼šå¦‚ç¼“å­˜ã€æ± åŒ–å¯¹è±¡ç­‰ã€‚ï¼Œå¯¼è‡´åº”ç”¨æ€§èƒ½ä¸‹é™ã€‚"
keywords: "ã€HeadFirstç³»åˆ—ä¹‹HeadFirstè®¾è®¡æ¨¡å¼ã€‘ç¬¬18å¤©ä¹‹è‡é‡æ¨¡å¼ï¼ˆFlyweight Patternï¼‰ï¼šä¼˜åŒ–èµ„æºçš„ç§˜å¯†æ­¦å™¨"
categories: ['ç³»ç»Ÿè®¾è®¡', 'Headfirst', 'Headfirst']
tags: ['è®¾è®¡æ¨¡å¼', 'è‡é‡æ¨¡å¼']
artid: "146115340"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146115340
    alt: "HeadFirstç³»åˆ—ä¹‹HeadFirstè®¾è®¡æ¨¡å¼ç¬¬18å¤©ä¹‹è‡é‡æ¨¡å¼Flyweight-Patternä¼˜åŒ–èµ„æºçš„ç§˜å¯†æ­¦å™¨"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146115340
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146115340
cover: https://bing.ee123.net/img/rand?artid=146115340
image: https://bing.ee123.net/img/rand?artid=146115340
img: https://bing.ee123.net/img/rand?artid=146115340
---

# ã€HeadFirstç³»åˆ—ä¹‹HeadFirstè®¾è®¡æ¨¡å¼ã€‘ç¬¬18å¤©ä¹‹è‡é‡æ¨¡å¼ï¼ˆFlyweight Patternï¼‰ï¼šä¼˜åŒ–èµ„æºçš„ç§˜å¯†æ­¦å™¨

## **è‡é‡æ¨¡å¼ï¼ˆFlyweight Patternï¼‰ï¼šä¼˜åŒ–èµ„æºçš„ç§˜å¯†æ­¦å™¨**

åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œå½“ç³»ç»Ÿéœ€è¦åˆ›å»ºå¤§é‡ç›¸ä¼¼å¯¹è±¡æ—¶ï¼Œå†…å­˜å ç”¨å’Œæ€§èƒ½é—®é¢˜å°±ä¼šæµ®å‡ºæ°´é¢ã€‚ã€ŠHead First è®¾è®¡æ¨¡å¼ã€‹ä»‹ç»äº†
**è‡é‡æ¨¡å¼ï¼ˆFlyweight Patternï¼‰**
ï¼Œè¿™æ˜¯ä¸€ç§ä¼˜åŒ–å¯¹è±¡å¤ç”¨çš„ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œæ—¨åœ¨å‡å°‘å¯¹è±¡åˆ›å»ºçš„å†…å­˜å¼€é”€ã€‚æœ¬æ–‡å°†æ·±å…¥å‰–æè‡é‡æ¨¡å¼çš„æ ¸å¿ƒå†…å®¹ï¼Œå¹¶ç»“åˆ
**JDK å’Œ Spring æ¡†æ¶ä¸­çš„åº”ç”¨**
è¿›è¡Œå®è·µæ¢è®¨ã€‚

---

### **1. é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Ÿ**

#### **åœºæ™¯ï¼šå¤§é‡é‡å¤å¯¹è±¡å¯¼è‡´å†…å­˜å ç”¨è¿‡é«˜**

å‡è®¾æˆ‘ä»¬è¦å¼€å‘ä¸€æ¬¾ç»˜å›¾åº”ç”¨ï¼Œæ”¯æŒç»˜åˆ¶å¤§é‡çš„â€œæ ‘æœ¨â€å¯¹è±¡ï¼Œæ¯æ£µæ ‘éƒ½æœ‰ä»¥ä¸‹å±æ€§ï¼š

* **å†…éƒ¨çŠ¶æ€ï¼ˆIntrinsic Stateï¼‰ï¼š**
  é¢œè‰²ã€æ ‘ç§ã€å½¢çŠ¶ç­‰ï¼Œæ‰€æœ‰ç›¸åŒç§ç±»çš„æ ‘å…±äº«ç›¸åŒçš„å±æ€§ã€‚
* **å¤–éƒ¨çŠ¶æ€ï¼ˆExtrinsic Stateï¼‰ï¼š**
  åæ ‡ï¼ˆXã€Yï¼‰ã€ç¯å¢ƒä¿¡æ¯ç­‰ï¼Œæ¯æ£µæ ‘çš„ä½ç½®ä¿¡æ¯ä¸åŒã€‚

å¦‚æœæ¯æ£µæ ‘éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¯¹è±¡ï¼Œå¹¶å­˜å‚¨æ‰€æœ‰å±æ€§ï¼Œé‚£ä¹ˆ
**ä¸Šåƒæ£µæ ‘å¯èƒ½ä¼šå ç”¨å¤§é‡å†…å­˜**
ï¼Œå¯¼è‡´åº”ç”¨æ€§èƒ½ä¸‹é™ã€‚

---

### **2. æ€ä¹ˆè§£å†³ï¼Ÿ**

#### **å¼•å…¥è‡é‡æ¨¡å¼**

è‡é‡æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯
**å°†å…±äº«éƒ¨åˆ†ï¼ˆå†…éƒ¨çŠ¶æ€ï¼‰æŠ½å–å‡ºæ¥ï¼Œé¿å…ä¸å¿…è¦çš„é‡å¤å­˜å‚¨ï¼Œè€Œå”¯ä¸€çš„ä¸åŒä¿¡æ¯ï¼ˆå¤–éƒ¨çŠ¶æ€ï¼‰ç”±å®¢æˆ·ç«¯ä¼ é€’ã€‚**
  
è¿™æ ·ï¼Œ
**ç›¸åŒç§ç±»çš„æ ‘å¯ä»¥å¤ç”¨åŒä¸€ä¸ªå¯¹è±¡**
ï¼Œè€Œä½ç½®ä¿¡æ¯ç­‰å˜åŒ–å±æ€§åˆ™ç”±å¤–éƒ¨æä¾›ã€‚

#### **æ ¸å¿ƒè®¾è®¡**

* **Flyweightï¼ˆè‡é‡å¯¹è±¡ï¼‰ï¼š**
  å…±äº«çš„å¯¹è±¡ï¼ŒåŒ…å«å†…éƒ¨çŠ¶æ€ã€‚
* **FlyweightFactoryï¼ˆå·¥å‚ç±»ï¼‰ï¼š**
  è´Ÿè´£ç®¡ç†å’Œå¤ç”¨ Flyweight å¯¹è±¡ï¼Œç¡®ä¿ç›¸åŒçš„å¯¹è±¡ä¸ä¼šé‡å¤åˆ›å»ºã€‚
* **Clientï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼š**
  è´Ÿè´£å­˜å‚¨å¤–éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨éœ€è¦æ—¶ä»å·¥å‚è·å–å…±äº«å¯¹è±¡ã€‚

---

### **3. ä»£ç å®ç°**

æˆ‘ä»¬ä»¥â€œç»˜åˆ¶æ£®æ—ä¸­çš„æ ‘æœ¨â€ä¸ºä¾‹ï¼Œä½¿ç”¨
**Java ä»£ç **
å®ç°è‡é‡æ¨¡å¼ï¼š

#### **ï¼ˆ1ï¼‰åˆ›å»º Flyweight æ¥å£**

```java
// è‡é‡æ¥å£ï¼Œå®šä¹‰å…±äº«æ–¹æ³•
public interface TreeFlyweight {
    void display(int x, int y); // å¤–éƒ¨çŠ¶æ€ç”±æ–¹æ³•å‚æ•°ä¼ å…¥
}

```

#### **ï¼ˆ2ï¼‰å…·ä½“çš„ Flyweight ç±»**

```java
// å…·ä½“çš„æ ‘å¯¹è±¡ï¼ŒåŒ…å«å…±äº«çš„å†…éƒ¨çŠ¶æ€
public class Tree implements TreeFlyweight {
    private final String type;  // æ ‘çš„ç§ç±»
    private final String color; // é¢œè‰²
    private final String texture; // çº¹ç†

    public Tree(String type, String color, String texture) {
        this.type = type;
        this.color = color;
        this.texture = texture;
    }

    @Override
    public void display(int x, int y) {
        System.out.println("ç»˜åˆ¶ " + type + " æ ‘ï¼Œé¢œè‰²: " + color + "ï¼Œçº¹ç†: " + texture + "ï¼Œä½ç½®: (" + x + "," + y + ")");
    }
}

```

#### **ï¼ˆ3ï¼‰åˆ›å»º FlyweightFactory è´Ÿè´£ç®¡ç†å…±äº«å¯¹è±¡**

```java
import java.util.HashMap;
import java.util.Map;

// å·¥å‚ç±»ï¼Œç®¡ç†å…±äº«å¯¹è±¡
public class TreeFactory {
    private static final Map<String, TreeFlyweight> treeCache = new HashMap<>();

    public static TreeFlyweight getTree(String type, String color, String texture) {
        String key = type + "-" + color + "-" + texture;
        if (!treeCache.containsKey(key)) {
            treeCache.put(key, new Tree(type, color, texture));
            System.out.println("åˆ›å»ºæ–°æ ‘å¯¹è±¡ï¼š" + key);
        } else {
            System.out.println("å¤ç”¨å·²æœ‰æ ‘å¯¹è±¡ï¼š" + key);
        }
        return treeCache.get(key);
    }
}

```

#### **ï¼ˆ4ï¼‰å®¢æˆ·ç«¯ä½¿ç”¨ Flyweight**

```java
public class FlyweightPatternDemo {
    public static void main(String[] args) {
        // åˆ›å»ºå¤šä¸ªæ ‘å¯¹è±¡ï¼Œä½†åªä¼šåˆ›å»ºå¿…è¦çš„ä¸åŒç§ç±»æ ‘ï¼Œå…¶ä»–å¤ç”¨
        TreeFlyweight tree1 = TreeFactory.getTree("Oak", "Green", "Smooth");
        tree1.display(10, 20);

        TreeFlyweight tree2 = TreeFactory.getTree("Oak", "Green", "Smooth");
        tree2.display(30, 40);

        TreeFlyweight tree3 = TreeFactory.getTree("Pine", "Dark Green", "Rough");
        tree3.display(50, 60);
    }
}

```

#### **ï¼ˆ5ï¼‰è¿è¡Œç»“æœ**

```plaintext
åˆ›å»ºæ–°æ ‘å¯¹è±¡ï¼šOak-Green-Smooth
ç»˜åˆ¶ Oak æ ‘ï¼Œé¢œè‰²: Greenï¼Œçº¹ç†: Smoothï¼Œä½ç½®: (10,20)
å¤ç”¨å·²æœ‰æ ‘å¯¹è±¡ï¼šOak-Green-Smooth
ç»˜åˆ¶ Oak æ ‘ï¼Œé¢œè‰²: Greenï¼Œçº¹ç†: Smoothï¼Œä½ç½®: (30,40)
åˆ›å»ºæ–°æ ‘å¯¹è±¡ï¼šPine-Dark Green-Rough
ç»˜åˆ¶ Pine æ ‘ï¼Œé¢œè‰²: Dark Greenï¼Œçº¹ç†: Roughï¼Œä½ç½®: (50,60)

```

**è¯´æ˜ï¼š**

* `Oak-Green-Smooth`
  åªåˆ›å»ºäº†ä¸€æ¬¡ï¼Œåç»­ç›´æ¥å¤ç”¨ã€‚
* `Pine-Dark Green-Rough`
  ç”±äºæ˜¯æ–°çš„ç±»å‹ï¼Œæ‰€ä»¥åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚

---

### **4. è‡é‡æ¨¡å¼çš„åº”ç”¨åœºæ™¯**

#### **ï¼ˆ1ï¼‰JDK ä¸­çš„åº”ç”¨**

* **Java String å¸¸é‡æ± ï¼š**

  ```java
  String s1 = "hello";
  String s2 = "hello";
  System.out.println(s1 == s2); // trueï¼ˆå­—ç¬¦ä¸²æ± å¤ç”¨ï¼‰

  ```

  JDK é‡‡ç”¨
  **å­—ç¬¦ä¸²æ± ï¼ˆString Poolï¼‰**
  æœºåˆ¶å¤ç”¨å­—ç¬¦ä¸²å¯¹è±¡ï¼Œé¿å…é‡å¤åˆ›å»ºã€‚
* **Integer.valueOf() å¤ç”¨å°æ•´æ•°å¯¹è±¡ï¼ˆ-128 ~ 127ï¼‰ï¼š**

  ```java
  Integer a = Integer.valueOf(127);
  Integer b = Integer.valueOf(127);
  System.out.println(a == b); // trueï¼ˆç¼“å­˜å¤ç”¨ï¼‰

  ```

  JDK é€šè¿‡
  `IntegerCache`
  å¤ç”¨å°æ•´æ•°ï¼Œå‡å°‘å¯¹è±¡åˆ›å»ºã€‚

#### **ï¼ˆ2ï¼‰Spring æ¡†æ¶ä¸­çš„åº”ç”¨**

* **Spring Bean ä½œç”¨åŸŸï¼ˆScopeï¼‰ä¸­çš„å•ä¾‹æ¨¡å¼**

  + é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring ç®¡ç†çš„ Bean æ˜¯
    **å•ä¾‹æ¨¡å¼**
    ï¼Œæ‰€æœ‰è¯·æ±‚å…±äº«åŒä¸€ä¸ª Bean å®ä¾‹ï¼Œç›¸å½“äºå…¨å±€çš„è‡é‡å¯¹è±¡ã€‚
  + ä¾‹å¦‚ï¼š

    ```java
    @Component
    @Scope("singleton") // åªåˆ›å»ºä¸€ä¸ªå®ä¾‹
    public class SingletonService { }

    ```
* **Spring MVC ä¸­çš„è§†å›¾å¯¹è±¡å¤ç”¨**

  + è§†å›¾è§£æå™¨ä¼šå¤ç”¨
    `View`
    å¯¹è±¡ï¼Œé¿å…é‡å¤åˆ›å»ºã€‚

---

### **5. è‡é‡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹**

#### **ä¼˜ç‚¹**

âœ…
**å‡å°‘å†…å­˜å ç”¨**
ï¼šé€šè¿‡å¯¹è±¡å…±äº«ï¼Œé™ä½å†…å­˜æ¶ˆè€—ã€‚
  
âœ…
**æé«˜æ€§èƒ½**
ï¼šé¿å…é‡å¤åˆ›å»ºå¯¹è±¡ï¼Œä¼˜åŒ–èµ„æºåˆ©ç”¨ã€‚
  
âœ…
**é€‚ç”¨äºå¤§é‡é‡å¤å¯¹è±¡çš„åœºæ™¯**
ï¼šå¦‚ç¼“å­˜ã€æ± åŒ–å¯¹è±¡ç­‰ã€‚

#### **ç¼ºç‚¹**

âŒ
**å¼•å…¥äº†é¢å¤–çš„ç®¡ç†é€»è¾‘**
ï¼šéœ€è¦ç®¡ç†å¯¹è±¡æ± å’Œå·¥å‚ã€‚
  
âŒ
**å¯èƒ½å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜**
ï¼šå…±äº«å¯¹è±¡éœ€è¦è€ƒè™‘å¹¶å‘è®¿é—®ã€‚
  
âŒ
**ä¸é€‚ç”¨äºå¯¹è±¡çŠ¶æ€å·®å¼‚å¾ˆå¤§çš„åœºæ™¯**
ï¼šå¦‚æœå¯¹è±¡çš„å¤–éƒ¨çŠ¶æ€è¿‡å¤šï¼Œæ¨¡å¼çš„ä¼˜åŠ¿å°±ä¼šå‡å°‘ã€‚

---

### **6. æ€»ç»“**

* **è‡é‡æ¨¡å¼é€šè¿‡å…±äº«å¯¹è±¡ï¼Œå‡å°‘ç³»ç»Ÿèµ„æºå¼€é”€ï¼Œä¼˜åŒ–æ€§èƒ½ã€‚**
* **é€‚ç”¨äºå¤§é‡ç›¸ä¼¼å¯¹è±¡çš„åœºæ™¯ï¼Œå¦‚ç¼“å­˜ã€æ± åŒ–æŠ€æœ¯ã€‚**
* **JDK å’Œ Spring ä¸­å¹¿æ³›ä½¿ç”¨ï¼Œå¦‚ String å¸¸é‡æ± ã€IntegerCacheã€Spring å•ä¾‹ Beanã€‚**
* **åœ¨ä½¿ç”¨æ—¶ï¼Œéœ€è¦æƒè¡¡ç®¡ç†å¤æ‚åº¦å’Œæ€§èƒ½ä¼˜åŒ–çš„æ”¶ç›Šã€‚**

**å¦‚æœä½ çš„ç³»ç»Ÿé¢ä¸´å¤§é‡é‡å¤å¯¹è±¡çš„å†…å­˜å‹åŠ›ï¼Œä¸å¦¨è€ƒè™‘è‡é‡æ¨¡å¼æ¥ä¼˜åŒ–ï¼**
ğŸš€