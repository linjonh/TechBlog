---
layout: post
title: "QT系列教程17-MVC结构之Model模型介绍"
date: 2025-03-10 16:40:33 +0800
description: "MVC结构之Model模型介绍"
keywords: "QT系列教程(17) MVC结构之Model模型介绍"
categories: ['Qt', 'C']
tags: ['开发语言', 'Qt', 'Mvc']
artid: "146157954"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146157954
    alt: "QT系列教程17-MVC结构之Model模型介绍"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146157954
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146157954
cover: https://bing.ee123.net/img/rand?artid=146157954
image: https://bing.ee123.net/img/rand?artid=146157954
img: https://bing.ee123.net/img/rand?artid=146157954
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     QT系列教程(17) MVC结构之Model模型介绍
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="MVC_0">
     </a>
     MVC简介
    </h3>
    <p>
     MVC 就是Model-View-Control模式的简称，包括模型层(Model), 视图层(View), 控制层(Controller).
     <br/>
     Model主要负责管理数据，View主要用来显示数据，Controller主要用来操作数据，控制View联动。
     <br/>
     Qt也采用了这个模式，模型层用Model，视图层用View，控制层改名叫了代理Delegate。
    </p>
    <h3>
     <a id="QFileSystemModel_4">
     </a>
     QFileSystemModel
    </h3>
    <p>
     我们可以举个简单的例子，用QFileSystemModel来实现文件夹内容的展示，QFileSystemModel是Qt给我们提供的处理本地文件系统的文件和目录。
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    QApplication <span class="token function">a</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QSplitter <span class="token operator">*</span> splitter  <span class="token operator">=</span> <span class="token keyword">new</span> QSplitter<span class="token punctuation">;</span>
    QFileSystemModel <span class="token operator">*</span> model <span class="token operator">=</span> <span class="token keyword">new</span> QFileSystemModel<span class="token punctuation">;</span>
    model<span class="token operator">-&gt;</span><span class="token function">setRootPath</span><span class="token punctuation">(</span><span class="token class-name">QDir</span><span class="token double-colon punctuation">::</span><span class="token function">currentPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    QTreeView <span class="token operator">*</span> tree <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QTreeView</span><span class="token punctuation">(</span>splitter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tree<span class="token operator">-&gt;</span><span class="token function">setModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tree<span class="token operator">-&gt;</span><span class="token function">setRootIndex</span><span class="token punctuation">(</span>model<span class="token operator">-&gt;</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token class-name">QDir</span><span class="token double-colon punctuation">::</span><span class="token function">currentPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    QListView <span class="token operator">*</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QListView</span><span class="token punctuation">(</span>splitter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token operator">-&gt;</span><span class="token function">setModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token operator">-&gt;</span><span class="token function">setRootIndex</span><span class="token punctuation">(</span>model<span class="token operator">-&gt;</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token class-name">QDir</span><span class="token double-colon punctuation">::</span><span class="token function">currentPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    splitter<span class="token operator">-&gt;</span><span class="token function">setWindowTitle</span><span class="token punctuation">(</span><span class="token string">"Two views onto the same file system model"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    splitter<span class="token operator">-&gt;</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    splitter<span class="token operator">-&gt;</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     为model设置根目录,目录为当前文件夹。
     <br/>
     创建树型视图，视图加载model，并且设置视图的根索引为model的当前目录的索引。
    </p>
    <h3>
     <a id="_32">
     </a>
     模型介绍
    </h3>
    <p>
     模型分为几种，有列表模型，表格模型，以及树模型。详细可以参考Qt的帮主文档，搜索Model/View Programming。
     <br/>
     <img alt="https://cdn.llfc.club/1671158788602.jpg" src="https://i-blog.csdnimg.cn/img_convert/2bd95d642ad72c3a36a5e60a0feb0989.jpeg"/>
    </p>
    <p>
     模型有一个最基本的类QStandardItemModel，我们基于这个模型类实现一个树形模型。
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    QApplication <span class="token function">a</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//创建标准itemmodel</span>
    QStandardItemModel model<span class="token punctuation">;</span>
    <span class="token comment">//获取模型根项，根项不可见</span>
    QStandardItem <span class="token operator">*</span> parentItem <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">invisibleRootItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//创建文本显示，图标，和工具显示</span>
    QStandardItem <span class="token operator">*</span> item0 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QStandardItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    item0<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"item0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QPixmap <span class="token function">pixmap0</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pixmap0<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>red<span class="token punctuation">)</span><span class="token punctuation">;</span>
    item0<span class="token operator">-&gt;</span><span class="token function">setIcon</span><span class="token punctuation">(</span>pixmap0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    item0<span class="token operator">-&gt;</span><span class="token function">setToolTip</span><span class="token punctuation">(</span><span class="token string">"indexA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    parentItem<span class="token operator">-&gt;</span><span class="token function">appendRow</span><span class="token punctuation">(</span>item0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//将新的项设置为父节点项</span>
    parentItem <span class="token operator">=</span> item0<span class="token punctuation">;</span>

    QStandardItem <span class="token operator">*</span> item1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QStandardItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    item1<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"item1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QPixmap <span class="token function">pixmap1</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pixmap1<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>blue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    item1<span class="token operator">-&gt;</span><span class="token function">setIcon</span><span class="token punctuation">(</span>pixmap1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    item1<span class="token operator">-&gt;</span><span class="token function">setToolTip</span><span class="token punctuation">(</span><span class="token string">"indexB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    parentItem<span class="token operator">-&gt;</span><span class="token function">appendRow</span><span class="token punctuation">(</span>item1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    QStandardItem <span class="token operator">*</span> item2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QStandardItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    item2<span class="token operator">-&gt;</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">"item2"</span><span class="token punctuation">,</span>Qt<span class="token double-colon punctuation">::</span>EditRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QPixmap <span class="token function">pixmap2</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pixmap2<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>green<span class="token punctuation">)</span><span class="token punctuation">;</span>
    item2<span class="token operator">-&gt;</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token function">QIcon</span><span class="token punctuation">(</span>pixmap2<span class="token punctuation">)</span><span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>DecorationRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
    item2<span class="token operator">-&gt;</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">"indexC"</span><span class="token punctuation">,</span>Qt<span class="token double-colon punctuation">::</span>ToolTipRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
    parentItem<span class="token operator">-&gt;</span><span class="token function">appendRow</span><span class="token punctuation">(</span>item2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//取出根节点第0行0列的模型索引</span>
    QModelIndex indexA <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">QModelIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"model indexA row count is "</span> <span class="token operator">&lt;&lt;</span> model<span class="token punctuation">.</span><span class="token function">rowCount</span><span class="token punctuation">(</span>indexA<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//获取indexA节点下0行0列</span>
    QModelIndex indexB <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>indexA<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"indexB text is "</span> <span class="token operator">&lt;&lt;</span> model<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>indexB<span class="token punctuation">,</span>Qt<span class="token double-colon punctuation">::</span>EditRole<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"indexB icon is "</span> <span class="token operator">&lt;&lt;</span> model<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>indexB<span class="token punctuation">,</span>Qt<span class="token double-colon punctuation">::</span>DecorationRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"indexB tool tip  is "</span> <span class="token operator">&lt;&lt;</span> model<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>indexB<span class="token punctuation">,</span>Qt<span class="token double-colon punctuation">::</span>ToolTipRole<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    QTreeView view<span class="token punctuation">;</span>
    view<span class="token punctuation">.</span><span class="token function">setModel</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    view<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     运行后程序效果图
     <br/>
     <img alt="https://cdn.llfc.club/1671159654393.jpg" src="https://i-blog.csdnimg.cn/img_convert/cb5f1d44b240c06a370b84a83bd113bd.jpeg">
      <br/>
      item0节点下挂载了item1和item2两个节点。程序用两种方式为item设置图标，提示，文本。
      <br/>
      一种是setText，setIcon, setToolTip方式，另一种是setData方式。
      <br/>
      setData的方式可以参考Qt的文档，文档里列举了一些可以设置的角色。
      <br/>
      EditRole是可编辑角色，DecorationRole类似于图片显示，ToolTipRole类似于提示的角色。
     </img>
    </p>
    <h3>
     <a id="_95">
     </a>
     特定模型
    </h3>
    <p>
     除了QStandardItemModel之外，还有一些其他集成好的特殊模型，如果我们要实现树形模型就子类化QStandardItemModel。
     <br/>
     如果想实现列表模型就子类化QAbstractListModel，如果像实现表格模型就子类化QAbstractTableModel。
     <br/>
     我们子类化QAbstractListModel，实现一个列表模型。
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">StringListModel</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QAbstractListModel</span></span>
<span class="token punctuation">{<!-- --></span>
    Q_OBJECT
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">StringListModel</span><span class="token punctuation">(</span><span class="token keyword">const</span> QStringList <span class="token operator">&amp;</span> strings<span class="token punctuation">,</span> QObject<span class="token operator">*</span> parent <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">rowCount</span><span class="token punctuation">(</span><span class="token keyword">const</span> QModelIndex<span class="token operator">&amp;</span> parent <span class="token operator">=</span> <span class="token function">QModelIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    QVariant <span class="token function">data</span><span class="token punctuation">(</span><span class="token keyword">const</span> QModelIndex<span class="token operator">&amp;</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> role<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    QVariant <span class="token function">headerData</span><span class="token punctuation">(</span><span class="token keyword">int</span> section<span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>Orientation orientation<span class="token punctuation">,</span>
                        <span class="token keyword">int</span> role <span class="token operator">=</span> Qt<span class="token double-colon punctuation">::</span>DisplayRole<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    QStringList stringList<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     这个模型类包含一个QStringList,用来管理数据
    </p>
    <pre><code class="prism language-cpp"><span class="token class-name">StringListModel</span><span class="token double-colon punctuation">::</span><span class="token function">StringListModel</span><span class="token punctuation">(</span><span class="token keyword">const</span> QStringList <span class="token operator">&amp;</span> strings<span class="token punctuation">,</span>
                                 QObject<span class="token operator">*</span> parent<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token function">QAbstractListModel</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">stringList</span><span class="token punctuation">(</span>strings<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>

<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token class-name">StringListModel</span><span class="token double-colon punctuation">::</span><span class="token function">rowCount</span><span class="token punctuation">(</span><span class="token keyword">const</span> QModelIndex<span class="token operator">&amp;</span> parent <span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> stringList<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

QVariant <span class="token class-name">StringListModel</span><span class="token double-colon punctuation">::</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token keyword">const</span> QModelIndex<span class="token operator">&amp;</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> role<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>index<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">QVariant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> stringList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">QVariant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>role <span class="token operator">==</span> Qt<span class="token double-colon punctuation">::</span>DisplayRole<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> stringList<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">QVariant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

QVariant <span class="token class-name">StringListModel</span><span class="token double-colon punctuation">::</span><span class="token function">headerData</span><span class="token punctuation">(</span><span class="token keyword">int</span> section<span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>Orientation orientation<span class="token punctuation">,</span>
                                     <span class="token keyword">int</span> role <span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>role <span class="token operator">!=</span> Qt<span class="token double-colon punctuation">::</span>DisplayRole<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">QVariant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>orientation <span class="token operator">==</span> Qt<span class="token double-colon punctuation">::</span>Horizontal<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"Column %1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>section<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"Row %1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>section<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     headerData函数内根据水平还是垂直判断，显示表头。
     <br/>
     data函数内根据角色返回索引对应的数据。
     <br/>
     在main函数中可以分别用一个listview和treeview显示
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    QApplication <span class="token function">a</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QStringList list<span class="token punctuation">;</span>
    list <span class="token operator">&lt;&lt;</span><span class="token string">"a"</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"b"</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"c"</span><span class="token punctuation">;</span>

    StringListModel <span class="token function">model</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QListView  listView<span class="token punctuation">;</span>
    listView<span class="token punctuation">.</span><span class="token function">setModel</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    listView<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    QTableView tableView<span class="token punctuation">;</span>
    tableView<span class="token punctuation">.</span><span class="token function">setModel</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tableView<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="https://cdn.llfc.club/1671174663824.jpg" src="https://i-blog.csdnimg.cn/img_convert/a720d770135aa415c9157447cf6271f1.jpeg"/>
    </p>
    <h3>
     <a id="_178">
     </a>
     设置可编辑选项
    </h3>
    <p>
     我们为自定义的listmodel模型添加两个函数flags()和setData()函数。
     <br/>
     flags函数用来判断模型索引对应的项目的属性，通过标记按位或的方式获取。
     <br/>
     setData用来设置模型索引对应的项，并且设置他的编辑属性。
    </p>
    <pre><code class="prism language-cpp">Qt<span class="token double-colon punctuation">::</span>ItemFlags  <span class="token class-name">StringListModel</span><span class="token double-colon punctuation">::</span><span class="token function">flags</span><span class="token punctuation">(</span><span class="token keyword">const</span> QModelIndex<span class="token operator">&amp;</span> index<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>index<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token keyword">return</span> Qt<span class="token double-colon punctuation">::</span>ItemIsEnabled<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">QAbstractItemModel</span><span class="token double-colon punctuation">::</span><span class="token function">flags</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">|</span> Qt<span class="token double-colon punctuation">::</span>ItemIsEditable<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     如果是无效的数据则返回ItemIsEnabled标记，否则在原来的标记基础上增加ItemIsEditable。
     <br/>
     当我们修改数据时，会触发setData函数, 该函数根据项的角色为EditRole替换原来的字符串。
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token class-name">StringListModel</span><span class="token double-colon punctuation">::</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token keyword">const</span> QModelIndex<span class="token operator">&amp;</span> index<span class="token punctuation">,</span>
                              <span class="token keyword">const</span> QVariant <span class="token operator">&amp;</span>value<span class="token punctuation">,</span> <span class="token keyword">int</span> role <span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> role <span class="token operator">==</span> Qt<span class="token double-colon punctuation">::</span>EditRole<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        stringList<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emit <span class="token function">dataChanged</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     并且发送了dataChanged，这个信号第一个参数为左上角的index，第二个参数为右下角index。
     <br/>
     dataChanged通知View视图刷新数据，从而完成数据的修改。
    </p>
    <p>
     另外Views显示数据时会根据data返回的数据显示，所以要将data函数的显示逻辑中添加Qt::EditRole。
    </p>
    <pre><code class="prism language-cpp">QVariant <span class="token class-name">StringListModel</span><span class="token double-colon punctuation">::</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token keyword">const</span> QModelIndex<span class="token operator">&amp;</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> role<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>index<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">QVariant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> stringList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">QVariant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>role <span class="token operator">==</span> Qt<span class="token double-colon punctuation">::</span>DisplayRole <span class="token operator">||</span> role <span class="token operator">==</span> Qt<span class="token double-colon punctuation">::</span>EditRole<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> stringList<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">QVariant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_225">
     </a>
     添加行与删除行
    </h3>
    <p>
     添加行和删除行都需要在添加和删除之前调用begin操作，操作完之后调用end操作
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token class-name">StringListModel</span><span class="token double-colon punctuation">::</span><span class="token function">insertRows</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">,</span> <span class="token keyword">int</span> rows<span class="token punctuation">,</span>
                                 <span class="token keyword">const</span> QModelIndex <span class="token operator">&amp;</span> index <span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">beginInsertRows</span><span class="token punctuation">(</span><span class="token function">QModelIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> position<span class="token punctuation">,</span> position <span class="token operator">+</span> rows <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> row <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> row <span class="token operator">&lt;</span> rows<span class="token punctuation">;</span> <span class="token operator">++</span> row<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        stringList<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">endInsertRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token class-name">StringListModel</span><span class="token double-colon punctuation">::</span><span class="token function">removeRows</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">,</span> <span class="token keyword">int</span> rows<span class="token punctuation">,</span>
                                 <span class="token keyword">const</span> QModelIndex <span class="token operator">&amp;</span> index <span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">beginRemoveRows</span><span class="token punctuation">(</span><span class="token function">QModelIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> position<span class="token punctuation">,</span> position<span class="token operator">+</span> rows<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> row<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> row <span class="token operator">&lt;</span> rows<span class="token punctuation">;</span> <span class="token operator">++</span> row<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        stringList<span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">endRemoveRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     接下来可以调用一下测试
    </p>
    <pre><code class="prism language-cpp">    model<span class="token punctuation">.</span><span class="token function">insertRows</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token punctuation">.</span><span class="token function">removeRows</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     运行的效果如下
     <br/>
     <img alt="https://cdn.llfc.club/1671256097654.jpg" src="https://i-blog.csdnimg.cn/img_convert/fe45ef90b0e5e453fb6d09b5411ace9d.jpeg"/>
    </p>
    <h3>
     <a id="_255">
     </a>
     源码链接
    </h3>
    <p>
     源码链接
     <br/>
     <a href="https://gitee.com/secondtonone1/qt-learning-notes" rel="nofollow">
      https://gitee.com/secondtonone1/qt-learning-notes
     </a>
    </p>
    <pre><code>接下来可以调用一下测试
```cpp
    model.insertRows(3,2);
    model.removeRows(0,1);
</code></pre>
    <p>
     运行的效果如下
     <br/>
     [外链图片转存中…(img-Brv61b0v-1741595978275)]
    </p>
    <h3>
     <a id="_273">
     </a>
     源码链接
    </h3>
    <p>
     源码链接
     <br/>
     <a href="https://gitee.com/secondtonone1/qt-learning-notes" rel="nofollow">
      https://gitee.com/secondtonone1/qt-learning-notes
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f7365636f6e64746f6e6f6e65312f:61727469636c652f64657461696c732f313436313537393534" class_="artid" style="display:none">
 </p>
</div>


