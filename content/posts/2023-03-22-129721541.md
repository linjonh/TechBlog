---
arturl_encode: "68747470733a:2f2f626c6f672e6373646e2e6e65742f4f6e63655f6461792f:61727469636c652f64657461696c732f313239373231353431"
layout: post
title: "GDBä¹‹4è°ƒè¯•Pythonä»£ç "
date: 2023-03-22 23:09:09 +0800
description: "å¦‚æœPythonç¨‹åºæŒ‚ä½äº†ï¼Œæƒ³æŸ¥çœ‹Pythonä»£ç çš„æ ˆï¼Œä½†æ˜¯ç”¨GDBçœ‹åˆ°çš„æ˜¯Cæ ˆï¼Œæœ¬æ–‡ä»‹ç»ä½¿ç”¨gdb"
keywords: "python gdb"
categories: ['Python', 'Linux', 'Cs']
tags: ['Python', 'Linux', 'Gdb']
artid: "129721541"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=129721541
    alt: "GDBä¹‹4è°ƒè¯•Pythonä»£ç "
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=129721541
featuredImagePreview: https://bing.ee123.net/img/rand?artid=129721541
---

# GDBä¹‹(4)è°ƒè¯•Pythonä»£ç 

#### GDBä¹‹(4)è°ƒè¯•Pythonä»£ç 

Authorï¼šOnce Day Dateï¼š2023å¹´3æœˆ22æ—¥/2024å¹´2æœˆ26æ—¥

æ¼«æ¼«é•¿è·¯ï¼Œæ‰åˆšåˆšå¼€å§‹â€¦

å…¨ç³»åˆ—æ–‡ç« è¯·æŸ¥çœ‹ä¸“æ :
[Linuxå®è·µè®°å½•\_Once-Dayçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/once_day/category_11958578.html)

æ¨èå‚è€ƒæ–‡æ¡£ï¼š

* [å¦‚ä½•ç”¨gdbè°ƒè¯•pythonç¨‹åº (winglq.github.io)](https://winglq.github.io/posts/pythongdb/)
* [GDB: The GNU Project Debugger (sourceware.org)](https://sourceware.org/gdb/)
* [GDB Documentation (sourceware.org)](https://sourceware.org/gdb/documentation/)

#### æ–‡ç« ç›®å½•

* + - [GDBä¹‹(4)è°ƒè¯•Pythonä»£ç ](#GDB4Python_0)
    - * [1. æ¦‚è¿°](#1__17)
      * [2. åŠ è½½libpythonæ–‡ä»¶](#2_libpython_50)
      * + [2.1 å¦‚æœæ‰“å°ä¿¡æ¯å¤±è´¥](#21__175)
      * [3.å®‰è£…pip+pystack](#3pippystack_207)

##### 1. æ¦‚è¿°

å¦‚æœPythonç¨‹åºæŒ‚ä½äº†ï¼Œæƒ³æŸ¥çœ‹Pythonä»£ç çš„æ ˆï¼Œä½†æ˜¯ç”¨GDBçœ‹åˆ°çš„æ˜¯Cæ ˆï¼Œæœ¬æ–‡ä»‹ç»ä½¿ç”¨gdbçš„pythonæ‰©å±•æ¥æŸ¥çœ‹pythonä»£ç æ ˆã€‚

ä¸€èˆ¬è€Œè¨€ï¼Œç°åœ¨çš„ubuntuè®¾å¤‡ä¸Šï¼Œå®‰è£…gdbæ—¶éƒ½ä¼šè‡ªå¸¦è£…ä¸Špythonçš„æ‰©å±•å·¥å…·ï¼š

```yacas
onceday->~:# find /usr/ -name "gdb"
/usr/include/gdb
/usr/share/doc/gdb
/usr/share/gdb
/usr/share/gdb/python/gdb
/usr/share/bash-completion/completions/gdb
/usr/bin/gdb

```

**å¦‚ä¸Šé¢ï¼Œæœç´¢ä¸€ä¸‹ç›®å½•ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰
`/usr/share/gdb/python/gdb`
ï¼Œå¦‚æœæ²¡æœ‰éœ€è¦å®‰è£…å¯¹åº”çš„å·¥å…·ï¼Œè¿™é‡Œè‡ªå¸¦çš„æ˜¯python3çš„è°ƒè¯•æ‰©å±•**
ã€‚

å¯¹äºPython2ï¼Œéœ€è¦å®‰è£…å¯¹åº”çš„åŒ…æ‰©å±•æ‰è¡Œã€‚

```yacas
onceday->~:# apt search python-gdb
Sorting... Done
Full Text Search... Done
python-gdbm/jammy 2.7.18-1build1 amd64
  GNU dbm database support for Python2

python-gdbm-dbg/jammy 2.7.18-1build1 amd64
  GNU dbm database support for Python2 (debug extension)

```

**å¦‚ä¸Šæ‰€ç¤ºï¼Œå®‰è£…å¯¹åº”çš„python2-gdbæ‰©å±•å³å¯**
ã€‚

##### 2. åŠ è½½libpythonæ–‡ä»¶

ä¸‹è½½åœ°å€ä¸ºï¼š
[GitHub cpython tools](https://github.com/python/cpython/blob/3.9/Tools/gdb/libpython.py)

ä¸‹è½½æ–‡ä»¶éœ€è¦åœ¨ä»“åº“åˆ†æ”¯é‚£é‡Œé€‰æ‹©å¯¹åº”å½“å‰ç‰ˆæœ¬çš„åˆ†æ”¯ä¸‹è½½è¯¥æ–‡ä»¶ï¼Œç„¶åæ“ä½œå¦‚ä¸‹ï¼š

* ä¸‹è½½åˆ°æœ¬åœ°æ–‡ä»¶å¤¹ä¸­ã€‚
  **å¯ä»¥æ”¾åˆ°ç³»ç»Ÿè·¯å¾„å»ï¼Œè¿™æ ·åé¢ä¸éœ€è¦é¢å¤–æ·»åŠ ç³»ç»Ÿè·¯å¾„äº†**
  ã€‚

é¦–å…ˆæ‰¾åˆ°ç›®æ ‡è¿›ç¨‹IDï¼Œæˆ–è€…coredumpæ–‡ä»¶ï¼Œçš†å¯ä»¥ï¼š

```yacas
onceday->~:# ps aux |grep gdb
ubuntu   1588276  0.0  0.1  16288  8844 pts/8    S+   21:58   0:00 python3 gdb_test.py
root     1588710  0.0  0.0   6476  2448 pts/9    S+   22:00   0:00 grep --color=auto gdb

```

ç„¶åä½¿ç”¨
`gdb python3 1588276`
ï¼Œä¾¿å¯ä»¥attachåˆ°è¿è¡Œçš„è¿›ç¨‹ä¸Šï¼š

```yacas
......
#10 0x000056527606a005 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#11 0x00005652760813ac in _PyFunction_Vectorcall ()
No symbol table info available.
#12 0x000056527606a005 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#13 0x00005652760813ac in _PyFunction_Vectorcall ()
No symbol table info available.
#14 0x000056527606a005 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#15 0x0000565276066766 in ?? ()
......

```

**ç›´æ¥ä½¿ç”¨bt fullæ‰“å‡ºæ¥çš„æ˜¯ä¸Šé¢çš„æ ˆï¼Œ(å¿½ç•¥ç¬¦å·è¡¨ï¼Œé‡ç‚¹æ˜¯æ ˆå½¢å¼)ï¼Œè¿™æ˜¯åŸºäºCä»£ç çš„è§’åº¦**
ã€‚

è¿™ä¸ªæ—¶å€™ï¼Œå¯ä»¥æ‰‹åŠ¨åŠ åœ¨pythonæ‰©å±•ï¼Œ
**éƒ¨åˆ†å‘è¡Œç‰ˆLinuxçš„GDBé›†æˆäº†pythonæ‰©å±•åŠŸèƒ½ï¼Œé‚£å°±æ— éœ€æ‰‹åŠ¨å¯¼å…¥äº†**
ã€‚

```yacas
(gdb) python
>import sys
>sys.path.insert(0,"/home/ubuntu/py-code")
>import libpython
>end
(gdb) py
py-bt               py-down             py-locals           py-up               python-interactive
py-bt-full          py-list             py-print            python        

```

**sys.path.insertæ˜¯æŠŠä¸‹è½½çš„libpython.pyæ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹åŠ å…¥ç³»ç»Ÿè·¯å¾„ä¸­ï¼Œå¦‚æœå·²ç»æ”¾å…¥ç³»ç»Ÿè·¯å¾„ï¼Œè¿™ä¸€æ­¥å°±æ˜¯å¤šä½™çš„äº†**
ã€‚

å¯¼å…¥æˆåŠŸäº†ï¼Œè¾“å…¥
`py`
ç„¶åtabï¼Œå°†çœ‹åˆ°ä¸‹é¢å‡ ä¸ªå‘½ä»¤ï¼Œå…¶å«ä¹‰å’Œgdbä¸­å‘½ä»¤ç±»ä¼¼ã€‚

```yacas
(gdb) py-bt
Traceback (most recent call first):
  (unable to read python frame information)
  (unable to read python frame information)
  (unable to read python frame information)

```

**`py-bt`
æ˜¯æ‰“å°æ ˆï¼Œä½†æ˜¯å¦‚æœæŠ¥å‡ºä¸Šé¢çš„é”™è¯¯ï¼Œæ— éœ€æ‹…å¿ƒï¼Œè¿™æ˜¯libpythonç‰ˆæœ¬å’Œå½“å‰pythonè§£é‡Šå™¨ç‰ˆæœ¬æ²¡å¯¹ä¸Šçš„é—®é¢˜ï¼Œå› æ­¤é‡æ–°ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„libpython.pyæ–‡ä»¶å³å¯**
ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/0785e9d49b5cbef66e75adc6b01c0183.png#pic_center)

**å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé€‰æ‹©å¯¹åº”çš„pythonç‰ˆæœ¬å³å¯ï¼Œè¿™é‡Œé€‰æ‹©çš„åº”è¯¥æ˜¯
`3.10`
ç‰ˆæœ¬**
ã€‚

ä¸‹é¢æ¥çœ‹ä¸€ä¸‹å¸¸è§çš„å‘½ä»¤æ•ˆæœï¼š

**py-btæ‰“å°æ ˆçš„ç®€ç•¥ä¿¡æ¯ï¼š**

```yacas
(gdb) py-bt
Traceback (most recent call first):
  File "/home/postgres/Connect_data.py", line 44, in deal_type_value
    data = (int(random.random() * 20000), int(random.random() * 1000000))
  File "/home/postgres/Connect_data.py", line 159, in <module>
    deal_type_value(f1, f2, start_time_sec)

```

**py-bt-fullæ‰“å°æ ˆçš„è¯¦ç»†ä¿¡æ¯**
ï¼š

```yacas
(gdb) py-bt-full
#0 Frame 0xffffb85ed640, for file /home/postgres/Connect_data.py, line 44, in deal_type_value (f1=<_io.TextIOWrapper at remote 0xffffb8622860>, f2=<_io.TextIOWrapper at remote 0xffffb8622ee0>, now_time=1704118932, d_time=80532)
    data = (int(random.random() * 20000), int(random.random() * 1000000))
#5 Frame 0x2302d680, for file /home/postgres/Connect_data.py, line 159, in <module> ()
    deal_type_value

```

**py-upå’Œpy-downä¸Šä¸‹ç§»åŠ¨æ ˆçš„ä½ç½®**
ï¼Œ
`py-list`
æ˜¾ç¤ºå½“å‰é™„è¿‘çš„æºç ï¼š

```yacas
(gdb) py-list 
  39    
  40    def deal_type_value(f1, f2, now_time):
  41        global sava_start_time
  42        global data_sum
  43        d_time = now_time - sava_start_time
 >44        data = (int(random.random() * 20000), int(random.random() * 1000000))
  45        data_sum["3s"].append(data)
  46        data_sum["10s"].append(data)
  47        if d_time % 3 == 0:
  48            succ, conc = sum_data(data_sum["3s"])
  49            f1.write(f"{now_time}, 1, {succ}, {conc}\n")

```

**py-localsæ‰“å°å½“å‰æ ˆçš„å±€éƒ¨å˜é‡ä¿¡æ¯**
ï¼š

```yacas
(gdb) py-locals 
f1 = <_io.TextIOWrapper at remote 0xffffb8622860>
f2 = <_io.TextIOWrapper at remote 0xffffb8622ee0>
now_time = 1704118932
d_time = 80532

```

**py-printå¯ä»¥æ‰“å°æŒ‡å®šçš„å˜é‡ä¿¡æ¯ï¼š**

```yacas
(gdb) py-print now_time
local 'now_time' = 1704118932

```

###### 2.1 å¦‚æœæ‰“å°ä¿¡æ¯å¤±è´¥

```yacas
(gdb) py-bt
Traceback (most recent call first):
  (unable to read python frame information)
  (unable to read python frame information)
  (unable to read python frame information)
  (unable to read python frame information)

```

ä¸Šè¿°è¾“å‡ºè¡¨æ˜ GDB æ— æ³•è¯»å– Python å †æ ˆå¸§ä¿¡æ¯ã€‚è¿™å¯èƒ½ä¼šå‡ºç°åœ¨å‡ ç§æƒ…å†µä¸‹ï¼š

1. **GDB æ²¡æœ‰æ­£ç¡®åŠ è½½ Python æ’ä»¶**
   ï¼šéœ€è¦ç¡®ä¿åœ¨å¼€å§‹è¿½è¸ªä¹‹å‰å·²ç»é€šè¿‡
   `gdb`
   å‘½ä»¤è¡ŒåŠ è½½äº† Python æ’ä»¶ï¼Œæ¯”å¦‚ï¼š

   ```python
   (gdb) python
   >>> import sys
   >>> sys.path.append('/path/to/python/source')
   >>> from Tools import gdb
   >>> end

   ```

   è¿™é‡Œçš„ â€˜/path/to/python/sourceâ€™ æ˜¯ Python æºä»£ç çš„è·¯å¾„ã€‚è¿™ä¸ªè·¯å¾„éœ€è¦æ›¿æ¢ä¸ºå®é™…çš„è·¯å¾„ã€‚
2. **Python å¯æ‰§è¡Œæ–‡ä»¶æ²¡æœ‰åŒ…å«è°ƒè¯•ç¬¦å·**
   ï¼šè¦åœ¨ GDB ä¸­è°ƒè¯• Pythonï¼Œéœ€è¦ä¸€ä¸ªåŒ…å«è°ƒè¯•ç¬¦å·çš„ Python å¯æ‰§è¡Œæ–‡ä»¶ã€‚åœ¨æ„å»º Python æ—¶ï¼Œéœ€è¦ä½¿ç”¨
   `--with-pydebug`
   é€‰é¡¹æ¥åŒ…å«è¿™äº›ç¬¦å·ã€‚å¦‚æœä½¿ç”¨çš„ Python æ²¡æœ‰åŒ…å«è¿™äº›ç¬¦å·ï¼Œå¯èƒ½éœ€è¦é‡æ–°æ„å»º Pythonã€‚
3. **GDB ç‰ˆæœ¬ä¸å…¼å®¹**
   ï¼šä¸æ˜¯æ‰€æœ‰ç‰ˆæœ¬çš„ GDB éƒ½èƒ½æ­£ç¡®åœ°å¤„ç† Python å †æ ˆå¸§ã€‚ä½ å¯èƒ½éœ€è¦å°è¯•å‡çº§æˆ–é™çº§ GDB æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚
4. **Python ä»£ç æ­£åœ¨æ‰§è¡Œé Python ä»£ç **
   ï¼šå¦‚æœ Python ä»£ç æ­£åœ¨æ‰§è¡Œä¸€ä¸ª C æ‰©å±•æˆ–è€…å…¶ä»–é Python ä»£ç ï¼ŒGDB å¯èƒ½æ— æ³•æ˜¾ç¤º Python å †æ ˆå¸§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…ä»£ç å›åˆ° Python åŸŸï¼Œæˆ–è€…åœ¨ C ä»£ç ä¸­è®¾ç½®æ–­ç‚¹ã€‚

##### 3.å®‰è£…pip+pystack

ä½¿ç”¨ä¸‹é¢å‘½ä»¤å®‰è£…
`pip(â€œensurepipâ€ is a module in Python that provides support for bootstrapping the pip installer into an existing Python installation or virtual environment)`

```yacas
pip -m ensurepip
pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple pystack-debugger
ps -ef | grep yams
pystack <python-pid>

```

  
  
  
  
  
  

![Alt](https://i-blog.csdnimg.cn/blog_migrate/027004482f3a3ce3cf6063b863ab8f98.png#pic_center)

### Once Day

### 



***ä¹Ÿä¿¡ç¾äººç»ˆä½œåœŸï¼Œä¸å ªå¹½æ¢¦å¤ªåŒ†åŒ†......***



**å¦‚æœè¿™ç¯‡æ–‡ç« ä¸ºæ‚¨å¸¦æ¥äº†å¸®åŠ©æˆ–å¯å‘ï¼Œä¸å¦¨ç‚¹ä¸ªèµğŸ‘å’Œå…³æ³¨ï¼Œå†åŠ ä¸Šä¸€ä¸ªå°å°çš„æ”¶è—â­ï¼**



**(ï½¡â—•â€¿â—•ï½¡)æ„Ÿè°¢æ‚¨çš„é˜…è¯»ä¸æ”¯æŒ~~~**