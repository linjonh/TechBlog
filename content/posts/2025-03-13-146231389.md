---
layout: post
title: "Flutter签名板封装"
date: 2025-03-13 15:08:01 +0800
description: "【代码】Flutter：签名板封装。"
keywords: "Flutter：签名板封装"
categories: ['Flutter']
tags: ['开发语言', 'Javascript', 'Flutter']
artid: "146231389"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146231389
    alt: "Flutter签名板封装"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146231389
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146231389
cover: https://bing.ee123.net/img/rand?artid=146231389
image: https://bing.ee123.net/img/rand?artid=146231389
img: https://bing.ee123.net/img/rand?artid=146231389
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Flutter：签名板封装
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     签名板
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e34a259ad2734e4dbb1c76335d005c12.png"/>
    </p>
    <blockquote>
     <p>
      依赖安装
     </p>
    </blockquote>
    <pre><code class="prism language-cpp">  # 图片处理
  image<span class="token operator">:</span> <span class="token operator">^</span><span class="token number">4.1</span><span class="token punctuation">.</span><span class="token number">3</span>
  # 签名
  signature<span class="token operator">:</span> <span class="token operator">^</span><span class="token number">5.4</span><span class="token punctuation">.</span><span class="token number">1</span>
</code></pre>
    <blockquote>
     <p>
      封装组件
     </p>
    </blockquote>
    <pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token string">'dart:typed_data'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:dogex/common/index.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:ducafe_ui_core/ducafe_ui_core.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:get/get.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:signature/signature.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:image/image.dart'</span> <span class="token keyword">as</span> img<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:path_provider/path_provider.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'dart:io'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SignaturePad</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">/// 显示签名板</span>
  <span class="token comment">/// [backgroundColor] 签名区域背景色</span>
  <span class="token comment">/// [titleColor] 标题文字颜色</span>
  <span class="token comment">/// [penColor] 签名笔颜色</span>
  <span class="token comment">/// [onConfirm] 确认回调，返回签名图片的PNG字节数据</span>
  <span class="token keyword">static</span> Future<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    Color backgroundColor <span class="token operator">=</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
    Color titleColor <span class="token operator">=</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
    Color penColor <span class="token operator">=</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>
    required <span class="token function">Function</span><span class="token punctuation">(</span>Uint8List<span class="token operator">?</span><span class="token punctuation">)</span> onConfirm<span class="token punctuation">,</span>
    bool convertToJpg <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    int jpgQuality <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> async <span class="token punctuation">{<!-- --></span>
    final SignatureController controller <span class="token operator">=</span> <span class="token function">SignatureController</span><span class="token punctuation">(</span>
      <span class="token literal-property property">penStrokeWidth</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token literal-property property">penColor</span><span class="token operator">:</span> penColor<span class="token punctuation">,</span>
      <span class="token literal-property property">exportBackgroundColor</span><span class="token operator">:</span> backgroundColor<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> Get<span class="token punctuation">.</span><span class="token function">bottomSheet</span><span class="token punctuation">(</span>
      <span class="token function">PopScope</span><span class="token punctuation">(</span>
        <span class="token literal-property property">canPop</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 禁止通过返回键或滑动关闭</span>
        <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
          <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">800</span><span class="token punctuation">.</span>w<span class="token punctuation">,</span>
          <span class="token literal-property property">decoration</span><span class="token operator">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
            <span class="token literal-property property">color</span><span class="token operator">:</span> AppTheme<span class="token punctuation">.</span>color2223<span class="token punctuation">,</span>
            <span class="token literal-property property">borderRadius</span><span class="token operator">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">vertical</span><span class="token punctuation">(</span>
              <span class="token literal-property property">top</span><span class="token operator">:</span> Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token comment">// 顶部标题栏</span>
              <span class="token function">Container</span><span class="token punctuation">(</span>
                <span class="token literal-property property">padding</span><span class="token operator">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">.</span>w<span class="token punctuation">,</span> <span class="token literal-property property">vertical</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
                  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token comment">// 标题和清除按钮</span>
                    <span class="token function">Row</span><span class="token punctuation">(</span>
                      <span class="token literal-property property">mainAxisAlignment</span><span class="token operator">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>
                      <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        TextWidget<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>
                          <span class="token string">'签署'</span><span class="token punctuation">,</span>
                          <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">.</span>sp<span class="token punctuation">,</span>
                          <span class="token literal-property property">color</span><span class="token operator">:</span> titleColor<span class="token punctuation">,</span>
                          <span class="token literal-property property">weight</span><span class="token operator">:</span> FontWeight<span class="token punctuation">.</span>w600<span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token function">GestureDetector</span><span class="token punctuation">(</span>
                          <span class="token literal-property property">onTap</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            controller<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                          <span class="token punctuation">}</span><span class="token punctuation">,</span>
                          <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                            <span class="token literal-property property">padding</span><span class="token operator">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">child</span><span class="token operator">:</span> TextWidget<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>
                              <span class="token string">'清除'</span><span class="token punctuation">,</span>
                              <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">.</span>sp<span class="token punctuation">,</span>
                              <span class="token literal-property property">color</span><span class="token operator">:</span> titleColor<span class="token punctuation">,</span>
                            <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token comment">// 提示文字</span>
                    TextWidget<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>
                      <span class="token string">'请在下方区域签名'</span><span class="token punctuation">,</span>
                      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">.</span>sp<span class="token punctuation">,</span>
                      <span class="token literal-property property">color</span><span class="token operator">:</span> AppTheme<span class="token punctuation">.</span>color999<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment">// 签名区域</span>
              <span class="token function">Expanded</span><span class="token punctuation">(</span>
                <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                  <span class="token literal-property property">margin</span><span class="token operator">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">decoration</span><span class="token operator">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                    <span class="token literal-property property">color</span><span class="token operator">:</span> backgroundColor<span class="token punctuation">,</span>
                    <span class="token literal-property property">borderRadius</span><span class="token operator">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Signature</span><span class="token punctuation">(</span>
                    <span class="token literal-property property">controller</span><span class="token operator">:</span> controller<span class="token punctuation">,</span>
                    <span class="token comment">// backgroundColor: backgroundColor,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment">// 底部按钮</span>
              <span class="token function">Container</span><span class="token punctuation">(</span>
                <span class="token literal-property property">padding</span><span class="token operator">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
                  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token comment">// 取消按钮</span>
                    <span class="token function">Expanded</span><span class="token punctuation">(</span>
                      <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">90</span><span class="token punctuation">.</span>w<span class="token punctuation">,</span>
                        <span class="token literal-property property">decoration</span><span class="token operator">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                          <span class="token literal-property property">color</span><span class="token operator">:</span> AppTheme<span class="token punctuation">.</span>blockBgColor<span class="token punctuation">,</span>
                          <span class="token literal-property property">borderRadius</span><span class="token operator">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">TextButton</span><span class="token punctuation">(</span>
                          <span class="token literal-property property">onPressed</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            Get<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                          <span class="token punctuation">}</span><span class="token punctuation">,</span>
                          <span class="token literal-property property">style</span><span class="token operator">:</span> TextButton<span class="token punctuation">.</span><span class="token function">styleFrom</span><span class="token punctuation">(</span>
                            <span class="token literal-property property">shape</span><span class="token operator">:</span> <span class="token function">RoundedRectangleBorder</span><span class="token punctuation">(</span>
                              <span class="token literal-property property">borderRadius</span><span class="token operator">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token literal-property property">child</span><span class="token operator">:</span> TextWidget<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>
                            <span class="token string">'取消'</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">.</span>sp<span class="token punctuation">,</span>
                            <span class="token literal-property property">color</span><span class="token operator">:</span> titleColor<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function">SizedBox</span><span class="token punctuation">(</span>width<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token comment">// 确认按钮</span>
                    <span class="token function">Expanded</span><span class="token punctuation">(</span>
                      <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">90</span><span class="token punctuation">.</span>w<span class="token punctuation">,</span>
                        <span class="token literal-property property">decoration</span><span class="token operator">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                          <span class="token literal-property property">color</span><span class="token operator">:</span> AppTheme<span class="token punctuation">.</span>primaryBlue<span class="token punctuation">,</span>
                          <span class="token literal-property property">borderRadius</span><span class="token operator">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">TextButton</span><span class="token punctuation">(</span>
                          <span class="token literal-property property">onPressed</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> async <span class="token punctuation">{<!-- --></span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>controller<span class="token punctuation">.</span>isEmpty<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                              Loading<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">'请签名后再确认'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                              <span class="token keyword">return</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            
                            final pngData <span class="token operator">=</span> <span class="token keyword">await</span> controller<span class="token punctuation">.</span><span class="token function">toPngBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>pngData <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                              <span class="token keyword">if</span> <span class="token punctuation">(</span>convertToJpg<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                                  <span class="token comment">// 转换为JPG格式</span>
                                  final jpgData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_convertPngToJpg</span><span class="token punctuation">(</span>pngData<span class="token punctuation">,</span> jpgQuality<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                  Get<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                  <span class="token function">onConfirm</span><span class="token punctuation">(</span>jpgData<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                  Loading<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">'图片转换失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                  Get<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                  <span class="token function">onConfirm</span><span class="token punctuation">(</span>pngData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 转换失败时返回原始PNG数据</span>
                                <span class="token punctuation">}</span>
                              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                                Get<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token function">onConfirm</span><span class="token punctuation">(</span>pngData<span class="token punctuation">)</span><span class="token punctuation">;</span>
                              <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                              Loading<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">'签名生成失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                          <span class="token punctuation">}</span><span class="token punctuation">,</span>
                          <span class="token literal-property property">style</span><span class="token operator">:</span> TextButton<span class="token punctuation">.</span><span class="token function">styleFrom</span><span class="token punctuation">(</span>
                            <span class="token literal-property property">shape</span><span class="token operator">:</span> <span class="token function">RoundedRectangleBorder</span><span class="token punctuation">(</span>
                              <span class="token literal-property property">borderRadius</span><span class="token operator">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token literal-property property">child</span><span class="token operator">:</span> TextWidget<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>
                            <span class="token string">'确认'</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">.</span>sp<span class="token punctuation">,</span>
                            <span class="token literal-property property">color</span><span class="token operator">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
                            <span class="token literal-property property">weight</span><span class="token operator">:</span> FontWeight<span class="token punctuation">.</span>w600<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">isScrollControlled</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">enableDrag</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 禁止拖拽关闭</span>
      <span class="token literal-property property">isDismissible</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 禁止点击外部关闭</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 释放控制器</span>
    controller<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// 将PNG字节数据转换为JPG格式</span>
  <span class="token keyword">static</span> Future<span class="token operator">&lt;</span>Uint8List<span class="token operator">&gt;</span> <span class="token function">_convertPngToJpg</span><span class="token punctuation">(</span>Uint8List pngData<span class="token punctuation">,</span> int quality<span class="token punctuation">)</span> async <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 使用image包解码PNG</span>
    final pngImage <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token function">decodePng</span><span class="token punctuation">(</span>pngData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pngImage <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">throw</span> <span class="token function">Exception</span><span class="token punctuation">(</span><span class="token string">'无法解码PNG图片'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 转换为JPG格式</span>
    final jpgData <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token function">encodeJpg</span><span class="token punctuation">(</span>pngImage<span class="token punctuation">,</span> <span class="token literal-property property">quality</span><span class="token operator">:</span> quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Uint8List<span class="token punctuation">.</span><span class="token function">fromList</span><span class="token punctuation">(</span>jpgData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// 保存签名图片到本地文件</span>
  <span class="token keyword">static</span> Future<span class="token operator">&lt;</span>String<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token function">saveSignatureToFile</span><span class="token punctuation">(</span>Uint8List imageData<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>bool isJpg <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span> async <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
      final directory <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getApplicationDocumentsDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      final timestamp <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>millisecondsSinceEpoch<span class="token punctuation">;</span>
      final extension <span class="token operator">=</span> isJpg <span class="token operator">?</span> <span class="token string">'jpg'</span> <span class="token operator">:</span> <span class="token string">'png'</span><span class="token punctuation">;</span>
      final path <span class="token operator">=</span> <span class="token string">'${directory.path}/signature_$timestamp.$extension'</span><span class="token punctuation">;</span>
      
      final file <span class="token operator">=</span> <span class="token function">File</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> file<span class="token punctuation">.</span><span class="token function">writeAsBytes</span><span class="token punctuation">(</span>imageData<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> path<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'保存签名图片失败: $e'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre>
    <blockquote>
     <p>
      页面调用
     </p>
    </blockquote>
    <pre><code class="prism language-js">  <span class="token comment">// 弹出签名框</span>
  <span class="token keyword">void</span> <span class="token function">onSignPopup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    SignaturePad<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>
      <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
      <span class="token literal-property property">titleColor</span><span class="token operator">:</span> AppTheme<span class="token punctuation">.</span>colorfff<span class="token punctuation">,</span>
      <span class="token literal-property property">penColor</span><span class="token operator">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>
      <span class="token literal-property property">convertToJpg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 转换为JPG格式</span>
      <span class="token literal-property property">jpgQuality</span><span class="token operator">:</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token comment">// JPG质量</span>
      <span class="token literal-property property">onConfirm</span><span class="token operator">:</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> async <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// 保存签名图片到本地文件</span>
          final filePath <span class="token operator">=</span> <span class="token keyword">await</span> SignaturePad<span class="token punctuation">.</span><span class="token function">saveSignatureToFile</span><span class="token punctuation">(</span>
            data<span class="token punctuation">,</span> 
            <span class="token literal-property property">isJpg</span><span class="token operator">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
          
          <span class="token keyword">if</span> <span class="token punctuation">(</span>filePath <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 保存到相册</span>
            <span class="token comment">// 这里将输入图片的临时路径</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'签名保存成功: $filePath'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            Loading<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">'签名保存失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34303734353134332f:61727469636c652f64657461696c732f313436323331333839" class_="artid" style="display:none">
 </p>
</div>


