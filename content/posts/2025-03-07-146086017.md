---
layout: post
title: "k8s的配置文件说明"
date: 2025-03-07 09:12:02 +0800
description: "通过此文档，您可以快速定位到关键配置文件，解决类似 ConfigMap 同步失败、证书过期等问题。| Controller Manager | 管理控制器逻辑 || 存储敏感数据（如密码、TLS证书） | 加密存储 || Scheduler | 调度策略配置 || Kubelet | 集群认证信息 |"
keywords: "k8s的配置文件说明"
categories: ['未分类']
tags: ['容器', '云原生', 'Kubernetes']
artid: "146086017"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146086017
    alt: "k8s的配置文件说明"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146086017
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146086017
cover: https://bing.ee123.net/img/rand?artid=146086017
image: https://bing.ee123.net/img/rand?artid=146086017
img: https://bing.ee123.net/img/rand?artid=146086017
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     k8s的配置文件说明
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h4>
     <a id="Master__0">
     </a>
     <strong>
      一、Master 节点核心配置文件
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        文件路径
       </th>
       <th>
        组件
       </th>
       <th>
        核心内容
       </th>
       <th>
        典型配置示例
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         <code>
          /etc/kubernetes/manifests/kube-apiserver.yaml
         </code>
        </strong>
       </td>
       <td>
        API Server
       </td>
       <td>
        控制 API 服务行为
       </td>
       <td>
       </td>
      </tr>
     </tbody>
    </table>
    <pre><code class="prism language-yaml"><span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">command</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>etcd<span class="token punctuation">-</span>servers=https<span class="token punctuation">:</span>//10.0.0.1<span class="token punctuation">:</span><span class="token number">2379</span>     <span class="token comment"># etcd 地址</span>
    <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>service<span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>ip<span class="token punctuation">-</span>range=10.96.0.0/12   <span class="token comment"># Service IP 范围</span>
    <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>authorization<span class="token punctuation">-</span>mode=Node<span class="token punctuation">,</span>RBAC             <span class="token comment"># 授权模式</span>
    <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>client<span class="token punctuation">-</span>ca<span class="token punctuation">-</span>file=/etc/kubernetes/pki/ca.crt <span class="token comment"># CA 证书</span>
</code></pre>
    <p>
     |
     <strong>
      <code>
       /etc/kubernetes/manifests/kube-controller-manager.yaml
      </code>
     </strong>
     | Controller Manager | 管理控制器逻辑 |
    </p>
    <pre><code class="prism language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">command</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>cidr=10.244.0.0/16       <span class="token comment"># Pod 网络 CIDR</span>
  <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>service<span class="token punctuation">-</span>account<span class="token punctuation">-</span>private<span class="token punctuation">-</span>key<span class="token punctuation">-</span>file=/etc/kubernetes/pki/sa.key
  <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>root<span class="token punctuation">-</span>ca<span class="token punctuation">-</span>file=/etc/kubernetes/pki/ca.crt
</code></pre>
    <p>
     |
     <strong>
      <code>
       /etc/kubernetes/manifests/kube-scheduler.yaml
      </code>
     </strong>
     | Scheduler | 调度策略配置 |
    </p>
    <pre><code class="prism language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">command</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>kubeconfig=/etc/kubernetes/scheduler.conf
  <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>leader<span class="token punctuation">-</span>elect=true                <span class="token comment"># 启用 Leader 选举</span>
</code></pre>
    <hr/>
    <h4>
     <a id="Worker__29">
     </a>
     <strong>
      二、Worker 节点核心配置文件
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        文件路径
       </th>
       <th>
        组件
       </th>
       <th>
        核心内容
       </th>
       <th>
        典型配置示例
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         <code>
          /var/lib/kubelet/config.yaml
         </code>
        </strong>
       </td>
       <td>
        Kubelet
       </td>
       <td>
        节点级配置
       </td>
       <td>
       </td>
      </tr>
     </tbody>
    </table>
    <pre><code class="prism language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kubelet.config.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> KubeletConfiguration
<span class="token key atrule">address</span><span class="token punctuation">:</span> 0.0.0.0                     <span class="token comment"># 监听地址</span>
<span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10250</span>                          <span class="token comment"># 服务端口</span>
<span class="token key atrule">authentication</span><span class="token punctuation">:</span>                      <span class="token comment"># 认证配置</span>
  <span class="token key atrule">webhook</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">evictionHard</span><span class="token punctuation">:</span>                        <span class="token comment"># 资源驱逐阈值</span>
  <span class="token key atrule">memory.available</span><span class="token punctuation">:</span> <span class="token string">"500Mi"</span>
  <span class="token key atrule">nodefs.available</span><span class="token punctuation">:</span> <span class="token string">"10%"</span>
</code></pre>
    <p>
     |
     <strong>
      <code>
       /etc/kubernetes/kubelet.conf
      </code>
     </strong>
     | Kubelet | 集群认证信息 |
    </p>
    <pre><code class="prism language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">clusters</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span>
    <span class="token key atrule">certificate-authority-data</span><span class="token punctuation">:</span> &lt;CA证书Base64<span class="token punctuation">&gt;</span>
    <span class="token key atrule">server</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//master<span class="token punctuation">:</span><span class="token number">6443</span>       <span class="token comment"># API Server 地址</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_56">
     </a>
     <strong>
      三、集群级动态配置
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        配置类型
       </th>
       <th>
        作用
       </th>
       <th>
        管理方式
       </th>
       <th>
        示例命令
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         ConfigMap
        </strong>
       </td>
       <td>
        存储非敏感配置数据（如环境变量、配置文件）
       </td>
       <td>
        <code>
         kubectl apply
        </code>
       </td>
       <td>
       </td>
      </tr>
     </tbody>
    </table>
    <pre><code class="prism language-bash">kubectl get configmap <span class="token parameter variable">-n</span> kube-system coredns <span class="token parameter variable">-o</span> yaml
<span class="token comment"># 输出示例：</span>
data:
  Corefile: <span class="token operator">|</span>
    .:53 <span class="token punctuation">{<!-- --></span>
        errors
        health
        kubernetes cluster.local <span class="token punctuation">{<!-- --></span>
            pods insecure
            fallthrough in-addr.arpa ip6.arpa
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
    <p>
     |
     <strong>
      Secret
     </strong>
     | 存储敏感数据（如密码、TLS证书） | 加密存储 |
    </p>
    <pre><code class="prism language-bash">kubectl create secret generic db-password --from-literal<span class="token operator">=</span>password<span class="token operator">=</span><span class="token number">123</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_81">
     </a>
     <strong>
      四、网络插件配置文件
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        插件
       </th>
       <th>
        文件路径
       </th>
       <th>
        核心配置内容
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         Calico
        </strong>
       </td>
       <td>
        <code>
         kubectl get configmap -n kube-system calico-config
        </code>
       </td>
       <td>
       </td>
      </tr>
     </tbody>
    </table>
    <pre><code class="prism language-yaml"><span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">typha_service_name</span><span class="token punctuation">:</span> <span class="token string">"none"</span>       <span class="token comment"># 是否启用 Typha 服务</span>
  <span class="token key atrule">veth_mtu</span><span class="token punctuation">:</span> <span class="token string">"1440"</span>                 <span class="token comment"># 网络 MTU</span>
  <span class="token key atrule">ipam</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> calico<span class="token punctuation">-</span>ipam
</code></pre>
    <p>
     |
     <strong>
      Flannel
     </strong>
     |
     <code>
      /etc/kube-flannel/net-conf.json
     </code>
     |
    </p>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"Network"</span><span class="token operator">:</span> <span class="token string">"10.244.0.0/16"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"Backend"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token string-property property">"Type"</span><span class="token operator">:</span> <span class="token string">"vxlan"</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_102">
     </a>
     <strong>
      五、用户级配置文件
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        文件路径
       </th>
       <th>
        作用
       </th>
       <th>
        内容示例
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         <code>
          ~/.kube/config
         </code>
        </strong>
       </td>
       <td>
        集群访问凭证
       </td>
       <td>
       </td>
      </tr>
     </tbody>
    </table>
    <pre><code class="prism language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">clusters</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span>
    <span class="token key atrule">server</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//master<span class="token punctuation">:</span><span class="token number">6443</span>
    <span class="token key atrule">certificate-authority-data</span><span class="token punctuation">:</span> &lt;CA证书<span class="token punctuation">&gt;</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>cluster
<span class="token key atrule">users</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> admin
  <span class="token key atrule">user</span><span class="token punctuation">:</span>
    <span class="token key atrule">client-certificate-data</span><span class="token punctuation">:</span> &lt;用户证书<span class="token punctuation">&gt;</span>
    <span class="token key atrule">client-key-data</span><span class="token punctuation">:</span> &lt;用户私钥<span class="token punctuation">&gt;</span>
<span class="token key atrule">contexts</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">context</span><span class="token punctuation">:</span>
    <span class="token key atrule">cluster</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>cluster
    <span class="token key atrule">user</span><span class="token punctuation">:</span> admin
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>context
</code></pre>
    <hr/>
    <h4>
     <a id="_127">
     </a>
     <strong>
      六、关键排查命令
     </strong>
    </h4>
    <h5>
     <a id="1__128">
     </a>
     <strong>
      1. 查看动态配置是否生效
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 检查 ConfigMap 是否被 Pod 挂载</span>
kubectl describe pod <span class="token parameter variable">-n</span> kube-system coredns-xxxx <span class="token operator">|</span> <span class="token function">grep</span> Mounts
<span class="token comment"># 输出应包含：ConfigMap "coredns" mounted at /etc/coredns</span>
</code></pre>
    <h5>
     <a id="2__135">
     </a>
     <strong>
      2. 验证证书有效期
     </strong>
    </h5>
    <pre><code class="prism language-bash">openssl x509 <span class="token parameter variable">-in</span> /etc/kubernetes/pki/apiserver.crt <span class="token parameter variable">-noout</span> <span class="token parameter variable">-dates</span>
<span class="token comment"># 输出示例：</span>
Not Before: Mar  <span class="token number">1</span> 00:00:00 <span class="token number">2023</span> GMT
Not After <span class="token builtin class-name">:</span> Mar  <span class="token number">1</span> 00:00:00 <span class="token number">2024</span> GMT
</code></pre>
    <h5>
     <a id="3__143">
     </a>
     <strong>
      3. 检查组件日志
     </strong>
    </h5>
    <pre><code class="prism language-bash">journalctl <span class="token parameter variable">-u</span> kubelet <span class="token parameter variable">--since</span> <span class="token string">"5 minutes ago"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> error
</code></pre>
    <hr/>
    <h4>
     <a id="_150">
     </a>
     <strong>
      常见问题定位表
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        现象
       </th>
       <th>
        优先检查的配置文件
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         Pod 无法解析 DNS
        </strong>
       </td>
       <td>
        <code>
         kube-system/coredns
        </code>
        ConfigMap
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         节点无法加入集群
        </strong>
       </td>
       <td>
        <code>
         /etc/kubernetes/kubelet.conf
        </code>
        中的证书和 API Server 地址
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         API Server 无法启动
        </strong>
       </td>
       <td>
        <code>
         /etc/kubernetes/manifests/kube-apiserver.yaml
        </code>
        的 etcd 配置
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         调度器不分配 Pod
        </strong>
       </td>
       <td>
        <code>
         kube-scheduler.yaml
        </code>
        的
        <code>
         --kubeconfig
        </code>
        路径
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     通过此文档，您可以快速定位到关键配置文件，解决类似 ConfigMap 同步失败、证书过期等问题。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f4c43593133332f:61727469636c652f64657461696c732f313436303836303137" class_="artid" style="display:none">
 </p>
</div>


