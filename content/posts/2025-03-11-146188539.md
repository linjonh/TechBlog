---
layout: post
title: "PaddleOCR-多相机协同工业字符检测与异常报警系统"
date: 2025-03-11 20:54:26 +0800
description: "PaddleOCR 是百度基于飞桨（PaddlePaddle）框架开源的全场景文字识别工具，支持多语言、多场景、高精度的 OCR 能力，覆盖文本检测、识别、方向分类等全流程，广泛应用于文档扫描、车牌识别、票据处理、工业质检等场景。图形化界面设计：主要用于产品包装的编号进行识别确认，当编号对比不正确时，发出警报和闪光，并保存错误图片结果。项目代码：注意：要改成自己的端口号，和摄像头的固定ip地址才可以进行使用。"
keywords: "《PaddleOCR》—— 多相机协同工业字符检测与异常报警系统"
categories: ['未分类']
tags: ['计算机视觉', '数码相机', 'Ocr']
artid: "146188539"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146188539
    alt: "PaddleOCR-多相机协同工业字符检测与异常报警系统"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146188539
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146188539
cover: https://bing.ee123.net/img/rand?artid=146188539
image: https://bing.ee123.net/img/rand?artid=146188539
img: https://bing.ee123.net/img/rand?artid=146188539
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     《PaddleOCR》—— 多相机协同工业字符检测与异常报警系统
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h3>
     <a id="PaddleOCR_3">
     </a>
     PaddleOCR
    </h3>
    <p>
     PaddleOCR 是百度基于飞桨（PaddlePaddle）框架开源的全场景文字识别工具，支持多语言、多场景、高精度的 OCR 能力，覆盖文本检测、识别、方向分类等全流程，广泛应用于文档扫描、车牌识别、票据处理、工业质检等场景。
    </p>
    <h3>
     <a id="_5">
     </a>
     项目介绍
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7221d84309f14d0d942e776317f5744c.png">
      <br/>
      图形化界面设计：
     </img>
    </p>
    <p>
     主要用于产品包装的编号进行识别确认，当编号对比不正确时，发出警报和闪光，并保存错误图片结果。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/5aee0ee27dfc4f1ea6e7f2acb79fc1b1.png"/>
    </p>
    <p>
     <mark>
      项目代码：
     </mark>
     <br/>
     <mark>
      注意：要改成自己的端口号，和摄像头的固定ip地址才可以进行使用。
     </mark>
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 导入OpenCV库，用于计算机视觉任务，如图像和视频处理</span>
<span class="token keyword">import</span> cv2
<span class="token comment"># 从collections模块导入Counter类，用于统计可迭代对象中元素的出现次数</span>
<span class="token keyword">from</span> collections <span class="token keyword">import</span> Counter
<span class="token comment"># 导入os模块，用于与操作系统进行交互，如文件和目录操作</span>
<span class="token keyword">import</span> os
<span class="token comment"># 从numpy模块导入ndarray类型，用于处理多维数组</span>
<span class="token keyword">from</span> numpy <span class="token keyword">import</span> ndarray
<span class="token comment"># 导入sys模块，用于访问与Python解释器紧密相关的变量和函数</span>
<span class="token keyword">import</span> sys
<span class="token comment"># 将指定路径添加到Python模块搜索路径中，以便可以导入该路径下的模块</span>
sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">r"D:\MVS\Development\Samples\Python\MvImport"</span><span class="token punctuation">)</span>
<span class="token comment"># 从HKCamera_class模块导入HKCamera类，可能用于操作海康相机</span>
<span class="token keyword">from</span> HKCamera_class <span class="token keyword">import</span> HKCamera
<span class="token comment"># 从PyQt5库导入QtCore、QtGui和QtWidgets模块，用于创建图形用户界面（GUI）</span>
<span class="token keyword">from</span> PyQt5 <span class="token keyword">import</span> QtCore<span class="token punctuation">,</span> QtGui<span class="token punctuation">,</span> QtWidgets
<span class="token comment"># 从PyQt5.QtCore模块导入所有内容，方便使用其中的类和函数</span>
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtCore <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># 从PyQt5.QtGui模块导入所有内容，用于处理图形、图像和字体等</span>
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtGui <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># 从PyQt5.QtWidgets模块导入QFileDialog和QMainWindow类，QFileDialog用于文件选择对话框，QMainWindow是主窗口的基类</span>
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QFileDialog<span class="token punctuation">,</span> QMainWindow
<span class="token comment"># 从金寨窗口0模块导入Ui_MainWindow类，可能是使用Qt Designer设计的主窗口界面类</span>
<span class="token keyword">from</span> 金寨窗口<span class="token number">0</span> <span class="token keyword">import</span> Ui_MainWindow
<span class="token comment"># 导入logging模块，用于记录程序运行时的信息</span>
<span class="token keyword">import</span> logging
<span class="token comment"># 导入numpy库，用于科学计算和数组操作</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token comment"># 从paddleocr模块导入PaddleOCR类，用于进行光学字符识别（OCR）</span>
<span class="token keyword">from</span> paddleocr <span class="token keyword">import</span> PaddleOCR
<span class="token comment"># 导入re模块，用于正则表达式操作，可用于字符串匹配和替换</span>
<span class="token keyword">import</span> re
<span class="token comment"># 导入serial模块，用于串口通信</span>
<span class="token keyword">import</span> serial
<span class="token comment"># 导入time模块，用于处理时间相关的操作，如延时</span>
<span class="token keyword">import</span> time
<span class="token comment"># 导入argparse模块，用于解析命令行参数</span>
<span class="token keyword">import</span> argparse
<span class="token comment"># 导入threading模块，用于创建和管理线程</span>
<span class="token keyword">import</span> threading

<span class="token comment"># 定义一个函数，用于定时释放并重新打开摄像头资源</span>
<span class="token keyword">def</span> <span class="token function">release_capture2</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token comment"># 每隔30分钟（1800秒）执行一次释放和重新打开操作</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1800</span><span class="token punctuation">)</span>
        <span class="token comment"># 释放当前摄像头资源</span>
        cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 重新打开指定编号的摄像头</span>
        cap<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>opt<span class="token punctuation">.</span>cap_numb3<span class="token punctuation">)</span>

<span class="token comment"># 创建一个命令行参数解析器对象</span>
parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 添加一个命令行参数，用于指定第二个串口的端口号，默认值为COM4</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--SERIAL_PORT1"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'COM5'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'第二个串口的端口号'</span><span class="token punctuation">)</span>
<span class="token comment"># 添加一个命令行参数，用于指定第一个串口的端口号，默认值为COM5</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--SERIAL_PORT2"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'COM6'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'第一个串口的端口号'</span><span class="token punctuation">)</span>
<span class="token comment"># 添加一个命令行参数，用于指定识别置信度水平，默认值为0.88</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--confid_level"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0.88</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'识别置信度水平'</span><span class="token punctuation">)</span>
<span class="token comment"># 添加一个命令行参数，用于指定第三个摄像头的编号，默认值为1</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--cap_numb3"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'第三个摄像头编号'</span><span class="token punctuation">)</span>
<span class="token comment"># 添加一个命令行参数，用于指定获取帧的延迟时间，默认值为67</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--frame_delay"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">67</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'获取帧的延迟时间'</span><span class="token punctuation">)</span>
<span class="token comment"># 解析命令行参数，并将结果存储在opt对象中</span>
opt <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 定义一些十六进制命令字符串，用于控制设备的灯光和蜂鸣器</span>
LIGHT_BUZZ1 <span class="token operator">=</span> <span class="token string">"0110001A000101CE18"</span>  <span class="token comment"># 灯光+蜂鸣器1</span>
LIGHT_BUZZ2 <span class="token operator">=</span> <span class="token string">"0110001A0001040E1B"</span>  <span class="token comment"># 灯光+蜂鸣器1</span>
LIGHT <span class="token operator">=</span> <span class="token string">"0110001A0001028E19"</span>  <span class="token comment"># 灯光</span>
BUZZ1 <span class="token operator">=</span> <span class="token string">"0110001A0001034FD9"</span>  <span class="token comment"># 蜂鸣器1</span>
BUZZ2 <span class="token operator">=</span> <span class="token string">"0110001A000105CFDB"</span>  <span class="token comment"># 蜂鸣器2</span>
BUZZ_CMD_CLOSE <span class="token operator">=</span> <span class="token string">"0110001A0001000FD8"</span>  <span class="token comment"># 关闭所有蜂鸣器</span>

<span class="token comment"># 禁用调试级别的日志记录，减少不必要的日志输出</span>
logging<span class="token punctuation">.</span>disable<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>

<span class="token comment"># 定义一个函数，用于向设备发送十六进制命令</span>
<span class="token keyword">def</span> <span class="token function">sendCmdToDevice</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> ser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 将十六进制字符串转换为字节对象</span>
    cmdd <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>cmd<span class="token punctuation">)</span>
    <span class="token comment"># 通过串口发送字节数据到设备</span>
    ser<span class="token punctuation">.</span>write<span class="token punctuation">(</span>cmdd<span class="token punctuation">)</span>

<span class="token comment"># 定义一个函数，用于找出列表中出现次数最多的元素</span>
<span class="token keyword">def</span> <span class="token function">most_common_element</span><span class="token punctuation">(</span>lst<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 使用Counter类统计列表中每个元素的出现次数</span>
    count <span class="token operator">=</span> Counter<span class="token punctuation">(</span>lst<span class="token punctuation">)</span>
    <span class="token comment"># 获取出现次数最多的元素</span>
    most_common_item <span class="token operator">=</span> count<span class="token punctuation">.</span>most_common<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> most_common_item

<span class="token comment"># 定义一个函数，用于处理输入字符串，提取符合特定模式的部分</span>
<span class="token keyword">def</span> <span class="token function">process_string</span><span class="token punctuation">(</span>input_string<span class="token punctuation">)</span><span class="token punctuation">:</span>
    aa <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># 使用空格分割输入字符串</span>
    parts <span class="token operator">=</span> input_string<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 定义正则表达式模式1：包含字母和数字，长度在2到10之间</span>
    pattern_alphanumeric <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d-]{2,10}$'</span><span class="token punctuation">)</span>
    <span class="token comment"># 定义正则表达式模式2：由4到7位数字组成</span>
    pattern_at_least_two_digits <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'^\d{4,7}$'</span><span class="token punctuation">)</span>
    <span class="token comment"># 遍历分割后的每个部分</span>
    <span class="token keyword">for</span> part <span class="token keyword">in</span> parts<span class="token punctuation">:</span>
        <span class="token comment"># 检查是否符合模式1或模式2</span>
        <span class="token keyword">if</span> pattern_alphanumeric<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>part<span class="token punctuation">)</span> <span class="token keyword">or</span> pattern_at_least_two_digits<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>part<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 如果符合条件，则添加到结果列表中</span>
            aa<span class="token punctuation">.</span>append<span class="token punctuation">(</span>part<span class="token punctuation">)</span>
    <span class="token keyword">return</span> aa

<span class="token comment"># 定义一个函数，用于对字符串集合进行字符替换</span>
<span class="token keyword">def</span> <span class="token function">set_bing</span><span class="token punctuation">(</span>set_a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    resu <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> set_a<span class="token punctuation">:</span>
        <span class="token comment"># 替换字符串中的特定字符</span>
        jj <span class="token operator">=</span> j<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'s'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'S'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'I'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'v'</span><span class="token punctuation">,</span> <span class="token string">'V'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'P'</span><span class="token punctuation">)</span>
        <span class="token comment"># 将替换后的字符串添加到结果集合中</span>
        resu<span class="token punctuation">.</span>add<span class="token punctuation">(</span>jj<span class="token punctuation">)</span>
    <span class="token keyword">return</span> resu

<span class="token comment"># 定义一个函数，用于隐藏标签并发送关闭蜂鸣器的命令</span>
<span class="token keyword">def</span> <span class="token function">hide_label_and_send_cmd</span><span class="token punctuation">(</span>label<span class="token punctuation">,</span> ser<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 隐藏指定的标签</span>
    label<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token comment"># 发送关闭蜂鸣器的命令</span>
    sendCmdToDevice<span class="token punctuation">(</span>BUZZ_CMD_CLOSE<span class="token punctuation">,</span> ser<span class="token punctuation">)</span>

<span class="token comment"># 定义一个函数，用于检查某个文本在给定集合中出现的次数</span>
<span class="token keyword">def</span> <span class="token function">In_which</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> hun<span class="token punctuation">)</span><span class="token punctuation">:</span>
    a <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> hun<span class="token punctuation">:</span>
        <span class="token keyword">if</span> text <span class="token keyword">in</span> i<span class="token punctuation">:</span>
            a <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> a

<span class="token comment"># 定义一个函数，用于计算四边形的面积</span>
<span class="token keyword">def</span> <span class="token function">are</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
    zs <span class="token operator">=</span> i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    ys <span class="token operator">=</span> i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    yx <span class="token operator">=</span> i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    zx <span class="token operator">=</span> i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>

    <span class="token comment"># 计算上底边的长度</span>
    width_A <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>zs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> ys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>zs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> ys<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 计算下底边的长度</span>
    width_B <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>zx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> yx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>zx<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> yx<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 计算左侧边的长度</span>
    height_A <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>zs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> zx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>zs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> zx<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 计算右侧边的长度</span>
    height_B <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> yx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ys<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> yx<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 取上下底边的平均值作为宽度</span>
    width <span class="token operator">=</span> <span class="token punctuation">(</span>width_A <span class="token operator">+</span> width_B<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
    <span class="token comment"># 取左右侧边的平均值作为高度</span>
    height <span class="token operator">=</span> <span class="token punctuation">(</span>height_A <span class="token operator">+</span> height_B<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
    <span class="token comment"># 计算四边形的面积</span>
    area <span class="token operator">=</span> width <span class="token operator">*</span> height
    <span class="token keyword">return</span> area

<span class="token comment"># 创建两个PaddleOCR对象，分别用于不同的OCR任务</span>
ocr <span class="token operator">=</span> PaddleOCR<span class="token punctuation">(</span>use_angle_cls<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> use_gpu<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> lang<span class="token operator">=</span><span class="token string">'en'</span><span class="token punctuation">,</span> use_mp<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> total_process_num<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>
ocr2 <span class="token operator">=</span> PaddleOCR<span class="token punctuation">(</span>use_angle_cls<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> use_gpu<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> lang<span class="token operator">=</span><span class="token string">'en'</span><span class="token punctuation">,</span> use_mp<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> total_process_num<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>

<span class="token comment"># 定义一个继承自QMainWindow和Ui_MainWindow的类，用于创建主窗口</span>
<span class="token keyword">class</span> <span class="token class-name">PyQtMainEntry</span><span class="token punctuation">(</span>QMainWindow<span class="token punctuation">,</span> Ui_MainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 调用父类的构造函数</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 设置UI界面</span>
        self<span class="token punctuation">.</span>setupUi<span class="token punctuation">(</span>self<span class="token punctuation">)</span>

        <span class="token comment"># 打开第一个串口，波特率为9600，超时时间为2.5秒</span>
        self<span class="token punctuation">.</span>ser1 <span class="token operator">=</span> serial<span class="token punctuation">.</span>Serial<span class="token punctuation">(</span>opt<span class="token punctuation">.</span>SERIAL_PORT1<span class="token punctuation">,</span> <span class="token number">9600</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">2.5</span><span class="token punctuation">)</span>
        <span class="token comment"># 打开第二个串口，波特率为9600，超时时间为2.5秒</span>
        self<span class="token punctuation">.</span>ser2 <span class="token operator">=</span> serial<span class="token punctuation">.</span>Serial<span class="token punctuation">(</span>opt<span class="token punctuation">.</span>SERIAL_PORT2<span class="token punctuation">,</span> <span class="token number">9600</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">2.5</span><span class="token punctuation">)</span>
        <span class="token comment"># self.ser3 = serial.Serial(opt.SERIAL_PORT3, 9600, timeout=2.5)</span>

        <span class="token comment"># 隐藏指定的标签</span>
        self<span class="token punctuation">.</span>label_4<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_5<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_6<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token comment"># 初始化一些列表和集合，用于存储识别结果</span>
        self<span class="token punctuation">.</span>list_zong1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>list_zong2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>list_zong3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>set_zong1 <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>set_zong2 <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>set_zong3 <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>set_12hun <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>guo <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        self<span class="token punctuation">.</span>list1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>list2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>list3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        <span class="token comment"># 最大化窗口显示</span>
        <span class="token comment"># self.showMaximized()</span>
        <span class="token comment"># 初始化第一个海康相机，指定相机IP地址</span>
        self<span class="token punctuation">.</span>camera1 <span class="token operator">=</span> HKCamera<span class="token punctuation">(</span>CameraIp<span class="token operator">=</span><span class="token string">'169.254.194.100'</span><span class="token punctuation">)</span>
        <span class="token comment"># 设置相机的像素格式为BayerGB8</span>
        self<span class="token punctuation">.</span>camera1<span class="token punctuation">.</span>set_Value<span class="token punctuation">(</span>param_type<span class="token operator">=</span><span class="token string">"enum_value"</span><span class="token punctuation">,</span> node_name<span class="token operator">=</span><span class="token string">"PixelFormat"</span><span class="token punctuation">,</span>
                               node_value<span class="token operator">=</span><span class="token string">'BayerGB8'</span><span class="token punctuation">)</span>
        <span class="token comment"># 设置相机的增益自动调整模式为连续</span>
        self<span class="token punctuation">.</span>camera1<span class="token punctuation">.</span>set_Value<span class="token punctuation">(</span>param_type<span class="token operator">=</span><span class="token string">"enum_value"</span><span class="token punctuation">,</span> node_name<span class="token operator">=</span><span class="token string">"GainAuto"</span><span class="token punctuation">,</span>
                               node_value<span class="token operator">=</span><span class="token string">'Continuous'</span><span class="token punctuation">)</span>
        <span class="token comment"># 设置相机的采集帧率为15.0000</span>
        self<span class="token punctuation">.</span>camera1<span class="token punctuation">.</span>set_Value<span class="token punctuation">(</span>param_type<span class="token operator">=</span><span class="token string">"float_value"</span><span class="token punctuation">,</span> node_name<span class="token operator">=</span><span class="token string">"AcquisitionFrameRate"</span><span class="token punctuation">,</span>
                               node_value<span class="token operator">=</span><span class="token string">'15.0000'</span><span class="token punctuation">)</span>
        <span class="token comment"># 自动曝光设置，这里注释掉了</span>
        <span class="token comment"># self.camera1.set_Value(param_type="enum_value", node_name="ExposureAuto",</span>
        <span class="token comment">#                        node_value='Continuous')  # 自动曝光</span>
        <span class="token comment"># 启动第一个相机</span>
        self<span class="token punctuation">.</span>camera1<span class="token punctuation">.</span>start_camera<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># 初始化第二个海康相机，指定相机IP地址</span>
        self<span class="token punctuation">.</span>camera2 <span class="token operator">=</span> HKCamera<span class="token punctuation">(</span>CameraIp<span class="token operator">=</span><span class="token string">'169.254.194.200'</span><span class="token punctuation">)</span>
        <span class="token comment"># 设置相机的像素格式为BayerGB8</span>
        self<span class="token punctuation">.</span>camera2<span class="token punctuation">.</span>set_Value<span class="token punctuation">(</span>param_type<span class="token operator">=</span><span class="token string">"enum_value"</span><span class="token punctuation">,</span> node_name<span class="token operator">=</span><span class="token string">"PixelFormat"</span><span class="token punctuation">,</span>
                               node_value<span class="token operator">=</span><span class="token string">'BayerGB8'</span><span class="token punctuation">)</span>
        <span class="token comment"># 设置相机的增益自动调整模式为连续</span>
        self<span class="token punctuation">.</span>camera2<span class="token punctuation">.</span>set_Value<span class="token punctuation">(</span>param_type<span class="token operator">=</span><span class="token string">"enum_value"</span><span class="token punctuation">,</span> node_name<span class="token operator">=</span><span class="token string">"GainAuto"</span><span class="token punctuation">,</span>
                               node_value<span class="token operator">=</span><span class="token string">'Continuous'</span><span class="token punctuation">)</span>
        <span class="token comment"># 设置相机的采集帧率为15.0000</span>
        self<span class="token punctuation">.</span>camera2<span class="token punctuation">.</span>set_Value<span class="token punctuation">(</span>param_type<span class="token operator">=</span><span class="token string">"float_value"</span><span class="token punctuation">,</span> node_name<span class="token operator">=</span><span class="token string">"AcquisitionFrameRate"</span><span class="token punctuation">,</span>
                               node_value<span class="token operator">=</span><span class="token string">'15.0000'</span><span class="token punctuation">)</span>
        <span class="token comment"># 自动曝光设置，这里注释掉了</span>
        <span class="token comment"># self.camera2.set_Value(param_type="enum_value", node_name="ExposureAuto",</span>
        <span class="token comment">#                        node_value='Continuous')   #自动曝光</span>
        <span class="token comment"># 水平和垂直下采样设置，这里注释掉了</span>
        <span class="token comment"># self.camera2.set_Value(param_type="enum_value", node_name="DecimationHorizontal",</span>
        <span class="token comment">#                        node_value='2')</span>
        <span class="token comment"># self.camera2.set_Value(param_type="enum_value", node_name="DecimationVertical",</span>
        <span class="token comment">#                        node_value='2')</span>
        <span class="token comment"># 启动第二个相机</span>
        self<span class="token punctuation">.</span>camera2<span class="token punctuation">.</span>start_camera<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># 打开第三个摄像头，使用指定的摄像头编号</span>
        self<span class="token punctuation">.</span>camera3 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span>opt<span class="token punctuation">.</span>cap_numb3<span class="token punctuation">)</span>

        <span class="token comment"># 创建一个线程，用于定时释放和重新打开第三个摄像头资源</span>
        release_thread2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>release_capture2<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>camera3<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 将线程设置为守护线程，主线程退出时该线程也会退出</span>
        release_thread2<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token comment"># 启动线程</span>
        release_thread2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># 初始化摄像头打开状态为False</span>
        self<span class="token punctuation">.</span>is_camera_opened <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token comment"># 创建一个Qt定时器对象</span>
        self<span class="token punctuation">.</span>_timer <span class="token operator">=</span> QtCore<span class="token punctuation">.</span>QTimer<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token comment"># 当定时器超时时，调用_queryFrame方法</span>
        self<span class="token punctuation">.</span>_timer<span class="token punctuation">.</span>timeout<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_queryFrame<span class="token punctuation">)</span>
        <span class="token comment"># 设置定时器的间隔时间，单位为毫秒</span>
        self<span class="token punctuation">.</span>_timer<span class="token punctuation">.</span>setInterval<span class="token punctuation">(</span>opt<span class="token punctuation">.</span>frame_delay<span class="token punctuation">)</span>

        <span class="token comment"># 初始化帧计数器为0</span>
        self<span class="token punctuation">.</span>frame_counter <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token comment"># 模拟点击按钮，这里注释掉了</span>
        <span class="token comment"># self.pushButton_4.click()</span>

    <span class="token comment"># 定义一个方法，用于打开或关闭摄像头</span>
    <span class="token keyword">def</span> <span class="token function">openvideo</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 切换摄像头打开状态</span>
        self<span class="token punctuation">.</span>is_camera_opened <span class="token operator">=</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_camera_opened
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>is_camera_opened<span class="token punctuation">:</span>
            <span class="token comment"># 如果摄像头打开，修改按钮文本为“关闭”</span>
            self<span class="token punctuation">.</span>pushButton_4<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"关闭"</span><span class="token punctuation">)</span>
            <span class="token comment"># 启动定时器</span>
            self<span class="token punctuation">.</span>_timer<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 如果摄像头关闭，修改按钮文本为“打开”</span>
            self<span class="token punctuation">.</span>pushButton_4<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"打开"</span><span class="token punctuation">)</span>
            <span class="token comment"># 停止定时器</span>
            self<span class="token punctuation">.</span>_timer<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># 发送关闭蜂鸣器的命令到第一个串口</span>
            sendCmdToDevice<span class="token punctuation">(</span>BUZZ_CMD_CLOSE<span class="token punctuation">,</span> self<span class="token punctuation">.</span>ser1<span class="token punctuation">)</span>
            <span class="token comment"># 发送关闭蜂鸣器的命令到第二个串口</span>
            sendCmdToDevice<span class="token punctuation">(</span>BUZZ_CMD_CLOSE<span class="token punctuation">,</span> self<span class="token punctuation">.</span>ser2<span class="token punctuation">)</span>
            <span class="token comment"># 发送关闭蜂鸣器的命令到第三个串口，这里注释掉了</span>
            <span class="token comment"># sendCmdToDevice(BUZZ_CMD_CLOSE, self.ser3)</span>
            <span class="token comment"># 隐藏指定的标签</span>
            self<span class="token punctuation">.</span>label_4<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>label_5<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>label_6<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token comment"># 定义一个方法，用于打开指定文件夹</span>
    <span class="token keyword">def</span> <span class="token function">open_folder</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 定义文件夹路径</span>
        folder_path <span class="token operator">=</span> <span class="token string">r'D:\MVS\Development\Samples\Python\shiyan\baojing'</span>
        <span class="token comment"># 打开指定文件夹</span>
        QDesktopServices<span class="token punctuation">.</span>openUrl<span class="token punctuation">(</span>QUrl<span class="token punctuation">.</span>fromLocalFile<span class="token punctuation">(</span>folder_path<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 定义一个方法，用于清空第一个集合和列表，并关闭蜂鸣器，隐藏标签</span>
    <span class="token keyword">def</span> <span class="token function">clearSet1</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 清空第一个集合</span>
        self<span class="token punctuation">.</span>set_zong1<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 清空第一个列表，这里注释掉了</span>
        <span class="token comment"># self.list_zong1.clear()</span>
        <span class="token comment"># 清空第一个临时列表</span>
        self<span class="token punctuation">.</span>list1<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 发送关闭蜂鸣器的命令到第一个串口</span>
        sendCmdToDevice<span class="token punctuation">(</span>BUZZ_CMD_CLOSE<span class="token punctuation">,</span> self<span class="token punctuation">.</span>ser1<span class="token punctuation">)</span>
        <span class="token comment"># 隐藏指定的标签</span>
        self<span class="token punctuation">.</span>label_4<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token comment"># 定义一个方法，用于清空第二个集合和列表，并关闭蜂鸣器，隐藏标签</span>
    <span class="token keyword">def</span> <span class="token function">clearSet2</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 清空第二个集合</span>
        self<span class="token punctuation">.</span>set_zong2<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 清空第二个列表，这里注释掉了</span>
        <span class="token comment"># self.list_zong2.clear()</span>
        <span class="token comment"># 清空第二个临时列表</span>
        self<span class="token punctuation">.</span>list2<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 发送关闭蜂鸣器的命令到第二个串口</span>
        sendCmdToDevice<span class="token punctuation">(</span>BUZZ_CMD_CLOSE<span class="token punctuation">,</span> self<span class="token punctuation">.</span>ser2<span class="token punctuation">)</span>
        <span class="token comment"># 隐藏指定的标签</span>
        self<span class="token punctuation">.</span>label_5<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token comment"># 定义一个装饰器函数，用于在函数调用n次后执行另一个函数</span>
    <span class="token keyword">def</span> <span class="token function">execute_after_n_calls</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> w2set<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">decorator</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># 记录函数调用次数</span>
                wrapper<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token comment"># 调用原函数</span>
                result <span class="token operator">=</span> func<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
                <span class="token keyword">if</span> wrapper<span class="token punctuation">.</span>count <span class="token operator">%</span> n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token comment"># 当调用次数达到n的倍数时，执行指定的函数</span>
                    w2set<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
                <span class="token keyword">return</span> result
            <span class="token comment"># 初始化函数调用次数为0</span>
            wrapper<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span>
       <span class="token comment"># 返回包装函数</span>
            <span class="token keyword">return</span> wrapper
        <span class="token comment"># 返回装饰器函数</span>
        <span class="token keyword">return</span> decorator

    <span class="token comment"># 声明这是一个 PyQt 的槽函数，用于处理定时器超时事件，定期查询并处理摄像头帧</span>
    <span class="token decorator annotation punctuation">@QtCore<span class="token punctuation">.</span>pyqtSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">_queryFrame</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 尝试从第三个摄像头抓取一帧图像</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>camera3<span class="token punctuation">.</span>grab<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># 如果抓取失败，打印提示信息</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"No frame grabbed."</span><span class="token punctuation">)</span>
                <span class="token comment"># 释放第三个摄像头资源</span>
                self<span class="token punctuation">.</span>camera3<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment"># 关闭当前窗口</span>
                self<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 如果抓取成功，从第一个海康相机获取图像，并指定返回的图像类型为 ndarray</span>
                self<span class="token punctuation">.</span>frame1<span class="token punctuation">:</span> ndarray <span class="token operator">=</span> self<span class="token punctuation">.</span>camera1<span class="token punctuation">.</span>get_image<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment"># 从第二个海康相机获取图像，并指定返回的图像类型为 ndarray</span>
                self<span class="token punctuation">.</span>frame2<span class="token punctuation">:</span> ndarray <span class="token operator">=</span> self<span class="token punctuation">.</span>camera2<span class="token punctuation">.</span>get_image<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment"># 从第三个摄像头读取一帧图像，ret3 表示是否成功读取，self.frame3 为读取的图像</span>
                ret3<span class="token punctuation">,</span> self<span class="token punctuation">.</span>frame3 <span class="token operator">=</span> self<span class="token punctuation">.</span>camera3<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

                <span class="token comment"># 检查是否成功从第三个摄像头读取到图像</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> ret3<span class="token punctuation">:</span>
                    <span class="token comment"># 如果读取失败，打印提示信息</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"No frame retrieved."</span><span class="token punctuation">)</span>
                    <span class="token comment"># 注释掉的代码，原可能用于释放第一个相机资源</span>
                    <span class="token comment"># self.camera1.release()</span>
                    <span class="token comment"># 释放第三个摄像头资源</span>
                    self<span class="token punctuation">.</span>camera3<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token comment"># 关闭当前窗口</span>
                    self<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># 如果读取成功，将第一个相机的图像调整为 640x480 大小</span>
                    self<span class="token punctuation">.</span>frame11 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token comment"># 将第二个相机的图像调整为 640x480 大小</span>
                    self<span class="token punctuation">.</span>frame22 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token comment"># 将第三个摄像头的图像调整为 640x480 大小</span>
                    self<span class="token punctuation">.</span>frame33 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame3<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

                    <span class="token comment"># 再次检查是否成功从第三个摄像头读取到图像</span>
                    <span class="token keyword">if</span> ret3<span class="token punctuation">:</span>
                        <span class="token comment"># 将第一个相机调整大小后的图像从 BGR 颜色空间转换为 RGB 颜色空间</span>
                        qimage <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame11<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
                        <span class="token comment"># 将转换后的图像数据封装为 QtGui.QImage 对象</span>
                        qimage <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">(</span>qimage<span class="token punctuation">.</span>data<span class="token punctuation">,</span> qimage<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> qimage<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">.</span>Format_RGB888<span class="token punctuation">)</span>
                        <span class="token comment"># 将 QImage 对象转换为 QPixmap 对象</span>
                        pixmap <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QPixmap<span class="token punctuation">.</span>fromImage<span class="token punctuation">(</span>qimage<span class="token punctuation">)</span>

                        <span class="token comment"># 将第二个相机调整大小后的图像从 BGR 颜色空间转换为 RGB 颜色空间</span>
                        qimage2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame22<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
                        <span class="token comment"># 将转换后的图像数据封装为 QtGui.QImage 对象</span>
                        qimage2 <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">(</span>qimage2<span class="token punctuation">.</span>data<span class="token punctuation">,</span> qimage2<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> qimage2<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">.</span>Format_RGB888<span class="token punctuation">)</span>
                        <span class="token comment"># 将 QImage 对象转换为 QPixmap 对象</span>
                        pixmap2 <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QPixmap<span class="token punctuation">.</span>fromImage<span class="token punctuation">(</span>qimage2<span class="token punctuation">)</span>

                        <span class="token comment"># 将第三个摄像头调整大小后的图像从 BGR 颜色空间转换为 RGB 颜色空间</span>
                        qimage3 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame33<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
                        <span class="token comment"># 将转换后的图像数据封装为 QtGui.QImage 对象</span>
                        qimage3 <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">(</span>qimage3<span class="token punctuation">.</span>data<span class="token punctuation">,</span> qimage3<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> qimage3<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">.</span>Format_RGB888<span class="token punctuation">)</span>
                        <span class="token comment"># 将 QImage 对象转换为 QPixmap 对象</span>
                        pixmap3 <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QPixmap<span class="token punctuation">.</span>fromImage<span class="token punctuation">(</span>qimage3<span class="token punctuation">)</span>

                        <span class="token comment"># 将第一个相机图像对应的 QPixmap 对象设置到名为 label 的标签上进行显示</span>
                        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setPixmap<span class="token punctuation">(</span>pixmap<span class="token punctuation">)</span>
                        <span class="token comment"># 将第二个相机图像对应的 QPixmap 对象设置到名为 label_3 的标签上进行显示</span>
                        self<span class="token punctuation">.</span>label_3<span class="token punctuation">.</span>setPixmap<span class="token punctuation">(</span>pixmap2<span class="token punctuation">)</span>
                        <span class="token comment"># 将第三个摄像头图像对应的 QPixmap 对象设置到名为 label_2 的标签上进行显示</span>
                        self<span class="token punctuation">.</span>label_2<span class="token punctuation">.</span>setPixmap<span class="token punctuation">(</span>pixmap3<span class="token punctuation">)</span>

                        <span class="token comment"># 每处理一帧图像，帧计数器加 1</span>
                        self<span class="token punctuation">.</span>frame_counter <span class="token operator">+=</span> <span class="token number">1</span>
                        <span class="token comment"># 检查帧计数器是否是 5 的倍数</span>
                        <span class="token keyword">if</span> self<span class="token punctuation">.</span>frame_counter <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            <span class="token comment"># 如果是 5 的倍数，调用 _performOCR1 方法进行 OCR 识别</span>
                            self<span class="token punctuation">.</span>_performOCR1<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token comment"># 检查帧计数器是否是 3 的倍数</span>
                        <span class="token keyword">if</span> self<span class="token punctuation">.</span>frame_counter <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            <span class="token comment"># 如果是 3 的倍数，调用 _performOCR2 方法进行 OCR 识别</span>
                            self<span class="token punctuation">.</span>_performOCR2<span class="token punctuation">(</span><span class="token punctuation">)</span>

                        <span class="token comment"># 注释掉的代码，原可能用于调用 OCR 识别方法</span>
                        <span class="token comment"># self._performOCR1()</span>
                        <span class="token comment"># self._performOCR2()</span>
                        <span class="token comment"># self._performOCR3()</span>
                        <span class="token comment"># 再次检查帧计数器是否是 3 的倍数</span>
                        <span class="token keyword">if</span> self<span class="token punctuation">.</span>frame_counter <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            <span class="token comment"># 如果是 3 的倍数，调用 _performOCR3 方法进行 OCR 识别</span>
                            self<span class="token punctuation">.</span>_performOCR3<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token comment"># 捕获所有异常，不做具体处理，避免程序因异常而崩溃</span>
            <span class="token keyword">pass</span>

        

    <span class="token comment"># 定义一个方法 w2set1，用于处理第一个相机的 OCR 识别结果，进行结果分析、显示和异常处理</span>
    <span class="token keyword">def</span> <span class="token function">w2set1</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 初始化最终答案为空字符串</span>
        self<span class="token punctuation">.</span>daan1 <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token comment"># 检查存储第一个相机 OCR 识别结果的列表是否不为空</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>list_zong1<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token comment"># 遍历存储第一个相机 OCR 识别结果的列表</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>list_zong1<span class="token punctuation">:</span>
                    <span class="token comment"># 检查元素 i 在列表中出现的次数是否大于 1</span>
                    <span class="token keyword">if</span> self<span class="token punctuation">.</span>list_zong1<span class="token punctuation">.</span>count<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
                        <span class="token comment"># 如果出现次数大于 1，将该元素添加到第一个相机结果集合中</span>
                        self<span class="token punctuation">.</span>set_zong1<span class="token punctuation">.</span>add<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
                <span class="token comment"># 对第一个相机结果集合进行字符替换处理，得到处理后的集合</span>
                set_len1 <span class="token operator">=</span> set_bing<span class="token punctuation">(</span>self<span class="token punctuation">.</span>set_zong1<span class="token punctuation">)</span>  <span class="token comment"># 当前的结果</span>

                <span class="token comment"># 遍历处理后的集合</span>
                <span class="token keyword">for</span> j <span class="token keyword">in</span> set_len1<span class="token punctuation">:</span>
                    <span class="token comment"># 将集合中的元素添加到临时列表 list1 中</span>
                    self<span class="token punctuation">.</span>list1<span class="token punctuation">.</span>append<span class="token punctuation">(</span>j<span class="token punctuation">)</span>

                <span class="token comment"># 找出临时列表 list1 中出现次数最多的元素，作为最终答案</span>
                self<span class="token punctuation">.</span>daan1 <span class="token operator">=</span> most_common_element<span class="token punctuation">(</span>self<span class="token punctuation">.</span>list1<span class="token punctuation">)</span>

                <span class="token comment"># 检查帧计数器是否是 16 的倍数，大约每 10 秒刷新一次临时列表</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>frame_counter <span class="token operator">%</span> <span class="token number">16</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token comment"># 如果是 16 的倍数，清空临时列表 list1</span>
                    self<span class="token punctuation">.</span>list1<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

                <span class="token comment"># 将处理后的集合中的元素用逗号连接成一个字符串</span>
                text <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>set_len1<span class="token punctuation">)</span>
                <span class="token comment"># 将连接后的字符串显示在名为 lineEdit 的文本框中</span>
                self<span class="token punctuation">.</span>lineEdit<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>text<span class="token punctuation">)</span>

                <span class="token comment"># 进行结果判断</span>
                <span class="token comment"># 如果最终答案为空或者处理后的集合为空，不做任何处理</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">not</span> self<span class="token punctuation">.</span>daan1<span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token keyword">not</span> set_len1<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">pass</span>
                <span class="token comment"># 如果处理后的集合中只有一个元素，且该元素等于最终答案，不做任何处理</span>
                <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>set_len1<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>set_len1<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>daan1<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">pass</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># 如果不满足上述条件，打印提示信息</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'一'</span><span class="token punctuation">)</span>
                    <span class="token comment"># 打印处理后的集合和最终答案</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>set_len1<span class="token punctuation">,</span> self<span class="token punctuation">.</span>daan1<span class="token punctuation">)</span>

                    <span class="token comment"># 在第一个相机的图像副本上添加文本信息，文本内容为处理后的集合元素连接成的字符串</span>
                    tu1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame1<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>
                                      cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>

                    <span class="token comment"># 获取当前时间，格式化为指定的字符串</span>
                    nam <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y_%m_%d_%H_%M"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token comment"># 构建保存异常图像的文件路径</span>
                    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">r'D:\MVS\Development\Samples\Python\shiyan\baojing\相机一'</span><span class="token punctuation">,</span>
                                        <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>nam<span class="token punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>daan1<span class="token punctuation">}</span></span><span class="token string">.jpg'</span></span><span class="token punctuation">)</span>
                    <span class="token comment"># 将添加文本后的图像保存到指定路径</span>
                    cv2<span class="token punctuation">.</span>imencode<span class="token punctuation">(</span><span class="token string">'.jpg'</span><span class="token punctuation">,</span> tu1<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tofile<span class="token punctuation">(</span>path<span class="token punctuation">)</span>

                    <span class="token comment"># 显示名为 label_4 的标签，可能用于提示异常信息</span>
                    self<span class="token punctuation">.</span>label_4<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
                    <span class="token comment"># 发送打开灯光的命令到第一个串口，可能用于触发灯光提示</span>
                    <span class="token comment"># sendCmdToDevice(LIGHT_BUZZ1, self.ser1)</span>
                    sendCmdToDevice<span class="token punctuation">(</span>LIGHT<span class="token punctuation">,</span> self<span class="token punctuation">.</span>ser1<span class="token punctuation">)</span>
                    <span class="token comment"># 5 秒后隐藏标签并发送关闭蜂鸣器的命令</span>
                    QtCore<span class="token punctuation">.</span>QTimer<span class="token punctuation">.</span>singleShot<span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> hide_label_and_send_cmd<span class="token punctuation">(</span>self<span class="token punctuation">.</span>label_4<span class="token punctuation">,</span> self<span class="token punctuation">.</span>ser1<span class="token punctuation">)</span><span class="token punctuation">)</span>

                    <span class="token comment"># 清空存储第一个相机 OCR 识别结果的列表和集合</span>
                    <span class="token comment"># self.list_zong1.clear()</span>
                    <span class="token comment"># self.set_zong1.clear()</span>
                    <span class="token comment"># 重置帧计数器为 0</span>
                    self<span class="token punctuation">.</span>frame_counter <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token comment"># 捕获异常并打印异常信息</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
            <span class="token comment"># 清空存储第一个相机 OCR 识别结果的列表和集合</span>
            self<span class="token punctuation">.</span>list_zong1<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>set_zong1<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 使用 execute_after_n_calls 装饰器，使得 _performOCR1 方法每调用 5 次后执行 w2set1 方法</span>
    <span class="token decorator annotation punctuation">@execute_after_n_calls</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> w2set1<span class="token punctuation">)</span>
    <span class="token comment"># 定义一个方法 _performOCR1，用于对第一个相机的图像进行 OCR 识别</span>
    <span class="token keyword">def</span> <span class="token function">_performOCR1</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 使用 ocr2 对第一个相机的图像进行 OCR 识别，不进行角度分类</span>
        result <span class="token operator">=</span> ocr2<span class="token punctuation">.</span>ocr<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame1<span class="token punctuation">,</span> cls<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token comment"># 检查识别结果是否不为空，且结果中不包含 None</span>
        <span class="token keyword">if</span> result <span class="token keyword">and</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">in</span> result<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token comment"># 遍历识别结果中的每一项</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    <span class="token comment"># 打印当前识别项</span>
                    <span class="token comment"># print(i)</span>
                    <span class="token comment"># 计算当前识别项所包围区域的面积</span>
                    mianji <span class="token operator">=</span> are<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
                    <span class="token comment"># 打印当前识别项和其面积</span>
                    <span class="token comment"># print('yi',i,mianji)</span>
                    <span class="token comment"># 对当前识别项的文本内容进行处理，提取符合条件的部分</span>
                    ma <span class="token operator">=</span> process_string<span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token comment"># 检查识别置信度是否大于 0.92，处理后的文本是否不为空，识别区域的左上角 x 坐标是否在 320 到 1060 之间，且面积是否大于 5000</span>
                    <span class="token comment"># if i[1][1] &gt; 0.92 and ma and 80&lt;i[0][0][0]&lt;550 and mianji&gt;1000:</span>
                    <span class="token keyword">if</span> i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0.92</span> <span class="token keyword">and</span> ma <span class="token keyword">and</span> <span class="token number">320</span> <span class="token operator">&lt;</span> i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">1060</span> <span class="token keyword">and</span> mianji <span class="token operator">&gt;</span> <span class="token number">5000</span><span class="token punctuation">:</span>
                        <span class="token comment"># 如果满足条件，将处理后的文本添加到存储第一个相机 OCR 识别结果的列表中</span>
                        self<span class="token punctuation">.</span>list_zong1<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>ma<span class="token punctuation">)</span>
                        <span class="token comment"># 打印当前识别项的文本内容和其面积</span>
                        <span class="token comment"># print(i[1][0], are(i))</span>
                <span class="token comment"># 打印分割线，用于区分不同帧的识别结果</span>
                <span class="token comment"># print('******************')</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                <span class="token comment"># 捕获异常，不做具体处理</span>
                <span class="token keyword">pass</span>

    <span class="token comment"># 定义处理第二个相机OCR结果的方法，进行结果分析、显示和异常处理</span>
    <span class="token keyword">def</span> <span class="token function">w2set2</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>daan2 <span class="token operator">=</span> <span class="token string">''</span>  <span class="token comment"># 初始化最终答案为空字符串</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>list_zong2<span class="token punctuation">:</span>  <span class="token comment"># 检查存储第二个相机OCR结果的列表是否有数据</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token comment"># 遍历列表，统计出现次数超过1次的元素并存入集合</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>list_zong2<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> self<span class="token punctuation">.</span>list_zong2<span class="token punctuation">.</span>count<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>set_zong2<span class="token punctuation">.</span>add<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

                <span class="token comment"># 对集合中的字符进行替换处理</span>
                set_len2 <span class="token operator">=</span> set_bing<span class="token punctuation">(</span>self<span class="token punctuation">.</span>set_zong2<span class="token punctuation">)</span>

                <span class="token comment"># 将处理后的字符添加到临时列表</span>
                <span class="token keyword">for</span> j <span class="token keyword">in</span> set_len2<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>list2<span class="token punctuation">.</span>append<span class="token punctuation">(</span>j<span class="token punctuation">)</span>

                <span class="token comment"># 找出临时列表中出现次数最多的元素作为最终答案</span>
                self<span class="token punctuation">.</span>daan2 <span class="token operator">=</span> most_common_element<span class="token punctuation">(</span>self<span class="token punctuation">.</span>list2<span class="token punctuation">)</span>

                <span class="token comment"># 每25帧清空临时列表（约14秒刷新）</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>frame_counter <span class="token operator">%</span> <span class="token number">25</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>list2<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

                <span class="token comment"># 将结果显示在文本框中</span>
                text2 <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>set_len2<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>lineEdit_2<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>text2<span class="token punctuation">)</span>

                <span class="token comment"># 结果验证逻辑</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">not</span> self<span class="token punctuation">.</span>daan2<span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token keyword">not</span> set_len2<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">pass</span>  <span class="token comment"># 结果为空时不处理</span>
                <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>set_len2<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>set_len2<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>daan2<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">pass</span>  <span class="token comment"># 唯一结果时不处理</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'二'</span><span class="token punctuation">)</span>  <span class="token comment"># 打印调试信息</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>set_len2<span class="token punctuation">,</span> self<span class="token punctuation">.</span>daan2<span class="token punctuation">)</span>  <span class="token comment"># 输出当前结果和最终答案</span>

                    <span class="token comment"># 在图像上添加文本标注</span>
                    tu2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame2<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> text2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                      cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>

                    <span class="token comment"># 保存异常图像</span>
                    nam2 <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y_%m_%d_%H_%M"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">r'D:\MVS\Development\Samples\Python\shiyan\baojing\相机二'</span><span class="token punctuation">,</span>
                                        <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>nam2<span class="token punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>daan2<span class="token punctuation">}</span></span><span class="token string">.jpg'</span></span><span class="token punctuation">)</span>
                    cv2<span class="token punctuation">.</span>imencode<span class="token punctuation">(</span><span class="token string">'.jpg'</span><span class="token punctuation">,</span> tu2<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tofile<span class="token punctuation">(</span>path<span class="token punctuation">)</span>

                    <span class="token comment"># 显示报警标签并控制灯光</span>
                    self<span class="token punctuation">.</span>label_5<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
                    sendCmdToDevice<span class="token punctuation">(</span>LIGHT<span class="token punctuation">,</span> self<span class="token punctuation">.</span>ser2<span class="token punctuation">)</span>  <span class="token comment"># 打开灯光</span>
                    <span class="token comment"># 5秒后关闭灯光并隐藏标签</span>
                    QtCore<span class="token punctuation">.</span>QTimer<span class="token punctuation">.</span>singleShot<span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> hide_label_and_send_cmd<span class="token punctuation">(</span>self<span class="token punctuation">.</span>label_5<span class="token punctuation">,</span> self<span class="token punctuation">.</span>ser2<span class="token punctuation">)</span><span class="token punctuation">)</span>

                    <span class="token comment"># 重置帧计数器</span>
                    self<span class="token punctuation">.</span>frame_counter <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>  <span class="token comment"># 异常处理</span>
            <span class="token keyword">finally</span><span class="token punctuation">:</span>
                <span class="token comment"># 清空临时数据</span>
                self<span class="token punctuation">.</span>list_zong2<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>set_zong2<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># 合并两个相机的识别结果</span>
        self<span class="token punctuation">.</span>set_12hun <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>daan1<span class="token punctuation">,</span> self<span class="token punctuation">.</span>daan2<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'1:'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>daan1<span class="token punctuation">)</span>  <span class="token comment"># 打印调试信息</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'2:'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>daan2<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'合:'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>set_12hun<span class="token punctuation">)</span>

    <span class="token comment"># 使用装饰器控制OCR执行频率（每3次调用后处理结果）</span>
    <span class="token decorator annotation punctuation">@execute_after_n_calls</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> w2set2<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">_performOCR2</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        result2 <span class="token operator">=</span> ocr2<span class="token punctuation">.</span>ocr<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame2<span class="token punctuation">,</span> cls<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>  <span class="token comment"># 执行OCR识别</span>
        <span class="token keyword">if</span> result2 <span class="token keyword">and</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">in</span> result2<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> result2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    mianji <span class="token operator">=</span> are<span class="token punctuation">(</span>i<span class="token punctuation">)</span>  <span class="token comment"># 计算识别区域面积</span>
                    ma <span class="token operator">=</span> process_string<span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 文本处理</span>
                    <span class="token comment"># 置信度、文本有效性、区域位置和面积过滤条件</span>
                    <span class="token keyword">if</span> i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0.84</span> <span class="token keyword">and</span> ma <span class="token keyword">and</span> mianji <span class="token operator">&gt;</span> <span class="token number">1600</span> <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token number">350</span> <span class="token operator">&lt;</span> i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">1060</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>list_zong2<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>ma<span class="token punctuation">)</span>  <span class="token comment"># 保存有效识别结果</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                <span class="token keyword">pass</span>
        <span class="token keyword">elif</span> <span class="token boolean">None</span> <span class="token keyword">in</span> result2<span class="token punctuation">:</span>
            <span class="token comment"># 处理识别结果包含None的情况</span>
            self<span class="token punctuation">.</span>daan2 <span class="token operator">=</span> <span class="token string">''</span>
            self<span class="token punctuation">.</span>set_12hun <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>daan1<span class="token punctuation">,</span> self<span class="token punctuation">.</span>daan2<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'1:'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>daan1<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'2:'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>daan2<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'合:'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>set_12hun<span class="token punctuation">)</span>

    <span class="token comment"># 定义处理第三个相机OCR结果的方法</span>
    <span class="token keyword">def</span> <span class="token function">w2set3</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        maxx <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 记录最大面积</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>list_zong3<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token comment"># 提取所有识别文本并统计出现次数</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>list_zong3<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>guo<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>guo<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> self<span class="token punctuation">.</span>guo<span class="token punctuation">.</span>count<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>set_zong3<span class="token punctuation">.</span>add<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

                <span class="token comment"># 找出最大面积的有效识别结果</span>
                <span class="token keyword">for</span> j <span class="token keyword">in</span> self<span class="token punctuation">.</span>list_zong3<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>j<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>set_zong3<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>are<span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token operator">&gt;</span> maxx<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        aa <span class="token operator">=</span> j
                        maxx <span class="token operator">=</span> are<span class="token punctuation">(</span>j<span class="token punctuation">)</span>

                <span class="token comment"># 文本处理并显示</span>
                text3 <span class="token operator">=</span> aa<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'S'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'I'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">,</span>
                                                                                                                 <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>
                    <span class="token string">'v'</span><span class="token punctuation">,</span> <span class="token string">'V'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'P'</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>lineEdit_3<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>text3<span class="token punctuation">)</span>

                <span class="token comment"># 结果验证逻辑</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">not</span> text3<span class="token punctuation">)</span> <span class="token keyword">or</span> self<span class="token punctuation">.</span>set_12hun <span class="token operator">==</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> self<span class="token punctuation">.</span>set_12hun <span class="token operator">==</span> <span class="token punctuation">{<!-- --></span><span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">:</span>
                    <span class="token keyword">pass</span>  <span class="token comment"># 无效结果不处理</span>
                <span class="token keyword">elif</span> self<span class="token punctuation">.</span>set_12hun <span class="token keyword">and</span> In_which<span class="token punctuation">(</span>text3<span class="token punctuation">,</span> self<span class="token punctuation">.</span>set_12hun<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">pass</span>  <span class="token comment"># 匹配到合并结果不处理</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'三'</span><span class="token punctuation">)</span>  <span class="token comment"># 打印调试信息</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>text3<span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>set_12hun<span class="token punctuation">)</span>

                    <span class="token comment"># 在图像上添加文本标注</span>
                    tu3 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame3<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> text3<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                      cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>

                    <span class="token comment"># 保存异常图像</span>
                    nam3 <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y_%m_%d_%H_%M"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">r'D:\MVS\Development\Samples\Python\shiyan\baojing\相机三'</span><span class="token punctuation">,</span>
                                        <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>nam3<span class="token punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>set_12hun<span class="token punctuation">}</span></span><span class="token string">.jpg'</span></span><span class="token punctuation">)</span>
                    cv2<span class="token punctuation">.</span>imencode<span class="token punctuation">(</span><span class="token string">'.jpg'</span><span class="token punctuation">,</span> tu3<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tofile<span class="token punctuation">(</span>path<span class="token punctuation">)</span>

                    <span class="token comment"># 重置合并结果并触发报警</span>
                    self<span class="token punctuation">.</span>set_12hun<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>label_6<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
                    sendCmdToDevice<span class="token punctuation">(</span>LIGHT<span class="token punctuation">,</span> self<span class="token punctuation">.</span>ser2<span class="token punctuation">)</span>  <span class="token comment"># 打开灯光</span>
                    QtCore<span class="token punctuation">.</span>QTimer<span class="token punctuation">.</span>singleShot<span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> hide_label_and_send_cmd<span class="token punctuation">(</span>self<span class="token punctuation">.</span>label_6<span class="token punctuation">,</span> self<span class="token punctuation">.</span>ser2<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                <span class="token keyword">pass</span>
            <span class="token keyword">finally</span><span class="token punctuation">:</span>
                <span class="token comment"># 清空临时数据</span>
                self<span class="token punctuation">.</span>guo<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>list_zong3<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>set_zong3<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 使用装饰器控制OCR执行频率（每3次调用后处理结果）</span>
    <span class="token decorator annotation punctuation">@execute_after_n_calls</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> w2set3<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">_performOCR3</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">global</span> text3
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 颜色检测预处理</span>
            hsv_image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame3<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2HSV<span class="token punctuation">)</span>
            lower_brown <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            upper_brown <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            mask <span class="token operator">=</span> cv2<span class="token punctuation">.</span>inRange<span class="token punctuation">(</span>hsv_image<span class="token punctuation">,</span> lower_brown<span class="token punctuation">,</span> upper_brown<span class="token punctuation">)</span>
            white_pixels <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>mask <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
            total_pixels <span class="token operator">=</span> mask<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> mask<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            color_percentage <span class="token operator">=</span> <span class="token punctuation">(</span>white_pixels <span class="token operator">/</span> total_pixels<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span>

            <span class="token comment"># 当棕色区域超过20%时执行OCR</span>
            <span class="token keyword">if</span> color_percentage <span class="token operator">&gt;=</span> <span class="token number">20</span><span class="token punctuation">:</span>
                result2 <span class="token operator">=</span> ocr2<span class="token punctuation">.</span>ocr<span class="token punctuation">(</span>self<span class="token punctuation">.</span>frame3<span class="token punctuation">,</span> cls<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> result2 <span class="token keyword">and</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">in</span> result2<span class="token punctuation">:</span>
                    <span class="token keyword">for</span> j <span class="token keyword">in</span> result2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        <span class="token comment"># 置信度和文本有效性过滤</span>
                        <span class="token keyword">if</span> j<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0.93</span> <span class="token keyword">and</span> process_string<span class="token punctuation">(</span>j<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            self<span class="token punctuation">.</span>list_zong3<span class="token punctuation">.</span>append<span class="token punctuation">(</span>j<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    text3 <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            text3 <span class="token operator">=</span> <span class="token string">''</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    app <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>  <span class="token comment"># 创建Qt应用程序实例</span>
    window <span class="token operator">=</span> PyQtMainEntry<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 创建主窗口实例</span>
    window<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 显示主窗口</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 进入应用程序主循环</span>
</code></pre>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f6c6f75303732302f:61727469636c652f64657461696c732f313436313838353339" class_="artid" style="display:none">
 </p>
</div>


