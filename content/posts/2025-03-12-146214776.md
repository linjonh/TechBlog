---
layout: post
title: "VueNode.jsMySQLElement-Plus实现一个账号注册与登录功能"
date: 2025-03-12 23:51:40 +0800
description: "Vue+Element实现前端页面，Node.js完成后端服务器与接口，MySQL存储用户相关信息。"
keywords: "Vue+Node.js+MySQL+Element-Plus实现一个账号注册与登录功能"
categories: ['未分类']
tags: ['Vue', 'Node', 'Mysql']
artid: "146214776"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146214776
    alt: "VueNode.jsMySQLElement-Plus实现一个账号注册与登录功能"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146214776
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146214776
cover: https://bing.ee123.net/img/rand?artid=146214776
image: https://bing.ee123.net/img/rand?artid=146214776
img: https://bing.ee123.net/img/rand?artid=146214776
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Vue+Node.js+MySQL+Element-Plus实现一个账号注册与登录功能
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <ul>
     <li>
      准备工作：先理清整体思路，明白各功能的实现思路
     </li>
    </ul>
    <ol>
     <li>
      使用Vue框架以及element-plus组件库来写前端页面
     </li>
     <li>
      使用Node.js来写后端接口以及连接数据库
     </li>
     <li>
      使用MySQL来存储用户信息
     </li>
    </ol>
    <h2>
     <a id="_6">
     </a>
     前端部分
    </h2>
    <h3>
     <a id="Vitevue_7">
     </a>
     Vite快速构建vue项目
    </h3>
    <ul>
     <li>
      我这里使用了
      <code>
       Vite
      </code>
      来快速构建了一个
      <code>
       vue
      </code>
      项目，构建命令如下：
      <br/>
      <code>
       npm create vite@latest my-vue-app -- --template vue
      </code>
     </li>
    </ul>
    <h3>
     <a id="ElementPlus_10">
     </a>
     引入Element-Plus组件库
    </h3>
    <ul>
     <li>
      Element-Plus官网中也有更加详细的引入流程
     </li>
     <li>
      这里我采用的是
      <strong>
       按需自动导入
      </strong>
      element组件
     </li>
     <li>
      首先需要安装
      <code>
       unplugin-vue-components
      </code>
      和
      <code>
       unplugin-auto-import
      </code>
      这两款插件，命令如下：
     </li>
     <li>
      <code>
       npm install -D unplugin-vue-components unplugin-auto-import
      </code>
     </li>
     <li>
      再将下面的代码插入
      <code>
       Vite
      </code>
      的配置文件中即可
     </li>
    </ul>
    <pre><code class="prism language-ts"><span class="token comment">// vite.config</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> AutoImport <span class="token keyword">from</span> <span class="token string">'unplugin-auto-import/vite'</span>
<span class="token keyword">import</span> Components <span class="token keyword">from</span> <span class="token string">'unplugin-vue-components/vite'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ElementPlusResolver <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'unplugin-vue-components/resolvers'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">// ...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
    <span class="token function">AutoImport</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      resolvers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">ElementPlusResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">Components</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      resolvers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">ElementPlusResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_36">
     </a>
     静态登录页面
    </h3>
    <ul>
     <li>
      接下来是写出了登录页面的静态页面，这个地方因人而异，大家可以写出自己喜欢的页面，效果如下：
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7d76a8b8798049439596bcb4e7861f7f.png"/>
     </li>
    </ul>
    <h3>
     <a id="_39">
     </a>
     使用正则表达式进行表单校验
    </h3>
    <ul>
     <li>
      这里我先分别定义了账号和密码的正则表达式
      <ul>
       <li>
        账号：用于验证用户名是否只包含字母（大小写均可）和数字，账号里面的
        <code>
         +
        </code>
        表示账号不能为空
       </li>
       <li>
        密码：用于验证密码是否只包含字母（大小写均可）、数字和下划线，并且长度在 2 到 16 个字符之间。
       </li>
      </ul>
     </li>
     <li>
      然后在表单变化的回调函数中进行校验
     </li>
    </ul>
    <pre><code class="prism language-js"><span class="token comment">//用户名变化回调函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">onUsernameChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// console.log(event);</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>reg_username<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">ElMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"用户名格式不对，只能是字母和数字"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"warning"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">plain</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//密码变化回调函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">onPasswordChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>reg_password<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">ElMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"密码格式不对，只能包含字母、数字、下划线"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"warning"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">plain</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <pre><code class="prism language-js"><span class="token comment">//定义正则表达式</span>
<span class="token keyword">const</span> reg_username <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[a-zA-Z0-9]+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> reg_password <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[a-zA-Z0-9_]{2,16}$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="_72">
     </a>
     动态绑定表单数据
    </h3>
    <ul>
     <li>
      这里我用到了
      <code>
       vue
      </code>
      中的
      <code>
       ref
      </code>
      响应式数据，将
      <code>
       username
      </code>
      和
      <code>
       password
      </code>
      都定义为
      <code>
       ref
      </code>
      类型
     </li>
    </ul>
    <pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> username <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> password <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      并将
      <code>
       username
      </code>
      和
      <code>
       password
      </code>
      通过
      <code>
       v-model
      </code>
      动态绑定到表单中
     </li>
    </ul>
    <pre><code class="prism language-js"><span class="token comment">//账号</span>
 <span class="token operator">&lt;</span>el<span class="token operator">-</span>input
            @change<span class="token operator">=</span><span class="token string">"onUsernameChange"</span>
            label<span class="token operator">=</span><span class="token string">"用户名"</span>
            v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"username"</span> <span class="token comment">//绑定数据</span>
            style<span class="token operator">=</span><span class="token string">"width: 240px; margin-left: 10px"</span>
            placeholder<span class="token operator">=</span><span class="token string">"请输入用户名"</span>
 <span class="token operator">/</span><span class="token operator">&gt;</span>
 <span class="token comment">//密码</span>
 <span class="token operator">&lt;</span>el<span class="token operator">-</span>input
            @change<span class="token operator">=</span><span class="token string">"onPasswordChange"</span>
            label<span class="token operator">=</span><span class="token string">"密码"</span>
            v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"password"</span> <span class="token comment">//绑定数据</span>
            type<span class="token operator">=</span><span class="token string">"password"</span>
            style<span class="token operator">=</span><span class="token string">"width: 240px; margin-left: 10px"</span>
            placeholder<span class="token operator">=</span><span class="token string">"请输入密码"</span>
            <span class="token operator">:</span>show<span class="token operator">-</span>password<span class="token operator">=</span><span class="token string">"true"</span>
 <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre>
    <h3>
     <a id="_101">
     </a>
     点击登录和注册按钮时的逻辑处理
    </h3>
    <h4>
     <a id="_102">
     </a>
     登录按钮
    </h4>
    <ul>
     <li>
      首先点击登录按钮后，会拿到此时表单中的账号和密码，然后通过
      <code>
       axios
      </code>
      向后端发送网络请求
      <strong>
       并携带此时的表单数据
      </strong>
     </li>
     <li>
      再通过后端返回的信息来进行后续的处理，后续情况无非是下面两种情况
     </li>
    </ul>
    <ol>
     <li>
      <strong>
       用户不存在
      </strong>
      ：提示用户账号不存在请先前去注册
     </li>
     <li>
      <strong>
       用户存在
      </strong>
      ：
      <ul>
       <li>
        如果密码错误，则提示用户密码输入错误，请重新输入
       </li>
       <li>
        如果密码正确，那么此时后端会返回该用户的
        <code>
         token
        </code>
        信息，前端需要做的就是将后端返回的
        <code>
         token
        </code>
        信息存放到
        <code>
         localstorage
        </code>
        中，这里我采用的是存放到
        <code>
         localstorage
        </code>
        中，当然存放到别的地方也行。
       </li>
      </ul>
     </li>
    </ol>
    <blockquote>
     <p>
      注意：密码正确后端返回的status为0
      <br/>
      用户不存在或者密码错误后端返回的status为1
     </p>
    </blockquote>
    <pre><code class="prism language-js"><span class="token comment">//点击登录按钮的回调函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">onLogin</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
<span class="token comment">//获取此时的表单数据</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">username</span><span class="token operator">:</span>username<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span>password<span class="token punctuation">.</span>value
  <span class="token punctuation">}</span>
<span class="token comment">//携带参数对后端进行网络请求</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">'http://127.0.0.1:8080/api/login'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">username</span><span class="token operator">:</span>username<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      <span class="token literal-property property">password</span><span class="token operator">:</span>password<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//用户不存在||用户存在但密码不正确</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">ElMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">plain</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//用户存在</span>
     <span class="token function">ElMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">message</span><span class="token operator">:</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"success"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">plain</span><span class="token operator">:</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">//拿到token信息</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> my_token <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token
    <span class="token comment">//将token存放到localstorage中</span>
    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">,</span>my_token<span class="token punctuation">)</span>
    <span class="token comment">//跳转路由，跳转到主页面</span>
     router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/home'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_153">
     </a>
     注册按钮
    </h4>
    <ul>
     <li>
      点击注册按钮后，同样向后端发送请求，根据请求进行前端的渲染
     </li>
     <li>
      注册按钮的前端逻辑比起登录按钮更加简单，只有两种情况
     </li>
    </ul>
    <ol>
     <li>
      数据库中该用户已存在：提示用户该用户已经注册过了
     </li>
     <li>
      数据库中没有该用户：提示用户注册成功。
     </li>
    </ol>
    <pre><code class="prism language-js"><span class="token comment">//点击注册按钮的回调函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">onRegister</span> <span class="token operator">=</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//获取此时的账号和密码</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">username</span><span class="token operator">:</span>username<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span>password<span class="token punctuation">.</span>value
  <span class="token punctuation">}</span>
  <span class="token comment">//发起注册请求</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">'http://127.0.0.1:8080/api/register'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">username</span><span class="token operator">:</span>data<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
        <span class="token literal-property property">password</span><span class="token operator">:</span>data<span class="token punctuation">.</span>password
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//console.log(res);</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//该账号已经被注册</span>
    <span class="token function">ElMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">message</span><span class="token operator">:</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"error"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">plain</span><span class="token operator">:</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//账号注册成功</span>
    <span class="token function">ElMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">message</span><span class="token operator">:</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"success"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">plain</span><span class="token operator">:</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="_194">
     </a>
     后端部分
    </h2>
    <ul>
     <li>
      这里我采用的是Node.js中的Express框架来进行Web服务器的搭建
     </li>
    </ul>
    <h3>
     <a id="_197">
     </a>
     连接数据库
    </h3>
    <ul>
     <li>
      使用Node.js中的
      <code>
       mysql
      </code>
      模块进行连接数据库
     </li>
    </ul>
    <pre><code class="prism language-js"><span class="token comment">//导入MySQL</span>
<span class="token keyword">import</span> mysql <span class="token keyword">from</span> <span class="token string">'mysql'</span>
<span class="token comment">//创建数据库连接对象</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">host</span><span class="token operator">:</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span><span class="token string">'root'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span><span class="token string">'*******'</span><span class="token punctuation">,</span> <span class="token comment">//user对应的密码</span>
    <span class="token literal-property property">database</span><span class="token operator">:</span><span class="token string">'*****'</span> <span class="token comment">//数据库名称</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//向外共享数据库连接对象</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> db
</code></pre>
    <h3>
     <a id="Express_213">
     </a>
     Express搭建服务器
    </h3>
    <ul>
     <li>
      在这一部分需要注册路由、配置中间件、测试数据库连接、监听端口
     </li>
     <li>
      需要用到的一些中间件：
      <ol>
       <li>
        CORS中间件：解决跨域资源问题
       </li>
       <li>
        expressJWT中间件：解析token的中间件
       </li>
       <li>
        express.urlencoded中间件：解析表单数据的中间件
       </li>
       <li>
        自定义中间件：验证token有效性的中间件
       </li>
       <li>
        错误中间件：判断登录成功后的请求是否携带token
       </li>
      </ol>
     </li>
    </ul>
    <blockquote>
     <p>
      下面的代码中的资源引入路径是我这个项目中的路径，需要更改
     </p>
    </blockquote>
    <pre><code class="prism language-js"><span class="token keyword">import</span> express <span class="token keyword">from</span> <span class="token string">'express'</span>
<span class="token keyword">import</span> cors <span class="token keyword">from</span> <span class="token string">'cors'</span>
<span class="token keyword">import</span> db <span class="token keyword">from</span> <span class="token string">'../db/index.js'</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router/user.js'</span>
<span class="token keyword">import</span> expressJWT <span class="token keyword">from</span> <span class="token string">'express-jwt'</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//将CORS注册为全局中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//配置解析token的中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">expressJWT</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">secret</span><span class="token operator">:</span><span class="token string">"yaoyao No1"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unless</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">path</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/api\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//配置解析表单数据的中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//导入并注册路由</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span>

<span class="token comment">//验证token的有效性的中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> authHeader <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Authorization'</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> authHeader <span class="token operator">&amp;&amp;</span> authHeader<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'token:'</span> <span class="token operator">+</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//如果token不存在</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">error</span><span class="token operator">:</span><span class="token string">'No Token Provided'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//验证token有效性</span>
    jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>user</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">error</span><span class="token operator">:</span><span class="token string">'Invalid Token'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//将用户信息附加到请求对象</span>
        req<span class="token punctuation">.</span>user <span class="token operator">=</span> user
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//配置错误中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'UnauthorizedError'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token literal-property property">message</span><span class="token operator">:</span><span class="token string">'身份认证失败'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 测试数据库连接</span>
db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'select 1'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//监听</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server running at http://127.0.0.1:8080'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_287">
     </a>
     后端接口
    </h3>
    <ul>
     <li>
      在这一部分写前端需要用到的接口，其中包括用户注册接口、用户登录接口以及获取用户头像的接口（测试携带token的接口）
     </li>
    </ul>
    <h4>
     <a id="_289">
     </a>
     注册接口
    </h4>
    <ul>
     <li>
      注册接口逻辑比较简单，使用
      <code>
       SQL
      </code>
      语句查找数据库并向其中插入数据即可实现。
     </li>
     <li>
      不过将插入数据时，不能将用户密码以明文的方式插入，而应该先对密码进行加密，这样可以提高安全性。这里我是通过
      <code>
       bcrypt
      </code>
      对密码进行
      <code>
       哈希盐加密
      </code>
      ，这样的加密方式有
      <code>
       唯一性
      </code>
      ，即使两个用户的密码完全相同，但是由于盐值不同，所以在数据库中的密码也不相同。
     </li>
    </ul>
    <h4>
     <a id="_292">
     </a>
     登录接口
    </h4>
    <ul>
     <li>
      登录接口则需要使用
      <code>
       bcrypt
      </code>
      中的匹配方法来进行验证用户输入的密码是否为数据库中的密码一致。如果一致，则登录成功，跳转到主页；如果不一致，则给用户轻提示。
     </li>
    </ul>
    <h4>
     <a id="token_295">
     </a>
     测试token接口
    </h4>
    <ul>
     <li>
      点击后可以获取该用户的头像，并将其渲染到主页面中
     </li>
    </ul>
    <pre><code class="prism language-js"><span class="token keyword">import</span> express <span class="token keyword">from</span> <span class="token string">"express"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> db <span class="token keyword">from</span> <span class="token string">"../../db/index.js"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> jwt <span class="token keyword">from</span> <span class="token string">"jsonwebtoken"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> bcrypt <span class="token keyword">from</span> <span class="token string">'bcryptjs'</span>
<span class="token comment">//创建路由对象</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//注册用户</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/api/register"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> body <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
  <span class="token comment">//首先查询数据库中是否存在该用户名</span>
  db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
    <span class="token string">"select * from ev_users where username = ?"</span><span class="token punctuation">,</span>
    body<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//用户存在</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"该账号已经注册过了"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//对用户的密码进行加密</span>
        <span class="token keyword">const</span> hashPassword <span class="token operator">=</span> bcrypt<span class="token punctuation">.</span><span class="token function">hashSync</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span>password<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token comment">// console.log('hashpassword:' + hashPassword);</span>
        
        <span class="token comment">//用户不存在，将其存放到数据库中</span>
        db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
          <span class="token string">"insert into ev_users (username,password) values (?,?)"</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span>body<span class="token punctuation">.</span>username<span class="token punctuation">,</span> hashPassword<span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
              <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// console.log("存储成功" + result);</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"账号注册成功"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//登录接口</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/api/login"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">//拿到了前端表单中的数据</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
  <span class="token comment">//首先进行数据库查询是否有该用户</span>
  db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
    <span class="token string">"select * from ev_users where username = ?"</span><span class="token punctuation">,</span>
    data<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//用户存在</span>
        <span class="token comment">//获取数据库中加密后的密码</span>
        <span class="token keyword">const</span> hash_password <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>password
        <span class="token comment">//验证密码</span>
        <span class="token keyword">const</span> isMatch <span class="token operator">=</span> bcrypt<span class="token punctuation">.</span><span class="token function">compareSync</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>password<span class="token punctuation">,</span>hash_password<span class="token punctuation">)</span>
        <span class="token comment">//进行密码匹配</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isMatch<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">//生成用户token</span>
          <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token operator">...</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">password</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token comment">//密钥</span>
          <span class="token keyword">const</span> secretKey <span class="token operator">=</span> <span class="token string">"yaoyao No1"</span><span class="token punctuation">;</span>
          <span class="token comment">//生成token</span>
          <span class="token keyword">const</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span> secretKey<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">expiresIn</span><span class="token operator">:</span> <span class="token string">"1h"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"登录成功"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">token</span><span class="token operator">:</span><span class="token string">'Bearer '</span> <span class="token operator">+</span> token 
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
          res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"密码错误，请重新输入"</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//用户不存在</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"该账号不存在，请前去注册"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//携带token参数的请求测试</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/my/info'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//查询数据库拿到用户头像</span>
    <span class="token keyword">const</span> userId <span class="token operator">=</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id
    db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'select * from ev_users where id = ?'</span><span class="token punctuation">,</span>userId<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//创建一个新对象，排除特定的键值对</span>
        <span class="token keyword">const</span> newresult <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token operator">...</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
        <span class="token keyword">delete</span> newresult<span class="token punctuation">.</span>password

        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token literal-property property">message</span><span class="token operator">:</span><span class="token string">'用户信息获取成功'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span>newresult
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//将路由对象共享出去</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> router<span class="token punctuation">;</span>
</code></pre>
    <h2>
     <a id="_422">
     </a>
     优化
    </h2>
    <h3>
     <a id="_423">
     </a>
     添加路由守卫
    </h3>
    <ul>
     <li>
      只有携带
      <code>
       token
      </code>
      的用户才可以访问主页，否则如果没有
      <code>
       token
      </code>
      的话，即使输入主页的url也会跳转到登录页面
     </li>
     <li>
      实现原理：使用
      <strong>
       路由前置守卫
      </strong>
      进行判断，如果当前页面中存在
      <code>
       token
      </code>
      ，那么就可以访问主页，否则，就跳转到登录页面。
     </li>
    </ul>
    <pre><code class="prism language-js"><span class="token comment">//设置路由守卫</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span>from<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'前置路由守卫触发'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">await</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//如果token不存在</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token operator">!==</span> <span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      <span class="token comment">//如果目标页面不是登录页</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//如果token存在</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_445">
     </a>
     我遇到的问题
    </h3>
    <ul>
     <li>
      我刚开始在添加路由守卫后，没有进行判断当前跳转的页面是否为
      <code>
       /login
      </code>
      页面，然后就导致了没有
      <code>
       token
      </code>
      ，即使当前已经在登录页面，页面就会一直进行跳转，类似于使用了递归函数但是却没有
      <strong>
       递归出口
      </strong>
      ，就很尴尬，需要避免
     </li>
    </ul>
    <h2>
     <a id="_447">
     </a>
     效果展示
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/3264de89fdb94bb5b5a23c1dc2a8a0dd.gif"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f73616d726f6f6d2f:61727469636c652f64657461696c732f313436323134373736" class_="artid" style="display:none">
 </p>
</div>


