---
layout: post
title: "kafka-zookeeper-集群搭建"
date: 2025-03-07 19:30:23 +0800
description: "配置完成后，每个节点只有broker.id不同，例如k1的配置如下。进入z1、z2、z3节点的zookeeper配置目录，例如。编辑节点/etc/hosts 文件，分发至每个节点。配置java环境（jdk1.8以上）或者手动配置java环境。采用官网下载安装包的方法。"
keywords: "kafka zookeeper 集群搭建"
categories: ['未分类']
tags: ['Kafka']
artid: "145911389"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=145911389
    alt: "kafka-zookeeper-集群搭建"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=145911389
featuredImagePreview: https://bing.ee123.net/img/rand?artid=145911389
cover: https://bing.ee123.net/img/rand?artid=145911389
image: https://bing.ee123.net/img/rand?artid=145911389
img: https://bing.ee123.net/img/rand?artid=145911389
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     kafka zookeeper 集群搭建
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="kafka_zookeeoer__0">
     </a>
     kafka zookeeoer 集群准备
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        节点
       </th>
       <th>
        IP
       </th>
       <th>
        备注
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        z1
       </td>
       <td>
        192.168.101.131
       </td>
       <td>
        zookeeper
       </td>
      </tr>
      <tr>
       <td>
        z2
       </td>
       <td>
        192.168.101.132
       </td>
       <td>
        zookeeper
       </td>
      </tr>
      <tr>
       <td>
        z3
       </td>
       <td>
        192.168.101.133
       </td>
       <td>
        zookeeper
       </td>
      </tr>
      <tr>
       <td>
        k1
       </td>
       <td>
        192.168.101.141
       </td>
       <td>
        kafka
       </td>
      </tr>
      <tr>
       <td>
        k2
       </td>
       <td>
        192.168.101.142
       </td>
       <td>
        kafka
       </td>
      </tr>
      <tr>
       <td>
        k3
       </td>
       <td>
        192.168.101.143
       </td>
       <td>
        kafka
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="_9">
     </a>
     （一）节点配置
    </h3>
    <h4>
     <a id="host_10">
     </a>
     host配置
    </h4>
    <p>
     编辑节点/etc/hosts 文件，分发至每个节点
    </p>
    <pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"192.168.101.131   z1"</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
<span class="token builtin class-name">echo</span> <span class="token string">"192.168.101.132   z2"</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
<span class="token builtin class-name">echo</span> <span class="token string">"192.168.101.133   z3"</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
<span class="token builtin class-name">echo</span> <span class="token string">"192.168.101.141   k1"</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
<span class="token builtin class-name">echo</span> <span class="token string">"192.168.101.142   k2"</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
<span class="token builtin class-name">echo</span> <span class="token string">"192.168.101.143   k3"</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
</code></pre>
    <h3>
     <a id="zookeeper_20">
     </a>
     （二）zookeeper
    </h3>
    <ol>
     <li>
      <p>
       配置java环境（jdk1.8以上）
       <br/>
       <code>
        yum install java
       </code>
       或者手动配置java环境
      </p>
     </li>
     <li>
      <p>
       安装
       <code>
        yum install -y zookeeper
       </code>
      </p>
     </li>
     <li>
      <p>
       修改配置文件
       <br/>
       进入z1、z2、z3节点的zookeeper配置目录，例如
       <code>
        /opt/zookeeper/conf/zoo.cfg
       </code>
       <br/>
       添加配置
      </p>
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token comment"># The number of milliseconds of each tick</span>
<span class="token assign-left variable">tickTime</span><span class="token operator">=</span><span class="token number">2000</span>
<span class="token comment"># The number of ticks that the initial </span>
<span class="token comment"># synchronization phase can take</span>
<span class="token assign-left variable">initLimit</span><span class="token operator">=</span><span class="token number">10</span>
<span class="token comment"># The number of ticks that can pass between </span>
<span class="token comment"># sending a request and getting an acknowledgement</span>
<span class="token assign-left variable">syncLimit</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token comment"># the directory where the snapshot is stored.</span>
<span class="token assign-left variable">dataDir</span><span class="token operator">=</span>/var/lib/zookeeper/data
<span class="token comment"># the port at which the clients will connect</span>
<span class="token assign-left variable">clientPort</span><span class="token operator">=</span><span class="token number">2181</span>

<span class="token assign-left variable">server.1</span><span class="token operator">=</span>z1:2888:3888
<span class="token assign-left variable">server.2</span><span class="token operator">=</span>z2:2888:3888
<span class="token assign-left variable">server.3</span><span class="token operator">=</span>z3:2888:3888
</code></pre>
    <ol start="4">
     <li>
      添加myid
      <br/>
      在上面配置dataDir对应的目录下新建文件myid，在z1节点中写如数字1，z2节点中写入数字2，z3节点中写入数字3
      <br/>
      z1节点
      <code>
       mkdir -p /var/lib/zookeeper/data/ &amp;&amp; echo 1 &gt; /var/lib/zookeeper/data/myid
      </code>
      <br/>
      z2节点
      <code>
       mkdir -p /var/lib/zookeeper/data/ &amp;&amp; echo 2 &gt; /var/lib/zookeeper/data/myid
      </code>
      <br/>
      z3节点
      <code>
       mkdir -p /var/lib/zookeeper/data/ &amp;&amp; echo 3 &gt; /var/lib/zookeeper/data/myid
      </code>
     </li>
     <li>
      启动zookeeper
      <br/>
      z1、z2、z3节点启动zookeeper服务
      <code>
       /opt/zookeeper/bin/zkServer.sh start /opt/zookeeper/conf/zoo.cfg
      </code>
     </li>
     <li>
      查询节点状态
      <code>
       /opt/zookeeper/bin/zkServer.sh status
      </code>
     </li>
    </ol>
    <h3>
     <a id="kafka372_55">
     </a>
     （三）kafka(3.7.2)
    </h3>
    <p>
     采用官网下载安装包的方法
    </p>
    <ol>
     <li>
      下载解压
      <br/>
      <code>
       wget -P /usr/local/ https://mirrors.tuna.tsinghua.edu.cn/apache/kafka/3.7.2/kafka_2.12-3.7.2.tgz
      </code>
      <br/>
      <code>
       tar -zxvf /usr/local/kafka_2.12-3.7.2.tgz -C /usr/local
      </code>
     </li>
     <li>
      配置软连接
      <br/>
      <code>
       ln -s /usr/local/kafka_2.12-3.7.2 /usr/local/kafka
      </code>
     </li>
     <li>
      更改用户权限（根据生产环境配置）
      <br/>
      <code>
       mkdir -p /data/kafka-logs
      </code>
      <br/>
      <code>
       chown 用户:组 -R /data/kafka-logs
      </code>
      <br/>
      <code>
       chown 用户:组 -R /usr/local/kafka_2.12-3.7.2
      </code>
     </li>
     <li>
      配置环境变量（可选，将kafka可执行文件加入PATH）
      <br/>
      <code>
       echo "export KAFKA_HOME=/usr/local/kafka" &gt;&gt; /etc/profile
      </code>
      <br/>
      <code>
       echo "export PATH=\$PATH:\$KAFKA_HOME/bin" &gt;&gt; /etc/profile
      </code>
      <br/>
      <code>
       source /etc/profile
      </code>
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token comment"># /etc/profile</span>
<span class="token punctuation">..</span>.
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KAFKA_HOME</span><span class="token operator">=</span>/usr/local/kafka
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$KAFKA_HOME</span>/bin

</code></pre>
    <ol start="5">
     <li>
      修改kafka配置
      <br/>
      配置server.properties 文件
      <br/>
      编辑config/server.properties 文件，修改broker.id和zookeeper.connect的值
     </li>
    </ol>
    <ul>
     <li>
      <p>
       节点k1
       <br/>
       <code>
        sed -i 's/broker\.id.*/broker.id=1/' /usr/local/kafka/config/server.properties
       </code>
       <br/>
       <code>
        sed -i 's/zookeeper.connect=.*/zookeeper.connect=z1:2181,z2:2181,z3:2181/' /usr/local/kafka/config/server.properties
       </code>
      </p>
     </li>
     <li>
      <p>
       节点k2
       <br/>
       <code>
        sed -i 's/broker\.id.*/broker.id=2/' /usr/local/kafka/config/server.properties
       </code>
       <br/>
       <code>
        sed -i 's/zookeeper.connect=.*/zookeeper.connect=z1:2181,z2:2181,z3:2181/' /usr/local/kafka/config/server.properties
       </code>
      </p>
     </li>
     <li>
      <p>
       节点k3
       <br/>
       <code>
        sed -i 's/broker\.id.*/broker.id=3/' /usr/local/kafka/config/server.properties
       </code>
       <br/>
       <code>
        sed -i 's/zookeeper.connect=.*/zookeeper.connect=z1:2181,z2:2181,z3:2181/' /usr/local/kafka/config/server.properties
       </code>
      </p>
     </li>
    </ul>
    <p>
     配置完成后，每个节点只有broker.id不同，例如k1的配置如下
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">..</span>.
<span class="token assign-left variable">broker.id</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">..</span>.
<span class="token assign-left variable">zookeeper.connect</span><span class="token operator">=</span>z1:2181,z2:2181,z3:2181
<span class="token punctuation">..</span>.
</code></pre>
    <ol start="6">
     <li>
      启动kafka
     </li>
    </ol>
    <ul>
     <li>
      后台启动kafka:
      <code>
       sh /usr/local/kafka/bin/kafka-server-start.sh -daemon /usr/local/kafka/config/server.properties
      </code>
     </li>
    </ul>
    <blockquote>
     <p>
      前台启动（测试用）
      <code>
       sh /usr/local/kafka/bin/kafka-server-start.sh /usr/local/kafka/config/server.properties
      </code>
      <br/>
      停止kafka
      <code>
       sh /usr/local/kafka/bin/kafka-server-stop.sh
      </code>
     </p>
    </blockquote>
    <h3>
     <a id="Topic_111">
     </a>
     （四）Topic
    </h3>
    <p>
     创建topic
     <br/>
     <code>
      kafka-topics.sh --bootstrap-server k1:9092 --create --topic topic-a --partitions 3 --replication-factor 2
     </code>
    </p>
    <p>
     列出topic
     <br/>
     <code>
      kafka-topics.sh --bootstrap-server k1:9092 --list
     </code>
    </p>
    <p>
     描述topic
     <br/>
     <code>
      kafka-topics.sh --bootstrap-server k1:9092 --describe --topic topic-a
     </code>
    </p>
    <pre><code class="prism language-bash">Topic: topic-a  TopicId: OXC_ux10Taq314OyL-dU9Q PartitionCount: <span class="token number">3</span>       ReplicationFactor: <span class="token number">3</span>    Configs: 
        Topic: topic-a  Partition: <span class="token number">0</span>    Leader: <span class="token number">143</span>     Replicas: <span class="token number">143,142</span>,141   Isr: <span class="token number">143,142</span>,141
        Topic: topic-a  Partition: <span class="token number">1</span>    Leader: <span class="token number">142</span>     Replicas: <span class="token number">142,141</span>,143   Isr: <span class="token number">142,141</span>,143
        Topic: topic-a  Partition: <span class="token number">2</span>    Leader: <span class="token number">141</span>     Replicas: <span class="token number">141,143</span>,142   Isr: <span class="token number">141</span>
</code></pre>
    <pre><code>每个分区都有一个Leader，负责处理对该分区的读写请求
每个分区都有三个副本，分布在不同的Broker上
</code></pre>
    <p>
     删除topic
     <br/>
     <code>
      kafka-topics.sh --bootstrap-server k1:9092 --delete --topic topic-a
     </code>
    </p>
    <p>
     修改topic
     <br/>
     <code>
      kafka-topics.sh --bootstrap-server k1:9092 --alter --topic topic-a --partitions 4
     </code>
    </p>
    <h3>
     <a id="_138">
     </a>
     （五）生产消费
    </h3>
    <ul>
     <li>
      生产者命令
      <br/>
      <code>
       kafka-console-producer.sh --bootstrap-server k1:9092 --topic topic-a
      </code>
     </li>
     <li>
      消费者命令 --from-beginning 从头消费数据
      <br/>
      <code>
       kafka-console-consumer.sh --bootstrap-server k1:9092 --topic topic-a --from-beginning
      </code>
     </li>
     <li>
      指定分区，并且消费历史数据
      <br/>
      <code>
       kafka-console-consumer.sh --bootstrap-server k1:9092 --topic topic-a --from-beginning --partition 2
      </code>
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f616c6963696e79612f:61727469636c652f64657461696c732f313435393131333839" class_="artid" style="display:none">
 </p>
</div>


