---
layout: post
title: "压力测试Monkey命令参数和报告分析"
date: 2025-03-13 14:24:59 +0800
description: "Monkey所执行的随机事件流中包含11大事件，分别是触摸（touch）、手势（motion）、缩放（pinchzoom）、轨迹（trackball）、屏幕旋转（rotation）、基本导航（nav）、主要导航（mojornav）、系统按键（syskeys）、Activity启动（appswitch）、键盘翻转（flip）、其他事件（anyevent）"
keywords: "压力测试Monkey命令参数和报告分析！"
categories: ['软件测试', '自动化测试', '测试工程师']
tags: ['自动化测试', '测试工具', '接口测试', '压力测试', '单元测试', 'Selenium', 'Pytest']
artid: "146230043"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146230043
    alt: "压力测试Monkey命令参数和报告分析"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146230043
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146230043
cover: https://bing.ee123.net/img/rand?artid=146230043
image: https://bing.ee123.net/img/rand?artid=146230043
img: https://bing.ee123.net/img/rand?artid=146230043
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     压力测试Monkey命令参数和报告分析！
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     adb的操作命令格式一般为：adb shell monkey +命令参数
    </p>
    <p>
     <strong>
      PART
     </strong>
     <strong>
      0
     </strong>
     <strong>
      1
     </strong>
    </p>
    <p>
     <strong>
      常用参数
     </strong>
    </p>
    <p>
     ⏩
     <strong>
      -p &lt;测试的包名列表&gt;
     </strong>
    </p>
    <p>
     <strong>
      用于约束限制
     </strong>
     ，用此参数指定一个或多个包。指定包之后，Monkey将只允许系统启动指定的APP。如果不指定包，Monkey将允许系统启动设备中的所有APP。
    </p>
    <ul>
     <li>
      <p>
       不指定包：adb shell monkey 50
      </p>
     </li>
     <li>
      <p>
       指定一个包执行50次：adb shell monkey -p 包名 50
      </p>
     </li>
     <li>
      <p>
       指定多个包执行50次：adb shell monkey -p 包名1 -p 包名2 50
      </p>
     </li>
    </ul>
    <p>
     具体有哪些包名，可以通过adb shell，进入data/data/路径下，ls查看。
    </p>
    <p>
    </p>
    <p>
     ⏩
     <strong>
      -v 显示日志详细程度
     </strong>
    </p>
    <p>
     <strong>
      用于指定反馈信息级别
     </strong>
     （信息级别就是日志的详细程度），差异为-v的数量。总共分3个级别，分别对应的参数：
    </p>
    <ul>
     <li>
      <p>
       Level 0 : adb shell monkey -p 包名 -v 100        //默认级别，仅提供启动提示、测试完成和最终结果等少量信息
      </p>
     </li>
     <li>
      <p>
       Level 1 : adb shell monkey -p 包名 -v -v 100        //提供较为详细的日志，包括每个发送到Activity的事件信息
      </p>
     </li>
     <li>
      <p>
       Level 2 : adb shell monkey -p 包名 -v -v -v 100        //最详细的日志，包括了测试中选中/未选中的Activity信息
      </p>
     </li>
    </ul>
    <p>
    </p>
    <p>
     ⏩
     <strong>
      -s 伪随机数生成器的种子值
     </strong>
    </p>
    <p>
     <strong>
      用于指定伪随机数生成器的seed值
     </strong>
     。如果使用相同的种子值重新运行Monkey，它将生成相同的事件序列，[-s 500 (事件序列) 1000（事件数）]
    </p>
    <blockquote>
     <p>
      例如：
     </p>
     <p>
      test1：adb shell monkey -p com.youdao.dict -s 10 -v 100
     </p>
     <p>
      test2：adb shell monkey -p com.youdao.dict -s 10 -v 100
     </p>
    </blockquote>
    <p>
    </p>
    <p>
     ⏩
     <strong>
      --throttle &lt; 毫秒&gt;
     </strong>
    </p>
    <p>
     <strong>
      在事件之间插入固定延迟
     </strong>
     。通过这个选项可以减缓Monkey的执行速度。如果不指定该选项，Monkey将不会被延迟，事件将尽可能快地被完成。
    </p>
    <blockquote>
     <p>
      例如：adb shell monkey -p com.youdao.dict --throttle 200 50        //表示执行50个用户事件数，事件间隔为200毫秒
     </p>
    </blockquote>
    <p>
    </p>
    <p>
     ⏩
     <strong>
      --ignore-crashes 忽略崩溃
     </strong>
    </p>
    <p>
     当应用程序崩溃或发生任何失控异常时，Monkey将停止运行。如果设置此选项，
     <strong>
      即使应用程序崩溃，Monkey将继续向系统发送事件
     </strong>
     ，直到事件计数完成。
    </p>
    <blockquote>
     <p>
      例如：adb shell monkey -p com.youdao.dict --ignore-crashes 100        //测试过程中即使程序崩溃，Monkey依然会继续发送事件，直到事件数目达到100为止
     </p>
    </blockquote>
    <p>
    </p>
    <p>
     ⏩
     <strong>
      --ignore-timeouts 忽略超时
     </strong>
    </p>
    <p>
     当应用程序发生任何超时错误时(如“Application Not Responding”)，Monkey将停止运行。如果设置此选项，
     <strong>
      即使应用程序发生ANR错误，Monkey将继续向系统发送事件
     </strong>
     ，直到计数完成。
    </p>
    <blockquote>
     <p>
      例如：adb shell monkey -p com.youdao.dict --ignore-timeouts 100   //测试过程中即使程序发生ANR错误，Monkey依然会继续发送事件，直到事件数目达到100为止
     </p>
    </blockquote>
    <p>
    </p>
    <p>
     ⏩
     <strong>
      --monitor-native-crashes 监视本地崩溃代码
     </strong>
    </p>
    <p>
     监视并报告Android系统中本地代码的崩溃事件。
    </p>
    <blockquote>
     <p>
      例如：adb shell monkey -p com.youdao.dict --monitor-native-crashes 100  //原理同上
     </p>
    </blockquote>
    <p>
    </p>
    <p>
     ⏩
     <strong>
      --ignore-security-exceptions 忽略安全异常
     </strong>
    </p>
    <p>
     当应用程序发生许可错误时（如证书许可，网络许可等），Monkey将停止运行。如果使用此参数，
     <strong>
      即使应用程序发生许可错误，Monkey依然会发送事件
     </strong>
     ，直到事件计数完成。
    </p>
    <blockquote>
     <p>
      例如：adb shell monkey -p com.youdao.dict --ignore-security-exceptions 100        //原理同上
     </p>
    </blockquote>
    <p>
    </p>
    <p>
     ⏩
     <strong>
      --kill-process-after-error 发生错误停止运行并保持当前状态
     </strong>
    </p>
    <p>
     当应用程序发生错误时，停止其运行。如果指定此参数，当应用程序发生错误时，应用程序停止运行并保持在当前状态（注意：应用程序
     <strong>
      仅是静止在发生错误时的状态
     </strong>
     ，系统并不会结束该应用程序的进程）。
    </p>
    <blockquote>
     <p>
      例如：adb shell monkey -p com.youdao.dict --kill-process-after-error 100        //同上
     </p>
    </blockquote>
    <p>
    </p>
    <p>
     ⏩
     <strong>
      --pct-事件类别+事件类别百分比
     </strong>
    </p>
    <p>
     <strong>
      用于指定每种类别事件的数目百分比
     </strong>
     （在Monkey事件序列中，该类事件数目占总事件数目的百分比）
    </p>
    <p>
     <strong>
      操作事件简介
     </strong>
    </p>
    <p>
     Monkey所执行的随机事件流中包含11大事件，分别是触摸（touch）、手势（motion）、缩放（pinchzoom）、轨迹（trackball）、屏幕旋转（rotation）、基本导航（nav）、主要导航（mojornav）、系统按键（syskeys）、Activity启动（appswitch）、键盘翻转（flip）、其他事件（anyevent）
    </p>
    <p>
     <strong>
      Monkey通过这11大事件来模拟用户的常规操作
     </strong>
     ，对手机App进行稳定性测试。
    </p>
    <blockquote>
     <p>
      --pct-touch  触摸事件
     </p>
     <p>
      --pct-motion  手势事件
     </p>
     <p>
      –pct-pinchzoom  二指缩放事件
     </p>
     <p>
      –pct-trackball  轨迹事件
     </p>
     <p>
      –pct-rotation  屏幕旋转事件
     </p>
     <p>
      –pct-nav  基本导航事件
     </p>
     <p>
      –pct-majornav  主要导航事件
     </p>
     <p>
      –pct-syskeys  系统按键事件
     </p>
     <p>
      –pct-appswitch  启动activity事件
     </p>
     <p>
      –pct-flip  键盘翻转事件
     </p>
     <p>
      –pct-anyevent  其他类型事件
     </p>
    </blockquote>
    <p>
    </p>
    <p>
     <strong>
      PART
     </strong>
     <strong>
      0
     </strong>
     <strong>
      2
     </strong>
    </p>
    <p>
     <strong>
      实例
     </strong>
    </p>
    <p>
     adb shell monkey -p com.android.gallery3d -s 50 --ignore-crashes --ignore-timeouts --monitor-native-crashes --ignore-security-exceptions --kill-process-after-error --throttle 300 -v -v -v 10000 &gt;D:\monkey_log\monkey_log.txt        //将跑完monkey后写入到电脑D盘的指定目录下并生成一个文件
    </p>
    <p>
    </p>
    <p>
     ⏩
     <strong>
      Monkey日志分析
     </strong>
    </p>
    <p>
     正常情况，如果Monkey测试顺利执行完成， 在log的最后，会打印出当前执行事件的次数和所花费的时间； // Monkey finished 代表执行完成\
    </p>
    <p>
     异常情况
    </p>
    <p>
     Monkey 测试出现错误后，一般的分析步骤
    </p>
    <p>
     看Monkey的日志 (注意第一个swith以及异常信息等)
    </p>
    <p>
    </p>
    <p>
     ⏩
     <strong>
      在日志中搜索 “ANR”
     </strong>
    </p>
    <p>
     程序无响应的问题: 在日志中搜索 “ANR”，ANR: Application Not Responding 应用程序无响应。
    </p>
    <p>
    </p>
    <p>
     <strong>
      ANR一般有以下三种类型：
     </strong>
    </p>
    <ul>
     <li>
      <p>
       KeyDispatchTimeout(5 seconds) --主要类型：按键或触摸事件在特定时间内无响应
      </p>
     </li>
     <li>
      <p>
       BroadcastTimeout(10 seconds)：BroadcastReceiver在特定时间内无法处理完成
      </p>
     </li>
     <li>
      <p>
       ServiceTimeout(20 seconds) --小概率类型：Service在特定的时间内无法处理完成
      </p>
     </li>
    </ul>
    <p>
    </p>
    <p>
     此外当ANR问题发生后我们可以使用adb pull命令（此命令无需root权限）从被测设备的/data/anr目录下导出名为traces.txt的对应log文件。例子： adb pull /data/anr/traces*.txt &gt; C:\
    </p>
    <p>
    </p>
    <p>
     ⏩
     <strong>
      崩溃问题搜索 “CRASH”
     </strong>
    </p>
    <p>
    </p>
    <p class="img-center">
     <img alt="图片" height="207" src="https://i-blog.csdnimg.cn/blog_migrate/46d3bc6ba69b4f9fe69f5d6729ec9c8a.png" width="1080"/>
    </p>
    <p>
    </p>
    <p>
     ⏩
     <strong>
      异常问题搜索 “Exception”
     </strong>
    </p>
    <p>
     （如果出现空指针， NullPointerException，需格外重视，肯定有bug）
    </p>
    <p>
    </p>
    <p>
     下面的属于monkey自己的问题。不用管。
    </p>
    <p>
     :Sending Flip keyboardOpen=false
    </p>
    <p>
     Got IOException performing flipjava.io.IOException: write failed: EINVAL (Invalid argument)
    </p>
    <p>
     // Injection Failed
    </p>
    <p>
    </p>
    <p>
     ⏩
     <strong>
      内存泄露问题搜索"GC"
     </strong>
     （需进一步分析）
    </p>
    <p>
     当手机提示Out of Memory（内存不足）时基本确定有内存泄露的问题。
    </p>
    <p>
     当查看logcat时有GC字段，可能有内存泄露问题。与GC相关的字段有如下四个：
    </p>
    <ul>
     <li>
      <p>
       GC_FOR_ALLOC 在分配内存时内存不够引发
      </p>
     </li>
     <li>
      <p>
       GC_EXPLICIT 表明GC被显式请求触发的，如System.gc调用
      </p>
     </li>
     <li>
      <p>
       GC_CONCURRENT, 表明GC在内存使用率达到一定的警戒值时，自动触发
      </p>
     </li>
     <li>
      <p>
       GC_BEFORE_OOM, 表明在虚拟机抛出内存不够异常OOM之前，执行最后一次回收内存垃圾
      </p>
     </li>
    </ul>
    <p>
     当出现内存泄露问题时可以加上--hprof参数再执行一次monkey测试，便可获得对应的profiling报告。
    </p>
    <p>
     adb shell monkey -p 包名 --hprof --throttle 100 --pct-touch 50 --pct-motion 50 -v -v -v 1000 &gt;c:\monkey.txt
    </p>
    <p>
     如果指定了这个选项，monkey会在发送时间的前后生成ａｐｐ内存快照文件，一般会在手机设备的/data/misc目录下生成hprof的文件。（注：/data/misc 需要root权限，可以在手机上安装个RE查看或通过手机助手查看）
    </p>
    <p>
    </p>
    <p>
     <strong>
      最后感谢每一个认真阅读我文章的人，看着粉丝一路的上涨和关注，礼尚往来总是要有的，虽然不是什么很值钱的东西，如果你用得到的话可以直接拿走！
     </strong>
    </p>
    <p class="img-center">
     <img alt="" height="735" src="https://i-blog.csdnimg.cn/direct/a5e4e09138194ce09211cb0659fcbc6e.png" width="752"/>
    </p>
    <h4>
     软件测试面试文档
    </h4>
    <p>
     我们学习必然是为了找到高薪的工作，下面这些面试题是来自阿里、腾讯、字节等一线互联网大厂最新的面试资料，并且有字节大佬给出了权威的解答，刷完这一套面试资料相信大家都能找到满意的工作。
    </p>
    <p class="img-center">
     <img alt="" height="473" src="https://i-blog.csdnimg.cn/direct/7e9960343af44d43b2fe08ab3ee9721d.png" width="814"/>
    </p>
    <p class="img-center">
     <img alt="" height="151" src="https://i-blog.csdnimg.cn/direct/d4630e9ad2c9438d9ab9409e2999530b.png" width="451"/>
    </p>
   </div>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34333337313639352f:61727469636c652f64657461696c732f313436323330303433" class_="artid" style="display:none">
 </p>
</div>


