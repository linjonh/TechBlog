---
layout: post
title: "CD7.C-Dev引用reference-下"
date: 2025-03-08 09:52:21 +0800
description: "承接CD6.【C++ Dev】引用&(reference) 中文章,介绍权限的平移 缩小 扩大的问题以及引用的实质和一道面试题"
keywords: "CD7.【C++ Dev】引用&(reference) 下"
categories: ['Develop', 'C']
tags: ['语法', '引用', '开发语言', '反汇编', 'C']
artid: "145785148"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=145785148
    alt: "CD7.C-Dev引用reference-下"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=145785148
featuredImagePreview: https://bing.ee123.net/img/rand?artid=145785148
cover: https://bing.ee123.net/img/rand?artid=145785148
image: https://bing.ee123.net/img/rand?artid=145785148
img: https://bing.ee123.net/img/rand?artid=145785148
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     CD7.【C++ Dev】引用&amp;(reference) 下
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <hr id="hr-toc" name="tableOfContents"/>
    <p>
     承接
     <a class="link-info" href="https://zhangcoder.blog.csdn.net/article/details/145761662" rel="nofollow" title="CD6.【C++ Dev】引用&amp;(reference) 中">
      CD6.【C++ Dev】引用&amp;(reference) 中
     </a>
     文章
    </p>
    <h2 id="1.%E7%BB%83%E4%B9%A01" name="1.%E7%BB%83%E4%B9%A01">
     1.练习1
    </h2>
    <p>
     下面代码是否有问题?
    </p>
    <pre><code class="language-cpp">int function1()
{
	static int x = 0;
	return x;
}

int main()
{
	int&amp; ret = function1();
	return 0;
}</code></pre>
    <h3 id="%E8%A7%A3" name="%E8%A7%A3">
     解
    </h3>
    <p>
     <span style="color:#fe2c24">
      <span style="background-color:#fef2f0">
       有引用,可能出现权限的问题
      </span>
     </span>
     ,这里权限
     <strong>
      放大
     </strong>
     了
    </p>
    <p>
     return x;由于返回类型为int,而返回值由临时变量接收,临时变量具有常属性(只可读),那么使用int&amp;来接收属于权限的放大
     <span style="color:#fe2c24">
      <span style="background-color:#fef2f0">
       (从只可读放大成可读可写),是不被允许的
      </span>
     </span>
    </p>
    <h4 id="%E6%94%B9%E6%B3%951%3A%E6%9D%83%E9%99%90%E7%9A%84%E5%B9%B3%E7%A7%BB" name="%E6%94%B9%E6%B3%951%3A%E6%9D%83%E9%99%90%E7%9A%84%E5%B9%B3%E7%A7%BB">
     改法1:权限的平移
    </h4>
    <pre><code class="language-cpp">int function1()
{
	static int x = 0;
	return x;
}

int main()
{
	const int&amp; ret = function1();
	return 0;
}</code></pre>
    <p>
     用const修饰,变成具有常属性,
     <span style="color:#fe2c24">
      <span style="background-color:#fef2f0">
       权限可以平移
      </span>
     </span>
    </p>
    <h4 id="%E6%94%B9%E6%B3%952%3A%E7%9B%B4%E6%8E%A5%E5%A4%8D%E5%88%B6%E8%BF%94%E5%9B%9E%E5%80%BC" name="%E6%94%B9%E6%B3%952%3A%E7%9B%B4%E6%8E%A5%E5%A4%8D%E5%88%B6%E8%BF%94%E5%9B%9E%E5%80%BC">
     改法2:直接复制返回值
    </h4>
    <p>
     不使用引用&amp;,直接复制返回值
    </p>
    <pre><code class="language-cpp">int function1()
{
	static int x = 0;
	return x;
}

int main()
{
	int ret = function1();//ret可读可写
	return 0;
}</code></pre>
    <h2 id="2.%E7%BB%83%E4%B9%A02" name="2.%E7%BB%83%E4%B9%A02">
     2.练习2
    </h2>
    <p>
     对于如下函数其接收返回值有几种写法?
    </p>
    <pre><code class="language-cpp">int&amp; function2()
{
	static int x = 0;
	return x;
}</code></pre>
    <h3 id="%E5%86%99%E6%B3%951%3A%E6%9D%83%E9%99%90%E7%9A%84%E5%B9%B3%E7%A7%BB" name="%E5%86%99%E6%B3%951%3A%E6%9D%83%E9%99%90%E7%9A%84%E5%B9%B3%E7%A7%BB">
     写法1:权限的平移
    </h3>
    <pre><code class="language-cpp">int main()
{
	int&amp; ret = function2();
    return 0;
}</code></pre>
    <p>
     function2()返回的是x的别名,因此使用int&amp;同级接收(平移权限)
    </p>
    <p>
     权限不变,即可读可写
    </p>
    <h3 id="%E5%86%99%E6%B3%952%3A%E6%9D%83%E9%99%90%E7%9A%84%E7%BC%A9%E5%B0%8F" name="%E5%86%99%E6%B3%952%3A%E6%9D%83%E9%99%90%E7%9A%84%E7%BC%A9%E5%B0%8F">
     写法2:权限的缩小
    </h3>
    <pre><code class="language-cpp">int main()
{
	const int&amp; ret = function2();
    return 0;
}</code></pre>
    <p>
     权限从可读可写变成只可读(const修饰)
    </p>
    <h2 id="3.%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC(%E4%B8%B4%E6%97%B6%E5%8F%98%E9%87%8F)%E5%88%86%E6%9E%90" name="3.%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC(%E4%B8%B4%E6%97%B6%E5%8F%98%E9%87%8F)%E5%88%86%E6%9E%90">
     3.函数返回值(临时变量)分析
    </h2>
    <h3 id="%E5%AF%B9%E6%AF%94%E7%BB%83%E4%B9%A01%E5%92%8C%E7%BB%83%E4%B9%A02%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC%E7%9A%84%E6%8E%A5%E6%94%B6%E6%96%B9%E5%BC%8F" name="%E5%AF%B9%E6%AF%94%E7%BB%83%E4%B9%A01%E5%92%8C%E7%BB%83%E4%B9%A02%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC%E7%9A%84%E6%8E%A5%E6%94%B6%E6%96%B9%E5%BC%8F">
     对比练习1和练习2函数返回值的接收方式
    </h3>
    <p>
     debug+x64平台下
    </p>
    <p>
     function1:
    </p>
    <p class="img-center">
     <img alt="" height="109" src="https://i-blog.csdnimg.cn/direct/e80e8f7c0ab649439a8d17117ef21cc5.png" width="353"/>
    </p>
    <p>
     直接返回x的值
    </p>
    <p>
     function2:
    </p>
    <p class="img-center">
     <img alt="" height="128" src="https://i-blog.csdnimg.cn/direct/78f3680aab734439bd1dabbc12acce7c.png" width="341"/>
    </p>
    <p>
     返回x的地址(
     <span style="color:#fe2c24">
      <span style="background-color:#fef2f0">
       引用在底层上是指针数学的
      </span>
     </span>
     )
    </p>
    <h3 id="%E4%B8%B4%E6%97%B6%E5%8F%98%E9%87%8F%E7%9A%84%E5%85%B6%E4%BB%96%E5%9C%BA%E6%99%AF" name="%E4%B8%B4%E6%97%B6%E5%8F%98%E9%87%8F%E7%9A%84%E5%85%B6%E4%BB%96%E5%9C%BA%E6%99%AF">
     临时变量的其他场景
    </h3>
    <p>
     例如隐式类型转换:
    </p>
    <pre><code class="language-cpp">int main()
{
	int i = 1;
	double d = 3.14;
	if (i &gt; d)
	{
		return 1;
	}
    return 0;
}</code></pre>
    <p>
     if在比较i和d时候,发现i和d是不同的类型,只有相同类型才能比较大小,因此int类型的i会被提升为double类型,
     <strong>
      <span style="color:#fe2c24">
       提升的结果暂时存储到临时变量(其实是寄存器)中,但i仍然为int类型
      </span>
     </strong>
    </p>
    <p>
     debug+x64反汇编代码分析:
    </p>
    <p class="img-center">
     <img alt="" height="118" src="https://i-blog.csdnimg.cn/direct/e3ae59aa37744ee3996be38db6564aa4.png" width="429"/>
    </p>
    <blockquote>
     <p>
      解析两个指令:
     </p>
     <p>
      1.cvtsi2sd
      <a class="link-info" href="https://www.felixcloutier.com/x86/cvtsi2sd" rel="nofollow" title="https://www.felixcloutier.com/x86/cvtsi2sd">
       https://www.felixcloutier.com/x86/cvtsi2sd
      </a>
      网站的部分描述
     </p>
     <p>
      <img alt="" height="237" src="https://i-blog.csdnimg.cn/direct/b072da0e1c444067b765ee72687acedb.png" width="1878"/>
     </p>
     <p>
      简要作用:将双字整型转换为双精度浮点型
     </p>
     <p>
      则可知
      <span style="color:#1c7892">
       <span style="background-color:#e7fafa">
        cvtsi2sd xmm0,dword ptr [i]
       </span>
      </span>
      作用为:将i的值转换为double类型存储到xmm0寄存器中
     </p>
     <p>
     </p>
     <p>
      2.comisd:下图截取了
      <a class="link-info" href="https://www.felixcloutier.com/x86/comisd" rel="nofollow" title="https://www.felixcloutier.com/x86/comisd">
       https://www.felixcloutier.com/x86/comisd
      </a>
      网站的部分描述
     </p>
     <p>
      <img alt="" height="211" src="https://i-blog.csdnimg.cn/direct/a7ec0dc517eb492d9941363d7edf4f15.png" width="1878"/>
     </p>
     <p>
      简要作用:
      <span style="color:#fe2c24">
       <span style="background-color:#fef2f0">
        比较双精度浮点型值
       </span>
      </span>
      并设置EFLAGS标志寄存器
     </p>
     <p>
      则可知
      <span style="color:#1c7892">
       <span style="background-color:#e7fafa">
        comisd xmm0,dword ptr [d]
       </span>
      </span>
      作用为:比较转换成双精度的i和d的值
     </p>
    </blockquote>
    <h2 id="4.%E5%BC%95%E7%94%A8%E5%AE%9E%E8%B4%A8%E7%9A%84%E4%B8%A4%E4%B8%AA%E8%A7%92%E5%BA%A6%E7%9A%84%E7%90%86%E8%A7%A3" name="4.%E5%BC%95%E7%94%A8%E5%AE%9E%E8%B4%A8%E7%9A%84%E4%B8%A4%E4%B8%AA%E8%A7%92%E5%BA%A6%E7%9A%84%E7%90%86%E8%A7%A3">
     4.引用实质的两个角度的理解
    </h2>
    <p style="text-align:center">
     <u>
      <strong>
       角度1:语法层面未开空间 角度2:底层开了空间
      </strong>
     </u>
    </p>
    <h3 id="%E5%88%86%E6%9E%90%E5%BA%95%E5%B1%82%E5%BC%80%E4%BA%86%E7%A9%BA%E9%97%B4" name="%E5%88%86%E6%9E%90%E5%BA%95%E5%B1%82%E5%BC%80%E4%BA%86%E7%A9%BA%E9%97%B4">
     分析底层开了空间
    </h3>
    <p>
     比较分割线上下两段代码,在底层上是否有区别?
    </p>
    <pre><code class="language-cpp">int main()
{
	int a = 1;
	int&amp; b = a;
	//=============
	int c = 2;
	int* pc = &amp;c;
    return 0;
}</code></pre>
    <p>
     解:观察反汇编指令
    </p>
    <pre><code class="language-cpp">	int a = 1;
 mov         dword ptr [a],1  
	int&amp; b = a;
 lea         rax,[a]  
 mov         qword ptr [b],rax  
	//=============
	int c = 2;
 mov         dword ptr [c],2  
	int* pc = &amp;c;
 lea         rax,[c]  
 mov         qword ptr [pc],rax  </code></pre>
    <p>
     上下两段代码的格式完全一样,引用和一级指针的写法没有区别,底层的引用是存储a的地址到b中
    </p>
    <h2 id="5.%E9%9D%A2%E8%AF%95%E9%A2%98%3A%E5%88%86%E6%9E%90%E5%BC%95%E7%94%A8%E5%92%8C%E6%8C%87%E9%92%88%E7%9A%84%E5%8C%BA%E5%88%AB" name="5.%E9%9D%A2%E8%AF%95%E9%A2%98%3A%E5%88%86%E6%9E%90%E5%BC%95%E7%94%A8%E5%92%8C%E6%8C%87%E9%92%88%E7%9A%84%E5%8C%BA%E5%88%AB">
     5.面试题:分析引用和指针的区别
    </h2>
    <blockquote>
     <p>
      1.
      <strong>
       概念上
      </strong>
      : 引用定义一个变量的别名,指针存储一个变量地址
      <br/>
      2.
      <strong>
       初始化上
      </strong>
      : 引用在定义时必须初始化,指针没有要求
      <br/>
      3.
      <strong>
       引用的特殊性
      </strong>
      : 引用在初始化时引用一个实体后,就不能再引用其他实体,而指针可以在任何时候指向任何一个同类型实体
      <br/>
      4.
      <strong>
       是否可为NULL
      </strong>
      : 没有NULL引用,但有NULL指针
      <br/>
      5.
      <strong>
       sizeof含义
      </strong>
      : 引用结果为引用类型的大小,但指针始终是地址空间所占字节个数(32位平台下占4个字节)
      <br/>
      6.
      <strong>
       运算
      </strong>
      : 例如引用自加即引用的实体增加1,指针自加即指针向后偏移一个类型的大小
      <br/>
      7.
      <strong>
       是否有多级
      </strong>
      : 有多级指针,但是没有多级引用
      <br/>
      8.
      <strong>
       访问实体方式
      </strong>
      : 指针需要显式解引用,引用编译器自己处理
      <br/>
      9.
      <strong>
       安全性
      </strong>
      : 引用比指针使用起来相对更安全
     </p>
    </blockquote>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323430315f38353832383631312f:61727469636c652f64657461696c732f313435373835313438" class_="artid" style="display:none">
 </p>
</div>


