---
layout: post
title: "Android-7-及以上夜神模拟器,Fiddler-抓-https-包"
date: 2025-03-13 15:52:05 +0800
description: "使用 OpenSSL 对 FiddlerRoot.cer 证书进行转换，然后放入手机系统证书目录内(/system/etc/security/cacerts------系统证书具体目录)，并对其附加读写权限，以下为详细步骤。1、 下载抓包工具 Fiddler 或 Fiddler everywhere 版。3.1 连续点击下图所指的版本号五次，即可进入开发者模式。，进入下图页面，按照顺序进行配置环境变量地址即可。5.2 这个文件夹内可以看到有个。4、 AndroidSDK 安装。3、 OpenSSL 安装。"
keywords: "Android 7 及以上夜神模拟器，Fiddler 抓 https 包"
categories: ['软件测试']
tags: ['网络协议', 'Https', 'Fiddler']
artid: "146115078"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146115078
    alt: "Android-7-及以上夜神模拟器,Fiddler-抓-https-包"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146115078
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146115078
cover: https://bing.ee123.net/img/rand?artid=146115078
image: https://bing.ee123.net/img/rand?artid=146115078
img: https://bing.ee123.net/img/rand?artid=146115078
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Android 7 及以上夜神模拟器，Fiddler 抓 https 包
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h4>
     <a id="_1">
     </a>
     问题描述
    </h4>
    <p>
     Android 从 7.0 开始系统不在信任用户 CA 证书(应用 targetSdkVersion &gt;= 24 是生效，若是 targetSdkVersion &lt; 24 即使系统是7.0+ 依然会信任)也就是说即使安装了用户 CA 证书，在 Android 7.0+ 的机器上，targetSdkVersion &gt;=24 的应用 HTTPS 包就抓不到了。
    </p>
    <h4>
     <a id="_3">
     </a>
     解决方案
    </h4>
    <p>
     亲测有效！！！！！！
     <br/>
     使用 OpenSSL 对 FiddlerRoot.cer 证书进行转换，然后放入手机系统证书目录内(/system/etc/security/cacerts------系统证书具体目录)，并对其附加读写权限，以下为详细步骤。
    </p>
    <h4>
     <a id="_6">
     </a>
     环境准备
    </h4>
    <p>
     1、 下载抓包工具 Fiddler 或 Fiddler everywhere 版
    </p>
    <ul>
     <li>
      可直接从
      <a href="https://www.telerik.com/download/fiddler-everywhere" rel="nofollow">
       官网链接
      </a>
      下载
     </li>
     <li>
      Fiddler 免费版不能抓 HTTP/2 的包， Fiddler everywhere 版可以，绿色永久版可查看
      <a href="https://blog.csdn.net/iOS_HC/article/details/146102465?spm=1001.2014.3001.5501">
       fiddler everywhere 绿色永久版
      </a>
     </li>
    </ul>
    <p>
     2、 下载夜神模拟器
    </p>
    <ul>
     <li>
      <a href="https://www.yeshen.com/" rel="nofollow">
       夜神模拟器官网下载链接
      </a>
     </li>
     <li>
      <a href="https://support.yeshen.com/zh-CN/qt" rel="nofollow">
       夜神模拟器帮助手册
      </a>
     </li>
     <li>
      温馨提示:如果你用的是真机那么必须要过root
     </li>
    </ul>
    <p>
     3、 OpenSSL 安装
    </p>
    <ul>
     <li>
      参考文章：
      <a href="https://blog.csdn.net/loveryunz/article/details/136739887">
       保姆级OpenSSL下载及安装教程
      </a>
     </li>
    </ul>
    <p>
     4、 AndroidSDK 安装
    </p>
    <ul>
     <li>
      <a href="https://developer.android.google.cn/tools/releases/platform-tools?hl=zh-cn" rel="nofollow">
       AndroidSDK 官方下载链接
      </a>
     </li>
     <li>
      下载完成后，环境配置和下面
      <code>
       操作步骤
      </code>
      中
      <code>
       5.3 夜神模拟器 cmd 环境配置
      </code>
      一样
     </li>
    </ul>
    <h4>
     <a id="_22">
     </a>
     操作步骤
    </h4>
    <h5>
     <a id="1_Fiddler__pem__0__23">
     </a>
     1、导出 Fiddler 证书并修改成 .pem 和 .0 文件
    </h5>
    <ul>
     <li>
      1.1 按下图步骤导出 Fiddler_Root_Certificate_Authority.crt 证书
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/direct/3d650b2e4ea34b12a01d41301e6ff4f1.png"/>
     </li>
     <li>
      1.2 cmd 命令切换到证书的导出路径（默认导出桌面）
      <br/>
      例如：
      <code>
       cd C:\Users\17710\Desktop
      </code>
      ，每个人桌面路径不一定相同，将证书文件拖拽到 cmd 窗口，即可找到文件夹路径
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/direct/ddb400b71cff4020b30eef75e4fac540.png"/>
     </li>
     <li>
      1.3 使用 OpenSSL 将 FiddlerRoot 证书的 crt 格式转换成 pem 格式
      <br/>
      <code>
       openssl x509 -inform DER -in Fiddler_Root_Certificate_Authority.cer -out cacert.pem
      </code>
     </li>
     <li>
      1.4 计算 pem 证书 hash 值-截取下图中箭头指向的
      <code>
       0725b47c
      </code>
      即可
      <br/>
      <code>
       openssl x509 -inform PEM -subject_hash_old -in cacert.pem
      </code>
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/direct/ecd748b5f1b645ce8ff4ea60b91393d7.png"/>
     </li>
     <li>
      1.5 将桌面上的 cacaert.pem 证书 修改为
      <code>
       0725b47c.0
      </code>
      ，名称为上一步操作的 hash 值，后缀为 0
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/direct/7ca0c5009aa9420e94f8081e9bc9d37f.png"/>
     </li>
    </ul>
    <h5>
     <a id="2_36">
     </a>
     2、修改夜神模拟器配置
    </h5>
    <ul>
     <li>
      2.1 启动一个Android 7 以上的模拟器，按照下图指示
      <ul>
       <li>
        点击右上角设置，开启网络连接和网络桥接模式
       </li>
       <li>
        设置静态 IP，一般只需要修改
        <code>
         IP 地址
        </code>
        和
        <code>
         网关
        </code>
        这两项即可，IP 地址可以自己设置，比如我的电脑 IP 是 192.168.1.3，可修改成下图的 IP
        <br/>
        <img alt="" src="https://i-blog.csdnimg.cn/direct/6732332055b2497b924d51f07700c3dd.png"/>
       </li>
      </ul>
     </li>
     <li>
      2.2 确保模拟器已开启 Root
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/direct/cc84ace58dfa41279c0b3a406eff0489.png"/>
     </li>
     <li>
      2.3 修改完成后重启模拟器，以保证生效
     </li>
     <li>
      2.4 修改模拟器 WiFi 代理为手动，这里和真机的操作一样
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/direct/ff31d1bbdfce4f6c9c580c9449e7f039.png"/>
     </li>
    </ul>
    <h5>
     <a id="3_USB__46">
     </a>
     3、打开夜神模拟器设备的
     <code>
      USB 调试选项
     </code>
    </h5>
    <ul>
     <li>
      <p>
       3.1 连续点击下图所指的版本号五次，即可进入开发者模式
       <br/>
       <img alt="" src="https://i-blog.csdnimg.cn/direct/43a2674e361a44cebaecf431a38a5b84.png"/>
      </p>
     </li>
     <li>
      <p>
       3.2 搜索
       <code>
        USB 调试
       </code>
       并打开
       <br/>
       <img alt="" src="https://i-blog.csdnimg.cn/direct/a6a1dd5aa04e4e66b56c287451e9c2a0.png"/>
      </p>
     </li>
     <li>
      <p>
       3.3 开启
       <code>
        USB 调试选项
       </code>
       <br/>
       <img alt="" src="https://i-blog.csdnimg.cn/direct/d8169b105cb64b759aec04ac42f51807.png"/>
      </p>
     </li>
    </ul>
    <h5>
     <a id="40725b47c0_56">
     </a>
     4、将
     <code>
      0725b47c.0
     </code>
     证书放入夜神模拟器系统证书目录
    </h5>
    <ul>
     <li>
      4.1 直接拖拽
      <code>
       0725b47c.0
      </code>
      文件到
      <code>
       夜神模拟器
      </code>
      ，会自动打开下图的文件夹，并复制成功
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a0729a5d1c544f969751fcf25b3978b1.png"/>
     </li>
     <li>
      4.2 复制上图中的
      <code>
       0725b47c.0
      </code>
      文件，然后打开下图指示的根目录文件夹，点击右上角的
      <code>
       粘贴
      </code>
      按钮，即可将
      <code>
       0725b47c.0
      </code>
      证书放入系统证书目录
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4e7d33e85a6b41f2b3ad0d20da07ecec.png"/>
     </li>
    </ul>
    <h5>
     <a id="5_cmd__61">
     </a>
     5、夜神模拟器 cmd 环境配置
    </h5>
    <ul>
     <li>
      <p>
       5.1 找到
       <code>
        夜神模拟器
       </code>
       快捷方式，右键点击
       <code>
        打开文件所在位置
       </code>
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/dd4091f13a9b469681c306e85b87c32e.png"/>
      </p>
     </li>
     <li>
      <p>
       5.2 这个文件夹内可以看到有个
       <code>
        nox_adb
       </code>
       应用程序
       <br/>
       <img alt="" src="https://i-blog.csdnimg.cn/direct/b655504eb2274189b3e74e6e674c59f4.png"/>
      </p>
     </li>
     <li>
      <p>
       5.3 打开
       <code>
        查看高级系统设置
       </code>
       ，进入下图页面，按照顺序进行配置环境变量地址即可
       <br/>
       <img alt="" src="https://i-blog.csdnimg.cn/direct/1ccfed56df1e434a822bc6419ea241fe.png"/>
      </p>
     </li>
    </ul>
    <h5>
     <a id="6_0725b47c0__72">
     </a>
     6、给 0725b47c.0 证书赋予权限
    </h5>
    <ul>
     <li>
      6.1 使用
      <code>
       nox_adb devices
      </code>
      命令查看设备连接状态
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/direct/605a61f354554a03b58c2d6726112f6c.png"/>
      <br/>
      若出现下面版本号不一致的错误，可参考
      <a href="https://www.cnblogs.com/yoyoketang/p/9024620.html" rel="nofollow">
       adb devices 发现连不上模拟器
      </a>
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/direct/c016ae83943444c89dcef939065c3034.png"/>
     </li>
     <li>
      6.2 使用
      <code>
       nox_adb conncet 127.0.0.1:62025
      </code>
      命令建立
      <code>
       adb
      </code>
      连接
      <br/>
      <code>
       !
      </code>
      注：夜神模拟器的端口是规律的，第一个模拟器端口是62001，第二个模拟器端口是62025，第三个是62025+1，以此类推）
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/direct/8651b4ee35a04ad4a3875330a8b2880e.png"/>
     </li>
     <li>
      6.3 使用
      <code>
       nox_adb -s 127.0.0.1:62025 shell
      </code>
      命令进入模拟器 shell 命令行
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/direct/d74861fae7554980b39dfeb16c5bd496.png"/>
     </li>
     <li>
      6.4 使用
      <code>
       mount -o remount -rw /system
      </code>
      命令给外层根目录中的 system 赋予权限
     </li>
     <li>
      6.5 使用
      <code>
       cd system/etc/security/cacerts
      </code>
      命令到系统证书目录
     </li>
     <li>
      6.6 使用
      <code>
       chmod 644 0725b47c.0
      </code>
      命令给证书赋予权限
     </li>
     <li>
      6.6 修改完成后，使用
      <code>
       ls -l
      </code>
      命令查看权限是否启用，如下图所示：
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/direct/e51fbf5d1461466f8d4a590fc881f631.png"/>
     </li>
     <li>
      6.7 最后需要在把最外层system的权限改回去
      <br/>
      <code>
       cd ../../../..
      </code>
      <br/>
      <code>
       mount -o remount -ro system
      </code>
     </li>
    </ul>
    <h5>
     <a id="7_fiddler_everywhere__91">
     </a>
     7、打开 fiddler everywhere 进行抓包
    </h5>
    <p>
     <strong>
      效果图如下：
     </strong>
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/direct/2e7b717359c6477cb228f0b6ae6fe196.png"/>
    </p>
    <p>
     <strong>
      参考文章：
     </strong>
     <a href="https://blog.csdn.net/weixin_49859373/article/details/124221279?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522d2f05f5353741cdc19b07fde2df7a294%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=d2f05f5353741cdc19b07fde2df7a294&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-124221279-null-null.142%5Ev102%5Epc_search_result_base8&amp;utm_term=Android%207%20%E4%BB%A5%E4%B8%8A%E6%8A%93%E5%8C%85&amp;spm=1018.2226.3001.4187">
      Android7及以上，抓https包-Fiddler篇
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f694f535f48432f:61727469636c652f64657461696c732f313436313135303738" class_="artid" style="display:none">
 </p>
</div>


