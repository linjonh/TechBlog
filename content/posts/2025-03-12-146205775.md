---
layout: post
title: "React-组件测试React-Testing-Library"
date: 2025-03-12 15:09:32 +0800
description: "Testing Library 是一个以用户为中心的前端测试工具集，关注用户行为和交互，而不是组件的内部实现细节。这意味着测试更加关注组件的行为，而不是具体的实现方式基于 DOM Testing Library，为 React、Angular、Vue 等框架提供了特定的封装，如等提供通用的用户事件模拟功能，不依赖于特定框架；为 Jest 测试框架提供自定义断言器。"
keywords: "React 组件测试【React Testing Library】"
categories: ['前端自动化测试']
tags: ['前端框架', '前端', 'React']
artid: "146205775"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146205775
    alt: "React-组件测试React-Testing-Library"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146205775
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146205775
cover: https://bing.ee123.net/img/rand?artid=146205775
image: https://bing.ee123.net/img/rand?artid=146205775
img: https://bing.ee123.net/img/rand?artid=146205775
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     React 组件测试【React Testing Library】
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h3>
     <a id="_2">
     </a>
     前言
    </h3>
    <ul>
     <li>
      Testing Library 是一个
      <code>
       以用户为中心
      </code>
      的
      <strong>
       前端测试
      </strong>
      <code>
       工具集
      </code>
      ，关注用户行为和交互，而不是组件的内部实现细节。这意味着测试更加关注组件的行为，而不是具体的实现方式
     </li>
     <li>
      基于 DOM Testing Library，为 React、Angular、Vue 等框架提供了特定的封装，如
      <code>
       React Testing Library
      </code>
      、
      <code>
       Vue Testing Library
      </code>
      ，
      <code>
       Angular Testing Library
      </code>
      等
     </li>
     <li>
      <code>
       @testing-library/user-event
      </code>
      提供通用的用户事件模拟功能，不依赖于特定框架；
      <code>
       @testing-library/jest-dom
      </code>
      为 Jest 测试框架提供自定义断言器
     </li>
    </ul>
    <blockquote>
     <p>
      React Testing Library 是一个用于测试 React 组件的轻量级库，它提供了一组工具来模拟用户交互、检查组件的状态和属性，并与 Jest 等测试框架配合使用。它的设计理念是尽可能地模拟用户行为，使测试更加贴近真实场景。
     </p>
    </blockquote>
    <h3>
     <a id="_10">
     </a>
     安装和配置
    </h3>
    <p>
     <strong>
      安装
     </strong>
     <br/>
     使用 npm 或 yarn 安装 React Testing Library 和 babel 相关依赖：
    </p>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev jest @babel/core @babel/preset-env @babel/preset-react @babel/preset-typescript babel-jest jest-environment-jsdom @testing-library/dom @testing-library/jest-dom @testing-library/react
<span class="token comment"># 或者</span>
<span class="token function">yarn</span> <span class="token function">add</span> <span class="token parameter variable">--dev</span> jest @babel/core @babel/preset-env @babel/preset-react @babel/preset-typescript babel-jest jest-environment-jsdom @testing-library/dom @testing-library/jest-dom @testing-library/react
</code></pre>
    <p>
     <strong>
      配置 Babel
     </strong>
     <br/>
     在项目根目录下创建
     <code>
      .babelrc
     </code>
     文件
    </p>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span>
    <span class="token string">"@babel/preset-react"</span><span class="token punctuation">,</span>
    <span class="token string">"@babel/preset-typescript"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      配置 Jest
     </strong>
     <br/>
     在项目根目录下修改
     <code>
      package.json
     </code>
     文件中的
     <code>
      scripts
     </code>
     部分：
    </p>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"test"</span><span class="token operator">:</span> <span class="token string">"jest"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     在项目根目录下创建
     <code>
      jest.config.js
     </code>
     文件：
    </p>
    <pre><code class="prism language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">modulePaths</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">moduleNameMapper</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"\\.(css|less)$"</span><span class="token operator">:</span> <span class="token string">"&lt;rootDir&gt;/__mocks__/styleMock.js"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 入口文件</span>
  <span class="token literal-property property">setupFilesAfterEnv</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"&lt;rootDir&gt;/src/setupTests.js"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 使用babel对jsx文件预处理</span>
  <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"^.+\\.[jt]sx?$"</span><span class="token operator">:</span> <span class="token string">"babel-jest"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     在
     <code>
      src
     </code>
     目录下创建
     <code>
      setupTests.js
     </code>
     文件：
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token string">"@testing-library/jest-dom"</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="_68">
     </a>
     基本用法
    </h3>
    <p>
     <strong>
      组件编写
     </strong>
    </p>
    <p>
     在
     <code>
      src
     </code>
     目录下创建
     <code>
      Hello.tsx
     </code>
     文件：
    </p>
    <pre><code class="prism language-tsx">import React, { useState } from "react";

export const Hello = () =&gt; {
  let [count, setCount] = useState(0);
  return (
    &lt;div className="hello"&gt;
      &lt;div id="hello"&gt;{count}&lt;/div&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt; count+1 &lt;/button&gt;
    &lt;/div&gt;
  );
};
</code></pre>
    <p>
     <strong>
      测试用例编写
     </strong>
     <br/>
     在
     <code>
      src
     </code>
     目录下创建
     <code>
      Hello.test.jsx
     </code>
     文件：
    </p>
    <ul>
     <li>
      <strong>
       <code>
        render
       </code>
      </strong>
      ：渲染组件并返回一个包含 DOM 和事件的对象。
     </li>
     <li>
      <strong>
       <code>
        screen.getByText
       </code>
      </strong>
      ：查找包含特定文本的元素。
     </li>
     <li>
      <strong>
       <code>
        screen.getByTestId
       </code>
      </strong>
      ：查找具有特定
      <code>
       data-testid
      </code>
      属性的元素。
     </li>
     <li>
      <strong>
       <code>
        fireEvent.click
       </code>
      </strong>
      ：模拟点击事件。
     </li>
     <li>
      <strong>
       <code>
        fireEvent.change
       </code>
      </strong>
      ：模拟表单元素的值变化。
     </li>
    </ul>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> render<span class="token punctuation">,</span> screen<span class="token punctuation">,</span> fireEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@testing-library/react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Hello <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./Hello"</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"renders learn react link"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> container <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Hello <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// DOM 查找</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveLength</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 获取元素值</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#hello"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 事件触发  状态管理</span>
  <span class="token keyword">await</span> fireEvent<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"count+1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 获取状态变更</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#hello"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="_116">
     </a>
     运行测试代码
    </h3>
    <p>
     打开 cmd，输入命令：
    </p>
    <pre><code class="prism language-bash"><span class="token function">yarn</span> <span class="token builtin class-name">test</span>
</code></pre>
    <h3>
     <a id="_126">
     </a>
     使用自定义钩子
    </h3>
    <p>
     React Testing Library 支持自定义钩子，用来测试自定义钩子，创建
     <code>
      src/useCounter.js
     </code>
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useCounter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">initialCount <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialCount<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevCount</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> prevCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span> count<span class="token punctuation">,</span> increment <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     创建
     <code>
      src/useCounter.test.js
     </code>
    </p>
    <pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> renderHook <span class="token punctuation">,</span>act<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@testing-library/react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> useCounter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./useCounter"</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"useCounter"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 测试初始值</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"测试初始值"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> result <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderHook</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">useCounter</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>current<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 测试 increment 功能</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">" 测试 increment 功能"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> result <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderHook</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">useCounter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">act</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      result<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>current<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre>
    <h3>
     <a id="_167">
     </a>
     测试用例截图
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e23e35ceaa044e4e91905285200fd954.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f63646e735f312f:61727469636c652f64657461696c732f313436323035373735" class_="artid" style="display:none">
 </p>
</div>


