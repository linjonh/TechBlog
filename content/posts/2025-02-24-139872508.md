---
layout: post
title: "分布式系列分布式锁在-Redis-主从部署中的挑战"
date: 2025-02-24 22:28:26 +0800
description: "💝💝💝欢迎来到我的博客，很高兴能够在这里和您见面！希望您在这里可"
keywords: "【分布式系列】分布式锁在 Redis 主从部署中的挑战"
categories: ['分布式', 'S']
tags: ['数据库', '分布式', 'Redis']
artid: "139872508"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=139872508
    alt: "分布式系列分布式锁在-Redis-主从部署中的挑战"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=139872508
featuredImagePreview: https://bing.ee123.net/img/rand?artid=139872508
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【分布式系列】分布式锁在 Redis 主从部署中的挑战
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <blockquote>
     <p>
      💝💝💝欢迎来到我的博客，很高兴能够在这里和您见面！希望您在这里可以感受到一份轻松愉快的氛围，不仅可以获得有趣的内容和知识，也可以畅所欲言、分享您的想法和见解。
      <br/>
      <img alt="img" src="https://i-blog.csdnimg.cn/blog_migrate/5b7d56665d406fee3159289ac61fa974.jpeg#pic_center"/>
     </p>
     <ul>
      <li>
       推荐:
       <a href="https://qinyingjie.blog.csdn.net/?type=blog" rel="nofollow">
        kwan 的首页
       </a>
       ,持续学习,不断总结,共同进步,活到老学到老
      </li>
      <li>
       导航
       <ul>
        <li>
         <a href="https://blog.csdn.net/qyj19920704/category_11763029.html">
          檀越剑指大厂系列
         </a>
         :全面总结 java 核心技术,jvm,并发编程 redis,kafka,Spring,微服务等
        </li>
        <li>
         <a href="https://blog.csdn.net/qyj19920704/category_11474211.html">
          常用开发工具系列
         </a>
         :常用的开发工具,IDEA,Mac,Alfred,Git,typora 等
        </li>
        <li>
         <a href="https://blog.csdn.net/qyj19920704/category_11474265.html">
          数据库系列
         </a>
         :详细总结了常用数据库 mysql 技术点,以及工作中遇到的 mysql 问题等
        </li>
        <li>
         <a href="https://meihua150.cn/" rel="nofollow">
          新空间代码工作室
         </a>
         :提供各种软件服务,承接各种毕业设计,毕业论文等
        </li>
        <li>
         <a href="https://blog.csdn.net/qyj19920704/category_7540627.html">
          懒人运维系列
         </a>
         :总结好用的命令,解放双手不香吗?能用一个命令完成绝不用两个操作
        </li>
        <li>
         <a href="https://blog.csdn.net/qyj19920704/category_11480075.html">
          数据结构与算法系列
         </a>
         :总结数据结构和算法,不同类型针对性训练,提升编程思维,剑指大厂
        </li>
       </ul>
      </li>
     </ul>
     <p>
      非常期待和您一起在这个小小的网络世界里共同探索、学习和成长。💝💝💝 ✨✨ 欢迎订阅本专栏 ✨✨
     </p>
    </blockquote>
    <p>
    </p>
    <div class="toc">
     <h4>
      博客目录
     </h4>
     <ul>
      <li>
       <ul>
        <li>
         <a href="#1_21" rel="nofollow">
          1.主从延时的影响
         </a>
        </li>
        <li>
         <a href="#2_26" rel="nofollow">
          2.解决策略
         </a>
        </li>
        <li>
         <a href="#3_42" rel="nofollow">
          3.实践中的注意事项
         </a>
        </li>
        <li>
         <a href="#4_57" rel="nofollow">
          4.结论
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <p>
     分布式锁是一种在分布式系统中确保多个节点在某一时刻只有一个节点能够执行某个操作的机制。Redis 是实现分布式锁的常用工具，因为它提供了原子操作和快速响应的特性。然而，在 Redis 主从部署的情况下，由于主从复制的延时，使用 Redis 作为分布式锁可能会面临一些挑战。
    </p>
    <p>
     在分布式系统中，为了保证操作的一致性和数据的完整性，分布式锁扮演着至关重要的角色。Redis 作为实现分布式锁的流行选择，提供了 SETNX 命令来实现锁的原子性。然而，在 Redis 的主从部署模式下，主节点（master）负责处理所有的写操作，而从节点（slave）则负责复制主节点的数据。由于网络延迟和复制机制，主从节点之间存在一定的延时，这可能会导致分布式锁的实现出现问题。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2d081960f17c06425e254aded826f7c2.png#pic_center"/>
    </p>
    <h3>
     <a id="1_21">
     </a>
     1.主从延时的影响
    </h3>
    <ol>
     <li>
      <strong>
       锁的安全性问题
      </strong>
      ：如果主节点在设置锁之后，但在从节点复制这个操作之前发生故障，那么从节点可能无法正确地复制锁的状态，导致锁的安全性无法得到保证。
     </li>
     <li>
      <strong>
       锁的可用性问题
      </strong>
      ：在主节点故障时，如果从节点不能及时接管成为新的主节点，那么已经设置的锁可能无法被释放，导致系统长时间处于锁定状态。
     </li>
    </ol>
    <h3>
     <a id="2_26">
     </a>
     2.解决策略
    </h3>
    <p>
     为了解决 Redis 主从部署中的延时问题，我们可以采取以下几种策略：
    </p>
    <ol>
     <li>
      <p>
       <strong>
        使用 Redis 哨兵（Sentinel）
       </strong>
       ：Redis Sentinel 可以监控 Redis 主从节点的状态，并在主节点故障时自动进行故障转移，确保系统的高可用性。
      </p>
     </li>
     <li>
      <p>
       <strong>
        优化复制策略
       </strong>
       ：通过配置 Redis 的复制缓冲区大小和调整复制的超时时间，可以减少主从复制的延时。
      </p>
     </li>
     <li>
      <p>
       <strong>
        使用 Redis 集群
       </strong>
       ：Redis 集群提供了数据分片和自动故障转移的功能，可以在一定程度上减少主从复制延时带来的影响。
      </p>
     </li>
     <li>
      <p>
       <strong>
        锁超时时间设置
       </strong>
       ：合理设置锁的超时时间，确保即使在主从复制延时的情况下，锁也能被及时释放。
      </p>
     </li>
     <li>
      <p>
       <strong>
        锁的重试机制
       </strong>
       ：在分布式锁的实现中，可以加入重试机制，当尝试获取锁失败时，可以等待一段时间后再次尝试。
      </p>
     </li>
     <li>
      <p>
       <strong>
        使用其他分布式锁实现
       </strong>
       ：除了 Redis，还可以考虑使用其他分布式锁实现，如 Zookeeper、Etcd 等，这些工具可能提供了更好的容错机制。
      </p>
     </li>
    </ol>
    <h3>
     <a id="3_42">
     </a>
     3.实践中的注意事项
    </h3>
    <p>
     在实际应用中，使用 Redis 作为分布式锁时，需要注意以下几点：
    </p>
    <ol>
     <li>
      <p>
       <strong>
        锁的粒度
       </strong>
       ：尽量使用细粒度的锁，以减少锁的竞争和冲突。
      </p>
     </li>
     <li>
      <p>
       <strong>
        锁的监控
       </strong>
       ：监控锁的状态和性能，及时发现并解决潜在的问题。
      </p>
     </li>
     <li>
      <p>
       <strong>
        锁的测试
       </strong>
       ：在部署前，对分布式锁进行充分的测试，包括在高并发和网络延迟的情况下的测试。
      </p>
     </li>
     <li>
      <p>
       <strong>
        锁的回滚
       </strong>
       ：在操作失败时，确保能够安全地回滚，释放锁资源。
      </p>
     </li>
     <li>
      <p>
       <strong>
        锁的文档
       </strong>
       ：编写清晰的文档，记录锁的使用方式和注意事项，以便团队成员理解和使用。
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/097843256cac265fcbee4051d224a42d.png#pic_center"/>
      </p>
     </li>
    </ol>
    <h3>
     <a id="4_57">
     </a>
     4.结论
    </h3>
    <p>
     虽然 Redis 主从部署中的延时问题给分布式锁的实现带来了挑战，但通过合理的策略和实践，我们仍然可以有效地使用 Redis 作为分布式锁。关键是要理解延时的影响，选择合适的工具和策略，并在实际应用中进行充分的测试和监控。
    </p>
    <p>
     通过上述策略和注意事项，我们可以在保证系统稳定性和数据一致性的同时，有效地利用 Redis 实现分布式锁，为分布式系统提供强有力的支持。
    </p>
    <blockquote>
     <p>
      觉得有用的话点个赞
      <code>
       👍🏻
      </code>
      呗。
      <br/>
      ❤️❤️❤️本人水平有限，如有纰漏，欢迎各位大佬评论批评指正！😄😄😄
     </p>
     <p>
      💘💘💘如果觉得这篇文对你有帮助的话，也请给个点赞、收藏下吧，非常感谢!👍 👍 👍
     </p>
     <p>
      🔥🔥🔥Stay Hungry Stay Foolish 道阻且长,行则将至,让我们一起加油吧！🌙🌙🌙
     </p>
     <p>
      <img alt="img" src="https://i-blog.csdnimg.cn/blog_migrate/101469850485989da7dda6f53e80e19d.gif#pic_center"/>
     </p>
    </blockquote>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71796a31393932303730342f:61727469636c652f64657461696c732f313339383732353038" class_="artid" style="display:none">
 </p>
</div>


