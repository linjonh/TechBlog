---
layout: post
title: "观察者模式Observer-Pattern"
date: 2025-03-12 11:37:06 +0800
description: "用途：观察者模式用于在对象状态变化时通知多个依赖对象，广泛应用于事件驱动的系统。实现：通过 Subject 管理观察者列表，Observer 定义更新接口，结合动态注册和通知实现松耦合。优势：灵活、可扩展，Subject 和 Observer 可以独立开发。注意：多线程环境下需加锁，内存管理可优化。"
keywords: "观察者模式（Observer Pattern）"
categories: ['C']
tags: ['观察者模式']
artid: "146200783"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146200783
    alt: "观察者模式Observer-Pattern"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146200783
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146200783
cover: https://bing.ee123.net/img/rand?artid=146200783
image: https://bing.ee123.net/img/rand?artid=146200783
img: https://bing.ee123.net/img/rand?artid=146200783
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     观察者模式（Observer Pattern）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在 C++ 中，
     <strong>
      观察者模式（Observer Pattern）
     </strong>
     是一种行为设计模式，用于建立对象之间的一对多依赖关系。当一个对象的状态发生变化时，所有依赖它的对象（观察者）都会自动收到通知并更新自己的状态。这种模式非常适合解耦发布者和订阅者之间的关系，常用于事件处理、UI 更新、日志系统等场景。
    </p>
    <hr/>
    <h4>
     <a id="_4">
     </a>
     观察者模式用于什么？
    </h4>
    <ol>
     <li>
      <strong>
       事件通知
      </strong>
      ：
      <ul>
       <li>
        当某个事件发生时（例如用户点击按钮），需要通知多个对象执行相应操作。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       状态同步
      </strong>
      ：
      <ul>
       <li>
        一个对象的状态改变时，多个依赖对象需要同步更新（例如数据模型变化时更新视图）。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       解耦系统
      </strong>
      ：
      <ul>
       <li>
        让发布者（Subject）和订阅者（Observer）独立运行，降低耦合度，方便扩展。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       典型场景
      </strong>
      ：
      <ul>
       <li>
        GUI 框架（如 Qt 的信号与槽机制）。
       </li>
       <li>
        游戏中角色状态变化通知 UI。
       </li>
       <li>
        分布式系统中的消息订阅。
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_18">
     </a>
     观察者模式的组成
    </h4>
    <ol>
     <li>
      <strong>
       Subject（主题/被观察者）
      </strong>
      ：
      <ul>
       <li>
        维护一个观察者列表，提供添加、删除观察者的方法，并在状态变化时通知所有观察者。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       Observer（观察者）
      </strong>
      ：
      <ul>
       <li>
        定义一个更新接口，Subject 状态变化时会调用该接口。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       ConcreteSubject
      </strong>
      ：
      <ul>
       <li>
        Subject 的具体实现，存储状态并在变化时触发通知。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       ConcreteObserver
      </strong>
      ：
      <ul>
       <li>
        Observer 的具体实现，定义收到通知后的具体行为。
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="C__30">
     </a>
     C++ 中的实现
    </h4>
    <p>
     下面是一个简单的 C++ 观察者模式实现，包含基本的添加、移除和通知功能。
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>

<span class="token comment">// 前向声明</span>
<span class="token keyword">class</span> <span class="token class-name">Subject</span><span class="token punctuation">;</span>

<span class="token comment">// 观察者基类（抽象接口）</span>
<span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Observer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> message<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 纯虚函数，接收通知</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 主题类（被观察者）</span>
<span class="token keyword">class</span> <span class="token class-name">Subject</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Observer<span class="token operator">*</span><span class="token operator">&gt;</span> observers<span class="token punctuation">;</span>  <span class="token comment">// 观察者列表</span>
    std<span class="token double-colon punctuation">::</span>string state<span class="token punctuation">;</span>                 <span class="token comment">// 主题的状态</span>

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">attach</span><span class="token punctuation">(</span>Observer<span class="token operator">*</span> observer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 添加观察者</span>
        observers<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">detach</span><span class="token punctuation">(</span>Observer<span class="token operator">*</span> observer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 移除观察者</span>
        observers<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">remove</span><span class="token punctuation">(</span>observers<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> observers<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> observer<span class="token punctuation">)</span><span class="token punctuation">,</span> observers<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 通知所有观察者</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Observer<span class="token operator">*</span> observer <span class="token operator">:</span> observers<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            observer<span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> newState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 修改状态并通知</span>
        state <span class="token operator">=</span> newState<span class="token punctuation">;</span>
        <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    std<span class="token double-colon punctuation">::</span>string <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 具体观察者 A</span>
<span class="token keyword">class</span> <span class="token class-name">ConcreteObserverA</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Observer</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>string name<span class="token punctuation">;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">ConcreteObserverA</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">name</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> message<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">" received update: "</span> <span class="token operator">&lt;&lt;</span> message <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 具体观察者 B</span>
<span class="token keyword">class</span> <span class="token class-name">ConcreteObserverB</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Observer</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>string name<span class="token punctuation">;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">ConcreteObserverB</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">name</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> message<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">" processed message: "</span> <span class="token operator">&lt;&lt;</span> message <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 测试代码</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Subject subject<span class="token punctuation">;</span>

    ConcreteObserverA <span class="token function">observerA</span><span class="token punctuation">(</span><span class="token string">"Observer A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ConcreteObserverB <span class="token function">observerB</span><span class="token punctuation">(</span><span class="token string">"Observer B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 注册观察者</span>
    subject<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>observerA<span class="token punctuation">)</span><span class="token punctuation">;</span>
    subject<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>observerB<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 修改状态，触发通知</span>
    subject<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"State changed to 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"----\n"</span><span class="token punctuation">;</span>

    <span class="token comment">// 移除一个观察者</span>
    subject<span class="token punctuation">.</span><span class="token function">detach</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>observerA<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 再次修改状态</span>
    subject<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"State changed to 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      输出
     </strong>
     ：
    </p>
    <pre><code>Observer A received update: State changed to 1
Observer B processed message: State changed to 1
----
Observer B processed message: State changed to 2
</code></pre>
    <hr/>
    <h4>
     <a id="_138">
     </a>
     实现要点解析
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        观察者接口（Observer）
       </strong>
       ：
      </p>
      <ul>
       <li>
        定义纯虚函数
        <code>
         update()
        </code>
        ，具体观察者需要实现它。
       </li>
       <li>
        使用虚析构函数确保派生类对象正确销毁。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        主题（Subject）
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用
        <code>
         std::vector&lt;Observer*&gt;
        </code>
        存储观察者指针，动态管理订阅关系。
       </li>
       <li>
        <code>
         attach()
        </code>
        和
        <code>
         detach()
        </code>
        分别添加和移除观察者。
       </li>
       <li>
        <code>
         notify()
        </code>
        遍历列表，调用每个观察者的
        <code>
         update()
        </code>
        。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        状态管理
       </strong>
       ：
      </p>
      <ul>
       <li>
        <code>
         setState()
        </code>
        修改主题状态并触发
        <code>
         notify()
        </code>
        ，实现“状态变化 -&gt; 通知”的逻辑。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        具体观察者
       </strong>
       ：
      </p>
      <ul>
       <li>
        <code>
         ConcreteObserverA
        </code>
        和
        <code>
         ConcreteObserverB
        </code>
        是不同类型的观察者，展示了如何自定义响应行为。
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_156">
     </a>
     改进建议
    </h4>
    <p>
     上述实现是一个基础版本，实际应用中可以根据需求优化：
    </p>
    <ol>
     <li>
      <p>
       <strong>
        线程安全
       </strong>
       ：
      </p>
      <ul>
       <li>
        如果在多线程环境下使用，需要在
        <code>
         attach()
        </code>
        、
        <code>
         detach()
        </code>
        和
        <code>
         notify()
        </code>
        中加锁（例如使用
        <code>
         std::mutex
        </code>
        ）。
       </li>
      </ul>
      <pre><code class="prism language-cpp">std<span class="token double-colon punctuation">::</span>mutex mtx<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">attach</span><span class="token punctuation">(</span>Observer<span class="token operator">*</span> observer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> <span class="token function">lock</span><span class="token punctuation">(</span>mtx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    observers<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        智能指针
       </strong>
       ：
      </p>
      <ul>
       <li>
        用
        <code>
         std::shared_ptr&lt;Observer&gt;
        </code>
        替代裸指针，避免手动管理内存。
       </li>
      </ul>
      <pre><code class="prism language-cpp">std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>Observer<span class="token operator">&gt;&gt;</span> observers<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">attach</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>Observer<span class="token operator">&gt;</span> observer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    observers<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        传递更多信息
       </strong>
       ：
      </p>
      <ul>
       <li>
        <code>
         update()
        </code>
        可以携带更多参数（如事件类型、数据指针），而不是简单的一个字符串。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        弱引用
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用
        <code>
         std::weak_ptr
        </code>
        避免观察者被意外销毁后仍留在列表中的问题。
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_186">
     </a>
     实际应用示例
    </h4>
    <p>
     假设你实现一个温度传感器系统：
    </p>
    <ul>
     <li>
      <strong>
       Subject
      </strong>
      ：温度传感器，记录温度变化。
     </li>
     <li>
      <strong>
       Observers
      </strong>
      ：显示屏（显示温度）、警报器（温度过高时报警）。
     </li>
    </ul>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">TemperatureSensor</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Observer<span class="token operator">*</span><span class="token operator">&gt;</span> observers<span class="token punctuation">;</span>
    <span class="token keyword">double</span> temperature<span class="token punctuation">;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">attach</span><span class="token punctuation">(</span>Observer<span class="token operator">*</span> o<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> observers<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">*</span> o <span class="token operator">:</span> observers<span class="token punctuation">)</span> o<span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">setTemperature</span><span class="token punctuation">(</span><span class="token keyword">double</span> temp<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        temperature <span class="token operator">=</span> temp<span class="token punctuation">;</span>
        <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Display</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Observer</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> message<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Display: Temperature is "</span> <span class="token operator">&lt;&lt;</span> message <span class="token operator">&lt;&lt;</span> <span class="token string">"°C\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Alarm</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Observer</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> message<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">double</span> temp <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">stod</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>temp <span class="token operator">&gt;</span> <span class="token number">30.0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Alarm: Temperature too high! "</span> <span class="token operator">&lt;&lt;</span> temp <span class="token operator">&lt;&lt;</span> <span class="token string">"°C\n"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    TemperatureSensor sensor<span class="token punctuation">;</span>
    Display display<span class="token punctuation">;</span>
    Alarm alarm<span class="token punctuation">;</span>

    sensor<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>display<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sensor<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>alarm<span class="token punctuation">)</span><span class="token punctuation">;</span>

    sensor<span class="token punctuation">.</span><span class="token function">setTemperature</span><span class="token punctuation">(</span><span class="token number">25.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sensor<span class="token punctuation">.</span><span class="token function">setTemperature</span><span class="token punctuation">(</span><span class="token number">35.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      输出
     </strong>
     ：
    </p>
    <pre><code>Display: Temperature is 25°C
Display: Temperature is 35°C
Alarm: Temperature too high! 35°C
</code></pre>
    <hr/>
    <h4>
     <a id="_249">
     </a>
     总结
    </h4>
    <ul>
     <li>
      <strong>
       用途
      </strong>
      ：观察者模式用于在对象状态变化时通知多个依赖对象，广泛应用于事件驱动的系统。
     </li>
     <li>
      <strong>
       实现
      </strong>
      ：通过 Subject 管理观察者列表，Observer 定义更新接口，结合动态注册和通知实现松耦合。
     </li>
     <li>
      <strong>
       优势
      </strong>
      ：灵活、可扩展，Subject 和 Observer 可以独立开发。
     </li>
     <li>
      <strong>
       注意
      </strong>
      ：多线程环境下需加锁，内存管理可优化。
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f35333833323035382f:61727469636c652f64657461696c732f313436323030373833" class_="artid" style="display:none">
 </p>
</div>


