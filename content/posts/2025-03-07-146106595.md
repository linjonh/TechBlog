---
layout: post
title: "Windows中在VSCodeCursor上通过CMake或launch文件配置CUDA编程环境"
date: 2025-03-07 23:36:01 +0800
description: "Windows 端笔者暂时没找到直接在VSCode中直接调试的方法，不过在Visual Studio中可以。"
keywords: "Windows中在VSCode/Cursor上通过CMake或launch文件配置CUDA编程环境"
categories: ['未分类']
tags: ['Windows', 'Vscode', 'Cuda', 'Cmake']
artid: "146106595"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146106595
    alt: "Windows中在VSCodeCursor上通过CMake或launch文件配置CUDA编程环境"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146106595
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146106595
cover: https://bing.ee123.net/img/rand?artid=146106595
image: https://bing.ee123.net/img/rand?artid=146106595
img: https://bing.ee123.net/img/rand?artid=146106595
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Windows中在VSCode/Cursor上通过CMake或launch文件配置CUDA编程环境
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     前置步骤
    </h2>
    <ul>
     <li>
      安装符合GPU型号的CUDA Toolkit
      <ul>
       <li>
        配置好 nvcc 环境变量
       </li>
      </ul>
     </li>
     <li>
      安装 Visual Studio
      <ul>
       <li>
        参考
        <code>
         https://blog.csdn.net/Cony_14/article/details/137510909
        </code>
       </li>
      </ul>
     </li>
     <li>
      VSCode 安装插件
      <ul>
       <li>
        <code>
         Nsight Visual Studio Code Edition
        </code>
        <ul>
         <li>
          注意：
          <strong>
           不是
          </strong>
          <code>
           vscode-cudacpp
          </code>
          。若两个插件同时安装，会导致语法功能异常。
         </li>
        </ul>
       </li>
      </ul>
     </li>
     <li>
      安装 cmake 并配置好环境变量
     </li>
    </ul>
    <p>
     <strong>
      注
     </strong>
     ：Windows 端笔者暂时没找到直接在VSCode中直接调试的方法，不过在Visual Studio中可以。
    </p>
    <h3>
     <a id="taskslaunch_12">
     </a>
     方法一：配置tasks和launch文件
    </h3>
    <ul>
     <li>
      文件-打开文件夹-选择
      <code>
       .cu
      </code>
      文件所在目录
     </li>
     <li>
      点开侧边栏
      <strong>
       运行与调试
      </strong>
      按钮，点击创建launch.json文件，选择环境为CUDA C++(CUDA-GDB)
     </li>
     <li>
      文件夹根目录下生成了一个
      <code>
       .vscode
      </code>
      目录，里面生成了一个
      <code>
       launch.json
      </code>
      文件
     </li>
     <li>
      手动在
      <code>
       .vscode
      </code>
      目录下创建
      <code>
       tasks.json文件
      </code>
     </li>
    </ul>
    <h4>
     <a id="tasksjson_18">
     </a>
     <code>
      tasks.json
     </code>
     文件内容如下：
    </h4>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"2.0.0"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"tasks"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"label"</span><span class="token operator">:</span> <span class="token string">"mynvcc"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"shell"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"command"</span><span class="token operator">:</span> <span class="token string">"nvcc"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">"-o"</span><span class="token punctuation">,</span>
                <span class="token string">"${fileDirname}\\${fileBasenameNoExtension}"</span><span class="token punctuation">,</span><span class="token comment">//VSCode里的宏，如果不了解可用直接copy，以工作区为默认路径</span>
                <span class="token string">"${file}"</span><span class="token comment">//源文件</span>
            <span class="token punctuation">]</span><span class="token comment">//等同于nvcc -o /CodeDir/test test.cu</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="launchjson_37">
     </a>
     <code>
      launch.json
     </code>
     文件内容如下：
    </h4>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"CUDA C++: Launch"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"cppvsdbg"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"program"</span><span class="token operator">:</span> <span class="token string">"${fileDirname}\\${fileBasenameNoExtension}.exe"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"console"</span><span class="token operator">:</span> <span class="token string">"externalTerminal"</span><span class="token punctuation">,</span> <span class="token comment">//使用外部终端，如果是vscode的终端会似乎会根据type设置的调用调试导致闪退</span>
            <span class="token string-property property">"preLaunchTask"</span><span class="token operator">:</span> <span class="token string">"mynvcc"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"CUDA C++: Attach"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"cuda-gdb"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"request"</span><span class="token operator">:</span> <span class="token string">"attach"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      我们只需要第一个
      <code>
       CUDA C++: Launch
      </code>
     </li>
     <li>
      type
      <ul>
       <li>
        需要选择
        <code>
         cppvsdbg
        </code>
        。默认是
        <code>
         cuda-gdb
        </code>
        在Windows上貌似不适配。
       </li>
      </ul>
     </li>
     <li>
      program
      <ul>
       <li>
        注意：需要
        <code>
         .exe
        </code>
        后缀
       </li>
      </ul>
     </li>
     <li>
      preLaunchTask
      <ul>
       <li>
        在执行前先编译
       </li>
       <li>
        填写
        <code>
         tasks.json
        </code>
        中label的名称
       </li>
      </ul>
     </li>
    </ul>
    <p>
     配置好后，即可直接在VSCode中运行CUDA代码。
    </p>
    <h3>
     <a id="CMake_70">
     </a>
     方法二、配置CMake文件
    </h3>
    <ul>
     <li>
      文件-打开文件夹-选择
      <code>
       .cu
      </code>
      文件所在目录
     </li>
     <li>
      根目录新建
      <code>
       CMakeLists.txt
      </code>
      文件
     </li>
    </ul>
    <h4>
     <a id="CMakeListstxt_74">
     </a>
     <code>
      CMakeLists.txt
     </code>
     文件内容如下：
    </h4>
    <pre><code class="prism language-shell">cmake_minimum_required<span class="token punctuation">(</span>VERSION <span class="token number">3.20</span><span class="token punctuation">)</span>
project<span class="token punctuation">(</span>cuda_test CUDA<span class="token punctuation">)</span>
set<span class="token punctuation">(</span>CMAKE_CUDA_STANDARD <span class="token number">17</span><span class="token punctuation">)</span>
link_directories<span class="token punctuation">(</span><span class="token variable">${LIB_DIR}</span><span class="token punctuation">)</span>
add_executable<span class="token punctuation">(</span>cuda_test test.cu<span class="token punctuation">)</span>
set_target_properties<span class="token punctuation">(</span>cuda_test PROPERTIES
        CUDA_SEPARABLE_COMPILATION ON<span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <code>
       project
      </code>
      和
      <code>
       add_executable
      </code>
      中的
      <code>
       cuda_test
      </code>
      <ul>
       <li>
        自定义的项目名称
       </li>
      </ul>
     </li>
     <li>
      <code>
       add_executable
      </code>
      中的
      <code>
       test.cu
      </code>
      <ul>
       <li>
        即：需要编译的CUDA代码（
        <strong>
         需修改
        </strong>
        成自己的）
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="_90">
     </a>
     查询编译器
    </h4>
    <ul>
     <li>
      在
      <code>
       terminal
      </code>
      中运行
      <code>
       cmake -B build -G
      </code>
      <ul>
       <li>
        会列出一系列生成器，复制自己安装的版本，如
        <code>
         "Visual Studio 16 2019"
        </code>
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="_94">
     </a>
     编译运行
    </h4>
    <ul>
     <li>
      依次运行
      <ul>
       <li>
        <code>
         cmake -B build -G "Visual Studio 16 2019"
        </code>
       </li>
       <li>
        <code>
         cmake --build build
        </code>
       </li>
       <li>
        <code>
         cd build\Debug
        </code>
       </li>
       <li>
        <code>
         .\cuda_test.exe
        </code>
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="_101">
     </a>
     步骤自动化
    </h4>
    <ul>
     <li>
      在项目根目录下创建文件
      <code>
       build_and_run.bat
      </code>
     </li>
    </ul>
    <pre><code class="prism language-shell">setlocal  

REM 清理 build 目录  
<span class="token keyword">if</span> exist build <span class="token punctuation">(</span>  
    <span class="token function">rmdir</span> /s /q build  
    <span class="token builtin class-name">echo</span> Cleaned up build directory.  
<span class="token punctuation">)</span>  

REM 创建 build 目录  
<span class="token function">mkdir</span> build  
<span class="token builtin class-name">echo</span> Created build directory.  

REM 使用 CMake 进行配置  
cmake <span class="token parameter variable">-B</span> build <span class="token parameter variable">-G</span> <span class="token string">"Visual Studio 16 2019"</span>   
<span class="token keyword">if</span> ERRORLEVEL <span class="token number">1</span> <span class="token punctuation">(</span>  
    <span class="token builtin class-name">echo</span> CMake configuration failed.  
    <span class="token builtin class-name">exit</span> /b %ERRORLEVEL%  
<span class="token punctuation">)</span>  

REM 构建项目  
cmake <span class="token parameter variable">--build</span> build  
<span class="token keyword">if</span> ERRORLEVEL <span class="token number">1</span> <span class="token punctuation">(</span>  
    <span class="token builtin class-name">echo</span> Build failed.  
    <span class="token builtin class-name">exit</span> /b %ERRORLEVEL%  
<span class="token punctuation">)</span>  

REM 进入 Debug 目录并运行测试  
<span class="token builtin class-name">cd</span> build<span class="token punctuation">\</span>Debug  
<span class="token keyword">if</span> ERRORLEVEL <span class="token number">1</span> <span class="token punctuation">(</span>  
    <span class="token builtin class-name">echo</span> Failed to enter Debug directory.  
    <span class="token builtin class-name">exit</span> /b %ERRORLEVEL%  
<span class="token punctuation">)</span>  

REM 运行  
.<span class="token punctuation">\</span>cuda_test.exe  

endlocal  
</code></pre>
    <ul>
     <li>
      终端-运行任务-CMake生成
      <ul>
       <li>
        自动在根目录创建
        <code>
         .vscode
        </code>
        目录及
        <code>
         tasks.json
        </code>
        文件
       </li>
      </ul>
     </li>
    </ul>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>  
    <span class="token comment">// See https://go.microsoft.com/fwlink/?LinkId=733558  </span>
    <span class="token comment">// for the documentation about the tasks.json format  </span>
    <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"2.0.0"</span><span class="token punctuation">,</span>  
    <span class="token string-property property">"tasks"</span><span class="token operator">:</span> <span class="token punctuation">[</span>  
        <span class="token punctuation">{<!-- --></span>  
            <span class="token string-property property">"label"</span><span class="token operator">:</span> <span class="token string">"Build, Run and Clean CUDA Test"</span><span class="token punctuation">,</span>  
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"shell"</span><span class="token punctuation">,</span>  
            <span class="token string-property property">"options"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>  
                <span class="token string-property property">"cwd"</span><span class="token operator">:</span> <span class="token string">"${workspaceFolder}"</span>  <span class="token comment">// 确保命令在当前工作目录中执行  </span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>  
            <span class="token string-property property">"command"</span><span class="token operator">:</span> <span class="token string">"cmd"</span><span class="token punctuation">,</span>  
            <span class="token string-property property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span>  
                <span class="token string">"/c"</span><span class="token punctuation">,</span>  
                <span class="token string">"build_and_run.bat"</span>  <span class="token comment">// 调用合并的批处理脚本  </span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>  
            <span class="token string-property property">"problemMatcher"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  
            <span class="token string-property property">"group"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>  
                <span class="token string-property property">"kind"</span><span class="token operator">:</span> <span class="token string">"build"</span><span class="token punctuation">,</span>  
                <span class="token string-property property">"isDefault"</span><span class="token operator">:</span> <span class="token boolean">true</span>  
            <span class="token punctuation">}</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">]</span>  
<span class="token punctuation">}</span>  
</code></pre>
    <ul>
     <li>
      编译并运行
      <ul>
       <li>
        终端-运行任务-
        <code>
         Build, Run and Clean CUDA Test
        </code>
        <ul>
         <li>
          <code>
           Build, Run and Clean CUDA Test
          </code>
          是
          <code>
           tasks.json
          </code>
          文件中的
          <code>
           lable
          </code>
         </li>
        </ul>
       </li>
       <li>
       </li>
      </ul>
     </li>
    </ul>
    <h2>
     <a id="Cursor_176">
     </a>
     Cursor
    </h2>
    <ul>
     <li>
      配置方法与VSCode一致。
     </li>
     <li>
      在VSCode中已经配置好的项目，在Cursor中直接打开，可以用一样的方法在"Terminal - Run Task" 中运行。
     </li>
    </ul>
    <h2>
     <a id="warning_180">
     </a>
     编译过程中warning信息处理
    </h2>
    <ul>
     <li>
      警告1：
      <code>
       LINK : warning LNK4098: 默认库"LIBCMT"与其他库的使用冲突；请使用 /NODEFAULTLIB:library
      </code>
      <ul>
       <li>
        原因：
       </li>
       <li>
        CUDA代码可能使用了静态多线程运行库(LIBCMT)，而项目其他部分使用了动态调试多线程运行库(MDd)
       </li>
       <li>
        解决方案：
        <ol>
         <li>
          <p>
           CMakeLists.txt最后加上如下内容：
           <br/>
           <code>
            if(MSVC) set_target_properties(cuda_test PROPERTIES LINK_FLAGS "/NODEFAULTLIB:LIBCMT /NODEFAULTLIB:MSVCRT") endif()
           </code>
          </p>
         </li>
         <li>
          <p>
           或CMakeLists.txt修改成如下内容：
          </p>
         </li>
        </ol>
       </li>
      </ul>
     </li>
    </ul>
    <pre><code class="prism language-shell">cmake_minimum_required<span class="token punctuation">(</span>VERSION <span class="token number">3.20</span><span class="token punctuation">)</span>
project<span class="token punctuation">(</span>cuda_test CUDA<span class="token punctuation">)</span>

set<span class="token punctuation">(</span>CMAKE_CUDA_STANDARD <span class="token number">17</span><span class="token punctuation">)</span>

<span class="token comment"># 确保CUDA编译器使用正确的运行时设置</span>
string<span class="token punctuation">(</span>APPEND CMAKE_CUDA_FLAGS <span class="token string">" --use-local-env"</span><span class="token punctuation">)</span>
string<span class="token punctuation">(</span>APPEND CMAKE_CUDA_FLAGS <span class="token string">" -Xcompiler=<span class="token entity" title='\"'>\"</span>/MDd<span class="token entity" title='\"'>\"</span>"</span><span class="token punctuation">)</span>

<span class="token comment"># 如果是Release模式则使用MD</span>
if<span class="token punctuation">(</span>CMAKE_BUILD_TYPE STREQUAL <span class="token string">"Release"</span><span class="token punctuation">)</span>
  string<span class="token punctuation">(</span>REPLACE <span class="token string">"/MDd"</span> <span class="token string">"/MD"</span> CMAKE_CUDA_FLAGS <span class="token string">"<span class="token variable">${CMAKE_CUDA_FLAGS}</span>"</span><span class="token punctuation">)</span>
endif<span class="token punctuation">(</span><span class="token punctuation">)</span>

link_directories<span class="token punctuation">(</span><span class="token variable">${LIB_DIR}</span><span class="token punctuation">)</span>

add_executable<span class="token punctuation">(</span>cuda_test test.cu<span class="token punctuation">)</span>

set_target_properties<span class="token punctuation">(</span>cuda_test PROPERTIES
        CUDA_SEPARABLE_COMPILATION ON<span class="token punctuation">)</span>

<span class="token comment"># 显式添加链接选项</span>
if<span class="token punctuation">(</span>MSVC<span class="token punctuation">)</span>
  set_target_properties<span class="token punctuation">(</span>cuda_test PROPERTIES LINK_FLAGS <span class="token string">"/NODEFAULTLIB:LIBCMT /NODEFAULTLIB:MSVCRT"</span><span class="token punctuation">)</span>
endif<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h2>
     <a id="_225">
     </a>
     参考文献：
    </h2>
    <p>
     [1] windows下用vscode编译并运行cuda程序
     <code>
      https://zhuanlan.zhihu.com/p/567996994
     </code>
     <br/>
     [2] CUDA 番外篇 | Visual Studio Code的CUDA环境
     <code>
      https://zhuanlan.zhihu.com/p/508810115
     </code>
     <br/>
     [3] windows下使用vccode+cmake编译cuda程序
     <code>
      https://blog.csdn.net/threestooegs/article/details/135173376
     </code>
     <br/>
     [4] CUDA Programming in VS Code with CMake
     <code>
      https://levelup.gitconnected.com/debugging-cuda-in-cmake-applications-on-vscode-with-ease-4a1990d77b18
     </code>
     <br/>
     [5] 如何应用 VS Code，CMake 和 Make 编译 C ++ 代码？
     <code>
      https://zhuanlan.zhihu.com/p/354070726
     </code>
     <br/>
     [6] Debugging CUDA in CMake applications on VSCODE with ease
     <code>
      https://levelup.gitconnected.com/debugging-cuda-in-cmake-applications-on-vscode-with-ease-4a1990d77b18
     </code>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f436f6e795f31342f:61727469636c652f64657461696c732f313436313036353935" class_="artid" style="display:none">
 </p>
</div>


