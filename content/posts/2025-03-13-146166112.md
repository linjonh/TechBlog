---
layout: post
title: "音视频开发第二章-FFmpeg-开发环境"
date: 2025-03-13 22:53:01 +0800
description: "MSYS2 可以选择 msys 或者 MinGW -w64 环境来编译，不过在 msys 下使用 gcc 编译出来的 exe 和 dll 依赖 msys-2.0.dll，而 MinGW -w64 下编译出来的文件不需要依赖这个 dll，从程序的运行效率来看，不依赖这个 dll 的程序的效率更高，所以选择 MinGW -w64 来编译更佳。重命名 msys64/usr/bin/link.exe 为 msys64/usr.bin/link.bak，避免和 MSVC 的 link.exe 冲突。"
keywords: "【音视频开发】第二章 FFmpeg 开发环境"
categories: ['音视频开发']
tags: ['音视频']
artid: "146166112"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146166112
    alt: "音视频开发第二章-FFmpeg-开发环境"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146166112
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146166112
cover: https://bing.ee123.net/img/rand?artid=146166112
image: https://bing.ee123.net/img/rand?artid=146166112
img: https://bing.ee123.net/img/rand?artid=146166112
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【音视频开发】第二章 FFmpeg 开发环境
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_FFmpeg__0">
     </a>
     【音视频开发】第二章 FFmpeg 开发环境
    </h2>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="Window__4">
     </a>
     一、Window 安装开发环境
    </h2>
    <h3>
     <a id="1FFmpeg__5">
     </a>
     1.FFmpeg 命令行环境搭建
    </h3>
    <p>
     FFMPEG 官网：
     <a href="https://ffmpeg.org" rel="nofollow">
      ffmpeg.org
     </a>
    </p>
    <p>
     下载以下文件：
     <br/>
     源码：ffmpeg-x.x.x.tar.bz2
     <br/>
     Shared：ffmpeg-x.x.x-winxx-shared.zip（包含 FFMPEG 的 dll 库文件）
     <br/>
     Static：ffmpeg-x.x.x-winxx-static.zip（包含了 FFMPEG 的官方文档）
     <br/>
     Dev：ffmpeg-x.x.x-winxx-dev.zip（包含 FFMPEG 的 lib 文件/头文件，以及 example 范例）
    </p>
    <p>
     <strong>
      拷贝可执行文件到 C://Windows
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1d953e2caa2342c9931d39dcfaa054b1.png"/>
    </p>
    <ul>
     <li>
      ffmpeg转码
     </li>
     <li>
      ffplay播放器
     </li>
     <li>
      ffprobe分析码流成分
     </li>
    </ul>
    <p>
     <strong>
      拷⻉动态链接库到C:\Windows\SysWOW64
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7aefc13fb54f49649dccc0cb6ac46ff5.png"/>
    </p>
    <p>
     <strong>
      输⼊ffmpeg -version测试
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/bca545b0200849aa9c0e3c03d5354f4f.png"/>
    </p>
    <ul>
     <li>
      configuration表示开启/关闭了哪些配置
     </li>
    </ul>
    <h3>
     <a id="2Visual_Studio__Qt__29">
     </a>
     2.Visual Studio 和 Qt 安装
    </h3>
    <p>
     Qt 下载地址：
     <a href="https://download.qt.io/archive/online_installers" rel="nofollow">
      download.qt.io/archive/online_installers
     </a>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/69f2fa2ae6ad443ea1e57c32394db3a3.png">
      <br/>
      这里下载的是 Qt 的在线安装程序
      <br/>
      选择 Qt 版本时，需要注意 Visual Studio 和 Qt 的版本是否兼容
     </img>
    </p>
    <p>
     配置 Visual Studio 环境变量
     <br/>
     D:\Program Files\VisualStudio\VC\Tools\MSVC\14.43.34808\bin\Hostx64\x64
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/3775ea19eb2e440aaddd4865bf744558.png"/>
    </p>
    <h3>
     <a id="3CDB__39">
     </a>
     3.CDB 调试器安装
    </h3>
    <p>
     MSVC 编译器使用 windbg 下的 cdb 调试器，所以需要安装 windbg
     <br/>
     <a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/debugger-download-tools" rel="nofollow">
      https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/debugger-download-tools
     </a>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/231b7ec8674c44f5a36124bec3819d93.png"/>
    </p>
    <h3>
     <a id="4Windows__FFmpeg_46">
     </a>
     4.Windows 编译 FFmpeg
    </h3>
    <p>
     <strong>
      安装 MSYS2
     </strong>
     <br/>
     MSYS2（Minimal System 2）是一个开源的软件发行环境和软件包管理器，主要用于在 Windows 上提供类似于 Unix/Linux 的开发体验。它是基于 Cygwin、MSYS（Minimal SYStem）和 MinGW-w64 项目的改进和扩展。MSYS2 提供了一个类 Unix 环境，以及支持 Windows 原生应用程序构建的工具链。
    </p>
    <p>
     下载地址：
     <a href="https://www.msys2.org" rel="nofollow">
      www.msys2.org
     </a>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/0c011ab95ab540b187c62f1c9758f11e.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/50d0174d8d4a4894836979c090cb5690.png">
       <br/>
       安装完成之后，先把安装目录下 msys2_shell.cmd 中的
      </img>
     </img>
    </p>
    <blockquote>
     <p>
      rem set MYS2_PATH_TYPE=inherit
     </p>
    </blockquote>
    <p>
     改成
    </p>
    <blockquote>
     <p>
      set MYS2_PATH_TYPE=inherit
     </p>
    </blockquote>
    <p>
     这是为了将 VS 的环境继承给 MSYS2
    </p>
    <p>
     MSYS2 可以选择 msys 或者 MinGW -w64 环境来编译，不过在 msys 下使用 gcc 编译出来的 exe 和 dll 依赖 msys-2.0.dll，而 MinGW -w64 下编译出来的文件不需要依赖这个 dll，从程序的运行效率来看，不依赖这个 dll 的程序的效率更高，所以选择 MinGW -w64 来编译更佳。
    </p>
    <p>
     <strong>
      修改 pacman 的源
     </strong>
     <br/>
     pacman 是一个软件包管理器，用来在 MSYS2 中安装软件，但是默认的国外源，下载安装包时非常慢，所以需要修改为国内源，可以选择中科大的源
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7240667f6ea74add924c6a6eac166853.png"/>
     <br/>
     编辑 /etc/pacman.d/mirrorlist.mingw32，在文件开头添加
    </p>
    <blockquote>
     <p>
      Server = https://mirrors.tuna.tsinghua.edu.cn/msys2/mingw/i686/
      <br/>
      Server = http://mirrors.ustc.edu.cn/msys2/mingw/i686/
     </p>
    </blockquote>
    <p>
     编辑 /etc/pacman.d/mirrorlist.mingw64，在文件开头添加
    </p>
    <blockquote>
     <p>
      Server = https://mirrors.tuna.tsinghua.edu.cn/msys2/mingw/x86_64/
      <br/>
      Server = http://mirrors.ustc.edu.cn/msys2/mingw/x86_64/
     </p>
    </blockquote>
    <p>
     编辑 /etc/pacman.d/mirrorlist.msys，在文件开头添加
    </p>
    <blockquote>
     <p>
      Server = https://mirrors.tuna.tsinghua.edu.cn/msys2/msys/$arch/
     </p>
     <p>
      Server = http://mirrors.ustc.edu.cn/msys2/msys/$arch/
     </p>
    </blockquote>
    <p>
     在 MSYS2 安装目录下输入以下命令，分别打开 64 位和 32 位的 shell
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d6320dd6bee841c9a224a0fd0cc9d0ee.png"/>
    </p>
    <p>
     然后在 msys2 的 shell 中执行
    </p>
    <blockquote>
     <p>
      pacman -Sy
     </p>
    </blockquote>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/172310dc037b483098d1a09a397df05f.png"/>
     <br/>
     刷新软件包数据
    </p>
    <p>
     <strong>
      安装编译环境
     </strong>
     <br/>
     安装 mingw-w64
     <br/>
     打开 MSYS2 MinGW64，在 shell 窗口中输入：
    </p>
    <blockquote>
     <p>
      pacman -S mingw-w64-x86_64-toolchain
     </p>
    </blockquote>
    <p>
     输入回车默认全部安装
    </p>
    <p>
     安装 git
    </p>
    <blockquote>
     <p>
      pacman -S git
     </p>
    </blockquote>
    <p>
     安装 make 等工具
    </p>
    <blockquote>
     <p>
      pacman -S make
      <br/>
      pacman -S automake
      <br/>
      pacman -S autoconf
      <br/>
      pacman -S perl
      <br/>
      pacman -S libtool
      <br/>
      pacman -S mingw-w64-i686-cmake
      <br/>
      pacman -S pkg-config
     </p>
    </blockquote>
    <p>
     如果需要编译出 ffplayer，还需要安装 SDL
    </p>
    <blockquote>
     <p>
      pacman -S mingw-w64-x86_64-SDL2
     </p>
    </blockquote>
    <p>
     <strong>
      重命名 link.exe
     </strong>
     <br/>
     重命名 msys64/usr/bin/link.exe 为 msys64/usr.bin/link.bak，避免和 MSVC 的 link.exe 冲突
    </p>
    <p>
     <strong>
      安装 YASM
     </strong>
    </p>
    <blockquote>
     <p>
      pacman -S nasm
      <br/>
      pacman -S yasm
     </p>
    </blockquote>
    <p>
     <strong>
      检查编译环境
     </strong>
    </p>
    <blockquote>
     <p>
      which cl link yasm cpp
     </p>
    </blockquote>
    <p>
     看返回结果，没有 no 的结果一般就没问题
    </p>
    <p>
     <strong>
      修改支持中文显示
     </strong>
     <br/>
     窗口右键 -&gt; Options -&gt; Text，然后 locale 选择：zh_CN，Character set 选择 UTF-8
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/aeefc69e76094615b90200c78d92fbc9.png"/>
    </p>
    <h3>
     <a id="5_140">
     </a>
     5.编译第三方库
    </h3>
    <p>
     <strong>
      下载和编译 x264
     </strong>
    </p>
    <p>
     <a href="https://www.videolan.org/developers/x264.html" rel="nofollow">
      www.videolan.org/developers/x264.html
     </a>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/974f439054bc4d98a4bfa73dd653b3d7.png"/>
     <br/>
     解压到此处
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e2081b256f524a1e9c777560b478ebac.png"/>
     <br/>
     进入 x264 目录
    </p>
    <blockquote>
     <p>
      ./configure --prefix=/home/${userName}/ffmpeg/build/libx264 --host=x86_64-w64-mingw32 --enable-shared --enable-static --extra-ldflags=-Wl,–output-def=libx264.def
      <br/>
      make
      <br/>
      make install
     </p>
    </blockquote>
    <p>
     生成 libx264.lib
     <br/>
     上面编译出来的结果没有包含 lib 文件，需要自己手动生成
    </p>
    <blockquote>
     <p>
      cp ./libx264.def /home/${username}/ffmpeg/build/libx264/lib
      <br/>
      cd /home/${username}/ffmpeg/build/libx264/lib
      <br/>
      lib /machine:X64 /def:libx264.def
     </p>
    </blockquote>
    <p>
     如果想在程序中直接使用 x264，将 include 中的 .h 头文件、libx264.lib 和 libx264-165.dll 复制到项目中对应位置，并且在程序中添加头文件
    </p>
    <p>
     <strong>
      下载和编译 fdk-aac
     </strong>
     <br/>
     <a href="https://sourceforge.net/projects/opencore-amr/files/fdk-aac/" rel="nofollow">
      https://sourceforge.net/projects/opencore-amr/files/fdk-aac
     </a>
    </p>
    <blockquote>
     <p>
      ./autogen.sh
      <br/>
      ./configure --prefix=/home/${username}/ffmpeg/build/libfdk-aac --enable-static --enable-shared
      <br/>
      make
      <br/>
      make install
     </p>
    </blockquote>
    <p>
     <strong>
      下载和编译 mp3
     </strong>
     <br/>
     <a href="https://sourceforge.net/projects/lame/" rel="nofollow">
      https://sourceforge.net/projects/lame
     </a>
    </p>
    <blockquote>
     <p>
      ./configure --prefix=/home/${username}/ffmpeg/build/libmp3lame --disable-shared --disable-frontend --enable-static
      <br/>
      make
      <br/>
      make install
     </p>
    </blockquote>
    <p>
     <strong>
      下载和编译 libvpx
     </strong>
     <br/>
     <a href="https://github.com/webmproject/libvpx">
      https://github.com/webmproject/libvpx
     </a>
    </p>
    <blockquote>
     <p>
      ./configure --prefix=/home/${username}/ffmpeg/build/libvpx --disable-examples --disable-unit-tests --enable-vp9-highbitdepth --as=yasm
      <br/>
      make
      <br/>
      make install
     </p>
    </blockquote>
    <p>
     <strong>
      下载和编译 ffmpeg
     </strong>
     <br/>
     <a href="https://gitee.com/mirrors/ffmpeg" rel="nofollow">
      https://gitee.com/mirrors/ffmpeg
     </a>
    </p>
    <blockquote>
     <p>
      ./configure --prefix=/home/${username}/ffmpeg/build/ffmpeg --arch=x86_64 --enable-shared --enable-gpl --enable-libfdk-aac --enable-nonfree --enable-libvpx --enable-libx264 --enable-libmp3lame --extra-cflags=“-I/home/${username}/ffmpeg/build/libfdk-aac/include” --extra-ldflags=“-L/home/${username}/ffmpeg/build/libfdk-aac/lib” --extra-cflags=“-I/home/${username}/ffmpeg/build/libvpx/include” --extra-ldflags=“-L/home/${username}/ffmpeg/build/libvpx/lib” --extra-cflags=“-I/home/${username}/ffmpeg/build/libx264/include” --extra-ldflags=“-L/home/${username}/ffmpeg/build/libx264/lib” --extra-cflags=“-I/home/${username}/ffmpeg/build/libmp3lame/include” --extra-ldflags=“-L/home/${username}/ffmpeg/build/libmp3lame/lib”
      <br/>
      make
      <br/>
      make install
     </p>
    </blockquote>
    <p>
     !注意 pkg-config
    </p>
    <h3>
     <a id="6Qt__MSVC__ffmpeg__194">
     </a>
     6.Qt 使用 MSVC 调用编译好的 ffmpeg 库
    </h3>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34353539333537352f:61727469636c652f64657461696c732f313436313636313132" class_="artid" style="display:none">
 </p>
</div>


