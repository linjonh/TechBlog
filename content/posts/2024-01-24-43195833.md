---
layout: post
title: "CAS数据库查询认证xml配置"
date: 2024-01-24 10:11:23 +0800
description: "上篇博客介绍的CAS的Demo，登录界面用户名、密码并没有通过数据库查询认证。本博客，将介绍如何通过"
keywords: "cas xml"
categories: ['单点登录Ssoshiro']
tags: ['无标签']
artid: "43195833"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=43195833
    alt: "CAS数据库查询认证xml配置"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=43195833
featuredImagePreview: https://bing.ee123.net/img/rand?artid=43195833
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     CAS数据库查询认证（xml配置）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p style="margin-top:13pt; margin-bottom:13pt">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      <span lang="zh-CN">
       上篇博客介绍的
      </span>
      <span lang="en-US">
       CAS
      </span>
      <span lang="zh-CN">
       的
      </span>
      <span lang="en-US">
       Demo
      </span>
      <span lang="zh-CN">
       ，登录界面用户名、密码并没有通过数据库查询认证。本博客，将介绍如何通过
      </span>
      <span lang="en-US">
       xml
      </span>
      <span lang="zh-CN">
       配置，进行
      </span>
      <span lang="en-US">
       CAS
      </span>
      <span lang="zh-CN">
       登录数据库查询认证。
      </span>
     </span>
    </p>
    <p style="margin-top:13pt; margin-bottom:13pt">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      <span lang="zh-CN">
       所需数据库
      </span>
      <span lang="en-US">
       sso
      </span>
      <span lang="en-US">
       _cas,
      </span>
      <span lang="zh-CN">
       库中的表：
      </span>
      <span lang="en-US">
       tb_user
      </span>
      <span lang="zh-CN">
       ，表中字段：
      </span>
      <span lang="en-US">
       Id
      </span>
      <span lang="zh-CN">
       、
      </span>
      <span lang="en-US">
       username
      </span>
      <span lang="zh-CN">
       、
      </span>
      <span lang="en-US">
       password
      </span>
      <span lang="zh-CN">
       ；
      </span>
     </span>
    </p>
    <p style="margin:0in">
     <img alt="" src="https://img-blog.csdn.net/20150127155743729?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGFueHVlbWluMTIzNDU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
      <br/>
     </img>
    </p>
    <p style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
     </span>
    </p>
    <p style="margin:0in">
     <img alt="" src="https://img-blog.csdn.net/20150127155719609?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGFueHVlbWluMTIzNDU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
      <br/>
     </img>
    </p>
    <p style="margin-top:13pt; margin-bottom:13pt">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      <span lang="zh-CN">
       <strong>
        数据库查询认证（通过
       </strong>
      </span>
      <span lang="en-US">
       <strong>
        xml
       </strong>
      </span>
      <span lang="zh-CN">
       <strong>
        配置）
       </strong>
      </span>
     </span>
    </p>
    <p style="margin-top:13pt; margin-bottom:13pt">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      <span lang="en-US">
       <strong>
        1
       </strong>
      </span>
      <span lang="zh-CN">
       <strong>
        ，修改
       </strong>
      </span>
      <span lang="en-US">
       <strong>
        cas
       </strong>
      </span>
      <span lang="zh-CN">
       <strong>
        服务端配置
       </strong>
      </span>
     </span>
    </p>
    <p style="margin:0in">
     <img alt="" src="https://img-blog.csdn.net/20150127155729015?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGFueHVlbWluMTIzNDU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
      <br/>
     </img>
    </p>
    <p style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      <span lang="en-US">
       tomcat
      </span>
      <span lang="zh-CN">
       下
      </span>
      <span lang="en-US">
       webapps/cas/WEB_INF/deployerConfigContext.xml
      </span>
      <span lang="zh-CN">
       文件做如下修改：
      </span>
     </span>
    </p>
    <p style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
     </span>
    </p>
    <p lang="en-US" style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      &lt;beanclass="org.jasig.cas.authentication.handler.support.SimpleTestUsernamePasswordAuthenticationHandler"/&gt;
     </span>
    </p>
    <p lang="en-US" style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
     </span>
    </p>
    <p style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      修改为：
     </span>
    </p>
    <p lang="en-US" style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      &lt;beanclass="org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler"&gt;
     </span>
    </p>
    <p lang="en-US" style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      &lt;propertyname="dataSource" ref="dataSource" &gt;&lt;/property&gt;
     </span>
    </p>
    <p lang="en-US" style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      &lt;propertyname="sql" value="select password from tb_user whereusername=?" &gt;&lt;/property&gt;
     </span>
    </p>
    <p lang="en-US" style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      &lt;/property&gt;
     </span>
    </p>
    <p lang="en-US" style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      &lt;/bean&gt;
     </span>
    </p>
    <p lang="en-US" style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
     </span>
    </p>
    <p style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      <span lang="zh-CN">
       添加
      </span>
      <span lang="en-US">
       datasource bean
      </span>
      <span lang="zh-CN">
       的定义：
      </span>
     </span>
    </p>
    <p lang="en-US" style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      &lt;beanid="dataSource"
     </span>
    </p>
    <p lang="en-US" style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      class="org.springframework.jdbc.datasource.DriverManagerDataSource"&gt;
     </span>
    </p>
    <p lang="en-US" style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      &lt;propertyname="driverClassName" value="com.mysql.jdbc.Driver" /&gt;
     </span>
    </p>
    <p lang="en-US" style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      &lt;propertyname="url" value="jdbc:mysql://localhost/sso_cas" /&gt;
     </span>
    </p>
    <p lang="en-US" style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      &lt;propertyname="username" value="root" /&gt;
     </span>
    </p>
    <p lang="en-US" style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      &lt;propertyname="password" value="root" /&gt;
     </span>
    </p>
    <p lang="en-US" style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      &lt;/bean&gt;
     </span>
    </p>
    <p lang="en-US" style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
     </span>
    </p>
    <p style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      注意
     </span>
    </p>
    <p style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      <span lang="en-US">
       1,QueryDatabaseAuthenticationHandler
      </span>
      <span lang="zh-CN">
       是
      </span>
      <span lang="en-US">
       cas-server-support-jdbc
      </span>
      <span lang="zh-CN">
       提供的查询接口其中一个是通过配置一个
      </span>
      <span lang="en-US">
       SQL
      </span>
      <span lang="zh-CN">
       语句查出密码，与所给密码匹配；
      </span>
     </span>
    </p>
    <p style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      <span lang="en-US">
       2,sql
      </span>
      <span lang="zh-CN">
       语句
      </span>
      <span lang="en-US">
       :select password from tb_user whereusername=?
      </span>
      <span lang="zh-CN">
       根据用户名
      </span>
      <span lang="en-US">
       user
      </span>
      <span lang="en-US">
       name
      </span>
      <span lang="en-US">
      </span>
      <span lang="zh-CN">
       查询表
      </span>
      <span lang="en-US">
       tb_user
      </span>
      <span lang="zh-CN">
       中密码
      </span>
      <span lang="en-US">
       password
      </span>
      <span lang="zh-CN">
       字段，
      </span>
      <span lang="en-US">
       CAS
      </span>
      <span lang="zh-CN">
       会匹配用户输入的密码，如果匹配则通过；
      </span>
     </span>
    </p>
    <p lang="en-US" style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
     </span>
    </p>
    <p style="margin-top:13pt; margin-bottom:13pt">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      <span lang="zh-CN" style="font-weight:bold">
       注：可配置多个数据库
      </span>
      <span lang="en-US" style="font-weight:bold">
      </span>
     </span>
    </p>
    <p style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      <span lang="zh-CN">
       如果需要配置多个数据库，可以配置多个
      </span>
      <span lang="en-US">
       QueryDatabaseAuthenticationHandler
      </span>
      <span lang="zh-CN">
       和多个
      </span>
      <span lang="en-US">
       datasource
      </span>
     </span>
    </p>
    <p style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      <span lang="zh-CN">
       假如
      </span>
      <span lang="en-US">
       a_user
      </span>
      <span lang="zh-CN">
       中有一个用户：
      </span>
      <span lang="en-US">
       auser
      </span>
      <span lang="zh-CN">
       ，
      </span>
      <span lang="en-US">
       b_user
      </span>
      <span lang="zh-CN">
       中有一个用户
      </span>
      <span lang="en-US">
       buser
      </span>
      <span lang="zh-CN">
       ，这样你无论用哪一个用户登录，
      </span>
      <span lang="en-US">
       CAS
      </span>
      <span lang="zh-CN">
       就会先查
      </span>
      <span lang="en-US">
       a_user
      </span>
      <span lang="zh-CN">
       ，如果用户名密码都正确，那么就通过，如果
      </span>
      <span lang="en-US">
       a_user
      </span>
      <span lang="zh-CN">
       中验证失败，那么
      </span>
      <span lang="en-US">
       CAS
      </span>
      <span lang="zh-CN">
       就会再查
      </span>
      <span lang="en-US">
       b_user
      </span>
      <span lang="zh-CN">
       ，用户名密码都正确就算通过了，此时不正确，就算这次登录验证没通过。
      </span>
      <span lang="en-US">
      </span>
     </span>
    </p>
    <p style="margin-top:13pt; margin-bottom:13pt">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      <span lang="zh-CN">
       <strong>
        添加相关的
       </strong>
      </span>
      <span lang="en-US">
       <strong>
        jar
       </strong>
      </span>
      <span lang="zh-CN">
       <strong>
        包
       </strong>
      </span>
     </span>
    </p>
    <p style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      <span lang="zh-CN">
       需要在
      </span>
      <span lang="en-US">
       web
      </span>
      <span lang="zh-CN">
       项目的
      </span>
      <span lang="en-US">
       lib
      </span>
      <span lang="zh-CN">
       下添加两个包：
      </span>
      <span lang="en-US">
       cas-server-support-jdbc-x.x.x.jar
      </span>
      <span lang="zh-CN">
       和
      </span>
      <span lang="en-US">
      </span>
      <span lang="en-US">
       mysql-connector-java-x.x.x-bin.jar
      </span>
      <span lang="zh-CN">
       （具体版本号根据情况而定）
      </span>
     </span>
    </p>
    <p style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
     </span>
    </p>
    <p style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
      <span lang="zh-CN">
       按如下配置好后，进入
      </span>
      <span lang="en-US">
       CAS
      </span>
      <span lang="zh-CN">
       登录页，用户名密码需要通过查询数据库来认证，输入用户名
      </span>
      <span lang="en-US">
       admin
      </span>
      <span lang="zh-CN">
       ，密码
      </span>
      <span lang="en-US">
       123
      </span>
      <span lang="zh-CN">
       ，才可登录成功；如果输入用户名
      </span>
      <span lang="en-US">
       admin
      </span>
      <span lang="zh-CN">
       ，密码
      </span>
      <span lang="en-US">
       admin
      </span>
      <span lang="zh-CN">
       是不能登录成功。
      </span>
     </span>
    </p>
    <p style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
     </span>
    </p>
    <p style="margin:0in">
     <img alt="" src="https://img-blog.csdn.net/20150127155821076?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGFueHVlbWluMTIzNDU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
      <br/>
     </img>
    </p>
    <p style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
     </span>
    </p>
    <p style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
     </span>
    </p>
    <p style="margin:0in">
     <span style="font-family:KaiTi_GB2312; font-size:18px">
     </span>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f68616e7875656d696e3132333435:2f61727469636c652f64657461696c732f3433313935383333" class_="artid" style="display:none">
 </p>
</div>


