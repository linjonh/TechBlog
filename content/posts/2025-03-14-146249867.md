---
layout: post
title: "理解langchain-langgraph-官方文档示例代码中的MemorySaver"
date: 2025-03-14 10:41:27 +0800
description: "中间件有什么特征：它在程序执行过程中某些数据流的环节介入，并根据设定的逻辑对部分数据进行加工或调整数据的流向，而这一切对用户来说是透明的，看不见的，像一只看不见的手在那里做了些什么。在这里中的作用类似于一个“中间件”，workflow编译的时候提供了一个“检查点（Checkpointing）”让这个中间件介入进去，让这个看不见的手去捕获并加工里面数据。节点 (Nodes): 节点是工作流中的执行单元，每个节点都关联一个函数，该函数定义了节点的执行逻辑。：标记节点及节点的状态，定义节点之间的连接和流向。"
keywords: "理解langchain langgraph 官方文档示例代码中的MemorySaver"
categories: ['未分类']
tags: ['前端', 'Langchain', 'Java']
artid: "146249867"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146249867
    alt: "理解langchain-langgraph-官方文档示例代码中的MemorySaver"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146249867
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146249867
cover: https://bing.ee123.net/img/rand?artid=146249867
image: https://bing.ee123.net/img/rand?artid=146249867
img: https://bing.ee123.net/img/rand?artid=146249867
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     理解langchain langgraph 官方文档示例代码中的MemorySaver
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     以下是langchain v0.3官方示例代码
    </p>
    <pre><code class="language-python">from langgraph.checkpoint.memory import MemorySaver
from langgraph.graph import START, MessagesState, StateGraph

# 可以理解为：定义一个流程，这个流程中用到的数据类型是Messages。 &lt;---定义一个有向图，指定状态模式/格式/规范为 MessagesState这种规范
workflow = StateGraph(state_schema=MessagesState)


# 定义调用模型的函数
def call_model(state: MessagesState):
    response = model.invoke(state["messages"])
    return {"messages": response}


# 整个流程只有一个节点，可谓是最简单的任务流了
workflow.add_edge(START, "model")
workflow.add_node("model", call_model)

# 把“记忆保存器”这个中间件注入到流程中
memory = MemorySaver()
app = workflow.compile(checkpointer=memory)

config = {"configurable": {"thread_id": "abc123"}}

query = "Hi! I'm Bob."

input_messages = [HumanMessage(query)]
output = app.invoke({"messages": input_messages}, config)
output["messages"][-1].pretty_print()  # output contains all messages in state

query = "What's my name?"

input_messages = [HumanMessage(query)]
output = app.invoke({"messages": input_messages}, config)
output["messages"][-1].pretty_print()</code></pre>
    <p>
     输出
    </p>
    <pre><code class="language-python">==================================[1m Ai Message [0m==================================

Hi Bob! How can I assist you today?


==================================[1m Ai Message [0m==================================

Your name is Bob! How can I help you today, Bob?</code></pre>
    <p>
    </p>
    <p>
     这里涉及到图论的基础知识，要快速了最基础概念，推荐这个视频：
     <a href="https://www.bilibili.com/video/BV1dz411e7WG/" rel="nofollow" title="【硬核干货】图论到底是个什么玩意儿？图论入门：树与生成树 (Graph Theory: Tree and Spanning Tree)_哔哩哔哩_bilibili">
      【硬核干货】图论到底是个什么玩意儿？图论入门：树与生成树 (Graph Theory: Tree and Spanning Tree)_哔哩哔哩_bilibili
     </a>
    </p>
    <p>
    </p>
    <p>
     <strong>
      图 (Graph)
     </strong>
     ：基于图论的概念，它由节点 (nodes) 和边 (edges) 组成。
    </p>
    <p>
     节点 (Nodes): 节点是工作流中的执行单元，每个节点都关联一个函数，该函数定义了节点的执行逻辑。
    </p>
    <p>
     边 (Edges): 边定义了节点之间的连接关系，以及工作流的执行路径。
    </p>
    <p>
     <strong>
      状态 (State)
     </strong>
     ：标记节点及节点的状态，定义节点之间的连接和流向。--&gt; 简单直观地理解的话，可以把State理解为我们常规编程中常用的Data
    </p>
    <p>
    </p>
    <p>
     StateGraph=  State + Graph --&gt; 依据【状态】来运作的【有向图】---&gt;可近似理解为工作流
    </p>
    <pre><code class="language-python">workflow = StateGraph(state_schema=MessagesState)</code></pre>
    <p>
     当中，state_schema 参数定义了这个“状态驱动的有向图” 的
     <span style="color:#fe2c24">
      状态描述格式/标准/规范
     </span>
     采用 MessagesState 这种数据结构的规范。
    </p>
    <p>
     --&gt; 更通俗理解的话，可以把它想象成是以下语句在LangGraph场景下的固有写法：
    </p>
    <pre><code class="hljs"># 以下这是一段伪代码
workflow = LangChainWorkFlow(data_type=Messages) </code></pre>
    <p>
     ------ MemorySaver ------
    </p>
    <pre><code class="language-python">memory = MemorySaver()
app = workflow.compile(checkpointer=memory)</code></pre>
    <p>
     这里的MemorySaver有点像一个中间件，你可以把它当作中间件来理解。
    </p>
    <p>
     中间件有什么特征：它在程序执行过程中某些数据流的环节介入，并根据设定的逻辑对部分数据进行加工或调整数据的流向，而这一切对用户来说是透明的，看不见的，像一只看不见的手在那里做了些什么。
    </p>
    <ul>
     <li>
      <strong>
       它不是核心逻辑
      </strong>
      ，但能在数据流经过时
      <strong>
       插入
      </strong>
      自己的逻辑。
     </li>
     <li>
      <strong>
       它不改变程序的主要流程
      </strong>
      ，但能
      <strong>
       修改、过滤、检查
      </strong>
      数据。
     </li>
     <li>
      <strong>
       它对用户是透明的
      </strong>
      ，但对系统来说是
      <strong>
       必不可少的
      </strong>
      。
     </li>
    </ul>
    <h4>
     <strong>
      中间件在程序中的作用
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        <strong>
         作用
        </strong>
       </th>
       <th>
        <strong>
         示例
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         数据过滤
        </strong>
       </td>
       <td>
        日志记录、请求验证、权限检查
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         数据转换
        </strong>
       </td>
       <td>
        格式转换、加密/解密、压缩
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         流向控制
        </strong>
       </td>
       <td>
        负载均衡、路由选择、错误处理
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     <code>
      MemorySaver
     </code>
     在这里中的作用类似于一个“中间件”，workflow编译的时候提供了一个“检查点（checkpointer）”让这个中间件介入进去，让这个看不见的手去捕获并加工里面数据。
    </p>
    <p>
    </p>
    <p>
     这个参数名叫checkpointer我觉得名字起得非常好。
    </p>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f626967636172702f:61727469636c652f64657461696c732f313436323439383637" class_="artid" style="display:none">
 </p>
</div>


