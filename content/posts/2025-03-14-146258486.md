---
layout: post
title: "Work2PGP-SAM-无需额外提示的自动化-SAM"
date: 2025-03-14 15:44:35 +0800
description: "和大家分享一下我们发表在ISBI 2025上的论文：。代码已经开源！！！期待您的 Star！！！PGP-SAMSegment Anything Model (SAM) 展现了强大且多功能的图像分割能力，并支持直观的提示交互。然而，将SAM定制应用于医学图像分割需要大量像素级标注和精确的点/框提示设计。为解决这些挑战，我们提出了PGP-SAM——一种基于原型的新型少样本调优方法，通过有限样本替代繁琐的手动提示设计。核心思想是利用类间和类内原型捕获类别特异性知识与关联关系。"
keywords: "Work【2】：PGP-SAM —— 无需额外提示的自动化 SAM！"
categories: ['Shot', 'Segmentation', 'Model', 'Medseg', 'Medical', 'Big']
tags: ['计算机视觉', '深度学习', '人工智能', 'Segment', 'Sam', 'Medical', 'Image']
artid: "146258486"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146258486
    alt: "Work2PGP-SAM-无需额外提示的自动化-SAM"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146258486
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146258486
cover: https://bing.ee123.net/img/rand?artid=146258486
image: https://bing.ee123.net/img/rand?artid=146258486
img: https://bing.ee123.net/img/rand?artid=146258486
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Work【2】：PGP-SAM —— 无需额外提示的自动化 SAM！
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <hr/>
    <h2>
     <a id="_5">
     </a>
     前言
    </h2>
    <p>
     和大家分享一下我们发表在
     <font color="red" size="4">
      ISBI 2025
     </font>
     上的论文：
     <font color="blue" size="4">
      PGP-SAM: Prototype-Guided Prompt Learning for Efficient Few-Shot Medical Image Segmentation
     </font>
     。
    </p>
    <p>
     欢迎大家在 arxiv 上阅读：
     <br/>
     <a href="https://arxiv.org/abs/2501.06692" rel="nofollow">
      PGP-SAM: Prototype-Guided Prompt Learning for Efficient Few-Shot Medical Image Segmentation
     </a>
    </p>
    <p>
     <strong>
      代码已经开源！！！期待您的 Star！！！
     </strong>
     <br/>
     <a href="https://github.com/PRIS-CV/PGP-SAM">
      PGP-SAM
     </a>
    </p>
    <hr/>
    <h2>
     <a id="Abstract_16">
     </a>
     Abstract
    </h2>
    <p>
     Segment Anything Model (SAM) 展现了强大且多功能的图像分割能力，并支持直观的提示交互。然而，将SAM定制应用于医学图像分割需要大量像素级标注和精确的点/框提示设计。为解决这些挑战，我们提出了
     <strong>
      PGP-SAM
     </strong>
     ——一种基于原型的新型少样本调优方法，通过有限样本替代繁琐的手动提示设计。核心思想是利用类间和类内原型捕获类别特异性知识与关联关系。我们提出两个关键组件：(1) 即插即用的上下文调制模块，用于融合多尺度信息；(2) 类别引导的交叉注意力机制，通过原型与特征融合实现自动提示生成。在公开多器官数据集和私有脑室数据集上的实验表明，
     <strong>
      PGP-SAM
     </strong>
     仅使用 10% 的 2D 切片即可超越现有无提示 SAM 变体的平均 Dice 分数。
    </p>
    <hr/>
    <h2>
     <a id="Introduction_20">
     </a>
     Introduction
    </h2>
    <p>
     医学图像分割旨在实现对特定感兴趣区域（如组织、器官）的精准识别与轮廓勾画，为医生提供可靠的诊断依据和有效的治疗规划[1,2]。然而，实现精确分割通常需要大量标注数据，其收集与标注过程需要耗费大量时间、专业知识和资源。
    </p>
    <p>
     分割一切模型（Segment Anything Model, SAM）凭借强大的分割能力和用户友好的提示交互机制，为图像分割领域带来了重大突破。然而，其在零样本医学图像分割中的表现被多项研究证实存在不足，这促使研究者探索如何有效适配SAM至医学领域。当前主流方法侧重于通过微调SAM的图像编码器来提升医学图像分割性能，同时保留其交互特性。这些方法在测试阶段常依赖真实标注数据生成提示。此外，针对SAM的无提示微调方法开始涌现，但这类方法对医学知识的利用尚不充分。尽管取得了显著进展，现有工作仍面临两大挑战：
    </p>
    <ul>
     <li>
      (1) 由于自然图像与医学图像存在显著领域差异，全参数或编码器重点微调需要大量标注医学数据；
     </li>
     <li>
      (2) SAM对输入点/框提示具有高度敏感性，即使提示存在细微偏差也会显著影响结果，这要求在训练和测试阶段必须设计精确的提示。
     </li>
    </ul>
    <p>
     为应对这些挑战，H-SAM 采用两阶段分层掩码解码器并冻结图像编码器，该策略仅需 10% 的可用样本即可快速整合医学知识。然而，由于可学习参数量较大，H-SAM在有限数据下仍难以有效学习类别特异性信息。
    </p>
    <p>
     基于上述少样本设定，我们提出 PGP-SAM（原型引导提示学习 SAM），旨在通过原型学习快速迁移类别特异性知识及器官关联关系。PGP-SAM包含两组原型：类内原型（intra-class prototypes）与类间原型（inter-class prototypes），分别学习 CT 图像中器官的类别特异性表征知识和共享知识。这些原型通过梯度反向传播在训练过程中更新。PGP-SAM 包含两个核心模块：(1) 上下文特征精炼模块（Contextual Feature Refinement），通过通道与空间维度的上下文融合使特征聚焦于感兴趣区域；(2) 渐进式原型优化模块（Progressive Prototype Refinement），通过将每个类内原型与最相似的类间原型匹配，并与图像特征、类别特征交互，最终生成增强型原型以产生精确提示。借助原型机制，我们能够从少量数据中学习核心特征。本方法在公开数据集和私有数据集上均取得优异结果，同时仅引入极少量额外参数。
    </p>
    <p>
     总结而言，我们的主要贡献包括：
    </p>
    <ul>
     <li>
      提出高效的上下文融合机制，帮助模型更好地学习全局信息
     </li>
     <li>
      设计基于原型的提示编码器，无需额外知识即可为SAM提供精确提示
     </li>
     <li>
      在公开与私有数据集上均达到最先进性能
     </li>
    </ul>
    <hr/>
    <h2>
     <a id="Methods_37">
     </a>
     Methods
    </h2>
    <p>
     本节通过微调 SAM 的图像编码器介绍
     <strong>
      PGP-SAM
     </strong>
     模型。该模型包含多尺度原型引导提示生成器和共享权重的掩码解码器，整体架构如下图所示。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a9d08d9d08f0418fad176be9681895e7.png#pic_center" width="800"/>
    </p>
    <h3>
     <a id="Contextual_Feature_Modulation_40">
     </a>
     Contextual Feature Modulation
    </h3>
    <p>
     图像编码器提取的特征通常包含丰富的空间细节，但缺乏全局语义理解。受前人工作[15]启发，我们提出
     <strong>
      上下文特征调制机制(Contextual Feature Modulation, CFM)
     </strong>
     ，在空间和通道维度将全局语义信息注入多尺度特征。
    </p>
    <p>
     给定每个阶段输入特征
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        F 
         
        
          i 
         
        
       
         ∈ 
        
        
        
          R 
         
         
         
           H 
          
         
           × 
          
         
           W 
          
         
           × 
          
         
           C 
          
         
        
       
      
        F_{i}\in \mathbb{R}^{H\times W\times C}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           F
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          ∈
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.8413em;">
         </span>
         <span class="mord">
          <span class="mord mathbb">
           R
          </span>
          <span class="msupsub">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.8413em;">
              <span class="" style="top: -3.063em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight" style="margin-right: 0.0813em;">
                  H
                 </span>
                 <span class="mbin mtight">
                  ×
                 </span>
                 <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                  W
                 </span>
                 <span class="mbin mtight">
                  ×
                 </span>
                 <span class="mord mathnormal mtight" style="margin-right: 0.0715em;">
                  C
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     （其中
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        i 
        
       
         ∈ 
        
       
         { 
        
       
         1 
        
       
         , 
        
       
         2 
        
       
         } 
        
       
      
        i\in\{1,2\}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6986em; vertical-align: -0.0391em;">
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          ∈
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mopen">
          {
          <!-- -->
         </span>
         <span class="mord">
          1
         </span>
         <span class="mpunct">
          ,
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mord">
          2
         </span>
         <span class="mclose">
          }
         </span>
        </span>
       </span>
      </span>
     </span>
     ），我们分别在空间和通道维度进行增强。此处采用第一和第四图像块[16]后的特征。在空间维度，通过对高度和宽度方向进行平均池化并求和得到
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        F 
         
        
          s 
         
        
       
         ∈ 
        
        
        
          R 
         
         
         
           H 
          
         
           × 
          
         
           W 
          
         
           × 
          
         
           C 
          
         
        
       
      
        F_{s}\in \mathbb{R}^{H\times W\times C}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           F
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.1514em;">
              <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  s
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          ∈
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.8413em;">
         </span>
         <span class="mord">
          <span class="mord mathbb">
           R
          </span>
          <span class="msupsub">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.8413em;">
              <span class="" style="top: -3.063em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight" style="margin-right: 0.0813em;">
                  H
                 </span>
                 <span class="mbin mtight">
                  ×
                 </span>
                 <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                  W
                 </span>
                 <span class="mbin mtight">
                  ×
                 </span>
                 <span class="mord mathnormal mtight" style="margin-right: 0.0715em;">
                  C
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     ，进而计算空间特征调制矩阵
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        F 
         
        
          i 
         
        
          s 
         
        
       
         ∈ 
        
        
        
          R 
         
         
         
           H 
          
         
           × 
          
         
           W 
          
         
           × 
          
         
           C 
          
         
        
       
      
        F_{i}^{s}\in \mathbb{R}^{H\times W\times C}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.942em; vertical-align: -0.2587em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           F
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.6644em;">
              <span class="" style="top: -2.4413em; margin-left: -0.1389em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                </span>
               </span>
              </span>
              <span class="" style="top: -3.063em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  s
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.2587em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          ∈
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.8413em;">
         </span>
         <span class="mord">
          <span class="mord mathbb">
           R
          </span>
          <span class="msupsub">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.8413em;">
              <span class="" style="top: -3.063em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight" style="margin-right: 0.0813em;">
                  H
                 </span>
                 <span class="mbin mtight">
                  ×
                 </span>
                 <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                  W
                 </span>
                 <span class="mbin mtight">
                  ×
                 </span>
                 <span class="mord mathnormal mtight" style="margin-right: 0.0715em;">
                  C
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     ：
    </p>
    <p>
     <span class="katex--display">
      <span class="katex-display">
       <span class="katex">
        <span class="katex-mathml">
         F 
          
         
           i 
          
         
           s 
          
         
        
          = 
         
         
         
           F 
          
         
           i 
          
         
        
          ⊙ 
         
        
          δ 
         
        
          ( 
         
         
         
           φ 
          
          
          
            k 
           
          
            × 
           
          
            1 
           
          
         
        
          ( 
         
        
          ϕ 
         
        
          ( 
         
         
         
           φ 
          
          
          
            1 
           
          
            × 
           
          
            k 
           
          
         
        
          ( 
         
         
         
           F 
          
         
           s 
          
         
        
          ) 
         
        
          ) 
         
        
          ) 
         
        
          ) 
         
         
        
          ( 
         
        
          1 
         
        
          ) 
         
        
       
         F_{i}^{s}=F_{i}\odot\delta(\varphi_{k\times 1}(\phi(\varphi_{1\times k}(F_{s})))) \qquad(1)
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.9614em; vertical-align: -0.247em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.1389em;">
            F
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.7144em;">
               <span class="" style="top: -2.453em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   i
                  </span>
                 </span>
                </span>
               </span>
               <span class="" style="top: -3.113em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   s
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.247em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.1389em;">
            F
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3117em;">
               <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   i
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           ⊙
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0379em;">
           δ
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord">
           <span class="mord mathnormal">
            φ
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3361em;">
               <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight" style="margin-right: 0.0315em;">
                   k
                  </span>
                  <span class="mbin mtight">
                   ×
                  </span>
                  <span class="mord mtight">
                   1
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.2083em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal">
           ϕ
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord">
           <span class="mord mathnormal">
            φ
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3361em;">
               <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mtight">
                   1
                  </span>
                  <span class="mbin mtight">
                   ×
                  </span>
                  <span class="mord mathnormal mtight" style="margin-right: 0.0315em;">
                   k
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.2083em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.1389em;">
            F
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.1514em;">
               <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   s
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose">
           ))))
          </span>
          <span class="mspace" style="margin-right: 2em;">
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord">
           1
          </span>
          <span class="mclose">
           )
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <p>
     其中
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        φ 
        
       
      
        \varphi
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.625em; vertical-align: -0.1944em;">
         </span>
         <span class="mord mathnormal">
          φ
         </span>
        </span>
       </span>
      </span>
     </span>
     表示条带卷积，
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        k 
        
       
      
        k
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0315em;">
          k
         </span>
        </span>
       </span>
      </span>
     </span>
     为卷积核尺寸，
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        ϕ 
        
       
      
        \phi
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;">
         </span>
         <span class="mord mathnormal">
          ϕ
         </span>
        </span>
       </span>
      </span>
     </span>
     表示层归一化与ReLU激活，
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        δ 
        
       
      
        \delta
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0379em;">
          δ
         </span>
        </span>
       </span>
      </span>
     </span>
     为Sigmoid函数。类似地，通道维度通过平均池化得到
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        F 
         
        
          c 
         
        
       
         ∈ 
        
        
        
          R 
         
         
         
           1 
          
         
           × 
          
         
           1 
          
         
           × 
          
         
           C 
          
         
        
       
      
        F_{c}\in \mathbb{R}^{1\times 1\times C}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           F
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.1514em;">
              <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  c
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          ∈
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.8413em;">
         </span>
         <span class="mord">
          <span class="mord mathbb">
           R
          </span>
          <span class="msupsub">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.8413em;">
              <span class="" style="top: -3.063em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mtight">
                  1
                 </span>
                 <span class="mbin mtight">
                  ×
                 </span>
                 <span class="mord mtight">
                  1
                 </span>
                 <span class="mbin mtight">
                  ×
                 </span>
                 <span class="mord mathnormal mtight" style="margin-right: 0.0715em;">
                  C
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     ，计算通道特征调制矩阵
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        F 
         
        
          i 
         
        
          c 
         
        
       
         ∈ 
        
        
        
          R 
         
         
         
           H 
          
         
           × 
          
         
           W 
          
         
           × 
          
         
           C 
          
         
        
       
      
        F_{i}^{c}\in \mathbb{R}^{H\times W\times C}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.942em; vertical-align: -0.2587em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           F
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.6644em;">
              <span class="" style="top: -2.4413em; margin-left: -0.1389em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                </span>
               </span>
              </span>
              <span class="" style="top: -3.063em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  c
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.2587em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          ∈
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.8413em;">
         </span>
         <span class="mord">
          <span class="mord mathbb">
           R
          </span>
          <span class="msupsub">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.8413em;">
              <span class="" style="top: -3.063em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight" style="margin-right: 0.0813em;">
                  H
                 </span>
                 <span class="mbin mtight">
                  ×
                 </span>
                 <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                  W
                 </span>
                 <span class="mbin mtight">
                  ×
                 </span>
                 <span class="mord mathnormal mtight" style="margin-right: 0.0715em;">
                  C
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     ：
    </p>
    <p>
     <span class="katex--display">
      <span class="katex-display">
       <span class="katex">
        <span class="katex-mathml">
         F 
          
         
           i 
          
         
           c 
          
         
        
          = 
         
         
         
           F 
          
         
           i 
          
         
        
          ⊙ 
         
        
          δ 
         
        
          ( 
         
         
         
           φ 
          
          
          
            1 
           
          
            × 
           
          
            1 
           
          
         
        
          ( 
         
        
          ϕ 
         
        
          ( 
         
         
         
           φ 
          
          
          
            1 
           
          
            × 
           
          
            1 
           
          
         
        
          ( 
         
         
         
           F 
          
         
           c 
          
         
        
          ) 
         
        
          ) 
         
        
          ) 
         
        
          ) 
         
         
        
          ( 
         
        
          2 
         
        
          ) 
         
        
       
         F_{i}^{c}=F_{i}\odot\delta(\varphi_{1\times 1}(\phi(\varphi_{1\times 1}(F_{c})))) \qquad(2)
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.9614em; vertical-align: -0.247em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.1389em;">
            F
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.7144em;">
               <span class="" style="top: -2.453em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   i
                  </span>
                 </span>
                </span>
               </span>
               <span class="" style="top: -3.113em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   c
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.247em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.1389em;">
            F
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3117em;">
               <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   i
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           ⊙
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0379em;">
           δ
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord">
           <span class="mord mathnormal">
            φ
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3011em;">
               <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mtight">
                   1
                  </span>
                  <span class="mbin mtight">
                   ×
                  </span>
                  <span class="mord mtight">
                   1
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.2083em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal">
           ϕ
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord">
           <span class="mord mathnormal">
            φ
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3011em;">
               <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mtight">
                   1
                  </span>
                  <span class="mbin mtight">
                   ×
                  </span>
                  <span class="mord mtight">
                   1
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.2083em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.1389em;">
            F
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.1514em;">
               <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   c
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose">
           ))))
          </span>
          <span class="mspace" style="margin-right: 2em;">
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord">
           2
          </span>
          <span class="mclose">
           )
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <p>
     最终将空间调制特征
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        F 
         
        
          i 
         
        
          s 
         
        
       
      
        F_{i}^{s}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.942em; vertical-align: -0.2587em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           F
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.6644em;">
              <span class="" style="top: -2.4413em; margin-left: -0.1389em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                </span>
               </span>
              </span>
              <span class="" style="top: -3.063em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  s
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.2587em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     和通道调制特征
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        F 
         
        
          i 
         
        
          c 
         
        
       
      
        F_{i}^{c}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.942em; vertical-align: -0.2587em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           F
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.6644em;">
              <span class="" style="top: -2.4413em; margin-left: -0.1389em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                </span>
               </span>
              </span>
              <span class="" style="top: -3.063em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  c
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.2587em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     与原始特征
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        F 
         
        
          i 
         
        
       
      
        F_{i}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           F
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     相加，得到上下文增强特征
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        F 
          
         
           ~ 
          
         
        
          i 
         
        
       
      
        \tilde{F}_{i}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1.0702em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord accent">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.9202em;">
              <span class="" style="top: -3em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="mord mathnormal" style="margin-right: 0.1389em;">
                F
               </span>
              </span>
              <span class="" style="top: -3.6023em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="accent-body" style="left: -0.1667em;">
                <span class="mord">
                 ~
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  i
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     。通过水平和垂直轴的全局池化，CFM捕获轴向上下文信息，使网络聚焦于前景区域，辅助后续原型学习识别最相关的类别特征。
    </p>
    <h3>
     <a id="Progressive_Prototype_Refinement_53">
     </a>
     Progressive Prototype Refinement
    </h3>
    <p>
     SAM 的性能依赖于精确提示，微小偏差即影响分割结果[1,13]。为此，我们引入两组原型：
    </p>
    <ul>
     <li>
      <strong>
       类内原型
      </strong>
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         P 
          
         
           intra 
          
         
        
          ∈ 
         
         
         
           R 
          
          
          
            N 
           
          
            × 
           
          
            C 
           
          
         
        
       
         P_{\text{intra}}\in \mathbb{R}^{N\times C}
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.1389em;">
            P
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3175em;">
               <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord text mtight">
                   <span class="mord mtight">
                    intra
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           ∈
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 0.8413em;">
          </span>
          <span class="mord">
           <span class="mord mathbb">
            R
           </span>
           <span class="msupsub">
            <span class="vlist-t">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.8413em;">
               <span class="" style="top: -3.063em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight" style="margin-right: 0.109em;">
                   N
                  </span>
                  <span class="mbin mtight">
                   ×
                  </span>
                  <span class="mord mathnormal mtight" style="margin-right: 0.0715em;">
                   C
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      （
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         N 
         
        
       
         N
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6833em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.109em;">
           N
          </span>
         </span>
        </span>
       </span>
      </span>
      为类别数）
     </li>
     <li>
      <strong>
       类间原型
      </strong>
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         P 
          
         
           inter 
          
         
        
          ∈ 
         
         
         
           R 
          
          
          
            Q 
           
          
            × 
           
          
            C 
           
          
         
        
       
         P_{\text{inter}}\in \mathbb{R}^{Q\times C}
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.1389em;">
            P
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3175em;">
               <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord text mtight">
                   <span class="mord mtight">
                    inter
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           ∈
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 0.8413em;">
          </span>
          <span class="mord">
           <span class="mord mathbb">
            R
           </span>
           <span class="msupsub">
            <span class="vlist-t">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.8413em;">
               <span class="" style="top: -3.063em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   Q
                  </span>
                  <span class="mbin mtight">
                   ×
                  </span>
                  <span class="mord mathnormal mtight" style="margin-right: 0.0715em;">
                   C
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      （
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         Q 
         
        
          = 
         
        
          α 
         
        
          × 
         
        
          N 
         
        
       
         Q=\alpha\times N
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.8778em; vertical-align: -0.1944em;">
          </span>
          <span class="mord mathnormal">
           Q
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 0.6667em; vertical-align: -0.0833em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0037em;">
           α
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           ×
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 0.6833em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.109em;">
           N
          </span>
         </span>
        </span>
       </span>
      </span>
      ,
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         α 
         
        
          = 
         
        
          8 
         
        
       
         \alpha=8
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.4306em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0037em;">
           α
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 0.6444em;">
          </span>
          <span class="mord">
           8
          </span>
         </span>
        </span>
       </span>
      </span>
      ）
     </li>
    </ul>
    <p>
     <strong>
      Step 1: 原型匹配
     </strong>
     <br/>
     计算
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        P 
         
        
          intra 
         
        
       
      
        P_{\text{intra}}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           P
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3175em;">
              <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord text mtight">
                  <span class="mord mtight">
                   intra
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     与
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        P 
         
        
          inter 
         
        
       
      
        P_{\text{inter}}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           P
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3175em;">
              <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord text mtight">
                  <span class="mord mtight">
                   inter
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     的余弦相似度，为每个类内原型选取top-k最相似的类间原型，拼接形成增强原型
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        P 
         
        
          ^ 
         
        
       
         ∈ 
        
        
        
          R 
         
         
         
           Q 
          
         
           × 
          
         
           C 
          
         
        
       
      
        \hat{P}\in \mathbb{R}^{Q\times C}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.9859em; vertical-align: -0.0391em;">
         </span>
         <span class="mord accent">
          <span class="vlist-t">
           <span class="vlist-r">
            <span class="vlist" style="height: 0.9468em;">
             <span class="" style="top: -3em;">
              <span class="pstrut" style="height: 3em;">
              </span>
              <span class="mord mathnormal" style="margin-right: 0.1389em;">
               P
              </span>
             </span>
             <span class="" style="top: -3.2523em;">
              <span class="pstrut" style="height: 3em;">
              </span>
              <span class="accent-body" style="left: -0.1667em;">
               <span class="mord">
                ^
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          ∈
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.8413em;">
         </span>
         <span class="mord">
          <span class="mord mathbb">
           R
          </span>
          <span class="msupsub">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.8413em;">
              <span class="" style="top: -3.063em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight">
                  Q
                 </span>
                 <span class="mbin mtight">
                  ×
                 </span>
                 <span class="mord mathnormal mtight" style="margin-right: 0.0715em;">
                  C
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     （
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        Q 
        
       
         = 
        
       
         N 
        
       
         × 
        
       
         ( 
        
       
         k 
        
       
         + 
        
       
         1 
        
       
         ) 
        
       
      
        Q=N\times(k+1)
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8778em; vertical-align: -0.1944em;">
         </span>
         <span class="mord mathnormal">
          Q
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          =
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.7667em; vertical-align: -0.0833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.109em;">
          N
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          ×
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0315em;">
          k
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          +
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord">
          1
         </span>
         <span class="mclose">
          )
         </span>
        </span>
       </span>
      </span>
     </span>
     ）。
    </p>
    <p>
     <strong>
      Step 2: 双路径交叉注意力
     </strong>
     <br/>
     设计
     <strong>
      类别引导双路径交叉注意力
     </strong>
     ，融合图像特征
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        F 
         
        
          I 
         
        
       
         ∈ 
        
        
        
          R 
         
         
         
           H 
          
         
           × 
          
         
           W 
          
         
           × 
          
         
           C 
          
         
        
       
      
        F_{I}\in \mathbb{R}^{H\times W\times C}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           F
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3283em;">
              <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight" style="margin-right: 0.0785em;">
                  I
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          ∈
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.8413em;">
         </span>
         <span class="mord">
          <span class="mord mathbb">
           R
          </span>
          <span class="msupsub">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.8413em;">
              <span class="" style="top: -3.063em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight" style="margin-right: 0.0813em;">
                  H
                 </span>
                 <span class="mbin mtight">
                  ×
                 </span>
                 <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                  W
                 </span>
                 <span class="mbin mtight">
                  ×
                 </span>
                 <span class="mord mathnormal mtight" style="margin-right: 0.0715em;">
                  C
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     与类别特征
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        F 
         
        
          M 
         
        
       
         ∈ 
        
        
        
          R 
         
         
         
           H 
          
         
           × 
          
         
           W 
          
         
           × 
          
         
           N 
          
         
        
       
      
        F_{M}\in \mathbb{R}^{H\times W\times N}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           F
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3283em;">
              <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight" style="margin-right: 0.109em;">
                  M
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          ∈
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.8413em;">
         </span>
         <span class="mord">
          <span class="mord mathbb">
           R
          </span>
          <span class="msupsub">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.8413em;">
              <span class="" style="top: -3.063em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mathnormal mtight" style="margin-right: 0.0813em;">
                  H
                 </span>
                 <span class="mbin mtight">
                  ×
                 </span>
                 <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                  W
                 </span>
                 <span class="mbin mtight">
                  ×
                 </span>
                 <span class="mord mathnormal mtight" style="margin-right: 0.109em;">
                  N
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     ：
    </p>
    <ol>
     <li>
      类别注意力权重
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         W 
          
         
           c 
          
         
        
       
         W_{c}
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.1389em;">
            W
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.1514em;">
               <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   c
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      计算：
      <br/>
      <span class="katex--display">
       <span class="katex-display">
        <span class="katex">
         <span class="katex-mathml">
          F 
           
          
            Θ 
           
           
           
             ′ 
            
           
             ′ 
            
           
          
         
           = 
          
         
           ζ 
          
          
          
            ( 
           
          
            reshape 
           
           
           
             ( 
            
           
             φ 
            
            
            
              ( 
             
             
             
               F 
              
             
               Θ 
              
             
            
              ) 
             
            
           
             ) 
            
           
          
            ) 
           
          
         
           , 
          
         
             
          
         
           Θ 
          
         
           ∈ 
          
         
           { 
          
         
           I 
          
         
           , 
          
         
           M 
          
         
           } 
          
          
         
           ( 
          
         
           3 
          
         
           ) 
          
         
        
          F_{\Theta}^{\prime\prime}=\zeta\left(\text{reshape}\left(\varphi\left(F_{\Theta}\right)\right)\right),\ \Theta\in\{I,M\} \qquad(3)
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 1.0489em; vertical-align: -0.247em;">
           </span>
           <span class="mord">
            <span class="mord mathnormal" style="margin-right: 0.1389em;">
             F
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.8019em;">
                <span class="" style="top: -2.453em; margin-left: -0.1389em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mtight">
                   <span class="mord mtight">
                    Θ
                   </span>
                  </span>
                 </span>
                </span>
                <span class="" style="top: -3.113em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mtight">
                   <span class="mord mtight">
                    ′′
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.247em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            =
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord mathnormal" style="margin-right: 0.0738em;">
            ζ
           </span>
           <span class="mspace" style="margin-right: 0.1667em;">
           </span>
           <span class="minner">
            <span class="mopen delimcenter" style="top: 0em;">
             (
            </span>
            <span class="mord text">
             <span class="mord">
              reshape
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.1667em;">
            </span>
            <span class="minner">
             <span class="mopen delimcenter" style="top: 0em;">
              (
             </span>
             <span class="mord mathnormal">
              φ
             </span>
             <span class="mspace" style="margin-right: 0.1667em;">
             </span>
             <span class="minner">
              <span class="mopen delimcenter" style="top: 0em;">
               (
              </span>
              <span class="mord">
               <span class="mord mathnormal" style="margin-right: 0.1389em;">
                F
               </span>
               <span class="msupsub">
                <span class="vlist-t vlist-t2">
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.3283em;">
                   <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                    <span class="pstrut" style="height: 2.7em;">
                    </span>
                    <span class="sizing reset-size6 size3 mtight">
                     <span class="mord mtight">
                      <span class="mord mtight">
                       Θ
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="vlist-s">
                   ​
                  </span>
                 </span>
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.15em;">
                   <span class="">
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="mclose delimcenter" style="top: 0em;">
               )
              </span>
             </span>
             <span class="mclose delimcenter" style="top: 0em;">
              )
             </span>
            </span>
            <span class="mclose delimcenter" style="top: 0em;">
             )
            </span>
           </span>
           <span class="mspace" style="margin-right: 0.1667em;">
           </span>
           <span class="mpunct">
            ,
           </span>
           <span class="mspace">
           </span>
           <span class="mspace" style="margin-right: 0.1667em;">
           </span>
           <span class="mord">
            Θ
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            ∈
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mopen">
            {
            <!-- -->
           </span>
           <span class="mord mathnormal" style="margin-right: 0.0785em;">
            I
           </span>
           <span class="mpunct">
            ,
           </span>
           <span class="mspace" style="margin-right: 0.1667em;">
           </span>
           <span class="mord mathnormal" style="margin-right: 0.109em;">
            M
           </span>
           <span class="mclose">
            }
           </span>
           <span class="mspace" style="margin-right: 2em;">
           </span>
           <span class="mopen">
            (
           </span>
           <span class="mord">
            3
           </span>
           <span class="mclose">
            )
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      <br/>
      <span class="katex--display">
       <span class="katex-display">
        <span class="katex">
         <span class="katex-mathml">
          W 
           
          
            c 
           
          
         
           = 
          
         
           softmax 
          
          
          
            ( 
           
          
            φ 
           
           
           
             ( 
            
            
            
              F 
             
            
              I 
             
             
             
               ′ 
              
             
               ′ 
              
             
            
           
             ⊗ 
            
            
            
              F 
             
            
              M 
             
             
             
               ′ 
              
             
               ′ 
              
             
            
           
             ) 
            
           
          
            ) 
           
          
          
         
           ( 
          
         
           4 
          
         
           ) 
          
         
        
          W_c=\text{softmax}\left(\varphi\left(F_I^{\prime\prime} \otimes F_M^{\prime\prime}\right)\right) \qquad(4)
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
           </span>
           <span class="mord">
            <span class="mord mathnormal" style="margin-right: 0.1389em;">
             W
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.1514em;">
                <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mathnormal mtight">
                   c
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.15em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            =
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1.0519em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             softmax
            </span>
           </span>
           <span class="mspace" style="margin-right: 0.1667em;">
           </span>
           <span class="minner">
            <span class="mopen delimcenter" style="top: 0em;">
             (
            </span>
            <span class="mord mathnormal">
             φ
            </span>
            <span class="mspace" style="margin-right: 0.1667em;">
            </span>
            <span class="minner">
             <span class="mopen delimcenter" style="top: 0em;">
              (
             </span>
             <span class="mord">
              <span class="mord mathnormal" style="margin-right: 0.1389em;">
               F
              </span>
              <span class="msupsub">
               <span class="vlist-t vlist-t2">
                <span class="vlist-r">
                 <span class="vlist" style="height: 0.8019em;">
                  <span class="" style="top: -2.453em; margin-left: -0.1389em; margin-right: 0.05em;">
                   <span class="pstrut" style="height: 2.7em;">
                   </span>
                   <span class="sizing reset-size6 size3 mtight">
                    <span class="mord mathnormal mtight" style="margin-right: 0.0785em;">
                     I
                    </span>
                   </span>
                  </span>
                  <span class="" style="top: -3.113em; margin-right: 0.05em;">
                   <span class="pstrut" style="height: 2.7em;">
                   </span>
                   <span class="sizing reset-size6 size3 mtight">
                    <span class="mord mtight">
                     <span class="mord mtight">
                      ′′
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="vlist-s">
                  ​
                 </span>
                </span>
                <span class="vlist-r">
                 <span class="vlist" style="height: 0.247em;">
                  <span class="">
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="mspace" style="margin-right: 0.2222em;">
             </span>
             <span class="mbin">
              ⊗
             </span>
             <span class="mspace" style="margin-right: 0.2222em;">
             </span>
             <span class="mord">
              <span class="mord mathnormal" style="margin-right: 0.1389em;">
               F
              </span>
              <span class="msupsub">
               <span class="vlist-t vlist-t2">
                <span class="vlist-r">
                 <span class="vlist" style="height: 0.8019em;">
                  <span class="" style="top: -2.453em; margin-left: -0.1389em; margin-right: 0.05em;">
                   <span class="pstrut" style="height: 2.7em;">
                   </span>
                   <span class="sizing reset-size6 size3 mtight">
                    <span class="mord mathnormal mtight" style="margin-right: 0.109em;">
                     M
                    </span>
                   </span>
                  </span>
                  <span class="" style="top: -3.113em; margin-right: 0.05em;">
                   <span class="pstrut" style="height: 2.7em;">
                   </span>
                   <span class="sizing reset-size6 size3 mtight">
                    <span class="mord mtight">
                     <span class="mord mtight">
                      ′′
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="vlist-s">
                  ​
                 </span>
                </span>
                <span class="vlist-r">
                 <span class="vlist" style="height: 0.247em;">
                  <span class="">
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="mclose delimcenter" style="top: 0em;">
              )
             </span>
            </span>
            <span class="mclose delimcenter" style="top: 0em;">
             )
            </span>
           </span>
           <span class="mspace" style="margin-right: 2em;">
           </span>
           <span class="mspace" style="margin-right: 0.1667em;">
           </span>
           <span class="mopen">
            (
           </span>
           <span class="mord">
            4
           </span>
           <span class="mclose">
            )
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </li>
     <li>
      查询生成：
      <br/>
      <span class="katex--display">
       <span class="katex-display">
        <span class="katex">
         <span class="katex-mathml">
          W 
               
              
                q 
               
              
             
            
            
             
              
               
              
                = 
               
              
                softmax 
               
              
                ( 
               
               
               
                 P 
                
               
                 ^ 
                
               
               
                
                
                  F 
                 
                
                  ^ 
                 
                
               
                 T 
                
               
              
                ) 
               
              
             
            
           
           
            
             
              
               
               
                 P 
                
               
                 ^ 
                
               
              
                ′ 
               
              
             
            
            
             
              
               
              
                = 
               
              
                ( 
               
              
                α 
               
              
                ⋅ 
               
               
               
                 W 
                
               
                 c 
                
               
              
                + 
               
              
                β 
               
              
                ⋅ 
               
               
               
                 W 
                
               
                 q 
                
               
              
                ) 
               
              
                ⊙ 
               
               
               
                 F 
                
               
                 ^ 
                
               
              
             
            
           
          
          
         
           ( 
          
         
           5 
          
         
           ) 
          
         
        
          \begin{align*} W_{q}&amp;=\text{softmax}(\hat{P}\hat{F}^{T}) \\ \hat{P}^{\prime}&amp;=(\alpha\cdot W_{c}+\beta\cdot W_{q})\odot\hat{F} \end{align*} \qquad(5)
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 3.2135em; vertical-align: -1.3568em;">
           </span>
           <span class="mord">
            <span class="mtable">
             <span class="col-align-r">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 1.8568em;">
                 <span class="" style="top: -3.91em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mord">
                    <span class="mord mathnormal" style="margin-right: 0.1389em;">
                     W
                    </span>
                    <span class="msupsub">
                     <span class="vlist-t vlist-t2">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.1514em;">
                        <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                         <span class="pstrut" style="height: 2.7em;">
                         </span>
                         <span class="sizing reset-size6 size3 mtight">
                          <span class="mord mtight">
                           <span class="mord mathnormal mtight" style="margin-right: 0.0359em;">
                            q
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                       <span class="vlist-s">
                        ​
                       </span>
                      </span>
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.2861em;">
                        <span class="">
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="" style="top: -2.3032em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mord">
                    <span class="mord accent">
                     <span class="vlist-t">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.9468em;">
                        <span class="" style="top: -3em;">
                         <span class="pstrut" style="height: 3em;">
                         </span>
                         <span class="mord mathnormal" style="margin-right: 0.1389em;">
                          P
                         </span>
                        </span>
                        <span class="" style="top: -3.2523em;">
                         <span class="pstrut" style="height: 3em;">
                         </span>
                         <span class="accent-body" style="left: -0.1667em;">
                          <span class="mord">
                           ^
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                    <span class="msupsub">
                     <span class="vlist-t">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.8019em;">
                        <span class="" style="top: -3.113em; margin-right: 0.05em;">
                         <span class="pstrut" style="height: 2.7em;">
                         </span>
                         <span class="sizing reset-size6 size3 mtight">
                          <span class="mord mtight">
                           <span class="mord mtight">
                            ′
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 1.3568em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="col-align-l">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 1.8568em;">
                 <span class="" style="top: -3.91em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mord">
                   </span>
                   <span class="mspace" style="margin-right: 0.2778em;">
                   </span>
                   <span class="mrel">
                    =
                   </span>
                   <span class="mspace" style="margin-right: 0.2778em;">
                   </span>
                   <span class="mord text">
                    <span class="mord">
                     softmax
                    </span>
                   </span>
                   <span class="mopen">
                    (
                   </span>
                   <span class="mord accent">
                    <span class="vlist-t">
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.9468em;">
                       <span class="" style="top: -3em;">
                        <span class="pstrut" style="height: 3em;">
                        </span>
                        <span class="mord mathnormal" style="margin-right: 0.1389em;">
                         P
                        </span>
                       </span>
                       <span class="" style="top: -3.2523em;">
                        <span class="pstrut" style="height: 3em;">
                        </span>
                        <span class="accent-body" style="left: -0.1667em;">
                         <span class="mord">
                          ^
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="mord">
                    <span class="mord accent">
                     <span class="vlist-t">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.9468em;">
                        <span class="" style="top: -3em;">
                         <span class="pstrut" style="height: 3em;">
                         </span>
                         <span class="mord mathnormal" style="margin-right: 0.1389em;">
                          F
                         </span>
                        </span>
                        <span class="" style="top: -3.2523em;">
                         <span class="pstrut" style="height: 3em;">
                         </span>
                         <span class="accent-body" style="left: -0.1667em;">
                          <span class="mord">
                           ^
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                    <span class="msupsub">
                     <span class="vlist-t">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.8913em;">
                        <span class="" style="top: -3.113em; margin-right: 0.05em;">
                         <span class="pstrut" style="height: 2.7em;">
                         </span>
                         <span class="sizing reset-size6 size3 mtight">
                          <span class="mord mtight">
                           <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                            T
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="mclose">
                    )
                   </span>
                  </span>
                 </span>
                 <span class="" style="top: -2.3032em;">
                  <span class="pstrut" style="height: 3em;">
                  </span>
                  <span class="mord">
                   <span class="mord">
                   </span>
                   <span class="mspace" style="margin-right: 0.2778em;">
                   </span>
                   <span class="mrel">
                    =
                   </span>
                   <span class="mspace" style="margin-right: 0.2778em;">
                   </span>
                   <span class="mopen">
                    (
                   </span>
                   <span class="mord mathnormal" style="margin-right: 0.0037em;">
                    α
                   </span>
                   <span class="mspace" style="margin-right: 0.2222em;">
                   </span>
                   <span class="mbin">
                    ⋅
                   </span>
                   <span class="mspace" style="margin-right: 0.2222em;">
                   </span>
                   <span class="mord">
                    <span class="mord mathnormal" style="margin-right: 0.1389em;">
                     W
                    </span>
                    <span class="msupsub">
                     <span class="vlist-t vlist-t2">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.1514em;">
                        <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                         <span class="pstrut" style="height: 2.7em;">
                         </span>
                         <span class="sizing reset-size6 size3 mtight">
                          <span class="mord mtight">
                           <span class="mord mathnormal mtight">
                            c
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                       <span class="vlist-s">
                        ​
                       </span>
                      </span>
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.15em;">
                        <span class="">
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="mspace" style="margin-right: 0.2222em;">
                   </span>
                   <span class="mbin">
                    +
                   </span>
                   <span class="mspace" style="margin-right: 0.2222em;">
                   </span>
                   <span class="mord mathnormal" style="margin-right: 0.0528em;">
                    β
                   </span>
                   <span class="mspace" style="margin-right: 0.2222em;">
                   </span>
                   <span class="mbin">
                    ⋅
                   </span>
                   <span class="mspace" style="margin-right: 0.2222em;">
                   </span>
                   <span class="mord">
                    <span class="mord mathnormal" style="margin-right: 0.1389em;">
                     W
                    </span>
                    <span class="msupsub">
                     <span class="vlist-t vlist-t2">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.1514em;">
                        <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                         <span class="pstrut" style="height: 2.7em;">
                         </span>
                         <span class="sizing reset-size6 size3 mtight">
                          <span class="mord mtight">
                           <span class="mord mathnormal mtight" style="margin-right: 0.0359em;">
                            q
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                       <span class="vlist-s">
                        ​
                       </span>
                      </span>
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.2861em;">
                        <span class="">
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="mclose">
                    )
                   </span>
                   <span class="mspace" style="margin-right: 0.2222em;">
                   </span>
                   <span class="mbin">
                    ⊙
                   </span>
                   <span class="mspace" style="margin-right: 0.2222em;">
                   </span>
                   <span class="mord accent">
                    <span class="vlist-t">
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.9468em;">
                       <span class="" style="top: -3em;">
                        <span class="pstrut" style="height: 3em;">
                        </span>
                        <span class="mord mathnormal" style="margin-right: 0.1389em;">
                         F
                        </span>
                       </span>
                       <span class="" style="top: -3.2523em;">
                        <span class="pstrut" style="height: 3em;">
                        </span>
                        <span class="accent-body" style="left: -0.1667em;">
                         <span class="mord">
                          ^
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 1.3568em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mspace" style="margin-right: 2em;">
           </span>
           <span class="mopen">
            (
           </span>
           <span class="mord">
            5
           </span>
           <span class="mclose">
            )
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      <br/>
      其中
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         F 
          
         
           ^ 
          
         
        
       
         \hat{F}
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.9468em;">
          </span>
          <span class="mord accent">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.9468em;">
              <span class="" style="top: -3em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="mord mathnormal" style="margin-right: 0.1389em;">
                F
               </span>
              </span>
              <span class="" style="top: -3.2523em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="accent-body" style="left: -0.1667em;">
                <span class="mord">
                 ^
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      为
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         F 
          
         
           I 
          
         
        
       
         F_I
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.1389em;">
            F
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3283em;">
               <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mathnormal mtight" style="margin-right: 0.0785em;">
                  I
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      与
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         F 
          
         
           M 
          
         
        
       
         F_M
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.1389em;">
            F
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3283em;">
               <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mathnormal mtight" style="margin-right: 0.109em;">
                  M
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      融合后的特征。
     </li>
    </ol>
    <p>
     <strong>
      Step 3: 原型更新
     </strong>
     <br/>
     将
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        P 
          
         
           ^ 
          
         
        
          ′ 
         
        
       
      
        \hat{P}^{\prime}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.9468em;">
         </span>
         <span class="mord">
          <span class="mord accent">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.9468em;">
              <span class="" style="top: -3em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="mord mathnormal" style="margin-right: 0.1389em;">
                P
               </span>
              </span>
              <span class="" style="top: -3.2523em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="accent-body" style="left: -0.1667em;">
                <span class="mord">
                 ^
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="msupsub">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.7519em;">
              <span class="" style="top: -3.063em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord mtight">
                  ′
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     重塑为
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        N 
        
       
         × 
        
       
         ( 
        
       
         k 
        
       
         + 
        
       
         1 
        
       
         ) 
        
       
         × 
        
       
         C 
        
       
      
        N\times(k+1)\times C
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.7667em; vertical-align: -0.0833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.109em;">
          N
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          ×
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0315em;">
          k
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          +
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord">
          1
         </span>
         <span class="mclose">
          )
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          ×
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0715em;">
          C
         </span>
        </span>
       </span>
      </span>
     </span>
     ，分离得到更新后的类内原型
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        P 
          
         
           ^ 
          
         
        
          intra 
         
        
       
      
        \hat{P}_{\text{intra}}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1.0968em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord accent">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.9468em;">
              <span class="" style="top: -3em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="mord mathnormal" style="margin-right: 0.1389em;">
                P
               </span>
              </span>
              <span class="" style="top: -3.2523em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="accent-body" style="left: -0.1667em;">
                <span class="mord">
                 ^
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3175em;">
              <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord text mtight">
                  <span class="mord mtight">
                   intra
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     和类间原型
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        P 
          
         
           ^ 
          
         
        
          inter 
         
        
       
      
        \hat{P}_{\text{inter}}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1.0968em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord accent">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.9468em;">
              <span class="" style="top: -3em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="mord mathnormal" style="margin-right: 0.1389em;">
                P
               </span>
              </span>
              <span class="" style="top: -3.2523em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="accent-body" style="left: -0.1667em;">
                <span class="mord">
                 ^
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3175em;">
              <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 <span class="mord text mtight">
                  <span class="mord mtight">
                   inter
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     ，通过索引匹配更新原始原型库。
    </p>
    <h3>
     <a id="Prototypebased_Prompt_Generator_76">
     </a>
     Prototype-based Prompt Generator
    </h3>
    <p>
     为避免信息混淆，我们为密集提示和稀疏提示设计独立生成路径：
    </p>
    <p>
     <strong>
      密集提示生成
     </strong>
     <br/>
     通过类间原型与查询交互生成：
     <br/>
     <span class="katex--display">
      <span class="katex-display">
       <span class="katex">
        <span class="katex-mathml">
         D 
         
        
          = 
         
        
          MLP 
         
        
          ( 
         
        
          softmax 
         
        
          ( 
         
         
         
           F 
          
         
           I 
          
         
        
          ⋅ 
         
         
          
          
            P 
           
          
            ^ 
           
          
         
           inter 
          
         
           T 
          
         
        
          ) 
         
        
          ⋅ 
         
         
          
          
            P 
           
          
            ^ 
           
          
         
           inter 
          
         
        
          ) 
         
         
        
          ( 
         
        
          6 
         
        
          ) 
         
        
       
         D=\text{MLP}(\text{softmax}(F_{I}\cdot\hat{P}_{\text{inter}}^{T})\cdot\hat{P}_{\text{inter}}) \qquad(6)
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6833em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0278em;">
           D
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord text">
           <span class="mord">
            MLP
           </span>
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord text">
           <span class="mord">
            softmax
           </span>
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.1389em;">
            F
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3283em;">
               <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight" style="margin-right: 0.0785em;">
                   I
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           ⋅
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1.1968em; vertical-align: -0.25em;">
          </span>
          <span class="mord">
           <span class="mord accent">
            <span class="vlist-t">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.9468em;">
               <span class="" style="top: -3em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="mord mathnormal" style="margin-right: 0.1389em;">
                 P
                </span>
               </span>
               <span class="" style="top: -3.2523em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="accent-body" style="left: -0.1667em;">
                 <span class="mord">
                  ^
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.8913em;">
               <span class="" style="top: -2.453em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord text mtight">
                   <span class="mord mtight">
                    inter
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="" style="top: -3.113em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                   T
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.247em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose">
           )
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           ⋅
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1.1968em; vertical-align: -0.25em;">
          </span>
          <span class="mord">
           <span class="mord accent">
            <span class="vlist-t">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.9468em;">
               <span class="" style="top: -3em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="mord mathnormal" style="margin-right: 0.1389em;">
                 P
                </span>
               </span>
               <span class="" style="top: -3.2523em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="accent-body" style="left: -0.1667em;">
                 <span class="mord">
                  ^
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3175em;">
               <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord text mtight">
                   <span class="mord mtight">
                    inter
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose">
           )
          </span>
          <span class="mspace" style="margin-right: 2em;">
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord">
           6
          </span>
          <span class="mclose">
           )
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     <br/>
     其中MLP包含两个点卷积层与GELU激活函数。
    </p>
    <p>
     <strong>
      稀疏提示生成
     </strong>
     <br/>
     通过类内原型与特征交互生成：
     <br/>
     <span class="katex--display">
      <span class="katex-display">
       <span class="katex">
        <span class="katex-mathml">
         S 
         
        
          = 
         
        
          MLP 
         
        
          ( 
         
        
          softmax 
         
        
          ( 
         
         
          
          
            P 
           
          
            ^ 
           
          
         
           intra 
          
         
           T 
          
         
        
          ⋅ 
         
         
         
           F 
          
         
           I 
          
         
        
          ) 
         
        
          ⋅ 
         
         
         
           F 
          
         
           I 
          
         
        
          ) 
         
         
        
          ( 
         
        
          7 
         
        
          ) 
         
        
       
         S=\text{MLP}(\text{softmax}(\hat{P}_{\text{intra}}^{T}\cdot F_{I})\cdot F_{I}) \qquad(7)
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6833em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0576em;">
           S
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1.1968em; vertical-align: -0.25em;">
          </span>
          <span class="mord text">
           <span class="mord">
            MLP
           </span>
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord text">
           <span class="mord">
            softmax
           </span>
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord">
           <span class="mord accent">
            <span class="vlist-t">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.9468em;">
               <span class="" style="top: -3em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="mord mathnormal" style="margin-right: 0.1389em;">
                 P
                </span>
               </span>
               <span class="" style="top: -3.2523em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="accent-body" style="left: -0.1667em;">
                 <span class="mord">
                  ^
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.8913em;">
               <span class="" style="top: -2.453em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord text mtight">
                   <span class="mord mtight">
                    intra
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="" style="top: -3.113em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                   T
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.247em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           ⋅
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.1389em;">
            F
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3283em;">
               <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight" style="margin-right: 0.0785em;">
                   I
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose">
           )
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           ⋅
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.1389em;">
            F
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3283em;">
               <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight" style="margin-right: 0.0785em;">
                   I
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose">
           )
          </span>
          <span class="mspace" style="margin-right: 2em;">
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord">
           7
          </span>
          <span class="mclose">
           )
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <p>
     双路径设计使提示生成过程既能捕获局部细节（密集提示），又能保持类别区分度（稀疏提示）。
    </p>
    <hr/>
    <h2>
     <a id="Experiment_91">
     </a>
     Experiment
    </h2>
    <p>
     本节通过在两个分割任务上的实验评估
     <strong>
      PGP-SAM
     </strong>
     的性能，与现有 SAM 变体进行对比，并通过消融实验分析模块贡献。
    </p>
    <h3>
     <a id="Datasets_93">
     </a>
     Datasets
    </h3>
    <p>
     我们在公开的 Synapse 多器官 CT 数据集和私有脑室 CT 数据集上进行多器官分割实验：
    </p>
    <ul>
     <li>
      Synapse数据集：包含18个训练案例和12个测试案例，每个案例约含70个有效切片
     </li>
     <li>
      脑室数据集：包含400个训练案例和100个测试案例，每个案例约含10个有效切片
     </li>
    </ul>
    <p>
     所有数据在少样本训练中均调整为 512×512 分辨率。
    </p>
    <h3>
     <a id="Implementation_Details_99">
     </a>
     Implementation Details
    </h3>
    <p>
     所有模型在单张 RTX 3090 GPU 上训练，采用数据增强策略（弹性形变、旋转、缩放）。损失函数为交叉熵损失与 Dice 损失的加权组合。我们使用 LoRA 配置（rank=4）对 ViT-b 模型进行微调，优化器选择 AdamW（初始学习率 3e-4，权重衰减 1e-4），训练 50 个 epoch，批量大小为 8。
    </p>
    <h3>
     <a id="Results_and_Analysis_101">
     </a>
     Results and Analysis
    </h3>
    <p>
     表1和表2分别展示了在Synapse和脑室数据集上的定量结果（Dice系数%）：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d38a4b000e4848b58b2d2584a38e7b9e.png#pic_center" width="800">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f1b2112e28774a21aade795c8fdf20b5.png#pic_center" width="700"/>
     </img>
    </p>
    <p>
     关键结论：
    </p>
    <ul>
     <li>
      PGP-SAM 在两类数据集上均取得最优 Dice 系数（Synapse: 78.75% vs 73.91%；脑室: 76.39% vs 73.36%）
     </li>
     <li>
      对复杂器官（如胰腺、第三脑室）提升显著（Synapse 胰腺提升 11.29%，脑室第三脑室提升 3.23%）
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/bf64ffb19e0945969d77b1f71efc7cb5.png#pic_center" width="600"/>
    </p>
    <h3>
     <a id="Ablation_Study_115">
     </a>
     Ablation Study
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1aff3cf07dd7407cb1657a3526d586d4.png#pic_center" width="300"/>
    </p>
    <hr/>
    <h2>
     <a id="_120">
     </a>
     总结
    </h2>
    <p>
     本文提出了一种基于原型引导的高效少样本医学图像分割方法PGP-SAM。通过设计上下文特征调制模块（CFM）和渐进式原型优化机制（PPR），我们实现了以下突破：
    </p>
    <ul>
     <li>
      高效上下文融合：CFM模块通过空间-通道双路径调制，使模型在有限数据下有效捕获全局语义信息，相比基线模型（71.92% Dice）提升6.83%。
     </li>
     <li>
      精准提示生成：通过类内/类间原型交互，自动生成的密集与稀疏提示在Synapse和脑室数据集上分别达到78.75%和76.39% Dice，显著优于SAMed（73.91%/73.36%）。
     </li>
     <li>
      低参数量适配：仅需微调0.8M参数（占SAM总参数0.6%），即实现跨数据集的稳定性能提升。
     </li>
    </ul>
    <p>
     实验结果表明，PGP-SAM在复杂解剖结构（如胰腺、第三脑室）的分割任务中展现出更强的鲁棒性。未来工作将探索：
    </p>
    <ul>
     <li>
      三维体积数据中的原型传递机制；
     </li>
     <li>
      多模态医学图像的原型统一表示学习。
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f486f7261636559616e2f:61727469636c652f64657461696c732f313436323538343836" class_="artid" style="display:none">
 </p>
</div>


