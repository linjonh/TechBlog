---
layout: post
title: "32单片机KEY"
date: 2025-03-12 14:07:43 +0800
description: "KEY0、KEY1和KEY2是低电平有效的，而KEY_UP则是高电平有效的，并且外部都没有上下拉电阻，所以需要在STM32F103内部设置上下拉，来确定设置空闲电平状态。"
keywords: "32单片机——KEY"
categories: ['未分类']
tags: ['嵌入式硬件', '单片机']
artid: "146188514"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146188514
    alt: "32单片机KEY"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146188514
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146188514
cover: https://bing.ee123.net/img/rand?artid=146188514
image: https://bing.ee123.net/img/rand?artid=146188514
img: https://bing.ee123.net/img/rand?artid=146188514
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     32单片机——KEY
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p style="text-align:center">
     <img alt="" height="273" src="https://i-blog.csdnimg.cn/direct/646991106dd04946b091e6c55bce9fef.png" width="347"/>
    </p>
    <p>
     KEY0、KEY1和KEY2是低电平有效的，而KEY_UP则是高电平有效的，并且外部都没有上下拉电阻，所以需要在STM32F103内部设置上下拉，来确定设置空闲电平状态
    </p>
    <h2>
     代码
    </h2>
    <p>
     通过开发板上的三个独立按键控制LED灯：KEY_UP控制蜂鸣器翻转，KEY1控制LED1翻转，KEY2控制LED0翻转，KEY0控制LED0/LED1同时翻转
    </p>
    <h3>
     led.h
    </h3>
    <blockquote>
     <p>
      #ifndef _LED_H
      <br/>
      #define _LED_H
      <br/>
      //led初始化
      <br/>
      void led_init(void);
      <br/>
      #endif
     </p>
     <p>
     </p>
    </blockquote>
    <h3>
     led.c
    </h3>
    <blockquote>
     <p>
      #include "./BSP/LED/led.h"
      <br/>
      #include "./SYSTEM/sys/sys.h"
      <br/>
      //led初始化
     </p>
     <p>
      void led_init(void){
      <!-- -->
      <br/>
      GPIO_InitTypeDef g_gppio_struct;
      <br/>
      __HAL_RCC_GPIOE_CLK_ENABLE();  //使能时钟--PE5
      <br/>
      __HAL_RCC_GPIOB_CLK_ENABLE();  //使能时钟--PB5
      <br/>
      <br/>
      g_gppio_struct.Pin=GPIO_PIN_5;
      <br/>
      g_gppio_struct.Mode=GPIO_MODE_OUTPUT_PP;  //推挽输出
      <br/>
      g_gppio_struct.Pull=GPIO_NOPULL;  //无上下拉
      <br/>
      g_gppio_struct.Speed=GPIO_SPEED_FREQ_HIGH;  //高速
      <br/>
      HAL_GPIO_Init(GPIOE,&amp;g_gppio_struct);  //初始化LED1
      <br/>
      <br/>
      g_gppio_struct.Pin=GPIO_PIN_5;
      <br/>
      g_gppio_struct.Mode=GPIO_MODE_OUTPUT_PP;  //推挽输出
      <br/>
      g_gppio_struct.Pull=GPIO_NOPULL;  //无上下拉
      <br/>
      g_gppio_struct.Speed=GPIO_SPEED_FREQ_HIGH;  //高速
      <br/>
      HAL_GPIO_Init(GPIOB,&amp;g_gppio_struct);  //初始化LED0
      <br/>
      }
     </p>
     <p>
     </p>
    </blockquote>
    <h3>
     beep.h
    </h3>
    <blockquote>
     <p>
      #ifndef _BEEP_H
      <br/>
      #define _BEEP_H
      <br/>
      #include "./SYSTEM/sys/sys.h"
      <br/>
      //beep初始化
      <br/>
      void beep_init(void);
      <br/>
      void set_beep(uint8_t flag);
      <br/>
      #endif
     </p>
     <p>
     </p>
    </blockquote>
    <h3>
     beep.c
    </h3>
    <blockquote>
     <p>
      #include "./BSP/BEEP/beep.h"
      <br/>
      //beep初始化
      <br/>
      void beep_init(void){
      <!-- -->
      <br/>
      GPIO_InitTypeDef g_gppio_struct;
      <br/>
      __HAL_RCC_GPIOB_CLK_ENABLE();  //使能beepIO口时钟
      <br/>
      <br/>
      g_gppio_struct.Pin=GPIO_PIN_8;  //引脚号
      <br/>
      g_gppio_struct.Mode=GPIO_MODE_OUTPUT_PP;  //推挽输出
      <br/>
      g_gppio_struct.Pull=GPIO_NOPULL;  //没有上下拉
      <br/>
      g_gppio_struct.Speed=GPIO_SPEED_FREQ_HIGH;  //高速
      <br/>
      HAL_GPIO_Init(GPIOB,&amp;g_gppio_struct);
      <br/>
      }
      <br/>
      void set_beep(uint8_t flag){
      <!-- -->
      <br/>
      if(flag){
      <!-- -->
      <br/>
      HAL_GPIO_WritePin(GPIOB,GPIO_PIN_8,GPIO_PIN_SET);
      <br/>
      }else{
      <!-- -->
      <br/>
      HAL_GPIO_WritePin(GPIOB,GPIO_PIN_8,GPIO_PIN_RESET);
      <br/>
      }
      <br/>
      }
     </p>
     <p>
     </p>
    </blockquote>
    <h3>
     key.h
    </h3>
    <blockquote>
     <p>
      #ifndef _KEY_H
      <br/>
      #define _KEY_H
      <br/>
      #include "./SYSTEM/sys/sys.h"
      <br/>
      #include "./SYSTEM/delay/delay.h"
      <br/>
      #define KEY0 HAL_GPIO_ReadPin(GPIOE,GPIO_PIN_4)
      <br/>
      #define KEY1 HAL_GPIO_ReadPin(GPIOE,GPIO_PIN_3)
      <br/>
      #define KEY2 HAL_GPIO_ReadPin(GPIOE,GPIO_PIN_2)
      <br/>
      #define KEY_UP HAL_GPIO_ReadPin(GPIOA,GPIO_PIN_0)
      <br/>
      //key初始化
      <br/>
      void key_init(void);
      <br/>
      //按键扫描函数
      <br/>
      uint8_t scan(uint8_t mode);
      <br/>
      #endif
     </p>
     <p>
     </p>
    </blockquote>
    <h3>
     key.c
    </h3>
    <blockquote>
     <p>
      #include "./BSP/KEY/key.h"
      <br/>
      //key初始化
      <br/>
      /*
      <br/>
      KEY0----PE4----输入上拉
      <br/>
      KEY1----PE3----输入上拉
      <br/>
      KEY2----PE2----输入上拉
      <br/>
      KEY_UP----PA0----输入下拉
      <br/>
      */
      <br/>
      void key_init(void){
      <!-- -->
      <br/>
      GPIO_InitTypeDef g_key_struct;
      <br/>
      //时钟使能
      <br/>
      __HAL_RCC_GPIOE_CLK_ENABLE();
      <br/>
      __HAL_RCC_GPIOA_CLK_ENABLE();
      <br/>
      //KEY0
      <br/>
      g_key_struct.Pin=GPIO_PIN_4;
      <br/>
      g_key_struct.Mode=GPIO_MODE_INPUT;  //输入模式
      <br/>
      g_key_struct.Pull=GPIO_PULLUP;  //上拉
      <br/>
      g_key_struct.Speed=GPIO_SPEED_FREQ_HIGH;  //高速
      <br/>
      HAL_GPIO_Init(GPIOE,&amp;g_key_struct);
      <br/>
      //KEY1
      <br/>
      g_key_struct.Pin=GPIO_PIN_3;
      <br/>
      HAL_GPIO_Init(GPIOE,&amp;g_key_struct);
      <br/>
      //KEY2
      <br/>
      g_key_struct.Pin=GPIO_PIN_2;
      <br/>
      HAL_GPIO_Init(GPIOE,&amp;g_key_struct);
      <br/>
      //KEY_UP
      <br/>
      g_key_struct.Pin=GPIO_PIN_0;
      <br/>
      g_key_struct.Pull=GPIO_PULLDOWN;  //下拉
      <br/>
      HAL_GPIO_Init(GPIOA,&amp;g_key_struct);
      <br/>
      }
      <br/>
      //按键扫描函数
      <br/>
      uint8_t scan(uint8_t mode){
      <!-- -->
      <br/>
      static uint8_t key_up = 1; /*按键按松开标志*/
      <br/>
      uint8_t keyval= 0;
      <br/>
      if (mode)key_up = 1; /*支持连按*/
      <br/>
      if (key_up &amp;&amp; ( KEY0 == 0 ||KEY1 == 0 ||KEY2 == 0 ||KEY_UP == 1)){ /*按键松开标志为1,且有任意一个按键按下了*/
      <br/>
      delay_ms(20);  /*去抖动*/
      <br/>
      key_up = 0;
      <br/>
      if (KEY0== 0) keyval=1;
      <br/>
      if (KEY1== 0) keyval=2;
     </p>
     <p>
      if (KEY2== 0) keyval=3;
      <br/>
      if (KEY_UP== 1) keyval=4;
      <br/>
      }else if (KEY0== 1 &amp;&amp; KEY1 == 1 &amp;&amp; KEY2 == 1 &amp;&amp; KEY_UP == 0){ /*没有任何按键按下,标记按键松开*/
      <br/>
      key_up = 1;
      <br/>
      }
      <br/>
      return keyval; /*返回键值*/
      <br/>
      }
     </p>
    </blockquote>
    <h3>
     main.c
    </h3>
    <blockquote>
     <p>
      #include "./SYSTEM/sys/sys.h"
      <br/>
      #include "./SYSTEM/delay/delay.h"
      <br/>
      #include "./BSP/LED/led.h"
      <br/>
      #include "./BSP/BEEP/beep.h"
     </p>
     <p>
      int main(void){
      <!-- -->
      <br/>
      HAL_Init();
      <br/>
      sys_stm32_clock_init(RCC_PLL_MUL9);
      <br/>
      delay_init(72);
      <br/>
      led_init();
      <br/>
      beep_init();
      <br/>
      while(1){
      <!-- -->
      <br/>
      set_beep(1);
      <br/>
      HAL_GPIO_WritePin(GPIOB,GPIO_PIN_5,GPIO_PIN_SET);  //熄灭
      <br/>
      HAL_Delay(2000);
      <br/>
      set_beep(0);
      <br/>
      HAL_GPIO_WritePin(GPIOB,GPIO_PIN_5,GPIO_PIN_RESET);  //点亮
      <br/>
      HAL_Delay(2000);
      <br/>
      }
      <br/>
      }
     </p>
     <p>
     </p>
    </blockquote>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f38313639393239382f:61727469636c652f64657461696c732f313436313838353134" class_="artid" style="display:none">
 </p>
</div>


