---
arturl_encode: "68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f38313639393239382f:61727469636c652f64657461696c732f313436313838353134"
layout: post
title: "32单片机KEY"
date: 2025-03-12 14:07:43 +0800
description: "KEY0、KEY1和KEY2是低电平有效的，而KEY_UP则是高电平有效的，并且外部都没有上下拉电阻，所以需要在STM32F103内部设置上下拉，来确定设置空闲电平状态。"
keywords: "32单片机——KEY"
categories: ['未分类']
tags: ['嵌入式硬件', '单片机']
artid: "146188514"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146188514
    alt: "32单片机KEY"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146188514
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146188514
cover: https://bing.ee123.net/img/rand?artid=146188514
image: https://bing.ee123.net/img/rand?artid=146188514
img: https://bing.ee123.net/img/rand?artid=146188514
---

# 32单片机——KEY

![](https://i-blog.csdnimg.cn/direct/646991106dd04946b091e6c55bce9fef.png)

KEY0、KEY1和KEY2是低电平有效的，而KEY\_UP则是高电平有效的，并且外部都没有上下拉电阻，所以需要在STM32F103内部设置上下拉，来确定设置空闲电平状态

## 代码

通过开发板上的三个独立按键控制LED灯：KEY\_UP控制蜂鸣器翻转，KEY1控制LED1翻转，KEY2控制LED0翻转，KEY0控制LED0/LED1同时翻转

### led.h

> #ifndef \_LED\_H
>   
> #define \_LED\_H
>   
> //led初始化
>   
> void led\_init(void);
>   
> #endif

### led.c

> #include "./BSP/LED/led.h"
>   
> #include "./SYSTEM/sys/sys.h"
>   
> //led初始化
>
> void led\_init(void){
>   
> GPIO\_InitTypeDef g\_gppio\_struct;
>   
> \_\_HAL\_RCC\_GPIOE\_CLK\_ENABLE();  //使能时钟--PE5
>   
> \_\_HAL\_RCC\_GPIOB\_CLK\_ENABLE();  //使能时钟--PB5
>   
>   
> g\_gppio\_struct.Pin=GPIO\_PIN\_5;
>   
> g\_gppio\_struct.Mode=GPIO\_MODE\_OUTPUT\_PP;  //推挽输出
>   
> g\_gppio\_struct.Pull=GPIO\_NOPULL;  //无上下拉
>   
> g\_gppio\_struct.Speed=GPIO\_SPEED\_FREQ\_HIGH;  //高速
>   
> HAL\_GPIO\_Init(GPIOE,&g\_gppio\_struct);  //初始化LED1
>   
>   
> g\_gppio\_struct.Pin=GPIO\_PIN\_5;
>   
> g\_gppio\_struct.Mode=GPIO\_MODE\_OUTPUT\_PP;  //推挽输出
>   
> g\_gppio\_struct.Pull=GPIO\_NOPULL;  //无上下拉
>   
> g\_gppio\_struct.Speed=GPIO\_SPEED\_FREQ\_HIGH;  //高速
>   
> HAL\_GPIO\_Init(GPIOB,&g\_gppio\_struct);  //初始化LED0
>   
> }

### beep.h

> #ifndef \_BEEP\_H
>   
> #define \_BEEP\_H
>   
> #include "./SYSTEM/sys/sys.h"
>   
> //beep初始化
>   
> void beep\_init(void);
>   
> void set\_beep(uint8\_t flag);
>   
> #endif

### beep.c

> #include "./BSP/BEEP/beep.h"
>   
> //beep初始化
>   
> void beep\_init(void){
>   
> GPIO\_InitTypeDef g\_gppio\_struct;
>   
> \_\_HAL\_RCC\_GPIOB\_CLK\_ENABLE();  //使能beepIO口时钟
>   
>   
> g\_gppio\_struct.Pin=GPIO\_PIN\_8;  //引脚号
>   
> g\_gppio\_struct.Mode=GPIO\_MODE\_OUTPUT\_PP;  //推挽输出
>   
> g\_gppio\_struct.Pull=GPIO\_NOPULL;  //没有上下拉
>   
> g\_gppio\_struct.Speed=GPIO\_SPEED\_FREQ\_HIGH;  //高速
>   
> HAL\_GPIO\_Init(GPIOB,&g\_gppio\_struct);
>   
> }
>   
> void set\_beep(uint8\_t flag){
>   
> if(flag){
>   
> HAL\_GPIO\_WritePin(GPIOB,GPIO\_PIN\_8,GPIO\_PIN\_SET);
>   
> }else{
>   
> HAL\_GPIO\_WritePin(GPIOB,GPIO\_PIN\_8,GPIO\_PIN\_RESET);
>   
> }
>   
> }

### key.h

> #ifndef \_KEY\_H
>   
> #define \_KEY\_H
>   
> #include "./SYSTEM/sys/sys.h"
>   
> #include "./SYSTEM/delay/delay.h"
>   
> #define KEY0 HAL\_GPIO\_ReadPin(GPIOE,GPIO\_PIN\_4)
>   
> #define KEY1 HAL\_GPIO\_ReadPin(GPIOE,GPIO\_PIN\_3)
>   
> #define KEY2 HAL\_GPIO\_ReadPin(GPIOE,GPIO\_PIN\_2)
>   
> #define KEY\_UP HAL\_GPIO\_ReadPin(GPIOA,GPIO\_PIN\_0)
>   
> //key初始化
>   
> void key\_init(void);
>   
> //按键扫描函数
>   
> uint8\_t scan(uint8\_t mode);
>   
> #endif

### key.c

> #include "./BSP/KEY/key.h"
>   
> //key初始化
>   
> /\*
>   
> KEY0----PE4----输入上拉
>   
> KEY1----PE3----输入上拉
>   
> KEY2----PE2----输入上拉
>   
> KEY\_UP----PA0----输入下拉
>   
> \*/
>   
> void key\_init(void){
>   
> GPIO\_InitTypeDef g\_key\_struct;
>   
> //时钟使能
>   
> \_\_HAL\_RCC\_GPIOE\_CLK\_ENABLE();
>   
> \_\_HAL\_RCC\_GPIOA\_CLK\_ENABLE();
>   
> //KEY0
>   
> g\_key\_struct.Pin=GPIO\_PIN\_4;
>   
> g\_key\_struct.Mode=GPIO\_MODE\_INPUT;  //输入模式
>   
> g\_key\_struct.Pull=GPIO\_PULLUP;  //上拉
>   
> g\_key\_struct.Speed=GPIO\_SPEED\_FREQ\_HIGH;  //高速
>   
> HAL\_GPIO\_Init(GPIOE,&g\_key\_struct);
>   
> //KEY1
>   
> g\_key\_struct.Pin=GPIO\_PIN\_3;
>   
> HAL\_GPIO\_Init(GPIOE,&g\_key\_struct);
>   
> //KEY2
>   
> g\_key\_struct.Pin=GPIO\_PIN\_2;
>   
> HAL\_GPIO\_Init(GPIOE,&g\_key\_struct);
>   
> //KEY\_UP
>   
> g\_key\_struct.Pin=GPIO\_PIN\_0;
>   
> g\_key\_struct.Pull=GPIO\_PULLDOWN;  //下拉
>   
> HAL\_GPIO\_Init(GPIOA,&g\_key\_struct);
>   
> }
>   
> //按键扫描函数
>   
> uint8\_t scan(uint8\_t mode){
>   
> static uint8\_t key\_up = 1; /\*按键按松开标志\*/
>   
> uint8\_t keyval= 0;
>   
> if (mode)key\_up = 1; /\*支持连按\*/
>   
> if (key\_up && ( KEY0 == 0 ||KEY1 == 0 ||KEY2 == 0 ||KEY\_UP == 1)){ /\*按键松开标志为1,且有任意一个按键按下了\*/
>   
> delay\_ms(20);  /\*去抖动\*/
>   
> key\_up = 0;
>   
> if (KEY0== 0) keyval=1;
>   
> if (KEY1== 0) keyval=2;
>
> if (KEY2== 0) keyval=3;
>   
> if (KEY\_UP== 1) keyval=4;
>   
> }else if (KEY0== 1 && KEY1 == 1 && KEY2 == 1 && KEY\_UP == 0){ /\*没有任何按键按下,标记按键松开\*/
>   
> key\_up = 1;
>   
> }
>   
> return keyval; /\*返回键值\*/
>   
> }

### main.c

> #include "./SYSTEM/sys/sys.h"
>   
> #include "./SYSTEM/delay/delay.h"
>   
> #include "./BSP/LED/led.h"
>   
> #include "./BSP/BEEP/beep.h"
>
> int main(void){
>   
> HAL\_Init();
>   
> sys\_stm32\_clock\_init(RCC\_PLL\_MUL9);
>   
> delay\_init(72);
>   
> led\_init();
>   
> beep\_init();
>   
> while(1){
>   
> set\_beep(1);
>   
> HAL\_GPIO\_WritePin(GPIOB,GPIO\_PIN\_5,GPIO\_PIN\_SET);  //熄灭
>   
> HAL\_Delay(2000);
>   
> set\_beep(0);
>   
> HAL\_GPIO\_WritePin(GPIOB,GPIO\_PIN\_5,GPIO\_PIN\_RESET);  //点亮
>   
> HAL\_Delay(2000);
>   
> }
>   
> }