---
layout: post
title: "UISearchController使用时,UISearchBar显示的问题"
date: 2019-11-20 15:28:39 +0800
description: "问题：iOS的提供实现搜索功能的SDK：UISearchController（iOS8.0之后）、U"
keywords: "uisearchcontroller 的searchresultscontroller添加侧滑返回"
categories: ['疑难杂症']
tags: ['无标签']
artid: "50724154"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=50724154
    alt: "UISearchController使用时,UISearchBar显示的问题"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=50724154
featuredImagePreview: https://bing.ee123.net/img/rand?artid=50724154
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     UISearchController使用时，UISearchBar显示的问题
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <strong>
      <span style="font-size:24px">
       问题：
      </span>
     </strong>
     <span style="font-size:14px">
      iOS提供实现搜索功能的SDK：UISearchController（iOS8.0之后）、UISearchDisplayController（iOS8.0之前，
      <span style="font-size:14px">
       iOS8.0
      </span>
      之后不建议再使用）。最近在做搜索的时候使用到了UISearchController，恰好NavigationController里有一个手势驱动返回。但是当在搜索页向右滑动界面时，UISearchController的UISearchBar并未跟着view一起向右滑动。考虑了很久，猜测是因为所用到的UISearchController其实并未显示到self.view 才上导致UISearchController的searchBar没有移动。
     </span>
    </p>
    <p>
     <br/>
    </p>
    <p>
     <span style="font-size:24px">
      原因：
     </span>
     <span style="font-size:14px">
      UISearchController继承自UIViewController，也就是说
      <span style="font-size:14px">
       UISearchController自身也带有一个View。
      </span>
      但我们在使用
      <span style="font-size:14px">
       UISearchController的时候并未将
       <span style="font-size:14px">
        UISearchController自带的View添加在self.view上，也就是未指定那个controller显示
        <span style="font-size:14px">
         UISearchController自带View上的控件
        </span>
        。
       </span>
      </span>
      <br/>
     </span>
     <br/>
    </p>
    <p>
     <span style="font-size:24px">
      解决办法：
     </span>
     <span style="font-size:14px">
      查找到UIViewController里有一个属性：@property  （nonatomic,assign）BOOL   definesPresentationContext  NS_AVAILABLE_IOS 5;
     </span>
    </p>
    <p>
     <span style="font-size:14px">
      苹果对其使用介绍是：Determines  which  parent  view  controller's  view  should  be  presented  over  for  presentations  of  type   UIModalPresentationCurrentContext. If  no  ancestor  view controller  has  this  flag  set, then  the  presenter  will  be  the  root   view  controller.
     </span>
    </p>
    <p>
     <span style="font-size:14px">
      即:这一属性决定了那个父控制器的View，将会以优先于
      <span style="font-size:14px">
       UIModalPresentationCurrentContext这种呈现方式来展现自己的View。如果没有父控制器设置这一属性，那么展示的控制器将会是根视图控制器。
      </span>
     </span>
    </p>
    <p>
     <span style="font-size:14px">
      只要在要实现搜索功能的控制器里设置：self.definesPresentationContext = YES;即可实现
      <span style="font-size:14px">
       UISearchController的UISearchBar跟随self.view一起滑动。
      </span>
     </span>
    </p>
    <p>
     <span style="font-size:14px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:24px">
      代码：
     </span>
    </p>
    <p>
     <span style="font-size:14px">
     </span>
    </p>
    <pre><code class="language-objc">        _searchController = [[UISearchController alloc] initWithSearchResultsController:nil];
        _searchController.searchResultsUpdater = self;  
        _searchController.delegate = self;
        _searchController.dimsBackgroundDuringPresentation = NO;
        _searchController.hidesNavigationBarDuringPresentation = YES;
        [self.view addSubview:_searchController.searchBar];    //将searbar添加在self.view上，这一步很重要.
        //重点：在合适的地方添加下面一行代码
        self.definesPresentationContext = YES;</code></pre>
    <p>
    </p>
    <p>
     <span style="font-size:14px">
      <br/>
     </span>
    </p>
    <span style="font-size:24px">
     补充：
    </span>
    <br/>
    <p style="margin-top:0px; margin-bottom:0px; line-height:normal; font-family:Menlo; color:rgb(255,255,255)">
     <span style="font-size:11px; color:rgb(51,51,51); letter-spacing:0.5px">
     </span>
     <span style="color:rgb(51,51,51); letter-spacing:0.5px">
      （1）如果不设置：self.definesPresentationContext = YES;那么如果设置了hidesNavigationBarDuringPresentation为YES，在进入编辑模式的时候会导致searchBar看不见（偏移-64）。
      <span style="color:rgb(51,51,51); font-family:Menlo; font-size:14px; letter-spacing:0.5px">
       如果设置了hidesNavigationBarDuringPresentation为NO，在进入编辑模式会导致高度为64的空白区域出现（导航栏未渲染出来）。
      </span>
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; color:rgb(255,255,255)">
     <span style="color:rgb(51,51,51); font-size:11px; letter-spacing:0.5px">
      <span style="color:rgb(51,51,51); font-family:Menlo; font-size:14px; letter-spacing:0.5px">
       （2）如果
       <span style="color:rgb(51,51,51); font-family:Menlo; font-size:14px; letter-spacing:0.5px">
        设置：
       </span>
       <span style="color:rgb(51,51,51); font-family:Menlo; font-size:14px; letter-spacing:0.5px">
        self.definesPresentationContext = YES;在设置
        <span style="color:rgb(51,51,51); font-family:Menlo; font-size:14px; letter-spacing:0.5px">
         hidesNavigationBarDuringPresentation为YES，进入编辑模式会正常显示和使用。
         <span style="color:rgb(51,51,51); font-family:Menlo; font-size:14px; letter-spacing:0.5px">
          如果设置了hidesNavigationBarDuringPresentation为NO，在进入编辑模式会导致搜索框向下偏移64.
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; color:rgb(255,255,255)">
     <span style="color:rgb(51,51,51); font-size:11px; letter-spacing:0.5px">
      <br/>
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; color:rgb(255,255,255)">
     <span style="color:rgb(51,51,51); font-size:11px; letter-spacing:0.5px">
      <br/>
     </span>
    </p>
    <p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; color:rgb(255,255,255)">
     <br/>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f626f7975616e67756972656e:2f61727469636c652f64657461696c732f3530373234313534" class_="artid" style="display:none">
 </p>
</div>


