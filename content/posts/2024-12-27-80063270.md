---
arturl_encode: "6874747073:3a2f2f626c6f672e6373646e2e6e65742f696f76335261696e:2f61727469636c652f64657461696c732f3830303633323730"
layout: post
title: "2D横板动作游戏常用角色移动逻辑转"
date: 2024-12-27 00:00:00 +08:00
description: "这里所说的横版动作游戏，包含且不限于2D横版动作游戏、横版跑酷游"
keywords: "2d射击游戏运用逻辑"
categories: ['游戏开发']
tags: ['无标签']
artid: "80063270"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=80063270
    alt: "2D横板动作游戏常用角色移动逻辑转"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=80063270
featuredImagePreview: https://bing.ee123.net/img/rand?artid=80063270
---

# 2D横板动作游戏常用角色移动逻辑（转）

这里所说的横版动作游戏，包含且不限于2D横版动作游戏、横版跑酷游戏、横版格斗游戏，只要逻辑层是横板的，且对于判定需要及高精度的（比如在动作游戏中就是拳头命中身体才算中，而不是WoW中，虽然近战攻击有时候看起来还有点距离，但是服务器计算命中就算命中了）就属于“横版动作游戏”范畴。
  
  


1、逻辑的世界
  

![](https://i-blog.csdnimg.cn/blog_migrate/e95f5230710bc1bae92669dfae6f13c9.jpeg)

  

在一个横版动作游戏中，我们就讨论这个移动问题，把世界拆散成三个，他们互相之间是并行的，由这些并行的世界，组成了玩家最后看到的游戏，事实上不同的游戏中并行的世界可能会有更多个。
  
  

在这篇里，我主要说的就是移动世界，一个逻辑世界。在开发游戏的时候，当开发者处于这个世界时，会抛开一切攻防判定世界和贴图世界的信息。
  
  


2、地形
  
  

地形的定义我就不作出解释了，仅仅要说明的，地形并不仅仅是踩在脚下的。在横版动作游戏中，地形可以有以下一些信息：
  
  


1）坐标点
  
  

地形在这个世界上的点位置，一切地形相关的控制由这个点的变化来决定他的位置，坐标点不是一个2维的x,y，它还包含了一维inWorld，我们暂且这么称呼，表示他是否在世界上存在。坐标点(x,y)的作用大家肯定第一时间可以抽象的出来——就是在一些横版动作游戏中，有些会移动的岛屿，FC的冒险岛、超级马里奥开始就有。
  
  

![](https://i-blog.csdnimg.cn/blog_migrate/f626d587024a19057574ef755d105b5a.jpeg)

  

这个很熟悉吧， 屏幕中间那两根会带着你往上或者往下走的地形，有时候角色踩上去还会自动往下掉。这就是(x,y)坐标在这里的作用。而会消失的地形，其实很多横版动作游戏也是有的，你接触的第一个这样的游戏可能就是……
  
  

![](https://i-blog.csdnimg.cn/blog_migrate/98938b68232b54c2749d51a4fb488da1.jpeg)

  

FC的经典大作魂斗罗，我们这一代游戏人都是玩这个长大的，不少人人生第一个游戏就是他，在刚开场没多久，你就能遇到一座桥，走过去的时候会爆炸，原本可以踩的地形inWorld变成false了，当然对于这个桥，更高效的处理是去掉这个地形信息，但是在另外一些动作游戏中，他会出现那种若隐若现的地形，出现的时候可以踩，但是消失了就会掉下去
  
  

![](https://i-blog.csdnimg.cn/blog_migrate/6bee3e96d93d33aba229e4392c4be7c3.jpeg)

  

FC的赤影战士里面有很多这样的地形，另外也有成龙之龙等都会有这样的地形。
  
  


2）天花板、充实体、墙壁
  
  

这两个都是可选属性，且都是boolean的，天花板的概念很好理解，就是当角色起跳的时候，会因为顶到天花板而终止跳跃开始下落，这是最常见的，天花板其实还是限制版子边缘的东西，也就是角色无法往上走了。
  

最古老的天花板之一：
  
  

![](https://i-blog.csdnimg.cn/blog_migrate/baae9c74fcd5d7332fb760146f9fcf15.jpeg)

  

超级马里奥开始的时候那些问号、砖头、顶掉问号后的铁块，都是天花板=true的，而魂斗罗中，大多地形天花板都是False的， 因此角色可以自下而上的跳跃。
  
  

充实体则是角色往下跳的障碍，这个真不好找图（因为无法说明问题），但是相信每个人的游戏经历里面都会遇到：
  
  

充实体=false的时候，角色按下和跳是会往下跳一层的。
  
  

充实体=true的时候，角色按下跳，要么就是蹲着，要么就是原地跳起（根据游戏设定的按键反馈不同）。
  
  

至于墙壁，就太好理解了，通常版子边缘，或者一些横向不让走过去的都是Wall=true的，比如上图玛丽奥里面的绿色水管就是个典型。
  

  

3）体型
  
  

这是地形最重要的属性，这决定了这块地形的大小。
  
  

老式的游戏中，采用二维数组作为地图，依然是Tile Based，如超级马里奥系列，所以都是正方形。但是随着游戏精度要求越来越高，也出现了多边形的地形，并且世界不再是tile based。
  
  

![](https://i-blog.csdnimg.cn/blog_migrate/b07357c2876947eacd6201e4c23114d0.jpeg)

  

早在MD时代，索尼克已经采用了特殊形状的地形（可怜国游的跑酷还做不出来）。体型的作用是什么我这里就不多说了，核心在于不是矩形的体型与点的碰撞算法，是要数学功底的，这里我就不提供算法了，自己百度很容易搜到，都是初中、高中教程了。
  
  

体型当然不是一个简单的polygon就了事而得，他还有一个offset坐标，这个坐标的x,y是与坐标属性的x,y产生关系的，已决定这个地形出现在哪儿。我们刚说了移动地形。
  
  


4）强制位移、溜滑、弹性。
  
  

严格的来说，溜滑、弹性是强制位移的一种，但是概念上来说还是要把它们分开。
  
  

强制位移，是指当角色处于这个地形的时候，会收到一个外力(forceMoveX, forceMoveY)，这些外力会导致角色的移动在x,y方向上受到力的作用：
  
  

![](https://i-blog.csdnimg.cn/blog_migrate/0727ea5f7ad977843aeac3fb0b87bcf4.jpeg)

  

最常见到的是传送带，但是松鼠大战中著名的强制移动地形不仅仅是传送带，还有电风扇。核心在于你往一个方向走会很慢，但是往另一个方向走却会很快。这里要特别注意的是，一些游戏中实现Y方向的强制移动可能是增加角色的重力或者跳跃力。
  
  

溜滑属性（通常是float）他的作用是让角色在停止移动的时候，还会逐渐保持一个减速的ForceMoveX效果：
  
  

![](https://i-blog.csdnimg.cn/blog_migrate/4b7af6b085e4b099c6bc5a860248aaf3.jpeg)

  
  

早在FC的冒险岛1代，我们就遇到过这种溜滑的地形。
  
  

而弹跳属性（通常也是float），则是给角色强加一个jump的力度，最常见的是：
  
  

![](https://i-blog.csdnimg.cn/blog_migrate/09318a921f7e6667f585afc4438a583a.jpeg)

  

注意到屏幕中间那个弹簧了么，就是他！
  
  


5）位移轨迹node，可携带性。
  
  

一些地形有自移动的能力，他们通常会跟随一定的轨迹移动，而这些地形通常也会需要设定一个可携带性，可携带性决定了角色在地形上是否会跟随地形的位移而位移。而地形位移的信息，除了坐标的移动轨迹、每两个轨迹间的tick长度外（这时候inWorld属性也就起作用了，你可以设计一个地形移动到一个地方突然没有了），还要设定一个可携带性，因为并不是所有的地形都要带着上面的角色走的（这个自开脑洞吧）。
  
  

![](https://i-blog.csdnimg.cn/blog_migrate/bdcea2c99ed85a720c42ea5935ad32a9.jpeg)

  
  

松鼠大战里面的小板车是“最不标准”的位移地形（可携带）。当可携带为true的时候，我这个地形这一帧的位移，也会成为ForceMove传递给角色（所以通常循环里面地形的位移在前，别问我为啥这么不严谨，因为大家都喜欢偷懒）。
  
  


6）其他属性
。
  
  

之所以归纳为其他属性，是因为根据游戏的不同，你还可以给地形带上一些其他的属性来丰富他，但是这些属性通常与现在正在讨论的位移这件事情没什么大关系。比如你给地形带来一个烧伤力，角色走上去会受伤，并且受到吹飞力等影响，的确这个吹飞力会影响到角色的移动，但这个逻辑并不属于这一层，而是属于攻防判断层带来的影响。
  
  

![](https://i-blog.csdnimg.cn/blog_migrate/b403a429276290a14ee3e62fd66800d2.jpeg)

  
  

比如洛克人的钉板就会让角色直接挂了（至于图里面为啥没挂，你懂得）
  
  


3、角色
  
  

在位移这件事情上，角色又有哪些属性呢？
  
  


1）坐标与体型
  
  

早期的游戏中，也包括现在很多比较粗糙的游戏中，角色移动是一个矩形，通过这个矩形与地形（通常也都是矩形，既然这么做了肯定是效率优先，自然都用矩形）之间的关系来实现位移的每一个细节。
  
  

而好一点的游戏，却采用了点阵和法线：
  
  

![](https://i-blog.csdnimg.cn/blog_migrate/e6d5b931871530456b12b5af73757cf2.jpeg)

  

一个角色通常有若干个点来组成，这是在地形（位移）判定的时候用的，而不是攻击框，这些点共同组成了一个多边形，这个多边形，决定了角色与地形的碰撞关系，而在角色中心会有一条法线（视觉上也是这个，但别跟法线贴图搞混了，完全没任何关系的），这跟法线是在角色ScaleX（左右反转）的时候使用的，让这些逻辑点的坐标也发生Scale，通常法线只是一个概念（并不存在实体数据），因为我们在设定角色的每一个动作的点阵（这个点阵是跟动作而非动作的每一帧的，有些游戏是跟角色的，都不分布道动作）的每一个点的坐标的时候，会把发现当做Y轴。而作为角色坐标的那个点，通常也是脚下那个X=0的点。
  
  


2）移动相关参数
  
  

角色本身（请一定注意“本身”）在一帧内移动相关的参数包括：
  
  

玩家期望位移(x, jump)：这个是根据操作传过来的x,y方向的唯一，y方向的位移通常为跳跃力（一些游戏中根据你按跳的时间长度不同，跳跃力是不同的，超级马里奥就是一个代表，对于玩家来说甚至是一个技巧活）。一些游戏中，角色在空中可以受到按键影响改变跳跃的方向，也就是因为“角色腾空后”依然接受x方向处理。
  
  

来自动作的强制位移(forceMoveX, forceMoveY, ignoreFloor)：强制位移主要是x,y方向上的，通常来说，会多一个ignoreFloor，但不会有ignoreWall或者ignoreRoof这种，当然成为ignoreFloor也不太科学，他的本意是——当我强制位移中，是否还受到正常的重力影响，典型的是侍魂中的不意打，这是一个非跳跃动作，但他有真的起跳了。还有DNF一些角色的后跳技能。
  
  


3）角色在这一帧的位置变化一审（李狗海看多了）
  
  

角色的位移，分为2个：X方向和Y方向。
  
  

X方向的位移距离=玩家期望X（通常这里是经过buff等计算的最终X方向的速度）+自身动作forceMoveX+地形ForceMoveX+游戏其他因素ForceMoveX。
  
  

Y方向的位移距离=-起跳力（这里有2个做法都不能说错，一些游戏中先运算了起跳力-重力，而一些则是在下一步运算，这两个都OK，看coder和designer的想法了）+本身ForceMoveY(如果是Jump变化则为-）+地形ForceMoveY+游戏设定ForceMoveY。
  
  




4）角色的位移定案
  
  

当我们知道了角色在2个方向上的移动距离以后，我们就要进行碰撞判断，决策是否最终能够去到那个点。
  

一些老的游戏的做法，现在可能并不是最合适，但是也是比较好用的是：直接判断这个点是否能放角色（马里奥做法），如果可以就过去，否则这次位移的目标点变成角色当前所在点。
  
  

更好的做法（恶魔城GBA开始的做法）则是：
  
  

![](https://i-blog.csdnimg.cn/blog_migrate/f1d940a1074d5ea910b615936ad2a6b8.jpeg)

  
  

我们来看图1，好的做法（也是适合与任何角度地形的）是将角色的碰撞点当前位置与目标位置相连，并计算这些直线与阻挡的关系。我们在图2中可以看到，蓝色的阻挡横向的如果是一个天花板，那正确的做法，角色还是应该继续向上，顶到天花板后才开始下落，但如果采用马里奥的做法，就会定不到天花板（正巧马里奥是tile的，大多时候避免了这个问题）；而另一些游戏则是角色的头顶会超出天花板一点（其实这也完全可以接受）。但是如果做一条线段去判断，则可以返回出顶端的点（这里所有的具体算法都是高中数学水平的，我就不写了自行百度吧，或者找你家数值策划去），当然这不是唯一的好处。
  
  

我们再仔细看图2，假如世界上有2中地行，他是橙色的线条，而且她的宽度恰好是橙色线条这么宽，按照马里奥的算法，在速度够快（移动距离够大）的时候，我们会穿过这条线，形成“穿墙”，所以我们必须做出这样一条射线（其实还是线段，毕竟两头都知道了，但我们还是需要方向的），以保证不发生这样的bug，而不是无端的把墙壁变粗，关卡设计毕竟有她的巧妙性，而且你也没法保证角色的速度不会这么快对吧？尤其是跑酷游戏。
  
  

关于角色位移，这么小的一件事情，背后就是这么复杂的东西，有太多需要思考的东西，太多太多了。而且要注意的是，这里并没有说的是，角色之间还有碰撞，当角色之间还有碰撞的时候，其他角色的碰撞框对“我”来说就是地形（墙壁为True，至于充实体和天花板就看你游戏多么恶搞了）。所以，真不要小看了动作游戏里面的角色移动，跟回合制游戏的概念是完全不同的！