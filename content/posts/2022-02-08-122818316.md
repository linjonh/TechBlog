---
layout: post
title: "sqlserver-查询数据库各表的数据量"
date: 2022-02-08 09:42:24 +0800
description: "SELECT a.name , b.rows FROM  sysobjects AS a   INN"
keywords: "sqlserver查询每张表的数据量"
categories: ['Sql']
tags: ['Sql', 'P', 'Linq']
artid: "122818316"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=122818316
    alt: "sqlserver-查询数据库各表的数据量"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=122818316
featuredImagePreview: https://bing.ee123.net/img/rand?artid=122818316
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     sqlserver 查询数据库各表的数据量
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     SELECT  a.name ,  b.rows  FROM    sysobjects AS a
    </p>
    <p>
     INNER JOIN sysindexes AS b ON a.id = b.id
     <br/>
     WHERE   ( a.type = 'u' )  AND ( b.indid IN ( 0, 1 ) )
     <br/>
     ORDER BY b.rows DESC
    </p>
    <p>
     select top 10 * from tablea order by Id desc
     <br/>
    </p>
    <p>
     SELECT
     <br/>
     db_name() as DbName,
     <br/>
     t.NAME AS TableName,
     <br/>
     s.Name AS SchemaName,
     <br/>
     p.rows AS RowCounts,
     <br/>
     SUM(a.total_pages) * 8 AS TotalSpaceKB,
     <br/>
     CAST(ROUND(((SUM(a.total_pages) * 8) / 1024.00), 2) AS NUMERIC(36, 2)) AS 总共占用空间MB,
     <br/>
     SUM(a.used_pages) * 8 AS UsedSpaceKB,
     <br/>
     CAST(ROUND(((SUM(a.used_pages) * 8) / 1024.00), 2) AS NUMERIC(36, 2)) AS UsedSpaceMB,
     <br/>
     (SUM(a.total_pages) - SUM(a.used_pages)) * 8 AS UnusedSpaceKB,
     <br/>
     CAST(ROUND(((SUM(a.total_pages) - SUM(a.used_pages)) * 8) / 1024.00, 2) AS NUMERIC(36, 2)) AS UnusedSpaceMB
     <br/>
     FROM
     <br/>
     sys.tables t
     <br/>
     INNER JOIN
     <br/>
     sys.indexes i ON t.OBJECT_ID = i.object_id
     <br/>
     INNER JOIN
     <br/>
     sys.partitions p ON i.object_id = p.OBJECT_ID AND i.index_id = p.index_id
     <br/>
     INNER JOIN
     <br/>
     sys.allocation_units a ON p.partition_id = a.container_id
     <br/>
     LEFT OUTER JOIN
     <br/>
     sys.schemas s ON t.schema_id = s.schema_id
     <br/>
     WHERE
     <br/>
     t.NAME NOT LIKE 'dt%'
     <br/>
     AND t.is_ms_shipped = 0
     <br/>
     AND i.OBJECT_ID &gt; 0
     <br/>
     GROUP BY
     <br/>
     t.Name, s.Name, p.Rows
     <br/>
     ORDER BY
     <br/>
     总共占用空间MB desc
    </p>
    <pre><code class="language-sql">USE [master] 
    GO
    ALTER DATABASE CS SET RECOVERY SIMPLE WITH NO_WAIT   ----blog为需要清除日志的数据库名称
    GO
    ALTER DATABASE CS SET RECOVERY SIMPLE   --简单模式   ----blog为需要清除日志的数据库名称
    GO
    USE CS     ----blog为需要清除日志的数据库名称
    GO
    DBCC SHRINKFILE (N'CS_log' , 11, TRUNCATEONLY)    ----blog_Log为需要清除日志的数据库名日志名称
    GO
    USE [master]
    GO

    ALTER DATABASE CS SET RECOVERY FULL WITH NO_WAIT   ----blog为需要清除日志的数据库名称

    GO

    ALTER DATABASE CS SET RECOVERY FULL  --还原为完全模式   ----blog为需要清除日志的数据库名称 </code></pre>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f7a616e66656e672f:61727469636c652f64657461696c732f313232383138333136" class_="artid" style="display:none">
 </p>
</div>


