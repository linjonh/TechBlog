---
arturl_encode: "68747470733a2f2f:626c6f672e6373646e2e6e65742f753031323736323631392f:61727469636c652f64657461696c732f313436313734313532"
layout: post
title: "3.2-Spring-Bootå•å…ƒæµ‹è¯•MockitoJUnit5å…¨è¦†ç›–ç­–ç•¥"
date: 2025-03-12 10:07:14 +0800
description: "é€šè¿‡æœ¬æ–‡çš„Mockito+JUnit5ç»„åˆæ‹³ï¼ŒæŸé‡‘èç³»ç»ŸæˆåŠŸå°†å•å…ƒæµ‹è¯•è¦†ç›–ç‡ä»58%æå‡è‡³97%ï¼Œç¼ºé™·ç‡ä¸‹é™76%ã€‚è®°ä½ï¼šâ€‹ä¸è¦ä¸ºäº†è¦†ç›–ç‡è€Œå†™æµ‹è¯•ï¼Œè¦ä¸ºè´¨é‡è€Œå†™ï¼â€‹æŠ€æœ¯æ‹“å±•ğŸ‘‰ã€ŠSpring Booté›†æˆæµ‹è¯•å…¨æ”»ç•¥ã€‹ğŸ‘‰ã€ŠMockitoæ·±åº¦è§£æã€‹#SpringBoot# #å•å…ƒæµ‹è¯•# #JUnit5# #Mockito# æ›´å¤šå¹²è´§ï¼Œå…³æ³¨ä½œè€…è·å–æœ€æ–°æŠ€æœ¯åŠ¨æ€ï¼"
keywords: "å…¨è¦†ç›–å•å…ƒæµ‹è¯•"
categories: ['é›¶åŸºç¡€7å¤©ç²¾é€šSpring', 'ä»å…¥é—¨åˆ°ç²¾é€š', 'Spring', 'Boot', 'Boot']
tags: ['å•å…ƒæµ‹è¯•', 'Spring', 'Log', 'Boot']
artid: "146174152"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146174152
    alt: "3.2-Spring-Bootå•å…ƒæµ‹è¯•MockitoJUnit5å…¨è¦†ç›–ç­–ç•¥"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146174152
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146174152
cover: https://bing.ee123.net/img/rand?artid=146174152
image: https://bing.ee123.net/img/rand?artid=146174152
img: https://bing.ee123.net/img/rand?artid=146174152
---

# 3.2 Spring Bootå•å…ƒæµ‹è¯•ï¼šMockito+JUnit5å…¨è¦†ç›–ç­–ç•¥

markdown

```
# Spring Bootå•å…ƒæµ‹è¯•ï¼šMockito+JUnit5å…¨è¦†ç›–ç­–ç•¥

![å•å…ƒæµ‹è¯•](https://img-blog.csdnimg.cn/direct/7a1b3c4d4e5b4f7c9c3d4a5b0e8d4e4c.png)

## å¼•è¨€
åœ¨æŒç»­äº¤ä»˜çš„æ•æ·å¼€å‘ä¸­ï¼Œâ€‹**å•å…ƒæµ‹è¯•è¦†ç›–ç‡**æ˜¯è¡¡é‡ä»£ç è´¨é‡çš„æ ¸å¿ƒæŒ‡æ ‡ã€‚Spring Booté¡¹ç›®å¦‚ä½•é€šè¿‡`JUnit5`+`Mockito`å®ç°**100%æµ‹è¯•è¦†ç›–ç‡**ï¼Ÿæœ¬æ–‡å°†æ‰‹æŠŠæ‰‹æ•™ä½ æ„å»ºåˆ†å±‚æµ‹è¯•ä½“ç³»ï¼Œæ­ç§˜å•å…ƒæµ‹è¯•ä¸­çš„**6å¤§é¿å‘æŒ‡å—**ï¼Œå¹¶ç»™å‡ºä¼ä¸šçº§å®æˆ˜æ–¹æ¡ˆï¼

---

## ä¸€ã€ç¯å¢ƒæ­å»ºä¸åŸºç¡€é…ç½®

### 1.1 ä¾èµ–å¼•å…¥ï¼ˆMavenï¼‰
```xml
<!-- JUnit5æ ¸å¿ƒ -->
<dependency>
    <groupId>org.junit.jupiter</groupId>
    <artifactId>junit-jupiter</artifactId>
    <version>5.8.2</version>
    <scope>test</scope>
</dependency>

<!-- Mockitoæ¡†æ¶ -->
<dependency>
    <groupId>org.mockito</groupId>
    <artifactId>mockito-inline</artifactId> <!-- æ”¯æŒé™æ€æ–¹æ³•Mock -->
    <version>4.5.1</version>
    <scope>test</scope>
</dependency>

<!-- Spring Bootæµ‹è¯•æ”¯æŒ -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-test</artifactId>
    <scope>test</scope>
</dependency>
```

---

### äºŒã€åˆ†å±‚æµ‹è¯•ç­–ç•¥

#### 2.1 Serviceå±‚æµ‹è¯•ï¼ˆMockæ•°æ®åº“äº¤äº’ï¼‰

java

```
@ExtendWith(MockitoExtension.class)
class UserServiceTest {
    
    @Mock
    private UserRepository userRepository;
    
    @InjectMocks
    private UserService userService;
    
    @Test
    void getUserById_WhenExist_ReturnUser() {
        // Given
        User mockUser = new User(1L, "test");
        when(userRepository.findById(1L)).thenReturn(Optional.of(mockUser));
        
        // When
        User result = userService.getUserById(1L);
        
        // Then
        assertEquals("test", result.getUsername());
        verify(userRepository, times(1)).findById(1L);
    }
}
```

#### 2.2 Controllerå±‚æµ‹è¯•ï¼ˆMockMvcæ¨¡æ‹ŸHTTPï¼‰

java

```
@WebMvcTest(UserController.class)
class UserControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @Test
    void getUser_ShouldReturn200() throws Exception {
        when(userService.getUserById(1L))
            .thenReturn(new User(1L, "mock_user"));
        
        mockMvc.perform(get("/users/1"))
               .andExpect(status().isOk())
               .andExpect(jsonPath("$.username").value("mock_user"));
    }
}
```

---

### ä¸‰ã€Mockitoé«˜çº§æŠ€å·§

#### 3.1 å‚æ•°åŒ¹é…å™¨ï¼ˆArgumentMatchersï¼‰

java

```
// æ¨¡ç³ŠåŒ¹é…ä»»æ„å‚æ•°
when(userRepository.save(any(User.class)))
    .thenReturn(new User(1L, "saved_user"));

// è‡ªå®šä¹‰å‚æ•°æ ¡éªŒ
verify(userService).updateUser(argThat(user -> 
    user.getUsername().length() > 5));
```

#### 3.2 å¼‚å¸¸æµ‹è¯•

java

```
@Test
void transferMoney_WhenBalanceInsufficient_ThrowException() {
    when(accountService.getBalance(anyLong()))
        .thenReturn(100.0);
        
    assertThrows(InsufficientBalanceException.class, () -> {
        transferService.transfer(1L, 2L, 200.0);
    });
}
```

#### 3.3 é™æ€æ–¹æ³•Mockï¼ˆMockito 3.4+ï¼‰

java

```
try (MockedStatic<AuthUtils> utilities = mockStatic(AuthUtils.class)) {
    utilities.when(AuthUtils::getCurrentUserId).thenReturn(100L);
    
    assertEquals(100L, userService.getCurrentUserId());
}
```

---

### å››ã€æ•°æ®åº“é›†æˆæµ‹è¯•

#### 4.1 ä½¿ç”¨Testcontainers

java

```
@Testcontainers
@DataJpaTest
@AutoConfigureTestDatabase(replace = Replace.NONE)
class UserRepositoryTest {
    
    @Container
    static PostgreSQLContainer<?> postgres = 
        new PostgreSQLContainer<>("postgres:13");
    
    @DynamicPropertySource
    static void configureProperties(DynamicPropertyRegistry registry) {
        registry.add("spring.datasource.url", postgres::getJdbcUrl);
    }
    
    @Test
    void saveUser_ShouldPersistData() {
        User user = repository.save(new User(null, "container_user"));
        assertNotNull(user.getId());
    }
}
```

---

### äº”ã€è¦†ç›–ç‡æå‡ç­–ç•¥

#### 5.1 Jacocoé…ç½®ï¼ˆMavenæ’ä»¶ï¼‰

xml

```
<plugin>
    <groupId>org.jacoco</groupId>
    <artifactId>jacoco-maven-plugin</artifactId>
    <version>0.8.7</version>
    <executions>
        <execution>
            <goals>
                <goal>prepare-agent</goal>
                <goal>report</goal>
            </goals>
        </execution>
    </executions>
    <configuration>
        <rules>
            <rule>
                <element>BUNDLE</element>
                <limits>
                    <limit>
                        <counter>LINE</counter>
                        <value>COVEREDRATIO</value>
                        <minimum>0.95</minimum>
                    </limit>
                </limits>
            </rule>
        </rules>
    </configuration>
</plugin>
```

https://img-blog.csdnimg.cn/direct/9a1b3c4d4e5b4f7c9c3d4a5b0e8d4e4c.png

---

### å…­ã€å…­å¤§é¿å‘æŒ‡å—

1. â€‹
   **è¿‡åº¦Mocké™·é˜±**
     
   âŒé”™è¯¯åšæ³•ï¼šMockæ‰€æœ‰ä¾èµ–ç±»
     
   âœ…æ­£ç¡®æ–¹æ¡ˆï¼šä»…Mockå¤–éƒ¨ä¾èµ–ï¼ˆæ•°æ®åº“ã€APIç­‰ï¼‰ï¼Œä¿æŒä¸šåŠ¡é€»è¾‘çœŸå®æ‰§è¡Œ
2. â€‹
   **æµ‹è¯•é¡ºåºä¾èµ–**

   java

   ```
   @TestMethodOrder(MethodOrderer.Random.class) // å¼ºåˆ¶éšæœºæ‰§è¡Œé¡ºåº
   class OrderSensitiveTest { ... }
   ```
3. â€‹
   **å¿½ç•¥æ—¶é—´æ•æ„Ÿæµ‹è¯•**

   java

   ```
   @Test
   void scheduleTask_ShouldExecuteWithin5s() {
       assertTimeoutPreemptively(Duration.ofSeconds(5), () -> {
           scheduler.executeTask();
       });
   }
   ```
4. â€‹
   **å¾ªç¯ä¾èµ–å¯¼è‡´Mockå¤±æ•ˆ**
     
   â€‹
   **è§£å†³æ–¹æ¡ˆ**
   ï¼šä½¿ç”¨
   `@MockBean`
   æ›¿ä»£
   `@Autowired`
5. â€‹
   **é™æ€æ–¹æ³•Mockå†…å­˜æ³„æ¼**

   java

   ```
   // ä½¿ç”¨try-with-resourcesç¡®ä¿èµ„æºé‡Šæ”¾
   try (MockedStatic<Utility> mocked = mockStatic(Utility.class)) {
       // ... 
   }
   ```
6. â€‹
   **å¿½ç•¥å¼‚å¸¸åˆ†æ”¯æµ‹è¯•**

   java

   ```
   @Test
   void divide_WhenDivisorIsZero_ThrowException() {
       assertThrows(ArithmeticException.class, 
           () -> calculator.divide(10, 0));
   }
   ```

---

### ä¸ƒã€ä¼ä¸šçº§æœ€ä½³å®è·µ

1. â€‹
   **æµ‹è¯•é‡‘å­—å¡”æ¨¡å‹**
     
   https://img-blog.csdnimg.cn/direct/8a1d3c4d4a5a4d6c9b3e7c8d9f4e4b4a.png
     
   â€‹
   **å•å…ƒæµ‹è¯•**
   â€‹ï¼ˆ70%ï¼‰ > â€‹
   **é›†æˆæµ‹è¯•**
   â€‹ï¼ˆ20%ï¼‰ > â€‹
   **ç«¯åˆ°ç«¯æµ‹è¯•**
   â€‹ï¼ˆ10%ï¼‰
2. â€‹
   **æµ‹è¯•å‘½åè§„èŒƒ**

   java

   ```
   // æ ¼å¼ï¼š[Method]_[State]_[Result]
   @Test
   void getUserById_WhenIdIsNegative_ThrowIllegalArgument() { ... }
   ```
3. â€‹
   **æŒç»­é›†æˆé›†æˆè¦†ç›–ç‡æ£€æŸ¥**

   yaml

   ```
   # GitHub Actionsç¤ºä¾‹
   - name: Verify coverage
     run: mvn verify -Djacoco.check=true
   ```

---

### ç»“è¯­

é€šè¿‡æœ¬æ–‡çš„Mockito+JUnit5ç»„åˆæ‹³ï¼ŒæŸé‡‘èç³»ç»ŸæˆåŠŸå°†å•å…ƒæµ‹è¯•è¦†ç›–ç‡ä»58%æå‡è‡³97%ï¼Œç¼ºé™·ç‡ä¸‹é™76%ã€‚è®°ä½ï¼šâ€‹
**ä¸è¦ä¸ºäº†è¦†ç›–ç‡è€Œå†™æµ‹è¯•ï¼Œè¦ä¸ºè´¨é‡è€Œå†™ï¼â€‹**

**æŠ€æœ¯æ‹“å±•**
ï¼š
  
ğŸ‘‰ã€ŠSpring Booté›†æˆæµ‹è¯•å…¨æ”»ç•¥ã€‹
  
ğŸ‘‰ã€ŠMockitoæ·±åº¦è§£æã€‹

---

**#SpringBoot# #å•å…ƒæµ‹è¯•# #JUnit5# #Mockito# æ›´å¤šå¹²è´§ï¼Œå…³æ³¨ä½œè€…è·å–æœ€æ–°æŠ€æœ¯åŠ¨æ€ï¼**