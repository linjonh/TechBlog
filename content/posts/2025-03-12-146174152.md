---
layout: post
title: "3.2-Spring-Bootå•å…ƒæµ‹è¯•MockitoJUnit5å…¨è¦†ç›–ç­–ç•¥"
date: 2025-03-12 10:07:14 +0800
description: "é€šè¿‡æœ¬æ–‡çš„Mockito+JUnit5ç»„åˆæ‹³ï¼ŒæŸé‡‘èç³»ç»ŸæˆåŠŸå°†å•å…ƒæµ‹è¯•è¦†ç›–ç‡ä»58%æå‡è‡³97%ï¼Œç¼ºé™·ç‡ä¸‹é™76%ã€‚è®°ä½ï¼šâ€‹ä¸è¦ä¸ºäº†è¦†ç›–ç‡è€Œå†™æµ‹è¯•ï¼Œè¦ä¸ºè´¨é‡è€Œå†™ï¼â€‹æŠ€æœ¯æ‹“å±•ğŸ‘‰ã€ŠSpring Booté›†æˆæµ‹è¯•å…¨æ”»ç•¥ã€‹ğŸ‘‰ã€ŠMockitoæ·±åº¦è§£æã€‹#SpringBoot# #å•å…ƒæµ‹è¯•# #JUnit5# #Mockito# æ›´å¤šå¹²è´§ï¼Œå…³æ³¨ä½œè€…è·å–æœ€æ–°æŠ€æœ¯åŠ¨æ€ï¼"
keywords: "å…¨è¦†ç›–å•å…ƒæµ‹è¯•"
categories: ['é›¶åŸºç¡€7å¤©ç²¾é€šSpring', 'ä»å…¥é—¨åˆ°ç²¾é€š', 'Spring', 'Boot', 'Boot']
tags: ['å•å…ƒæµ‹è¯•', 'Spring', 'Log', 'Boot']
artid: "146174152"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146174152
    alt: "3.2-Spring-Bootå•å…ƒæµ‹è¯•MockitoJUnit5å…¨è¦†ç›–ç­–ç•¥"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146174152
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146174152
cover: https://bing.ee123.net/img/rand?artid=146174152
image: https://bing.ee123.net/img/rand?artid=146174152
img: https://bing.ee123.net/img/rand?artid=146174152
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     3.2 Spring Bootå•å…ƒæµ‹è¯•ï¼šMockito+JUnit5å…¨è¦†ç›–ç­–ç•¥
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <pre></pre>
    <p>
     markdown
    </p>
    <pre><code># Spring Bootå•å…ƒæµ‹è¯•ï¼šMockito+JUnit5å…¨è¦†ç›–ç­–ç•¥

![å•å…ƒæµ‹è¯•](https://img-blog.csdnimg.cn/direct/7a1b3c4d4e5b4f7c9c3d4a5b0e8d4e4c.png)

## å¼•è¨€
åœ¨æŒç»­äº¤ä»˜çš„æ•æ·å¼€å‘ä¸­ï¼Œâ€‹**å•å…ƒæµ‹è¯•è¦†ç›–ç‡**æ˜¯è¡¡é‡ä»£ç è´¨é‡çš„æ ¸å¿ƒæŒ‡æ ‡ã€‚Spring Booté¡¹ç›®å¦‚ä½•é€šè¿‡`JUnit5`+`Mockito`å®ç°**100%æµ‹è¯•è¦†ç›–ç‡**ï¼Ÿæœ¬æ–‡å°†æ‰‹æŠŠæ‰‹æ•™ä½ æ„å»ºåˆ†å±‚æµ‹è¯•ä½“ç³»ï¼Œæ­ç§˜å•å…ƒæµ‹è¯•ä¸­çš„**6å¤§é¿å‘æŒ‡å—**ï¼Œå¹¶ç»™å‡ºä¼ä¸šçº§å®æˆ˜æ–¹æ¡ˆï¼

---

## ä¸€ã€ç¯å¢ƒæ­å»ºä¸åŸºç¡€é…ç½®

### 1.1 ä¾èµ–å¼•å…¥ï¼ˆMavenï¼‰
```xml
&lt;!-- JUnit5æ ¸å¿ƒ --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
    &lt;artifactId&gt;junit-jupiter&lt;/artifactId&gt;
    &lt;version&gt;5.8.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;

&lt;!-- Mockitoæ¡†æ¶ --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.mockito&lt;/groupId&gt;
    &lt;artifactId&gt;mockito-inline&lt;/artifactId&gt; &lt;!-- æ”¯æŒé™æ€æ–¹æ³•Mock --&gt;
    &lt;version&gt;4.5.1&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;

&lt;!-- Spring Bootæµ‹è¯•æ”¯æŒ --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
    <hr/>
    <h3>
     äºŒã€åˆ†å±‚æµ‹è¯•ç­–ç•¥
    </h3>
    <h4>
     2.1 Serviceå±‚æµ‹è¯•ï¼ˆMockæ•°æ®åº“äº¤äº’ï¼‰
    </h4>
    <pre></pre>
    <p>
     java
    </p>
    <pre><code>@ExtendWith(MockitoExtension.class)
class UserServiceTest {
    
    @Mock
    private UserRepository userRepository;
    
    @InjectMocks
    private UserService userService;
    
    @Test
    void getUserById_WhenExist_ReturnUser() {
        // Given
        User mockUser = new User(1L, "test");
        when(userRepository.findById(1L)).thenReturn(Optional.of(mockUser));
        
        // When
        User result = userService.getUserById(1L);
        
        // Then
        assertEquals("test", result.getUsername());
        verify(userRepository, times(1)).findById(1L);
    }
}</code></pre>
    <h4>
     2.2 Controllerå±‚æµ‹è¯•ï¼ˆMockMvcæ¨¡æ‹ŸHTTPï¼‰
    </h4>
    <pre></pre>
    <p>
     java
    </p>
    <pre><code>@WebMvcTest(UserController.class)
class UserControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @Test
    void getUser_ShouldReturn200() throws Exception {
        when(userService.getUserById(1L))
            .thenReturn(new User(1L, "mock_user"));
        
        mockMvc.perform(get("/users/1"))
               .andExpect(status().isOk())
               .andExpect(jsonPath("$.username").value("mock_user"));
    }
}</code></pre>
    <hr/>
    <h3>
     ä¸‰ã€Mockitoé«˜çº§æŠ€å·§
    </h3>
    <h4>
     3.1 å‚æ•°åŒ¹é…å™¨ï¼ˆArgumentMatchersï¼‰
    </h4>
    <pre></pre>
    <p>
     java
    </p>
    <pre><code>// æ¨¡ç³ŠåŒ¹é…ä»»æ„å‚æ•°
when(userRepository.save(any(User.class)))
    .thenReturn(new User(1L, "saved_user"));

// è‡ªå®šä¹‰å‚æ•°æ ¡éªŒ
verify(userService).updateUser(argThat(user -&gt; 
    user.getUsername().length() &gt; 5));</code></pre>
    <h4>
     3.2 å¼‚å¸¸æµ‹è¯•
    </h4>
    <pre></pre>
    <p>
     java
    </p>
    <pre><code>@Test
void transferMoney_WhenBalanceInsufficient_ThrowException() {
    when(accountService.getBalance(anyLong()))
        .thenReturn(100.0);
        
    assertThrows(InsufficientBalanceException.class, () -&gt; {
        transferService.transfer(1L, 2L, 200.0);
    });
}</code></pre>
    <h4>
     3.3 é™æ€æ–¹æ³•Mockï¼ˆMockito 3.4+ï¼‰
    </h4>
    <pre></pre>
    <p>
     java
    </p>
    <pre><code>try (MockedStatic&lt;AuthUtils&gt; utilities = mockStatic(AuthUtils.class)) {
    utilities.when(AuthUtils::getCurrentUserId).thenReturn(100L);
    
    assertEquals(100L, userService.getCurrentUserId());
}</code></pre>
    <hr/>
    <h3>
     å››ã€æ•°æ®åº“é›†æˆæµ‹è¯•
    </h3>
    <h4>
     4.1 ä½¿ç”¨Testcontainers
    </h4>
    <pre></pre>
    <p>
     java
    </p>
    <pre><code>@Testcontainers
@DataJpaTest
@AutoConfigureTestDatabase(replace = Replace.NONE)
class UserRepositoryTest {
    
    @Container
    static PostgreSQLContainer&lt;?&gt; postgres = 
        new PostgreSQLContainer&lt;&gt;("postgres:13");
    
    @DynamicPropertySource
    static void configureProperties(DynamicPropertyRegistry registry) {
        registry.add("spring.datasource.url", postgres::getJdbcUrl);
    }
    
    @Test
    void saveUser_ShouldPersistData() {
        User user = repository.save(new User(null, "container_user"));
        assertNotNull(user.getId());
    }
}</code></pre>
    <hr/>
    <h3>
     äº”ã€è¦†ç›–ç‡æå‡ç­–ç•¥
    </h3>
    <h4>
     5.1 Jacocoé…ç½®ï¼ˆMavenæ’ä»¶ï¼‰
    </h4>
    <pre></pre>
    <p>
     xml
    </p>
    <pre><code>&lt;plugin&gt;
    &lt;groupId&gt;org.jacoco&lt;/groupId&gt;
    &lt;artifactId&gt;jacoco-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;0.8.7&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;goals&gt;
                &lt;goal&gt;prepare-agent&lt;/goal&gt;
                &lt;goal&gt;report&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
    &lt;configuration&gt;
        &lt;rules&gt;
            &lt;rule&gt;
                &lt;element&gt;BUNDLE&lt;/element&gt;
                &lt;limits&gt;
                    &lt;limit&gt;
                        &lt;counter&gt;LINE&lt;/counter&gt;
                        &lt;value&gt;COVEREDRATIO&lt;/value&gt;
                        &lt;minimum&gt;0.95&lt;/minimum&gt;
                    &lt;/limit&gt;
                &lt;/limits&gt;
            &lt;/rule&gt;
        &lt;/rules&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
    <p>
     https://img-blog.csdnimg.cn/direct/9a1b3c4d4e5b4f7c9c3d4a5b0e8d4e4c.png
    </p>
    <hr/>
    <h3>
     å…­ã€å…­å¤§é¿å‘æŒ‡å—
    </h3>
    <ol>
     <li>
      <p>
       â€‹
       <strong>
        è¿‡åº¦Mocké™·é˜±
       </strong>
       <br/>
       âŒé”™è¯¯åšæ³•ï¼šMockæ‰€æœ‰ä¾èµ–ç±»
       <br/>
       âœ…æ­£ç¡®æ–¹æ¡ˆï¼šä»…Mockå¤–éƒ¨ä¾èµ–ï¼ˆæ•°æ®åº“ã€APIç­‰ï¼‰ï¼Œä¿æŒä¸šåŠ¡é€»è¾‘çœŸå®æ‰§è¡Œ
      </p>
     </li>
     <li>
      <p>
       â€‹
       <strong>
        æµ‹è¯•é¡ºåºä¾èµ–
       </strong>
      </p>
      <pre></pre>
      <p>
       java
      </p>
      <pre><code>@TestMethodOrder(MethodOrderer.Random.class) // å¼ºåˆ¶éšæœºæ‰§è¡Œé¡ºåº
class OrderSensitiveTest { ... }</code></pre>
     </li>
     <li>
      <p>
       â€‹
       <strong>
        å¿½ç•¥æ—¶é—´æ•æ„Ÿæµ‹è¯•
       </strong>
      </p>
      <pre></pre>
      <p>
       java
      </p>
      <pre><code>@Test
void scheduleTask_ShouldExecuteWithin5s() {
    assertTimeoutPreemptively(Duration.ofSeconds(5), () -&gt; {
        scheduler.executeTask();
    });
}</code></pre>
     </li>
     <li>
      <p>
       â€‹
       <strong>
        å¾ªç¯ä¾èµ–å¯¼è‡´Mockå¤±æ•ˆ
       </strong>
       <br/>
       â€‹
       <strong>
        è§£å†³æ–¹æ¡ˆ
       </strong>
       ï¼šä½¿ç”¨
       <code>
        @MockBean
       </code>
       æ›¿ä»£
       <code>
        @Autowired
       </code>
      </p>
     </li>
     <li>
      <p>
       â€‹
       <strong>
        é™æ€æ–¹æ³•Mockå†…å­˜æ³„æ¼
       </strong>
      </p>
      <pre></pre>
      <p>
       java
      </p>
      <pre><code>// ä½¿ç”¨try-with-resourcesç¡®ä¿èµ„æºé‡Šæ”¾
try (MockedStatic&lt;Utility&gt; mocked = mockStatic(Utility.class)) {
    // ... 
}</code></pre>
     </li>
     <li>
      <p>
       â€‹
       <strong>
        å¿½ç•¥å¼‚å¸¸åˆ†æ”¯æµ‹è¯•
       </strong>
      </p>
      <pre></pre>
      <p>
       java
      </p>
      <pre><code>@Test
void divide_WhenDivisorIsZero_ThrowException() {
    assertThrows(ArithmeticException.class, 
        () -&gt; calculator.divide(10, 0));
}</code></pre>
     </li>
    </ol>
    <hr/>
    <h3>
     ä¸ƒã€ä¼ä¸šçº§æœ€ä½³å®è·µ
    </h3>
    <ol>
     <li>
      <p>
       â€‹
       <strong>
        æµ‹è¯•é‡‘å­—å¡”æ¨¡å‹
       </strong>
       <br/>
       https://img-blog.csdnimg.cn/direct/8a1d3c4d4a5a4d6c9b3e7c8d9f4e4b4a.png
       <br/>
       â€‹
       <strong>
        å•å…ƒæµ‹è¯•
       </strong>
       â€‹ï¼ˆ70%ï¼‰ &gt; â€‹
       <strong>
        é›†æˆæµ‹è¯•
       </strong>
       â€‹ï¼ˆ20%ï¼‰ &gt; â€‹
       <strong>
        ç«¯åˆ°ç«¯æµ‹è¯•
       </strong>
       â€‹ï¼ˆ10%ï¼‰
      </p>
     </li>
     <li>
      <p>
       â€‹
       <strong>
        æµ‹è¯•å‘½åè§„èŒƒ
       </strong>
      </p>
      <pre></pre>
      <p>
       java
      </p>
      <pre><code>// æ ¼å¼ï¼š[Method]_[State]_[Result]
@Test
void getUserById_WhenIdIsNegative_ThrowIllegalArgument() { ... }</code></pre>
     </li>
     <li>
      <p>
       â€‹
       <strong>
        æŒç»­é›†æˆé›†æˆè¦†ç›–ç‡æ£€æŸ¥
       </strong>
      </p>
      <pre></pre>
      <p>
       yaml
      </p>
      <pre><code># GitHub Actionsç¤ºä¾‹
- name: Verify coverage
  run: mvn verify -Djacoco.check=true</code></pre>
     </li>
    </ol>
    <hr/>
    <h3>
     ç»“è¯­
    </h3>
    <p>
     é€šè¿‡æœ¬æ–‡çš„Mockito+JUnit5ç»„åˆæ‹³ï¼ŒæŸé‡‘èç³»ç»ŸæˆåŠŸå°†å•å…ƒæµ‹è¯•è¦†ç›–ç‡ä»58%æå‡è‡³97%ï¼Œç¼ºé™·ç‡ä¸‹é™76%ã€‚è®°ä½ï¼šâ€‹
     <strong>
      ä¸è¦ä¸ºäº†è¦†ç›–ç‡è€Œå†™æµ‹è¯•ï¼Œè¦ä¸ºè´¨é‡è€Œå†™ï¼â€‹
     </strong>
    </p>
    <p>
     <strong>
      æŠ€æœ¯æ‹“å±•
     </strong>
     ï¼š
     <br/>
     ğŸ‘‰ã€ŠSpring Booté›†æˆæµ‹è¯•å…¨æ”»ç•¥ã€‹
     <br/>
     ğŸ‘‰ã€ŠMockitoæ·±åº¦è§£æã€‹
    </p>
    <hr/>
    <p>
     <strong>
      #SpringBoot# #å•å…ƒæµ‹è¯•# #JUnit5# #Mockito# æ›´å¤šå¹²è´§ï¼Œå…³æ³¨ä½œè€…è·å–æœ€æ–°æŠ€æœ¯åŠ¨æ€ï¼
     </strong>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031323736323631392f:61727469636c652f64657461696c732f313436313734313532" class_="artid" style="display:none">
 </p>
</div>


