---
layout: post
title: "RedisSpringboot集成Redis"
date: 2025-03-08 06:13:51 +0800
description: "Redis｜Springboot集成Redis"
keywords: "Redis｜Springboot集成Redis"
categories: ['Redis']
tags: ['数据库', 'Spring', 'Redis', 'Redis', 'Go', 'Boot']
artid: "146109764"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146109764
    alt: "RedisSpringboot集成Redis"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146109764
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146109764
cover: https://bing.ee123.net/img/rand?artid=146109764
image: https://bing.ee123.net/img/rand?artid=146109764
img: https://bing.ee123.net/img/rand?artid=146109764
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Redis｜Springboot集成Redis
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <br/>
    <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/588cfe4a36014749b88f137cabf52291.png">
     <p>
     </p>
     <h3>
      <a id="_3">
      </a>
      总体概述
     </h3>
     <ul>
      <li>
       jedis-lettuce-RedisTemplate三者的联系
       <ul>
        <li>
         jedis第一代
        </li>
        <li>
         lettuce承上启下
        </li>
        <li>
         redistemplate着重使用
        </li>
       </ul>
      </li>
     </ul>
     <h3>
      <a id="JavaRedis_10">
      </a>
      本地Java连接Redis常见问题
     </h3>
     <ul>
      <li>
       bind配置请注释掉
      </li>
      <li>
       保护模式设置为no
      </li>
      <li>
       Linux系统的防火墙设置
      </li>
      <li>
       Redis服务器的IP地址和密码是否正确
      </li>
      <li>
       忘记写访问redis的服务端口号和auth密码
      </li>
     </ul>
     <h3>
      <a id="Jedis_17">
      </a>
      集成Jedis
     </h3>
     <ul>
      <li>
       是什么：Jedis Client是Redis官网推荐的一个面向Java客户端，库文件实现了对各类API进行封装调用
      </li>
      <li>
       步骤
       <ol>
        <li>
         建Module
        </li>
        <li>
         改POM.xml
        </li>
        <li>
         写application.yaml
        </li>
        <li>
         主启动
        </li>
        <li>
         业务类
        </li>
       </ol>
      </li>
     </ul>
     <pre><code class="prism language-bash"><span class="token operator">&lt;</span>?xml <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">"1.0"</span> <span class="token assign-left variable">encoding</span><span class="token operator">=</span><span class="token string">"UTF-8"</span>?<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>project <span class="token assign-left variable">xmlns</span><span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0"</span> xmlns:xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         xsi:schemaLocation<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>modelVersion<span class="token operator">&gt;</span><span class="token number">4.0</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/modelVersion<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>parent<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.springframework.boot<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring-boot-starter-parent<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">2.7</span>.1<span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span>/version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>relativePath/<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">!</span>-- lookup parent from repository --<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/parent<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com.luojia<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>redis7_study<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">0.0</span>.1-SNAPSHOT<span class="token operator">&lt;</span>/version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>redis7_study<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>Demo project <span class="token keyword">for</span> Spring Boot<span class="token operator">&lt;</span>/description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>properties<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>project.build.sourceEncoding<span class="token operator">&gt;</span>UTF-<span class="token operator"><span class="token file-descriptor important">8</span>&lt;</span>/project.build.sourceEncoding<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>maven.compiler.source<span class="token operator">&gt;</span><span class="token number">1</span>.<span class="token operator"><span class="token file-descriptor important">8</span>&lt;</span>/maven.compiler.source<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>maven.compiler.target<span class="token operator">&gt;</span><span class="token number">1</span>.<span class="token operator"><span class="token file-descriptor important">8</span>&lt;</span>/maven.compiler.target<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>junit.version<span class="token operator">&gt;</span><span class="token number">4.1</span><span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/junit.version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>log4j.version<span class="token operator">&gt;</span><span class="token number">1.2</span>.1<span class="token operator"><span class="token file-descriptor important">7</span>&lt;</span>/log4j.version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>lombok.version<span class="token operator">&gt;</span><span class="token number">1.16</span>.1<span class="token operator"><span class="token file-descriptor important">8</span>&lt;</span>/lombok.version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/properties<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>dependencies<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span>--SpringBoot 通用依赖模块--<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.springframework.boot<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring-boot-starter-web<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span>-- jedis --<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>redis.clients<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>jedis<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">4.3</span>.<span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span>/version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span>-- 通用基础配置 --<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>junit<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>junit<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token variable">${junit.version}</span><span class="token operator">&lt;</span>/version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>log4j<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>log4j<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token variable">${log4j.version}</span><span class="token operator">&lt;</span>/version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.projectlombok<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>lombok<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token variable">${lombok.version}</span><span class="token operator">&lt;</span>/version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.springframework.boot<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring-boot-starter-test<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>scope<span class="token operator">&gt;</span>test<span class="token operator">&lt;</span>/scope<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/dependencies<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>build<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>plugins<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>plugin<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.springframework.boot<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring-boot-maven-plugin<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/plugin<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>/plugins<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/build<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/project<span class="token operator">&gt;</span>
</code></pre>
     <pre><code class="prism language-bash"><span class="token assign-left variable">server.port</span><span class="token operator">=</span><span class="token number">7777</span>
<span class="token assign-left variable">spring.application.name</span><span class="token operator">=</span>redis7_study
</code></pre>
     <p>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c050ec341de5412b976eedecc6fdbf76.png">
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7cf038a7cab345f28335f5f03e682e4f.png"/>
      </img>
     </p>
     <h3>
      <a id="lettuce_104">
      </a>
      集成lettuce
     </h3>
     <ul>
      <li>
       <p>
        是什么：Lettuce是一个Redis的Java驱动包，Lettuce翻译为生菜，就是吃的那种生菜
       </p>
      </li>
      <li>
       <p>
        lettuce VS Jedis
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/b053010e9104414382de7a247a847262.png"/>
       </p>
      </li>
      <li>
       <p>
        改POM
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/13af70cf90c247eb958f15f3c1471163.png"/>
       </p>
      </li>
      <li>
       <p>
        业务类
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/08904274e967488aa8b1ba9093e2470a.png">
         <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/090808beeb7f4544b9ffaee3362a9d9d.png"/>
        </img>
       </p>
      </li>
     </ul>
     <h3>
      <a id="RedisTemplate_113">
      </a>
      集成RedisTemplate——推荐使用
     </h3>
     <h4>
      <a id="_114">
      </a>
      连接单机
     </h4>
     <ul>
      <li>
       boot整合Redis基础演示
      </li>
      <li>
       建module：redis7_study
      </li>
      <li>
       改pom
      </li>
     </ul>
     <pre><code class="prism language-xml"><span class="token comment">&lt;!-- SpringBoot 与Redis整合依赖 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- swagger2 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
     <ul>
      <li>
       写YML
      </li>
     </ul>
     <pre><code class="prism language-yaml">server.port=7777

spring.application.name=redis7_study

<span class="token comment"># ===========================logging===========================</span>
logging.level.root=info
logging.1evel.com.luojia.redis7_study.redis7=info
1ogging.pattern.console=%d<span class="token punctuation">{<!-- --></span>yyyy<span class="token punctuation">-</span>MM<span class="token punctuation">-</span>dd HH<span class="token punctuation">:</span>m<span class="token punctuation">:</span>ss.SSS<span class="token punctuation">}</span> <span class="token punctuation">[</span>%thread<span class="token punctuation">]</span> %<span class="token punctuation">-</span>5level %1ogger<span class="token punctuation">-</span> %msg%n

1ogging.file.name=F<span class="token punctuation">:</span>\workspace\数据结构和算法\Learning<span class="token punctuation">-</span>in<span class="token punctuation">-</span>practice\Redis\redis7<span class="token punctuation">-</span>study
1ogging.pattern.fi1e=%d<span class="token punctuation">{<!-- --></span>yyyy<span class="token punctuation">-</span>MM<span class="token punctuation">-</span>dd HH<span class="token punctuation">:</span>mm<span class="token punctuation">:</span>ss.SSS<span class="token punctuation">}</span> <span class="token punctuation">[</span>%thread<span class="token punctuation">]</span> %<span class="token punctuation">-</span>5level %logger<span class="token punctuation">-</span> %msg%n

<span class="token comment"># ===========================swagge===========================</span>
spring.swagger2.enabled=true
<span class="token comment">#在springboot2.6.X结合swagger2.9.X会提示documentationPluginsBootstrapper空指针异常，</span>
<span class="token comment">#原因是在springboot2.6.X中将SpringMVC默认路径匹配策略MAntPathMatcher更改为athPatternParser,</span>
<span class="token comment">#导致出错，解决办法是matching-strategy 切换回之前ant_path_matcher</span>
spring.mvc.pathmatch.matching<span class="token punctuation">-</span>strategy=ant_path_matcher

<span class="token comment"># ===========================redis单机===========================</span>
spring.redis.database=0
<span class="token comment">#修改为自己真实IP</span>
spring.redis.host=127.0.0.1
spring.redis.port=6379
spring.redis.password=123456
spring.redis.lettuce.pool.max<span class="token punctuation">-</span>active=8
spring.redis.1ettuce.pool.max<span class="token punctuation">-</span>wait=<span class="token punctuation">-</span>1ms
spring.redis.1ettuce.pool.max<span class="token punctuation">-</span>idle=8
spring.redis.lettuce.pool.min<span class="token punctuation">-</span>idle=0
</code></pre>
     <ul>
      <li>
       主启动
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a0c866e18c774920b1d6291a1ede2434.png"/>
      </li>
      <li>
       业务类-配置类
      </li>
     </ul>
     <pre><code class="prism language-java"><span class="token comment">// RedisConfig</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>luojia<span class="token punctuation">.</span>redis7_study<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>lettuce<span class="token punctuation">.</span></span><span class="token class-name">LettuceConnectionFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">GenericJackson2JsonRedisSerializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">StringRedisSerializer</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * *redis序列化的工具定置类，下面这个请一定开启配置
     * *127.0.0.1:6379&gt; keys *
     * *1) “ord:102” 序列化过
     * *2)“\xaclxedlxeelx05tixeelaord:102” 野生，没有序列化过
     * *this.redisTemplate.opsForValue(); //提供了操作string类型的所有方法
     * *this.redisTemplate.opsForList();// 提供了操作List类型的所有方法
     * *this.redisTemplate.opsForset(); //提供了操作set类型的所有方法
     * *this.redisTemplate.opsForHash(); //提供了操作hash类型的所有方认
     * *this.redisTemplate.opsForZSet(); //提供了操作zset类型的所有方法
     * param LettuceConnectionFactory
     * return
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">LettuceConnectionFactory</span> lettuceConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>lettuceConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置key序列化方式string</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置value的序列化方式json，使用GenericJackson2JsonRedisSerializer替换默认序列化</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
     <pre><code class="prism language-java"><span class="token comment">// SwaggerConfig</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>luojia<span class="token punctuation">.</span>redis7_study<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">ApiInfoBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">PathSelectors</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">RequestHandlerSelectors</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ApiInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>spi<span class="token punctuation">.</span></span><span class="token class-name">DocumentationType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>web<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span></span><span class="token class-name">Docket</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>swagger2<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">EnableSwagger2</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>format<span class="token punctuation">.</span></span><span class="token class-name">DateTimeFormatter</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableSwagger2</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwaggerConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.swagger2.enabled}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> enabled<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Docket</span> <span class="token function">createRestApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Docket</span> <span class="token punctuation">(</span><span class="token class-name">DocumentationType</span><span class="token punctuation">.</span><span class="token constant">SWAGGER_2</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>enabled<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">apis</span><span class="token punctuation">(</span><span class="token class-name">RequestHandlerSelectors</span><span class="token punctuation">.</span><span class="token function">basePackage</span><span class="token punctuation">(</span><span class="token string">"com.luojia.redis7_study.config"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//你自己的package</span>
                <span class="token punctuation">.</span>paths <span class="token punctuation">(</span><span class="token class-name">PathSelectors</span><span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">ApiInfo</span> <span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ApiInfoBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">"springboot利用swagger2构建api接口文档 "</span><span class="token operator">+</span><span class="token string">"\t"</span>
                        <span class="token operator">+</span> <span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span> <span class="token string">"springboot+redis整合"</span> <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">termsOfServiceUrl</span><span class="token punctuation">(</span><span class="token string">"https://github.com/Romantic-Lei"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
     <ul>
      <li>
       业务类-service
      </li>
     </ul>
     <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>luojia<span class="token punctuation">.</span>redis7_study<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">UUID</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadLocalRandom</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ORDER_KEY</span><span class="token operator">=</span><span class="token string">"ord:"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> keyId <span class="token operator">=</span> <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> serialNo <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token constant">ORDER_KEY</span><span class="token operator">+</span>keyId<span class="token punctuation">;</span>
        <span class="token class-name">String</span> value <span class="token operator">=</span> <span class="token string">"JD"</span> <span class="token operator">+</span> serialNo<span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"***key:{}"</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"***value:{}"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getOrderById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> keyId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">ORDER_KEY</span><span class="token operator">+</span>keyId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
     <ul>
      <li>
       业务类-controller
      </li>
     </ul>
     <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>luojia<span class="token punctuation">.</span>redis7_study<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>luojia<span class="token punctuation">.</span>redis7_study<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">OrderService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Api</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiOperation</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>models<span class="token punctuation">.</span>auth<span class="token punctuation">.</span></span><span class="token class-name">In</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>tags<span class="token operator">=</span><span class="token string">"订单接口"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"新增订单"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/order/add"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        orderService<span class="token punctuation">.</span><span class="token function">addOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"根据keyId查询订单"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/order/query"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">queryOrder</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> keyId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> orderService<span class="token punctuation">.</span><span class="token function">getOrderById</span><span class="token punctuation">(</span>keyId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
     <ul>
      <li>
       测试
       <ul>
        <li>
         项目启动，连接swagger：
         <a href="http://localhost:7777/swagger-ui.html" rel="nofollow">
          http://localhost:7777/swagger-ui.html
         </a>
        </li>
        <li>
         序列化问题
         <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8be709c359ee434cb7cdb133a59aa2fe.png"/>
        </li>
        <li>
         为什么会这样？RedisTemplate使用的是JDK序列化方式（默认）惹的祸
         <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/09e4193fe89b48ada6aa8ff0ee0c4035.png"/>
         <br/>
         <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e55ebc8cf9e04fb1a0331678d665f79b.png"/>
         <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e245c94d24214f3f8035ae779b8c3980.png"/>
        </li>
       </ul>
      </li>
     </ul>
     <h4>
      <a id="_356">
      </a>
      连接集群
     </h4>
     <ul>
      <li>
       启动Redis集群6台实例
      </li>
      <li>
       第一次改写YML
      </li>
     </ul>
     <pre><code class="prism language-yaml"><span class="token comment"># ===========================redis集群===========================</span>
spring.redis.password=111111
<span class="token comment"># 获取失败 最大重定向次数</span>
spring.redis.cluster.max<span class="token punctuation">-</span>redirects=3
spring.redis.lettuce.pool.max<span class="token punctuation">-</span>active=8
spring.redis.1ettuce.pool.max<span class="token punctuation">-</span>wait=<span class="token punctuation">-</span>1ms
spring.redis.1ettuce.pool.max<span class="token punctuation">-</span>idle=8
spring.redis.lettuce.pool.min<span class="token punctuation">-</span>idle=0
spring.redis.cluster.nodes=192.168.111.175<span class="token punctuation">:</span><span class="token number">6381</span><span class="token punctuation">,</span>192.168.111.175<span class="token punctuation">:</span><span class="token number">6382</span><span class="token punctuation">,</span>192.168.111.176<span class="token punctuation">:</span><span class="token number">6383</span><span class="token punctuation">,</span>192.168.111.176<span class="token punctuation">:</span><span class="token number">6384</span>
</code></pre>
     <ul>
      <li>
       直接通过微服务访问Redis集群：一切正常 （
       <a href="http://localhost:7777/swagger-ui.html" rel="nofollow">
        http://localhost:7777/swagger-ui.html
       </a>
       ）
      </li>
      <li>
       问题来了：
       <ol>
        <li>
         人为模拟，master-6381机器意外宕机，手动shutdown
        </li>
        <li>
         先对redis集群用命令的方式，手动验证各种读写命令，看看6384是否上位
        </li>
        <li>
         Redis Cluster集群能自动感知并自动完成主备切换，对应的slave6384会被选举为新的master节点
        </li>
        <li>
         通过redis客户端连接6384可以正常进行读写操作
        </li>
        <li>
         微服务客户端再次读写访问试试
         <ul>
          <li>
           <p>
            故障现象
           </p>
           <ul>
            <li>
             SpringBoot客户端没有动态感知RedisCluster的最新集群信息
            </li>
            <li>
             经典故障-故障演练：Redis Cluster集群部署采用了3主3从拓扑结构，数据读写访问master节点，slave节点负责备份。当master宕机主从切换成功，redis手动OK，but 2个经典故障
             <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2558753fad5047b696b42d641fc9556d.png"/>
            </li>
           </ul>
          </li>
          <li>
           <p>
            导致原因：SpringBoot 2.X版本，Redis默认的连接池采用Lettuce，当Redis集群节点发生变化后，Letture默认是不会刷新节点拓扑
           </p>
          </li>
          <li>
           <p>
            解决方案
           </p>
           <ol>
            <li>
             排除lettuce采用Jedis（不推荐）
             <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2934de75eda8440095949da578bb443b.png"/>
            </li>
            <li>
             修改源码，重写连接工厂实例（极度不推荐）
            </li>
            <li>
             刷新节点集群拓扑动态感应
             <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7fc3b73bad10429280a745d0bea43a3c.png"/>
             <ul>
              <li>
               解决方法：
               <ul>
                <li>
                 调用 RedisClusterClient.reloadPartitions
                </li>
                <li>
                 后台基于时间间隔的周期刷新
                </li>
                <li>
                 后台基于持续的断开和移动、重定向的自适应更新
                </li>
               </ul>
              </li>
             </ul>
            </li>
           </ol>
          </li>
          <li>
           <p>
            第二次改写YML
            <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ca604759d915444fbb6f9779d683954e.png"/>
           </p>
          </li>
         </ul>
        </li>
       </ol>
      </li>
     </ul>
    </img>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34343034333935322f:61727469636c652f64657461696c732f313436313039373634" class_="artid" style="display:none">
 </p>
</div>


