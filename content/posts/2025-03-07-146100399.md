---
layout: post
title: "SSM架构-java后台-实现rtsp流转hls流,在前端html上实现视频播放"
date: 2025-03-07 17:45:20 +0800
description: "SSM架构 +java后台 实现rtsp流转hls流，在前端html上实现视频播放 ，集合到SSM框架中"
keywords: "SSM架构 +java后台 实现rtsp流转hls流，在前端html上实现视频播放"
categories: ['摄像头', '实时预览', 'Hls']
tags: ['前端', 'Ssm', 'Rtsp', 'Java', 'Hls']
artid: "146100399"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146100399
    alt: "SSM架构-java后台-实现rtsp流转hls流,在前端html上实现视频播放"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146100399
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146100399
cover: https://bing.ee123.net/img/rand?artid=146100399
image: https://bing.ee123.net/img/rand?artid=146100399
img: https://bing.ee123.net/img/rand?artid=146100399
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     SSM架构 +java后台 实现rtsp流转hls流，在前端html上实现视频播放
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-dracula" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     序言：书接上文，我们继续
     <br/>
     <a href="https://blog.csdn.net/qq_39951524/article/details/146098817?sharetype=blogdetail&amp;sharerId=146098817&amp;sharerefer=PC&amp;sharesource=qq_39951524&amp;spm=1011.2480.3001.8118">
      SSM架构 +Nginx+FFmpeg实现rtsp流转hls流，在前端html上实现视频播放
     </a>
    </p>
    <h2>
     <a id="rtsphlsJava_3">
     </a>
     步骤一：把rtsp流转化为hls流，用Java代码进行转换
    </h2>
    <pre><code class="prism language-java">



<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>tools</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedReader</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStreamReader</span></span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RTSPtoHLS</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"111111111111111111"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       
		<span class="token class-name">String</span> inputVideoPath<span class="token operator">=</span><span class="token string">"rtsp://admin:bfm100766@192.168.1.64:554/streaming/channels/101"</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> outputVideoPath <span class="token operator">=</span><span class="token string">"D:/nginx/html/orb/test.m3u8"</span><span class="token punctuation">;</span>
		
		<span class="token function">generateVideo</span><span class="token punctuation">(</span> inputVideoPath<span class="token punctuation">,</span>  outputVideoPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	
	
	<span class="token comment">//视频拼接的接口</span>
		 <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">generateVideo</span><span class="token punctuation">(</span><span class="token class-name">String</span> inputVideoPath<span class="token punctuation">,</span> <span class="token class-name">String</span> outputVideoPath<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
		            <span class="token comment">// 构建FFmpeg命令，这里假设是将输入视频与模板视频合成，并输出成片</span>
		            <span class="token comment">// 命令示例: ffmpeg -i input.mp4 -i template.mp4 -filter_complex "your_complex_filter_graph" output.mp4</span>
		            <span class="token comment">// "your_complex_filter_graph" 是你用来应用模板的复杂滤波图</span>
		        	<span class="token comment">// ffmpeg -fflags +genpts -i rtsp://admin:bfm100766@192.168.1.64:554/streaming/channels/101 -c copy -f hls -hls_time 2.0 -hls_list_size 1  D:/nginx/html/hls/test.m3u8</span>
		            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> command <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span>
		                <span class="token string">"ffmpeg"</span><span class="token punctuation">,</span>
		                <span class="token string">"-fflags"</span><span class="token punctuation">,</span> <span class="token string">"+genpts"</span><span class="token punctuation">,</span>
		                <span class="token string">"-i"</span><span class="token punctuation">,</span> inputVideoPath<span class="token punctuation">,</span>
		                <span class="token string">"-c"</span><span class="token punctuation">,</span> <span class="token string">"copy"</span><span class="token punctuation">,</span>
		                <span class="token string">"-f"</span><span class="token punctuation">,</span> <span class="token string">"hls"</span><span class="token punctuation">,</span>
		                <span class="token string">"-hls_time"</span><span class="token punctuation">,</span><span class="token string">"10"</span><span class="token punctuation">,</span>
		                <span class="token string">"-hls_list_size"</span><span class="token punctuation">,</span><span class="token string">"10"</span><span class="token punctuation">,</span>
		                outputVideoPath
		            <span class="token punctuation">}</span><span class="token punctuation">;</span>                                        
		            <span class="token class-name">ProcessBuilder</span> processBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
		            <span class="token class-name">Process</span> process <span class="token operator">=</span> processBuilder<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		            <span class="token comment">// 读取错误流并打印</span>
		            <span class="token class-name">BufferedReader</span> errorReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">getErrorStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		            <span class="token class-name">String</span> line<span class="token punctuation">;</span>
		            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> errorReader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
		            <span class="token punctuation">}</span>
		            <span class="token comment">// 等待进程结束　</span>
		            process<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Video generation completed!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> <span class="token operator">|</span> <span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Error generating video."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		        <span class="token punctuation">}</span>
				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		    <span class="token punctuation">}</span>
	
	
	
<span class="token punctuation">}</span>

</code></pre>
    <h2>
     <a id="SSM_Controller__75">
     </a>
     步骤二：SSM 架构中Controller层 如何调用
    </h2>
    <pre><code class="prism language-java">
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Calendar</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Timer</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpSession</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResponseBody</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSONObject</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tools<span class="token punctuation">.</span></span><span class="token class-name">FileCleanupTask</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tools<span class="token punctuation">.</span></span><span class="token class-name">RTSPtoHLS</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/rh"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RtspHlsController</span> <span class="token punctuation">{<!-- --></span>

	
	       <span class="token comment">//1跳转到前端首页面</span>
			<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/rh_login.html"</span><span class="token punctuation">)</span>
			<span class="token keyword">public</span> <span class="token class-name">String</span>  <span class="token function">getdrLogin</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				
				
				
			     <span class="token keyword">return</span> <span class="token string">"rh_login"</span><span class="token punctuation">;</span>
				
			<span class="token punctuation">}</span>
	
			<span class="token comment">//使用传递 参数改变全局变量的参数</span>
			 <span class="token annotation punctuation">@ResponseBody</span>
			 <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/setHls"</span><span class="token punctuation">)</span>
				<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">set_Entity</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span>			
			<span class="token punctuation">{<!-- --></span> 
				
				 <span class="token class-name">JSONObject</span>  jsonObject<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					
				 <span class="token comment">//第一步先清空nginx中hls文件夹中的内容 </span>
				    <span class="token class-name">String</span> directoryPath <span class="token operator">=</span> <span class="token string">"D:/nginx/html/hls/"</span><span class="token punctuation">;</span>
				    
			        <span class="token keyword">long</span> thresholdSize <span class="token operator">=</span> <span class="token number">2000</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token comment">//  文件阈值大小，例如10KB</span>
			        <span class="token comment">// 创建定时任务</span>
			        <span class="token class-name">FileCleanupTask</span> cleanupTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileCleanupTask</span><span class="token punctuation">(</span>directoryPath<span class="token punctuation">,</span> thresholdSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
			        
			        <span class="token comment">// 创建定时器并设置初始延迟为0，之后每5分钟执行一次任务（5 * 60 * 1000毫秒）</span>
			        <span class="token class-name">Timer</span> timer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			        timer<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span>cleanupTask<span class="token punctuation">,</span> <span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始延迟为1000毫秒，之后每5分钟执行一次（5分钟=5*60*1000毫秒）</span>
			        
				 
				 
				 <span class="token comment">//第二步nginx中录入中hls文件夹中内容 </span>
				    <span class="token comment">//rtsp视频流的访问路径</span>
				    <span class="token class-name">String</span> inputVideoPath<span class="token operator">=</span><span class="token string">"rtsp://admin:bfm100766@192.168.1.64:554/streaming/channels/101"</span><span class="token punctuation">;</span>
					
					<span class="token comment">//nginx的路径 把hls视频流输入到nginx服务器 hls文件夹中下</span>
					<span class="token class-name">String</span> outputVideoPath <span class="token operator">=</span><span class="token string">"D:/nginx/html/hls/test.m3u8"</span><span class="token punctuation">;</span>
					
					<span class="token class-name">RTSPtoHLS</span><span class="token punctuation">.</span><span class="token function">generateVideo</span><span class="token punctuation">(</span> inputVideoPath<span class="token punctuation">,</span>  outputVideoPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
					
					jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"saveUrl"</span><span class="token punctuation">,</span> outputVideoPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
				 
				 
				 <span class="token keyword">return</span>   jsonObject<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			 
			
			<span class="token comment">//使用传递 参数改变全局变量的参数</span>
			 <span class="token annotation punctuation">@ResponseBody</span>
			 <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/setHls1"</span><span class="token punctuation">)</span>
				<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">set_Entity1</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span>			
			<span class="token punctuation">{<!-- --></span> 
				
				 <span class="token class-name">JSONObject</span>  jsonObject<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					
				 <span class="token comment">//第一步先清空nginx中hls文件夹中的内容 </span>
				    <span class="token class-name">String</span> directoryPath <span class="token operator">=</span> <span class="token string">"D:/nginx/html/hls/"</span><span class="token punctuation">;</span>
				    
			        <span class="token keyword">long</span> thresholdSize <span class="token operator">=</span> <span class="token number">5000</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token comment">//  文件阈值大小，例如5000KB==5M</span>
			        <span class="token comment">// 创建定时任务</span>
			        <span class="token class-name">FileCleanupTask</span> cleanupTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileCleanupTask</span><span class="token punctuation">(</span>directoryPath<span class="token punctuation">,</span> thresholdSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
			        
			        <span class="token comment">// 创建定时器并设置初始延迟为0，之后每5分钟执行一次任务（5 * 60 * 1000毫秒）</span>
			        <span class="token class-name">Timer</span> timer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			        <span class="token comment">//timer.schedule(cleanupTask, 60*60*1000, 60 * 60 * 1000); // 初始延迟为1000毫秒，之后每5分钟执行一次（5分钟=5*60*1000毫秒）</span>
			        
			        <span class="token comment">//********设置每天的12点，执行某一函数************</span>
			        
			        <span class="token comment">// 计算下一个12点的时间</span>
			        <span class="token class-name">Calendar</span> calendar <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			        calendar<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">HOUR_OF_DAY</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置小时为12</span>
			        calendar<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">MINUTE</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置分钟为0</span>
			        calendar<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">SECOND</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置秒为0</span>
			        calendar<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">MILLISECOND</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置毫秒为0</span>
			 
			        <span class="token comment">// 如果当前时间已超过今天的12点，则设置明天的12点</span>
			        <span class="token keyword">if</span> <span class="token punctuation">(</span>calendar<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			            calendar<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 明天的日期</span>
			        <span class="token punctuation">}</span>
			        
			        <span class="token comment">// 安排任务在计算出的时间执行</span>
			        timer<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span>cleanupTask<span class="token punctuation">,</span> calendar<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			        
			        
				 
				 
				 <span class="token comment">//第二步nginx中录入中hls文件夹中内容 </span>
				    <span class="token comment">//rtsp视频流的访问路径</span>
				    <span class="token class-name">String</span> inputVideoPath<span class="token operator">=</span><span class="token string">"rtsp://admin:bfm100766@192.168.1.64:554/streaming/channels/101"</span><span class="token punctuation">;</span>
					
					<span class="token comment">//nginx的路径 把hls视频流输入到nginx服务器 hls文件夹中下</span>
					<span class="token class-name">String</span> outputVideoPath <span class="token operator">=</span><span class="token string">"D:/nginx/html/hls/test.m3u8"</span><span class="token punctuation">;</span>
					
					<span class="token class-name">RTSPtoHLS</span><span class="token punctuation">.</span><span class="token function">generateVideo</span><span class="token punctuation">(</span> inputVideoPath<span class="token punctuation">,</span>  outputVideoPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
					
					jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"saveUrl"</span><span class="token punctuation">,</span> outputVideoPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
				 
				 
				 <span class="token keyword">return</span>   jsonObject<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
	
	
<span class="token punctuation">}</span>



</code></pre>
    <h2>
     <a id="htmlhls_214">
     </a>
     步骤三：html播放hls流视频
    </h2>
    <pre><code class="prism language-java">

<span class="token operator">&lt;</span><span class="token operator">%</span>@ page language<span class="token operator">=</span><span class="token string">"java"</span> contentType<span class="token operator">=</span><span class="token string">"text/html; charset=UTF-8"</span>
    pageEncoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span><span class="token annotation punctuation">@taglib</span> prefix<span class="token operator">=</span><span class="token string">"c"</span> uri<span class="token operator">=</span><span class="token string">"http://java.sun.com/jsp/jstl/core"</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span><span class="token annotation punctuation">@taglib</span> uri<span class="token operator">=</span><span class="token string">"http://java.sun.com/jsp/jstl/fmt"</span> prefix<span class="token operator">=</span><span class="token string">"fmt"</span> <span class="token operator">%</span><span class="token operator">&gt;</span>  
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>html<span class="token punctuation">&gt;</span></span>
	
	 <span class="token generics"><span class="token punctuation">&lt;</span>head<span class="token punctuation">&gt;</span></span>
        <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"X-UA-Compatible"</span> content<span class="token operator">=</span><span class="token string">"IE=edge,chrome=1"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width,initial-scale=1.0, maximum-scale=1.0"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>title<span class="token punctuation">&gt;</span></span><span class="token constant">FLV</span><span class="token operator">-</span><span class="token constant">HLS</span> 监控视频播放展示界面<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"${pageContext.request.contextPath }/statics/common/commonCss/bootstrap.min.css"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"${pageContext.request.contextPath }/statics/common/demo.css"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> src<span class="token operator">=</span><span class="token string">"${pageContext.request.contextPath }/statics/common/commonJs/jquery.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> src<span class="token operator">=</span><span class="token string">"${pageContext.request.contextPath }/statics/common/commonJs/bootstrap.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> src<span class="token operator">=</span><span class="token string">"${pageContext.request.contextPath }/statics/common/player/dhhls.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> src<span class="token operator">=</span><span class="token string">"${pageContext.request.contextPath }/statics/common/player/dhflv.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
	
	
	<span class="token generics"><span class="token punctuation">&lt;</span>style<span class="token punctuation">&gt;</span></span>
	
	<span class="token punctuation">.</span>mgt20 <span class="token punctuation">{<!-- --></span>
		margin<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>
		margin<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">--</span> $<span class="token punctuation">{<!-- --></span>saveUrl<span class="token punctuation">}</span> <span class="token operator">--</span><span class="token operator">%</span><span class="token operator">&gt;</span>
	<span class="token generics"><span class="token punctuation">&lt;</span>body<span class="token punctuation">&gt;</span></span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"demo-box"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"title"</span><span class="token operator">&gt;</span><span class="token constant">HLS</span>播放器<span class="token class-name">Demo</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"content"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 左侧导航栏 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>                 <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"nav-box"</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>ul <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"nav nav-pills"</span> role<span class="token operator">=</span><span class="token string">"tablist"</span> id<span class="token operator">=</span><span class="token string">"mainTabs"</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>li role<span class="token operator">=</span><span class="token string">"presentation"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"nav-link list-group-item active-item"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"#home"</span> aria<span class="token operator">-</span>controls<span class="token operator">=</span><span class="token string">"home"</span> role<span class="token operator">=</span><span class="token string">"tab"</span> data<span class="token operator">-</span>toggle<span class="token operator">=</span><span class="token string">"tab"</span><span class="token operator">&gt;</span><span class="token constant">HLS</span> 视频流播放<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>li role<span class="token operator">=</span><span class="token string">"presentation"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"nav-link list-group-item"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"#profile"</span> aria<span class="token operator">-</span>controls<span class="token operator">=</span><span class="token string">"profile"</span> role<span class="token operator">=</span><span class="token string">"tab"</span> data<span class="token operator">-</span>toggle<span class="token operator">=</span><span class="token string">"tab"</span><span class="token operator">&gt;</span><span class="token constant">FLV</span> 视频流播放<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> tab主要内容 <span class="token operator">--</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tab-content content-box"</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token constant">HLS</span> 播放 <span class="token operator">--</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>div role<span class="token operator">=</span><span class="token string">"tabpanel"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tab-pane active"</span> id<span class="token operator">=</span><span class="token string">"home"</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 步骤引导 <span class="token operator">--</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"common-step play-step"</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sec-title"</span><span class="token operator">&gt;</span><span class="token constant">HLS</span>视频流播放步骤<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"step-box"</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"step-item"</span><span class="token operator">&gt;</span><span class="token number">1.</span> 获取<span class="token constant">HLS</span>实时流地址（如何获取流地址请查看<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"https://open-icc.dahuatech.com/hlsplayer/#5"</span><span class="token operator">&gt;</span><span class="token constant">HLS</span>详细说明<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>），获取<span class="token constant">HLS</span>录像回放流地址（如何获取流地址请查看<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"https://open-icc.dahuatech.com/#/home?url=%3Fnav%3Dwiki%2Fadmin%2Freplay.html&amp;version=enterprisebase/5.0.15&amp;blank=true"</span><span class="token operator">&gt;</span>详细说明<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>）<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"line-with-arrow"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"step-item"</span><span class="token operator">&gt;</span><span class="token number">3.</span> 播放配置输入流地址<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"step-item"</span><span class="token operator">&gt;</span><span class="token number">4.</span> 开始播放<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 播放配置<span class="token operator">--</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"common-step play-setting"</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sec-title"</span><span class="token operator">&gt;</span>播放配置<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"oneInput"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"mgt20 mgl10"</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span>label style<span class="token operator">=</span><span class="token string">"display: none;"</span><span class="token operator">&gt;</span>流地址：<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> style<span class="token operator">=</span><span class="token string">"display: none;"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"stream-input"</span> id<span class="token operator">=</span><span class="token string">"oneStartUrl"</span> placeholder<span class="token operator">=</span><span class="token string">"请输入流地址"</span> value<span class="token operator">=</span><span class="token string">"http://192.168.1.103:80/hls/test.m3u8"</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"common-btn"</span> id<span class="token operator">=</span><span class="token string">"oneStartVideo"</span><span class="token operator">&gt;</span>播放<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"common-btn"</span> style<span class="token operator">=</span><span class="token string">"display: none;"</span> id<span class="token operator">=</span><span class="token string">"downloadVideo"</span><span class="token operator">&gt;</span>录像下载<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token generics"><span class="token punctuation">&lt;</span>br<span class="token punctuation">&gt;</span></span><span class="token generics"><span class="token punctuation">&lt;</span>br<span class="token punctuation">&gt;</span></span>
                            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 播放器 <span class="token operator">--</span><span class="token operator">&gt;</span>
                        <span class="token generics"><span class="token punctuation">&lt;</span>div<span class="token punctuation">&gt;</span></span>
                            <span class="token operator">&lt;</span>video <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"video-box"</span> id<span class="token operator">=</span><span class="token string">"myVideo"</span> controls preload<span class="token operator">=</span><span class="token string">"auto"</span> autoplay<span class="token operator">=</span><span class="token string">"autoplay"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>video<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                       <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>  <span class="token generics"><span class="token punctuation">&lt;</span>div<span class="token punctuation">&gt;</span></span><span class="token generics"><span class="token punctuation">&lt;</span>strong<span class="token punctuation">&gt;</span></span>补充说明<span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span><span class="token operator">:</span> hls <span class="token constant">H265</span>视频编码播放仅<span class="token class-name">Chrome104</span>及以上版本支持<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                   
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		 	
		
		
	<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
	
	
	    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"${pageContext.request.contextPath }/statics/common/player/dhflv.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"${pageContext.request.contextPath }/statics/common/player/dhhls.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>
        
           <span class="token comment">//异步请求处理，开始进行视频流输出</span>
			        $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
						async<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>   
						type<span class="token operator">:</span><span class="token string">"post"</span><span class="token punctuation">,</span>
						url<span class="token operator">:</span><span class="token string">"${pageContext.request.contextPath }/rh/setHls1"</span><span class="token punctuation">,</span>
						dataType<span class="token operator">:</span><span class="token string">"json"</span><span class="token punctuation">,</span>
						success<span class="token operator">:</span><span class="token function">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
							
							 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"nginx 输出视频流的绝对路径路径"</span><span class="token operator">+</span>data<span class="token punctuation">.</span>saveUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
				        	
						<span class="token punctuation">}</span><span class="token punctuation">,</span>
						error<span class="token operator">:</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
							<span class="token comment">//layer.msg('出现异常');</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        
        
        
                <span class="token comment">//菜单切换</span>
                $<span class="token punctuation">(</span>'#mainTabs a'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>function <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    $<span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tab</span><span class="token punctuation">(</span><span class="token char">'show'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    $<span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">siblings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token char">'active'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    $<span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">siblings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span>'active<span class="token operator">-</span>item active'<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    $<span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span>'active<span class="token operator">-</span>item'<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">/**
                 * 第一部分
                 * HLS实时播放
                **/</span>
                <span class="token comment">//检测浏览器是否支持HLS 播放器</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Hls</span><span class="token punctuation">.</span><span class="token function">isSupported</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"浏览器不支持 HLS, 请升级！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
                <span class="token comment">//视频流帧数据、用于下载</span>
                let fmp4Data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                    audio<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    video<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                let url <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
                let hlsplayer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                $<span class="token punctuation">(</span>'#oneStartVideo'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    url <span class="token operator">=</span> $<span class="token punctuation">(</span>'#oneStartUrl'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>url<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请输入流地址！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">//初始化录像配置</span>
                    $<span class="token punctuation">(</span>'#downloadVideo'<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"录像下载"</span><span class="token punctuation">;</span>
                    fmp4Data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                        audio<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        video<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
                    <span class="token comment">//开始播放</span>
                    <span class="token function">playHls</span><span class="token punctuation">(</span>'myVideo'<span class="token punctuation">,</span>url<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
				
				
				$<span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
				     url <span class="token operator">=</span> $<span class="token punctuation">(</span>'#oneStartUrl'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					
					<span class="token comment">//url ="http://127.0.0.1:80/hls/test.m3u8";</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>url<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请输入流地址！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">//初始化录像配置</span>
                    $<span class="token punctuation">(</span>'#downloadVideo'<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"录像下载"</span><span class="token punctuation">;</span>
                    fmp4Data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                        audio<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        video<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
                    <span class="token comment">//开始播放</span>
                   <span class="token function">playHls</span><span class="token punctuation">(</span>'myVideo'<span class="token punctuation">,</span>url<span class="token punctuation">)</span>
				  
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				
				
			<span class="token comment">//定时重新播放视频</span>
			function <span class="token function">refreshPageAfter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                	
                	<span class="token comment">//console.log("设定时间符合当前时间")</span>
				  
				  url <span class="token operator">=</span> $<span class="token punctuation">(</span>'#oneStartUrl'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					
					<span class="token comment">//url ="http://127.0.0.1:80/hls/test.m3u8";</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>url<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请输入流地址！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">//初始化录像配置</span>
                    $<span class="token punctuation">(</span>'#downloadVideo'<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"录像下载"</span><span class="token punctuation">;</span>
                    fmp4Data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                        audio<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        video<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
                    <span class="token comment">//开始播放</span>
                   <span class="token function">playHls</span><span class="token punctuation">(</span>'myVideo'<span class="token punctuation">,</span>url<span class="token punctuation">)</span>
				  
			 <span class="token punctuation">}</span>

			<span class="token comment">//启动定时器</span>
			<span class="token comment">//self.setInterval("refreshPageAfter()", 61 * 60 *1000);</span>
		 
				
			
			<span class="token comment">//莫一时间定时器</span>
			
		
		 
		function <span class="token function">scheduleRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		    <span class="token keyword">var</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		    <span class="token keyword">var</span> targetTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		    <span class="token comment">// 设置目标时间为今天的12点15分</span>
		    targetTime<span class="token punctuation">.</span><span class="token function">setHours</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		    
		    <span class="token comment">// 如果当前时间已经超过12点15分，则将目标时间设置为明天的12点15分</span>
		    <span class="token keyword">if</span> <span class="token punctuation">(</span>now <span class="token operator">&gt;=</span> targetTime<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		        targetTime<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span>targetTime<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		    <span class="token punctuation">}</span>
		    
		    <span class="token comment">// 计算从现在到目标时间的毫秒数</span>
		    <span class="token keyword">var</span> delay <span class="token operator">=</span> targetTime <span class="token operator">-</span> now<span class="token punctuation">;</span>
		    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"设定时间符合当前时间"</span><span class="token operator">+</span>delay<span class="token punctuation">)</span>
		    
		    <span class="token comment">// 设置延时，直到目标时间到达</span>
		    <span class="token function">setTimeout</span><span class="token punctuation">(</span>refreshPageAfter<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
		    
		    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"设定时间符合当前时间"</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		 
		<span class="token comment">//初始化调用== 调用函数以设置定时刷新</span>
		<span class="token function">scheduleRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			
			
			
			
			
			
				
				
                <span class="token comment">//创建hls播放器</span>
                function <span class="token function">playHls</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> url<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//先触发销毁</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>hlsplayer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        hlsplayer<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">//创建播放</span>
                    let video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Hls</span><span class="token punctuation">.</span><span class="token function">isSupported</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        hlsplayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hls</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        hlsplayer<span class="token punctuation">.</span><span class="token function">loadSource</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        hlsplayer<span class="token punctuation">.</span><span class="token function">attachMedia</span><span class="token punctuation">(</span>video<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        hlsplayer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token class-name">Hls<span class="token punctuation">.</span>Events</span><span class="token punctuation">.</span><span class="token constant">MANIFEST_PARSED</span><span class="token punctuation">,</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            hlsplayer<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>video<span class="token punctuation">.</span><span class="token function">canPlayType</span><span class="token punctuation">(</span>'application<span class="token operator">/</span>vnd<span class="token punctuation">.</span>apple<span class="token punctuation">.</span>mpegurl'<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"apple原生"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 如果支持原生播放</span>
                        video<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>
						video<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                   
                <span class="token punctuation">}</span>
                <span class="token comment">//hls录像下载</span>
                $<span class="token punctuation">(</span>'#downloadVideo'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>hlsplayer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请先触发播放"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span>
                    <span class="token punctuation">}</span>
                    let text <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>text <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">"录像下载"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        $<span class="token punctuation">(</span>'#downloadVideo'<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"录像中"</span><span class="token punctuation">;</span>
                        <span class="token function">playHls</span><span class="token punctuation">(</span>'myVideo'<span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        hlsplayer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token class-name">Hls<span class="token punctuation">.</span>Events</span><span class="token punctuation">.</span><span class="token constant">BUFFER_APPENDING</span><span class="token punctuation">,</span> function <span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token comment">//录像数据缓存</span>
                            fmp4Data<span class="token punctuation">[</span>data<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fmp4Data<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        $<span class="token punctuation">(</span>'#downloadVideo'<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"录像下载"</span><span class="token punctuation">;</span>
                        <span class="token comment">//结束并下载录像</span>
                        let type <span class="token operator">=</span> <span class="token string">"video"</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>fmp4Data<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">arrayConcat</span><span class="token punctuation">(</span>fmp4Data<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
                                type<span class="token operator">:</span> 'application<span class="token operator">/</span>octet<span class="token operator">-</span>stream'<span class="token punctuation">,</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">const</span> filename <span class="token operator">=</span> type <span class="token operator">+</span> <span class="token char">'-'</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token char">'.mp4'</span><span class="token punctuation">;</span>
                            let aDom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'a'</span><span class="token punctuation">)</span>
                            aDom<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"download"</span><span class="token punctuation">,</span>`hlsjs<span class="token operator">-</span>` <span class="token operator">+</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            aDom<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            aDom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token char">'none'</span><span class="token punctuation">;</span>
                            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>aDom<span class="token punctuation">)</span>
                            aDom<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>aDom<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token comment">//重置录像数据</span>
                        fmp4Data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                            audio<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                            video<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">//组合视频数据</span>
                function <span class="token function">arrayConcat</span><span class="token punctuation">(</span>inputArray<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">const</span> totalLength <span class="token operator">=</span> inputArray<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>function <span class="token punctuation">(</span>prev<span class="token punctuation">,</span> cur<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">return</span> prev <span class="token operator">+</span> cur<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>totalLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    let offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                    inputArray<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>function <span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        result<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        offset <span class="token operator">+=</span> element<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> 
                <span class="token comment">/**
                 * 第二部分
                 * FLV实时播放
                **/</span>
                <span class="token comment">//检测浏览器是否支持flv 播放器</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>dhflvjs<span class="token punctuation">.</span><span class="token function">isSupported</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"浏览器不支持 FLV, 请升级！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                let flvUrl <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
                let flvPlayer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                $<span class="token punctuation">(</span>'#oneStartVideoFlv'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    flvUrl <span class="token operator">=</span> $<span class="token punctuation">(</span>'#oneStartUrlFlv'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>flvUrl<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请输入流地址！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">//开始播放</span>
                    <span class="token function">playflv</span><span class="token punctuation">(</span>'myVideoflV'<span class="token punctuation">,</span>flvUrl<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">//创建flv播放器</span>
                function <span class="token function">playflv</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> url<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>typeof flvPlayer <span class="token operator">!=</span><span class="token operator">=</span> <span class="token string">"undefined"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>flvPlayer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            flvPlayer<span class="token punctuation">.</span><span class="token function">unload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            flvPlayer<span class="token punctuation">.</span><span class="token function">detachMediaElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            flvPlayer<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            flvPlayer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">const</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    flvPlayer <span class="token operator">=</span> dhflvjs<span class="token punctuation">.</span><span class="token function">createPlayer</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                        type<span class="token operator">:</span> <span class="token char">'flv'</span><span class="token punctuation">,</span>
                        url <span class="token operator">:</span> flvUrl<span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    flvPlayer<span class="token punctuation">.</span><span class="token function">attachMediaElement</span><span class="token punctuation">(</span>video<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    flvPlayer<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    flvPlayer<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//录像下载</span>
                $<span class="token punctuation">(</span>'#downloadVideoFlv'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>flvPlayer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请先触发播放"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span>
                    <span class="token punctuation">}</span>
                    let text <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>text <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">"录像下载"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        $<span class="token punctuation">(</span>'#downloadVideoFlv'<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"录像中"</span><span class="token punctuation">;</span>
                        <span class="token comment">//开始录像</span>
                        <span class="token function">downloadFLV</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        $<span class="token punctuation">(</span>'#downloadVideoFlv'<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"录像下载"</span><span class="token punctuation">;</span>
                        <span class="token comment">//结束录像</span>
                        <span class="token function">downloadFLV</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">//下载录像</span>
                function <span class="token function">downloadFLV</span><span class="token punctuation">(</span>startFlag<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span> startFlag <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        flvPlayer <span class="token operator">&amp;&amp;</span> flvPlayer<span class="token punctuation">.</span><span class="token function">startRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        flvPlayer <span class="token operator">&amp;&amp;</span> flvPlayer<span class="token punctuation">.</span><span class="token function">endRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

        <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
	
	
 <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> src<span class="token operator">=</span><span class="token string">"${pageContext.request.contextPath }/statics/jquery-2.1.0.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">--</span> <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> src<span class="token operator">=</span><span class="token string">"${pageContext.request.contextPath }/statics/js/sebeiqiehuan.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">%</span><span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> src<span class="token operator">=</span><span class="token string">"${pageContext.request.contextPath }/statics/video.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

 
 
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>


</code></pre>
    <p>
     步骤四：所需物料库
     <br/>
     链接下载：
     <a href="https://download.csdn.net/download/qq_39951524/90465236">
      SSM架构 +Nginx+FFmpeg实现rtsp流转hls流—物料包
     </a>
     <br/>
     地址为：https://download.csdn.net/download/qq_39951524/90465236
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/6cc7a01f3b2a43ccbe88286b0721e1c0.png"/>
    </p>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33393935313532342f:61727469636c652f64657461696c732f313436313030333939" class_="artid" style="display:none">
 </p>
</div>


