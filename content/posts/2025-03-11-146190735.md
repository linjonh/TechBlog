---
layout: post
title: "HiveHive安装"
date: 2025-03-11 22:22:27 +0800
description: "第二章 Hive安装第三章 DDL（Data Definition Language）数据定义第四章 DML（Data Manipulation Language）数据操作第五章 Hive查询第六章 Hive的基础知识第七章 Hive函数第八章 分区表和分桶表第九章 文件格式和压缩第十章 企业级调优附录：常见错误及解决方案。"
keywords: "【Hive】Hive安装"
categories: ['未分类']
tags: ['数据仓库', 'Hive', 'Hadoop']
artid: "146190735"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146190735
    alt: "HiveHive安装"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146190735
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146190735
cover: https://bing.ee123.net/img/rand?artid=146190735
image: https://bing.ee123.net/img/rand?artid=146190735
img: https://bing.ee123.net/img/rand?artid=146190735
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【Hive】Hive安装
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="Hive_0">
     </a>
     Hive
    </h2>
    <p>
     <a href="https://qiushanshuigong.blog.csdn.net/article/details/146144090?spm=1001.2014.3001.5502" rel="nofollow">
      第一章 Hive的基础知识
     </a>
     <br/>
     <a href="https://qiushanshuigong.blog.csdn.net/article/details/146190735?spm=1011.2415.3001.5331" rel="nofollow">
      第二章 Hive安装
     </a>
     <br/>
     第三章 DDL（Data Definition Language）数据定义
     <br/>
     第四章 DML（Data Manipulation Language）数据操作
     <br/>
     第五章 Hive查询
     <br/>
     第六章 Hive的基础知识
     <br/>
     第七章 Hive函数
     <br/>
     第八章 分区表和分桶表
     <br/>
     第九章 文件格式和压缩
     <br/>
     第十章 企业级调优
     <br/>
     附录：常见错误及解决方案
    </p>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="Hive_14">
     </a>
     Hive安装地址
    </h2>
    <h3>
     <a id="1Hive_15">
     </a>
     1）Hive官网地址
    </h3>
    <p>
     <a href="http://hive.apache.org/" rel="nofollow">
      Hive官网地址
     </a>
    </p>
    <h3>
     <a id="2_18">
     </a>
     2）文档查看地址
    </h3>
    <p>
     <a href="https://cwiki.apache.org/confluence/display/Hive/GettingStarted" rel="nofollow">
      文档查看地址
     </a>
    </p>
    <h3>
     <a id="3_20">
     </a>
     3）下载地址
    </h3>
    <p>
     <a href="http://archive.apache.org/dist/hive/" rel="nofollow">
      下载地址
     </a>
    </p>
    <h3>
     <a id="4github_22">
     </a>
     4）github地址
    </h3>
    <p>
     <a href="https://github.com/apache/hive">
      github地址
     </a>
    </p>
    <h2>
     <a id="Hive_24">
     </a>
     Hive安装部署
    </h2>
    <h3>
     <a id="Hive_25">
     </a>
     安装Hive
    </h3>
    <p>
     1）把apache-hive-3.1.3-bin.tar.gz上传到Linux的/opt/software目录下
     <br/>
     2）解压apache-hive-3.1.3-bin.tar.gz到/opt/module/目录下面
    </p>
    <pre><code>tar -zxvf /opt/software/apache-hive-3.1.3-bin.tar.gz -C /opt/module
</code></pre>
    <p>
     3）修改apache-hive-3.1.3-bin.tar.gz的名称为hive
    </p>
    <pre><code>mv /opt/module/apache-hive-3.1.3-bin/ /opt/module/hive
</code></pre>
    <p>
     4）修改/etc/profile.d/my_env.sh，添加环境变量
    </p>
    <pre><code>sudo vim /etc/profile.d/my_env.sh
</code></pre>
    <p>
     （1）添加内容
    </p>
    <pre><code>#HIVE_HOME
export HIVE_HOME=/opt/module/hive
export PATH=$PATH:$HIVE_HOME/bin
</code></pre>
    <p>
     （2）source一下
    </p>
    <pre><code>source /etc/profile.d/my_env.sh
</code></pre>
    <p>
     5）初始化元数据库（默认是derby数据库）
    </p>
    <pre><code>bin/schematool -dbType derby -initSchema
</code></pre>
    <h3>
     <a id="Hive_59">
     </a>
     启动并使用Hive
    </h3>
    <p>
     1）启动Hive
     <br/>
     在Hive目录下
    </p>
    <pre><code>bin/hive
</code></pre>
    <p>
     2）使用Hive
    </p>
    <pre><code>hive&gt; show databases;
hive&gt; show tables;
hive&gt; create table stu(id int, name string);
hive&gt; insert into stu values(1,"ss");
hive&gt; select * from stu;
</code></pre>
    <p>
     观察HDFS的路径/user/hive/warehouse/stu，体会Hive与Hadoop之间的关系
    </p>
    <p>
     <strong>
      Hive中的表在Hadoop中是目录；Hive中的数据在Hadoop中是文件。
     </strong>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/b1c2c38c4046433fafd003e8542f655c.png"/>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/384cfe04b1f47a6c0618258d4b5e3b31.png">
      <br/>
      3）在Xshell窗口中开启另一个窗口开启Hive，在/tmp/atguigu目录下监控hive.log文件
     </img>
    </p>
    <pre><code> tail -f hive.log
</code></pre>
    <pre><code>Caused by: ERROR XSDB6: Another instance of Derby may have already booted the database /opt/module/hive/metastore_db.
        at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)
        at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)
        at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.privGetJBMSLockOnDB(Unknown Source)
        at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.run(Unknown Source)
...
</code></pre>
    <p>
     <strong>
      原因在于Hive默认使用的元数据库为derby。derby数据库的特点是同一时间只允许一个客户端访问。如果多个Hive客户端同时访问，就会报错。由于在企业开发中，都是多人协作开发，需要多客户端同时访问Hive，怎么解决呢？我们可以将Hive的元数据改为用MySQL存储，MySQL支持多客户端同时访问。
     </strong>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e67584b090ad85d1baeb9bb971ecbccb.png">
      <br/>
      4）首先退出hive客户端。然后在Hive的安装目录下将derby.log和metastore_db删除，顺便将HDFS上目录删除
     </img>
    </p>
    <pre><code>--退出hive客户端
hive&gt; quit;
--将derby.log和metastore_db删除
 rm -rf derby.log metastore_db
 hadoop fs -rm -r /user
</code></pre>
    <p>
     5）删除HDFS中/user/hive/warehouse/stu中数据
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/6bf00cc838273aeb2771a95c45306827.png"/>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/56d7d286fcda2fc9631cb7b543c54cfd.png"/>
    </p>
    <h3>
     <a id="MySQL_114">
     </a>
     MySQL安装
    </h3>
    <p>
     <a href="https://qiushanshuigong.blog.csdn.net/article/details/144964903" rel="nofollow">
      基于docker安装MySQL8.x
     </a>
    </p>
    <p>
     <a href="https://qiushanshuigong.blog.csdn.net/article/details/146190182" rel="nofollow">
      Linux安装MySQL5.x
     </a>
    </p>
    <h2>
     <a id="HiveMySQL_120">
     </a>
     配置Hive元数据存储到MySQL
    </h2>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/6df76e21baa3da78064ae4073427dd41.png"/>
    </p>
    <h3>
     <a id="MySQL_122">
     </a>
     配置元数据到MySQL
    </h3>
    <p>
     1）新建Hive元数据库
    </p>
    <pre><code>create database metastore;
</code></pre>
    <p>
     2）将MySQL的JDBC驱动拷贝到Hive的lib目录下。
    </p>
    <pre><code>cp mysql-connector-java-5.1.37.jar $HIVE_HOME/lib
</code></pre>
    <p>
     3）在$HIVE_HOME/conf目录下新建hive-site.xml文件
    </p>
    <pre><code>vim $HIVE_HOME/conf/hive-site.xml
</code></pre>
    <p>
     添加如下内容：
    </p>
    <pre><code>&lt;?xml version="1.0"?&gt;
&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;

&lt;configuration&gt;
    &lt;!-- jdbc连接的URL --&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;
        &lt;value&gt;jdbc:mysql://MySQL地址:3306/metastore?useSSL=false&lt;/value&gt;
    &lt;/property&gt;
    
    &lt;!-- jdbc连接的Driver--&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;
        &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;
    &lt;/property&gt;
    
	&lt;!-- jdbc连接的username--&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;
        &lt;value&gt;MySQL账号&lt;/value&gt;
    &lt;/property&gt;

    &lt;!-- jdbc连接的password --&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;
        &lt;value&gt;MySQL密码&lt;/value&gt;
    &lt;/property&gt;

    &lt;!-- Hive默认在HDFS的工作目录 --&gt;
    &lt;property&gt;
        &lt;name&gt;hive.metastore.warehouse.dir&lt;/name&gt;
        &lt;value&gt;/user/hive/warehouse&lt;/value&gt;
    &lt;/property&gt;
&lt;/configuration&gt;
</code></pre>
    <p>
     5）初始化Hive元数据库（修改为采用MySQL存储元数据）
    </p>
    <pre><code>bin/schematool -dbType mysql -initSchema -verbose
</code></pre>
    <h3>
     <a id="_182">
     </a>
     验证元数据是否配置成功
    </h3>
    <p>
     1）再次启动Hive
    </p>
    <pre><code>bin/hive
</code></pre>
    <p>
     2）使用Hive
    </p>
    <pre><code>hive&gt; show databases;
hive&gt; show tables;
hive&gt; create table stu(id int, name string);
hive&gt; insert into stu values(1,"ss");
hive&gt; select * from stu;
</code></pre>
    <p>
     3）在Xshell窗口中开启另一个窗口开启Hive（两个窗口都可以操作Hive，没有出现异常）
    </p>
    <pre><code>hive&gt; show databases;
hive&gt; show tables;
hive&gt; select * from stu;
</code></pre>
    <h2>
     <a id="MySQL_204">
     </a>
     查看MySQL中的元数据
    </h2>
    <p>
     查看元数据库metastore
    </p>
    <pre><code>mysql&gt; show databases;
mysql&gt; use metastore;
mysql&gt; show tables;
</code></pre>
    <p>
     （1）查看元数据库中存储的库信息
    </p>
    <pre><code>mysql&gt; select * from DBS;
+-------+-----------------------+-------------------------------------------+---------+------------+------------+-----------+
| DB_ID | DESC                  | DB_LOCATION_URI                           | NAME    | OWNER_NAME | OWNER_TYPE | CTLG_NAME |
+-------+-----------------------+-------------------------------------------+---------+------------+------------+-----------+
|     1 | Default Hive database | hdfs://hadoop102:8020/user/hive/warehouse | default | public     | ROLE       | hive      |
+-------+-----------------------+-------------------------------------------+---------+------------+------------+-----------+
</code></pre>
    <p>
     （2）查看元数据库中存储的表信息
    </p>
    <pre><code>mysql&gt; select * from TBLS;
+--------+-------------+-------+------------------+---------+------------+-----------+-------+----------+---------------+
| TBL_ID | CREATE_TIME | DB_ID | LAST_ACCESS_TIME | OWNER   | OWNER_TYPE | RETENTION | SD_ID | TBL_NAME | TBL_TYPE      | 
+--------+-------------+-------+------------------+---------+------------+-----------+-------+----------+---------------+
|      1 |  1656318303 |     1 |                0 | atguigu | USER       |         0 |     1 | stu      | MANAGED_TABLE |
+--------+-------------+-------+------------------+---------+------------+-----------+-------+----------+---------------+
</code></pre>
    <p>
     （3）查看元数据库中存储的表中列相关信息
    </p>
    <pre><code>mysql&gt; select * from COLUMNS_V2;
+-------+----------+---------+------------+-------------+-------------+--------+
| CS_ID | CAT_NAME | DB_NAME | TABLE_NAME | COLUMN_NAME | COLUMN_TYPE | TBL_ID |
+-------+----------+---------+------------+-------------+-------------+--------+
|     1 | hive     | default | stu        | id          | int         |      1 |
|     2 | hive     | default | stu        | name        | string      |      1 |
+-------+----------+---------+------------+-------------+-------------+--------+
</code></pre>
    <h2>
     <a id="Hive_247">
     </a>
     Hive服务部署
    </h2>
    <h3>
     <a id="hiveserver2_248">
     </a>
     hiveserver2服务
    </h3>
    <p>
     Hive的hiveserver2服务的作用是提供jdbc/odbc接口，为用户提供远程访问Hive数据的功能，例如用户期望在个人电脑中访问远程服务中的Hive数据，就需要用到Hiveserver2。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/6a5af743ab57a57c7e563a9c35644a0e.png"/>
    </p>
    <h4>
     <a id="_254">
     </a>
     用户说明
    </h4>
    <p>
     在远程访问Hive数据时，客户端并未直接访问Hadoop集群，而是由Hivesever2代理访问。由于Hadoop集群中的数据具备访问权限控制，所以此时需考虑一个问题：那就是访问Hadoop集群的用户身份是谁？是Hiveserver2的启动用户？还是客户端的登录用户？
     <br/>
     答案是都有可能，具体是谁，由Hiveserver2的hive.server2.enable.doAs参数决定，该参数的含义是是否启用Hiveserver2用户模拟的功能。若启用，则Hiveserver2会模拟成客户端的登录用户去访问Hadoop集群的数据，不启用，则Hivesever2会直接使用启动用户访问Hadoop集群数据。模拟用户的功能，默认是开启的。
     <br/>
     具体逻辑如下：
     <br/>
     未开启用户模拟功能：
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/5c46f6429e39f8093e26810f22692df4.png"/>
    </p>
    <p>
     开启用户模拟功能：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/3eb9f82813b3d9d85536ace72ff2b777.png"/>
     <br/>
     生产环境，推荐开启用户模拟功能，因为开启后才能保证各用户之间的权限隔离。
    </p>
    <h3>
     <a id="hiveserver2_266">
     </a>
     hiveserver2部署
    </h3>
    <h4>
     <a id="Hadoop_267">
     </a>
     Hadoop端配置
    </h4>
    <p>
     hivesever2的模拟用户功能，依赖于Hadoop提供的proxy user（代理用户功能），只有Hadoop中的代理用户才能模拟其他用户的身份访问Hadoop集群。因此，需要
     <strong>
      将hiveserver2的启动用户设置为Hadoop的代理用户
     </strong>
     ，配置方式如下：
    </p>
    <p>
     修改配置文件core-site.xml，然后记得分发三台机器
    </p>
    <pre><code>cd $HADOOP_HOME/etc/hadoop
vim core-site.xml
</code></pre>
    <p>
     增加如下配置：
    </p>
    <pre><code>&lt;!--配置所有节点的Hadoop的代理用户都可作为代理用户--&gt;
&lt;property&gt;
    &lt;name&gt;hadoop.proxyuser.Hadoop的代理用户.hosts&lt;/name&gt;
    &lt;value&gt;*&lt;/value&gt;
&lt;/property&gt;

&lt;!--配置Hadoop的代理用户能够代理的用户组为任意组--&gt;
&lt;property&gt;
    &lt;name&gt;hadoop.proxyuser.Hadoop的代理用户.groups&lt;/name&gt;
    &lt;value&gt;*&lt;/value&gt;
&lt;/property&gt;

&lt;!--配置atguigu用户能够代理的用户为任意用户--&gt;
&lt;property&gt;
    &lt;name&gt;hadoop.proxyuser.Hadoop的代理用户.users&lt;/name&gt;
    &lt;value&gt;*&lt;/value&gt;
&lt;/property&gt;
</code></pre>
    <h4>
     <a id="Hive_297">
     </a>
     Hive端配置
    </h4>
    <p>
     在hive-site.xml文件中添加如下配置信息
    </p>
    <pre><code>&lt;!-- 指定hiveserver2连接的host --&gt;
&lt;property&gt;
	&lt;name&gt;hive.server2.thrift.bind.host&lt;/name&gt;
	&lt;value&gt;hiveserver2连接的hos&lt;/value&gt;
&lt;/property&gt;

&lt;!-- 指定hiveserver2连接的端口号 --&gt;
&lt;property&gt;
	&lt;name&gt;hive.server2.thrift.port&lt;/name&gt;
	&lt;value&gt;10000&lt;/value&gt;
&lt;/property&gt;
</code></pre>
    <h4>
     <a id="_314">
     </a>
     测试
    </h4>
    <p>
     （1）启动hiveserver2
    </p>
    <pre><code>bin/hive --service hiveserver2
</code></pre>
    <p>
     （2）使用命令行客户端beeline进行远程访问
     <br/>
     启动beeline客户端
    </p>
    <pre><code>bin/beeline -u jdbc:hive2://hadoop102:10000 -n atguigu
</code></pre>
    <p>
     看到如下界面
    </p>
    <pre><code>Connecting to jdbc:hive2://hadoop102:10000
Connected to: Apache Hive (version 3.1.3)
Driver: Hive JDBC (version 3.1.3)
Transaction isolation: TRANSACTION_REPEATABLE_READ
Beeline version 3.1.3 by Apache Hive
0: jdbc:hive2://hadoop102:10000&gt;
</code></pre>
    <p>
     （3）使用图形化客户端进行远程访问
    </p>
    <p>
     4）配置DataGrip连接
     <br/>
     （1）创建连接
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/03b50985101d9275a91d4d3707995a00.png"/>
    </p>
    <p>
     （2）配置连接属性
     <br/>
     所有属性配置，和Hive的beeline客户端配置一致即可。初次使用，配置过程会提示缺少JDBC驱动，按照提示下载即可。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e382bb2ce1361bb1edae2b41df3cfc8e.jpeg"/>
    </p>
    <p>
     （3）界面介绍
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/9d96b88003574ac01f12974e7b920909.png"/>
    </p>
    <p>
     （4）测试sql执行
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/c267d7c6b5e31e8f47b254f53faa5470.png"/>
    </p>
    <p>
     （5）修改数据库
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e1ed4dbea8a008991f9cfd228faeb6d5.png"/>
    </p>
    <h3>
     <a id="metastore_360">
     </a>
     metastore服务
    </h3>
    <p>
     Hive的metastore服务的作用是为Hive CLI或者Hiveserver2提供元数据访问接口。
    </p>
    <h4>
     <a id="metastore_363">
     </a>
     metastore运行模式
    </h4>
    <p>
     metastore有两种运行模式，分别为嵌入式模式和独立服务模式。下面分别对两种模式进行说明：
     <br/>
     （1）嵌入式模式
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/3955e043ba49624ed11e86ad7246bcb8.png"/>
    </p>
    <p>
     （2）独立服务模式
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/907e784b8b37b9e31de498c8e5f7dfb3.png"/>
    </p>
    <p>
     生产环境中，不推荐使用嵌入式模式。因为其存在以下两个问题：
    </p>
    <p>
     （1）嵌入式模式下，每个Hive CLI都需要直接连接元数据库，当Hive CLI较多时，数据库压力会比较大。
    </p>
    <p>
     （2）每个客户端都需要用户元数据库的读写权限，元数据库的安全得不到很好的保证。
    </p>
    <h4>
     <a id="metastore_378">
     </a>
     metastore部署
    </h4>
    <p>
     （1）嵌入式模式
    </p>
    <p>
     嵌入式模式下，只需保证Hiveserver2和每个Hive CLI的配置文件hive-site.xml中包含连接元数据库所需要的以下参数即可：
    </p>
    <pre><code>    &lt;!-- jdbc连接的URL --&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;
        &lt;value&gt;jdbc:mysql://URL:3306/metastore?useSSL=false&lt;/value&gt;
    &lt;/property&gt;
    
    &lt;!-- jdbc连接的Driver--&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;
        &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;
    &lt;/property&gt;
    
	&lt;!-- jdbc连接的username--&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;
        &lt;value&gt;jdbc连接的username&lt;/value&gt;
    &lt;/property&gt;

    &lt;!-- jdbc连接的password --&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;
        &lt;value&gt;jdbc连接的password&lt;/value&gt;
    &lt;/property&gt;
</code></pre>
    <p>
     （2）独立服务模式
    </p>
    <p>
     独立服务模式需做以下配置：
    </p>
    <p>
     首先，保证metastore服务的配置文件hive-site.xml中包含连接元数据库所需的以下参数：
    </p>
    <pre><code>    &lt;!-- jdbc连接的URL --&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;
        &lt;value&gt;jdbc:mysql://jdbc连接的URL:3306/metastore?useSSL=false&lt;/value&gt;
    &lt;/property&gt;
    
    &lt;!-- jdbc连接的Driver--&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;
        &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;
    &lt;/property&gt;
    
	&lt;!-- jdbc连接的username--&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;
        &lt;value&gt;jdbc连接的username&lt;/value&gt;
    &lt;/property&gt;

    &lt;!-- jdbc连接的password --&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;
        &lt;value&gt;jdbc连接的password&lt;/value&gt;
    &lt;/property&gt;
</code></pre>
    <p>
     其次，保证Hiveserver2和每个Hive CLI的配置文件hive-site.xml中包含访问metastore服务所需的以下参数：
    </p>
    <pre><code>&lt;!-- 指定metastore服务的地址 --&gt;
&lt;property&gt;
	&lt;name&gt;hive.metastore.uris&lt;/name&gt;
	&lt;value&gt;thrift://metastore服务的地址:9083&lt;/value&gt;
&lt;/property&gt;
</code></pre>
    <p>
     注意：主机名需要改为metastore服务所在节点，端口号无需修改，metastore服务的默认端口就是9083。
    </p>
    <h4>
     <a id="_452">
     </a>
     测试
    </h4>
    <p>
     此时启动Hive CLI，执行shou databases语句，会出现一下错误提示信息：
    </p>
    <pre><code>hive (default)&gt; show databases;
FAILED: HiveException java.lang.RuntimeException: Unable to instantiate org.apache.hadoop.hive.ql.metadata.SessionHiveMetaStoreClient
</code></pre>
    <p>
     这是因为我们在Hive CLI的配置文件中配置了hive.metastore.uris参数，此时Hive CLI会去请求我们执行的metastore服务地址，所以必须启动metastore服务才能正常使用。
    </p>
    <p>
     metastore服务的启动命令如下：
    </p>
    <pre><code>--前端启动
hive --service metastore
</code></pre>
    <p>
     注意：启动后该窗口不能再操作，需打开一个新的Xshell窗口来对Hive操作。
    </p>
    <p>
     重新启动 Hive CLI，并执行shou databases语句，就能正常访问了
    </p>
    <pre><code>bin/hive
</code></pre>
    <h2>
     <a id="Hive_476">
     </a>
     Hive使用技巧
    </h2>
    <h3>
     <a id="Hive_477">
     </a>
     Hive参数配置方式
    </h3>
    <p>
     1）查看当前所有的配置信息
    </p>
    <pre><code>hive&gt;set;
</code></pre>
    <p>
     2）参数的配置三种方式
     <br/>
     （1）配置文件方式
    </p>
    <p>
     默认配置文件：hive-default.xml
    </p>
    <p>
     用户自定义配置文件：hive-site.xml
    </p>
    <p>
     注意：用户自定义配置会覆盖默认配置。另外，Hive也会读入Hadoop的配置，因为Hive是作为Hadoop的客户端启动的，Hive的配置会覆盖Hadoop的配置。配置文件的设定对本机启动的所有Hive进程都有效。
    </p>
    <p>
     （2）命令行参数方式
    </p>
    <p>
     ①启动Hive时，可以在命令行添加-hiveconf param=value来设定参数。例如：
    </p>
    <pre><code>bin/hive -hiveconf mapreduce.job.reduces=10;
</code></pre>
    <p>
     注意：仅对本次Hive启动有效。
    </p>
    <p>
     ②查看参数设置
    </p>
    <pre><code>set mapreduce.job.reduces;set mapreduce.job.reduces;
</code></pre>
    <p>
     （3）参数声明方式
     <br/>
     可以在HQL中使用SET关键字设定参数，例如：
    </p>
    <pre><code>hive(default)&gt; set mapreduce.job.reduces=10;
</code></pre>
    <p>
     注意：仅对本次Hive启动有效。
    </p>
    <p>
     查看参数设置：
    </p>
    <pre><code>set mapreduce.job.reduces;
</code></pre>
    <p>
     上述三种设定方式的优先级依次递增。即配置文件 &lt; 命令行参数 &lt; 参数声明。注意某些系统级的参数，例如log4j相关的设定，必须用前两种方式设定，因为那些参数的读取在会话建立以前已经完成了。
    </p>
    <h3>
     <a id="Hive_529">
     </a>
     Hive常见属性配置
    </h3>
    <h4>
     <a id="Hive_530">
     </a>
     Hive客户端显示当前库和表头
    </h4>
    <p>
     （1）在hive-site.xml中加入如下两个配置:
    </p>
    <pre><code>&lt;property&gt;
    &lt;name&gt;hive.cli.print.header&lt;/name&gt;
    &lt;value&gt;true&lt;/value&gt;
    &lt;description&gt;Whether to print the names of the columns in query output.&lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;hive.cli.print.current.db&lt;/name&gt;
    &lt;value&gt;true&lt;/value&gt;
    &lt;description&gt;Whether to include the current database in the Hive prompt.&lt;/description&gt;
&lt;/property&gt;
</code></pre>
    <p>
     （2）hive客户端在运行时可以显示当前使用的库和表头信息
    </p>
    <pre><code>[yj@hadoop102 conf]$ hive

hive (default)&gt; select * from stu;
OK
stu.id	stu.name 
1	ss
Time taken: 1.874 seconds, Fetched: 1 row(s)
hive (default)&gt;
</code></pre>
    <h4>
     <a id="Hive_558">
     </a>
     Hive运行日志路径配置
    </h4>
    <p>
     修改Hive的log存放日志到/opt/module/hive/logs
    </p>
    <p>
     （1）修改$HIVE_HOME/conf/hive-log4j2.properties.template文件名称为
     <br/>
     hive-log4j2.properties
    </p>
    <pre><code>mv hive-log4j2.properties.template hive-log4j2.properties
</code></pre>
    <p>
     （2）在hive-log4j2.properties文件中修改log存放位置
     <br/>
     修改配置如下
    </p>
    <pre><code>property.hive.log.dir=/opt/module/hive/logs
</code></pre>
    <h4>
     <a id="Hadoop_574">
     </a>
     关闭Hadoop虚拟内存检查
    </h4>
    <p>
     在yarn-site.xml中关闭虚拟内存检查（虚拟内存校验，如果已经关闭了，就不需要配了）。
     <br/>
     （1）修改前记得先停Hadoop
     <br/>
     （2）在yarn-site.xml添加如下配置
    </p>
    <pre><code>&lt;property&gt;
    &lt;name&gt;yarn.nodemanager.vmem-check-enabled&lt;/name&gt;
    &lt;value&gt;false&lt;/value&gt;
&lt;/property&gt;
</code></pre>
    <p>
     （3）修改完后记得分发yarn-site.xml，并重启yarn。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34343931373230312f:61727469636c652f64657461696c732f313436313930373335" class_="artid" style="display:none">
 </p>
</div>


