---
layout: post
title: "kubernetes中使用java-client完成deployment的部署以及删除"
date: 2024-09-13 21:56:14 +0800
description: "1、pom.xml文件中引入依赖<!--k8s相关jar包-->\t\t<dependency>\t\t\t<"
keywords: "kubernetes client-java"
categories: ['未分类']
tags: ['Kubernetes', 'Java']
artid: "107022166"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=107022166
  alt: "kubernetes中使用java-client完成deployment的部署以及删除"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=107022166
featuredImagePreview: https://bing.ee123.net/img/rand?artid=107022166
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     kubernetes中使用java-client完成deployment的部署以及删除
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     1、pom.xml文件中引入依赖
    </p>
    <pre><code class="prism language-bash"><span class="token operator">&lt;</span><span class="token operator">!</span>--k8s相关jar包--<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>io.kubernetes<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>client-java<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>version<span class="token operator">&gt;</span>8.0.2<span class="token operator">&lt;</span>/version<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>scope<span class="token operator">&gt;</span>compile<span class="token operator">&lt;</span>/scope<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>
</code></pre>
    <p>
     2、逻辑流程
    </p>
    <pre><code class="prism language-bash">大致流程
 * 1）创建一个命名空间
 * 2）根据资源对象文件创建deployment，创建多个副本，并指定自定义调度器
 * 3）通过API获取节点和pod
 * 4）选择phase<span class="token operator">=</span>pending和schedulerName<span class="token operator">=</span>my-scheduler的pod
 * 5）然后通过自定义的调度算法（这里只采用随机数的方法）计算出pod的合适目标节点。并使用Binding对象去绑定。
</code></pre>
    <p>
     3、配置连接k8s
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a0bda327b8641de8d58a1585a87d4858.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/be9e25a43a8bf0c0ec10bd7edf562aa4.png">
       <br/>
       4、项目工程目录如下
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d33314c70064b53f047317ae8ab4544b.png">
        <br/>
        只需要关注config文件、myScheduler包、uitl包即可。
        <br/>
        5、util包中工具类是配置连接客户端
       </img>
      </img>
     </img>
    </p>
    <pre><code class="prism language-bash">package com.example.demo.util<span class="token punctuation">;</span>

<span class="token function">import</span> io.kubernetes.client.openapi.ApiClient<span class="token punctuation">;</span>
<span class="token function">import</span> io.kubernetes.client.openapi.Configuration<span class="token punctuation">;</span>
<span class="token function">import</span> io.kubernetes.client.openapi.auth.ApiKeyAuth<span class="token punctuation">;</span>
<span class="token function">import</span> io.kubernetes.client.util.ClientBuilder<span class="token punctuation">;</span>
<span class="token function">import</span> io.kubernetes.client.util.KubeConfig<span class="token punctuation">;</span>

<span class="token function">import</span> java.io.FileReader<span class="token punctuation">;</span>
<span class="token function">import</span> java.io.IOException<span class="token punctuation">;</span>

/\*\*

- 配置信息
  \*/
  public class Config <span class="token punctuation">{<!-- --></span>
  // 返回 client
  // 默认使用这个方法
  public static ApiClient defaultClient<span class="token punctuation">(</span><span class="token punctuation">)</span> throws IOException <span class="token punctuation">{<!-- --></span>

          String kubeConfigPath <span class="token operator">=</span> <span class="token string">"config"</span><span class="token punctuation">;</span>
          //
          ApiClient client <span class="token operator">=</span>
                  ClientBuilder.kubeconfig<span class="token punctuation">(</span>KubeConfig.loadKubeConfig<span class="token punctuation">(</span>new FileReader<span class="token punctuation">(</span>kubeConfigPath<span class="token punctuation">))</span><span class="token punctuation">)</span>.build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> client<span class="token punctuation">;</span>

      <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<p>
6、在主类中实现，具体代码如下
</p>
<pre><code class="prism language-bash">package com.example.demo.myScheduler<span class="token punctuation">;</span>

<span class="token function">import</span> com.example.demo.util.Config<span class="token punctuation">;</span>
<span class="token function">import</span> io.kubernetes.client.ProtoClient<span class="token punctuation">;</span>
<span class="token function">import</span> io.kubernetes.client.openapi.ApiClient<span class="token punctuation">;</span>
<span class="token function">import</span> io.kubernetes.client.openapi.ApiException<span class="token punctuation">;</span>
<span class="token function">import</span> io.kubernetes.client.openapi.Configuration<span class="token punctuation">;</span>
<span class="token function">import</span> io.kubernetes.client.openapi.apis.AppsV1Api<span class="token punctuation">;</span>
<span class="token function">import</span> io.kubernetes.client.openapi.apis.AppsV1beta1Api<span class="token punctuation">;</span>
<span class="token function">import</span> io.kubernetes.client.openapi.apis.CoreV1Api<span class="token punctuation">;</span>
<span class="token function">import</span> io.kubernetes.client.openapi.apis.ExtensionsV1beta1Api<span class="token punctuation">;</span>
<span class="token function">import</span> io.kubernetes.client.openapi.models.\*<span class="token punctuation">;</span>
<span class="token function">import</span> io.kubernetes.client.proto.Meta<span class="token punctuation">;</span>
<span class="token function">import</span> io.kubernetes.client.proto.V1<span class="token punctuation">;</span>
<span class="token function">import</span> io.kubernetes.client.util.Yaml<span class="token punctuation">;</span>

<span class="token function">import</span> java.io.File<span class="token punctuation">;</span>
<span class="token function">import</span> java.io.IOException<span class="token punctuation">;</span>
<span class="token function">import</span> java.util.List<span class="token punctuation">;</span>
<span class="token function">import</span> java.util.Random<span class="token punctuation">;</span>

/\*\*

- 大致流程
- 1）创建一个命名空间
- 2）根据资源对象文件创建 deployment，创建多个副本，并指定自定义调度器
- 3）通过 API 获取节点和 pod
- 4）选择 phase<span class="token operator">=</span>pending 和 schedulerName<span class="token operator">=</span>my-scheduler 的 pod
- 5）然后通过自定义的调度算法（这里只采用随机数的方法）计算出 pod 的合适目标节点。并使用 Binding 对象去绑定。
  \*/
  public class myScheduler <span class="token punctuation">{<!-- --></span>

      public static File deploymentFile <span class="token operator">=</span> new File<span class="token punctuation">(</span><span class="token string">"test-scheduler.yaml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      public static void main<span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> throws IOException, ApiException <span class="token punctuation">{<!-- --></span>

          String namespaceStr <span class="token operator">=</span> <span class="token string">"shiyan"</span><span class="token punctuation">;</span>
          // 配置client
          ApiClient client <span class="token operator">=</span> Config.defaultClient<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Configuration.setDefaultApiClient<span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>
          AppsV1Api apiInstance <span class="token operator">=</span> new AppsV1Api<span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>
          CoreV1Api api <span class="token operator">=</span> new CoreV1Api<span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>
          ProtoClient protoClient <span class="token operator">=</span> new ProtoClient<span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>

          // 创建命名空间和deployment
          //createNameSpaceAndDepoyment<span class="token punctuation">(</span>namespaceStr,apiInstance,protoClient<span class="token punctuation">)</span><span class="token punctuation">;</span>

          // 通过api获得节点和pod，并完成预选，优选的过程
          //getNodeAndPod<span class="token punctuation">(</span>namespaceStr,api,client<span class="token punctuation">)</span><span class="token punctuation">;</span>

          // 删除deployment
          //deleteDeploymentByYaml<span class="token punctuation">(</span>apiInstance,namespaceStr<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token punctuation">}</span>

      /**
       * 删除对应的deployment
       * @param api
       * @param namespaceStr
       */
      private static void deleteDeploymentByYaml<span class="token punctuation">(</span>AppsV1Api api, String namespaceStr<span class="token punctuation">)</span> throws ApiException <span class="token punctuation">{<!-- --></span>
          // 传入deployment的名字，命名空间，就可以删除deployment以及所有的pod了
          V1Status v1Status <span class="token operator">=</span> api.deleteNamespacedDeployment<span class="token punctuation">(</span><span class="token string">"pause"</span>,namespaceStr,null,null,null,null,null,null<span class="token punctuation">)</span><span class="token punctuation">;</span>
          System.out.println<span class="token punctuation">(</span>v1Status.getCode<span class="token punctuation">(</span><span class="token punctuation">)</span>+<span class="token string">"删除完毕"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      /**
       * 获得可用节点和判断pod的状态完成绑定
       * @param namespaceStr
       * @param api
       * @param client
       * @throws ApiException
       */
      private static void getNodeAndPod<span class="token punctuation">(</span>String namespaceStr, CoreV1Api api, ApiClient client<span class="token punctuation">)</span> throws ApiException <span class="token punctuation">{<!-- --></span>
          Random random <span class="token operator">=</span> new Random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          // 调用方法，计算出所有可用的节点
          // 预选
          V1NodeList nodeList <span class="token operator">=</span> ready_node<span class="token punctuation">(</span>api<span class="token punctuation">)</span><span class="token punctuation">;</span>
          // 通过api获取指定命名空间<span class="token punctuation">(</span>shiyan<span class="token punctuation">)</span>中的pod
          V1PodList list <span class="token operator">=</span> api.listNamespacedPod<span class="token punctuation">(</span>namespaceStr,null,null,null,null,null,null,null, null, null<span class="token punctuation">)</span><span class="token punctuation">;</span>
          // 遍历list，循环判断pod的状态，并完成pod的调度
          for<span class="token punctuation">(</span>V1Pod item:list.getItems<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">{<!-- --></span>
              // 优选
              int n <span class="token operator">=</span> random.nextInt<span class="token punctuation">(</span>nodeList.getItems<span class="token punctuation">(</span><span class="token punctuation">)</span>.size<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
              // 获取pod的状态
              String podStatus <span class="token operator">=</span> item.getStatus<span class="token punctuation">(</span><span class="token punctuation">)</span>.getPhase<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              String nodeName <span class="token operator">=</span> item.getSpec<span class="token punctuation">(</span><span class="token punctuation">)</span>.getNodeName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              // 根据pod的状态和所属节点的名称进行绑定
              <span class="token keyword">if</span> <span class="token punctuation">(</span>podStatus.equals<span class="token punctuation">(</span><span class="token string">"Pending"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> nodeName <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                  // 执行调度方法 pod的名字；可用node<span class="token punctuation">;</span>命名空间；客户端；api
                  schedluer<span class="token punctuation">(</span>item.getMetadata<span class="token punctuation">(</span><span class="token punctuation">)</span>.getName<span class="token punctuation">(</span><span class="token punctuation">)</span>,nodeList.getItems<span class="token punctuation">(</span><span class="token punctuation">)</span>.get<span class="token punctuation">(</span>n<span class="token punctuation">)</span>,namespaceStr,client,api<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      /**
       * binding 绑定的过程
       * @param name
       * @param v1Node
       * @param namespaceStr
       * @param client
       * @param api
       * @throws ApiException
       */
      private static void schedluer<span class="token punctuation">(</span>String name, V1Node v1Node, String namespaceStr, ApiClient client, CoreV1Api api<span class="token punctuation">)</span> throws ApiException <span class="token punctuation">{<!-- --></span>
          V1Binding body <span class="token operator">=</span> new V1Binding<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          V1ObjectReference target <span class="token operator">=</span> new V1ObjectReference<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          V1ObjectMeta meta <span class="token operator">=</span> new V1ObjectMeta<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          target.setKind<span class="token punctuation">(</span><span class="token string">"Node"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          target.setApiVersion<span class="token punctuation">(</span><span class="token string">"v1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          target.setName<span class="token punctuation">(</span>v1Node.getMetadata<span class="token punctuation">(</span><span class="token punctuation">)</span>.getName<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>  // 节点的名称
          meta.setName<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
          body.setTarget<span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
          body.setMetadata<span class="token punctuation">(</span>meta<span class="token punctuation">)</span><span class="token punctuation">;</span>
          api.createNamespacedBinding<span class="token punctuation">(</span>namespaceStr,body,null,null,null<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>


      /**
       * 获得可用的node，这个方法相当于预选阶段
       * @param api
       * @return
       * @throws ApiException
       */
      private static V1NodeList ready_node<span class="token punctuation">(</span>CoreV1Api api<span class="token punctuation">)</span> throws ApiException <span class="token punctuation">{<!-- --></span>
          // 定义list装所有符合条件的节点
          V1NodeList nodeSelectList <span class="token operator">=</span> new V1NodeList<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          // 通过api获取所有的节点
          V1NodeList nodeList <span class="token operator">=</span> api.listNode<span class="token punctuation">(</span>null,null,null,null,null,null,null,null,null<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
          // 遍历，找出能用的node，存进list中去
          <span class="token keyword">for</span> <span class="token punctuation">(</span>V1Node node:nodeList.getItems<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">{<!-- --></span>
              List<span class="token operator">&lt;</span>V1NodeCondition<span class="token operator">&gt;</span> conditionsList <span class="token operator">=</span> node.getStatus<span class="token punctuation">(</span><span class="token punctuation">)</span>.getConditions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              // 取出最后一个
              String status <span class="token operator">=</span> conditionsList.get<span class="token punctuation">(</span>conditionsList.size<span class="token punctuation">(</span><span class="token punctuation">)</span>-1<span class="token punctuation">)</span>.getStatus<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              String <span class="token function">type</span> <span class="token operator">=</span> conditionsList.get<span class="token punctuation">(</span>conditionsList.size<span class="token punctuation">(</span><span class="token punctuation">)</span>-1<span class="token punctuation">)</span>.getType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              // 这里的预选策略相当于就是判断node节点的两个状态值
              <span class="token keyword">if</span> <span class="token punctuation">(</span>status.equals<span class="token punctuation">(</span><span class="token string">"True"</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>type.equals<span class="token punctuation">(</span><span class="token string">"Ready"</span><span class="token punctuation">))</span><span class="token punctuation">{<!-- --></span>
                  nodeSelectList.addItemsItem<span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          // 返回所有符合条件的节点
          <span class="token keyword">return</span> nodeSelectList<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      /**
       * 创建命名空间和通过deployment资源对象文件来创建deployment
       * @param namespaceStr
       * @param apiInstance
       * @param protoClient
       * @throws IOException
       * @throws ApiException
       */
      private static void createNameSpaceAndDepoyment<span class="token punctuation">(</span>String namespaceStr, AppsV1Api apiInstance, ProtoClient protoClient<span class="token punctuation">)</span> throws IOException, ApiException <span class="token punctuation">{<!-- --></span>
          // 1、创建一个命名空间 shiyan
          V1.Namespace namespace <span class="token operator">=</span>
                  V1.Namespace.newBuilder<span class="token punctuation">(</span><span class="token punctuation">)</span>.setMetadata<span class="token punctuation">(</span>Meta.ObjectMeta.newBuilder<span class="token punctuation">(</span><span class="token punctuation">)</span>.setName<span class="token punctuation">(</span>namespaceStr<span class="token punctuation">)</span>.build<span class="token punctuation">(</span><span class="token punctuation">))</span>.build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          protoClient.create<span class="token punctuation">(</span>namespace,<span class="token string">"/api/v1/namespaces"</span>,<span class="token string">"v1"</span>,<span class="token string">"Namespace"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          //   删除指定的命名空间
          //protoClient.delete<span class="token punctuation">(</span>V1.Namespace.newBuilder<span class="token punctuation">(</span><span class="token punctuation">)</span>,<span class="token string">"/api/v1/namespaces/"</span>+namespaceStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
          // 2、根据资源对象文件创建deployment，创建多个副本，并指定自定义调度器
         // File deploymentFile <span class="token operator">=</span> new File<span class="token punctuation">(</span><span class="token string">"test-scheduler.yaml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          V1Deployment body <span class="token operator">=</span> <span class="token punctuation">(</span>V1Deployment<span class="token punctuation">)</span> Yaml.load<span class="token punctuation">(</span>deploymentFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
          try <span class="token punctuation">{<!-- --></span>
              V1Deployment result <span class="token operator">=</span> apiInstance.createNamespacedDeployment<span class="token punctuation">(</span>namespaceStr,body,null,null,null<span class="token punctuation">)</span><span class="token punctuation">;</span>
              System.out.println<span class="token punctuation">(</span><span class="token string">"success,工作负载创建成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>catch <span class="token punctuation">(</span>ApiException e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>e.getCode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> 409<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                  System.out.println<span class="token punctuation">(</span><span class="token string">"error 工作负载创建已重复！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e.getCode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> 200<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                  System.out.println<span class="token punctuation">(</span><span class="token string">"success 工作负载创建成功！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e.getCode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> 201<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                  System.out.println<span class="token punctuation">(</span><span class="token string">"error 工作负载创建已重复！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e.getCode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> 401<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                  System.out.println<span class="token punctuation">(</span><span class="token string">"error 无权限操作！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                  System.out.println<span class="token punctuation">(</span><span class="token string">"error 工作负载创建失败！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              System.out.println<span class="token punctuation">(</span><span class="token string">"Exception when calling AppsV1Api#createNamespacedDeployment"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              System.out.println<span class="token punctuation">(</span><span class="token string">"Status code: {}"</span>+ e.getCode<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
              System.out.println<span class="token punctuation">(</span><span class="token string">"Reason: {}"</span>+ e.getResponseBody<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
              System.out.println<span class="token punctuation">(</span><span class="token string">"Response headers: {}"</span>+ e.getResponseHeaders<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>

</code></pre>
<p>
7、用到的 deployment 资源对象文件也在工程目录的根目录下，其具体的内容如下：
</p>
<pre><code class="prism language-bash">apiVersion: apps/v1
kind: Deployment
metadata:
name: pause <span class="token comment"># 名称</span>
namespace: shiyan <span class="token comment">#指定命名空间</span>
spec:
replicas: 5 <span class="token comment"># 副本数</span>
selector:
matchLabels:
app: pause
template:
metadata:
labels:
app: pause
spec:
schedulerName: my-scheduler <span class="token comment"># 指定自定义的调度器</span>
containers: - name: pause
image: docker.io/mirrorgooglecontainers/pause:3.1 <span class="token comment"># 镜像</span>
</code></pre>
<p>
8、通过 java-client 操作 k8s 集群内的资源对象，可以使用命令 kubectl get pod -n shiyan（这个是命名空间的名称） 查看所有 pod 的状态。
<br/>
补充几条命令：
</p>
<pre><code class="prism language-bash">kubectl get node
kubectl get pod -n shiyan
kubectl describe pod -n shiyan pod 的名称
kubectl log pod 的名称
</code></pre>

   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33313135323032332f:61727469636c652f64657461696c732f313037303232313636" class_="artid" style="display:none">
 </p>
</div>
