---
layout: post
title: "git-submodule"
date: 2025-03-14 00:35:12 +0800
description: "在 A 项目中添加 B 项目的 git 仓库，作为子目录，执行 B 项目在 A 项目中的路径是 A/client/Assets/B。B 仓库作为 A 仓库的 submodule，此时 B 仓库并不是在哪个分支上，而是在 B 仓库的某一条提交。要确保当前使用的 submodule 是最新的提交，递归的将所有子模块更新到远程仓库的最新提交。只有在明确地更新并提交了子模块的状态后，父仓库才会知道子模块现在指向的是最新的提交。A 仓库只是在使用 B 仓库某一次提交的状态，具体细节可以自行查资料。"
keywords: "git submodule"
categories: ['Git']
tags: ['子模块', 'Submodule', 'Submodule', 'Git', 'Git', 'Git', 'Git']
artid: "146245400"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146245400
    alt: "git-submodule"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146245400
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146245400
cover: https://bing.ee123.net/img/rand?artid=146245400
image: https://bing.ee123.net/img/rand?artid=146245400
img: https://bing.ee123.net/img/rand?artid=146245400
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     git submodule
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="git_submodule_0">
     </a>
     git submodule
    </h3>
    <h5>
     <a id="git_submodule__git__git__1">
     </a>
     git submodule 的作用是将一个 git 仓库，最为另一个 git 仓库的子模块
    </h5>
    <p>
     比如
     <br/>
     A 仓库地址：git@github.com:xxxxxxx/A.git
     <br/>
     B 仓库地址：git@github.com:xxxxxxx/B.git
    </p>
    <h5>
     <a id="_A__6">
     </a>
     一、克隆 A 仓库
    </h5>
    <p>
     打开拉取的 A 项目根目录
     <br/>
     在 A 项目中添加 B 项目的 git 仓库，作为子模块，设置 B 项目在 A 项目中的路径是 A/client/Assets/B
     <br/>
     打开命令行，执行命令
    </p>
    <pre><code class="prism language-bash"><span class="token function">git</span> submodule <span class="token function">add</span> git@github.com:xxxxxx/B.git client/Assets/B
</code></pre>
    <p>
     A 项目目录下出现两个文件
    </p>
    <pre><code class="prism language-bash">.gitmobule
client/Assets/B
</code></pre>
    <p>
     打开
     <code>
      .gitmodule
     </code>
     显示 三行信息
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>submodule <span class="token string">"client/Assets/B"</span><span class="token punctuation">]</span>
	path <span class="token operator">=</span> client/Assets/B
	url <span class="token operator">=</span> git@github.com:XXXXXX/B.git
</code></pre>
    <p>
     这里一般默认使用 submodule 仓库 (B)的 master 或者 main 分支
     <br/>
     如果想使用哪一个分支，添加 branch，修改如下
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>submodule <span class="token string">"client/Assets/B"</span><span class="token punctuation">]</span>
	path <span class="token operator">=</span> client/Assets/B
	url <span class="token operator">=</span> git@github.com:LIQIANGEASTSUN/B.git
    branch <span class="token operator">=</span> master_sdk <span class="token comment"># 确保这里是 master_sdk 分支</span>
</code></pre>
    <p>
     在可视化 git 工具，如：SourceTree 上选择 client/Assets/B 可以看到 里边是一条指向 B 项目某一次提交的 commit
     <br/>
     B 仓库作为 A 仓库的 submodule，此时 B 仓库并不是在哪个分支上，而是在 B 仓库的某一条提交
     <br/>
     A 仓库只是在使用 B 仓库某一次提交的状态，具体细节可以自行查资料
    </p>
    <h5>
     <a id="_39">
     </a>
     二、初始化子模块，执行命令
    </h5>
    <pre><code class="prism language-bash"><span class="token function">git</span> submodule init
</code></pre>
    <h5>
     <a id="_submodule_43">
     </a>
     三、更新 submodule，执行命令
    </h5>
    <pre><code class="prism language-bash"><span class="token function">git</span> submodule update
</code></pre>
    <p>
     git submodule update 命令会将子模块检出到父仓库中记录的提交
     <br/>
     只有在明确地更新并提交了子模块的状态后，父仓库才会知道子模块现在指向的是最新的提交
    </p>
    <p>
     要确保当前使用的 submodule 是最新的提交，递归的将所有子模块更新到远程仓库的最新提交
     <br/>
     执行命令：
    </p>
    <pre><code class="prism language-bash"><span class="token function">git</span> submodule update <span class="token parameter variable">--remote</span> <span class="token parameter variable">--recursive</span>
</code></pre>
    <p>
     如果只是想更新具体的 submodule 如 client/Assets/B，将 --recursive 替换为具体的 submodule 名
     <br/>
     执行命令
    </p>
    <pre><code class="prism language-bash"><span class="token function">git</span> submodule update <span class="token parameter variable">--remote</span> client/Assets/B
</code></pre>
    <h5>
     <a id="_61">
     </a>
     四、提交子模块的更新
    </h5>
    <p>
     更新子模块后，需要将子模块的状态提交到父仓库，执行以下命令：
    </p>
    <pre><code class="prism language-bash"><span class="token function">git</span> <span class="token function">add</span> client/Assets/B
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"Update submodule to latest commit"</span>
<span class="token function">git</span> push
</code></pre>
    <h5>
     <a id="_submodule__68">
     </a>
     五、查看 submodule 状态
    </h5>
    <pre><code class="prism language-bash"><span class="token function">git</span> submodule status
输出：daddf8e4fe8b122128c63d69fd73fd031269285a client/Assets/B<span class="token punctuation">(</span>heads/master_sdk<span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="_submodule_74">
     </a>
     六、已经克隆的项目更新 submodule
    </h5>
    <p>
     一个项目已经克隆到本地了，别人添加了一个 submodule 并提交，我们本地仓库需要更新，执行命令：
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 初始化和更新所有子模块</span>
<span class="token function">git</span> submodule update <span class="token parameter variable">--init</span> <span class="token parameter variable">--recursive</span>
</code></pre>
    <p>
     然后执行 三、四
    </p>
    <h5>
     <a id="_submodule__82">
     </a>
     七、克隆一个添加了 submodule 的仓库
    </h5>
    <p>
     执行命令
    </p>
    <pre><code class="prism language-bash"><span class="token function">git</span> clone --recurse-submodules git@github.com:XXXXX/A.git
<span class="token function">git</span> submodule update <span class="token parameter variable">--init</span> <span class="token parameter variable">--recursive</span>
</code></pre>
    <p>
     执行 三 、四
     <br/>
     如果克隆时没有添加
     <code>
      --recurse-submodules
     </code>
     克隆完成后，执行 二、三 、六、七
    </p>
    <h5>
     <a id="_90">
     </a>
     八、删除子模块
    </h5>
    <ol>
     <li>
      删除子模块的条目
      <br/>
      首先，从 .gitmodules 文件中删除子模块的相关配置
      <br/>
      打开 .gitmodules 文件，找到并删除与要移除的子模块相关的条目，如下
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>submodule <span class="token string">"client/Assets/B"</span><span class="token punctuation">]</span>
	path <span class="token operator">=</span> client/Assets/B
	url <span class="token operator">=</span> git@github.com:xxxxxx/B.git
    branch <span class="token operator">=</span> master_sdk <span class="token comment"># 确保这里是 master_sdk 分支</span>
</code></pre>
    <ol start="2">
     <li>
      删除子模块的配置
      <br/>
      接下来，从 Git 配置中删除子模块的条目。您可以使用以下命令：
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token function">git</span> config --remove-section submodule.client/Assets/B
</code></pre>
    <p>
     也可以打开
     <code>
      .git/config
     </code>
     文件手动删除，如下
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>submodule <span class="token string">"client/Assets/B"</span><span class="token punctuation">]</span>
	active <span class="token operator">=</span> <span class="token boolean">true</span>
	url <span class="token operator">=</span> git@github.com:LIQIANGEASTSUN/B.git
</code></pre>
    <ol start="3">
     <li>
      删除子模块的目录
      <code>
       .git\modules\client\Assets\B
      </code>
      目录
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> client/Assets/B
</code></pre>
    <ol start="4">
     <li>
      将这些更改提交到父仓库
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token function">git</span> <span class="token function">add</span> .gitmodules
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"Remove submodule client/Assets/B"</span>
<span class="token function">git</span> push
</code></pre>
    <ol start="5">
     <li>
      清理 Git 缓存（可选）
      <br/>
      如果希望完全清理 Git 的缓存，可以运行以下命令：
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token function">git</span> <span class="token function">rm</span> <span class="token parameter variable">--cached</span> client/Assets/B
</code></pre>
    <ol start="6">
     <li>
      移除子模块
      <br/>
      首先，使用以下命令移除子模块：
      <br/>
      取消子模块的初始化
      <br/>
      git submodule deinit -f client/Assets/B
     </li>
    </ol>
    <p>
     从工作目录和索引中移除子模块
    </p>
    <pre><code class="prism language-bash"><span class="token function">git</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> client/Assets/B
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f67:2e6373646e2e6e65742f4c495149414e474541535453554e2f:61727469636c652f64657461696c732f313436323435343030" class_="artid" style="display:none">
 </p>
</div>


