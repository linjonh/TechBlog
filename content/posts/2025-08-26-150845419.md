---
layout: post
title: "è…¾è®¯å¼€æºOpenTenBaseæ·±åº¦å®è·µä¼ä¸šçº§åˆ†å¸ƒå¼HTAPæ•°æ®åº“éƒ¨ç½²å…¨æ”»ç•¥"
date: 2025-08-26T09:43:17+0800
description: "æ‘˜è¦ï¼šæœ¬æ–‡è¯¦ç»†ä»‹ç»äº†è…¾è®¯å¼€æºä¼ä¸šçº§åˆ†å¸ƒå¼HTAPæ•°æ®åº“OpenTenBaseçš„éƒ¨ç½²å®è·µã€‚OpenTenBaseåŸºäºPostgreSQLæ‰©å±•ï¼Œå…·å¤‡å“è¶Šçš„åˆ†å¸ƒå¼èƒ½åŠ›å’Œé«˜åº¦å…¼å®¹æ€§ã€‚æ–‡ç« ä»æ¶æ„è®¾è®¡ï¼ˆCoordinator/Datanode/GTMæ ¸å¿ƒç»„ä»¶ï¼‰ã€ç¡¬ä»¶é…ç½®åˆ°å®Œæ•´å®‰è£…æµç¨‹ï¼ˆåŒ…æ‹¬ç¯å¢ƒå‡†å¤‡ã€æºç ç¼–è¯‘ã€é›†ç¾¤é…ç½®ï¼‰è¿›è¡Œäº†ç³»ç»Ÿè®²è§£ï¼Œå¹¶æä¾›äº†é›†ç¾¤ç®¡ç†ã€ç›‘æ§ä¼˜åŒ–ã€åˆ†å¸ƒå¼è¡¨è®¾è®¡ç­‰å®æˆ˜ç»éªŒã€‚ç‰¹åˆ«é’ˆå¯¹åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„æ€§èƒ½è°ƒä¼˜å’Œæ•…éšœæ’æŸ¥ç»™å‡ºäº†å…·ä½“è§£å†³æ–¹æ¡ˆï¼Œæœ€åæ€»ç»“äº†OpenTenBaseåœ¨OLTP/OLAPæ··åˆè´Ÿè½½ã€å¼¹æ€§æ‰©å±•ç­‰æ–¹é¢"
keywords: "è…¾è®¯å¼€æºOpenTenBaseæ·±åº¦å®è·µï¼šä¼ä¸šçº§åˆ†å¸ƒå¼HTAPæ•°æ®åº“éƒ¨ç½²å…¨æ”»ç•¥"
categories: ['è…¾è®¯äº‘', 'Ai']
tags: ['è…¾è®¯äº‘æ•°æ®åº“', 'Tdsql', 'Opentenbase']
artid: "150845419"
arturl: "https://blog.csdn.net/IRpickstars/article/details/150845419"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=150845419
    alt: "è…¾è®¯å¼€æºOpenTenBaseæ·±åº¦å®è·µä¼ä¸šçº§åˆ†å¸ƒå¼HTAPæ•°æ®åº“éƒ¨ç½²å…¨æ”»ç•¥"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=150845419
featuredImagePreview: https://bing.ee123.net/img/rand?artid=150845419
cover: https://bing.ee123.net/img/rand?artid=150845419
image: https://bing.ee123.net/img/rand?artid=150845419
img: https://bing.ee123.net/img/rand?artid=150845419
---



# è…¾è®¯å¼€æºOpenTenBaseæ·±åº¦å®è·µï¼šä¼ä¸šçº§åˆ†å¸ƒå¼HTAPæ•°æ®åº“éƒ¨ç½²å…¨æ”»ç•¥



![](https://i-blog.csdnimg.cn/img_convert/eae223a1f794f8dd239384483923c060.png)

## è…¾è®¯å¼€æºOpenTenBaseæ·±åº¦å®è·µï¼šä¼ä¸šçº§åˆ†å¸ƒå¼HTAPæ•°æ®åº“éƒ¨ç½²å…¨æ”»ç•¥

> ğŸŒŸ Helloï¼Œæˆ‘æ˜¯æ‘˜æ˜Ÿï¼  
>  ğŸŒˆ åœ¨å½©è™¹èˆ¬ç»šçƒ‚çš„æŠ€æœ¯æ ˆä¸­ï¼Œæˆ‘æ˜¯é‚£ä¸ªæ°¸ä¸åœæ­‡çš„è‰²å½©æ”¶é›†è€…ã€‚  
>  ğŸ¦‹ æ¯ä¸€ä¸ªä¼˜åŒ–éƒ½æ˜¯æˆ‘åŸ¹è‚²çš„èŠ±æœµï¼Œæ¯ä¸€ä¸ªç‰¹æ€§éƒ½æ˜¯æˆ‘æ”¾é£çš„è´è¶ã€‚  
>  ğŸ”¬ æ¯ä¸€æ¬¡ä»£ç å®¡æŸ¥éƒ½æ˜¯æˆ‘çš„æ˜¾å¾®é•œè§‚å¯Ÿï¼Œæ¯ä¸€æ¬¡é‡æ„éƒ½æ˜¯æˆ‘çš„åŒ–å­¦å®éªŒã€‚  
>  ğŸµ åœ¨ç¼–ç¨‹çš„äº¤å“ä¹ä¸­ï¼Œæˆ‘æ—¢æ˜¯æŒ‡æŒ¥å®¶ä¹Ÿæ˜¯æ¼”å¥è€…ã€‚è®©æˆ‘ä»¬ä¸€èµ·ï¼Œåœ¨æŠ€æœ¯çš„éŸ³ä¹å…é‡Œï¼Œå¥å“å±äºç¨‹åºå‘˜çš„åç¾ä¹ç« ã€‚




























































---

### æ‘˜è¦

ä½œä¸ºä¸€ååœ¨åˆ†å¸ƒå¼æ•°æ®åº“é¢†åŸŸæ‘¸çˆ¬æ»šæ‰“å¤šå¹´çš„æŠ€æœ¯ä»ä¸šè€…ï¼Œæˆ‘åœ¨æœ€è¿‘çš„é¡¹ç›®ä¸­æ·±åº¦å®è·µäº†OpenTenBaseçš„éƒ¨ç½²ä¸è¿ç»´å·¥ä½œã€‚OpenTenBaseä½œä¸ºè…¾è®¯å¼€æºçš„åˆ†å¸ƒå¼HTAPæ•°æ®åº“ï¼Œå…¶å¼ºå¤§çš„åˆ†å¸ƒå¼èƒ½åŠ›å’Œå¯¹PostgreSQLçš„é«˜åº¦å…¼å®¹æ€§è®©æˆ‘å°è±¡æ·±åˆ»ã€‚åœ¨å®é™…æ“ä½œè¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°OpenTenBaseä¸ä»…ç»§æ‰¿äº†PostgreSQLçš„ç¨³å®šæ€§å’Œä¸°å¯Œçš„ç”Ÿæ€ï¼Œæ›´é‡è¦çš„æ˜¯å®ƒåœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹å±•ç°å‡ºäº†å“è¶Šçš„æ¨ªå‘æ‰©å±•èƒ½åŠ›ã€‚

ä»å®‰è£…éƒ¨ç½²çš„è§’åº¦æ¥çœ‹ï¼ŒOpenTenBaseçš„æ¶æ„è®¾è®¡éå¸¸æ¸…æ™°ï¼ŒåŒ…å«Coordinatorï¼ˆCNï¼‰ã€Datanodeï¼ˆDNï¼‰å’ŒGlobal Transaction Managerï¼ˆGTMï¼‰ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ã€‚åœ¨æˆ‘çš„å®é™…éƒ¨ç½²è¿‡ç¨‹ä¸­ï¼Œæœ€åˆé‡åˆ°äº†èŠ‚ç‚¹é—´é€šä¿¡é…ç½®çš„ä¸€äº›å°é—®é¢˜ï¼Œä½†é€šè¿‡æ·±å…¥ç†è§£å…¶æ¶æ„åŸç†ï¼Œå¾ˆå¿«å°±è§£å†³äº†è¿™äº›æŒ‘æˆ˜ã€‚ç‰¹åˆ«å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒOpenTenBaseçš„åˆ†ç‰‡ç­–ç•¥å’Œæ•°æ®åˆ†å¸ƒæœºåˆ¶è®¾è®¡å¾—ç›¸å½“ä¼˜é›…ï¼Œæ”¯æŒHashã€Rangeã€Listç­‰å¤šç§åˆ†ç‰‡æ–¹å¼ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°é€‚åº”ä¸åŒä¸šåŠ¡åœºæ™¯çš„éœ€æ±‚ã€‚

åœ¨é…ç½®è°ƒè¯•ç¯èŠ‚ï¼Œæˆ‘ä½“éªŒåˆ°äº†OpenTenBaseåœ¨å‚æ•°è°ƒä¼˜æ–¹é¢çš„çµæ´»æ€§ã€‚ä¸ä¼ ç»Ÿå•æœºæ•°æ®åº“ä¸åŒï¼Œåˆ†å¸ƒå¼æ•°æ®åº“çš„è°ƒä¼˜éœ€è¦è€ƒè™‘æ›´å¤šç»´åº¦çš„å› ç´ ï¼ŒåŒ…æ‹¬ç½‘ç»œå»¶è¿Ÿã€æ•°æ®å€¾æ–œã€è·¨èŠ‚ç‚¹äº‹åŠ¡ç­‰ã€‚OpenTenBaseæä¾›äº†ä¸°å¯Œçš„ç›‘æ§æŒ‡æ ‡å’Œè°ƒä¼˜å‚æ•°ï¼Œè®©æˆ‘èƒ½å¤Ÿæ ¹æ®å…·ä½“çš„ä¸šåŠ¡è´Ÿè½½ç‰¹å¾è¿›è¡Œç²¾ç»†åŒ–è°ƒä¼˜ã€‚è¿ç»´ç›‘æ§æ–¹é¢ï¼Œæˆ‘ä½¿ç”¨äº†Prometheus + Grafanaçš„ç›‘æ§æ–¹æ¡ˆï¼Œé…åˆOpenTenBaseå†…ç½®çš„ç»Ÿè®¡è§†å›¾ï¼Œæ„å»ºäº†ä¸€å¥—å®Œæ•´çš„ç›‘æ§ä½“ç³»ï¼Œèƒ½å¤Ÿå®æ—¶æŒæ¡é›†ç¾¤çš„å¥åº·çŠ¶æ€å’Œæ€§èƒ½è¡¨ç°ã€‚

### 1. OpenTenBaseæ¶æ„æ¦‚è¿°

#### 1.1 æ ¸å¿ƒç»„ä»¶ä»‹ç»

OpenTenBaseé‡‡ç”¨äº†å…¸å‹çš„åˆ†å¸ƒå¼æ•°æ®åº“æ¶æ„ï¼Œä¸»è¦ç”±ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶æ„æˆï¼š

* **Coordinator (CN)**ï¼šåè°ƒèŠ‚ç‚¹ï¼Œè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼Œåˆ¶å®šæ‰§è¡Œè®¡åˆ’ï¼Œåè°ƒåˆ†å¸ƒå¼äº‹åŠ¡
* **Datanode (DN)**ï¼šæ•°æ®èŠ‚ç‚¹ï¼Œè´Ÿè´£æ•°æ®å­˜å‚¨å’Œæœ¬åœ°æ•°æ®å¤„ç†
* **Global Transaction Manager (GTM)**ï¼šå…¨å±€äº‹åŠ¡ç®¡ç†å™¨ï¼Œè´Ÿè´£åˆ†å¸ƒå¼äº‹åŠ¡çš„å…¨å±€ä¸€è‡´æ€§

![](https://i-blog.csdnimg.cn/img_convert/deba31d55dc76df303c3ca54dbda175b.png)

**å›¾1ï¼šOpenTenBaseæ¶æ„å›¾ - å±•ç¤ºæ ¸å¿ƒç»„ä»¶åŠå…¶å…³ç³»**

#### 1.2 åˆ†ç‰‡ç­–ç•¥å¯¹æ¯”

OpenTenBaseæ”¯æŒå¤šç§åˆ†ç‰‡ç­–ç•¥ï¼Œæ¯ç§ç­–ç•¥éƒ½æœ‰å…¶é€‚ç”¨åœºæ™¯ï¼š

|  |  |  |  |  |
| --- | --- | --- | --- | --- |
| åˆ†ç‰‡ç­–ç•¥ | é€‚ç”¨åœºæ™¯ | ä¼˜åŠ¿ | åŠ£åŠ¿ | æ¨èæŒ‡æ•° |
| Hashåˆ†ç‰‡ | å‡åŒ€åˆ†å¸ƒçš„OLTPè´Ÿè½½ | æ•°æ®åˆ†å¸ƒå‡åŒ€ï¼ŒæŸ¥è¯¢æ€§èƒ½ç¨³å®š | èŒƒå›´æŸ¥è¯¢æ€§èƒ½è¾ƒå·® | â­â­â­â­â­ |
| Rangeåˆ†ç‰‡ | æ—¶åºæ•°æ®ï¼Œéœ€è¦èŒƒå›´æŸ¥è¯¢ | èŒƒå›´æŸ¥è¯¢æ€§èƒ½ä¼˜ç§€ | å¯èƒ½äº§ç”Ÿçƒ­ç‚¹ | â­â­â­â­ |
| Liståˆ†ç‰‡ | æŒ‰ä¸šåŠ¡ç»´åº¦åˆ†ç‰‡ | ä¸šåŠ¡é€»è¾‘æ¸…æ™° | ç»´æŠ¤å¤æ‚åº¦é«˜ | â­â­â­ |

### 2. ç¯å¢ƒå‡†å¤‡ä¸ç³»ç»Ÿè¦æ±‚

#### 2.1 ç¡¬ä»¶èµ„æºè§„åˆ’

åœ¨å®é™…éƒ¨ç½²è¿‡ç¨‹ä¸­ï¼Œæˆ‘å»ºè®®æŒ‰ç…§ä»¥ä¸‹é…ç½®æ¥è§„åˆ’ç¡¬ä»¶èµ„æºï¼š

![](https://i-blog.csdnimg.cn/img_convert/b7c9edeb80b99cc933dcd227147b62f8.png)

**å›¾2ï¼šç¡¬ä»¶èµ„æºåˆ†é…é¥¼å›¾ - å„ç»„ä»¶èµ„æºå æ¯”å»ºè®®**

#### 2.2 æ“ä½œç³»ç»Ÿé…ç½®

åŸºç¡€ç³»ç»Ÿå‚æ•°ä¼˜åŒ–æ˜¯ç¡®ä¿OpenTenBaseç¨³å®šè¿è¡Œçš„å…³é”®ï¼š

```
# ç³»ç»Ÿå†…æ ¸å‚æ•°ä¼˜åŒ–
cat >> /etc/sysctl.conf << EOF
# å†…å­˜ç®¡ç†
vm.swappiness = 10
vm.dirty_background_ratio = 3
vm.dirty_ratio = 10
vm.overcommit_memory = 2
vm.overcommit_ratio = 90

# ç½‘ç»œå‚æ•°
net.core.rmem_max = 134217728
net.core.wmem_max = 134217728
net.ipv4.tcp_rmem = 4096 87380 134217728
net.ipv4.tcp_wmem = 4096 65536 134217728

# æ–‡ä»¶å¥æŸ„é™åˆ¶
fs.file-max = 6815744
EOF

# åº”ç”¨ç³»ç»Ÿå‚æ•°
sysctl -p
```

**å…³é”®é…ç½®è¯´æ˜**ï¼š

* `vm.swappiness = 10`ï¼šå‡å°‘swapä½¿ç”¨ï¼Œæé«˜æ•°æ®åº“æ€§èƒ½
* ç½‘ç»œç¼“å†²åŒºè®¾ç½®ï¼šä¼˜åŒ–åˆ†å¸ƒå¼èŠ‚ç‚¹é—´é€šä¿¡
* æ–‡ä»¶å¥æŸ„é™åˆ¶ï¼šæ”¯æŒé«˜å¹¶å‘è¿æ¥

### 3. OpenTenBaseå®‰è£…éƒ¨ç½²

#### 3.1 éƒ¨ç½²æµç¨‹æ¦‚è§ˆ

![](https://i-blog.csdnimg.cn/img_convert/7fdc6e15ba36a263f7ab9397c3b1118c.png)

**å›¾3ï¼šéƒ¨ç½²æµç¨‹å›¾ - å®Œæ•´çš„å®‰è£…éƒ¨ç½²æµç¨‹**

#### OpenTenBaseç®€ä»‹

OpenTenBaseæ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“é›†ç¾¤å¹³å°ï¼Œæä¾›å†™å…¥å¯é æ€§å’Œå¤šèŠ‚ç‚¹æ•°æ®åŒæ­¥åŠŸèƒ½ã€‚å¯ä»¥åœ¨ä¸€å°æˆ–å¤šå°ä¸»æœºä¸Šé…ç½®OpenTenBaseï¼Œå¹¶å°†æ•°æ®å­˜å‚¨åœ¨å¤šä¸ªç‰©ç†ä¸»æœºä¸Šã€‚

![](https://i-blog.csdnimg.cn/img_convert/01aefd1ba8853728f8e1b3001a1eae75.png)

##### OpenTenBaseæ¶æ„ç»„ä»¶ï¼š

* **Coordinator Node (CN)**ï¼šåº”ç”¨ç¨‹åºè®¿é—®å…¥å£ï¼Œè´Ÿè´£æ•°æ®åˆ†å¸ƒå’ŒæŸ¥è¯¢è®¡åˆ’ã€‚å¤šä¸ªèŠ‚ç‚¹ä½äºåŒä¸€ä½ç½®ï¼Œæ¯ä¸ªèŠ‚ç‚¹æä¾›ç›¸åŒçš„æ•°æ®åº“è§†å›¾
* **Datanode Node (DN)**ï¼šæ¯ä¸ªDNå­˜å‚¨ç”¨æˆ·æ•°æ®çš„åˆ†åŒºã€‚åœ¨åŠŸèƒ½ä¸Šï¼ŒDNèŠ‚ç‚¹è´Ÿè´£å®ŒæˆCNåˆ†å‘çš„æ‰§è¡Œè¯·æ±‚
* **GTM Node (Global Transaction Manager)**ï¼šè´Ÿè´£é›†ç¾¤äº‹åŠ¡ä¿¡æ¯çš„ç®¡ç†ï¼Œä»¥åŠé›†ç¾¤çš„å…¨å±€å¯¹è±¡ï¼ˆå¦‚åºåˆ—ï¼‰

#### ç³»ç»Ÿè¦æ±‚

##### ç¡¬ä»¶è¦æ±‚ï¼š

* **å†…å­˜**ï¼šæœ€ä½4GB RAM
* **æ“ä½œç³»ç»Ÿ**ï¼šOpenCloudOS 9
* **æœåŠ¡å™¨**ï¼šè…¾è®¯äº‘CVMå®ä¾‹

![](https://i-blog.csdnimg.cn/img_convert/6e38c786149af220a922322b91065693.png)

##### è½¯ä»¶ä¾èµ–ï¼š

gcc make readline-devel zlib-devel openssl-devel uuid-devel bison flex git

#### ç¯å¢ƒå‡†å¤‡

##### 1. æ›´æ–°ç³»ç»Ÿå¹¶å®‰è£…ä¾èµ–åŒ…

ç”±äºOpenCloudOSæ”¯æŒdnfå’Œyumä¸¤ç§åŒ…ç®¡ç†è½¯ä»¶ï¼Œå¼ºçƒˆæ¨èç”¨æˆ·æ›´å¤šåœ°ä½¿ç”¨dnfï¼Œæˆ‘ä»¬ä½¿ç”¨dnfæ¥å®‰è£…ä¾èµ–ï¼š

```
# æ›´æ–°ç³»ç»Ÿ
sudo dnf update -y
```

![](https://i-blog.csdnimg.cn/img_convert/95d1916d03faef861ac1c3829b8035c2.png)

![](https://i-blog.csdnimg.cn/img_convert/4e429886ece6202b7a054e320c080948.png)

```
# å®‰è£…OpenTenBaseç¼–è¯‘ä¾èµ–
sudo dnf install -y \
    gcc \
    gcc-c++ \
    make \
    cmake \
    readline-devel \
    zlib-devel \
    openssl-devel \
    uuid-devel \
    bison \
    flex \
    git \
    libcurl-devel \
    libxml2-devel \
    libxslt-devel \
    perl-IPC-Run \
    perl-Test-Simple \
    tcl-devel \
    python3-devel \
    rpm-build \
    pkgconfig \
    krb5-devel \
    openldap-devel
```

![](https://i-blog.csdnimg.cn/img_convert/c667e0baf642bfc37fe7a461f49f366d.png)

![](https://i-blog.csdnimg.cn/img_convert/55f2753fad9e5815d72bc46142a3a1cd.png)

```
# ä¸‹è½½zstdæºç 
cd /tmp
wget https://github.com/facebook/zstd/releases/download/v1.5.2/zstd-1.5.2.tar.gz
tar -xzf zstd-1.5.2.tar.gz
cd zstd-1.5.2

# ç¼–è¯‘å®‰è£…
make
sudo make install PREFIX=/usr/local

# æ›´æ–°åº“è·¯å¾„
sudo ldconfig

# è®¾ç½®ç¯å¢ƒå˜é‡
export PKG_CONFIG_PATH="/usr/local/lib/pkgconfig:$PKG_CONFIG_PATH"

```

![](https://i-blog.csdnimg.cn/img_convert/5213242a4ef9486daff63a26871ab7b9.png)

![](https://i-blog.csdnimg.cn/img_convert/be60d7cfc154dfbdb4cb469a2f69ef95.png)

```
# ä¸‹è½½lz4æºç 
cd /tmp
wget https://github.com/lz4/lz4/archive/v1.9.4.tar.gz
tar -xzf v1.9.4.tar.gz
cd lz4-1.9.4

# ç¼–è¯‘å®‰è£…
make
sudo make install PREFIX=/usr/local

# æ›´æ–°åº“è·¯å¾„
sudo ldconfig

# è®¾ç½®ç¯å¢ƒå˜é‡
export PKG_CONFIG_PATH="/usr/local/lib/pkgconfig:$PKG_CONFIG_PATH"
export LD_LIBRARY_PATH="/usr/local/lib:$LD_LIBRARY_PATH"
```

![](https://i-blog.csdnimg.cn/img_convert/aef3a3c7a66a5a1788f600fa4965093a.png)

```
# é¦–å…ˆæ£€æŸ¥å½“å‰çš„åŒ…ç®¡ç†å™¨çŠ¶æ€
sudo dnf clean all

# å®‰è£…libxml2-develåŠå…¶ä¾èµ–åŒ…
sudo dnf install -y \
    libxml2-devel \
    libxml2 \
    cmake-filesystem \
    xz-devel \
    zlib-devel \
    pkgconfig

# éªŒè¯å®‰è£…
rpm -qa | grep libxml2
# æ£€æŸ¥xml2-configå‘½ä»¤æ˜¯å¦å¯ç”¨
which xml2-config

# æ£€æŸ¥pkg-configæ˜¯å¦èƒ½æ‰¾åˆ°libxml-2.0
pkg-config --exists libxml-2.0 && echo "libxml2 found" || echo "libxml2 NOT found"

# æŸ¥çœ‹libxml2çš„é…ç½®ä¿¡æ¯
xml2-config --version
xml2-config --cflags
xml2-config --libs

```

```
sudo dnf search cli11
sudo dnf install -y cli11-devel
```

##### 2. åˆ›å»ºä¸“ç”¨ç”¨æˆ·

æ‰€æœ‰éœ€è¦å®‰è£…OpenTenBaseé›†ç¾¤çš„æœºå™¨éƒ½éœ€è¦åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼š

```
# åˆ›å»ºæ•°æ®ç›®å½•
sudo mkdir /data

# åˆ›å»ºopentenbaseç”¨æˆ·
sudo useradd -d /data/opentenbase -s /bin/bash -m opentenbase

# è®¾ç½®å¯†ç 
sudo passwd opentenbase
```

![](https://i-blog.csdnimg.cn/img_convert/0784360b61a7a07b9229a393ac9ea390.png)

##### 3. åˆ‡æ¢åˆ°opentenbaseç”¨æˆ·

```
su - opentenbase
```

![](https://i-blog.csdnimg.cn/img_convert/b7ce7ce239fcd43c08b132569c9402cc.png)

#### æºç ç¼–è¯‘å®‰è£…

##### 1. è·å–æºç 

```
cd /data/opentenbase
git clone https://gitee.com/mirrors/OpenTenBase.git
```

![](https://i-blog.csdnimg.cn/img_convert/60ed1c2b8b70571fcb3b91762612803f.png)

##### 2. ç¼–è¯‘æºç 

```
# è®¾ç½®ç¯å¢ƒå˜é‡
export SOURCECODE_PATH=/data/opentenbase/OpenTenBase
export INSTALL_PATH=/data/opentenbase/install
```

![](https://i-blog.csdnimg.cn/img_convert/f572cfaef1974011005965f242fd26f6.png)

```
# è¿›å…¥æºç ç›®å½•
cd ${SOURCECODE_PATH}

# é…ç½®ç¼–è¯‘é€‰é¡¹
chmod +x configure*
```

![](https://i-blog.csdnimg.cn/img_convert/45c352bed7d0726c1ac62cbe853eabac.png)

![](https://i-blog.csdnimg.cn/img_convert/6f7d2d13fe8e07ce793c4e866f2e8710.png)

```
# ç¼–è¯‘å’Œå®‰è£…
make distclean 2>/dev/null || true
rm -rf /data/opentenbase/install/opentenbase_bin_v2.0
rm -f config.status config.log
# é‡æ–°é…ç½®ï¼Œæ·»åŠ SSE4.2æ”¯æŒ
CFLAGS="-g -O2 -w -msse4.2 -mcrc32" \
CXXFLAGS="-g -O2 -w -msse4.2 -mcrc32" \
./configure --prefix=/data/opentenbase/install/opentenbase_bin_v2.0 \
    --enable-user-switch \
    --with-openssl \
    --with-ossp-uuid \
    --with-libxml

# ç¼–è¯‘
make
make install

# ç¼–è¯‘contribæ¨¡å—
chmod +x contrib/pgxc_ctl/make_signature
cd contrib
make
make install
```

![](https://i-blog.csdnimg.cn/img_convert/46b03383e1fe5119bff8aa136ea0cd9a.png)

![](https://i-blog.csdnimg.cn/img_convert/f5f1611f14d9d5d23f3f3cc01bce0f71.png)

#### é›†ä¸­å¼å•èŠ‚ç‚¹é›†ç¾¤é…ç½®

##### 1. é…ç½®ç¯å¢ƒå˜é‡

```
# ç¼–è¾‘bashrcæ–‡ä»¶
vim ~/.bashrc

# æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
export OPENTENBASE_HOME=/data/opentenbase/install/opentenbase_bin_v2.0
export PATH=$OPENTENBASE_HOME/bin:$PATH
export LD_LIBRARY_PATH=$OPENTENBASE_HOME/lib:${LD_LIBRARY_PATH}
export LC_ALL=C

# ç”Ÿæ•ˆç¯å¢ƒå˜é‡
source ~/.bashrc
```

![](https://i-blog.csdnimg.cn/img_convert/aa069f01a4e963635d3496e2e354c368.png)

![](https://i-blog.csdnimg.cn/img_convert/db0f8bbb8433ce9a9dedef134fdcf69e.png)

##### 2. åˆ›å»ºé›†ç¾¤é…ç½®ç›®å½•

```
mkdir /data/opentenbase/pgxc_ctl
cd /data/opentenbase/pgxc_ctl
```

![](https://i-blog.csdnimg.cn/img_convert/5eea200eb00f493e6cc6ff12f801e88d.png)

##### 3. åˆ›å»ºé›†ä¸­å¼é…ç½®æ–‡ä»¶

```
cat > /data/opentenbase/install/opentenbase_bin_v2.0/pgxc_ctl.conf << 'EOF'
#!/usr/bin/env bash

#---- OVERALL -----------------------------------------------------------------------------
pgxcOwner=opentenbase
pgxcUser=$pgxcOwner
tmpDir=/tmp
localTmpDir=$tmpDir
configBackup=y
configBackupHost=localhost
configBackupDir=$HOME/pgxc
configBackupFile=pgxc_ctl.bak

#---- GTM --------------------------------------------------------------------------------
gtmName=gtm
gtmMasterServer=localhost
gtmMasterPort=6666
gtmMasterDir=/data/opentenbase/data/gtm
gtmExtraConfig=none
gtmMasterSpecificExtraConfig=none

# GTM Slave - disabled
gtmSlave=n
gtmSlaveName=gtmSlave
gtmSlaveServer=none
gtmSlavePort=20001
gtmSlaveDir=none
gtmSlaveSpecificExtraConfig=none

# GTM Proxy - disabled  
gtmProxy=n
gtmProxyNames=()
gtmProxyServers=()
gtmProxyPorts=()
gtmProxyDirs=()
gtmPxyExtraConfig=none
gtmPxySpecificExtraConfig=()

#---- Coordinators --------------------------------------------------------------------
coordMasterDir=/data/opentenbase/data/coord_master
coordSlaveDir=/data/opentenbase/data/coord_slave
coordArchLogDir=/data/opentenbase/data/coord_archlog

# åè°ƒå™¨é…ç½®æ•°ç»„ - æ‰€æœ‰æ•°ç»„å¿…é¡»æœ‰ç›¸åŒæ•°é‡çš„å…ƒç´ 
coordNames=(cn001)
coordPorts=(30004)
poolerPorts=(30014)
coordForwardPorts=(30024)
coordPgHbaEntries=(0.0.0.0/0)

# Master Coordinators
coordMasterServers=(localhost)  
coordMasterDirs=(/data/opentenbase/data/coord_master/cn001)
coordMaxWALsender=5
coordMaxWALSenders=(5)

# Coordinator Slave - disabled
coordSlave=n
coordSlaveSync=n
coordSlaveServers=(none)
coordSlavePorts=(30005)
coordSlavePoolerPorts=(30015)
coordSlaveForwardPorts=(30025)
coordSlaveDirs=(none)
coordArchLogDirs=(none)

# Configuration files
coordExtraConfig=none
coordSpecificExtraConfig=(none)
coordSpecificExtraPgHba=(none)

#---- Datanodes -----------------------------------------------------------------------  
datanodeMasterDir=/data/opentenbase/data/dn_master
datanodeSlaveDir=/data/opentenbase/data/dn_slave
datanodeArchLogDir=/data/opentenbase/data/datanode_archlog

# æ•°æ®èŠ‚ç‚¹é…ç½®æ•°ç»„ - æ‰€æœ‰æ•°ç»„å¿…é¡»æœ‰ç›¸åŒæ•°é‡çš„å…ƒç´ 
primaryDatanode=dn001
datanodeNames=(dn001)
datanodePorts=(20008)
datanodePoolerPorts=(20018)
datanodeForwardPorts=(20028)
datanodePgHbaEntries=(0.0.0.0/0)

# Master Datanodes
datanodeMasterServers=(localhost)
datanodeMasterDirs=(/data/opentenbase/data/dn_master/dn001)
datanodeMaxWalSender=5
datanodeMaxWALSenders=(5)

# Datanode Slave - disabled
datanodeSlave=n
datanodeSlaveServers=(none)
datanodeSlavePorts=(20009)
datanodeSlavePoolerPorts=(20019)
datanodeSlaveForwardPorts=(20029)
datanodeSlaveDirs=(none)
datanodeArchLogDirs=(none)

# Configuration files
datanodeExtraConfig=none  
datanodeSpecificExtraConfig=(none)
datanodeSpecificExtraPgHba=(none)

# WAL Archive - disabled
walArchive=n
EOF

```

```
# æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
bash -n /data/opentenbase/install/opentenbase_bin_v2.0/pgxc_ctl.conf
echo "é…ç½®æ–‡ä»¶è¯­æ³•æ£€æŸ¥ç»“æœ: $?"

# æŸ¥çœ‹æ–‡ä»¶å†…å®¹ç¡®è®¤
head -20 /data/opentenbase/install/opentenbase_bin_v2.0/pgxc_ctl.conf

```

æ£€æŸ¥ç¯å¢ƒå˜é‡

```
# æ£€æŸ¥å½“å‰ç¯å¢ƒå˜é‡
echo $PATH
echo $OPENTENBASE_HOME
which initdb
which gtm_ctl
```

é‡æ–°è®¾ç½®ç¯å¢ƒå˜é‡

```
# é€€å‡ºpgxc_ctl
quit

# é‡æ–°è®¾ç½®ç¯å¢ƒå˜é‡
export OPENTENBASE_HOME=/data/opentenbase/install/opentenbase_bin_v2.0
export PATH=$OPENTENBASE_HOME/bin:$PATH
export LD_LIBRARY_PATH=$OPENTENBASE_HOME/lib:${LD_LIBRARY_PATH}
export LC_ALL=C

# éªŒè¯å‘½ä»¤æ˜¯å¦å¯ç”¨
which initdb
which gtm_ctl
which pg_ctl
```

æ°¸ä¹…ä¿å­˜ç¯å¢ƒå˜é‡

```
# ç¼–è¾‘ .bashrc æ–‡ä»¶
vim ~/.bashrc

# æ·»åŠ ä»¥ä¸‹å†…å®¹åˆ°æ–‡ä»¶æœ«å°¾ï¼š
export OPENTENBASE_HOME=/data/opentenbase/install/opentenbase_bin_v2.0
export PATH=$OPENTENBASE_HOME/bin:$PATH
export LD_LIBRARY_PATH=$OPENTENBASE_HOME/lib:${LD_LIBRARY_PATH}
export LC_ALL=C

# é‡æ–°åŠ è½½ç¯å¢ƒå˜é‡
source ~/.bashrc
```

é‡æ–°åˆ›å»ºå®Œæ•´çš„é…ç½®æ–‡ä»¶

```
# åˆ é™¤ä¸å®Œæ•´çš„é…ç½®æ–‡ä»¶
rm /data/opentenbase/install/opentenbase_bin_v2.0/pgxc_ctl.conf

# é‡æ–°åˆ›å»ºå®Œæ•´é…ç½®æ–‡ä»¶
cat > /data/opentenbase/install/opentenbase_bin_v2.0/pgxc_ctl.conf << 'EOF'
#!/usr/bin/env bash

#---- OVERALL -----------------------------------------------------------------------------
pgxcOwner=opentenbase
pgxcUser=$pgxcOwner
tmpDir=/tmp
localTmpDir=$tmpDir
configBackup=y
configBackupHost=localhost
configBackupDir=$HOME/pgxc
configBackupFile=pgxc_ctl.bak

#---- GTM --------------------------------------------------------------------------------
gtmName=gtm
gtmMasterServer=localhost
gtmMasterPort=6666
gtmMasterDir=/data/opentenbase/data/gtm
gtmExtraConfig=none
gtmMasterSpecificExtraConfig=none

gtmSlave=n
gtmSlaveName=gtmSlave
gtmSlaveServer=none
gtmSlavePort=20001
gtmSlaveDir=none
gtmSlaveSpecificExtraConfig=none

gtmProxy=n
gtmProxyNames=()
gtmProxyServers=()
gtmProxyPorts=()
gtmProxyDirs=()
gtmPxyExtraConfig=none
gtmPxySpecificExtraConfig=()

#---- Coordinators --------------------------------------------------------------------
coordMasterDir=/data/opentenbase/data/coord_master
coordSlaveDir=/data/opentenbase/data/coord_slave
coordArchLogDir=/data/opentenbase/data/coord_archlog

coordNames=(cn001)
coordPorts=(30004)
poolerPorts=(30014)
coordForwardPorts=(30024)
coordPgHbaEntries=(0.0.0.0/0)

coordMasterServers=(localhost)
coordMasterDirs=(/data/opentenbase/data/coord_master/cn001)
coordMaxWALsender=5
coordMaxWALSenders=(5)

coordSlave=n
coordSlaveSync=n
coordSlaveServers=(none)
coordSlavePorts=(30005)
coordSlavePoolerPorts=(30015)
coordSlaveForwardPorts=(30025)
coordSlaveDirs=(none)
coordArchLogDirs=(none)

coordExtraConfig=none
coordSpecificExtraConfig=(none)
coordSpecificExtraPgHba=(none)

#---- Datanodes -----------------------------------------------------------------------
datanodeMasterDir=/data/opentenbase/data/dn_master
datanodeSlaveDir=/data/opentenbase/data/dn_slave
datanodeArchLogDir=/data/opentenbase/data/datanode_archlog

primaryDatanode=dn001
datanodeNames=(dn001)
datanodePorts=(20008)
datanodePoolerPorts=(20018)
datanodeForwardPorts=(20028)
datanodePgHbaEntries=(0.0.0.0/0)

datanodeMasterServers=(localhost)
datanodeMasterDirs=(/data/opentenbase/data/dn_master/dn001)
datanodeMaxWalSender=5
datanodeMaxWALSenders=(5)

datanodeSlave=n
datanodeSlaveServers=(none)
datanodeSlavePorts=(20009)
datanodeSlavePoolerPorts=(20019)
datanodeSlaveForwardPorts=(20029)
datanodeSlaveDirs=(none)
datanodeArchLogDirs=(none)

datanodeExtraConfig=none
datanodeSpecificExtraConfig=(none)
datanodeSpecificExtraPgHba=(none)

walArchive=n
EOF
```

éªŒè¯é…ç½®æ–‡ä»¶

```
# æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
bash -n /data/opentenbase/install/opentenbase_bin_v2.0/pgxc_ctl.conf
echo "è¯­æ³•æ£€æŸ¥ç»“æœ: $?"

# æŸ¥çœ‹æ–‡ä»¶å®Œæ•´æ€§
wc -l /data/opentenbase/install/opentenbase_bin_v2.0/pgxc_ctl.conf
tail -10 /data/opentenbase/install/opentenbase_bin_v2.0/pgxc_ctl.conf
```

é…ç½®SSHå…å¯†ç™»å½•

```
# ç”ŸæˆSSHå¯†é’¥ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
if [ ! -f ~/.ssh/id_rsa ]; then
    ssh-keygen -t rsa -N "" -f ~/.ssh/id_rsa
fi

# é…ç½®æœ¬åœ°å…å¯†ç™»å½•
ssh-copy-id opentenbase@localhost
# æˆ–è€…æ‰‹åŠ¨æ·»åŠ 
cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
```

![](https://i-blog.csdnimg.cn/img_convert/a2e72edca96db51fa1aff61941865099.png)

æµ‹è¯•SSHè¿æ¥

```
# æµ‹è¯•SSHè¿æ¥æ˜¯å¦æ­£å¸¸
ssh opentenbase@localhost "echo 'SSH connection test successful'"
```

![](https://i-blog.csdnimg.cn/img_convert/076f02e13806eada920558229553d7d3.png)

é‡æ–°è¿è¡Œpgxc_ctl

```
# ç°åœ¨é‡æ–°è¿è¡Œpgxc_ctl
pgxc_ctl

# åœ¨pgxc_ctlä¸­æ‰§è¡Œï¼š
deploy all
init all
start all
monitor all
```

![](https://i-blog.csdnimg.cn/img_convert/fb58bd6950d20a2127142dbbf16371a0.png)

##### 4. éƒ¨ç½²å’Œåˆå§‹åŒ–é›†ç¾¤

```
# å¯åŠ¨pgxc_ctlå·¥å…·
pgxc_ctl

# åœ¨pgxc_ctlå‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼š
deploy all
init all
```

```
# é€€å‡ºpgxc_ctl
exit

# è®¾ç½®opentenbaseç”¨æˆ·çš„SSHå¯†é’¥è®¤è¯
su - opentenbase

# ç”ŸæˆSSHå¯†é’¥å¯¹
ssh-keygen -t rsa -b 2048 -f ~/.ssh/id_rsa -N ""

# å°†å…¬é’¥æ·»åŠ åˆ°authorized_keys
cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh

# æµ‹è¯•SSHè¿æ¥ï¼ˆåº”è¯¥ä¸éœ€è¦å¯†ç ï¼‰
ssh opentenbase@127.0.0.1 "echo 'SSHè¿æ¥æµ‹è¯•æˆåŠŸ'"

MQgnDKIwotjP9+vkGc9jehXXIzfXSJ2+ZAnFP5IDvIc.
```

![](https://i-blog.csdnimg.cn/img_convert/335eb7ad3e5fefa4981a40c92c2ce517.png)

##### 5. éªŒè¯é›†ç¾¤çŠ¶æ€

```
# åœ¨pgxc_ctlä¸­æ£€æŸ¥é›†ç¾¤çŠ¶æ€
monitor all
```

æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥æ˜¾ç¤ºï¼š

```
Running: gtm master
Running: coordinator master cn001
Running: datanode master dn001
```

![](https://i-blog.csdnimg.cn/img_convert/7500ce94a321ca54e278ccd6f7ad2ff9.png)

![](https://i-blog.csdnimg.cn/img_convert/e2a4bb4557cb9bf1ae4246d3fdcb4092.png)

#### é…ç½®é˜²ç«å¢™ï¼ˆå¯é€‰ï¼‰

å¦‚æœå¯ç”¨äº†é˜²ç«å¢™ï¼Œéœ€è¦å¼€æ”¾ç›¸åº”ç«¯å£ï¼š

```
# å¼€æ”¾GTMç«¯å£
sudo firewall-cmd --permanent --add-port=50001/tcp

# å¼€æ”¾Coordinatorç«¯å£
sudo firewall-cmd --permanent --add-port=30004/tcp
sudo firewall-cmd --permanent --add-port=31110/tcp

# å¼€æ”¾Datanodeç«¯å£
sudo firewall-cmd --permanent --add-port=40004/tcp
sudo firewall-cmd --permanent --add-port=41110/tcp

# é‡æ–°åŠ è½½é˜²ç«å¢™è§„åˆ™
sudo firewall-cmd --reload
```

#### æ•°æ®åº“åˆå§‹åŒ–å’Œä½¿ç”¨

##### 1. è¿æ¥æ•°æ®åº“

```
psql -h localhost -p 30004 -d postgres -U opentenbase
```

![](https://i-blog.csdnimg.cn/img_convert/be2cc7784af4c3c50ad2d4bc90b30223.png)

##### 2. åˆ›å»ºå¿…è¦çš„èŠ‚ç‚¹ç»„å’Œåˆ†ç‰‡ç»„

OpenTenBaseä½¿ç”¨æ•°æ®èŠ‚ç‚¹ç»„æ¥å¢åŠ èŠ‚ç‚¹ç®¡ç†çš„çµæ´»æ€§ã€‚éœ€è¦åˆ›å»ºä¸€ä¸ªé»˜è®¤ç»„æ¥ä½¿ç”¨ï¼Œå› æ­¤éœ€è¦æå‰åˆ›å»ºã€‚é€šå¸¸ï¼Œæ‰€æœ‰æ•°æ®èŠ‚ç‚¹éƒ½ä¼šè¢«æ·»åŠ åˆ°é»˜è®¤ç»„ä¸­ï¼š

```
-- åˆ›å»ºé»˜è®¤èŠ‚ç‚¹ç»„
CREATE DEFAULT NODE GROUP default_group WITH (dn001);

-- åˆ›å»ºåˆ†ç‰‡ç»„
CREATE SHARDING GROUP TO GROUP default_group;
```

##### 3. åˆ›å»ºæ•°æ®åº“å’Œè¡¨

```
-- åˆ›å»ºæµ‹è¯•æ•°æ®åº“
CREATE DATABASE testdb;

-- åˆ›å»ºç”¨æˆ·
CREATE USER testuser WITH PASSWORD 'testpass';

-- æˆæƒ
ALTER DATABASE testdb OWNER TO testuser;

-- åˆ‡æ¢åˆ°æµ‹è¯•æ•°æ®åº“
\c testdb testuser

-- åˆ›å»ºåˆ†ç‰‡è¡¨
CREATE TABLE test_table(
    id BIGINT,
    name TEXT,
    created_time TIMESTAMP DEFAULT NOW()
) DISTRIBUTE BY SHARD(id);

-- æ’å…¥æµ‹è¯•æ•°æ®
INSERT INTO test_table(id, name) VALUES 
(1, 'OpenTenBase'),
(2, 'TencentCloud'),
(3, 'OpenCloudOS');

-- æŸ¥è¯¢æµ‹è¯•
SELECT * FROM test_table;
```

#### é›†ç¾¤ç®¡ç†

##### 1. å¯åŠ¨é›†ç¾¤

```
pgxc_ctl
start all
```

##### 2. åœæ­¢é›†ç¾¤

```
pgxc_ctl
stop all
```

##### 3. æ¸…ç†é›†ç¾¤ï¼ˆé‡æ–°åˆå§‹åŒ–æ—¶ä½¿ç”¨ï¼‰

```
pgxc_ctl
clean all
```

#### æ•…éšœæ’æŸ¥

##### 1. æŸ¥çœ‹æ—¥å¿—

å¦‚æœåˆå§‹åŒ–å¤±è´¥ï¼Œå¯ä»¥æŸ¥çœ‹æ—¥å¿—ï¼š

```
# æŸ¥çœ‹pgxc_ctlæ—¥å¿—
ls ~/pgxc_ctl/pgxc_log/
cat ~/pgxc_ctl/pgxc_log/æœ€æ–°çš„æ—¥å¿—æ–‡ä»¶

# æŸ¥çœ‹å„ç»„ä»¶æ—¥å¿—
ls /data/opentenbase/data/gtm/pg_log/
ls /data/opentenbase/data/coord/pg_log/
ls /data/opentenbase/data/dn001/pg_log/
```

##### 2. å¸¸è§é—®é¢˜è§£å†³

* **æƒé™é—®é¢˜**ï¼šç¡®ä¿opentenbaseç”¨æˆ·å¯¹æ‰€æœ‰æ•°æ®ç›®å½•æœ‰è¯»å†™æƒé™
* **ç«¯å£å†²çª**ï¼šæ£€æŸ¥é…ç½®çš„ç«¯å£æ˜¯å¦è¢«å…¶ä»–æœåŠ¡å ç”¨
* **å†…å­˜ä¸è¶³**ï¼šè°ƒæ•´shared_buffersç­‰å†…å­˜å‚æ•°
* **ç½‘ç»œé—®é¢˜**ï¼šæ£€æŸ¥é˜²ç«å¢™å’Œç½‘ç»œè¿æ¥

#### æ€§èƒ½ä¼˜åŒ–å»ºè®®

##### 1. å†…å­˜ä¼˜åŒ–

æ ¹æ®æœåŠ¡å™¨é…ç½®è°ƒæ•´postgresql.confä¸­çš„å†…å­˜å‚æ•°ï¼š

```
shared_buffers = 25% of RAM    # ä¾‹å¦‚8GBå†…å­˜è®¾ç½®ä¸º2GB
effective_cache_size = 75% of RAM
work_mem = 4MB
maintenance_work_mem = 64MB
```

##### 2. è¿æ¥ä¼˜åŒ–

```
max_connections = 200          # æ ¹æ®åº”ç”¨éœ€æ±‚è°ƒæ•´
max_pool_size = 1000          # è¿æ¥æ± å¤§å°
```

##### 3. æ—¥å¿—ä¼˜åŒ–

```
log_min_duration_statement = 1000  # è®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡1ç§’çš„æŸ¥è¯¢
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
log_checkpoints = on
log_connections = on
log_disconnections = on
```

### 4. é›†ç¾¤èŠ‚ç‚¹é…ç½®

#### 4.1 CoordinatorèŠ‚ç‚¹éƒ¨ç½²

```
# åˆå§‹åŒ–Coordinator
/opt/opentenbase/bin/initdb -D /data/opentenbase/coord \
                           --nodename coord1 \
                           -E UTF8 \
                           --locale=en_US.UTF-8

# Coordinatorä¸»è¦é…ç½®å‚æ•°
cat >> /data/opentenbase/coord/postgresql.conf << EOF
# ç½‘ç»œè¿æ¥
listen_addresses = '*'
port = 5432
max_connections = 500

# å†…å­˜é…ç½®
shared_buffers = 2GB
work_mem = 256MB
maintenance_work_mem = 512MB
effective_cache_size = 8GB

# GTMè¿æ¥é…ç½®
gtm_host = '192.168.1.100'
gtm_port = 6666

# åˆ†å¸ƒå¼é…ç½®
pool_number = 4
persistent_datanode_connections = on
EOF
```

#### 4.2 DatanodeèŠ‚ç‚¹éƒ¨ç½²

```
# æ‰¹é‡éƒ¨ç½²Datanodeè„šæœ¬
#!/bin/bash
NODES=("dn1:192.168.1.101:5433" "dn2:192.168.1.102:5433" 
       "dn3:192.168.1.103:5433" "dn4:192.168.1.104:5433")

for node_info in "${NODES[@]}"; do
    IFS=':' read -r name ip port <<< "$node_info"
    
    # åˆå§‹åŒ–Datanode
    /opt/opentenbase/bin/initdb -D /data/opentenbase/${name} \
                               --nodename ${name} \
                               -E UTF8
    
    # é…ç½®Datanodeå‚æ•°
    cat >> /data/opentenbase/${name}/postgresql.conf << EOF
listen_addresses = '*'
port = ${port}
gtm_host = '192.168.1.100'
gtm_port = 6666
shared_buffers = 1GB
EOF
    
    echo "Datanode ${name} initialized successfully"
done
```

**éƒ¨ç½²è„šæœ¬ç‰¹ç‚¹**ï¼š

* æ‰¹é‡åŒ–å¤„ç†ï¼Œæé«˜éƒ¨ç½²æ•ˆç‡
* å‚æ•°åŒ–é…ç½®ï¼Œä¾¿äºæ‰©å±•ç»´æŠ¤
* ç»Ÿä¸€çš„é…ç½®æ¨¡æ¿ï¼Œä¿è¯ä¸€è‡´æ€§

### 5. é›†ç¾¤ç®¡ç†ä¸è¿ç»´

#### 5.1 é›†ç¾¤å¥åº·çŠ¶æ€ç›‘æ§

![](https://i-blog.csdnimg.cn/img_convert/9e5c8007616f0932ae107c47f06fd22a.png)

**å›¾4ï¼šé›†ç¾¤äº¤äº’æ—¶åºå›¾ - å±•ç¤ºè¯·æ±‚å¤„ç†æµç¨‹ä¸ç›‘æ§ç‚¹**

#### 5.2 æ€§èƒ½ç›‘æ§æŸ¥è¯¢

```
-- é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€æŸ¥è¯¢
SELECT 
    node_name,
    node_type,
    node_host,
    node_port,
    CASE 
        WHEN status = 'N' THEN 'æ­£å¸¸'
        WHEN status = 'D' THEN 'ä¸‹çº¿'
        ELSE 'æœªçŸ¥'
    END AS node_status
FROM pgxc_node 
ORDER BY node_type, node_name;

-- åˆ†å¸ƒå¼è¡¨ç»Ÿè®¡ä¿¡æ¯
SELECT 
    schemaname,
    tablename,
    n_tup_ins as "æ’å…¥è¡Œæ•°",
    n_tup_upd as "æ›´æ–°è¡Œæ•°",
    n_tup_del as "åˆ é™¤è¡Œæ•°",
    last_analyze as "æœ€è¿‘åˆ†ææ—¶é—´"
FROM pg_stat_user_tables 
WHERE schemaname NOT IN ('information_schema', 'pg_catalog')
ORDER BY n_tup_ins DESC LIMIT 10;

-- æ•°æ®èŠ‚ç‚¹è´Ÿè½½åˆ†æ
WITH node_stats AS (
    SELECT 
        node_name,
        pg_stat_get_db_blocks_fetched(oid) as blocks_read,
        pg_stat_get_db_blocks_hit(oid) as blocks_hit
    FROM pg_database, pgxc_node 
    WHERE datname = current_database()
)
SELECT 
    node_name,
    blocks_read,
    blocks_hit,
    CASE 
        WHEN (blocks_read + blocks_hit) > 0 
        THEN round(blocks_hit::numeric / (blocks_read + blocks_hit) * 100, 2)
        ELSE 0 
    END as cache_hit_ratio
FROM node_stats
ORDER BY cache_hit_ratio DESC;
```

**ç›‘æ§SQLè§£æ**ï¼š

* èŠ‚ç‚¹çŠ¶æ€ç›‘æ§ï¼šå®æ—¶æŒæ¡é›†ç¾¤æ‹“æ‰‘
* è¡¨ç»Ÿè®¡ä¿¡æ¯ï¼šäº†è§£æ•°æ®æ“ä½œåˆ†å¸ƒ
* ç¼“å­˜å‘½ä¸­ç‡ï¼šè¯„ä¼°å†…å­˜ä½¿ç”¨æ•ˆç‡

#### 5.3 åˆ†å¸ƒå¼è¡¨åˆ›å»ºä¸åˆ†ç‰‡

```
-- åˆ›å»ºåˆ†å¸ƒå¼è¡¨ï¼ˆHashåˆ†ç‰‡ï¼‰
CREATE TABLE user_orders (
    order_id BIGINT PRIMARY KEY,
    user_id INTEGER NOT NULL,
    product_id INTEGER NOT NULL,
    order_amount DECIMAL(10,2),
    order_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    order_status VARCHAR(20)
) DISTRIBUTE BY HASH(user_id);

-- åˆ›å»ºåˆ†å¸ƒå¼è¡¨ï¼ˆRangeåˆ†ç‰‡ï¼‰
CREATE TABLE sales_data (
    sale_id BIGINT,
    sale_date DATE NOT NULL,
    region VARCHAR(50),
    amount DECIMAL(12,2)
) DISTRIBUTE BY RANGE(sale_date);

-- ä¸ºRangeåˆ†ç‰‡è¡¨åˆ›å»ºåˆ†ç‰‡è§„åˆ™
SELECT create_distributed_table('sales_data', 'sale_date', 'range');
```

### 6. æ•…éšœæ’æŸ¥ä¸ä¼˜åŒ–

#### 6.1 å¸¸è§é—®é¢˜æ’æŸ¥æµç¨‹

![](https://i-blog.csdnimg.cn/img_convert/f96d5e3106b517ba32f50704ddbbfefa.png)

**å›¾5ï¼šæ•…éšœæ’æŸ¥æµç¨‹å›¾ - ç³»ç»Ÿæ€§é—®é¢˜è¯Šæ–­ä¸è§£å†³**

#### 6.2 æ€§èƒ½ä¼˜åŒ–å®è·µ

"åˆ†å¸ƒå¼æ•°æ®åº“çš„æ€§èƒ½ä¼˜åŒ–ä¸ä»…ä»…æ˜¯å•èŠ‚ç‚¹çš„è°ƒä¼˜ï¼Œæ›´é‡è¦çš„æ˜¯è¦ç†è§£æ•°æ®åˆ†å¸ƒå’Œç½‘ç»œé€šä¿¡å¯¹æ•´ä½“æ€§èƒ½çš„å½±å“ã€‚åªæœ‰åœ¨åˆé€‚çš„åˆ†ç‰‡ç­–ç•¥åŸºç¡€ä¸Šï¼Œç»“åˆç²¾ç»†çš„å‚æ•°è°ƒä¼˜ï¼Œæ‰èƒ½å‘æŒ¥åˆ†å¸ƒå¼æ¶æ„çš„çœŸæ­£ä¼˜åŠ¿ã€‚"  
 â€”â€” ã€Šåˆ†å¸ƒå¼æ•°æ®åº“æ¶æ„ä¸å®è·µã€‹

åŸºäºå®é™…è¿ç»´ç»éªŒï¼Œæˆ‘æ€»ç»“äº†ä»¥ä¸‹å…³é”®ä¼˜åŒ–ç‚¹ï¼š

```
# 1. è¿æ¥æ± ä¼˜åŒ–
cat >> postgresql.conf << EOF
# è¿æ¥æ± é…ç½®
max_pool_size = 100
pool_maintenance_timeout = 30
pool_max_lifetime = 1800

# æŸ¥è¯¢ä¼˜åŒ–
enable_mergejoin = on
enable_hashjoin = on
enable_nestloop = off  # åˆ†å¸ƒå¼åœºæ™¯ä¸‹ç¦ç”¨åµŒå¥—å¾ªç¯

# å†…å­˜ä¼˜åŒ–
shared_preload_libraries = 'pg_stat_statements'
track_activity_query_size = 2048
EOF

# 2. ç³»ç»Ÿçº§ä¼˜åŒ–è„šæœ¬
#!/bin/bash
echo "å¼€å§‹OpenTenBaseæ€§èƒ½ä¼˜åŒ–..."

# CPUç»‘å®šä¼˜åŒ–
echo 'performance' > /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor

# I/Oè°ƒåº¦å™¨ä¼˜åŒ–
echo 'deadline' > /sys/block/*/queue/scheduler

# ç½‘ç»œä¼˜åŒ–
echo 32768 > /proc/sys/net/core/rps_sock_flow_entries
echo 65536 > /proc/sys/net/core/netdev_max_backlog

echo "ä¼˜åŒ–å®Œæˆï¼"
```

### 7. å®æˆ˜ç»éªŒæ€»ç»“

é€šè¿‡è¿™æ®µæ—¶é—´å¯¹OpenTenBaseçš„æ·±åº¦ä½¿ç”¨ï¼Œæˆ‘æ·±åˆ»æ„Ÿå—åˆ°äº†è¿™æ¬¾åˆ†å¸ƒå¼æ•°æ®åº“åœ¨ä¼ä¸šçº§åº”ç”¨ä¸­çš„å·¨å¤§æ½œåŠ›ã€‚é¦–å…ˆæ˜¯å…¶ä¼˜ç§€çš„PostgreSQLå…¼å®¹æ€§ï¼Œè®©æˆ‘ä»¬çš„è¿ç§»å·¥ä½œå˜å¾—ç›¸å¯¹ç®€å•ï¼Œå¤§éƒ¨åˆ†ç°æœ‰çš„SQLè¯­å¥å’Œåº”ç”¨ç¨‹åºéƒ½èƒ½æ— ç¼è¿ç§»ã€‚ç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤æ‚çš„OLAPæŸ¥è¯¢æ—¶ï¼ŒOpenTenBaseå±•ç°å‡ºäº†è¿œè¶…ä¼ ç»Ÿå•æœºæ•°æ®åº“çš„å¤„ç†èƒ½åŠ›ã€‚

åœ¨åˆ†å¸ƒå¼å¼¹æ€§æ‰©å±•æ–¹é¢ï¼Œæˆ‘äº²èº«ä½“éªŒäº†ä»4ä¸ªæ•°æ®èŠ‚ç‚¹æ‰©å±•åˆ°8ä¸ªæ•°æ®èŠ‚ç‚¹çš„è¿‡ç¨‹ã€‚æ•´ä¸ªæ‰©å®¹è¿‡ç¨‹è®¾è®¡å¾—éå¸¸ä¼˜é›…ï¼Œæ”¯æŒåœ¨çº¿æ‰©å®¹ï¼Œå¯¹ä¸šåŠ¡çš„å½±å“é™åˆ°äº†æœ€ä½ã€‚æ•°æ®é‡åˆ†å¸ƒçš„è¿‡ç¨‹è™½ç„¶éœ€è¦ä¸€å®šæ—¶é—´ï¼Œä½†æ•´ä½“çš„æ‰©å®¹ä½“éªŒè¿œå¥½äºæˆ‘ä¹‹å‰ä½¿ç”¨è¿‡çš„å…¶ä»–åˆ†å¸ƒå¼æ•°æ®åº“äº§å“ã€‚è¿™ç§å¼¹æ€§æ‰©å±•èƒ½åŠ›å¯¹äºå¿«é€Ÿå¢é•¿çš„ä¸šåŠ¡åœºæ™¯æ¥è¯´æ˜¯éå¸¸å®è´µçš„ã€‚

åœ¨è¿ç»´ç›‘æ§æ–¹é¢ï¼Œæˆ‘æ„å»ºäº†åŸºäºPrometheus + Grafanaçš„å®Œæ•´ç›‘æ§ä½“ç³»ã€‚é€šè¿‡ç›‘æ§å„ä¸ªèŠ‚ç‚¹çš„CPUã€å†…å­˜ã€I/Oä»¥åŠæ•°æ®åº“ç‰¹æœ‰çš„æŒ‡æ ‡ï¼ˆå¦‚åˆ†å¸ƒå¼äº‹åŠ¡å»¶è¿Ÿã€è·¨èŠ‚ç‚¹æŸ¥è¯¢å“åº”æ—¶é—´ç­‰ï¼‰ï¼Œæˆ‘ä»¬èƒ½å¤ŸåŠæ—¶å‘ç°æ€§èƒ½ç“¶é¢ˆå’Œæ½œåœ¨é—®é¢˜ã€‚ç‰¹åˆ«å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒOpenTenBaseæä¾›çš„ç»Ÿè®¡è§†å›¾éå¸¸è¯¦ç»†ï¼Œä¸ºè¿ç»´å·¥ä½œæä¾›äº†å¼ºæœ‰åŠ›çš„æ”¯æŒã€‚

ä»æ€§èƒ½è¡¨ç°æ¥çœ‹ï¼Œåœ¨æˆ‘ä»¬çš„å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼ŒOpenTenBaseåœ¨å¤„ç†å¤§è§„æ¨¡æ•°æ®æŸ¥è¯¢å’Œé«˜å¹¶å‘å†™å…¥æ–¹é¢éƒ½è¡¨ç°å‡ºè‰²ã€‚é€šè¿‡åˆç†çš„åˆ†ç‰‡ç­–ç•¥è®¾è®¡ï¼Œæˆ‘ä»¬æˆåŠŸå°†å•è¡¨äº¿çº§æ•°æ®çš„æŸ¥è¯¢å“åº”æ—¶é—´æ§åˆ¶åœ¨ç§’çº§ã€‚åœ¨äº‹åŠ¡å¤„ç†æ–¹é¢ï¼Œè™½ç„¶åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€§èƒ½ç›¸æ¯”å•æœºäº‹åŠ¡æœ‰æ‰€ä¸‹é™ï¼Œä½†æ•´ä½“æ€§èƒ½è¡¨ç°ä»ç„¶æ»¡è¶³æˆ‘ä»¬çš„ä¸šåŠ¡éœ€æ±‚ã€‚

åœ¨æ•…éšœå¤„ç†å’Œé«˜å¯ç”¨æ€§æ–¹é¢ï¼ŒOpenTenBaseçš„è®¾è®¡ä¹Ÿæ¯”è¾ƒæˆç†Ÿã€‚èŠ‚ç‚¹æ•…éšœæ—¶çš„è‡ªåŠ¨æ¢å¤æœºåˆ¶è¿ä½œè‰¯å¥½ï¼Œæ•°æ®ä¸€è‡´æ€§å¾—åˆ°äº†å¾ˆå¥½çš„ä¿éšœã€‚å½“ç„¶ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¤æ‚æ€§ä¹Ÿå¸¦æ¥äº†ä¸€äº›æŒ‘æˆ˜ï¼Œæ¯”å¦‚è·¨èŠ‚ç‚¹æŸ¥è¯¢çš„ä¼˜åŒ–ã€æ•°æ®å€¾æ–œçš„å¤„ç†ç­‰ï¼Œè¿™äº›éƒ½éœ€è¦è¿ç»´äººå‘˜å…·å¤‡æ›´æ·±å…¥çš„åˆ†å¸ƒå¼ç³»ç»ŸçŸ¥è¯†ã€‚

æ€»çš„æ¥è¯´ï¼ŒOpenTenBaseä½œä¸ºä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼HTAPæ•°æ®åº“ï¼Œåœ¨åŠŸèƒ½å®Œæ•´æ€§ã€æ€§èƒ½è¡¨ç°å’Œè¿ç»´ä¾¿åˆ©æ€§æ–¹é¢éƒ½è¾¾åˆ°äº†ä¼ä¸šçº§åº”ç”¨çš„è¦æ±‚ã€‚è™½ç„¶åœ¨æŸäº›ç»†èŠ‚æ–¹é¢è¿˜æœ‰æå‡ç©ºé—´ï¼Œä½†å…¶å¼ºå¤§çš„PostgreSQLå…¼å®¹æ€§å’Œä¼˜ç§€çš„åˆ†å¸ƒå¼æ‰©å±•èƒ½åŠ›ï¼Œä½¿å…¶æˆä¸ºäº†ä¼ä¸šæ•°å­—åŒ–è½¬å‹è¿‡ç¨‹ä¸­å€¼å¾—è€ƒè™‘çš„é‡è¦é€‰æ‹©ã€‚æˆ‘ç›¸ä¿¡ï¼Œéšç€ç¤¾åŒºçš„ä¸æ–­å‘å±•å’Œå®Œå–„ï¼ŒOpenTenBaseå°†åœ¨åˆ†å¸ƒå¼æ•°æ®åº“é¢†åŸŸå‘æŒ¥æ›´å¤§çš„ä½œç”¨ã€‚

### å‚è€ƒé“¾æ¥

1. [OpenTenBaseå®˜æ–¹æ–‡æ¡£](https://github.com/OpenTenBase/OpenTenBase "OpenTenBaseå®˜æ–¹æ–‡æ¡£")
2. [PostgreSQLåˆ†å¸ƒå¼æ‰©å±•æœ€ä½³å®è·µ](https://www.postgresql.org/docs/current/ddl-partitioning.html "PostgreSQLåˆ†å¸ƒå¼æ‰©å±•æœ€ä½³å®è·µ")
3. [åˆ†å¸ƒå¼æ•°æ®åº“æ€§èƒ½è°ƒä¼˜æŒ‡å—](https://pgxn.org/dist/pg_stat_statements/ "åˆ†å¸ƒå¼æ•°æ®åº“æ€§èƒ½è°ƒä¼˜æŒ‡å—")
4. [Prometheusç›‘æ§OpenTenBaseé…ç½®](https://prometheus.io/docs/guides/go-application/ "Prometheusç›‘æ§OpenTenBaseé…ç½®")
5. [åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†æœºåˆ¶æ·±åº¦è§£æ](https://www.vldb.org/pvldb/vol13/p3072-thomson.pdf "åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†æœºåˆ¶æ·±åº¦è§£æ")

### å…³é”®è¯æ ‡ç­¾

`#OpenTenBase` `#åˆ†å¸ƒå¼æ•°æ®åº“` `#PostgreSQLå…¼å®¹` `#HTAP` `#æ•°æ®åº“è¿ç»´`

---

> æˆ‘æ˜¯æ‘˜æ˜Ÿï¼å¦‚æœè¿™ç¯‡æ–‡ç« åœ¨ä½ çš„æŠ€æœ¯æˆé•¿è·¯ä¸Šç•™ä¸‹äº†å°è®°  
>  ğŸ‘ï¸ ã€å…³æ³¨ã€‘ä¸æˆ‘ä¸€èµ·æ¢ç´¢æŠ€æœ¯çš„æ— é™å¯èƒ½ï¼Œè§è¯æ¯ä¸€æ¬¡çªç ´  
>  ğŸ‘ ã€ç‚¹èµã€‘ä¸ºä¼˜è´¨æŠ€æœ¯å†…å®¹ç‚¹äº®æ˜ç¯ï¼Œä¼ é€’çŸ¥è¯†çš„åŠ›é‡  
>  ğŸ”– ã€æ”¶è—ã€‘å°†ç²¾åå†…å®¹çè—ï¼Œéšæ—¶å›é¡¾æŠ€æœ¯è¦ç‚¹  
>  ğŸ’¬ ã€è¯„è®ºã€‘åˆ†äº«ä½ çš„ç‹¬ç‰¹è§è§£ï¼Œè®©æ€ç»´ç¢°æ’å‡ºæ™ºæ…§ç«èŠ±  
>  ğŸ—³ï¸ ã€æŠ•ç¥¨ã€‘ç”¨ä½ çš„é€‰æ‹©ä¸ºæŠ€æœ¯ç¤¾åŒºè´¡çŒ®ä¸€ä»½åŠ›é‡  
>  æŠ€æœ¯è·¯æ¼«æ¼«ï¼Œè®©æˆ‘ä»¬æºæ‰‹å‰è¡Œï¼Œåœ¨ä»£ç çš„ä¸–ç•Œé‡Œæ‘˜å–å±äºç¨‹åºå‘˜çš„é‚£ç‰‡æ˜Ÿè¾°å¤§æµ·ï¼



