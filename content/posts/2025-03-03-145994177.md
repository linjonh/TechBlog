---
layout: post
title: "计算机视觉手势识别"
date: 2025-03-03 17:28:12 +0800
description: "手势识别是计算机视觉领域中的重要方向，通过对摄像机采集的手部相关的图像序列进行分析处理，进而识别其中的手势，手势被识别后用户就可以通过手势来控制设备或者与设备交互。完整的手势识别一般有手的检测和姿态估计、手部跟踪和手势识别等。"
keywords: "【计算机视觉】手势识别"
categories: ['计算机视觉']
tags: ['计算机视觉', '人工智能', 'Opencv']
artid: "145994177"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=145994177
    alt: "计算机视觉手势识别"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=145994177
featuredImagePreview: https://bing.ee123.net/img/rand?artid=145994177
cover: https://bing.ee123.net/img/rand?artid=145994177
image: https://bing.ee123.net/img/rand?artid=145994177
img: https://bing.ee123.net/img/rand?artid=145994177
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【计算机视觉】手势识别
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-dracula" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     手势识别是计算机视觉领域中的重要方向，通过对摄像机采集的手部相关的图像序列进行分析处理，进而识别其中的手势，手势被识别后用户就可以通过手势来控制设备或者与设备交互。完整的手势识别一般有手的检测和姿态估计、手部跟踪和手势识别等。
    </p>
    <h2>
     <a id="_1">
     </a>
     一、手掌检测
    </h2>
    <pre><code class="prism language-Python">import cv2
import mediapipe as mp

# 初始化 MediaPipe 手部模型
mp_hands = mp.solutions.hands
hands = mp_hands.Hands()

# 初始化视频流
cap = cv2.VideoCapture(0)

while True:
    ret, frame = cap.read()
    
    if not ret:
        break
    
    # 转换为 RGB
    rgb_frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
    
    # 获取手部关键点
    results = hands.process(rgb_frame)
    
    # 如果检测到手部
    if results.multi_hand_landmarks:
        for landmarks in results.multi_hand_landmarks:
            # 绘制手部关键点
            mp.solutions.drawing_utils.draw_landmarks(frame, landmarks, mp_hands.HAND_CONNECTIONS)
    
    # 显示图像
    cv2.imshow('Hand Detection', frame)

    # 按 'q' 键退出
    if cv2.waitKey(1) &amp; 0xFF == ord('q'):
        break

# 释放资源
cap.release()
cv2.destroyAllWindows()

</code></pre>
    <p>
     这段代码是一个简单的手部检测应用程序，使用了 OpenCV 和 MediaPipe 库来实时检测和绘制手部关键点。下面是对代码的详细解释：
    </p>
    <h5>
     <a id="1__44">
     </a>
     1. 导入必要的库
    </h5>
    <pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> mediapipe <span class="token keyword">as</span> mp
</code></pre>
    <ul>
     <li>
      <code>
       cv2
      </code>
      是 OpenCV 的 Python 接口库，用于图像处理和计算机视觉任务。
     </li>
     <li>
      <code>
       mediapipe
      </code>
      是 Google 提供的一个跨平台框架，用于实现高效的计算机视觉任务，这里用它来做手部关键点检测。
     </li>
    </ul>
    <h5>
     <a id="2__MediaPipe__53">
     </a>
     2. 初始化 MediaPipe 手部模型
    </h5>
    <pre><code class="prism language-python">mp_hands <span class="token operator">=</span> mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>hands
hands <span class="token operator">=</span> mp_hands<span class="token punctuation">.</span>Hands<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <code>
       mp_hands
      </code>
      是 MediaPipe 提供的手部检测模块。通过
      <code>
       mp.solutions.hands
      </code>
      访问。
     </li>
     <li>
      <code>
       hands = mp_hands.Hands()
      </code>
      创建了一个
      <code>
       Hands
      </code>
      对象，用于进行手部检测。它会自动处理图像中的手部检测、手部关键点识别和跟踪。
     </li>
    </ul>
    <h5>
     <a id="3__62">
     </a>
     3. 初始化视频流
    </h5>
    <pre><code class="prism language-python">cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <code>
       cv2.VideoCapture(0)
      </code>
      打开了计算机的默认摄像头（
      <code>
       0
      </code>
      表示第一个摄像头）。返回的
      <code>
       cap
      </code>
      对象用于读取视频流。
     </li>
    </ul>
    <h5>
     <a id="4__69">
     </a>
     4. 开始处理视频流
    </h5>
    <pre><code class="prism language-python"><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token keyword">not</span> ret<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
</code></pre>
    <ul>
     <li>
      <code>
       cap.read()
      </code>
      从摄像头读取一帧图像并返回两个值：
      <code>
       ret
      </code>
      和
      <code>
       frame
      </code>
      。
      <code>
       ret
      </code>
      是布尔值，表示图像是否成功读取，
      <code>
       frame
      </code>
      是当前帧的图像。
     </li>
     <li>
      如果
      <code>
       ret
      </code>
      为
      <code>
       False
      </code>
      ，则说明读取图像失败，程序退出循环。
     </li>
    </ul>
    <h5>
     <a id="5__RGB_81">
     </a>
     5. 转换图像为 RGB
    </h5>
    <pre><code class="prism language-python">rgb_frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      OpenCV 使用 BGR（蓝绿红）色彩空间，而 MediaPipe 要求输入图像为 RGB（红绿蓝）色彩空间。因此，我们用
      <code>
       cv2.cvtColor
      </code>
      将图像从 BGR 转换为 RGB。
     </li>
    </ul>
    <h5>
     <a id="6__88">
     </a>
     6. 处理图像以检测手部关键点
    </h5>
    <pre><code class="prism language-python">results <span class="token operator">=</span> hands<span class="token punctuation">.</span>process<span class="token punctuation">(</span>rgb_frame<span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <code>
       hands.process(rgb_frame)
      </code>
      将 RGB 图像传递给 MediaPipe 的
      <code>
       Hands
      </code>
      模型进行处理。
     </li>
     <li>
      <code>
       results
      </code>
      包含了检测到的手部信息，包括手部关键点的位置。如果图像中没有手部，
      <code>
       results.multi_hand_landmarks
      </code>
      会是空的。
     </li>
    </ul>
    <h5>
     <a id="7__96">
     </a>
     7. 绘制手部关键点
    </h5>
    <pre><code class="prism language-python"><span class="token keyword">if</span> results<span class="token punctuation">.</span>multi_hand_landmarks<span class="token punctuation">:</span>
    <span class="token keyword">for</span> landmarks <span class="token keyword">in</span> results<span class="token punctuation">.</span>multi_hand_landmarks<span class="token punctuation">:</span>
        mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>drawing_utils<span class="token punctuation">.</span>draw_landmarks<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> landmarks<span class="token punctuation">,</span> mp_hands<span class="token punctuation">.</span>HAND_CONNECTIONS<span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <code>
       results.multi_hand_landmarks
      </code>
      是一个包含所有检测到的手的关键点位置的列表。如果检测到手部，它会返回一个非空列表。
     </li>
     <li>
      <code>
       landmarks
      </code>
      是每个手部的关键点集合，每个关键点是一个
      <code>
       (x, y, z)
      </code>
      坐标。
     </li>
     <li>
      <code>
       mp.solutions.drawing_utils.draw_landmarks(frame, landmarks, mp_hands.HAND_CONNECTIONS)
      </code>
      将每个手的关键点绘制到
      <code>
       frame
      </code>
      图像上，并且连接关键点，形成手的骨架结构。
      <code>
       mp_hands.HAND_CONNECTIONS
      </code>
      用于连接不同的关键点。
     </li>
    </ul>
    <h5>
     <a id="8__106">
     </a>
     8. 显示处理后的图像
    </h5>
    <pre><code class="prism language-python">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Hand Detection'</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <code>
       cv2.imshow
      </code>
      显示处理后的图像（
      <code>
       frame
      </code>
      ）。窗口的标题是 ‘Hand Detection’。
     </li>
    </ul>
    <h5>
     <a id="9__111">
     </a>
     9. 按键退出
    </h5>
    <pre><code class="prism language-python"><span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">break</span>
</code></pre>
    <ul>
     <li>
      <code>
       cv2.waitKey(1)
      </code>
      等待键盘输入，
      <code>
       1
      </code>
      表示等待 1 毫秒。返回值是按下键的 ASCII 码。
     </li>
     <li>
      如果按下
      <code>
       q
      </code>
      键，
      <code>
       ord('q')
      </code>
      的值与
      <code>
       cv2.waitKey(1)
      </code>
      返回值相等，程序就会退出循环，停止视频流。
     </li>
    </ul>
    <h5>
     <a id="10__118">
     </a>
     10. 释放资源并关闭窗口
    </h5>
    <pre><code class="prism language-python">cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <code>
       cap.release()
      </code>
      释放摄像头资源。
     </li>
     <li>
      <code>
       cv2.destroyAllWindows()
      </code>
      关闭所有 OpenCV 显示的窗口。
     </li>
    </ul>
    <h2>
     <a id="_127">
     </a>
     二、手关键点估计
    </h2>
    <p>
     要进行手关键点估计，可以使用
     <strong>
      MediaPipe
     </strong>
     库来进行高效的手部检测，结合
     <strong>
      OpenCV
     </strong>
     来进行图像处理和显示。这里将展示一个基于 MediaPipe 手部模型的手关键点估计的完整代码。
    </p>
    <p>
     MediaPipe 提供了一个预训练的模型来检测手部的 21 个关键点，包括手指关节和手掌部位。我们将使用 MediaPipe 提供的
     <code>
      Hands
     </code>
     模块来检测手部关键点。
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> mediapipe <span class="token keyword">as</span> mp

<span class="token comment"># 初始化 MediaPipe 手部检测模型</span>
mp_hands <span class="token operator">=</span> mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>hands
hands <span class="token operator">=</span> mp_hands<span class="token punctuation">.</span>Hands<span class="token punctuation">(</span>min_detection_confidence<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">,</span> min_tracking_confidence<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
mp_drawing <span class="token operator">=</span> mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>drawing_utils

<span class="token comment"># 打开摄像头</span>
cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># 读取每一帧图像</span>
    ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token keyword">not</span> ret<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"无法获取视频帧"</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    
    <span class="token comment"># 将图像转换为 RGB 格式，MediaPipe 需要 RGB 输入</span>
    rgb_frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
    
    <span class="token comment"># 获取手部关键点检测结果</span>
    results <span class="token operator">=</span> hands<span class="token punctuation">.</span>process<span class="token punctuation">(</span>rgb_frame<span class="token punctuation">)</span>
    
    <span class="token comment"># 如果检测到手部</span>
    <span class="token keyword">if</span> results<span class="token punctuation">.</span>multi_hand_landmarks<span class="token punctuation">:</span>
        <span class="token keyword">for</span> landmarks <span class="token keyword">in</span> results<span class="token punctuation">.</span>multi_hand_landmarks<span class="token punctuation">:</span>
            <span class="token comment"># 绘制手部关键点和连接线</span>
            mp_drawing<span class="token punctuation">.</span>draw_landmarks<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> landmarks<span class="token punctuation">,</span> mp_hands<span class="token punctuation">.</span>HAND_CONNECTIONS<span class="token punctuation">)</span>

            <span class="token comment"># 获取并显示每个关键点的坐标</span>
            <span class="token keyword">for</span> idx<span class="token punctuation">,</span> landmark <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">.</span>landmark<span class="token punctuation">)</span><span class="token punctuation">:</span>
                h<span class="token punctuation">,</span> w<span class="token punctuation">,</span> c <span class="token operator">=</span> frame<span class="token punctuation">.</span>shape
                cx<span class="token punctuation">,</span> cy <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>x <span class="token operator">*</span> w<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>y <span class="token operator">*</span> h<span class="token punctuation">)</span>
                cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>
                cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">(</span>cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 绘制红色的关键点</span>

    <span class="token comment"># 显示图像</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Hand Keypoint Estimation'</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>

    <span class="token comment"># 按 'q' 键退出</span>
    <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>

<span class="token comment"># 释放摄像头资源并关闭窗口</span>
cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="1_183">
     </a>
     1.代码解释
    </h5>
    <ol>
     <li>
      <p>
       <strong>
        初始化 MediaPipe 手部模型
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用
        <code>
         mp.solutions.hands.Hands()
        </code>
        创建手部检测模型，
        <code>
         min_detection_confidence=0.7
        </code>
        和
        <code>
         min_tracking_confidence=0.5
        </code>
        表示最低的检测和追踪置信度阈值，适用于动态环境中。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        打开摄像头
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用
        <code>
         cv2.VideoCapture(0)
        </code>
        打开计算机的默认摄像头，并获取实时视频流。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        图像转换
       </strong>
       ：
      </p>
      <ul>
       <li>
        OpenCV 默认使用 BGR 色彩空间，但 MediaPipe 需要 RGB 色彩空间，因此使用
        <code>
         cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
        </code>
        将图像转换为 RGB 格式。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        处理图像并获取手部关键点
       </strong>
       ：
      </p>
      <ul>
       <li>
        <code>
         hands.process(rgb_frame)
        </code>
        用于处理图像并检测手部关键点。
        <code>
         results
        </code>
        对象包含手部信息，如果检测到手部，
        <code>
         results.multi_hand_landmarks
        </code>
        将返回手部的 21 个关键点的位置。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        绘制关键点和连接线
       </strong>
       ：
      </p>
      <ul>
       <li>
        <code>
         mp_drawing.draw_landmarks(frame, landmarks, mp_hands.HAND_CONNECTIONS)
        </code>
        绘制手的 21 个关键点以及它们之间的连接线（即手指的骨架）。
       </li>
       <li>
        <code>
         landmarks.landmark
        </code>
        包含了每个关键点的
        <code>
         (x, y, z)
        </code>
        坐标，其中
        <code>
         x
        </code>
        和
        <code>
         y
        </code>
        是图像中的像素坐标，
        <code>
         z
        </code>
        是深度信息（在 3D 空间中的位置，但对于 2D 图像可忽略）。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        显示关键点坐标
       </strong>
       ：
      </p>
      <ul>
       <li>
        对于每个关键点，通过
        <code>
         cv2.putText
        </code>
        在图像上显示关键点的索引。
        <code>
         cv2.circle
        </code>
        用来在图像上绘制关键点位置。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        显示视频流
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用
        <code>
         cv2.imshow()
        </code>
        来显示处理过的每一帧图像，展示检测到的手部关键点。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        退出条件
       </strong>
       ：
      </p>
      <ul>
       <li>
        按下
        <code>
         q
        </code>
        键退出程序并释放摄像头资源。
       </li>
      </ul>
     </li>
    </ol>
    <h5>
     <a id="2_211">
     </a>
     2.手部关键点索引
    </h5>
    <p>
     MediaPipe 的
     <code>
      Hands
     </code>
     模型检测手部的 21 个关键点，索引如下（从 0 到 20）：
    </p>
    <ul>
     <li>
      <strong>
       0
      </strong>
      : 手腕
     </li>
     <li>
      <strong>
       1
      </strong>
      : 大拇指根部
     </li>
     <li>
      <strong>
       2
      </strong>
      : 大拇指第一关节
     </li>
     <li>
      <strong>
       3
      </strong>
      : 大拇指第二关节
     </li>
     <li>
      <strong>
       4
      </strong>
      : 大拇指尖端
     </li>
     <li>
      <strong>
       5
      </strong>
      : 食指根部
     </li>
     <li>
      <strong>
       6
      </strong>
      : 食指第一关节
     </li>
     <li>
      <strong>
       7
      </strong>
      : 食指第二关节
     </li>
     <li>
      <strong>
       8
      </strong>
      : 食指尖端
     </li>
     <li>
      <strong>
       9
      </strong>
      : 中指根部
     </li>
     <li>
      <strong>
       10
      </strong>
      : 中指第一关节
     </li>
     <li>
      <strong>
       11
      </strong>
      : 中指第二关节
     </li>
     <li>
      <strong>
       12
      </strong>
      : 中指尖端
     </li>
     <li>
      <strong>
       13
      </strong>
      : 无名指根部
     </li>
     <li>
      <strong>
       14
      </strong>
      : 无名指第一关节
     </li>
     <li>
      <strong>
       15
      </strong>
      : 无名指第二关节
     </li>
     <li>
      <strong>
       16
      </strong>
      : 无名指尖端
     </li>
     <li>
      <strong>
       17
      </strong>
      : 小指根部
     </li>
     <li>
      <strong>
       18
      </strong>
      : 小指第一关节
     </li>
     <li>
      <strong>
       19
      </strong>
      : 小指第二关节
     </li>
     <li>
      <strong>
       20
      </strong>
      : 小指尖端
     </li>
    </ul>
    <h2>
     <a id="_237">
     </a>
     三、实例
    </h2>
    <p>
     YOLO（You Only Look Once）是一个非常强大的目标检测算法，特别适用于实时应用。它将目标检测任务转化为一个回归问题，能够快速且准确地检测图像中的目标物体。虽然 YOLO 本身并没有直接针对手部关键点估计的功能，但可以用它来检测手部区域，然后结合其他模型（比如 MediaPipe 或深度学习的关键点检测模型）来进行手关键点估计。
    </p>
    <ol>
     <li>
      <strong>
       YOLO 检测手部
      </strong>
      ：首先用 YOLO 模型检测图像中的手部位置，YOLO 会输出手部的边界框。
     </li>
     <li>
      <strong>
       手部关键点估计
      </strong>
      ：然后，我们可以通过一个手部关键点估计模型（如 MediaPipe 或自定义深度学习模型）来进一步估计手部的 21 个关键点。
     </li>
    </ol>
    <pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> mediapipe <span class="token keyword">as</span> mp

<span class="token comment"># 初始化 MediaPipe 手部检测模型</span>
mp_hands <span class="token operator">=</span> mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>hands
hands <span class="token operator">=</span> mp_hands<span class="token punctuation">.</span>Hands<span class="token punctuation">(</span>min_detection_confidence<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">,</span> min_tracking_confidence<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
mp_drawing <span class="token operator">=</span> mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>drawing_utils

<span class="token comment"># 加载 YOLOv5 模型（选择合适的模型大小）</span>
model <span class="token operator">=</span> torch<span class="token punctuation">.</span>hub<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'ultralytics/yolov5'</span><span class="token punctuation">,</span> <span class="token string">'yolov5s'</span><span class="token punctuation">)</span>  <span class="token comment"># 'yolov5s' 是一个小型的 YOLOv5 模型</span>

<span class="token comment"># 打开摄像头</span>
cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># 读取每一帧图像</span>
    ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token keyword">not</span> ret<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"无法获取视频帧"</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    
    <span class="token comment"># 使用 YOLOv5 检测图像中的物体（包括手部）</span>
    results <span class="token operator">=</span> model<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>  <span class="token comment"># 检测结果，包括边界框、标签、置信度等</span>

    <span class="token comment"># 提取 YOLOv5 检测到的手部（通常手部被标记为 0 或其他标签，依赖于训练数据）</span>
    <span class="token comment"># 获取所有检测到的物体的边界框</span>
    hands_detections <span class="token operator">=</span> results<span class="token punctuation">.</span>xyxy<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># 获取检测结果，xyxy 形式 [x_min, y_min, x_max, y_max, confidence, class]</span>
    <span class="token keyword">for</span> detection <span class="token keyword">in</span> hands_detections<span class="token punctuation">:</span>
        <span class="token keyword">if</span> detection<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># 类别 0 代表手部（具体根据训练数据集而定）</span>
            x_min<span class="token punctuation">,</span> y_min<span class="token punctuation">,</span> x_max<span class="token punctuation">,</span> y_max <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> detection<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

            <span class="token comment"># 在图像上绘制手部边界框</span>
            cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">(</span>x_min<span class="token punctuation">,</span> y_min<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x_max<span class="token punctuation">,</span> y_max<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

            <span class="token comment"># 提取手部区域并进行手部关键点估计</span>
            hand_region <span class="token operator">=</span> frame<span class="token punctuation">[</span>y_min<span class="token punctuation">:</span>y_max<span class="token punctuation">,</span> x_min<span class="token punctuation">:</span>x_max<span class="token punctuation">]</span>
            rgb_hand_region <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>hand_region<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>

            <span class="token comment"># 使用 MediaPipe 估计手部关键点</span>
            hand_results <span class="token operator">=</span> hands<span class="token punctuation">.</span>process<span class="token punctuation">(</span>rgb_hand_region<span class="token punctuation">)</span>

            <span class="token comment"># 如果检测到手部关键点</span>
            <span class="token keyword">if</span> hand_results<span class="token punctuation">.</span>multi_hand_landmarks<span class="token punctuation">:</span>
                <span class="token keyword">for</span> landmarks <span class="token keyword">in</span> hand_results<span class="token punctuation">.</span>multi_hand_landmarks<span class="token punctuation">:</span>
                    <span class="token comment"># 绘制手部关键点和连接线</span>
                    mp_drawing<span class="token punctuation">.</span>draw_landmarks<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> landmarks<span class="token punctuation">,</span> mp_hands<span class="token punctuation">.</span>HAND_CONNECTIONS<span class="token punctuation">)</span>
                    <span class="token keyword">for</span> idx<span class="token punctuation">,</span> landmark <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">.</span>landmark<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        h<span class="token punctuation">,</span> w<span class="token punctuation">,</span> c <span class="token operator">=</span> frame<span class="token punctuation">.</span>shape
                        cx<span class="token punctuation">,</span> cy <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>x <span class="token operator">*</span> w<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>y <span class="token operator">*</span> h<span class="token punctuation">)</span>
                        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>
                        cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">(</span>cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 绘制红色的关键点</span>

    <span class="token comment"># 显示图像</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Hand Detection and Keypoint Estimation'</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>

    <span class="token comment"># 按 'q' 键退出</span>
    <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>

<span class="token comment"># 释放摄像头资源并关闭窗口</span>
cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="1_308">
     </a>
     1.代码解析
    </h5>
    <ol>
     <li>
      <strong>
       加载 YOLOv5 模型
      </strong>
      ：
      <ul>
       <li>
        <code>
         torch.hub.load('ultralytics/yolov5', 'yolov5s')
        </code>
        载入 YOLOv5 模型，
        <code>
         yolov5s
        </code>
        是一个小型的 YOLOv5 模型，适合实时应用。可以根据需求选择
        <code>
         yolov5m
        </code>
        或
        <code>
         yolov5l
        </code>
        （更大的模型，精度更高但速度较慢）。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       读取摄像头视频流
      </strong>
      ：
      <ul>
       <li>
        使用
        <code>
         cv2.VideoCapture(0)
        </code>
        打开摄像头并读取每一帧图像。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       YOLOv5 物体检测
      </strong>
      ：
      <ul>
       <li>
        使用
        <code>
         model(frame)
        </code>
        进行图像检测，返回一个
        <code>
         results
        </code>
        对象，其中包含检测到的边界框、类别标签、置信度等信息。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       提取手部区域
      </strong>
      ：
      <ul>
       <li>
        如果 YOLO 检测到手部（通过检测类别标号），提取手部的区域并将其转化为 RGB 格式（因为 MediaPipe 需要 RGB 输入）。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       MediaPipe 手部关键点估计
      </strong>
      ：
      <ul>
       <li>
        使用
        <code>
         hands.process(rgb_hand_region)
        </code>
        进行手部关键点估计，返回手部的关键点信息。
       </li>
       <li>
        使用
        <code>
         mp_drawing.draw_landmarks()
        </code>
        绘制手部的 21 个关键点和连接线。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       结果显示
      </strong>
      ：
      <ul>
       <li>
        将检测到的手部边界框、关键点及连接线显示在视频流上。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       退出条件
      </strong>
      ：
      <ul>
       <li>
        按下
        <code>
         q
        </code>
        键退出程序。
       </li>
      </ul>
     </li>
    </ol>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f7a6b7735343333342f:61727469636c652f64657461696c732f313435393934313737" class_="artid" style="display:none">
 </p>
</div>


