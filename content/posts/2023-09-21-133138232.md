---
layout: post
title: "制作麒麟v10的docker镜像"
date: 2023-09-21 17:33:37 +0800
description: "制作麒麟v10的docker镜像和上传远端全流程_银河麒麟docker镜像"
keywords: "银河麒麟docker镜像"
categories: ['未分类']
tags: ['容器', 'Kylin', 'Docker']
artid: "133138232"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=133138232
  alt: "制作麒麟v10的docker镜像"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=133138232
featuredImagePreview: https://bing.ee123.net/img/rand?artid=133138232
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     制作麒麟v10的docker镜像
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      制作麒麟v10的docker镜像
     </h4>
     <br/>
     1.准备好麒麟V10的ios镜像（可以从银河麒麟官网下载）
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/70b66f7e1a8939e151b71f3b0ab96269.png">
      <br/>
      2.用VM把麒麟v10安装到虚拟机
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2c1b109c1a2495d3dc966b85ed9a9b42.png">
       <br/>
       3.点击运行虚拟机（第一次打开请在虚拟机中安装麒麟v10系统，运行虚拟机后会有界面提示）
       <br/>
       4.构建镜像文件
      </img>
     </img>
    </div>
    <p>
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">//#创建独立文件夹用来打包镜像文件(在/目录下创建，保证后续的/dev文件可以拷到/kylin-docker-fs/dev)</span>
<span class="token number">1.</span>mkdir <span class="token operator">/</span>kylin<span class="token operator">-</span>docker<span class="token operator">-</span>fs <span class="token operator">&amp;&amp;</span> cd <span class="token operator">/</span>kylin<span class="token operator">-</span>docker<span class="token operator">-</span>fs
<span class="token comment">//#创建基础目录,dev 必须要创建，不然会提示找不到/dev/null</span>
<span class="token number">2.</span>mkdir usr dev
<span class="token number">3.</span>cp <span class="token operator">-</span>a <span class="token operator">/</span>usr<span class="token operator">/</span>lib <span class="token operator">/</span>usr<span class="token operator">/</span>lib64 <span class="token operator">/</span>usr<span class="token operator">/</span>bin <span class="token operator">/</span>usr<span class="token operator">/</span>share <span class="token operator">/</span>usr<span class="token operator">/</span>sbin usr<span class="token operator">/</span>
<span class="token comment">//#创建链接</span>
<span class="token number">4.</span>	ln <span class="token operator">-</span>s usr<span class="token operator">/</span>lib lib
	ln <span class="token operator">-</span>s usr<span class="token operator">/</span>lib64 lib64
	ln <span class="token operator">-</span>s usr<span class="token operator">/</span>bin bin
	ln <span class="token operator">-</span>s usr<span class="token operator">/</span>sbin sbin
<span class="token comment">//#配置文件(我把文件都打包了，不然会遇到无法apt install和无法安装等情况)</span>
<span class="token number">5.</span>cp <span class="token operator">-</span>a <span class="token operator">/</span>etc <span class="token operator">/</span>root <span class="token operator">/</span>var <span class="token operator">/</span>tem <span class="token operator">/</span>boot <span class="token operator">/</span>cdrom <span class="token operator">/</span>media <span class="token operator">/</span>mnt <span class="token operator">/</span>opt <span class="token punctuation">.</span><span class="token operator">/</span>
<span class="token comment">//#把/dev里面的文件全部拷到/kylin-docker-fs/dev</span>
<span class="token number">6.</span>cp <span class="token operator">-</span>a <span class="token operator">/</span>dev<span class="token comment">/*  /kylin-docker-fs/dev                                       		    */</span>
<span class="token comment">//#裁剪部分脚本，不然会提示/proc 没有mount </span>
<span class="token number">7.</span>rm <span class="token operator">-</span>rf etc<span class="token operator">/</span>profile<span class="token punctuation">.</span>d<span class="token operator">/</span>flatpak<span class="token punctuation">.</span>sh etc<span class="token operator">/</span>profile<span class="token punctuation">.</span>d<span class="token operator">/</span>gawk<span class="token punctuation">.</span>csh etc<span class="token operator">/</span>profile<span class="token punctuation">.</span>d<span class="token operator">/</span>gawk<span class="token punctuation">.</span>sh etc<span class="token operator">/</span>profile<span class="token punctuation">.</span>d<span class="token operator">/</span>lang<span class="token punctuation">.</span>csh etc<span class="token operator">/</span>profile<span class="token punctuation">.</span>d<span class="token operator">/</span>lang<span class="token punctuation">.</span>sh etc<span class="token operator">/</span>profile<span class="token punctuation">.</span>d<span class="token operator">/</span>system<span class="token operator">-</span>info<span class="token punctuation">.</span>sh
<span class="token comment">//#测试镜像(最好测试一下apt install安装命令，保证可以安装再进行下一步，如失败，请重复保证第5步复制文件的完整性，把能复制的都复制了)</span>
<span class="token number">8.</span>chroot <span class="token punctuation">.</span>
<span class="token comment">//#打包到一个单独文件夹</span>
<span class="token number">9.</span>cd <span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">10.</span>mkdir <span class="token operator">/</span>home<span class="token operator">/</span>kylin<span class="token operator">-</span>docker
<span class="token number">11.</span>tar <span class="token operator">-</span>C kylin<span class="token operator">-</span>docker<span class="token operator">-</span>fs<span class="token operator">/</span> <span class="token operator">-</span>z <span class="token operator">-</span>c <span class="token punctuation">.</span> <span class="token operator">-</span>f <span class="token operator">/</span>home<span class="token operator">/</span>kylin<span class="token operator">-</span>docker<span class="token operator">/</span>kylin<span class="token operator">-</span>v10<span class="token operator">-</span>docker<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
<span class="token number">12.</span>cd <span class="token operator">/</span>home<span class="token operator">/</span>kylin<span class="token operator">-</span>docker
<span class="token comment">//#使用apt install nano安装nano</span>
<span class="token number">13.</span>sudo nano Dockerfile
	<span class="token comment">//#写入以下内容</span>
	FROM scratch
	ADD kylin<span class="token operator">-</span>v10<span class="token operator">-</span>docker<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">/</span>
	LABEL \
	    org<span class="token punctuation">.</span>label<span class="token operator">-</span>schema<span class="token punctuation">.</span>schema<span class="token operator">-</span>version<span class="token operator">=</span><span class="token string">"1.0"</span> \
	    org<span class="token punctuation">.</span>label<span class="token operator">-</span>schema<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"Kylin Base Image"</span> \
	    org<span class="token punctuation">.</span>label<span class="token operator">-</span>schema<span class="token punctuation">.</span>vendor<span class="token operator">=</span><span class="token string">"Kylin"</span> \
	    org<span class="token punctuation">.</span>label<span class="token operator">-</span>schema<span class="token punctuation">.</span>license<span class="token operator">=</span><span class="token string">"GPLv2"</span> \
	    org<span class="token punctuation">.</span>label<span class="token operator">-</span>schema<span class="token punctuation">.</span>build<span class="token operator">-</span>date<span class="token operator">=</span><span class="token string">"20230920"</span> \
	    org<span class="token punctuation">.</span>opencontainers<span class="token punctuation">.</span>image<span class="token punctuation">.</span>title<span class="token operator">=</span><span class="token string">"Kylin Base Image"</span> \
	    org<span class="token punctuation">.</span>opencontainers<span class="token punctuation">.</span>image<span class="token punctuation">.</span>vendor<span class="token operator">=</span><span class="token string">"Kylin"</span> \
	    org<span class="token punctuation">.</span>opencontainers<span class="token punctuation">.</span>image<span class="token punctuation">.</span>licenses<span class="token operator">=</span><span class="token string">"GPL-2.0-only"</span> \
	    org<span class="token punctuation">.</span>opencontainers<span class="token punctuation">.</span>image<span class="token punctuation">.</span>created<span class="token operator">=</span><span class="token string">"2022-09-20"</span>

    CMD <span class="token punctuation">[</span><span class="token string">"/bin/bash"</span><span class="token punctuation">]</span>

<span class="token comment">//写完后依次按以下操作：</span>
<span class="token comment">//ctrl+o,Enter,ctrl+x 保存并退出</span>
<span class="token comment">//-----------------------------</span>
<span class="token comment">//构建镜像</span>
<span class="token number">14.</span>docker build <span class="token punctuation">.</span> <span class="token operator">-</span>t kylin<span class="token operator">-</span>v10<span class="token operator">-</span>docker<span class="token operator">:</span>v1<span class="token punctuation">.</span><span class="token number">0</span> <span class="token comment">//(kylin-v10-docker 是想构建的名字，v1.0 为标签)</span>
<span class="token comment">//构建完成后，docker images 可以查看构建出来的镜像</span>

</code></pre>
<p> 5.将本地镜像推送到指定 docker 服务器
</p>
<pre><code class="prism language-cpp"><span class="token comment">//假设我的镜像仓库地址是 192.168.1.100 ，端口是 8080， 账号 test ，密码 123456， 要推送本地 kylin-v10-docker:v1.0 镜像</span>
<span class="token number">1.</span>docker tag SOURCE_IMAGE<span class="token punctuation">[</span><span class="token operator">:</span>TAG<span class="token punctuation">]</span> <span class="token punctuation">[</span>ip 地址<span class="token punctuation">]</span><span class="token operator">:</span><span class="token punctuation">[</span>端口<span class="token punctuation">]</span><span class="token operator">/</span>IMAGE<span class="token punctuation">[</span><span class="token operator">:</span>TAG<span class="token punctuation">]</span> <span class="token comment">//打 tag</span>
例<span class="token operator">:</span>docker tag kylin<span class="token operator">-</span>v10<span class="token operator">-</span>docker<span class="token operator">:</span>v1<span class="token punctuation">.</span><span class="token number">0</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">1.100</span><span class="token operator">:</span><span class="token number">8080</span><span class="token operator">/</span>kylin<span class="token operator">-</span>v10<span class="token operator">-</span>docker<span class="token operator">:</span>v1<span class="token punctuation">.</span><span class="token number">0</span>
<span class="token comment">//登录目标服务器</span>
<span class="token number">2.</span>docker login <span class="token operator">-</span>u <span class="token punctuation">[</span>用户名<span class="token punctuation">]</span> <span class="token operator">-</span>p <span class="token punctuation">[</span>密码<span class="token punctuation">]</span> <span class="token punctuation">[</span>服务器 IP 地址<span class="token punctuation">]</span><span class="token operator">:</span><span class="token punctuation">[</span>端口<span class="token punctuation">]</span>
例：docker login <span class="token operator">-</span>u test <span class="token operator">-</span>p <span class="token number">123456</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">1.100</span><span class="token operator">:</span><span class="token number">8080</span>
<span class="token comment">//推送镜像</span>
<span class="token number">3.</span>docker push <span class="token punctuation">[</span>IP 地址<span class="token punctuation">]</span><span class="token operator">:</span><span class="token punctuation">[</span>端口号<span class="token punctuation">]</span><span class="token operator">/</span>IMAGE<span class="token punctuation">[</span><span class="token operator">:</span>TAG<span class="token punctuation">]</span>
例：docker push <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">1.100</span><span class="token operator">:</span><span class="token number">8080</span><span class="token operator">/</span>kylin<span class="token operator">-</span>v10<span class="token operator">-</span>docker<span class="token operator">:</span>v1<span class="token punctuation">.</span><span class="token number">0</span>
</code></pre>
<p>
至此，制作麒麟 v10 的 docker 镜像和推送到远端结束，欢迎指正！谢谢
</p>
<p>
参考： https://blog.csdn.net/qq_38189542/article/details/126366254
<br/>
https://www.cnblogs.com/xwxz/p/14262506.html
</p>

   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34353635373539362f:61727469636c652f64657461696c732f313333313338323332" class_="artid" style="display:none">
 </p>
</div>
