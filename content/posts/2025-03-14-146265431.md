---
layout: post
title: "工具C游戏防沉迷小工具"
date: 2025-03-14 19:23:33 +0800
description: "嘿，各位小伙伴！今天想跟大家唠唠我为啥要搞这么个防沉迷小工具。咱都清楚，现在这游戏啊，玩起来那叫一个带劲，但时间一长，不仅眼睛累，心也跟着累。有些游戏，规则定得挺有意思：要是玩超过 15 分钟，你就可以秒退了，系统不会给你什么惩罚。这不，我就寻思着，要是有个东西能帮咱盯着游戏开始的时间，到时候提醒咱一声，那该多好啊！我可以根据当前局势判断要不要退出，要是碰到开挂的、花钱的，那果断推出，不能苦了自己舒服了别人。于是，我就琢磨着做这么个防沉迷小工具。"
keywords: "【工具】C#游戏防沉迷小工具"
categories: ['工具']
tags: ['防沉迷', '进程时间', '游戏', '提醒', '小工具', 'C']
artid: "146265431"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146265431
    alt: "工具C游戏防沉迷小工具"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146265431
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146265431
cover: https://bing.ee123.net/img/rand?artid=146265431
image: https://bing.ee123.net/img/rand?artid=146265431
img: https://bing.ee123.net/img/rand?artid=146265431
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【工具】C#游戏防沉迷小工具
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     背景介绍
    </h3>
    <p>
     嘿，各位小伙伴！今天想跟大家唠唠我为啥要搞这么个防沉迷小工具。
     <br/>
     咱都清楚，现在这游戏啊，玩起来那叫一个带劲，但时间一长，不仅眼睛累，心也跟着累。有些游戏，规则定得挺有意思：要是玩超过 15 分钟，你就可以秒退了，系统不会给你什么惩罚。这不，我就寻思着，要是有个东西能帮咱盯着游戏开始的时间，到时候提醒咱一声，那该多好啊！我可以根据当前局势判断要不要退出，要是碰到开挂的、花钱的，那果断推出，不能苦了自己舒服了别人。
     <br/>
     于是，我就琢磨着做这么个防沉迷小工具。它的功能说白了就是：在后台悄悄看着游戏进程，一旦快到那个关键的 15 分钟（或者你可以自己定别的时长），就给你来个提醒，比如播放个声音，或者用其他方式。这样，咱就能根据当时的游戏情况，决定是赶紧退出 “保全自己”，还是再坚持一会儿。
     <br/>
     而且啊，这小工具还很灵活，支持各种配置。你可以根据自己的喜好，调整提醒的时间、方式啥的，想怎么来就怎么来。不管你是想避开那些开挂的，还是不想被诱导花冤枉钱，有了它，都能帮你更果断地做出选择，不至于让自己玩得太累，让别人占了便宜。
     <br/>
     总之，这防沉迷小助手就是咱在游戏世界里的一位贴心 “小管家”，帮咱把握好分寸，让咱玩得开心又不 “上头”。
    </p>
    <h3>
     <a id="_7">
     </a>
     一、需求设计目标
    </h3>
    <p>
     在游戏场景中，许多防沉迷系统采用强制退出机制。本工具旨在实现柔性提醒机制，通过声音、弹窗、窗口抖动等方式提醒用户，同时满足以下工程目标：
    </p>
    <ol>
     <li>
      <strong>
       可配置化
      </strong>
      ：支持配置进程匹配规则、提醒策略等参数
     </li>
     <li>
      <strong>
       扩展性
      </strong>
      ：可灵活添加新的提醒方式
     </li>
     <li>
      <strong>
       健壮性
      </strong>
      ：避免资源泄漏，处理进程访问异常
     </li>
     <li>
      <strong>
       低侵入性
      </strong>
      ：不修改目标进程内存或行为
     </li>
    </ol>
    <p>
     效果如下：
     <br/>
     <img alt="效果图" src="https://i-blog.csdnimg.cn/direct/8dedae0d5e3946beada697a99151c606.png"/>
    </p>
    <h3>
     <a id="_19">
     </a>
     二、架构设计
    </h3>
    <p>
     采用分层架构：
    </p>
    <ul>
     <li>
      配置层：处理XML配置加载
     </li>
     <li>
      监控层：实现进程状态检测
     </li>
     <li>
      策略层：多种提醒策略实现
     </li>
     <li>
      UI层：提供配置界面和状态显示
     </li>
    </ul>
    <h3>
     <a id="_26">
     </a>
     三、关键模块实现
    </h3>
    <h4>
     <a id="31__28">
     </a>
     3.1 配置管理模块
    </h4>
    <p>
     使用.NET ConfigurationSection实现自定义配置：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProcessMonitorSection</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ConfigurationSection</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ConfigurationProperty</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"ProcessItems"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ProcessItemCollection</span> ProcessItems <span class="token operator">=&gt;</span> 
        <span class="token punctuation">(</span>ProcessItemCollection<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">"ProcessItems"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     优势：
    </p>
    <ol>
     <li>
      配置热加载能力
     </li>
     <li>
      强类型配置访问
     </li>
     <li>
      配置验证机制
     </li>
    </ol>
    <h4>
     <a id="32__45">
     </a>
     3.2 进程监控引擎
    </h4>
    <p>
     核心监控流程：
    </p>
    <div class="mermaid">
     <svg class="mermaid-svg" height="893.7749633789062" id="mermaid-svg-Wl83obCiLbawwqnN" viewbox="-8 -8 175.08749389648438 893.7749633789062" width="175.08749389648438" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-Wl83obCiLbawwqnN {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-Wl83obCiLbawwqnN .error-icon{fill:#552222;}#mermaid-svg-Wl83obCiLbawwqnN .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-Wl83obCiLbawwqnN .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-Wl83obCiLbawwqnN .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-Wl83obCiLbawwqnN .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-Wl83obCiLbawwqnN .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-Wl83obCiLbawwqnN .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-Wl83obCiLbawwqnN .marker{fill:#333333;stroke:#333333;}#mermaid-svg-Wl83obCiLbawwqnN .marker.cross{stroke:#333333;}#mermaid-svg-Wl83obCiLbawwqnN svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-Wl83obCiLbawwqnN .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-Wl83obCiLbawwqnN .cluster-label text{fill:#333;}#mermaid-svg-Wl83obCiLbawwqnN .cluster-label span{color:#333;}#mermaid-svg-Wl83obCiLbawwqnN .label text,#mermaid-svg-Wl83obCiLbawwqnN span{fill:#333;color:#333;}#mermaid-svg-Wl83obCiLbawwqnN .node rect,#mermaid-svg-Wl83obCiLbawwqnN .node circle,#mermaid-svg-Wl83obCiLbawwqnN .node ellipse,#mermaid-svg-Wl83obCiLbawwqnN .node polygon,#mermaid-svg-Wl83obCiLbawwqnN .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-Wl83obCiLbawwqnN .node .label{text-align:center;}#mermaid-svg-Wl83obCiLbawwqnN .node.clickable{cursor:pointer;}#mermaid-svg-Wl83obCiLbawwqnN .arrowheadPath{fill:#333333;}#mermaid-svg-Wl83obCiLbawwqnN .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-Wl83obCiLbawwqnN .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-Wl83obCiLbawwqnN .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-Wl83obCiLbawwqnN .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-Wl83obCiLbawwqnN .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-Wl83obCiLbawwqnN .cluster text{fill:#333;}#mermaid-svg-Wl83obCiLbawwqnN .cluster span{color:#333;}#mermaid-svg-Wl83obCiLbawwqnN div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-Wl83obCiLbawwqnN :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
       <g class="output">
        <g class="clusters">
        </g>
        <g class="edgePaths">
         <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;">
          <path class="path" d="M83.54374694824219,54L83.54374694824219,58.166666666666664C83.54374694824219,62.333333333333336,83.54374694824219,70.66666666666667,83.54374694824219,79C83.54374694824219,87.33333333333333,83.54374694824219,95.66666666666667,83.54374694824219,99.83333333333333L83.54374694824219,104" marker-end="url(#arrowhead73)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead73" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-C" id="L-B-C" style="opacity: 1;">
          <path class="path" d="M83.54374694824219,150L83.54374694824219,154.16666666666666C83.54374694824219,158.33333333333334,83.54374694824219,166.66666666666666,83.54374694824219,175C83.54374694824219,183.33333333333334,83.54374694824219,191.66666666666666,83.54374694824219,195.83333333333334L83.54374694824219,200" marker-end="url(#arrowhead74)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead74" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-C LE-D" id="L-C-D" style="opacity: 1;">
          <path class="path" d="M83.54374694824219,246L83.54374694824219,250.16666666666666C83.54374694824219,254.33333333333334,83.54374694824219,262.6666666666667,83.62708028157552,271.0833333333333C83.71041361490886,279.5,83.87708028157552,288,83.96041361490886,292.25L84.04374694824219,296.5" marker-end="url(#arrowhead75)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead75" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-D LE-E" id="L-D-E" style="opacity: 1;">
          <path class="path" d="M84.04374694824219,433.1875L83.96041361490886,439.4375C83.87708028157552,445.6875,83.71041361490886,458.1875,83.62708028157552,470.7708333333333C83.54374694824219,483.3541666666667,83.54374694824219,496.0208333333333,83.54374694824219,502.3541666666667L83.54374694824219,508.6875" marker-end="url(#arrowhead76)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead76" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-E LE-F" id="L-E-F" style="opacity: 1;">
          <path class="path" d="M83.54374694824219,554.6875L83.54374694824219,558.8541666666666C83.54374694824219,563.0208333333334,83.54374694824219,571.3541666666666,83.62708028157552,579.7708338419596C83.71041361490886,588.1875010172527,83.87708028157552,596.6875020345052,83.96041361490886,600.9375025431315L84.04374694824219,605.1875030517579" marker-end="url(#arrowhead77)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead77" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-F LE-G" id="L-F-G" style="opacity: 1;">
          <path class="path" d="M84.04374694824219,756.2749969482421L83.96041361490886,762.5249964396158C83.87708028157552,768.7749959309895,83.71041361490886,781.2749949137369,83.62708028157552,793.858327738444C83.54374694824219,806.441660563151,83.54374694824219,819.1083272298177,83.54374694824219,825.441660563151L83.54374694824219,831.7749938964844" marker-end="url(#arrowhead78)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead78" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
        </g>
        <g class="edgeLabels">
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-B" id="L-L-A-B">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-C" id="L-L-B-C">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-C' L-LE-D" id="L-L-C-D">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="translate(83.54374694824219,470.6875)">
          <g class="label" transform="translate(-8,-13)">
           <rect height="26" rx="0" ry="0" width="16">
           </rect>
           <foreignobject height="26" width="16">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-D' L-LE-E" id="L-L-D-E">
              是
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-E' L-LE-F" id="L-L-E-F">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="translate(83.54374694824219,793.7749938964844)">
          <g class="label" transform="translate(-8,-13)">
           <rect height="26" rx="0" ry="0" width="16">
           </rect>
           <foreignobject height="26" width="16">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-F' L-LE-G" id="L-L-F-G">
              是
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
        </g>
        <g class="nodes">
         <g class="node default" id="flowchart-A-36" style="opacity: 1;" transform="translate(83.54374694824219,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="100" x="-50" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-40,-13)">
            <foreignobject height="26" width="80">
             <div style="display: inline-block; white-space: nowrap;">
              启动定时器
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-B-37" style="opacity: 1;" transform="translate(83.54374694824219,127)">
          <rect class="label-container" height="46" rx="0" ry="0" width="116" x="-58" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-48,-13)">
            <foreignobject height="26" width="96">
             <div style="display: inline-block; white-space: nowrap;">
              遍历配置规则
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-C-39" style="opacity: 1;" transform="translate(83.54374694824219,223)">
          <rect class="label-container" height="46" rx="0" ry="0" width="116" x="-58" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-48,-13)">
            <foreignobject height="26" width="96">
             <div style="display: inline-block; white-space: nowrap;">
              枚举系统进程
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-D-41" style="opacity: 1;" transform="translate(83.54374694824219,364.34375)">
          <polygon class="label-container" points="68.34375,0 136.6875,-68.34375 68.34375,-136.6875 0,-68.34375" transform="translate(-68.34375,68.34375)">
          </polygon>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-42.9375,-13)">
            <foreignobject height="26" width="85.875">
             <div style="display: inline-block; white-space: nowrap;">
              匹配进程名?
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-E-43" style="opacity: 1;" transform="translate(83.54374694824219,531.6875)">
          <rect class="label-container" height="46" rx="0" ry="0" width="116" x="-58" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-48,-13)">
            <foreignobject height="26" width="96">
             <div style="display: inline-block; white-space: nowrap;">
              计算运行时间
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-F-45" style="opacity: 1;" transform="translate(83.54374694824219,680.2312469482422)">
          <polygon class="label-container" points="75.54375,0 151.0875,-75.54375 75.54375,-151.0875 0,-75.54375" transform="translate(-75.54375,75.54375)">
          </polygon>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-50.9375,-13)">
            <foreignobject height="26" width="101.875">
             <div style="display: inline-block; white-space: nowrap;">
              超时且需提醒?
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-G-47" style="opacity: 1;" transform="translate(83.54374694824219,854.7749938964844)">
          <rect class="label-container" height="46" rx="0" ry="0" width="116" x="-58" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-48,-13)">
            <foreignobject height="26" width="96">
             <div style="display: inline-block; white-space: nowrap;">
              执行提醒策略
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
       </g>
      </g>
     </svg>
    </div>
    <p>
     关键技术点：
    </p>
    <ul>
     <li>
      通配符转正则表达式
     </li>
    </ul>
    <pre><code class="prism language-csharp"><span class="token keyword">private</span> <span class="token return-type class-name">Regex</span> <span class="token function">ConvertWildcardToRegex</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> pattern<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Regex</span><span class="token punctuation">(</span><span class="token string">"^"</span> <span class="token operator">+</span> 
        Regex<span class="token punctuation">.</span><span class="token function">Escape</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"\\*"</span><span class="token punctuation">,</span> <span class="token string">".*"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"\\?"</span><span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"$"</span><span class="token punctuation">,</span> 
        RegexOptions<span class="token punctuation">.</span>IgnoreCase<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      进程生命周期管理
     </li>
     <li>
      异常处理机制
     </li>
    </ul>
    <h4>
     <a id="33__73">
     </a>
     3.3 策略模式实现提醒
    </h4>
    <p>
     策略接口定义：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IAlertStrategy</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token return-type class-name">Task</span> <span class="token function">ExecuteAsync</span><span class="token punctuation">(</span><span class="token class-name">AlertContext</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     具体策略示例（窗口抖动）：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WindowShakeStrategy</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IAlertStrategy</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">ExecuteAsync</span><span class="token punctuation">(</span><span class="token class-name">AlertContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                NativeMethods<span class="token punctuation">.</span><span class="token function">ShakeWindow</span><span class="token punctuation">(</span>_windowHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     策略组合配置示例：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">processNamePattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notepad++<span class="token punctuation">"</span></span> 
     <span class="token attr-name">addictionTime</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span>
     <span class="token attr-name">soundAlert</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Alarm01.wav<span class="token punctuation">"</span></span>
     <span class="token attr-name">messageBoxText</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>该休息了！<span class="token punctuation">"</span></span>
     <span class="token attr-name">showMessageBox</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre>
    <h3>
     <a id="_109">
     </a>
     四、工程实践亮点
    </h3>
    <h4>
     <a id="41__111">
     </a>
     4.1 资源管理
    </h4>
    <ul>
     <li>
      实现IDisposable接口
     </li>
     <li>
      使用using语句确保资源释放
     </li>
     <li>
      定时器生命周期控制
     </li>
    </ul>
    <h4>
     <a id="42__116">
     </a>
     4.2 并发控制
    </h4>
    <ul>
     <li>
      锁机制保护共享资源
     </li>
    </ul>
    <pre><code class="prism language-csharp"><span class="token keyword">lock</span> <span class="token punctuation">(</span>_lock<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 访问_monitorItems</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      异步策略执行避免UI阻塞
     </li>
    </ul>
    <h4>
     <a id="43__126">
     </a>
     4.3 可观测性
    </h4>
    <ul>
     <li>
      日志跟踪系统状态
     </li>
     <li>
      异常捕获与处理
     </li>
    </ul>
    <pre><code class="prism language-csharp"><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>ex <span class="token keyword">is</span> <span class="token class-name">Win32Exception</span> <span class="token operator">||</span> ex <span class="token keyword">is</span> <span class="token class-name">InvalidOperationException</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 处理进程访问异常</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_136">
     </a>
     五、使用与扩展
    </h3>
    <h4>
     <a id="51__138">
     </a>
     5.1 配置示例
    </h4>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ProcessItems</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">processNamePattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>game*.exe<span class="token punctuation">"</span></span> 
         <span class="token attr-name">addictionTime</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>900<span class="token punctuation">"</span></span>
         <span class="token attr-name">soundAlert</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alert.wav<span class="token punctuation">"</span></span>
         <span class="token attr-name">messageBoxText</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>游戏时间已达15分钟<span class="token punctuation">"</span></span>
         <span class="token attr-name">showMessageBox</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ProcessItems</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h4>
     <a id="52__149">
     </a>
     5.2 扩展新策略
    </h4>
    <ol>
     <li>
      实现IAlertStrategy接口
     </li>
     <li>
      在配置中添加新策略参数
     </li>
     <li>
      在工厂方法中创建策略实例
     </li>
    </ol>
    <p>
     示例（邮件提醒策略）：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmailAlertStrategy</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IAlertStrategy</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Task</span> <span class="token function">ExecuteAsync</span><span class="token punctuation">(</span><span class="token class-name">AlertContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 发送邮件逻辑</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_168">
     </a>
     六、完整代码
    </h3>
    <ul>
     <li>
      AppForm.cs
     </li>
    </ul>
    <pre><code class="prism language-C#">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Configuration;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace AntiAddictionAides
{
    public partial class AppForm : Form
    {
        #region 函数
        public AppForm()
        {
            InitializeComponent();

            #region 初始化
            Inst = this;

            var headers = new string[] { "序号", "进程信息", "防沉迷时间(秒)", "声音提示", "弹框提示", "窗口抖动" };
            foreach(var v in headers)
            {
                this.listViewProcess.Columns.Add(v).TextAlign = HorizontalAlignment.Center;
            }
            this.listViewProcess.AutoResizeColumns(ColumnHeaderAutoResizeStyle.HeaderSize);
            this.listViewProcess.Columns[1].Width = 150;
            this.listViewProcess.Columns[3].Width = 150;
            this.listViewProcess.Columns[4].Width = 400;
            this.listViewProcess.Columns[5].Width = 96;

            // 读取配置项
            _processMonitor = new ProcessMonitor();
            var configItems = LoadProcessConfig();
            foreach(var v in configItems)
            {
                var lv = this.listViewProcess.Items.Add($"{this.listViewProcess.Items.Count + 1}");
                lv.SubItems.AddRange(new string[] {
                    v.ProcessNamePattern,
                    v.AddictionTime.ToString(),
                    v.SoundAlert,
                    v.MessageBoxText,
                    (v.ShowMessageBox ? "是" : "否")
                });
                var monitor = _processMonitor.SetMonitor(v.ProcessNamePattern, TimeSpan.FromSeconds(v.AddictionTime));
                if(!string.IsNullOrWhiteSpace(v.SoundAlert))
                {
                    monitor.AddAlert(new SoundAlertStrategy(v.SoundAlert));
                }
                if (!string.IsNullOrWhiteSpace(v.MessageBoxText))
                {
                    monitor.AddAlert(new MessageBoxAlertStrategy(v.MessageBoxText));
                }
                if(v.ShowMessageBox)
                {
                    monitor.AddAlert(new WindowShakeStrategy(this.Handle));
                }
            }
            #endregion
        }

        public static void Log(string info)
        {
            lock(Inst)
            {
                Console.WriteLine($"[{DateTime.Now}]{info}");
            }
        }
        #endregion

        #region 内部函数
        static List&lt;ProcessItem&gt; LoadProcessConfig()
        {
            var config = new List&lt;ProcessItem&gt;();
            try
            {
                var section = ConfigurationManager.GetSection("ProcessMonitor") as ProcessMonitorSection;
                foreach (ProcessItemElement element in section.ProcessItems)
                {
                    config.Add(new ProcessItem
                    {
                        ProcessNamePattern = element.ProcessNamePattern,
                        AddictionTime = element.AddictionTime,
                        SoundAlert = element.SoundAlert,
                        MessageBoxText = element.MessageBoxText,
                        ShowMessageBox = element.ShowMessageBox
                    });
                }
            }
            catch (Exception ex)
            {
                AppForm.Log($"配置加载失败: {ex.Message}");
            }
            return config;
        }

        class ProcessItem
        {
            public string ProcessNamePattern { get; set; }
            public int AddictionTime { get; set; }
            public string SoundAlert { get; set; }
            public string MessageBoxText { get; set; }
            public bool ShowMessageBox { get; set; }
        }
        #endregion

        #region 属性变量
        ProcessMonitor _processMonitor;
        public static AppForm Inst { get; set; }
        #endregion

        #region 事件
        private void buttonStart_Click(object sender, EventArgs e)
        {
            if(buttonStart.Text == "启动")
            {
                _processMonitor.Start();
                buttonStart.Text = "停止";
            }
            else
            {
                _processMonitor.Stop();
                buttonStart.Text = "启动";
            }
        }
        #endregion
    }

    #region 配置
    public class ProcessMonitorSection : ConfigurationSection
    {
        [ConfigurationProperty("ProcessItems")]
        public ProcessItemCollection ProcessItems =&gt;
            (ProcessItemCollection)this["ProcessItems"];
    }

    public class ProcessItemCollection : ConfigurationElementCollection
    {
        protected override ConfigurationElement CreateNewElement() =&gt;
            new ProcessItemElement();

        protected override object GetElementKey(ConfigurationElement element) =&gt;
            ((ProcessItemElement)element).ProcessNamePattern;
    }

    public class ProcessItemElement : ConfigurationElement
    {
        [ConfigurationProperty("processNamePattern", IsRequired = true)]
        public string ProcessNamePattern =&gt;
            (string)this["processNamePattern"];

        [ConfigurationProperty("addictionTime", IsRequired = true)]
        public int AddictionTime =&gt;
            (int)this["addictionTime"];

        [ConfigurationProperty("soundAlert", IsRequired = false)]
        public string SoundAlert =&gt;
            (string)this["soundAlert"];

        [ConfigurationProperty("messageBoxText", IsRequired = false)]
        public string MessageBoxText =&gt;
            (string)this["messageBoxText"];

        [ConfigurationProperty("showMessageBox", IsRequired = true)]
        public bool ShowMessageBox =&gt;
            (bool)this["showMessageBox"];
    }
    #endregion
}
</code></pre>
    <ul>
     <li>
      ProcessMonitor.cs
     </li>
    </ul>
    <pre><code class="prism language-C#">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Diagnostics;
using System.IO;
using System.Media;
using System.Text.RegularExpressions;
using System.Threading;
using System.Threading.Tasks;

namespace AntiAddictionAides
{
    public class ProcessMonitor : IDisposable
    {
        private readonly Timer _timer;
        private readonly Dictionary&lt;string, MonitorItem&gt; _monitorItems = new Dictionary&lt;string, MonitorItem&gt;();
        private readonly object _lock = new object();
        private bool _disposed;

        public ProcessMonitor()
        {
            _timer = new Timer(CheckProcesses, null, Timeout.Infinite, Timeout.Infinite);
        }

        public void Start()
        {
            // 每30秒检查一次
            _timer.Change(0, 5000);
        }

        public void Stop()
        {
            _timer.Change(Timeout.Infinite, Timeout.Infinite);
        }

        public MonitorItem SetMonitor(string processNamePattern, TimeSpan threshold)
        {
            var regex = ConvertWildcardToRegex(processNamePattern);
            var monitor = new MonitorItem(regex, threshold);
            lock (_lock)
            {
                _monitorItems[processNamePattern] = monitor;
            }
            AppForm.Log($"添加监控，进程：{processNamePattern} 沉迷时间:{threshold.TotalSeconds} 秒");
            return monitor;
        }

        public void RemoveMonitor(string processNamePattern)
        {
            lock (_lock)
            {
                if (_monitorItems.TryGetValue(processNamePattern, out var item))
                {
                    item.Dispose();
                    _monitorItems.Remove(processNamePattern);
                }
            }
            AppForm.Log($"删除监控，进程：{processNamePattern}");
        }

        private void CheckProcesses(object state)
        {
            lock (_lock)
            {
                foreach (var item in _monitorItems.Values)
                {
                    AppForm.Log($"任务检查，进程：{item.ProcessNameRegex}");
                    foreach (var process in Process.GetProcesses())
                    {
                        try
                        {
                            if (!item.ProcessNameRegex.IsMatch(process.ProcessName))
                            {
                                continue;
                            }
                            item.Alert(process);
                        }
                        catch (Exception ex) when (ex is Win32Exception || ex is InvalidOperationException)
                        {
                            // 处理进程访问异常
                        }
                        finally
                        {
                            process.Dispose();
                        }
                    }
                }
            }
        }

        private Regex ConvertWildcardToRegex(string pattern)
        {
            return new Regex("^" +
                Regex.Escape(pattern).Replace("\\*", ".*").Replace("\\?", ".") +
                "$", RegexOptions.IgnoreCase);
        }

        public void Dispose()
        {
            Dispose(true);
            GC.SuppressFinalize(this);
        }

        protected virtual void Dispose(bool disposing)
        {
            if (!_disposed)
            {
                if (disposing)
                {
                    Stop();
                    foreach (var item in _monitorItems.Values)
                    {
                        item.Dispose();
                    }
                    _timer.Dispose();
                }
                _disposed = true;
            }
        }

        ~ProcessMonitor()
        {
            Dispose(false);
        }

        public class MonitorItem
        {
            public Dictionary&lt;int, AlertContext&gt; ProcessAlert { get; set; }
            public Regex ProcessNameRegex { get; }
            public TimeSpan Threshold { get; }
            public List&lt;IAlertStrategy&gt; Alerts { get; private set; }

            public MonitorItem(Regex regex, TimeSpan threshold, IAlertStrategy[] alerts = null)
            {
                ProcessNameRegex = regex;
                Threshold = threshold;
                Alerts = new List&lt;IAlertStrategy&gt;();
                if (alerts != null)
                {
                    Alerts.AddRange(alerts);
                }
                ProcessAlert = new Dictionary&lt;int, AlertContext&gt;();
            }

            AlertContext GetAlertContext(Process process, int pid=0, string pname=null)
            {
                AlertContext context;
                lock (ProcessAlert)
                {
                    if (!ProcessAlert.TryGetValue(process.Id, out context) || process.ProcessName != context.ProcessName)
                    {
                        if(pid &gt; 0 &amp;&amp; !string.IsNullOrWhiteSpace(pname))
                        {
                            context = new AlertContext()
                            {
                                ProcessId = pid,
                                ProcessName = pname,
                                LastPlayed = DateTime.Now
                            };
                            ProcessAlert[pid] = context;
                        }
                    }
                }
                return context;
            }


            public void Alert(Process process)
            {
                var pinfo = $"[{process.Id}-{process.ProcessName}]";
                AlertContext context = GetAlertContext(process, process.Id, process.ProcessName);
                if (context == null)
                {
                    AppForm.Log($"获取告警上下文失败:{pinfo}");
                    return;
                }
                AppForm.Log($"获取{pinfo}上下文信息，告警数:{context.AlertNum} 最近时间:{context.LastPlayed}");
                if (context.AlertNum &gt; 3)
                {
                    AppForm.Log($"进程{pinfo}告警数{context.AlertNum}超限，已忽略");
                    return;
                }
                context.RunTime = DateTime.Now - process.StartTime;
                if (context.RunTime &lt; Threshold)
                {
                    AppForm.Log($"进程{pinfo}未达沉迷时限，已忽略");
                    return;
                }
                if (DateTime.Now - context.LastPlayed &lt; TimeSpan.FromSeconds(10))
                {
                    AppForm.Log($"进程{pinfo}仍在提醒期限内，已忽略");
                    return;
                }

                context.AlertNum++;
                context.LastPlayed = DateTime.Now;
                AppForm.Log($"进程{pinfo}在{context.LastPlayed}触发提醒{context.AlertNum}");

                // 默认提示音
                if (Alerts.Count == 0)
                {
                    new SoundAlertStrategy("Alarm01.wav").ExecuteAsync(context);
                }
                else
                {
                    foreach(var v in Alerts)
                    {
                        v.ExecuteAsync(context);
                    }
                }
            }

            public int AddAlert(IAlertStrategy alert)
            {
                int idx = 0;
                lock(Alerts)
                {
                    Alerts.Add(alert);
                    idx = Alerts.Count;
                }
                return idx;
            }

            public void RemoveAlert(int idx)
            {
                if(idx &lt; 0 || idx &gt;= Alerts.Count)
                {
                    return;
                }

                lock (Alerts)
                {
                    Alerts.RemoveAt(idx);
                }
            }

            public void Dispose()
            {
                foreach(var v in Alerts)
                {
                    if(v is SoundAlertStrategy sa)
                    {
                        sa.Dispose();
                    }
                }
            }
        }
    }

    public class WinMediaWav
    {
        public static readonly string MediaPath = Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.Windows), "Media");
        public static string[] Wavs
        {
            get
            {
                return null;
            }
        }

        public static string Wav(string name)
        {
            var file = Path.Combine(MediaPath, name);
            var files = new string[] { name, file, file + ".wav" };
            foreach(var v in files)
            {
                if (File.Exists(v))
                {
                    return v;
                }
            }
            return null;
        }
    }


    public interface IAlertStrategy
    {
        Task ExecuteAsync(AlertContext context);
    }

    public class SoundAlertStrategy : IAlertStrategy
    {
        private readonly SoundPlayer _player;

        public SoundAlertStrategy(string soundFilePath)
        {
            _player = new SoundPlayer(WinMediaWav.Wav(soundFilePath));
        }

        public Task ExecuteAsync(AlertContext context)
        {
            AppForm.Log($"执行提示音{context.RunTime} {context.ProcessId}-{context.ProcessName}");
            return Task.Run(() =&gt; _player.PlaySync());
        }

        public void Dispose()
        {
            _player.Dispose();
        }
    }

    public class MessageBoxAlertStrategy : IAlertStrategy
    {
        private string Text { get; set; }
        public MessageBoxAlertStrategy(string text)
        {
            Text = text;
        }

        public Task ExecuteAsync(AlertContext context)
        {
            return Task.Run(() =&gt;
            {
                AppForm.Log($"执行弹框提醒{context.RunTime} {context.ProcessId}-{context.ProcessName}");
                var result = System.Windows.Forms.MessageBox.Show(
                    Text ?? $"老铁，醒醒，该休息啦！",
                    $"防沉迷提醒-{context.ProcessName} 沉迷时间:{context.RunTime}",
                    System.Windows.Forms.MessageBoxButtons.OK,
                    System.Windows.Forms.MessageBoxIcon.Information);
            });
        }
    }

    public class WindowShakeStrategy : IAlertStrategy
    {
        private readonly IntPtr _windowHandle;

        public WindowShakeStrategy(IntPtr hWnd)
        {
            _windowHandle = hWnd;
        }

        public async Task ExecuteAsync(AlertContext context)
        {
            await Task.Run(() =&gt;
            {
                AppForm.Log($"执行窗口抖动提醒{context.RunTime} {context.ProcessId}-{context.ProcessName}");
                for (int i = 0; i &lt; 3; i++)
                {
                    NativeMethods.ShakeWindow(_windowHandle);
                    Thread.Sleep(200);
                }
            });
        }
    }

    public class AlertContext
    {
        public int ProcessId { get; set; }
        public string ProcessName { get; set; }
        public TimeSpan RunTime { get; set; }
        public DateTime LastPlayed { get; set; } = DateTime.MinValue;
        public int AlertNum { get; set; }
    }

    internal static class NativeMethods
    {
        [System.Runtime.InteropServices.DllImport("user32.dll")]
        private static extern bool GetWindowRect(IntPtr hWnd, out RECT lpRect);

        [System.Runtime.InteropServices.DllImport("user32.dll")]
        private static extern bool SetWindowPos(IntPtr hWnd, IntPtr hWndInsertAfter, int X, int Y, int cx, int cy, uint uFlags);

        [System.Runtime.InteropServices.StructLayout(System.Runtime.InteropServices.LayoutKind.Sequential)]
        private struct RECT
        {
            public int Left;
            public int Top;
            public int Right;
            public int Bottom;
        }

        public static void ShakeWindow(IntPtr hWnd)
        {
            const uint SWP_NOSIZE = 0x0001;
            const uint SWP_NOZORDER = 0x0004;
            const int SHAKE_DISTANCE = 10; // 抖动幅度
            const int SHAKE_SPEED = 20;    // 抖动速度（毫秒）

            // 获取原始窗口位置
            if (!GetWindowRect(hWnd, out RECT originalRect))
                return;

            int originalX = originalRect.Left;
            int originalY = originalRect.Top;

            // 抖动动画
            for (int i = 0; i &lt; 3; i++)
            {
                // 右移
                SetWindowPos(hWnd, IntPtr.Zero,
                    originalX + SHAKE_DISTANCE, originalY,
                    0, 0, SWP_NOSIZE | SWP_NOZORDER);
                System.Threading.Thread.Sleep(SHAKE_SPEED);

                // 左移
                SetWindowPos(hWnd, IntPtr.Zero,
                    originalX - SHAKE_DISTANCE, originalY,
                    0, 0, SWP_NOSIZE | SWP_NOZORDER);
                System.Threading.Thread.Sleep(SHAKE_SPEED);
            }

            // 恢复原始位置
            SetWindowPos(hWnd, IntPtr.Zero,
                originalX, originalY,
                0, 0, SWP_NOSIZE | SWP_NOZORDER);
        }
    }
}
</code></pre>
    <ul>
     <li>
      App.Config
     </li>
    </ul>
    <pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 必须放在最前面 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configSections</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ProcessMonitor<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>AntiAddictionAides.ProcessMonitorSection, AntiAddictionAides<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configSections</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>startup</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>supportedRuntime</span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>v4.0<span class="token punctuation">"</span></span> <span class="token attr-name">sku</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.NETFramework,Version=v4.5<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>startup</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ProcessMonitor</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ProcessItems</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">processNamePattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notepad++<span class="token punctuation">"</span></span> <span class="token attr-name">addictionTime</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span> <span class="token attr-name">soundAlert</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Alarm01.wav<span class="token punctuation">"</span></span> <span class="token attr-name">messageBoxText</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>该休息了！<span class="token punctuation">"</span></span> <span class="token attr-name">showMessageBox</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">processNamePattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chrome*<span class="token punctuation">"</span></span> <span class="token attr-name">addictionTime</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3600<span class="token punctuation">"</span></span> <span class="token attr-name">soundAlert</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Alarm02.wav<span class="token punctuation">"</span></span> <span class="token attr-name">messageBoxText</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>注意用眼健康<span class="token punctuation">"</span></span> <span class="token attr-name">showMessageBox</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ProcessItems</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ProcessMonitor</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031343136313836342f:61727469636c652f64657461696c732f313436323635343331" class_="artid" style="display:none">
 </p>
</div>


