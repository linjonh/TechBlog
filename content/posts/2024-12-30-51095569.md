---
layout: post
title: "Java-通过HttpClient-Post方式提交json,并从服务端返回json数据"
date: 2024-12-30 11:40:38 +0800
description: "直接上代码吧，和前面几篇文章都差不多java代码：package PostPager;import "
keywords: "client.postforentity 传输json"
categories: ['Java']
tags: ['Json', 'Java']
artid: "51095569"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=51095569
    alt: "Java-通过HttpClient-Post方式提交json,并从服务端返回json数据"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=51095569
featuredImagePreview: https://bing.ee123.net/img/rand?artid=51095569
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Java 通过HttpClient  Post方式提交json，并从服务端返回json数据
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     直接上代码吧，和前面几篇文章都差不多
    </p>
    <p>
     java代码：
    </p>
    <pre class="prettyprint"><code class="hljs avrasm">package PostPager<span class="hljs-comment">;</span>


import java<span class="hljs-preprocessor">.io</span><span class="hljs-preprocessor">.IOException</span><span class="hljs-comment">;</span>
import java<span class="hljs-preprocessor">.io</span><span class="hljs-preprocessor">.InputStream</span><span class="hljs-comment">;</span>
import java<span class="hljs-preprocessor">.io</span><span class="hljs-preprocessor">.OutputStream</span><span class="hljs-comment">;</span>
import java<span class="hljs-preprocessor">.net</span><span class="hljs-preprocessor">.HttpURLConnection</span><span class="hljs-comment">;</span>
import java<span class="hljs-preprocessor">.net</span><span class="hljs-preprocessor">.URL</span><span class="hljs-comment">;</span>
import java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.ArrayList</span><span class="hljs-comment">;</span>
import java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.List</span><span class="hljs-comment">;</span>

import org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.http</span><span class="hljs-preprocessor">.HttpEntity</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.http</span><span class="hljs-preprocessor">.HttpResponse</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.http</span><span class="hljs-preprocessor">.NameValuePair</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.http</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.ClientProtocolException</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.http</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.ResponseHandler</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.http</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.entity</span><span class="hljs-preprocessor">.UrlEncodedFormEntity</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.http</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.methods</span><span class="hljs-preprocessor">.CloseableHttpResponse</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.http</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.methods</span><span class="hljs-preprocessor">.HttpPost</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.http</span><span class="hljs-preprocessor">.entity</span><span class="hljs-preprocessor">.StringEntity</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.http</span><span class="hljs-preprocessor">.impl</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.CloseableHttpClient</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.http</span><span class="hljs-preprocessor">.impl</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.HttpClients</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.http</span><span class="hljs-preprocessor">.message</span><span class="hljs-preprocessor">.BasicNameValuePair</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.http</span><span class="hljs-preprocessor">.params</span><span class="hljs-preprocessor">.CoreProtocolPNames</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.http</span><span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.EntityUtils</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.json</span><span class="hljs-preprocessor">.JSONArray</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.json</span><span class="hljs-preprocessor">.JSONException</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.json</span><span class="hljs-preprocessor">.JSONObject</span><span class="hljs-comment">;</span>

public class PostXml {



    public static void main(String args[]) {
        try {
            JSONObject  obj = new JSONObject()<span class="hljs-comment">;</span>
                obj<span class="hljs-preprocessor">.append</span>(<span class="hljs-string">"app_name"</span>, <span class="hljs-string">"全民大讨论"</span>)<span class="hljs-comment">;</span>
                obj<span class="hljs-preprocessor">.append</span>(<span class="hljs-string">"app_ip"</span>, <span class="hljs-string">"10.21.243.234"</span>)<span class="hljs-comment">;</span>
                obj<span class="hljs-preprocessor">.append</span>(<span class="hljs-string">"app_port"</span>, <span class="hljs-number">8080</span>)<span class="hljs-comment">;</span>
                obj<span class="hljs-preprocessor">.append</span>(<span class="hljs-string">"app_type"</span>, <span class="hljs-string">"001"</span>)<span class="hljs-comment">;</span>
                obj<span class="hljs-preprocessor">.append</span>(<span class="hljs-string">"app_area"</span>, <span class="hljs-string">"asd"</span>)<span class="hljs-comment">;</span>

            CloseableHttpClient httpclient = HttpClients<span class="hljs-preprocessor">.createDefault</span>()<span class="hljs-comment">;</span>
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(obj)<span class="hljs-comment">;</span>

            HttpPost httpPost = new HttpPost(<span class="hljs-string">"http://119.29.85.118//test.php"</span>)<span class="hljs-comment">;</span>
            httpPost<span class="hljs-preprocessor">.addHeader</span>(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json;charset=UTF-8"</span>)<span class="hljs-comment">;</span>

            // 解决中文乱码问题
            StringEntity stringEntity = new StringEntity(obj<span class="hljs-preprocessor">.toString</span>(), <span class="hljs-string">"UTF-8"</span>)<span class="hljs-comment">;</span>
            stringEntity<span class="hljs-preprocessor">.setContentEncoding</span>(<span class="hljs-string">"UTF-8"</span>)<span class="hljs-comment">;</span>

            httpPost<span class="hljs-preprocessor">.setEntity</span>(stringEntity)<span class="hljs-comment">;</span>

            // CloseableHttpResponse response =
            // httpclient<span class="hljs-preprocessor">.execute</span>(httpPost)<span class="hljs-comment">;</span>

            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"Executing request "</span> + httpPost<span class="hljs-preprocessor">.getRequestLine</span>())<span class="hljs-comment">;</span>

            // Create a custom response handler
            ResponseHandler&lt;String&gt; responseHandler = new ResponseHandler&lt;String&gt;() {
                @Override
                public String handleResponse(final HttpResponse response)
                        throws ClientProtocolException, IOException {//
                    int status = response<span class="hljs-preprocessor">.getStatusLine</span>()<span class="hljs-preprocessor">.getStatusCode</span>()<span class="hljs-comment">;</span>
                    if (status &gt;= <span class="hljs-number">200</span> &amp;&amp; status &lt; <span class="hljs-number">300</span>) {

                        HttpEntity entity = response<span class="hljs-preprocessor">.getEntity</span>()<span class="hljs-comment">;</span>

                        return entity != null ? EntityUtils<span class="hljs-preprocessor">.toString</span>(entity) : null<span class="hljs-comment">;</span>
                    } else {
                        throw new ClientProtocolException(
                                <span class="hljs-string">"Unexpected response status: "</span> + status)<span class="hljs-comment">;</span>
                    }
                }
            }<span class="hljs-comment">;</span>
            String responseBody = httpclient<span class="hljs-preprocessor">.execute</span>(httpPost, responseHandler)<span class="hljs-comment">;</span>
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"----------------------------------------"</span>)<span class="hljs-comment">;</span>
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(responseBody)<span class="hljs-comment">;</span>

        } catch (Exception e) {
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(e)<span class="hljs-comment">;</span>
        }
    }
}
</code></pre>
    <p>
     服务端test.php代码：
    </p>
    <pre class="prettyprint"><code class="hljs xml"> <span class="php"><span class="hljs-preprocessor">&lt;?php</span>
         <span class="hljs-variable">$result</span> = file_get_contents(<span class="hljs-string">'php://input'</span>);
         <span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>;
         <span class="hljs-keyword">echo</span> json_decode(json_encode(<span class="hljs-variable">$result</span>));

 <span class="hljs-preprocessor">?&gt;</span></span></code></pre>
    <p>
     输出结果：
     <br/>
     {“app_name”:[“全民大讨论”],”app_ip”:[“10.21.243.234”],”app_type”:[“001”],”app_port”:[8080],”app_area”:[“asd”]}
    </p>
    <h3 id="executing-request-post-http1192985118testphp-http11">
     Executing request POST
     <a href="http://119.29.85.118//test.php" rel="nofollow">
      http://119.29.85.118//test.php
     </a>
     HTTP/1.1
    </h3>
    <p>
     {“app_name”:[“全民大讨论”],”app_ip”:[“10.21.243.234”],”app_type”:[“001”],”app_port”:[8080],”app_area”:[“asd”]}{“app_name”:[“全民大讨论”],”app_ip”:[“10.21.243.234”],”app_type”:[“001”],”app_port”:[8080],”app_area”:[“asd”]}
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f75303133373636343336:2f61727469636c652f64657461696c732f3531303935353639" class_="artid" style="display:none">
 </p>
</div>


