---
layout: post
title: "带宽管理配置实验"
date: 2025-03-15 00:07:42 +0800
description: "FW-policy-traffic-profile-01]bandwidth maximum-bandwidth whole downstream 60000   ----设定带宽，最大带宽，下行60M。[FW-policy-quota-profile-niuma]limit-bandwidth 0     -----超出配额后的限制带宽为0。[FW-policy-quota-profile-niuma]time-daily 240      ------设定上网时长。"
keywords: "带宽管理配置实验"
categories: ['未分类']
tags: ['运维', '网络', '服务器']
artid: "146269777"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146269777
    alt: "带宽管理配置实验"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146269777
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146269777
cover: https://bing.ee123.net/img/rand?artid=146269777
image: https://bing.ee123.net/img/rand?artid=146269777
img: https://bing.ee123.net/img/rand?artid=146269777
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     带宽管理配置实验
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h4>
     一、实验拓扑
    </h4>
    <p>
     <img alt="" height="476" src="https://i-blog.csdnimg.cn/direct/7d09fece596a43ae881cfb01027c22e9.png" width="790"/>
    </p>
    <blockquote>
     <p>
      配置流程：
      <br/>
      1、带宽通道：整体带宽、每个用户带宽、连接数、优先级信息
      <br/>
      2、带宽策略
      <br/>
      3、策略+通道，引用
      <br/>
      4、配置接口出入带宽
     </p>
    </blockquote>
    <p>
     二、实验需求和配置
    </p>
    <p>
     1、基础配置
    </p>
    <p>
     接口配置
    </p>
    <blockquote>
     <p>
      [dianxin]interface GigabitEthernet 0/0/0
      <br/>
      [dianxin-GigabitEthernet0/0/0]ip add 12.0.0.2 24
     </p>
     <p>
      [liantong]interface GigabitEthernet 0/0/0
      <br/>
      [liantong-GigabitEthernet0/0/0]ip add 13.0.0.2 24
     </p>
     <p>
      [FW]interface GigabitEthernet 1/0/0
      <br/>
      [FW-GigabitEthernet1/0/0]ip add 12.0.0.1 24
      <br/>
      [FW]interface GigabitEthernet 1/0/1
      <br/>
      [FW-GigabitEthernet1/0/1]ip add 13.0.0.1 24
      <br/>
      [FW]int g 1/0/2.10
      <br/>
      [FW-GigabitEthernet1/0/2.10]ip add 192.168.1.254 24
      <br/>
      [FW]interface GigabitEthernet 1/0/2.20
      <br/>
      [FW-GigabitEthernet1/0/2.20]int g 1/0/2.30
      <br/>
      [FW-GigabitEthernet1/0/2.30]ip add 192.168.3.254 24
      <br/>
      [FW-GigabitEthernet1/0/2.30]int g 1/0/2.40
      <br/>
      [FW-GigabitEthernet1/0/2.40]ip add 192.168.4.254 24
      <br/>
      [FW]interface GigabitEthernet 1/0/3
      <br/>
      [FW-GigabitEthernet1/0/3]ip add 10.1.1.254 24
     </p>
    </blockquote>
    <p>
     配置VLAN并划分接口
    </p>
    <blockquote>
     <p>
      [SW1]vlan batch 10 20 30 40
      <br/>
      [SW1]interface GigabitEthernet 0/0/1
      <br/>
      [SW1-GigabitEthernet0/0/1]port link-type trunk
      <br/>
      [SW1-GigabitEthernet0/0/1]port trunk allow-pass vlan 10 20 30 40
      <br/>
      [SW1]int g 0/0/2
      <br/>
      [SW1-GigabitEthernet0/0/2]port link-type access
      <br/>
      [SW1-GigabitEthernet0/0/2]port default vlan 10
      <br/>
      [SW1]int g 0/0/3
      <br/>
      [SW1-GigabitEthernet0/0/3]port link-type access
      <br/>
      [SW1-GigabitEthernet0/0/3]port default vlan 20
      <br/>
      [SW1]int g 0/0/4
      <br/>
      [SW1-GigabitEthernet0/0/4]port link-type access
      <br/>
      [SW1-GigabitEthernet0/0/4]port default vlan 30
      <br/>
      [SW1]int g 0/0/5
      <br/>
      [SW1-GigabitEthernet0/0/5]port link-type access
      <br/>
      [SW1-GigabitEthernet0/0/5]port default vlan 40
     </p>
    </blockquote>
    <p>
     划分安全区域
    </p>
    <blockquote>
     <p>
      firewall zone untrust
      <br/>
      set priority 5
      <br/>
      add interface GigabitEthernet1/0/0
      <br/>
      add interface GigabitEthernet1/0/1
     </p>
     <p>
      firewall zone trust
      <br/>
      set priority 85
      <br/>
      add interface GigabitEthernet0/0/0
      <br/>
      add interface GigabitEthernet1/0/2.10
      <br/>
      add interface GigabitEthernet1/0/2.20
      <br/>
      add interface GigabitEthernet1/0/2.30
      <br/>
      add interface GigabitEthernet1/0/2.40
     </p>
     <p>
      firewall zone dmz
      <br/>
      set priority 50
      <br/>
      add interface GigabitEthernet1/0/3
     </p>
    </blockquote>
    <p>
     配置路由
    </p>
    <blockquote>
     <p>
      [FW]ip route-static 0.0.0.0 0 12.0.0.2
      <br/>
      [FW]ip route-static 0.0.0.0 0 13.0.0.2
     </p>
    </blockquote>
    <p>
     配置NAT策略
    </p>
    <blockquote>
     <p>
      nat-policy
      <br/>
      rule name 01
      <br/>
      source-zone trust
      <br/>
      action source-nat easy-ip
     </p>
    </blockquote>
    <p>
     2、带宽管理配置
    </p>
    <p>
     需求一
    </p>
    <blockquote>
     <p>
      企业组织架构中存在部门A，部门A中存在销售组1和研发组2：
      <br/>
      销售部门----&gt;Email、ERP业务
      <br/>
      可以对部门A中的销售组进行带宽资源细分，保证销售员工的业务流量正常转发：
      <br/>
      1、部门A中的下行最大带宽不超过60M
      <br/>
      2、部门A的销售组下行最大带宽不超过30M
      <br/>
      3、部门A的销售组的Email业务下行最小带宽不低于20M
     </p>
     <p>
      分析：需求之间存在父子关系
      <br/>
      A部门带宽通道---最大60M
      <br/>
      部门A销售组带宽通道---最大30M
      <br/>
      部门A销售组Email业务带宽通道---最小20M
     </p>
    </blockquote>
    <p>
     带宽策略配置一
    </p>
    <blockquote>
     <p>
      [FW]traffic-policy  ---- 进入带宽策略配置视图
      <br/>
      [FW-policy-traffic]profile 01    ----创建一个带宽通道，名称为01
      <br/>
      [FW-policy-traffic-profile-01]bandwidth maximum-bandwidth whole downstream 60000   ----设定带宽，最大带宽，下行60M
     </p>
     <p>
      [FW]traffic-policy
      <br/>
      [FW-policy-traffic]display this
      <br/>
      rule name 01      ----策略名称
      <br/>
      description A
      <br/>
      source-zone trust
      <br/>
      destination-zone untrust
      <br/>
      source-address 192.168.1.0 mask 255.255.255.0
      <br/>
      source-address 192.168.2.0 mask 255.255.255.0
      <br/>
      action qos profile 01        ----动作为限流，且调用带宽通道
     </p>
    </blockquote>
    <p>
     <img alt="" height="343" src="https://i-blog.csdnimg.cn/direct/0b369369068445b7ac2a59dc1353a71d.png" width="359">
     </img>
    </p>
    <blockquote>
     <p>
      [FW]traffic-policy
      <br/>
      [FW-policy-traffic]profile 02
      <br/>
      [FW-policy-traffic-profile-02]bandwidth maximum-bandwidth whole downstream 30000
     </p>
     <p>
      [FW]traffic-policy
      <br/>
      [FW-policy-traffic]display this
      <br/>
      rule name 02 parent 01
      <br/>
      description A_xiaoshou
      <br/>
      source-zone trust
      <br/>
      destination-zone untrust
      <br/>
      source-address 192.168.1.0 mask 255.255.255.0
      <br/>
      action qos profile 02
     </p>
    </blockquote>
    <p>
     <img alt="" height="345" src="https://i-blog.csdnimg.cn/direct/89c2d273116f4b4d83816960eacdbd94.png" width="354"/>
    </p>
    <blockquote>
     <p>
      [FW]traffic-policy
      <br/>
      [FW-policy-traffic]display this
      <br/>
      profile 03
      <br/>
      bandwidth guaranteed-bandwidth whole downstream 20000
      <br/>
      rule name 03 parent 02
      <br/>
      description A_xiaoshou_email
      <br/>
      source-zone trust
      <br/>
      destination-zone untrust
      <br/>
      source-address 192.168.1.0 mask 255.255.255.0
      <br/>
      action qos profile 03
     </p>
    </blockquote>
    <p>
     <img alt="" height="336" src="https://i-blog.csdnimg.cn/direct/3be0645790404457a8027bfd738de405.png" width="351">
     </img>
    </p>
    <p>
     <img alt="" height="290" src="https://i-blog.csdnimg.cn/direct/472eb2eb9c224fd5a9604eb854e915a4.png" width="779"/>
    </p>
    <p>
     安全策略
    </p>
    <blockquote>
     <p>
      [FW]security-policy
      <br/>
      [FW-policy-security]dis th
      <br/>
      security-policy
      <br/>
      rule name 01
      <br/>
      description 带宽策略（01）引入
      <br/>
      source-zone trust
      <br/>
      destination-zone untrust
      <br/>
      source-address 192.168.1.0 mask 255.255.255.0
      <br/>
      source-address 192.168.2.0 mask 255.255.255.0
      <br/>
      action permit
     </p>
    </blockquote>
    <p>
     需求二
    </p>
    <blockquote>
     <p>
      给部门A和部门B划分可使用的带宽资源。要避免P2P业务占据较多的带宽，还需要限制部门A和部门B使用P2P业务的带宽总和。
      <br/>
      1、部门A下行最大带宽60M
      <br/>
      2、部门B下行最大带宽40M
      <br/>
      3、部门A和部门B的P2P业务下行最大带宽不超过80M
      <br/>
      4、P2P流量需要计算到各自部门的总流量中
     </p>
    </blockquote>
    <p>
     带宽策略配置二
    </p>
    <p>
     <a href="https://so.csdn.net/so/search?q=P2P&amp;spm=1001.2101.3001.7020" title="P2P">
      P2P
     </a>
     带宽通道：
    </p>
    <blockquote>
     <p>
      traffic-policy
      <br/>
      profile 05_P2P
      <br/>
      bandwidth reference-mode rule-shared
      <br/>
      bandwidth maximum-bandwidth whole downstream 80000
     </p>
    </blockquote>
    <p>
     <img alt="" height="344" src="https://i-blog.csdnimg.cn/direct/c58b512ac8894f28a487b7c26af8da52.png" width="757">
     </img>
    </p>
    <blockquote>
     <p>
      [FW]traffic-policy
      <br/>
      [FW-policy-traffic]dis th
      <br/>
      rule name 05 parent 01
      <br/>
      description A_P2P业务
      <br/>
      source-zone trust
      <br/>
      destination-zone untrust
      <br/>
      source-address 192.168.1.0 mask 255.255.255.0
      <br/>
      source-address 192.168.2.0 mask 255.255.255.0
      <br/>
      application app Oracle_MySQL
      <br/>
      action qos profile 05_P2P
      <br/>
      rule name 04
      <br/>
      description B
      <br/>
      source-zone trust
      <br/>
      destination-zone untrust
      <br/>
      source-address 192.168.3.0 mask 255.255.255.0
      <br/>
      source-address 192.168.4.0 mask 255.255.255.0
      <br/>
      action qos profile 04
      <br/>
      rule name 06 parent 04
      <br/>
      description B_P2P业务
      <br/>
      source-zone trust
      <br/>
      destination-zone untrust
      <br/>
      source-address 192.168.3.0 mask 255.255.255.0
      <br/>
      source-address 192.168.4.0 mask 255.255.255.0
      <br/>
      application app Oracle_MySQL
      <br/>
      action qos profile 05_P2P
     </p>
    </blockquote>
    <p>
     <img alt="" height="383" src="https://i-blog.csdnimg.cn/direct/993be1a67dd343b0a4f78ceea96fbba4.png" width="778"/>
    </p>
    <p>
     <img alt="" height="424" src="https://i-blog.csdnimg.cn/direct/a30a7813f8a34f45ac3db31db68c80ea.png" width="773"/>
     <img alt="" height="425" src="https://i-blog.csdnimg.cn/direct/7c51c3228f6946fabc6b296aa5ee882e.png" width="776"/>
    </p>
    <p>
     <img alt="" height="430" src="https://i-blog.csdnimg.cn/direct/1e95d285efc04f6e95d8b9741118eaa4.png" width="780"/>
    </p>
    <p>
     需求三
    </p>
    <blockquote>
     <p>
      在不影响正常用户上网和web服务器正常提供对外服务的情况下，实现以下功能：
      <br/>
      1、将从ISP购买的100M带宽进行划分
      <br/>
      上网高峰期(工作日下午3点-6点)，上网用户下行带宽60M(U-T)，外用用户下行带宽40M(D-U)
      <br/>
      2、2台web服务器，限制每一台web服务器对外提供的最大下行带宽不超过20M
      <br/>
      3、假设，总共30个上网用户，在上网高峰期，限制每个用户访问Internet的最大下行带宽不超过2M
     </p>
    </blockquote>
    <p>
     新建时间段：
    </p>
    <p>
     <img alt="" height="373" src="https://i-blog.csdnimg.cn/direct/08dafb07f70c48b98f3978c0d2175c65.png" width="780"/>
    </p>
    <p>
     带宽策略配置三
    </p>
    <blockquote>
     <p>
      profile 06
      <br/>
      bandwidth maximum-bandwidth whole downstream 60000
      <br/>
      bandwidth maximum-bandwidth per-ip downstream 2000
      <br/>
      rule name 07
      <br/>
      description 企业上网用户策略
      <br/>
      source-zone trust
      <br/>
      destination-zone untrust
      <br/>
      source-address 192.168.0.0 mask 255.255.0.0
      <br/>
      time-range time_01
      <br/>
      action qos profile 06
     </p>
    </blockquote>
    <p>
     <img alt="" height="428" src="https://i-blog.csdnimg.cn/direct/29cef7f0e92e45bfb74bc0ef42dda4d6.png" width="778"/>
     <img alt="" height="426" src="https://i-blog.csdnimg.cn/direct/b3802dd1067a4de4b317fc5287533947.png" width="782"/>
    </p>
    <blockquote>
     <p>
      profile 07
      <br/>
      bandwidth maximum-bandwidth whole downstream 40000
      <br/>
      bandwidth maximum-bandwidth per-ip downstream 20000
      <br/>
      rule name 08
      <br/>
      description 外网用户访问服务器
      <br/>
      source-zone untrust
      <br/>
      destination-zone dmz
      <br/>
      destination-address 10.1.1.0 mask 255.255.255.0
      <br/>
      action qos profile 07
     </p>
    </blockquote>
    <p>
     <img alt="" height="428" src="https://i-blog.csdnimg.cn/direct/c64ffe846e654dce986b369426844c9b.png" width="767"/>
     需求四
    </p>
    <blockquote>
     <p>
      部门A的上网用户数量不固定，为了让用户公平的使用带宽，根据实际在线上网用户数量，平均分配带宽：
      <br/>
      1、部门A的下行最大带宽60M
      <br/>
      2、根据实时的上网用户数量，对部门A的60M带宽资源进行均分
     </p>
    </blockquote>
    <p>
     <strong>
      动态均分功能：在配置了整体最大带宽的前提下，FW根据在线IP/用户的个数和带宽使用率，动态的对每一个IP/用户能够使用的最大带宽进行平均分配
     </strong>
     。
    </p>
    <p>
     <span style="color:#4d4d4d">
      <span style="background-color:#ffffff">
       计算方式：
      </span>
     </span>
     <strong>
      <span style="color:orange">
       每个IP/用户最大带宽=MAX(带宽最小值，整体最大带宽/IP用户数*平均分配系数)
      </span>
     </strong>
     <span style="color:#4d4d4d">
      <span style="background-color:#ffffff">
       。
      </span>
     </span>
    </p>
    <p>
     带宽通道：
    </p>
    <blockquote>
     <p>
      profile 08
      <br/>
      bandwidth maximum-bandwidth whole downstream 60000
      <br/>
      bandwidth average per-ip manual multiplier 1 minimum 1000
     </p>
    </blockquote>
    <p>
     <img alt="" height="478" src="https://i-blog.csdnimg.cn/direct/71591d46d8b74aa7b993a2a7835b881c.png" width="771"/>
    </p>
    <blockquote>
     <p>
      平均分配系数----与带宽使用率存在反比关系
      <br/>
      0                &lt;70%
      <br/>
      1                70-75%
      <br/>
      2                75-80%
      <br/>
      3
      <br/>
      4
     </p>
    </blockquote>
    <p>
     带宽策略配置四
    </p>
    <blockquote>
     <p>
      rule name 09
      <br/>
      description A_用户带宽分配
      <br/>
      source-zone trust
      <br/>
      destination-zone untrust
      <br/>
      source-address 192.168.1.0 mask 255.255.255.0
      <br/>
      source-address 192.168.2.0 mask 255.255.255.0
      <br/>
      action qos profile 08
     </p>
    </blockquote>
    <p>
     <img alt="" height="424" src="https://i-blog.csdnimg.cn/direct/62d83389c9424b0d8b54a67a027132e5.png" width="776"/>
     需求五
    </p>
    <p>
     设定出入接口带宽：
    </p>
    <blockquote>
     <p>
      电信购买带宽100M
      <br/>
      联通购买带宽50M
     </p>
    </blockquote>
    <p>
     <img alt="" height="450" src="https://i-blog.csdnimg.cn/direct/339f91ab96094025a1ac726e35780c7f.png" width="777"/>
    </p>
    <p>
     <img alt="" height="509" src="https://i-blog.csdnimg.cn/direct/13af6da8dadc464e82d857f6ec3b83c5.png" width="761"/>
    </p>
    <p>
     需求六–配额策略
    </p>
    <blockquote>
     <p>
      运营商---&gt;流量套餐---&gt;对中小企业500G/月，超出部分，额外计费
      <br/>
      限额---&gt;每一个员工规定上网时长
      <br/>
      1、员工40人，10名管理人员+30名牛马
      <br/>
      高管--&gt;20G/月
      <br/>
      牛马--&gt;10G/月
      <br/>
      2、牛马---&gt;4h/日，流量500M/日
      <br/>
      3、超额后限制
      <br/>
      牛马---&gt;禁止上网
      <br/>
      高管---&gt;超过配额后最大带宽限定为800K
     </p>
    </blockquote>
    <p>
     <img alt="" height="380" src="https://i-blog.csdnimg.cn/direct/2cbf297b50d94b5f885f7cc0d3da2894.png" width="773"/>
    </p>
    <blockquote>
     <p>
      [FW]quota-policy       ----进入配额策略视图
      <br/>
      [FW-policy-quota]profile niuma          -----创建配额通道
      <br/>
      [FW-policy-quota-profile-niuma]stream-daily 500     -----每日流量限额
      <br/>
      [FW-policy-quota-profile-niuma]stream-monthly 10240        ----每月流量配额
      <br/>
      [FW-policy-quota-profile-niuma]time-daily 240      ------设定上网时长
      <br/>
      [FW-policy-quota-profile-niuma]limit-bandwidth 0     -----超出配额后的限制带宽为0
     </p>
     <p>
      [FW-policy-quota]rule name niuma
      <br/>
      [FW-policy-quota-rule-niuma]user user-group /default/niuma   -----策略应用用户
      <br/>
      [FW-policy-quota-rule-niuma]action quota profile niuma
     </p>
     <p>
     </p>
    </blockquote>
    <p>
     <img alt="" height="410" src="https://i-blog.csdnimg.cn/direct/e9820e60b2644a1f94f02b39ffc55c68.png" width="766"/>
    </p>
    <blockquote>
     <p>
      quota-policy
      <br/>
      profile gaoguan
      <br/>
      stream-monthly 20480
      <br/>
      limit-bandwidth 800
      <br/>
      rule name gaoguan
      <br/>
      description 高管
      <br/>
      user user-group /default/gaoguan
      <br/>
      action quota profile gaoguan
     </p>
    </blockquote>
    <p>
     <img alt="" height="429" src="https://i-blog.csdnimg.cn/direct/856e544156084e789f6ba055836141e4.png" width="771"/>
    </p>
    <p>
     需求七—流量整形和流量监管
    </p>
    <p>
     <strong>
      <span style="color:red">
       无法在web界面实现
      </span>
     </strong>
     <span style="color:#4d4d4d">
      <span style="background-color:#ffffff">
       。
      </span>
     </span>
    </p>
    <blockquote>
     <p>
      流量监管：对进入接口的，超出限制速率的报文进行丢弃。
      <br/>
      流量整形：对接口发送的，超出限制速率的报文先进行缓存，等待流量不超出速率时发送。
     </p>
    </blockquote>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f37333937313632342f:61727469636c652f64657461696c732f313436323639373737" class_="artid" style="display:none">
 </p>
</div>


