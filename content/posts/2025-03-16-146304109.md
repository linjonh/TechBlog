---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f6c696c696e6861693534382f:61727469636c652f64657461696c732f313436333034313039"
layout: post
title: "Javaå¹¶å‘ç¼–ç¨‹é¢è¯•é¢˜åŸºç¡€11é¢˜"
date: 2025-03-16 23:49:55 +08:00
description: "è¿›ç¨‹è¯´ç®€å•ç‚¹å°±æ˜¯æˆ‘ä»¬åœ¨ç”µè„‘ä¸Šå¯åŠ¨çš„ä¸€ä¸ªä¸ªåº”ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªæµè§ˆå™¨ï¼Œå°±ä¼šå¯åŠ¨äº†ä¸€ä¸ªæµè§ˆå™¨è¿›ç¨‹ã€‚è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼Œå®ƒåŒ…æ‹¬äº†ç¨‹åºã€æ•°æ®å’Œè¿›ç¨‹æ§åˆ¶å—ç­‰ã€‚çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿä¸­è°ƒåº¦çš„æœ€å°å•ä½ï¼Œå®ƒæ˜¯è¿›ç¨‹ä¸­çš„ç‹¬ç«‹æ‰§è¡Œå•å…ƒã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ªè¿›ç¨‹çš„èµ„æºï¼Œå¦‚å†…å­˜å’Œæ–‡ä»¶å¥æŸ„ï¼Œä½†æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆå’Œå¯„å­˜å™¨ã€‚ä¸è¿›ç¨‹ç›¸æ¯”ï¼Œçº¿ç¨‹çš„åˆ›å»ºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€æ›´å°ï¼Œå› æ­¤åœ¨éœ€è¦å¹¶å‘æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå¤šçº¿ç¨‹æ˜¯ä¸€ç§å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œå¤šçº¿ç¨‹çš„å…¸å‹åº”ç”¨åŒ…æ‹¬å¹¶è¡Œå¤„ç†ã€I/O æ“ä½œã€å¹¶å‘æœåŠ¡å™¨ç­‰åœºæ™¯ã€‚"
keywords: "Javaå¹¶å‘ç¼–ç¨‹é¢è¯•é¢˜ï¼šåŸºç¡€ï¼ˆ11é¢˜ï¼‰"
categories: ['Java']
tags: ['å¼€å‘è¯­è¨€', 'Java']
artid: "146304109"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146304109
    alt: "Javaå¹¶å‘ç¼–ç¨‹é¢è¯•é¢˜åŸºç¡€11é¢˜"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146304109
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146304109
cover: https://bing.ee123.net/img/rand?artid=146304109
image: https://bing.ee123.net/img/rand?artid=146304109
img: https://bing.ee123.net/img/rand?artid=146304109
---

# Javaå¹¶å‘ç¼–ç¨‹é¢è¯•é¢˜ï¼šåŸºç¡€ï¼ˆ11é¢˜ï¼‰

> ğŸ§‘ åšä¸»ç®€ä»‹ï¼š
> **CSDNåšå®¢ä¸“å®¶**
> ï¼Œ
> **å†ä»£æ–‡å­¦ç½‘**
> ï¼ˆPCç«¯å¯ä»¥è®¿é—®ï¼š
> <https://literature.sinhy.com/#/?__c=1000>
> ï¼Œç§»åŠ¨ç«¯å¯å¾®ä¿¡å°ç¨‹åºæœç´¢â€œ
> **å†ä»£æ–‡å­¦**
> â€ï¼‰æ€»æ¶æ„å¸ˆï¼Œ
> `15å¹´`
> å·¥ä½œç»éªŒï¼Œç²¾é€š
> `Javaç¼–ç¨‹`
> ï¼Œ
> `é«˜å¹¶å‘è®¾è®¡`
> ï¼Œ
> `Springbootå’Œå¾®æœåŠ¡`
> ï¼Œç†Ÿæ‚‰
> `Linux`
> ï¼Œ
> `ESXIè™šæ‹ŸåŒ–`
> ä»¥åŠ
> `äº‘åŸç”ŸDockerå’ŒK8s`
> ï¼Œçƒ­è¡·äºæ¢ç´¢ç§‘æŠ€çš„è¾¹ç•Œï¼Œå¹¶å°†ç†è®ºçŸ¥è¯†è½¬åŒ–ä¸ºå®é™…åº”ç”¨ã€‚ä¿æŒå¯¹æ–°æŠ€æœ¯çš„å¥½å¥‡å¿ƒï¼Œä¹äºåˆ†äº«æ‰€å­¦ï¼Œå¸Œæœ›é€šè¿‡æˆ‘çš„å®è·µç»å†å’Œè§è§£ï¼Œå¯å‘ä»–äººçš„åˆ›æ–°æ€ç»´ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å¸Œæœ›èƒ½ä¸å¿—åŒé“åˆçš„æœ‹å‹äº¤æµæ¢è®¨ï¼Œå…±åŒè¿›æ­¥ï¼Œä¸€èµ·åœ¨æŠ€æœ¯çš„ä¸–ç•Œé‡Œä¸æ–­å­¦ä¹ æˆé•¿ã€‚
>   
> **æŠ€æœ¯åˆä½œ**
> è¯·åŠ æœ¬äººwxï¼ˆ
> *æ³¨æ˜æ¥è‡ªcsdn*
> ï¼‰ï¼š
> `foreast_sea`

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/11968bb92b404ca7bd9fdfe004b640b1.gif#pic_center)

---

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/25436bb1d72e473dabb5cbd5db081972.png#pic_center)

### Javaå¹¶å‘ç¼–ç¨‹é¢è¯•é¢˜ï¼šåŸºç¡€ï¼ˆ11é¢˜ï¼‰

#### 1.å¹¶è¡Œè·Ÿå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

* **å¹¶è¡Œ**
  æ˜¯æŒ‡å¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªæ ¸å¿ƒå®é™…ä¸Šå¯ä»¥åœ¨åŒä¸€æ—¶é—´ç‹¬ç«‹åœ°æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚
* **å¹¶å‘**
  æ˜¯æŒ‡ç³»ç»Ÿæœ‰å¤„ç†å¤šä¸ªä»»åŠ¡çš„èƒ½åŠ›ï¼Œä½†æ˜¯ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œã€‚åœ¨å•æ ¸å¤„ç†å™¨ä¸Šï¼Œå¤šä¸ªä»»åŠ¡æ˜¯é€šè¿‡æ—¶é—´ç‰‡è½®è½¬çš„æ–¹å¼å®ç°çš„ã€‚ä½†è¿™ç§åˆ‡æ¢éå¸¸å¿«ï¼Œç»™äººæ„Ÿè§‰æ˜¯åœ¨åŒæ—¶æ‰§è¡Œã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/bd389b7916634240b7316449719dbece.png)

å°±å¥½åƒæˆ‘ä»¬å»é£Ÿå ‚æ‰“é¥­ï¼Œå¹¶è¡Œå°±æ˜¯æ¯ä¸ªäººå¯¹åº”ä¸€ä¸ªé˜¿å§¨ï¼ŒåŒæ—¶æ‰“é¥­ï¼›è€Œå¹¶å‘å°±æ˜¯ä¸€ä¸ªé˜¿å§¨ï¼Œè½®æµç»™æ¯ä¸ªäººæ‰“é¥­ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/cc24b792ec6e4d888a57f022ab5bf5fd.png)

##### ä½ å¯¹çº¿ç¨‹å®‰å…¨çš„ç†è§£æ˜¯ä»€ä¹ˆï¼Ÿ

çº¿ç¨‹å®‰å…¨æ˜¯å¹¶å‘ç¼–ç¨‹ä¸­ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œå¦‚æœä¸€æ®µä»£ç å—æˆ–è€…ä¸€ä¸ªæ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œæ—¶èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†å…±äº«æ•°æ®ï¼Œé‚£ä¹ˆè¿™æ®µä»£ç å—æˆ–è€…æ–¹æ³•å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚

å¯ä»¥ä»ä¸‰ä¸ªè¦ç´ æ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼š

**â‘ ã€åŸå­æ€§**
ï¼šç¡®ä¿å½“æŸä¸ªçº¿ç¨‹ä¿®æ”¹å…±äº«å˜é‡æ—¶ï¼Œæ²¡æœ‰å…¶ä»–çº¿ç¨‹å¯ä»¥åŒæ—¶ä¿®æ”¹è¿™ä¸ªå˜é‡ï¼Œå³è¿™ä¸ªæ“ä½œæ˜¯ä¸å¯åˆ†å‰²çš„ã€‚

![é›·å°å¸…ï¼šåŸå­æ€§](https://i-blog.csdnimg.cn/img_convert/39f847df0cc0cfa323cfbdaeefe66759.png)

åŸå­æ€§å¯ä»¥é€šè¿‡äº’æ–¥é”ï¼ˆå¦‚ synchronizedï¼‰æˆ–åŸå­æ“ä½œï¼ˆå¦‚ AtomicInteger ç±»ä¸­çš„æ–¹æ³•ï¼‰æ¥ä¿è¯ã€‚

**â‘¡ã€å¯è§æ€§**
ï¼šç¡®ä¿ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹å¯ä»¥ç«‹å³è¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°ã€‚

![é›·å°å¸…ï¼šå¯è§æ€§](https://i-blog.csdnimg.cn/img_convert/c2b79dc679afed027fb895f07c505248.png)

volatile å…³é”®å­—å¯ä»¥ä¿è¯äº†å˜é‡çš„ä¿®æ”¹å¯¹æ‰€æœ‰çº¿ç¨‹ç«‹å³å¯è§ï¼Œå¹¶é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–å¯¼è‡´çš„å¯è§æ€§é—®é¢˜ã€‚

**â‘¢ã€æ´»è·ƒæ€§é—®é¢˜**
ï¼šè¦ç¡®ä¿çº¿ç¨‹ä¸ä¼šå› ä¸ºæ­»é”ã€é¥¥é¥¿ã€æ´»é”ç­‰é—®é¢˜å¯¼è‡´æ— æ³•ç»§ç»­æ‰§è¡Œã€‚

![é›·å°å¸…ï¼šæ´»è·ƒæ€§é—®é¢˜](https://i-blog.csdnimg.cn/img_convert/f5dc66f41bdb56cc6fb44bdd71b154a2.png)

#### 2.è¯´è¯´ä»€ä¹ˆæ˜¯è¿›ç¨‹å’Œçº¿ç¨‹ï¼Ÿ

è¿›ç¨‹è¯´ç®€å•ç‚¹å°±æ˜¯æˆ‘ä»¬åœ¨ç”µè„‘ä¸Šå¯åŠ¨çš„ä¸€ä¸ªä¸ªåº”ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªæµè§ˆå™¨ï¼Œå°±ä¼šå¯åŠ¨äº†ä¸€ä¸ªæµè§ˆå™¨è¿›ç¨‹ã€‚è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼Œå®ƒåŒ…æ‹¬äº†ç¨‹åºã€æ•°æ®å’Œè¿›ç¨‹æ§åˆ¶å—ç­‰ã€‚

çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿä¸­è°ƒåº¦çš„æœ€å°å•ä½ï¼Œå®ƒæ˜¯è¿›ç¨‹ä¸­çš„ç‹¬ç«‹æ‰§è¡Œå•å…ƒã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ªè¿›ç¨‹çš„èµ„æºï¼Œå¦‚å†…å­˜å’Œæ–‡ä»¶å¥æŸ„ï¼Œä½†æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆå’Œå¯„å­˜å™¨ã€‚ä¸è¿›ç¨‹ç›¸æ¯”ï¼Œçº¿ç¨‹çš„åˆ›å»ºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€æ›´å°ï¼Œå› æ­¤åœ¨éœ€è¦å¹¶å‘æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå¤šçº¿ç¨‹æ˜¯ä¸€ç§å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/93b5cb47875e461e8038e7eea59cf8da.png)

åœ¨ç¼–ç¨‹ä¸­ï¼Œå¤šçº¿ç¨‹çš„å…¸å‹åº”ç”¨åŒ…æ‹¬å¹¶è¡Œå¤„ç†ã€I/O æ“ä½œã€å¹¶å‘æœåŠ¡å™¨ç­‰åœºæ™¯ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬æ–°å»ºã€å°±ç»ªã€è¿è¡Œã€é˜»å¡å’Œç»ˆæ­¢ã€‚

##### å¦‚ä½•ç†è§£åç¨‹ï¼Ÿ

åç¨‹é€šå¸¸è¢«è§†ä¸ºæ¯”çº¿ç¨‹æ›´è½»é‡çº§çš„å¹¶å‘å•å…ƒï¼Œå®ƒä»¬ä¸»è¦åœ¨ä¸€äº›æ”¯æŒå¼‚æ­¥ç¼–ç¨‹æ¨¡å‹çš„è¯­è¨€ä¸­å¾—åˆ°äº†åŸç”Ÿæ”¯æŒï¼Œå¦‚ Kotlinã€Go ç­‰ã€‚

ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CompletableFuture æ¥æ¨¡æ‹Ÿåç¨‹å¼çš„å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ã€‚

```java
class CompletableFutureExample {

    public static void main(String[] args) throws ExecutionException, InterruptedException {
        // å¼‚æ­¥æ‰§è¡Œä»»åŠ¡1
        CompletableFuture<Integer> future1 = CompletableFuture.supplyAsync(() -> {
            try {
                Thread.sleep(1000); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            return 10;
        });

        // å¼‚æ­¥æ‰§è¡Œä»»åŠ¡2
        CompletableFuture<Integer> future2 = CompletableFuture.supplyAsync(() -> {
            try {
                Thread.sleep(1000); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            return 20;
        });

        // åˆå¹¶ä¸¤ä¸ªä»»åŠ¡çš„ç»“æœå¹¶è®¡ç®—
        CompletableFuture<Integer> resultFuture = future1.thenCombine(future2, Integer::sum);

        // ç­‰å¾…æœ€ç»ˆç»“æœå¹¶æ‰“å°
        System.out.println("ç»“æœ: " + resultFuture.get());
    }
}

```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ª CompletableFuture å¯¹è±¡æ¥å¼‚æ­¥æ‰§è¡Œä¸¤ä¸ªç®€å•çš„æ•°å€¼è¿”å›ä»»åŠ¡ã€‚è¿™ä¸¤ä¸ªä»»åŠ¡éƒ½ä¼šä¼‘çœ  1 ç§’é’Ÿæ¥æ¨¡æ‹Ÿè€—æ—¶è®¡ç®—ã€‚

ç„¶åæˆ‘ä»¬ä½¿ç”¨ thenCombine æ–¹æ³•æ¥åˆå¹¶è¿™ä¸¤ä¸ªä»»åŠ¡çš„ç»“æœã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡ get æ–¹æ³•ç­‰å¾…æœ€ç»ˆç»“æœçš„å®Œæˆï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚

##### è¯´è¯´çº¿ç¨‹çš„å…±äº«å†…å­˜ï¼Ÿ

çº¿ç¨‹ä¹‹é—´æƒ³è¦è¿›è¡Œé€šä¿¡ï¼Œå¯ä»¥é€šè¿‡æ¶ˆæ¯ä¼ é€’å’Œå…±äº«å†…å­˜ä¸¤ç§æ–¹æ³•æ¥å®Œæˆã€‚é‚£ Java é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜çš„å¹¶å‘æ¨¡å‹ã€‚

è¿™ä¸ªæ¨¡å‹è¢«ç§°ä¸º Java å†…å­˜æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯ JMMï¼ŒJMM å†³å®šäº†ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ä½•æ—¶å¯¹å¦å¤–ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚

çº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼ˆmain memoryï¼‰ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æœ¬åœ°å†…å­˜ï¼ˆlocal memoryï¼‰ï¼Œæœ¬åœ°å†…å­˜ä¸­å­˜å‚¨äº†å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚å½“ç„¶äº†ï¼Œæœ¬åœ°å†…å­˜æ˜¯ JMM çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ã€‚

![æ·±å…¥æµ…å‡º Java å¤šçº¿ç¨‹ï¼šJMM](https://i-blog.csdnimg.cn/img_convert/2fe29c3d17cd68c8e2e993764a0dbe32.png)

çº¿ç¨‹ A ä¸çº¿ç¨‹ B ä¹‹é—´å¦‚è¦é€šä¿¡çš„è¯ï¼Œå¿…é¡»è¦ç»å†ä¸‹é¢ 2 ä¸ªæ­¥éª¤ï¼š

* çº¿ç¨‹ A æŠŠæœ¬åœ°å†…å­˜ A ä¸­çš„å…±äº«å˜é‡å‰¯æœ¬åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚
* çº¿ç¨‹ B åˆ°ä¸»å†…å­˜ä¸­è¯»å–çº¿ç¨‹ A åˆ·æ–°è¿‡çš„å…±äº«å˜é‡ï¼Œå†åŒæ­¥åˆ°è‡ªå·±çš„å…±äº«å˜é‡å‰¯æœ¬ä¸­ã€‚

![æ·±å…¥æµ…å‡º Java å¤šçº¿ç¨‹ï¼šçº¿ç¨‹é—´é€šä¿¡](https://i-blog.csdnimg.cn/img_convert/5c04e6f61daaad7bdef7fccf8a2bacce.png)

#### 3.è¯´è¯´çº¿ç¨‹æœ‰å‡ ç§åˆ›å»ºæ–¹å¼ï¼Ÿ

Java ä¸­åˆ›å»ºçº¿ç¨‹ä¸»è¦æœ‰ä¸‰ç§æ–¹å¼ï¼Œåˆ†åˆ«ä¸ºç»§æ‰¿ Thread ç±»ã€å®ç° Runnable æ¥å£ã€å®ç° Callable æ¥å£ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://i-blog.csdnimg.cn/img_convert/b174d992bc76680330e3480173b99f8d.png)

ç¬¬ä¸€ç§ï¼Œç»§æ‰¿ Thread ç±»ï¼Œé‡å†™
`run()`
æ–¹æ³•ï¼Œè°ƒç”¨
`start()`
æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚

```java
class ThreadTask extends Thread {
    public void run() {
        System.out.println("çœ‹å®ŒäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼Œä¸Šå²¸äº†!");
    }

    public static void main(String[] args) {
        ThreadTask task = new ThreadTask();
        task.start();
    }
}

```

è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ï¼Œç”±äº Java ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œæ‰€ä»¥å¦‚æœç±»å·²ç»ç»§æ‰¿äº†å¦ä¸€ä¸ªç±»ï¼Œå°±ä¸èƒ½ä½¿ç”¨è¿™ç§æ–¹æ³•äº†ã€‚

ç¬¬äºŒç§ï¼Œå®ç° Runnable æ¥å£ï¼Œé‡å†™
`run()`
æ–¹æ³•ï¼Œç„¶ååˆ›å»º Thread å¯¹è±¡ï¼Œå°† Runnable å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™ Thread å¯¹è±¡ï¼Œè°ƒç”¨
`start()`
æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚

```java
class RunnableTask implements Runnable {
    public void run() {
        System.out.println("çœ‹å®ŒäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼Œä¸Šå²¸äº†!");
    }

    public static void main(String[] args) {
        RunnableTask task = new RunnableTask();
        Thread thread = new Thread(task);
        thread.start();
    }
}

```

è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯å¯ä»¥é¿å… Java çš„å•ç»§æ‰¿é™åˆ¶ï¼Œå¹¶ä¸”æ›´ç¬¦åˆé¢å‘å¯¹è±¡çš„ç¼–ç¨‹æ€æƒ³ï¼Œå› ä¸º Runnable æ¥å£å°†ä»»åŠ¡ä»£ç å’Œçº¿ç¨‹æ§åˆ¶çš„ä»£ç è§£è€¦äº†ã€‚

ç¬¬ä¸‰ç§ï¼Œå®ç° Callable æ¥å£ï¼Œé‡å†™
`call()`
æ–¹æ³•ï¼Œç„¶ååˆ›å»º FutureTask å¯¹è±¡ï¼Œå‚æ•°ä¸º Callable å¯¹è±¡ï¼›ç´§æ¥ç€åˆ›å»º Thread å¯¹è±¡ï¼Œå‚æ•°ä¸º FutureTask å¯¹è±¡ï¼Œè°ƒç”¨
`start()`
æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚

```java
class CallableTask implements Callable<String> {
    public String call() {
        return "çœ‹å®ŒäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼Œä¸Šå²¸äº†!";
    }

    public static void main(String[] args) throws ExecutionException, InterruptedException {
        CallableTask task = new CallableTask();
        FutureTask<String> futureTask = new FutureTask<>(task);
        Thread thread = new Thread(futureTask);
        thread.start();
        System.out.println(futureTask.get());
    }
}

```

è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯å¯ä»¥è·å–çº¿ç¨‹çš„æ‰§è¡Œç»“æœã€‚

##### ä¸€ä¸ª 8G å†…å­˜çš„ç³»ç»Ÿæœ€å¤šèƒ½åˆ›å»ºå¤šå°‘çº¿ç¨‹?

åœ¨ç¡®å®šä¸€ä¸ªç³»ç»Ÿæœ€å¤šå¯ä»¥åˆ›å»ºå¤šä¸ªçº¿ç¨‹æ—¶ï¼Œé™¤äº†éœ€è¦è€ƒè™‘ç³»ç»Ÿçš„å†…å­˜å¤§å°å¤–ï¼ŒJava è™šæ‹Ÿæœºæ ˆçš„å¤§å°ä¹Ÿæ˜¯å€¼å¾—è€ƒè™‘çš„å› ç´ ã€‚

çº¿ç¨‹åœ¨åˆ›å»ºçš„æ—¶å€™ä¼šè¢«åˆ†é…ä¸€ä¸ªè™šæ‹Ÿæœºæ ˆï¼Œåœ¨ 64 ä½æ“ä½œç³»ç»Ÿä¸­ï¼Œé»˜è®¤å¤§å°ä¸º 1Mã€‚

é€šè¿‡
`java -XX:+PrintFlagsFinal -version | grep ThreadStackSize`
è¿™ä¸ªå‘½ä»¤å¯ä»¥æŸ¥çœ‹ JVM æ ˆçš„é»˜è®¤å¤§å°ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šé»˜è®¤çš„è™šæ‹Ÿæœºæ ˆå¤§å°](https://i-blog.csdnimg.cn/img_convert/9454dbbcb2148ffd4df2a4b6528d4c08.png)

å…¶ä¸­ ThreadStackSize çš„å•ä½æ˜¯å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤çš„ JVM æ ˆå¤§å°æ˜¯ 1024 KBï¼Œä¹Ÿå°±æ˜¯ 1Mã€‚

æ¢å¥è¯è¯´ï¼Œ8GB = 8 \_ 1024 MB = 8 \_ 1024 \_ 1024 KBï¼Œæ‰€ä»¥ä¸€ä¸ª 8G å†…å­˜çš„ç³»ç»Ÿå¯ä»¥åˆ›å»ºçš„çº¿ç¨‹æ•°ä¸º 8 \_ 1024 = 8192 ä¸ªã€‚

ä½†æ“ä½œç³»ç»Ÿæœ¬èº«çš„è¿è¡Œä¹Ÿéœ€è¦æ¶ˆè€—ä¸€å®šçš„å†…å­˜ï¼Œæ‰€ä»¥å®é™…ä¸Šå¯ä»¥åˆ›å»ºçš„çº¿ç¨‹æ•°è‚¯å®šä¼šæ¯” 8192 å°‘ä¸€äº›ã€‚

å¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ®µä»£ç æ¥éªŒè¯ä¸€ä¸‹ï¼š

```java
public class StackOverflowErrorTest1 {
    private static AtomicInteger count = new AtomicInteger(0);
    public static void main(String[] args) {
        while (true) {
            testStackOverflowError();
        }
    }

    public static void testStackOverflowError() {
        System.out.println(count.incrementAndGet());
        testStackOverflowError();
    }
}

```

##### å¯åŠ¨ä¸€ä¸ª Java ç¨‹åºï¼Œä½ èƒ½è¯´è¯´é‡Œé¢æœ‰å“ªäº›çº¿ç¨‹å—ï¼Ÿ

é¦–å…ˆæ˜¯ main çº¿ç¨‹ï¼Œè¿™æ˜¯ç¨‹åºå¼€å§‹æ‰§è¡Œçš„å…¥å£ã€‚

ç„¶åæ˜¯åƒåœ¾å›æ”¶çº¿ç¨‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œè´Ÿè´£å›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ã€‚

è¿˜æœ‰ç¼–è¯‘å™¨çº¿ç¨‹ï¼Œåœ¨åŠæ—¶ç¼–è¯‘ä¸­ï¼ˆJITï¼‰ï¼Œè´Ÿè´£æŠŠä¸€éƒ¨åˆ†çƒ­ç‚¹ä»£ç ç¼–è¯‘åæ”¾åˆ° codeCache ä¸­ï¼Œä»¥æå‡ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šJIT](https://i-blog.csdnimg.cn/img_convert/2e5359bdade15c62351e6b96097dc983.png)

å¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ®µä»£ç è¿›è¡Œæ£€æµ‹ï¼š

```java
class ThreadLister {
    public static void main(String[] args) {
        // è·å–æ‰€æœ‰çº¿ç¨‹çš„å †æ ˆè·Ÿè¸ª
        Map<Thread, StackTraceElement[]> threads = Thread.getAllStackTraces();
        for (Thread thread : threads.keySet()) {
            System.out.println("Thread: " + thread.getName() + " (ID=" + thread.getId() + ")");
        }
    }
}

```

ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
Thread: Monitor Ctrl-Break (ID=5)
Thread: Reference Handler (ID=2)
Thread: main (ID=1)
Thread: Signal Dispatcher (ID=4)
Thread: Finalizer (ID=3)

```

ç®€å•è§£é‡Šä¸‹ï¼š

* `Thread: main (ID=1)`
  - ä¸»çº¿ç¨‹ï¼ŒJava ç¨‹åºå¯åŠ¨æ—¶ç”± JVM åˆ›å»ºã€‚
* `Thread: Reference Handler (ID=2)`
  - è¿™ä¸ªçº¿ç¨‹æ˜¯ç”¨æ¥å¤„ç†å¼•ç”¨å¯¹è±¡çš„ï¼Œå¦‚è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ã€å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰å’Œè™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ã€‚è´Ÿè´£æ¸…ç†è¢« JVM å›æ”¶çš„å¯¹è±¡ã€‚
* `Thread: Finalizer (ID=3)`
  - ç»ˆç»“å™¨çº¿ç¨‹ï¼Œè´Ÿè´£è°ƒç”¨å¯¹è±¡çš„ finalize æ–¹æ³•ã€‚å¯¹è±¡åœ¨åƒåœ¾å›æ”¶å™¨æ ‡è®°ä¸ºå¯å›æ”¶ä¹‹å‰ï¼Œç”±è¯¥çº¿ç¨‹æ‰§è¡Œå…¶ finalize æ–¹æ³•ï¼Œç”¨äºæ‰§è¡Œç‰¹å®šçš„èµ„æºé‡Šæ”¾æ“ä½œã€‚
* `Thread: Signal Dispatcher (ID=4)`
  - ä¿¡å·è°ƒåº¦çº¿ç¨‹ï¼Œå¤„ç†æ¥è‡ªæ“ä½œç³»ç»Ÿçš„ä¿¡å·ï¼Œå°†å®ƒä»¬è½¬å‘ç»™ JVM è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ï¼Œä¾‹å¦‚å“åº”ä¸­æ–­ã€åœæ­¢ç­‰ä¿¡å·ã€‚
* `Thread: Monitor Ctrl-Break (ID=5)`
  - ç›‘è§†å™¨çº¿ç¨‹ï¼Œé€šå¸¸ç”±ä¸€äº›ç‰¹å®šçš„ IDE åˆ›å»ºï¼Œç”¨äºåœ¨å¼€å‘è¿‡ç¨‹ä¸­ç›‘æ§å’Œç®¡ç†ç¨‹åºæ‰§è¡Œæˆ–è€…å¤„ç†ä¸­æ–­ã€‚

#### 4.è°ƒç”¨ start()æ–¹æ³•æ—¶ä¼šæ‰§è¡Œ run()æ–¹æ³•ï¼Œé‚£æ€ä¹ˆä¸ç›´æ¥è°ƒç”¨ run()æ–¹æ³•ï¼Ÿ

åœ¨ Java ä¸­ï¼Œå¯åŠ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹åº”è¯¥è°ƒç”¨å…¶
`start()`
æ–¹æ³•ï¼Œè€Œä¸æ˜¯ç›´æ¥è°ƒç”¨
`run()`
æ–¹æ³•ã€‚

å½“è°ƒç”¨
`start()`
æ–¹æ³•æ—¶ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œå¹¶è®©è¿™ä¸ªæ–°çº¿ç¨‹è°ƒç”¨
`run()`
æ–¹æ³•ã€‚è¿™æ ·ï¼Œ
`run()`
æ–¹æ³•å°±åœ¨æ–°çš„çº¿ç¨‹ä¸­è¿è¡Œï¼Œä»è€Œå®ç°å¤šçº¿ç¨‹å¹¶å‘ã€‚

```java
class MyThread extends Thread {
    public void run() {
        System.out.println(Thread.currentThread().getName());
    }

    public static void main(String[] args) {
        MyThread t1 = new MyThread();
        t1.start(); // æ­£ç¡®çš„æ–¹å¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¹¶åœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œ run()
        t1.run(); // ä»…åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ run()ï¼Œæ²¡æœ‰åˆ›å»ºæ–°çº¿ç¨‹
    }
}

```

å¦‚æœç›´æ¥è°ƒç”¨
`run()`
æ–¹æ³•ï¼Œé‚£ä¹ˆ
`run()`
æ–¹æ³•å°±åœ¨å½“å‰çº¿ç¨‹ä¸­è¿è¡Œï¼Œæ²¡æœ‰æ–°çš„çº¿ç¨‹è¢«åˆ›å»ºï¼Œä¹Ÿå°±æ²¡æœ‰å®ç°å¤šçº¿ç¨‹çš„æ•ˆæœã€‚

æ¥çœ‹è¾“å‡ºç»“æœï¼š

```
main
Thread-0

```

ä¹Ÿå°±æ˜¯è¯´ï¼Œ
`start()`
æ–¹æ³•çš„è°ƒç”¨ä¼šå‘Šè¯‰ JVM å‡†å¤‡å¥½æ‰€æœ‰å¿…è¦çš„æ–°çº¿ç¨‹ç»“æ„ï¼Œåˆ†é…å…¶æ‰€éœ€èµ„æºï¼Œå¹¶è°ƒç”¨çº¿ç¨‹çš„
`run()`
æ–¹æ³•åœ¨è¿™ä¸ªæ–°çº¿ç¨‹ä¸­æ‰§è¡Œã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/840948269d8a4731b9ba4e79032b17ee.png)

#### 5.çº¿ç¨‹æœ‰å“ªäº›å¸¸ç”¨çš„è°ƒåº¦æ–¹æ³•ï¼Ÿ

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/4f1f4f7cc7574d3fbfe66486cf6dfa46.png)

##### è¯´è¯´çº¿ç¨‹ç­‰å¾…ä¸é€šçŸ¥ï¼Ÿ

åœ¨ Object ç±»ä¸­æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥ç”¨äºçº¿ç¨‹çš„ç­‰å¾…ä¸é€šçŸ¥ã€‚

â‘ ã€
`wait()`
ï¼šå½“ä¸€ä¸ªçº¿ç¨‹ A è°ƒç”¨ä¸€ä¸ªå…±äº«å˜é‡çš„
`wait()`
æ–¹æ³•æ—¶ï¼Œçº¿ç¨‹ A ä¼šè¢«é˜»å¡æŒ‚èµ·ï¼Œç›´åˆ°å‘ç”Ÿä¸‹é¢å‡ ç§æƒ…å†µæ‰ä¼šè¿”å› ï¼š

* çº¿ç¨‹ B è°ƒç”¨äº†å…±äº«å¯¹è±¡
  `notify()`
  æˆ–è€…
  `notifyAll()`
  æ–¹æ³•ï¼›
* å…¶ä»–çº¿ç¨‹è°ƒç”¨äº†çº¿ç¨‹ A çš„
  `interrupt()`
  æ–¹æ³•ï¼Œçº¿ç¨‹ A æŠ›å‡º InterruptedException å¼‚å¸¸è¿”å›ã€‚

â‘¡ã€
`wait(long timeout)`
ï¼šè¿™ä¸ªæ–¹æ³•ç›¸æ¯”
`wait()`
æ–¹æ³•å¤šäº†ä¸€ä¸ªè¶…æ—¶å‚æ•°ï¼Œå®ƒçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå¦‚æœçº¿ç¨‹ A è°ƒç”¨å…±äº«å¯¹è±¡çš„
`wait(long timeout)`
æ–¹æ³•åï¼Œæ²¡æœ‰åœ¨æŒ‡å®šçš„ timeout æ—¶é—´å†…è¢«å…¶å®ƒçº¿ç¨‹å”¤é†’ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•è¿˜æ˜¯ä¼šå› ä¸ºè¶…æ—¶è€Œè¿”å›ã€‚

â‘¢ã€
`wait(long timeout, int nanos)`
ï¼Œå…¶å†…éƒ¨è°ƒç”¨çš„æ˜¯
`wait(long timout)`
æ–¹æ³•ã€‚

å”¤é†’çº¿ç¨‹ä¸»è¦æœ‰ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•ï¼š

â‘ ã€
`notify()`
ï¼šä¸€ä¸ªçº¿ç¨‹ A è°ƒç”¨å…±äº«å¯¹è±¡çš„
`notify()`
æ–¹æ³•åï¼Œä¼šå”¤é†’ä¸€ä¸ªåœ¨è¿™ä¸ªå…±äº«å˜é‡ä¸Šè°ƒç”¨ wait ç³»åˆ—æ–¹æ³•åè¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚

ä¸€ä¸ªå…±äº«å˜é‡ä¸Šå¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…ï¼Œå…·ä½“å”¤é†’å“ªä¸ªç­‰å¾…çš„çº¿ç¨‹æ˜¯éšæœºçš„ã€‚

â‘¡ã€
`notifyAll()`
ï¼šä¸åŒäºåœ¨å…±äº«å˜é‡ä¸Šè°ƒç”¨
`notify()`
æ–¹æ³•ä¼šå”¤é†’è¢«é˜»å¡åˆ°è¯¥å…±äº«å˜é‡ä¸Šçš„ä¸€ä¸ªçº¿ç¨‹ï¼ŒnotifyAll æ–¹æ³•ä¼šå”¤é†’æ‰€æœ‰åœ¨è¯¥å…±äº«å˜é‡ä¸Šè°ƒç”¨ wait ç³»åˆ—æ–¹æ³•è€Œè¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚

Thread ç±»è¿˜æä¾›äº†ä¸€ä¸ª
`join()`
æ–¹æ³•ï¼Œæ„æ€æ˜¯å¦‚æœä¸€ä¸ªçº¿ç¨‹ A æ‰§è¡Œäº†
`thread.join()`
ï¼Œå½“å‰çº¿ç¨‹ A ä¼šç­‰å¾… thread çº¿ç¨‹ç»ˆæ­¢ä¹‹åæ‰ä»
`thread.join()`
è¿”å›ã€‚

##### è¯´è¯´çº¿ç¨‹ä¼‘çœ 

`sleep(long millis)`
ï¼šThread ç±»ä¸­çš„é™æ€æ–¹æ³•ï¼Œå½“ä¸€ä¸ªæ‰§è¡Œä¸­çš„çº¿ç¨‹ A è°ƒç”¨äº† Thread çš„ sleep æ–¹æ³•åï¼Œçº¿ç¨‹ A ä¼šæš‚æ—¶è®©å‡ºæŒ‡å®šæ—¶é—´çš„æ‰§è¡Œæƒã€‚

ä½†æ˜¯çº¿ç¨‹ A æ‰€æ‹¥æœ‰çš„ç›‘è§†å™¨èµ„æºï¼Œæ¯”å¦‚é”ï¼Œè¿˜æ˜¯æŒæœ‰ä¸è®©å‡ºçš„ã€‚æŒ‡å®šçš„ç¡çœ æ—¶é—´åˆ°äº†åè¯¥æ–¹æ³•ä¼šæ­£å¸¸è¿”å›ï¼Œæ¥ç€å‚ä¸ CPU çš„è°ƒåº¦ï¼Œè·å–åˆ° CPU èµ„æºåå°±å¯ä»¥ç»§ç»­è¿è¡Œã€‚

##### è¯´è¯´è®©å‡ºä¼˜å…ˆæƒ

`yield()`
ï¼šThread ç±»ä¸­çš„é™æ€æ–¹æ³•ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ yield æ–¹æ³•æ—¶ï¼Œå®é™…æ˜¯åœ¨æš—ç¤ºçº¿ç¨‹è°ƒåº¦å™¨ï¼Œå½“å‰çº¿ç¨‹è¯·æ±‚è®©å‡ºè‡ªå·±çš„ CPUï¼Œä½†æ˜¯çº¿ç¨‹è°ƒåº¦å™¨å¯èƒ½ä¼šâ€œè£…çœ‹ä¸è§â€å¿½ç•¥è¿™ä¸ªæš—ç¤ºã€‚

##### è¯´è¯´çº¿ç¨‹ä¸­æ–­

Java ä¸­çš„çº¿ç¨‹ä¸­æ–­æ˜¯ä¸€ç§çº¿ç¨‹é—´çš„åä½œæ¨¡å¼ï¼Œé€šè¿‡è®¾ç½®çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—å¹¶ä¸èƒ½ç›´æ¥ç»ˆæ­¢è¯¥çº¿ç¨‹çš„æ‰§è¡Œã€‚è¢«ä¸­æ–­çš„çº¿ç¨‹ä¼šæ ¹æ®ä¸­æ–­çŠ¶æ€è‡ªè¡Œå¤„ç†ã€‚

* `void interrupt()`
  æ–¹æ³•ï¼šä¸­æ–­çº¿ç¨‹ï¼Œä¾‹å¦‚ï¼Œå½“çº¿ç¨‹ A è¿è¡Œæ—¶ï¼Œçº¿ç¨‹ B å¯ä»¥è°ƒç”¨çº¿ç¨‹
  `interrupt()`
  æ–¹æ³•æ¥è®¾ç½®çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä¸º true å¹¶ç«‹å³è¿”å›ã€‚è®¾ç½®æ ‡å¿—ä»…ä»…æ˜¯è®¾ç½®æ ‡å¿—, çº¿ç¨‹ B å®é™…å¹¶æ²¡æœ‰è¢«ä¸­æ–­ï¼Œä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚
* `boolean isInterrupted()`
  æ–¹æ³•ï¼š æ£€æµ‹å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ã€‚
* `boolean interrupted()`
  æ–¹æ³•ï¼š æ£€æµ‹å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ï¼Œä¸ isInterrupted ä¸åŒçš„æ˜¯ï¼Œè¯¥æ–¹æ³•å¦‚æœå‘ç°å½“å‰çº¿ç¨‹è¢«ä¸­æ–­ï¼Œåˆ™ä¼šæ¸…é™¤ä¸­æ–­æ ‡å¿—ã€‚

ä¸ºäº†å“åº”ä¸­æ–­ï¼Œçº¿ç¨‹çš„æ‰§è¡Œä»£ç åº”è¯¥è¿™æ ·ç¼–å†™ï¼š

```java
public void run() {
    try {
        while (!Thread.currentThread().isInterrupted()) {
            // æ‰§è¡Œä»»åŠ¡
        }
    } catch (InterruptedException e) {
        // çº¿ç¨‹è¢«ä¸­æ–­æ—¶çš„æ¸…ç†ä»£ç 
    } finally {
        // çº¿ç¨‹ç»“æŸå‰çš„æ¸…ç†ä»£ç 
    }
}

```

stop æ–¹æ³•ç”¨æ¥å¼ºåˆ¶çº¿ç¨‹åœæ­¢æ‰§è¡Œï¼Œç›®å‰å·²ç»å¤„äºåºŸå¼ƒçŠ¶æ€ï¼Œå› ä¸º stop æ–¹æ³•ä¼šå¯¼è‡´çº¿ç¨‹ç«‹å³åœæ­¢ï¼Œå¯èƒ½ä¼šåœ¨ä¸ä¸€è‡´çš„çŠ¶æ€ä¸‹é‡Šæ”¾é”ï¼Œç ´åå¯¹è±¡çš„ä¸€è‡´æ€§ï¼Œå¯¼è‡´éš¾ä»¥å‘ç°çš„é”™è¯¯å’Œèµ„æºæ³„æ¼ã€‚

![](https://i-blog.csdnimg.cn/img_convert/8c3fd1f1bbe2adca1f761fce67bb14ea.png)

#### 6.çº¿ç¨‹æœ‰å‡ ç§çŠ¶æ€ï¼Ÿ

åœ¨ Java ä¸­ï¼Œçº¿ç¨‹å…±æœ‰ 6 ç§çŠ¶æ€ï¼š

| çŠ¶æ€ | è¯´æ˜ |
| --- | --- |
| NEW | å½“çº¿ç¨‹è¢«åˆ›å»ºåï¼Œå¦‚é€šè¿‡ `new Thread()` ï¼Œå®ƒå¤„äºæ–°å»ºçŠ¶æ€ã€‚æ­¤æ—¶ï¼Œçº¿ç¨‹å·²ç»è¢«åˆ†é…äº†å¿…è¦çš„èµ„æºï¼Œä½†è¿˜æ²¡æœ‰å¼€å§‹æ‰§è¡Œã€‚ |
| RUNNABLE | å½“è°ƒç”¨çº¿ç¨‹çš„ `start()` æ–¹æ³•åï¼Œçº¿ç¨‹è¿›å…¥å¯è¿è¡ŒçŠ¶æ€ã€‚åœ¨è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹å¯èƒ½æ­£åœ¨è¿è¡Œä¹Ÿå¯èƒ½æ­£åœ¨ç­‰å¾…è·å– CPU æ—¶é—´ç‰‡ï¼Œå…·ä½“å–å†³äºçº¿ç¨‹è°ƒåº¦å™¨çš„è°ƒåº¦ç­–ç•¥ã€‚ |
| BLOCKED | çº¿ç¨‹åœ¨è¯•å›¾è·å–ä¸€ä¸ªé”ä»¥è¿›å…¥åŒæ­¥å—/æ–¹æ³•æ—¶ï¼Œå¦‚æœé”è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œçº¿ç¨‹å°†è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°å®ƒè·å–åˆ°é”ã€‚ |
| WAITING | çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€æ˜¯å› ä¸ºè°ƒç”¨äº†å¦‚ä¸‹æ–¹æ³•ä¹‹ä¸€ï¼š `Object.wait()` æˆ– `LockSupport.park()` ã€‚åœ¨ç­‰å¾…çŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹éœ€è¦å…¶ä»–çº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œå¦åˆ™ä¸ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚ |
| TIME\_WAITING | å½“çº¿ç¨‹è°ƒç”¨å¸¦æœ‰è¶…æ—¶å‚æ•°çš„æ–¹æ³•æ—¶ï¼Œå¦‚ `Thread.sleep(long millis)` ã€ `Object.wait(long timeout)` æˆ– `LockSupport.parkNanos()` ï¼Œå®ƒå°†è¿›å…¥è¶…æ—¶ç­‰å¾…çŠ¶æ€ã€‚çº¿ç¨‹åœ¨æŒ‡å®šçš„ç­‰å¾…æ—¶é—´è¿‡åä¼šè‡ªåŠ¨è¿”å›å¯è¿è¡ŒçŠ¶æ€ã€‚ |
| TERMINATED | å½“çº¿ç¨‹çš„ `run()` æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œæˆ–è€…å› ä¸ºä¸€ä¸ªæœªæ•è·çš„å¼‚å¸¸ç»ˆæ­¢äº†æ‰§è¡Œï¼Œçº¿ç¨‹è¿›å…¥ç»ˆæ­¢çŠ¶æ€ã€‚ä¸€æ—¦çº¿ç¨‹ç»ˆæ­¢ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œä¸èƒ½å†è¢«é‡æ–°å¯åŠ¨ã€‚ |

ä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥åˆ†ä¸ºäº”ä¸ªä¸»è¦é˜¶æ®µï¼šæ–°å»ºã€å¯è¿è¡Œã€è¿è¡Œä¸­ã€é˜»å¡/ç­‰å¾…ã€å’Œç»ˆæ­¢ã€‚çº¿ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šæ ¹æ®çŠ¶æ€çš„å˜åŒ–åœ¨è¿™äº›é˜¶æ®µä¹‹é—´åˆ‡æ¢ã€‚ï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/49a271234c184f2195901f4929779373.png)

#### 7.ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ

ä½¿ç”¨å¤šçº¿ç¨‹çš„ç›®çš„æ˜¯ä¸ºäº†å……åˆ†åˆ©ç”¨ CPUï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œå¹¶å‘å…¶å®æ˜¯ä¸€ä¸ª CPU æ¥åº”ä»˜å¤šä¸ªçº¿ç¨‹ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šçº¿ç¨‹åˆ‡æ¢](https://i-blog.csdnimg.cn/img_convert/7b1563523072965b20184bc4943f9563.png)

ä¸ºäº†è®©ç”¨æˆ·æ„Ÿè§‰å¤šä¸ªçº¿ç¨‹æ˜¯åœ¨åŒæ—¶æ‰§è¡Œçš„ï¼Œ CPU èµ„æºçš„åˆ†é…é‡‡ç”¨äº†æ—¶é—´ç‰‡è½®è½¬ä¹Ÿå°±æ˜¯ç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œçº¿ç¨‹åœ¨æ—¶é—´ç‰‡å†…å ç”¨ CPU æ‰§è¡Œä»»åŠ¡ã€‚å½“çº¿ç¨‹ä½¿ç”¨å®Œæ—¶é—´ç‰‡åï¼Œå°±ä¼šå¤„äºå°±ç»ªçŠ¶æ€å¹¶è®©å‡º CPU è®©å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œè¿™å°±æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶æœº](https://i-blog.csdnimg.cn/img_convert/ca5409af06acd55a5b40597662b0b560.png)

##### çº¿ç¨‹å¯ä»¥è¢«å¤šæ ¸è°ƒåº¦å—ï¼Ÿ

å½“ç„¶å¯ä»¥ï¼Œåœ¨ç°ä»£æ“ä½œç³»ç»Ÿå’Œå¤šæ ¸å¤„ç†å™¨çš„ç¯å¢ƒä¸­ï¼Œçº¿ç¨‹çš„è°ƒåº¦å’Œç®¡ç†æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸çš„é‡è¦èŒè´£ä¹‹ä¸€ã€‚

æ“ä½œç³»ç»Ÿçš„è°ƒåº¦å™¨è´Ÿè´£å°†çº¿ç¨‹åˆ†é…ç»™å¯ç”¨çš„ CPU æ ¸å¿ƒï¼Œä»è€Œå®ç°å¹¶è¡Œå¤„ç†ã€‚

å¤šæ ¸å¤„ç†å™¨æä¾›äº†å¹¶è¡Œæ‰§è¡Œå¤šä¸ªçº¿ç¨‹çš„èƒ½åŠ›ã€‚æ¯ä¸ªæ ¸å¿ƒå¯ä»¥ç‹¬ç«‹æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ï¼Œæ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨ä¼šæ ¹æ®ç­–ç•¥å’Œç®—æ³•ï¼Œå¦‚ä¼˜å…ˆçº§è°ƒåº¦ã€è½®è½¬è°ƒåº¦ç­‰ï¼Œå†³å®šå“ªä¸ªçº¿ç¨‹ä½•æ—¶åœ¨å“ªä¸ªæ ¸å¿ƒä¸Šè¿è¡Œã€‚

#### 8.å®ˆæŠ¤çº¿ç¨‹äº†è§£å—ï¼Ÿ

Java ä¸­çš„çº¿ç¨‹åˆ†ä¸ºä¸¤ç±»ï¼Œåˆ†åˆ«ä¸º daemon çº¿ç¨‹ï¼ˆå®ˆæŠ¤çº¿ç¨‹ï¼‰å’Œ user çº¿ç¨‹ï¼ˆç”¨æˆ·çº¿ç¨‹ï¼‰ã€‚

åœ¨ JVM å¯åŠ¨æ—¶ä¼šè°ƒç”¨ main æ–¹æ³•ï¼Œmain æ–¹æ³•æ‰€åœ¨çš„çº¿ç¨‹å°±æ˜¯ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹ã€‚å…¶å®åœ¨ JVM å†…éƒ¨åŒæ—¶è¿˜å¯åŠ¨äº†å¾ˆå¤šå®ˆæŠ¤çº¿ç¨‹ï¼Œ æ¯”å¦‚åƒåœ¾å›æ”¶çº¿ç¨‹ã€‚

é‚£ä¹ˆå®ˆæŠ¤çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼ŸåŒºåˆ«ä¹‹ä¸€æ˜¯å½“æœ€åä¸€ä¸ªéå®ˆæŠ¤çº¿ç¨‹æŸæ—¶ï¼Œ JVM ä¼šæ­£å¸¸é€€å‡ºï¼Œè€Œä¸ç®¡å½“å‰æ˜¯å¦å­˜åœ¨å®ˆæŠ¤çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´å®ˆæŠ¤çº¿ç¨‹æ˜¯å¦ç»“æŸå¹¶ä¸å½±å“ JVM é€€å‡ºã€‚æ¢è€Œè¨€ä¹‹ï¼Œåªè¦æœ‰ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹è¿˜æ²¡ç»“æŸï¼Œæ­£å¸¸æƒ…å†µä¸‹ JVM å°±ä¸ä¼šé€€å‡ºã€‚

#### 9.çº¿ç¨‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼ï¼Ÿ

çº¿ç¨‹ä¹‹é—´ä¼ é€’ä¿¡æ¯æœ‰å¤šç§æ–¹å¼ï¼Œæ¯”å¦‚è¯´ä½¿ç”¨å…±äº«å¯¹è±¡ã€
`wait()`
å’Œ
`notify()`
æ–¹æ³•ã€Exchanger å’Œ CompletableFutureã€‚

â‘ ã€
**ä½¿ç”¨å…±äº«å¯¹è±¡**
ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®å’Œä¿®æ”¹åŒä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œå®ç°ä¿¡æ¯çš„ä¼ é€’ï¼Œæ¯”å¦‚è¯´ volatile å’Œ synchronized å…³é”®å­—ã€‚

```java
public class SharedObject {
    private String message;
    private boolean hasMessage = false;

    public synchronized void writeMessage(String message) {
        while (hasMessage) {
            try {
                wait();
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }
        this.message = message;
        hasMessage = true;
        notifyAll();
    }

    public synchronized String readMessage() {
        while (!hasMessage) {
            try {
                wait();
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }
        hasMessage = false;
        notifyAll();
        return message;
    }
}

public class Main {
    public static void main(String[] args) {
        SharedObject sharedObject = new SharedObject();

        Thread writer = new Thread(() -> {
            sharedObject.writeMessage("Hello from Writer!");
        });

        Thread reader = new Thread(() -> {
            String message = sharedObject.readMessage();
            System.out.println("Reader received: " + message);
        });

        writer.start();
        reader.start();
    }
}

```

â‘¡ã€
**ä½¿ç”¨ wait() å’Œ notify()**
ï¼Œä¾‹å¦‚ï¼Œç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ä¸­ï¼Œç”Ÿäº§è€…ç”Ÿäº§æ•°æ®ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®ï¼Œé€šè¿‡
`wait()`
å’Œ
`notify()`
æ–¹æ³•å¯ä»¥å®ç°ç”Ÿäº§å’Œæ¶ˆè´¹çš„åè°ƒã€‚

ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨å…±äº«å¯¹è±¡çš„
`wait()`
æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè¿›å…¥è¯¥å¯¹è±¡çš„ç­‰å¾…æ± ï¼Œå¹¶é‡Šæ”¾å·²ç»æŒæœ‰çš„è¯¥å¯¹è±¡çš„é”ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚

ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨å…±äº«å¯¹è±¡çš„
`notify()`
æ–¹æ³•æ—¶ï¼Œå®ƒä¼šå”¤é†’åœ¨è¯¥å¯¹è±¡ç­‰å¾…æ± ä¸­ç­‰å¾…çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œä½¿å…¶è¿›å…¥é”æ± ï¼Œç­‰å¾…è·å–é”ã€‚

**Condition**
ä¹Ÿæä¾›äº†ç±»ä¼¼çš„æ–¹æ³•ï¼Œ
`await()`
è´Ÿè´£ç­‰å¾…ã€
`signal()`
å’Œ
`signalAll()`
è´Ÿè´£é€šçŸ¥ã€‚

é€šå¸¸ä¸é”ï¼ˆç‰¹åˆ«æ˜¯
**ReentrantLock**
ï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œä¸ºçº¿ç¨‹æä¾›äº†ä¸€ç§ç­‰å¾…æŸä¸ªæ¡ä»¶æˆçœŸçš„æœºåˆ¶ï¼Œå¹¶å…è®¸å…¶ä»–çº¿ç¨‹åœ¨è¯¥æ¡ä»¶å˜åŒ–æ—¶é€šçŸ¥ç­‰å¾…çº¿ç¨‹ã€‚æ›´çµæ´»ã€æ›´å¼ºå¤§ã€‚

```java
class MessageBox {
    private String message;
    private boolean empty = true;

    public synchronized void produce(String message) {
        while (!empty) {
            try {
                wait();
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }
        empty = false;
        this.message = message;
        notifyAll();
    }

    public synchronized String consume() {
        while (empty) {
            try {
                wait();
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }
        empty = true;
        notifyAll();
        return message;
    }
}

public class Main {
    public static void main(String[] args) {
        MessageBox box = new MessageBox();

        Thread producer = new Thread(() -> {
            box.produce("Message from producer");
        });

        Thread consumer = new Thread(() -> {
            String message = box.consume();
            System.out.println("Consumer received: " + message);
        });

        producer.start();
        consumer.start();
    }
}

```

â‘¢ã€
**ä½¿ç”¨ Exchanger**
ï¼ŒExchanger æ˜¯ä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œå¯ä»¥åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´äº¤æ¢æ•°æ®ã€‚ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨
`exchange()`
æ–¹æ³•ï¼Œå°†æ•°æ®ä¼ é€’ç»™å¦ä¸€ä¸ªçº¿ç¨‹ï¼ŒåŒæ—¶æ¥æ”¶å¦ä¸€ä¸ªçº¿ç¨‹çš„æ•°æ®ã€‚

```java
class Main {
    public static void main(String[] args) {
        Exchanger<String> exchanger = new Exchanger<>();

        Thread thread1 = new Thread(() -> {
            try {
                String message = "Message from thread1";
                String response = exchanger.exchange(message);
                System.out.println("Thread1 received: " + response);
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        });

        Thread thread2 = new Thread(() -> {
            try {
                String message = "Message from thread2";
                String response = exchanger.exchange(message);
                System.out.println("Thread2 received: " + response);
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        });

        thread1.start();
        thread2.start();
    }
}

```

â‘£ã€
**ä½¿ç”¨ CompletableFuture**
ï¼ŒCompletableFuture æ˜¯ Java 8 å¼•å…¥çš„ä¸€ä¸ªç±»ï¼Œæ”¯æŒå¼‚æ­¥ç¼–ç¨‹ï¼Œå…è®¸çº¿ç¨‹åœ¨å®Œæˆè®¡ç®—åå°†ç»“æœä¼ é€’ç»™å…¶ä»–çº¿ç¨‹ã€‚

```java
class Main {
    public static void main(String[] args) {
        CompletableFuture<String> future = CompletableFuture.supplyAsync(() -> {
            // æ¨¡æ‹Ÿé•¿æ—¶é—´è®¡ç®—
            return "Message from CompletableFuture";
        });

        future.thenAccept(message -> {
            System.out.println("Received: " + message);
        });
    }
}

```

#### 10.è¯·è¯´è¯´ sleep å’Œ wait çš„åŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰

> 2024 å¹´ 03 æœˆ 21 æ—¥å¢è¡¥

sleep ä¼šè®©å½“å‰çº¿ç¨‹ä¼‘çœ ï¼Œä¸æ¶‰åŠå¯¹è±¡ç±»ï¼Œä¹Ÿä¸éœ€è¦è·å–å¯¹è±¡çš„é”ï¼Œå±äº Thread ç±»çš„æ–¹æ³•ï¼›wait ä¼šè®©è·å¾—å¯¹è±¡é”çš„çº¿ç¨‹å®ç°ç­‰å¾…ï¼Œè¦æå‰è·å¾—å¯¹è±¡çš„é”ï¼Œå±äº Object ç±»çš„æ–¹æ³•ã€‚

å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š

â‘ ã€æ‰€å±ç±»ä¸åŒ

* `sleep()`
  æ–¹æ³•ä¸“å±äº
  `Thread`
  ç±»ã€‚
* `wait()`
  æ–¹æ³•ä¸“å±äº
  `Object`
  ç±»ã€‚

â‘¡ã€é”è¡Œä¸ºä¸åŒ

å½“çº¿ç¨‹æ‰§è¡Œ sleep æ–¹æ³•æ—¶ï¼Œå®ƒä¸ä¼šé‡Šæ”¾ä»»ä½•é”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰æŸä¸ªå¯¹è±¡çš„é”æ—¶è°ƒç”¨äº† sleepï¼Œå®ƒåœ¨ç¡çœ æœŸé—´ä»ç„¶ä¼šæŒæœ‰è¿™ä¸ªé”ã€‚

```java
class SleepDoesNotReleaseLock {

    private static final Object lock = new Object();

    public static void main(String[] args) throws InterruptedException {
        Thread sleepingThread = new Thread(() -> {
            synchronized (lock) {
                System.out.println("Thread 1 ä¼šç»§ç»­æŒæœ‰é”ï¼Œå¹¶ä¸”è¿›å…¥ç¡çœ çŠ¶æ€");
                try {
                    Thread.sleep(5000);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                System.out.println("Thread 1 é†’æ¥äº†ï¼Œå¹¶ä¸”é‡Šæ”¾äº†é”");
            }
        });

        Thread waitingThread = new Thread(() -> {
            synchronized (lock) {
                System.out.println("Thread 2 è¿›å…¥åŒæ­¥ä»£ç å—");
            }
        });

        sleepingThread.start();
        Thread.sleep(1000);
        waitingThread.start();
    }
}

```

è¾“å‡ºç»“æœï¼š

```
Thread 1 ä¼šç»§ç»­æŒæœ‰é”ï¼Œå¹¶ä¸”è¿›å…¥ç¡çœ çŠ¶æ€
Thread 1 é†’æ¥äº†ï¼Œå¹¶ä¸”é‡Šæ”¾äº†é”
Thread 2 è¿›å…¥åŒæ­¥ä»£ç å—

```

ä»è¾“å‡ºä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒwaitingThread å¿…é¡»ç­‰å¾… sleepingThread å®Œæˆç¡çœ åæ‰èƒ½è¿›å…¥åŒæ­¥ä»£ç å—ã€‚

è€Œå½“çº¿ç¨‹æ‰§è¡Œ wait æ–¹æ³•æ—¶ï¼Œå®ƒä¼šé‡Šæ”¾å®ƒæŒæœ‰çš„é‚£ä¸ªå¯¹è±¡çš„é”ï¼Œè¿™ä½¿å¾—å…¶ä»–çº¿ç¨‹å¯ä»¥æœ‰æœºä¼šè·å–è¯¥å¯¹è±¡çš„é”ã€‚

```java
class WaitReleasesLock {

    private static final Object lock = new Object();

    public static void main(String[] args) throws InterruptedException {
        Thread waitingThread = new Thread(() -> {
            synchronized (lock) {
                try {
                    System.out.println("Thread 1 æŒæœ‰é”ï¼Œå‡†å¤‡ç­‰å¾… 5 ç§’");
                    lock.wait(5000);
                    System.out.println("Thread 1 é†’æ¥äº†ï¼Œå¹¶ä¸”é€€å‡ºåŒæ­¥ä»£ç å—");
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        });

        Thread notifyingThread = new Thread(() -> {
            synchronized (lock) {
                System.out.println("Thread 2 å°è¯•å”¤é†’ç­‰å¾…ä¸­çš„çº¿ç¨‹");
                lock.notify();
                System.out.println("Thread 2 æ‰§è¡Œå®Œäº† notify");
            }
        });

        waitingThread.start();
        Thread.sleep(1000);
        notifyingThread.start();
    }
}

```

è¾“å‡ºç»“æœï¼š

```
Thread 1 æŒæœ‰é”ï¼Œå‡†å¤‡ç­‰å¾… 5 ç§’
Thread 2 å°è¯•å”¤é†’ç­‰å¾…ä¸­çš„çº¿ç¨‹
Thread 2 æ‰§è¡Œå®Œäº† notify
Thread 1 é†’æ¥äº†ï¼Œå¹¶ä¸”é€€å‡ºåŒæ­¥ä»£ç å—

```

è¿™è¡¨æ˜ waitingThread åœ¨è°ƒç”¨ wait åç¡®å®é‡Šæ”¾äº†é”ã€‚

â‘¢ã€ä½¿ç”¨æ¡ä»¶ä¸åŒ

* `sleep()`
  æ–¹æ³•å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¢«è°ƒç”¨ã€‚
* `wait()`
  æ–¹æ³•å¿…é¡»åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼Œè¿™æ˜¯å› ä¸ºè°ƒç”¨
  `wait()`
  æ–¹æ³•çš„å‰ææ˜¯å½“å‰çº¿ç¨‹å¿…é¡»æŒæœ‰å¯¹è±¡çš„é”ã€‚å¦åˆ™ä¼šæŠ›å‡º
  `IllegalMonitorStateException`
  å¼‚å¸¸ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šwait æ–¹æ³•å¿…é¡»åœ¨åŒæ­¥ä»£ç å—ä¸­è°ƒç”¨](https://i-blog.csdnimg.cn/img_convert/3619e2cde0d6eaf07b65cffcb31e13d8.png)

â‘£ã€å”¤é†’æ–¹å¼ä¸åŒ

* è°ƒç”¨ sleep æ–¹æ³•åï¼Œçº¿ç¨‹ä¼šè¿›å…¥ TIMED\_WAITING çŠ¶æ€ï¼ˆå®šæ—¶ç­‰å¾…çŠ¶æ€ï¼‰ï¼Œå³åœ¨æŒ‡å®šçš„æ—¶é—´å†…æš‚åœæ‰§è¡Œã€‚å½“æŒ‡å®šçš„æ—¶é—´ç»“æŸåï¼Œçº¿ç¨‹ä¼šè‡ªåŠ¨æ¢å¤åˆ° RUNNABLE çŠ¶æ€ï¼ˆå°±ç»ªçŠ¶æ€ï¼‰ï¼Œç­‰å¾… CPU è°ƒåº¦å†æ¬¡æ‰§è¡Œã€‚
* è°ƒç”¨ wait æ–¹æ³•åï¼Œçº¿ç¨‹ä¼šè¿›å…¥ WAITING çŠ¶æ€ï¼ˆæ— é™æœŸç­‰å¾…çŠ¶æ€ï¼‰ï¼Œç›´åˆ°æœ‰å…¶ä»–çº¿ç¨‹åœ¨åŒä¸€å¯¹è±¡ä¸Šè°ƒç”¨ notify æˆ– notifyAllï¼Œçº¿ç¨‹æ‰ä¼šä» WAITING çŠ¶æ€è½¬å˜ä¸º RUNNABLE çŠ¶æ€ï¼Œå‡†å¤‡å†æ¬¡è·å¾— CPU çš„æ‰§è¡Œæƒã€‚

â‘¤ã€æŠ›å‡ºå¼‚å¸¸ä¸åŒ

* `sleep()`
  æ–¹æ³•åœ¨ç­‰å¾…æœŸé—´ï¼Œå¦‚æœçº¿ç¨‹è¢«ä¸­æ–­ï¼Œä¼šæŠ›å‡º
  `InterruptedException`
  ã€‚
* å¦‚æœçº¿ç¨‹è¢«ä¸­æ–­æˆ–ç­‰å¾…æ—¶é—´åˆ°æœŸæ—¶ï¼Œ
  `wait()`
  æ–¹æ³•åŒæ ·ä¼šåœ¨ç­‰å¾…æœŸé—´æŠ›å‡º
  `InterruptedException`
  ã€‚

æˆ‘ä»¬æ¥é€šè¿‡ä»£ç å†æ„Ÿå—ä¸€ä¸‹
`sleep()`
å’Œ
`wait()`
åœ¨ç”¨æ³•ä¸Šçš„åŒºåˆ«ï¼Œå…ˆçœ‹
`sleep()`
çš„ç”¨æ³•ï¼š

```java
class SleepExample {
    public static void main(String[] args) {
        Thread thread = new Thread(() -> {
            System.out.println("çº¿ç¨‹å‡†å¤‡ä¼‘çœ  2 ç§’");
            try {
                Thread.sleep(2000); // çº¿ç¨‹å°†ç¡çœ 2ç§’
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            System.out.println("çº¿ç¨‹é†’æ¥äº†");
        });

        thread.start();
    }
}

```

å†æ¥çœ‹
`wait()`
çš„ç”¨æ³•ï¼š

```java
class WaitExample {
    public static void main(String[] args) {
        final Object lock = new Object();

        Thread thread = new Thread(() -> {
            synchronized (lock) {
                try {
                    System.out.println("çº¿ç¨‹å‡†å¤‡ç­‰å¾… 2 ç§’");
                    lock.wait(2000); // çº¿ç¨‹ä¼šç­‰å¾…2ç§’ï¼Œæˆ–è€…ç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨ lock.notify()/notifyAll()
                    System.out.println("çº¿ç¨‹ç»“æŸç­‰å¾…");
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        });

        thread.start();
    }
}

```

#### 11.æ€ä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿï¼ˆè¡¥å……ï¼‰

> 2024 å¹´ 05 æœˆ 01 æ—¥å¢è¡¥

å¤šçº¿ç¨‹å®‰å…¨æ˜¯æŒ‡åœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œç¨‹åºèƒ½å¤Ÿæ­£ç¡®åœ°æ‰§è¡Œï¼Œè€Œä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æˆ–ç«äº‰æ¡ä»¶ç­‰é—®é¢˜ã€‚åä¹‹ï¼Œå¦‚æœç¨‹åºå‡ºç°äº†æ•°æ®ä¸ä¸€è‡´ã€æ­»é”ã€é¥¥é¥¿ç­‰é—®é¢˜ï¼Œå°±ç§°ä¸ºçº¿ç¨‹ä¸å®‰å…¨ã€‚

ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨
`synchronized`
å…³é”®å­—æˆ– ReentrantLock æ¥ä¿è¯å…±äº«èµ„æºçš„äº’æ–¥è®¿é—®ã€‚

å¯¹äºç®€å•çš„å˜é‡æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ Atomic ç±»æ¥å®ç°æ— é”çº¿ç¨‹å®‰å…¨ã€‚

å¯ä»¥ä½¿ç”¨çº¿ç¨‹å®‰å…¨å®¹å™¨ï¼Œå¦‚
`ConcurrentHashMap`
æˆ–
`CopyOnWriteArrayList`
ã€‚

å¯¹äºæ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ ThreadLocal æ¥ä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ã€‚

å¯¹äºç®€å•çš„çŠ¶æ€æ ‡å¿—ï¼Œå¯ä»¥ä½¿ç”¨ volatile å…³é”®å­—ç¡®ä¿å¤šçº¿ç¨‹é—´çš„å¯è§æ€§ã€‚

##### æœ‰ä¸ªintçš„å˜é‡ä¸º0ï¼Œåä¸ªçº¿ç¨‹è½®æµå¯¹å…¶è¿›è¡Œ++æ“ä½œï¼ˆå¾ªç¯10000æ¬¡ï¼‰ï¼Œç»“æœæ˜¯å¤§äºå°äºè¿˜æ˜¯ç­‰äº10ä¸‡ï¼Œä¸ºä»€ä¹ˆï¼Ÿ

åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæœ€ç»ˆçš„ç»“æœä¼šå°äº 100000ï¼ŒåŸå› åœ¨äºå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œ++ æ“ä½œä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

int++ å®é™…ä¸Šå¯ä»¥åˆ†è§£ä¸ºä¸‰æ­¥ï¼š

1. è¯»å–å˜é‡çš„å€¼ã€‚
2. å°†è¯»å–åˆ°çš„å€¼åŠ  1ã€‚
3. å°†ç»“æœå†™å›å˜é‡ã€‚

å¤šä¸ªçº¿ç¨‹åœ¨å¹¶å‘æ‰§è¡Œ ++ æ“ä½œæ—¶ï¼Œå¯èƒ½å‡ºç°ä»¥ä¸‹ç«æ€æ¡ä»¶ï¼š

* çº¿ç¨‹ 1 è¯»å–å˜é‡å€¼ä¸º 0ã€‚
* çº¿ç¨‹ 2 ä¹Ÿè¯»å–å˜é‡å€¼ä¸º 0ã€‚
* çº¿ç¨‹ 1 è¿›è¡ŒåŠ æ³•è¿ç®—å¹¶å°†ç»“æœ 1 å†™å›å˜é‡ã€‚
* çº¿ç¨‹ 2 è¿›è¡ŒåŠ æ³•è¿ç®—å¹¶å°†ç»“æœ 1 å†™å›å˜é‡ï¼Œè¦†ç›–äº†çº¿ç¨‹ 1 çš„ç»“æœã€‚

å¯ä»¥é€šè¿‡ synchronized æˆ– AtomicInteger å®ç°çº¿ç¨‹å®‰å…¨ã€‚

##### åœºæ™¯:æœ‰ä¸€ä¸ª key å¯¹åº”çš„ value æ˜¯ä¸€ä¸ªjson ç»“æ„ï¼Œjson å½“ä¸­æœ‰å¥½å‡ ä¸ªå­ä»»åŠ¡ï¼Œè¿™äº›å­ä»»åŠ¡å¦‚æœå¯¹ key è¿›è¡Œä¿®æ”¹çš„è¯,ä¼šä¸ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨çš„é—®é¢˜?å¦‚ä½•è§£å†³?å¦‚æœæ˜¯å¤šä¸ªèŠ‚ç‚¹çš„æƒ…å†µï¼Œåº”è¯¥æ€ä¹ˆåŠ é”?

ä¼šã€‚

åœ¨å•èŠ‚ç‚¹ç¯å¢ƒä¸­ï¼Œå¯ä»¥ä½¿ç”¨ synchronized å…³é”®å­—æˆ– ReentrantLock æ¥ä¿è¯å¯¹ key çš„ä¿®æ”¹æ“ä½œæ˜¯åŸå­çš„ã€‚

```java
class KeyManager {
    private final ReentrantLock lock = new ReentrantLock();

    private String key = "{\"tasks\": [\"task1\", \"task2\"]}";

    public String readKey() {
        lock.lock();
        try {
            return key;
        } finally {
            lock.unlock();
        }
    }

    public void updateKey(String newKey) {
        lock.lock();
        try {
            this.key = newKey;
        } finally {
            lock.unlock();
        }
    }
}

```

åœ¨å¤šèŠ‚ç‚¹ç¯å¢ƒä¸­ï¼Œå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼é” Redisson æ¥ä¿è¯å¯¹ key çš„ä¿®æ”¹æ“ä½œæ˜¯åŸå­çš„ã€‚

```java
class DistributedKeyManager {
    private final RedissonClient redisson;

    public DistributedKeyManager() {
        Config config = new Config();
        config.useSingleServer().setAddress("redis://127.0.0.1:6379");
        this.redisson = Redisson.create(config);
    }

    public void updateKey(String key, String newValue) {
        RLock lock = redisson.getLock(key);
        lock.lock();
        try {
            // æ¨¡æ‹Ÿè¯»å–å’Œæ›´æ–°æ“ä½œ
            String currentValue = readFromDatabase(key); // å‡è®¾è¯»å– JSON æ•°æ®
            String updatedValue = modifyJson(currentValue, newValue); // ä¿®æ”¹ JSON
            writeToDatabase(key, updatedValue); // å†™å›æ•°æ®åº“
        } finally {
            lock.unlock();
        }
    }

    private String readFromDatabase(String key) {
        // æ¨¡æ‹Ÿä»æ•°æ®åº“è¯»å–
        return "{\"tasks\": [\"task1\", \"task2\"]}";
    }

    private String modifyJson(String json, String newValue) {
        // ä½¿ç”¨ JSON åº“è§£æå¹¶ä¿®æ”¹
        return json.replace("task1", newValue);
    }

    private void writeToDatabase(String key, String value) {
        // æ¨¡æ‹Ÿå†™å›æ•°æ®åº“
    }
}

```

##### è¯´ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ

ä¸€ä¸ªå¸¸è§çš„ä½¿ç”¨åœºæ™¯æ˜¯åœ¨å®ç°å•ä¾‹æ¨¡å¼æ—¶ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚

å•ä¾‹æ¨¡å¼ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶å°è¯•åˆ›å»ºå®ä¾‹ï¼Œå•ä¾‹ç±»å¿…é¡»ç¡®ä¿åªåˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚

é¥¿æ±‰å¼æ˜¯ä¸€ç§æ¯”è¾ƒç›´æ¥çš„å®ç°æ–¹å¼ï¼Œå®ƒé€šè¿‡åœ¨ç±»åŠ è½½æ—¶å°±ç«‹å³åˆå§‹åŒ–å•ä¾‹å¯¹è±¡æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚

```java
class Singleton {
    private static final Singleton instance = new Singleton();

    private Singleton() {
    }

    public static Singleton getInstance() {
        return instance;
    }
}

```

æ‡’æ±‰å¼å•ä¾‹åˆ™åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶åˆå§‹åŒ–ï¼Œè¿™ç§æ–¹å¼éœ€è¦ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šæ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œvolatile ç”¨æ¥ä¿è¯å¯è§æ€§ï¼Œsyncronized ç”¨æ¥ä¿è¯åŒæ­¥ã€‚

```java
public class LazySingleton {
    private static volatile LazySingleton instance;

    private LazySingleton() {}

    public static LazySingleton getInstance() {
        if (instance == null) { // ç¬¬ä¸€æ¬¡æ£€æŸ¥
            synchronized (LazySingleton.class) {
                if (instance == null) { // ç¬¬äºŒæ¬¡æ£€æŸ¥
                    instance = new LazySingleton();
                }
            }
        }
        return instance;
    }
}

```

##### èƒ½è¯´ä¸€ä¸‹ Hashtable æ•°æ®ç»“æ„åº•å±‚å—ï¼Ÿ

ä¸ HashMap ç±»ä¼¼ï¼ŒHashtable çš„åº•å±‚æ•°æ®ç»“æ„ä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„åŠ ä¸Šé“¾è¡¨çš„æ–¹å¼ï¼Œç„¶åé€šè¿‡ synchronized åŠ é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚

![Hashtableæºç ](https://i-blog.csdnimg.cn/img_convert/b67efdab60e6d681b74256dcf31192db.png)