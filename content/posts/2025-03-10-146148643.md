---
layout: post
title: "clickhouse集群部署保姆级教程"
date: 2025-03-10 11:26:46 +0800
description: "23.8及之后的版本。"
keywords: "clickhouse集群配置文件"
categories: ['未分类']
tags: ['运维', 'Debian', 'Clickhouse']
artid: "146148643"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146148643
    alt: "clickhouse集群部署保姆级教程"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146148643
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146148643
cover: https://bing.ee123.net/img/rand?artid=146148643
image: https://bing.ee123.net/img/rand?artid=146148643
img: https://bing.ee123.net/img/rand?artid=146148643
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     clickhouse集群部署保姆级教程
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="ClickHouse_1">
     </a>
     ClickHouse安装
    </h2>
    <h3>
     <a id="_2">
     </a>
     版本要求
    </h3>
    <p>
     23.8及之后的版本
    </p>
    <h3>
     <a id="_5">
     </a>
     硬件要求
    </h3>
    <h4>
     <a id="_6">
     </a>
     三台机器
    </h4>
    <h4>
     <a id="_7">
     </a>
     建议配置
    </h4>
    <ul>
     <li>
      磁盘 ssd 500G
     </li>
     <li>
      内存 32g
     </li>
     <li>
      cpu 16c
     </li>
    </ul>
    <h4>
     <a id="_12">
     </a>
     最低配置
    </h4>
    <ul>
     <li>
      磁盘 机械硬盘 50G
     </li>
     <li>
      内存 4g
     </li>
     <li>
      cpu 4c
     </li>
    </ul>
    <h3>
     <a id="_17">
     </a>
     容量规划
    </h3>
    <p>
     一亿条数据大约使用1TB磁盘容量
    </p>
    <p>
     <a href="https://clickhouse.com/docs/en/guides/sizing-and-hardware-recommendations" rel="nofollow">
      参考官方容量推荐
     </a>
    </p>
    <h3>
     <a id="_22">
     </a>
     安装包准备
    </h3>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/8e9ba0c9a7bad07aa015b65a9d320c45.png"/>
    </p>
    <h3>
     <a id="zookeeper_27">
     </a>
     zookeeper安装
    </h3>
    <p>
     zookeeper需要java启动，8版本以上，三台机器都需要执行
    </p>
    <h4>
     <a id="_31">
     </a>
     解压安装：
    </h4>
    <pre><code class="prism language-plain">yum install -y java

tar -zxvf apache-zookeeper-3.5.9-bin.tar.gz -C /app
</code></pre>
    <h4>
     <a id="_38">
     </a>
     配置环境变量：
    </h4>
    <pre><code class="prism language-plain"> vi /etc/profile
</code></pre>
    <p>
     添加我们需要的配置信息：
    </p>
    <p>
     ZOOKEEPER_HOME 为你安装的zookeeper目录
    </p>
    <pre><code class="prism language-plain">export ZOOKEEPER_HOME=/app/apache-zookeeper-3.9.3-bin
export PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$ZOOKEEPER_HOME/bin:$PATH
</code></pre>
    <p>
     检测生效
    </p>
    <pre><code class="prism language-plain">source /etc/profile
echo $ZOOKEEPER_HOME
</code></pre>
    <h4>
     <a id="font_stylecolorrgb77_77_77zookeeperfont_61">
     </a>
     <strong>
      配置zookeeper
     </strong>
    </h4>
    <p>
     创建data目录
    </p>
    <pre><code class="prism language-plain">mkdir /app/apache-zookeeper-3.9.3-bin/data
</code></pre>
    <p>
     修改配置
    </p>
    <pre><code class="prism language-plain">cd /app/apache-zookeeper-3.9.3-bin/conf
cp zoo_sample.cfg zoo.cfg
vim zoo.cfg
</code></pre>
    <pre><code class="prism language-plain">tickTime=2000
initLimit=10
syncLimit=5
dataDir=/app/apache-zookeeper-3.9.3-bin/data
clientPort=2181

server.1=ip1:2888:3888
server.2=ip2:2888:3888
server.3=ip3:2888:3888

</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/bdb5499942cb59f2b31bc3d46978a2cf.png"/>
    </p>
    <h4>
     <a id="font_stylecolorrgb77_77_77idfont_95">
     </a>
     为每台机器配置节点id
    </h4>
    <p>
     在机器一上执行：
    </p>
    <pre><code class="prism language-plain">echo 1 &gt;/app/apache-zookeeper-3.9.3-bin/data/myid
</code></pre>
    <p>
     在机器二上执行：
    </p>
    <pre><code class="prism language-plain">echo 2 &gt;/app/apache-zookeeper-3.9.3-bin/data/myid
</code></pre>
    <p>
     在机器三上执行：
    </p>
    <pre><code class="prism language-plain">echo 3 &gt;/app/apache-zookeeper-3.9.3-bin/data/myid
</code></pre>
    <h4>
     <a id="font_stylecolorrgb77_77_77zookeeperfont_114">
     </a>
     启动zookeeper
    </h4>
    <pre><code class="prism language-plain">cd /app/apache-zookeeper-3.9.3-bin/bin
sh zkServer.sh start

</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/5b2b17eac735173e5a26dbc7eb7c15a8.png"/>
    </p>
    <h4>
     <a id="font_stylecolorrgb77_77_77font_123">
     </a>
     验证
    </h4>
    <p>
     <strong>
      启动成功后可以随便选择一个节点尝试连接另一个节点验证：
     </strong>
    </p>
    <pre><code class="prism language-plain">sh zkCli.sh -server ip:2181
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/506490fae633505986ac5129d4c2e2dc.png"/>
    </p>
    <h3>
     <a id="clickhouse_132">
     </a>
     clickhouse安装
    </h3>
    <h4>
     <a id="cpu_133">
     </a>
     检查cpu指令集是否支持
    </h4>
    <p>
     执行
     <code>
      grep -q sse4_2 /proc/cpuinfo &amp;&amp; echo "SSE 4.2 supported" || echo "SSE 4.2 not supported"
     </code>
     ，返回
     <code>
      SSE 4.2 supported
     </code>
     <br/>
     表示检查通过
    </p>
    <h4>
     <a id="font_stylecolorDF2A3Ffont_137">
     </a>
     数据盘挂载
    </h4>
    <h5>
     <a id="21_138">
     </a>
     2.1.挂载目录
    </h5>
    <p>
     :::info
     <br/>
     clickhouse数据库数据存储目录建议使用挂载目录
    </p>
    <p>
     挂载目录需要客户提供并完成挂载
    </p>
    <p>
     示例挂载命令：mount /dev/sdb1 /app
    </p>
    <p>
     :::
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/9c6a3926eb8cc1995c3d9f1f3d526091.png"/>
    </p>
    <h5>
     <a id="22_150">
     </a>
     2.2.创建数据目录
    </h5>
    <pre><code class="prism language-plain">mkdir -p /app/clickhouse/data
mkdir -p /app/clickhouse/tmp
</code></pre>
    <h5>
     <a id="23_156">
     </a>
     2.3.授予目录权限
    </h5>
    <pre><code class="prism language-plain">chown -R clickhouse:clickhouse /app/clickhouse
chmod 755 /app/clickhouse
</code></pre>
    <h4>
     <a id="_163">
     </a>
     下载安装包
    </h4>
    <p>
     <a href="http://192.168.0.107/clickhouse/rpm" rel="nofollow">
      http://192.168.0.107/clickhouse/rpm
     </a>
    </p>
    <p>
     ![](https://i-blog.csdnimg.cn/img_convert/422adfdebe8ec469fc4dcd422cf8d1cb.png下载最新安装包（推荐最新版本）
    </p>
    <p>
     arm版本使用：
    </p>
    <ul>
     <li>
      clickhouse-common-static-xxx.aarch64.rpm
     </li>
     <li>
      clickhouse-server-xxx.aarch64.rpm
     </li>
     <li>
      clickhouse-client-xxx.aarch64.rpm
     </li>
    </ul>
    <h4>
     <a id="_174">
     </a>
     安装
    </h4>
    <pre><code class="prism language-shell"><span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> clickhouse-common-static-*.rpm clickhouse-server-*.rpm clickhouse-client-*.rpm

<span class="token comment"># 有提示输入账号的直接回车跳过，后续统一处理</span>
</code></pre>
    <h4>
     <a id="clickhouse_181">
     </a>
     clickhouse配置
    </h4>
    <h5>
     <a id="_182">
     </a>
     默认配置
    </h5>
    <p>
     添加配置
     <code>
      /etc/clickhouse-server/config.xml
     </code>
    </p>
    <pre><code class="prism language-plain">vim config.xml

&lt;listen_host&gt;0.0.0.0&lt;/listen_host&gt;
&lt;timezone&gt;Asia/Shanghai&lt;/timezone&gt;

&lt;level&gt;information&lt;/level&gt;
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/df78c8948d2287b92752118e0ad6ed60.png"/>
    </p>
    <h5>
     <a id="font_stylecolorDF2A3Ffont_196">
     </a>
     修改挂载目录（可选，无挂载目录可不用）
    </h5>
    <p>
     修改数据目录
    </p>
    <pre><code class="prism language-plain">vim /etc/clickhouse-server/config.xml
路径改为挂载路径即可
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/2744f0e052304cd8ae427a317c5d780e.png"/>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/a580dc19df7d8ab9dfdbbcadef5d4301.png"/>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/ef5fdde0bcba170ada0c68fff6f409e5.png"/>
    </p>
    <h5>
     <a id="61__210">
     </a>
     6.1 用户管理配置
    </h5>
    <ul>
     <li>
      修改default用户密码为econage123，全部权限，只允许本地登录
     </li>
     <li>
      添加用户user，密码为econage123，读写权限，bpi服务使用
     </li>
     <li>
      添加管理用户admin，密码为econage123，读写权限，ddl权限
     </li>
     <li>
      添加只读用户read，密码为econage123
     </li>
    </ul>
    <p>
     添加
     <code>
      /etc/clickhouse-server/users.d/users.xml
     </code>
     ，自行修改相关密码
    </p>
    <pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>clickhouse</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- See also the files in users.d directory where the settings can be overridden. --&gt;</span>

    <span class="token comment">&lt;!-- Profiles of settings. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profiles</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Default settings. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>default</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>max_bytes_before_external_group_by</span><span class="token punctuation">&gt;</span></span>268435456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>max_bytes_before_external_group_by</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>max_bytes_before_external_sort</span><span class="token punctuation">&gt;</span></span>268435456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>max_bytes_before_external_sort</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>max_download_threads</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>max_download_threads</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input_format_parallel_parsing</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input_format_parallel_parsing</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output_format_parallel_formatting</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output_format_parallel_formatting</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optimize_trivial_insert_select</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optimize_trivial_insert_select</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>default</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!-- Profile that allows only read queries. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>read</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readonly</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>readonly</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>max_bytes_before_external_group_by</span><span class="token punctuation">&gt;</span></span>268435456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>max_bytes_before_external_group_by</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>max_bytes_before_external_sort</span><span class="token punctuation">&gt;</span></span>268435456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>max_bytes_before_external_sort</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>max_download_threads</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>max_download_threads</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input_format_parallel_parsing</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input_format_parallel_parsing</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output_format_parallel_formatting</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output_format_parallel_formatting</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optimize_trivial_insert_select</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optimize_trivial_insert_select</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>read</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>write</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readonly</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>readonly</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>allow_ddl</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>allow_ddl</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>max_bytes_before_external_group_by</span><span class="token punctuation">&gt;</span></span>268435456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>max_bytes_before_external_group_by</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>max_bytes_before_external_sort</span><span class="token punctuation">&gt;</span></span>268435456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>max_bytes_before_external_sort</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>max_download_threads</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>max_download_threads</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input_format_parallel_parsing</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input_format_parallel_parsing</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output_format_parallel_formatting</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output_format_parallel_formatting</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optimize_trivial_insert_select</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optimize_trivial_insert_select</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>write</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profiles</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- Users and ACL. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>users</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>read</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">&gt;</span></span>econage123<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>networks</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ip</span><span class="token punctuation">&gt;</span></span>::/0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ip</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>networks</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">&gt;</span></span>read<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>quota</span><span class="token punctuation">&gt;</span></span>default<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>quota</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>read</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>admin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">&gt;</span></span>econage123<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>networks</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ip</span><span class="token punctuation">&gt;</span></span>::/0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ip</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>networks</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">&gt;</span></span>default<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>quota</span><span class="token punctuation">&gt;</span></span>default<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>quota</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>admin</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">&gt;</span></span>econage123<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>networks</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ip</span><span class="token punctuation">&gt;</span></span>::/0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ip</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>networks</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">&gt;</span></span>write<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>quota</span><span class="token punctuation">&gt;</span></span>default<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>quota</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!-- If user name was not specified, 'default' user is used. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>default</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">&gt;</span></span>econage123<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>networks</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ip</span><span class="token punctuation">&gt;</span></span>::1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ip</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>networks</span><span class="token punctuation">&gt;</span></span>

            <span class="token comment">&lt;!-- Settings profile for user. --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">&gt;</span></span>default<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">&gt;</span></span>

            <span class="token comment">&lt;!-- Quota for user. --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>quota</span><span class="token punctuation">&gt;</span></span>default<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>quota</span><span class="token punctuation">&gt;</span></span>

            <span class="token comment">&lt;!-- User can create other users and grant rights to them. --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>access_management</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>access_management</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>default</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>users</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- Quotas. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>quotas</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Name of quota. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>default</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- Limits for time interval. You could specify many intervals with different limits. --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>interval</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!-- Length of interval. --&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>duration</span><span class="token punctuation">&gt;</span></span>3600<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>duration</span><span class="token punctuation">&gt;</span></span>

                <span class="token comment">&lt;!-- No limits. Just calculate resource usage for time interval. --&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>queries</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>queries</span><span class="token punctuation">&gt;</span></span>

                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>errors</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>errors</span><span class="token punctuation">&gt;</span></span>

                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result_rows</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result_rows</span><span class="token punctuation">&gt;</span></span>

                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>read_rows</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>read_rows</span><span class="token punctuation">&gt;</span></span>

                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution_time</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution_time</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>interval</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>default</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>quotas</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>clickhouse</span><span class="token punctuation">&gt;</span></span>

</code></pre>
    <h4>
     <a id="_376">
     </a>
     启动服务
    </h4>
    <pre><code class="prism language-shell">systemctl start clickhouse-server
或者
clickhouse start
</code></pre>
    <h4>
     <a id="_383">
     </a>
     校验服务
    </h4>
    <pre><code class="prism language-shell"><span class="token function">curl</span> localhost:8123
<span class="token comment">#返回'Ok.'则服务启动正常</span>
clickhouse-client <span class="token parameter variable">--user</span><span class="token operator">=</span>user <span class="token parameter variable">--password</span><span class="token operator">=</span>econage123 <span class="token parameter variable">--host</span><span class="token operator">=</span><span class="token number">192.168</span>.7.18 <span class="token parameter variable">--query</span><span class="token operator">=</span><span class="token string">"select version()"</span>
<span class="token comment">#返回版本号则用户创建正常</span>

clickhouse-client <span class="token parameter variable">--user</span><span class="token operator">=</span>admin <span class="token parameter variable">--password</span><span class="token operator">=</span>econage123 <span class="token parameter variable">--host</span><span class="token operator">=</span><span class="token number">192.168</span>.7.18 <span class="token parameter variable">--query</span><span class="token operator">=</span><span class="token string">"select version()"</span>
<span class="token comment">#返回版本号则用户创建正常</span>
</code></pre>
    <h3>
     <a id="clickhosue_396">
     </a>
     clickhosue集群版本配置
    </h3>
    <p>
     三台机器都需要执行上述clickouse安装步骤
    </p>
    <h5>
     <a id="zookeeper_399">
     </a>
     添加zookeeper配置
    </h5>
    <pre><code class="prism language-plain">vim /etc/clickhouse-server/config.xml
</code></pre>
    <p>
     host是zookeeper的三个地址
    </p>
    <p>
     port默认2181
    </p>
    <pre><code class="prism language-plain">修改配置

&lt;zookeeper&gt;
        &lt;node index="1"&gt;
            &lt;host&gt;192.168.7.141&lt;/host&gt;
            &lt;port&gt;2181&lt;/port&gt;
        &lt;/node&gt;
        &lt;node index="2"&gt;
            &lt;host&gt;192.168.7.142&lt;/host&gt;
            &lt;port&gt;2181&lt;/port&gt;
        &lt;/node&gt;
        &lt;node index="3"&gt;
            &lt;host&gt;192.168.7.143&lt;/host&gt;
            &lt;port&gt;2181&lt;/port&gt;
        &lt;/node&gt;
    &lt;/zookeeper&gt;
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/1a0fdc4bdabab597f97a5806bea58538.png"/>
    </p>
    <h5>
     <a id="_429">
     </a>
     配置分片
    </h5>
    <p>
     host是clickhouse的三个地址
    </p>
    <p>
     port默认9000
    </p>
    <pre><code class="prism language-plain">                &lt;replica&gt;
                    &lt;host&gt;192.168.7.141&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
                &lt;replica&gt;
                    &lt;host&gt;192.168.7.142&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
                &lt;replica&gt;
                    &lt;host&gt;192.168.7.143&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;

</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e91ed7533b7921a47937ee07f12e8837.png"/>
    </p>
    <h5>
     <a id="macros_454">
     </a>
     配置macros
    </h5>
    <p>
     第一台机器
    </p>
    <pre><code class="prism language-plain">    &lt;macros&gt;
        &lt;shard&gt;01&lt;/shard&gt;
        &lt;replica&gt;01&lt;/replica&gt;
    &lt;/macros&gt;
</code></pre>
    <p>
     第二台机器
    </p>
    <pre><code class="prism language-plain">    &lt;macros&gt;
        &lt;shard&gt;01&lt;/shard&gt;
        &lt;replica&gt;02&lt;/replica&gt;
    &lt;/macros&gt;
</code></pre>
    <p>
     第三台机器
    </p>
    <pre><code class="prism language-plain">    &lt;macros&gt;
        &lt;shard&gt;01&lt;/shard&gt;
        &lt;replica&gt;03&lt;/replica&gt;
    &lt;/macros&gt;
</code></pre>
    <h4>
     <a id="_482">
     </a>
     启动服务
    </h4>
    <pre><code class="prism language-shell">systemctl start clickhouse-server
或者
clickhouse start
</code></pre>
    <h4>
     <a id="_489">
     </a>
     验证集群同步
    </h4>
    <p>
     登录任意一台机器
    </p>
    <pre><code class="prism language-plain">clickhouse-client --user admin --password econage123
</code></pre>
    <pre><code class="prism language-plain">select * from system.clusters;
</code></pre>
    <p>
     集群名称default
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/6c7fa739d4775957d6758a93d4e3243c.png"/>
    </p>
    <p>
     创建 ReplicatedMergeTree 测试表：
    </p>
    <p>
     任选一台机器，创建一个 ReplicatedMergeTree 引擎的测试表，测试 ZooKeeper 同步功能
    </p>
    <pre><code class="prism language-plain">CREATE TABLE test_ck ON CLUSTER default (EventDate DateTime, Number UInt32, id UInt32 )
 ENGINE = ReplicatedMergeTree('/clickhouse/tables/{shard}/test_ck', '{replica}') PARTITION BY toYYYYMM(EventDate) 
 ORDER BY (Number, EventDate, intHash32(id)) SAMPLE BY intHash32(id);
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/a0269e5f970ef936891b39192a463d5c.png"/>
    </p>
    <p>
     在其他机器节点show tables查看表结构是否同步成功;
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/d104fd19fd0292ec5dc3aa977fd2cd56.png"/>
    </p>
    <p>
     <strong>
      创建 Distributed 引擎测试表：
     </strong>
     <br/>
     创建一个分布式测试表测试数据分片是否正常。因为已经配置了zookeeper，所以创建表的DDL语句也会同步到其他节点上。
    </p>
    <pre><code class="prism language-plain">CREATE TABLE dis_test ON CLUSTER default  AS test_ck
ENGINE = Distributed(default, default, test_ck, rand())
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/9a7ffe783d15d4e194da1d2dd5c676eb.png"/>
    </p>
    <pre><code class="prism language-plain">show table
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/54017fa423ee97073fd8355bb88b6bf4.png"/>
    </p>
    <h3>
     <a id="_538">
     </a>
     文件清单
    </h3>
    <ul>
     <li>
      clickhouse-common-static-*.rpm
     </li>
     <li>
      clickhouse-server-*.rpm
     </li>
     <li>
      clickhouse-client-*.rpm
     </li>
     <li>
      /etc/clickhouse-server/users.d/users.xml
     </li>
     <li>
      /etc/clickhouse-server/config.d/config.xml
     </li>
    </ul>
    <h3>
     <a id="clickhouse_545">
     </a>
     clickhouse目录说明
    </h3>
    <ul>
     <li>
      数据文件目录 /var/lib/clickhouse/
     </li>
     <li>
      日志文件目录 /var/log/clickhouse-server/
     </li>
    </ul>
    <h3>
     <a id="_549">
     </a>
     可视化管理工具
    </h3>
    <ul>
     <li>
      dbeaver
     </li>
     <li>
      <a href="http://localhost:8123/play" rel="nofollow">
       http://localhost:8123/play
      </a>
     </li>
     <li>
      更多参考
      <a href="https://clickhouse.com/docs/zh/interfaces/third-party/gui" rel="nofollow">
       https://clickhouse.com/docs/zh/interfaces/third-party/gui
      </a>
     </li>
    </ul>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f35333538373236312f:61727469636c652f64657461696c732f313436313438363433" class_="artid" style="display:none">
 </p>
</div>


