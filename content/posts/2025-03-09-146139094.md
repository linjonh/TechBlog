---
layout: post
title: "5单调队列学习笔记"
date: 2025-03-09 21:26:15 +0800
description: "鸽了很久，2023152023/1/52023/1/5开始，20231212023/1/212023/1/21才完工。中途去集训了，没时间来补漏洞。"
keywords: "【5】单调队列学习笔记"
categories: ['未分类']
tags: ['算法', '笔记', '学习', 'C']
artid: "146139094"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146139094
    alt: "5单调队列学习笔记"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146139094
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146139094
cover: https://bing.ee123.net/img/rand?artid=146139094
image: https://bing.ee123.net/img/rand?artid=146139094
img: https://bing.ee123.net/img/rand?artid=146139094
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【5】单调队列学习笔记
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h4>
     <a id="_0">
     </a>
     前言
    </h4>
    <p>
     鸽了很久，
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        2023 
        
       
         / 
        
       
         1 
        
       
         / 
        
       
         5 
        
       
      
        2023/1/5
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord">
          2023/1/5
         </span>
        </span>
       </span>
      </span>
     </span>
     开始，
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        2023 
        
       
         / 
        
       
         1 
        
       
         / 
        
       
         21 
        
       
      
        2023/1/21
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord">
          2023/1/21
         </span>
        </span>
       </span>
      </span>
     </span>
     才完工。
    </p>
    <p>
     中途去集训了，没时间来补漏洞。
    </p>
    <h4>
     <a id="_6">
     </a>
     单调队列
    </h4>
    <p>
     单调队列是一种非常实用的数据结构，可以用于查询一个
     <strong>
      定长区间
     </strong>
     在以一定速度向后
     <strong>
      滑动
     </strong>
     ，并查询
     <strong>
      区间内最值
     </strong>
     的问题（具体见例题
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        1 
        
       
      
        1
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6444em;">
         </span>
         <span class="mord">
          1
         </span>
        </span>
       </span>
      </span>
     </span>
     ）。时间复杂度非常低，总体是
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        O 
        
       
         ( 
        
       
         n 
        
       
         ) 
        
       
      
        O(n)
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0278em;">
          O
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord mathnormal">
          n
         </span>
         <span class="mclose">
          )
         </span>
        </span>
       </span>
      </span>
     </span>
     ，均摊到每个元素是
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        O 
        
       
         ( 
        
       
         1 
        
       
         ) 
        
       
      
        O(1)
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0278em;">
          O
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord">
          1
         </span>
         <span class="mclose">
          )
         </span>
        </span>
       </span>
      </span>
     </span>
     ，所以常用来优化其他算法。
    </p>
    <p>
     单调队列需要保证队列元素的
     <strong>
      单调性
     </strong>
     ，也就是说，要保证
     <strong>
      队头就是最值
     </strong>
     ，这样就可以做到
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        O 
        
       
         ( 
        
       
         1 
        
       
         ) 
        
       
      
        O(1)
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0278em;">
          O
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord">
          1
         </span>
         <span class="mclose">
          )
         </span>
        </span>
       </span>
      </span>
     </span>
     查询最值。
    </p>
    <p>
     单调队列的维护：
    </p>
    <p>
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        1 
        
       
      
        1
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6444em;">
         </span>
         <span class="mord">
          1
         </span>
        </span>
       </span>
      </span>
     </span>
     ：向后滑动的过程中，会有新的元素加入队列。这时候，为了保证队列单调性，就应该把新元素与队尾元素
     <strong>
      比较大小
     </strong>
     。如果比队尾元素更接近最值，那么表示这个元素既比队尾元素
     <strong>
      优
     </strong>
     ，又比队尾元素的
     <strong>
      时间晚
     </strong>
     ，队尾元素会在这个元素之前被移出区间。这时存储这个元素就没有必要，可以直接
     <strong>
      前移队尾指针
     </strong>
     ，把队尾元素移除队列。重复执行直到
     <strong>
      队列为空
     </strong>
     或
     <strong>
      该元素不比队尾元素优
     </strong>
     ，最后该元素入队。
    </p>
    <p>
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        2 
        
       
      
        2
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6444em;">
         </span>
         <span class="mord">
          2
         </span>
        </span>
       </span>
      </span>
     </span>
     ：向后滑动的过程中，会有旧的元素退出队列。可以记录每个元素的
     <strong>
      入队位置
     </strong>
     ，根据
     <strong>
      现在的位置
     </strong>
     和
     <strong>
      队列长度
     </strong>
     计算出队首元素是否退出队列。如果退出，可以后移队头指针，将队首元素
     <strong>
      出队
     </strong>
     。重复执行直到队首元素满足要求。
    </p>
    <p>
     具体代码详见各题目。
    </p>
    <h4>
     <a id="_20">
     </a>
     单调队列例题
    </h4>
    <p>
     例题
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        1 
        
       
      
        1
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6444em;">
         </span>
         <span class="mord">
          1
         </span>
        </span>
       </span>
      </span>
     </span>
     ：
    </p>
    <p>
     <a href="https://www.luogu.com.cn/problem/P1886" rel="nofollow">
      P1886 滑动窗口 /【模板】单调队列
     </a>
    </p>
    <p>
     单调队列模板题，不多赘述。
    </p>
    <p>
     此处用的是
     <code>
      for
     </code>
     循环，代码比较冗余，简洁的模板请见其他题目。
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">int</span> n<span class="token punctuation">,</span>k<span class="token punctuation">,</span>a<span class="token punctuation">[</span><span class="token number">2000050</span><span class="token punctuation">]</span><span class="token punctuation">,</span>heads<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>tails<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>headb<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>tailb<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">node</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> v<span class="token punctuation">,</span>t<span class="token punctuation">;</span>
<span class="token punctuation">}</span>stb<span class="token punctuation">[</span><span class="token number">2000050</span><span class="token punctuation">]</span><span class="token punctuation">,</span>sts<span class="token punctuation">[</span><span class="token number">2000050</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">inline</span> <span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> x<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>f<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">char</span> ch<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>ch<span class="token operator">&lt;</span><span class="token char">'0'</span><span class="token operator">||</span>ch<span class="token operator">&gt;</span><span class="token char">'9'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">if</span> <span class="token punctuation">(</span>ch<span class="token operator">==</span><span class="token char">'-'</span><span class="token punctuation">)</span> f<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>ch<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>ch<span class="token operator">&gt;=</span><span class="token char">'0'</span><span class="token operator">&amp;&amp;</span>ch<span class="token operator">&lt;=</span><span class="token char">'9'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>x<span class="token operator">=</span>x<span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span>ch<span class="token operator">-</span><span class="token number">48</span><span class="token punctuation">;</span>ch<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	<span class="token keyword">return</span> x<span class="token operator">*</span>f<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	n<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>k<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	sts<span class="token punctuation">[</span><span class="token operator">++</span>heads<span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>sts<span class="token punctuation">[</span>heads<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>tails<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span>sts<span class="token punctuation">[</span>heads<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    <span class="token punctuation">{<!-- --></span>
	    	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>tails<span class="token punctuation">;</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&lt;</span>sts<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token operator">&amp;&amp;</span>j<span class="token operator">&gt;=</span>heads<span class="token punctuation">;</span>j<span class="token operator">--</span><span class="token punctuation">)</span>tails<span class="token operator">--</span><span class="token punctuation">;</span>
	    	sts<span class="token punctuation">[</span><span class="token operator">++</span>tails<span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token operator">=</span>i<span class="token punctuation">;</span>sts<span class="token punctuation">[</span>tails<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token operator">=</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	    	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>heads<span class="token punctuation">;</span>j<span class="token operator">&lt;=</span>tails<span class="token operator">&amp;&amp;</span>i<span class="token operator">-</span>sts<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token operator">&gt;=</span>k<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>heads<span class="token operator">++</span><span class="token punctuation">;</span>
	    	<span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">&gt;=</span>k<span class="token punctuation">)</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span>sts<span class="token punctuation">[</span>heads<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	stb<span class="token punctuation">[</span><span class="token operator">++</span>headb<span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>stb<span class="token punctuation">[</span>headb<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>tailb<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span>stb<span class="token punctuation">[</span>headb<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>tailb<span class="token punctuation">;</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;</span>stb<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token operator">&amp;&amp;</span>j<span class="token operator">&gt;=</span>headb<span class="token punctuation">;</span>j<span class="token operator">--</span><span class="token punctuation">)</span>tailb<span class="token operator">--</span><span class="token punctuation">;</span>
	    	stb<span class="token punctuation">[</span><span class="token operator">++</span>tailb<span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token operator">=</span>i<span class="token punctuation">;</span>stb<span class="token punctuation">[</span>tailb<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token operator">=</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	    	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>headb<span class="token punctuation">;</span>j<span class="token operator">&lt;=</span>tailb<span class="token operator">&amp;&amp;</span>i<span class="token operator">-</span>stb<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token operator">&gt;=</span>k<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>headb<span class="token operator">++</span><span class="token punctuation">;</span>
	    	<span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">&gt;=</span>k<span class="token punctuation">)</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span>stb<span class="token punctuation">[</span>headb<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     例题
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        2 
        
       
      
        2
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6444em;">
         </span>
         <span class="mord">
          2
         </span>
        </span>
       </span>
      </span>
     </span>
     ：
    </p>
    <p>
     <a href="https://www.luogu.com.cn/problem/P3088" rel="nofollow">
      P3088 [USACO13NOV]Crowded Cows S
     </a>
    </p>
    <p>
     如果一头奶牛
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        D 
        
       
      
        D
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0278em;">
          D
         </span>
        </span>
       </span>
      </span>
     </span>
     范围内的最高奶牛都不是它的两倍，那么这头奶牛就不会拥挤。所以可以通过查询最大值来确定是否会拥挤，就转化为了滑窗最大值问题。
    </p>
    <p>
     首先把奶牛按照
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        x 
         
        
          i 
         
        
       
      
        x_i
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.5806em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal">
           x
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 i
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     升序排列，然后以
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        x 
         
        
          i 
         
        
       
      
        x_i
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.5806em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal">
           x
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 i
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     为位置，
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        h 
         
        
          i 
         
        
       
      
        h_i
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.8444em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal">
           h
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 i
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     为值建立单调队列查询最大值，队列长度为
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        D 
        
       
      
        D
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0278em;">
          D
         </span>
        </span>
       </span>
      </span>
     </span>
     。单调队列需要正着跑一遍，反着跑一遍，求出两边的最大值。
    </p>
    <p>
     注意这里是先计算，再插入值。因为奶牛自己不会拥挤自己。
    </p>
    <p>
     当然不这样也可以，因为奶牛自己的身高不会是自己的
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        2 
        
       
      
        2
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6444em;">
         </span>
         <span class="mord">
          2
         </span>
        </span>
       </span>
      </span>
     </span>
     倍以上。
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;bits/stdc++.h&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">cow</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">long</span> <span class="token keyword">long</span> h<span class="token punctuation">,</span>x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>c<span class="token punctuation">[</span><span class="token number">300000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>que<span class="token punctuation">[</span><span class="token number">300000</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token keyword">long</span> n<span class="token punctuation">,</span>d<span class="token punctuation">,</span>cnt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> book1<span class="token punctuation">[</span><span class="token number">300000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>book2<span class="token punctuation">[</span><span class="token number">300000</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> <span class="token function">cmp</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">cow</span> a<span class="token punctuation">,</span><span class="token keyword">struct</span> <span class="token class-name">cow</span> b<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> a<span class="token punctuation">.</span>x<span class="token operator">&lt;</span>b<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%lld%lld"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>n<span class="token punctuation">,</span><span class="token operator">&amp;</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%lld%lld"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span><span class="token operator">&amp;</span>c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sort</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>c<span class="token operator">+</span>n<span class="token punctuation">,</span>cmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> <span class="token keyword">long</span> head<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>tail<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    que<span class="token punctuation">[</span><span class="token operator">++</span>tail<span class="token punctuation">]</span><span class="token operator">=</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    head<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
        	<span class="token keyword">while</span><span class="token punctuation">(</span>que<span class="token punctuation">[</span>head<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">&lt;</span>c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">-</span>d<span class="token operator">&amp;&amp;</span>head<span class="token operator">&lt;=</span>tail<span class="token punctuation">)</span>head<span class="token operator">++</span><span class="token punctuation">;</span>
        	<span class="token keyword">if</span><span class="token punctuation">(</span>que<span class="token punctuation">[</span>head<span class="token punctuation">]</span><span class="token punctuation">.</span>h<span class="token operator">&gt;=</span>c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>h<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>book1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
        	<span class="token keyword">while</span><span class="token punctuation">(</span>que<span class="token punctuation">[</span>tail<span class="token punctuation">]</span><span class="token punctuation">.</span>h<span class="token operator">&lt;=</span>c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>h<span class="token operator">&amp;&amp;</span>tail<span class="token operator">&gt;=</span>head<span class="token punctuation">)</span>tail<span class="token operator">--</span><span class="token punctuation">;</span>
        	que<span class="token punctuation">[</span><span class="token operator">++</span>tail<span class="token punctuation">]</span><span class="token operator">=</span>c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	head<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>tail<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    que<span class="token punctuation">[</span><span class="token operator">++</span>tail<span class="token punctuation">]</span><span class="token operator">=</span>c<span class="token punctuation">[</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    head<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> i<span class="token operator">=</span>n<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span>i<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
        	<span class="token keyword">while</span><span class="token punctuation">(</span>que<span class="token punctuation">[</span>head<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">&gt;</span>c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">+</span>d<span class="token operator">&amp;&amp;</span>head<span class="token operator">&lt;=</span>tail<span class="token punctuation">)</span>head<span class="token operator">++</span><span class="token punctuation">;</span>
        	<span class="token keyword">if</span><span class="token punctuation">(</span>que<span class="token punctuation">[</span>head<span class="token punctuation">]</span><span class="token punctuation">.</span>h<span class="token operator">&gt;=</span>c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>h<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>book2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
        	<span class="token keyword">while</span><span class="token punctuation">(</span>que<span class="token punctuation">[</span>tail<span class="token punctuation">]</span><span class="token punctuation">.</span>h<span class="token operator">&lt;=</span>c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>h<span class="token operator">&amp;&amp;</span>tail<span class="token operator">&gt;=</span>head<span class="token punctuation">)</span>tail<span class="token operator">--</span><span class="token punctuation">;</span>
        	que<span class="token punctuation">[</span><span class="token operator">++</span>tail<span class="token punctuation">]</span><span class="token operator">=</span>c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    <span class="token keyword">if</span><span class="token punctuation">(</span>book1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>book2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>cnt<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%lld\n"</span><span class="token punctuation">,</span>cnt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     例题
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        3 
        
       
      
        3
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6444em;">
         </span>
         <span class="mord">
          3
         </span>
        </span>
       </span>
      </span>
     </span>
     ：
    </p>
    <p>
     <a href="https://www.luogu.com.cn/problem/P2698" rel="nofollow">
      P2698 [USACO12MAR]Flowerpot S
     </a>
    </p>
    <p>
     答案是满足单调性的。越宽的花盆，可以得到的答案就越大。反之亦然。所以可以通过二分答案来做。
    </p>
    <p>
     验证答案时，由于需要查询最值，而花盆长度固定，可以假设花盆从左向右滑动，最后的答案是每次滑动后最大值与最小值的差的最大值，实际上就是枚举花盆的结束点。所以就转化为了滑窗最值问题，可以跑两遍单调队列。一遍跑最大值，一遍跑最小值。
    </p>
    <p>
     把奶牛按照
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        x 
         
        
          i 
         
        
       
      
        x_i
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.5806em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal">
           x
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 i
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     升序排列，然后以
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        x 
         
        
          i 
         
        
       
      
        x_i
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.5806em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal">
           x
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 i
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     为位置，
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        y 
         
        
          i 
         
        
       
      
        y_i
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.625em; vertical-align: -0.1944em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.0359em;">
           y
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3117em;">
              <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 i
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     为值建立单调队列查询最大值和最小值，队列长度为二分查找时的
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        m 
        
       
         i 
        
       
         d 
        
       
      
        mid
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord mathnormal">
          mi
         </span>
         <span class="mord mathnormal">
          d
         </span>
        </span>
       </span>
      </span>
     </span>
     。最后把每次滑动后最大值与最小值的差的最大值与
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        D 
        
       
      
        D
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0278em;">
          D
         </span>
        </span>
       </span>
      </span>
     </span>
     比较，就能知道答案的正确性了。
    </p>
    <p>
     注意，如果一个答案合理，那么还可以尝试更小的花盆，不能直接退出。
    </p>
    <p>
     听说ST表也能做，但是效率绝对没有单调队列高。
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">drop</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> x<span class="token punctuation">,</span>y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>water<span class="token punctuation">[</span><span class="token number">100010</span><span class="token punctuation">]</span><span class="token punctuation">,</span>que<span class="token punctuation">[</span><span class="token number">300010</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> n<span class="token punctuation">,</span>d<span class="token punctuation">,</span>l<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>r<span class="token operator">=</span><span class="token number">99999999</span><span class="token punctuation">,</span>ans<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>h<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>t<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> maxn<span class="token punctuation">[</span><span class="token number">1000100</span><span class="token punctuation">]</span><span class="token punctuation">,</span>minn<span class="token punctuation">[</span><span class="token number">1000100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> <span class="token function">cmp1</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">drop</span> a<span class="token punctuation">,</span><span class="token keyword">struct</span> <span class="token class-name">drop</span> b<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> a<span class="token punctuation">.</span>x<span class="token operator">&lt;</span>b<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> ans<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">memset</span><span class="token punctuation">(</span>maxn<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>maxn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">memset</span><span class="token punctuation">(</span>minn<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>minn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	h<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>t<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	que<span class="token punctuation">[</span><span class="token operator">++</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">=</span>water<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>que<span class="token punctuation">[</span><span class="token operator">++</span>t<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">=</span>water<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
	maxn<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>water<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    <span class="token punctuation">{<!-- --></span>
	    	<span class="token keyword">while</span><span class="token punctuation">(</span>que<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">&lt;=</span>water<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">&amp;&amp;</span>h<span class="token operator">&lt;=</span>t<span class="token punctuation">)</span>t<span class="token operator">--</span><span class="token punctuation">;</span>
	    	que<span class="token punctuation">[</span><span class="token operator">++</span>t<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">=</span>water<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>que<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">=</span>water<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
	    	<span class="token keyword">while</span><span class="token punctuation">(</span>water<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">-</span>que<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">&gt;</span>l<span class="token operator">&amp;&amp;</span>h<span class="token operator">&lt;=</span>t<span class="token punctuation">)</span>h<span class="token operator">++</span><span class="token punctuation">;</span>
	    	maxn<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>que<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	h<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>t<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	que<span class="token punctuation">[</span><span class="token operator">++</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">=</span>water<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>que<span class="token punctuation">[</span><span class="token operator">++</span>t<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">=</span>water<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
	minn<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>water<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    <span class="token punctuation">{<!-- --></span>
	    	<span class="token keyword">while</span><span class="token punctuation">(</span>que<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">&gt;=</span>water<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">&amp;&amp;</span>h<span class="token operator">&lt;=</span>t<span class="token punctuation">)</span>t<span class="token operator">--</span><span class="token punctuation">;</span>
	    	que<span class="token punctuation">[</span><span class="token operator">++</span>t<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">=</span>water<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>que<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">=</span>water<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
	    	<span class="token keyword">while</span><span class="token punctuation">(</span>water<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">-</span>que<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">&gt;</span>l<span class="token operator">&amp;&amp;</span>h<span class="token operator">&lt;=</span>t<span class="token punctuation">)</span>h<span class="token operator">++</span><span class="token punctuation">;</span>
	    	minn<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>que<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    ans<span class="token operator">=</span><span class="token function">max</span><span class="token punctuation">(</span>ans<span class="token punctuation">,</span>maxn<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span>minn<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> ans<span class="token operator">&gt;=</span>d<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>n<span class="token punctuation">,</span><span class="token operator">&amp;</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>water<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span><span class="token operator">&amp;</span>water<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">sort</span><span class="token punctuation">(</span>water<span class="token punctuation">,</span>water<span class="token operator">+</span>n<span class="token punctuation">,</span>cmp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>l<span class="token operator">&lt;</span>r<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
        	<span class="token keyword">int</span> mid<span class="token operator">=</span><span class="token punctuation">(</span>l<span class="token operator">+</span>r<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
        	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">check</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">)</span>ans<span class="token operator">=</span>mid<span class="token punctuation">,</span>r<span class="token operator">=</span>mid<span class="token punctuation">;</span>
        	<span class="token keyword">else</span> l<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span>ans<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_209">
     </a>
     单调队列的运用
    </h4>
    <p>
     单调队列是可以用来优化DP的，可以把一部分
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        O 
        
       
         ( 
        
        
        
          n 
         
        
          2 
         
        
       
         ) 
        
       
      
        O(n^2)
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1.0641em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0278em;">
          O
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord">
          <span class="mord mathnormal">
           n
          </span>
          <span class="msupsub">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.8141em;">
              <span class="" style="top: -3.063em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 2
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mclose">
          )
         </span>
        </span>
       </span>
      </span>
     </span>
     的DP优化到
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        O 
        
       
         ( 
        
       
         n 
        
       
         ) 
        
       
      
        O(n)
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0278em;">
          O
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord mathnormal">
          n
         </span>
         <span class="mclose">
          )
         </span>
        </span>
       </span>
      </span>
     </span>
     ，是一个非常大的优化。
    </p>
    <p>
     当然，想使用单调队列优化DP，还是需要一定的想象力的。
    </p>
    <p>
     例题
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        4 
        
       
      
        4
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6444em;">
         </span>
         <span class="mord">
          4
         </span>
        </span>
       </span>
      </span>
     </span>
     ：
    </p>
    <p>
     <a href="https://www.luogu.com.cn/problem/P1725" rel="nofollow">
      P1725 琪露诺
     </a>
    </p>
    <p>
     很容易写出这样一个转移方程：
    </p>
    <p>
     <span class="katex--display">
      <span class="katex-display">
       <span class="katex">
        <span class="katex-mathml">
         d 
         
        
          p 
         
        
          [ 
         
        
          i 
         
        
          ] 
         
        
          = 
         
        
          max 
         
        
          ⁡ 
         
        
          { 
         
        
          d 
         
        
          p 
         
        
          [ 
         
        
          i 
         
        
          − 
         
        
          j 
         
        
          ] 
         
        
          } 
         
        
          + 
         
        
          a 
         
        
          [ 
         
        
          i 
         
        
          ] 
         
        
          ( 
         
        
          L 
         
        
          ≤ 
         
        
          j 
         
        
          ≤ 
         
        
          R 
         
        
          ) 
         
        
       
         dp[i]=\max\{dp[i-j]\}+a[i](L\le j\le R)
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal">
           d
          </span>
          <span class="mord mathnormal">
           p
          </span>
          <span class="mopen">
           [
          </span>
          <span class="mord mathnormal">
           i
          </span>
          <span class="mclose">
           ]
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mop">
           max
          </span>
          <span class="mopen">
           {
           <!-- -->
          </span>
          <span class="mord mathnormal">
           d
          </span>
          <span class="mord mathnormal">
           p
          </span>
          <span class="mopen">
           [
          </span>
          <span class="mord mathnormal">
           i
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           −
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0572em;">
           j
          </span>
          <span class="mclose">
           ]}
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           +
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal">
           a
          </span>
          <span class="mopen">
           [
          </span>
          <span class="mord mathnormal">
           i
          </span>
          <span class="mclose">
           ]
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal">
           L
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           ≤
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 0.854em; vertical-align: -0.1944em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0572em;">
           j
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           ≤
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0077em;">
           R
          </span>
          <span class="mclose">
           )
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <p>
     如果这样子朴素转移，时间复杂度是
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        O 
        
       
         ( 
        
       
         n 
        
       
         ( 
        
       
         L 
        
       
         − 
        
       
         R 
        
       
         ) 
        
       
         ) 
        
       
      
        O(n(L-R))
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0278em;">
          O
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord mathnormal">
          n
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord mathnormal">
          L
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          −
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0077em;">
          R
         </span>
         <span class="mclose">
          ))
         </span>
        </span>
       </span>
      </span>
     </span>
     的，很容易超时。
    </p>
    <p>
     我们观察到，
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        j 
        
       
      
        j
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.854em; vertical-align: -0.1944em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0572em;">
          j
         </span>
        </span>
       </span>
      </span>
     </span>
     的取值范围
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        ( 
        
       
         L 
        
       
         ≤ 
        
       
         j 
        
       
         ≤ 
        
       
         R 
        
       
         ) 
        
       
      
        (L\le j\le R)
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord mathnormal">
          L
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          ≤
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.854em; vertical-align: -0.1944em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0572em;">
          j
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          ≤
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0077em;">
          R
         </span>
         <span class="mclose">
          )
         </span>
        </span>
       </span>
      </span>
     </span>
     是不变的，也就意味着可以取的
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        d 
        
       
         p 
        
       
         [ 
        
       
         i 
        
       
         − 
        
       
         j 
        
       
         ] 
        
       
      
        dp[i-j]
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal">
          d
         </span>
         <span class="mord mathnormal">
          p
         </span>
         <span class="mopen">
          [
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          −
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0572em;">
          j
         </span>
         <span class="mclose">
          ]
         </span>
        </span>
       </span>
      </span>
     </span>
     的个数是不变的。又因为
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        j 
        
       
      
        j
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.854em; vertical-align: -0.1944em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0572em;">
          j
         </span>
        </span>
       </span>
      </span>
     </span>
     在取值范围
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        ( 
        
       
         L 
        
       
         ≤ 
        
       
         j 
        
       
         ≤ 
        
       
         R 
        
       
         ) 
        
       
      
        (L\le j\le R)
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord mathnormal">
          L
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          ≤
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.854em; vertical-align: -0.1944em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0572em;">
          j
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          ≤
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0077em;">
          R
         </span>
         <span class="mclose">
          )
         </span>
        </span>
       </span>
      </span>
     </span>
     中是连续自然数，所以
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        d 
        
       
         p 
        
       
         [ 
        
       
         i 
        
       
         − 
        
       
         j 
        
       
         ] 
        
       
      
        dp[i-j]
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal">
          d
         </span>
         <span class="mord mathnormal">
          p
         </span>
         <span class="mopen">
          [
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          −
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0572em;">
          j
         </span>
         <span class="mclose">
          ]
         </span>
        </span>
       </span>
      </span>
     </span>
     是连续的。
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        d 
        
       
         p 
        
       
         [ 
        
       
         i 
        
       
         − 
        
       
         j 
        
       
         ] 
        
       
      
        dp[i-j]
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal">
          d
         </span>
         <span class="mord mathnormal">
          p
         </span>
         <span class="mopen">
          [
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          −
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0572em;">
          j
         </span>
         <span class="mclose">
          ]
         </span>
        </span>
       </span>
      </span>
     </span>
     的取值就像一个固定长度的窗口。
    </p>
    <p>
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        d 
        
       
         p 
        
       
         [ 
        
       
         i 
        
       
         − 
        
       
         j 
        
       
         ] 
        
       
      
        dp[i-j]
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal">
          d
         </span>
         <span class="mord mathnormal">
          p
         </span>
         <span class="mopen">
          [
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          −
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0572em;">
          j
         </span>
         <span class="mclose">
          ]
         </span>
        </span>
       </span>
      </span>
     </span>
     中，我们需要逐个递增枚举
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        i 
        
       
      
        i
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6595em;">
         </span>
         <span class="mord mathnormal">
          i
         </span>
        </span>
       </span>
      </span>
     </span>
     。那么此时
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        d 
        
       
         p 
        
       
         [ 
        
       
         i 
        
       
         − 
        
       
         j 
        
       
         ] 
        
       
      
        dp[i-j]
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal">
          d
         </span>
         <span class="mord mathnormal">
          p
         </span>
         <span class="mopen">
          [
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          −
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0572em;">
          j
         </span>
         <span class="mclose">
          ]
         </span>
        </span>
       </span>
      </span>
     </span>
     的取值也会随之逐个递增，就像一个固定长度的滑动窗口。就像这样：
    </p>
    <p>
     <img alt="图片不见了" src="https://i-blog.csdnimg.cn/img_convert/e092595f941e99b79f4b11c1457875da.png"/>
    </p>
    <p>
     <s>
      对这是滑动窗口的原图
     </s>
    </p>
    <p>
     而此时需要求的就是
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        d 
        
       
         p 
        
       
         [ 
        
       
         i 
        
       
         − 
        
       
         j 
        
       
         ] 
        
       
      
        dp[i-j]
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal">
          d
         </span>
         <span class="mord mathnormal">
          p
         </span>
         <span class="mopen">
          [
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          −
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0572em;">
          j
         </span>
         <span class="mclose">
          ]
         </span>
        </span>
       </span>
      </span>
     </span>
     的取值中的最大值，可以使用单调队列来维护。
    </p>
    <p>
     注意如果
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        i 
        
       
         &lt; 
        
       
         L 
        
       
      
        i\lt L
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6986em; vertical-align: -0.0391em;">
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          &lt;
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal">
          L
         </span>
        </span>
       </span>
      </span>
     </span>
     ，证明无法跳到这个格子，可以赋值为负无穷，排除干扰。
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">int</span> n<span class="token punctuation">,</span>l<span class="token punctuation">,</span>r<span class="token punctuation">,</span>a<span class="token punctuation">[</span><span class="token number">2000050</span><span class="token punctuation">]</span><span class="token punctuation">,</span>f<span class="token punctuation">[</span><span class="token number">2000050</span><span class="token punctuation">]</span><span class="token punctuation">,</span>head<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>tail<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>ans<span class="token operator">=</span><span class="token operator">-</span><span class="token number">99999999</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">node</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> t<span class="token punctuation">,</span>v<span class="token punctuation">;</span>
<span class="token punctuation">}</span>que<span class="token punctuation">[</span><span class="token number">2000050</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">inline</span> <span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> x<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>f<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">char</span> ch<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>ch<span class="token operator">&lt;</span><span class="token char">'0'</span><span class="token operator">||</span>ch<span class="token operator">&gt;</span><span class="token char">'9'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">if</span> <span class="token punctuation">(</span>ch<span class="token operator">==</span><span class="token char">'-'</span><span class="token punctuation">)</span> f<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>ch<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>ch<span class="token operator">&gt;=</span><span class="token char">'0'</span><span class="token operator">&amp;&amp;</span>ch<span class="token operator">&lt;=</span><span class="token char">'9'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>x<span class="token operator">=</span>x<span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span>ch<span class="token operator">-</span><span class="token number">48</span><span class="token punctuation">;</span>ch<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	<span class="token keyword">return</span> x<span class="token operator">*</span>f<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	n<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>l<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>r<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	que<span class="token punctuation">[</span><span class="token operator">++</span>tail<span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>que<span class="token punctuation">[</span>tail<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>head<span class="token operator">++</span><span class="token punctuation">;</span>
	f<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>n<span class="token operator">+</span>r<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    <span class="token punctuation">{<!-- --></span>
	    	f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">99999999</span><span class="token punctuation">;</span>
	    	<span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">&gt;</span>l<span class="token punctuation">)</span>
	    	   <span class="token punctuation">{<!-- --></span>
	    	   <span class="token keyword">while</span><span class="token punctuation">(</span>que<span class="token punctuation">[</span>tail<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token operator">&lt;=</span>f<span class="token punctuation">[</span>i<span class="token operator">-</span>l<span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>tail<span class="token operator">&gt;=</span>head<span class="token punctuation">)</span>tail<span class="token operator">--</span><span class="token punctuation">;</span>
	    	   que<span class="token punctuation">[</span><span class="token operator">++</span>tail<span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token operator">=</span>i<span class="token operator">-</span>l<span class="token punctuation">;</span>que<span class="token punctuation">[</span>tail<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token operator">=</span>f<span class="token punctuation">[</span>i<span class="token operator">-</span>l<span class="token punctuation">]</span><span class="token punctuation">;</span>
	    	   <span class="token keyword">while</span><span class="token punctuation">(</span>que<span class="token punctuation">[</span>head<span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token operator">&lt;</span>i<span class="token operator">-</span>r<span class="token operator">&amp;&amp;</span>head<span class="token operator">&lt;=</span>tail<span class="token punctuation">)</span>head<span class="token operator">++</span><span class="token punctuation">;</span>
	    	   f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>que<span class="token punctuation">[</span>head<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token operator">+</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	           <span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>n<span class="token operator">+</span>r<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    ans<span class="token operator">=</span><span class="token function">max</span><span class="token punctuation">(</span>ans<span class="token punctuation">,</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span>ans<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     例题
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        5 
        
       
      
        5
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6444em;">
         </span>
         <span class="mord">
          5
         </span>
        </span>
       </span>
      </span>
     </span>
     ：
    </p>
    <p>
     <a href="https://www.luogu.com.cn/problem/P2034" rel="nofollow">
      P2034 选择数字
     </a>
    </p>
    <p>
     双倍经验
    </p>
    <p>
     <a href="https://www.luogu.com.cn/problem/P2627" rel="nofollow">
      P2627 [USACO11OPEN]Mowing the Lawn G
     </a>
    </p>
    <p>
     正着DP不好想，不如正难则反，要使选出的数字的和最大，就是要不选的数字和最小。
    </p>
    <p>
     很容易写出这样一个逆向DP的转移方程：
    </p>
    <p>
     <span class="katex--display">
      <span class="katex-display">
       <span class="katex">
        <span class="katex-mathml">
         d 
         
        
          p 
         
        
          [ 
         
        
          i 
         
        
          ] 
         
        
          = 
         
        
          min 
         
        
          ⁡ 
         
        
          { 
         
        
          d 
         
        
          p 
         
        
          [ 
         
        
          i 
         
        
          − 
         
        
          j 
         
        
          ] 
         
        
          } 
         
        
          + 
         
        
          a 
         
        
          [ 
         
        
          i 
         
        
          ] 
         
        
          ( 
         
        
          0 
         
        
          &lt; 
         
        
          j 
         
        
          ≤ 
         
        
          k 
         
        
          ) 
         
        
       
         dp[i]=\min\{dp[i-j]\}+a[i](0\lt j\le k)
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal">
           d
          </span>
          <span class="mord mathnormal">
           p
          </span>
          <span class="mopen">
           [
          </span>
          <span class="mord mathnormal">
           i
          </span>
          <span class="mclose">
           ]
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mop">
           min
          </span>
          <span class="mopen">
           {
           <!-- -->
          </span>
          <span class="mord mathnormal">
           d
          </span>
          <span class="mord mathnormal">
           p
          </span>
          <span class="mopen">
           [
          </span>
          <span class="mord mathnormal">
           i
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           −
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0572em;">
           j
          </span>
          <span class="mclose">
           ]}
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           +
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal">
           a
          </span>
          <span class="mopen">
           [
          </span>
          <span class="mord mathnormal">
           i
          </span>
          <span class="mclose">
           ]
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord">
           0
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           &lt;
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 0.854em; vertical-align: -0.1944em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0572em;">
           j
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           ≤
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0315em;">
           k
          </span>
          <span class="mclose">
           )
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <p>
     依据例题
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        4 
        
       
      
        4
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6444em;">
         </span>
         <span class="mord">
          4
         </span>
        </span>
       </span>
      </span>
     </span>
     的分析，这个式子也可以用单调队列来维护
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        min 
        
       
         ⁡ 
        
       
         { 
        
       
         d 
        
       
         p 
        
       
         [ 
        
       
         i 
        
       
         − 
        
       
         j 
        
       
         ] 
        
       
         } 
        
       
      
        \min\{dp[i-j]\}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mop">
          min
         </span>
         <span class="mopen">
          {
          <!-- -->
         </span>
         <span class="mord mathnormal">
          d
         </span>
         <span class="mord mathnormal">
          p
         </span>
         <span class="mopen">
          [
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          −
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0572em;">
          j
         </span>
         <span class="mclose">
          ]}
         </span>
        </span>
       </span>
      </span>
     </span>
     ，把时间复杂度降为
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        O 
        
       
         ( 
        
       
         n 
        
       
         ) 
        
       
      
        O(n)
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0278em;">
          O
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord mathnormal">
          n
         </span>
         <span class="mclose">
          )
         </span>
        </span>
       </span>
      </span>
     </span>
     。
    </p>
    <p>
     P2034
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token keyword">long</span> n<span class="token punctuation">,</span>k<span class="token punctuation">,</span>a<span class="token punctuation">[</span><span class="token number">2000050</span><span class="token punctuation">]</span><span class="token punctuation">,</span>f<span class="token punctuation">[</span><span class="token number">2000050</span><span class="token punctuation">]</span><span class="token punctuation">,</span>head<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>tail<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>ans<span class="token operator">=</span><span class="token number">99999999999999</span><span class="token punctuation">,</span>tol<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">node</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">long</span> <span class="token keyword">long</span> t<span class="token punctuation">,</span>v<span class="token punctuation">;</span>
<span class="token punctuation">}</span>que<span class="token punctuation">[</span><span class="token number">2000050</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">inline</span> <span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">long</span> <span class="token keyword">long</span> x<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>f<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">char</span> ch<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>ch<span class="token operator">&lt;</span><span class="token char">'0'</span><span class="token operator">||</span>ch<span class="token operator">&gt;</span><span class="token char">'9'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">if</span> <span class="token punctuation">(</span>ch<span class="token operator">==</span><span class="token char">'-'</span><span class="token punctuation">)</span> f<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>ch<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>ch<span class="token operator">&gt;=</span><span class="token char">'0'</span><span class="token operator">&amp;&amp;</span>ch<span class="token operator">&lt;=</span><span class="token char">'9'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>x<span class="token operator">=</span>x<span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span>ch<span class="token operator">-</span><span class="token number">48</span><span class="token punctuation">;</span>ch<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	<span class="token keyword">return</span> x<span class="token operator">*</span>f<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	n<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>k<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    <span class="token punctuation">{<!-- --></span>
	    a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    tol<span class="token operator">+=</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	que<span class="token punctuation">[</span><span class="token operator">++</span>tail<span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>que<span class="token punctuation">[</span>tail<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>head<span class="token operator">++</span><span class="token punctuation">;</span>
	f<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    <span class="token punctuation">{<!-- --></span>
	    <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">-</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span>
	       <span class="token punctuation">{<!-- --></span>
	       <span class="token keyword">while</span><span class="token punctuation">(</span>que<span class="token punctuation">[</span>head<span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token operator">&lt;</span>i<span class="token operator">-</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span>head<span class="token operator">&lt;=</span>tail<span class="token punctuation">)</span>head<span class="token operator">++</span><span class="token punctuation">;</span>
	       f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>que<span class="token punctuation">[</span>head<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token punctuation">;</span>
	       <span class="token punctuation">}</span>
	    f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+=</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	    <span class="token keyword">while</span><span class="token punctuation">(</span>que<span class="token punctuation">[</span>tail<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token operator">&gt;</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>head<span class="token operator">&lt;=</span>tail<span class="token punctuation">)</span>tail<span class="token operator">--</span><span class="token punctuation">;</span>
	    que<span class="token punctuation">[</span><span class="token operator">++</span>tail<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token operator">=</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>que<span class="token punctuation">[</span>tail<span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token operator">=</span>i<span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> i<span class="token operator">=</span>n<span class="token operator">-</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    ans<span class="token operator">=</span><span class="token function">min</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>ans<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%lld"</span><span class="token punctuation">,</span>tol<span class="token operator">-</span>ans<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     P2627
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token keyword">long</span> n<span class="token punctuation">,</span>k<span class="token punctuation">,</span>a<span class="token punctuation">[</span><span class="token number">2000050</span><span class="token punctuation">]</span><span class="token punctuation">,</span>f<span class="token punctuation">[</span><span class="token number">2000050</span><span class="token punctuation">]</span><span class="token punctuation">,</span>head<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>tail<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>ans<span class="token operator">=</span><span class="token number">99999999999999</span><span class="token punctuation">,</span>tol<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">node</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">long</span> <span class="token keyword">long</span> t<span class="token punctuation">,</span>v<span class="token punctuation">;</span>
<span class="token punctuation">}</span>que<span class="token punctuation">[</span><span class="token number">2000050</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">inline</span> <span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">long</span> <span class="token keyword">long</span> x<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>f<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">char</span> ch<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>ch<span class="token operator">&lt;</span><span class="token char">'0'</span><span class="token operator">||</span>ch<span class="token operator">&gt;</span><span class="token char">'9'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">if</span> <span class="token punctuation">(</span>ch<span class="token operator">==</span><span class="token char">'-'</span><span class="token punctuation">)</span> f<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>ch<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>ch<span class="token operator">&gt;=</span><span class="token char">'0'</span><span class="token operator">&amp;&amp;</span>ch<span class="token operator">&lt;=</span><span class="token char">'9'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>x<span class="token operator">=</span>x<span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span>ch<span class="token operator">-</span><span class="token number">48</span><span class="token punctuation">;</span>ch<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	<span class="token keyword">return</span> x<span class="token operator">*</span>f<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	n<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>k<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    <span class="token punctuation">{<!-- --></span>
	    a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    tol<span class="token operator">+=</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	que<span class="token punctuation">[</span><span class="token operator">++</span>tail<span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>que<span class="token punctuation">[</span>tail<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>head<span class="token operator">++</span><span class="token punctuation">;</span>
	f<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    <span class="token punctuation">{<!-- --></span>
	    <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">-</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span>
	       <span class="token punctuation">{<!-- --></span>
	       <span class="token keyword">while</span><span class="token punctuation">(</span>que<span class="token punctuation">[</span>head<span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token operator">&lt;</span>i<span class="token operator">-</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span>head<span class="token operator">&lt;=</span>tail<span class="token punctuation">)</span>head<span class="token operator">++</span><span class="token punctuation">;</span>
	       f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>que<span class="token punctuation">[</span>head<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token punctuation">;</span>
	       <span class="token punctuation">}</span>
	    f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+=</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	    <span class="token keyword">while</span><span class="token punctuation">(</span>que<span class="token punctuation">[</span>tail<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token operator">&gt;</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>head<span class="token operator">&lt;=</span>tail<span class="token punctuation">)</span>tail<span class="token operator">--</span><span class="token punctuation">;</span>
	    que<span class="token punctuation">[</span><span class="token operator">++</span>tail<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token operator">=</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>que<span class="token punctuation">[</span>tail<span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token operator">=</span>i<span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> i<span class="token operator">=</span>n<span class="token operator">-</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    ans<span class="token operator">=</span><span class="token function">min</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>ans<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%lld"</span><span class="token punctuation">,</span>tol<span class="token operator">-</span>ans<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_389">
     </a>
     后记
    </h4>
    <p>
     单调队列还是很需要想象力的，否则没有那么好理解。
    </p>
    <p>
     顺便纪念一下，这是我农历虎年的最后一篇博客！
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f575344333331395f2f:61727469636c652f64657461696c732f313436313339303934" class_="artid" style="display:none">
 </p>
</div>


