---
layout: post
title: "2025Electron-基础二进程模型三大核心"
date: 2025-03-11 12:56:00 +0800
description: "Electron IPC通信：使用 invoke/handle 和 send/on 进行通信。"
keywords: "【2025】Electron 基础二（进程模型三大核心）"
categories: ['Electron']
tags: ['前端', 'Javascript', 'Electron']
artid: "146175982"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146175982
    alt: "2025Electron-基础二进程模型三大核心"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146175982
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146175982
cover: https://bing.ee123.net/img/rand?artid=146175982
image: https://bing.ee123.net/img/rand?artid=146175982
img: https://bing.ee123.net/img/rand?artid=146175982
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【2025】Electron 基础二（进程模型三大核心）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="Electron___0">
     </a>
     Electron 基础 （多进程架构解析）
    </h2>
    <p>
     源代码仓库：
     <br/>
     <a href="https://github.com/IsMShmily/electron_git">
      Github仓库【electron_git】
     </a>
    </p>
    <h3>
     <a id="1Electron__5">
     </a>
     1、Electron 多进程都是什么
    </h3>
    <ol>
     <li>
      <strong>
       主进程 (Main Process)
      </strong>
     </li>
     <li>
      <strong>
       渲染进程 (Renderer Process)
      </strong>
     </li>
     <li>
      <strong>
       预加载脚本 (Preload Script)
      </strong>
     </li>
    </ol>
    <h5>
     <a id="_12">
     </a>
     打个比方：公司里的三个关键角色
    </h5>
    <p>
     假设你要开一家公司（开发一个桌面应用），这个公司需要三个核心角色：
    </p>
    <ol>
     <li>
      <p>
       <strong>
        董事长（主进程）
       </strong>
       ：整个公司只有一个董事长，他掌握所有核心权力：
      </p>
      <ul>
       <li>
        ✅ 决定公司什么时候开门/关门（应用启动退出）
       </li>
       <li>
        ✅ 招聘新员工（创建新窗口）
       </li>
       <li>
        ✅ 直接联系政府机关（调用系统级API）
       </li>
       <li>
        ✅ 保管公司保险柜钥匙（访问本地文件）
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        普通员工（渲染进程）
       </strong>
       ：每个员工负责一个窗口的接待工作：
      </p>
      <ul>
       <li>
        🖥️ 每人只负责一个办事窗口（每个窗口对应一个渲染进程）
       </li>
       <li>
        🎨 专门搞装修设计（负责界面UI展示）
       </li>
       <li>
        🔒 不能直接进保险库（默认不能访问敏感功能）
       </li>
       <li>
        💬 有事得打报告请示（通过IPC通信找董事长）
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        秘书（预加载脚本）
       </strong>
       ：董事长安排在员工身边的助手：
      </p>
      <ul>
       <li>
        📞 帮员工转达需求给董事长（桥接通信）
       </li>
       <li>
        🛡️ 盯着员工别乱来（安全隔离）
       </li>
       <li>
        📋 只给员工有限的申请表（暴露有限API）
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_35">
     </a>
     实际工作流程举例：用户点击"打开文件"按钮
    </h4>
    <h5>
     <a id="1_37">
     </a>
     步骤1：员工收到用户请求
    </h5>
    <pre><code class="prism language-js"><span class="token comment">// renderer层</span>
<span class="token comment">// 员工（渲染进程）的日常工作</span>
<span class="token keyword">function</span> <span class="token function">handleOpenFileClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 不能直接操作文件，得找秘书帮忙</span>
  window<span class="token punctuation">.</span><span class="token constant">API</span><span class="token punctuation">.</span><span class="token function">sendRequest</span><span class="token punctuation">(</span><span class="token string">'open-file'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="2_47">
     </a>
     步骤2：秘书转达需求
    </h5>
    <pre><code class="prism language-js"><span class="token comment">// preload层</span>
<span class="token comment">// 秘书（预加载脚本）的工作手册</span>
contextBridge<span class="token punctuation">.</span><span class="token function">exposeInMainWorld</span><span class="token punctuation">(</span><span class="token string">'API'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function-variable function">sendRequest</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'to-boss'</span><span class="token punctuation">,</span> type<span class="token punctuation">)</span> <span class="token comment">// 打电话给董事长</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="3__59">
     </a>
     步骤3： 董事长处理重要事务
    </h5>
    <pre><code class="prism language-js"><span class="token comment">// main层</span>
<span class="token comment">// 董事长（主进程）的权限</span>
ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'to-boss'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'open-file'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> file <span class="token operator">=</span> dialog<span class="token punctuation">.</span><span class="token function">showOpenDialogSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 直接调用系统对话框</span>
    event<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'reply'</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span> <span class="token comment">// 把结果传回去</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="4_71">
     </a>
     步骤4：秘书把结果转交员工
    </h5>
    <pre><code class="prism language-js"><span class="token comment">// 员工收到回复后的操作</span>
ipcRenderer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'reply'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'file-path'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> file
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="2Electron__80">
     </a>
     2、Electron 进程如何通信
    </h3>
    <p>
     Electron IPC通信：使用 invoke/handle 和 send/on 进行通信
    </p>
    <h4>
     <a id="invokehandle_vs_sendon__84">
     </a>
     一、invoke/handle vs send/on 场景详解
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        特性
       </th>
       <th>
        invoke/handle
       </th>
       <th>
        send/on
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        通信方向
       </td>
       <td>
        双向（需要响应）
       </td>
       <td>
        单向/双向（需手动回复）
       </td>
      </tr>
      <tr>
       <td>
        返回值处理
       </td>
       <td>
        自动返回Promise
       </td>
       <td>
        需手动监听回复事件
       </td>
      </tr>
      <tr>
       <td>
        错误处理
       </td>
       <td>
        自动传递reject错误
       </td>
       <td>
        需额外错误事件处理
       </td>
      </tr>
      <tr>
       <td>
        代码简洁度
       </td>
       <td>
        ⭐⭐⭐⭐
       </td>
       <td>
        ⭐⭐
       </td>
      </tr>
      <tr>
       <td>
        典型使用场景
       </td>
       <td>
        获取数据、执行操作并等待结果
       </td>
       <td>
        通知事件、状态推送、实时消息
       </td>
      </tr>
     </tbody>
    </table>
    <h4>
     <a id="_invokehandle_94">
     </a>
     二、什么时候该用 invoke/handle？
    </h4>
    <h6>
     <a id="1_96">
     </a>
     场景1：需要等待操作结果的异步任务
    </h6>
    <pre><code class="prism language-javascript"><span class="token comment">// 渲染进程</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> ipcRenderer<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">'read-file'</span><span class="token punctuation">,</span> <span class="token string">'/path/to/file'</span><span class="token punctuation">)</span>

<span class="token comment">// 主进程</span>
ipcMain<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token string">'read-file'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> path</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="2_107">
     </a>
     场景2：需要明确知道操作是否成功
    </h5>
    <pre><code class="prism language-js"><span class="token comment">// 自动错误传递</span>
<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">await</span> ipcRenderer<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">'dangerous-operation'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">showErrorDialog</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="3_116">
     </a>
     场景3：链式异步操作
    </h5>
    <pre><code class="prism language-js"><span class="token comment">// 顺序执行多个依赖操作</span>
<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> ipc<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">'get-user'</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>
<span class="token keyword">const</span> orders <span class="token operator">=</span> <span class="token keyword">await</span> ipc<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">'get-orders'</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token keyword">const</span> analytics <span class="token operator">=</span> <span class="token keyword">await</span> ipc<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">'generate-report'</span><span class="token punctuation">,</span> orders<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_sendon_125">
     </a>
     三、什么时候该用 send/on？
    </h4>
    <h5>
     <a id="1_126">
     </a>
     场景1：单向通知不需要响应
    </h5>
    <pre><code class="prism language-js"><span class="token comment">// 渲染进程：不需要等待回复</span>
ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'window-minimize'</span><span class="token punctuation">)</span>

<span class="token comment">// 主进程</span>
ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'window-minimize'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  mainWindow<span class="token punctuation">.</span><span class="token function">minimize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="2_137">
     </a>
     场景2：主进程主动推送消息
    </h5>
    <pre><code class="prism language-js"><span class="token comment">// 主进程：检测到新版本时广播</span>
mainWindow<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'update-available'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">'2.0.0'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">releaseNotes</span><span class="token operator">:</span> <span class="token string">'...'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 渲染进程</span>
ipcRenderer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'update-available'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> info</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">showUpdateDialog</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="3_151">
     </a>
     场景3：多个渲染进程协同工作
    </h5>
    <pre><code class="prism language-js"><span class="token comment">// 主进程：中转消息</span>
ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'chat-message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 广播给所有窗口</span>
  BrowserWindow<span class="token punctuation">.</span><span class="token function">getAllWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">win</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'new-message'</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f73686d696c796e6e5f2f:61727469636c652f64657461696c732f313436313735393832" class_="artid" style="display:none">
 </p>
</div>


