---
layout: post
title: "u8g2原理解析"
date: 2025-03-14 18:29:30 +0800
description: "综上所述，u8g2_font_info_t 结构体通过存储字体的各种信息，为 U8g2 库在文本渲染和布局过程中提供了必要的参数，确保能够正确地显示和排版文本。含义：字体中字符的最大高度，注意这里是整体高度，而不是上升高度（ascent）。注释掉的代码 u8g2_add_vector_x 和 u8g2_add_vector_y 是另一种实现方式，但会增加 AVR 平台的代码大小。u8g2_t *u8g2：指向 u8g2_t 结构体的指针，该结构体包含了 U8g2 库的上下文信息，如显示屏设置、字体信息等。"
keywords: "u8g2原理解析"
categories: ['模块']
tags: ['嵌入式硬件']
artid: "146233358"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146233358
    alt: "u8g2原理解析"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146233358
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146233358
cover: https://bing.ee123.net/img/rand?artid=146233358
image: https://bing.ee123.net/img/rand?artid=146233358
img: https://bing.ee123.net/img/rand?artid=146233358
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     u8g2原理解析
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="u8g2_font_info_t__U8g2__1">
     </a>
     u8g2_font_info_t 结构体用于存储 U8g2 图形库中字体的相关信息.
    </h2>
    <h3>
     <a id="1__0_2">
     </a>
     1. 字符计数与编码模式相关信息（偏移量 0）
    </h3>
    <pre><code class="prism language-c"><span class="token class-name">uint8_t</span> glyph_cnt<span class="token punctuation">;</span>
<span class="token class-name">uint8_t</span> bbx_mode<span class="token punctuation">;</span>
<span class="token class-name">uint8_t</span> bits_per_0<span class="token punctuation">;</span>
<span class="token class-name">uint8_t</span> bits_per_1<span class="token punctuation">;</span>
</code></pre>
    <p>
     glyph_cnt：
     <br/>
     含义：表示字体中可用字符（字形，glyph）的数量。这有助于确定字体所能支持的字符范围。
     <br/>
     用途：在遍历字体中的字符时，可根据此值来控制循环范围。
     <br/>
     bbx_mode：
     <br/>
     含义：边界框（bounding box）模式。边界框用于定义字符的最小矩形区域，此模式决定了如何计算和使用这些边界框。
     <br/>
     用途：在进行字符布局和对齐时，根据不同的模式来确定字符的位置和大小。
     <br/>
     bits_per_0 和 bits_per_1：
     <br/>
     含义：分别表示编码中 “0” 和 “1” 所占用的位数。在字体的点阵数据编码中，不同的编码方式可能对 “0” 和 “1” 的表示位数有不同要求。
     <br/>
     用途：在解码字体点阵数据时，根据这些位数信息来正确解析数据。
    </p>
    <h3>
     <a id="2__4_18">
     </a>
     2. 字符尺寸编码位数信息（偏移量 4）
    </h3>
    <pre><code class="prism language-c"><span class="token class-name">uint8_t</span> bits_per_char_width<span class="token punctuation">;</span>
<span class="token class-name">uint8_t</span> bits_per_char_height<span class="token punctuation">;</span>
<span class="token class-name">uint8_t</span> bits_per_char_x<span class="token punctuation">;</span>
<span class="token class-name">uint8_t</span> bits_per_char_y<span class="token punctuation">;</span>
<span class="token class-name">uint8_t</span> bits_per_delta_x<span class="token punctuation">;</span>
bits_per_char_width：
</code></pre>
    <p>
     含义：表示字符宽度编码所占用的位数。
     <br/>
     用途：在读取字体数据中字符宽度信息时，根据此位数进行解析。
     <br/>
     bits_per_char_height：
     <br/>
     含义：表示字符高度编码所占用的位数。
     <br/>
     用途：同理，用于解析字符高度信息。
     <br/>
     bits_per_char_x 和 bits_per_char_y：
     <br/>
     含义：分别表示字符在 X 轴和 Y 轴上位置编码所占用的位数。
     <br/>
     用途：用于确定字符在字体中的具体位置。
     <br/>
     bits_per_delta_x：
     <br/>
     含义：表示字符在 X 轴上的偏移量编码所占用的位数。
     <br/>
     用途：在进行字符布局时，根据此偏移量来调整字符之间的间距。
    </p>
    <h3>
     <a id="3__9_38">
     </a>
     3. 字符最大尺寸与偏移信息（偏移量 9）
    </h3>
    <pre><code class="prism language-c"><span class="token class-name">int8_t</span> max_char_width<span class="token punctuation">;</span>
<span class="token class-name">int8_t</span> max_char_height<span class="token punctuation">;</span> 
<span class="token class-name">int8_t</span> x_offset<span class="token punctuation">;</span>
<span class="token class-name">int8_t</span> y_offset<span class="token punctuation">;</span>
max_char_width：
</code></pre>
    <p>
     含义：字体中字符的最大宽度。
     <br/>
     用途：在进行文本布局时，可根据此值来估算一行文本所需的最大宽度。
     <br/>
     max_char_height：
     <br/>
     含义：字体中字符的最大高度，注意这里是整体高度，而不是上升高度（ascent）。上升高度等于 max_char_height + y_offset。
     <br/>
     用途：用于确定文本行的高度。
     <br/>
     x_offset 和 y_offset：
     <br/>
     含义：分别表示字符在 X 轴和 Y 轴上的偏移量。
     <br/>
     用途：在绘制字符时，根据这些偏移量来调整字符的位置。
    </p>
    <h3>
     <a id="4__13_54">
     </a>
     4. 字符上升和下降高度信息（偏移量 13）
    </h3>
    <pre><code class="prism language-c"><span class="token class-name">int8_t</span>  ascent_A<span class="token punctuation">;</span>
<span class="token class-name">int8_t</span>  descent_g<span class="token punctuation">;</span>
<span class="token class-name">int8_t</span>  ascent_para<span class="token punctuation">;</span>
<span class="token class-name">int8_t</span>  descent_para<span class="token punctuation">;</span>
</code></pre>
    <p>
     ascent_A：
     <br/>
     含义：大写字母 “A” 的上升高度，即字符从基线（baseline）到最高点的距离。
     <br/>
     用途：在文本布局中，用于确定文本行的顶部位置。
     <br/>
     descent_g：
     <br/>
     含义：小写字母 “g” 的下降高度，通常为负值，表示字符从基线到最低点的距离。
     <br/>
     用途：用于确定文本行的底部位置。
     <br/>
     ascent_para 和 descent_para：
     <br/>
     含义：分别表示段落的上升高度和下降高度，可能用于处理多行文本的布局。
     <br/>
     用途：在进行段落排版时，根据这些值来调整行间距和段落的整体布局。
    </p>
    <h3>
     <a id="5__17_70">
     </a>
     5. 字符起始位置信息（偏移量 17）
    </h3>
    <pre><code class="prism language-c"><span class="token class-name">uint16_t</span> start_pos_upper_A<span class="token punctuation">;</span>
<span class="token class-name">uint16_t</span> start_pos_lower_a<span class="token punctuation">;</span> 
start_pos_upper_A：
</code></pre>
    <p>
     含义：大写字母 “A” 在字体数据中的起始位置。
     <br/>
     用途：在查找大写字母 “A” 的点阵数据时，根据此位置进行定位。
     <br/>
     start_pos_lower_a：
     <br/>
     含义：小写字母 “a” 在字体数据中的起始位置。
     <br/>
     用途：同理，用于查找小写字母 “a” 的点阵数据。
    </p>
    <h3>
     <a id="6_Unicode__21_81">
     </a>
     6. Unicode 字符起始位置信息（偏移量 21，可选）
    </h3>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">U8G2_WITH_UNICODE  </span></span>
<span class="token class-name">uint16_t</span> start_pos_unicode<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre>
    <p>
     start_pos_unicode：
     <br/>
     含义：如果启用了 Unicode 支持（U8G2_WITH_UNICODE 宏定义），此成员表示 Unicode 字符在字体数据中的起始位置。
     <br/>
     用途：在处理 Unicode 字符时，根据此位置来查找相应的点阵数据。
     <br/>
     综上所述，u8g2_font_info_t 结构体通过存储字体的各种信息，为 U8g2 库在文本渲染和布局过程中提供了必要的参数，确保能够正确地显示和排版文本。
    </p>
    <h2>
     <a id="u8g2_draw_string_91">
     </a>
     u8g2_draw_string
    </h2>
    <p>
     函数定义和参数
    </p>
    <pre><code class="prism language-c"><span class="token keyword">static</span> <span class="token class-name">u8g2_uint_t</span> <span class="token function">u8g2_draw_string</span><span class="token punctuation">(</span><span class="token class-name">u8g2_t</span> <span class="token operator">*</span>u8g2<span class="token punctuation">,</span> <span class="token class-name">u8g2_uint_t</span> x<span class="token punctuation">,</span> <span class="token class-name">u8g2_uint_t</span> y<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">)</span>
</code></pre>
    <p>
     static：表示该函数是一个静态函数，其作用域仅限于当前文件。
     <br/>
     返回值：u8g2_uint_t 类型，返回绘制整个字符串所占用的水平或垂直总长度（根据字体旋转方向而定）。
     <br/>
     参数：
     <br/>
     u8g2_t *u8g2：指向 u8g2_t 结构体的指针，该结构体包含了 U8g2 库的上下文信息，如显示屏设置、字体信息等。
     <br/>
     u8g2_uint_t x 和 u8g2_uint_t y：指定字符串绘制的起始坐标。
     <br/>
     const char *str：指向要绘制的字符串的指针。
     <br/>
     变量声明
    </p>
    <pre><code class="prism language-c"><span class="token class-name">uint16_t</span> e<span class="token punctuation">;</span>
<span class="token class-name">u8g2_uint_t</span> delta<span class="token punctuation">,</span> sum<span class="token punctuation">;</span>
</code></pre>
    <p>
     e：用于存储从字符串中解码出的 Unicode 字符编码。
     <br/>
     delta：表示绘制单个字符所占用的水平或垂直长度。
     <br/>
     sum：用于累加绘制整个字符串所占用的总长度。
     <br/>
     UTF - 8 初始化
    </p>
    <pre><code class="prism language-c"><span class="token function">u8x8_utf8_init</span><span class="token punctuation">(</span><span class="token function">u8g2_GetU8x8</span><span class="token punctuation">(</span>u8g2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     调用 u8x8_utf8_init 函数对 UTF - 8 解码进行初始化，确保后续能正确处理 UTF - 8 编码的字符串。u8g2_GetU8x8(u8g2) 用于获取 u8g2 结构体中关联的 u8x8 上下文。
     <br/>
     初始化总长度
    </p>
    <pre><code class="prism language-c">sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     将 sum 初始化为 0，用于后续累加字符绘制的长度。
     <br/>
     字符串处理循环
    </p>
    <pre><code class="prism language-c"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    e <span class="token operator">=</span> u8g2<span class="token operator">-&gt;</span>u8x8<span class="token punctuation">.</span><span class="token function">next_cb</span><span class="token punctuation">(</span><span class="token function">u8g2_GetU8x8</span><span class="token punctuation">(</span>u8g2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token punctuation">)</span><span class="token operator">*</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> e <span class="token operator">==</span> <span class="token number">0x0ffff</span> <span class="token punctuation">)</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    str<span class="token operator">++</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     u8g2-&gt;u8x8.next_cb 是一个回调函数，用于从字符串中解码出下一个 Unicode 字符编码。
     <br/>
     如果解码结果为 0x0ffff，表示已经到达字符串的末尾，此时跳出循环。
     <br/>
     每次解码后，将字符串指针 str 向后移动一位。
     <br/>
     绘制字符
    </p>
    <pre><code class="prism language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span> e <span class="token operator">!=</span> <span class="token number">0x0fffe</span> <span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    delta <span class="token operator">=</span> <span class="token function">u8g2_DrawGlyph</span><span class="token punctuation">(</span>u8g2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     如果解码结果不是 0x0fffe（表示无效字符），则调用 u8g2_DrawGlyph 函数在指定位置 (x, y) 绘制该 Unicode 字符。该函数返回绘制该字符所占用的水平或垂直长度，存储在 delta 中。
     <br/>
     处理字体旋转
    </p>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">U8G2_WITH_FONT_ROTATION</span></span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>u8g2<span class="token operator">-&gt;</span>font_decode<span class="token punctuation">.</span>dir<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
            x <span class="token operator">+=</span> delta<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
            y <span class="token operator">+=</span> delta<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
            x <span class="token operator">-=</span> delta<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
            y <span class="token operator">-=</span> delta<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/*
    // requires 10 bytes more on avr
    x = u8g2_add_vector_x(x, delta, 0, u8g2-&gt;font_decode.dir);
    y = u8g2_add_vector_y(y, delta, 0, u8g2-&gt;font_decode.dir);
    */</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
    x <span class="token operator">+=</span> delta<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre>
    <p>
     启用字体旋转支持（U8G2_WITH_FONT_ROTATION 宏定义）：
     <br/>
     根据 u8g2-&gt;font_decode.dir 的值（表示字体旋转方向），更新下一个字符的绘制位置。
     <br/>
     case 0：正常水平方向，x 坐标增加 delta。
     <br/>
     case 1：顺时针旋转 90 度，y 坐标增加 delta。
     <br/>
     case 2：顺时针旋转 180 度，x 坐标减少 delta。
     <br/>
     case 3：顺时针旋转 270 度，y 坐标减少 delta。
     <br/>
     注释掉的代码 u8g2_add_vector_x 和 u8g2_add_vector_y 是另一种实现方式，但会增加 AVR 平台的代码大小。
     <br/>
     未启用字体旋转支持：默认情况下，水平方向绘制，x 坐标增加 delta。
     <br/>
     累加总长度
    </p>
    <pre><code class="prism language-c">sum <span class="token operator">+=</span> delta<span class="token punctuation">;</span>    
</code></pre>
    <p>
     将当前字符绘制所占用的长度 delta 累加到 sum 中。
     <br/>
     返回总长度
    </p>
    <pre><code class="prism language-c"><span class="token keyword">return</span> sum<span class="token punctuation">;</span>
</code></pre>
    <p>
     循环结束后，返回绘制整个字符串所占用的总长度。
    </p>
    <h2>
     <a id="UFT8UFT8_186">
     </a>
     UFT8解码函数（将中文变成UFT8解码）
    </h2>
    <pre><code class="prism language-c"><span class="token class-name">uint16_t</span> <span class="token function">u8x8_utf8_next</span><span class="token punctuation">(</span><span class="token class-name">u8x8_t</span> <span class="token operator">*</span>u8x8<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> b<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> b <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> b <span class="token operator">==</span> <span class="token char">'\n'</span> <span class="token punctuation">)</span>	<span class="token comment">/* '\n' terminates the string to support the string list procedures */</span>
    <span class="token keyword">return</span> <span class="token number">0x0ffff</span><span class="token punctuation">;</span>	<span class="token comment">/* end of string detected, pending UTF8 is discarded */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> u8x8<span class="token operator">-&gt;</span>utf8_state <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> b <span class="token operator">&gt;=</span> <span class="token number">0xfc</span> <span class="token punctuation">)</span>	<span class="token comment">/* 6 byte sequence */</span>
    <span class="token punctuation">{<!-- --></span>
      u8x8<span class="token operator">-&gt;</span>utf8_state <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
      b <span class="token operator">&amp;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> b <span class="token operator">&gt;=</span> <span class="token number">0xf8</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
      u8x8<span class="token operator">-&gt;</span>utf8_state <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
      b <span class="token operator">&amp;=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> b <span class="token operator">&gt;=</span> <span class="token number">0xf0</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
      u8x8<span class="token operator">-&gt;</span>utf8_state <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
      b <span class="token operator">&amp;=</span> <span class="token number">7</span><span class="token punctuation">;</span>      
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> b <span class="token operator">&gt;=</span> <span class="token number">0xe0</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
      u8x8<span class="token operator">-&gt;</span>utf8_state <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
      b <span class="token operator">&amp;=</span> <span class="token number">15</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> b <span class="token operator">&gt;=</span> <span class="token number">0xc0</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
      u8x8<span class="token operator">-&gt;</span>utf8_state <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      b <span class="token operator">&amp;=</span> <span class="token number">0x01f</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token comment">/* do nothing, just use the value as encoding */</span>
      <span class="token keyword">return</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    u8x8<span class="token operator">-&gt;</span>encoding <span class="token operator">=</span> b<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0x0fffe</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">{<!-- --></span> 
    u8x8<span class="token operator">-&gt;</span>utf8_state<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token comment">/* The case b &lt; 0x080 (an illegal UTF8 encoding) is not checked here. */</span>
    u8x8<span class="token operator">-&gt;</span>encoding<span class="token operator">&lt;&lt;=</span><span class="token number">6</span><span class="token punctuation">;</span>
    b <span class="token operator">&amp;=</span> <span class="token number">0x03f</span><span class="token punctuation">;</span>
    u8x8<span class="token operator">-&gt;</span>encoding <span class="token operator">|=</span> b<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> u8x8<span class="token operator">-&gt;</span>utf8_state <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token number">0x0fffe</span><span class="token punctuation">;</span>	<span class="token comment">/* nothing to do yet */</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> u8x8<span class="token operator">-&gt;</span>encoding<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="__Unicode__240">
     </a>
     一个例子**“世界” 的 Unicode 编码及解析过程**
    </h3>
    <ol>
     <li>
      Unicode 编码结果
      <br/>
      世：U+4E16
      <br/>
      界：U+754C
     </li>
     <li>
      UTF-8 编码解析过程
      <br/>
      根据 UTF-8 编码规则，将 Unicode 代码点转换为字节序列的步骤如下：
      <br/>
      “世”（U+4E16）的编码
      <br/>
      代码点转换为二进制
      <br/>
      U+4E16 → 二进制 0100 1110 0001 0110。
      <br/>
      按三字节格式拆分
      <br/>
      UTF-8 三字节格式为：
      <br/>
      plaintext
      <br/>
      1110xxxx 10xxxxyy 10yyyyyy
     </li>
    </ol>
    <p>
     将二进制位分配到各字段：
     <br/>
     第一部分（4 位）：0100
     <br/>
     第二部分（6 位）：111000
     <br/>
     第三部分（6 位）：010110
     <br/>
     生成字节序列
     <br/>
     第一字节：1110 0100 → 0xE4
     <br/>
     第二字节：10 111000 → 0xB8
     <br/>
     第三字节：10 010110 → 0x96
    </p>
    <p>
     最终 UTF-8 编码：E4 B8 96。
     <br/>
     “界”（U+754C）的编码
     <br/>
     代码点转换为二进制
     <br/>
     U+754C → 二进制 0111 0101 0100 1100。
     <br/>
     按三字节格式拆分
     <br/>
     第一部分（4 位）：0111
     <br/>
     第二部分（6 位）：010101
     <br/>
     第三部分（6 位）：001100
     <br/>
     生成字节序列
     <br/>
     第一字节：1110 0111 → 0xE7
     <br/>
     第二字节：10 010101 → 0x95
     <br/>
     第三字节：10 001100 → 0x8C
    </p>
    <p>
     最终 UTF-8 编码：E7 95 8C。
     <br/>
     <strong>
      3. 结合u8x8_utf8_next函数的处理逻辑
     </strong>
     <br/>
     当函数依次处理 “世界” 的 UTF-8 字节E4 B8 96 E7 95 8C时：
     <br/>
     处理E4（0xE4）
     <br/>
     b = 0xE4，判断为三字节序列（0xE0 ≤ b &lt; 0xF0）。
     <br/>
     utf8_state设为 2，encoding保存0x16（E4的低 4 位），返回0x0fffe。
     <br/>
     处理B8（0xB8）
     <br/>
     utf8_state减为 1，encoding左移 6 位，合并B8的低 6 位（0x18）。
     <br/>
     encoding = 0x16 &lt;&lt; 6 | 0x18 = 0x1618，返回0x0fffe。
     <br/>
     处理96（0x96）
     <br/>
     utf8_state减为 0，encoding左移 6 位，合并96的低 6 位（0x16）。
     <br/>
     encoding = 0x1618 &lt;&lt; 6 | 0x16 = 0x4E16，返回0x4E16（“世” 的 Unicode 编码）。
     <br/>
     处理E7（0xE7）
     <br/>
     重复上述步骤，最终返回0x754C（“界” 的 Unicode 编码）。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="687474:70733a2f2f626c6f672e6373646e2e6e65742f79796279672f:61727469636c652f64657461696c732f313436323333333538" class_="artid" style="display:none">
 </p>
</div>


