---
layout: post
title: "SpringMVC三响应处理"
date: 2025-03-13 10:13:09 +0800
description: "创建 POJO 实例并填充属性，Spring 自动转换属性名为 JSON 字段（如。快速构建 RESTful API，返回结构化数据（如查询用户信息）。类注解，自动将方法返回值序列化为 JSON（无需。将文件流包装为响应体，避免直接加载文件到内存。声明文件大小（非必须，但利于浏览器进度显示）。会将文件全部读入内存，大文件易导致 OOM。封装响应实体，精确控制状态码、头部和正文。）会被处理为 JSON 数组。无需手动处理响应头或内容协商。流式返回，无需预读字节。触发浏览器下载行为。，可能导致流关闭异常。"
keywords: "SpringMVC（三）响应处理"
categories: ['Ssm']
tags: ['Spring', 'Java']
artid: "146214718"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146214718
    alt: "SpringMVC三响应处理"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146214718
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146214718
cover: https://bing.ee123.net/img/rand?artid=146214718
image: https://bing.ee123.net/img/rand?artid=146214718
img: https://bing.ee123.net/img/rand?artid=146214718
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     SpringMVC（三）响应处理
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <hr id="hr-toc" name="tableOfContents"/>
    <p>
    </p>
    <h4 id="" name="">
    </h4>
    <h4 id="%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%9A" name="%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%9A">
     响应数据类型：
    </h4>
    <p>
     <img alt="" height="995" src="https://i-blog.csdnimg.cn/direct/e0f0846d4447469e85d3af77fb412b9f.png" width="1627"/>
    </p>
    <h4 id="%E4%B8%80%E3%80%81%E8%87%AA%E5%8A%A8%20JSON%20%E5%93%8D%E5%BA%94" name="%E4%B8%80%E3%80%81%E8%87%AA%E5%8A%A8%20JSON%20%E5%93%8D%E5%BA%94">
     <strong>
      一、自动 JSON 响应
     </strong>
    </h4>
    <h5 id="1%20%E5%AE%9E%E7%8E%B0%E8%A7%A3%E6%9E%90" name="1%20%E5%AE%9E%E7%8E%B0%E8%A7%A3%E6%9E%90">
     <strong>
      1 实现解析
     </strong>
    </h5>
    <ol>
     <li>
      <p>
       <strong>
        <code>
         @RestController
        </code>
        作用
       </strong>
      </p>
      <ul>
       <li>
        <p>
         类注解，自动将方法返回值序列化为 JSON（无需
         <code>
          @ResponseBody
         </code>
         注解）。
        </p>
       </li>
       <li>
        <p>
         底层依赖
         <code>
          HttpMessageConverter
         </code>
         （如
         <code>
          Jackson
         </code>
         库）。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        <code>
         emailUsers
        </code>
        对象封装
       </strong>
      </p>
      <ul>
       <li>
        <p>
         创建 POJO 实例并填充属性，Spring 自动转换属性名为 JSON 字段（如
         <code>
          account → "account"
         </code>
         ）。
        </p>
       </li>
       <li>
        <p>
         复杂属性（如
         <code>
          String[] hobby
         </code>
         ）会被处理为 JSON 数组。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        适用场景
       </strong>
      </p>
      <ul>
       <li>
        <p>
         快速构建 RESTful API，返回结构化数据（如查询用户信息）。
        </p>
       </li>
       <li>
        <p>
         无需手动处理响应头或内容协商。
        </p>
       </li>
      </ul>
     </li>
    </ol>
    <pre><code class="language-java">    // 会自动将返回值封装成JSON格式返回给客户端
    @RequestMapping("/request01")
    public emailUsers handleRequest() {
        emailUsers emailUser = new emailUsers();
        emailUser.setAccount("zhangsan");
        emailUser.setPw("123456");
        emailUser.setGender("男");
        emailUser.setHid("1");
        emailUser.setPlace("北京");
        emailUser.setOther("无");
        emailUser.setHobby(new String[]{"打球", "看电影" });
        System.out.println(emailUser);
        return emailUser;
    }</code></pre>
    <p>
    </p>
    <h4 id="%E4%BA%8C%E3%80%81%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD" name="%E4%BA%8C%E3%80%81%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD">
     <strong>
      二、文件下载
     </strong>
    </h4>
    <h5 id="1%20%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0" name="1%20%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0">
     <strong>
      1 核心实现
     </strong>
    </h5>
    <ol>
     <li>
      <p>
       <strong>
        <code>
         ResponseEntity&lt;InputStreamResource&gt;
        </code>
       </strong>
      </p>
      <ul>
       <li>
        <p>
         封装响应实体，精确控制状态码、头部和正文。
        </p>
       </li>
       <li>
        <p>
         <code>
          InputStreamResource
         </code>
         将文件流包装为响应体，避免直接加载文件到内存。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        关键配置
       </strong>
      </p>
      <ul>
       <li>
        <p>
         <strong>
          文件名编码
         </strong>
         ：
         <code>
          URLEncoder.encode()
         </code>
         解决中文乱码。
        </p>
       </li>
       <li>
        <p>
         <strong>
          内容类型
         </strong>
         ：
         <code>
          MediaType.APPLICATION_OCTET_STREAM
         </code>
         表示二进制流。
        </p>
       </li>
       <li>
        <p>
         <strong>
          内容长度
         </strong>
         ：
         <code>
          contentLength()
         </code>
         声明文件大小（非必须，但利于浏览器进度显示）。
        </p>
       </li>
       <li>
        <p>
         <strong>
          下载头
         </strong>
         ：
         <code>
          Content-Disposition
         </code>
         触发浏览器下载行为。
        </p>
       </li>
      </ul>
     </li>
    </ol>
    <h5 id="2%20%E4%BC%98%E5%8C%96%E4%B8%8E%E9%97%AE%E9%A2%98" name="2%20%E4%BC%98%E5%8C%96%E4%B8%8E%E9%97%AE%E9%A2%98">
     <strong>
      2 优化与问题
     </strong>
    </h5>
    <ol>
     <li>
      <p>
       <strong>
        大文件处理
       </strong>
      </p>
      <ul>
       <li>
        <p>
         <strong>
          问题
         </strong>
         ：
         <code>
          inputStream.readAllBytes()
         </code>
         会将文件全部读入内存，大文件易导致 OOM。
        </p>
       </li>
       <li>
        <p>
         <strong>
          解决
         </strong>
         ：直接传递
         <code>
          InputStreamResource
         </code>
         流式返回，无需预读字节。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        资源关闭问题
       </strong>
      </p>
      <ul>
       <li>
        <p>
         <strong>
          风险
         </strong>
         ：
         <code>
          inputStream.close()
         </code>
         后仍返回
         <code>
          InputStreamResource
         </code>
         ，可能导致流关闭异常。
        </p>
       </li>
       <li>
        <p>
         <strong>
          建议
         </strong>
         ：使用
         <code>
          try-with-resources
         </code>
         或确保流在响应结束后关闭（如通过
         <code>
          FileSystemResource
         </code>
         自动管理）。
        </p>
       </li>
      </ul>
     </li>
    </ol>
    <pre><code class="language-java">    /**
     * 文件下载
     * HttpEntity：拿到整个响应数据（响应头，响应体，状态码）
     * 1 文件名中文会乱码
     * 2 文件太大会内存溢出
     */

    @RequestMapping("/request02")
    public ResponseEntity&lt;InputStreamResource&gt; handleRequest02() throws IOException {

        FileInputStream inputStream = new FileInputStream("D:\\test.txt");
        byte[] bytes = inputStream.readAllBytes();
        //解决中文乱码
        String encode = URLEncoder.encode("文本.txt", StandardCharsets.UTF_8);
        //解决文件太大内存溢出
        InputStreamResource resource = new InputStreamResource(inputStream);
        inputStream.close();

        return ResponseEntity.ok()
                //文件类型
                .contentType(MediaType.APPLICATION_OCTET_STREAM)
                //内容大小
                .contentLength(inputStream.available())
                //内容处理方式
                .header("Content-Disposition", "attachment;filename=" + encode)
                .body(resource);
    }</code></pre>
    <h2 id="" name="">
    </h2>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330325f37393834373833312f:61727469636c652f64657461696c732f313436323134373138" class_="artid" style="display:none">
 </p>
</div>


