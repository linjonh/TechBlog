---
layout: post
title: "Navigation的进阶知识与拦截器配置"
date: 2025-03-09 21:24:17 +0800
description: "Navigation的进阶知识与拦截器配置。"
keywords: "Navigation的进阶知识与拦截器配置"
categories: ['鸿蒙应用开发']
tags: ['鸿蒙', '华为', 'Harmonyos']
artid: "146139025"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146139025
    alt: "Navigation的进阶知识与拦截器配置"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146139025
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146139025
cover: https://bing.ee123.net/img/rand?artid=146139025
image: https://bing.ee123.net/img/rand?artid=146139025
img: https://bing.ee123.net/img/rand?artid=146139025
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Navigation的进阶知识与拦截器配置
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
    </h2>
    <h2>
     <a id="Navigation_1">
     </a>
     Navigation的进阶知识与拦截器配置
    </h2>
    <ul>
     <li>
      写的不是很详细，后续有时间会补充，建议参考官方文档食用
     </li>
    </ul>
    <h3>
     <a id="1_7">
     </a>
     1.如何配置路由信息
    </h3>
    <h4>
     <a id="11__9">
     </a>
     1.1 创建工程结构
    </h4>
    <pre><code class="prism language-tex">src/main/ets
├── pages
│   └── navigation
│       ├── views
│       │   ├── Mine.ets      // 个人中心页
│       │   ├── Login.ets     // 登录页
│       │   └── ErrorPage.ets // 错误页
│       └── NavagationIndex.ets // 导航入口
├── routerMap.json5           // 路由配置文件

</code></pre>
    <h4>
     <a id="12_routerMapjson5_24">
     </a>
     1.2 核心路由配置解析（routerMap.json5）
    </h4>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"routerMap"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"mine"</span><span class="token punctuation">,</span>       <span class="token comment">// 路由唯一标识符</span>
      <span class="token string-property property">"buildFunction"</span><span class="token operator">:</span> <span class="token string">"MineBuilder"</span><span class="token punctuation">,</span>   
      <span class="token string-property property">"pageSourceFile"</span><span class="token operator">:</span> <span class="token string">"src/main/.../Mine.ets"</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ...其他路由项</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
    <blockquote>
     <p>
      关键字段含义
     </p>
    </blockquote>
    <table>
     <thead>
      <tr>
       <th>
        关键字段
       </th>
       <th>
        说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         name
        </code>
       </td>
       <td>
        路由标识符，用于编程式导航
       </td>
      </tr>
      <tr>
       <td>
        <code>
         buildFunction
        </code>
       </td>
       <td>
        页面构建器函数名（关联组件注册）
       </td>
      </tr>
      <tr>
       <td>
        <code>
         pageSourceFile
        </code>
       </td>
       <td>
        源代码文件位置（动态加载基础）
       </td>
      </tr>
     </tbody>
    </table>
    <h4>
     <a id="13__47">
     </a>
     1.3 案例演示
    </h4>
    <h5>
     <a id="1_49">
     </a>
     1.创建首页面
    </h5>
    <pre><code>@Entry
@Component
struct TextPage {
  @Provide
  navPathStack:NavPathStack = new NavPathStack()
  build() {
  Navigation(this.navPathStack){
    Text('这是首页')
      Button('跳到下一页去')
      .onClick(()=&gt;{
        this.navPathStack.pushPath({name:'nextOne'})
      })
  }
  }
}
</code></pre>
    <h5>
     <a id="2_69">
     </a>
     2.创建子页面（跳转页面）
    </h5>
    <pre><code>@Builder
function PageOne() {
  TextPage_()
}

@Component
struct TextPage_ {
  @Consume
  navPathStack: NavPathStack

  build() {
    NavDestination() {
      Text('这是我从首页面跳过来的第一个页面')
      Image($r('app.media.Cover'))
        .width(100)
        .aspectRatio(1)
      Button('跳到第三个页面去')
        .onClick(() =&gt; {
          this.navPathStack.pushPath({ name: 'pageTwo' })
        })
    }
  }
}

@Builder
function PageTwo() {
  TextPage2_()
}

@Component
struct TextPage2_ {
  build() {
    NavDestination() {
      Text('这是我从首页面跳过来的第二个页面')
      Image($r('app.media.Cover2'))
        .width(100)
        .aspectRatio(1)
    }

  }
}

</code></pre>
    <h5>
     <a id="3jsonmap_116">
     </a>
     3.配置json.map映射路径
    </h5>
    <pre><code>   {
      "name": "nextOne",
      "buildFunction": "PageOne",
      "pageSourceFile": "src/main/ets/pages/TextPage_.ets"
    },
    {
      "name": "pageTwo",
      "buildFunction": "PageTwo",
      "pageSourceFile": "src/main/ets/pages/TextPage_.ets"
    }
</code></pre>
    <h5>
     <a id="4_131">
     </a>
     4.效果展示
    </h5>
    <p>
     <img alt="img" src="https://i-blog.csdnimg.cn/img_convert/9ec2fa19fd1ef696aa605979365a3ba6.gif"/>
    </p>
    <h3>
     <a id="2NavagationIndexets_135">
     </a>
     2.导航入口组件实现（NavagationIndex.ets）
    </h3>
    <h4>
     <a id="1_137">
     </a>
     1.组件结构
    </h4>
    <pre><code class="prism language-ts"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Entry</span></span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span>
struct NavagationIndex <span class="token punctuation">{<!-- --></span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Provide</span></span> navPathStack<span class="token operator">:</span> NavPathStack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NavPathStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  
  <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">Navigation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>navPathStack<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 初始页面内容</span>
      <span class="token function">Button</span><span class="token punctuation">(</span><span class="token string">'跳转至-我的'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>navPathStack<span class="token punctuation">.</span><span class="token function">pushPath</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>name<span class="token operator">:</span> <span class="token string">'mine'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token function">mode</span><span class="token punctuation">(</span>NavigationMode<span class="token punctuation">.</span>Auto<span class="token punctuation">)</span> <span class="token comment">// 跨设备适配</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h4>
     <a id="2_158">
     </a>
     2.导航模式说明
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        模式
       </th>
       <th>
        适用场景
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        NavigationMode.Stack
       </td>
       <td>
        单页面栈模式（移动端）
       </td>
      </tr>
      <tr>
       <td>
        NavigationMode.Split
       </td>
       <td>
        分栏模式（平板/PC）
       </td>
      </tr>
      <tr>
       <td>
        NavigationMode.Auto
       </td>
       <td>
        自动适配设备
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="3_166">
     </a>
     3.拦截器配置
    </h3>
    <h5>
     <a id="1_168">
     </a>
     1.拦截器注册时机
    </h5>
    <pre><code class="prism language-ts"><span class="token punctuation">.</span><span class="token function">onAppear</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerInterceptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="2__176">
     </a>
     2. 拦截逻辑流程图解
    </h5>
    <p>
     <img alt="image-20250309205538032" src="https://i-blog.csdnimg.cn/img_convert/58a2c5e7514220c619a09ab242b34433.png"/>
    </p>
    <h4>
     <a id="3__180">
     </a>
     3. 关键拦截逻辑代码
    </h4>
    <pre><code class="prism language-ts"><span class="token keyword">const</span> token <span class="token operator">=</span> AppStorage<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token operator">!</span> <span class="token keyword">as</span> <span class="token builtin">string</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>pathInfo<span class="token operator">?.</span>name <span class="token operator">===</span> <span class="token string">'mine'</span> <span class="token operator">&amp;&amp;</span> token <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 拦截动作分解</span>
  t<span class="token punctuation">.</span>pathStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 移除无效跳转</span>
  t<span class="token punctuation">.</span>pathStack<span class="token punctuation">.</span><span class="token function">pushPath</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>      <span class="token comment">// 重定向到登录页</span>
    name<span class="token operator">:</span> <span class="token string">"login"</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="4_193">
     </a>
     4.错误处理机制
    </h5>
    <pre><code class="prism language-ts"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>t<span class="token punctuation">.</span>pathInfo <span class="token operator">&amp;&amp;</span> f<span class="token punctuation">.</span>pathInfo<span class="token punctuation">.</span>name <span class="token operator">!==</span> <span class="token string">'error'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  f<span class="token punctuation">.</span>pathStack<span class="token punctuation">.</span><span class="token function">pushPath</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>name<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 注入错误页</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="5_202">
     </a>
     5.代码示例
    </h5>
    <pre><code class="prism language-ts"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> promptAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@kit.ArkUI'</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Entry</span></span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span>
struct NavagationIndex <span class="token punctuation">{<!-- --></span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Provide</span></span>
  navPathStack<span class="token operator">:</span> NavPathStack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NavPathStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token function">registerInterceptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>navPathStack<span class="token punctuation">.</span><span class="token function">setInterception</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token comment">//f从哪来，t到哪去</span>
      <span class="token function-variable function">willShow</span><span class="token operator">:</span> <span class="token punctuation">(</span>f<span class="token punctuation">,</span> t<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> t <span class="token operator">===</span> <span class="token string">'string'</span><span class="token operator">||</span><span class="token keyword">typeof</span> f <span class="token operator">===</span><span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//f可能是首页跳过来的</span>
        <span class="token comment">//必须加个逻辑与</span>
        <span class="token comment">// if(!t.pathInfo &amp;&amp; f.pathInfo.name !='error'){<!-- --></span>
        <span class="token comment">//   f.pathStack.pushPath({name:'error'})</span>
        <span class="token comment">//   return</span>
        <span class="token comment">//   //返回不好返回</span>
        <span class="token comment">// }</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>pathInfo<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'mine'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          promptAction<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            message<span class="token operator">:</span> <span class="token string">'拦截到我要去mine'</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token comment">//拦截你 不让你跳</span>
          <span class="token comment">// t.pathStack.pop()</span>
          <span class="token keyword">const</span> token <span class="token operator">=</span> AppStorage<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token operator">!</span> <span class="token keyword">as</span> <span class="token builtin">string</span> <span class="token operator">||</span> <span class="token string">''</span>
          <span class="token comment">//拦截！！！</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>token <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            t<span class="token punctuation">.</span>pathStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">//去登录</span>
            t<span class="token punctuation">.</span>pathStack<span class="token punctuation">.</span><span class="token function">pushPath</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
              name<span class="token operator">:</span> <span class="token string">"login"</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>

      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">//t 跳转之后的拦截</span>
      <span class="token function-variable function">didShow</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>

      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">Navigation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>navPathStack<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">//还没有进行跳转，但是已经有展示的内容了</span>
      <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'这是我的首页'</span><span class="token punctuation">)</span>
      <span class="token function">Button</span><span class="token punctuation">(</span><span class="token string">'跳转至-我的'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>navPathStack<span class="token punctuation">.</span><span class="token function">pushPath</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            name<span class="token operator">:</span> <span class="token string">'mine'</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token function">onAppear</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerInterceptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token string">'100%'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token string">'100%'</span><span class="token punctuation">)</span>
    <span class="token comment">//跨设备</span>
    <span class="token punctuation">.</span><span class="token function">mode</span><span class="token punctuation">(</span>NavigationMode<span class="token punctuation">.</span>Auto<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e63:73646e2e6e65742f5969686f6e67313833333130303139382f:61727469636c652f64657461696c732f313436313339303235" class_="artid" style="display:none">
 </p>
</div>


