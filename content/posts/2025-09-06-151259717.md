---
layout: post
title: "RPC-å’Œ-HTTP-çš„åŒºåˆ«"
date: 2025-09-06T17:38:16+0800
description: "RPC å’Œ HTTP çš„åŒºåˆ«ï¼ğŸ‰"
keywords: "RPC å’Œ HTTP çš„åŒºåˆ«"
categories: ['æœªåˆ†ç±»']
tags: ['ç½‘ç»œåè®®', 'Rpc', 'Http']
artid: "151259717"
arturl: "https://blog.csdn.net/qq_56158663/article/details/151259717"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=151259717
    alt: "RPC-å’Œ-HTTP-çš„åŒºåˆ«"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=151259717
featuredImagePreview: https://bing.ee123.net/img/rand?artid=151259717
cover: https://bing.ee123.net/img/rand?artid=151259717
image: https://bing.ee123.net/img/rand?artid=151259717
img: https://bing.ee123.net/img/rand?artid=151259717
---



# RPC å’Œ HTTP çš„åŒºåˆ«



![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/0a71b47705c44f53853e4e9c1cd5de7d.gif#pic_center)

#### æ ¸å¿ƒæ€æƒ³ï¼šä¸€ä¸ªç®€å•çš„æ¯”å–»

åœ¨æˆ‘ä»¬æ·±å…¥æŠ€æœ¯ç»†èŠ‚ä¹‹å‰ï¼Œå…ˆç”¨ä¸€ä¸ªæ¯”å–»æ¥å¸®åŠ©ç†è§£ï¼š

* **HTTP å°±åƒå»é¤å…ç‚¹é¤**ï¼š

  + ä½ ï¼ˆå®¢æˆ·ç«¯ï¼‰çœ‹ç€ä¸€ä»½æ ‡å‡†èœå•ï¼ˆHTTPæ–¹æ³•ï¼šGET, POST, PUT, DELETEï¼‰ã€‚
  + ä½ å‘Šè¯‰æœåŠ¡å‘˜ï¼ˆç½‘ç»œï¼‰ï¼šâ€œæˆ‘æƒ³è¦ä¸€ä»½å®«ä¿é¸¡ä¸â€ï¼ˆURL: `/dishes/kung-pao-chicken`ï¼‰ï¼Œè¿™æ˜¯â€œè·å–â€ï¼ˆGETï¼‰æ“ä½œã€‚
  + æœåŠ¡å‘˜ç»™ä½ ç«¯ä¸Šèœï¼ˆå“åº”ï¼‰ã€‚
  + æ•´ä¸ªè¿‡ç¨‹æ˜¯æ ‡å‡†åŒ–çš„ï¼Œä½ å…³å¿ƒçš„æ˜¯â€œèµ„æºâ€ï¼ˆèœå“ï¼‰ï¼Œå¹¶é€šè¿‡æ ‡å‡†åŠ¨ä½œï¼ˆç‚¹é¤ã€åŠ èœï¼‰æ¥æ“ä½œå®ƒã€‚ä½ ä¸éœ€è¦çŸ¥é“åå¨æ˜¯æ€ä¹ˆåšçš„ã€‚
* **RPC å°±åƒç›´æ¥ç»™å¨å¸ˆæ‰“ç”µè¯**ï¼š

  + ä½ ï¼ˆå®¢æˆ·ç«¯ï¼‰æœ‰ä¸€æœ¬å¨å¸ˆçš„â€œæŠ€èƒ½æ‰‹å†Œâ€ï¼ˆæœåŠ¡æ¥å£å®šä¹‰ï¼Œå¦‚ `.proto` æ–‡ä»¶ï¼‰ã€‚
  + ä½ ç›´æ¥åœ¨ç”µè¯é‡Œå¯¹å¨å¸ˆï¼ˆæœåŠ¡ç«¯ï¼‰è¯´ï¼šâ€œå¸®æˆ‘**åšä¸€ä»½**ï¼ˆæ–¹æ³•å: `makeDish`ï¼‰**ç‰¹è¾£çš„**ï¼ˆå‚æ•°: `spiceLevel="extra_hot"`ï¼‰**å®«ä¿é¸¡ä¸**ï¼ˆå‚æ•°: `dishName="kung-pao-chicken"`ï¼‰â€ã€‚
  + ä½ è°ƒç”¨çš„æ˜¯ä¸€ä¸ªå…·ä½“çš„**åŠ¨ä½œï¼ˆæ–¹æ³•ï¼‰**ï¼Œè€Œä¸æ˜¯æ“ä½œä¸€ä¸ªèµ„æºã€‚è¿™ä¸ªè°ƒç”¨è¿‡ç¨‹å°±åƒåœ¨è°ƒç”¨ä½ è‡ªå·±æœ¬åœ°ä»£ç é‡Œçš„ä¸€ä¸ªæ–¹æ³•ä¸€æ ·ï¼Œç½‘ç»œç»†èŠ‚è¢«æ¡†æ¶éšè—äº†ã€‚

---

#### ä¸€ã€ æ¦‚å¿µä¸å®šä½

##### 1. HTTP (HyperText Transfer Protocol)

HTTPæ˜¯ä¸€ä¸ª**åº”ç”¨å±‚åè®®**ï¼Œæ˜¯äº’è”ç½‘ä¸Šæ•°æ®é€šä¿¡çš„åŸºç¡€ã€‚å®ƒæœ€åˆè¢«è®¾è®¡ç”¨æ¥ä¼ è¾“HTMLé¡µé¢ï¼Œä½†ç°åœ¨å·²æˆä¸ºäº¤æ¢ä»»ä½•ç±»å‹æ•°æ®çš„é€šç”¨åè®®ï¼ˆå¦‚ JSONã€XMLã€å›¾ç‰‡ç­‰ï¼‰ã€‚

å½“æˆ‘ä»¬è°ˆè®ºåœ¨åº”ç”¨ä¸­ä½¿ç”¨HTTPæ—¶ï¼Œé€šå¸¸æŒ‡çš„æ˜¯æ„å»º **RESTful API**ã€‚REST (Representational State Transfer) æ˜¯ä¸€ç§åŸºäºHTTPåè®®çš„**æ¶æ„é£æ ¼**ï¼Œå®ƒå¼ºè°ƒï¼š

* **èµ„æºï¼ˆResourceï¼‰**: ç³»ç»Ÿä¸­çš„ä¸€åˆ‡çš†ä¸ºèµ„æºï¼Œæ¯ä¸ªèµ„æºéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼ˆURIï¼‰ã€‚
* **è¡¨ç°å±‚ï¼ˆRepresentationï¼‰**: èµ„æºçš„è¡¨ç°å½¢å¼ï¼Œå¦‚JSONæˆ–XMLã€‚
* **çŠ¶æ€è½¬ç§»ï¼ˆState Transferï¼‰**: é€šè¿‡HTTPåŠ¨è¯ï¼ˆGET, POST, PUT, DELETE, PATCHï¼‰å¯¹èµ„æºè¿›è¡Œæ“ä½œï¼Œä»è€Œå®ç°æœåŠ¡ç«¯èµ„æºçŠ¶æ€çš„å˜æ›´ã€‚

**æ ¸å¿ƒå®šä½**ï¼šHTTP/RESTå…³æ³¨çš„æ˜¯**å¯¹èµ„æºçš„å¢åˆ æ”¹æŸ¥ï¼ˆCRUDï¼‰**ï¼Œå®ƒæ˜¯ä¸€ç§é¢å‘èµ„æºçš„è®¾è®¡æ€æƒ³ã€‚

##### 2. RPC (Remote Procedure Call)

RPCæ˜¯ä¸€ç§**ç¼–ç¨‹æ¨¡å‹**æˆ–**é€šä¿¡èŒƒå¼**ã€‚å®ƒçš„æ ¸å¿ƒç›®æ ‡æ˜¯è®©å¼€å‘äººå‘˜åœ¨è°ƒç”¨è¿œç¨‹æœåŠ¡ä¸Šçš„æ–¹æ³•æ—¶ï¼Œæ„Ÿè§‰å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ï¼Œè€Œæ— éœ€å…³å¿ƒåº•å±‚å¤æ‚çš„ç½‘ç»œé€šä¿¡ç»†èŠ‚ã€‚

å¼€å‘è€…åªéœ€è¦å®šä¹‰ä¸€ä¸ªæœåŠ¡æ¥å£ï¼ˆService Interfaceï¼‰ï¼ŒRPCæ¡†æ¶ä¼šè‡ªåŠ¨ç”Ÿæˆå®¢æˆ·ç«¯çš„"æ¡©"ï¼ˆStubï¼‰å’ŒæœåŠ¡ç«¯çš„"éª¨æ¶"ï¼ˆSkeletonï¼‰ã€‚

* **å®¢æˆ·ç«¯æ¡©ï¼ˆStubï¼‰**: çœ‹èµ·æ¥åƒä¸€ä¸ªæœ¬åœ°å¯¹è±¡ï¼Œä½†å…¶å†…éƒ¨å®ç°æ˜¯å°†æ–¹æ³•è°ƒç”¨å’Œå‚æ•°åºåˆ—åŒ–ï¼Œå¹¶é€šè¿‡ç½‘ç»œå‘é€åˆ°æœåŠ¡ç«¯ã€‚
* **æœåŠ¡ç«¯éª¨æ¶ï¼ˆSkeletonï¼‰**: æ¥æ”¶ç½‘ç»œè¯·æ±‚ï¼Œååºåˆ—åŒ–æ•°æ®ï¼Œç„¶åè°ƒç”¨å®é™…çš„æœåŠ¡ç«¯ä¸šåŠ¡é€»è¾‘ã€‚

**æ ¸å¿ƒå®šä½**ï¼šRPCå…³æ³¨çš„æ˜¯**æ‰§è¡Œä¸€ä¸ªè¿œç¨‹åŠ¨ä½œï¼ˆActionï¼‰**ï¼Œå®ƒæ˜¯ä¸€ç§é¢å‘è¿‡ç¨‹/æœåŠ¡çš„è®¾è®¡æ€æƒ³ã€‚

---

#### äºŒã€ æ ¸å¿ƒåŒºåˆ«å¯¹æ¯”

| ç‰¹æ€§ç»´åº¦ | HTTP (é€šå¸¸æŒ‡RESTful API) | RPC (ä»¥gRPCä¸ºä¾‹) |
| --- | --- | --- |
| **æŠ½è±¡å±‚æ¬¡** | **èµ„æºï¼ˆResourceï¼‰**ã€‚å®¢æˆ·ç«¯é€šè¿‡HTTPåŠ¨è¯æ“ä½œURIå®šä¹‰çš„èµ„æºã€‚å…³æ³¨â€œæ˜¯ä»€ä¹ˆâ€ã€‚ | **æ–¹æ³•/å‡½æ•°ï¼ˆMethod/Functionï¼‰**ã€‚å®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡ç«¯å®šä¹‰å¥½çš„æ–¹æ³•ã€‚å…³æ³¨â€œåšä»€ä¹ˆâ€ã€‚ |
| **é€šä¿¡åè®®** | é€šå¸¸åŸºäº `HTTP/1.1` æˆ– `HTTP/2`ã€‚åè®®æœ¬èº«æ˜¯é€šç”¨çš„ã€‚ | å¯ä»¥åŸºäºå¤šç§åè®®ã€‚ç°ä»£RPCæ¡†æ¶ï¼ˆå¦‚gRPCï¼‰å»ºç«‹åœ¨`HTTP/2`ä¹‹ä¸Šï¼Œä»¥è·å¾—é«˜æ€§èƒ½ã€‚è€å¼RPCå¯èƒ½ä½¿ç”¨è‡ªå®šä¹‰TCPåè®®ã€‚ |
| **æ•°æ®æ ¼å¼** | **çµæ´»ï¼Œå¯è¯»æ€§å¥½**ã€‚é€šå¸¸æ˜¯JSONæˆ–XMLï¼ŒåŸºäºæ–‡æœ¬ã€‚ | **é«˜æ•ˆï¼Œç»“æ„åŒ–**ã€‚é€šå¸¸æ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼Œå¦‚Protobuf (Protocol Buffers), Thrift, Avroã€‚éœ€è¦é¢„å…ˆå®šä¹‰Schemaã€‚ |
| **è€¦åˆåº¦** | **æ¾è€¦åˆ**ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åªéœ€è¦å¯¹èµ„æºå’Œæ•°æ®æ ¼å¼ï¼ˆå¦‚JSONç»“æ„ï¼‰è¾¾æˆå…±è¯†ã€‚ | **ç´§è€¦åˆ**ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¼ºä¾èµ–äºé¢„å…ˆå®šä¹‰çš„æ¥å£æ–‡ä»¶ï¼ˆIDL - Interface Definition Languageï¼Œå¦‚`.proto`æ–‡ä»¶ï¼‰ã€‚æœåŠ¡ç«¯æ¥å£å˜æ›´é€šå¸¸éœ€è¦å®¢æˆ·ç«¯é‡æ–°ç”Ÿæˆä»£ç ã€‚ |
| **æ€§èƒ½** | ç›¸å¯¹è¾ƒä½ã€‚æ–‡æœ¬åè®®ï¼ˆJSONï¼‰è§£æå¼€é”€å¤§ï¼ŒHTTP/1.1å¤´éƒ¨å†—ä½™ï¼Œè¿æ¥å¤ç”¨æ•ˆç‡ä½ã€‚ | ç›¸å¯¹è¾ƒé«˜ã€‚äºŒè¿›åˆ¶åè®®ï¼ˆProtobufï¼‰ä½“ç§¯å°ï¼Œåºåˆ—åŒ–/ååºåˆ—åŒ–é€Ÿåº¦å¿«ï¼ŒHTTP/2çš„å¤šè·¯å¤ç”¨å’Œå¤´éƒ¨å‹ç¼©ç­‰ç‰¹æ€§ä½¿å…¶éå¸¸é«˜æ•ˆã€‚ |
| **æœåŠ¡å®šä¹‰** | **éšå¼å®šä¹‰**ã€‚é€šå¸¸é€šè¿‡æ–‡æ¡£ï¼ˆå¦‚Swagger/OpenAPIï¼‰æ¥æè¿°APIã€‚ | **æ˜¾å¼ã€å¼ºåˆ¶å®šä¹‰**ã€‚é€šè¿‡IDLæ–‡ä»¶ï¼ˆå¦‚gRPCçš„`.proto`ï¼‰æ¥ä¸¥æ ¼å®šä¹‰æœåŠ¡ã€æ–¹æ³•å’Œæ¶ˆæ¯ä½“ï¼Œå…·æœ‰å¼ºç±»å‹çº¦æŸã€‚ |
| **å¯è¯»æ€§ä¸è°ƒè¯•** | **æä½³**ã€‚è¯·æ±‚å’Œå“åº”éƒ½æ˜¯äººç±»å¯è¯»çš„ï¼Œå¯ä»¥ä½¿ç”¨æµè§ˆå™¨ã€`curl`ã€Postmanç­‰å·¥å…·è½»æ¾è°ƒè¯•ã€‚ | **è¾ƒå·®**ã€‚äºŒè¿›åˆ¶æµå¯¹äººç±»ä¸å‹å¥½ï¼Œéœ€è¦ä¸“é—¨çš„å·¥å…·ï¼ˆå¦‚`grpcurl`ï¼‰æˆ–UIï¼ˆå¦‚BloomRPCï¼‰æ¥è¿›è¡Œè°ƒè¯•ã€‚ |
| **è·¨è¯­è¨€æ”¯æŒ** | **æå¥½**ã€‚ä»»ä½•æ”¯æŒHTTPåè®®æ ˆçš„è¯­è¨€éƒ½å¯ä»¥è½»æ¾å®ç°ã€‚ | **å¥½**ã€‚ä¸»æµRPCæ¡†æ¶ï¼ˆDubboï¼ŒgRPC, Thriftï¼‰é€šè¿‡ä»£ç ç”Ÿæˆå·¥å…·æ”¯æŒå¤šç§è¯­è¨€ï¼Œä½†éœ€è¦ä¾èµ–ç‰¹å®šçš„æ¡†æ¶åº“ã€‚ |
| **æµè§ˆå™¨æ”¯æŒ** | **åŸç”Ÿæ”¯æŒ**ã€‚æ‰€æœ‰æµè§ˆå™¨éƒ½å†…ç½®äº†HTTPå®¢æˆ·ç«¯ã€‚ | **ä¸ç›´æ¥æ”¯æŒ**ã€‚éœ€è¦é€šè¿‡ç½‘å…³ï¼ˆå¦‚gRPC-Web + Envoy proxyï¼‰è½¬æ¢åè®®æ‰èƒ½è¢«æµè§ˆå™¨è°ƒç”¨ã€‚ |

---

#### ä¸‰ã€ Javaä»£ç ç¤ºä¾‹

è®©æˆ‘ä»¬é€šè¿‡Spring Boot 3æ¥å®ç°è¿™ä¸¤ä¸ªæ¨¡å¼ï¼Œç›´è§‚åœ°æ„Ÿå—å·®å¼‚ã€‚

##### åœºæ™¯ï¼šæ ¹æ®ç”¨æˆ·IDè·å–ç”¨æˆ·ä¿¡æ¯ã€‚

##### 1. HTTP/REST ç¤ºä¾‹ (ä½¿ç”¨Spring Web)

è¿™ç§æ–¹å¼éå¸¸ç›´è§‚ï¼Œå…³æ³¨çš„æ˜¯ `/users/{id}` è¿™ä¸ªèµ„æºã€‚

**`pom.xml` ä¾èµ– (æ ¸å¿ƒ)**

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>

```

**æœåŠ¡ç«¯ `UserController.java`**

```java
package com.example.httpdemo.controller;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

@RestController
@RequestMapping("/users")
public class UserController {

    // æ¨¡æ‹Ÿæ•°æ®åº“
    private static final Map<Long, User> userDatabase = new ConcurrentHashMap<>();

    static {
        userDatabase.put(1L, new User(1L, "Alice", "alice@example.com"));
        userDatabase.put(2L, new User(2L, "Bob", "bob@example.com"));
    }

    /**
     * é€šè¿‡GETè¯·æ±‚è·å–ç”¨æˆ·ä¿¡æ¯èµ„æº
     * @param id ç”¨æˆ·ID
     * @return ç”¨æˆ·å¯¹è±¡ï¼ŒSpring Bootä¼šè‡ªåŠ¨åºåˆ—åŒ–ä¸ºJSON
     */
    @GetMapping("/{id}")
    public User getUserById(@PathVariable Long id) {
        User user = userDatabase.get(id);
        if (user == null) {
            // åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿™é‡Œåº”è¯¥è¿”å›404 Not Foundå¹¶æœ‰ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†
            throw new UserNotFoundException("User not found with id: " + id);
        }
        return user;
    }

    // DTO (Data Transfer Object)
    public static class User {
        private Long id;
        private String name;
        private String email;

        // çœç•¥æ„é€ å‡½æ•°ã€getter/setter
        public User(Long id, String name, String email) {
            this.id = id;
            this.name = name;
            this.email = email;
        }

        public Long getId() { return id; }
        public String getName() { return name; }
        public String getEmail() { return email; }
    }
  
    // è‡ªå®šä¹‰å¼‚å¸¸
    static class UserNotFoundException extends RuntimeException {
        public UserNotFoundException(String message) {
            super(message);
        }
    }
}

```

**å®¢æˆ·ç«¯è°ƒç”¨ (ä½¿ç”¨`RestTemplate`æˆ–`WebClient`)**

```java
// ä½¿ç”¨curlå‘½ä»¤æ¨¡æ‹Ÿå®¢æˆ·ç«¯
// curl http://localhost:8080/users/1
// å“åº”: {"id":1,"name":"Alice","email":"alice@example.com"}

// ä½¿ç”¨Springçš„RestTemplate
RestTemplate restTemplate = new RestTemplate();
String url = "http://localhost:8080/users/1";
User user = restTemplate.getForObject(url, User.class);
System.out.println("Fetched User: " + user.getName());

```

##### 2. RPC ç¤ºä¾‹ (ä½¿ç”¨ gRPC)

è¿™ç§æ–¹å¼æ›´å¤æ‚ï¼Œéœ€è¦å…ˆå®šä¹‰æ¥å£ï¼Œç„¶åå®ç°ã€‚å…³æ³¨çš„æ˜¯ `getUser` è¿™ä¸ªæ–¹æ³•è°ƒç”¨ã€‚

**æ­¥éª¤1: å®šä¹‰æœåŠ¡æ¥å£ (`src/main/proto/user.proto`)**

```protobuf
syntax = "proto3";

// ç”Ÿæˆçš„Javaç±»æ‰€åœ¨çš„åŒ…
option java_package = "com.example.grpcdemo.grpc";
// æ˜¯å¦å°†protoæ–‡ä»¶ä¸­çš„messageç”Ÿæˆä¸ºå•ç‹¬çš„Javaæ–‡ä»¶
option java_multiple_files = true;

// å®šä¹‰æœåŠ¡
service UserService {
  // å®šä¹‰ä¸€ä¸ªåä¸ºGetUserçš„æ–¹æ³•
  rpc GetUser (UserRequest) returns (UserResponse);
}

// å®šä¹‰è¯·æ±‚æ¶ˆæ¯ä½“
message UserRequest {
  int64 user_id = 1;
}

// å®šä¹‰å“åº”æ¶ˆæ¯ä½“
message UserResponse {
  int64 id = 1;
  string name = 2;
  string email = 3;
}

```

**æ­¥éª¤2: `pom.xml` æ·»åŠ gRPCå’ŒProtobufæ’ä»¶åŠä¾èµ–**  
 è¿™éƒ¨åˆ†æ¯”è¾ƒç¹çï¼Œéœ€è¦æ·»åŠ  `grpc-spring-boot-starter`, `protobuf-maven-plugin` ç­‰ã€‚æ’ä»¶ä¼šåœ¨ç¼–è¯‘æ—¶æ ¹æ® `.proto` æ–‡ä»¶è‡ªåŠ¨ç”ŸæˆJavaä»£ç ã€‚

**æ­¥éª¤3: æœåŠ¡ç«¯å®ç° (`UserServiceImpl.java`)**  
 ç”Ÿæˆçš„ä»£ç ä¼šåŒ…å«ä¸€ä¸ª `UserServiceGrpc.UserServiceImplBase` ç±»ï¼Œæˆ‘ä»¬ç»§æ‰¿å®ƒå¹¶å®ç°æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘ã€‚

```java
package com.example.grpcdemo.service;

import com.example.grpcdemo.grpc.*;
import io.grpc.stub.StreamObserver;
import net.devh.boot.grpc.server.service.GrpcService;

import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

@GrpcService // è¿™ä¸ªæ³¨è§£æ¥è‡ª grpc-spring-boot-starterï¼Œè‡ªåŠ¨å°†è¯¥æœåŠ¡æ³¨å†Œåˆ°gRPCæœåŠ¡å™¨
public class UserServiceImpl extends UserServiceGrpc.UserServiceImplBase {

    // æ¨¡æ‹Ÿæ•°æ®åº“
    private static final Map<Long, UserResponse> userDatabase = new ConcurrentHashMap<>();

    static {
        userDatabase.put(1L, UserResponse.newBuilder().setId(1L).setName("Alice").setEmail("alice@example.com").build());
        userDatabase.put(2L, UserResponse.newBuilder().setId(2L).setName("Bob").setEmail("bob@example.com").build());
    }

    /**
     * å®ç°protoæ–‡ä»¶ä¸­å®šä¹‰çš„GetUseræ–¹æ³•
     * @param request å°è£…äº†è¯·æ±‚å‚æ•°çš„UserRequestå¯¹è±¡
     * @param responseObserver ç”¨äºå‘å®¢æˆ·ç«¯å‘é€å“åº”çš„æµè§‚å¯Ÿè€…
     */
    @Override
    public void getUser(UserRequest request, StreamObserver<UserResponse> responseObserver) {
        long userId = request.getUserId();
        UserResponse user = userDatabase.get(userId);

        if (user == null) {
            // é€šè¿‡onErrorå‘å®¢æˆ·ç«¯ä¼ é€’é”™è¯¯
            responseObserver.onError(io.grpc.Status.NOT_FOUND
                    .withDescription("User not found with id: " + userId)
                    .asRuntimeException());
            return;
        }

        // é€šè¿‡onNextå‘é€å“åº”æ•°æ®
        responseObserver.onNext(user);
        // é€šè¿‡onCompletedè¡¨ç¤ºè°ƒç”¨ç»“æŸ
        responseObserver.onCompleted();
    }
}

```

**æ­¥éª¤4: å®¢æˆ·ç«¯è°ƒç”¨**  
 å®¢æˆ·ç«¯ä¹Ÿéœ€è¦ä¾èµ– `.proto` æ–‡ä»¶ç”Ÿæˆçš„ä»£ç ã€‚

```java
package com.example.grpcdemo.client;

import com.example.grpcdemo.grpc.UserRequest;
import com.example.grpcdemo.grpc.UserResponse;
import com.example.grpcdemo.grpc.UserServiceGrpc;
import io.grpc.ManagedChannel;
import io.grpc.ManagedChannelBuilder;

public class GrpcClient {
    public static void main(String[] args) {
        // 1. åˆ›å»ºé€šä¿¡çš„Channel
        ManagedChannel channel = ManagedChannelBuilder.forAddress("localhost", 9090) // gRPCæœåŠ¡é»˜è®¤ç«¯å£
                .usePlaintext() // ä½¿ç”¨éåŠ å¯†è¿æ¥ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰
                .build();

        // 2. ä»Channelåˆ›å»ºå®¢æˆ·ç«¯Stub (é˜»å¡å¼)
        UserServiceGrpc.UserServiceBlockingStub blockingStub = UserServiceGrpc.newBlockingStub(channel);

        // 3. å‡†å¤‡è¯·æ±‚å¯¹è±¡
        UserRequest request = UserRequest.newBuilder()
                .setUserId(1L)
                .build();
      
        try {
            // 4. åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æ–¹æ³•
            UserResponse response = blockingStub.getUser(request);
            System.out.println("Fetched User: " + response.getName());
        } catch (Exception e) {
            System.err.println("Request failed: " + e.getMessage());
        } finally {
            // 5. å…³é—­Channel
            channel.shutdown();
        }
    }
}

```

å¯ä»¥çœ‹åˆ°ï¼Œ`blockingStub.getUser(request)` è¿™è¡Œä»£ç å¯¹å¼€å‘è€…éšè—äº†æ‰€æœ‰ç½‘ç»œç»†èŠ‚ï¼Œè¿™å°±æ˜¯RPCçš„æ ¸å¿ƒé­…åŠ›ã€‚

---

#### å››ã€ å®è·µä¸é€‰å‹å»ºè®® (ä½•æ—¶ä½¿ç”¨å“ªä¸€ä¸ªï¼Ÿ)

ä½œä¸ºæ¶æ„å¸ˆæˆ–èµ„æ·±å¼€å‘è€…ï¼ŒæŠ€æœ¯é€‰å‹æ˜¯æˆ‘ä»¬çš„æ—¥å¸¸ã€‚ä»¥ä¸‹æ˜¯æˆ‘çš„å»ºè®®ï¼š

##### é€‰æ‹© HTTP/REST çš„åœºæ™¯ï¼š

1. **å¯¹å¤–å¼€æ”¾çš„API (Public APIs)**ï¼šå½“ä½ çš„APIéœ€è¦è¢«ç¬¬ä¸‰æ–¹å¼€å‘è€…ã€åˆä½œä¼™ä¼´æˆ–å‰ç«¯Web/ç§»åŠ¨åº”ç”¨è°ƒç”¨æ—¶ï¼ŒHTTP/RESTæ˜¯äº‹å®ä¸Šçš„æ ‡å‡†ã€‚å®ƒçš„é€šç”¨æ€§ã€æ˜“äºç†è§£å’Œè°ƒè¯•çš„ç‰¹ç‚¹æ˜¯æ— ä¸ä¼¦æ¯”çš„ã€‚
2. **ç®€å•çš„ã€é¢å‘èµ„æºçš„æœåŠ¡**ï¼šå¦‚æœä½ çš„æœåŠ¡ä¸»è¦æ˜¯æä¾›æ•°æ®çš„å¢åˆ æ”¹æŸ¥ï¼Œé‚£ä¹ˆRESTfulé£æ ¼æ˜¯æå…¶è‡ªç„¶å’Œåˆé€‚çš„ã€‚
3. **è¿½æ±‚æ¾è€¦åˆå’Œå¿«é€Ÿè¿­ä»£çš„å‰ç«¯åä½œ**ï¼šå‰ç«¯å’Œåç«¯å¯ä»¥é€šè¿‡ä¸€ä»½ç®€å•çš„JSONçº¦å®šæˆ–Swaggeræ–‡æ¡£å¹¶è¡Œå¼€å‘ï¼Œè€¦åˆåº¦ä½ã€‚
4. **éœ€è¦åˆ©ç”¨å¹¿æ³›çš„ç”Ÿæ€ç³»ç»Ÿ**ï¼šHTTPæœ‰å¤§é‡çš„ä»£ç†ã€ç¼“å­˜ã€è´Ÿè½½å‡è¡¡ã€ç›‘æ§å·¥å…·æ”¯æŒï¼Œç”Ÿæ€éå¸¸æˆç†Ÿã€‚

##### é€‰æ‹© RPC (ç‰¹åˆ«æ˜¯ gRPC) çš„åœºæ™¯ï¼š

1. **å†…éƒ¨å¾®æœåŠ¡é—´é€šä¿¡ (East-West Traffic)**ï¼šåœ¨å¤æ‚çš„å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒæœåŠ¡é—´çš„è°ƒç”¨é¢‘ç‡æé«˜ï¼Œå¯¹æ€§èƒ½å’Œå»¶è¿Ÿéå¸¸æ•æ„Ÿã€‚gRPCçš„äºŒè¿›åˆ¶åè®®å’ŒHTTP/2å¸¦æ¥çš„æ€§èƒ½ä¼˜åŠ¿éå¸¸æ˜¾è‘—ã€‚
2. **æ€§èƒ½æ˜¯å…³é”®æŒ‡æ ‡çš„ç³»ç»Ÿ**ï¼šå¯¹äºå®æ—¶æ¸¸æˆã€é‡‘èäº¤æ˜“ã€ç‰©è”ç½‘æ•°æ®é‡‡é›†ç­‰å¯¹ä½å»¶è¿Ÿã€é«˜ååé‡æœ‰è‹›åˆ»è¦æ±‚çš„åœºæ™¯ã€‚
3. **éœ€è¦å¼ºç±»å‹å¥‘çº¦**ï¼šå½“å›¢é˜Ÿå¸Œæœ›é€šè¿‡æ¥å£å®šä¹‰æ–‡ä»¶ï¼ˆIDLï¼‰æ¥å¼ºåˆ¶ç»Ÿä¸€å‰åç«¯çš„æ•°æ®æ¨¡å‹å’Œæ¥å£è§„èŒƒæ—¶ï¼ŒRPCæ˜¯ç»ä½³é€‰æ‹©ã€‚è¿™å¯ä»¥é¿å…å¾ˆå¤šå› æ•°æ®ç±»å‹ä¸åŒ¹é…å¯¼è‡´çš„è¿è¡Œæ—¶é”™è¯¯ã€‚
4. **éœ€è¦å¤æ‚é€šä¿¡æ¨¡å¼**ï¼šgRPCåŸç”Ÿæ”¯æŒå››ç§é€šä¿¡æ¨¡å¼ï¼šç®€å•è¯·æ±‚-å“åº”ã€æœåŠ¡ç«¯æµã€å®¢æˆ·ç«¯æµã€åŒå‘æµã€‚è¿™å¯¹äºéœ€è¦æµå¼å¤„ç†æ•°æ®çš„åœºæ™¯ï¼ˆå¦‚å®æ—¶æ¨é€ã€æ–‡ä»¶ä¸Šä¼ ï¼‰éå¸¸æœ‰ç”¨ï¼Œè€ŒHTTP/1.1å®ç°èµ·æ¥éå¸¸å¤æ‚ã€‚

#### æ€»ç»“

|  | **HTTP/REST** | **RPC/gRPC** |
| --- | --- | --- |
| **æ€æƒ³** | é¢å‘èµ„æº | é¢å‘åŠ¨ä½œ/æœåŠ¡ |
| **å¼ºé¡¹** | **é€šç”¨æ€§ã€å…¼å®¹æ€§ã€å¯è¯»æ€§** | **æ€§èƒ½ã€æ•ˆç‡ã€å¼ºç±»å‹çº¦æŸ** |
| **æœ€ä½³åº”ç”¨** | **å¯¹å¤–APIã€WebæœåŠ¡ã€å‰ç«¯äº¤äº’** | **å†…éƒ¨å¾®æœåŠ¡é—´çš„é«˜æ€§èƒ½é€šä¿¡** |
| **å¼€å‘ä½“éªŒ** | ç®€å•ç›´è§‚ï¼Œè°ƒè¯•æ–¹ä¾¿ | ç•¥æ˜¾å¤æ‚ï¼ˆéœ€IDLå’Œä»£ç ç”Ÿæˆï¼‰ï¼Œä½†å¥‘çº¦å…ˆè¡Œ |

**æœ€åçš„å¿ å‘Š**ï¼šåœ¨ç°ä»£åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ**RPCå’ŒHTTPå¹¶éâ€œäºŒé€‰ä¸€â€çš„å¯¹ç«‹å…³ç³»ï¼Œè€Œæ˜¯â€œå„å¸å…¶èŒâ€çš„åä½œå…³ç³»**ã€‚ä¸€ä¸ªå…¸å‹çš„å¾®æœåŠ¡ç³»ç»Ÿæ¶æ„å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š

* **API Gateway (å…¥å£)**: ä½¿ç”¨HTTP/RESTæš´éœ²APIç»™å¤–éƒ¨å®¢æˆ·ç«¯ï¼ˆWeb, Appï¼‰ã€‚
* **å†…éƒ¨æœåŠ¡ä¹‹é—´**: ä½¿ç”¨gRPCè¿›è¡Œé«˜æ•ˆã€ä½å»¶è¿Ÿçš„é€šä¿¡ã€‚



