---
layout: post
title: "机器学习_交叉验证"
date: 2025-03-13 09:51:27 +0800
description: "【代码】机器学习_交叉验证。"
keywords: "机器学习_交叉验证"
categories: ['机器学习']
tags: ['机器学习']
artid: "146223052"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146223052
    alt: "机器学习_交叉验证"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146223052
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146223052
cover: https://bing.ee123.net/img/rand?artid=146223052
image: https://bing.ee123.net/img/rand?artid=146223052
img: https://bing.ee123.net/img/rand?artid=146223052
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     机器学习_交叉验证
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h4>
     <a id="_2">
     </a>
     <strong>
      一、交叉验证的核心知识点
     </strong>
    </h4>
    <h5>
     <a id="1__3">
     </a>
     <strong>
      1. 交叉验证的基本概念
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       定义
      </strong>
      ：通过将数据集划分为多个子集，多次训练和测试模型，以评估模型性能并减少过拟合风险的方法。
     </li>
     <li>
      <strong>
       目的
      </strong>
      ：
      <ul>
       <li>
        评估模型在未知数据上的泛化能力。
       </li>
       <li>
        选择最优超参数或模型。
       </li>
       <li>
        平衡数据不足时的训练与测试数据分配。
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="2__10">
     </a>
     <strong>
      2. 常用交叉验证方法
     </strong>
    </h5>
    <table>
     <thead>
      <tr>
       <th>
        <strong>
         方法
        </strong>
       </th>
       <th>
        <strong>
         描述
        </strong>
       </th>
       <th>
        <strong>
         优点
        </strong>
       </th>
       <th>
        <strong>
         缺点
        </strong>
       </th>
       <th>
        <strong>
         适用场景
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         K折交叉验证 (K-Fold)
        </strong>
       </td>
       <td>
        将数据分为K个子集，每次用一个子集测试，其余K-1个子集训练，重复K次。
       </td>
       <td>
        充分利用数据，减少方差，结果稳定。
       </td>
       <td>
        计算成本高，需多次训练模型。
       </td>
       <td>
        数据量适中，类别分布均衡。
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         留一交叉验证 (LOOCV)
        </strong>
       </td>
       <td>
        K等于样本总数，每次仅用一个样本测试，其余训练。
       </td>
       <td>
        测试集覆盖所有数据，评估结果接近真实性能。
       </td>
       <td>
        计算成本极高，尤其当数据量大时。
       </td>
       <td>
        数据量极小，需精确评估。
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         分层K折交叉验证
        </strong>
       </td>
       <td>
        在分类任务中，确保每个子集的类别分布与原始数据一致。
       </td>
       <td>
        避免类别分布偏差，尤其适合类别不平衡数据。
       </td>
       <td>
        计算成本与普通K折相同。
       </td>
       <td>
        类别分布不均衡的分类问题。
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         HoldOut 法
        </strong>
       </td>
       <td>
        将数据简单分为训练集（如70%）和测试集（30%）。
       </td>
       <td>
        简单快速，计算成本低。
       </td>
       <td>
        随机性高，结果可能不稳定，无法充分利用数据。
       </td>
       <td>
        数据量充足，快速验证模型。
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         时间序列交叉验证
        </strong>
       </td>
       <td>
        适用于时间序列数据，按时间顺序划分训练集和测试集。
       </td>
       <td>
        保留时间序列的时序性，避免未来数据泄露。
       </td>
       <td>
        仅适用于时间序列数据，灵活性较低。
       </td>
       <td>
        时间序列预测（如股票、天气）。
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         蒙特卡洛交叉验证
        </strong>
       </td>
       <td>
        随机划分训练集和测试集多次，每次划分比例固定（如70%:30%）。
       </td>
       <td>
        灵活，可调整划分次数以平衡计算与稳定性。
       </td>
       <td>
        需大量重复以保证结果稳定，可能忽略数据分布规律。
       </td>
       <td>
        需多次评估模型鲁棒性时。
       </td>
      </tr>
     </tbody>
    </table>
    <h5>
     <a id="3__20">
     </a>
     <strong>
      3. 交叉验证的关键参数与选择
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       K值选择
      </strong>
      ：
      <ul>
       <li>
        <strong>
         K=5或10
        </strong>
        ：平衡计算成本与结果稳定性（K越大，结果越接近LOOCV，但计算量越大）。
       </li>
       <li>
        <strong>
         K的选择依据
        </strong>
        ：数据量、计算资源、模型复杂度。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       分层与非分层
      </strong>
      ：
      <ul>
       <li>
        <strong>
         分层
        </strong>
        ：确保子集类别分布一致（分类任务推荐）。
       </li>
       <li>
        <strong>
         非分层
        </strong>
        ：适用于回归任务或类别均衡数据。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       时间序列数据
      </strong>
      ：
      <ul>
       <li>
        必须按时间顺序划分，避免未来数据“泄漏”到训练集。
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="4__30">
     </a>
     <strong>
      4. 交叉验证的核心作用
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       模型评估
      </strong>
      ：通过多次验证减少单次划分的偶然性。
     </li>
     <li>
      <strong>
       超参数调优
      </strong>
      ：例如选择正则化参数（如Lasso的λ）。
     </li>
     <li>
      <strong>
       算法选择
      </strong>
      ：比较不同模型（如SVM、决策树）的性能。
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_37">
     </a>
     <strong>
      二、重点需要掌握的知识
     </strong>
    </h4>
    <h5>
     <a id="1__38">
     </a>
     <strong>
      1. 交叉验证的核心思想
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       数据重用
      </strong>
      ：通过多次划分数据，最大化数据利用率。
     </li>
     <li>
      <strong>
       减少方差
      </strong>
      ：通过多次测试结果的平均，降低评估结果的波动性。
     </li>
     <li>
      <strong>
       防止过拟合
      </strong>
      ：通过测试集验证模型是否过度依赖训练数据。
     </li>
    </ul>
    <h5>
     <a id="2_K_43">
     </a>
     <strong>
      2. K折交叉验证的实现步骤
     </strong>
    </h5>
    <ol>
     <li>
      <strong>
       数据划分
      </strong>
      ：将数据集随机分成K个大小相近的子集。
     </li>
     <li>
      <strong>
       迭代训练与测试
      </strong>
      ：
      <ul>
       <li>
        对每个子集i，用其他K-1个子集训练模型。
       </li>
       <li>
        用子集i测试模型，记录评估指标（如准确率、F1值）。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       结果聚合
      </strong>
      ：取K次结果的平均值作为最终评估指标。
     </li>
    </ol>
    <h5>
     <a id="3_KK_50">
     </a>
     <strong>
      3. 分层K折与普通K折的区别
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       分层K折
      </strong>
      ：
      <ul>
       <li>
        确保每个子集的类别比例与原始数据一致。
       </li>
       <li>
        <strong>
         适用场景
        </strong>
        ：类别不平衡数据（如正负样本比例1:9）。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       普通K折
      </strong>
      ：
      <ul>
       <li>
        随机划分，可能导致某些子集类别分布偏差。
       </li>
       <li>
        <strong>
         适用场景
        </strong>
        ：类别均衡数据。
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="4__58">
     </a>
     <strong>
      4. 交叉验证的注意事项
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       数据划分随机性
      </strong>
      ：需设置随机种子（如
      <code>
       random_state
      </code>
      ）保证可复现。
     </li>
     <li>
      <strong>
       计算成本
      </strong>
      ：K越大、数据量越大，计算时间越长。
     </li>
     <li>
      <strong>
       特征工程
      </strong>
      ：需在交叉验证内进行（如标准化、特征选择）。
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="K_65">
     </a>
     <strong>
      三、示例：使用K折交叉验证评估分类模型
     </strong>
    </h4>
    <h5>
     <a id="1_Python__scikitlearn_66">
     </a>
     <strong>
      1. 示例代码（Python + scikit-learn）
     </strong>
    </h5>
    <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> KFold<span class="token punctuation">,</span> StratifiedKFold
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LogisticRegression
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> accuracy_score

<span class="token comment"># 加载数据</span>
iris <span class="token operator">=</span> load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>
X<span class="token punctuation">,</span> y <span class="token operator">=</span> iris<span class="token punctuation">.</span>data<span class="token punctuation">,</span> iris<span class="token punctuation">.</span>target

<span class="token comment"># 定义模型</span>
model <span class="token operator">=</span> LogisticRegression<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 普通K折交叉验证（K=5）</span>
kf <span class="token operator">=</span> KFold<span class="token punctuation">(</span>n_splits<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
accuracies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> train_idx<span class="token punctuation">,</span> test_idx <span class="token keyword">in</span> kf<span class="token punctuation">.</span>split<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">:</span>
    X_train<span class="token punctuation">,</span> X_test <span class="token operator">=</span> X<span class="token punctuation">[</span>train_idx<span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">[</span>test_idx<span class="token punctuation">]</span>
    y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> y<span class="token punctuation">[</span>train_idx<span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span>test_idx<span class="token punctuation">]</span>
    
    model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
    y_pred <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
    accuracies<span class="token punctuation">.</span>append<span class="token punctuation">(</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"普通K折平均准确率:"</span><span class="token punctuation">,</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>accuracies<span class="token punctuation">)</span><span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>accuracies<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 分层K折交叉验证（适用于分类任务）</span>
skf <span class="token operator">=</span> StratifiedKFold<span class="token punctuation">(</span>n_splits<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
accuracies_stratified <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> train_idx<span class="token punctuation">,</span> test_idx <span class="token keyword">in</span> skf<span class="token punctuation">.</span>split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    X_train<span class="token punctuation">,</span> X_test <span class="token operator">=</span> X<span class="token punctuation">[</span>train_idx<span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">[</span>test_idx<span class="token punctuation">]</span>
    y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> y<span class="token punctuation">[</span>train_idx<span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span>test_idx<span class="token punctuation">]</span>
    
    model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
    y_pred <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
    accuracies_stratified<span class="token punctuation">.</span>append<span class="token punctuation">(</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"分层K折平均准确率:"</span><span class="token punctuation">,</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>accuracies_stratified<span class="token punctuation">)</span><span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>accuracies_stratified<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="2__109">
     </a>
     <strong>
      2. 示例说明
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       输出结果
      </strong>
      ：
      <ul>
       <li>
        普通K折与分层K折的准确率可能接近，但分层K折更可靠（尤其当类别不均衡时）。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       关键点
      </strong>
      ：
      <ul>
       <li>
        <code>
         StratifiedKFold
        </code>
        确保每个子集的类别分布一致。
       </li>
       <li>
        <code>
         shuffle=True
        </code>
        避免数据顺序影响划分结果。
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_118">
     </a>
     <strong>
      四、学习资源推荐
     </strong>
    </h4>
    <h5>
     <a id="1__119">
     </a>
     <strong>
      1. 官方文档与教程
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       scikit-learn交叉验证文档
      </strong>
      ：
      <br/>
      <a href="https://scikit-learn.org/stable/modules/cross_validation.html" rel="nofollow">
       https://scikit-learn.org/stable/modules/cross_validation.html
      </a>
     </li>
     <li>
      <strong>
       K折交叉验证API
      </strong>
      ：
      <br/>
      <a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.KFold.html" rel="nofollow">
       https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.KFold.html
      </a>
     </li>
    </ul>
    <h5>
     <a id="2__125">
     </a>
     <strong>
      2. 经典书籍
     </strong>
    </h5>
    <ul>
     <li>
      《Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow》
      <ul>
       <li>
        <strong>
         章节
        </strong>
        ：第2章“训练/测试分割”和第3章“模型评估与超参数调优”。
       </li>
      </ul>
     </li>
     <li>
      《Pattern Recognition and Machine Learning》（Bishop）
      <ul>
       <li>
        <strong>
         章节
        </strong>
        ：交叉验证的理论推导与数学基础。
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="3__131">
     </a>
     <strong>
      3. 在线课程
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       Coursera《Machine Learning》（Andrew Ng）
      </strong>
      ：
      <ul>
       <li>
        <strong>
         内容
        </strong>
        ：第3周“过拟合与交叉验证”。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       Udacity《Intro to Machine Learning》
      </strong>
      ：
      <ul>
       <li>
        <strong>
         内容
        </strong>
        ：交叉验证的实际应用案例。
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="4__137">
     </a>
     <strong>
      4. 博客与文章
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       CSDN交叉验证详解
      </strong>
      ：
      <br/>
      https://blog.csdn.net/
     </li>
     <li>
      <strong>
       知乎专栏《机器学习中的交叉验证》
      </strong>
      ：
      <br/>
      https://zhuanlan.zhihu.com/
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_145">
     </a>
     <strong>
      五、总结
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       核心思想
      </strong>
      ：通过多次划分数据，平衡模型评估的稳定性与计算成本。
     </li>
     <li>
      <strong>
       关键选择
      </strong>
      ：根据数据量、类别分布、任务类型选择交叉验证方法。
     </li>
     <li>
      <strong>
       实践重点
      </strong>
      ：熟练使用scikit-learn的交叉验证工具，理解分层划分的必要性
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f6b3331363337383038352f:61727469636c652f64657461696c732f313436323233303532" class_="artid" style="display:none">
 </p>
</div>


