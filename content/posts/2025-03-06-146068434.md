---
layout: post
title: "vue3antV-G6节点与文本框实现"
date: 2025-03-06 13:51:10 +0800
description: "const securityId1 = ref(props.securityId) // 证券id。const symbol1 = ref(props.symbol) // 证券代码。const symbol1 = ref(props.symbol) // 证券代码。const datePicker = ref() // 时间筛选框ref。const dateYear = ref<any>('') // 年份。const mapData = ref({}) // 脑图数据。// 控制当前时间之后不能选。"
keywords: "vue3+antV G6节点与文本框实现"
categories: ['未分类']
tags: ['Vue', 'Plus', 'G']
artid: "146068434"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146068434
    alt: "vue3antV-G6节点与文本框实现"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146068434
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146068434
cover: https://bing.ee123.net/img/rand?artid=146068434
image: https://bing.ee123.net/img/rand?artid=146068434
img: https://bing.ee123.net/img/rand?artid=146068434
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     vue3+antV G6节点与文本框实现
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h3>
     一、下载第三方包
    </h3>
    <p>
     使用npm下载第三方包：npm install @antv/g6
    </p>
    <h3>
     二、父组件代码
    </h3>
    <p>
     &lt;template&gt;
    </p>
    <p>
     &lt;div id="financialMonitoring" v-loading="loading"&gt;
    </p>
    <p>
     &lt;retainedProfitsMap
    </p>
    <p>
     :securityId="securityId1"
    </p>
    <p>
     :symbol="symbol1"
    </p>
    <p>
     id="retainedProfitsMap"
    </p>
    <p>
     class="mt10"
    </p>
    <p>
     /&gt;
    </p>
    <p>
     &lt;/div&gt;
    </p>
    <p>
     &lt;/template&gt;
    </p>
    <p>
     &lt;script setup lang="ts"&gt;
    </p>
    <p>
     import retainedProfitsMap from './retainedProfitsMap.vue'
    </p>
    <p>
     const props = defineProps({
     <!-- -->
    </p>
    <p>
     symbol: {
     <!-- -->
    </p>
    <p>
     type: String,
    </p>
    <p>
     default: ''
    </p>
    <p>
     },
    </p>
    <p>
     securityId: {
     <!-- -->
    </p>
    <p>
     type: [String, Number],
    </p>
    <p>
     required: true
    </p>
    <p>
     }
    </p>
    <p>
     })
    </p>
    <p>
     const loading = ref(false) // 加载状态
    </p>
    <p>
     const securityId1 = ref(props.securityId) // 证券id
    </p>
    <p>
     const symbol1 = ref(props.symbol) // 证券代码
    </p>
    <p>
     // 监听参数重新赋值
    </p>
    <p>
     watch(
    </p>
    <p>
     () =&gt; [props.securityId, props.symbol],
    </p>
    <p>
     (newValue: any, oldValue: any) =&gt; {
     <!-- -->
    </p>
    <p>
     if (newValue[0] != oldValue[0]) {
     <!-- -->
    </p>
    <p>
     securityId1.value = newValue[0]
    </p>
    <p>
     }
    </p>
    <p>
     if (newValue[1] != oldValue[1]) {
     <!-- -->
    </p>
    <p>
     symbol1.value = newValue[1]
    </p>
    <p>
     }
    </p>
    <p>
     editIndex.value = 1
    </p>
    <p>
     dateRange.value = []
    </p>
    <p>
     getFinanciaMonitoringData()
    </p>
    <p>
     },
    </p>
    <p>
     { deep: true }
    </p>
    <p>
     )
    </p>
    <p>
     &lt;/script&gt;
    </p>
    <h3>
     三、子组件代码
    </h3>
    <p>
     &lt;template&gt;
    </p>
    <p>
     &lt;ItemCard title="脑图" v-loading="loading"&gt;
    </p>
    <p>
     &lt;template #rightPart&gt;
    </p>
    <p>
     &lt;el-date-picker
    </p>
    <p>
     v-model="dateYear"
    </p>
    <p>
     type="year"
    </p>
    <p>
     value-format="YYYY"
    </p>
    <p>
     placeholder="请选择年份"
    </p>
    <p>
     :editable="false"
    </p>
    <p>
     :clearable="false"
    </p>
    <p>
     :disabled-date="disabledDate"
    </p>
    <p>
     @change="changeDate"
    </p>
    <p>
     class="year-select"
    </p>
    <p>
     ref="datePicker"
    </p>
    <p>
     /&gt;
    </p>
    <p>
     &lt;/template&gt;
    </p>
    <p>
     &lt;template #otherContent&gt;
    </p>
    <p>
     &lt;div id="container"&gt;&lt;/div&gt;
    </p>
    <p>
     &lt;/template&gt;
    </p>
    <p>
     &lt;/ItemCard&gt;
    </p>
    <p>
     &lt;/template&gt;
    </p>
    <p>
     &lt;script setup lang="ts"&gt;
    </p>
    <p>
     import { ElMessage } from 'element-plus'
    </p>
    <p>
     import ItemCard from './../RiskWarn/ItemCard.vue'
    </p>
    <p>
     import G6 from '@antv/g6'
    </p>
    <p>
     import { queryRetainedProfitsData } from '@/pages/monitor/monitorApi/stockMonitor'
    </p>
    <p>
     const props = defineProps({
     <!-- -->
    </p>
    <p>
     symbol: {
     <!-- -->
    </p>
    <p>
     // 证券代码
    </p>
    <p>
     type: String,
    </p>
    <p>
     default: ''
    </p>
    <p>
     },
    </p>
    <p>
     editIndex: {
     <!-- -->
    </p>
    <p>
     // 变更前后索引
    </p>
    <p>
     type: Number,
    </p>
    <p>
     default: 1
    </p>
    <p>
     }
    </p>
    <p>
     })
    </p>
    <p>
     const loading = ref(false) // 加载状态
    </p>
    <p>
     const dateYear = ref&lt;any&gt;('') // 年份
    </p>
    <p>
     const symbol1 = ref(props.symbol) // 证券代码
    </p>
    <p>
     const graphMap = ref() // 脑图dom
    </p>
    <p>
     const mapData = ref({}) // 脑图数据
    </p>
    <p>
     const datePicker = ref() // 时间筛选框ref
    </p>
    <p>
     // 监听参数重新赋值
    </p>
    <p>
     watch(
    </p>
    <p>
     () =&gt; [props.symbol],
    </p>
    <p>
     (newValue: any, oldValue: any) =&gt; {
     <!-- -->
    </p>
    <p>
     if (newValue[0] != oldValue[0]) {
     <!-- -->
    </p>
    <p>
     symbol1.value = newValue[0]
    </p>
    <p>
     }
    </p>
    <p>
     handleClear()
    </p>
    <p>
     getRetainedProfitsData()
    </p>
    <p>
     },
    </p>
    <p>
     { deep: true }
    </p>
    <p>
     )
    </p>
    <p>
     // 获取脑图数据
    </p>
    <p>
     const getRetainedProfitsData = async () =&gt; {
     <!-- -->
    </p>
    <p>
     loading.value = true
    </p>
    <p>
     await queryRetainedProfitsData(
    </p>
    <p>
     symbol1.value,
    </p>
    <p>
     dateYear.value
    </p>
    <p>
     ).then((res: any) =&gt; {
     <!-- -->
    </p>
    <p>
     if (res.code === 200) {
     <!-- -->
    </p>
    <p>
     dateYear.value = String(res.data.year)
    </p>
    <p>
     mapData.value = res.data.mindMap
    </p>
    <p>
     initData()
    </p>
    <p>
     } else {
     <!-- -->
    </p>
    <p>
     ElMessage({
     <!-- -->
    </p>
    <p>
     type: 'error',
    </p>
    <p>
     message: res.message
    </p>
    <p>
     })
    </p>
    <p>
     }
    </p>
    <p>
     loading.value = false
    </p>
    <p>
     })
    </p>
    <p>
     }
    </p>
    <p>
     // 注册自定义节点
    </p>
    <p>
     G6.registerNode('custom-node', {
     <!-- -->
    </p>
    <p>
     draw(cfg: any, group: any) {
     <!-- -->
    </p>
    <p>
     const {
     <!-- -->
    </p>
    <p>
     labelCfg = {},
    </p>
    <p>
     id,
    </p>
    <p>
     num,
    </p>
    <p>
     sameRatio,
    </p>
    <p>
     numRank,
    </p>
    <p>
     sameRatioRank,
    </p>
    <p>
     children
    </p>
    <p>
     } = cfg
    </p>
    <p>
     let keyShape = null
    </p>
    <p>
     // 绘制矩形作为节点主体
    </p>
    <p>
     const rect = group.addShape('rect', {
     <!-- -->
    </p>
    <p>
     attrs: {
     <!-- -->
    </p>
    <p>
     fill: '#0088FE',
    </p>
    <p>
     stroke: '#ffffff',
    </p>
    <p>
     radius: 3,
    </p>
    <p>
     cursor: children &amp;&amp; children.length &gt; 0 ? 'pointer' : '',
    </p>
    <p>
     text: id,
    </p>
    <p>
     width: Math.max(220, id.length * 4),
    </p>
    <p>
     height: 60,
    </p>
    <p>
     x: 0,
    </p>
    <p>
     y: 0
    </p>
    <p>
     }
    </p>
    <p>
     })
    </p>
    <p>
     group.addShape('text', {
     <!-- -->
    </p>
    <p>
     attrs: {
     <!-- -->
    </p>
    <p>
     ...labelCfg.style,
    </p>
    <p>
     cursor: children &amp;&amp; children.length &gt; 0 ? 'pointer' : '',
    </p>
    <p>
     text: id,
    </p>
    <p>
     x: Math.max(220, id.length * 4) / 2,
    </p>
    <p>
     y: 60 / 2,
    </p>
    <p>
     fontSize: 24,
    </p>
    <p>
     fill: '#ffffff'
    </p>
    <p>
     }
    </p>
    <p>
     })
    </p>
    <p>
     group.addShape('rect', {
     <!-- -->
    </p>
    <p>
     attrs: {
     <!-- -->
    </p>
    <p>
     width: 380,
    </p>
    <p>
     height: 70,
    </p>
    <p>
     x: -90,
    </p>
    <p>
     y: 80,
    </p>
    <p>
     lineWidth: 1,
    </p>
    <p>
     stroke: '#ccc',
    </p>
    <p>
     fill: '#ffffff',
    </p>
    <p>
     radius: 3,
    </p>
    <p>
     fillOpacity: 0
    </p>
    <p>
     },
    </p>
    <p>
     name: 'num-node'
    </p>
    <p>
     })
    </p>
    <p>
     group.addShape('text', {
     <!-- -->
    </p>
    <p>
     attrs: {
     <!-- -->
    </p>
    <p>
     text: `数值：${num}`,
    </p>
    <p>
     fill: '#333',
    </p>
    <p>
     fontSize: 15,
    </p>
    <p>
     x: -Math.max(80, id.length * 4) / 4 - 62,
    </p>
    <p>
     y: 105
    </p>
    <p>
     },
    </p>
    <p>
     name: 'num-text'
    </p>
    <p>
     })
    </p>
    <p>
     group.addShape('text', {
     <!-- -->
    </p>
    <p>
     attrs: {
     <!-- -->
    </p>
    <p>
     text: `行业排名(数值)：${numRank}`,
    </p>
    <p>
     fill: '#333',
    </p>
    <p>
     fontSize: 15,
    </p>
    <p>
     x: -Math.max(80, id.length * 4) / 4 + 105,
    </p>
    <p>
     y: 105
    </p>
    <p>
     },
    </p>
    <p>
     name: 'num-text'
    </p>
    <p>
     })
    </p>
    <p>
     group.addShape('text', {
     <!-- -->
    </p>
    <p>
     attrs: {
     <!-- -->
    </p>
    <p>
     text: `同比：${sameRatio}`,
    </p>
    <p>
     fill: '#333',
    </p>
    <p>
     fontSize: 15,
    </p>
    <p>
     x: -Math.max(80, id.length * 4) / 4 - 62,
    </p>
    <p>
     y: 142
    </p>
    <p>
     },
    </p>
    <p>
     name: 'num-text'
    </p>
    <p>
     })
    </p>
    <p>
     group.addShape('text', {
     <!-- -->
    </p>
    <p>
     attrs: {
     <!-- -->
    </p>
    <p>
     text: `行业排名(同比)：${sameRatioRank}`,
    </p>
    <p>
     fill: '#333',
    </p>
    <p>
     fontSize: 15,
    </p>
    <p>
     x: -Math.max(80, id.length * 4) / 4 + 105,
    </p>
    <p>
     y: 142
    </p>
    <p>
     },
    </p>
    <p>
     name: 'num-text'
    </p>
    <p>
     })
    </p>
    <p>
     return rect
    </p>
    <p>
     }
    </p>
    <p>
     })
    </p>
    <p>
     // 控制当前时间之后不能选
    </p>
    <p>
     const disabledDate = (time: any) =&gt; {
     <!-- -->
    </p>
    <p>
     const year = time.getFullYear()
    </p>
    <p>
     return year &lt; 2019 || year &gt; new Date().getFullYear()
    </p>
    <p>
     }
    </p>
    <p>
     // 改变时间
    </p>
    <p>
     const changeDate = (value: any) =&gt; {
     <!-- -->
    </p>
    <p>
     if (value) {
     <!-- -->
    </p>
    <p>
     dateYear.value = value
    </p>
    <p>
     handleClear()
    </p>
    <p>
     getRetainedProfitsData()
    </p>
    <p>
     datePicker.value.blur()
    </p>
    <p>
     }
    </p>
    <p>
     }
    </p>
    <p>
     const initData = () =&gt; {
     <!-- -->
    </p>
    <p>
     const graph = new G6.TreeGraph({
     <!-- -->
    </p>
    <p>
     container: 'container',
    </p>
    <p>
     width: 1410,
    </p>
    <p>
     height: 790,
    </p>
    <p>
     modes: {
     <!-- -->
    </p>
    <p>
     default: ['drag-canvas', 'zoom-canvas']
    </p>
    <p>
     },
    </p>
    <p>
     defaultNode: {
     <!-- -->
    </p>
    <p>
     type: 'custom-node',
    </p>
    <p>
     anchorPoints: [
    </p>
    <p>
     [0, 0.5],
    </p>
    <p>
     [1, 0.5]
    </p>
    <p>
     ],
    </p>
    <p>
     labelCfg: {
     <!-- -->
    </p>
    <p>
     style: {
     <!-- -->
    </p>
    <p>
     fill: '#ffffff',
    </p>
    <p>
     fontSize: 20,
    </p>
    <p>
     fontWeight: 'normal',
    </p>
    <p>
     textAlign: 'center',
    </p>
    <p>
     textBaseline: 'middle'
    </p>
    <p>
     }
    </p>
    <p>
     }
    </p>
    <p>
     },
    </p>
    <p>
     defaultEdge: {
     <!-- -->
    </p>
    <p>
     type: 'cubic-horizontal',
    </p>
    <p>
     style: {
     <!-- -->
    </p>
    <p>
     stroke: '#0088FE',
    </p>
    <p>
     lineWidth: 2,
    </p>
    <p>
     startArrow: {
     <!-- -->
    </p>
    <p>
     path: 'M 0,0 L 4,3 L 4,-3 Z', // 开始箭头
    </p>
    <p>
     fill: '#0088FE'
    </p>
    <p>
     }
    </p>
    <p>
     }
    </p>
    <p>
     },
    </p>
    <p>
     layout: {
     <!-- -->
    </p>
    <p>
     type: 'compactBox',
    </p>
    <p>
     direction: 'H',
    </p>
    <p>
     getVGap: () =&gt; {
     <!-- -->
    </p>
    <p>
     return 68
    </p>
    <p>
     },
    </p>
    <p>
     getHGap: () =&gt; {
     <!-- -->
    </p>
    <p>
     return 308
    </p>
    <p>
     },
    </p>
    <p>
     getSide: () =&gt; {
     <!-- -->
    </p>
    <p>
     return 'right'
    </p>
    <p>
     }
    </p>
    <p>
     }
    </p>
    <p>
     })
    </p>
    <p>
     graph.data(mapData.value)
    </p>
    <p>
     graph.render()
    </p>
    <p>
     graph.fitView()
    </p>
    <p>
     graphMap.value = graph
    </p>
    <p>
     // 脑图点击事件
    </p>
    <p>
     graph.on('node:click', (evt: any) =&gt; {
     <!-- -->
    </p>
    <p>
     const { item } = evt
    </p>
    <p>
     const model = item.getModel()
    </p>
    <p>
     haneldCollapse(item, model)
    </p>
    <p>
     })
    </p>
    <p>
     }
    </p>
    <p>
     // 处理节点展开折叠
    </p>
    <p>
     const haneldCollapse = (item: any, model: any) =&gt; {
     <!-- -->
    </p>
    <p>
     const hasChildren = model.children &amp;&amp; model.children.length &gt; 0 ? true : false
    </p>
    <p>
     if (!hasChildren) {
     <!-- -->
    </p>
    <p>
     return
    </p>
    <p>
     }
    </p>
    <p>
     let collapsed = model.collapsed
    </p>
    <p>
     collapsed = !collapsed
    </p>
    <p>
     model.collapsed = collapsed
    </p>
    <p>
     graphMap.value.updateChild(model, model.id)
    </p>
    <p>
     const updateParams = {
     <!-- -->
    </p>
    <p>
     collapsed
    </p>
    <p>
     }
    </p>
    <p>
     graphMap.value.updateItem(item, updateParams)
    </p>
    <p>
     }
    </p>
    <p>
     // 清除画布
    </p>
    <p>
     const handleClear = () =&gt; {
     <!-- -->
    </p>
    <p>
     graphMap.value &amp;&amp; graphMap.value.destroy()
    </p>
    <p>
     graphMap.value = null
    </p>
    <p>
     }
    </p>
    <p>
     onMounted(() =&gt; {
     <!-- -->
    </p>
    <p>
     getRetainedProfitsData()
    </p>
    <p>
     })
    </p>
    <p>
     onBeforeUnmount(() =&gt; {
     <!-- -->
    </p>
    <p>
     handleClear()
    </p>
    <p>
     })
    </p>
    <p>
     &lt;/script&gt;
    </p>
    <p>
     &lt;style lang="less" scoped&gt;
    </p>
    <p>
     :deep(.right-part) {
     <!-- -->
    </p>
    <p>
     display: flex;
    </p>
    <p>
     align-items: center;
    </p>
    <p>
     margin-left: auto;
    </p>
    <p>
     .year-select {
     <!-- -->
    </p>
    <p>
     width: 182px;
    </p>
    <p>
     height: 28px;
    </p>
    <p>
     --el-text-color-regular: #333333;
    </p>
    <p>
     }
    </p>
    <p>
     }
    </p>
    <p>
     #container {
     <!-- -->
    </p>
    <p>
     width: 1410px;
    </p>
    <p>
     height: 790px;
    </p>
    <p>
     border: 1px solid #ebeef8;
    </p>
    <p>
     }
    </p>
    <p>
     &lt;/style&gt;
    </p>
    <p>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f4d6972735f5a68752f:61727469636c652f64657461696c732f313436303638343334" class_="artid" style="display:none">
 </p>
</div>


