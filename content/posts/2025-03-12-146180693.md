---
layout: post
title: "使用OpenCV和MediaPipe库抽烟检测姿态监控"
date: 2025-03-12 09:00:00 +0800
description: "抽烟检测技术可用于公共安全、智能城市、健康管理、商业分析等领域，结合计算机视觉、传感器和物联网，实现自动检测、警报和数据分析，提高安全性与管理效率。"
keywords: "opencv mediapipe"
categories: ['Python', 'Ai']
tags: ['计算机视觉', '人工智能', 'Opencv']
artid: "146180693"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146180693
    alt: "使用OpenCV和MediaPipe库抽烟检测姿态监控"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146180693
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146180693
cover: https://bing.ee123.net/img/rand?artid=146180693
image: https://bing.ee123.net/img/rand?artid=146180693
img: https://bing.ee123.net/img/rand?artid=146180693
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     使用OpenCV和MediaPipe库——抽烟检测（姿态监控）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
    </p>
    <p class="img-center">
     <img alt="" src="https://i-blog.csdnimg.cn/direct/3935f452d9ec430888ea8006539039b4.jpeg"/>
    </p>
    <hr id="hr-toc" name="tableOfContents"/>
    <p>
    </p>
    <hr/>
    <h2 id="%E6%8A%BD%E7%83%9F%E6%A3%80%E6%B5%8B%E7%9A%84%E8%BF%90%E7%94%A8" name="%E6%8A%BD%E7%83%9F%E6%A3%80%E6%B5%8B%E7%9A%84%E8%BF%90%E7%94%A8">
     抽烟检测的运用
    </h2>
    <h3 id="1.%20%E5%AE%89%E5%85%A8%E7%9B%91%E6%8E%A7" name="1.%20%E5%AE%89%E5%85%A8%E7%9B%91%E6%8E%A7">
     <strong>
      1. 安全监控
     </strong>
    </h3>
    <h4 id="(1)%20%E5%85%AC%E5%85%B1%E5%9C%BA%E6%89%80%E7%A6%81%E7%83%9F%E7%9B%91%E7%AE%A1" name="(1)%20%E5%85%AC%E5%85%B1%E5%9C%BA%E6%89%80%E7%A6%81%E7%83%9F%E7%9B%91%E7%AE%A1">
     <strong>
      (1) 公共场所禁烟监管
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       应用场景
      </strong>
      ：机场、火车站、地铁站、医院、商场、学校等禁烟区域。
     </li>
     <li>
      <strong>
       作用
      </strong>
      ：利用摄像头自动检测吸烟行为，触发警报或通知管理人员干预，减少人工巡逻成本。
     </li>
    </ul>
    <h4 id="(2)%20%E5%B7%A5%E4%B8%9A%E5%AE%89%E5%85%A8" name="(2)%20%E5%B7%A5%E4%B8%9A%E5%AE%89%E5%85%A8">
     <strong>
      (2) 工业安全
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       应用场景
      </strong>
      ：化工厂、加油站、煤矿、仓库等易燃易爆场所。
     </li>
     <li>
      <strong>
       作用
      </strong>
      ：实时监测抽烟行为，防止安全事故，提高生产安全管理。
     </li>
    </ul>
    <hr/>
    <h3 id="2.%20%E6%99%BA%E8%83%BD%E5%9F%8E%E5%B8%82%E4%B8%8E%E6%89%A7%E6%B3%95" name="2.%20%E6%99%BA%E8%83%BD%E5%9F%8E%E5%B8%82%E4%B8%8E%E6%89%A7%E6%B3%95">
     <strong>
      2. 智能城市与执法
     </strong>
    </h3>
    <h4 id="(1)%20%E5%9F%8E%E5%B8%82%E8%BF%9D%E7%AB%A0%E5%90%B8%E7%83%9F%E6%A3%80%E6%B5%8B" name="(1)%20%E5%9F%8E%E5%B8%82%E8%BF%9D%E7%AB%A0%E5%90%B8%E7%83%9F%E6%A3%80%E6%B5%8B">
     <strong>
      (1) 城市违章吸烟检测
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       应用场景
      </strong>
      ：公交站、公共厕所、电梯、餐厅等区域。
     </li>
     <li>
      <strong>
       作用
      </strong>
      ：结合智能监控系统，对违规吸烟行为进行抓拍、存证，甚至自动处罚。
     </li>
    </ul>
    <h4 id="(2)%20%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E7%AE%A1%E7%90%86" name="(2)%20%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E7%AE%A1%E7%90%86">
     <strong>
      (2) 无人值守管理
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       应用场景
      </strong>
      ：智能楼宇、写字楼、电影院等无人巡逻区域。
     </li>
     <li>
      <strong>
       作用
      </strong>
      ：通过 AI 检测+语音提醒，劝阻违规吸烟者。
     </li>
    </ul>
    <hr/>
    <h3 id="3.%20%E5%81%A5%E5%BA%B7%E7%AE%A1%E7%90%86%E4%B8%8E%E5%8C%BB%E7%96%97" name="3.%20%E5%81%A5%E5%BA%B7%E7%AE%A1%E7%90%86%E4%B8%8E%E5%8C%BB%E7%96%97">
     <strong>
      3. 健康管理与医疗
     </strong>
    </h3>
    <h4 id="(1)%20%E5%90%B8%E7%83%9F%E4%B9%A0%E6%83%AF%E5%88%86%E6%9E%90" name="(1)%20%E5%90%B8%E7%83%9F%E4%B9%A0%E6%83%AF%E5%88%86%E6%9E%90">
     <strong>
      (1) 吸烟习惯分析
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       应用场景
      </strong>
      ：医院、戒烟中心、健康管理 APP。
     </li>
     <li>
      <strong>
       作用
      </strong>
      ：记录个人抽烟次数、时间、环境等数据，帮助戒烟计划制定。
     </li>
    </ul>
    <h4 id="(2)%20%E8%BF%9C%E7%A8%8B%E7%9B%91%E6%8A%A4" name="(2)%20%E8%BF%9C%E7%A8%8B%E7%9B%91%E6%8A%A4">
     <strong>
      (2) 远程监护
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       应用场景
      </strong>
      ：养老院、精神病院等特殊场所。
     </li>
     <li>
      <strong>
       作用
      </strong>
      ：监测老年人或患者是否有吸烟行为，防止健康风险。
     </li>
    </ul>
    <hr/>
    <h3 id="4.%20AI%20%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%95%86%E4%B8%9A%E5%88%86%E6%9E%90" name="4.%20AI%20%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%95%86%E4%B8%9A%E5%88%86%E6%9E%90">
     <strong>
      4. AI 监控与商业分析
     </strong>
    </h3>
    <h4 id="(1)%20%E4%BF%9D%E9%99%A9%E8%A1%8C%E4%B8%9A" name="(1)%20%E4%BF%9D%E9%99%A9%E8%A1%8C%E4%B8%9A">
     <strong>
      (1) 保险行业
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       应用场景
      </strong>
      ：人寿保险、健康保险公司。
     </li>
     <li>
      <strong>
       作用
      </strong>
      ：检测投保人是否吸烟，调整保费或健康建议。
     </li>
    </ul>
    <h4 id="(2)%20%E5%95%86%E5%9C%BA%E8%90%A5%E9%94%80" name="(2)%20%E5%95%86%E5%9C%BA%E8%90%A5%E9%94%80">
     <strong>
      (2) 商场营销
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       应用场景
      </strong>
      ：便利店、烟草店。
     </li>
     <li>
      <strong>
       作用
      </strong>
      ：分析吸烟人群的特征，优化营销策略。
     </li>
    </ul>
    <hr/>
    <h3 id="5.%20%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0" name="5.%20%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0">
     <strong>
      5. 技术实现
     </strong>
    </h3>
    <h4 id="(1)%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89" name="(1)%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89">
     <strong>
      (1) 计算机视觉
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       算法
      </strong>
      ：基于
      <strong>
       YOLO、Faster R-CNN
      </strong>
      等目标检测模型。
     </li>
     <li>
      <strong>
       数据
      </strong>
      ：训练数据包含吸烟者的手部、嘴部、烟雾等特征。
     </li>
    </ul>
    <h4 id="(2)%20%E4%BC%A0%E6%84%9F%E5%99%A8%E6%A3%80%E6%B5%8B" name="(2)%20%E4%BC%A0%E6%84%9F%E5%99%A8%E6%A3%80%E6%B5%8B">
     <strong>
      (2) 传感器检测
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       红外摄像头
      </strong>
      ：检测烟头的温度特征。
     </li>
     <li>
      <strong>
       空气质量传感器
      </strong>
      ：监测 PM2.5、尼古丁气味等。
     </li>
    </ul>
    <h4 id="(3)%20%E7%BB%93%E5%90%88%E7%89%A9%E8%81%94%E7%BD%91%EF%BC%88IoT%EF%BC%89" name="(3)%20%E7%BB%93%E5%90%88%E7%89%A9%E8%81%94%E7%BD%91%EF%BC%88IoT%EF%BC%89">
     <strong>
      (3) 结合物联网（IoT）
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       智能监控摄像头
      </strong>
      ：内置 AI 识别系统，边缘计算本地处理数据。
     </li>
     <li>
      <strong>
       云平台
      </strong>
      ：接收数据并发出警报。
     </li>
    </ul>
    <hr/>
    <h3 id="6.%20%E6%8C%91%E6%88%98%E4%B8%8E%E4%BC%98%E5%8C%96" name="6.%20%E6%8C%91%E6%88%98%E4%B8%8E%E4%BC%98%E5%8C%96">
     <strong>
      6. 挑战与优化
     </strong>
    </h3>
    <h4 id="(1)%20%E8%AF%AF%E6%8A%A5%E9%97%AE%E9%A2%98" name="(1)%20%E8%AF%AF%E6%8A%A5%E9%97%AE%E9%A2%98">
     <strong>
      (1) 误报问题
     </strong>
    </h4>
    <ul>
     <li>
      误将吸烟动作与喝水、拿笔等动作混淆。
     </li>
     <li>
      解决方案：使用时间序列分析、骨骼检测等方法提高准确率。
     </li>
    </ul>
    <h4 id="(2)%20%E5%A4%9C%E9%97%B4%E6%A3%80%E6%B5%8B%E9%9A%BE%E5%BA%A6" name="(2)%20%E5%A4%9C%E9%97%B4%E6%A3%80%E6%B5%8B%E9%9A%BE%E5%BA%A6">
     <strong>
      (2) 夜间检测难度
     </strong>
    </h4>
    <ul>
     <li>
      夜间光照条件差，普通摄像头难以检测烟雾。
     </li>
     <li>
      解决方案：采用
      <strong>
       红外摄像头
      </strong>
      结合 AI 算法提高夜间识别率。
     </li>
    </ul>
    <h4 id="(3)%20%E9%9A%90%E7%A7%81%E9%97%AE%E9%A2%98" name="(3)%20%E9%9A%90%E7%A7%81%E9%97%AE%E9%A2%98">
     <strong>
      (3) 隐私问题
     </strong>
    </h4>
    <ul>
     <li>
      监控摄像头涉及个人隐私，可能引发争议。
     </li>
     <li>
      解决方案：使用
      <strong>
       边缘计算
      </strong>
      ，仅上传检测结果，不存储人脸信息。
     </li>
    </ul>
    <hr/>
    <hr/>
    <hr/>
    <h2 id="%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF" name="%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF">
     代码实现思路
    </h2>
    <h3 id="%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF" name="%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF">
     <strong>
      实现思路
     </strong>
    </h3>
    <h4 id="1.%20%E5%88%9D%E5%A7%8B%E5%8C%96%E6%A3%80%E6%B5%8B%E6%A8%A1%E5%9E%8B" name="1.%20%E5%88%9D%E5%A7%8B%E5%8C%96%E6%A3%80%E6%B5%8B%E6%A8%A1%E5%9E%8B">
     <strong>
      1. 初始化检测模型
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       MediaPipe Hands
      </strong>
      ：用于检测
      <strong>
       手部位置
      </strong>
      ，得到手的边界框（bounding box）。
     </li>
     <li>
      <strong>
       dlib 人脸关键点检测
      </strong>
      ：用于检测
      <strong>
       嘴部关键点
      </strong>
      ，确定嘴巴的位置。
     </li>
     <li>
      <strong>
       YOLOv3
      </strong>
      ：用于检测
      <strong>
       香烟
      </strong>
      ，需要加载权重（
      <code>
       yolov3.weights
      </code>
      ）、配置文件（
      <code>
       yolov3.cfg
      </code>
      ）和类别标签（
      <code>
       coco.names
      </code>
      ）。
     </li>
    </ul>
    <hr/>
    <h4 id="2.%20%E8%AF%BB%E5%8F%96%E8%A7%86%E9%A2%91%E6%B5%81" name="2.%20%E8%AF%BB%E5%8F%96%E8%A7%86%E9%A2%91%E6%B5%81">
     <strong>
      2. 读取视频流
     </strong>
    </h4>
    <ul>
     <li>
      通过
      <code>
       cv2.VideoCapture(0)
      </code>
      打开摄像头，逐帧读取视频。
     </li>
    </ul>
    <hr/>
    <h4 id="3.%20%E6%89%8B%E9%83%A8%E6%A3%80%E6%B5%8B" name="3.%20%E6%89%8B%E9%83%A8%E6%A3%80%E6%B5%8B">
     <strong>
      3. 手部检测
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       MediaPipe Hands
      </strong>
      处理帧图像，返回检测到的手部
      <strong>
       关键点
      </strong>
      。
     </li>
     <li>
      计算手部的
      <strong>
       边界框
      </strong>
      （
      <code>
       x_min, y_min, x_max, y_max
      </code>
      ）。
     </li>
     <li>
      使用
      <code>
       cv2.rectangle()
      </code>
      画出手部边界框。
     </li>
    </ul>
    <hr/>
    <h4 id="4.%20%E9%A6%99%E7%83%9F%E6%A3%80%E6%B5%8B" name="4.%20%E9%A6%99%E7%83%9F%E6%A3%80%E6%B5%8B">
     <strong>
      4. 香烟检测
     </strong>
    </h4>
    <ul>
     <li>
      通过
      <strong>
       YOLOv3 目标检测
      </strong>
      识别图像中的物体（包括香烟）。
     </li>
     <li>
      过滤出
      <strong>
       类别为 "cigarette" 的目标
      </strong>
      ，并记录香烟的边界框信息（
      <code>
       cigarette_bboxes
      </code>
      ）。
     </li>
     <li>
      使用
      <code>
       cv2.rectangle()
      </code>
      画出香烟的位置。
     </li>
    </ul>
    <hr/>
    <h4 id="5.%20%E5%98%B4%E9%83%A8%E6%A3%80%E6%B5%8B" name="5.%20%E5%98%B4%E9%83%A8%E6%A3%80%E6%B5%8B">
     <strong>
      5. 嘴部检测
     </strong>
    </h4>
    <ul>
     <li>
      通过
      <strong>
       dlib 人脸检测器
      </strong>
      定位人脸，并使用
      <strong>
       68个面部关键点
      </strong>
      识别嘴部（
      <strong>
       第48-67号点
      </strong>
      ）。
     </li>
     <li>
      计算
      <strong>
       嘴部中心位置
      </strong>
      。
     </li>
     <li>
      用
      <code>
       cv2.polylines()
      </code>
      画出嘴部区域。
     </li>
    </ul>
    <hr/>
    <h4 id="6.%20%E6%8A%BD%E7%83%9F%E8%A1%8C%E4%B8%BA%E5%88%A4%E6%96%AD" name="6.%20%E6%8A%BD%E7%83%9F%E8%A1%8C%E4%B8%BA%E5%88%A4%E6%96%AD">
     <strong>
      6. 抽烟行为判断
     </strong>
    </h4>
    <ul>
     <li>
      遍历每只
      <strong>
       手的边界框
      </strong>
      ：
      <ol>
       <li>
        <strong>
         判断是否持有香烟
        </strong>
        （手与香烟的
        <strong>
         IOU 交并比
        </strong>
        是否超过阈值
        <code>
         0.3
        </code>
        ）。
       </li>
       <li>
        <strong>
         计算手部到嘴部的距离
        </strong>
        ：
        <ul>
         <li>
          获取手部中心
          <code>
           (hand_center_x, hand_center_y)
          </code>
          。
         </li>
         <li>
          计算与
          <strong>
           最近的嘴部中心
          </strong>
          的欧几里得距离
          <code>
           distance
          </code>
          。
         </li>
        </ul>
       </li>
       <li>
        <strong>
         综合判断抽烟行为
        </strong>
        ：
        <ul>
         <li>
          若
          <strong>
           手持香烟 且 距离嘴部&lt;100像素
          </strong>
          ，则判定
          <strong>
           正在抽烟
          </strong>
          。
         </li>
         <li>
          若
          <strong>
           手部靠近嘴部&lt;50像素
          </strong>
          ，但未持有香烟，则
          <strong>
           可能在抽烟
          </strong>
          （警告）。
         </li>
        </ul>
       </li>
      </ol>
     </li>
    </ul>
    <hr/>
    <h4 id="7.%20%E5%8F%AF%E8%A7%86%E5%8C%96%E8%BE%93%E5%87%BA" name="7.%20%E5%8F%AF%E8%A7%86%E5%8C%96%E8%BE%93%E5%87%BA">
     <strong>
      7. 可视化输出
     </strong>
    </h4>
    <ul>
     <li>
      如果检测到
      <strong>
       正在抽烟
      </strong>
      ：
      <ul>
       <li>
        在屏幕上显示
        <strong>
         "WARNING: Active Smoking Detected!"
        </strong>
        （红色警告）。
       </li>
      </ul>
     </li>
     <li>
      如果
      <strong>
       疑似抽烟
      </strong>
      （手靠近嘴但未持烟）：
      <ul>
       <li>
        显示
        <strong>
         "Potential Smoking!"
        </strong>
        （黄色提示）。
       </li>
      </ul>
     </li>
     <li>
      画出所有检测到的
      <strong>
       手部、香烟、嘴部
      </strong>
      。
     </li>
    </ul>
    <hr/>
    <h4 id="8.%20%E8%BF%90%E8%A1%8C%E4%B8%BB%E5%BE%AA%E7%8E%AF" name="8.%20%E8%BF%90%E8%A1%8C%E4%B8%BB%E5%BE%AA%E7%8E%AF">
     <strong>
      8. 运行主循环
     </strong>
    </h4>
    <ul>
     <li>
      不断读取摄像头画面，并调用
      <code>
       detect_smoking(frame)
      </code>
      进行检测。
     </li>
     <li>
      按下
      <code>
       ESC
      </code>
      退出程序。
     </li>
    </ul>
    <hr/>
    <hr/>
    <hr/>
    <h2 id="%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81" name="%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81">
     完整代码
    </h2>
    <pre><code class="language-python">import cv2
import numpy as np
import dlib
import mediapipe as mp

# 初始化MediaPipe手部检测
mp_hands = mp.solutions.hands
hands = mp_hands.Hands(
    max_num_hands=2,
    min_detection_confidence=0.7,
    min_tracking_confidence=0.5
)

# 初始化dlib人脸检测
detector = dlib.get_frontal_face_detector()
predictor = dlib.shape_predictor("shape_predictor_68_face_landmarks.dat")

# 加载YOLOv3模型（需包含自定义训练的香烟类别）
net = cv2.dnn.readNet("yolov3.weights", "yolov3.cfg")
layer_names = net.getLayerNames()
output_layers = [layer_names[i - 1] for i in net.getUnconnectedOutLayers().flatten()]

with open("coco.names", "r") as f:
    classes = [line.strip() for line in f.readlines()]


def is_holding_cigarette(hand_bbox, cigarette_bboxes, iou_threshold=0.3):
    """判断手部是否持有香烟（基于IOU）"""
    for cig_bbox in cigarette_bboxes:
        # 计算IOU
        x1 = max(hand_bbox[0], cig_bbox[0])
        y1 = max(hand_bbox[1], cig_bbox[1])
        x2 = min(hand_bbox[2], cig_bbox[2])
        y2 = min(hand_bbox[3], cig_bbox[3])

        intersection = max(0, x2 - x1) * max(0, y2 - y1)
        area_hand = (hand_bbox[2] - hand_bbox[0]) * (hand_bbox[3] - hand_bbox[1])
        area_cig = (cig_bbox[2] - cig_bbox[0]) * (cig_bbox[3] - cig_bbox[1])

        iou = intersection / (area_hand + area_cig - intersection)
        if iou &gt; iou_threshold:
            return True
    return False


def detect_smoking(frame):
    # 转换为RGB格式（MediaPipe需要）
    rgb_frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)

    # 手部检测
    hand_bboxes = []
    results = hands.process(rgb_frame)
    if results.multi_hand_landmarks:
        for landmarks in results.multi_hand_landmarks:
            # 获取手部边界框
            x_coords = [lm.x * frame.shape[1] for lm in landmarks.landmark]
            y_coords = [lm.y * frame.shape[0] for lm in landmarks.landmark]
            x_min, x_max = min(x_coords), max(x_coords)
            y_min, y_max = min(y_coords), max(y_coords)
            hand_bboxes.append((x_min, y_min, x_max, y_max))
            cv2.rectangle(frame, (int(x_min), int(y_min)),
                          (int(x_max), int(y_max)), (255, 0, 0), 2)

    # YOLOv3香烟检测
    cigarette_bboxes = []
    blob = cv2.dnn.blobFromImage(frame, 0.00392, (320, 320), swapRB=True)
    net.setInput(blob)
    outs = net.forward(output_layers)

    for out in outs:
        for detection in out:
            scores = detection[5:]
            class_id = np.argmax(scores)
            confidence = scores[class_id]
            if confidence &gt; 0.5 and classes[class_id] == "cigarette":
                center_x = int(detection[0] * frame.shape[1])
                center_y = int(detection[1] * frame.shape[0])
                w = int(detection[2] * frame.shape[1])
                h = int(detection[3] * frame.shape[0])
                x = center_x - w // 2
                y = center_y - h // 2
                cigarette_bboxes.append((x, y, x + w, y + h))
                cv2.rectangle(frame, (x, y), (x + w, y + h), (0, 255, 0), 2)

    # 人脸关键点检测
    mouth_positions = []
    faces = detector(frame)
    for face in faces:
        landmarks = predictor(frame, face)
        mouth_points = [(landmarks.part(i).x, landmarks.part(i).y)
                        for i in range(48, 68)]
        mouth_center = np.mean(mouth_points, axis=0)
        mouth_positions.append(mouth_center)
        # 绘制嘴巴区域
        cv2.polylines(frame, [np.array(mouth_points, dtype=np.int32)],
                      True, (0, 0, 255), 2)

    # 综合判断逻辑
    warning = False
    for hand in hand_bboxes:
        # 判断是否持烟
        holding = is_holding_cigarette(hand, cigarette_bboxes)

        # 计算手部中心点
        hand_center = ((hand[0] + hand[2]) / 2, (hand[1] + hand[3]) / 2)

        # 找最近的人脸
        min_distance = float('inf')
        for mouth in mouth_positions:
            distance = np.sqrt((hand_center[0] - mouth[0]) ** 2 +
                               (hand_center[1] - mouth[1]) ** 2)
            min_distance = min(min_distance, distance)

        # 判断条件
        if holding and min_distance &lt; 100:  # 持烟且距离&lt;100像素
            warning = True
        elif min_distance &lt; 50:  # 未持烟但手部靠近嘴部
            cv2.putText(frame, "Potential Smoking!",
                        (int(hand[0]), int(hand[1]) - 10),
                        cv2.FONT_HERSHEY_SIMPLEX, 0.7, (0, 255, 255), 2)

    if warning:
        cv2.putText(frame, "WARNING: Active Smoking Detected!",
                    (20, 50), cv2.FONT_HERSHEY_SIMPLEX,
                    1, (0, 0, 255), 3, cv2.LINE_AA)

    return frame


# 视频处理主循环
cap = cv2.VideoCapture(0)
while cap.isOpened():
    ret, frame = cap.read()
    if not ret:
        break

    frame = cv2.flip(frame, 1)  # 镜像翻转
    result = detect_smoking(frame)

    cv2.imshow('Smoking Detection', result)
    if cv2.waitKey(1) == 27:
        break

cap.release()
cv2.destroyAllWindows()
</code></pre>
    <hr/>
    <h2 id="%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA" name="%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA">
     效果展示
    </h2>
    <p class="img-center">
     <img alt="" height="600" src="https://i-blog.csdnimg.cn/direct/ce3bb1c1e71e4c1180b6f8f3a66ac793.jpeg" width="800"/>
    </p>
    <p>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f44444444574a444444442f:61727469636c652f64657461696c732f313436313830363933" class_="artid" style="display:none">
 </p>
</div>


