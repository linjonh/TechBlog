---
layout: post
title: "RTP-RTCP在音视频传输与同步方面的使用"
date: 2024-12-19 00:34:24 +0800
description: "http://blog.sina.com.cn/s/blog_488365030100ccp8.ht"
keywords: "live555 server发送的流接收rtcp后音视频不同步"
categories: ['Jrtplib']
tags: ['无标签']
artid: "10033559"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=10033559
    alt: "RTP-RTCP在音视频传输与同步方面的使用"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=10033559
featuredImagePreview: https://bing.ee123.net/img/rand?artid=10033559
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     RTP RTCP在音视频传输与同步方面的使用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <a href="http://blog.sina.com.cn/s/blog_488365030100ccp8.html" rel="nofollow noopener noreferrer" target="_blank">
      http://blog.sina.com.cn/s/blog_488365030100ccp8.html
     </a>
    </p>
    <p style="">
     <a name="_Toc197953388" style="color:rgb(118,95,71); text-decoration:underline" target="_blank">
      <strong>
       1
       <wbr/>
      </strong>
     </a>
     <strong>
      音视频实时传输
     </strong>
    </p>
    <p style="">
     <a name="_Toc200028598" style="color:rgb(118,95,71); text-decoration:underline" target="_blank">
     </a>
     <a name="_Toc198718607" style="color:rgb(118,95,71); text-decoration:underline" target="_blank">
     </a>
     <a name="_Toc197953389" style="color:rgb(118,95,71); text-decoration:underline" target="_blank">
      <strong>
       1.1
       <wbr/>
       Jrtplib
      </strong>
     </a>
     <strong>
      库介绍
     </strong>
    </p>
    <p style="">
     本系统采用开源库Jrtplib进行RTP传输模块的开发。Jrtplib库是由比利时Hasselt大学EDM（Expertise Centre for Digital Media）开发的一个用C++语言实现的完全开源的RTP库，目前已经可以运行在Windows、Linux、FreeBSD、Solaris、Unix和VxWorks等多种操作系统上，其现有的最新版本为Jrtplib3.7.1。
    </p>
    <p style="">
     Jrtplib完全遵循RFC3550标准设计，提供了丰富的接口，使用win32 socket实现网络通讯。应用该库进行开发设计时，开发人员只需要关心RTP负载、RTCP负载、时间戳增量、发送目标地址及端口、RTCP带宽及发送间隔等最基本的问题，而不必考虑一些琐碎的细节,可以从Jrtplib的网站（http://lumumba.luc.ac.be/jori/jrtplib/jrtplib.html）下载更新的源码包。
    </p>
    <p style="">
     <a name="_Toc200028599" style="color:rgb(118,95,71); text-decoration:underline" target="_blank">
     </a>
     <a name="_Toc198718608" style="color:rgb(118,95,71); text-decoration:underline" target="_blank">
     </a>
     <a name="_Toc197953390" style="color:rgb(118,95,71); text-decoration:underline" target="_blank">
      <strong>
       1.2
       <wbr/>
      </strong>
     </a>
     <strong>
      Jrtplib初始化
     </strong>
    </p>
    <p style="">
     在使用Jrtplib进行实时流媒体数据传输之前，首先应该生成RTPSession类的一个实例来表示此次RTP会话，然后调用Create() 方法来对其进行初始化操作。RTPSession类的Create()方法只有一个参数，用来指明此次RTP会话所采用的端口号。示例1中给出了一个最简单的初始化框架，它只是完成了RTP会话的初始化工作，还不具备任何实际的功能。
    </p>
    <p style="">
     1、initial.cpp
    </p>
    <p style="">
     ＃include "rtpsession.h"
    </p>
    <p style="">
     int main(void)
    </p>
    <p style="">
     {
     <!-- -->
    </p>
    <p style="">
     RTPSession sess；
    </p>
    <p style="">
     sess.Create(5000)；
    </p>
    <p style="">
     return 0；
    </p>
    <p style="">
     }
    </p>
    <p style="">
     如果RTP会话创建过程失败，Create()方法将会返回一个负数，通过它虽然可以很容易地判断出函数调用究竟是成功的还是失败的，但却很难明白出错的原因到底什么。Jrtplib采用了统一的错误处理机制，它提供的所有函数如果返回负数就表明出现了某种形式的错误，而具体的出错信息则可以通过调用 RTPGetErrorString()函数得到。RTPGetErrorString()函数将错误代码作为参数传入，然后返回该错误代码所对应的错误信息。示例2给出了一个更加完整的初始化框架，它可以对RTP会话初始化过程中所产生的错误进行更好的处理：
    </p>
    <p style="">
     2、framework.cpp
    </p>
    <p style="">
     ＃include
    </p>
    <p style="">
     ＃include "rtpsession.h"
    </p>
    <p style="">
     int main(void)
    </p>
    <p style="">
     {
     <!-- -->
    </p>
    <p style="">
     RTPSession sess；
    </p>
    <p style="">
     int status；
    </p>
    <p style="">
     char* msg；
    </p>
    <p style="">
     sess.Create(6000)；
    </p>
    <p style="">
     msg = RTPGetErrorString(status)；
    </p>
    <p style="">
     printf("Error String：%s\\n"，msg)；
    </p>
    <p style="">
     return 0；
    </p>
    <p style="">
     }
    </p>
    <p style="">
     设置恰当的时戳单元，是RTP会话初始化过程所要进行的另外一项重要工作，这是通过调用RTPSession类的SetTimestampUnit ()方法来实现的，该方法同样也只有一个参数，表示的是以秒为单元的时戳单元。例如，当使用RTP会话传输8000Hz采样的音频数据时，由于时戳每秒钟将递增8000，所以时戳单元相应地应该被设置成1/8000：
    </p>
    <p style="">
     sess.SetTimestampUnit(1.0/8000.0)；
    </p>
    <p style="">
     <a name="_Toc200028600" style="color:rgb(118,95,71); text-decoration:underline" target="_blank">
     </a>
     <a name="_Toc198718609" style="color:rgb(118,95,71); text-decoration:underline" target="_blank">
      <strong>
       1.3
       <wbr/>
       Jrtplib
      </strong>
     </a>
     <strong>
      数据发送
     </strong>
    </p>
    <p style="">
     当RTP会话成功建立起来之后，接下去就可以开始进行流媒体数据的实时传输了。首先需要设置好数据发送的目标地址，RTP协议允许同一会话存在多个目标地址，这可以通过调用RTPSession类的AddDestination()、DeleteDestination()和 ClearDestinations()方法来完成。例如，下面的语句表示的是让RTP会话将数据发送到本地主机的6000端口：
    </p>
    <p style="">
     unsigned long addr = ntohl(inet_addr("127.0.0.1"))；
    </p>
    <p style="">
     sess.AddDestination(addr， 6000)；
    </p>
    <p style="">
     目标地址全部指定之后，接着就可以调用RTPSession类的SendPacket()方法，向所有的目标地址发送流媒体数据。SendPacket()是RTPSession类提供的一个重载函数，它具有下列多种形式：
    </p>
    <p style="">
     int SendPacket(void *data，int len)
    </p>
    <p style="">
     int SendPacket(void *data，int len，unsigned char pt，bool mark，unsigned long timestampinc)
    </p>
    <p style="">
     int SendPacket(void *data，int len，unsigned short hdrextID，void *hdrextdata，int numhdrextwords)
    </p>
    <p style="">
     int SendPacket(void *data，int len，unsigned char pt，bool mark，unsigned long timestampinc，unsigned short hdrextID，void *hdrextdata，int numhdrextwords)
    </p>
    <p style="">
     SendPacket()最典型的用法是类似于下面的语句，其中第一个参数是要被发送的数据，而第二个参数则指明将要发送数据的长度，再往后依次是RTP负载类型、标识和时戳增量。
    </p>
    <p style="">
     sess.SendPacket(buffer,5,0,false,10)；
    </p>
    <p style="">
     对于同一个RTP会话来讲，负载类型、标识和时戳增量通常来讲都是相同的，Jrtplib允许将它们设置为会话的默认参数，这是通过调用 RTPSession类的SetDefaultPayloadType()、SetDefaultMark()和 SetDefaultTimeStampIncre
     <wbr/>
     ment()方法来完成的。为RTP会话设置这些默认参数的好处是可以简化数据的发送，例如，如果为 RTP会话设置了默认参数：
    </p>
    <p style="">
     sess.SetDefaultPayloadType(0)；
    </p>
    <p style="">
     sess.SetDefaultMark(false)；
    </p>
    <p style="">
     sess.SetDefaultTimeStampIncre
     <wbr/>
     ment(10)；
    </p>
    <p style="">
     之后在进行数据发送时只需指明要发送的数据及其长度就可以了：
    </p>
    <p style="">
     sess.SendPacket(buffer,5)；
    </p>
    <p style="">
     <a name="_Toc198718610" style="color:rgb(118,95,71); text-decoration:underline" target="_blank">
      <strong>
       1.4
       <wbr/>
       Jrtplib
      </strong>
     </a>
     <strong>
      数据接收
     </strong>
    </p>
    <p style="">
     对于流媒体数据的接收端，首先需要调用RTPSession类的PollData()方法来接收发送过来的RTP或者RTCP数据报。由于同一个 RTP会话中允许有多个参与者（源），既可以通过调用RTPSession类的GotoFirstSource()和GotoNextSource() 方法来遍历所有的源，也可以通过调用RTPSession类的GotoFirstSourceWithData()和 GotoNextSourceWithData()方法来遍历那些携带有数据的源。在从RTP会话中检测出有效的数据源之后，接下去就可以调用 RTPSession类的GetNextPacket()方法从中抽取RTP数据报，当接收到的RTP数据报处理完之后，一定要记得及时释放。下面的代码示范了该如何对接收到的RTP数据报进行处理：
    </p>
    <p style="">
     if (sess.GotoFirstSourceWithData()) {
     <!-- -->
    </p>
    <p style="">
     do {
     <!-- -->
    </p>
    <p style="">
     RTPPacket *pack；
    </p>
    <p style="">
     pack = sess.GetNextPacket()； // 处理接收到的数据
    </p>
    <p style="">
     delete pack；
    </p>
    <p style="">
     } while (sess.GotoNextSourceWithData())；
    </p>
    <p style="">
     }
    </p>
    <p style="">
     Jrtplib为RTP数据报定义了三种接收模式，其中每种接收模式都具体规定了哪些到达的RTP数据报将会被接受，而哪些到达的RTP数据报将会被拒绝。通过调用RTPSession类的SetReceiveMode()方法可以设置下列这些接收模式：
    </p>
    <p style="">
     a) RECEIVEMODE_ALL　缺省的接收模式，所有到达的RTP数据报都将被接受；
    </p>
    <p style="">
     b) RECEIVEMODE_IGNORESOME　除了某些特定的发送者之外，所有到达的RTP数据报都将被接受，而被拒绝的发送者列表可以通过调用AddToIgnoreList()、DeleteFromIgnoreList()和ClearIgnoreList()方法来进行设置；
    </p>
    <p style="">
     c) RECEIVEMODE_ACCEPTSOME　除了某些特定的发送者之外，所有到达的RTP数据报都将被拒绝，而被接受的发送者列表可以通过调用AddToAcceptList ()、DeleteFromAcceptList()和ClearAcceptList ()方法来进行设置。
    </p>
    <p style="">
     <a name="_Toc197953391" style="color:rgb(118,95,71); text-decoration:underline" target="_blank">
      <strong>
       2
       <wbr/>
      </strong>
     </a>
     <strong>
      音视频同步
     </strong>
    </p>
    <p style="">
     <a name="_Toc197953392" style="color:rgb(118,95,71); text-decoration:underline" target="_blank">
      <strong>
       2.1
       <wbr/>
       RTCP
      </strong>
     </a>
     <strong>
      控制参数
     </strong>
    </p>
    <p style="">
     由于音视频流作为不同的RTP会话传送，它们在RTP层无直接关联。尽管由一个数据源发出的不同的流具有不同的同步源标识(SSRC)，为能进行流同步，RTCP要求发送方给接收方传送一个唯一的标识数据源的规范名(canonical name)，应用层藉此关联音视频流，以便实现同步。
    </p>
    <p style="">
     RTP/ RTCP中有时间戳（相对和绝对）和序列号等信息，可以利用它实现基于时间戳的多媒体流同步。使用相对时间戳和序列号实现流内同步；使用相对和绝对时间戳的对应关系实现流间同步。获得相对与绝对时间戳的算法如下：
    </p>
    <p style="">
     while ((pack = GetNextPacket()) != NULL)
    </p>
    <p style="">
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     {
     <!-- -->
    </p>
    <p style="">
     if(srcdat-&gt;SR_HasInfo() &amp;&amp; srcdat-&gt;SR_GetRTPTimestamp() != app-&gt;mvideortcprtp)
     <wbr/>
     <wbr/>
    </p>
    <p style="">
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     {
     <wbr/>
     <wbr/>
    </p>
    <p style="">
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     app-&gt;mvideortcprtp = srcdat-&gt;SR_GetRTPTimestamp();
    </p>
    <p style="">
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     app-&gt;mvideortcpntp = srcdat-&gt;SR_GetNTPTimestamp().GetMSW();
    </p>
    <p style="">
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     srcdat-&gt;FlushPackets();
     <wbr/>
     <wbr/>
     }
    </p>
    <p style="">
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     DeletePacket(pack);
    </p>
    <p style="">
     }
    </p>
    <p style="">
     <wbr/>
    </p>
    <p style="">
     <wbr/>
    </p>
    <p>
     <a name="_Toc197953395" style="" target="_blank">
      <strong>
       2.2
       <wbr/>
      </strong>
     </a>
     <span style="">
     </span>
     <strong style="">
      音视频流间同步实现
     </strong>
     <span style="">
     </span>
    </p>
    <p style="">
     <wbr/>
    </p>
    <p style="">
     发送端在发送音视频数据时，同时也会发送SR包，这样可以使接收方能够正确使音视频同步播放。具体实现方法是在接收方每次接收数据包后，再遍历一次数据源，获取所有源端的SS_RTPTime与SS_NTPTime这两则数据，通过获取音频端与视频端的数据，可以利用下面的公式进行计算。先描述变量如表2.1所列：
    </p>
    <p align="center" style="">
     表 2.1
     <wbr/>
     <wbr/>
     <wbr/>
     变量描述表
    </p>
    <p>
    </p>
    <table border="1" cellpadding="0" cellspacing="0" style="">
     <tbody>
      <tr>
       <td style="padding-bottom:0px; line-height:18px; margin:0px; padding-left:0px; padding-right:0px; font-family:Verdana,宋体,sans-serif; font-size:12px; padding-top:0px" width="99">
        <p style="border-bottom:0px; border-left:0px; padding-bottom:0px; line-height:18px; list-style-type:none; margin:0px 0px 5px; padding-left:0px; padding-right:0px; word-wrap:normal; word-break:normal; border-top:0px; border-right:0px; padding-top:0px">
         类型
        </p>
       </td>
       <td style="padding-bottom:0px; line-height:18px; margin:0px; padding-left:0px; padding-right:0px; font-family:Verdana,宋体,sans-serif; font-size:12px; padding-top:0px" width="144">
        <p style="border-bottom:0px; border-left:0px; padding-bottom:0px; line-height:18px; list-style-type:none; margin:0px 0px 5px; padding-left:0px; padding-right:0px; word-wrap:normal; word-break:normal; border-top:0px; border-right:0px; padding-top:0px">
         RTP数据
        </p>
       </td>
       <td style="padding-bottom:0px; line-height:18px; margin:0px; padding-left:0px; padding-right:0px; font-family:Verdana,宋体,sans-serif; font-size:12px; padding-top:0px" width="145">
        <p style="border-bottom:0px; border-left:0px; padding-bottom:0px; line-height:18px; list-style-type:none; margin:0px 0px 5px; padding-left:0px; padding-right:0px; word-wrap:normal; word-break:normal; border-top:0px; border-right:0px; padding-top:0px">
         NTP数据
        </p>
       </td>
       <td style="padding-bottom:0px; line-height:18px; margin:0px; padding-left:0px; padding-right:0px; font-family:Verdana,宋体,sans-serif; font-size:12px; padding-top:0px" width="142">
        <p style="border-bottom:0px; border-left:0px; padding-bottom:0px; line-height:18px; list-style-type:none; margin:0px 0px 5px; padding-left:0px; padding-right:0px; word-wrap:normal; word-break:normal; border-top:0px; border-right:0px; padding-top:0px">
         RTP时戳频率
        </p>
       </td>
      </tr>
      <tr>
       <td style="padding-bottom:0px; line-height:18px; margin:0px; padding-left:0px; padding-right:0px; font-family:Verdana,宋体,sans-serif; font-size:12px; padding-top:0px" width="99">
        <p style="border-bottom:0px; border-left:0px; padding-bottom:0px; line-height:18px; list-style-type:none; margin:0px 0px 5px; padding-left:0px; padding-right:0px; word-wrap:normal; word-break:normal; border-top:0px; border-right:0px; padding-top:0px">
         音频
        </p>
       </td>
       <td style="padding-bottom:0px; line-height:18px; margin:0px; padding-left:0px; padding-right:0px; font-family:Verdana,宋体,sans-serif; font-size:12px; padding-top:0px" width="144">
        <p style="border-bottom:0px; border-left:0px; padding-bottom:0px; line-height:18px; list-style-type:none; margin:0px 0px 5px; padding-left:0px; padding-right:0px; word-wrap:normal; word-break:normal; border-top:0px; border-right:0px; padding-top:0px">
         Audio_SRRTPTime
        </p>
       </td>
       <td style="padding-bottom:0px; line-height:18px; margin:0px; padding-left:0px; padding-right:0px; font-family:Verdana,宋体,sans-serif; font-size:12px; padding-top:0px" width="145">
        <p style="border-bottom:0px; border-left:0px; padding-bottom:0px; line-height:18px; list-style-type:none; margin:0px 0px 5px; padding-left:0px; padding-right:0px; word-wrap:normal; word-break:normal; border-top:0px; border-right:0px; padding-top:0px">
         <wbr/>
         Audio_SRNTPTime
        </p>
       </td>
       <td style="padding-bottom:0px; line-height:18px; margin:0px; padding-left:0px; padding-right:0px; font-family:Verdana,宋体,sans-serif; font-size:12px; padding-top:0px" width="142">
        <p style="border-bottom:0px; border-left:0px; padding-bottom:0px; line-height:18px; list-style-type:none; margin:0px 0px 5px; padding-left:0px; padding-right:0px; word-wrap:normal; word-break:normal; border-top:0px; border-right:0px; padding-top:0px">
         Audio_Fre
        </p>
       </td>
      </tr>
      <tr>
       <td style="padding-bottom:0px; line-height:18px; margin:0px; padding-left:0px; padding-right:0px; font-family:Verdana,宋体,sans-serif; font-size:12px; padding-top:0px" width="99">
        <p style="border-bottom:0px; border-left:0px; padding-bottom:0px; line-height:18px; list-style-type:none; margin:0px 0px 5px; padding-left:0px; padding-right:0px; word-wrap:normal; word-break:normal; border-top:0px; border-right:0px; padding-top:0px">
         视频
        </p>
       </td>
       <td style="padding-bottom:0px; line-height:18px; margin:0px; padding-left:0px; padding-right:0px; font-family:Verdana,宋体,sans-serif; font-size:12px; padding-top:0px" width="144">
        <p style="border-bottom:0px; border-left:0px; padding-bottom:0px; line-height:18px; list-style-type:none; margin:0px 0px 5px; padding-left:0px; padding-right:0px; word-wrap:normal; word-break:normal; border-top:0px; border-right:0px; padding-top:0px">
         Video_SRRTPTime
        </p>
       </td>
       <td style="padding-bottom:0px; line-height:18px; margin:0px; padding-left:0px; padding-right:0px; font-family:Verdana,宋体,sans-serif; font-size:12px; padding-top:0px" width="145">
        <p style="border-bottom:0px; border-left:0px; padding-bottom:0px; line-height:18px; list-style-type:none; margin:0px 0px 5px; padding-left:0px; padding-right:0px; word-wrap:normal; word-break:normal; border-top:0px; border-right:0px; padding-top:0px">
         <wbr/>
         Video_SRNTPTime
        </p>
       </td>
       <td style="padding-bottom:0px; line-height:18px; margin:0px; padding-left:0px; padding-right:0px; font-family:Verdana,宋体,sans-serif; font-size:12px; padding-top:0px" width="142">
        <p style="border-bottom:0px; border-left:0px; padding-bottom:0px; line-height:18px; list-style-type:none; margin:0px 0px 5px; padding-left:0px; padding-right:0px; word-wrap:normal; word-break:normal; border-top:0px; border-right:0px; padding-top:0px">
         Video_Fre
        </p>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
    </p>
    <p style="">
     从SR包中可以读出音频与视频的RTP与NTP数据，而需要计算的是时戳频率，利用下述公式：
    </p>
    <p style="">
     Audio_Fre=(AudioSRRTPtime2- AudioSRRTPtime1)/( AudioSRNTPtime2- AudioSRNTPtime1)；
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     (4.3)
    </p>
    <p style="">
     Video_Fre=( VideoSRRTPtime2- VideoSRRTPtime1)/( VideoSRNTPtime2- Video SRNTPtime1)；
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     (4.4)
    </p>
    <p style="">
     然后计算视频RTP的时间，即：
    </p>
    <p style="">
     Video_RTPTime=Video_SRRTPTime+(Audio_SRNTP-Video_SRRTP)×Video_Fre；
     <wbr/>
     <wbr/>
     <wbr/>
    </p>
    <p style="">
     (4.5)
    </p>
    <p style="">
     最后按式
     <wbr/>
     (4.6)即可计算出Video_TRUERTP时间，将其与从RTP包中读出的时间进行比较，就可以进行同步播放了。
    </p>
    <p style="">
     (Video_TRUERTP-Video_RTPTime)/Video_Fre=(Audio_TRUERTP-Audio_SRRTPTime)/Audio_Fre；
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     <wbr/>
     (4.6)
    </p>
    <p style="">
     下面采用临时缓冲区的方法来同步音视频。因为要保证音频优先正常传输，所以本系统以音频为主轴，视频为辅轴。以最大延迟时间为缓冲区大小，存放M个音频帧数据。当接收端获得M个音频帧后开始播放音频，每次获得视频帧时，就计算出当前视频应当播放RTP时间与现有RTP时间进行比对，如若在120ms以内，迅速播放；延迟120ms以上，则扔掉，然后比对下一帧；还在120ms以内，放入视频缓冲区内进行储存，如果视频缓冲区的大小超过了最大临时缓冲区的数值，依旧开始播放。
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f79616e343230353233:2f61727469636c652f64657461696c732f3130303333353539" class_="artid" style="display:none">
 </p>
</div>


