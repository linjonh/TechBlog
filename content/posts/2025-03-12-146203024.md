---
layout: post
title: "Go红队开发web网络编程"
date: 2025-03-12 13:44:19 +0800
description: "web网络编程—安全工具开发铺垫终章"
keywords: "Go红队开发—web网络编程"
categories: ['Go']
tags: ['网络', '开发语言', '安全', '前端', 'Web', 'Golang']
artid: "146203024"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146203024
    alt: "Go红队开发web网络编程"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146203024
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146203024
cover: https://bing.ee123.net/img/rand?artid=146203024
image: https://bing.ee123.net/img/rand?artid=146203024
img: https://bing.ee123.net/img/rand?artid=146203024
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Go红队开发—web网络编程
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="web_2">
     </a>
     web网络编程
    </h2>
    <p>
     <strong>
      <code>
       tips：这一章的铺垫比较重要，这章过后就是一些安全工具如何编写以及一些poc、exp的工具编写。
      </code>
     </strong>
    </p>
    <h3>
     <a id="Req_4">
     </a>
     Req
    </h3>
    <p>
     简单的请求
    </p>
    <ul>
     <li>
      客户端创建
     </li>
     <li>
      请求设置
     </li>
    </ul>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/a1291405fee93d369cdd0aeae815a941.png"/>
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">reqHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment">//客户端创建</span>

    res<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">//请求设置，这个点的意思链式调用，后续在控制请求中会讲</span>

                <span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"https://httpbin.org/uuid"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"请求失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_31">
     </a>
     快速请求
    </h4>
    <ul>
     <li>
      MustGet
      <br/>
      测试使用可以，正式开发不建议使用，可控性差
     </li>
    </ul>
    <pre><code class="prism language-go">
<span class="token comment">// 快速使用，一般用在test的时候</span>

<span class="token keyword">func</span> <span class="token function">testHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  

    resp <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">MustGet</span><span class="token punctuation">(</span><span class="token string">"https://httpbin.org/uuid"</span><span class="token punctuation">)</span> <span class="token comment">//这里就是发起了一次请求</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                      <span class="token comment">//第一种打印*req.Response类型的响应体</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>               <span class="token comment">//第二种打印*req.Response类型的响应体</span>

<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_51">
     </a>
     调试
    </h3>
    <h4>
     <a id="DevMode_52">
     </a>
     DevMode
    </h4>
    <p>
     DevMode是直接开启全局调试，自动打印出来
    </p>
    <pre><code class="prism language-go"><span class="token comment">// 调试模式</span>

<span class="token keyword">func</span> <span class="token function">devModeReq</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//使用req进行请求，所以req的调试模式也是在req启动</span>

    req<span class="token punctuation">.</span><span class="token function">DevMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                   <span class="token comment">//开启调试模式，就会打印出来请求的过程以及响应内容</span>

    req<span class="token punctuation">.</span><span class="token function">SetCommonBasicAuth</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">//设置用户名和密码</span>

                            <span class="token function">SetTimeout</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">//设置超时时间</span>

                            <span class="token function">SetUserAgent</span><span class="token punctuation">(</span><span class="token string">"my-ua"</span><span class="token punctuation">)</span>

    resp <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">MustGet</span><span class="token punctuation">(</span><span class="token string">"https://httpbin.org/uuid"</span><span class="token punctuation">)</span>

    <span class="token comment">//没有开启调试模式但是想打印的话就正常打印</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">//第一种打印*req.Response类型的响应体</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//第二种打印*req.Response类型的响应体</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="DebugLog_82">
     </a>
     DebugLog
    </h4>
    <p>
     DebugLog 是跟踪请求的过程
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/187a067f7860ab37afda2f92e0b1b823.png"/>
    </p>
    <p>
     他可以看到你整个请求的过程，重定向的信息等等
    </p>
    <pre><code class="prism language-go"><span class="token comment">// 查看请求的过程发生了什么</span>

<span class="token keyword">func</span> <span class="token function">deLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">EnableDebugLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//开启DebugLog</span>

    client<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"http://baidu.com/s?wd=req"</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="TraceInfo_103">
     </a>
     TraceInfo瓶颈分析
    </h4>
    <p>
     trace跟踪信息
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/59f72e6b7a0feea04c98935668789e42.png"/>
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">traceReq</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// Enable trace at request level</span>

    client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">EnableTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">//开启瓶颈分析</span>

        <span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"https://api.github.com/users/imroc"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    trace <span class="token operator">:=</span> resp<span class="token punctuation">.</span><span class="token function">TraceInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//trace跟踪信息</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>trace<span class="token punctuation">.</span><span class="token function">Blame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//分析总结(请求减慢的原因归咎)</span>

  

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>trace<span class="token punctuation">)</span> <span class="token comment">// 打印内容</span>

<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_137">
     </a>
     控制请求与响应
    </h3>
    <h4>
     <a id="_138">
     </a>
     控制请求的字段内容
    </h4>
    <p>
     这里做一个了解，后面会详细说一下作用范围，这里就过一遍即可，知道哪些字段可控(其实都可控)
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">controlReq</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  

    client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">SetUserAgent</span><span class="token punctuation">(</span><span class="token string">"my-ua"</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">//设置ua头，在client中设置，在下面的R()中设置不了</span>

        <span class="token comment">//EnableDumpAllToFile("log.txt") //将请求的信息写到该文件中</span>

        <span class="token comment">//捕获请求和响应,</span>

        <span class="token comment">// 想要看的更加详细就可以开启dump所有内容，</span>
        <span class="token comment">// 就能够看到我们是不是真的改变了请求内容</span>

        <span class="token function">EnableDumpAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  

    parms <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span>

        <span class="token string">"a"</span><span class="token punctuation">:</span> <span class="token string">"123"</span><span class="token punctuation">,</span>

        <span class="token string">"b"</span><span class="token punctuation">:</span> <span class="token string">"hello"</span><span class="token punctuation">,</span>

    <span class="token punctuation">}</span>

  

    resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">//拿到请求体</span>

                    <span class="token function">SetPathParam</span><span class="token punctuation">(</span><span class="token string">"usernamae"</span><span class="token punctuation">,</span> <span class="token string">"imroc"</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">//设置请求路径，用username作为占位符</span>

                    <span class="token function">SetPathParam</span><span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>        <span class="token comment">//再次设置，用xxx作为占位符</span>

                    <span class="token function">SetQueryParam</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"12"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>           <span class="token comment">//设置请求参数，a=12</span>

                    <span class="token function">SetQueryParams</span><span class="token punctuation">(</span>parms<span class="token punctuation">)</span><span class="token punctuation">.</span>              <span class="token comment">//用map来作为请求参数，用于多个参数的时候</span>

                    <span class="token function">SetHeader</span><span class="token punctuation">(</span><span class="token string">"mycookie"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>      <span class="token comment">//设置请求头</span>

                    <span class="token function">SetHeader</span><span class="token punctuation">(</span><span class="token string">"mysession"</span><span class="token punctuation">,</span> <span class="token string">"test2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>    <span class="token comment">//设置请求头</span>

                    <span class="token function">SetBody</span><span class="token punctuation">(</span><span class="token string">"body=world"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>              <span class="token comment">//设置请求体</span>

                    <span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"https://httpbin.org/uuid"</span><span class="token punctuation">)</span>

  

    <span class="token comment">//以上设置暂时在初期阶段够用了。</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"请求出错："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_209">
     </a>
     控制调试打印的内容
    </h4>
    <ul>
     <li>
      SetCommonDumpOptions：控制输出的内容
     </li>
     <li>
      EnableDumpAllToFile：dump到文件中
     </li>
    </ul>
    <p>
     输出的log2.txt文件内容如下
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/72fd554b7ca7dd615de9885236736772.png"/>
    </p>
    <pre><code class="prism language-go"><span class="token comment">// 控制调试打印的内容</span>

<span class="token comment">// 全局应用</span>

<span class="token keyword">func</span> <span class="token function">controlDevOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    opt <span class="token operator">:=</span> <span class="token operator">&amp;</span>req<span class="token punctuation">.</span>DumpOptions<span class="token punctuation">{<!-- --></span>
        Output<span class="token punctuation">:</span>         os<span class="token punctuation">.</span>Stdout<span class="token punctuation">,</span> <span class="token comment">//标准输出</span>
        RequestHeader<span class="token punctuation">:</span>  <span class="token boolean">false</span><span class="token punctuation">,</span>     <span class="token comment">//不输出请求头</span>
        RequestBody<span class="token punctuation">:</span>    <span class="token boolean">false</span><span class="token punctuation">,</span>     <span class="token comment">//不输出请求体</span>
        ResponseHeader<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      <span class="token comment">//输出响应头</span>
        ResponseBody<span class="token punctuation">:</span>   <span class="token boolean">true</span><span class="token punctuation">,</span>      <span class="token comment">//输出响应体</span>
        Async<span class="token punctuation">:</span>          <span class="token boolean">false</span><span class="token punctuation">,</span>     <span class="token comment">//不进行异步输出</span>

    <span class="token punctuation">}</span>
    client<span class="token punctuation">.</span><span class="token function">SetCommonDumpOptions</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token function">EnableDumpAllToFile</span><span class="token punctuation">(</span><span class="token string">"log2.txt"</span><span class="token punctuation">)</span>
    client<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"https://httpbin.org/uuid"</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="dump_245">
     </a>
     分开dump请求与响应部分
    </h4>
    <ul>
     <li>
      <code>
       var bufReq, bufResp bytes.Buffer
      </code>
      ：需要用变量来接收请求与响应不同部分
     </li>
     <li>
      SetDumpOptions：控制dump导出部分
     </li>
    </ul>
    <pre><code class="prism language-go"><span class="token comment">// 分别打印请求与响应部分</span>

<span class="token comment">// 在R中控制调试打印的内容，只作用与本次R请求，与上面的client直接全局设置的不同</span>

<span class="token keyword">func</span> <span class="token function">controlReqRespOutPut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> bufReq<span class="token punctuation">,</span> bufResp bytes<span class="token punctuation">.</span>Buffer

    client<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token comment">// 不开启的话就会导致无法转储出去单独打印请求体响应体</span>

        <span class="token function">EnableDump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">//EnableDump启用转储，包括请求和响应的所有内容。</span>

        <span class="token function">SetDumpOptions</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>req<span class="token punctuation">.</span>DumpOptions<span class="token punctuation">{<!-- --></span>

            RequestOutput<span class="token punctuation">:</span>  <span class="token operator">&amp;</span>bufReq<span class="token punctuation">,</span>  <span class="token comment">//将请求体输出到这里</span>

            ResponseOutput<span class="token punctuation">:</span> <span class="token operator">&amp;</span>bufResp<span class="token punctuation">,</span> <span class="token comment">//将响应体输出到这里</span>

            RequestHeader<span class="token punctuation">:</span>  <span class="token boolean">true</span><span class="token punctuation">,</span>

            RequestBody<span class="token punctuation">:</span>    <span class="token boolean">true</span><span class="token punctuation">,</span>

            ResponseHeader<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

            ResponseBody<span class="token punctuation">:</span>   <span class="token boolean">true</span><span class="token punctuation">,</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">SetBody</span><span class="token punctuation">(</span><span class="token string">"body=hello+world!"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"https://httpbin.org/uuid"</span><span class="token punctuation">)</span>

  

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"请求体"</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bufReq<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"响应体"</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bufResp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_300">
     </a>
     请求体设置
    </h4>
    <p>
     <strong>
      SetBody
     </strong>
     可以接受任意类型
    </p>
    <p>
     PS:
     <code>
      EnableDumpAllWithoutResponse
     </code>
     因为开启了调试模式，所以会打印很多东西，但是可以忽略响应打印出来结果，所以这函数就是忽略响应结果，只看请求。
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/59bb83e67e9f32b80bd2329f75b197f5.png"/>
    </p>
    <p>
     在编写一些poc/exp的时候可能需要在body部分，需要加入一些结构体或者map数据，他会根据你设置的content-type来判断解析成json还是xml格式，如果都不设置的话他会默认将这些类型解析为json数据body。
    </p>
    <p>
     <img alt="400" src="https://i-blog.csdnimg.cn/img_convert/bddd1d64971cdf071f2c404fa6b45d02.png"/>
    </p>
    <p>
     添加上content-type类型后就自动转了，比较方便(后面还有更方便的)
     <br/>
     <img alt="400" src="https://i-blog.csdnimg.cn/img_convert/23034d2c612854632221c1d33f74cbdb.png"/>
    </p>
    <ul>
     <li>
      <strong>
       SetBodyXXX
      </strong>
      <br/>
      不用设置content-type也能直接转想要的格式了
      <br/>
      <img alt="400" src="https://i-blog.csdnimg.cn/img_convert/3bd6bb612456167646c99669cf3dfa92.png"/>
     </li>
    </ul>
    <p>
     以下是代码：
    </p>
    <pre><code class="prism language-go"><span class="token comment">// 设置请求体中的一些骚姿势</span>

<span class="token keyword">func</span> <span class="token function">setbodyHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">type</span> test <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>

        Name <span class="token builtin">string</span>

        Age  <span class="token builtin">int</span>

    <span class="token punctuation">}</span>

    t <span class="token operator">:=</span> test<span class="token punctuation">{<!-- --></span>

        Name<span class="token punctuation">:</span> <span class="token string">"zhangsan"</span><span class="token punctuation">,</span>

        Age<span class="token punctuation">:</span>  <span class="token number">123</span><span class="token punctuation">,</span>

    <span class="token punctuation">}</span>

    client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">DevMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">EnableDumpAllWithoutResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    client<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">SetBody</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">SetContentType</span><span class="token punctuation">(</span><span class="token string">"application/xml"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"https://httpbin.org/uuid"</span><span class="token punctuation">)</span>

  

    client2 <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">DevMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">EnableDumpAllWithoutResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    client2<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">SetBodyXmlMarshal</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"https://httpbin.org/uuid"</span><span class="token punctuation">)</span>

  

<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_368">
     </a>
     作用范围级别
    </h3>
    <p>
     在设置请求参数的时候，有分两种作用范围设置，一种全局(客户端级别)，另一种就是只作用与这一个client的对象(请求级别)。
    </p>
    <p>
     以下就尽量快速过为妙，上面学的时候已经有很多函数都用过了，没必要花太多时间，知道即可，下面作为一个知识字典，以后方便查阅。
    </p>
    <hr/>
    <p>
     <strong>
      <code>
       请记住：
      </code>
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       <code>
        用req.C().R()来设置的请求级别
       </code>
      </strong>
     </li>
     <li>
      <strong>
       <code>
        用req.C()来设置的是全局级别(也即客户端级别client)
       </code>
      </strong>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_383">
     </a>
     设置参数查询
    </h4>
    <p>
     <strong>
      请求级别：
     </strong>
    </p>
    <ul>
     <li>
      SetQueryParam：
      <code>
       SetQueryParam("test", "123")
      </code>
      即 httpxxx?test=123
      <br/>
      设置多个的时候仅仅对最后一个设置的生效
     </li>
     <li>
      SetQueryParams：SetQueryParams接收map类型设置多个变量，由于map的键唯一，所以多个同名的话也只会作用一个。
     </li>
     <li>
      SetQueryString：直接给查询参数即可，
      <code>
       SetQueryString("test1=123&amp;test2=456")
      </code>
      <br/>
      这个不会产生什么重复覆盖问题，字符串给啥他就拼接到你url中去
     </li>
     <li>
      AddQueryParam：
      <code>
       AddQueryParam("key", "value1")
      </code>
      如果该参数已存在，它不会覆盖原有的值，这个一般用在你临时需要添加什么查询参数的时候可以用，而且不会覆盖原有的同名键值
     </li>
    </ul>
    <hr/>
    <p>
     <strong>
      全局级别：
     </strong>
    </p>
    <ul>
     <li>
      SetCommonQueryParam
     </li>
     <li>
      SetCommonQueryParams
     </li>
     <li>
      SetCommonQueryString
     </li>
     <li>
      AddCommonQueryParam
     </li>
    </ul>
    <h4>
     <a id="URL__402">
     </a>
     URL 路径参数
    </h4>
    <p>
     <strong>
      请求级别：
     </strong>
    </p>
    <ul>
     <li>
      SetPathParam：
      <code>
       SetPathParam("username", "zhangsan")
      </code>
     </li>
     <li>
      SetPathParams：接收map类型
     </li>
    </ul>
    <hr/>
    <p>
     <strong>
      全局级别：
     </strong>
    </p>
    <ul>
     <li>
      SetCommonPathParam
     </li>
     <li>
      SetCommonPathParams
     </li>
    </ul>
    <h4>
     <a id="_414">
     </a>
     表单请求设置
    </h4>
    <p>
     <strong>
      请求级别：
     </strong>
    </p>
    <ul>
     <li>
      SetFormData：接收map类型，但是同一个键只能有一个
     </li>
     <li>
      SetFormDataFromValues:：
      <br/>
      代码如下所示，但是注意的是url.Values是net/url包，所以要注意这个url不是我定义的，拿来就用即可。
     </li>
    </ul>
    <pre><code class="prism language-go">client3 <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">DevMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">EnableDumpAllWithoutResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

v <span class="token operator">:=</span> url<span class="token punctuation">.</span>Values<span class="token punctuation">{<!-- --></span>
	<span class="token string">"p"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"world"</span><span class="token punctuation">,</span> <span class="token string">"!"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
client3<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
	<span class="token function">SetFormDataFromValues</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">.</span>
	<span class="token function">Post</span><span class="token punctuation">(</span><span class="token string">"https://httpbin.org/post"</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/14d4f4a9a5cdd9c7cb080c1724454a04.png"/>
    </p>
    <ul>
     <li>
      multipart ⽅式提交表单：
      <code>
       EnableForceMultipart
      </code>
     </li>
    </ul>
    <pre><code class="prism language-go">client3 <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">DevMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">EnableDumpAllWithoutResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
v <span class="token operator">:=</span> url<span class="token punctuation">.</span>Values<span class="token punctuation">{<!-- --></span>
	<span class="token string">"p"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"world"</span><span class="token punctuation">,</span> <span class="token string">"!"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
client3<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
	<span class="token function">EnableForceMultipart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
	<span class="token function">SetFormDataFromValues</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">.</span>
	<span class="token function">Post</span><span class="token punctuation">(</span><span class="token string">"https://httpbin.org/post"</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/febda26babe5f94951be5e40de53d6a3.png"/>
    </p>
    <hr/>
    <p>
     <strong>
      全局级别：
     </strong>
    </p>
    <ul>
     <li>
      SetCommonFormData
     </li>
     <li>
      SetCommonFormDataFromValues
     </li>
    </ul>
    <h4>
     <a id="_454">
     </a>
     请求头设置
    </h4>
    <p>
     请求级别：
    </p>
    <ul>
     <li>
      SetHeader：自动将你传进的header键的首字母大写
     </li>
     <li>
      SetHeaders：接收map类型，自动将你传进的header键的首字母大写
     </li>
     <li>
      SetHeaderNonCanonical：你给什么样就输出什么样，不会自动给你首字母大写
     </li>
     <li>
      SetHeadersNonCanonical：你给什么样就输出什么样，不会自动给你首字母大写
     </li>
     <li>
      SetHeaderOrder：控制header的顺序，因为有的服务端可能会对header的顺序判断是否允许请求，设置了SetHeaderOrder，他就会按照你给定的顺序进行排序请求过去。
     </li>
    </ul>
    <pre><code class="prism language-go">request<span class="token punctuation">.</span><span class="token function">SetHeaderOrder</span><span class="token punctuation">(</span> 
	<span class="token string">"cookie"</span><span class="token punctuation">,</span> 
	<span class="token string">"ssession"</span><span class="token punctuation">,</span> 
	<span class="token string">"test"</span><span class="token punctuation">,</span>
	<span class="token string">"ua"</span><span class="token punctuation">,</span> 
<span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <p>
     全局级别
    </p>
    <ul>
     <li>
      SetCommonHeaderNonCanonical
     </li>
     <li>
      SetCommonHeadersNonCanonical
     </li>
    </ul>
    <h3>
     <a id="_480">
     </a>
     判断响应状态码
    </h3>
    <p>
     没啥好说的，都到这了这些应该对于各位师傅来说都是一眼就学会的基操了。
    </p>
    <ul>
     <li>
      resp.IsSuccessState
     </li>
     <li>
      resp.IsErrorState
     </li>
     <li>
      resp.StatusCode
     </li>
    </ul>
    <pre><code class="prism language-go"><span class="token comment">// 判断响应状态码</span>

<span class="token keyword">func</span> <span class="token function">judgeStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"http://www.baidu.com"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"请求失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> resp<span class="token punctuation">.</span><span class="token function">IsSuccessState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> resp<span class="token punctuation">.</span><span class="token function">IsErrorState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

  

    <span class="token comment">//可以通过响应对应的代码判断</span>

    <span class="token keyword">if</span> resp<span class="token punctuation">.</span>StatusCode <span class="token operator">!=</span> http<span class="token punctuation">.</span>StatusOK <span class="token punctuation">{<!-- --></span> <span class="token comment">//http有一个const变量，里面有很多对应的响应码，自行查看即可(文件：http\status.go)</span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

  

    <span class="token comment">//打印响应体</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//bytes打印</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//string打印</span>

<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_537">
     </a>
     解析数据
    </h3>
    <h4>
     <a id="SetSuccessResult_539">
     </a>
     SetSuccessResult
    </h4>
    <ul>
     <li>
      <p>
       SetSuccessResult：SetSuccessResult会⾃动解析你给的结构体或map
      </p>
     </li>
     <li>
      <p>
       SetErrorResult
       <br/>
       这里一同把SetErrorResult也讲了，可以自定义错误解析到你自己定义的错误中去，没啥好说感觉也时，定义好了就直接给到SetErrorResult即可(详细见代码处)
      </p>
     </li>
    </ul>
    <p>
     运行结果如下图所示：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/adfd96b4b784518e1d4ab69ec37dc168.png"/>
    </p>
    <pre><code class="prism language-go">  

<span class="token comment">// 接收响应回来的json数据</span>

<span class="token keyword">type</span> user <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>

    Login <span class="token builtin">string</span> <span class="token string">`json:login`</span>

    Id    <span class="token builtin">int</span>    <span class="token string">`json:id`</span>

    Name  <span class="token builtin">string</span> <span class="token string">`json:name`</span>

<span class="token punctuation">}</span>

  

<span class="token comment">// 接收错误响应</span>

<span class="token keyword">type</span> errorResp <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>

    Mess <span class="token builtin">string</span> <span class="token string">`json:message`</span>

<span class="token punctuation">}</span>

  

<span class="token comment">// 解析响应的json数据</span>

<span class="token comment">// SetSuccessResult⾃动解析结构体或map</span>

<span class="token keyword">func</span> <span class="token function">getHttpJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> respUser user

    <span class="token keyword">var</span> respError errorResp

    res<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">SetSuccessResult</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>respUser<span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">//接收响应回来的json数据，同时也可以解析map</span>

        <span class="token function">SetErrorResult</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>respError<span class="token punctuation">)</span><span class="token punctuation">.</span>  <span class="token comment">//若请求错误将错误信息存储到该结构体中</span>

        <span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"https://api.github.com/users/whoisdhan"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"代码请求出错："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

        <span class="token keyword">return</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> res<span class="token punctuation">.</span><span class="token function">IsSuccessState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"请求成功"</span><span class="token punctuation">)</span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>respUser<span class="token punctuation">.</span>Login<span class="token punctuation">)</span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>respUser<span class="token punctuation">.</span>Id<span class="token punctuation">)</span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>respUser<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> res<span class="token punctuation">.</span><span class="token function">IsErrorState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"网络请求出错："</span><span class="token punctuation">,</span> respError<span class="token punctuation">.</span>Mess<span class="token punctuation">)</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"未知错误："</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>StatusCode<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

  

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="gjson_629">
     </a>
     gjson
    </h4>
    <ul>
     <li>
      <code>
       字段名
      </code>
      、
      <code>
       .
      </code>
      ：表示读取该字段，
      <code>
       字段名.0
      </code>
      表示读取该键名下的数据的第一个字段，
      <code>
       字段名.1
      </code>
      读取第二个
     </li>
     <li>
      <code>
       *
      </code>
      、
      <code>
       ?
      </code>
      ：gjson支持通配符：像在linux命令行中使用的通配符那样用就行，
      <code>
       a*a
      </code>
      收尾为a的都匹配
     </li>
     <li>
      <code>
       #
      </code>
      ：表示该字段所有元素。
      <ul>
       <li>
        在结尾：
        <code>
         字段名1.字段名2.#
        </code>
        表示返回字段名2的数组长度
       </li>
       <li>
        在中间，即
        <code>
         #
        </code>
        后面还有内容：
        <code>
         字段名1.#.字段名2
        </code>
        表示返回字段名2所有元素
       </li>
       <li>
        原因：这也是为啥我叫他
        <code>
         #
        </code>
        的意思是表示该字段所有元素，在结尾就是返回长度，不在就是返回整个数组列表
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <p>
     <strong>
      <code>
       gjson解析json数据可提取指定字段，不用定义结构体
      </code>
     </strong>
    </p>
    <p>
     gjson非常适合提取几个字段出来之类的，方便的一笔。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e895092c3641a34c1ec2b86c811b38f0.png"/>
    </p>
    <pre><code class="prism language-go"><span class="token comment">// 由于我们的http请求回来的数据能方便的转为string所以也能用gjson</span>

<span class="token comment">// 模拟数据</span>

<span class="token keyword">const</span> httpjson <span class="token operator">=</span> <span class="token string">`

{

  "name":{"first":"Tom", "last": "Anderson"},

  "age": 37,

  "children": ["Sara", "Alex", "Jack"],

  "fav.movie": "Dear Hunter",

  "friends": [

    {"first": "Dale", "last":"Murphy", "age": 44, "nets": ["ig", "fb", "tw"]},

    {"first": "Roger", "last": "Craig", "age": 68, "nets": ["fb", "tw"]},

    {"first": "Jane", "last": "Murphy", "age": 47, "nets": ["ig", "tw"]}

  ]

}`</span>

  

<span class="token keyword">func</span> <span class="token function">gjsonHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//先简单用正常的httpjson数据尝试一下</span>

    client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    resp<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"https://api.github.com/users/whoisdhan"</span><span class="token punctuation">)</span>

  

    login <span class="token operator">:=</span> gjson<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"login"</span><span class="token punctuation">)</span>

    id <span class="token operator">:=</span> gjson<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">)</span>

    name <span class="token operator">:=</span> gjson<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>login<span class="token punctuation">,</span> id<span class="token punctuation">,</span> name<span class="token punctuation">)</span>

  

    <span class="token comment">//用httpjson测试数据</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>gjson<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>httpjson<span class="token punctuation">,</span> <span class="token string">"name.first"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>gjson<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>httpjson<span class="token punctuation">,</span> <span class="token string">"friends.#.first"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>gjson<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>httpjson<span class="token punctuation">,</span> <span class="token string">"friends.#.nets"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>gjson<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>httpjson<span class="token punctuation">,</span> <span class="token string">"fav\\.movie"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//字段存在符号的话用\\转义</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_713">
     </a>
     响应数据解析练习
    </h4>
    <p>
     这里的解析可能有点主观了，可以按照自己的想法，尽量不要被我带偏，我的不一定是最佳的
    </p>
    <pre><code class="prism language-shell">// 练习
// <span class="token number">1</span>. 获取⽤户信息 https://api.github.com/users/<span class="token punctuation">{<!-- --></span>username<span class="token punctuation">}</span>
// <span class="token number">2</span>. 获取仓库列表信息 https://api.github.com/users/<span class="token punctuation">{<!-- --></span>username<span class="token punctuation">}</span>/repos
// <span class="token number">3</span>. 用户与仓库列表信息：普通读取json、Unmarshal转结构体⽅式解析、gjson读取
// <span class="token number">4</span>. 用户与仓库列表信息：格式化输出到控制台
// <span class="token number">5</span>. 仓库列表信息保存到本地 JSON ⽂件中。
//这里就固定拿仓库列表信息如下信息：
// <span class="token punctuation">(</span>也可以随便获取你想要的字段<span class="token punctuation">)</span>
//  用户信息<span class="token punctuation">{<!-- --></span>login、id、url、name、email<span class="token punctuation">}</span>
//  仓库列表信息<span class="token punctuation">{<!-- --></span>name、owner.login、description<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      myMarshalIndent：为了方便格式化，我自己写了一个格式化函数方便不同方式保存的时候进行格式化
      <br/>
      格式化都需要先转到map中存储才能够格式化正常的json数据出来，格式化好了就任意你想干啥就干啥了
     </li>
     <li>
      需要注意的细节：
      <br/>
      有的json他是列表包裹着
      <code>
       []
      </code>
      ，所以转的时候要注意判断用
      <code>
       map[string]interface{}
      </code>
      还是
      <code>
       []map[string]interface{}
      </code>
     </li>
     <li>
      json.MarshalIndent：他可以对map列表进行格式化的，因为那样也时一个正常的json数据，只不过你需要用
      <code>
       []map[string]interface{}
      </code>
      列表类型进行存储(这里是一个很重要的细节，开发过程中如果不注意很容易导致崩溃)
     </li>
    </ul>
    <hr/>
    <p>
     我用了三个函数完成这个练习：
    </p>
    <ul>
     <li>
      normalGetJson：普通读取，就是解析出来后整个data就直接write到文件中
     </li>
     <li>
      UnmarshalToStruct：Unmarshal转结构体⽅式解析，这里使用了上面学到的
      <code>
       SetSuccessResult
      </code>
      ，给到结构体后进行解析，这样也很方便
     </li>
     <li>
      gjsonOutput：这里就是使用gjson了，gjson很方便，但是面对比较多字段提取的时候还是比较繁琐。
      <br/>
      <strong>
       这里复习了一个细节：map想要后续不断地赋值的话就需要进行make空间出来才行，如果是[]map的话需要给定一个空间范围，0也行，你要说明这是一个切片。如果你只是单单定义一个map变量或者map切片变量，后续是无法使用的。
      </strong>
      <br/>
      还有一个细节就是：make出来的空间是固定的，如果你要make出来的空间作为一个临时变量赋值给其他变量的时候要注意了，用了一个空间就不要继续用了，因为你将一个空间给了多个变量的话，那么那些变量都指向你这一个空间，那么他们的值其实都一样。
     </li>
    </ul>
    <p>
     运行结果：这里就放几个保存出来的文件截图
    </p>
    <ul>
     <li>
      <p>
       normalGetJson：
       <br/>
       <img alt="" src="https://i-blog.csdnimg.cn/img_convert/5091132f31f0009f0c531adcb5d3a3a5.png"/>
      </p>
     </li>
     <li>
      <p>
       UnmarshalToStruct
       <br/>
       <img alt="" src="https://i-blog.csdnimg.cn/img_convert/37af8d78ace69021cf235767fcadc8b9.png"/>
      </p>
     </li>
     <li>
      <p>
       gjsonOutput
       <br/>
       <img alt="" src="https://i-blog.csdnimg.cn/img_convert/37af8d78ace69021cf235767fcadc8b9.png"/>
      </p>
     </li>
    </ul>
    <p>
     示例代码：
    </p>
    <pre><code class="prism language-go"><span class="token comment">// 用户信息{login、id、url、name、email}</span>

<span class="token comment">// 仓库列表信息{name、owner.login、description}</span>

<span class="token keyword">func</span> <span class="token function">gjsonOutput</span><span class="token punctuation">(</span>username <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//gjson就十分简单了，只需要拿到响应json数据即可取出来看</span>

    mapUserData <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//用户信息存储</span>

    <span class="token comment">//仓库信息存储，</span>

    <span class="token comment">// 由于仓库是数组列表所以要给一个初始长度</span>

    <span class="token comment">// 因为可能仓库为空的，所以就初始化为0即可</span>

    mapReposData <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"-------------------用户信息-------------------"</span><span class="token punctuation">)</span>

    client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">SetPathParam</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"https://api.github.com/users/{username}"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"代码请求失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//gjson想要写入文件就只能转储到struct或者map中</span>

    mapUserData<span class="token punctuation">[</span><span class="token string">"login"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gjson<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"login"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    mapUserData<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gjson<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    mapUserData<span class="token punctuation">[</span><span class="token string">"url"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gjson<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    mapUserData<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gjson<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    mapUserData<span class="token punctuation">[</span><span class="token string">"email"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gjson<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"email"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    data<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">MarshalIndent</span><span class="token punctuation">(</span>mapUserData<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"\t"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"格式化失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// test := gjson.Get(resp.String(), "login")</span>

    <span class="token comment">// fmt.Println(test)</span>

  

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"---------------------------------------------"</span><span class="token punctuation">)</span>

  

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"-------------------仓库信息-------------------"</span><span class="token punctuation">)</span>

    client <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    resp<span class="token punctuation">,</span> err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">SetPathParam</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"https://api.github.com/users/{username}/repos"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"代码请求失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token comment">// 仓库列表信息{name、owner.login、description}</span>

    arr <span class="token operator">:=</span> gjson<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"#.name"</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token operator">:=</span> <span class="token keyword">range</span> arr<span class="token punctuation">.</span><span class="token function">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">//一定要放到这里来，因为make指向同一个空间，</span>

        <span class="token comment">// 如果你在for外面定义mapTmpRepos造成取到的值会全部变成最后一个值，</span>

        <span class="token comment">// 因为同一个空间他会同步改变你map切片append里面所有的内容，</span>

        <span class="token comment">// 因为同一个空间嘛</span>

        mapTmpRepos <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>

        mapTmpRepos<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token operator">=</span> j<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        mapTmpRepos<span class="token punctuation">[</span><span class="token string">"login"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gjson<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".owner.login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        mapTmpRepos<span class="token punctuation">[</span><span class="token string">"description"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gjson<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".description"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        mapReposData <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>mapReposData<span class="token punctuation">,</span> mapTmpRepos<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    data<span class="token punctuation">,</span> err <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">MarshalIndent</span><span class="token punctuation">(</span>mapReposData<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"\t"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"格式化失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//格式化的内容打印到终端</span>

  

    file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span><span class="token string">"gjson.json"</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_RDWR<span class="token operator">|</span>os<span class="token punctuation">.</span>O_RDWR<span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"打开文件失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"导出json失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="Cookie_904">
     </a>
     Cookie
    </h3>
    <p>
     请求级别：
    </p>
    <ul>
     <li>
      SetCookies
     </li>
    </ul>
    <pre><code class="prism language-go"><span class="token function">SetCookies</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Cookie<span class="token punctuation">{<!-- --></span>
	Name<span class="token punctuation">:</span>  <span class="token string">"hacker"</span><span class="token punctuation">,</span>
	Value<span class="token punctuation">:</span> <span class="token string">"aaa"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     全局级别：
    </p>
    <ul>
     <li>
      SetCommonCookies
     </li>
    </ul>
    <pre><code class="prism language-go"><span class="token function">SetCommonCookies</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Cookie<span class="token punctuation">{<!-- --></span>
	Name<span class="token punctuation">:</span>  <span class="token string">"Global"</span><span class="token punctuation">,</span>
	Value<span class="token punctuation">:</span> <span class="token string">"dddd"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_923">
     </a>
     默认行为
    </h4>
    <p>
     <strong>
      就是当你请求的服务端响应了set-cookie回来后，当你再次请求的时候就会携带上这个set-cookie回来的cookie键值去请求。
     </strong>
    </p>
    <h4>
     <a id="Cookie_927">
     </a>
     禁⽤Cookie
    </h4>
    <ul>
     <li>
      SetCookieJar(nil)
     </li>
    </ul>
    <h4>
     <a id="Cookie_931">
     </a>
     存储Cookie
    </h4>
    <p>
     安装
    </p>
    <pre><code class="prism language-go"><span class="token keyword">go</span> get <span class="token operator">-</span>u github<span class="token punctuation">.</span>com<span class="token operator">/</span>juju<span class="token operator">/</span>persistent<span class="token operator">-</span>cookiejar
</code></pre>
    <p>
     使用
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">saveCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    jar<span class="token punctuation">,</span> err <span class="token operator">:=</span> cookiejar<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cookiejar<span class="token punctuation">.</span>Options<span class="token punctuation">{<!-- --></span>
        Filename<span class="token punctuation">:</span> <span class="token string">"cookies.json"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"保存失败"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">defer</span> jar<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetCookieJar</span><span class="token punctuation">(</span>jar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">DevMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    client<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"http://www.baidu.com"</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_957">
     </a>
     证书校验
    </h3>
    <h4>
     <a id="_958">
     </a>
     无视风险
    </h4>
    <p>
     针对一些不安全的网站请求可能会请求失败，所以需要忽略证书的校验
    </p>
    <p>
     两种方式可以忽略：
    </p>
    <pre><code class="prism language-go">client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">DevMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">EnableDumpAllWithoutResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//忽略证书风险</span>
<span class="token comment">//第一种</span>
<span class="token comment">//client.SetTLSClientConfig(&amp;tls.Config{InsecureSkipVerify: true})</span>
<span class="token comment">//第二种</span>
client<span class="token punctuation">.</span>TLSClientConfig<span class="token punctuation">.</span>InsecureSkipVerify <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
	<span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"https://self-signed.badssl.com/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"代码请求失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_977">
     </a>
     配置证书
    </h4>
    <p>
     配置好风险站点的证书即可访问风险站点
     <br/>
     证书需要访问网站的时候在浏览器的小锁中下载即可（具体不演示了，自行百度网站证书如何下载）
    </p>
    <ul>
     <li>
      证书文件配置
     </li>
    </ul>
    <pre><code class="prism language-go">client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">DevMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">EnableDumpAllWithoutResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//可以同时配置多个网站的证书</span>
client<span class="token punctuation">.</span><span class="token function">SetRootCertsFromFile</span><span class="token punctuation">(</span><span class="token string">"cert1.crt"</span><span class="token punctuation">,</span><span class="token string">"cert2.crt"</span><span class="token punctuation">,</span><span class="token string">"cert3.crt"</span><span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      证书内容配置
      <br/>
      在下载了证书之后，可以编辑证书将里面的内容配置进来也行
     </li>
    </ul>
    <pre><code class="prism language-go">client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">DevMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">EnableDumpAllWithoutResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span><span class="token function">SetRootCertFromString</span><span class="token punctuation">(</span><span class="token string">"-----BEGIN CERTIFICATE-----"</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="Auth_995">
     </a>
     Auth身份认证
    </h3>
    <ul>
     <li>
      SetBasicAuth
     </li>
     <li>
      SetDigestAuth
      <br/>
      区别：
      <br/>
      一个Basic认证，一个Digest认证
      <br/>
      Digest认证比较安全，请求被拦截了攻击者无法直接获取密码
      <br/>
      但是Basic的请求被拦截了就是直接获取到密码
      <br/>
      服务端支持哪一个？
      <br/>
      检查
      <code>
       WWW-Authenticate
      </code>
      响应头，返回Basic 还是 Digest就知道支持哪一个。
     </li>
    </ul>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">authHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">DevMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">EnableDumpAllWithoutResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    client<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token function">SetBasicAuth</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"https://httpbin.org/uuid"</span><span class="token punctuation">)</span>
        
    client2 <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">DevMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">EnableDumpAllWithoutResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    client2<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token function">SetDigestAuth</span><span class="token punctuation">(</span><span class="token string">"username2"</span><span class="token punctuation">,</span> <span class="token string">"password2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"https://httpbin.org/uuid"</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_1023">
     </a>
     文件上传下载
    </h3>
    <h4>
     <a id="_1025">
     </a>
     上传文件
    </h4>
    <ul>
     <li>
      SetFile
     </li>
     <li>
      SetFiles：接收map类型，上传多个文件
     </li>
     <li>
      SetUploadCallback：显示上传进度
     </li>
    </ul>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">uploadFileHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//简单上传</span>
    client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">DevMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">EnableDumpAllWithoutResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    callback <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>info req<span class="token punctuation">.</span>UploadInfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//显示上传进度</span>

        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"\n文件名：%q\n已上传：%.2f%%\n"</span><span class="token punctuation">,</span>
            info<span class="token punctuation">.</span>FileName<span class="token punctuation">,</span>
            <span class="token function">float64</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>UploadedSize<span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">float64</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>FileSize<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100.0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    client<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token comment">//SetFile("filename", "cookies.json").</span>
        <span class="token function">SetFiles</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span>

            <span class="token string">"test"</span><span class="token punctuation">:</span>  <span class="token string">"test.txt"</span><span class="token punctuation">,</span>

            <span class="token string">"test2"</span><span class="token punctuation">:</span> <span class="token string">"test2.txt"</span><span class="token punctuation">,</span>

            <span class="token string">"test3"</span><span class="token punctuation">:</span> <span class="token string">"test3.txt"</span><span class="token punctuation">,</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token function">SetUploadCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">//使用该函数：显示上传进度</span>
        <span class="token function">Post</span><span class="token punctuation">(</span><span class="token string">"https://httpbin.org/post"</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_1062">
     </a>
     下载文件
    </h4>
    <ul>
     <li>
      SetOutputFile：这里是指定下载的文件路径
     </li>
     <li>
      SetOutputDirectory：设置下载的默认路径，即SetOutputFile可以只给文件名，自动存在该路径下
     </li>
     <li>
      SetDownloadCallback：显示下载进度
     </li>
    </ul>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">downloadFileHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//.DevMode().EnableDumpAllWithoutResponse()</span>

    callback <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>info req<span class="token punctuation">.</span>DownloadInfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">if</span> info<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>Response <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//响应不为空</span>

            fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"\n已下载：%.2f%%\n"</span><span class="token punctuation">,</span>

                <span class="token function">float64</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>DownloadedSize<span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">float64</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>ContentLength<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100.0</span><span class="token punctuation">)</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>  

    client<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token comment">//这里是指定文件路径</span>

        <span class="token function">SetOutputFile</span><span class="token punctuation">(</span><span class="token string">"./baidu.html"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"http://127.0.0.1/xxx.txt"</span><span class="token punctuation">)</span>

    client2 <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token comment">//这里可以设置默认下载目录，后面直接download的时候就不用指定路径了，给文件名即可</span>

        <span class="token function">SetOutputDirectory</span><span class="token punctuation">(</span><span class="token string">"./"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">DevMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">EnableDumpAllWithoutResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    client2<span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">SetOutputFile</span><span class="token punctuation">(</span><span class="token string">"baidu2.html"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">SetDownloadCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"http://127.0.0.1/xxx.txt"</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_1113">
     </a>
     多线程下载练习
    </h4>
    <ul>
     <li>
      NewParallelDownload：创建一个多线程下载客户端
     </li>
     <li>
      其他函数在注释中标明了。
     </li>
    </ul>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">threatDownload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    client <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">NewParallelDownload</span><span class="token punctuation">(</span><span class="token string">"http://xxxxx.xxxx.xxx/xxx.iso"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

        <span class="token function">SetConcurrency</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>               <span class="token comment">//设置 5 个线程 并行下载</span>

        <span class="token function">SetFileMode</span><span class="token punctuation">(</span><span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">.</span>               <span class="token comment">//设置 文件权限（可读可写可执行）。</span>

        <span class="token function">SetOutputFile</span><span class="token punctuation">(</span><span class="token string">"xxx.iso"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>        <span class="token comment">//设定最终 存储文件名</span>

        <span class="token function">SetSegmentSize</span><span class="token punctuation">(</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">//每个线程下载 5MB 的数据块</span>

        <span class="token function">SetTempRootDir</span><span class="token punctuation">(</span><span class="token string">"./tmp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>         <span class="token comment">//这个是下载的时候指定的临时存储目录</span>

        <span class="token function">Do</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"下载失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

        <span class="token keyword">return</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f36303532313033362f:61727469636c652f64657461696c732f313436323033303234" class_="artid" style="display:none">
 </p>
</div>


