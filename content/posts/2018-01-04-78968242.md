---
layout: post
title: "详细剖析I2C和SPI通信协议的区别"
date: 2018-01-04 10:32:13 +0800
description: "原文链接：http://m.elecfans.com/article/610220.html1. 概"
keywords: "spi和i2c的区别"
categories: ['杂谈']
tags: ['通信']
artid: "78968242"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=78968242
    alt: "详细剖析I2C和SPI通信协议的区别"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=78968242
featuredImagePreview: https://bing.ee123.net/img/rand?artid=78968242
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     详细剖析I2C和SPI通信协议的区别
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="1_I2CSPI_0">
     </a>
     1. 概述I2C与SPI协议
    </h3>
    <ul>
     <li>
      IIC vs SPI现今，在低端数字通信应用领域，我们随处可见**IIC (Inter-Integrated Circuit) **和 **SPI (Serial Peripheral Interface)**的身影。原因是这两种通信协议非常适合近距离低速芯片间通信。Philips（for IIC）和Motorola（for SPI） 出于不同背景和市场需求制定了这两种标准通信协议。
     </li>
     <li>
      IIC 开发于1982年，当时是为了给电视机内的CPU和外围芯片提供更简易的互联方式。电视机是最早的嵌入式系统之一，而最初的嵌入系统是使用内存映射（memory-mapped I/O）的方式来互联微控制器和外围设备的。要实现内存映射，设备必须并联入微控制器的数据线和地址线，这种方式在连接多个外设时需大量线路和额外地址解码芯片，很不方便并且成本高。为了节省微控制器的引脚和和额外的逻辑芯片，使印刷电路板更简单，成本更低，位于荷兰的Philips实验室开发了 ‘Inter-Integrated Circuit’, I2C 或 IIC ，一种只使用二根线接连所有外围芯片的总线协议。最初的标准定义总线速度为100kbps。经历几次修订，主要是1995年的400kbps，1998的3.4Mbps。
     </li>
    </ul>
    <ul>
     <li>
      有迹象表明，SPI总线首次推出是在1979年，Motorola公司将SPI总线集成在他们第一支改自68000微处理器的微控制器芯片上。SPI总线是微控制器四线的外部总线（相对于内部总线）。与IIC不同，SPI没有明文标准，只是一种事实标准，对通信操作的实现只作一般的抽象描述，芯片厂商与驱动开发者通过data sheets和application notes沟通实现上的细节。
     </li>
    </ul>
    <h3>
     <a id="2_SPI_4">
     </a>
     2. SPI协议
    </h3>
    <p>
     <strong>
      2.1 SPI是种四根信号线协议（如图）：
     </strong>
     <br/>
     <img alt="SPI连接示意图" src="https://i-blog.csdnimg.cn/blog_migrate/32e85d5a01b5733cf15bac0d54b22f7e.jpeg">
      <br/>
      SCLK: Serial Clock (output from master);
     </img>
    </p>
    <p>
     MOSI; SIMO: Master Output, Slave Input(output from master);
    </p>
    <p>
     MISO; SOMI: Master Input, Slave Output(output from slave);
    </p>
    <p>
     SS: Slave Select (active low, outputfrom master).
    </p>
    <p>
     <strong>
      2.2 SPI是［单主设备（ single-master ）］通信协议
     </strong>
    </p>
    <p>
     这意味着总线中的只有一支中心设备能发起通信。当SPI主设备想读/写［从设备］时，它首先拉低［从设备］对应的SS线（SS是低电平有效），接着开始发送工作脉冲到时钟线上，在相应的脉冲时间上，［主设备］把信号发到MOSI实现“写”，同时可对MISO采样而实现“读”，如下图：
     <br/>
     <img alt="SPI读写时序" src="https://i-blog.csdnimg.cn/blog_migrate/80a85ed15e6318b244fb2f6523e08135.jpeg">
      <br/>
      <strong>
       2.3 SPI有四种操作模式
      </strong>
     </img>
    </p>
    <p>
     模式0、模式1、模式2和模式3，它们的区别是定义了在时钟脉冲的哪条边沿转换（toggles）输出信号，哪条边沿采样输入信号，还有时钟脉冲的稳定电平值（就是时钟信号无效时是高还是低）。每种模式由一对参数刻画，它们称为时钟极（clock polarity）CPOL与时钟期（clock phase）CPHA。
     <br/>
     <img alt="SPI四种操作模式" src="https://i-blog.csdnimg.cn/blog_migrate/c170f7ad39fb240ffb1663e9fae8ed0a.jpeg">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f3d49e1fd314bc32d2ea288686e9a968.png">
       <br/>
       ［主从设备］必须使用相同的工作参数——SCLK、CPOL 和 CPHA，才能正常工作。如果有多个［从设备］，并且它们使用了不同的工作参数，那么［主设备］必须在读写不同［从设备］间重新配置这些参数。
      </img>
     </img>
    </p>
    <p>
     <strong>
      2.4 SPI总线总结
     </strong>
    </p>
    <p>
     以上SPI总线协议的主要内容。
     <strong>
      SPI不规定最大传输速率，没有地址方案；SPI也没规定通信应答机制，没有规定流控制规则
     </strong>
     。事实上，SPI［主设备］甚至并不知道指定的［从设备］是否存在。这些通信控制都得通过SPI协议以外自行实现。例如，要用SPI连接一支［命令-响应控制型］解码芯片，则必须在SPI的基础上实现更高级的通信协议。SPI并不关心物理接口的电气特性，例如信号的标准电压。在最初，大多数SPI应用都是使用间断性时钟脉冲和以字节为单位传输数据的，但现在有很多变种实现了连续性时间脉冲和任意长度的数据帧。
    </p>
    <h3>
     <a id="3_IIC_30">
     </a>
     3. IIC协议
    </h3>
    <p>
     <strong>
      3.1 IIC协议基本规定：
     </strong>
    </p>
    <p>
     IIC与SPI的单主设备不同，IIC 是多主设备的总线，IIC没有物理的芯片选择信号线，没有仲裁逻辑电路，只使用两条信号线—— ‘serial data’ (SDA) 和 ‘serial clock’ (SCL)。
     <br/>
     第一，每一支IIC设备都有一个唯一的七位设备地址；
    </p>
    <p>
     第二，数据帧大小为8位的字节；
    </p>
    <p>
     第三，数据（帧）中的某些数据位用于控制通信的开始、停止、方向（读写）和应答机制。
    </p>
    <p>
     IIC 数据传输速率有标准模式（100 kbps）、快速模式（400 kbps）和高速模式（3.4 Mbps），另外一些变种实现了低速模式（10 kbps）和快速+模式（1 Mbps）。物理实现上，IIC 总线由两根信号线和一根地线组成。两根信号线都是双向传输的，参考下图。IIC协议标准规定发起通信的设备称为主设备，主设备发起一次通信后，其它设备均为从设备。
     <br/>
     <img alt="IIC连接" src="https://i-blog.csdnimg.cn/blog_migrate/983ad355ca4e3326a54618a10866826d.jpeg"/>
    </p>
    <p>
     <strong>
      3.2 IIC 通信过程大概如下
     </strong>
    </p>
    <p>
     首先，主设备发一个START信号，这个信号就像对所有其它设备喊：请大家注意！然后其它设备开始监听总线以准备接收数据。接着，主设备发送一个7位设备地址加一位的读写操作的数据帧。当所设备接收数据后，比对地址自己是否目标设备。如果比对不符，设备进入等待状态，等待STOP信号的来临；如果比对相符，设备会发送一个应答信号——ACKNOWLEDGE作回应。当主设备收到应答后便开始传送或接收数据。数据帧大小为8位，尾随一位的应答信号。主设备发送数据，从设备应答；相反主设备接数据，主设备应答。当数据传送完毕，主设备发送一个STOP信号，向其它设备宣告释放总线，其它设备回到初始状态。
     <br/>
     <img alt="IIC 通信过程" src="https://i-blog.csdnimg.cn/blog_migrate/a6aa14de235ebfb99c2cf81688231afa.jpeg"/>
    </p>
    <p>
     基于IIC总线的物理结构，总线上的START和STOP信号必定是唯一的。
     <br/>
     另外，
     <strong>
      IIC总线标准规定SDA线的数据转换必须在SCL线的低电平期，在SCL线的高电平期，SDA线的上数据是稳定的。换句话说，IIC并不是要求只在上升沿或下降沿数据有效，而是要求整个高电平期间都有效！
     </strong>
     <br/>
     下图就是IIC通信的时序图，可以看到起始位是在SCL的高电平期间SDA有一个下降沿；停止位是在SCL的高电平期间SDA有一个上升沿。
     <br/>
     <img alt="IIC数据转换发生在SCL低电平期间" src="https://i-blog.csdnimg.cn/blog_migrate/12e755b82e4c6cd068818ff65f58c491.jpeg"/>
    </p>
    <p>
     IIC协议规定，数据传输必须带响应。比如主机发了一个字节的数据，那么这时从机应该发送一个响应告诉主机它收到了（注意，此时的响应虽然是从机发出的，但是时钟还是主机提供的，也就是不管什么时候，不管主机是接收还是发送，只要是主机，那么时钟就是由这个主机提供）。那这个响应到底是啥？就是：在响应的时钟期间，发送器释放SDA线（释放后，SDA就被上拉电阻拉高了），而同时，在这个响应的时钟脉冲期间，接收器必须将SDA线拉低，且保持整个时钟脉冲的高电平期间，SDA为稳定的低电平，就相当于回应了发送器ACK了，这就是响应。
     <br/>
     下图描述的是IIC上的响应（Acknowledge）信号是如何产生的，如图所示，在第九个时钟周期，发送端数据置高电平，接收端将数据线拉低，则发送端检测到低电平响应信号。
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/95d71799b7797a57380c69b7c21d749a.jpeg">
      <br/>
      <strong>
       3.3 IIC物理实现
      </strong>
     </img>
    </p>
    <p>
     SCL线和SDA线都是漏极开路（open-drain），通过上拉电阻外加一个电压源。当把线路接地时，线路为逻辑0，当释放线路，线路空闲时，线路为逻辑1。基于这些特性，IIC设备对总线的操作仅有“把线路地”——输出逻辑0。IIC总线设计只使用了两条线，但相当优雅地实现任意数目设备间无缝通信，堪称完美。我们设想一下，如果有两支设备同时向SCL线和SDA线发送信息会出现什么情况。
     <strong>
      基于IIC总线的设计，线路上不可能出现电平冲突现象
     </strong>
     。如果一支设备发送逻辑0，其它发送逻辑1，那么线路看到的只有逻辑0。也就是说，如果出现电平冲突，发送逻辑0的始终是“赢家”。总线的物理结构亦允许主设备在往总线写数据的同时读取数据。这样，任何设备都可以检测冲突的发生。当两支主设备竞争总线的时候，“赢家”并不知道竞争的发生，只有“输家”发现了冲突——当它写一个逻辑1，却读到0时——而退出竞争。10位设备地址任何IIC设备都有一个7位地址，理论上，现实中只能有127种不同的IIC设备。实际上，已有IIC的设备种类远远多于这个限制，在一条总线上出现相同的地址的IIC设备的概率相当高。为了突破这个限制，很多设备使用了双重地址——7位地址加引脚地址（external configuration pins）。IIC 标准也预知了这种限制，提出10位的地址方案。
    </p>
    <p>
     <strong>
      10位的地址方案
     </strong>
     对 IIC协议的影响有两点：
    </p>
    <p>
     第一，地址帧为两个字节长，原来的是一个字节；
    </p>
    <p>
     第二，第一个字节前五位最高有效位用作10位地址标识，约定是“11110”。
     <br/>
     <img alt="IIC的10位地址方案" src="https://i-blog.csdnimg.cn/blog_migrate/1a44421953f2fe33d7042b61dda4dc36.jpeg"/>
     <br/>
     除了10位地址标识，标准还预留了一些地址码用作其它用途，如下表：
     <br/>
     <img alt="地址码" src="https://i-blog.csdnimg.cn/blog_migrate/852c0fe49b541ea74e420e98fa5c954a.jpeg"/>
    </p>
    <h3>
     <a id="4_IIC_vs_SPI__70">
     </a>
     4. 总结：IIC vs SPI: 哪位是赢家？
    </h3>
    <ul>
     <li>
      <strong>
       总线拓扑结构/信号路由/硬件资源耗费
      </strong>
      <br/>
      IIC 只需两根信号线，而标准SPI至少四根信号，如果有多个从设备，信号需要更多。一些SPI变种虽然只使用三根线——SCLK, SS和双向的MISO/MOSI，但SS线还是要和从设备一对一根。另外，如果SPI要实现多主设备结构，总线系统需额外的逻辑和线路。用IIC 构建系统总线唯一的问题是有限的7位地址空间，但这个问题新标准已经解决——使用10位地址。从第一点上看，IIC是明显的大赢家。
     </li>
     <li>
      <strong>
       数据吞吐/传输速度
      </strong>
      <br/>
      如果应用中必须使用高速数据传输，那么SPI是必然的选择。因为SPI是全双工，IIC 的不是。SPI没有定义速度限制，一般的实现通常能达到甚至超过10 Mbps。IIC 最高的速度也就快速+模式（1 Mbps）和高速模式（3.4 Mbps），后面的模式还需要额外的I/O缓冲区，还并不是总是容易实现的。
     </li>
     <li>
      <strong>
       优雅性
      </strong>
      <br/>
      IIC 常被称更优雅于SPI。公正的说，我们更倾向于认为两者同等优雅和健壮。IIC的优雅在于它的特色——用很轻盈的架构实现了多主设备仲裁和设备路由。但是对使用的工程师来讲，理解总线结构更费劲，而且总线的性能不高。SPI的优点在于它的结构相当的直观简单，容易实现，并且有很好扩展性。SPI的简单性不足称其优雅，因为要用SPI搭建一个有用的通信平台，还需要在SPI之上构建特定的通信协议软件。也就是说要想获得SPI特有而IIC没有的特性——高速性能，工程师们需要付出更多的劳动。另外，这种自定的工作是完全自由的，这也说明为什么SPI没有官方标准。IIC和SPI都对低速设备通信提供了很好的支持，不过，SPI适合数据流应用，而IIC更适合“字节设备”的多主设备应用。
     </li>
     <li>
      <strong>
       小结
      </strong>
      <br/>
      在数字通信协议簇中，IIC和SPI常称为“小”协议，相对Ethernet, USB, SATA, PCI-Express等传输速度达数百上千兆字节每秒的总线。但是，我们不能忘记的是各种总线的用途是什么。“大”协议是用于系统外的整个系统之间通信的，“小”协议是用于系统内各芯片间的通信，没有迹象表明“大”协议有必要取代“小”协议。
      <strong>
       IIC和SPI的存在和流行体现了“够用就好”的哲学
      </strong>
      。回应文首，IIC和SPI如此的流行，它是任何一位嵌入式工程师必备的工具。
     </li>
    </ul>
    <h3>
     <a id="5__80">
     </a>
     5. 参考
    </h3>
    <ol>
     <li>
      http://m.elecfans.com/article/610220.html
     </li>
     <li>
      https://blog.csdn.net/ruiyelp/article/details/113872648
     </li>
    </ol>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874:7470733a2f2f626c6f672e6373646e2e6e65742f536574756c:2f61727469636c652f64657461696c732f3738393638323432" class_="artid" style="display:none">
 </p>
</div>


