---
layout: post
title: "Python-调用-DeepSeek-API-完整指南"
date: 2025-02-04 11:37:50 +0800
description: "本文将详细介绍如何使用 Python 调用 DeepSeek A"
keywords: "python调用deepseek"
categories: ['人工智能', 'Python']
tags: ['数据库', 'Python']
artid: "145438717"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=145438717
    alt: "Python-调用-DeepSeek-API-完整指南"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=145438717
featuredImagePreview: https://bing.ee123.net/img/rand?artid=145438717
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Python 调用 DeepSeek API 完整指南
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_1">
     </a>
     简介
    </h3>
    <p>
     本文将详细介绍如何使用 Python 调用 DeepSeek API，实现流式对话并保存对话记录。相比 Go 版本，Python 实现更加简洁优雅，适合快速开发和原型验证。
     <a href="https://cloud.siliconflow.cn/i/vnCCfVaQ" rel="nofollow">
      https://cloud.siliconflow.cn/i/vnCCfVaQ
     </a>
    </p>
    <h3>
     <a id="1__4">
     </a>
     1. 环境准备
    </h3>
    <h4>
     <a id="11__6">
     </a>
     1.1 依赖安装
    </h4>
    <pre><code class="prism language-bash">pip <span class="token function">install</span> requests
</code></pre>
    <h4>
     <a id="12__11">
     </a>
     1.2 项目结构
    </h4>
    <pre><code>deepseek-project/
├── main.py           # 主程序
└── conversation.txt  # 对话记录文件
</code></pre>
    <h3>
     <a id="2__18">
     </a>
     2. 完整代码实现
    </h3>
    <pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> json
<span class="token keyword">import</span> time
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">def</span> <span class="token function">save_to_file</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> content<span class="token punctuation">,</span> is_question<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""保存对话内容到文件"""</span>
    timestamp <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y-%m-%d %H:%M:%S"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> is_question<span class="token punctuation">:</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\n[</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>timestamp<span class="token punctuation">}</span></span><span class="token string">] Question:\n</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>content<span class="token punctuation">}</span></span><span class="token string">\n\n[</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>timestamp<span class="token punctuation">}</span></span><span class="token string">] Answer:\n"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 配置</span>
    url <span class="token operator">=</span> <span class="token string">"https://api.siliconflow.cn/v1/chat/completions"</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span><span class="token punctuation">,</span>
        <span class="token string">"Authorization"</span><span class="token punctuation">:</span> <span class="token string">"Bearer YOUR_API_KEY"</span>  <span class="token comment"># 替换为你的 API Key</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 打开文件用于保存对话</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"conversation.txt"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token comment"># 获取用户输入</span>
            question <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"\n请输入您的问题 (输入 q 退出): "</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> question<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'q'</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"程序已退出"</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>

            <span class="token comment"># 保存问题</span>
            save_to_file<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> question<span class="token punctuation">,</span> is_question<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

            <span class="token comment"># 准备请求数据</span>
            data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"model"</span><span class="token punctuation">:</span> <span class="token string">"deepseek-ai/DeepSeek-V3"</span><span class="token punctuation">,</span>
                <span class="token string">"messages"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                        <span class="token string">"content"</span><span class="token punctuation">:</span> question
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">"stream"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
                <span class="token string">"max_tokens"</span><span class="token punctuation">:</span> <span class="token number">2048</span><span class="token punctuation">,</span>
                <span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">0.7</span><span class="token punctuation">,</span>
                <span class="token string">"top_p"</span><span class="token punctuation">:</span> <span class="token number">0.7</span><span class="token punctuation">,</span>
                <span class="token string">"top_k"</span><span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
                <span class="token string">"frequency_penalty"</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
                <span class="token string">"n"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string">"response_format"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"text"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token comment"># 发送流式请求</span>
                response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> json<span class="token operator">=</span>data<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> stream<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
                response<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 检查响应状态</span>

                <span class="token comment"># 处理流式响应</span>
                <span class="token keyword">for</span> line <span class="token keyword">in</span> response<span class="token punctuation">.</span>iter_lines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> line<span class="token punctuation">:</span>
                        line <span class="token operator">=</span> line<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> line<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'data: '</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            <span class="token keyword">if</span> line <span class="token operator">==</span> <span class="token string">'data: [DONE]'</span><span class="token punctuation">:</span>
                                <span class="token keyword">continue</span>
                            
                            <span class="token keyword">try</span><span class="token punctuation">:</span>
                                content <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 去掉 'data: ' 前缀</span>
                                <span class="token keyword">if</span> content<span class="token punctuation">[</span><span class="token string">'choices'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'delta'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                                    chunk <span class="token operator">=</span> content<span class="token punctuation">[</span><span class="token string">'choices'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'delta'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span>
                                    <span class="token keyword">print</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> flush<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
                                    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
                                    <span class="token builtin">file</span><span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token keyword">except</span> json<span class="token punctuation">.</span>JSONDecodeError<span class="token punctuation">:</span>
                                <span class="token keyword">continue</span>

                <span class="token comment"># 添加分隔符</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n----------------------------------------"</span><span class="token punctuation">)</span>
                <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\n----------------------------------------\n"</span><span class="token punctuation">)</span>
                <span class="token builtin">file</span><span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token keyword">except</span> requests<span class="token punctuation">.</span>RequestException <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                error_msg <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"请求错误: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>error_msg<span class="token punctuation">)</span>
                <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>error_msg<span class="token punctuation">)</span>
                <span class="token builtin">file</span><span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="3__115">
     </a>
     3. 代码详解
    </h3>
    <h4>
     <a id="31__117">
     </a>
     3.1 核心功能
    </h4>
    <h5>
     <a id="_119">
     </a>
     文件记录功能
    </h5>
    <p>
     <code>
      save_to_file
     </code>
     函数负责：
    </p>
    <ul>
     <li>
      生成时间戳
     </li>
     <li>
      格式化保存问题和答案
     </li>
     <li>
      自动刷新文件缓冲区
     </li>
    </ul>
    <h5>
     <a id="API__125">
     </a>
     API 配置
    </h5>
    <pre><code class="prism language-python">headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span><span class="token punctuation">,</span>
    <span class="token string">"Authorization"</span><span class="token punctuation">:</span> <span class="token string">"Bearer YOUR_API_KEY"</span>  <span class="token comment"># 替换为你的 API Key</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_133">
     </a>
     流式请求处理
    </h5>
    <p>
     程序使用
     <code>
      requests
     </code>
     库的流式处理功能：
    </p>
    <ul>
     <li>
      使用
      <code>
       stream=True
      </code>
      启用流式传输
     </li>
     <li>
      逐行处理响应数据
     </li>
     <li>
      实时显示和保存内容
     </li>
    </ul>
    <h4>
     <a id="32__139">
     </a>
     3.2 配置参数说明
    </h4>
    <p>
     API 请求参数：
    </p>
    <ul>
     <li>
      <code>
       model
      </code>
      : 使用的模型名称
     </li>
     <li>
      <code>
       stream
      </code>
      : 启用流式输出
     </li>
     <li>
      <code>
       max_tokens
      </code>
      : 最大输出长度 (2048)
     </li>
     <li>
      <code>
       temperature
      </code>
      : 控制随机性 (0.7)
     </li>
     <li>
      <code>
       top_p
      </code>
      ,
      <code>
       top_k
      </code>
      : 采样参数
     </li>
     <li>
      <code>
       frequency_penalty
      </code>
      : 重复惩罚系数
     </li>
    </ul>
    <h3>
     <a id="4__149">
     </a>
     4. 错误处理
    </h3>
    <p>
     代码包含完整的错误处理机制：
    </p>
    <ul>
     <li>
      检查 HTTP 响应状态
     </li>
     <li>
      捕获网络异常
     </li>
     <li>
      处理 JSON 解析错误
     </li>
     <li>
      文件操作错误处理
     </li>
    </ul>
    <h3>
     <a id="5__156">
     </a>
     5. 使用方法
    </h3>
    <h4>
     <a id="51__158">
     </a>
     5.1 修改配置
    </h4>
    <p>
     在代码中替换 YOUR_API_KEY 为你的实际 API Key。
    </p>
    <h4>
     <a id="52__161">
     </a>
     5.2 运行程序
    </h4>
    <pre><code class="prism language-bash">python main.py
</code></pre>
    <h4>
     <a id="53__166">
     </a>
     5.3 交互方式
    </h4>
    <ol>
     <li>
      输入问题进行对话
     </li>
     <li>
      输入 ‘q’ 退出程序
     </li>
     <li>
      查看 conversation.txt 获取对话记录
     </li>
    </ol>
    <h3>
     <a id="6__171">
     </a>
     6. 性能优化建议
    </h3>
    <ol>
     <li>
      <p>
       文件操作
      </p>
      <ul>
       <li>
        使用适当的缓冲区大小
       </li>
       <li>
        定期刷新文件缓冲
       </li>
       <li>
        正确关闭文件句柄
       </li>
      </ul>
     </li>
     <li>
      <p>
       网络请求
      </p>
      <ul>
       <li>
        设置适当的超时
       </li>
       <li>
        使用会话（Session）复用连接
       </li>
       <li>
        处理网络异常
       </li>
      </ul>
     </li>
     <li>
      <p>
       内存管理
      </p>
      <ul>
       <li>
        及时释放资源
       </li>
       <li>
        避免大量数据积累
       </li>
       <li>
        使用生成器处理流式数据
       </li>
      </ul>
     </li>
    </ol>
    <h3>
     <a id="_188">
     </a>
     总结
    </h3>
    <p>
     Python 版本的 DeepSeek API 调用实现简单直观，适合快速开发和测试。通过流式处理和文件记录，提供了完整的对话体验。
    </p>
    <h3>
     <a id="_191">
     </a>
     立即体验
    </h3>
    <p>
     现在就来体验 DeepSeek 的强大功能！
    </p>
    <p>
     快来体验 DeepSeek：
     <a href="https://cloud.siliconflow.cn/i/vnCCfVaQ" rel="nofollow">
      https://cloud.siliconflow.cn/i/vnCCfVaQ
     </a>
    </p>
    <p>
     快来体验 DeepSeek：
     <a href="https://cloud.siliconflow.cn/i/vnCCfVaQ" rel="nofollow">
      https://cloud.siliconflow.cn/i/vnCCfVaQ
     </a>
    </p>
    <p>
     快来体验 DeepSeek：
     <a href="https://cloud.siliconflow.cn/i/vnCCfVaQ" rel="nofollow">
      https://cloud.siliconflow.cn/i/vnCCfVaQ
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f687a65746865722f:61727469636c652f64657461696c732f313435343338373137" class_="artid" style="display:none">
 </p>
</div>


