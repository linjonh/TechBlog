---
layout: post
title: "WPF可编辑的DataGrid根据条件控制最后一行的按钮显示隐藏"
date: 2025-03-14 23:28:02 +0800
description: "WPF可编辑的DataGrid根据条件控制最后一行的按钮显示隐藏"
keywords: "WPF可编辑的DataGrid根据条件控制最后一行的按钮显示隐藏"
categories: ['Wpf']
tags: ['最后一行控制显示隐藏', 'Wpf']
artid: "146269326"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146269326
    alt: "WPF可编辑的DataGrid根据条件控制最后一行的按钮显示隐藏"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146269326
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146269326
cover: https://bing.ee123.net/img/rand?artid=146269326
image: https://bing.ee123.net/img/rand?artid=146269326
img: https://bing.ee123.net/img/rand?artid=146269326
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     WPF可编辑的DataGrid根据条件控制最后一行的按钮显示隐藏
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <p>
     如下图，可编辑的DataGrid，如果有操作按钮，则最后一行会异常出现按钮；解决办法就是让代码动态生成按钮；
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f6b1c72aa7c24c1a8972bc9cb3857c3d.png"/>
    </p>
    <h3>
     <a id="_6">
     </a>
     页面代码
    </h3>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Page</span> <span class="token attr-name"><span class="token namespace">x:</span>Class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>WpfSnqkGasAnalysis.PageUser<span class="token punctuation">"</span></span>
      <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.microsoft.com/winfx/2006/xaml/presentation<span class="token punctuation">"</span></span>
      <span class="token attr-name"><span class="token namespace">xmlns:</span>x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.microsoft.com/winfx/2006/xaml<span class="token punctuation">"</span></span>
      <span class="token attr-name"><span class="token namespace">xmlns:</span>mc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.openxmlformats.org/markup-compatibility/2006<span class="token punctuation">"</span></span> 
      <span class="token attr-name"><span class="token namespace">xmlns:</span>d</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.microsoft.com/expression/blend/2008<span class="token punctuation">"</span></span> 
      <span class="token attr-name"><span class="token namespace">xmlns:</span>local</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>clr-namespace:WpfSnqkGasAnalysis.Model;assembly=WpfSnqkGasAnalysis.Model<span class="token punctuation">"</span></span> 
      <span class="token attr-name"><span class="token namespace">xmlns:</span>local1</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>clr-namespace:WpfSnqkGasAnalysis<span class="token punctuation">"</span></span>
      <span class="token attr-name"><span class="token namespace">mc:</span>Ignorable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>d<span class="token punctuation">"</span></span> 
      <span class="token attr-name"><span class="token namespace">d:</span>DesignHeight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>450<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">d:</span>DesignWidth</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>800<span class="token punctuation">"</span></span>
      <span class="token attr-name">Title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PageUser<span class="token punctuation">"</span></span> <span class="token attr-name">Loaded</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Page_Loaded<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Page.Resources</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">local1:</span>ImgShowConvert</span> <span class="token attr-name"><span class="token namespace">x:</span>Key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>imgShow<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">local1:</span>ImgShowConvert</span><span class="token punctuation">&gt;</span></span>       
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">local1:</span>CheckNullConvert</span> <span class="token attr-name"><span class="token namespace">x:</span>Key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>accountIsReadOnly<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Page.Resources</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Grid</span> <span class="token attr-name">Margin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>       
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Grid.RowDefinitions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RowDefinition</span> <span class="token attr-name">Height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>60<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RowDefinition</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RowDefinition</span> <span class="token attr-name">Height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RowDefinition</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Grid.RowDefinitions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DockPanel</span> <span class="token attr-name">LastChildFill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>False<span class="token punctuation">"</span></span> <span class="token attr-name">Grid.Row</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Label</span> <span class="token attr-name">Content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>账号：<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">Style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token punctuation">{<!-- --></span>StaticResource Label1<span class="token punctuation">}</span></span><span class="token punctuation">"</span></span></span>  <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextBox</span>  <span class="token attr-name"><span class="token namespace">x:</span>Name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>txtAccount<span class="token punctuation">"</span></span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">Style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token punctuation">{<!-- --></span>StaticResource input1<span class="token punctuation">}</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name">Margin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0,0,20,0<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span> <span class="token attr-name"><span class="token namespace">x:</span>Name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btnSearch<span class="token punctuation">"</span></span> <span class="token attr-name">Content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>查询<span class="token punctuation">"</span></span>  <span class="token special-attr"><span class="token attr-name">Style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token punctuation">{<!-- --></span>StaticResource buttonBlue<span class="token punctuation">}</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name">HorizontalAlignment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Left<span class="token punctuation">"</span></span> <span class="token attr-name">VerticalAlignment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Center<span class="token punctuation">"</span></span> <span class="token attr-name">Click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btnSearch_Click<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DockPanel</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Grid</span> <span class="token attr-name">Grid.Row</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span>   <span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DataGrid</span>  <span class="token attr-name"><span class="token namespace">x:</span>Name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dgUser<span class="token punctuation">"</span></span>  <span class="token attr-name">ItemsSource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{Binding }<span class="token punctuation">"</span></span>  <span class="token special-attr"><span class="token attr-name">Style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token punctuation">{<!-- --></span>StaticResource DataGrid1<span class="token punctuation">}</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name">ColumnHeaderStyle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{StaticResource DataGrid1_header}<span class="token punctuation">"</span></span>  <span class="token attr-name">RowHeaderWidth</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>  <span class="token attr-name">BorderBrush</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#D3D3D3<span class="token punctuation">"</span></span> <span class="token attr-name">BorderThickness</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1,0,0,0<span class="token punctuation">"</span></span>  <span class="token attr-name">AutoGenerateColumns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>False<span class="token punctuation">"</span></span> <span class="token attr-name">SelectionUnit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Cell<span class="token punctuation">"</span></span> <span class="token attr-name">CanUserAddRows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>True<span class="token punctuation">"</span></span> <span class="token attr-name">CellEditEnding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dgUser_CellEditEnding<span class="token punctuation">"</span></span>   <span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DataGrid.Columns</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DataGridTextColumn</span> <span class="token attr-name">ElementStyle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{StaticResource dataGridColumn}<span class="token punctuation">"</span></span> <span class="token attr-name">Width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>150<span class="token punctuation">"</span></span> <span class="token attr-name">Header</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>账号<span class="token punctuation">"</span></span> <span class="token attr-name">Binding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{Binding  Account }<span class="token punctuation">"</span></span> <span class="token attr-name">IsReadOnly</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{Binding Path=Account,Converter={StaticResource accountIsReadOnly}}<span class="token punctuation">"</span></span>   <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DataGridTextColumn</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DataGridTextColumn</span>   <span class="token attr-name">ElementStyle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{StaticResource dataGridColumn}<span class="token punctuation">"</span></span> <span class="token attr-name">Width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span> <span class="token attr-name">Header</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>姓名<span class="token punctuation">"</span></span> <span class="token attr-name">Binding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{Binding Realname,Mode=TwoWay}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DataGridTextColumn</span><span class="token punctuation">&gt;</span></span>
                    <span class="token comment">&lt;!--&lt;DataGridComboBoxColumn   Width="200" Header="角色" TextBinding="{Binding Role_id,Mode=TwoWay }"  ItemsSource="{x:Static  local:CommonConfig.RoleList  }" SelectedItemBinding="{Binding  Role_id,UpdateSourceTrigger=PropertyChanged}"   /&gt;--&gt;</span>
                   
                    <span class="token comment">&lt;!--&lt;DataGridCheckBoxColumn      Width="90"  Header="是否启用" Binding="{Binding Dstat,Mode=TwoWay}"  &gt;&lt;/DataGridCheckBoxColumn&gt;--&gt;</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DataGridTemplateColumn</span>  <span class="token attr-name">Header</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>是否启用<span class="token punctuation">"</span></span> <span class="token attr-name">Width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>90<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DataGridTemplateColumn.CellTemplate</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DataTemplate</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>StackPanel</span>   <span class="token attr-name">Loaded</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CheckStackPanel_Loaded<span class="token punctuation">"</span></span>  <span class="token attr-name">Tag</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{Binding Dstat}<span class="token punctuation">"</span></span>  <span class="token attr-name">Orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Horizontal<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">Style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token punctuation">{<!-- --></span>StaticResource StackPanel_buttonSpance<span class="token punctuation">}</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
                                   
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>StackPanel</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DataTemplate</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DataGridTemplateColumn.CellTemplate</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DataGridTemplateColumn</span><span class="token punctuation">&gt;</span></span>


                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DataGridTemplateColumn</span> <span class="token attr-name">Header</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>电子签名<span class="token punctuation">"</span></span>  <span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DataGridTemplateColumn.CellTemplate</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DataTemplate</span><span class="token punctuation">&gt;</span></span>                                            
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Image</span> <span class="token attr-name">Source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{Binding SignatureImgPath,Converter={StaticResource imgShow} }<span class="token punctuation">"</span></span> <span class="token attr-name">MaxHeight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>60<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Image</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DataTemplate</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DataGridTemplateColumn.CellTemplate</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DataGridTemplateColumn</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DataGridTextColumn</span> <span class="token attr-name">ElementStyle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{StaticResource dataGridColumn}<span class="token punctuation">"</span></span> <span class="token attr-name">Width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span>   <span class="token attr-name">Header</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>备注<span class="token punctuation">"</span></span> <span class="token attr-name">Binding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{Binding Remark,Mode=TwoWay}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DataGridTextColumn</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DataGridTemplateColumn</span>  <span class="token attr-name">Header</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>操作<span class="token punctuation">"</span></span> <span class="token attr-name">Width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DataGridTemplateColumn.CellTemplate</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DataTemplate</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>StackPanel</span> <span class="token attr-name">Name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btnList<span class="token punctuation">"</span></span>  <span class="token attr-name">Loaded</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btnList_Loaded<span class="token punctuation">"</span></span>  <span class="token attr-name">Tag</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{Binding Id}<span class="token punctuation">"</span></span>  <span class="token attr-name">Orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Horizontal<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">Style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token punctuation">{<!-- --></span>StaticResource StackPanel_buttonSpance<span class="token punctuation">}</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
                                    <span class="token comment">&lt;!--&lt;TextBlock Text="{Binding Id}" Background="#D77DE1" Padding="10,2"&gt;&lt;/TextBlock&gt;--&gt;</span>

                                    <span class="token comment">&lt;!--&lt;Button  Name="btnEdit" Tag="{Binding Id}" HorizontalAlignment="Left"   Visibility="{Binding Id, ConverterParameter=99, Converter={StaticResource lastRowC}  }"  VerticalAlignment="Center" Content="上传电子签名"   Click="BtnImgName_Click"  /&gt;
                                    &lt;Button  Name="btnPasswordReset" Tag="{Binding Id}" HorizontalAlignment="Left" Visibility="{Binding Id, ConverterParameter=99, Converter={StaticResource lastRowC}  }"  VerticalAlignment="Center" Content="重置密码"   Click="ResetPassword_Click"  /&gt;
                                    &lt;Button  Name="btnDel"   HorizontalAlignment="Left" VerticalAlignment="Center" Content="删除" Visibility="{Binding Id, ConverterParameter=99, Converter={StaticResource lastRowC}  }"   Click="del_Click"  /&gt;--&gt;</span>
                           
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>StackPanel</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DataTemplate</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DataGridTemplateColumn.CellTemplate</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DataGridTemplateColumn</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DataGrid.Columns</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DataGrid</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Grid</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Grid</span><span class="token punctuation">&gt;</span></span>   
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Page</span><span class="token punctuation">&gt;</span></span>

</code></pre>
    <h3>
     <a id="_84">
     </a>
     后台代码
    </h3>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>VisualBasic<span class="token punctuation">.</span>ApplicationServices</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Controls</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Primitives</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Data</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Documents</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Media</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>Imaging</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Navigation</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Shapes</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">WpfRepairProject<span class="token punctuation">.</span>IBLL</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">WpfRepairProject<span class="token punctuation">.</span>IData</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">WpfRepairProject<span class="token punctuation">.</span>Model</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">WpfSnqkGasAnalysis<span class="token punctuation">.</span>IBusiness_impl</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">WpfSnqkGasAnalysis<span class="token punctuation">.</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">WpfSnqkGasAnalysis</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// PageUser.xaml 的交互逻辑，账号管理</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">PageUser</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Page</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token function">PageUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">InitializeComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//UserBusiness userBusiness = new UserBusiness();</span>

        <span class="token keyword">readonly</span> <span class="token class-name">IK_userDAL</span> userDAL <span class="token operator">=</span> ServicesRepairHelpter<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IK_userDAL<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">readonly</span> <span class="token class-name">IUserBLL</span> userBLL <span class="token operator">=</span> ServicesRepairHelpter<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IUserBLL<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Page_Loaded</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//dgUser</span>
            <span class="token class-name"><span class="token keyword">var</span></span> list <span class="token operator">=</span> userDAL<span class="token punctuation">.</span><span class="token function">GetListAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">?.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> item <span class="token keyword">in</span> list<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    item<span class="token punctuation">.</span>Dstat <span class="token operator">=</span> item<span class="token punctuation">.</span>U_stat <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            dgUser<span class="token punctuation">.</span>ItemsSource <span class="token operator">=</span> list<span class="token punctuation">;</span>
            <span class="token comment">//   dgUser.</span>
            <span class="token comment">//dgUser.</span>
            <span class="token comment">//dgUser.row</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//回车键提交，或者鼠标点击其他单元格</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">dgUser_CellEditEnding</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">DataGridCellEditEndingEventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> e<span class="token punctuation">.</span>Row<span class="token punctuation">.</span>Item <span class="token keyword">as</span> <span class="token class-name">K_user</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">object</span></span> selectedValue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>EditingElement <span class="token keyword">is</span> <span class="token class-name">TextBox</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                selectedValue <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>TextBox<span class="token punctuation">)</span>e<span class="token punctuation">.</span>EditingElement<span class="token punctuation">)</span><span class="token punctuation">.</span>Text<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>



            <span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> updateColumns <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//账号。</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>Column<span class="token punctuation">.</span>SortMemberPath<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"Account"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>

                user<span class="token punctuation">.</span>Account <span class="token operator">=</span> selectedValue<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                updateColumns<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"Account"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>Column<span class="token punctuation">.</span>SortMemberPath<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"Realname"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                user<span class="token punctuation">.</span>Realname <span class="token operator">=</span> selectedValue<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                updateColumns<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"Realname"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//角色</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>Column<span class="token punctuation">.</span>SortMemberPath<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"User_role_id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name"><span class="token keyword">var</span></span> selectedValue1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Primitives<span class="token punctuation">.</span>Selector<span class="token punctuation">)</span>e<span class="token punctuation">.</span>EditingElement<span class="token punctuation">)</span><span class="token punctuation">.</span>SelectedValue <span class="token keyword">as</span> <span class="token class-name"><span class="token keyword">string</span></span><span class="token punctuation">;</span>
                user<span class="token punctuation">.</span>User_role_id <span class="token operator">=</span> selectedValue1<span class="token punctuation">.</span><span class="token function">ToMyInt64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                updateColumns<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"User_role_id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//备注</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>Column<span class="token punctuation">.</span>SortMemberPath<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"Remark"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                user<span class="token punctuation">.</span>Remark <span class="token operator">=</span> selectedValue<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                updateColumns<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"Remark"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//状态</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>Column<span class="token punctuation">.</span>SortMemberPath<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"Dstat"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name"><span class="token keyword">bool</span><span class="token punctuation">?</span></span> check <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Primitives<span class="token punctuation">.</span>ToggleButton<span class="token punctuation">)</span>e<span class="token punctuation">.</span>EditingElement<span class="token punctuation">)</span><span class="token punctuation">.</span>IsChecked<span class="token punctuation">;</span>
                user<span class="token punctuation">.</span>U_stat <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>check <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    user<span class="token punctuation">.</span>U_stat <span class="token operator">=</span> check<span class="token punctuation">.</span>Value <span class="token punctuation">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                updateColumns<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"U_stat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>selectedValue <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>selectedValue<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>Id <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>

                <span class="token comment">//新增一个人。//添加时间：2022-12-6 17:35:58</span>
                <span class="token class-name">K_user</span> userInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">K_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userInfo<span class="token punctuation">.</span>Account <span class="token operator">=</span> selectedValue<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> addResult <span class="token operator">=</span> userBLL<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token function">btnSearch_Click</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RoutedEventArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//刷新列表数据</span>


                ShowAlertHelpter<span class="token punctuation">.</span><span class="token function">ShowAlert</span><span class="token punctuation">(</span>addResult<span class="token punctuation">.</span>Msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>updateColumns<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> updateColumns<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"Account"</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    ShowAlertHelpter<span class="token punctuation">.</span><span class="token function">ShowAlert</span><span class="token punctuation">(</span><span class="token string">"账号不允许修改"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">btnSearch_Click</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RoutedEventArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//刷新列表数据</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">//修改，保存</span>
                <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> userBLL<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> updateColumns<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>Code <span class="token operator">==</span> ResultCode<span class="token punctuation">.</span>Success<span class="token punctuation">.</span><span class="token function">ToMyInt64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">btnSearch_Click</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RoutedEventArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//刷新列表数据</span>
                <span class="token punctuation">}</span>
                ShowAlertHelpter<span class="token punctuation">.</span><span class="token function">ShowAlert</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>Msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

        <span class="token comment">//搜索</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">btnSearch_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">var</span></span> list <span class="token operator">=</span> userDAL<span class="token punctuation">.</span><span class="token function">GetListAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> listResult <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>g <span class="token operator">=&gt;</span> g<span class="token punctuation">.</span>Account<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>txtAccount<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>listResult<span class="token punctuation">?.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> item <span class="token keyword">in</span> listResult<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    item<span class="token punctuation">.</span>Dstat <span class="token operator">=</span> item<span class="token punctuation">.</span>U_stat <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//必须要List，否则不能编辑单元格</span>
            dgUser<span class="token punctuation">.</span>ItemsSource <span class="token operator">=</span> listResult<span class="token punctuation">;</span>
            dgUser<span class="token punctuation">.</span><span class="token function">UpdateLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//上传签名</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">BtnImgName_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Microsoft<span class="token punctuation">.</span>Win32<span class="token punctuation">.</span>OpenFileDialog</span> ofd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Microsoft<span class="token punctuation">.</span>Win32<span class="token punctuation">.</span>OpenFileDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ofd<span class="token punctuation">.</span>Filter <span class="token operator">=</span> <span class="token string">"image|*.png"</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span>ofd<span class="token punctuation">.</span><span class="token function">ShowDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//保存图片</span>
                <span class="token class-name"><span class="token keyword">string</span></span> dir <span class="token operator">=</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>AppDomain<span class="token punctuation">.</span>CurrentDomain<span class="token punctuation">.</span>BaseDirectory<span class="token punctuation">,</span> CommonConfig<span class="token punctuation">.</span>UploadImgSavePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name"><span class="token keyword">string</span></span> file <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span>Ticks <span class="token operator">+</span> <span class="token string">".png"</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">string</span></span> fileSavePath <span class="token operator">=</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> buffer <span class="token operator">=</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>File<span class="token punctuation">.</span><span class="token function">ReadAllBytes</span><span class="token punctuation">(</span>ofd<span class="token punctuation">.</span>FileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>File<span class="token punctuation">.</span><span class="token function">WriteAllBytes</span><span class="token punctuation">(</span>fileSavePath<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//当前人，修改签名</span>
                <span class="token class-name"><span class="token keyword">string</span></span> relativePath <span class="token operator">=</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>CommonConfig<span class="token punctuation">.</span>UploadImgSavePath<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//Login_user login_User = this.dgUser.SelectedItem as Login_user;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> button <span class="token operator">=</span> sender <span class="token keyword">as</span> <span class="token class-name">Button</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>button <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name"><span class="token keyword">long</span></span> id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>button<span class="token punctuation">.</span>Tag<span class="token punctuation">.</span><span class="token function">ToMyInt64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> userDAL<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        ShowAlertHelpter<span class="token punctuation">.</span><span class="token function">ShowAlert</span><span class="token punctuation">(</span><span class="token string">"没找到用户"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    user<span class="token punctuation">.</span>SignatureImgPath <span class="token operator">=</span> relativePath<span class="token punctuation">;</span>
                    <span class="token class-name"><span class="token keyword">var</span></span> taskUpdate <span class="token operator">=</span> userDAL<span class="token punctuation">.</span><span class="token function">UpdateAsync</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{<!-- --></span> <span class="token string">"SignatureImgPath"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name"><span class="token keyword">int</span></span> count <span class="token operator">=</span> taskUpdate<span class="token punctuation">.</span>Result<span class="token punctuation">;</span>

                    <span class="token class-name">IResult</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Result</span><span class="token punctuation">(</span><span class="token string">"签名图片保存失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ResultSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>Code <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ResultCode<span class="token punctuation">.</span>Success<span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token function">btnSearch_Click</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//刷新列表数据</span>
                        ShowAlertHelpter<span class="token punctuation">.</span><span class="token function">ShowAlert</span><span class="token punctuation">(</span><span class="token string">"签名图片保存成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span>
                    <span class="token punctuation">{<!-- --></span>
                        ShowAlertHelpter<span class="token punctuation">.</span><span class="token function">ShowAlert</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>Msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//重置密码 //添加时间：2023-1-10 10:17:37。作者：王浩力</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ResetPassword_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">WindowUserResetPassword</span> windowUserReset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WindowUserResetPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            windowUserReset<span class="token punctuation">.</span>selectedUser <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dgUser<span class="token punctuation">.</span>CurrentItem <span class="token keyword">as</span> <span class="token class-name">K_user</span><span class="token punctuation">;</span>
            windowUserReset<span class="token punctuation">.</span><span class="token function">ShowDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token comment">//删除用户</span>
        <span class="token keyword">private</span> <span class="token keyword">async</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">del_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>FrameworkElement<span class="token punctuation">)</span>sender<span class="token punctuation">)</span><span class="token punctuation">.</span>DataContext <span class="token keyword">as</span> <span class="token class-name">K_user</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                e<span class="token punctuation">.</span>Handled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"确认删除`</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">user<span class="token punctuation">.</span>Account</span><span class="token punctuation">}</span></span><span class="token string">`吗？"</span></span><span class="token punctuation">,</span> <span class="token string">"删除提示"</span><span class="token punctuation">,</span> MessageBoxButton<span class="token punctuation">.</span>YesNo<span class="token punctuation">)</span> <span class="token operator">==</span> MessageBoxResult<span class="token punctuation">.</span>No
                <span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                e<span class="token punctuation">.</span>Handled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name"><span class="token keyword">int</span></span> count <span class="token operator">=</span> <span class="token keyword">await</span> userDAL<span class="token punctuation">.</span><span class="token function">DeleteByPrimaryKeyAsync</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                ShowAlertHelpter<span class="token punctuation">.</span><span class="token function">ShowAlert</span><span class="token punctuation">(</span><span class="token string">"删除成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">btnSearch_Click</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//刷新列表数据</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

        <span class="token comment">//按钮的StackPanel加载完成</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">btnList_Loaded</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//ShowAlertHelpter.ShowAlert("按钮容器加载完成");</span>
            <span class="token class-name"><span class="token keyword">var</span></span> conqi <span class="token operator">=</span> sender <span class="token keyword">as</span> <span class="token class-name">StackPanel</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>conqi <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> conqi<span class="token punctuation">.</span>Tag <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> conqi<span class="token punctuation">.</span>Tag<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"0"</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name"><span class="token keyword">var</span></span> row <span class="token operator">=</span> conqi<span class="token punctuation">.</span>Parent<span class="token punctuation">;</span>

            <span class="token class-name">Button</span> button <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            button<span class="token punctuation">.</span>Content <span class="token operator">=</span> <span class="token string">"重置密码"</span><span class="token punctuation">;</span>
            button<span class="token punctuation">.</span>Click <span class="token operator">+=</span> ResetPassword_Click<span class="token punctuation">;</span>
            button<span class="token punctuation">.</span>Tag <span class="token operator">=</span> conqi<span class="token punctuation">.</span>Tag<span class="token punctuation">;</span>
            conqi<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Button</span> button2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            button2<span class="token punctuation">.</span>Content <span class="token operator">=</span> <span class="token string">"上传电子签名"</span><span class="token punctuation">;</span>
            button2<span class="token punctuation">.</span>Click <span class="token operator">+=</span> BtnImgName_Click<span class="token punctuation">;</span>
            button2<span class="token punctuation">.</span>Tag <span class="token operator">=</span> conqi<span class="token punctuation">.</span>Tag<span class="token punctuation">;</span>
            conqi<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>button2<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Button</span> button3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            button3<span class="token punctuation">.</span>Content <span class="token operator">=</span> <span class="token string">"删除"</span><span class="token punctuation">;</span>
            button3<span class="token punctuation">.</span>Click <span class="token operator">+=</span> del_Click<span class="token punctuation">;</span>
            button3<span class="token punctuation">.</span>Tag <span class="token operator">=</span> conqi<span class="token punctuation">.</span>Tag<span class="token punctuation">;</span>
            conqi<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>button3<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token comment">//动态绑定checkbox</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CheckStackPanel_Loaded</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">var</span></span> conqi <span class="token operator">=</span> sender <span class="token keyword">as</span> <span class="token class-name">StackPanel</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>conqi <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> conqi<span class="token punctuation">.</span>Tag <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">CheckBox</span> checkBox <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CheckBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            checkBox<span class="token punctuation">.</span>IsChecked <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span>conqi<span class="token punctuation">.</span>Tag<span class="token punctuation">;</span>
            checkBox<span class="token punctuation">.</span>Click <span class="token operator">+=</span> <span class="token punctuation">(</span>o<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name"><span class="token keyword">var</span></span> zuj <span class="token operator">=</span> o <span class="token keyword">as</span> <span class="token class-name">CheckBox</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> zuj<span class="token punctuation">.</span>DataContext <span class="token keyword">as</span> <span class="token class-name">K_user</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"确认修改用户`</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">user<span class="token punctuation">.</span>Account</span><span class="token punctuation">}</span></span><span class="token string">`状态吗"</span></span>
                    <span class="token punctuation">,</span> <span class="token string">"提示"</span>
                    <span class="token punctuation">,</span> MessageBoxButton<span class="token punctuation">.</span>OKCancel<span class="token punctuation">)</span> <span class="token operator">!=</span> MessageBoxResult<span class="token punctuation">.</span>OK<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">btnSearch_Click</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RoutedEventArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//刷新列表数据</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                user<span class="token punctuation">.</span>U_stat <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>zuj<span class="token punctuation">.</span>IsChecked <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    user<span class="token punctuation">.</span>U_stat <span class="token operator">=</span> zuj<span class="token punctuation">.</span>IsChecked<span class="token punctuation">.</span>Value <span class="token punctuation">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">//修改，保存</span>
                <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> userBLL<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span> <span class="token string">"U_stat"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>Code <span class="token operator">==</span> ResultCode<span class="token punctuation">.</span>Success<span class="token punctuation">.</span><span class="token function">ToMyInt64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">btnSearch_Click</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RoutedEventArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//刷新列表数据</span>
                <span class="token punctuation">}</span>
                ShowAlertHelpter<span class="token punctuation">.</span><span class="token function">ShowAlert</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>Msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            conqi<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>checkBox<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h3>
     <a id="_417">
     </a>
     动态生成按钮主要代码：
    </h3>
    <pre><code class="prism language-csharp"> <span class="token comment">//按钮的StackPanel加载完成</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">btnList_Loaded</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//ShowAlertHelpter.ShowAlert("按钮容器加载完成");</span>
            <span class="token class-name"><span class="token keyword">var</span></span> conqi <span class="token operator">=</span> sender <span class="token keyword">as</span> <span class="token class-name">StackPanel</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>conqi <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> conqi<span class="token punctuation">.</span>Tag <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> conqi<span class="token punctuation">.</span>Tag<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"0"</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name"><span class="token keyword">var</span></span> row <span class="token operator">=</span> conqi<span class="token punctuation">.</span>Parent<span class="token punctuation">;</span>

            <span class="token class-name">Button</span> button <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            button<span class="token punctuation">.</span>Content <span class="token operator">=</span> <span class="token string">"重置密码"</span><span class="token punctuation">;</span>
            button<span class="token punctuation">.</span>Click <span class="token operator">+=</span> ResetPassword_Click<span class="token punctuation">;</span>
            button<span class="token punctuation">.</span>Tag <span class="token operator">=</span> conqi<span class="token punctuation">.</span>Tag<span class="token punctuation">;</span>
            conqi<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Button</span> button2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            button2<span class="token punctuation">.</span>Content <span class="token operator">=</span> <span class="token string">"上传电子签名"</span><span class="token punctuation">;</span>
            button2<span class="token punctuation">.</span>Click <span class="token operator">+=</span> BtnImgName_Click<span class="token punctuation">;</span>
            button2<span class="token punctuation">.</span>Tag <span class="token operator">=</span> conqi<span class="token punctuation">.</span>Tag<span class="token punctuation">;</span>
            conqi<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>button2<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Button</span> button3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            button3<span class="token punctuation">.</span>Content <span class="token operator">=</span> <span class="token string">"删除"</span><span class="token punctuation">;</span>
            button3<span class="token punctuation">.</span>Click <span class="token operator">+=</span> del_Click<span class="token punctuation">;</span>
            button3<span class="token punctuation">.</span>Tag <span class="token operator">=</span> conqi<span class="token punctuation">.</span>Tag<span class="token punctuation">;</span>
            conqi<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>button3<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031313531313038362f:61727469636c652f64657461696c732f313436323639333236" class_="artid" style="display:none">
 </p>
</div>


