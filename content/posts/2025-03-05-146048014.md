---
layout: post
title: "SegRNN-源码理解PMF的多步并行预测"
date: 2025-03-05 17:39:57 +0800
description: "用自己的话，593 个样本，随机选择了 16 个，这16 个样本的时间步并不一定是连续的，但是一个 batch 内部封装的 60 个时间步一定是连续的。我又有了一个新的问题，训练集大小是 593 个样本，怎么 batchsize=16，seqlen=60。"
keywords: "【SegRNN 源码理解】PMF的多步并行预测"
categories: ['扒代码']
tags: ['算法']
artid: "146048014"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146048014
    alt: "SegRNN-源码理解PMF的多步并行预测"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146048014
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146048014
cover: https://bing.ee123.net/img/rand?artid=146048014
image: https://bing.ee123.net/img/rand?artid=146048014
img: https://bing.ee123.net/img/rand?artid=146048014
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【SegRNN 源码理解】PMF的多步并行预测
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     位置编码
    </h2>
    <pre><code class="language-python">        elif self.dec_way == "pmf":
            if self.channel_id:
                # m,d//2 -&gt; 1,m,d//2 -&gt; c,m,d//2
                # c,d//2 -&gt; c,1,d//2 -&gt; c,m,d//2
                # c,m,d -&gt; cm,1,d -&gt; bcm, 1, d
                pos_emb = torch.cat([
                    self.pos_emb.unsqueeze(0).repeat(self.enc_in, 1, 1),
                    self.channel_emb.unsqueeze(1).repeat(1, self.seg_num_y, 1)
                ], dim=-1).view(-1, 1, self.d_model).repeat(batch_size,1,1)</code></pre>
    <p>
     <img alt="" height="184" src="https://i-blog.csdnimg.cn/direct/b86a235db12449188d223f6e66079865.png" width="2010"/>
    </p>
    <p>
     <img alt="" height="428" src="https://i-blog.csdnimg.cn/direct/925d09677c664b8e8639bb09287ea3ae.png" width="2004">
      <img alt="" height="1118" src="https://i-blog.csdnimg.cn/direct/053f9cb7506d40a08ae65e8a8020f17c.png" width="2008"/>
     </img>
    </p>
    <p>
     <img alt="" height="970" src="https://i-blog.csdnimg.cn/direct/e53fcf3093974597ac9d8a1b8a8e2c68.png" width="1994"/>
    </p>
    <p>
    </p>
    <pre><code class="language-python">┌─────────────┐              ┌─────────────┐
│  pos_emb    │              │ channel_emb │
│  [2, 256]   │              │  [7, 256]   │
└──────┬──────┘              └──────┬──────┘
       │                            │
       ▼                            ▼
┌─────────────┐              ┌─────────────┐
│ unsqueeze(0)│              │unsqueeze(1) │
│  [1,2,256]  │              │ [7,1,256]   │
└──────┬──────┘              └──────┬──────┘
       │                            │
       ▼                            ▼
┌─────────────┐              ┌─────────────┐
│ repeat      │              │ repeat      │
│ [7,2,256]   │              │ [7,2,256]   │
└──────┬──────┘              └──────┬──────┘
       │                            │
       └────────────┬───────────────┘
                    │
                    ▼
            ┌───────────────┐
            │ concat(dim=-1)│
            │  [7,2,512]    │
            └───────┬───────┘
                    │
                    ▼
            ┌───────────────┐
            │ view(-1,1,512)│
            │  [14,1,512]   │
            └───────┬───────┘
                    │
                    ▼
            ┌───────────────┐
            │ repeat        │
            │ [224,1,512]   │
            └───────┬───────┘
                    │
                    ▼
              最终组合嵌入</code></pre>
    <p>
     <img alt="" height="1182" src="https://i-blog.csdnimg.cn/direct/9ba3ceedd1eb424a943658c2e37ef06c.png" width="1984"/>
    </p>
    <h2>
     理解时间序列数据的训练集、序列长度和批次大小
    </h2>
    <blockquote>
     <p>
      我又有了一个新的问题，训练集大小是 593 个样本，怎么 batchsize=16，seqlen=60
     </p>
    </blockquote>
    <p>
     用自己的话，593 个样本，随机选择了 16 个，这16 个样本的时间步并不一定是连续的，但是一个 batch 内部封装的 60 个时间步一定是连续的
    </p>
    <p>
     <img alt="" height="760" src="https://i-blog.csdnimg.cn/direct/7aa8dbd526d7477d8a37687b8a3040fe.png" width="1994"/>
    </p>
    <p>
     <img alt="" height="594" src="https://i-blog.csdnimg.cn/direct/d11760c233ac4e6b8c6f9b0469b4315e.png" width="2006"/>
    </p>
    <p>
     <img alt="" height="728" src="https://i-blog.csdnimg.cn/direct/8150ea6399134198b182344fbd6c7697.png" width="2020"/>
    </p>
    <p>
     <img alt="" height="910" src="https://i-blog.csdnimg.cn/direct/6b7898c09fda4eacaf64f52e59d5d9e4.png" width="1994"/>
    </p>
    <h3>
     shuffle=True
    </h3>
    <p>
     <img alt="" height="510" src="https://i-blog.csdnimg.cn/direct/76727f33d11b417bb38284add61c5eca.png" width="2008"/>
    </p>
    <p>
     <img alt="" height="604" src="https://i-blog.csdnimg.cn/direct/45f01b5ad6614c6ea9720b6fdcf0647c.png" width="2012"/>
     <img alt="" height="584" src="https://i-blog.csdnimg.cn/direct/ff9827e333204c079e096fbe7665623b.png" width="2024"/>
    </p>
    <p>
     <img alt="" height="1102" src="https://i-blog.csdnimg.cn/direct/5a2f465e092b4dc3952c2d23202dfae5.png" width="2002"/>
     <img alt="" height="392" src="https://i-blog.csdnimg.cn/direct/347436d34fdc4150896e9cdc2719264a.png" width="2004"/>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f37373534393937372f:61727469636c652f64657461696c732f313436303438303134" class_="artid" style="display:none">
 </p>
</div>


