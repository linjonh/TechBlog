---
layout: post
title: "机试题微服务群组"
date: 2025-03-07 15:36:10 +0800
description: "小明为了调研微服务调用情况，对n个微服务调用数据进行了采集分析。微服务使用数字0到n-1进行编号，给定一个数组edges，其中edges[i]表示存在一条从微服务i到微服务edges[i]的接口调用。为了更好地维护，小明将形成环的多个微服务称为。一个微服务群组的所有微服务数量为L，能够访问到该微服务群组的微服务数量为V，这个微服务群组的为H = L - V。已知提供的数据中有1个或多个微服务群组，请按照内聚值H的结果从大到小的顺序对所有微服务群组排序（H。"
keywords: "机试题——微服务群组"
categories: ['Hw']
tags: ['算法', '数据结构', 'C']
artid: "146097123"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146097123
    alt: "机试题微服务群组"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146097123
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146097123
cover: https://bing.ee123.net/img/rand?artid=146097123
image: https://bing.ee123.net/img/rand?artid=146097123
img: https://bing.ee123.net/img/rand?artid=146097123
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     机试题——微服务群组
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     题目描述
    </h2>
    <p>
     小明为了调研微服务调用情况，对
     <code>
      n
     </code>
     个微服务调用数据进行了采集分析。微服务使用数字
     <code>
      0
     </code>
     到
     <code>
      n-1
     </code>
     进行编号，给定一个数组
     <code>
      edges
     </code>
     ，其中
     <code>
      edges[i]
     </code>
     表示存在一条从微服务
     <code>
      i
     </code>
     到微服务
     <code>
      edges[i]
     </code>
     的接口调用。
    </p>
    <p>
     为了更好地维护，小明将形成环的多个微服务称为
     <strong>
      微服务群组
     </strong>
     。一个微服务群组的所有微服务数量为
     <code>
      L
     </code>
     ，能够访问到该微服务群组的微服务数量为
     <code>
      V
     </code>
     ，这个微服务群组的
     <strong>
      内聚值
     </strong>
     为
     <code>
      H = L - V
     </code>
     。
    </p>
    <p>
     已知提供的数据中有1个或多个微服务群组，请按照内聚值
     <code>
      H
     </code>
     的结果从大到小的顺序对所有微服务群组排序（
     <code>
      H
     </code>
     相等时，取环中最大的数进行比较），输出排在第一的微服务群组，输出时每个微服务群组输出的起始编号为环中最小的数。
    </p>
    <h3>
     <a id="_7">
     </a>
     输入描述
    </h3>
    <ol>
     <li>
      第一行：一个整数
      <code>
       n
      </code>
      ，表示有
      <code>
       n
      </code>
      个微服务（
      <code>
       2 ≤ n ≤ 10^5
      </code>
      ）。
     </li>
     <li>
      第二行：数组
      <code>
       edges
      </code>
      ，其中
      <code>
       edges[i]
      </code>
      表示存在一条从微服务
      <code>
       i
      </code>
      到微服务
      <code>
       edges[i]
      </code>
      的接口调用（
      <code>
       0 ≤ edges[i] ≤ n-1
      </code>
      ，
      <code>
       edges[i] ≠ i
      </code>
      ）。
     </li>
    </ol>
    <h3>
     <a id="_11">
     </a>
     输出描述
    </h3>
    <p>
     输出排在第一的微服务群组的编号数组，按照环的访问顺序输出，起始编号为环中最小的数，数字以空格分隔。
    </p>
    <h3>
     <a id="_14">
     </a>
     用例输入
    </h3>
    <pre><code class="prism language-bash"><span class="token number">4</span>
<span class="token number">3</span> <span class="token number">3</span> <span class="token number">0</span> <span class="token number">2</span>
</code></pre>
    <pre><code class="prism language-bash"><span class="token number">0</span> <span class="token number">3</span> <span class="token number">2</span>
</code></pre>
    <p>
     <code>
      0
     </code>
     ，
     <code>
      3
     </code>
     ，
     <code>
      2
     </code>
     组成了微服务群组（环）
     <code>
      a
     </code>
     ，其
     <code>
      L
     </code>
     值为
     <code>
      3
     </code>
     ，只有编号为
     <code>
      1
     </code>
     的一个微服务可以访问到
     <code>
      a
     </code>
     ，因此
     <code>
      V
     </code>
     值为
     <code>
      1
     </code>
     ，内聚值
     <code>
      H = L - V = 2
     </code>
     。
    </p>
    <pre><code class="prism language-bash"><span class="token number">12</span>
<span class="token number">2</span> <span class="token number">6</span> <span class="token number">10</span> <span class="token number">1</span> <span class="token number">6</span> <span class="token number">0</span> <span class="token number">3</span> <span class="token number">0</span> <span class="token number">5</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">8</span>
</code></pre>
    <pre><code class="prism language-bash"><span class="token number">0</span> <span class="token number">2</span> <span class="token number">10</span> <span class="token number">5</span>
</code></pre>
    <p>
     <code>
      1
     </code>
     ，
     <code>
      6
     </code>
     ，
     <code>
      3
     </code>
     组成了微服务群组（环）
     <code>
      a1
     </code>
     ，
     <code>
      L1
     </code>
     值为
     <code>
      3
     </code>
     ，编号为
     <code>
      4
     </code>
     、
     <code>
      9
     </code>
     的
     <code>
      2
     </code>
     个微服务可以访问到
     <code>
      a1
     </code>
     ，因此
     <code>
      V1
     </code>
     值为
     <code>
      2
     </code>
     ，
     <code>
      H1 = L1 - V1 = 1
     </code>
     。
     <br/>
     <code>
      0
     </code>
     ，
     <code>
      2
     </code>
     ，
     <code>
      10
     </code>
     ，
     <code>
      5
     </code>
     组成了微服务群组（环）
     <code>
      a2
     </code>
     ，
     <code>
      L2
     </code>
     值为
     <code>
      4
     </code>
     ，编号为
     <code>
      7
     </code>
     、
     <code>
      8
     </code>
     、
     <code>
      11
     </code>
     的
     <code>
      3
     </code>
     个微服务可以访问到
     <code>
      a2
     </code>
     ，因此
     <code>
      V2
     </code>
     值为
     <code>
      3
     </code>
     ，
     <code>
      H2 = L2 - V2 = 1
     </code>
     。
     <br/>
     内聚值
     <code>
      H1 = H2
     </code>
     ，但
     <code>
      a2
     </code>
     中最大编号为
     <code>
      10
     </code>
     ，大于
     <code>
      a1
     </code>
     中的最大编号
     <code>
      6
     </code>
     ，因此输出
     <code>
      a2
     </code>
     。
    </p>
    <h2>
     <a id="65_40">
     </a>
     解题思路（65%）
    </h2>
    <ol>
     <li>
      <p>
       <strong>
        问题建模
       </strong>
       ：
      </p>
      <ul>
       <li>
        该问题可以看作是一个
        <strong>
         图论问题
        </strong>
        ，目标是找到所有微服务群组（环）并计算其内聚值
        <code>
         H
        </code>
        。
       </li>
       <li>
        使用深度优先搜索（DFS）找到所有环，并记录每个环的访问顺序。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        数据结构
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用
        <code>
         unordered_map&lt;int, int&gt;
        </code>
        存储图的边关系。
       </li>
       <li>
        使用
        <code>
         vector&lt;node&gt;
        </code>
        存储所有微服务群组，其中
        <code>
         node
        </code>
        结构体包含：
        <ul>
         <li>
          <code>
           w
          </code>
          ：环中的微服务编号。
         </li>
         <li>
          <code>
           v
          </code>
          ：可以访问该环的微服务数量。
         </li>
         <li>
          <code>
           maxid
          </code>
          ：环中编号最大的微服务。
         </li>
         <li>
          <code>
           size
          </code>
          ：环的大小。
         </li>
        </ul>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        DFS遍历
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用DFS找到所有环，并记录每个环的访问顺序。
       </li>
       <li>
        使用状态数组
        <code>
         states
        </code>
        记录每个节点的访问状态：
        <ul>
         <li>
          <code>
           0
          </code>
          ：未访问。
         </li>
         <li>
          <code>
           1
          </code>
          ：已完全访问。
         </li>
         <li>
          <code>
           2
          </code>
          ：正在访问（用于检测环）。
         </li>
        </ul>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        计算内聚值
       </strong>
       ：
      </p>
      <ul>
       <li>
        对于每个环，计算其内聚值
        <code>
         H = L - V
        </code>
        。
       </li>
       <li>
        计算每个环的
        <code>
         V
        </code>
        值，即可以访问该环的微服务数量。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        排序
       </strong>
       ：
      </p>
      <ul>
       <li>
        按内聚值
        <code>
         H
        </code>
        从大到小排序。
       </li>
       <li>
        如果
        <code>
         H
        </code>
        值相同，按环中最大编号从大到小排序。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        输出结果
       </strong>
       ：
      </p>
      <ul>
       <li>
        输出排在第一的微服务群组，起始编号为环中最小的数。
       </li>
      </ul>
     </li>
    </ol>
    <blockquote>
     <p>
      100%需要使用Tarjan 算法
     </p>
    </blockquote>
    <h2>
     <a id="65_73">
     </a>
     代码（65%）
    </h2>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;cstdio&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;cstring&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;cmath&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;map&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;algorithm&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unordered_map&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unordered_set&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;queue&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;set&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;list&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;bitset&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stack&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;climits&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iomanip&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;cstdint&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">// 用于存储图的边关系</span>
unordered_map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span> mp<span class="token punctuation">;</span>

<span class="token comment">// 定义微服务群组的结构体</span>
<span class="token keyword">struct</span> <span class="token class-name">node</span> <span class="token punctuation">{<!-- --></span>
    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> w<span class="token punctuation">;</span> <span class="token comment">// 微服务的环</span>
    <span class="token keyword">int</span> v<span class="token punctuation">;</span> <span class="token comment">// 其他微服务可访问数量</span>
    <span class="token keyword">int</span> maxid<span class="token punctuation">;</span> <span class="token comment">// 环中编号最大的节点</span>
    <span class="token keyword">int</span> size<span class="token punctuation">;</span> <span class="token comment">// 环的大小</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 临时遍历的栈，用于记录DFS路径</span>
vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> temp<span class="token punctuation">;</span>

<span class="token comment">// 存储所有微服务群组</span>
vector<span class="token operator">&lt;</span>node<span class="token operator">&gt;</span> res<span class="token punctuation">;</span>

<span class="token comment">// 状态表，记录每个节点的访问状态</span>
unordered_map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span> states<span class="token punctuation">;</span>

<span class="token comment">// 状态定义：</span>
<span class="token comment">// 0 - 未遍历</span>
<span class="token comment">// 1 - 已完全遍历</span>
<span class="token comment">// 2 - 正在遍历（用于检测环）</span>
<span class="token keyword">void</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> cur<span class="token punctuation">,</span> unordered_map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> states<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>states<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 如果当前节点已完全遍历，直接返回</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>states<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 如果当前节点正在遍历中，说明遇到了环</span>
        node tres<span class="token punctuation">;</span>
        <span class="token keyword">auto</span> index <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>temp<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> temp<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cur<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 找到环的起始位置</span>
        tres<span class="token punctuation">.</span>w <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>index <span class="token operator">!=</span> temp<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            tres<span class="token punctuation">.</span>w<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token operator">*</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将环中的节点加入到当前群组</span>
            index<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        tres<span class="token punctuation">.</span>maxid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 初始化环中最大编号</span>
        tres<span class="token punctuation">.</span>v <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 初始化可访问数量</span>
        res<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>tres<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将当前群组加入到结果中</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    temp<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将当前节点加入到临时路径</span>
    states<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 标记当前节点为正在遍历</span>
    <span class="token function">dfs</span><span class="token punctuation">(</span>mp<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">,</span> states<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 递归访问下一个节点</span>
    temp<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 回溯，移除当前节点</span>
    states<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 标记当前节点为已完全遍历</span>
<span class="token punctuation">}</span>

<span class="token comment">// 从最小的节点开始遍历环，确保环的输出顺序正确</span>
<span class="token keyword">void</span> <span class="token function">find_w</span><span class="token punctuation">(</span><span class="token keyword">int</span> root<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> temp<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>temp<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> temp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> root<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 如果已经遍历到根节点，结束</span>
    temp<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将当前节点加入到路径</span>
    <span class="token function">find_w</span><span class="token punctuation">(</span>mp<span class="token punctuation">[</span>root<span class="token punctuation">]</span><span class="token punctuation">,</span> temp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 递归访问下一个节点</span>
<span class="token punctuation">}</span>

<span class="token comment">// 比较函数，用于排序</span>
<span class="token keyword">bool</span> <span class="token function">cmp</span><span class="token punctuation">(</span>node<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> node<span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>size <span class="token operator">-</span> a<span class="token punctuation">.</span>v<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>b<span class="token punctuation">.</span>size <span class="token operator">-</span> b<span class="token punctuation">.</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 如果内聚值不同，按内聚值从大到小排序</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>size <span class="token operator">-</span> a<span class="token punctuation">.</span>v<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span>b<span class="token punctuation">.</span>size <span class="token operator">-</span> b<span class="token punctuation">.</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 如果内聚值相同，按环中最大编号从大到小排序</span>
    <span class="token keyword">return</span> a<span class="token punctuation">.</span>maxid <span class="token operator">&gt;</span> b<span class="token punctuation">.</span>maxid<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    ios<span class="token double-colon punctuation">::</span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> n<span class="token punctuation">;</span>
    cin <span class="token operator">&gt;&gt;</span> n<span class="token punctuation">;</span> <span class="token comment">// 输入微服务的数量</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> x<span class="token punctuation">;</span>
        cin <span class="token operator">&gt;&gt;</span> x<span class="token punctuation">;</span> <span class="token comment">// 输入每个微服务的调用关系</span>
        mp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token comment">// 构建图</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 从每个节点开始DFS，确保找到所有环</span>
        <span class="token function">dfs</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> states<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 初始化每个节点的群组标记</span>
    unordered_map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span> is<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> is<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> res<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> minnid <span class="token operator">=</span> INT_MAX<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>maxid <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>maxid<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 更新环中最大编号</span>
            minnid <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> minnid<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 更新环中最小编号</span>
            is<span class="token punctuation">[</span>res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span> <span class="token comment">// 标记当前节点属于哪个群组</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 从环中最小的节点开始重新遍历环，确保输出顺序正确</span>
        res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">find_w</span><span class="token punctuation">(</span>minnid<span class="token punctuation">,</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>size <span class="token operator">=</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 更新环的大小</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 计算每个群组的可访问数量</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 如果当前节点不属于任何群组，检查它可以访问的群组</span>
            <span class="token keyword">int</span> ne <span class="token operator">=</span> mp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>is<span class="token punctuation">[</span>ne<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                ne <span class="token operator">=</span> mp<span class="token punctuation">[</span>ne<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 沿着调用链找到属于某个群组的节点</span>
            <span class="token punctuation">}</span>
            res<span class="token punctuation">[</span>is<span class="token punctuation">[</span>ne<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// 增加群组的可访问数量</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 按内聚值和环中最大编号排序</span>
    <span class="token function">sort</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 输出排在第一的微服务群组</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34353630353334312f:61727469636c652f64657461696c732f313436303937313233" class_="artid" style="display:none">
 </p>
</div>


