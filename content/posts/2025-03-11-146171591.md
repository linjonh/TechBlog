---
layout: post
title: "gitlab备份到SVN之变更备份服务器"
date: 2025-03-11 14:18:05 +0800
description: "gitlab上代码，先下载下来后又上传到SVN，因原备份机器和gitlab服务器是用一个机器，导致这个服务器内存越来越大，为了防止以后爆了，新建了一个服务器，想将后续的备份迁移过去，特此做个记录"
keywords: "gitlab备份到SVN之变更备份服务器"
categories: ['Svn', 'Gitlabci', 'Crontab']
tags: ['服务器', 'Svn', 'Gitlab']
artid: "146171591"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146171591
    alt: "gitlab备份到SVN之变更备份服务器"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146171591
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146171591
cover: https://bing.ee123.net/img/rand?artid=146171591
image: https://bing.ee123.net/img/rand?artid=146171591
img: https://bing.ee123.net/img/rand?artid=146171591
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     gitlab备份到SVN之变更备份服务器
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     gitlab上代码，先下载下来后又上传到SVN，因原备份机器和gitlab服务器是用一个机器，导致这个服务器内存越来越大，为了防止以后爆了，新建了一个服务器，想将后续的备份迁移过去，特此做个记录，看看会不会出现什么问题，记录一下解决办法，以防哪天忘记了。
    </p>
    <p>
     登录了新的机器，本想在跟原先服务器相同的位置将SVN上备份代码拷贝下来，但是发现，新的服务器没有安装SVN，头大。
    </p>
    <h2>
     <strong>
      配置yum源
     </strong>
    </h2>
    <p>
     首先让IT开了外网权限后，
     <strong>
      配置yum源
     </strong>
     <br/>
     一、进入/etc/yum.repos.d 查看目录下文件，进行备份，将所有文件备份到新建目录repo_bak下
    </p>
    <pre><code class="hljs">cd /etc/yum.repos.d
ll
mkdir repo_bak
mv *.repo repo_bak/
ll
</code></pre>
    <p>
     <img alt="" height="201" src="https://i-blog.csdnimg.cn/direct/7d23fc7e07e64c34a99b0215b05470b4.png" width="543"/>
    </p>
    <p>
     <img alt="" height="63" src="https://i-blog.csdnimg.cn/direct/85d69275f8bb4c23b78204dee1ac4a21.png" width="398"/>
    </p>
    <p>
     二、下载阿里的CentOS-Base.repo 到/etc/yum.repos.d/
     <br/>
    </p>
    <pre><code class="hljs">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
</code></pre>
    <p>
     <img alt="" height="264" src="https://i-blog.csdnimg.cn/direct/ec6fd1f5a74b4a6eb2ffba6fe4326e19.png" width="966">
      三、运行yum clean all 清除缓存，运行 yum makecache 生成新的缓存
     </img>
    </p>
    <pre><code class="hljs">yum clean all
yum makecache</code></pre>
    <p>
     <img alt="" height="798" src="https://i-blog.csdnimg.cn/direct/911c47674a1e4450a6e73bb06c91f558.png" width="1016"/>
    </p>
    <p>
     不知道为啥那么多FAILD，看不懂。换个方式下载，再清理和生成缓存试试。
    </p>
    <pre><code class="hljs">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</code></pre>
    <p>
     <img alt="" height="502" src="https://i-blog.csdnimg.cn/direct/d402dbc28afd424f9ce1758f3d6e2505.png" width="1006">
      检查仓库是否启用，现存可用仓库列表
     </img>
    </p>
    <pre><code class="hljs">yum repolist enabled
yum repolist all</code></pre>
    <p>
     <img alt="" height="357" src="https://i-blog.csdnimg.cn/direct/fbdc4ce970274fc49740e3555b890e5a.png" width="1009"/>
    </p>
    <p>
     四、下载测试
    </p>
    <h2>
     安装git和SVN
    </h2>
    <pre><code class="hljs">yum install git</code></pre>
    <p>
     <img alt="" height="174" src="https://i-blog.csdnimg.cn/direct/2d19a34d7b6b4f709821051fba42baaa.png" width="761"/>
    </p>
    <p>
     <img alt="" height="620" src="https://i-blog.csdnimg.cn/direct/77abceb8717044aeabb98a9e22816114.png" width="1007">
      <img alt="" height="717" src="https://i-blog.csdnimg.cn/direct/fee924ea413d46b5b347c1ccb17609c7.png" width="1004"/>
     </img>
    </p>
    <h2>
     <img alt="" height="688" src="https://i-blog.csdnimg.cn/direct/93bf73048eec497c853f0b5764360ee5.png" width="1012">
      下载原服务器内容
     </img>
    </h2>
    <p>
     安装git和SVN后，下载原SVN服务器上内容：
    </p>
    <p>
     创建了和原备份服务器相同的文件结构，但是原服务器已经设置过了自动备份，我担心同一个目录容易出问题，遂决定换一个新的环境，重新配置一遍全流程，这样后续新增项目就在新的服务器。线下表格里记录好位置，应该省事些。
    </p>
    <p>
     /code/svn/Atlas-code/代码-新库
     <br/>
    </p>
    <pre><code class="hljs">#!/bin/bash

ProjectAddress=172.16.67.163:8083/REAL3D/ZhangZhouProject/ZhangZhouAncientCityWebUI.git

ProjectName=ZhangZhouAncientCityWebUI



cd /code/git

git clone http://root:Geoway123@$ProjectAddress

cp -a /code/git/$ProjectName/.  /code/svn/Atlas-code/代码-新库/REAL3D/ZhangZhouProject/$ProjectName


cd /code/svn/Atlas-code/代码-新库

sudo svn cleanup

svn add *
sudo svn cleanup
sudo svn commit -m 'update' --username gitlab --password gitlab --no-auth-cache
</code></pre>
    <p>
     <img alt="" height="257" src="https://i-blog.csdnimg.cn/direct/d08b208c804e47b7bdea4457260f4455.png" width="700"/>
    </p>
    <h2>
     创建每日自动同步脚本
    </h2>
    <p>
     记录一个快捷键，vim中，G可以直接定位到文件的最后一行，跳转到文件的第一行.
     <br/>
    </p>
    <pre><code class="hljs">#!/bin/bash

cd /code/git/ZhangZhouAncientCityWebUI
git pull
cp -a /code/git/ZhangZhouAncientCityWebUI/. /code/svn/Atlas-code/代码-新库/REAL3D/ZhangZhouProject/ZhangZhouAncientCityWebUI


cd  /code/svn/Atlas-code/代码-新库


svn update --username gitlab --password gitlab --no-auth-cache
sudo svn cleanup
sudo svn commit -m 'update every code' --username gitlab --password gitlab --no-auth-cache

svn status

sudo svn add $(svn status)

sudo svn commit -m 'update every code' --username gitlab --password gitlab --no-auth-cache

</code></pre>
    <p>
     chmod +x backupcodeeveryday-newku.sh
     <br/>
     使用crontab将自动同步，加入到服务器定时计划中。 使用crontab，我得翻翻以前的记录
     <br/>
     <a class="link-info" href="https://blog.csdn.net/xiaodaiwang/article/details/53079999?spm=1001.2014.3001.5501" title="crontab定时执行命令">
      crontab定时执行命令
     </a>
    </p>
    <p>
    </p>
    <p>
     <img alt="" height="53" src="https://i-blog.csdnimg.cn/direct/1174416d639c4b14a010a4e94b7d540c.png" width="462"/>
    </p>
    <p>
     明天检查下是否自动备份。
     <br/>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f7869616f64616977616e672f:61727469636c652f64657461696c732f313436313731353931" class_="artid" style="display:none">
 </p>
</div>


