---
layout: post
title: "åå››Golang-æ¥å£"
date: 2025-03-10 20:36:11 +0800
description: "æ¥å£æ˜¯ä¸€ç§æŠ½è±¡çš„æ•°æ®ç±»å‹ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„æ–¹æ³•æˆ–è¡Œä¸ºçš„è§„èŒƒï¼Œä½†ä¸æä¾›å…·ä½“å®ç°"
keywords: "ã€åå››ã€‘Golang æ¥å£"
categories: ['Golang']
tags: ['å¼€å‘è¯­è¨€', 'åç«¯', 'Golang']
artid: "146161916"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146161916
    alt: "åå››Golang-æ¥å£"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146161916
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146161916
cover: https://bing.ee123.net/img/rand?artid=146161916
image: https://bing.ee123.net/img/rand?artid=146161916
img: https://bing.ee123.net/img/rand?artid=146161916
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ã€åå››ã€‘Golang æ¥å£
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <blockquote>
     <p>
      ğŸ’¢æ¬¢è¿æ¥åˆ°å¼ èƒ¤å°˜çš„å¼€æºæŠ€æœ¯ç«™
      <br/>
      ğŸ’¥å¼€æºå¦‚æ±Ÿæ²³ï¼Œæ±‡èšä¼—å¿—æˆã€‚ä»£ç ä¼¼æ˜Ÿè¾°ï¼Œç…§äº®è¡Œå¾ç¨‹ã€‚å¼€æºç²¾ç¥é•¿ï¼Œä¼ æ‰¿æ°¸ä¸å¿˜ã€‚æºæ‰‹å…±å‰è¡Œï¼Œæœªæ¥æ›´è¾‰ç…ŒğŸ’¥
     </p>
    </blockquote>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="_5">
     </a>
     æ¥å£
    </h2>
    <p>
     <strong>
      æ¥å£æ˜¯ä¸€ç§æŠ½è±¡çš„æ•°æ®ç±»å‹ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„æ–¹æ³•æˆ–è¡Œä¸ºçš„è§„èŒƒï¼Œä½†ä¸æä¾›å…·ä½“å®ç°
     </strong>
     ã€‚åœ¨
     <code>
      golang
     </code>
     ä¸­æ¥å£çš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼š
     <strong>
      è§£è€¦åˆ
     </strong>
     å’Œ
     <strong>
      å¤šæ€
     </strong>
     ã€‚
    </p>
    <ul>
     <li>
      <p>
       <strong>
        è§£è€¦åˆ
       </strong>
       ï¼šå‡å°‘æ¨¡å—ä¹‹é—´çš„ç›´æ¥ä¾èµ–å…³ç³»ï¼Œä½¿å¾—æ¨¡å—ä¹‹é—´çš„ä¿®æ”¹ä¸ä¼šç›¸äº’å½±å“ã€‚å¦å¤–ï¼Œé€šè¿‡æ¥å£è°ƒç”¨è€…åªéœ€è¦çŸ¥é“æ¥å£çš„è§„èŒƒï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…·ä½“çš„å®ç°ç»†èŠ‚ã€‚å®ç°è€…å¯ä»¥éšæ—¶æ›¿æ¢ï¼Œåªè¦æ»¡è¶³æ¥å£è§„èŒƒå³å¯ã€‚
      </p>
     </li>
     <li>
      <p>
       <strong>
        å¤šæ€
       </strong>
       ï¼šå¤šæ€æ˜¯æŒ‡åŒä¸€ä¸ªæ¥å£å¯ä»¥è¢«ä¸åŒçš„å®ç°ç±»ä½¿ç”¨ï¼Œè°ƒç”¨è€…åœ¨è¿è¡Œæ—¶å¯ä»¥æ ¹æ®å…·ä½“å®ç°è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚æ¥å£å…è®¸ä¸åŒçš„å®ç°ç±»æä¾›ä¸åŒçš„è¡Œä¸ºï¼Œä½†è°ƒç”¨è€…å¯ä»¥é€šè¿‡ç»Ÿä¸€çš„æ¥å£è¿›è¡Œæ“ä½œã€‚
      </p>
     </li>
    </ul>
    <h3>
     <a id="_13">
     </a>
     æ¥å£å®šä¹‰
    </h3>
    <p>
     åœ¨
     <code>
      golang
     </code>
     ä¸­ï¼Œæ¥å£é€šè¿‡
     <code>
      type
     </code>
     å…³é”®å­—å’Œ
     <code>
      interface
     </code>
     å…³é”®å­—å®šä¹‰ã€‚è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">type</span> InterfaceName <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">Method1</span><span class="token punctuation">(</span>paramType1<span class="token punctuation">)</span> returnType1
    <span class="token function">Method2</span><span class="token punctuation">(</span>paramType2<span class="token punctuation">)</span> returnType2
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     ä¾‹å¦‚ï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">type</span> Shape <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">float64</span>
    <span class="token function">Perimeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">float64</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     åœ¨ä¸Šé¢ä»£ç ä¸­ï¼Œ
     <code>
      Shape
     </code>
     æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒå®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼š
     <code>
      Area()
     </code>
     å’Œ
     <code>
      Perimeter()
     </code>
     ã€‚
     <strong>
      åªè¦æ˜¯ä»»ä½•å®ç°äº†è¿™ä¸¤ä¸ªæ–¹æ³•çš„ç±»å‹éƒ½è‡ªåŠ¨å®ç°äº†
      <code>
       Shape
      </code>
      æ¥å£
     </strong>
     ã€‚
    </p>
    <p>
     ä¸‹é¢æœ‰ä¸€ä¸ª
     <code>
      Circle
     </code>
     ç±»ï¼Œå®ç°äº†
     <code>
      Area()
     </code>
     å’Œ
     <code>
      Perimeter()
     </code>
     ä¸¤ä¸ªæ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">type</span> Circle <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    Radius <span class="token builtin">float64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c Circle<span class="token punctuation">)</span> <span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> math<span class="token punctuation">.</span>Pi <span class="token operator">*</span> c<span class="token punctuation">.</span>Radius <span class="token operator">*</span> c<span class="token punctuation">.</span>Radius
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c Circle<span class="token punctuation">)</span> <span class="token function">Perimeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>Pi <span class="token operator">*</span> c<span class="token punctuation">.</span>Radius
<span class="token punctuation">}</span>
</code></pre>
    <p>
     ä»ä»£ç ä¸­å¯çŸ¥
     <code>
      Circle
     </code>
     ç±»å‹å®ç°äº†
     <code>
      Shape
     </code>
     æ¥å£ä¸­çš„
     <code>
      Area()
     </code>
     å’Œ
     <code>
      Perimeter()
     </code>
     æ–¹æ³•ï¼Œå®ƒè‡ªåŠ¨æ»¡è¶³äº†
     <code>
      Shape
     </code>
     æ¥å£çš„è¦æ±‚ã€‚
    </p>
    <h3>
     <a id="_54">
     </a>
     æ¥å£åˆå§‹åŒ–
    </h3>
    <p>
     æ¥å£çš„åˆå§‹åŒ–å¹¶ä¸æ˜¯ç›´æ¥åˆå§‹åŒ–æ¥å£æœ¬èº«ï¼Œè€Œæ˜¯é€šè¿‡åˆå§‹åŒ–å®ç°äº†æ¥å£çš„ç±»å‹æ¥é—´æ¥å®Œæˆçš„ã€‚
     <strong>
      å¦‚æœæ¥å£åˆå§‹åŒ–æ—¶å¹¶æ²¡æœ‰æŒ‡å®šå…·ä½“çš„å®ç°ç±»ï¼Œåˆ™æ¥å£é»˜è®¤æ˜¯é›¶å€¼
      <code>
       nil
      </code>
      ï¼Œè¡¨ç¤ºå®ƒæ²¡æœ‰æŒ‡å‘ä»»ä½•å…·ä½“çš„ç±»å‹æˆ–å€¼
     </strong>
     ã€‚å¦‚æœæ¥å£å˜é‡ä¸º
     <code>
      nil
     </code>
     ï¼Œè°ƒç”¨å…¶æ–¹æ³•ä¼šå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">type</span> Shape <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">float64</span>
	<span class="token function">Perimeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">float64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> s Shape <span class="token operator">=</span> <span class="token boolean">nil</span>
	s<span class="token punctuation">.</span><span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// invalid memory address or nil pointer dereference</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     åˆ™éœ€è¦ä¸ºå…¶æŒ‡å®šæ­£ç¡®çš„å®ç°ç±»æ¥å®Œæˆåˆå§‹åŒ–è¡Œä¸ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"math"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Shape <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">float64</span>
	<span class="token function">Perimeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">float64</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Circle <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Radius <span class="token builtin">float64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c Circle<span class="token punctuation">)</span> <span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> math<span class="token punctuation">.</span>Pi <span class="token operator">*</span> c<span class="token punctuation">.</span>Radius <span class="token operator">*</span> c<span class="token punctuation">.</span>Radius
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c Circle<span class="token punctuation">)</span> <span class="token function">Perimeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>Pi <span class="token operator">*</span> c<span class="token punctuation">.</span>Radius
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> shape Shape
	shape <span class="token operator">=</span> Circle<span class="token punctuation">{<!-- --></span>Radius<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span> <span class="token comment">// åˆå§‹åŒ–</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>shape<span class="token punctuation">.</span><span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 12.566370614359172</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     ä¸Šè¿°ä»£ç ä¸­ï¼Œ
     <code>
      shape
     </code>
     æ˜¯ä¸€ä¸ª
     <code>
      Shape
     </code>
     æ¥å£å˜é‡ã€‚é€šè¿‡å°†
     <code>
      Circle
     </code>
     ç±»å‹çš„å®ä¾‹èµ‹å€¼ç»™å®ƒï¼Œæ¥å£å˜é‡å°±åˆå§‹åŒ–å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥é€šè¿‡
     <code>
      shape
     </code>
     è°ƒç”¨äº†
     <code>
      Area
     </code>
     æ–¹æ³•æ¥æ‰“å°å‡ºä¸€ä¸ªåŠå¾„ä¸º 2 çš„
     <code>
      Circle
     </code>
     çš„é¢ç§¯ã€‚
    </p>
    <h3>
     <a id="_108">
     </a>
     æ¥å£åµŒå¥—
    </h3>
    <p>
     æ¥å£çš„åµŒå¥—ä¸»è¦ä½“ç°åœ¨æ¥å£ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ï¼Œå³ä¸€ä¸ªæ¥å£å¯ä»¥åµŒå¥—å¦ä¸€ä¸ªæ¥å£ã€‚è¿™ç§åµŒå¥—å…³ç³»å¯ä»¥è®©æ¥å£ç»§æ‰¿å…¶ä»–æ¥å£çš„æ–¹æ³•é›†åˆï¼Œä»è€Œå®ç°æ›´çµæ´»çš„æ¥å£è®¾è®¡ã€‚
    </p>
    <p>
     å®šä¹‰ä¸€ä¸ªæ¥å£
     <code>
      Reader
     </code>
     ï¼Œåœ¨æ¥å£ä¸­å®šä¹‰äº†ä¸€ä¸ª
     <code>
      Read
     </code>
     æ–¹æ³•ï¼Œç”¨äºä»æŸä¸ªæ•°æ®æºè¯»å–æ•°æ®åˆ°ä¸€ä¸ªå­—èŠ‚åˆ‡ç‰‡
     <code>
      p
     </code>
     ä¸­ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">type</span> Reader <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">Read</span><span class="token punctuation">(</span>p <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     å®šä¹‰ä¸€ä¸ªæ¥å£
     <code>
      Writer
     </code>
     ï¼Œåœ¨æ¥å£ä¸­å®šä¹‰äº†ä¸€ä¸ª
     <code>
      Write
     </code>
     æ–¹æ³•ï¼Œç”¨äºå°†å­—èŠ‚åˆ‡ç‰‡
     <code>
      p
     </code>
     ä¸­çš„æ•°æ®å†™å…¥æŸä¸ªç›®æ ‡ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">type</span> Writer <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">Write</span><span class="token punctuation">(</span>p <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     å®šä¹‰ä¸€ä¸ªæ¥å£
     <code>
      ReadWriter
     </code>
     ï¼Œé€šè¿‡åµŒå¥—
     <code>
      Reader
     </code>
     å’Œ
     <code>
      Writer
     </code>
     ï¼Œå®ƒç»§æ‰¿äº†è¿™ä¸¤ä¸ªæ¥å£çš„æ‰€æœ‰æ–¹æ³•ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">type</span> ReadWriter <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
    Reader
    Writer
<span class="token punctuation">}</span>
</code></pre>
    <p>
     ç”±äº
     <code>
      ReadWriter
     </code>
     ç»§æ‰¿äº†
     <code>
      Reader
     </code>
     å’Œ
     <code>
      Writer
     </code>
     ä¸¤ä¸ªæ¥å£ï¼Œæ‰€ä»¥å®ç°
     <code>
      ReadWriter
     </code>
     æ¥å£ä¹ŸåŒæ ·éœ€è¦å®ç°è¿™ä¸¤ä¸ªæ¥å£ä¸­çš„æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">type</span> MyReadWriter <span class="token keyword">struct</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>MyReadWriter<span class="token punctuation">)</span> <span class="token function">Read</span><span class="token punctuation">(</span>p <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"MyReadWriter Read~~ %c\n"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>MyReadWriter<span class="token punctuation">)</span> <span class="token function">Write</span><span class="token punctuation">(</span>p <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"MyReadWriter Write~~ %c\n"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     æœ€åé€šè¿‡
     <code>
      main
     </code>
     å‡½æ•°è¿›è¡Œæµ‹è¯•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> rw ReadWriter
	rw <span class="token operator">=</span> <span class="token operator">&amp;</span>MyReadWriter<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

	rw<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"hello world~ ycz"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// MyReadWriter Read~~ [h e l l o   w o r l d ~   y c z]</span>
	rw<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"hello world~ ycz"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// MyReadWriter Write~~ [h e l l o   w o r l d ~   y c z]</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     é€šè¿‡æ¥å£åµŒå¥—ï¼Œå¯ä»¥å°†æ¥å£çš„åŠŸèƒ½è¿›è¡Œæ¨¡å—åŒ–è®¾è®¡ï¼Œä»è€Œå®ç°åŠŸèƒ½çš„ç»„åˆå’Œæ‰©å±•ï¼Œä¹Ÿå¯ä»¥é¿å…åœ¨æ¯ä¸ªæ¥å£ä¸­é‡å¤å®šä¹‰ç›¸åŒçš„æ–¹æ³•ã€‚
    </p>
    <h3>
     <a id="_167">
     </a>
     ç©ºæ¥å£
    </h3>
    <p>
     ç©ºæ¥å£æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ¥å£ç±»å‹ï¼Œå®ƒä¸åŒ…å«ä»»ä½•æ–¹æ³•ã€‚ç”±äºå®ƒæ²¡æœ‰ä»»ä½•æ–¹æ³•çº¦æŸï¼Œå› æ­¤å¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„å€¼ã€‚å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">var</span> v <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre>
    <p>
     ä¸Šè¿°ä»£ç ä¸­çš„
     <code>
      v
     </code>
     æ˜¯ä¸€ä¸ªç©ºæ¥å£å˜é‡ï¼Œå®ƒå¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„å€¼ã€‚
    </p>
    <p>
     åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¼šç»å¸¸ä½¿ç”¨åˆ°ç©ºæ¥å£ï¼Œä¾‹å¦‚ï¼š
     <strong>
      å­˜å‚¨ä»»æ„ç±»å‹çš„æ•°æ®
     </strong>
     ã€
     <strong>
      ä½œä¸ºå‡½æ•°å‚æ•°
     </strong>
     ã€
     <strong>
      ç±»å‹æ–­è¨€å’Œç±»å‹åˆ‡æ¢
     </strong>
     ã€‚
    </p>
    <h4>
     <a id="_179">
     </a>
     å­˜å‚¨ä»»æ„ç±»å‹çš„æ•°æ®
    </h4>
    <p>
     ç©ºæ¥å£å¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„å€¼ï¼ŒåŒ…æ‹¬åŸºæœ¬ç±»å‹ï¼ˆå¦‚
     <code>
      int
     </code>
     ã€
     <code>
      string
     </code>
     ï¼‰ã€è‡ªå®šä¹‰ç±»å‹ï¼ˆå¦‚ç»“æ„ä½“ã€åˆ‡ç‰‡ã€æ˜ å°„ç­‰ï¼‰ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> v <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

	v <span class="token operator">=</span> <span class="token number">42</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">// 42</span>

	v <span class="token operator">=</span> <span class="token string">"zyc"</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">// zyc</span>

	v <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">// [1 2 3]</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_202">
     </a>
     ä½œä¸ºå‡½æ•°å‚æ•°
    </h4>
    <p>
     ç©ºæ¥å£å¸¸ç”¨äºå‡½æ•°å‚æ•°ï¼Œä½¿å‡½æ•°èƒ½å¤Ÿæ¥å—ä»»ä½•ç±»å‹çš„å€¼ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">PrintValue</span><span class="token punctuation">(</span>v <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">PrintValue</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>             <span class="token comment">// 10</span>
	<span class="token function">PrintValue</span><span class="token punctuation">(</span><span class="token string">"zzzzzzz"</span><span class="token punctuation">)</span>      <span class="token comment">// zzzzzzz</span>
	<span class="token function">PrintValue</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// [1 2 3]</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_222">
     </a>
     ç±»å‹æ–­è¨€å’Œç±»å‹åˆ‡æ¢
    </h4>
    <p>
     ç”±äºç©ºæ¥å£å­˜å‚¨çš„å€¼ç±»å‹ä¸æ˜ç¡®ï¼Œé€šå¸¸éœ€è¦é€šè¿‡
     <strong>
      ç±»å‹æ–­è¨€
     </strong>
     æˆ–
     <strong>
      ç±»å‹åˆ‡æ¢
     </strong>
     æ¥è·å–å…¶å®é™…ç±»å‹ã€‚
    </p>
    <h5>
     <a id="_226">
     </a>
     ç±»å‹æ–­è¨€
    </h5>
    <p>
     ç”¨äºä»æ¥å£å˜é‡ä¸­æå–å…·ä½“çš„ç±»å‹å€¼ã€‚åŸºæœ¬è¯­æ³•æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go">value<span class="token punctuation">,</span> ok <span class="token operator">:=</span> interfaceVariable<span class="token punctuation">.</span><span class="token punctuation">(</span>Type<span class="token punctuation">)</span>value <span class="token operator">:=</span> iface<span class="token punctuation">.</span><span class="token punctuation">(</span>Type<span class="token punctuation">)</span>
</code></pre>
    <p>
     åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ–­è¨€å¤±è´¥ï¼Œ
     <code>
      ok
     </code>
     ä¼šè¿”å›
     <code>
      false
     </code>
     ï¼Œè€Œ
     <code>
      value
     </code>
     ä¼šæ˜¯ç›®æ ‡ç±»å‹çš„é›¶å€¼ã€‚
     <strong>
      ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ç±»å‹æ–­è¨€è€Œä¸æ£€æŸ¥
      <code>
       ok
      </code>
      å€¼å¯èƒ½å¯¼è‡´è¿è¡Œæ—¶
      <code>
       panic
      </code>
     </strong>
     ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ¥å£å˜é‡çš„å®é™…ç±»å‹ä¸æ–­è¨€ç±»å‹ä¸åŒ¹é…ï¼Œç¨‹åºä¼šå´©æºƒã€‚
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> v <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token string">"Hello, World!"</span>

	<span class="token keyword">if</span> str<span class="token punctuation">,</span> ok <span class="token operator">:=</span> v<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"v is string:"</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span> <span class="token comment">// v is string: Hello, World!</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"v is not string"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_252">
     </a>
     ç±»å‹åˆ‡æ¢
    </h5>
    <p>
     ç»“åˆ
     <code>
      switch...case
     </code>
     è¯­å¥ï¼Œå¤„ç†æ¥å£å˜é‡å¯èƒ½åŒ…å«å¤šç§ç±»å‹çš„æƒ…å†µï¼ŒåŸºæœ¬è¯­æ³•æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">switch</span> v <span class="token operator">:=</span> interfaceVariable<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">case</span> Type1<span class="token punctuation">:</span>
    <span class="token comment">// å¤„ç† Type1</span>
<span class="token keyword">case</span> Type2<span class="token punctuation">:</span>
    <span class="token comment">// å¤„ç† Type2</span>
<span class="token keyword">default</span><span class="token punctuation">:</span>
    <span class="token comment">// é»˜è®¤å¤„ç†</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     ç±»å‹åˆ‡æ¢é€‚ç”¨äºæ¥å£å˜é‡å¯èƒ½åŒ…å«å¤šç§ç±»å‹çš„æƒ…å†µï¼Œå¯ä»¥åœ¨å¤šä¸ªç±»å‹ä¹‹é—´è¿›è¡Œåˆ†æ”¯å¤„ç†ã€‚å¦å¤–ï¼Œä¸ç±»å‹æ–­è¨€ç›¸æ¯”ï¼Œç±»å‹åˆ‡æ¢å¯ä»¥ä¼˜é›…åœ°å¤„ç†æœªçŸ¥ç±»å‹ï¼Œé€šè¿‡
     <code>
      default
     </code>
     åˆ†æ”¯æä¾›é»˜è®¤é€»è¾‘ã€‚
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> v <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">10</span>

	<span class="token keyword">switch</span> v <span class="token operator">:=</span> v<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"v is int:"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token comment">// v is int: 10</span>
	<span class="token keyword">case</span> <span class="token builtin">string</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"v is string:"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"unknown type"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_288">
     </a>
     æºç è§£æ
    </h3>
    <p>
     æ¥å£ä»åŠŸèƒ½ä¸Šæ¥è¯´åˆ†ä¸ºä¸¤ç±»ï¼š
     <strong>
      ç©ºæ¥å£
     </strong>
     å’Œ
     <strong>
      éç©ºæ¥å£
     </strong>
     ã€‚å®ƒä»¬å†åº•å±‚å®ç°ä¸Šå¤§è‡´æ˜¯ç±»ä¼¼çš„ï¼ˆè¿˜æ˜¯æœ‰åŒºåˆ«ï¼‰ï¼Œä½†æ˜¯å®ƒä»¬çš„ç”¨é€”å’Œçº¦æŸæœ‰æ‰€ä¸åŒï¼š
    </p>
    <ul>
     <li>
      <strong>
       ç©ºæ¥å£
      </strong>
      ï¼šæ²¡æœ‰æ–¹æ³•é›†åˆï¼Œå› æ­¤å¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„å€¼ã€‚
     </li>
     <li>
      <strong>
       éç©ºæ¥å£
      </strong>
      ï¼šæœ‰ä¸€ä¸ªæ–¹æ³•é›†åˆï¼Œåªæœ‰å®ç°äº†è¿™äº›æ–¹æ³•çš„ç±»å‹æ‰èƒ½è¢«å­˜å‚¨ã€‚
     </li>
    </ul>
    <p>
     ä¸‹é¢åˆ†åˆ«ä»è¿™ä¸¤ç±»å¯¹æ¥å£çš„æºç è¿›è¡Œæ·±åº¦è§£æã€‚
    </p>
    <h4>
     <a id="_297">
     </a>
     ç©ºæ¥å£
    </h4>
    <p>
     ç©ºæ¥å£åº•å±‚å®ç°åŸºäºä¸€ä¸ªç»“æ„ä½“ï¼Œé€šå¸¸è¢«ç§°ä¸º
     <strong>
      æ¥å£ç±»å‹æè¿°ç¬¦
     </strong>
     ã€‚å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/runtime/runtime2.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token keyword">type</span> eface <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	_type <span class="token operator">*</span>_type
	data  unsafe<span class="token punctuation">.</span>Pointer
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <code>
       _type
      </code>
      ï¼šæŒ‡å‘ä¸€ä¸ªç±»å‹æè¿°ç¬¦ï¼Œå®ƒåŒ…å«äº†å€¼çš„ç±»å‹ä¿¡æ¯ï¼Œä¾‹å¦‚ç±»å‹åç§°ã€å¤§å°ã€æ–¹æ³•é›†åˆç­‰ã€‚
     </li>
     <li>
      <code>
       data
      </code>
      ï¼šæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å®é™…å­˜å‚¨çš„å€¼ã€‚ç”±äº
      <code>
       data
      </code>
      æ˜¯ä¸€ä¸ªé€šç”¨æŒ‡é’ˆï¼Œå®ƒå¯ä»¥æŒ‡å‘ä»»ä½•ç±»å‹çš„å€¼ã€‚
     </li>
    </ul>
    <h5>
     <a id="_313">
     </a>
     ç±»å‹æè¿°ç¬¦
    </h5>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/runtime/type.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token keyword">type</span> _type <span class="token operator">=</span> abi<span class="token punctuation">.</span>Type
</code></pre>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/internal/abi/type.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token keyword">type</span> Type <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Size_       <span class="token builtin">uintptr</span>
	PtrBytes    <span class="token builtin">uintptr</span> <span class="token comment">// number of (prefix) bytes in the type that can contain pointers</span>
	Hash        <span class="token builtin">uint32</span>  <span class="token comment">// hash of type; avoids computation in hash tables</span>
	TFlag       TFlag   <span class="token comment">// extra type information flags</span>
	Align_      <span class="token builtin">uint8</span>   <span class="token comment">// alignment of variable with this type</span>
	FieldAlign_ <span class="token builtin">uint8</span>   <span class="token comment">// alignment of struct field with this type</span>
	Kind_       Kind    <span class="token comment">// enumeration for C</span>
	<span class="token comment">// function for comparing objects of this type</span>
	<span class="token comment">// (ptr to object A, ptr to object B) -&gt; ==?</span>
	Equal <span class="token keyword">func</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span>Pointer<span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span>Pointer<span class="token punctuation">)</span> <span class="token builtin">bool</span>
	<span class="token comment">// GCData stores the GC type data for the garbage collector.</span>
	<span class="token comment">// If the KindGCProg bit is set in kind, GCData is a GC program.</span>
	<span class="token comment">// Otherwise it is a ptrmask bitmap. See mbitmap.go for details.</span>
	GCData    <span class="token operator">*</span><span class="token builtin">byte</span>
	Str       NameOff <span class="token comment">// string form</span>
	PtrToThis TypeOff <span class="token comment">// type for pointer to this type, may be zero</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <code>
       Size_
      </code>
      ï¼šç±»å‹çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚ä¾‹å¦‚ï¼Œ
      <code>
       int32
      </code>
      çš„å¤§å°ä¸º 4 å­—èŠ‚ï¼Œ
      <code>
       int64
      </code>
      çš„å¤§å°ä¸º 8 å­—èŠ‚ã€‚
     </li>
     <li>
      <code>
       PtrBytes
      </code>
      ï¼šç±»å‹ä¸­å¯èƒ½åŒ…å«æŒ‡é’ˆçš„å‰ç¼€éƒ¨åˆ†çš„å­—èŠ‚æ•°ã€‚è¿™ä¸ªå­—æ®µä¸»è¦ç”¨äºåƒåœ¾å›æ”¶å™¨ï¼Œå¸®åŠ©
      <code>
       gc
      </code>
      ç¡®å®šå“ªäº›éƒ¨åˆ†å¯èƒ½åŒ…å«æŒ‡é’ˆã€‚
     </li>
     <li>
      <code>
       Hash
      </code>
      ï¼šç±»å‹çš„å“ˆå¸Œå€¼ï¼Œç”¨äºåœ¨å“ˆå¸Œè¡¨ä¸­å¿«é€Ÿæ¯”è¾ƒå’ŒæŸ¥æ‰¾ç±»å‹ã€‚
     </li>
     <li>
      <code>
       TFlag
      </code>
      ï¼šç±»å‹æ ‡å¿—ï¼Œå­˜å‚¨é¢å¤–çš„ç±»å‹ä¿¡æ¯æ ‡å¿—ã€‚
     </li>
     <li>
      <code>
       Align_
      </code>
      ï¼šç±»å‹çš„å¯¹é½è¦æ±‚ã€‚ä¾‹å¦‚ï¼Œ
      <code>
       int64
      </code>
      åœ¨å†…å­˜ä¸­éœ€è¦ 8 å­—èŠ‚å¯¹é½ã€‚
     </li>
     <li>
      <code>
       FieldAlign_
      </code>
      ï¼šä½œä¸ºç»“æ„ä½“å­—æ®µæ—¶çš„å¯¹é½è¦æ±‚ã€‚
     </li>
     <li>
      <code>
       Kind_
      </code>
      ï¼šç±»å‹çš„ç§ç±»ï¼ˆ
      <code>
       Kind
      </code>
      ï¼‰ï¼Œæ˜¯ä¸€ä¸ªæšä¸¾å€¼ï¼Œä¾‹å¦‚
      <code>
       reflect.Int
      </code>
      ã€
      <code>
       reflect.String
      </code>
      ã€
      <code>
       reflect.Struct
      </code>
      ç­‰ã€‚
     </li>
     <li>
      <code>
       Equal
      </code>
      ï¼šä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªè¯¥ç±»å‹çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚ä¾‹å¦‚ï¼Œå¯¹äºç»“æ„ä½“ç±»å‹ï¼Œ
      <code>
       Equal
      </code>
      å‡½æ•°ä¼šæ¯”è¾ƒç»“æ„ä½“çš„æ¯ä¸ªå­—æ®µæ˜¯å¦ç›¸ç­‰ã€‚
     </li>
     <li>
      <code>
       GCData
      </code>
      ï¼šåƒåœ¾å›æ”¶ç›¸å…³çš„æ•°æ®ã€‚å¦‚æœ
      <code>
       Kind
      </code>
      ä¸­è®¾ç½®äº†
      <code>
       KindGCProg
      </code>
      æ ‡å¿—ï¼Œåˆ™
      <code>
       GCData
      </code>
      æ˜¯ä¸€ä¸ªåƒåœ¾å›æ”¶ç¨‹åºï¼›å¦åˆ™æ˜¯ä¸€ä¸ªæŒ‡é’ˆæ©ç ï¼ˆ
      <code>
       ptrmask
      </code>
      ï¼‰ã€‚
     </li>
     <li>
      <code>
       Str
      </code>
      ï¼šç±»å‹çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼ˆ
      <code>
       NameOff
      </code>
      æ˜¯ä¸€ä¸ªåç§»é‡ï¼ŒæŒ‡å‘ç±»å‹åç§°çš„å­—ç¬¦ä¸²ï¼‰ã€‚
     </li>
     <li>
      <code>
       PtrToThis
      </code>
      ï¼šæŒ‡å‘è¯¥ç±»å‹çš„æŒ‡é’ˆç±»å‹çš„åç§»é‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ
      <code>
       Type
      </code>
      è¡¨ç¤º
      <code>
       int
      </code>
      ï¼Œåˆ™
      <code>
       PtrToThis
      </code>
      è¡¨ç¤º
      <code>
       *int
      </code>
      ã€‚
     </li>
    </ul>
    <h5>
     <a id="_356">
     </a>
     è¾“å‡ºæ¥å£å€¼
    </h5>
    <p>
     ç»™å‡ºä¸€æ®µæ‰“å°ç©ºæ¥å£å€¼çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> v <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">10</span>
	<span class="token function">print</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">// (0x46d400,0x4967e8)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     å°†ä¸Šé¢çš„ä»£ç ç¼–è¯‘æˆæ±‡ç¼–ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-assembly">0x000e 00014        CALL    runtime.printlock(SB)
# ...
0x0021 00033        CALL    runtime.printeface(SB)
0x0026 00038        CALL    runtime.printunlock(SB)
</code></pre>
    <blockquote>
     <p>
      ä»¥ä¸Šæ±‡ç¼–ä»£ç åªæ˜¯éƒ¨åˆ†æˆªå–ï¼Œè¯·æ³¨æ„ç”„åˆ«ã€‚
     </p>
    </blockquote>
    <p>
     <code>
      printeface
     </code>
     å‡½æ•°æ˜¯è¿è¡Œæ—¶æ‰“å°æ¥å£å€¼æ‰€æ‰§è¡Œçš„å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/runtime/print.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">printeface</span><span class="token punctuation">(</span>e eface<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"("</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>_type<span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token string">")"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     ç»è¿‡
     <code>
      print
     </code>
     å‡½æ•°æ‰§è¡Œåï¼Œå°†ç±»å‹æè¿°ç¬¦çš„åœ°å€å’Œåº•å±‚å®é™…å­˜å‚¨çš„å€¼çš„åœ°å€æ ¼å¼åŒ–æ‰“å°å‡ºæ¥ã€‚
    </p>
    <h4>
     <a id="_392">
     </a>
     éç©ºæ¥å£
    </h4>
    <p>
     éç©ºæ¥å£åº•å±‚å®ç°ä¹Ÿæ˜¯åŸºäºä¸€ä¸ªç»“æ„ä½“ï¼Œé€šå¸¸è¢«ç§°ä¸º
     <strong>
      æ¥å£ç±»å‹æè¿°ç¬¦
     </strong>
     ã€‚å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/runtime/runtime2.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token keyword">type</span> iface <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	tab  <span class="token operator">*</span>itab
	data unsafe<span class="token punctuation">.</span>Pointer
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <p>
       <code>
        tab
       </code>
       ï¼šæ˜¯ä¸€ä¸ªæŒ‡å‘
       <code>
        ITab
       </code>
       çš„æŒ‡é’ˆï¼Œ
       <code>
        ITab
       </code>
       æ˜¯ä¸€ä¸ªé‡è¦çš„ç»“æ„ä½“ï¼Œç”¨äºå­˜å‚¨æ¥å£ç±»å‹å’Œå…·ä½“å®ç°ç±»å‹ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚
      </p>
     </li>
     <li>
      <p>
       <code>
        data
       </code>
       ï¼šæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å®é™…å­˜å‚¨çš„å€¼ã€‚ç”±äº
       <code>
        data
       </code>
       æ˜¯ä¸€ä¸ªé€šç”¨æŒ‡é’ˆï¼Œå®ƒå¯ä»¥æŒ‡å‘ä»»ä½•ç±»å‹çš„å€¼ã€‚
      </p>
     </li>
    </ul>
    <h5>
     <a id="ITab_409">
     </a>
     <code>
      ITab
     </code>
    </h5>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/runtime/runtime2.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token keyword">type</span> itab <span class="token operator">=</span> abi<span class="token punctuation">.</span>ITab
</code></pre>
    <p>
     <code>
      ITab
     </code>
     æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ç»“æ„ä½“ï¼Œç”¨äºè¡¨ç¤ºæ¥å£ç±»å‹å’Œå…·ä½“å®ç°ç±»å‹ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚å®ƒçš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/internal/abi/iface.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token keyword">type</span> ITab <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Inter <span class="token operator">*</span>InterfaceType
	Type  <span class="token operator">*</span>Type
	Hash  <span class="token builtin">uint32</span>     <span class="token comment">// copy of Type.Hash. Used for type switches.</span>
	Fun   <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token builtin">uintptr</span> <span class="token comment">// variable sized. fun[0]==0 means Type does not implement Inter.</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <code>
       Inter
      </code>
      ï¼ˆ
      <code>
       *InterfaceType
      </code>
      ï¼‰ï¼šæ¥å£ç±»å‹çš„ç±»å‹æè¿°ç¬¦ã€‚è¿™è¡¨ç¤ºæ¥å£çš„ç±»å‹ä¿¡æ¯ï¼Œä¾‹å¦‚æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•é›†åˆã€‚
     </li>
     <li>
      <code>
       Type
      </code>
      ï¼ˆ
      <code>
       *Type
      </code>
      ï¼‰ï¼šå…·ä½“å®ç°ç±»å‹çš„ç±»å‹æè¿°ç¬¦ã€‚è¿™è¡¨ç¤ºæ¥å£èƒŒåçš„å®é™…ç±»å‹ã€‚
     </li>
     <li>
      <code>
       Hash
      </code>
      ï¼ˆ
      <code>
       uint32
      </code>
      ï¼‰ï¼šç”¨äºç±»å‹åˆ‡æ¢çš„å“ˆå¸Œå€¼ã€‚å®ƒæ˜¯
      <code>
       Type.Hash
      </code>
      çš„å‰¯æœ¬ï¼Œç”¨äºå¿«é€Ÿæ¯”è¾ƒç±»å‹ã€‚
     </li>
     <li>
      <code>
       Fun
      </code>
      ï¼ˆ
      <code>
       [1]uintptr
      </code>
      ï¼‰ï¼šä¸€ä¸ªå¯å˜å¤§å°çš„æ•°ç»„ï¼Œå­˜å‚¨æ¥å£æ–¹æ³•åˆ°å…·ä½“å®ç°æ–¹æ³•çš„æ˜ å°„ï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ã€‚
      <code>
       Fun
      </code>
      æ•°ç»„çš„å¤§å°å–å†³äºæ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•æ•°é‡ã€‚
     </li>
    </ul>
    <h5>
     <a id="itabTableType_435">
     </a>
     <code>
      itabTableType
     </code>
    </h5>
    <p>
     <code>
      itabTableType
     </code>
     æ˜¯
     <code>
      golang
     </code>
     è¿è¡Œæ—¶ç”¨æ¥å­˜å‚¨å’Œç®¡ç†æ‰€æœ‰
     <code>
      itab
     </code>
     çš„æ•°æ®ç»“æ„ã€‚å®ƒæ˜¯ä¸€ä¸ªå…¨å±€çš„å“ˆå¸Œè¡¨ï¼Œç”¨äºç¼“å­˜å·²ç»ç”Ÿæˆçš„
     <code>
      itab
     </code>
     ï¼Œä»¥é¿å…é‡å¤åˆ›å»ºã€‚
    </p>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/runtime/iface.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token keyword">const</span> itabInitSize <span class="token operator">=</span> <span class="token number">512</span>

<span class="token keyword">var</span> <span class="token punctuation">(</span>
	itabLock      mutex                               <span class="token comment">// lock for accessing itab table</span>
	itabTable     <span class="token operator">=</span> <span class="token operator">&amp;</span>itabTableInit                    <span class="token comment">// pointer to current table</span>
	itabTableInit <span class="token operator">=</span> itabTableType<span class="token punctuation">{<!-- --></span>size<span class="token punctuation">:</span> itabInitSize<span class="token punctuation">}</span> <span class="token comment">// starter table</span>
<span class="token punctuation">)</span>

<span class="token comment">// Note: change the formula in the mallocgc call in itabAdd if you change these fields.</span>
<span class="token keyword">type</span> itabTableType <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	size    <span class="token builtin">uintptr</span>             <span class="token comment">// length of entries array. Always a power of 2.</span>
	count   <span class="token builtin">uintptr</span>             <span class="token comment">// current number of filled entries.</span>
	entries <span class="token punctuation">[</span>itabInitSize<span class="token punctuation">]</span><span class="token operator">*</span>itab <span class="token comment">// really [size] large</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <code>
       size
      </code>
      ï¼šå“ˆå¸Œè¡¨çš„å¤§å°ï¼ˆå³
      <code>
       entries
      </code>
      æ•°ç»„çš„é•¿åº¦ï¼‰ã€‚å®ƒå§‹ç»ˆæ˜¯ 2 çš„å¹‚æ¬¡æ–¹ã€‚
     </li>
     <li>
      <code>
       count
      </code>
      ï¼šå½“å‰å“ˆå¸Œè¡¨ä¸­å·²å¡«å……çš„æ¡ç›®æ•°é‡ï¼ˆå³å·²å­˜å‚¨çš„
      <code>
       itab
      </code>
      æ•°é‡ï¼‰ã€‚
     </li>
     <li>
      <code>
       entries
      </code>
      ï¼šå“ˆå¸Œè¡¨çš„æ¡ç›®æŒ‡é’ˆæ•°ç»„ï¼Œå­˜å‚¨æŒ‡å‘
      <code>
       itab
      </code>
      çš„æŒ‡é’ˆã€‚æ•°ç»„çš„åˆå§‹é•¿åº¦æ˜¯512ã€‚
     </li>
    </ul>
    <h6>
     <a id="_itab__462">
     </a>
     åˆå§‹åŒ–
     <code>
      itab
     </code>
     è¡¨
    </h6>
    <p>
     åœ¨
     <code>
      golang
     </code>
     ç¨‹åºå¯åŠ¨æ—¶ï¼Œè¿è¡Œæ—¶ä¼šæ‰§è¡Œä¸€ç³»åˆ—åˆå§‹åŒ–æ“ä½œï¼ŒåŒ…æ‹¬åˆå§‹åŒ–å…¨å±€é”ã€å†…å­˜åˆ†é…å™¨ç­‰ã€‚åœ¨è¿™äº›åˆå§‹åŒ–æ“ä½œä¸­ï¼Œ
     <code>
      itabsinit
     </code>
     å‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œç”¨äºåˆå§‹åŒ–å…¨å±€çš„
     <code>
      itab
     </code>
     è¡¨ã€‚
    </p>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/runtime/iface.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">itabsinit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// åˆå§‹åŒ–å…¨å±€é” itabLock</span>
	<span class="token function">lockInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>itabLock<span class="token punctuation">,</span> lockRankItab<span class="token punctuation">)</span>
	<span class="token function">lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>itabLock<span class="token punctuation">)</span>
    <span class="token comment">// è·å–æ‰€æœ‰åŠ è½½çš„æ¨¡å—</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> md <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token function">activeModules</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> md<span class="token punctuation">.</span>itablinks <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// å°†æ¯ä¸ªæ¨¡å—çš„ itab æ·»åŠ åˆ°å…¨å±€è¡¨ä¸­</span>
			<span class="token function">itabAdd</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>itabLock<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <code>
      itabsinit
     </code>
     å‡½æ•°ä¼šéå†æ‰€æœ‰åŠ è½½çš„æ¨¡å—ï¼Œå°†æ¯ä¸ªæ¨¡å—çš„
     <code>
      itab
     </code>
     æ·»åŠ åˆ°å…¨å±€è¡¨ä¸­ã€‚
    </p>
    <h6>
     <a id="_itab_486">
     </a>
     æ·»åŠ 
     <code>
      itab
     </code>
    </h6>
    <p>
     <code>
      itabAdd
     </code>
     å‡½æ•°çš„ä¸»è¦ä½œç”¨æ˜¯å°†ä¸€ä¸ªæ–°çš„
     <code>
      itab
     </code>
     æ·»åŠ åˆ°å…¨å±€çš„
     <code>
      itab
     </code>
     è¡¨ä¸­ã€‚
    </p>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/runtime/iface.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token comment">// itabAdd adds the given itab to the itab hash table.</span>
<span class="token comment">// itabLock must be held.</span>
<span class="token keyword">func</span> <span class="token function">itabAdd</span><span class="token punctuation">(</span>m <span class="token operator">*</span>itab<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// Bugs can lead to calling this while mallocing is set,</span>
	<span class="token comment">// typically because this is called while panicking.</span>
	<span class="token comment">// Crash reliably, rather than only when we need to grow</span>
	<span class="token comment">// the hash table.</span>
    <span class="token comment">// æ£€æŸ¥å½“å‰ Goroutine æ˜¯å¦å¤„äºå†…å­˜åˆ†é…ä¸­</span>
    <span class="token comment">// å¦‚æœåœ¨å†…å­˜åˆ†é…ä¸­è°ƒç”¨ itabAddï¼Œä¼šè§¦å‘æ­»é”ï¼Œå› æ­¤ç›´æ¥æŠ›å‡ºé”™è¯¯</span>
	<span class="token keyword">if</span> <span class="token function">getg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>m<span class="token punctuation">.</span>mallocing <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">throw</span><span class="token punctuation">(</span><span class="token string">"malloc deadlock"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	t <span class="token operator">:=</span> itabTable
    <span class="token comment">// æ£€æŸ¥å“ˆå¸Œè¡¨çš„è´Ÿè½½å› å­æ˜¯å¦è¶…è¿‡ 75%</span>
	<span class="token keyword">if</span> t<span class="token punctuation">.</span>count <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token operator">*</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>size<span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 75% load factor</span>
        <span class="token comment">// å“ˆå¸Œè¡¨æ‰©å®¹çš„é€»è¾‘</span>
		<span class="token comment">// Grow hash table.</span>
		<span class="token comment">// t2 = new(itabTableType) + some additional entries</span>
		<span class="token comment">// We lie and tell malloc we want pointer-free memory because</span>
		<span class="token comment">// all the pointed-to values are not in the heap.</span>
        <span class="token comment">// åˆ†é…æ–°çš„å“ˆå¸Œè¡¨ï¼Œå¤§å°ä¸ºåŸæ¥çš„ä¸¤å€</span>
		t2 <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span>itabTableType<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">mallocgc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>t<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token operator">*</span>goarch<span class="token punctuation">.</span>PtrSize<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		t2<span class="token punctuation">.</span>size <span class="token operator">=</span> t<span class="token punctuation">.</span>size <span class="token operator">*</span> <span class="token number">2</span>
		
        <span class="token comment">// åœ¨å¤åˆ¶æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½ä¼šå¯»æ‰¾ itab è€Œæ‰¾ä¸åˆ°å®ƒã€‚æ²¡å…³ç³»ï¼Œç„¶åå®ƒä»¬å°†å°è¯•è·å– tab é”ï¼Œå¹¶å› æ­¤ç­‰å¾…ï¼Œç›´åˆ°å¤åˆ¶å®Œæˆ</span>
		<span class="token comment">// Copy over entries.</span>
		<span class="token comment">// Note: while copying, other threads may look for an itab and</span>
		<span class="token comment">// fail to find it. That's ok, they will then try to get the itab lock</span>
		<span class="token comment">// and as a consequence wait until this copying is complete.</span>
        <span class="token comment">// éå†å½“å‰å“ˆå¸Œè¡¨ä¸­çš„æ‰€æœ‰ itabï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°æ–°çš„å“ˆå¸Œè¡¨ä¸­</span>
        <span class="token comment">// ä¼ å…¥ add å‡½æ•°æŒ‡é’ˆï¼Œå…¶å®è°ƒç”¨çš„è¿˜æ˜¯ add å‡½æ•°è¿›è¡Œæ·»åŠ </span>
		<span class="token function">iterate_itabs</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>add<span class="token punctuation">)</span>
		<span class="token keyword">if</span> t2<span class="token punctuation">.</span>count <span class="token operator">!=</span> t<span class="token punctuation">.</span>count <span class="token punctuation">{<!-- --></span>
			<span class="token function">throw</span><span class="token punctuation">(</span><span class="token string">"mismatched count during itab table copy"</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// Publish new hash table. Use an atomic write: see comment in getitab.</span>
        <span class="token comment">// åŸå­åœ°æ›´æ–°å…¨å±€ itabTable æŒ‡é’ˆï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨</span>
		<span class="token function">atomicstorep</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>itabTable<span class="token punctuation">)</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token comment">// Adopt the new table as our own.</span>
		t <span class="token operator">=</span> itabTable
		<span class="token comment">// Note: the old table can be GC'ed here.</span>
	<span class="token punctuation">}</span>
    
    <span class="token comment">// å¦‚æœæ²¡æœ‰è¶…è¿‡ 75%ï¼Œåˆ™è°ƒç”¨ itabTableType.add æ–¹æ³•ï¼Œå°†æ–°çš„ itab æ·»åŠ åˆ°å“ˆå¸Œè¡¨ä¸­</span>
	t<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     å¦å¤–ï¼Œåœ¨æ‰©å®¹å®Œæˆåï¼Œæ–°çš„
     <code>
      itab
     </code>
     è¡¨éœ€è¦è¢«å‘å¸ƒã€‚ä¸ºäº†ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œ
     <code>
      golang
     </code>
     ä½¿ç”¨åŸå­æ“ä½œ
     <code>
      atomicstorep
     </code>
     æ¥æ›´æ–°å…¨å±€
     <code>
      itabTable
     </code>
     æŒ‡é’ˆï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œ
     <code>
      itabTable
     </code>
     çš„æ›´æ–°æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚
    </p>
    <p>
     æ¥ä¸‹æ¥å°±æ˜¯å°†
     <code>
      itab
     </code>
     æ·»åŠ åˆ°å“ˆå¸Œè¡¨ä¸­çš„ä»£ç 
     <code>
      itabTableType.add
     </code>
     ã€‚
    </p>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/runtime/iface.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token comment">// add adds the given itab to itab table t.</span>
<span class="token comment">// itabLock must be held.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>itabTableType<span class="token punctuation">)</span> <span class="token function">add</span><span class="token punctuation">(</span>m <span class="token operator">*</span>itab<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// See comment in find about the probe sequence.</span>
	<span class="token comment">// Insert new itab in the first empty spot in the probe sequence.</span>
    <span class="token comment">// ä½¿ç”¨æ©ç  mask ç¡®ä¿å“ˆå¸Œå€¼åœ¨å“ˆå¸Œè¡¨çš„èŒƒå›´å†…</span>
	mask <span class="token operator">:=</span> t<span class="token punctuation">.</span>size <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token comment">// ä½¿ç”¨ itabHashFunc è®¡ç®— itab çš„å“ˆå¸Œå€¼</span>
	h <span class="token operator">:=</span> <span class="token function">itabHashFunc</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>Inter<span class="token punctuation">,</span> m<span class="token punctuation">.</span>Type<span class="token punctuation">)</span> <span class="token operator">&amp;</span> mask
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token function">uintptr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ä½¿ç”¨çº¿æ€§æ¢æµ‹æ³•è§£å†³å“ˆå¸Œå†²çª</span>
		p <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span>itab<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>t<span class="token punctuation">.</span>entries<span class="token punctuation">)</span><span class="token punctuation">,</span> h<span class="token operator">*</span>goarch<span class="token punctuation">.</span>PtrSize<span class="token punctuation">)</span><span class="token punctuation">)</span>
		m2 <span class="token operator">:=</span> <span class="token operator">*</span>p
        <span class="token comment">// å¦‚æœå‡ºç°ç›¸åŒçš„ itab åˆ™ç›´æ¥è¿”å›ï¼Œé¿å…é‡å¤æ·»åŠ </span>
		<span class="token keyword">if</span> m2 <span class="token operator">==</span> m <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// A given itab may be used in more than one module</span>
			<span class="token comment">// and thanks to the way global symbol resolution works, the</span>
			<span class="token comment">// pointed-to itab may already have been inserted into the</span>
			<span class="token comment">// global 'hash'.</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
        <span class="token comment">// å¦‚æœæ‰¾åˆ°ç©ºä½ï¼Œå°†æ–°çš„ itab æ·»åŠ åˆ°è¯¥ä½ç½®</span>
		<span class="token keyword">if</span> m2 <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// Use atomic write here so if a reader sees m, it also</span>
			<span class="token comment">// sees the correctly initialized fields of m.</span>
			<span class="token comment">// NoWB is ok because m is not in heap memory.</span>
			<span class="token comment">// *p = m</span>
            <span class="token comment">// ä½¿ç”¨ atomic.StorepNoWB ç¡®ä¿å†™å…¥æ“ä½œæ˜¯åŸå­çš„</span>
			atomic<span class="token punctuation">.</span><span class="token function">StorepNoWB</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// æ›´æ”¹å…¨å±€å“ˆå¸Œè¡¨çš„è®¡æ•°å€¼</span>
			t<span class="token punctuation">.</span>count<span class="token operator">++</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
        
        <span class="token comment">// æ›´æ–°å“ˆå¸Œå€¼</span>
        <span class="token comment">// ç›´æ¥æŸ¥æ‰¾ä¸‹ä¸€ä¸ªï¼Œçº¿æ€§æ¢æµ‹æ³•</span>
		h <span class="token operator">+=</span> i
		h <span class="token operator">&amp;=</span> mask
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h6>
     <a id="_itab_591">
     </a>
     æŸ¥æ‰¾
     <code>
      itab
     </code>
    </h6>
    <p>
     <code>
      getitab
     </code>
     å‡½æ•°çš„ä½œç”¨æ˜¯æŸ¥æ‰¾æˆ–ç”Ÿæˆä¸€ä¸ª
     <code>
      itab
     </code>
     ã€‚å¦‚æœæ‰¾åˆ°ç°æˆçš„
     <code>
      itab
     </code>
     ï¼Œåˆ™ç›´æ¥è¿”å›ï¼›å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™åŠ¨æ€ç”Ÿæˆä¸€ä¸ªæ–°çš„
     <code>
      itab
     </code>
     å¹¶æ·»åŠ åˆ°å…¨å±€è¡¨ä¸­ã€‚
    </p>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/runtime/iface.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token comment">// getitab should be an internal detail,</span>
<span class="token comment">// but widely used packages access it using linkname.</span>
<span class="token comment">// Notable members of the hall of shame include:</span>
<span class="token comment">//   - github.com/bytedance/sonic</span>
<span class="token comment">//</span>
<span class="token comment">// Do not remove or change the type signature.</span>
<span class="token comment">// See go.dev/issue/67401.</span>
<span class="token comment">//</span>
<span class="token comment">//go:linkname getitab</span>
<span class="token keyword">func</span> <span class="token function">getitab</span><span class="token punctuation">(</span>inter <span class="token operator">*</span>interfacetype<span class="token punctuation">,</span> typ <span class="token operator">*</span>_type<span class="token punctuation">,</span> canfail <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token operator">*</span>itab <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// å¦‚æœæ¥å£æ²¡æœ‰æ–¹æ³•ï¼ŒæŠ›å‡ºå†…éƒ¨é”™è¯¯</span>
    <span class="token comment">// å¿…é¡»ä¿è¯æ˜¯éç©ºæ¥å£</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>inter<span class="token punctuation">.</span>Methods<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">throw</span><span class="token punctuation">(</span><span class="token string">"internal error - misuse of itab"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// easy case</span>
    <span class="token comment">// å¦‚æœå…·ä½“ç±»å‹æ²¡æœ‰æ–¹æ³•è¡¨, å¹¶ä¸” canfail ä¸º trueï¼Œåˆ™è¿”å› nil</span>
	<span class="token keyword">if</span> typ<span class="token punctuation">.</span>TFlag<span class="token operator">&amp;</span>abi<span class="token punctuation">.</span>TFlagUncommon <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> canfail <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span>
        <span class="token comment">// å¦‚æœ canfail ä¸º falseï¼ŒæŠ›å‡ºç±»å‹æ–­è¨€é”™è¯¯</span>
		name <span class="token operator">:=</span> <span class="token function">toRType</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>inter<span class="token punctuation">.</span>Type<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nameOff</span><span class="token punctuation">(</span>inter<span class="token punctuation">.</span>Methods<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>TypeAssertionError<span class="token punctuation">{<!-- --></span><span class="token boolean">nil</span><span class="token punctuation">,</span> typ<span class="token punctuation">,</span> <span class="token operator">&amp;</span>inter<span class="token punctuation">.</span>Type<span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">var</span> m <span class="token operator">*</span>itab

	<span class="token comment">// First, look in the existing table to see if we can find the itab we need.</span>
	<span class="token comment">// This is by far the most common case, so do it without locks.</span>
	<span class="token comment">// Use atomic to ensure we see any previous writes done by the thread</span>
	<span class="token comment">// that updates the itabTable field (with atomic.Storep in itabAdd).</span>
    <span class="token comment">// ä½¿ç”¨åŸå­æ“ä½œåŠ è½½å…¨å±€ itabTable</span>
	t <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span>itabTableType<span class="token punctuation">)</span><span class="token punctuation">(</span>atomic<span class="token punctuation">.</span><span class="token function">Loadp</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>itabTable<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// è°ƒç”¨ t.find æŸ¥æ‰¾ç°æœ‰çš„ itab</span>
	<span class="token keyword">if</span> m <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>inter<span class="token punctuation">,</span> typ<span class="token punctuation">)</span><span class="token punctuation">;</span> m <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// å¦‚æœæ‰¾åˆ°ï¼Œè·³è½¬åˆ° finish</span>
		<span class="token keyword">goto</span> finish
	<span class="token punctuation">}</span>
	
    <span class="token comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå…ˆåŠ é”ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨</span>
	<span class="token comment">// Not found.  Grab the lock and try again.</span>
	<span class="token function">lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>itabLock<span class="token punctuation">)</span>
    <span class="token comment">// å†æ¬¡æŸ¥æ‰¾</span>
	<span class="token keyword">if</span> m <span class="token operator">=</span> itabTable<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>inter<span class="token punctuation">,</span> typ<span class="token punctuation">)</span><span class="token punctuation">;</span> m <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// æ‰¾åˆ°äº†ç›´æ¥å°±è§£é”ï¼Œè·³è½¬åˆ° finish</span>
		<span class="token function">unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>itabLock<span class="token punctuation">)</span>
		<span class="token keyword">goto</span> finish
	<span class="token punctuation">}</span>
	
    <span class="token comment">// å¦‚æœä»£ç èµ°åˆ°äº†è¿™é‡Œï¼Œè¡¨ç¤ºå…¨å±€ itabTable è¡¨ä¸­ä¸å­˜åœ¨ç›®æ ‡ itab</span>
    <span class="token comment">// ä¸‹é¢å°±éœ€è¦åŠ¨æ€ç”Ÿæˆ itabï¼Œå¹¶åŠ å…¥åˆ°å…¨å±€ itabTable è¡¨ä¸­</span>
	<span class="token comment">// Entry doesn't exist yet. Make a new entry &amp; add it.</span>
    <span class="token comment">// åŠ¨æ€åˆ†é…æ–°çš„ itab</span>
	m <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>itab<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">persistentalloc</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span>itab<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">uintptr</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>inter<span class="token punctuation">.</span>Methods<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>goarch<span class="token punctuation">.</span>PtrSize<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>memstats<span class="token punctuation">.</span>other_sys<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// åˆå§‹åŒ– itab çš„å­—æ®µ</span>
	m<span class="token punctuation">.</span>Inter <span class="token operator">=</span> inter
	m<span class="token punctuation">.</span>Type <span class="token operator">=</span> typ
	<span class="token comment">// The hash is used in type switches. However, compiler statically generates itab's</span>
	<span class="token comment">// for all interface/type pairs used in switches (which are added to itabTable</span>
	<span class="token comment">// in itabsinit). The dynamically-generated itab's never participate in type switches,</span>
	<span class="token comment">// and thus the hash is irrelevant.</span>
	<span class="token comment">// Note: m.Hash is _not_ the hash used for the runtime itabTable hash table.</span>
	m<span class="token punctuation">.</span>Hash <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">// è°ƒç”¨ itabInit åˆå§‹åŒ–æ–¹æ³•è¡¨</span>
	<span class="token function">itabInit</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token comment">// è°ƒç”¨ itabAdd å°†æ–°çš„ itab æ·»åŠ åˆ°å…¨å±€è¡¨ä¸­</span>
	<span class="token function">itabAdd</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
    <span class="token comment">// è§£é”</span>
	<span class="token function">unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>itabLock<span class="token punctuation">)</span>
    
    <span class="token comment">// æ¥ä¸‹æ¥å°±æ˜¯æŸ¥æ‰¾å®Œæˆçš„é€»è¾‘</span>
finish<span class="token punctuation">:</span>
    <span class="token comment">// å¦‚æœ m.Fun[0] ä¸ä¸º 0ï¼Œè¿”å› itab</span>
    <span class="token comment">// è¿™é‡Œéœ€è¦è§£é‡Šä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œéœ€è¦åŠ è¿™ä¹ˆä¸€ä¸ªåˆ¤æ–­</span>
    <span class="token comment">// å› ä¸º m.Fun[0] æ˜¯è¿™ä¸ªæ–¹æ³•è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œé€šå¸¸å¯¹åº”æ¥å£çš„ç¬¬ä¸€ä¸ªæ–¹æ³•</span>
    <span class="token comment">// m.Fun[0] != 0 å°±è¡¨ç¤ºæ¥å£çš„ç¬¬ä¸€ä¸ªæ–¹æ³•å·²ç»è¢«æ­£ç¡®åŠ è½½ï¼Œä¹Ÿå°±æ˜¯è¯´ itab å·²ç»åˆå§‹åŒ–å®Œæ¯•äº†</span>
    <span class="token comment">// m.Fun[0] == 0 è¡¨ç¤ºæ¥å£çš„ç¬¬ä¸€ä¸ªæ–¹æ³•æ²¡æœ‰è¢«åŠ è½½ï¼Œitabåˆå§‹åŒ–å¤±è´¥</span>
	<span class="token keyword">if</span> m<span class="token punctuation">.</span>Fun<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> m
	<span class="token punctuation">}</span>
    
    <span class="token comment">// å¦‚æœ canfail ä¸º trueï¼Œè¿”å› nil</span>
	<span class="token keyword">if</span> canfail <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// this can only happen if the conversion</span>
	<span class="token comment">// was already done once using the , ok form</span>
	<span class="token comment">// and we have a cached negative result.</span>
	<span class="token comment">// The cached result doesn't record which</span>
	<span class="token comment">// interface function was missing, so initialize</span>
	<span class="token comment">// the itab again to get the missing function name.</span>
    <span class="token comment">// å¦åˆ™ï¼ŒæŠ›å‡ºç±»å‹æ–­è¨€é”™è¯¯</span>
	<span class="token function">panic</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>TypeAssertionError<span class="token punctuation">{<!-- --></span>concrete<span class="token punctuation">:</span> typ<span class="token punctuation">,</span> asserted<span class="token punctuation">:</span> <span class="token operator">&amp;</span>inter<span class="token punctuation">.</span>Type<span class="token punctuation">,</span> missingMethod<span class="token punctuation">:</span> <span class="token function">itabInit</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <code>
      find
     </code>
     æ–¹æ³•çš„ä½œç”¨å°±æ˜¯åœ¨
     <code>
      itabTable
     </code>
     ä¸­æŸ¥æ‰¾ç»™å®šçš„æ¥å£ç±»å‹å’Œå…·ä½“ç±»å‹çš„
     <code>
      itab
     </code>
     ã€‚
    </p>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/runtime/iface.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token comment">// find finds the given interface/type pair in t.</span>
<span class="token comment">// Returns nil if the given interface/type pair isn't present.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>itabTableType<span class="token punctuation">)</span> <span class="token function">find</span><span class="token punctuation">(</span>inter <span class="token operator">*</span>interfacetype<span class="token punctuation">,</span> typ <span class="token operator">*</span>_type<span class="token punctuation">)</span> <span class="token operator">*</span>itab <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// Implemented using quadratic probing.</span>
	<span class="token comment">// Probe sequence is h(i) = h0 + i*(i+1)/2 mod 2^k.</span>
	<span class="token comment">// We're guaranteed to hit all table entries using this probe sequence.</span>
	mask <span class="token operator">:=</span> t<span class="token punctuation">.</span>size <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token comment">// è®¡ç®—æ¥å£ç±»å‹å’Œå…·ä½“ç±»å‹çš„å“ˆå¸Œå€¼</span>
	h <span class="token operator">:=</span> <span class="token function">itabHashFunc</span><span class="token punctuation">(</span>inter<span class="token punctuation">,</span> typ<span class="token punctuation">)</span> <span class="token operator">&amp;</span> mask
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token function">uintptr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// è®¡ç®—å½“å‰å“ˆå¸Œä½ç½®çš„æŒ‡é’ˆ</span>
		p <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span>itab<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>t<span class="token punctuation">.</span>entries<span class="token punctuation">)</span><span class="token punctuation">,</span> h<span class="token operator">*</span>goarch<span class="token punctuation">.</span>PtrSize<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token comment">// Use atomic read here so if we see m != nil, we also see</span>
		<span class="token comment">// the initializations of the fields of m.</span>
		<span class="token comment">// m := *p</span>
        <span class="token comment">// ä½¿ç”¨åŸå­æ“ä½œåŠ è½½ itabï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨</span>
		m <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span>itab<span class="token punctuation">)</span><span class="token punctuation">(</span>atomic<span class="token punctuation">.</span><span class="token function">Loadp</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> m <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// å¦‚æœå½“å‰ä½ç½®ä¸ºç©ºï¼Œè¿”å› nilï¼Œè¡¨ç¤ºæœªæ‰¾åˆ°åŒ¹é…çš„ itab</span>
			<span class="token keyword">return</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span>
        <span class="token comment">// å¦‚æœå½“å‰ itab çš„æ¥å£ç±»å‹å’Œå…·ä½“ç±»å‹ä¸ç›®æ ‡åŒ¹é…ï¼Œè¿”å›è¯¥ itab</span>
		<span class="token keyword">if</span> m<span class="token punctuation">.</span>Inter <span class="token operator">==</span> inter <span class="token operator">&amp;&amp;</span> m<span class="token punctuation">.</span>Type <span class="token operator">==</span> typ <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> m
		<span class="token punctuation">}</span>
        
        <span class="token comment">// å½“å‰ä½ç½®ä¸ä¸ºç©ºï¼Œå¹¶ä¸”ä¸ç›®æ ‡ç±»å‹ä¹Ÿä¸åŒ¹é…ï¼Œåˆ™ç›´æ¥æŸ¥æ‰¾ä¸‹ä¸€ä¸ª</span>
        <span class="token comment">// çº¿æ€§æ¢æµ‹æ³•</span>
        
        <span class="token comment">// æ›´æ–°å“ˆå¸Œå€¼</span>
		h <span class="token operator">+=</span> i
		h <span class="token operator">&amp;=</span> mask
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨äº†åŸå­æ“ä½œ
     <code>
      atomic.Loadp
     </code>
     æ¥åŠ è½½
     <code>
      itab
     </code>
     ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚è¿™é¿å…äº†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯èƒ½å‡ºç°çš„è¯»å–æœªåˆå§‹åŒ–æˆ–éƒ¨åˆ†åˆå§‹åŒ–çš„
     <code>
      itab
     </code>
     çš„é—®é¢˜ã€‚
    </p>
    <p>
     å¦å¤–ï¼Œåœ¨
     <code>
      getitab
     </code>
     å‡½æ•°ä¸­ï¼Œå½“
     <code>
      itab
     </code>
     ä¸å­˜åœ¨æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„
     <code>
      itab
     </code>
     ï¼Œå¹¶è¿›è¡Œåˆå§‹åŒ–ï¼Œé‚£ä¹ˆå…¶ä¸­è¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„åˆå§‹åŒ–åŠ¨ä½œï¼š
     <code>
      itabInit
     </code>
     å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯
     <code>
      golang
     </code>
     è¿è¡Œæ—¶ä¸­ç”¨äºåˆå§‹åŒ–
     <code>
      itab
     </code>
     çš„æ–¹æ³•è¡¨çš„å…³é”®å‡½æ•°ã€‚å®ƒçš„ä½œç”¨æ˜¯å°†æ¥å£ç±»å‹çš„æ–¹æ³•ä¸å…·ä½“ç±»å‹çš„æ–¹æ³•è¿›è¡ŒåŒ¹é…ï¼Œå¹¶å¡«å……
     <code>
      itab
     </code>
     çš„
     <code>
      Fun
     </code>
     å­—æ®µã€‚
    </p>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/runtime/iface.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">itabInit</span><span class="token punctuation">(</span>m <span class="token operator">*</span>itab<span class="token punctuation">,</span> firstTime <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// æ¥å£ç±»å‹</span>
	inter <span class="token operator">:=</span> m<span class="token punctuation">.</span>Inter
    <span class="token comment">// å…·ä½“ç±»å‹</span>
	typ <span class="token operator">:=</span> m<span class="token punctuation">.</span>Type
    <span class="token comment">// å…·ä½“ç±»å‹çš„ UncommonTypeï¼ŒåŒ…å«æ–¹æ³•è¡¨ä¿¡æ¯</span>
	x <span class="token operator">:=</span> typ<span class="token punctuation">.</span><span class="token function">Uncommon</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// both inter and typ have method sorted by name,</span>
	<span class="token comment">// and interface names are unique,</span>
	<span class="token comment">// so can iterate over both in lock step;</span>
	<span class="token comment">// the loop is O(ni+nt) not O(ni*nt).</span>
    <span class="token comment">// æ¥å£æ–¹æ³•çš„æ•°é‡</span>
	ni <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>inter<span class="token punctuation">.</span>Methods<span class="token punctuation">)</span>
    <span class="token comment">// å…·ä½“ç±»å‹æ–¹æ³•çš„æ•°é‡</span>
	nt <span class="token operator">:=</span> <span class="token function">int</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>Mcount<span class="token punctuation">)</span>
    <span class="token comment">// å…·ä½“ç±»å‹çš„æ–¹æ³•è¡¨</span>
	xmhdr <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">]</span>abi<span class="token punctuation">.</span>Method<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>Moff<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span>nt<span class="token punctuation">:</span>nt<span class="token punctuation">]</span>
	j <span class="token operator">:=</span> <span class="token number">0</span>
    <span class="token comment">// itab çš„æ–¹æ³•è¡¨ï¼Œç”¨äºå­˜å‚¨æ¥å£æ–¹æ³•çš„å‡½æ•°æŒ‡é’ˆ</span>
	methods <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">]</span>unsafe<span class="token punctuation">.</span>Pointer<span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m<span class="token punctuation">.</span>Fun<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span>ni<span class="token punctuation">:</span>ni<span class="token punctuation">]</span>
    <span class="token comment">// ç¬¬ä¸€ä¸ªæ–¹æ³•çš„å‡½æ•°æŒ‡é’ˆï¼Œç”¨äºåˆå§‹åŒ– m.Fun[0]</span>
	<span class="token keyword">var</span> fun0 unsafe<span class="token punctuation">.</span>Pointer
imethods<span class="token punctuation">:</span>
    <span class="token comment">// éå†æ¥å£çš„æ‰€æœ‰æ–¹æ³•</span>
	<span class="token keyword">for</span> k <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> ni<span class="token punctuation">;</span> k<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// å½“å‰æ¥å£æ–¹æ³•çš„æè¿°</span>
		i <span class="token operator">:=</span> <span class="token operator">&amp;</span>inter<span class="token punctuation">.</span>Methods<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
        <span class="token comment">// å½“å‰æ¥å£æ–¹æ³•çš„ç±»å‹</span>
		itype <span class="token operator">:=</span> <span class="token function">toRType</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>inter<span class="token punctuation">.</span>Type<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">typeOff</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>Typ<span class="token punctuation">)</span>
        <span class="token comment">// å½“å‰æ¥å£æ–¹æ³•çš„åç§°</span>
		name <span class="token operator">:=</span> <span class="token function">toRType</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>inter<span class="token punctuation">.</span>Type<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nameOff</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
        <span class="token comment">// å½“å‰æ¥å£æ–¹æ³•çš„åç§°å­—ç¬¦ä¸²</span>
		iname <span class="token operator">:=</span> name<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// å½“å‰æ¥å£æ–¹æ³•çš„åŒ…è·¯å¾„</span>
		ipkg <span class="token operator">:=</span> <span class="token function">pkgPath</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
		<span class="token keyword">if</span> ipkg <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">{<!-- --></span>
			ipkg <span class="token operator">=</span> inter<span class="token punctuation">.</span>PkgPath<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
        <span class="token comment">// éå†å…·ä½“ç±»å‹çš„æ‰€æœ‰æ–¹æ³•ï¼Œå°è¯•æ‰¾åˆ°åŒ¹é…çš„æ¥å£æ–¹æ³•</span>
		<span class="token keyword">for</span> <span class="token punctuation">;</span> j <span class="token operator">&lt;</span> nt<span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// å½“å‰å…·ä½“ç±»å‹æ–¹æ³•çš„æè¿°</span>
			t <span class="token operator">:=</span> <span class="token operator">&amp;</span>xmhdr<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
            <span class="token comment">// å½“å‰å…·ä½“ç±»å‹çš„ç±»å‹ä¿¡æ¯</span>
			rtyp <span class="token operator">:=</span> <span class="token function">toRType</span><span class="token punctuation">(</span>typ<span class="token punctuation">)</span>
            <span class="token comment">// å½“å‰å…·ä½“ç±»å‹æ–¹æ³•çš„åç§°</span>
			tname <span class="token operator">:=</span> rtyp<span class="token punctuation">.</span><span class="token function">nameOff</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
            
            <span class="token comment">// ä¸‹é¢å¼€å§‹çœŸæ­£çš„åŒ¹é…åŠ¨ä½œ</span>
            <span class="token comment">// åŒ¹é…æ¡ä»¶ï¼š1. æ–¹æ³•ç±»å‹åŒ¹é…</span>
            <span class="token comment">// 2. æ–¹æ³•ååŒ¹é…</span>
            <span class="token comment">// 3. åŒ…è·¯å¾„åŒ¹é…</span>
			<span class="token keyword">if</span> rtyp<span class="token punctuation">.</span><span class="token function">typeOff</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>Mtyp<span class="token punctuation">)</span> <span class="token operator">==</span> itype <span class="token operator">&amp;&amp;</span> tname<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> iname <span class="token punctuation">{<!-- --></span>
				pkgPath <span class="token operator">:=</span> <span class="token function">pkgPath</span><span class="token punctuation">(</span>tname<span class="token punctuation">)</span>
				<span class="token keyword">if</span> pkgPath <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">{<!-- --></span>
					pkgPath <span class="token operator">=</span> rtyp<span class="token punctuation">.</span><span class="token function">nameOff</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>PkgPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> tname<span class="token punctuation">.</span><span class="token function">IsExported</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> pkgPath <span class="token operator">==</span> ipkg <span class="token punctuation">{<!-- --></span>
					ifn <span class="token operator">:=</span> rtyp<span class="token punctuation">.</span><span class="token function">textOff</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>Ifn<span class="token punctuation">)</span>
                    <span class="token comment">// å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œå­˜å‚¨å‡½æ•°æŒ‡é’ˆåˆ° fun0</span>
					<span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
						fun0 <span class="token operator">=</span> ifn <span class="token comment">// we'll set m.Fun[0] at the end</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> firstTime <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå­˜å‚¨å‡½æ•°æŒ‡é’ˆåˆ° methods[k]</span>
						methods<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> ifn
					<span class="token punctuation">}</span>
					<span class="token keyword">continue</span> imethods
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// didn't find method</span>
		<span class="token comment">// Leaves m.Fun[0] set to 0.</span>
        <span class="token comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–¹æ³•ï¼Œè¿”å›ç¼ºå¤±æ–¹æ³•çš„åç§°</span>
        <span class="token comment">// m.Fun[0] ä¿æŒä¸º 0ï¼Œå…¶å®å°±æ˜¯è¡¨ç¤ºäº†æ¥å£çš„ç¬¬ä¸€ä¸ªæ–¹æ³•æœªè¢«åŠ è½½</span>
		<span class="token keyword">return</span> iname
	<span class="token punctuation">}</span>
    
    <span class="token comment">// å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡åˆå§‹åŒ–ï¼Œè®¾ç½® m.Fun[0] ä¸ºç¬¬ä¸€ä¸ªæ–¹æ³•çš„å‡½æ•°æŒ‡é’ˆ</span>
	<span class="token keyword">if</span> firstTime <span class="token punctuation">{<!-- --></span>
		m<span class="token punctuation">.</span>Fun<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>fun0<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
    <span class="token comment">// è¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºåˆå§‹åŒ–æˆåŠŸ</span>
	<span class="token keyword">return</span> <span class="token string">""</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_830">
     </a>
     å¸¸è§æ“ä½œåŸç†
    </h4>
    <h5>
     <a id="_832">
     </a>
     å¤šæ€æ€§
    </h5>
    <p>
     å½“ä¸€ä¸ªå˜é‡è¢«å£°æ˜ä¸ºæ¥å£ç±»å‹æ—¶ï¼Œ
     <code>
      golang
     </code>
     è¿è¡Œæ—¶ä¼šåŠ¨æ€åœ°ç®¡ç†æ¥å£çš„è°ƒç”¨é€»è¾‘ã€‚ä¸»è¦åˆ†ä¸ºä¸¤é˜¶æ®µï¼š
     <strong>
      æ¥å£èµ‹å€¼
     </strong>
     å’Œ
     <strong>
      æ–¹æ³•è°ƒç”¨
     </strong>
     ã€‚
    </p>
    <blockquote>
     <p>
      è¿™é‡Œçš„å¤šæ€æ€§ä¸»è¦è®¨è®ºçš„æ˜¯éç©ºæ¥å£ã€‚
     </p>
    </blockquote>
    <h6>
     <a id="_838">
     </a>
     æ¥å£èµ‹å€¼
    </h6>
    <p>
     å½“ä¸€ä¸ªå…·ä½“ç±»å‹è¢«èµ‹å€¼ç»™æ¥å£å˜é‡æ—¶ï¼Œ
     <code>
      golang
     </code>
     è¿è¡Œæ—¶ä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
    </p>
    <ul>
     <li>
      é¦–å…ˆï¼Œæ£€æŸ¥è¯¥ç±»å‹æ˜¯å¦å®ç°äº†æ¥å£ã€‚
     </li>
     <li>
      å¦‚æœå®ç°äº†æ¥å£ï¼Œè¿è¡Œæ—¶ä¼šåˆ›å»ºä¸€ä¸ª
      <code>
       itab
      </code>
      ï¼Œå¹¶å°†æ¥å£ç±»å‹å’Œå…·ä½“ç±»å‹å…³è”èµ·æ¥ã€‚
     </li>
     <li>
      æ¥å£å˜é‡ä¼šå­˜å‚¨æŒ‡å‘
      <code>
       itab
      </code>
      çš„æŒ‡é’ˆå’Œå…·ä½“ç±»å‹çš„å€¼ã€‚
     </li>
    </ul>
    <h6>
     <a id="_846">
     </a>
     æ–¹æ³•è°ƒç”¨
    </h6>
    <p>
     å½“è°ƒç”¨æ¥å£æ–¹æ³•æ—¶ï¼Œ
     <code>
      golang
     </code>
     è¿è¡Œæ—¶ä¼šé€šè¿‡ä»¥ä¸‹æ­¥éª¤æ‰¾åˆ°å…·ä½“çš„æ–¹æ³•å®ç°ï¼š
    </p>
    <ul>
     <li>
      é€šè¿‡æ¥å£å˜é‡çš„
      <code>
       itab
      </code>
      æŒ‡é’ˆæ‰¾åˆ°å¯¹åº”çš„
      <code>
       itab
      </code>
      ã€‚
     </li>
     <li>
      åœ¨
      <code>
       itab
      </code>
      çš„æ–¹æ³•è¡¨
      <code>
       Fun
      </code>
      ä¸­æŸ¥æ‰¾æ–¹æ³•çš„å‡½æ•°æŒ‡é’ˆã€‚
     </li>
     <li>
      è°ƒç”¨å‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„å…·ä½“æ–¹æ³•ã€‚
     </li>
    </ul>
    <h6>
     <a id="_854">
     </a>
     ä»£ç ç¤ºä¾‹
    </h6>
    <p>
     ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼Œå±•ç¤ºæ¥å£å¤šæ€çš„å®ç°ï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">type</span> Animal <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Cat <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> p<span class="token punctuation">.</span>Name
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Cat<span class="token punctuation">)</span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> c<span class="token punctuation">.</span>Name
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> p Animal <span class="token operator">=</span> <span class="token operator">&amp;</span>Person<span class="token punctuation">{<!-- --></span>Name<span class="token punctuation">:</span> <span class="token string">"ycz"</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ycz</span>

	p <span class="token operator">=</span> <span class="token operator">&amp;</span>Cat<span class="token punctuation">{<!-- --></span>Name<span class="token punctuation">:</span> <span class="token string">"ccc"</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ccc</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     å°†ä¸Šè¿°ä»£ç ç¼–è¯‘æˆæ±‡ç¼–ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-assembly"># ...

# åˆ†é…å†…å­˜
0x001a 00026      LEAQ    type:main.Person(SB), AX
0x0021 00033      PCDATA  $1, $0
0x0021 00033      CALL    runtime.newobject(SB)
0x0026 00038      MOVQ    AX, main..autotmp_5+88(SP)

# åˆå§‹åŒ– Person å¯¹è±¡
0x002b 00043      MOVQ    $3, 8(AX)
0x0033 00051      CMPL    runtime.writeBarrier(SB), $0
0x003a 00058      PCDATA  $0, $-2
0x003a 00058      JEQ     64
0x003c 00060      JMP     66
0x003e 00062      NOP
0x0040 00064      JMP     79
0x0042 00066      MOVQ    (AX), CX
0x0045 00069      CALL    runtime.gcWriteBarrier1(SB)
0x004a 00074      MOVQ    CX, (R11)
0x004d 00077      JMP     79
0x004f 00079      LEAQ    go:string."ycz"(SB), CX
0x0056 00086      MOVQ    CX, (AX)

# ... 

# æ¥å£èµ‹å€¼
0x0075 00117      LEAQ    go:itab.*main.Person,main.Animal(SB), CX
# æ›´æ–° itab æŒ‡é’ˆ
0x007c 00124      MOVQ    CX, main.p+24(SP)
# æ›´æ–° data æŒ‡é’ˆ
0x0081 00129      MOVQ    AX, main.p+32(SP)
# è°ƒç”¨ main.(*Person).GetName æ–¹æ³•
0x0086 00134      CALL    main.(*Person).GetName(SB)
0x008b 00139      MOVQ    AX, main..autotmp_2+120(SP)
0x0090 00144      MOVQ    BX, main..autotmp_2+128(SP)
0x0098 00152      MOVUPS  X15, main..autotmp_3+104(SP)
0x009e 00158      LEAQ    main..autotmp_3+104(SP), CX
0x00a3 00163      MOVQ    CX, main..autotmp_7+56(SP)
0x00a8 00168      MOVQ    main..autotmp_2+120(SP), AX
0x00ad 00173      MOVQ    main..autotmp_2+128(SP), BX
0x00b5 00181      PCDATA  $1, $1
# å°†æ–¹æ³•è¿”å›çš„ç»“æœè½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹
0x00b5 00181      CALL    runtime.convTstring(SB)

# ...

# è¾“å‡ºç»“æœ
0x0120 00288      CALL    fmt.Println(SB)

# åˆ›å»ºå¦ä¸€ä¸ªå¯¹è±¡ Cat
0x0125 00293      LEAQ    type:main.Cat(SB), AX
# åˆ†é…å†…å­˜å¹¶å­˜å‚¨å¯¹è±¡åœ°å€
0x012c 00300      CALL    runtime.newobject(SB)
0x0131 00305      MOVQ    AX, main..autotmp_9+40(SP)
0x0136 00310      MOVQ    $3, 8(AX)
0x013e 00318      CMPL    runtime.writeBarrier(SB), $0
0x0145 00325      PCDATA  $0, $-2
0x0145 00325      JEQ     329
0x0147 00327      JMP     331
0x0149 00329      JMP     344
0x014b 00331      MOVQ    (AX), CX
0x014e 00334      CALL    runtime.gcWriteBarrier1(SB)
0x0153 00339      MOVQ    CX, (R11)
0x0156 00342      JMP     344
0x0158 00344      LEAQ    go:string."ccc"(SB), CX
0x015f 00351      MOVQ    CX, (AX)
0x0162 00354      PCDATA  $0, $-1
0x0162 00354      MOVQ    main..autotmp_9+40(SP), CX
0x0167 00359      TESTB   AL, (CX)
0x0169 00361      MOVQ    $1, 16(CX)
0x0171 00369      MOVQ    main..autotmp_9+40(SP), AX
0x0176 00374      MOVQ    AX, main..autotmp_4+96(SP)
# å°† Cat å¯¹è±¡èµ‹å€¼ç»™æ¥å£å˜é‡
0x017b 00379      LEAQ    go:itab.*main.Cat,main.Animal(SB), CX
# æ›´æ–° itab æŒ‡é’ˆ
0x0182 00386      MOVQ    CX, main.p+24(SP)
# æ›´æ–° data æŒ‡é’ˆ
0x0187 00391      MOVQ    AX, main.p+32(SP)
# è°ƒç”¨ main.(*Cat).GetName æ–¹æ³•
0x018c 00396      CALL    main.(*Cat).GetName(SB)

# ...

# å°†æ–¹æ³•è¿”å›çš„ç»“æœè½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹
0x01c0 00448      CALL    runtime.convTstring(SB)

# ...

# è¾“å‡ºç»“æœ
0x023a 00570      CALL    fmt.Println(SB)

# å‡½æ•°ç»“æŸï¼Œè¿”å›
0x023f 00575      ADDQ    $184, SP
0x0246 00582      POPQ    BP
0x0247 00583      RET

# ...
</code></pre>
    <blockquote>
     <p>
      ä»¥ä¸Šæ±‡ç¼–ä»£ç åªæ˜¯éƒ¨åˆ†æˆªå–ï¼Œè¯·æ³¨æ„ç”„åˆ«ã€‚
     </p>
    </blockquote>
    <p>
     ä»ä»¥ä¸Šæ±‡ç¼–ä»£ç å°±å¯ä»¥çœ‹å‡ºï¼Œå½“æ¥å£å˜é‡çš„ç±»å‹åˆ‡æ¢æ—¶ä¼šæ›´æ–°
     <code>
      itab
     </code>
     æŒ‡é’ˆå’Œ
     <code>
      data
     </code>
     æŒ‡é’ˆï¼Œåç»­è°ƒç”¨æ–¹æ³•æ—¶ï¼Œç›´æ¥æ ¹æ®
     <code>
      itab
     </code>
     æŒ‡é’ˆæ‰¾åˆ°å¯¹åº”æ–¹æ³•è¡¨ï¼Œå†ä»æ–¹æ³•è¡¨ä¸­æ ¹æ®å‡½æ•°çš„æ¬¡åºå®šä½åˆ°å…·ä½“çš„å‡½æ•°ï¼ˆå¾—åˆ°å‡½æ•°æŒ‡é’ˆï¼‰ï¼Œå†æ ¹æ®å‡½æ•°æŒ‡é’ˆæ‰§è¡Œå…·ä½“çš„æ–¹æ³•ã€‚è¿™ç§æœºåˆ¶ä½¿å¾—æ¥å£å˜é‡å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ‡æ¢ç±»å‹ï¼ŒåŒæ—¶ä¿æŒé«˜æ•ˆçš„æ€§èƒ½å’Œçµæ´»çš„å¤šæ€æ€§ã€‚
    </p>
    <h5>
     <a id="_999">
     </a>
     ç±»å‹æ–­è¨€
    </h5>
    <p>
     ä¸‹é¢ç»™å‡ºä¸€ä¸ªä½¿ç”¨æ¥å£è¿›è¡Œç±»å‹æ–­è¨€çš„ä¾‹å­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">func</span> <span class="token function">someFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token number">10</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> v <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">someFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> i<span class="token punctuation">,</span> ok <span class="token operator">:=</span> v<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{<!-- --></span>
		<span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// 10</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     å°†ä¸Šé¢çš„ä»£ç ç¼–è¯‘æˆæ±‡ç¼–ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-assembly"># ...
# è°ƒç”¨ someFunction å‡½æ•°å¹¶èµ‹å€¼ç»™ v
# AX å¯„å­˜å™¨å­˜å‚¨æ¥å£çš„ç±»å‹ä¿¡æ¯
# BX å¯„å­˜å™¨å­˜å‚¨æ¥å£çš„æ•°æ®æŒ‡é’ˆ
0x0012 00018       CALL    main.someFunction(SB)
0x0017 00023       MOVQ    AX, main.v+40(SP)
0x001c 00028       MOVQ    BX, main.v+48(SP)

# ç±»å‹æ–­è¨€çš„è¿è¡Œæ—¶æ£€æŸ¥
# å°† int ç±»å‹çš„åœ°å€åŠ è½½åˆ°å¯„å­˜å™¨ CX
0x0021 00033       LEAQ    type:int(SB), CX
# æ¯”è¾ƒ v çš„ç±»å‹ä¿¡æ¯ä¸ç›®æ ‡ç±»å‹ int çš„ç±»å‹ä¿¡æ¯
0x0028 00040       CMPQ    AX, CX
# å¦‚æœç±»å‹åŒ¹é…è·³è½¬åˆ°æˆåŠŸåˆ†æ”¯åœ°å€ 47
0x002b 00043       JEQ     47
# å¦‚æœç±»å‹ä¸åŒ¹é…è·³è½¬åˆ°å¤±è´¥åˆ†æ”¯åœ°å€ 57
0x002d 00045       JMP     57

# ç±»å‹æ–­è¨€æˆåŠŸåˆ†æ”¯
# å°† v çš„æ•°æ®æŒ‡é’ˆï¼ˆå­˜å‚¨10ï¼‰æŒ‡å‘çš„å®é™…å€¼åŠ è½½åˆ°å¯„å­˜å™¨ AX
0x002f 00047       MOVQ    (BX), AX
# å°† 1 èµ‹å€¼ç»™å¯„å­˜å™¨ CXï¼Œè¡¨ç¤º ok ä¸º true
0x0032 00050       MOVL    $1, CX
# è·³è½¬åˆ°åç»­çš„èµ‹å€¼é€»è¾‘
0x0037 00055       JMP     63

# ç±»å‹æ–­è¨€å¤±è´¥åˆ†æ”¯
# å°†å¯„å­˜å™¨ AX å’Œ CX æ¸…é›¶
# AX è¡¨ç¤º i çš„å€¼ï¼Œæ¸…é›¶è¡¨ç¤º i ä¸º 0
# CX è¡¨ç¤º ok çš„å€¼ï¼Œæ¸…é›¶è¡¨ç¤º ok ä¸º false
0x0039 00057       XORL    AX, AX
0x003b 00059       XORL    CX, CX
# è·³è½¬åˆ°åç»­çš„èµ‹å€¼é€»è¾‘
0x003d 00061       JMP     63

# å°†å¯„å­˜å™¨ä¸­çš„å€¼èµ‹å€¼ç»™æ ˆä¸Šçš„ä¸´æ—¶å˜é‡ï¼Œæœ€ç»ˆèµ‹å€¼ç»™ i å’Œ ok
# ...
# i çš„å€¼
0x0060 00096       MOVQ    AX, main.i+16(SP)
# ...
# ok çš„å€¼
0x006a 00106       MOVB    AL, main.ok+13(SP)

# æµ‹è¯• ok çš„å€¼
0x006e 00110       TESTB   AL, AL
# å¦‚æœ ok ä¸º trueï¼Œè·³è½¬åˆ°æ‰“å°é€»è¾‘
0x0070 00112       JNE     116
# å¦‚æœ ok ä¸º falseï¼Œè·³è¿‡æ‰“å°é€»è¾‘ï¼Œç›´æ¥ç»“æŸå‡½æ•°
0x0072 00114       JMP     140

# æ‰“å°é€»è¾‘
# å¦‚æœç±»å‹æ–­è¨€æˆåŠŸï¼Œåˆ™è°ƒç”¨ runtime.printint æ‰“å° i çš„å€¼
0x0074 00116       CALL    runtime.printlock(SB)
0x0079 00121       MOVQ    main.i+16(SP), AX
0x007e 00126       NOP
0x0080 00128       CALL    runtime.printint(SB)
0x0085 00133       CALL    runtime.printunlock(SB)

# ç»“æŸå‡½æ•°
# ...
0x008c 00140       JMP     142
0x008e 00142       ADDQ    $56, SP
0x0092 00146       POPQ    BP
0x0093 00147       RET
# ...
</code></pre>
    <blockquote>
     <p>
      ä»¥ä¸Šæ±‡ç¼–ä»£ç åªæ˜¯éƒ¨åˆ†æˆªå–ï¼Œè¯·æ³¨æ„ç”„åˆ«ã€‚
     </p>
    </blockquote>
    <p>
     ä»”ç»†è§‚å¯Ÿç”Ÿæˆçš„æ±‡ç¼–ä»£ç ä¹‹åï¼Œä¸éš¾å‘ç°é—®é¢˜æ‰€åœ¨ï¼šæ±‡ç¼–ä»£ç ä¸­å¹¶æ²¡æœ‰è°ƒç”¨
     <code>
      getitab
     </code>
     å‡½æ•°ä»å…¨å±€
     <code>
      itab
     </code>
     è¡¨ä¸­è¿›è¡Œè·å–
     <code>
      itab
     </code>
     è¿›è¡Œæ¥å£åˆ¤æ–­ã€‚
     <strong>
      ä½†æ˜¯ï¼Œå®é™…ä¸Š
      <code>
       golang
      </code>
      ç¼–è¯‘å™¨åœ¨å¤„ç†ç±»å‹æ–­è¨€æ—¶ï¼Œå¯¹äºä¸€äº›ç®€å•çš„æƒ…å†µï¼Œç¼–è¯‘å™¨å¯èƒ½ä¼šç›´æ¥å†…è”ç›¸å…³é€»è¾‘ï¼Œç”Ÿæˆæ–­è¨€ç±»å‹ç›®æ ‡çš„ä»£ç ï¼Œä»è€Œç›´æ¥åˆ¤æ–­æ˜¯å¦ä¸æ–­è¨€ç›®æ ‡ç±»å‹æ˜¯å¦åŒ¹é…ï¼Œè€Œä¸æ˜¯è°ƒç”¨
      <code>
       getitab
      </code>
      å‡½æ•°ã€‚è¿™æ ·ä¼šå‡å°‘è¿è¡Œæ—¶é¢å¤–çš„å¼€é”€
     </strong>
     ã€‚
    </p>
    <p>
     å¦‚æœå°†ä»¥ä¸Šç®€å•ç±»å‹æ–­è¨€ä»£ç æ”¹ä¸ºé‡‡ç”¨æ¥å£æ–­è¨€ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">type</span> Animal <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
	<span class="token function">GetAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span>
	<span class="token function">SetName</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token function">SetAge</span><span class="token punctuation">(</span>age <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> p<span class="token punctuation">.</span>Name
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">GetAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> p<span class="token punctuation">.</span>Age
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">SetName</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{<!-- --></span>
	p<span class="token punctuation">.</span>Name <span class="token operator">=</span> name
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">SetAge</span><span class="token punctuation">(</span>age <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{<!-- --></span>
	p<span class="token punctuation">.</span>Age <span class="token operator">=</span> age
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> p Animal <span class="token operator">=</span> <span class="token operator">&amp;</span>Person<span class="token punctuation">{<!-- --></span>Name<span class="token punctuation">:</span> <span class="token string">"ycz"</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span>
	<span class="token keyword">if</span> v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> p<span class="token punctuation">.</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%v\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     å°†ä»¥ä¸Šä»£ç ç¼–è¯‘æˆæ±‡ç¼–ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-assembly"># ...

# åˆ›å»º Person å¯¹è±¡
0x001a 00026      LEAQ    type:main.Person(SB), AX
# ...
0x0021 00033      CALL    runtime.newobject(SB)
0x0026 00038      MOVQ    AX, main..autotmp_9+80(SP)
0x002b 00043      MOVQ    $3, 8(AX)

# ...

# åˆå§‹åŒ– Person å¯¹è±¡çš„å­—æ®µ
0x004f 00079      LEAQ    go:string."ycz"(SB), DX
0x0056 00086      MOVQ    DX, (AX)
0x0059 00089      PCDATA  $0, $-1
0x0059 00089      MOVQ    main..autotmp_9+80(SP), DX
0x005e 00094      TESTB   AL, (DX)
0x0060 00096      MOVQ    $18, 16(DX)

# å°† Person å¯¹è±¡èµ‹å€¼ç»™æ¥å£å˜é‡ p
0x0068 00104      MOVQ    main..autotmp_9+80(SP), DX
0x006d 00109      MOVQ    DX, main..autotmp_5+120(SP)
# åŠ è½½ Person ç±»å‹å’Œ Animal æ¥å£çš„ itab åœ°å€åˆ°å¯„å­˜å™¨ R8
0x0072 00114      LEAQ    go:itab.*main.Person,main.Animal(SB), R8
0x0079 00121      MOVQ    R8, main.p+64(SP)
0x007e 00126      MOVQ    DX, main.p+72(SP)


# ç±»å‹æ–­è¨€é€»è¾‘
0x0083 00131      MOVUPS  X15, main..autotmp_6+104(SP)
0x0089 00137      MOVQ    main.p+64(SP), DX
0x008e 00142      MOVQ    main.p+72(SP), R8
# æ£€æŸ¥ç±»å‹ä¿¡æ¯æ˜¯å¦ä¸ºé›¶
0x0093 00147      TESTQ   DX, DX
# å¦‚æœç±»å‹ä¿¡æ¯ä¸ä¸ºé›¶ï¼Œè·³è½¬åˆ°åœ°å€ 154
0x0096 00150      JNE     154
# å¦‚æœç±»å‹ä¿¡æ¯ä¸ºé›¶ï¼Œè·³è½¬åˆ°åœ°å€ 192
0x0098 00152      JMP     192

# è°ƒç”¨ runtime.typeAssert è¿›è¡Œç±»å‹æ–­è¨€
0x009a 00154      MOVQ    R8, main..autotmp_14+144(SP)
0x00a2 00162      MOVQ    8(DX), BX
0x00a6 00166      LEAQ    main..typeAssert.0(SB), AX
0x00ad 00173      PCDATA  $1, $1
0x00ad 00173      CALL    runtime.typeAssert(SB)
0x00b2 00178      MOVQ    main..autotmp_14+144(SP), R8
0x00ba 00186      MOVQ    AX, DX
0x00bd 00189      JMP     194
0x00bf 00191      NOP

# ç±»å‹æ–­è¨€ç»“æœå¤„ç†
# ... 

# å‡½æ•°ç»“æŸï¼Œè¿”å›
0x0209 00521      ADDQ    $208, SP
0x0210 00528      POPQ    BP
0x0211 00529      RET
# ...
</code></pre>
    <blockquote>
     <p>
      ä»¥ä¸Šæ±‡ç¼–ä»£ç åªæ˜¯éƒ¨åˆ†æˆªå–ï¼Œè¯·æ³¨æ„ç”„åˆ«ã€‚
     </p>
    </blockquote>
    <p>
     æ±‡ç¼–ä»£ç ä¸­æœ€ä¸ºå…³é”®çš„ä¸€æ­¥å°±æ˜¯è¿è¡Œæ—¶è°ƒç”¨äº†
     <code>
      typeAssert
     </code>
     è¿›è¡Œç±»å‹æ–­è¨€ï¼Œé‚£ä¹ˆä¸‹é¢ç»§ç»­è·Ÿè¸ªæºç ã€‚
    </p>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/runtime/iface.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token comment">// typeAssert builds an itab for the concrete type t and the</span>
<span class="token comment">// interface type s.Inter. If the conversion is not possible it</span>
<span class="token comment">// panics if s.CanFail is false and returns nil if s.CanFail is true.</span>
<span class="token keyword">func</span> <span class="token function">typeAssert</span><span class="token punctuation">(</span>s <span class="token operator">*</span>abi<span class="token punctuation">.</span>TypeAssert<span class="token punctuation">,</span> t <span class="token operator">*</span>_type<span class="token punctuation">)</span> <span class="token operator">*</span>itab <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> tab <span class="token operator">*</span>itab
    <span class="token comment">// å¦‚æœå…·ä½“ç±»å‹ t ä¸º nilï¼Œå¹¶ä¸” s.CanFail ä¸º falseï¼Œåˆ™æŠ›å‡ºç±»å‹æ–­è¨€é”™è¯¯</span>
	<span class="token keyword">if</span> t <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token operator">!</span>s<span class="token punctuation">.</span>CanFail <span class="token punctuation">{<!-- --></span>
			<span class="token function">panic</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>TypeAssertionError<span class="token punctuation">{<!-- --></span><span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>s<span class="token punctuation">.</span>Inter<span class="token punctuation">.</span>Type<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// å…·ä½“ç±»å‹ t ä¸ä¸º nilï¼Œåˆ™è°ƒç”¨ getitab å‡½æ•°ï¼Œå°è¯•è·å–æˆ–ç”Ÿæˆä¸€ä¸ª itab</span>
		tab <span class="token operator">=</span> <span class="token function">getitab</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>Inter<span class="token punctuation">,</span> t<span class="token punctuation">,</span> s<span class="token punctuation">.</span>CanFail<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

    <span class="token comment">// å¦‚æœå½“å‰æ¶æ„ä¸æ”¯æŒæ¥å£åˆ‡æ¢ç¼“å­˜ï¼Œåˆ™ç›´æ¥è¿”å› itab</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>abi<span class="token punctuation">.</span><span class="token function">UseInterfaceSwitchCache</span><span class="token punctuation">(</span>GOARCH<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> tab
	<span class="token punctuation">}</span>

	<span class="token comment">// Maybe update the cache, so the next time the generated code</span>
	<span class="token comment">// doesn't need to call into the runtime.</span>
    <span class="token comment">// ä½¿ç”¨ cheaprand ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œåªæœ‰å½“éšæœºæ•°æ»¡è¶³æ¡ä»¶æ—¶ï¼Œæ‰å°è¯•æ›´æ–°ç¼“å­˜</span>
    <span class="token comment">// è¿™æ˜¯ä¸ºäº†å‡å°‘æ›´æ–°ç¼“å­˜çš„é¢‘ç‡ï¼Œé¿å…é¢‘ç¹æ›´æ–°å¸¦æ¥çš„æ€§èƒ½å¼€é”€</span>
	<span class="token keyword">if</span> <span class="token function">cheaprand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">1023</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// Only bother updating the cache ~1 in 1000 times.</span>
		<span class="token keyword">return</span> tab
	<span class="token punctuation">}</span>
    
    <span class="token comment">// ä¸‹é¢æ˜¯æ›´æ–°ç¼“å­˜çš„é€»è¾‘</span>
    
	<span class="token comment">// Load the current cache.</span>
	oldC <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span>abi<span class="token punctuation">.</span>TypeAssertCache<span class="token punctuation">)</span><span class="token punctuation">(</span>atomic<span class="token punctuation">.</span><span class="token function">Loadp</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">.</span>Cache<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> <span class="token function">cheaprand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token function">uint32</span><span class="token punctuation">(</span>oldC<span class="token punctuation">.</span>Mask<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// As cache gets larger, choose to update it less often</span>
		<span class="token comment">// so we can amortize the cost of building a new cache.</span>
		<span class="token keyword">return</span> tab
	<span class="token punctuation">}</span>
    
    <span class="token comment">// å½“ä»£ç è¿è¡Œåˆ°è¿™ä¸€æ­¥çš„æ—¶å€™ï¼Œå°±éœ€è¦æ„å»ºä¸€ä¸ªæ–°çš„æ¥å£åˆ‡æ¢ç¼“å­˜å®ä¾‹</span>

	<span class="token comment">// Make a new cache.</span>
    <span class="token comment">// è°ƒç”¨ buildTypeAssertCache å‡½æ•°ï¼Œæ ¹æ®å½“å‰ç¼“å­˜ oldCã€å…·ä½“ç±»å‹ t å’Œ itab æ„å»ºä¸€ä¸ªæ–°çš„ç¼“å­˜</span>
	newC <span class="token operator">:=</span> <span class="token function">buildTypeAssertCache</span><span class="token punctuation">(</span>oldC<span class="token punctuation">,</span> t<span class="token punctuation">,</span> tab<span class="token punctuation">)</span>

	<span class="token comment">// Update cache. Use compare-and-swap so if multiple threads</span>
	<span class="token comment">// are fighting to update the cache, at least one of their</span>
	<span class="token comment">// updates will stick.</span>
    <span class="token comment">// ä½¿ç”¨åŸå­æ“ä½œæ›´æ–°ç¼“å­˜</span>
	<span class="token function">atomic_casPointer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>unsafe<span class="token punctuation">.</span>Pointer<span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">.</span>Cache<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>oldC<span class="token punctuation">)</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>newC<span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> tab
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <code>
      TypeAssertCache
     </code>
     ç”¨äºä¼˜åŒ–ç±»å‹æ–­è¨€çš„æ€§èƒ½ã€‚ç¼“å­˜å…·ä½“ç±»å‹å’Œå¯¹åº”çš„
     <code>
      itab
     </code>
     ï¼Œä»¥ä¾¿å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªæ¥å£å˜é‡æ˜¯å¦å¯ä»¥æ–­è¨€ä¸ºæŸä¸ªå…·ä½“ç±»å‹ã€‚ä¸‹é¢ä»‹ç»ä¸‰ä¸ªæ ¸å¿ƒçš„ç¼“å­˜ç»“æ„ä½“ï¼š
     <code>
      TypeAssert
     </code>
     ã€
     <code>
      TypeAssertCache
     </code>
     ã€
     <code>
      TypeAssertCacheEntry
     </code>
     ã€‚
    </p>
    <h6>
     <a id="TypeAssert_1265">
     </a>
     <code>
      TypeAssert
     </code>
    </h6>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/internal/abi/switch.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token keyword">type</span> TypeAssert <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Cache   <span class="token operator">*</span>TypeAssertCache
	Inter   <span class="token operator">*</span>InterfaceType
	CanFail <span class="token builtin">bool</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <code>
       Cache
      </code>
      ï¼šæŒ‡å‘
      <code>
       TypeAssertCache
      </code>
      ï¼Œè¿™æ˜¯ä¸€ä¸ªç¼“å­˜ç»“æ„ï¼Œç”¨äºå­˜å‚¨ç±»å‹æ–­è¨€çš„ç»“æœã€‚ç¼“å­˜çš„ç›®çš„æ˜¯å‡å°‘è¿è¡Œæ—¶çš„é‡å¤è®¡ç®—ï¼Œæé«˜ç±»å‹æ–­è¨€çš„æ€§èƒ½ã€‚
     </li>
     <li>
      <code>
       Inter
      </code>
      ï¼šæŒ‡å‘
      <code>
       InterfaceType
      </code>
      ï¼Œè¡¨ç¤ºç›®æ ‡æ¥å£ç±»å‹ã€‚è¿™ä¸ªå­—æ®µç”¨äºè®°å½•ç±»å‹æ–­è¨€çš„ç›®æ ‡æ¥å£ç±»å‹ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚
     </li>
     <li>
      <code>
       CanFail
      </code>
      ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºç±»å‹æ–­è¨€æ˜¯å¦å…è®¸å¤±è´¥ã€‚å¦‚æœ
      <code>
       CanFail
      </code>
      ä¸º
      <code>
       true
      </code>
      ï¼Œç±»å‹æ–­è¨€å¤±è´¥æ—¶ä¼šè¿”å›
      <code>
       nil
      </code>
      ï¼›å¦‚æœ
      <code>
       CanFail
      </code>
      ä¸º
      <code>
       false
      </code>
      ï¼Œç±»å‹æ–­è¨€å¤±è´¥æ—¶ä¼šæŠ›å‡ºé”™è¯¯ã€‚
     </li>
    </ul>
    <h6>
     <a id="TypeAssertCache_1281">
     </a>
     <code>
      TypeAssertCache
     </code>
    </h6>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/internal/abi/switch.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token keyword">type</span> TypeAssertCache <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Mask    <span class="token builtin">uintptr</span>
	Entries <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>TypeAssertCacheEntry
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <code>
       Mask
      </code>
      ï¼šç”¨äºè®¡ç®—ç¼“å­˜çš„å¤§å°å’Œç´¢å¼•ã€‚ç¼“å­˜çš„å¤§å°å§‹ç»ˆæ˜¯ 2 çš„å¹‚ï¼Œ
      <code>
       Mask
      </code>
      çš„å€¼ä¸º
      <code>
       size - 1
      </code>
      ï¼Œç”¨äºå¿«é€Ÿè®¡ç®—ç´¢å¼•ã€‚
     </li>
     <li>
      <code>
       Entries
      </code>
      ï¼šç¼“å­˜æ¡ç›®æ•°ç»„ï¼Œåˆå§‹å¤§å°ä¸º 1ã€‚æ¯ä¸ªæ¡ç›®æ˜¯ä¸€ä¸ª
      <code>
       TypeAssertCacheEntry
      </code>
      ï¼Œå­˜å‚¨äº†å…·ä½“ç±»å‹å’Œå¯¹åº”çš„
      <code>
       itab
      </code>
      ã€‚
     </li>
    </ul>
    <h6>
     <a id="TypeAssertCacheEntry_1295">
     </a>
     <code>
      TypeAssertCacheEntry
     </code>
    </h6>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/internal/abi/switch.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token keyword">type</span> TypeAssertCacheEntry <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// type of source value (a *runtime._type)</span>
	Typ <span class="token builtin">uintptr</span>
	<span class="token comment">// itab to use for result (a *runtime.itab)</span>
	<span class="token comment">// nil if CanFail is set and conversion would fail.</span>
	Itab <span class="token builtin">uintptr</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <code>
       Typ
      </code>
      ï¼šå…·ä½“ç±»å‹çš„æŒ‡é’ˆã€‚ç”¨äºè®°å½•å…·ä½“ç±»å‹çš„ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨ç±»å‹æ–­è¨€æ—¶è¿›è¡Œæ¯”è¾ƒã€‚
     </li>
     <li>
      <code>
       Itab
      </code>
      ï¼š
      <code>
       itab
      </code>
      çš„æŒ‡é’ˆã€‚å¦‚æœ
      <code>
       CanFail
      </code>
      ä¸º
      <code>
       true
      </code>
      ä¸”ç±»å‹è½¬æ¢å¤±è´¥ï¼Œåˆ™ä¸º
      <code>
       nil
      </code>
      ã€‚ç”¨äºè®°å½•å…·ä½“ç±»å‹å’Œæ¥å£ç±»å‹çš„æ˜ å°„å…³ç³»ï¼Œä»¥ä¾¿åœ¨ç±»å‹æ–­è¨€æ—¶å¿«é€ŸæŸ¥æ‰¾ã€‚
     </li>
    </ul>
    <h6>
     <a id="buildTypeAssertCache_1312">
     </a>
     <code>
      buildTypeAssertCache
     </code>
    </h6>
    <p>
     æ„å»ºç±»å‹æ–­è¨€ç¼“å­˜ï¼Œæºç å¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/runtime/iface.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">buildTypeAssertCache</span><span class="token punctuation">(</span>oldC <span class="token operator">*</span>abi<span class="token punctuation">.</span>TypeAssertCache<span class="token punctuation">,</span> typ <span class="token operator">*</span>_type<span class="token punctuation">,</span> tab <span class="token operator">*</span>itab<span class="token punctuation">)</span> <span class="token operator">*</span>abi<span class="token punctuation">.</span>TypeAssertCache <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// å°†æ—§ç¼“å­˜çš„æ¡ç›®è½¬æ¢ä¸ºä¸€ä¸ªåˆ‡ç‰‡ï¼ŒåŒ…å«æ‰€æœ‰æ—§çš„ç¼“å­˜æ¡ç›®</span>
	oldEntries <span class="token operator">:=</span> unsafe<span class="token punctuation">.</span><span class="token function">Slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>oldC<span class="token punctuation">.</span>Entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> oldC<span class="token punctuation">.</span>Mask<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>

	<span class="token comment">// Count the number of entries we need.</span>
    <span class="token comment">// è®¡ç®—æ—§ç¼“å­˜ä¸­éç©ºæ¡ç›®çš„æ•°é‡ï¼ŒåŠ ä¸Šä¸€ä¸ªé¢å¤–çš„æ¡ç›®ç”¨äºç»ˆæ­¢</span>
	n <span class="token operator">:=</span> <span class="token number">1</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> e <span class="token operator">:=</span> <span class="token keyword">range</span> oldEntries <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> e<span class="token punctuation">.</span>Typ <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
			n<span class="token operator">++</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Figure out how big a table we need.</span>
	<span class="token comment">// We need at least one more slot than the number of entries</span>
	<span class="token comment">// so that we are guaranteed an empty slot (for termination).</span>
    <span class="token comment">// æ–°ç¼“å­˜çš„å¤§å°ï¼Œé€šå¸¸æ˜¯æ—§ç¼“å­˜å¤§å°çš„ä¸¤å€ï¼Œç¡®ä¿æ–°ç¼“å­˜çš„è´Ÿè½½å› å­ä¸è¶…è¿‡ 50%</span>
	newN <span class="token operator">:=</span> n <span class="token operator">*</span> <span class="token number">2</span>                         <span class="token comment">// make it at most 50% full</span>
    <span class="token comment">// è®¡ç®— newN-1 çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­çš„ä½æ•°ï¼Œç¡®ä¿æ–°ç¼“å­˜å¤§å°æ˜¯ 2 çš„å¹‚</span>
	newN <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> sys<span class="token punctuation">.</span><span class="token function">Len64</span><span class="token punctuation">(</span><span class="token function">uint64</span><span class="token punctuation">(</span>newN<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// round up to a power of 2</span>

	<span class="token comment">// Allocate the new table.</span>
    <span class="token comment">// è®¡ç®—æ–°ç¼“å­˜çš„æ€»å¤§å°ï¼ŒåŒ…æ‹¬ TypeAssertCache ç»“æ„ä½“å’Œæ‰€æœ‰æ¡ç›®çš„å¤§å°</span>
	newSize <span class="token operator">:=</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span>TypeAssertCache<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>newN<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span>TypeAssertCacheEntry<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// åˆ†é…å†…å­˜</span>
	newC <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span>abi<span class="token punctuation">.</span>TypeAssertCache<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">mallocgc</span><span class="token punctuation">(</span>newSize<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// è®¾ç½®æ–°ç¼“å­˜çš„æ©ç ï¼Œç”¨äºè®¡ç®—å“ˆå¸Œå€¼</span>
	newC<span class="token punctuation">.</span>Mask <span class="token operator">=</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>newN <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment">// å°†æ–°ç¼“å­˜çš„æ¡ç›®è½¬æ¢ä¸ºä¸€ä¸ªåˆ‡ç‰‡</span>
	newEntries <span class="token operator">:=</span> unsafe<span class="token punctuation">.</span><span class="token function">Slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newC<span class="token punctuation">.</span>Entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> newN<span class="token punctuation">)</span>

	<span class="token comment">// Fill the new table.</span>
    <span class="token comment">// å°†æ–°çš„ç¼“å­˜æ¡ç›®æ·»åŠ åˆ°æ–°ç¼“å­˜ä¸­</span>
	addEntry <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>typ <span class="token operator">*</span>_type<span class="token punctuation">,</span> tab <span class="token operator">*</span>itab<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		h <span class="token operator">:=</span> <span class="token function">int</span><span class="token punctuation">(</span>typ<span class="token punctuation">.</span>Hash<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>newN <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> newEntries<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>Typ <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
				newEntries<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>Typ <span class="token operator">=</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>typ<span class="token punctuation">)</span><span class="token punctuation">)</span>
				newEntries<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>Itab <span class="token operator">=</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>tab<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span>
			<span class="token punctuation">}</span>
			h <span class="token operator">=</span> <span class="token punctuation">(</span>h <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>newN <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
    <span class="token comment">// éå†æ—§ç¼“å­˜çš„æ¡ç›®ï¼Œå°†éç©ºæ¡ç›®å¤åˆ¶åˆ°æ–°ç¼“å­˜ä¸­</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> e <span class="token operator">:=</span> <span class="token keyword">range</span> oldEntries <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> e<span class="token punctuation">.</span>Typ <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">addEntry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>_type<span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Typ<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>itab<span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Itab<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
    <span class="token comment">// è°ƒç”¨ä¸Šé¢çš„ addEntry å‡½æ•°ï¼Œå°†æ–°çš„ç¼“å­˜æ¡ç›®æ·»åŠ åˆ°æ–°ç¼“å­˜ä¸­</span>
	<span class="token function">addEntry</span><span class="token punctuation">(</span>typ<span class="token punctuation">,</span> tab<span class="token punctuation">)</span>
	
    <span class="token comment">// è¿”å›æ–°çš„ç¼“å­˜ç¤ºä¾‹</span>
	<span class="token keyword">return</span> newC
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_1377">
     </a>
     ç±»å‹åˆ‡æ¢
    </h5>
    <p>
     åŸºäºç±»å‹åˆ‡æ¢å°ç»“ä¸­çš„ä»£ç ï¼Œå†ç»™å‡ºä¸€æ®µæ¥å£ç±»å‹åˆ‡æ¢çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">type</span> Animal <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
	<span class="token function">GetAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span>
	<span class="token function">SetName</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token function">SetAge</span><span class="token punctuation">(</span>age <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> p<span class="token punctuation">.</span>Name
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">GetAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> p<span class="token punctuation">.</span>Age
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">SetName</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{<!-- --></span>
	p<span class="token punctuation">.</span>Name <span class="token operator">=</span> name
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">SetAge</span><span class="token punctuation">(</span>age <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{<!-- --></span>
	p<span class="token punctuation">.</span>Age <span class="token operator">=</span> age
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> p Animal <span class="token operator">=</span> <span class="token operator">&amp;</span>Person<span class="token punctuation">{<!-- --></span>Name<span class="token punctuation">:</span> <span class="token string">"ycz"</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span>
	<span class="token keyword">switch</span> p <span class="token operator">:=</span> p<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> Animal<span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%v\n"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"default"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     å°†ä»¥ä¸Šä»£ç ç¼–è¯‘æˆæ±‡ç¼–ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <pre><code class="prism language-assembly"># ...

# åˆ›å»º Person å¯¹è±¡
0x001a 00026      LEAQ    type:main.Person(SB), AX
# ...
0x0021 00033      CALL    runtime.newobject(SB)
0x0026 00038      MOVQ    AX, main..autotmp_5+136(SP)
0x002e 00046      MOVQ    $3, 8(AX)

# ...

# åˆå§‹åŒ– Person å¯¹è±¡çš„å­—æ®µ
0x0051 00081      LEAQ    go:string."ycz"(SB), CX
0x0058 00088      MOVQ    CX, (AX)
0x005b 00091      PCDATA  $0, $-1
0x005b 00091      MOVQ    main..autotmp_5+136(SP), CX
0x0063 00099      TESTB   AL, (CX)
0x0065 00101      MOVQ    $18, 16(CX)
0x006d 00109      MOVQ    main..autotmp_5+136(SP), CX
0x0075 00117      MOVQ    CX, main..autotmp_3+160(SP)
# åŠ è½½ Person ç±»å‹å’Œ Animal æ¥å£çš„ itab åœ°å€åˆ°å¯„å­˜å™¨ DX
0x007d 00125      LEAQ    go:itab.*main.Person,main.Animal(SB), DX
0x0084 00132      MOVQ    DX, main.p+96(SP)
0x0089 00137      MOVQ    CX, main.p+104(SP)

# ...

# ç±»å‹æ–­è¨€é€»è¾‘
# åŠ è½½ Person ç±»å‹å’Œ Animal æ¥å£çš„ itab åœ°å€åˆ°å¯„å­˜å™¨ CX
0x009d 00157      MOVL    go:itab.*main.Person,main.Animal+16(SB), CX
0x00a3 00163      MOVL    CX, main..autotmp_9+44(SP)
0x00a7 00167      MOVQ    main..autotmp_6+120(SP), CX
0x00ac 00172      MOVQ    8(CX), BX
# åŠ è½½ç±»å‹æ–­è¨€çš„é”™è¯¯ä¿¡æ¯åœ°å€åˆ°å¯„å­˜å™¨ AX
0x00b0 00176      LEAQ    main..interfaceSwitch.0(SB), AX
0x00b7 00183      PCDATA  $1, $1
# è°ƒç”¨è¿è¡Œæ—¶çš„ interfaceSwitch å‡½æ•°ï¼Œè¿›è¡Œæ¥å£åˆ‡æ¢
0x00b7 00183      CALL    runtime.interfaceSwitch(SB)
0x00bc 00188      MOVQ    AX, main..autotmp_10+56(SP)
0x00c1 00193      MOVQ    BX, main..autotmp_8+112(SP)

# ç±»å‹æ–­è¨€ç»“æœå¤„ç†
# ...

# å‡½æ•°ç»“æŸï¼Œè¿”å›
0x023e 00574      ADDQ    $232, SP
0x0245 00581      POPQ    BP
0x0246 00582      RET
# ...
</code></pre>
    <blockquote>
     <p>
      ä»¥ä¸Šæ±‡ç¼–ä»£ç åªæ˜¯éƒ¨åˆ†æˆªå–ï¼Œè¯·æ³¨æ„ç”„åˆ«ã€‚
     </p>
    </blockquote>
    <p>
     æ±‡ç¼–ä»£ç ä¸­æœ€ä¸ºå…³é”®çš„ä¸€æ­¥å°±æ˜¯è¿è¡Œæ—¶è°ƒç”¨äº†
     <code>
      interfaceSwitch
     </code>
     è¿›è¡Œæ¥å£ç±»å‹åˆ‡æ¢ï¼Œé‚£ä¹ˆä¸‹é¢ç»§ç»­è·Ÿè¸ªæºç ã€‚
    </p>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/runtime/iface.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token comment">// interfaceSwitch compares t against the list of cases in s.</span>
<span class="token comment">// If t matches case i, interfaceSwitch returns the case index i and</span>
<span class="token comment">// an itab for the pair &lt;t, s.Cases[i]&gt;.</span>
<span class="token comment">// If there is no match, return N,nil, where N is the number</span>
<span class="token comment">// of cases.</span>
<span class="token keyword">func</span> <span class="token function">interfaceSwitch</span><span class="token punctuation">(</span>s <span class="token operator">*</span>abi<span class="token punctuation">.</span>InterfaceSwitch<span class="token punctuation">,</span> t <span class="token operator">*</span>_type<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token operator">*</span>itab<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// å°† s.Cases è½¬æ¢ä¸ºä¸€ä¸ªåˆ‡ç‰‡ï¼ŒåŒ…å«æ‰€æœ‰åˆ†æ”¯çš„æ¥å£ç±»å‹</span>
	cases <span class="token operator">:=</span> unsafe<span class="token punctuation">.</span><span class="token function">Slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">.</span>Cases<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>NCases<span class="token punctuation">)</span>

	<span class="token comment">// Results if we don't find a match.</span>
    <span class="token comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…é¡¹ï¼Œè¿”å›çš„åˆ†æ”¯ç´¢å¼•</span>
	case_ <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>cases<span class="token punctuation">)</span>
	<span class="token keyword">var</span> tab <span class="token operator">*</span>itab

	<span class="token comment">// Look through each case in order.</span>
    <span class="token comment">// éå†æ‰€æœ‰åˆ†æ”¯ï¼Œè°ƒç”¨ getitab æ£€æŸ¥å…·ä½“ç±»å‹ t æ˜¯å¦åŒ¹é…å½“å‰åˆ†æ”¯çš„æ¥å£ç±»å‹ c</span>
	<span class="token keyword">for</span> i<span class="token punctuation">,</span> c <span class="token operator">:=</span> <span class="token keyword">range</span> cases <span class="token punctuation">{<!-- --></span>
		tab <span class="token operator">=</span> <span class="token function">getitab</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> t<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token comment">// å¦‚æœæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œæ›´æ–° case_ å’Œ tabï¼Œå¹¶é€€å‡ºå¾ªç¯</span>
		<span class="token keyword">if</span> tab <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			case_ <span class="token operator">=</span> i
			<span class="token keyword">break</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
    <span class="token comment">// å¦‚æœä¸æ”¯æŒæ¥å£åˆ‡æ¢ç¼“å­˜ï¼Œåˆ™ç›´æ¥è¿”å›ç»“æœ</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>abi<span class="token punctuation">.</span><span class="token function">UseInterfaceSwitchCache</span><span class="token punctuation">(</span>GOARCH<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> case_<span class="token punctuation">,</span> tab
	<span class="token punctuation">}</span>

	<span class="token comment">// Maybe update the cache, so the next time the generated code</span>
	<span class="token comment">// doesn't need to call into the runtime.</span>
    <span class="token comment">// ä½¿ç”¨ cheaprand() ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œåªæœ‰å½“éšæœºæ•°æ»¡è¶³æ¡ä»¶æ—¶ï¼Œæ‰å°è¯•æ›´æ–°ç¼“å­˜</span>
    <span class="token comment">// é¿å…é¢‘ç¹æ›´æ–°å¸¦æ¥çš„æ€§èƒ½å¼€é”€</span>
	<span class="token keyword">if</span> <span class="token function">cheaprand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">1023</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// Only bother updating the cache ~1 in 1000 times.</span>
		<span class="token comment">// This ensures we don't waste memory on switches, or</span>
		<span class="token comment">// switch arguments, that only happen a few times.</span>
		<span class="token keyword">return</span> case_<span class="token punctuation">,</span> tab
	<span class="token punctuation">}</span>
    <span class="token comment">// ä½¿ç”¨åŸå­æ“ä½œåŠ è½½å½“å‰çš„æ¥å£åˆ‡æ¢ç¼“å­˜ s.Cache</span>
	<span class="token comment">// Load the current cache.</span>
	oldC <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span>abi<span class="token punctuation">.</span>InterfaceSwitchCache<span class="token punctuation">)</span><span class="token punctuation">(</span>atomic<span class="token punctuation">.</span><span class="token function">Loadp</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">.</span>Cache<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> <span class="token function">cheaprand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token function">uint32</span><span class="token punctuation">(</span>oldC<span class="token punctuation">.</span>Mask<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// As cache gets larger, choose to update it less often</span>
		<span class="token comment">// so we can amortize the cost of building a new cache</span>
		<span class="token comment">// (that cost is linear in oldc.Mask).</span>
		<span class="token keyword">return</span> case_<span class="token punctuation">,</span> tab
	<span class="token punctuation">}</span>

   	<span class="token comment">// è°ƒç”¨ buildInterfaceSwitchCache å‡½æ•°ï¼Œæ ¹æ®å½“å‰ç¼“å­˜ oldCã€å…·ä½“ç±»å‹ tã€åŒ¹é…çš„åˆ†æ”¯ç´¢å¼• case_ å’Œ itab æ„å»ºä¸€ä¸ªæ–°çš„ç¼“å­˜</span>
	<span class="token comment">// Make a new cache.</span>
	newC <span class="token operator">:=</span> <span class="token function">buildInterfaceSwitchCache</span><span class="token punctuation">(</span>oldC<span class="token punctuation">,</span> t<span class="token punctuation">,</span> case_<span class="token punctuation">,</span> tab<span class="token punctuation">)</span>

	<span class="token comment">// Update cache. Use compare-and-swap so if multiple threads</span>
	<span class="token comment">// are fighting to update the cache, at least one of their</span>
	<span class="token comment">// updates will stick.</span>
    <span class="token comment">// ä½¿ç”¨åŸå­æ“ä½œæ›´æ–°ç¼“å­˜</span>
	<span class="token function">atomic_casPointer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>unsafe<span class="token punctuation">.</span>Pointer<span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">.</span>Cache<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>oldC<span class="token punctuation">)</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>newC<span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> case_<span class="token punctuation">,</span> tab
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <code>
      interfaceSwitch
     </code>
     åŒæ ·åšäº†ç¼“å­˜ä¼˜åŒ–ï¼Œç±»ä¼¼äº
     <code>
      TypeAssert
     </code>
     ä¹Ÿæœ‰ä¸‰ä¸ªé‡è¦çš„ç»“æ„ä½“ï¼š
     <code>
      InterfaceSwitch
     </code>
     ã€
     <code>
      InterfaceSwitchCache
     </code>
     ã€
     <code>
      InterfaceSwitchCacheEntry
     </code>
     ã€‚
    </p>
    <h6>
     <a id="InterfaceSwitch_1555">
     </a>
     <code>
      InterfaceSwitch
     </code>
    </h6>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/internal/abi/switch.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token keyword">type</span> InterfaceSwitch <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Cache  <span class="token operator">*</span>InterfaceSwitchCache
	NCases <span class="token builtin">int</span>

	<span class="token comment">// Array of NCases elements.</span>
	<span class="token comment">// Each case must be a non-empty interface type.</span>
	Cases <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span>InterfaceType
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <code>
       Cache
      </code>
      ï¼šæŒ‡å‘
      <code>
       InterfaceSwitchCache
      </code>
      ï¼Œç”¨äºç¼“å­˜æ¥å£åˆ‡æ¢çš„ç»“æœã€‚
     </li>
     <li>
      <code>
       NCases
      </code>
      ï¼šåˆ†æ”¯çš„æ•°é‡ã€‚
     </li>
     <li>
      <code>
       Cases
      </code>
      ï¼šæ¥å£ç±»å‹æ•°ç»„ï¼Œå­˜å‚¨æ‰€æœ‰å¯èƒ½çš„åˆ†æ”¯ã€‚
     </li>
    </ul>
    <h6>
     <a id="InterfaceSwitchCache_1574">
     </a>
     <code>
      InterfaceSwitchCache
     </code>
    </h6>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/internal/abi/switch.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token keyword">type</span> InterfaceSwitchCache <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Mask    <span class="token builtin">uintptr</span>                      <span class="token comment">// mask for index. Must be a power of 2 minus 1</span>
	Entries <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>InterfaceSwitchCacheEntry <span class="token comment">// Mask+1 entries total</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <code>
       Mask
      </code>
      ï¼šæ©ç ï¼Œç”¨äºè®¡ç®—ç¼“å­˜ç´¢å¼•ã€‚
     </li>
     <li>
      <code>
       Entries
      </code>
      ï¼šç¼“å­˜æ¡ç›®æ•°ç»„ï¼Œå­˜å‚¨å…·ä½“ç±»å‹å’Œå¯¹åº”çš„åˆ†æ”¯ç´¢å¼•ã€‚
     </li>
    </ul>
    <h6>
     <a id="InterfaceSwitchCacheEntry_1588">
     </a>
     <code>
      InterfaceSwitchCacheEntry
     </code>
    </h6>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/internal/abi/switch.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token keyword">type</span> InterfaceSwitchCacheEntry <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// type of source value (a *Type)</span>
	Typ <span class="token builtin">uintptr</span>
	<span class="token comment">// case # to dispatch to</span>
	Case <span class="token builtin">int</span>
	<span class="token comment">// itab to use for resulting case variable (a *runtime.itab)</span>
	Itab <span class="token builtin">uintptr</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <code>
       Typ
      </code>
      ï¼šå…·ä½“ç±»å‹çš„æŒ‡é’ˆã€‚ç”¨äºè®°å½•å…·ä½“ç±»å‹çš„ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨æ¥å£åˆ‡æ¢æ—¶è¿›è¡Œç±»å‹åŒ¹é…ã€‚
     </li>
     <li>
      <code>
       Case
      </code>
      ï¼šåŒ¹é…çš„åˆ†æ”¯ç´¢å¼•ã€‚è¡¨ç¤ºåœ¨æ¥å£åˆ‡æ¢ä¸­ï¼Œå…·ä½“ç±»å‹åŒ¹é…çš„åˆ†æ”¯ç¼–å·ã€‚
     </li>
     <li>
      <code>
       Itab
      </code>
      ï¼š
      <code>
       itab
      </code>
      çš„æŒ‡é’ˆã€‚ç”¨äºè®°å½•å…·ä½“ç±»å‹å’Œæ¥å£ç±»å‹çš„æ˜ å°„å…³ç³»ï¼Œä»¥ä¾¿åœ¨æ¥å£åˆ‡æ¢æ—¶å¿«é€ŸæŸ¥æ‰¾å’Œä½¿ç”¨ã€‚
     </li>
    </ul>
    <h6>
     <a id="buildInterfaceSwitchCache_1607">
     </a>
     <code>
      buildInterfaceSwitchCache
     </code>
    </h6>
    <p>
     æ„å»ºç±»å‹åˆ‡æ¢ç¼“å­˜ï¼Œæºç å¦‚ä¸‹æ‰€ç¤ºï¼š
    </p>
    <blockquote>
     <p>
      æºç ä½ç½®ï¼šsrc/runtime/iface.go
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token comment">// buildInterfaceSwitchCache constructs an interface switch cache</span>
<span class="token comment">// containing all the entries from oldC plus the new entry</span>
<span class="token comment">// (typ,case_,tab).</span>
<span class="token keyword">func</span> <span class="token function">buildInterfaceSwitchCache</span><span class="token punctuation">(</span>oldC <span class="token operator">*</span>abi<span class="token punctuation">.</span>InterfaceSwitchCache<span class="token punctuation">,</span> typ <span class="token operator">*</span>_type<span class="token punctuation">,</span> case_ <span class="token builtin">int</span><span class="token punctuation">,</span> tab <span class="token operator">*</span>itab<span class="token punctuation">)</span> <span class="token operator">*</span>abi<span class="token punctuation">.</span>InterfaceSwitchCache <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// å°†æ—§ç¼“å­˜çš„æ¡ç›®è½¬æ¢ä¸ºä¸€ä¸ªåˆ‡ç‰‡ï¼ŒåŒ…å«æ‰€æœ‰æ—§çš„ç¼“å­˜æ¡ç›®</span>
	oldEntries <span class="token operator">:=</span> unsafe<span class="token punctuation">.</span><span class="token function">Slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>oldC<span class="token punctuation">.</span>Entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> oldC<span class="token punctuation">.</span>Mask<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>

	<span class="token comment">// Count the number of entries we need.</span>
	n <span class="token operator">:=</span> <span class="token number">1</span>
    <span class="token comment">// éå†æ—§ç¼“å­˜æ¡ç›®ï¼Œç»Ÿè®¡éç©ºæ¡ç›®æ•°é‡</span>
    <span class="token comment">// æ–°ç¼“å­˜éœ€è¦åŒ…å«æ—§ç¼“å­˜çš„æ‰€æœ‰æ¡ç›®ï¼Œå†åŠ ä¸Šä¸€ä¸ªæ–°æ¡ç›®</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> e <span class="token operator">:=</span> <span class="token keyword">range</span> oldEntries <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> e<span class="token punctuation">.</span>Typ <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
			n<span class="token operator">++</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Figure out how big a table we need.</span>
	<span class="token comment">// We need at least one more slot than the number of entries</span>
	<span class="token comment">// so that we are guaranteed an empty slot (for termination).</span>
    <span class="token comment">// æ–°ç¼“å­˜çš„å¤§å°è‡³å°‘æ˜¯æ¡ç›®æ•°é‡çš„ä¸¤å€ï¼Œä¿è¯å“ˆå¸Œè¡¨çš„è´Ÿè½½ç‡ä¸è¶…è¿‡ 50%</span>
    <span class="token comment">// ç¡®ä¿å“ˆå¸Œè¡¨å¤§å°æ˜¯ 2 çš„æ•´æ•°æ¬¡å¹‚</span>
	newN <span class="token operator">:=</span> n <span class="token operator">*</span> <span class="token number">2</span>                         <span class="token comment">// make it at most 50% full</span>
	newN <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> sys<span class="token punctuation">.</span><span class="token function">Len64</span><span class="token punctuation">(</span><span class="token function">uint64</span><span class="token punctuation">(</span>newN<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// round up to a power of 2</span>

	<span class="token comment">// Allocate the new table.</span>
    <span class="token comment">// è®¡ç®—æ–°ç¼“å­˜çš„æ€»å¤§å°ï¼ŒåŒ…æ‹¬ InterfaceSwitchCache ç»“æ„ä½“å’Œæ¡ç›®æ•°ç»„</span>
	newSize <span class="token operator">:=</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span>InterfaceSwitchCache<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>newN<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span>InterfaceSwitchCacheEntry<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// åˆ†é…å†…å­˜</span>
	newC <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span>abi<span class="token punctuation">.</span>InterfaceSwitchCache<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">mallocgc</span><span class="token punctuation">(</span>newSize<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// åˆå§‹åŒ–æ–°ç¼“å­˜çš„æ©ç </span>
	newC<span class="token punctuation">.</span>Mask <span class="token operator">=</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>newN <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment">// åˆå§‹åŒ–æ¡ç›®æ•°ç»„</span>
	newEntries <span class="token operator">:=</span> unsafe<span class="token punctuation">.</span><span class="token function">Slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newC<span class="token punctuation">.</span>Entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> newN<span class="token punctuation">)</span>

	<span class="token comment">// Fill the new table.</span>
    <span class="token comment">// å°†æ–°çš„ç¼“å­˜æ¡ç›®æ·»åŠ åˆ°æ–°ç¼“å­˜ä¸­</span>
	addEntry <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>typ <span class="token operator">*</span>_type<span class="token punctuation">,</span> case_ <span class="token builtin">int</span><span class="token punctuation">,</span> tab <span class="token operator">*</span>itab<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		h <span class="token operator">:=</span> <span class="token function">int</span><span class="token punctuation">(</span>typ<span class="token punctuation">.</span>Hash<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>newN <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> newEntries<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>Typ <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
				newEntries<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>Typ <span class="token operator">=</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>typ<span class="token punctuation">)</span><span class="token punctuation">)</span>
				newEntries<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>Case <span class="token operator">=</span> case_
				newEntries<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>Itab <span class="token operator">=</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>tab<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span>
			<span class="token punctuation">}</span>
			h <span class="token operator">=</span> <span class="token punctuation">(</span>h <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>newN <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
    
    <span class="token comment">// éå†æ—§ç¼“å­˜çš„æ‰€æœ‰æ¡ç›®ï¼Œå°†éç©ºæ¡ç›®å¤åˆ¶åˆ°æ–°ç¼“å­˜</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> e <span class="token operator">:=</span> <span class="token keyword">range</span> oldEntries <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> e<span class="token punctuation">.</span>Typ <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">addEntry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>_type<span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Typ<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>Case<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>itab<span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Itab<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
    <span class="token comment">// è°ƒç”¨ä¸Šé¢çš„ addEntry å‡½æ•°ï¼Œæœ€åæ’å…¥æ–°æ¡ç›®</span>
	<span class="token function">addEntry</span><span class="token punctuation">(</span>typ<span class="token punctuation">,</span> case_<span class="token punctuation">,</span> tab<span class="token punctuation">)</span>
	
    <span class="token comment">// è¿”å›æ„å»ºå¥½çš„æ–°ç¼“å­˜</span>
	<span class="token keyword">return</span> newC
<span class="token punctuation">}</span>
</code></pre>
    <p>
     ğŸŒºğŸŒºğŸŒºæ’’èŠ±ï¼
    </p>
    <p>
     å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œå°±ç‚¹å…³æ³¨æˆ–è€…ç•™ä¸ªğŸ‘
     <br/>
     å¦‚æœæ‚¨æœ‰ä»»ä½•æŠ€æœ¯é—®é¢˜æˆ–è€…éœ€è¦æ›´å¤šå…¶ä»–çš„å†…å®¹ï¼Œè¯·éšæ—¶å‘æˆ‘æé—®ã€‚
     <br/>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/direct/3734a0d4d24847a6ad83ea7ad3b1a2c6.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f34363238373931382f:61727469636c652f64657461696c732f313436313631393136" class_="artid" style="display:none">
 </p>
</div>


