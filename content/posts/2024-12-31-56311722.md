---
layout: post
title: "windows下ffmpeg音视频采集并推流"
date: 2024-12-31 11:29:05 +0800
description: "1.windows下ffmpeg的编译：        可参考：在windows下编译ffmpeg的"
keywords: "win11 capdriverconnect失败"
categories: ['技术资料']
tags: ['无标签']
artid: "56311722"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=56311722
    alt: "windows下ffmpeg音视频采集并推流"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=56311722
featuredImagePreview: https://bing.ee123.net/img/rand?artid=56311722
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     windows下ffmpeg音视频采集并推流
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h3 class="entry_title" style='margin:0px; padding:0px; font-family:"Microsoft YaHei",微软雅黑,Arial,"Lucida Grande",Tahoma,sans-serif; color:rgb(47,47,47); border:0px; font-size:15px; line-height:22px'>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      1.
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      windows下ffmpeg的编译：
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      可参考：
      <a href="http://www.codecoolie.com/ffmpeg/compile-ffmpeg-under-windows/" rel="nofollow noopener noreferrer" style="text-decoration:none; outline:0px; color:rgb(51,102,153)" target="_blank">
       在windows下编译ffmpeg的详细说明
      </a>
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      如：./configure --disable-yasm --enable-static --enable-indev=dshow
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      如果装了yasm，x264，就：./configure --enable-static --enable-indev=dshow --enable-gpl --enable-libx264
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      2.
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      windows下用ffmpeg采集视频：
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      可参考：
      <a href="http://blog.sina.com.cn/s/blog_51396f890102dxei.html" rel="nofollow noopener noreferrer" style="text-decoration:none; outline:0px; color:rgb(51,102,153)" target="_blank">
       ffmpeg在windows下捕获摄像头视频
      </a>
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      命令如：
      <span style="font-family:simsun; margin:0px; padding:0px; border:0px; color:rgb(50,62,50); line-height:21px; background:rgb(235,238,240)">
       ffmpeg.exe -r 5 -f vfwcap -i
       <br/>
       0 -s 176x144
      </span>
      <wbr style="color:rgb(50,62,50); font-family:simsun; line-height:21px; background-color:rgb(235,238,240)"/>
      <span style="font-family:simsun; margin:0px; padding:0px; border:0px; color:rgb(50,62,50); line-height:21px; background:rgb(235,238,240)">
       -f rawvideo -pix_fmt yuv420p
       <br/>
       ss.yuv
      </span>
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      3.
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      如果要想深入下ffmpeg中vfwcap：
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      可参考：
      <a href="http://blog.csdn.net/nkmnkm/article/details/7035877" rel="noopener noreferrer" style="text-decoration:none; outline:0px; color:rgb(51,102,153)" target="_blank">
       ffmpeg源码分析之vfwcap
      </a>
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      4.记录一下遇到的问题
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      A
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      connect设备失败
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <a href="http://bbs.2cto.com/read.php?tid=234870" rel="nofollow noopener noreferrer" style="text-decoration:none; outline:0px; color:rgb(51,102,153)" target="_blank">
       <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
       </span>
       <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
       </span>
       <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
       </span>
       Win7系统下使用capDriverConnect()连接失败的解决办法
      </a>
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      5.
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      前面提到的是VFW（video for windows）设备，现在摄像头都会支持vfw/wdm，但各系统并非有对应驱动
      <span class="wp_keywordlink" style="font-family:inherit; margin:0px; padding:0px; border:0px; background:transparent">
       <a href="http://www.xuebuyuan.com/" rel="nofollow noopener noreferrer" style="text-decoration:none; outline:0px; color:rgb(1,150,227)" target="_blank" title="程序">
        程序
       </a>
      </span>
      。
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      【电脑插上USB摄像头时，会为其安装通用驱动，测试其是VFW还是WDM，在设备管理查看驱动程序详细信息应该能辨别，或者直接上程序，编译测试。】
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      【根据使用的驱动程序的不同来分类，目前市场上大致有两种捕捉卡：VFW (Video for Windows)卡和WDM (Windows Driver Model)卡。VFW是DirectShow的前身，摄像头驱动未必支持。新的程序应该使用DirectShow。参考DirectShow
      <br/>
      SDK中的amcap示例。】
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      【视频捕捉卡的接口，可以是以PCI或AGP的方式插入PC机箱，也可以直接以USB接口的方式外挂；还有就是通过1394接口与PC机相连的数码摄像机等等。】
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      6.windows下用ffmpeg采集音频：
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      7.windows下使用ffmpeg中的dshow
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      如：ffmpeg -f dshow -i video="6RoomsCam" -y out.flv //用的六间房的虚拟摄像头
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
      </span>
      ffmpeg-f dshow -i audio="Realtek HD Audio Input" -y out.flv
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
       上面是分开采集的，同时采集，合并就行了，两个输入文件是ffmpeg -f dshow -i video="6RoomsCam" -f dshow -i audio="Realtek HD Audio Input" -y out.flv。
      </span>
      若要查看本机有哪些设备，可以参考10.
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      8.null.
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      9.在linux下，如：
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      ffmpeg  -f video4linux2 -s 320*240 -r 10 -i /dev/video0  test.asf
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      ffmpeg -f oss -i /dev/dsp   /tmp/out.mpg
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      10. 最后可以参考这里：
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <a href="http://ffmpeg.org/trac/ffmpeg/wiki/How%20to%20capture%20a%20webcam%20input" rel="nofollow noopener noreferrer" style="text-decoration:none; outline:0px; color:rgb(51,102,153)" target="_blank">
       how to capture a webcam input
      </a>
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      记录一些命令，直接研究也可：
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <span style="font-family:inherit; margin:0px; padding:0px; border:0px; white-space:pre; background:transparent">
       <span style="font-family:arial; margin:0px; padding:0px; border:0px; font-size:12px; color:rgb(204,0,0); line-height:18px; background:transparent">
        ffmpeg
       </span>
       <span style="font-family:arial; margin:0px; padding:0px; border:0px; font-size:12px; line-height:18px; background:transparent">
        -
       </span>
       <span style="font-family:arial; margin:0px; padding:0px; border:0px; font-size:12px; color:rgb(204,0,0); line-height:18px; background:transparent">
        list_devices
       </span>
       <span style="font-family:arial; margin:0px; padding:0px; border:0px; font-size:12px; line-height:18px; background:transparent">
        true
        <br/>
        -f dshow -i dummy //可查看摄像头和声卡设备名称
       </span>
      </span>
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
     </p>
     <pre class="wiki" name="code" style="margin: 0px 1.75em; padding: 0.25em; font-family: 微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif; white-space: pre-wrap; word-wrap: break-word; font-size: 13px; font-weight: normal; color: rgb(51, 51, 51); line-height: 26px; border: 1px solid rgb(215, 215, 215); overflow: auto; background-color: rgb(247, 247, 247);"><span class="searchword0" style="font-family: inherit; margin: 0px; padding: 0px; border: 0px; background: rgb(255, 255, 153);">ffmpeg</span> -y -f vfwcap -i list</pre>
     <pre class="wiki" name="code" style="margin: 0px 1.75em; padding: 0.25em; font-family: 微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif; white-space: pre-wrap; word-wrap: break-word; font-size: 13px; font-weight: normal; color: rgb(51, 51, 51); line-height: 26px; border: 1px solid rgb(215, 215, 215); overflow: auto; background-color: rgb(247, 247, 247);"><span class="searchword0" style="font-family: inherit; margin: 0px; padding: 0px; border: 0px; background: rgb(255, 255, 153);">ffmpeg</span> -y -f vfwcap -r 25 -i 0 out.mp4</pre>
     <pre class="wiki" name="code" style="margin: 0px 1.75em; padding: 0.25em; font-family: 微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif; white-space: pre-wrap; word-wrap: break-word; font-size: 13px; font-weight: normal; color: rgb(51, 51, 51); line-height: 26px; border: 1px solid rgb(215, 215, 215); overflow: auto; background-color: rgb(247, 247, 247);"><span class="searchword0" style="font-family: inherit; margin: 0px; padding: 0px; border: 0px; background: rgb(255, 255, 153);">ffmpeg</span> -f video4linux2 -r 25 -s 640x480 -i /dev/video0 out.avi</pre>
     <pre class="wiki" name="code" style="margin: 0px 1.75em; padding: 0.25em; font-family: 微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif; white-space: pre-wrap; word-wrap: break-word; font-size: 13px; font-weight: normal; color: rgb(51, 51, 51); line-height: 26px; border: 1px solid rgb(215, 215, 215); overflow: auto; background-color: rgb(247, 247, 247);"><span class="searchword0" style="font-family: inherit; margin: 0px; padding: 0px; border: 0px; background: rgb(255, 255, 153);">ffmpeg</span> -f v4l2 -r 25 -s 640x480 -i /dev/video0 out.avi</pre>
     <pre class="wiki" name="code" style="margin: 0px 1.75em; padding: 0.25em; font-family: 微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif; white-space: pre-wrap; word-wrap: break-word; font-size: 13px; font-weight: normal; color: rgb(51, 51, 51); line-height: 26px; border: 1px solid rgb(215, 215, 215); overflow: auto; background-color: rgb(247, 247, 247);">ffmpeg -f dshow -i video="Integrated Camera" out.mp4</pre>
     <p style="font-family:inherit; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:13px; font-weight:normal; line-height:24.05px">
      <span style="font-family:monospace; margin:0px; padding:0px; border:0px; color:rgb(51,51,51); line-height:26px; background:transparent">
       ffmpeg -f dshow -s 1280x720 -r 15 -vcodec mjpeg -i video="Integrated Camera" out.avi
      </span>
      <br style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"/>
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <strong>
       dshow编译方面参考
      </strong>
      ：
      <a href="http://blog.csdn.net/nkmnkm/article/details/7302936" rel="noopener noreferrer" style="text-decoration:none; outline:0px; color:rgb(51,102,153)" target="_blank">
       如何编译包含dshow设备的版本
      </a>
      【编译遇到问题，就自己解决吧，不是很麻烦。】
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      ffplay -f dshow video="USB video capture 0"
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      <strong>
       <span style="font-family:inherit; margin:0px; padding:0px; border:0px; color:rgb(255,0,0); background:transparent">
        【交代后期遇到的问题，以及提示】
       </span>
      </strong>
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      『用ffmpeg推音视频流（音视频皆用dshow为输入，视频编码用X264，以flv格式输出）的延迟问题，据我所看，有两点如下：』
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      1. 音频采样的带来的延迟，这个延迟很小。它是如何影响到延迟大小的呢？这样的：dshow中，音视频源filter的capture pin，数据包buffer大小是可设置的，假设它默认为1秒的数据，也就是每一秒才回调并向外投递出一包数据，此时（假设视频fps=15）编码器得到了15帧，在format的interleave（音视频包交错存放）处理里ff_interleave_packet_per_dts时，就缓存了接近1秒，即造成等量延迟。
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      如何修改capture pin呢？参考
      <span class="wp_keywordlink" style="font-family:inherit; margin:0px; padding:0px; border:0px; background:transparent">
       <a href="http://www.xuebuyuan.com/" rel="nofollow noopener noreferrer" style="text-decoration:none; outline:0px; color:rgb(1,150,227)" target="_blank" title="代码">
        代码
       </a>
      </span>
      如下：
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
     </p>
     <div class="dp-highlighter bg_cpp" style='margin:18px 0px!important; padding:1px 0px 0px; font-family:Consolas,"Courier New",Courier,mono,serif; border:1px solid rgb(237,237,237); font-size:13px; width:687.047px; word-break:break-all; overflow:auto; font-weight:normal; color:rgb(51,51,51); line-height:26px; background:rgb(231,229,220)'>
      <div class="bar" style="margin:0px; padding:2px 2px 2px 45px; font-family:inherit; border:0px; background:transparent">
       <div class="tools" style="margin:0px; padding:3px 8px 10px 10px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; border-width:0px 0px 1px 3px; border-bottom-style:solid; border-left-style:solid; border-bottom-color:rgb(43,145,175); border-left-color:rgb(108,226,108); font-size:9px; line-height:normal; color:silver; background:rgb(248,248,248)">
        <strong>
         [cpp]
        </strong>
        <a class="ViewSource" href="http://blog.csdn.net/fallenink/article/details/8556695#" rel="noopener noreferrer" style="text-decoration:none; outline:0px; color:rgb(160,160,160); font-size:9px; margin:0px 10px 0px 0px; border:none; padding:1px; display:inline-block; width:16px; height:16px; text-indent:-2000px; background-color:inherit" target="_blank" title="view plain">
         view
         <br/>
         plain
        </a>
        <a class="CopyToClipboard" href="http://blog.csdn.net/fallenink/article/details/8556695#" rel="noopener noreferrer" style="text-decoration:none; outline:0px; color:rgb(160,160,160); font-size:9px; margin:0px 10px 0px 0px; border:none; padding:1px; display:inline-block; width:16px; height:16px; text-indent:-2000px; background-color:inherit" target="_blank" title="copy">
         copy
        </a>
        <p style="font-family:inherit; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; text-indent:0em; background:transparent">
        </p>
        <div style="margin:0px; padding:0px; font-family:inherit; border:0px; position:absolute; left:558px; top:2429px; width:18px; height:18px; z-index:99; background:transparent">
        </div>
       </div>
      </div>
      <ol class="dp-cpp" start="1" style="margin:0px 0px 1px 45px!important; padding:0px; font-family:微软雅黑,宋体,黑体,Arial,Helvetica,sans-serif; list-style:none; border:none; color:rgb(92,92,92); background:rgb(255,255,255)">
       <li class="alt" style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; color:inherit; padding:0px 3px 0px 10px!important; margin:0px!important">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         dshow_cycle_formats()
        </span>
       </li>
       <li style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; padding:0px 3px 0px 10px!important; margin:0px!important; background-color:rgb(248,248,248)">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         {
        </span>
       </li>
       <li class="alt" style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; color:inherit; padding:0px 3px 0px 10px!important; margin:0px!important">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         ......
        </span>
       </li>
       <li style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; padding:0px 3px 0px 10px!important; margin:0px!important; background-color:rgb(248,248,248)">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         IAMBufferNegotiation *negotiate = NULL;
        </span>
       </li>
       <li class="alt" style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; color:inherit; padding:0px 3px 0px 10px!important; margin:0px!important">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         ALLOCATOR_PROPERTIES prop = {0};
        </span>
       </li>
       <li style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; padding:0px 3px 0px 10px!important; margin:0px!important; background-color:rgb(248,248,248)">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         <span class="keyword" style="font-family:inherit; margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">
          if
         </span>
         <span style="font-family:inherit; margin:0px; padding:0px; border:none; background-color:inherit">
          (devtype == AudioDevice)
         </span>
        </span>
       </li>
       <li class="alt" style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; color:inherit; padding:0px 3px 0px 10px!important; margin:0px!important">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         <span class="keyword" style="font-family:inherit; margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">
          if
         </span>
         <span style="font-family:inherit; margin:0px; padding:0px; border:none; background-color:inherit">
          (IPin_QueryInterface(pin, &amp;, (
         </span>
         <span class="keyword" style="font-family:inherit; margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">
          void
         </span>
         <span style="font-family:inherit; margin:0px; padding:0px; border:none; background-color:inherit">
          **) &amp;negotiate) != S_OK)
         </span>
        </span>
       </li>
       <li style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; padding:0px 3px 0px 10px!important; margin:0px!important; background-color:rgb(248,248,248)">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         <span class="keyword" style="font-family:inherit; margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">
          return
         </span>
         <span style="font-family:inherit; margin:0px; padding:0px; border:none; background-color:inherit">
          ;
         </span>
         <span class="comment" style="font-family:inherit; margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">
          //IID_IAMBufferNegotiation
         </span>
         <span style="font-family:inherit; margin:0px; padding:0px; border:none; background-color:inherit">
         </span>
        </span>
       </li>
       <li class="alt" style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; color:inherit; padding:0px 3px 0px 10px!important; margin:0px!important">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         ......
        </span>
       </li>
       <li style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; padding:0px 3px 0px 10px!important; margin:0px!important; background-color:rgb(248,248,248)">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         <span class="keyword" style="font-family:inherit; margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">
          if
         </span>
         <span style="font-family:inherit; margin:0px; padding:0px; border:none; background-color:inherit">
          (devtype == AudioDevice)
         </span>
        </span>
       </li>
       <li class="alt" style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; color:inherit; padding:0px 3px 0px 10px!important; margin:0px!important">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         {
        </span>
       </li>
       <li style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; padding:0px 3px 0px 10px!important; margin:0px!important; background-color:rgb(248,248,248)">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         {
        </span>
       </li>
       <li class="alt" style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; color:inherit; padding:0px 3px 0px 10px!important; margin:0px!important">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         prop.cbAlign = 1;
        </span>
       </li>
       <li style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; padding:0px 3px 0px 10px!important; margin:0px!important; background-color:rgb(248,248,248)">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         prop.cBuffers = 2;
        </span>
       </li>
       <li class="alt" style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; color:inherit; padding:0px 3px 0px 10px!important; margin:0px!important">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         prop.cbBuffer = ??;
        </span>
       </li>
       <li style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; padding:0px 3px 0px 10px!important; margin:0px!important; background-color:rgb(248,248,248)">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         }
        </span>
       </li>
       <li class="alt" style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; color:inherit; padding:0px 3px 0px 10px!important; margin:0px!important">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         <span class="keyword" style="font-family:inherit; margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">
          if
         </span>
         <span style="font-family:inherit; margin:0px; padding:0px; border:none; background-color:inherit">
          (IAMBufferNegotiation_SuggestAllocatorProperties(negotiate, &amp;prop) != S_OK)
         </span>
        </span>
       </li>
       <li style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; padding:0px 3px 0px 10px!important; margin:0px!important; background-color:rgb(248,248,248)">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         <span class="keyword" style="font-family:inherit; margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">
          goto
         </span>
         <span style="font-family:inherit; margin:0px; padding:0px; border:none; background-color:inherit">
          next;
         </span>
        </span>
       </li>
       <li class="alt" style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; color:inherit; padding:0px 3px 0px 10px!important; margin:0px!important">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         }
        </span>
       </li>
       <li style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; padding:0px 3px 0px 10px!important; margin:0px!important; background-color:rgb(248,248,248)">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         ......
        </span>
       </li>
       <li class="alt" style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; color:inherit; padding:0px 3px 0px 10px!important; margin:0px!important">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         <span class="keyword" style="font-family:inherit; margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">
          if
         </span>
         <span style="font-family:inherit; margin:0px; padding:0px; border:none; background-color:inherit">
          (devtype == AudioDevice)
         </span>
        </span>
       </li>
       <li style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; padding:0px 3px 0px 10px!important; margin:0px!important; background-color:rgb(248,248,248)">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         IAMBufferNegotiation_Release(negotiate);
        </span>
       </li>
       <li class="alt" style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; color:inherit; padding:0px 3px 0px 10px!important; margin:0px!important">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         ......
        </span>
       </li>
       <li style="list-style:decimal-leading-zero outside; border-left:3px solid rgb(108,226,108); border-top-style:none; border-right-style:none; border-bottom-style:none; line-height:18px; padding:0px 3px 0px 10px!important; margin:0px!important; background-color:rgb(248,248,248)">
        <span style="font-family:inherit; margin:0px; padding:0px; border:none; color:black; background-color:inherit">
         }
        </span>
       </li>
      </ol>
     </div>
     <p style="font-family:inherit; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:13px; font-weight:normal; line-height:24.05px">
      <br style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"/>
      <span style="font-family:Arial; margin:0px; padding:0px; border:0px; font-size:14px; color:rgb(51,51,51); line-height:26px; background:transparent">
       至于该buffer设置多大，可以结合，音频编码的frame_size、interleave是单帧视频对应多少音频包，来考虑
      </span>
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
     </p>
     <p style="font-family:Arial; margin-top:0px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; border:0px; font-size:14px; font-weight:normal; color:rgb(51,51,51); line-height:26px">
      2. X264编码带来的延迟，在配置参数的时候，先参考下这篇文章：
      <a href="http://blog.yikuyiku.com/?p=3161" rel="nofollow noopener noreferrer" style="text-decoration:none; outline:0px; color:rgb(51,102,153)" target="_blank">
       如何计算x264编码延迟（转载如下）
      </a>
     </p>
    </h3>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f7a71665f6f6666696365:2f61727469636c652f64657461696c732f3536333131373232" class_="artid" style="display:none">
 </p>
</div>


