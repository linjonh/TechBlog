---
layout: post
title: "基于C的以太网通讯实现TcpClient异步通讯详解"
date: 2025-03-16 17:38:29 +0800
description: "以太网通讯基于TCP/IP协议，是一种可靠的、面向连接的通讯方式。在C#中，System.Net.Sockets.TcpClient类提供了对TCP协议的支持，可以方便地实现客户端与服务器之间的通讯。本文将使用异步编程模型（APM）来处理连接、发送和接收数据，以提高程序的响应性和性能。"
keywords: "基于C#的以太网通讯实现：TcpClient异步通讯详解"
categories: ['C']
tags: ['开发语言', 'C']
artid: "146298072"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146298072
    alt: "基于C的以太网通讯实现TcpClient异步通讯详解"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146298072
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146298072
cover: https://bing.ee123.net/img/rand?artid=146298072
image: https://bing.ee123.net/img/rand?artid=146298072
img: https://bing.ee123.net/img/rand?artid=146298072
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     基于C#的以太网通讯实现：TcpClient异步通讯详解
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     基于C#的以太网通讯实现：TcpClient异步通讯详解
     <br/>
     在现代工业控制和物联网应用中，以太网通讯是一种常见的数据传输方式。本文将介绍如何使用C#实现基于TCP协议的以太网通讯，并通过异步编程提高通讯效率。我们将使用TcpClient类来实现客户端与服务器的连接、数据发送和接收，并详细讲解关键技术点。
    </p>
    <h2>
     <a id="1__3">
     </a>
     1. 概述
    </h2>
    <p>
     以太网通讯基于TCP/IP协议，是一种可靠的、面向连接的通讯方式。在C#中，System.Net.Sockets.TcpClient类提供了对TCP协议的支持，可以方便地实现客户端与服务器之间的通讯。本文将使用异步编程模型（APM）来处理连接、发送和接收数据，以提高程序的响应性和性能。
    </p>
    <h2>
     <a id="2__6">
     </a>
     2. 关键技术点
    </h2>
    <h3>
     <a id="21_TcpClient_7">
     </a>
     2.1 TcpClient类
    </h3>
    <p>
     TcpClient是C#中用于实现TCP客户端通讯的核心类。它封装了底层的Socket操作，提供了简单易用的接口。
    </p>
    <h3>
     <a id="22__10">
     </a>
     2.2 数据缓冲区
    </h3>
    <p>
     在通讯过程中，数据通过字节数组（byte[]）进行传输。合理设置缓冲区大小可以提高数据传输效率。
    </p>
    <h3>
     <a id="23__13">
     </a>
     2.3 连接超时处理
    </h3>
    <p>
     在网络通讯中，连接超时是一个常见问题。通过设置超时时间，可以避免程序长时间等待无响应的服务器。
    </p>
    <h2>
     <a id="3__15">
     </a>
     3. 代码实现
    </h2>
    <p>
     以下是基于TcpClient的异步通讯实现代码，关键技术点已标识。
    </p>
    <h3>
     <a id="31_TcpClientAsyncTool_18">
     </a>
     3.1 TcpClientAsyncTool类
    </h3>
    <pre><code class="prism language-csharp">    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TcpClientAsyncTool</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">TcpClient</span> tcpClient<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">bool</span></span> isConnected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token class-name">IPAddress</span> iPAddress<span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> port<span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> connectTimeout<span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> receiveBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token function">TcpClientAsyncTool</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> ip<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> port<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> connectTimeout <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            tcpClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TcpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>iPAddress <span class="token operator">=</span> IPAddress<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>port <span class="token operator">=</span> port<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>connectTimeout <span class="token operator">=</span> connectTimeout<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 连接服务器</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="errorMsg"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Connect</span><span class="token punctuation">(</span><span class="token class-name">Action</span> connectDelegate<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">string</span></span> errorMsg<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">bool</span></span> result <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            errorMsg <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">IAsyncResult</span> asyncResult <span class="token operator">=</span> tcpClient<span class="token punctuation">.</span><span class="token function">BeginConnect</span><span class="token punctuation">(</span>iPAddress<span class="token punctuation">,</span> port<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">connectDelegate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">bool</span></span> success <span class="token operator">=</span> asyncResult<span class="token punctuation">.</span>AsyncWaitHandle<span class="token punctuation">.</span><span class="token function">WaitOne</span><span class="token punctuation">(</span>TimeSpan<span class="token punctuation">.</span><span class="token function">FromMilliseconds</span><span class="token punctuation">(</span>connectTimeout<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置连接超时时间为2秒</span>
                tcpClient<span class="token punctuation">.</span><span class="token function">EndConnect</span><span class="token punctuation">(</span>asyncResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                isConnected <span class="token operator">=</span> result<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                errorMsg <span class="token operator">=</span> ex<span class="token punctuation">.</span>Message<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 断开连接</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="errorMsg"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">DisConnect</span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">string</span></span> errorMsg<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">bool</span></span> result <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            errorMsg <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                tcpClient<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                isConnected <span class="token operator">=</span> result<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                errorMsg <span class="token operator">=</span> ex<span class="token punctuation">.</span>Message<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 发送数据</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="bytes"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="errorMsg"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">SendData</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> sendBytes<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">string</span></span> errorMsg<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">bool</span></span> result <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            errorMsg <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">NetworkStream</span> networkStream <span class="token operator">=</span> tcpClient<span class="token punctuation">.</span><span class="token function">GetStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">IAsyncResult</span> asyncResult <span class="token operator">=</span> networkStream<span class="token punctuation">.</span><span class="token function">BeginWrite</span><span class="token punctuation">(</span>sendBytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sendBytes<span class="token punctuation">.</span>Length<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                networkStream<span class="token punctuation">.</span><span class="token function">EndWrite</span><span class="token punctuation">(</span>asyncResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                errorMsg <span class="token operator">=</span> ex<span class="token punctuation">.</span>Message <span class="token operator">+</span> ex<span class="token punctuation">.</span>StackTrace<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 接收数据</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="result"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="errorMsg"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">ReceiveData</span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">bool</span></span> result<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">string</span></span> errorMsg<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            result <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            errorMsg <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> readByteArray <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">NetworkStream</span> networkStream <span class="token operator">=</span> tcpClient<span class="token punctuation">.</span><span class="token function">GetStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">IAsyncResult</span> iAsyncResult <span class="token operator">=</span> networkStream<span class="token punctuation">.</span><span class="token function">BeginRead</span><span class="token punctuation">(</span>receiveBuffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> receiveBuffer<span class="token punctuation">.</span>Length<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">int</span></span> readBytes <span class="token operator">=</span> networkStream<span class="token punctuation">.</span><span class="token function">EndRead</span><span class="token punctuation">(</span>iAsyncResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                readByteArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span>readBytes<span class="token punctuation">]</span><span class="token punctuation">;</span>
                Array<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>receiveBuffer<span class="token punctuation">,</span> readByteArray<span class="token punctuation">,</span> readBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
                result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                errorMsg <span class="token operator">=</span> ex<span class="token punctuation">.</span>Message <span class="token operator">+</span> ex<span class="token punctuation">.</span>StackTrace<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> readByteArray<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="32__135">
     </a>
     3.2 使用示例
    </h3>
    <p>
     以下是使用TcpClientAsyncTool类的示例代码，展示了如何连接服务器、发送和接收数据。
    </p>
    <h4>
     <a id="321_socket10010_137">
     </a>
     3.2.1 socket连接，端口号10010
    </h4>
    <pre><code class="prism language-csharp">    tcpClient1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TcpConnect<span class="token punctuation">.</span>TcpClientAsyncTool</span><span class="token punctuation">(</span>controlBoxWithID1<span class="token punctuation">.</span>IP<span class="token punctuation">,</span> <span class="token number">10010</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化TcpClient</span>
    tasks<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tcpClient1<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> <span class="token keyword">out</span> errorMsg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 连接服务器</span>
        <span class="token punctuation">{<!-- --></span>
            isConnected1 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action</span><span class="token punctuation">(</span>ReaceiveData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 启动数据接收任务</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="322__149">
     </a>
     3.2.2 数据接收
    </h4>
    <p>
     提前声明：TcpConnect.TcpClientAsyncTool tcpClient1; TcpClient客户端1
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ReaceiveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">bool</span></span> result <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> errorMsg <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> readReadBytes <span class="token operator">=</span> tcpClient1<span class="token punctuation">.</span><span class="token function">ReceiveData</span><span class="token punctuation">(</span><span class="token keyword">out</span> result<span class="token punctuation">,</span> <span class="token keyword">out</span> errorMsg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 接收数据</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>readReadBytes <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
             <span class="token comment">//处理接收数据信息readReadBytes </span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Failed to connect to power supply: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">ex<span class="token punctuation">.</span>Message</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 捕获异常并输出错误信息</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isConnected1 <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">// 如果连接断开，退出循环</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="322__178">
     </a>
     3.2.2 数据发送
    </h4>
    <pre><code class="prism language-csharp">        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SendData1</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> message<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">string</span></span> errorMsg <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>isConnected1<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                tcpClient1<span class="token punctuation">.</span><span class="token function">SendData</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token keyword">out</span> errorMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="4__191">
     </a>
     4. 关键技术解析
    </h2>
    <h3>
     <a id="41__192">
     </a>
     4.1 异步连接
    </h3>
    <p>
     通过BeginConnect和EndConnect方法实现异步连接，避免了主线程阻塞。使用AsyncWaitHandle.WaitOne设置超时时间，防止连接无响应的服务器。
    </p>
    <h3>
     <a id="42__195">
     </a>
     4.2 异步发送和接收数据
    </h3>
    <p>
     使用BeginWrite/EndWrite和BeginRead/EndRead实现异步数据发送和接收，确保通讯过程不会阻塞主线程。
    </p>
    <h3>
     <a id="43__198">
     </a>
     4.3 数据缓冲区
    </h3>
    <p>
     通过byte[]数组作为数据缓冲区，接收到的数据会被存储在该数组中。合理设置缓冲区大小可以提高数据传输效率。
    </p>
    <p>
     4.4 连接状态管理
     <br/>
     通过isConnected变量管理连接状态，确保在连接断开时及时停止数据接收任务。
    </p>
    <h2>
     <a id="5__204">
     </a>
     5. 总结
    </h2>
    <p>
     本文介绍了如何使用C#实现基于TCP协议的以太网通讯，并通过异步编程模型提高了通讯效率。关键技术点包括TcpClient的使用、异步编程模型、数据缓冲区和连接超时处理。通过本文的代码示例，您可以快速实现一个可靠的以太网通讯客户端。
    </p>
    <p>
     希望这篇文章对您有所帮助！如果有任何问题，欢迎在评论区留言讨论。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34343839393634322f:61727469636c652f64657461696c732f313436323938303732" class_="artid" style="display:none">
 </p>
</div>


