---
layout: post
title: "Vue-3-Composition-API优化项目"
date: 2025-03-14 08:23:05 +0800
description: "Vue 3 Composition API 优化项目"
keywords: "Vue 3 Composition API优化项目"
categories: ['Vue']
tags: ['前端', 'Vue']
artid: "146248047"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146248047
    alt: "Vue-3-Composition-API优化项目"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146248047
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146248047
cover: https://bing.ee123.net/img/rand?artid=146248047
image: https://bing.ee123.net/img/rand?artid=146248047
img: https://bing.ee123.net/img/rand?artid=146248047
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Vue 3 Composition API优化项目
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     以下是使用
     <strong>
      Vue 3 Composition API
     </strong>
     优化项目的通俗指南，无需复杂术语，直接上干货：
    </p>
    <hr/>
    <h4>
     <a id="1__4">
     </a>
     <strong>
      1. 像搭积木一样复用逻辑
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       问题
      </strong>
      ：多个组件有重复逻辑（比如获取数据、计时器），复制粘贴代码很麻烦。
     </li>
     <li>
      <strong>
       解决
      </strong>
      ：用
      <code>
       Composables
      </code>
      （自定义函数）封装逻辑，随用随取。
      <pre><code class="prism language-javascript"><span class="token comment">// useTimer.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref<span class="token punctuation">,</span> onUnmounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> seconds <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">start</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      seconds<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// 自动清理定时器（避免内存泄漏）</span>
  <span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span> seconds<span class="token punctuation">,</span> start <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      <strong>
       使用
      </strong>
      ：
      <pre><code class="prism language-javascript"><span class="token comment">// 组件内</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> useTimer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./useTimer'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> seconds<span class="token punctuation">,</span> start <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 直接调用</span>
</code></pre>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="2__37">
     </a>
     <strong>
      2. 响应式数据：该省则省
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       问题
      </strong>
      ：所有数据都加响应式，性能浪费。
     </li>
     <li>
      <strong>
       技巧
      </strong>
      ：
      <ul>
       <li>
        基本类型用
        <code>
         ref
        </code>
        ：
        <code>
         const count = ref(0)
        </code>
       </li>
       <li>
        对象/数组用
        <code>
         reactive
        </code>
        ：
        <code>
         const user = reactive({ name: '张三' })
        </code>
       </li>
       <li>
        <strong>
         不需要响应式的数据
        </strong>
        ：用普通变量或
        <code>
         readonly
        </code>
        。
        <pre><code class="prism language-javascript"><span class="token keyword">const</span> staticConfig <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">api</span><span class="token operator">:</span> <span class="token string">'/data'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 不响应</span>
<span class="token keyword">const</span> frozenData <span class="token operator">=</span> <span class="token function">readonly</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 禁止修改</span>
</code></pre>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="3__50">
     </a>
     <strong>
      3. 性能优化：少干活，多偷懒
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        列表渲染
       </strong>
       ：
      </p>
      <ul>
       <li>
        加
        <code>
         key
        </code>
        ：
        <code>
         &lt;div v-for="item in list" :key="item.id"&gt;
        </code>
       </li>
       <li>
        万级数据用虚拟滚动（比如只渲染看得见的 20 条）。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        条件渲染
       </strong>
       ：
      </p>
      <ul>
       <li>
        频繁切换用
        <code>
         v-show
        </code>
        （不销毁元素）：
        <code>
         &lt;div v-show="isVisible"&gt;
        </code>
       </li>
       <li>
        一次性渲染用
        <code>
         v-if
        </code>
        （减少初始负载）。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        计算属性缓存
       </strong>
       ：
      </p>
      <pre><code class="prism language-javascript"><span class="token keyword">const</span> fullName <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>firstName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>lastName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 自动缓存结果</span>
</code></pre>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="4__setup__66">
     </a>
     <strong>
      4. 代码组织：让 setup 干净清爽
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        拆分逻辑块
       </strong>
       ：把不同功能写在独立的
       <code>
        Composables
       </code>
       里。
      </p>
      <pre><code class="prism language-javascript"><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 数据获取</span>
  <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> data<span class="token punctuation">,</span> error <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useFetch</span><span class="token punctuation">(</span><span class="token string">'/api/data'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 用户交互</span>
  <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> position<span class="token punctuation">,</span> trackClick <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMouseTracker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 定时器</span>
  <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> seconds <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span> data<span class="token punctuation">,</span> error<span class="token punctuation">,</span> position<span class="token punctuation">,</span> seconds <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        生命周期钩子
       </strong>
       ：在
       <code>
        setup
       </code>
       里直接调用：
      </p>
      <pre><code class="prism language-javascript"><span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'组件加载了！'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 销毁时清理</span>
</code></pre>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="5__89">
     </a>
     <strong>
      5. 实战场景：表单提交优化
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       问题
      </strong>
      ：表单提交时，重复处理加载状态、错误提示。
     </li>
     <li>
      <strong>
       优化
      </strong>
      ：封装一个
      <code>
       useFormSubmit
      </code>
      ：
      <pre><code class="prism language-javascript"><span class="token comment">// useFormSubmit.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useFormSubmit</span><span class="token punctuation">(</span><span class="token parameter">apiFn</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> isLoading <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">submit</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">formData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    isLoading<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">await</span> <span class="token function">apiFn</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 传入具体的提交函数</span>
      error<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      error<span class="token punctuation">.</span>value <span class="token operator">=</span> err<span class="token punctuation">.</span>message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
      isLoading<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span> isLoading<span class="token punctuation">,</span> error<span class="token punctuation">,</span> submit <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      <strong>
       使用
      </strong>
      ：
      <pre><code class="prism language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> isLoading<span class="token punctuation">,</span> error<span class="token punctuation">,</span> submit <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useFormSubmit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/submit'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 传入提交逻辑</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_124">
     </a>
     <strong>
      总结
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       复用逻辑
      </strong>
      ：用
      <code>
       Composables
      </code>
      代替 Mixins，像乐高一样拼装代码。
     </li>
     <li>
      <strong>
       数据精准响应
      </strong>
      ：别给不需要变化的数据加响应式。
     </li>
     <li>
      <strong>
       性能偷懒
      </strong>
      ：少渲染、少计算、少监听。
     </li>
     <li>
      <strong>
       代码整洁
      </strong>
      ：一个函数只干一件事，拆分成小块。
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34363437363436302f:61727469636c652f64657461696c732f313436323438303437" class_="artid" style="display:none">
 </p>
</div>


