---
layout: post
title: "WebSocketWS协议系列四SSLTLS协议"
date: 2025-03-07 01:01:01 +0800
description: "SSL（Secure Sockets Layer） 和 TLS（Transport Layer Security） 是用于在网络上实现安全通信的协议，它们通常用于加密数据传输，保护数据免受窃取、篡改和伪造。虽然 SSL 已被逐步淘汰，现代网络通信大多使用 TLS，但很多时候，我们仍然会把 SSL/TLS 一起提及，通常理解为同一个概念。"
keywords: "WebSocket（WS）协议系列（四）SSL/TLS协议"
categories: ['网络', 'Websocket']
tags: ['网络协议', 'Websocket', 'Ssl']
artid: "146083619"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146083619
    alt: "WebSocketWS协议系列四SSLTLS协议"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146083619
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146083619
cover: https://bing.ee123.net/img/rand?artid=146083619
image: https://bing.ee123.net/img/rand?artid=146083619
img: https://bing.ee123.net/img/rand?artid=146083619
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     WebSocket（WS）协议系列（四）SSL/TLS协议
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <blockquote>
     <p>
      SSL（Secure Sockets Layer） 和 TLS（Transport Layer Security） 是用于在网络上实现安全通信的协议，它们通常用于加密数据传输，保护数据免受窃取、篡改和伪造。虽然 SSL 已被逐步淘汰，现代网络通信大多使用 TLS，但很多时候，我们仍然会把 SSL/TLS 一起提及，通常理解为同一个概念。
     </p>
    </blockquote>
    <h2>
     <a id="SSLTLS_3">
     </a>
     SSL/TLS协议是什么？
    </h2>
    <p>
     SSL 是最初由 Netscape 开发的一种加密协议，目的是在计算机网络中提供加密通信。它最早发布于 1994 年，但由于安全漏洞，它在 2015 年被
     <strong>
      废弃
     </strong>
     。
     <br/>
     TLS 是 SSL 的继任者，它是基于 SSL 设计的，但增强了安全性。TLS 1.0 于 1999 年发布，是 SSL 的改进版本，后续发布了多个版本，如 TLS 1.1、1.2、以及目前的 TLS 1.3（2018 年发布）。
    </p>
    <h2>
     <a id="SSLTLS_7">
     </a>
     SSL/TLS的作用
    </h2>
    <p>
     1.数据加密：
     <br/>
     SSL/TLS 通过加密技术确保传输的数据无法被第三方读取。这是非常重要的，特别是在互联网上传输敏感信息时（例如密码、信用卡信息、个人身份数据等）。
     <br/>
     加密有两种方式：
     <strong>
      对称加密
     </strong>
     （双方使用相同的密钥进行加密解密）和
     <strong>
      非对称加密
     </strong>
     （使用公钥和私钥进行加密和解密）。
    </p>
    <p>
     2.身份验证：
     <br/>
     SSL/TLS 通过使用证书（数字证书）来验证通信双方的身份。这个证书由 证书颁发机构（CA） 签发，确保你正在与一个真实且受信任的服务器进行通信。
     <br/>
     通过证书，客户端（比如浏览器）可以验证服务器的身份，防止与恶意伪装的服务器进行通信。
    </p>
    <p>
     3.数据完整性：
     <br/>
     SSL/TLS 通过 消息认证码（MAC） 来保证传输的数据没有在传输过程中被篡改。如果数据被修改，接收方可以通过 MAC 检测到篡改行为，防止数据丢失或伪造。
    </p>
    <h2>
     <a id="SSLTLS__21">
     </a>
     SSL/TLS 工作流程
    </h2>
    <p>
     SSL/TLS 的工作主要分为两个阶段：
    </p>
    <p>
     TLS 握手（TLS Handshake）：用于身份验证和密钥交换
     <br/>
     数据传输（Data Transmission）：使用对称加密进行安全通信
    </p>
    <h3>
     <a id="_1TLS__27">
     </a>
     <strong>
      阶段 1：TLS 握手
     </strong>
    </h3>
    <h4>
     <a id="TLS__28">
     </a>
     TLS 握手的目标是：
    </h4>
    <p>
     确认客户端和服务器
     <strong>
      可以使用 TLS
     </strong>
     进行安全通信
     <br/>
     服务器提供
     <strong>
      数字证书
     </strong>
     ，以证明自己的身份
     <br/>
     协商使用的加密算法
     <br/>
     安全地交换会话密钥，用于后续的加密通信
    </p>
    <h4>
     <a id="TLS__34">
     </a>
     TLS 握手的流程如下：
    </h4>
    <h5>
     <a id="_1_HelloClient_Hello_35">
     </a>
     步骤 1：客户端 Hello（Client Hello）
    </h5>
    <p>
     1.客户端向服务器发送“Client Hello”消息，其中包含：
     <br/>
     客户端支持的 TLS 版本（如 TLS 1.2 或 TLS 1.3）
     <br/>
     客户端支持的 加密算法（Cipher Suites）
     <br/>
     一个 随机数（Client Random）：稍后用于生成加密密钥
    </p>
    <h5>
     <a id="_2_HelloServer_Hello_41">
     </a>
     步骤 2：服务器 Hello（Server Hello）
    </h5>
    <p>
     2.服务器收到 Client Hello 后，发送“Server Hello”消息，其中包含：
     <br/>
     服务器选择的 TLS 版本
     <br/>
     服务器选择的 加密算法
     <br/>
     服务器自己的 随机数（Server Random）
     <br/>
     服务器的 数字证书（SSL/TLS 证书）（包含服务器的公钥）
    </p>
    <p>
     3.客户端验证服务器的证书：
     <br/>
     检查服务器的证书是否由 受信任的证书颁发机构（CA） 签发
     <br/>
     检查证书是否过期
     <br/>
     验证证书中的 域名是否匹配 服务器的域名
     <br/>
     <strong>
      如果证书不可信，TLS 连接会终止。
     </strong>
    </p>
    <h5>
     <a id="_3_54">
     </a>
     步骤 3：会话密钥的生成
    </h5>
    <p>
     根据不同的 TLS 版本，客户端和服务器使用不同的方法来生成会话密钥：
    </p>
    <p>
     （1）TLS 1.2 及之前：RSA 密钥交换
    </p>
    <p>
     4.客户端生成一个 “Pre-Master Secret”（预主密钥）
     <br/>
     这个 “Pre-Master Secret” 是一个随机数
     <br/>
     客户端用服务器的公钥加密这个 Pre-Master Secret，然后发送给服务器
     <br/>
     服务器用自己的 私钥 解密，得到 Pre-Master Secret
    </p>
    <p>
     5.客户端和服务器使用相同的算法计算会话密钥
     <br/>
     计算方式：
     <br/>
     <code>
      Session Key = Pre-Master Secret + Client Random + Server Random
     </code>
     <br/>
     这个会话密钥是对称密钥，将用于加密后续的数据通信
    </p>
    <p>
     （2）TLS 1.3：ECDHE（椭圆曲线 Diffie-Hellman）密钥交换
    </p>
    <p>
     TLS 1.3 不再使用 RSA 进行密钥交换，而是采用 ECDHE（Elliptic Curve Diffie-Hellman Ephemeral），保证前向安全性（即密钥泄露后无法解密过去的通信）。
     <br/>
     服务器和客户端各自生成一个 私钥 和 公钥，并交换公钥，最终生成共享的 会话密钥。
    </p>
    <h5>
     <a id="_4_75">
     </a>
     步骤 4：密钥交换完成
    </h5>
    <p>
     6.双方使用会话密钥加密“Finished”消息
    </p>
    <p>
     服务器和客户端分别发送一条加密的 Finished 消息，表明 TLS 握手成功
     <br/>
     这条消息是握手过程的最后一步，确保双方使用相同的密钥
     <br/>
     阶段 2：数据加密通信
    </p>
    <p>
     7.对称加密数据传输
    </p>
    <p>
     服务器和客户端使用刚才协商的 会话密钥 进行数据加密传输
     <br/>
     数据加密通常使用 AES（高级加密标准）等对称加密算法
    </p>
    <p>
     8.数据完整性校验
    </p>
    <p>
     每条消息都附带一个 MAC（消息认证码），用于校验数据是否被篡改
    </p>
    <p>
     9.连接关闭
    </p>
    <p>
     当通信结束后，客户端或服务器可以发送 Close Notify 消息，安全地终止连接
    </p>
    <h2>
     <a id="_97">
     </a>
     例子：
    </h2>
    <h3>
     <a id="WebSSLTLS_98">
     </a>
     在Web服务器上启用SSL/TLS
    </h3>
    <p>
     1.获取SSL证书：
     <br/>
     可以从受信任的证书颁发机构（如 Let’s Encrypt, Comodo, Digicert 等）申请一个证书。一般而言，证书有免费和付费版本。
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ac986bb537044ca58003f6fa54639061.png"/>
    </p>
    <p>
     2.安装SSL证书：
     <br/>
     下载并安装证书文件，通常包括 私钥文件、公钥证书（证书文件）和 证书链文件。将这些文件放置在Web服务器的指定目录中。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f535cbe88c1d4d2c9f8d3dda5e11205a.png"/>
    </p>
    <p>
     配置Web服务器（如Apache）启用TLS
    </p>
    <pre><code class="prism language-bash"><span class="token operator">&lt;</span>Host *:44<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>
    ServerName www.example.com
    DocumentRoot /var/www/html

    SSLEngine on
    SSLCertificateFile /path/to/your/certificate.crt
    SSLCertificateKeyFile /path/to/your/private.key
    SSLCertificateChainFile /path/to/your/chain.pem
<span class="token operator">&lt;</span>/VirtualHost<span class="token operator">&gt;</span>

</code></pre>
    <p>
     重启 Web 服务器
    </p>
    <p>
     验证 HTTPS： 使用浏览器访问服务器，查看网址是否以 https:// 开头，并检查浏览器中的 SSL 证书信息，确保连接已加密。
    </p>
    <h3>
     <a id="NodejsSSLTLS_125">
     </a>
     在Node.js中使用SSL/TLS
    </h3>
    <pre><code class="prism language-bash">const https <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'https'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const fs <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// 读取 SSL 证书
const options <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  key: fs.readFileSync<span class="token punctuation">(</span><span class="token string">'path/to/private.key'</span><span class="token punctuation">)</span>, 
  cert: fs.readFileSync<span class="token punctuation">(</span><span class="token string">'path/to/certificate.crt'</span><span class="token punctuation">)</span>,
  ca: fs.readFileSync<span class="token punctuation">(</span><span class="token string">'path/to/chain.pem'</span><span class="token punctuation">)</span>  // 可选：证书链文件
<span class="token punctuation">}</span><span class="token punctuation">;</span>

// 创建 HTTPS 服务器
https.createServer<span class="token punctuation">(</span>options, <span class="token punctuation">(</span>req, res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
  res.writeHead<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res.end<span class="token punctuation">(</span><span class="token string">'Hello, Secure World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>.listen<span class="token punctuation">(</span><span class="token number">443</span>, <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
  console.log<span class="token punctuation">(</span><span class="token string">'HTTPS server running on port 443'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f70696c6c70656f706c652f:61727469636c652f64657461696c732f313436303833363139" class_="artid" style="display:none">
 </p>
</div>


