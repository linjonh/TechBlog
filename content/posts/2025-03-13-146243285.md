---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f35393334343132372f:61727469636c652f64657461696c732f313436323433323835"
layout: post
title: "åç«¯django-drfdjangoè‡ªåŠ¨å¯¼å‡ºä¼˜é›…çš„apiæ–‡æ¡£çš„å†™æ³•"
date: 2025-03-13 21:52:55 +0800
description: "ï¼ˆä¸€ï¼‰ç¤ºä¾‹OpenApiParameter(name=\"username\", description=\"æŒ‰ç…§ç”¨æˆ·åç­›é€‰\", required=False, type=str),OpenApiParameter(name=\"page\", description=\"åˆ†é¡µå‚æ•°ï¼Œé»˜è®¤ä¸º1\", required=False, type=int),],ğŸ“Œ è§„åˆ™ç”¨äº API æŸ¥è¯¢å‚æ•°è¯´æ˜ã€‚description=\"è¯´æ˜\"ç¡®ä¿å‰ç«¯æ˜“äºç†è§£ã€‚"
keywords: "ã€åç«¯ã€‘ã€django drfã€‘djangoè‡ªåŠ¨å¯¼å‡ºä¼˜é›…çš„apiæ–‡æ¡£çš„å†™æ³•"
categories: ['é¢è¯•è€ƒé¢˜ä¸“æ å‰åç«¯', 'åç«¯ç³»ç»ŸåŠŸèƒ½', 'Django']
tags: ['Sqlite', 'Python', 'Django']
artid: "146243285"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146243285
    alt: "åç«¯django-drfdjangoè‡ªåŠ¨å¯¼å‡ºä¼˜é›…çš„apiæ–‡æ¡£çš„å†™æ³•"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146243285
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146243285
cover: https://bing.ee123.net/img/rand?artid=146243285
image: https://bing.ee123.net/img/rand?artid=146243285
img: https://bing.ee123.net/img/rand?artid=146243285
---

# ã€åç«¯ã€‘ã€django drfã€‘djangoè‡ªåŠ¨å¯¼å‡ºä¼˜é›…çš„apiæ–‡æ¡£çš„å†™æ³•

## Django DRF API ç¼–å†™è§„èŒƒï¼ˆåŒ…å« OpenAPI ç”Ÿæˆè§„åˆ™ï¼‰

ä¸ºäº†ç¡®ä¿ Django DRF API ä»£ç çš„
**å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§**
ï¼ŒåŒæ—¶
**ç”Ÿæˆæ¸…æ™°ã€è§„èŒƒã€ç»“æ„å±‚æ¬¡åˆ†æ˜**
çš„ OpenAPI æ–‡æ¡£ï¼Œå¿…é¡»éµå¾ªä»¥ä¸‹è§„åˆ™ã€‚

---

### ä¸€ã€ä½¿ç”¨ `drf-spectacular` ç”Ÿæˆ OpenAPI æ–‡æ¡£

#### ï¼ˆä¸€ï¼‰å®‰è£… `drf-spectacular`

```bash
pip install drf-spectacular

```

#### ï¼ˆäºŒï¼‰é…ç½® `settings.py`

```python
INSTALLED_APPS = [
    'drf_spectacular',
    'rest_framework',
]

REST_FRAMEWORK = {
    'DEFAULT_SCHEMA_CLASS': 'drf_spectacular.openapi.AutoSchema',
}

SPECTACULAR_SETTINGS = {
    'TITLE': "My API",
    'DESCRIPTION': "é¡¹ç›® API æ–‡æ¡£",
    'VERSION': '1.0.0',
    'SERVE_INCLUDE_SCHEMA': False,
    'SWAGGER_UI_SETTINGS': {
        'deepLinking': True,
        'defaultModelRendering': 'model',
        'defaultModelsExpandDepth': 2,
    },
}

```

#### ï¼ˆä¸‰ï¼‰æ·»åŠ  OpenAPI è·¯ç”±

```python
from drf_spectacular.views import SpectacularAPIView, SpectacularSwaggerView, SpectacularRedocView

urlpatterns = [
    path('api/schema/', SpectacularAPIView.as_view(), name='schema'),
    path('api/docs/', SpectacularSwaggerView.as_view(url_name='schema'), name='swagger-ui'),
    path('api/redoc/', SpectacularRedocView.as_view(url_name='schema'), name='redoc'),
]

```

* è®¿é—®
  `/api/docs/`
  ï¼šSwagger UI
* è®¿é—®
  `/api/redoc/`
  ï¼šReDoc

---

### äºŒã€ç¼–å†™æ¸…æ™°çš„ API è§†å›¾

#### ï¼ˆä¸€ï¼‰ä½¿ç”¨ `@extend_schema` è¯¦ç»†æè¿° API

```python
from drf_spectacular.utils import extend_schema
from rest_framework.viewsets import ModelViewSet
from .models import User
from .serializers import UserSerializer

class UserViewSet(ModelViewSet):
    queryset = User.objects.all()
    serializer_class = UserSerializer

    @extend_schema(
        summary="è·å–ç”¨æˆ·åˆ—è¡¨",
        description="è¿”å›æ‰€æœ‰ç”¨æˆ·çš„åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µã€‚",
        responses={200: UserSerializer(many=True)}
    )
    def list(self, request, *args, **kwargs):
        return super().list(request, *args, **kwargs)

```

##### **ğŸ“Œ è§„åˆ™**

1. `@extend_schema(summary="ç®€è¦è¯´æ˜", description="è¯¦ç»†æè¿°")`
   ç”¨äºä¸°å¯Œ API æ–‡æ¡£ã€‚
2. `responses={200: UserSerializer(many=True)}`
   ç¡®ä¿æ–‡æ¡£æ˜¾ç¤ºæ­£ç¡®çš„è¿”å›æ ¼å¼ã€‚

---

### ä¸‰ã€åœ¨ `serializers.py` é‡Œä¼˜åŒ–æ–‡æ¡£

#### ï¼ˆä¸€ï¼‰ä½¿ç”¨ `help_text` å’Œ `verbose_name` æä¾›å­—æ®µè¯´æ˜

```python
from rest_framework import serializers
from .models import User

class UserSerializer(serializers.ModelSerializer):
    username = serializers.CharField(help_text="ç”¨æˆ·åï¼Œå”¯ä¸€æ ‡è¯†")
    email = serializers.EmailField(help_text="ç”¨æˆ·çš„ç”µå­é‚®ç®±åœ°å€")

    class Meta:
        model = User
        fields = ["id", "username", "email"]

```

##### **ğŸ“Œ è§„åˆ™**

1. **`help_text`**
   ï¼šç”¨äº API æ–‡æ¡£ä¸­å±•ç¤ºå­—æ®µè¯´æ˜ã€‚
2. **`verbose_name`**
   ï¼šå¦‚æœæ¨¡å‹é‡Œå®šä¹‰äº†ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸ºå­—æ®µçš„æè¿°ã€‚

---

### å››ã€ä½¿ç”¨ `@extend_schema_view` è®© `ViewSet` æ›´æ¸…æ™°

å¦‚æœ
`ViewSet`
é‡Œçš„æ–¹æ³•è¾ƒå¤šï¼Œæ¯ä¸ªæ–¹æ³•éƒ½å†™
`@extend_schema`
ä¼šå¾ˆå†—ä½™ï¼Œå¯ä»¥ç›´æ¥ç»™æ•´ä¸ª
`ViewSet`
ç»Ÿä¸€å®šä¹‰ï¼š

```python
from drf_spectacular.utils import extend_schema_view

@extend_schema_view(
    list=extend_schema(summary="è·å–ç”¨æˆ·åˆ—è¡¨"),
    retrieve=extend_schema(summary="è·å–å•ä¸ªç”¨æˆ·è¯¦æƒ…"),
    create=extend_schema(summary="åˆ›å»ºæ–°ç”¨æˆ·"),
    update=extend_schema(summary="æ›´æ–°ç”¨æˆ·ä¿¡æ¯"),
    partial_update=extend_schema(summary="éƒ¨åˆ†æ›´æ–°ç”¨æˆ·ä¿¡æ¯"),
    destroy=extend_schema(summary="åˆ é™¤ç”¨æˆ·"),
)
class UserViewSet(ModelViewSet):
    queryset = User.objects.all()
    serializer_class = UserSerializer

```

##### **ğŸ“Œ è§„åˆ™**

1. `@extend_schema_view`
   ç»Ÿä¸€ç®¡ç†
   `ViewSet`
   æ–¹æ³•çš„æ–‡æ¡£ä¿¡æ¯ï¼Œé¿å…é‡å¤å†™
   `@extend_schema`
   ã€‚
2. é€‚ç”¨äº
   `ModelViewSet`
   ã€‚

---

### äº”ã€ç»™è¯·æ±‚å‚æ•°æä¾›æ˜ç¡®è¯´æ˜

#### **ï¼ˆä¸€ï¼‰åœ¨ `serializers.py` é‡Œå®šä¹‰ API è¯·æ±‚ä½“**

```python
from drf_spectacular.utils import OpenApiExample, extend_schema
from rest_framework import serializers

class UserCreateSerializer(serializers.Serializer):
    username = serializers.CharField(help_text="ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†")
    email = serializers.EmailField(help_text="ç”¨æˆ·çš„ç”µå­é‚®ç®±")
    password = serializers.CharField(write_only=True, help_text="å¯†ç ï¼Œè‡³å°‘8ä½")

    class Meta:
        fields = ["username", "email", "password"]

```

#### **ï¼ˆäºŒï¼‰åœ¨ `views.py` é‡Œä½¿ç”¨**

```python
from drf_spectacular.utils import extend_schema

@extend_schema(
    request=UserCreateSerializer,
    responses={201: UserSerializer},
    examples=[
        OpenApiExample(
            name="ç¤ºä¾‹ç”¨æˆ·",
            value={"username": "john_doe", "email": "john@example.com", "password": "securepassword"},
            request_only=True
        )
    ]
)
def create(self, request, *args, **kwargs):
    return super().create(request, *args, **kwargs)

```

##### **ğŸ“Œ è§„åˆ™**

1. **`request=UserCreateSerializer`**
   æŒ‡å®š API éœ€è¦çš„è¯·æ±‚å‚æ•°æ ¼å¼ã€‚
2. **`examples`**
   æä¾›ç¤ºä¾‹æ•°æ®ï¼Œæ–¹ä¾¿å‰ç«¯æŸ¥çœ‹ã€‚

---

### å…­ã€ä½¿ç”¨ `OpenApiParameter` å®šä¹‰æŸ¥è¯¢å‚æ•°

#### **ï¼ˆä¸€ï¼‰ç¤ºä¾‹**

```python
from drf_spectacular.utils import OpenApiParameter

@extend_schema(
    parameters=[
        OpenApiParameter(name="username", description="æŒ‰ç…§ç”¨æˆ·åç­›é€‰", required=False, type=str),
        OpenApiParameter(name="page", description="åˆ†é¡µå‚æ•°ï¼Œé»˜è®¤ä¸º1", required=False, type=int),
    ],
    responses={200: UserSerializer(many=True)}
)
def list(self, request, *args, **kwargs):
    return super().list(request, *args, **kwargs)

```

##### **ğŸ“Œ è§„åˆ™**

1. **`OpenApiParameter`**
   ç”¨äº API æŸ¥è¯¢å‚æ•°è¯´æ˜ã€‚
2. **`description="è¯´æ˜"`**
   ç¡®ä¿å‰ç«¯æ˜“äºç†è§£ã€‚

---

### ä¸ƒã€ç¤ºä¾‹ API ç«¯ç‚¹

#### **æœ€ç»ˆæ•ˆæœï¼ˆè®¿é—® `/api/docs/` ï¼‰**

```yaml
paths:
  /users/:
    get:
      summary: "è·å–ç”¨æˆ·åˆ—è¡¨"
      description: "è¿”å›æ‰€æœ‰ç”¨æˆ·çš„åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µ"
      parameters:
        - name: username
          in: query
          description: "æŒ‰ç…§ç”¨æˆ·åç­›é€‰"
          required: false
          schema:
            type: string
        - name: page
          in: query
          description: "åˆ†é¡µå‚æ•°ï¼Œé»˜è®¤ä¸º1"
          required: false
          schema:
            type: integer
      responses:
        "200":
          description: "æˆåŠŸè·å–ç”¨æˆ·åˆ—è¡¨"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
  /users/{id}/:
    get:
      summary: "è·å–å•ä¸ªç”¨æˆ·è¯¦æƒ…"
      description: "è¿”å›æŒ‡å®š ID çš„ç”¨æˆ·ä¿¡æ¯"
      responses:
        "200":
          description: "æˆåŠŸè·å–ç”¨æˆ·"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"

```

---

### **æ€»ç»“**

1. **`drf-spectacular`
   æ˜¯ Django DRF ç”Ÿæˆ OpenAPI æ–‡æ¡£çš„æœ€ä½³é€‰æ‹©**
   ã€‚
2. **ä½¿ç”¨
   `@extend_schema`
   ä¸º API æ–¹æ³•æ·»åŠ è¯¦ç»†è¯´æ˜**
   ï¼Œé¿å…è‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£ç¼ºå°‘æè¿°ã€‚
3. **åœ¨
   `serializers.py`
   é‡Œä½¿ç”¨
   `help_text`
   æä¾›å­—æ®µè¯´æ˜**
   ï¼Œæå‡å¯è¯»æ€§ã€‚
4. **ä½¿ç”¨
   `@extend_schema_view`
   ç»Ÿä¸€ç®¡ç†
   `ViewSet`
   çš„æ–‡æ¡£ä¿¡æ¯**
   ï¼Œå‡å°‘é‡å¤ä»£ç ã€‚
5. **ä½¿ç”¨
   `OpenApiParameter`
   æ˜ç¡®æŸ¥è¯¢å‚æ•°ï¼Œæå‡ API äº¤äº’æ€§**
   ã€‚
6. **æä¾›
   `examples`
   ç¤ºä¾‹ï¼Œè®©å‰ç«¯æ›´å®¹æ˜“ç†è§£ API è¯·æ±‚ç»“æ„**
   ã€‚

è¿™æ ·å¯ä»¥ç¡®ä¿ API æ–‡æ¡£æ¸…æ™°ã€å¯ç»´æŠ¤ï¼Œæ–¹ä¾¿å‰åç«¯åä½œ ğŸš€ã€‚