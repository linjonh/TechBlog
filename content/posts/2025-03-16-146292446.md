---
layout: post
title: "uniapp-多环境配置打包,比较优雅的解决方案,全网相对优解"
date: 2025-03-16 12:45:30 +0800
description: "读取.env.[development|test|staging|production]配置文件进行打包的方案我们如果有多个环境开发需求和打包需求，尤其是配置多个环境的接口请求地址等配置。针对这种情况，我在网上找了很多相关的资料，基本都是命令行的方案，使用uniapp的scripts方案也有，但是是把配置信息写到scripts上的，这解决方案也不够优雅，如果有多个配置就显得很拥肿了。"
keywords: "uniapp 多环境配置打包，比较优雅的解决方案，全网相对优解"
categories: ['未分类']
tags: ['Uniapp', 'Uniapp', 'Uniapp', 'Hbuilder']
artid: "146292446"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146292446
    alt: "uniapp-多环境配置打包,比较优雅的解决方案,全网相对优解"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146292446
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146292446
cover: https://bing.ee123.net/img/rand?artid=146292446
image: https://bing.ee123.net/img/rand?artid=146292446
img: https://bing.ee123.net/img/rand?artid=146292446
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     uniapp 多环境配置打包，比较优雅的解决方案，全网相对优解
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="uniapp__0">
     </a>
     uniapp 多环境配置打包，比较优雅的解决方案，全网相对优解
    </h2>
    <p>
     <em>
      读取.env.[development|test|staging|production]配置文件进行打包
     </em>
     ，最终效果如下图可以看到多个环境，
     <br/>
     并且我们可以自定义更多的环境配置
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/af58653b64514d8288037fd05c8e3585.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/830ff60bfbde4036b305508218123886.png"/>
     </img>
    </p>
    <h3>
     <a id="_7">
     </a>
     前言
    </h3>
    <p>
     由于uniapp的hbuilder开发工具，只提供了development和production的环境编译方式，一般来说，只能做到development和production两个环境的区分。在实际开发中，我们如果有多个环境开发需求和打包需求，尤其是配置多个环境的接口请求地址等配置。
     <br/>
     针对这种情况，我在网上找了很多相关的资料，基本都是命令行的方案，使用uniapp的scripts方案也有，但是是把配置信息写到scripts上的，这解决方案也不够优雅，如果有多个配置就显得很拥肿了。
    </p>
    <p>
     下面，我们一步一步来配置实现如何根据编译环境读取对应的.env文件加载到项目中。（下面只讲vite配置的方式，webpack的配置方式有空再补充）
    </p>
    <h3>
     <a id="_12">
     </a>
     配置实现
    </h3>
    <ol>
     <li>
      <p>
       项目根目录，自行新增对应的配置文件
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/af58653b64514d8288037fd05c8e3585.png"/>
      </p>
     </li>
     <li>
      <p>
       在package.json文件添加uni-app的scripts，需要配置几个环境就添加几个，关于这个配置的意思，可以去查看其他相关的文档，这里不展开讲述。
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c837d18ebe3b4ea086fdd933a9f503d6.png">
        <br/>
        配置好后，点击运行和发行就能看到对应的环境选择项了
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ba9ff40030bf493799af15ea665104f8.png">
         <br/>
         此时只是有对应的环境选择项，接下来的思路就是，判断对应的script执行环境，来加载不同的.env配置文件，读取到项目中
        </img>
       </img>
      </p>
     </li>
     <li>
      <p>
       修改vite.config.js文件,重点看注释
      </p>
     </li>
    </ol>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> loadEnv <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> uni <span class="token keyword">from</span> <span class="token string">'@dcloudio/vite-plugin-uni'</span><span class="token punctuation">;</span>
<span class="token comment">// import viteCompression from 'vite-plugin-compression';</span>
<span class="token comment">// https://vitejs.dev/config/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">command<span class="token punctuation">,</span> mode</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//uniapp中，这个mode,不用命令行的添加--mode编译的话，是undefined的</span>
	<span class="token keyword">let</span> env <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>mode<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//这里是为了确保mode有值，假如开发人员直接在开发工具选择编译到浏览器，也能兼容到</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token operator">==</span><span class="token string">'production'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			mode <span class="token operator">=</span> <span class="token string">'production'</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
			mode <span class="token operator">=</span> <span class="token string">'development'</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_SCRIPT</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//这个就是第三步配置的uni-app的script,一一对应判断</span>
		<span class="token keyword">case</span> <span class="token string">'dev-h5'</span><span class="token operator">:</span>
			mode <span class="token operator">=</span> <span class="token string">'development'</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token string">'test-h5'</span><span class="token operator">:</span>	
			mode <span class="token operator">=</span> <span class="token string">'test'</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token string">'stage-h5'</span><span class="token operator">:</span>
			mode <span class="token operator">=</span> <span class="token string">'staging'</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token string">'prod-h5'</span><span class="token operator">:</span>
			mode <span class="token operator">=</span> <span class="token string">'production'</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	env <span class="token operator">=</span> <span class="token function">loadEnv</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span> __dirname<span class="token punctuation">,</span><span class="token string">"APP"</span><span class="token punctuation">)</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">编译</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>mode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">环境</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//此时已经把env配置读取到了，并且这是个json格式，</span>
	<span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//别试图在这里定义mode,试过了，在uniapp中不起作用，目前方案只想到了用define来做</span>
		<span class="token literal-property property">envPrefix</span><span class="token operator">:</span><span class="token string">'APP_'</span><span class="token punctuation">,</span>
		<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token function">uni</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token literal-property property">server</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
			<span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
			<span class="token comment">// open: true,</span>
			<span class="token literal-property property">port</span><span class="token operator">:</span> env<span class="token punctuation">.</span><span class="token constant">APP_PORT</span><span class="token punctuation">,</span>
			<span class="token literal-property property">hmr</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">overlay</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token literal-property property">define</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token comment">//根据vite的官方文档，可以把define定义的变量名，在项目编译时，识别项目文件中的这个变量名直接替换成env配置，我们把这个变量放到config.js文件中，对env配置进行集中管理</span>
			<span class="token literal-property property">__VITE_ENV__</span><span class="token operator">:</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <ol start="5">
     <li>
      接下来在项目中由一个config.js文件来集中管理env相关的配置，再暴露出来给其他业务模块调用。
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a8564555fa334cd1a1ccf8662db39183.png">
       <br/>
       至此，uniapp的多环境配置已经完成！！！
       <br/>
       如果需要命令行配置打包，可以参考其他的博客，直接配置命令行就可以，命令行写–mode参数即可。
      </img>
     </li>
    </ol>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031323330383438312f:61727469636c652f64657461696c732f313436323932343436" class_="artid" style="display:none">
 </p>
</div>


