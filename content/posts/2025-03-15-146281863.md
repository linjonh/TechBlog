---
arturl_encode: "68747470733a2f2f626c6f672e:6373646e2e6e65742f7a7a775f31373630303639313335372f:61727469636c652f64657461696c732f313436323831383633"
layout: post
title: "redis删除与先判断再删除的区别"
date: 2025-03-15 16:54:51 +0800
description: "redis直接删除与先判断存在后再删除的区别"
keywords: "redis删除与先判断再删除的区别"
categories: ['未分类']
tags: ['缓存', '数据库', 'Redis']
artid: "146281863"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146281863
    alt: "redis删除与先判断再删除的区别"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146281863
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146281863
cover: https://bing.ee123.net/img/rand?artid=146281863
image: https://bing.ee123.net/img/rand?artid=146281863
img: https://bing.ee123.net/img/rand?artid=146281863
---

# redis删除与先判断再删除的区别

在Redis中，“先判断存在再删除”与“直接删除”的区别主要体现在‌
**操作效率、原子性保障、并发安全性**
‌三个方面，具体对比如下：

---

#### ‌ **1. 操作效率** ‌

* ‌
  **直接删除**
  ‌：仅需执行
  `DEL`
  命令一次，无论键是否存在均直接操作，无额外判断步骤。时间复杂度为
  `O(1)`
  ，适合高频操作场景‌。
* ‌
  **先判断存在再删除**
  ‌：需先执行
  `EXISTS`
  命令判断键是否存在，再根据结果执行
  `DEL`
  。若键不存在，
  `DEL`
  命令仍会执行但实际无操作，导致‌
  **两次网络请求和两次命令执行**
  ‌，增加耗时和资源消耗‌。

---

#### ‌ **2. 原子性保障** ‌

* ‌
  **直接删除**
  ‌：
  `DEL`
  命令本身是原子操作，执行过程不会被其他客户端命令打断，保证操作的完整性‌。
* ‌
  **先判断存在再删除**
  ‌：
  `EXISTS`
  与
  `DEL`
  为两个独立操作，在两者间隔期间可能因其他客户端修改键状态（如删除或更新），导致判断结果与实际删除操作不一致（‌
  **竞态条件**
  ‌）‌。

---

#### ‌ **3. 并发安全性** ‌

* ‌
  **直接删除**
  ‌：在高并发场景下，仅需关注
  `DEL`
  的返回结果（返回
  `1`
  表示删除成功，
  `0`
  表示键不存在），无需额外逻辑即可处理并发冲突‌。
* ‌
  **先判断存在再删除**
  ‌：若多个客户端同时判断键存在并尝试删除，可能导致重复删除或误删问题（如键已被其他客户端删除）‌。

---

#### ‌ **总结对比** ‌

| ‌ **场景** ‌ | ‌ **直接删除** ‌ | ‌ **先判断存在再删除** ‌ |
| --- | --- | --- |
| ‌ **执行次数** ‌ | 1次命令 | 2次命令（ `EXISTS` + `DEL` ） |
| ‌ **网络开销** ‌ | 低（单次请求） | 高（两次请求） |
| ‌ **原子性** ‌ | 强（单命令原子性） | 弱（命令组合非原子） |
| ‌ **适用场景** ‌ | 无需关心键是否存在的场景 | 需记录键状态或统计删除次数的场景 |
| ‌ **性能影响** ‌ | 更高效 | 效率较低，存在竞态风险 |

---

#### ‌ **推荐方案** ‌

* ‌
  **优先选择直接删除**
  ‌：通过
  `DEL`
  命令的返回值（
  `0`
  或
  `1`
  ）即可判断是否删除成功，无需额外操作‌。
* ‌特殊场景处理

  若需记录键的删除状态，可结合事务（MULTI/EXEC）或Lua脚本保证操作的原子性‌。例如：

  ```lua
  if redis.call('EXISTS', KEYS‌:ml-citation{ref="5" data="citationList"}) == 1 then
    return redis.call('DEL', KEYS‌:ml-citation{ref="5" data="citationList"})
  else
    return 0
  end

  ```