---
layout: post
title: "MySQL6-数据库约束"
date: 2025-03-16 18:14:49 +0800
description: "就是自动对数据、表间关联关系的正确性校验，一般在列上加约束。        限制数据值不能为 null，比如学生姓名：        限制数据值唯一，比如 id：        但是 unique 限制的 id 可以有重复的 null：        限制数据唯一且不为空，可以由一个或多个列组成，用于唯一标识数据行，建议每个表都有一个主键，但一个表最多只能有一个主键，最多只能有一个 auto_increment 列，主键类型建议为 bigint。        插入数据：        当插入失败时（比如设"
keywords: "【MySQL】(6) 数据库约束"
categories: ['Mysql']
tags: ['数据库', 'Mysql']
artid: "146295988"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146295988
    alt: "MySQL6-数据库约束"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146295988
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146295988
cover: https://bing.ee123.net/img/rand?artid=146295988
image: https://bing.ee123.net/img/rand?artid=146295988
img: https://bing.ee123.net/img/rand?artid=146295988
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【MySQL】(6) 数据库约束
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     一、约束的作用
    </h2>
    <p>
     就是
     <strong>
      自动对数据、表间关联关系的正确性校验
     </strong>
     ，一般在列上加约束。
    </p>
    <h2>
     二、各种约束
    </h2>
    <h3>
     1、非空约束 not null
    </h3>
    <p>
     限制数据值不能为 null，比如学生姓名：
    </p>
    <p>
     <img alt="" height="548" src="https://i-blog.csdnimg.cn/direct/38cefe18b7b7483ab77ddc002b136756.png" width="1368"/>
    </p>
    <h3>
     2、唯一约束 unique
    </h3>
    <p>
     限制数据值唯一，比如 id：
    </p>
    <p>
     <img alt="" height="432" src="https://i-blog.csdnimg.cn/direct/1b92489f183c4823998eee6f71c50ca6.png" width="1473"/>
    </p>
    <p>
     但是 unique 限制的 id 可以有重复的 null：
    </p>
    <p>
     <img alt="" height="199" src="https://i-blog.csdnimg.cn/direct/b8543c483ed34124b32d30c027ed957b.png" width="527"/>
    </p>
    <h3>
     3、主键约束 primary key
    </h3>
    <p>
     限制数据唯一且不为空，
     <strong>
      可以由一个或多个列组成
     </strong>
     ，用于唯一标识数据行，建议每个表都有一个主键，但
     <strong>
      一个表最多只能有一个主键
     </strong>
     ，
     <strong>
      最多只能有一个 auto_increment 列
     </strong>
     ，主键类型建议为 bigint。
    </p>
    <p>
     <img alt="" height="383" src="https://i-blog.csdnimg.cn/direct/5b315a3b23714f57873b43dd320f65af.png" width="1179"/>
    </p>
    <p>
     插入数据：
    </p>
    <p>
     <img alt="" height="401" src="https://i-blog.csdnimg.cn/direct/b0318a7f144348c78c09972624c52e61.png" width="1203"/>
    </p>
    <p>
     <img alt="" height="515" src="https://i-blog.csdnimg.cn/direct/982487a68d1448dda4f21b14a9dca1c8.png" width="1291"/>
    </p>
    <p>
     当插入失败时（比如设置 id 为重复值），插入失败的那个自增值会失效（auto_imcrement 只会增加，不会减少）：
    </p>
    <p>
     <img alt="" height="354" src="https://i-blog.csdnimg.cn/direct/ef42337f9f83440dbd3319657b987d3a.png" width="1486"/>
    </p>
    <p>
     <img alt="" height="263" src="https://i-blog.csdnimg.cn/direct/e2c284b1c95e482694587c13b61497bd.png" width="401"/>
    </p>
    <p>
     当预计插入数据的主键、唯一键会有重复时，可以用以下两种语法（先把 name 设置为 unique）：
    </p>
    <p>
     <img alt="" height="63" src="https://i-blog.csdnimg.cn/direct/0ee083ecf2994feeaf927ccff8148dbc.png" width="491"/>
    </p>
    <p>
     语法1：主键、唯一键冲突，则
     <strong>
      更新数据
     </strong>
     ；不冲突，则直接插入（恢复到原样再执行）：
    </p>
    <p>
     <img alt="" height="206" src="https://i-blog.csdnimg.cn/direct/5146d86b46be4dd1811f2d3e7521c1b7.png" width="357"/>
    </p>
    <p>
     语法2：主键、唯一键冲突，则
     <strong>
      删除数据，再添加
     </strong>
     ；不冲突，则直接插入：
    </p>
    <p>
     <img alt="" height="212" src="https://i-blog.csdnimg.cn/direct/3cf059cd4cbe42c4a4163ec5f598530c.png" width="420"/>
    </p>
    <p>
     在工作中是
     <strong>
      不建议替换旧记录
     </strong>
     的，应该先查询有没有冲突，没有就插入。有就做更新操作，要么把旧记录的 deleteState 设为 1，再添加新记录。
    </p>
    <p>
     修改 (id, name) 为一个主键：
    </p>
    <p>
     <img alt="" height="190" src="https://i-blog.csdnimg.cn/direct/52bef4b75b1847c9b3aa0630a77ec9b2.png" width="519"/>
    </p>
    <p>
     primary key 和 not null + unique 是不一样的。primary key 是表的属性，一个表只能有一个主键；而 not null + unique 是业务数据的要求，一个表中的很多数据都可以是 not null + unique 。
    </p>
    <h3>
     4、外键约束 foreign key
    </h3>
    <p>
     外键约束
     <strong>
      定义了主表和从表之间的关系
     </strong>
     。
     <strong>
      外键约束定义在从表
     </strong>
     中，从表
     <strong>
      引用的主表列必须是主键或唯一键
     </strong>
     。当从表中的外键约束列添加值时，
     <strong>
      只能从主表的引用列中的值选择，或者为 null
     </strong>
     。
    </p>
    <p>
     语法：
    </p>
    <p>
     <img alt="" height="35" src="https://i-blog.csdnimg.cn/direct/5ec27804e0d74571bcb514ec9b7db71c.png" width="352"/>
    </p>
    <p>
     创建班级表和学生表：
    </p>
    <pre><code class="language-sql">drop table if exists class;
create table class (
  id bigint primary key auto_increment,
  name varchar(20) not null
);
insert into class (name) values ('java01'), ('java02'), ('java03'), ('C++01'), ('C++02');

drop table if exists student;
create table student(
  id bigint PRIMARY KEY auto_increment,  
  name varchar(20) not null,
  age int DEFAULT 18,
  class_id bigint,
  foreign key (class_id) references class(id)  # 外键约束
);</code></pre>
    <p>
     查看表结构：
    </p>
    <p>
     <img alt="" height="182" src="https://i-blog.csdnimg.cn/direct/1a30dba53d5743ddbb876e2fccf4e553.png" width="469"/>
    </p>
    <p>
     插入一个不存在的班级编号的学生信息：
    </p>
    <p>
     <img alt="" height="461" src="https://i-blog.csdnimg.cn/direct/0bc0b7d2464f47d7808e213b8d5c0750.png" width="1543"/>
    </p>
    <p>
     如果从表引用了主表中的列值，主表就不能随意删除该列值，或者删除主表。如果非要删除，从表必须删除引用的值，或者删除外键约束：
    </p>
    <p>
     <img alt="" height="33" src="https://i-blog.csdnimg.cn/direct/053536d4c27a417ca0d61663465ac29b.png" width="492"/>
    </p>
    <p>
     外键约束影响数据库效率，数据量很大时，在 java 程序中处理关联关系，校验好后再入库。
    </p>
    <h3>
     5、默认约束 default
    </h3>
    <p>
     就是给列一个默认值，插入数据时，若
     <strong>
      没有给该列指定值，则给默认值
     </strong>
     。如果
     <strong>
      给了指定值，不管是 null 还是不是 null，都以设置的值为准
     </strong>
     。
    </p>
    <p>
     <img alt="" height="97" src="https://i-blog.csdnimg.cn/direct/e0b4229ac6d04a25abaf4ef658996cc8.png" width="390"/>
    </p>
    <h3>
     6、check 约束
    </h3>
    <p>
     就是对数据值限定一个范围，8.0.16 版本后才起作用，check 约束也会像外键约束一样自动设置一个 check 约束名。语法如下：
    </p>
    <p>
     <img alt="" height="129" src="https://i-blog.csdnimg.cn/direct/8b080d3ec4ad4959a0472cfd2e38ae23.png" width="348"/>
    </p>
    <p>
     因为很多老版本 MySQL 不支持 check，所以把校验放在 java 程序中。
    </p>
    <p>
     <strong>
      常用的就是非空、唯一、主键、默认约束
     </strong>
     ，外键约束在大公司不用，check 约束不用。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323430315f38363237323634382f:61727469636c652f64657461696c732f313436323935393838" class_="artid" style="display:none">
 </p>
</div>


