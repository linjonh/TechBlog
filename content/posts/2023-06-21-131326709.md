---
layout: post
title: "解决阿里云服务器被植入挖矿脚本过程"
date: 2023-06-21 14:53:08 +0800
description: "基于学习的便利性，在阿里云服务中购买了云服务器，但是突然被告警提示被挖矿，而且要在一定期限内解决挖矿"
keywords: "解决阿里云服务器被植入挖矿脚本过程"
categories: ['运维篇']
tags: ['阿里云', '服务器', '云计算']
artid: "131326709"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=131326709
    alt: "解决阿里云服务器被植入挖矿脚本过程"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=131326709
featuredImagePreview: https://bing.ee123.net/img/rand?artid=131326709
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     解决阿里云服务器被植入挖矿脚本过程
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#_6" rel="nofollow">
        前言
       </a>
      </li>
      <li>
       <a href="#_14" rel="nofollow">
        一、服务器为什么会被告警挖矿？
       </a>
      </li>
      <li>
       <a href="#_20" rel="nofollow">
        二、怎么解决：
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1top_cpu__22" rel="nofollow">
          1.top 命令查看进程cpu 占用情况：
         </a>
        </li>
        <li>
         <a href="#2pid_30" rel="nofollow">
          2.通过pid进程号，查找改程序所在的目录：
         </a>
        </li>
        <li>
         <a href="#3__38" rel="nofollow">
          3. 强制删除脚本文件：
         </a>
        </li>
        <li>
         <a href="#4__44" rel="nofollow">
          4. 强制杀死进程：
         </a>
        </li>
        <li>
         <a href="#5__51" rel="nofollow">
          5. 检查是否有脚本的定时任务：
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#51__53" rel="nofollow">
            5.1 检查定时任务是否开启：
           </a>
          </li>
          <li>
           <a href="#52__59" rel="nofollow">
            5.2 查看存在的任务：
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#6__76" rel="nofollow">
          6. 检查是否被创建了其它用户：
         </a>
        </li>
        <li>
         <a href="#7__89" rel="nofollow">
          7. 登录阿里云的后端在云安全中心处理告警事件：
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_98" rel="nofollow">
        总结:
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <hr/>
    <h2>
     <a id="_6">
     </a>
     前言
    </h2>
    <p>
     基于学习的便利性，在阿里云服务中购买了云服务器，但是突然被告警提示被挖矿，而且要在一定期限内解决挖矿问题，否则就会被关停服务，本篇对于其处理过程进行一个记录，可能对于挖矿的处理也不全面，欢迎各路大神进行评论交流。
    </p>
    <hr/>
    <h2>
     <a id="_14">
     </a>
     一、服务器为什么会被告警挖矿？
    </h2>
    <p>
     云服务器中被恶意安装了脚本，然后脚本运行占用了大量的cpu 和内存，触发了云服务器监控的告警；
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ada38bae478f3e5abc046230f0b9a62a.png"/>
    </p>
    <h2>
     <a id="_20">
     </a>
     二、怎么解决：
    </h2>
    <p>
     挖矿行为需要强大的算力支持，所以其一定会占用大量的cpu 资源，所以我们以此关键点展开
    </p>
    <h3>
     <a id="1top_cpu__22">
     </a>
     1.top 命令查看进程cpu 占用情况：
    </h3>
    <pre><code class="prism language-shell"><span class="token function">top</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/26400688aeadaec267fc4b75d23697de.png">
      <br/>
      cpu 占用越多，该进程是挖矿进程的可能性越大，可以清楚的看到有进程竟然将cpu 的占用率达到了100% ；
     </img>
    </p>
    <h3>
     <a id="2pid_30">
     </a>
     2.通过pid进程号，查找改程序所在的目录：
    </h3>
    <p>
     <code>
      提示{pid} 为 top 命令 第一列对应的PID
     </code>
    </p>
    <pre><code class="prism language-shell"> <span class="token function">ls</span> -l /proc/<span class="token punctuation">{<!-- --></span>pid<span class="token punctuation">}</span><span class="token operator">|</span> <span class="token function">grep</span> exe
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b78d4f257f0e82d8faa9b3e1f724554d.png">
      <br/>
      这里可以清楚的看到改进程脚本所在的目录；
     </img>
    </p>
    <h3>
     <a id="3__38">
     </a>
     3. 强制删除脚本文件：
    </h3>
    <pre><code class="prism language-shell"><span class="token function">rm</span>  -f  跟文件的路径
</code></pre>
    <h3>
     <a id="4__44">
     </a>
     4. 强制杀死进程：
    </h3>
    <pre><code class="prism language-shell"><span class="token function">kill</span> -9 <span class="token punctuation">{<!-- --></span>pid<span class="token punctuation">}</span>
</code></pre>
    <p>
     通过以上步骤，我们已经删掉了脚本文件，并且杀死了进程，此时cpu 的占用应该会显著下降，可以使用top 命令在观察下；
    </p>
    <h3>
     <a id="5__51">
     </a>
     5. 检查是否有脚本的定时任务：
    </h3>
    <p>
     <code>
      防止定时有挖矿的定时任务存在
     </code>
     ；
    </p>
    <h4>
     <a id="51__53">
     </a>
     5.1 检查定时任务是否开启：
    </h4>
    <pre><code class="prism language-shell">systemctl status crond
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/bdd94974a2c995c5142e7e85b486a9a4.png"/>
    </p>
    <h4>
     <a id="52__59">
     </a>
     5.2 查看存在的任务：
    </h4>
    <pre><code class="prism language-shell"><span class="token function">crontab</span> -l
</code></pre>
    <p>
     如果发现有可疑的任务 则编辑删掉任务（记得看下这个脚本的位置将脚本也一起删掉）：
    </p>
    <pre><code class="prism language-shell"> <span class="token function">vim</span> /etc/crontab
</code></pre>
    <p>
     然后重新加载任务：
    </p>
    <pre><code class="prism language-shell">/bin/systemctl restart crond
</code></pre>
    <h3>
     <a id="6__76">
     </a>
     6. 检查是否被创建了其它用户：
    </h3>
    <pre><code class="prism language-shell"><span class="token function">cat</span> /etc/passwd
</code></pre>
    <p>
     如果发现被创建了用户则进行删除：
     <br/>
     删除用户和用户组：其中 username 是需要删除的用户的用户名
    </p>
    <pre><code class="prism language-shell"><span class="token function">userdel</span> -r username <span class="token operator">&amp;&amp;</span> <span class="token function">groupdel</span> username
</code></pre>
    <h3>
     <a id="7__89">
     </a>
     7. 登录阿里云的后端在云安全中心处理告警事件：
    </h3>
    <p>
     当出现挖矿事件时，云安全中心会产生挖矿程序的告警事件，在这个列表下单击
     <code>
      操作列
     </code>
     的
     <code>
      处理
     </code>
     ，完成处理：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3be0e29b213cb852c3216cbc5fa86e92.png"/>
    </p>
    <hr/>
    <h2>
     <a id="_98">
     </a>
     总结:
    </h2>
    <p>
     以上就是今天要讲的内容，本文仅仅简单记录了处理服务器挖矿的流程，记录的不全面，欢迎各路大神探讨交流。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f6c3132336c67782f:61727469636c652f64657461696c732f313331333236373039" class_="artid" style="display:none">
 </p>
</div>


