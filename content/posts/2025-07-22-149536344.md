---
layout: post
title: "黑马SpringCloud微服务开发与实战五微服务保护"
date: 2025-07-22T17:02:45+0800
description: "本文介绍了微服务架构中的雪崩问题及其解决方案，重点讲解了Sentinel的快速入门和使用方法。内容涵盖：1）雪崩问题原因分析；2）通过Sentinel实现请求限流、线程隔离和熔断降级等解决方案；3）Sentinel的本地启动和与Spring Cloud集成配置；4）演示了自定义Fallback处理异常请求；5）详细说明了如何配置服务熔断规则。Sentinel作为强大的流量控制组件，能有效提高系统稳定性和容错能力。文章提供了完整的代码示例和配置说明，便于开发者快速实现服务保护功能。"
keywords: "黑马程序员微服务sentinel"
categories: ['未分类']
tags: ['微服务', 'Spring', 'Spring', 'Cloud']
artid: "149536344"
arturl: "https://blog.csdn.net/xtreallydance/article/details/149536344"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=149536344
    alt: "黑马SpringCloud微服务开发与实战五微服务保护"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=149536344
featuredImagePreview: https://bing.ee123.net/img/rand?artid=149536344
cover: https://bing.ee123.net/img/rand?artid=149536344
image: https://bing.ee123.net/img/rand?artid=149536344
img: https://bing.ee123.net/img/rand?artid=149536344
---



# 【黑马SpringCloud微服务开发与实战】（五）微服务保护



#### 1.雪崩问题——原因分析

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/eab3d95943a5444085430c82ef753375.png)

#### 2.雪崩问题——解决方案

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/113d2fcf1af74eb09d905ad69c1cdfa1.png)

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/d740fd88ce024714919a01ec80b50534.png)

#### 3.Sentinel——快速入门

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/e1335dcae46749ebbd3d3491abd87450.png)

本地启动：从资料里面获取jar包并且把版本后缀去掉和命令的名称一致

```powershell
java -Dserver.port=8090 -Dcsp.sentinel.dashboard.server=localhost:8090 -Dproject.name=sentinel-dashboard -jar sentinel-dashboard.jar

```

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/ce07a13cf87b4286a3d003cb60105f26.png)  
http://localhost:8090 访问sentinel

cart服务整合sentinel

```xml
<!--sentinel-->
<dependency>
    <groupId>com.alibaba.cloud</groupId> 
    <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>
</dependency>

```

```yaml
spring:
  cloud: 
    sentinel:
      transport:
        dashboard: localhost:8090

```

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/27a1e6b92c724dbfbba05b8d28d48d8f.png)

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/551de93a525144a886eb31a47cdb268d.png)

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/3a8817ec436c422db446724dce639d19.png)

```yaml
spring:
  cloud:
    sentinel:
      transport:
        dashboard: localhost:8090
      http-method-specify: true # 开启请求方式前缀

```

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/e7f7e410a862441990bdaff71451d465.png)

#### 4.Sentinel——请求限流

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/6b2d9a11131d46228992209750dd950d.png)

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/732d9794fa9e4d5fa6bcbc8f79f73fe4.png)

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/3f970436a4064ea8ace2432bd3c952db.png)

用户信息  
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/9a02afac1a214c1288c3c8c3699cdec5.png)  
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/bd01f883cf0a4401af4a391878bffffa.png)

#### 5.Sentinel——线程隔离

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/41c1ba968bf2417cae0c36fda49ce7d8.png)  
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/a5e894b4e5ee4b4e927aba9df5701079.png)

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/a540400e117f4bf9994f864942bcf27e.png)

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/a6c01cc23a0a4841af33bda4e87807d3.png)  
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/00b76fbd0b2847e1aaf0835f614dd8e0.png)

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/dd644ee06fc44ef08b2a982f72d858ff.png)

#### 6.Sentinel——Fallback

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/634166dc959c406e85547714a7dd26cf.png)

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/abde121d1fbc427190ff9a4932741cd0.png)

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/4833ad254779458e86bef6d0ee9325df.png)

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/5962260da02e4a54a10f5661b63fe9b0.png)

```java
@Slf4j
public class ItemClientFallback implements FallbackFactory<ItemClient> {
    @Override
    public ItemClient create(Throwable cause) {
        return new ItemClient() {
            @Override
            public List<ItemDTO> queryItemByIds(Collection<Long> ids) {
                log.error("远程调用ItemClient#queryItemByIds方法出现异常，参数：{}", ids, cause);
                // 查询购物车允许失败，查询失败，返回空集合
                return CollUtils.emptyList();
            }

            @Override
            public void deductStock(List<OrderDetailDTO> items) {
                // 库存扣减业务需要触发事务回滚，查询失败，抛出异常
                throw new BizIllegalException(cause);
            }
        };
    }
}

```

放置DefaultFeignConfig中进行声明

```java
    @Bean
    public ItemClientFallback itemClientFallback(){
        return new ItemClientFallback();
    }

```

```java
@FeignClient(value = "item-service",
        configuration = DefaultFeignConfig.class,
        fallbackFactory = ItemClientFallback.class)
public interface ItemClient {

    @GetMapping("/items")
    List<ItemDTO> queryItemByIds(@RequestParam("ids") Collection<Long> ids);

    @PutMapping("/items/stock/deduct")
    void deductStock(@RequestBody List<OrderDetailDTO> items);
}


```

```yaml
feign:
  okhttp:
    enabled: true # 开启OKHttp功能
  sentinel:
    enabled: true

```

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/aa4595af5dd24025803c4919eada94a0.png)

![

| 在这里插入图片描述 |  |
| --- | --- |
|  |  |
| ](https://i-blog.csdnimg.cn/direct/a0e64688bd644f5881334da5a2866c37.png) |  |

#### 7.Sentinel——服务熔断

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/e19d7bc0c12447ca9935b22c1d3f8553.png)

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/230b73d829414313a9cb79bbc0677dc3.png)

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/21688ddb65114eb99f779d27ed72980b.png)

20s后熔断结束后会发送一个请求看商品服务查询是否正常，如果不正常继续熔断，反之。。。。。。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/f77ee019ed9646e481a9bcb13be4fae0.png)



