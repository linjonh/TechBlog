---
layout: post
title: "ROS2-话题学习"
date: 2025-03-09 22:17:56 +0800
description: "自己写的代码放在./demo_python_pkg/demo_python_pkg目录下。格式为：\"名字 = 包名.文件名:函数名\"可执行的节点文件在以下文件夹。在根目录运行以下终端命令。"
keywords: "ROS2-话题学习"
categories: ['Ros']
tags: ['学习']
artid: "146139684"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146139684
    alt: "ROS2-话题学习"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146139684
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146139684
cover: https://bing.ee123.net/img/rand?artid=146139684
image: https://bing.ee123.net/img/rand?artid=146139684
img: https://bing.ee123.net/img/rand?artid=146139684
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ROS2-话题学习
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     强烈推荐教程：
    </p>
    <p>
     <a href="https://www.bilibili.com/video/BV18GWreJEVo?spm_id_from=333.788.player.switch&amp;vd_source=fbdf774a64421b7b232ae166a621500c" rel="nofollow" title="《ROS 2机器人开发从入门到实践》3.2.2订阅小说并合成语音_哔哩哔哩_bilibili">
      《ROS 2机器人开发从入门到实践》3.2.2订阅小说并合成语音_哔哩哔哩_bilibili
     </a>
    </p>
    <p>
    </p>
    <h4>
     <strong>
      构建功能包
     </strong>
    </h4>
    <blockquote>
     <p>
      # create package demo_python_pkg
     </p>
     <p>
      ros2 pkg create --build-type ament_python --license Apache-2.0 demo_python_pkg
     </p>
    </blockquote>
    <p>
     <strong>
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#fe2c24">
       自己写的代码放在./demo_python_pkg/demo_python_pkg目录下
      </span>
     </strong>
    </p>
    <p>
    </p>
    <h4>
     <strong>
      发布者
     </strong>
    </h4>
    <pre><code class="language-python">import rclpy
from rclpy.node import Node
import requests
from example_interfaces.msg import String
from queue import Queue


class NovelPubNode(Node):
    def __init__(self, node_name):
        super().__init__(node_name)
        self.novels_queue = Queue()
        self.get_logger().info("NovelPubNode has been started")
        self.novel_pub = self.create_publisher(String, "novel_topic", 10)

        self.timer = self.create_timer(5,self.timer_callback)


    def timer_callback(self):
        if not self.novels_queue.empty():
            line = self.novels_queue.get()
            msg = String()
            msg.data = line
            self.novel_pub.publish(msg)
            self.get_logger().info(f"Published novel: {line}")       

    def download_novel(self, url):
        response = requests.get(url)
        response.encoding = 'utf-8'
        text = response.text
        for text_line in text.splitlines():
            self.novels_queue.put(text_line)

        self.get_logger().info(f"Downloaded novel: {text}")



def main():
    rclpy.init()
    node = NovelPubNode("novel_pub_node")
    node.download_novel("http://0.0.0.0:8000/novel_1.txt")
    rclpy.spin(node)
    node.shutdown()</code></pre>
    <p>
    </p>
    <h4>
     <strong>
      订阅者
     </strong>
    </h4>
    <pre><code class="language-python">import time
import espeakng
import rclpy
from rclpy.node import Node
from example_interfaces.msg import String
from queue import Queue
import threading


class NovelSubNode(Node):
    def __init__(self, node_name):
        super().__init__(node_name)
        self.get_logger().info("NovelSubNode has been created!")
        self.novels_queue = Queue()
        self.create_subscription(String, "novel_topic", self.novel_callback, 10)
        self.say_thread = threading.Thread(target=self.say)
        self.say_thread.start()
        


    def novel_callback(self, msg):
        self.novels_queue.put(msg.data)
        


    def say(self):
        engine = espeakng.Speaker()
        engine.voice = "zh"
        while rclpy.ok():
            if not self.novels_queue.empty():
                novel = self.novels_queue.get()
                engine.say(novel)
                print("Said: " + novel)
                engine.wait()
            else:
                time.sleep(1)



def main():
    rclpy.init()
    node = NovelSubNode("novel_sub_node")
    rclpy.spin(node)
    rclpy.shutdown()
    </code></pre>
    <p>
    </p>
    <p>
     <span style="color:#fe2c24">
      <strong>
       代码完成后，配置setup.py文件
      </strong>
     </span>
    </p>
    <p>
     <img alt="" height="693" src="https://i-blog.csdnimg.cn/direct/d6e934477bc845c2b6d8fd74bec0f942.png" width="1328"/>
    </p>
    <p>
     格式为："名字 = 包名.文件名:函数名"
    </p>
    <p>
    </p>
    <p>
     <strong>
      <span style="color:#fe2c24">
       在根目录运行以下终端命令
      </span>
     </strong>
    </p>
    <blockquote>
     <p>
      # build package demo_python_pkg
     </p>
     <p>
      colcon build
     </p>
     <p>
     </p>
     <p>
      # source setup.bash
     </p>
     <p>
      source install/setup.bash
     </p>
    </blockquote>
    <p>
     <span style="color:#1a439c">
      <strong>
       运行以上命令后，得到build、install、log文件夹
      </strong>
     </span>
    </p>
    <p>
    </p>
    <p>
     可执行的节点文件在以下文件夹
    </p>
    <p>
     <strong>
      <span style="color:#ff9900">
       ./install/demo_python_pkg/lib/demo_python_pkg
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#ff9900">
       运行节点命令
      </span>
     </strong>
    </p>
    <blockquote>
     <p>
      ros2 run demo_python_pkg python_pub_node
     </p>
     <p>
      ros2 run demo_python_pkg python_sub_node
     </p>
    </blockquote>
    <p>
    </p>
    <h4>
     <span style="color:#fe2c24">
      <strong>
       其他常用命令
      </strong>
     </span>
    </h4>
    <blockquote>
     <p>
      # check if node is running
     </p>
     <p>
      ros2 node list
     </p>
     <p>
     </p>
     <p>
      # check if topic is published
     </p>
     <p>
      ros2 topic list
     </p>
     <p>
     </p>
     <p>
      # check topic content
     </p>
     <p>
      ros2 topic echo /novel_topic
     </p>
     <p>
     </p>
     <p>
      # check topic speed
     </p>
     <p>
      ros2 topic hz /novel_topic
     </p>
     <p>
     </p>
     <p>
      # check if service is available
     </p>
     <p>
      ros2 service list
     </p>
    </blockquote>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34393832343730332f:61727469636c652f64657461696c732f313436313339363834" class_="artid" style="display:none">
 </p>
</div>


