---
layout: post
title: "Ubuntu-22.04-上安装-Home-Assistant"
date: 2025-03-15 16:08:36 +0800
description: "Ubuntu 22.04 上安装无桌面的 Home Assistant"
keywords: "Ubuntu 22.04 上安装 Home Assistant"
categories: ['未分类']
tags: ['运维', 'Ubuntu', 'Linux']
artid: "146280885"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146280885
    alt: "Ubuntu-22.04-上安装-Home-Assistant"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146280885
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146280885
cover: https://bing.ee123.net/img/rand?artid=146280885
image: https://bing.ee123.net/img/rand?artid=146280885
img: https://bing.ee123.net/img/rand?artid=146280885
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Ubuntu 22.04 上安装 Home Assistant
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在 Ubuntu 22.04 上安装无桌面的 Home Assistant 可以通过以下步骤完成。Home Assistant 是自动化爱好者常用的平台，我们将使用 Home Assistant 的容器（docker）版本以确保灵活性和易于管理。
    </p>
    <h4>
     <a id="_2">
     </a>
     安装步骤
    </h4>
    <h5>
     <a id="1__4">
     </a>
     1. 更新系统
    </h5>
    <p>
     首先，确保系统是最新的，运行下面的命令来更新包管理器和软件包。
    </p>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt</span> upgrade <span class="token parameter variable">-y</span>
</code></pre>
    <h5>
     <a id="2__Docker_12">
     </a>
     2. 安装 Docker
    </h5>
    <p>
     Home Assistant 的容器版要求 Docker 的运行环境，因此首先要安装 Docker。
    </p>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> apt-transport-https ca-certificates <span class="token function">curl</span> software-properties-common
<span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg <span class="token operator">|</span> <span class="token function">sudo</span> gpg <span class="token parameter variable">--dearmor</span> <span class="token parameter variable">-o</span> /usr/share/keyrings/docker-archive-keyring.gpg
<span class="token builtin class-name">echo</span> <span class="token string">"deb [arch=<span class="token variable"><span class="token variable">$(</span>dpkg --print-architecture<span class="token variable">)</span></span> signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu <span class="token variable"><span class="token variable">$(</span>lsb_release <span class="token parameter variable">-cs</span><span class="token variable">)</span></span> stable"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/docker.list <span class="token operator">&gt;</span> /dev/null
<span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> docker-ce docker-ce-cli containerd.io
</code></pre>
    <p>
     确保 Docker 安装成功：
    </p>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> systemctl status <span class="token function">docker</span>
</code></pre>
    <h5>
     <a id="3__Docker_Compose_30">
     </a>
     3. 安装 Docker Compose
    </h5>
    <p>
     Docker Compose 是用于定义和运行多容器 Docker 应用程序的工具。在这里我们将使用它来管理 Home Assistant。
    </p>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token string">"https://github.com/docker/compose/releases/download/$(curl -s https://api.github.com/repos/docker/compose/releases/latest | grep -oP '"tag_name": "\K(.*)(?="</span><span class="token punctuation">)</span>'<span class="token punctuation">)</span>/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-s</span><span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">)</span></span>" <span class="token parameter variable">-o</span> /usr/local/bin/docker-compose
<span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose
</code></pre>
    <p>
     验证安装：
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker-compose</span> <span class="token parameter variable">--version</span>
</code></pre>
    <p>
     如果下载失败，可以自己通过其它电脑获取 docker-compose
     <br/>
     注意：
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        ( 
        
       
         u 
        
       
         n 
        
       
         a 
        
       
         m 
        
       
         e 
        
       
         − 
        
       
         s 
        
       
         ) 
        
       
         − 
        
       
      
        (uname -s)-
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord mathnormal">
          u
         </span>
         <span class="mord mathnormal">
          nam
         </span>
         <span class="mord mathnormal">
          e
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          −
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mclose">
          )
         </span>
         <span class="mord">
          −
         </span>
        </span>
       </span>
      </span>
     </span>
     (uname -m)
    </p>
    <h5>
     <a id="_Home_Assistant__48">
     </a>
     准备 Home Assistant 的运行环境
    </h5>
    <p>
     创建一个目录来保存 Home Assistant 的配置文件和 Docker Compose 文件。
    </p>
    <pre><code class="prism language-bash"><span class="token function">mkdir</span> ~/homeassistant
<span class="token builtin class-name">cd</span> ~/homeassistant
</code></pre>
    <p>
     创建一个
     <code>
      docker-compose.yml
     </code>
     文件：
    </p>
    <pre><code class="prism language-yaml"><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">homeassistant</span><span class="token punctuation">:</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> home<span class="token punctuation">-</span>assistant
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">"ghcr.nju.edu.cn/home-assistant/home-assistant:stable"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./config<span class="token punctuation">:</span>/config
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> TZ=Asia/Shanghai    <span class="token comment"># 替换 YOUR_TIME_ZONE 为您的时区，例如 America/New_York</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped
    <span class="token key atrule">network_mode</span><span class="token punctuation">:</span> host
</code></pre>
    <p>
     确保将
     <code>
      YOUR_TIME_ZONE
     </code>
     替换为实际的时区名称。
    </p>
    <p>
     <code>
      timedatectl
     </code>
     是一个用于查看和设置系统时钟的命令。你可以通过运行以下命令来查看当前时区：
    </p>
    <pre><code class="prism language-bash">timedatectl
</code></pre>
    <h5>
     <a id="5__Home_Assistant_80">
     </a>
     5. 启动 Home Assistant
    </h5>
    <p>
     运行以下命令以拉取镜像并启动容器：
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>
</code></pre>
    <h5>
     <a id="6__Home_Assistant_88">
     </a>
     6. 访问 Home Assistant
    </h5>
    <p>
     在浏览器中打开
     <code>
      http://&lt;你的服务器IP&gt;:8123
     </code>
     ，你应该可以看到 Home Assistant 的初始设置页面。
    </p>
    <h4>
     <a id="_Docker__95">
     </a>
     离线获取 Docker 镜像
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        在联网机器上导出镜像:
       </strong>
      </p>
      <p>
       在一台可以访问 Docker Registry 的机器上，首先拉取所需的 Docker 镜像：
      </p>
      <pre><code class="prism language-bash"><span class="token function">docker</span> pull ghcr.io/home-assistant/home-assistant:stable
</code></pre>
      <p>
       导出镜像到一个 tar 文件：
      </p>
      <pre><code class="prism language-bash"><span class="token function">docker</span> save <span class="token parameter variable">-o</span> home-assistant-stable.tar ghcr.io/home-assistant/home-assistant:stable
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        将镜像传输到离线机器:
       </strong>
      </p>
      <p>
       使用 USB 驱动器、局域网或其他传输方法，将
       <code>
        home-assistant-stable.tar
       </code>
       文件传输到离线机器。
      </p>
     </li>
     <li>
      <p>
       <strong>
        在离线机器上导入镜像:
       </strong>
      </p>
      <p>
       在离线机器上，使用以下命令导入镜像：
      </p>
      <pre><code class="prism language-bash"><span class="token function">docker</span> load <span class="token parameter variable">-i</span> home-assistant-stable.tar
</code></pre>
      <p>
       通过这种方法，镜像就会被加载到你的 Docker 环境中，你可以像通常那样运行它。
      </p>
     </li>
    </ol>
    <h4>
     <a id="Linux_apt__127">
     </a>
     更新Linux apt 源
    </h4>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">vi</span> /etc/apt/sources.list
</code></pre>
    <p>
     替换配置
    </p>
    <pre><code class="prism language-bash"><span class="token comment">#deb cdrom:[Ubuntu 22.04.2 LTS _Jammy Jellyfish_ - Release amd64 (20230223)]/ jammy main restricted</span>

<span class="token comment"># See http://help.ubuntu.com/community/UpgradeNotes for how to upgrade to</span>
<span class="token comment"># newer versions of the distribution.</span>
deb http://cn.archive.ubuntu.com/ubuntu/ jammy main restricted
<span class="token comment"># deb-src http://cn.archive.ubuntu.com/ubuntu/ jammy main restricted</span>

<span class="token comment">## Major bug fix updates produced after the final release of the</span>
<span class="token comment">## distribution.</span>
deb http://cn.archive.ubuntu.com/ubuntu/ jammy-updates main restricted
<span class="token comment"># deb-src http://cn.archive.ubuntu.com/ubuntu/ jammy-updates main restricted</span>

<span class="token comment">## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu</span>
<span class="token comment">## team. Also, please note that software in universe WILL NOT receive any</span>
<span class="token comment">## review or updates from the Ubuntu security team.</span>
deb http://cn.archive.ubuntu.com/ubuntu/ jammy universe
<span class="token comment"># deb-src http://cn.archive.ubuntu.com/ubuntu/ jammy universe</span>
deb http://cn.archive.ubuntu.com/ubuntu/ jammy-updates universe
<span class="token comment"># deb-src http://cn.archive.ubuntu.com/ubuntu/ jammy-updates universe</span>

<span class="token comment">## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu </span>
<span class="token comment">## team, and may not be under a free licence. Please satisfy yourself as to </span>
<span class="token comment">## your rights to use the software. Also, please note that software in </span>
<span class="token comment">## multiverse WILL NOT receive any review or updates from the Ubuntu</span>
<span class="token comment">## security team.</span>
deb http://cn.archive.ubuntu.com/ubuntu/ jammy multiverse
<span class="token comment"># deb-src http://cn.archive.ubuntu.com/ubuntu/ jammy multiverse</span>
deb http://cn.archive.ubuntu.com/ubuntu/ jammy-updates multiverse
<span class="token comment"># deb-src http://cn.archive.ubuntu.com/ubuntu/ jammy-updates multiverse</span>

<span class="token comment">## N.B. software from this repository may not have been tested as</span>
<span class="token comment">## extensively as that contained in the main release, although it includes</span>
<span class="token comment">## newer versions of some applications which may provide useful features.</span>
<span class="token comment">## Also, please note that software in backports WILL NOT receive any review</span>
<span class="token comment">## or updates from the Ubuntu security team.</span>
deb http://cn.archive.ubuntu.com/ubuntu/ jammy-backports main restricted universe multiverse
<span class="token comment"># deb-src http://cn.archive.ubuntu.com/ubuntu/ jammy-backports main restricted universe multiverse</span>

deb http://security.ubuntu.com/ubuntu jammy-security main restricted
<span class="token comment"># deb-src http://security.ubuntu.com/ubuntu jammy-security main restricted</span>
deb http://security.ubuntu.com/ubuntu jammy-security universe
<span class="token comment"># deb-src http://security.ubuntu.com/ubuntu jammy-security universe</span>
deb http://security.ubuntu.com/ubuntu jammy-security multiverse
<span class="token comment"># deb-src http://security.ubuntu.com/ubuntu jammy-security multiverse</span>

<span class="token comment"># This system was installed using small removable media</span>
<span class="token comment"># (e.g. netinst, live or single CD). The matching "deb cdrom"</span>
<span class="token comment"># entries were disabled at the end of the installation process.</span>
<span class="token comment"># For information about how to configure apt package sources,</span>
<span class="token comment"># see the sources.list(5) manual.</span>
</code></pre>
    <h4>
     <a id="_Home_Assistant_188">
     </a>
     卸载 Home Assistant：
    </h4>
    <ol>
     <li>
      <p>
       列出正在运行的容器以找到 Home Assistant 容器的ID（如果未提供明确名称）：
      </p>
      <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">docker</span> <span class="token function">ps</span>
</code></pre>
     </li>
     <li>
      <p>
       停止并删除 Home Assistant 容器：
      </p>
      <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">docker</span> stop <span class="token operator">&lt;</span>container_id_or_name<span class="token operator">&gt;</span>
<span class="token function">sudo</span> <span class="token function">docker</span> <span class="token function">rm</span> <span class="token operator">&lt;</span>container_id_or_name<span class="token operator">&gt;</span>
</code></pre>
     </li>
     <li>
      <p>
       删除镜像：
      </p>
      <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">docker</span> rmi homeassistant/home-assistant
</code></pre>
     </li>
    </ol>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031343331323835382f:61727469636c652f64657461696c732f313436323830383835" class_="artid" style="display:none">
 </p>
</div>


