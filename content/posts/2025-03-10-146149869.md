---
layout: post
title: "PostgreSQL在Linux环境下的常用命令总结"
date: 2025-03-10 11:57:43 +0800
description: "这条查询语句会列出正在使用 mydb 数据库的会话的进程 ID（pid）、用户名（usename）、数据库名（datname）、应用程序名（application_name）、客户端地址（client_addr）、客户端主机名（client_hostname）以及客户端端口（client_port）等信息。在一些较新的 PostgreSQL 版本中，理论上可以尝试使用 ALTER DATABASE 语句来更改数据库名称，但这种方法可能会受到一些限制，比如数据库的使用状态、权限等因素可能会影响其成功与否。"
keywords: "PostgreSQL在Linux环境下的常用命令总结"
categories: ['面试', '阿里巴巴', '学习路线']
tags: ['Postgresql', 'Oracle', 'Linux']
artid: "146149869"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146149869
    alt: "PostgreSQL在Linux环境下的常用命令总结"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146149869
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146149869
cover: https://bing.ee123.net/img/rand?artid=146149869
image: https://bing.ee123.net/img/rand?artid=146149869
img: https://bing.ee123.net/img/rand?artid=146149869
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     PostgreSQL在Linux环境下的常用命令总结
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h5>
     <a id="_4">
     </a>
     标题
    </h5>
    <ul>
     <li>
      <a href="#PgSQL_9" rel="nofollow">
       登录PgSQL
      </a>
     </li>
     <li>
      <a href="#_17" rel="nofollow">
       库表基本操作命令
      </a>
     </li>
     <li>
      <a href="#_69" rel="nofollow">
       新建库表
      </a>
     </li>
     <li>
      <a href="#_119" rel="nofollow">
       修改库表
      </a>
     </li>
     <li>
      <ul>
       <li>
        <a href="#_121" rel="nofollow">
         修改数据库名称：
        </a>
       </li>
       <li>
        <a href="#_174" rel="nofollow">
         修改表名称
        </a>
       </li>
       <li>
        <a href="#_184" rel="nofollow">
         修改表字段信息
        </a>
       </li>
      </ul>
     </li>
     <li>
      <a href="#_248" rel="nofollow">
       删除库表
      </a>
     </li>
     <li>
      <ul>
       <li>
        <a href="#pgsql_277" rel="nofollow">
         pgsql删除正在使用的数据库
        </a>
       </li>
      </ul>
     </li>
    </ul>
    <p>
     须知：
     <br/>
     以下所有命令我都在Linux环境中执行验证过，大家放心食用，其中的实际名称换成自己的实际名称即可。而且这块如果你不是运维人员的话，你只需要简单的会在Linux下查一下数据就行了。其他的操作都在客户端工具操作比较简单。了解一下即可
    </p>
    <p>
     <strong>
      <a href="https://lxdlxd.blog.csdn.net/article/details/142339933" rel="nofollow">
       关于客户端的操作命令可以点我查看
      </a>
     </strong>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/5838bb25c08b4bdbbc456b23cbdca5dc.png"/>
    </p>
    <h3>
     <a id="PgSQL_23">
     </a>
     登录PgSQL
    </h3>
    <p>
     <strong>
      基本连接方式
     </strong>
     <br/>
     <code>
      psql -U &lt;用户名&gt; -d &lt;数据库名&gt;
     </code>
     ：这是连接到指定数据库的常用命令。
     <br/>
     例如，
     <code>
      psql -U postgres -d mydb
     </code>
     表示以 postgres 用户身份连接到 mydb 数据库。
     <br/>
     如果省略 -d 选项和数据库名，将连接到用户的默认数据库(postgres) 。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/dcc6ae7874e145fd9fe524e62b8b1f58.png"/>
    </p>
    <h3>
     <a id="_33">
     </a>
     库表基本操作命令
    </h3>
    <ul>
     <li>
      <p>
       查看数据库版本：
       <code>
        select version();
       </code>
      </p>
     </li>
     <li>
      <p>
       #查看有哪些用户：
       <code>
        dg
       </code>
      </p>
     </li>
     <li>
      <p>
       列出所有数据库：
       <code>
        l
       </code>
      </p>
     </li>
     <li>
      <p>
       切换数据库：
       <code>
        c mydb
       </code>
      </p>
     </li>
     <li>
      <p>
       列出当前数据库的所有表：
       <code>
        dt
       </code>
      </p>
     </li>
     <li>
      <p>
       列出表的结构：
       <code>
        d 表名
       </code>
      </p>
     </li>
     <li>
      <p>
       列出所有角色：
       <code>
        du
       </code>
      </p>
     </li>
     <li>
      <p>
       修改用户名密码：postgres=#
       <code>
        alter user postgres with password 'postgres';
       </code>
      </p>
      <p>
       – 创建新数据库
       <br/>
       CREATE DATABASE 数据库名;
      </p>
      <p>
       – 删除数据库
       <br/>
       DROP DATABASE 数据库名;
      </p>
      <p>
       – 创建新表
       <br/>
       CREATE TABLE 表名 (
       <br/>
       列1 数据类型,
       <br/>
       列2 数据类型,
       <br/>
       …
       <br/>
       );
      </p>
      <p>
       – 删除表
       <br/>
       DROP TABLE 表名;
      </p>
      <p>
       – 插入数据
       <br/>
       INSERT INTO 表名 (列1, 列2, …) VALUES (值1, 值2, …);
      </p>
      <p>
       – 更新数据
       <br/>
       UPDATE 表名 SET 列1 = 值1, 列2 = 值2 WHERE 条件;
      </p>
      <p>
       – 删除数据
       <br/>
       DELETE FROM 表名 WHERE 条件;
      </p>
      <p>
       – 查询数据
       <br/>
       SELECT * FROM 表名;
      </p>
      <p>
       – 创建新用户
       <br/>
       CREATE USER 用户名 WITH PASSWORD ‘密码’;
      </p>
      <p>
       – 修改用户密码
       <br/>
       ALTER USER 用户名 WITH PASSWORD ‘新密码’;
      </p>
      <p>
       – 为用户授权
       <br/>
       GRANT 权限 TO 用户名;
      </p>
      <p>
       – 撤销权限
       <br/>
       REVOKE 权限 FROM 用户名;
      </p>
     </li>
    </ul>
    <h3>
     <a id="_86">
     </a>
     新建库表
    </h3>
    <p>
     以下是在 PostgreSQL 中创建数据库 mydb 以及在其中创建 student 表和 teacher 表，并为每个表添加一些测试用字段的示例代码：
    </p>
    <pre><code>-- 创建数据库mydb
CREATE DATABASE mydb;

-- 连接到新创建的数据库mydb
c mydb

-- 创建student表
CREATE TABLE student (
    student_id SERIAL PRIMARY KEY,
    student_name VARCHAR(50),
    student_age INTEGER,
    student_gender CHAR(1),
    major VARCHAR(100)
);

-- 创建teacher表
CREATE TABLE teacher (
    teacher_id SERIAL PRIMARY KEY,
    teacher_name VARCHAR(50),
    teacher_age INTEGER,
    subject VARCHAR(100),
    department VARCHAR(100)
);



-- 向student表插入第一条数据
INSERT INTO student (student_name, student_age, student_gender, major)
VALUES ('张三', 20, 'M', '计算机科学与技术');

-- 向student表插入第二条数据
INSERT INTO student (student_name, student_age, student_gender, major)
VALUES ('李四', 22, 'F', '软件工程');

-- 向teacher表插入第一条数据
INSERT INTO teacher (teacher_name, teacher_age, subject, department)
VALUES ('王老师', 35, '数据库原理', '计算机系');

-- 向teacher表插入第二条数据
INSERT INTO teacher (teacher_name, teacher_age, subject, department)
VALUES ('李老师', 40, '操作系统', '计算机系');
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/472529059f824fa4b4077151c0af7820.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/929bb108b26a466995dfab0601737d05.png"/>
     </img>
    </p>
    <h3>
     <a id="_138">
     </a>
     修改库表
    </h3>
    <h4>
     <a id="_141">
     </a>
     修改数据库名称：
    </h4>
    <p>
     一般来说没这种需求，不过测试玩玩的话还是整理一下吧
    </p>
    <p>
     <strong>
      方法一
     </strong>
    </p>
    <pre><code>备份sql（见下面说明）
切换到别的数据库下删除：DROP DATABASE mydb;
CREATE DATABASE mybdtest;
执行备份SQL进行回复（见下面说明）
</code></pre>
    <p>
     备份数据库（使用pg_dump）
     <br/>
     在 Linux 下，备份mydb数据库可以使用pg_dump命令。假设你的 PostgreSQL 数据库用户名是postgres，密码是your_password（请替换为实际密码），主机地址是localhost，数据库名是mydb，你可以使用以下命令将数据库备份为一个.sql文件：
     <br/>
     <code>
      pg_dump -U postgres -h localhost -Fc mydb &gt; mydb_backup.dump
     </code>
    </p>
    <p>
     <strong>
      命令解释：
     </strong>
     <br/>
     <code>
      -U postgres
     </code>
     ：指定以postgres用户身份进行备份操作。
     <br/>
     <code>
      -h localhost
     </code>
     ：指定数据库主机地址为本地（localhost），如果数据库在远程服务器，需要替换为实际的远程主机地址。
     <br/>
     <code>
      -Fc
     </code>
     ：指定输出格式为自定义（custom）二进制格式，这种格式在恢复数据时比较高效。如果想要纯文本格式的备份文件，可以使用-Fp（plain text），不过恢复时可能会稍微复杂一点。
     <br/>
     <code>
      mydb
     </code>
     ：要备份的数据库名称。
     <br/>
     <code>
      &gt; mydb_backup.dump
     </code>
     ：将备份内容输出到名为mydb_backup.dump的文件中，你可以根据自己的喜好更改文件名。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9025df12a2f74c0aaab7d8b0c6f928e6.png"/>
    </p>
    <p>
     <strong>
      恢复数据库（使用pg_restore）
     </strong>
    </p>
    <p>
     在删除mydb并创建mybdtest后，使用pg_restore命令来恢复备份的数据到mybdtest数据库。假设你的用户名、主机地址等信息不变，执行以下命令：
     <br/>
     <code>
      pg_restore -U postgres -h localhost -d mybdtest mydb_backup.dump
     </code>
    </p>
    <p>
     命令解释：
     <br/>
     -U postgres：指定以postgres用户身份进行恢复操作。
     <br/>
     -h localhost：指定数据库主机地址为本地。
     <br/>
     -d mybdtest：指定恢复数据的目标数据库为mybdtest。
     <br/>
     mydb_backup.dump：要恢复的备份文件的名称，需要与备份时的文件名一致。
     <br/>
     需要注意的是，在执行这些命令时，可能需要确保postgres用户有足够的权限进行备份和恢复操作。如果数据库设置了密码，可能还需要在命令中正确提供密码，或者设置PGPASSWORD环境变量来存储密码，这样就不用每次在命令中输入密码了。例如，可以在执行命令前设置环境变量：
     <code>
      export PGPASSWORD=your_password
     </code>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8407c05e6e914dfa9effa63dbc57af96.png"/>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7c942da53a214ce08461280ef48349f0.png"/>
    </p>
    <p>
     <strong>
      方法二
     </strong>
     <br/>
     使用 ALTER DATABASE（在某些特定版本和场景下可能有限制）
     <br/>
     在一些较新的 PostgreSQL 版本中，理论上可以尝试使用 ALTER DATABASE 语句来更改数据库名称，但这种方法可能会受到一些限制，比如数据库的使用状态、权限等因素可能会影响其成功与否。
     <br/>
     假设你在 psql 命令行环境下并且有足够的权限，你可以尝试以下操作：
     <br/>
     <code>
      ALTER DATABASE mydb RENAME TO mybdtest;
     </code>
     <br/>
     如果此操作成功，那么数据库名称就直接被更改为 mybdtest 了。但如果遇到错误，可能就需要按照方法一的步骤来完成更名操作啦。
     <br/>
     需要注意的是，无论使用哪种方法，在进行这些操作之前，都建议你先对重要数据进行备份，以防出现意外情况导致数据丢失。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f723dd46089b495d9078ec3cdf286f5d.png"/>
    </p>
    <h4>
     <a id="_191">
     </a>
     修改表名称
    </h4>
    <p>
     要将表名 student 修改为 student_info，可以使用 ALTER TABLE 语句来实现。以下是具体的操作步骤：
    </p>
    <pre><code>-- 将表student修改为student_info
ALTER TABLE student RENAME TO student_info;
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d60f8130f6fb4f7d8e6814f017c2b503.png"/>
    </p>
    <h4>
     <a id="_201">
     </a>
     修改表字段信息
    </h4>
    <p>
     修改表字段名称、字段类型、字段注释
     <br/>
     <a href="https://lxdlxd.blog.csdn.net/article/details/142339933" rel="nofollow">
      这块我有一篇博客根据各种情况都有对应的命令说明可以点我去看
     </a>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a83dc91fd4bd4f4a95ba3b648ef57435.png"/>
    </p>
    <pre><code>一、修改列名
将 student_id 修改为 stu_id：
ALTER TABLE student_info RENAME COLUMN student_id TO stu_id;

二、修改数据类型
将 student_name 的数据类型从 character varying(50) 修改为 character(20)：
ALTER TABLE student_info ALTER COLUMN student_name TYPE character(20);

三、修改数据类型及注释
先将 student_gender 的数据类型从 character(1) 修改为 integer：
# ALTER TABLE student_info ALTER COLUMN student_gender TYPE integer;
如果执行上面sql一定会报错的，因为上面这种情况只适合修改前后数据类型一致的情况，需要执行下面sql,
但是不保证一定成功，除非你存储的数据能成功转换为目标类型，像我实践中就报错，所以要保证数据的合理性

ALTER TABLE student_info
ALTER COLUMN student_gender TYPE integer
USING CAST(student_gender AS integer);

然后为 student_age 添加注释 “学生年龄”。在 PostgreSQL 中，添加列注释可以使用 COMMENT ON COLUMN 语句：
COMMENT ON COLUMN student_info.student_age IS '学生年龄';

完成上述操作后，你可以再次使用 d student_info 命令来查看表结构的变化情况，此时表结构应该符合你修改后的要求。 
d student_info
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ba94211e41e44a69befb137921b043ff.png"/>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8665369cbc284a0d98c88308ad7811ca.png"/>
    </p>
    <p>
     <strong>
      关于看不见添加的注释问题原因分析：
     </strong>
    </p>
    <p>
     d student_info 命令来查看表结构。这个命令在某些数据库客户端中可能不会显示列注释。
     <br/>
     你可以尝试使用以下查询语句来查看带有注释的表结构：
    </p>
    <pre><code>SELECT column_name, data_type, column_default, is_nullable, col_description((table_schema || '.' || table_name)::regclass,ordinal_position) AS comment
FROM information_schema.columns
WHERE table_schema = 'public' AND table_name = 'student_info';
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c22716df4882441281344f97f1aa4f84.png"/>
    </p>
    <p>
     这个查询会从 information_schema.columns 中获取列的详细信息，包括注释。
    </p>
    <p>
     <strong>
      数据库配置或客户端问题
     </strong>
     <br/>
     有些数据库客户端可能不支持显示注释，或者需要特定的设置才能显示注释。你可以检查一下你使用的数据库客户端的设置，看是否有相关选项可以启用注释显示。
    </p>
    <p>
     <strong>
      注释未正确添加
     </strong>
     <br/>
     虽然从截图中看到了添加注释的操作，但有可能由于某种原因（例如权限问题或数据库错误）导致注释没有成功添加。你可以尝试重新添加注释，然后使用上述查询语句来验证注释是否添加成功。
    </p>
    <h3>
     <a id="_258">
     </a>
     删除库表
    </h3>
    <p>
     一般来说直接
     <code>
      drop database mydb;
     </code>
     就可以删除掉数据库了，下面我们说下相关注意事项
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f0bb2a36b05746ca8ceed4403d0fd627.png"/>
     <br/>
     执行这条命令之前要确保你当前
     <strong>
      没有连接到 mydb 数据库
     </strong>
     哦，不然也会报错无法删除的。
     <br/>
     一般可以先通过
     <code>
      c
     </code>
     命令切换到其他数据库（比如 postgres），然后再执行删除 mydb 的操作。
     <br/>
     例如：
     <br/>
     <code>
      c postgres
     </code>
     <br/>
     <code>
      drop database mydb;
     </code>
    </p>
    <p>
     当前还有其他用户（或者其他会话）正在连接并使用 mydb 数据库时，是无法直接删除它的。
    </p>
    <p>
     你可以通过以下几种方法来解决这个问题并成功删除 mydb 数据库：
     <br/>
     <strong>
      方法一：终止其他正在使用的会话
     </strong>
     <br/>
     首先，你需要查看当前正在使用 mydb 数据库的会话信息。可以使用以下查询语句（在 postgres 数据库下执行）：
     <br/>
     <code>
      SELECT pid, usename, datname, application_name, client_addr, client_hostname, client_port FROM pg_stat_activity WHERE datname ='mydb';
     </code>
     <br/>
     这条查询语句会列出正在使用 mydb 数据库的会话的进程 ID（pid）、用户名（usename）、数据库名（datname）、应用程序名（application_name）、客户端地址（client_addr）、客户端主机名（client_hostname）以及客户端端口（client_port）等信息。
    </p>
    <p>
     找到对应的会话进程 ID 后，你可以使用以下命令来终止该会话（需要有足够的权限，比如超级用户权限）：
     <br/>
     <code>
      SELECT pg_terminate_backend(pid);
     </code>
     <br/>
     这里的 pid 就是你在上一步查询中找到的那个正在使用 mydb 数据库的会话的进程 ID。
     <br/>
     终止所有正在使用 mydb 数据库的会话后，再尝试执行删除数据库的命令：
     <br/>
     <code>
      drop database mydb;
     </code>
    </p>
    <p>
     <strong>
      方法二：等待其他会话结束自行使用
     </strong>
     <br/>
     如果你确定其他正在使用 mydb 数据库的会话会在不久后自行结束，你可以稍作等待，然后再重新尝试执行删除数据库的命令：
     <code>
      drop database mydb;
     </code>
     <br/>
     不过这种方法可能不太确定需要等待多长时间，而且如果其他会话一直不结束，就无法顺利删除数据库啦。
    </p>
    <h4>
     <a id="pgsql_287">
     </a>
     pgsql删除正在使用的数据库
    </h4>
    <p>
     这个了解一下就行，也就测试阶段使用
    </p>
    <pre><code>-- 设置数据库禁止连接
UPDATE pg_database SET datallowconn = 'false' WHERE datname = 'db_name';
-- 中断当前所有连接会话
SELECT pg_terminate_backend(pid) FROM pg_stat_activity WHERE datname = 'db_name';
-- 删除数据库
drop database db_name;
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2c2e6c266c664cc79a41ad340c549148.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f37343832333539352f:61727469636c652f64657461696c732f313436313439383639" class_="artid" style="display:none">
 </p>
</div>


