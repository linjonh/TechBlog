---
layout: post
title: "clionarm-cm3MSYS-mingw-jlink配置用于嵌入式开发"
date: 2025-03-09 00:21:24 +0800
description: "至此，总算是能完成的搭建好 构建 debug的环境配置了，尽管jlink+openocd不是一个联合调试的好选项。"
keywords: "clion+arm-cm3+MSYS-mingw +jlink配置用于嵌入式开发"
categories: ['未分类']
tags: ['调试', 'Openocd', 'Jlink', 'Clion']
artid: "146116047"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146116047
    alt: "clionarm-cm3MSYS-mingw-jlink配置用于嵌入式开发"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146116047
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146116047
cover: https://bing.ee123.net/img/rand?artid=146116047
image: https://bing.ee123.net/img/rand?artid=146116047
img: https://bing.ee123.net/img/rand?artid=146116047
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     clion+arm-cm3+MSYS-mingw +jlink配置用于嵌入式开发
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="0_0">
     </a>
     0.前言
    </h2>
    <p>
     正文可以跳过这段
     <br/>
     初识clion，应该是2015年首次发布的时候， 那会还是大三，被一则推介广告吸引到，当时还在用vs studio，但是就喜欢鼓捣新工具，然后下载安装试用了clion，但是当时对cmake规则知之甚少，而且觉得还麻烦，所以之后就没有再用clion了。一晃10年已逝。
     <br/>
     从事嵌入式MCU开发工作的，现在用过Keil MDK、IAR、VS-Code、RT-thread studio(eclipse核)，现在从我辈楷模这里了解用Clion也能做嵌入式开发，那必须试试，
     <br/>
     1.为了从github上 clone 稚晖的项目学习进步；
     <br/>
     2.了解多种IDE的开发方式，知己知彼，后续可以根据项目适用哪种平台，灵活的选择开发方式：
     <br/>
     比如，我现在喜欢RT-Thread Studio,因为基于HAL库的初始化代码可以很方面的使用cubemx的ioc工程配置，rt-thread系统的管理 也很方便。
     <br/>
     Clion 也可以使用ioc工程完成基于HAL库的的初始化配置。
     <br/>
     所以可以根据项目的特点 选择最易开发的平台。
     <br/>
     3.另外就是大家说的开源问题，商业软件都涉及licenses，能用开源的方式还是开源的方式，虽然clion也不是开源的，但是商业化的便捷也可以试试到底有多好用。
    </p>
    <p>
     参考
     <a href="https://zhuanlan.zhihu.com/p/145801160" rel="nofollow">
      稚晖君-配置CLion用于STM32开发【优雅の嵌入式开发】
     </a>
     ，随着系统版本更新，各软件也都更新，与时俱进，参考配置的过程也不是一帆风顺，故记录一下，我的配置环境和过程，方便交流学习。
    </p>
    <h2>
     <a id="1_13">
     </a>
     1.环境及所需工具
    </h2>
    <p>
     软件环境:
    </p>
    <table>
     <thead>
      <tr>
       <th>
        软件名
       </th>
       <th>
        版本号
       </th>
       <th>
        描述
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        Windows 11
       </td>
       <td>
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        STM32CubeMX
       </td>
       <td>
        V6.5.0
       </td>
       <td>
        <a href="https://www.st.com/en/development-tools/stm32cubemx.html" rel="nofollow">
         官网直达
        </a>
       </td>
      </tr>
      <tr>
       <td>
        Clion
       </td>
       <td>
        2024.3.4
       </td>
       <td>
        <a href="https://download-cdn.jetbrains.com/cpp/CLion-2024.3.4.exe" rel="nofollow">
         官网直达
        </a>
       </td>
      </tr>
      <tr>
       <td>
        MinGW-W64
       </td>
       <td>
        MSYS2更新最新版
       </td>
       <td>
        <a href="https://www.msys2.org/" rel="nofollow">
         官网直达
        </a>
       </td>
      </tr>
      <tr>
       <td>
        OpenOCD
       </td>
       <td>
       </td>
       <td>
        <a href="http://gnutoolchains.com/arm-eabi/openocd/" rel="nofollow">
         OpenOCD
        </a>
        是用于对STM32进行下载仿真的工具，是一个开源软件包
       </td>
      </tr>
      <tr>
       <td>
        arm-none-eabi-gcc
       </td>
       <td>
       </td>
       <td>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     关于交叉编译工具链的详细可跳转到我的另外一篇博文
     <a href="https://editor.csdn.net/md/?articleId=146108778" rel="nofollow">
      windows平台下交叉编译工具链和环境详解
     </a>
    </p>
    <p>
     硬件环境：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        软件名
       </th>
       <th>
        版本号
       </th>
       <th>
        描述
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        STM32F103VET6
       </td>
       <td>
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        J-Link
       </td>
       <td>
        V9
       </td>
       <td>
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="2_33">
     </a>
     2.需要重点注意的点
    </h3>
    <p>
     稚晖的文档已经很详细了，我这里只说点卡点
     <br/>
     Clion的配置上，在配置预设的MinGW和Cmake环境上，我是使用MSYS2安装的MinGW-W64环境，
     <br/>
     这是正确的配置图
     <br/>
     <img alt="Clion工具链设置" src="https://i-blog.csdnimg.cn/direct/72e1c14d38e94bc8b912bb21f9ee8f2d.png">
      <br/>
      提供一个错误的配置图,该mingw64-环境 是用于配置rt-thread studio的环境和工具链的,这个mingw64-环境是我在其它平台上正常可以使用的环境，也不知道为什么不能正常工作，这里先将其配置为msys下配置的mingw环境 先解决问题；
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/dc273381deb14858a59874d41aa0b755.png">
       <br/>
       其实 对于 插件管理式的平台，针对嵌入式开发 离不开这些环境的配置；比如vscode eclipse clion等。
      </img>
     </img>
    </p>
    <p>
     目前clion的这个环境文件很重要，即使我不更改下面的其它可执行文件，即为配置成这样也可以正常构建
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/799e61cd59bf4a35ab246758def7352c.png"/>
    </p>
    <p>
     我现在有一个问题是 clion 是 如何查找捆绑的cmake gdb的 ？
    </p>
    <p>
     上述配置完成后 基本上是可以 构建程序了 完成了很重要的一步。
    </p>
    <h4>
     <a id="openocd_50">
     </a>
     openocd下载和运行
    </h4>
    <p>
     openocd 在稚晖君的教程中需要配置一下 这个 进入方式
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/b92f9266021941898924068da48b6041.png">
      <br/>
      进入后需要在该界面下新建一个openocd下载和运行的配置环境，类似于keil里面需要下载什么文件进去，使用什么调试工具。
     </img>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c05968a79d4e401da39728ced205d484.png"/>
    </p>
    <p>
     按照教程 配置 和稚晖的区别是他使用的DAP 可能windows下 clion支持挺好的 ， 我用的jlink 就出现一个错误
    </p>
    <p>
     使用的stm32f1x.cfg文件内容如下
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 选择 J-Link 适配器</span>
adapter driver jlink

<span class="token comment"># 选择 SWD 协议</span>
transport <span class="token keyword">select</span> swd

<span class="token comment"># 配置目标芯片（STM32F103VE）</span>
<span class="token builtin class-name">source</span> <span class="token punctuation">[</span>find target/stm32f1x.cfg<span class="token punctuation">]</span>
</code></pre>
    <p>
     错误情况：
    </p>
    <pre><code class="prism language-bash">Open On-Chip Debugger <span class="token number">0.12</span>.0
Licensed under GNU GPL v2
For bug reports, <span class="token builtin class-name">read</span>
        http://openocd.org/doc/doxygen/bugs.html
Warn <span class="token builtin class-name">:</span> Failed to <span class="token function">open</span> device: LIBUSB_ERROR_NOT_SUPPORTED
Error: No J-Link device found
</code></pre>
    <p>
     使用 OpenOCD 调试模式
    </p>
    <pre><code class="prism language-bash">openocd <span class="token parameter variable">-d3</span> <span class="token parameter variable">-f</span> stm32f103c8_blue_pill.cfg
</code></pre>
    <p>
     得到的详细debug 报告
    </p>
    <pre><code class="prism language-bash">PS D:<span class="token punctuation">\</span>MyProjectRepos<span class="token punctuation">\</span>MCUDevelopProject<span class="token punctuation">\</span>Ctrl-FOC-Lite<span class="token punctuation">\</span><span class="token number">2</span>.Firmware<span class="token punctuation">\</span>STM32_HAL_version<span class="token punctuation">\</span>Ctrl-FOC-Lite-fw<span class="token operator">&gt;</span> openocd <span class="token parameter variable">-d3</span> <span class="token parameter variable">-f</span> stm32f103c8_blue_pill.cfg
Open On-Chip Debugger <span class="token number">0.12</span>.0
Licensed under GNU GPL v2
For bug reports, <span class="token builtin class-name">read</span>
        http://openocd.org/doc/doxygen/bugs.html
User <span class="token builtin class-name">:</span> <span class="token number">3</span> <span class="token number">2</span> options.c:52 configuration_output_handler<span class="token punctuation">(</span><span class="token punctuation">)</span>: debug_level: <span class="token number">3</span>
User <span class="token builtin class-name">:</span> <span class="token number">4</span> <span class="token number">4</span> options.c:52 configuration_output_handler<span class="token punctuation">(</span><span class="token punctuation">)</span>:
Debug: <span class="token number">5</span> <span class="token number">6</span> options.c:233 add_default_dirs<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token assign-left variable">bindir</span><span class="token operator">=</span>D:/a/msys64/mingw64/bin
Debug: <span class="token number">6</span> <span class="token number">7</span> options.c:234 add_default_dirs<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token assign-left variable">pkgdatadir</span><span class="token operator">=</span>D:/a/msys64/mingw64/share/openocd
Debug: <span class="token number">7</span> <span class="token number">9</span> options.c:235 add_default_dirs<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token assign-left variable">exepath</span><span class="token operator">=</span>D:/msys64/mingw64/bin
Debug: <span class="token number">8</span> <span class="token number">11</span> options.c:236 add_default_dirs<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token assign-left variable">bin2data</span><span class="token operator">=</span><span class="token punctuation">..</span>/share/openocd
Debug: <span class="token number">9</span> <span class="token number">13</span> configuration.c:33 add_script_search_dir<span class="token punctuation">(</span><span class="token punctuation">)</span>: adding C:/Users/leesincere/AppData/Roaming/OpenOCD
Debug: <span class="token number">10</span> <span class="token number">16</span> configuration.c:33 add_script_search_dir<span class="token punctuation">(</span><span class="token punctuation">)</span>: adding D:/msys64/mingw64/bin/<span class="token punctuation">..</span>/share/openocd/site
Debug: <span class="token number">11</span> <span class="token number">19</span> configuration.c:33 add_script_search_dir<span class="token punctuation">(</span><span class="token punctuation">)</span>: adding D:/msys64/mingw64/bin/<span class="token punctuation">..</span>/share/openocd/scripts
Debug: <span class="token number">12</span> <span class="token number">22</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - ocd_find stm32f103c8_blue_pill.cfg
Debug: <span class="token number">13</span> <span class="token number">24</span> configuration.c:88 find_file<span class="token punctuation">(</span><span class="token punctuation">)</span>: found stm32f103c8_blue_pill.cfg
Debug: <span class="token number">14</span> <span class="token number">28</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - adapter driver jlink
Debug: <span class="token number">15</span> <span class="token number">30</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - transport <span class="token keyword">select</span> swd
Debug: <span class="token number">16</span> <span class="token number">32</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - ocd_find target/stm32f1x.cfg
Debug: <span class="token number">17</span> <span class="token number">35</span> configuration.c:88 find_file<span class="token punctuation">(</span><span class="token punctuation">)</span>: found D:/msys64/mingw64/bin/<span class="token punctuation">..</span>/share/openocd/scripts/target/stm32f1x.cfg
Debug: <span class="token number">18</span> <span class="token number">38</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - ocd_find target/swj-dp.tcl
Debug: <span class="token number">19</span> <span class="token number">41</span> configuration.c:88 find_file<span class="token punctuation">(</span><span class="token punctuation">)</span>: found D:/msys64/mingw64/bin/<span class="token punctuation">..</span>/share/openocd/scripts/target/swj-dp.tcl
Debug: <span class="token number">20</span> <span class="token number">44</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - transport <span class="token keyword">select</span>
Debug: <span class="token number">21</span> <span class="token number">46</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - ocd_find mem_helper.tcl
Debug: <span class="token number">22</span> <span class="token number">48</span> configuration.c:88 find_file<span class="token punctuation">(</span><span class="token punctuation">)</span>: found D:/msys64/mingw64/bin/<span class="token punctuation">..</span>/share/openocd/scripts/mem_helper.tcl
Debug: <span class="token number">23</span> <span class="token number">52</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - add_usage_text mrw address
Debug: <span class="token number">24</span> <span class="token number">54</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - add_help_text mrw Returns value of word <span class="token keyword">in</span> memory.
Debug: <span class="token number">25</span> <span class="token number">56</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - add_usage_text mrh address
Debug: <span class="token number">26</span> <span class="token number">59</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - add_help_text mrh Returns value of halfword <span class="token keyword">in</span> memory.
Debug: <span class="token number">27</span> <span class="token number">62</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - add_usage_text mrb address
Debug: <span class="token number">28</span> <span class="token number">64</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - add_help_text mrb Returns value of byte <span class="token keyword">in</span> memory.
Debug: <span class="token number">29</span> <span class="token number">67</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - add_usage_text mmw address setbits clearbits
Debug: <span class="token number">30</span> <span class="token number">69</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - add_help_text mmw Modify word <span class="token keyword">in</span> memory. new_val <span class="token operator">=</span> <span class="token punctuation">(</span>old_val <span class="token operator">&amp;</span> ~clearbits<span class="token punctuation">)</span> <span class="token operator">|</span> setbits<span class="token punctuation">;</span>
Debug: <span class="token number">31</span> <span class="token number">73</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - transport <span class="token keyword">select</span>
Debug: <span class="token number">32</span> <span class="token number">74</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - <span class="token function">expr</span>  <span class="token punctuation">[</span> string first <span class="token string">"jtag"</span> <span class="token variable">$_TRANSPORT</span> <span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token parameter variable">-1</span>
Debug: <span class="token number">33</span> <span class="token number">76</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - transport <span class="token keyword">select</span>
Debug: <span class="token number">34</span> <span class="token number">78</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - <span class="token function">expr</span>  <span class="token punctuation">[</span> string first <span class="token string">"jtag"</span> <span class="token variable">$_TRANSPORT</span> <span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token parameter variable">-1</span>
Debug: <span class="token number">35</span> <span class="token number">81</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - transport <span class="token keyword">select</span>
Debug: <span class="token number">36</span> <span class="token number">82</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - <span class="token function">expr</span>  <span class="token punctuation">[</span> string first <span class="token string">"swd"</span> <span class="token variable">$_TRANSPORT</span> <span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token parameter variable">-1</span>
Debug: <span class="token number">37</span> <span class="token number">85</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - swd newdap stm32f1x cpu <span class="token parameter variable">-irlen</span> <span class="token number">4</span> <span class="token parameter variable">-ircapture</span> 0x1 <span class="token parameter variable">-irmask</span> 0xf -expected-id 0x1ba01477
Debug: <span class="token number">38</span> <span class="token number">88</span> tcl.c:557 jim_newtap_cmd<span class="token punctuation">(</span><span class="token punctuation">)</span>: Creating New Tap, Chip: stm32f1x, Tap: cpu, Dotted: stm32f1x.cpu, <span class="token number">8</span> params
Debug: <span class="token number">39</span> <span class="token number">92</span> core.c:1474 jtag_tap_init<span class="token punctuation">(</span><span class="token punctuation">)</span>: Created Tap: stm32f1x.cpu @ abs position <span class="token number">0</span>, irlen <span class="token number">0</span>, capture: 0x0 mask: 0x0
Debug: <span class="token number">40</span> <span class="token number">95</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - dap create stm32f1x.dap -chain-position stm32f1x.cpu
Debug: <span class="token number">41</span> <span class="token number">98</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - transport <span class="token keyword">select</span>
Debug: <span class="token number">42</span> <span class="token number">100</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - <span class="token function">expr</span>  <span class="token punctuation">[</span> string first <span class="token string">"jtag"</span> <span class="token variable">$_TRANSPORT</span> <span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token parameter variable">-1</span>
Debug: <span class="token number">43</span> <span class="token number">103</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - target create stm32f1x.cpu cortex_m <span class="token parameter variable">-endian</span> little <span class="token parameter variable">-dap</span> stm32f1x.dap
Debug: <span class="token number">44</span> <span class="token number">107</span> command.c:289 register_command<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> <span class="token string">'tpiu'</span> is already registered
Debug: <span class="token number">45</span> <span class="token number">109</span> command.c:289 register_command<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> <span class="token string">'rtt'</span> is already registered
Debug: <span class="token number">46</span> <span class="token number">111</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - stm32f1x.cpu configure -work-area-phys 0x20000000 -work-area-size 0x1000 -work-area-backup <span class="token number">0</span>
Debug: <span class="token number">47</span> <span class="token number">115</span> target.c:2199 target_free_all_working_areas_restore<span class="token punctuation">(</span><span class="token punctuation">)</span>: freeing all working areas
Debug: <span class="token number">48</span> <span class="token number">118</span> target.c:2199 target_free_all_working_areas_restore<span class="token punctuation">(</span><span class="token punctuation">)</span>: freeing all working areas
Debug: <span class="token number">49</span> <span class="token number">120</span> target.c:2199 target_free_all_working_areas_restore<span class="token punctuation">(</span><span class="token punctuation">)</span>: freeing all working areas
Debug: <span class="token number">50</span> <span class="token number">123</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - flash bank stm32f1x.flash stm32f1x 0x08000000 <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> stm32f1x.cpu
Debug: <span class="token number">51</span> <span class="token number">126</span> tcl.c:1305 handle_flash_bank_command<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token string">'stm32f1x'</span> driver usage field missing
Debug: <span class="token number">52</span> <span class="token number">129</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - adapter speed <span class="token number">1000</span>
Debug: <span class="token number">53</span> <span class="token number">132</span> adapter.c:251 adapter_config_khz<span class="token punctuation">(</span><span class="token punctuation">)</span>: handle adapter khz
Debug: <span class="token number">54</span> <span class="token number">134</span> adapter.c:215 adapter_khz_to_speed<span class="token punctuation">(</span><span class="token punctuation">)</span>: convert khz to adapter specific speed value
Debug: <span class="token number">55</span> <span class="token number">136</span> adapter.c:215 adapter_khz_to_speed<span class="token punctuation">(</span><span class="token punctuation">)</span>: convert khz to adapter specific speed value
Debug: <span class="token number">56</span> <span class="token number">139</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - adapter srst delay <span class="token number">100</span>
Debug: <span class="token number">57</span> <span class="token number">142</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - transport <span class="token keyword">select</span>
Debug: <span class="token number">58</span> <span class="token number">144</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - <span class="token function">expr</span>  <span class="token punctuation">[</span> string first <span class="token string">"jtag"</span> <span class="token variable">$_TRANSPORT</span> <span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token parameter variable">-1</span>
Debug: <span class="token number">59</span> <span class="token number">147</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - reset_config srst_nogate
Debug: <span class="token number">60</span> <span class="token number">149</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - transport <span class="token keyword">select</span>
Debug: <span class="token number">61</span> <span class="token number">150</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - <span class="token function">expr</span>  <span class="token punctuation">[</span> string first <span class="token string">"hla"</span> <span class="token variable">$_TRANSPORT</span> <span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token parameter variable">-1</span>
Debug: <span class="token number">62</span> <span class="token number">153</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - cortex_m reset_config sysresetreq
Debug: <span class="token number">63</span> <span class="token number">155</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - stm32f1x.cpu configure <span class="token parameter variable">-event</span> examine-end
        <span class="token comment"># DBGMCU_CR |= DBG_WWDG_STOP | DBG_IWDG_STOP |</span>
        <span class="token comment">#              DBG_STANDBY | DBG_STOP | DBG_SLEEP</span>
        mmw 0xE0042004 0x00000307 <span class="token number">0</span>

Debug: <span class="token number">64</span> <span class="token number">161</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - tpiu create stm32f1x.tpiu <span class="token parameter variable">-dap</span> stm32f1x.dap -ap-num <span class="token number">0</span> <span class="token parameter variable">-baseaddr</span> 0xE0040000
Debug: <span class="token number">65</span> <span class="token number">165</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - stm32f1x.tpiu configure <span class="token parameter variable">-event</span> pre-enable _proc_pre_enable_stm32f1x.tpiu stm32f1x.cpu
Debug: <span class="token number">66</span> <span class="token number">169</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - adapter speed <span class="token number">10000</span>
Debug: <span class="token number">67</span> <span class="token number">171</span> adapter.c:251 adapter_config_khz<span class="token punctuation">(</span><span class="token punctuation">)</span>: handle adapter khz
Debug: <span class="token number">68</span> <span class="token number">173</span> adapter.c:215 adapter_khz_to_speed<span class="token punctuation">(</span><span class="token punctuation">)</span>: convert khz to adapter specific speed value
Debug: <span class="token number">69</span> <span class="token number">176</span> adapter.c:215 adapter_khz_to_speed<span class="token punctuation">(</span><span class="token punctuation">)</span>: convert khz to adapter specific speed value
User <span class="token builtin class-name">:</span> <span class="token number">70</span> <span class="token number">179</span> options.c:52 configuration_output_handler<span class="token punctuation">(</span><span class="token punctuation">)</span>: adapter speed: <span class="token number">10000</span> kHz
User <span class="token builtin class-name">:</span> <span class="token number">71</span> <span class="token number">181</span> options.c:52 configuration_output_handler<span class="token punctuation">(</span><span class="token punctuation">)</span>:
Info <span class="token builtin class-name">:</span> <span class="token number">72</span> <span class="token number">184</span> server.c:297 add_service<span class="token punctuation">(</span><span class="token punctuation">)</span>: Listening on port <span class="token number">6666</span> <span class="token keyword">for</span> tcl connections
Info <span class="token builtin class-name">:</span> <span class="token number">73</span> <span class="token number">187</span> server.c:297 add_service<span class="token punctuation">(</span><span class="token punctuation">)</span>: Listening on port <span class="token number">4444</span> <span class="token keyword">for</span> telnet connections
Debug: <span class="token number">74</span> <span class="token number">189</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - init
Debug: <span class="token number">75</span> <span class="token number">191</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - target init
Debug: <span class="token number">76</span> <span class="token number">193</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - target names
Debug: <span class="token number">77</span> <span class="token number">195</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - stm32f1x.cpu cget <span class="token parameter variable">-event</span> gdb-flash-erase-start
Debug: <span class="token number">78</span> <span class="token number">198</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - stm32f1x.cpu configure <span class="token parameter variable">-event</span> gdb-flash-erase-start reset init
Debug: <span class="token number">79</span> <span class="token number">201</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - stm32f1x.cpu cget <span class="token parameter variable">-event</span> gdb-flash-write-end
Debug: <span class="token number">80</span> <span class="token number">204</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - stm32f1x.cpu configure <span class="token parameter variable">-event</span> gdb-flash-write-end reset <span class="token function">halt</span>
Debug: <span class="token number">81</span> <span class="token number">208</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - stm32f1x.cpu cget <span class="token parameter variable">-event</span> gdb-attach
Debug: <span class="token number">82</span> <span class="token number">210</span> command.c:155 script_debug<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token builtin class-name">command</span> - stm32f1x.cpu configure <span class="token parameter variable">-event</span> gdb-attach <span class="token function">halt</span> <span class="token number">1000</span>
Debug: <span class="token number">83</span> <span class="token number">213</span> target.c:1657 handle_target_init_command<span class="token punctuation">(</span><span class="token punctuation">)</span>: Initializing targets<span class="token punctuation">..</span>.
Debug: <span class="token number">84</span> <span class="token number">215</span> semihosting_common.c:109 semihosting_common_init<span class="token punctuation">(</span><span class="token punctuation">)</span>:
Debug: <span class="token number">85</span> <span class="token number">217</span> jlink.c:635 jlink_init<span class="token punctuation">(</span><span class="token punctuation">)</span>: Using libjaylink <span class="token number">0.4</span>.0 <span class="token punctuation">(</span>compiled with <span class="token number">0.4</span>.0<span class="token punctuation">)</span>
Debug: <span class="token number">86</span> <span class="token number">235</span> jlink.c:514 jaylink_log_handler<span class="token punctuation">(</span><span class="token punctuation">)</span>: Found device <span class="token punctuation">(</span>VID:PID <span class="token operator">=</span> <span class="token number">1366</span>:0101, bus:address <span class="token operator">=</span> 001:018<span class="token punctuation">)</span>
Warn <span class="token builtin class-name">:</span> <span class="token number">87</span> <span class="token number">238</span> jlink.c:514 jaylink_log_handler<span class="token punctuation">(</span><span class="token punctuation">)</span>: Failed to <span class="token function">open</span> device: LIBUSB_ERROR_NOT_SUPPORTED
Debug: <span class="token number">88</span> <span class="token number">241</span> jlink.c:514 jaylink_log_handler<span class="token punctuation">(</span><span class="token punctuation">)</span>: Found <span class="token number">0</span> USB device<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
Error: <span class="token number">89</span> <span class="token number">242</span> jlink.c:688 jlink_init<span class="token punctuation">(</span><span class="token punctuation">)</span>: No J-Link device found
Debug: <span class="token number">90</span> <span class="token number">244</span> command.c:544 run_command<span class="token punctuation">(</span><span class="token punctuation">)</span>: Command <span class="token string">'init'</span> failed with error code <span class="token parameter variable">-100</span>
User <span class="token builtin class-name">:</span> <span class="token number">91</span> <span class="token number">247</span> command.c:608 command_run_line<span class="token punctuation">(</span><span class="token punctuation">)</span>:
Debug: <span class="token number">92</span> <span class="token number">249</span> target.c:2199 target_free_all_working_areas_restore<span class="token punctuation">(</span><span class="token punctuation">)</span>: freeing all working areas
</code></pre>
    <p>
     根据调试日志分析，根本原因是 ​Windows 系统下 libusb 与 SEGGER 官方驱动冲突，导致 OpenOCD 无法正确访问 J-Link 设备。以下是逐行解析和终极解决方案：
    </p>
    <p>
     ​错误日志关键点分析
     <br/>
     ​
     <strong>
      Found device (VID:PID = 1366:0101)
     </strong>
     <br/>
     J-Link 设备已被系统识别，VID/PID 正确。
     <br/>
     ​
     <strong>
      Failed to open device: LIBUSB_ERROR_NOT_SUPPORTED
     </strong>
     <br/>
     OpenOCD 的 libjaylink 库尝试通过 libusb 访问 J-Link，但被系统拒绝。
     <br/>
     ​
     <strong>
      No J-Link device found
     </strong>
     <br/>
     最终因驱动冲突导致设备访问失败。
     <br/>
     ​根本原因
     <br/>
     ​Windows 系统同时存在 libusb 和 SEGGER 驱动，OpenOCD 默认优先使用 libusb，但 SEGGER 官方驱动已独占设备访问权。
     <br/>
     ​OpenOCD 配置未完全禁用 libusb，导致底层库（libjaylink）仍尝试通过 libusb 通信。
    </p>
    <p>
     但是尝试了很多办法 不知道如何使clion使用segger的驱动，也尝试了禁用libusb在cfg文件内加入以下代码 好像无效，
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 禁用 libusb，强制使用 SEGGER 驱动</span>
jlink config use_libusb <span class="token boolean">false</span>
jlink usb <span class="token number">0</span>
</code></pre>
    <p>
     根据wiki 文档 那segger+jlink就不是一个好的调试选项，因为切换后，因为他更换了jlink的驱动程序，使用keil iar 等程序时，就不太好用了，
     <br/>
     那不如换调试器了，DAP或者st link
    </p>
    <h2>
     <a id="_216">
     </a>
     总结
    </h2>
    <p>
     至此，总算是能完成的搭建好 构建 debug的环境配置了，尽管jlink+openocd不是一个联合调试的好选项。
    </p>
    <h2>
     <a id="_219">
     </a>
     参考
    </h2>
    <p>
     <a href="https://blog.csdn.net/weixin_45467056/article/details/119886361">
      1.参考1 解决openocd无法识别jlink的问题LIBUSB_ERROR_NOT_SUPPORTED
     </a>
     <br/>
     <a href="https://blog.csdn.net/u013798595/article/details/122282189">
      2.解决libusb问题参考2
     </a>
     <br/>
     <a href="https://kb.segger.com/OpenOCD" rel="nofollow">
      3.segger wiki原参考文档
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f4c656553696e636572653532312f:61727469636c652f64657461696c732f313436313136303437" class_="artid" style="display:none">
 </p>
</div>


