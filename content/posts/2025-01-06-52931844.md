---
layout: post
title: "python项目内import其他内部package的模块的正确方法"
date: 2025-01-06 10:02:46 +0800
description: "本文主要介绍如何在一个Python项目中，优雅的实现项目内各个package的模块（module）之"
keywords: "如何从一个package中import 另一个package中的moudle"
categories: ['Python']
tags: ['Python', 'Import']
artid: "52931844"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=52931844
    alt: "python项目内import其他内部package的模块的正确方法"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=52931844
featuredImagePreview: https://bing.ee123.net/img/rand?artid=52931844
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     python项目内import其他内部package的模块的正确方法
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     本文主要介绍如何在一个
     <a class="replace_word" href="http://lib.csdn.net/base/11" rel="nofollow noopener noreferrer" style="color:rgb(223,52,52); text-decoration:none; font-weight:bold" target="_blank" title="undefined">
      Python
     </a>
     项目中，优雅的实现项目内各个package的模块（module）之间的相互引用。
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     之所以写这篇文章，是因为网上流传的各种奇技淫巧简直五花八门（包括stackoverflow等知名社区），极易误导对python的import机制不熟悉的人。比如我就曾一度因为找不到优雅的import方式，而认为python是一门愚蠢的语言。所以，我把近一上午的学习结果总结出来，希望大家不要误入歧途。
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     本文参考了如下两篇博客：
     <br style=""/>
     habnab关于python package的精彩总结：
     <a href="http://blog.habnab.it/blog/2013/07/21/python-packages-and-you/" rel="nofollow noopener noreferrer" style="color:rgb(51,102,153); text-decoration:none" target="_blank">
      地址点我
     </a>
     <br style=""/>
     Jean-Paul Calderone关于python项目结构的建议：
     <a href="http://as.ynchrono.us/2007/12/filesystem-structure-of-python-project_21.html" rel="nofollow noopener noreferrer" style="color:rgb(51,102,153); text-decoration:none" target="_blank">
      地址点我
     </a>
    </p>
    <h2 id="demo-project" style='margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(51,51,51); font-family:"microsoft yahei"'>
     <a name="t0" style="color:rgb(51,102,153)" target="_blank">
     </a>
     demo project
    </h2>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     本文以一个demo project为例，来介绍python的包管理机制。
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     这个demo project我放到github上了：
     <a href="https://github.com/inteliL/demo-python-project" rel="noopener noreferrer" style="color:rgb(51,102,153); text-decoration:none" target="_blank">
      地址点我
     </a>
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     其中，项目根目录有三个文件夹：
    </p>
    <ul style='color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     <li style="">
      data：存放项目数据
     </li>
     <li style="">
      doc：存放项目文档
     </li>
     <li style="">
      package：一个demo python package
     </li>
    </ul>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     其中，package中的文件结构如下图：
     <br style=""/>
     <img align="center" alt="项目结构" src="https://img-blog.csdn.net/20151115163408592" style="border:none; max-width:100%" width="250"/>
    </p>
    <h2 id="python-package" style='margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(51,51,51); font-family:"microsoft yahei"'>
     <a name="t1" style="color:rgb(51,102,153)" target="_blank">
     </a>
     python package
    </h2>
    <h3 id="基础知识" style='margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(51,51,51); font-family:"microsoft yahei"'>
     <a name="t2" style="color:rgb(51,102,153)" target="_blank">
     </a>
     基础知识
    </h3>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     当你import的时候，python只会在sys.path这个变量（一个list，你可以print出来看）里面的路径中找可能匹配的package和module。
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     而一个package跟一个普通文件夹的区别在于，package的文件夹中多了一个__init__.py文件。换句话说，如果你在某个文件夹中添加了一个__init__.py文件，则python就认为这个文件夹是一个package。
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     __init__.py文件可以是空的（也推荐者这么做），它只是告诉python当前文件夹是一个package。当然，也可以在里面添加一些代码，这些代码会在import这个包的时候运行。
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     所以，请确保你要import的文件所在的文件夹有__init__.py文件（除非它在sys.path中某个文件夹下）。
    </p>
    <h3 id="错误的import做法" style='margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(51,51,51); font-family:"microsoft yahei"'>
     <a name="t3" style="color:rgb(51,102,153)" target="_blank">
     </a>
     错误的import做法
    </h3>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     如上述project中，如果你想让subpackage2中的foo2来import subpackage1中的foo1，便会出现找不到subpackage1的情况。
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     目前网络上大部分的做法都是通过sys.path.append(yourpath)之类的方法，将你需要import的module的目录添加到sys.path中。或者，通过修改PYTHONPATH这个环境变量来将添加（跟修改sys.path效果相同）。
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     但是，这种做法有如下几个缺点：
    </p>
    <ul style='color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     <li style="">
      如果你用PYTHONPATH，那么当有多个项目时，你需要把每个项目的根目录都加入到PYTHONPATH中，会使得PYTHONPATH变得十分臃肿
     </li>
     <li style="">
      如果你使用sys.path，由于文件夹是动态添加的，所以当你使用相对路径的时候，实际路径会十分依赖于你的入口函数，当入口函数改变很可能就会导致代码无法运行
     </li>
     <li style="">
      如果你使用绝对路径，将你的代码在其他机器上运行的时候需要重新配置这些变量，十分麻烦
     </li>
    </ul>
    <h3 id="正确的做法" style='margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(51,51,51); font-family:"microsoft yahei"'>
     <a name="t4" style="color:rgb(51,102,153)" target="_blank">
     </a>
     正确的做法
    </h3>
    <h4 id="代码中正常import" style='margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(51,51,51); font-family:"microsoft yahei"'>
     <a name="t5" style="color:rgb(51,102,153)" target="_blank">
     </a>
     代码中正常import
    </h4>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     首先，在代码中按照正常方式导入你需要的包
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     比如，你需要在app.py中导入foo1，则：
    </p>
    <pre><code class="language-python">from package.subpackage1 import foo1 </code></pre>
    <p>
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     虽然你可能发现from subpackage1 import foo1也可以正常运行，但是请避免这种使用相对路径的方法。因为这在python3中将不再支持，同时也有可能会引起奇怪的问题。同时，虽然PEP 328中也给出了 from .subpackage1 import foo1这样的形式，但是还是不要自己给自己制造麻烦，统一使用完整路径（绝对路径）为好。
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     再比如，如果你需要在foo2.py中导入foo1.py（在不同的subpackage中），则：
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
    </p>
    <pre><code class="language-python">from package.subpackage1 import foo1</code></pre>
    <p>
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     跟上面一模一样，这就是使用绝对路径的好处，各处的引用高度统一。同时，如果你的package被安装在其他用户的机器中，其他用户也会使用这种绝对路径来import你package中的模块（回想你自己import第三方package的情景）。
    </p>
    <h4 id="创建mainpy文件" style='margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(51,51,51); font-family:"microsoft yahei"'>
     <a name="t6" style="color:rgb(51,102,153)" target="_blank">
     </a>
     创建__main__.py文件
    </h4>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     在package的根目录中创建__main__.py文件，可以使得你的package可以通过python -m直接运行。
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     demo中的__main__.py文件十分简单：
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
    </p>
    <pre><code class="language-python">from package.app import main
main()</code></pre>
    <br/>
    即import真正的主函数app.py中的main方法，然后调用main()
    <p>
    </p>
    <h4 id="用python-m运行你的python文件" style='margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(51,51,51); font-family:"microsoft yahei"'>
     <a name="t7" style="color:rgb(51,102,153)" target="_blank">
     </a>
     用python -m运行你的python文件
    </h4>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     python的-m参数官方说法是：
     <br style=""/>
     Searches sys.path for the named module and runs the corresponding .py file as a script.
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     在下面的例子中，加上-m参数后，所运行的.py文件便会识别其顶层的package
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     回到刚才的例子。创建完__main__.py之后，cd到项目的根目录，运行
    </p>
    <pre><code class="language-python">python -m package</code></pre>
    <p>
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     即可实现直接运行__main__.py，即直接运行了package这个包
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     如果你想直接运行package内的某个.py文件，比如foo1，则：
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
    </p>
    <pre><code class="language-python">python -m package.subpackage1.foo1</code></pre>
    <br/>
    当然，你要确保foo1中存在判断其是否是入口函数的逻辑，如下：
    <p>
    </p>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
    </p>
    <pre><code class="language-python">if __name__ == "__main__":
    speak()</code></pre>
    <p>
    </p>
    <h4 id="总结" style='margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(51,51,51); font-family:"microsoft yahei"'>
     <a name="t8" style="color:rgb(51,102,153)" target="_blank">
     </a>
     总结
    </h4>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     至此，我们已经实现了你所希望的所有功能：
    </p>
    <ul style='color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     <li style="">
      在project内部实现各个模块之间的import
     </li>
     <li style="">
      project中的各个.py文件可以直接运行
     </li>
     <li style="">
      将project迁移到其他机器时，不用进行额外配置
     </li>
    </ul>
    <p style='margin-top:0px; margin-bottom:1.1em; color:rgb(51,51,51); font-family:"microsoft yahei"; font-size:14px'>
     如果还有不明白的，可以将github上的源码下载下来看一看，然后用python -m运行一下
    </p>
    <br/>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f75303131303839353233:2f61727469636c652f64657461696c732f3532393331383434" class_="artid" style="display:none">
 </p>
</div>


