---
layout: post
title: "vuereact前端项目打包的时候加上时间,防止后端扯皮"
date: 2025-03-14 19:20:50 +0800
description: "在前端项目（Vue/React）打包时，将打包时间注入到项目中，可以有效防止前后端扯皮，尤其是在部署和调试时能够明确知道当前运行的代码版本和打包时间。将里面的buildCmd替换为自己的命令。"
keywords: "vue/react前端项目打包的时候加上时间，防止后端扯皮"
categories: ['Html']
tags: ['前端', 'Vue', 'React']
artid: "146265469"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146265469
    alt: "vuereact前端项目打包的时候加上时间,防止后端扯皮"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146265469
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146265469
cover: https://bing.ee123.net/img/rand?artid=146265469
image: https://bing.ee123.net/img/rand?artid=146265469
img: https://bing.ee123.net/img/rand?artid=146265469
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     vue/react前端项目打包的时候加上时间，防止后端扯皮
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <img alt="" height="988" src="https://i-blog.csdnimg.cn/direct/c05f4c981fc546a7984c13e21abc62c7.png" width="2336"/>
    </p>
    <p>
     在前端项目（Vue/React）打包时，将打包时间注入到项目中，可以有效防止前后端扯皮，尤其是在部署和调试时能够明确知道当前运行的代码版本和打包时间。以下是实现方案
    </p>
    <p>
     在index.html中加入时间模板：
    </p>
    <pre><code>&lt;div style="display: none"&gt;PUBLISHTIME&lt;/div&gt;</code></pre>
    <p>
     <img alt="" height="464" src="https://i-blog.csdnimg.cn/direct/920f13a4fdf14a07b4c4badc480a19cd.png" width="1980"/>
    </p>
    <p>
     安装一个文件管理依赖：
    </p>
    <pre><code class="language-javascript">pnpm install fs-extra -D</code></pre>
    <p>
     然后新建一个script文件夹用于存储编译脚本，并存储编译脚本：
    </p>
    <p>
     将里面的buildCmd替换为自己的命令
    </p>
    <pre><code class="language-javascript">const fs = require('fs-extra')
const path = require('path')
const { exec } = require('child_process')

const buildCmd = 'pnpm run test'

const updateDeployTime = () =&gt; {
    const indexHtml = path.join(__dirname, '../index.html')
    let content = fs.readFileSync(indexHtml, 'utf-8')
    if (content.includes(`PUBLISHTIME`)) {
        var currentTime = new Date()
        // 提取年、月、日、时、分、秒
        var year = currentTime.getFullYear() // 年
        var month = String(currentTime.getMonth() + 1).padStart(2, '0')
        var day = String(currentTime.getDate()).padStart(2, '0') // 日
        var hours = String(currentTime.getHours()).padStart(2, '0') // 时
        var minutes = String(currentTime.getMinutes()).padStart(2, '0') // 分
        var seconds = String(currentTime.getSeconds()).padStart(2, '0') // 秒
        // 拼接成 YYYY-MM-DD HH:mm:ss 格式
        var formattedTime = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`
        console.log('currentTime', formattedTime)
        content = content.replace('PUBLISHTIME', `build time: ${formattedTime}`)
        fs.writeFileSync(indexHtml, content)
        console.log(`Updated time in: ${indexHtml}`)
    }
}

const deleteDistFolder = () =&gt; {
    const distFolder = path.join(__dirname, '../dist')
    if (fs.existsSync(distFolder)) {
        fs.remove(distFolder)
        console.log(`Deleted folder: ${distFolder}`)
    } else {
        console.log(`Folder does not exist: ${distFolder}`)
    }
}

const testBuild = () =&gt; {
    // Step 1: Run the build command
    console.log('Starting build process...')
    exec(buildCmd + ' &amp;&amp; git restore .', (error, stdout, stderr) =&gt; {
        if (error) {
            console.error(`Build error: ${error.message}`)
            return
        }
        if (stderr) {
            console.error(`Build stderr: ${stderr}`)
        }
        console.log(`Build stdout: ${stdout}`)
        console.log('Build process complete.')
    })
}

// 从命令行获取新服务的名称
exec('git add .', (error, stdout, stderr) =&gt; {
    // del dist folder
    deleteDistFolder()
    // update build time
    updateDeployTime()
    // run build test command
    testBuild()
    // upload dist folder to server
})
</code></pre>
    <p>
     然后在package.json里面添加编译命令：
    </p>
    <pre><code class="language-javascript">"pub:test": "node scripts/test.cjs",
"pub:prod": "node scripts/prod.cjs"</code></pre>
    <p>
     <img alt="" height="1046" src="https://i-blog.csdnimg.cn/direct/755e9e058705444eac8294fec6dfa5f3.png" width="2320"/>
    </p>
   </div>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34343738363533302f:61727469636c652f64657461696c732f313436323635343639" class_="artid" style="display:none">
 </p>
</div>


