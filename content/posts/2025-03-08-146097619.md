---
layout: post
title: "从零到多页复用我的WPF-MVVM国际化实践"
date: 2025-03-08 00:00:00 +0800
description: "起步简单：资源文件和基本绑定能快速实现单页面国际化。提升体验：依赖属性和下拉框让切换更自然。复用为王：集中化管理避免重复劳动。动态扩展：用动态对象应对未来需求。如果你的项目也有国际化需求，不妨从基础开始，根据规模逐步优化。你遇到过哪些国际化难题？欢迎留言分享！"
keywords: "从零到多页复用：我的WPF MVVM国际化实践"
categories: ['C']
tags: ['开发语言', 'Wpf', 'C']
artid: "146097619"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146097619
    alt: "从零到多页复用我的WPF-MVVM国际化实践"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146097619
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146097619
cover: https://bing.ee123.net/img/rand?artid=146097619
image: https://bing.ee123.net/img/rand?artid=146097619
img: https://bing.ee123.net/img/rand?artid=146097619
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     从零到多页复用：我的WPF MVVM国际化实践
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/d431ceb6a45107d9b598ee8faada8844.png"/>
    </p>
    <p>
    </p>
    <br/>
    作为一名WPF开发者，我最近在一个配置工具项目中遇到了国际化需求。起初，我只是想让按钮文本支持英文和中文切换，但随着页面增多，需求复杂化，我逐渐摸索出一套从简单到专业化的实现方案。这篇文章记录了我的探索过程，从最基础的资源文件开始，到多页面复用的优化，希望能给有类似需求的开发者一些启发。
    <p>
    </p>
    <h3>
     <a id="_5">
     </a>
     第一步：基础实现，资源文件入门
    </h3>
    <p>
     我的项目是一个基于WPF和MVVM的配置工具，界面上有“Save”和“Refresh”两个按钮，需要支持英文和中文切换。WPF的国际化通常从资源文件（.resx）入手，于是我先尝试了最简单的方法。
    </p>
    <p>
     在项目中，我创建了一个Resources文件夹，添加了两个资源文件：
    </p>
    <ul>
     <li>
      Resources.resx（默认英文）：
      <ul>
       <li>
        save: Save
       </li>
       <li>
        refresh: Refresh
       </li>
      </ul>
     </li>
     <li>
      Resources.zh-CN.resx（中文）：
      <ul>
       <li>
        save: 保存
       </li>
       <li>
        refresh: 刷新
       </li>
      </ul>
     </li>
    </ul>
    <p>
     在XAML中，我尝试直接绑定到资源：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span> <span class="token attr-name">Content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{Binding Source={x:Static local:Resources.save}}<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre>
    <p>
     但很快发现，这种方式在运行时切换语言时不会更新UI，因为静态绑定无法响应动态变化。于是，我转向代码隐藏文件，在UserControl中定义属性：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">PageTemplate</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">UserControl</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Save <span class="token operator">=&gt;</span> Resources<span class="token punctuation">.</span>ResourceManager<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"save"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Refresh <span class="token operator">=&gt;</span> Resources<span class="token punctuation">.</span>ResourceManager<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"refresh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">PageTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">InitializeComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        DataContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     XAML改为：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span> <span class="token attr-name">Content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{Binding Save}<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre>
    <p>
     这时候，按钮显示了英文，但点击“中文”按钮后，文本没变。我意识到，语言切换需要更新CultureInfo，于是引入了一个单例类LanguageManager：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LanguageManager</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name">Lazy<span class="token punctuation">&lt;</span>LanguageManager<span class="token punctuation">&gt;</span></span> _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Lazy<span class="token punctuation">&lt;</span>LanguageManager<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LanguageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">LanguageManager</span> Instance <span class="token operator">=&gt;</span> _instance<span class="token punctuation">.</span>Value<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">CultureInfo</span> _currentCulture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CultureInfo</span><span class="token punctuation">(</span><span class="token string">"en-US"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">CultureInfo</span> CurrentCulture
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _currentCulture<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            _currentCulture <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
            Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>CurrentUICulture <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetString</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> key<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Resources<span class="token punctuation">.</span>ResourceManager<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> _currentCulture<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token interpolation-string"><span class="token string">$"[</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">key</span><span class="token punctuation">}</span></span><span class="token string">]"</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     在PageTemplate中使用：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">LanguageManager</span> _languageManager <span class="token operator">=</span> LanguageManager<span class="token punctuation">.</span>Instance<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Save <span class="token operator">=&gt;</span> _languageManager<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"save"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     加上切换命令：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span> <span class="token attr-name">CommandParameter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zh-CN<span class="token punctuation">"</span></span> <span class="token attr-name">Command</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{Binding SwitchLanguageCommand}<span class="token punctuation">"</span></span> <span class="token attr-name">Content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>中文<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name">ICommand</span> SwitchLanguageCommand <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RelayCommand<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>lang <span class="token operator">=&gt;</span>
<span class="token punctuation">{<!-- --></span>
    _languageManager<span class="token punctuation">.</span>CurrentCulture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CultureInfo</span><span class="token punctuation">(</span>lang<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     然而，切换后UI还是没更新。我调试发现，虽然CultureInfo变了，但绑定没有刷新。加上INotifyPropertyChanged后问题解决：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">PageTemplate</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">UserControl</span><span class="token punctuation">,</span> <span class="token class-name">INotifyPropertyChanged</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">LanguageManager</span> _languageManager <span class="token operator">=</span> LanguageManager<span class="token punctuation">.</span>Instance<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Save <span class="token operator">=&gt;</span> _languageManager<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"save"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">PageTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">InitializeComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        DataContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        _languageManager<span class="token punctuation">.</span>PropertyChanged <span class="token operator">+=</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">PropertyChangedEventHandler</span> PropertyChanged<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> propertyName<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> PropertyChanged<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PropertyChangedEventArgs</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     终于，切换语言时按钮文本正常更新了！
    </p>
    <h3>
     <a id="WPF_95">
     </a>
     第二步：依赖属性，提升WPF体验
    </h3>
    <p>
     虽然基础功能实现了，但这种只读属性方式让我觉得不够“WPF”。在WPF中，依赖属性更适合绑定场景。于是我改用依赖属性：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name">DependencyProperty</span> SaveProperty <span class="token operator">=</span> DependencyProperty<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>
    <span class="token keyword">nameof</span><span class="token punctuation">(</span>Save<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">string</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">PageTemplate</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PropertyMetadata</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Save
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">get</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span><span class="token function">GetValue</span><span class="token punctuation">(</span>SaveProperty<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">set</span> <span class="token operator">=&gt;</span> <span class="token function">SetValue</span><span class="token punctuation">(</span>SaveProperty<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token function">PageTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">InitializeComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DataContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token function">UpdateLocalizedStrings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _languageManager<span class="token punctuation">.</span>PropertyChanged <span class="token operator">+=</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">UpdateLocalizedStrings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">UpdateLocalizedStrings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    Save <span class="token operator">=</span> _languageManager<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"save"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Refresh <span class="token operator">=</span> _languageManager<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"refresh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     这样，绑定更符合WPF的习惯，而且UI更新更可靠。下一步，我把语言切换按钮改成了下拉框：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ComboBox</span> <span class="token attr-name">ItemsSource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{Binding Languages}<span class="token punctuation">"</span></span>
          <span class="token attr-name">DisplayMemberPath</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DisplayName<span class="token punctuation">"</span></span>
          <span class="token attr-name">SelectedValuePath</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CultureName<span class="token punctuation">"</span></span>
          <span class="token attr-name">SelectedValue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{Binding SelectedLanguage, Mode=TwoWay}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>LanguageOption<span class="token punctuation">&gt;</span></span> Languages <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>LanguageOption<span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LanguageOption</span><span class="token punctuation">(</span><span class="token string">"English"</span><span class="token punctuation">,</span> <span class="token string">"en-US"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LanguageOption</span><span class="token punctuation">(</span><span class="token string">"中文"</span><span class="token punctuation">,</span> <span class="token string">"zh-CN"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name">DependencyProperty</span> SelectedLanguageProperty <span class="token operator">=</span> DependencyProperty<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>
    <span class="token keyword">nameof</span><span class="token punctuation">(</span>SelectedLanguage<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">string</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">PageTemplate</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PropertyMetadata</span><span class="token punctuation">(</span><span class="token string">"en-US"</span><span class="token punctuation">,</span> OnSelectedLanguageChanged<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> SelectedLanguage
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">get</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span><span class="token function">GetValue</span><span class="token punctuation">(</span>SelectedLanguageProperty<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">set</span> <span class="token operator">=&gt;</span> <span class="token function">SetValue</span><span class="token punctuation">(</span>SelectedLanguageProperty<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnSelectedLanguageChanged</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> d<span class="token punctuation">,</span> <span class="token class-name">DependencyPropertyChangedEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name"><span class="token keyword">var</span></span> page <span class="token operator">=</span> <span class="token punctuation">(</span>PageTemplate<span class="token punctuation">)</span>d<span class="token punctuation">;</span>
    page<span class="token punctuation">.</span>_languageManager<span class="token punctuation">.</span>CurrentCulture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CultureInfo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>e<span class="token punctuation">.</span>NewValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     这让界面更友好，用户体验也提升了。
    </p>
    <h3>
     <a id="_153">
     </a>
     第三步：多页面复用，减少重复代码
    </h3>
    <p>
     项目发展到有多个页面时，我发现每个页面都重复定义Save、Refresh和语言切换逻辑，太繁琐了。我决定把国际化集中化，先创建了一个基类：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaseViewModel</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">INotifyPropertyChanged</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">protected</span> <span class="token keyword">readonly</span> <span class="token class-name">LanguageService</span> _languageService <span class="token operator">=</span> LanguageService<span class="token punctuation">.</span>Instance<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Save <span class="token operator">=&gt;</span> _languageService<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"save"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Refresh <span class="token operator">=&gt;</span> _languageService<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"refresh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">PropertyChangedEventHandler</span> PropertyChanged<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> propertyName<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> PropertyChanged<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PropertyChangedEventArgs</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     LanguageService接管了语言管理：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LanguageService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">INotifyPropertyChanged</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name">Lazy<span class="token punctuation">&lt;</span>LanguageService<span class="token punctuation">&gt;</span></span> _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Lazy<span class="token punctuation">&lt;</span>LanguageService<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LanguageService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">LanguageService</span> Instance <span class="token operator">=&gt;</span> _instance<span class="token punctuation">.</span>Value<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">CultureInfo</span> _currentCulture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CultureInfo</span><span class="token punctuation">(</span><span class="token string">"en-US"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">CultureInfo</span> CurrentCulture
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _currentCulture<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            _currentCulture <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
            Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>CurrentUICulture <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
            <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetString</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> key<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Resources<span class="token punctuation">.</span>ResourceManager<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> _currentCulture<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token interpolation-string"><span class="token string">$"[</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">key</span><span class="token punctuation">}</span></span><span class="token string">]"</span></span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>LanguageOption<span class="token punctuation">&gt;</span></span> Languages <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>LanguageOption<span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LanguageOption</span><span class="token punctuation">(</span><span class="token string">"English"</span><span class="token punctuation">,</span> <span class="token string">"en-US"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LanguageOption</span><span class="token punctuation">(</span><span class="token string">"中文"</span><span class="token punctuation">,</span> <span class="token string">"zh-CN"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> SelectedLanguage
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _currentCulture<span class="token punctuation">.</span>Name<span class="token punctuation">;</span>
        <span class="token keyword">set</span> <span class="token operator">=&gt;</span> CurrentCulture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CultureInfo</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">PropertyChangedEventHandler</span> PropertyChanged<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> propertyName<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> PropertyChanged<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PropertyChangedEventArgs</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     页面只需继承BaseViewModel：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PageTemplateViewModel</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">BaseViewModel</span></span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">PageTemplate</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">UserControl</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token function">PageTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">InitializeComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        DataContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PageTemplateViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     XAML绑定到全局服务：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ComboBox</span> <span class="token attr-name">ItemsSource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{Binding Languages, Source={x:Static services:LanguageService.Instance}}<span class="token punctuation">"</span></span>
          <span class="token attr-name">SelectedValue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{Binding SelectedLanguage, Source={x:Static services:LanguageService.Instance}, Mode=TwoWay}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre>
    <h3>
     <a id="_222">
     </a>
     第四步：动态化，应对更多字符串
    </h3>
    <p>
     页面越来越多，字符串也从save、refresh扩展到title、user等十几个。我不想在BaseViewModel中为每个字符串写属性，于是尝试了动态方案：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaseViewModel</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">INotifyPropertyChanged</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">protected</span> <span class="token keyword">readonly</span> <span class="token class-name">LanguageService</span> _languageService <span class="token operator">=</span> LanguageService<span class="token punctuation">.</span>Instance<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">dynamic</span></span> Strings <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LocalizedStrings</span><span class="token punctuation">(</span>_languageService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">BaseViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        _languageService<span class="token punctuation">.</span>PropertyChanged <span class="token operator">+=</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>Strings<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">PropertyChangedEventHandler</span> PropertyChanged<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> propertyName<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> PropertyChanged<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PropertyChangedEventArgs</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LocalizedStrings</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DynamicObject</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">LanguageService</span> _languageService<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">LocalizedStrings</span><span class="token punctuation">(</span><span class="token class-name">LanguageService</span> languageService<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        _languageService <span class="token operator">=</span> languageService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">TryGetMember</span><span class="token punctuation">(</span><span class="token class-name">GetMemberBinder</span> binder<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">object</span></span> result<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        result <span class="token operator">=</span> _languageService<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>binder<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     XAML改为：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span> <span class="token attr-name">Content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{Binding Strings.save}<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextBlock</span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{Binding Strings.title}<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre>
    <p>
     现在，无论有多少字符串，我只需在资源文件里添加键值对，代码完全不用改动。这种方式让我从繁琐的属性定义中解放出来。
    </p>
    <h3>
     <a id="_263">
     </a>
     总结与反思
    </h3>
    <p>
     从最初的简单资源文件，到依赖属性，再到多页面复用，最后用动态对象优化，我的国际化之旅走了不少弯路，但每一步都让我更理解WPF和MVVM的精髓：
    </p>
    <ul>
     <li>
      <strong>
       起步简单
      </strong>
      ：资源文件和基本绑定能快速实现单页面国际化。
     </li>
     <li>
      <strong>
       提升体验
      </strong>
      ：依赖属性和下拉框让切换更自然。
     </li>
     <li>
      <strong>
       复用为王
      </strong>
      ：集中化管理避免重复劳动。
     </li>
     <li>
      <strong>
       动态扩展
      </strong>
      ：用动态对象应对未来需求。
     </li>
    </ul>
    <p>
     如果你的项目也有国际化需求，不妨从基础开始，根据规模逐步优化。你遇到过哪些国际化难题？欢迎留言分享！
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f5a5f6f696f69686f69692f:61727469636c652f64657461696c732f313436303937363139" class_="artid" style="display:none">
 </p>
</div>


