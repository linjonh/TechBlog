---
layout: post
title: Javaè¿­ä»£å™¨è¯¦è§£,çœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†
date: 2022-01-27 18:00:11 +0800
categories: ['Java']
tags: ['å¼€å‘è¯­è¨€', 'åç«¯', 'Java']
image:
    path: https://img-blog.csdnimg.cn/197950636cfe4918bf91772d803dd7fe.png?x-oss-process=image/resize,m_fixed,h_150
    alt: Javaè¿­ä»£å™¨è¯¦è§£,çœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†
artid: 122712947
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=122712947
featuredImagePreview: https://bing.ee123.net/img/rand?artid=122712947
---

# Javaè¿­ä»£å™¨è¯¦è§£ï¼Œçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†

> #### æ–‡ç« ç›®å½•
>
> * [ğŸš©Java è¿­ä»£å™¨è¯¦è§£](#Java__4)
> * + [ğŸ“šè¿­ä»£å™¨çš„å®šä¹‰](#_5)
>   + [ğŸ“’è®¤è¯†Iterator](#Iterator_12)
>   + - [âœï¸ç±»ç»“æ„å›¾](#_13)
>     - [âœ’ï¸Iterableæ¥å£](#Iterable_17)
>     - [ğŸ–ï¸Iteratoræ¥å£](#Iterator_31)
>     - * [ğŸ“ƒIteratoræ¥å£çš„æ–¹æ³•](#Iterator_44)
>   + [ğŸ“™è¿­ä»£å™¨çš„ä½¿ç”¨](#_54)
>   + - [ğŸ·ï¸ä½¿ç”¨è¿­ä»£å™¨éå†é›†åˆ](#_55)
>     - [ğŸ”–Itertorçš„æ‰§è¡ŒåŸç†](#Itertor_81)
>     - * [â³å›¾ç¤ºæ‰§è¡Œè¿‡ç¨‹](#_83)
>       * [âŒ›æ‰§è¡Œè¿‡ç¨‹è¯¦è§£](#_86)
>     - [ğŸƒç”Ÿæˆè¿­ä»£å™¨çš„å¿«æ·é”®](#_97)
>   + [ğŸ“•è¿­ä»£å™¨ä¸­çš„remove()](#remove_100)
>   + - [â›„è¿­ä»£å™¨çš„remove()æ–¹æ³•ä½¿ç”¨](#remove_101)
>     - [â˜ƒï¸è¿­ä»£å™¨éå†ä¸­è°ƒç”¨é›†åˆrevome()æ–¹æ³•è§¦å‘å¼‚å¸¸](#revome_130)
>   + [ğŸ“—å¢å¼ºforå¾ªç¯](#for_244)
>   + - [ğŸ“«è®¤è¯†å¢å¼ºforå¾ªç¯](#for_245)
>     - [ğŸ“ªåŸºæœ¬è¯­æ³•](#_249)
>     - [ğŸ“¬å¢å¼ºforå¾ªç¯çš„ä½¿ç”¨](#for_251)
>     - [ğŸ“­å¢å¼ºforå¾ªç¯çš„å¿«æ·é”®](#for_281)

## ğŸš©Java è¿­ä»£å™¨è¯¦è§£

### ğŸ“šè¿­ä»£å™¨çš„å®šä¹‰

`è¿­ä»£å™¨`
æ˜¯å±äº
**è®¾è®¡æ¨¡å¼**
ä¹‹ä¸€ï¼Œ
è¿­ä»£å™¨æ¨¡å¼
æä¾›äº†ä¸€ç§æ–¹æ³•æ¥é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­å„ä¸ªå…ƒç´ ï¼Œè€Œä¸ä¿ç•™è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚

> 1ï¼‰
> `Iteratorå¯¹è±¡`
> ç§°ä¸º
> **è¿­ä»£å™¨**
> ï¼Œä¸»è¦ç”¨äºéå†
> `Collectioné›†åˆ`
> ä¸­çš„å…ƒç´ ã€‚
>   
> 2ï¼‰æ‰€æœ‰å®ç°äº†
> `Collectionæ¥å£`
> çš„é›†åˆç±»éƒ½æœ‰ä¸€ä¸ª
> `iterator()`
> æ–¹æ³•ï¼Œç”¨ä»¥è¿”å›ä¸€ä¸ªå®ç°äº†
> `Iteratoræ¥å£çš„å¯¹è±¡`
> ï¼Œå³å¯ä»¥è¿”å›ä¸€ä¸ª
> `è¿­ä»£å™¨`
> ã€‚
>   
> 3ï¼‰
> `Iterator`
> ä»…ç”¨äºéå†é›†åˆï¼Œ
> `Iterator`
> æœ¬èº«å¹¶ä¸å­˜æ”¾å¯¹è±¡ã€‚

### ğŸ“’è®¤è¯†Iterator

#### âœï¸ç±»ç»“æ„å›¾

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/5160b869b02d7f435016d90aca9958a2.png)
  
é€šè¿‡è§‚å¯Ÿç±»ç»“æ„å›¾çš„ç»§æ‰¿å…³ç³»æˆ‘ä»¬å‘ç°ï¼Œé›†åˆçš„é¡¶å±‚æ¥å£
`Collection`
ç»§æ‰¿
`Iterable`
æ¥å£ã€‚

#### âœ’ï¸Iterableæ¥å£

```java
public interface Iterable<T> {
    /**
     * Returns an iterator over elements of type {@code T}.
     *
     * @return an Iterator.
     */
    Iterator<T> iterator();
}

```

åœ¨
`Iterableæ¥å£`
ä¸­æœ‰ä¸€ä¸ª
`Iteratoræ–¹æ³•`
ï¼Œå®ƒè¿”å›ä¸€ä¸ª
`Itertatorå¯¹è±¡`
ã€‚

#### ğŸ–ï¸Iteratoræ¥å£

```java
public interface Iterator<E> {
    boolean hasNext();
    
    E next();
    
    default void remove() {
        throw new UnsupportedOperationException("remove");
    }
}

```

##### ğŸ“ƒIteratoræ¥å£çš„æ–¹æ³•

| è¿”å›å€¼ç±»å‹ | æ–¹æ³•å | åŠŸèƒ½ |
| --- | --- | --- |
| boolean | hasNext() | åˆ¤æ–­é›†åˆæ˜¯å¦è¿˜æœ‰å…ƒç´ ï¼Œå¦‚æœè¿”å› **true** è¡¨ç¤ºé›†åˆè¿˜æœ‰å…ƒç´ ï¼Œè¿”å› **false** è¡¨ç¤ºé›†åˆä¸­æ²¡æœ‰å…ƒç´ ï¼›ä¸€èˆ¬å¯¹é›†åˆçš„è®¿é—®é€šè¿‡ **while(hasNext())** åˆ¤æ–­æ˜¯å¦è¿˜éœ€è¦éå†ã€‚ |
| E | next() | è·å–é›†åˆä¸­éå†çš„å½“å‰å…ƒç´  ï¼›ä¸€èˆ¬å…ˆè°ƒç”¨ **hasNext()** æ–¹æ³•åˆ¤æ–­æ˜¯å¦å­˜åœ¨å…ƒç´ ï¼Œå†è°ƒç”¨ **next()** è·å–å…ƒç´ ï¼Œéœ€è¦è¿›è¡Œå¾ªç¯äº¤æ›¿éå†é›†åˆä¸­çš„å…ƒç´ ã€‚ |
| void | remove | åˆ é™¤é›†åˆä¸­çš„å…ƒç´ ã€‚ |

### ğŸ“™è¿­ä»£å™¨çš„ä½¿ç”¨

#### ğŸ·ï¸ä½¿ç”¨è¿­ä»£å™¨éå†é›†åˆ

æˆ‘ä»¬ç”¨
`ArrayListé›†åˆ`
å­˜æ”¾ä¸€äº›æ•´å‹æ•°æ®åšç¤ºä¾‹ï¼Œç„¶åå°†å…¶é›†åˆä¸­çš„å…ƒç´ ä¸€ä¸€éå†æ‰“å°è¾“å‡ºã€‚

```java
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

public class TestDemo {
    public static void main(String[] args) {
        List<Integer> list = new ArrayList<>();
        list.add(111);
        list.add(222);
        list.add(333);

        Iterator<Integer> iterator = list.iterator();
        while(iterator.hasNext()) {
            int value = iterator.next();
            System.out.print(value + " ");
        }
    }
}

```

**è¿è¡Œç»“æœï¼š**
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/3e7c4a681b2d3ac79efb5f2d91c638c5.png)
  
è§‚å¯Ÿè¿è¡Œç»“æœæˆ‘ä»¬å‘ç°ï¼Œé€šè¿‡
`è¿­ä»£å™¨`
æˆ‘ä»¬å°†
`ArrayListé›†åˆ`
ä¸­çš„å…ƒç´ ä¸€ä¸€æ‰“å°äº†å‡ºæ¥ã€‚

#### ğŸ”–Itertorçš„æ‰§è¡ŒåŸç†

åœ¨ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼Œ
è¿­ä»£å™¨
æ˜¯å¦‚ä½•å®ç°å¯¹é›†åˆçš„éå†å‘¢ï¼Ÿ

##### â³å›¾ç¤ºæ‰§è¡Œè¿‡ç¨‹

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/25c06405128bdd89361a8995762dc65f.gif)

##### âŒ›æ‰§è¡Œè¿‡ç¨‹è¯¦è§£

â‘ é¦–å…ˆå¾—åˆ°ä¸€ä¸ªé›†åˆçš„è¿­ä»£å™¨
`Iterator iterator = list.iterator();`
  
â‘¡è¿›å…¥
`whileå¾ªç¯`
ï¼Œè°ƒç”¨
`hasNext()`
åˆ¤æ–­æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›trueï¼Œ
`Iterator.next()`
ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œå°†è¯¥ä½ç½®çš„å…ƒç´ 
**111**
è¿”å›ã€‚
  
â‘¢å†æ¬¡è¿›å…¥
`whileå¾ªç¯`
ï¼Œè°ƒç”¨
`hasNext()`
åˆ¤æ–­æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›trueï¼Œ
`Iterator.next()`
ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œå°†è¯¥ä½ç½®
**222**
çš„å…ƒç´ è¿”å›ã€‚
  
â‘£å†æ¬¡è¿›å…¥
`whileå¾ªç¯`
ï¼Œè°ƒç”¨
`hasNext()`
åˆ¤æ–­æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›trueï¼Œ
`Iterator.next()`
ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œå°†è¯¥ä½ç½®
**333**
çš„å…ƒç´ è¿”å›ã€‚
  
â‘¤å†æ¬¡è¿›å…¥
`whileå¾ªç¯`
ï¼Œè°ƒç”¨
`hasNext()`
åˆ¤æ–­æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›falseï¼Œå¾ªç¯ç»“æŸã€‚

---

åœ¨
è¿­ä»£å™¨
çš„éå†è¿‡ç¨‹ä¸­å…ˆé€šè¿‡
`hastNext()`
æ–¹æ³•åˆ¤æ–­æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœå­˜åœ¨ä¸‹ä¸€ä¸ªå…ƒç´ å†è°ƒç”¨
`next()`
æ–¹æ³•è·å–å…ƒç´ ï¼Œåœ¨è¿™é‡Œ
`next()`
æ–¹æ³•å…ˆå¾€åç§»åŠ¨ä¸€ä¸ªå…ƒç´ ä½ç½®ï¼Œå†è¿”å›è¯¥ä½ç½®çš„å…ƒç´ ã€‚å› æ­¤ï¼Œåœ¨è°ƒç”¨
`next()`
æ–¹æ³•ä¹‹å‰å¿…é¡»è¦è°ƒç”¨
`hastNext()`
æ–¹æ³•è¿›è¡Œæ£€æµ‹ï¼›å¦‚æœæ²¡æœ‰è°ƒç”¨å¹¶ä¸”æ²¡æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œç›´æ¥è°ƒç”¨
`next()`
æ–¹æ³•ä¼šæŠ›å‡º
`NoSuchElementExceptionå¼‚å¸¸`
ã€‚

#### ğŸƒç”Ÿæˆè¿­ä»£å™¨çš„å¿«æ·é”®

ä¸€å¼€å§‹ä½¿ç”¨
è¿­ä»£å™¨
å¯èƒ½ä¼šè§‰å¾—éº»çƒ¦ï¼Œä½†æ˜¯å¦‚æœç”¨çš„
`Ideaç¼–è¯‘å™¨`
æ˜¯æœ‰å¿«æ·é”®çš„ï¼Œè¾“å…¥
`itit`
å†å›è½¦å°±ä¼šç›´æ¥ç”Ÿæˆã€‚
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/9ad3a7183b6d8569868983a4e00e412b.gif)

### ğŸ“•è¿­ä»£å™¨ä¸­çš„remove()

#### â›„è¿­ä»£å™¨çš„remove()æ–¹æ³•ä½¿ç”¨

åœ¨
Iteratoræ¥å£
ä¸­é™¤äº†
`hasNext()`
å’Œ
`next()`
æ–¹æ³•å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª
`remove()`
æ–¹æ³•ï¼Œå³
**åˆ é™¤é›†åˆä¸­çš„å…ƒç´ **
ã€‚

*å¦‚åˆ é™¤ä¸Šè¿°ç¤ºä¾‹é›†åˆä¸­çš„å…ƒç´ 111*

```java
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
@SuppressWarnings({"all"})
public class TestDemo {
    public static void main(String[] args) {
        List<Integer> list = new ArrayList<>();
        list.add(111);
        list.add(222);
        list.add(333);

        System.out.println("åˆ é™¤å‰:" + list);
        Iterator<Integer> iterator = list.iterator();
        while (iterator.hasNext()) {
            Integer value =  iterator.next();
            if(value == 111) iterator.remove();
        }
        System.out.println("åˆ é™¤å" + list);
    }
}

```

**è¿è¡Œç»“æœï¼š**
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/89bf1d9da8a590d47989f4a9e3993fe0.png)

#### â˜ƒï¸è¿­ä»£å™¨éå†ä¸­è°ƒç”¨é›†åˆrevome()æ–¹æ³•è§¦å‘å¼‚å¸¸

åœ¨Javaé›†åˆä¸­ï¼Œä»¥é›†åˆ
`ArrayList`
ä¸ºä¾‹ï¼Œåœ¨ä½¿ç”¨ä¸­å¯èƒ½ä¼šé‡åˆ°åˆ é™¤çš„éœ€æ±‚åœºæ™¯ï¼Œæ­¤æ—¶å¦‚æœä»£ç ä¹¦å†™ä¸å½“ï¼Œææœ‰å¯èƒ½ä¼šæŠ›å‡º
`java.util.ConcurrentModificationException`
å¼‚å¸¸ä¿¡æ¯ã€‚
  
åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ç”¨
`Iterator`
è°ƒç”¨äº†è¿­ä»£å™¨
`remove()`
æ–¹æ³•ï¼Œå¦‚æœåœ¨ä½¿ç”¨ä¸­ä¸å°å¿ƒè°ƒç”¨äº†é›†åˆä¸­çš„
`remove()`
æ–¹æ³•ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

```java
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
@SuppressWarnings({"all"})
public class TestDemo {
    public static void main(String[] args) {
        List<Integer> list = new ArrayList<>();
        list.add(111);
        list.add(222);
        list.add(333);

        System.out.println("åˆ é™¤å‰:" + list);
        Iterator<Integer> iterator = list.iterator();
        while (iterator.hasNext()) {
            Integer value =  iterator.next();
            if(value == 111) list.remove(Integer.valueOf(111));
        }
        System.out.println("åˆ é™¤å" + list);
    }
}


```

**è¿è¡Œç»“æœï¼š**
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/836ed7e76786f0621313f3768e5225af.png)
  
è¿è¡Œç»“æœä¸­æŠ›å‡º
`java.util.ConcurrentModificationException`
å¼‚å¸¸ä¿¡æ¯ã€‚è¿™æ˜¯å› ä¸ºè§¦å‘äº†
é›†åˆä¸­å¹¶å‘ä¿®æ”¹çš„å¼‚å¸¸
æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡æºç å¯¹æŠ›å‡ºå¼‚å¸¸çš„åŸå› è¿›è¡Œå‰–æã€‚

```java
    public Iterator<E> iterator() {
        return new Itr();
    }

```

åœ¨
`ArrayList`
é›†åˆçš„
`Iterator`
æ–¹æ³•ä¸­ï¼Œæ˜¯é€šè¿‡è¿”å›
`Itr`
å¯¹è±¡æ¥è·å¾—è¿­ä»£å™¨çš„ã€‚
`Itr`
æ˜¯
`ArrayList`
çš„ä¸€ä¸ª
å†…éƒ¨ç±»
ï¼Œå®ƒå®ç°äº†
`Iterator`
æ¥å£ï¼Œ
*ä»£ç å¦‚ä¸‹ï¼š*

```java
   private class Itr implements Iterator<E> {
        int cursor;       // index of next element to return
        int lastRet = -1; // index of last element returned; -1 if no such
        int expectedModCount = modCount;

        Itr() {}

        public boolean hasNext() {
            return cursor != size;
        }

        @SuppressWarnings("unchecked")
        public E next() {
            checkForComodification();
            int i = cursor;
            if (i >= size)
                throw new NoSuchElementException();
            Object[] elementData = ArrayList.this.elementData;
            if (i >= elementData.length)
                throw new ConcurrentModificationException();
            cursor = i + 1;
            return (E) elementData[lastRet = i];
        }

        public void remove() {
            if (lastRet < 0)
                throw new IllegalStateException();
            checkForComodification();

            try {
                ArrayList.this.remove(lastRet);
                cursor = lastRet;
                lastRet = -1;
                expectedModCount = modCount;
            } catch (IndexOutOfBoundsException ex) {
                throw new ConcurrentModificationException();
            }
        }

```

**Itrç±»å±æ€§**

| å±æ€§ | å«ä¹‰ |
| --- | --- |
| cursor | ç´¢å¼•ä¸‹æ ‡ï¼Œè¡¨ç¤ºä¸‹ä¸€ä¸ªå¯ä»¥è®¿é—®çš„å…ƒç´ çš„ç´¢å¼•ï¼Œé»˜è®¤å€¼ä¸º **0** |
| lastRet | ç´¢å¼•ä¸‹æ ‡ï¼Œè¡¨ç¤ºä¸Šä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œé»˜è®¤å€¼ä¸º **-1** |
| expectedModCount | å¯¹é›†åˆä¿®æ”¹çš„ç‰ˆæœ¬å·ï¼Œåˆå§‹å€¼ä¸º **ModCount** |

ModCountå®šä¹‰åœ¨AbstractListæ¥å£ä¸­ï¼Œåˆå§‹å€¼ä¸º
**0**
ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š

```java
 protected transient int modCount = 0;

```

ModCountæ˜¯ç‰ˆæœ¬å·ï¼Œåœ¨å¯¹é›†åˆè¿›è¡Œå˜æ›´æ“ä½œï¼ˆå¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ç­‰ï¼‰çš„æ—¶å€™ä¼šå¯¹ç‰ˆæœ¬å·è¿›è¡Œ
**+1**
æ“ä½œã€‚

---

ç»“åˆä¸Šè¿°ä»£ç è¿›è¡ŒæŠ›å‡º
`java.util.ConcurrentModificationException`
å¼‚å¸¸çš„è§£é‡Šã€‚
  
â‘ åˆå§‹åŒ–ArrayListï¼Œæ·»åŠ ä¸‰æ¬¡å…ƒç´ ï¼Œå³ä¸‰æ¬¡è°ƒç”¨
`add()`
æ–¹æ³•ï¼Œè¿›è¡Œä¸‰æ¬¡
`modCount++;`
æ­¤æ—¶ï¼Œ

m
o
d
C
o
u
n
t
=
3
ï¼Œ
s
i
z
e
=
3
ï¼›
\color{red}{modCount = 3ï¼Œsize = 3ï¼›}






m

o

d

C

o

u

n

t



=



3

ï¼Œ

s

i

z

e



=



3

ï¼›
  
â‘¡åˆå§‹åŒ–Iteratorè¿­ä»£å™¨è¿›è¡Œå¾ªç¯ï¼Œæ­¤æ—¶ï¼Œ

e
x
p
e
c
t
e
d
M
o
d
C
o
u
n
t
=
m
o
d
C
o
u
n
t
=
3
ï¼Œ
\color{red}{expectedModCount = modCount=3ï¼Œ}






e

x

p

e

c

t

e

d

M

o

d

C

o

u

n

t



=



m

o

d

C

o

u

n

t



=



3

ï¼Œ



c
u
r
s
o
r
=
0
ï¼Œ
l
a
s
t
R
e
t
=
âˆ’
1
\color{red}{cursor=0ï¼ŒlastRet = -1}






c

u

r

s

o

r



=



0

ï¼Œ

l

a

s

t

R

e

t



=



âˆ’

1
  
â‘¢è¿›è¡ŒhasNextåˆ¤æ–­ï¼Œ
`cursor != size;`
æˆç«‹ï¼Œè¿›å…¥å¾ªç¯
  
â‘£è°ƒç”¨
`next()`
æ–¹æ³•ï¼Œé¦–å…ˆè¿›è¡Œ
`checkForComodification()`
æ ¡éªŒï¼Œ

m
o
d
C
o
u
n
t
=
=
e
x
p
e
c
t
e
d
M
o
d
C
o
u
n
t
\color{red}{modCount == expectedModCount}






m

o

d

C

o

u

n

t



=

=



e

x

p

e

c

t

e

d

M

o

d

C

o

u

n

t
ï¼Œæ ¡éªŒé€šè¿‡ï¼Œè¿”å›å€¼ï¼Œæ­¤æ—¶

l
a
s
t
R
e
t
=
0
;
c
u
r
s
o
r
=
1
\color{red}{lastRet = 0;cursor = 1}






l

a

s

t

R

e

t



=



0

;



c

u

r

s

o

r



=



1

```java
 final void checkForComodification() {
            if (modCount != expectedModCount)
                throw new ConcurrentModificationException();
        }

```

â‘¤è°ƒç”¨é›†åˆ
`remove()`
æ–¹æ³•ï¼Œ
`modCount++ï¼›`
ï¼Œæ­¤æ—¶

m
o
d
C
o
u
n
t
=
4
;
s
i
z
e
=
2
\color{red}{modCount = 4;size = 2}






m

o

d

C

o

u

n

t



=



4

;



s

i

z

e



=



2
  
â‘¥å†æ¬¡è°ƒç”¨hasNext()æ–¹æ³•åˆ¤æ–­ï¼Œ
`cursor != size;`
æˆç«‹ï¼Œè¿›å…¥å¾ªç¯
  
â‘¦è°ƒç”¨
`next()`
æ–¹æ³•è¿›è¡Œæ ¡éªŒï¼Œ

m
o
d
C
o
u
n
t
!
=
e
x
p
e
c
t
e
d
M
o
d
C
o
u
n
t
\color{red}{modCount != expectedModCount}






m

o

d

C

o

u

n

t

!



=



e

x

p

e

c

t

e

d

M

o

d

C

o

u

n

t
ï¼Œæ ¡éªŒæœªé€šè¿‡ï¼ŒæŠ›å‡º
`java.util.ConcurrentModificationException`
å¼‚å¸¸

**æ€»ç»“ï¼š**

> â‘ åœ¨ä½¿ç”¨
> è¿­ä»£å™¨
> çš„
> `remove()`
> æ“ä½œæ—¶ï¼Œä¼šå°†æ›´æ–°åçš„
> `modCount`
> ç»™
> `expectedModCount`
> ï¼Œä¸¤è€…ä¼šå¾—åˆ°åŒæ­¥ï¼Œä½†æ˜¯åœ¨è°ƒç”¨é›†åˆçš„
> `remove()`
> æ–¹æ³•åï¼Œä¸¤ä¸ªä¸ä¼šè¿›è¡ŒåŒæ­¥ï¼Œè¿›è€Œå¯¼è‡´åœ¨
> `checkForComodification()`
> æ ¡éªŒæ—¶ä¸é€šè¿‡ï¼ŒæŠ›å‡º
> `java.util.ConcurrentModificationException`
> å¼‚å¸¸ã€‚
>   
> â‘¡æ‰€ä»¥ï¼Œåœ¨å•çº¿ç¨‹ä¸‹ä½¿ç”¨è¿­ä»£å™¨æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ä¸‹åŒæ—¶æ“ä½œé›†åˆå°±ä¸å…è®¸äº†ï¼Œå¯ä»¥é€šè¿‡
> **fail-fast**
> å¿«é€Ÿå¤±è´¥æœºåˆ¶ï¼Œå¿«é€Ÿåˆ¤æ–­æ˜¯å¦å­˜åœ¨åŒæ—¶æ“ä½œé—®é¢˜ã€‚å› æ­¤ï¼Œ
> é›†åˆåœ¨å¤šçº¿ç¨‹ä¸‹ä½¿ç”¨æ˜¯ä¸å®‰å…¨çš„
> ã€‚

### ğŸ“—å¢å¼ºforå¾ªç¯

#### ğŸ“«è®¤è¯†å¢å¼ºforå¾ªç¯

> `å¢å¼ºforå¾ªç¯`
> å¯ä»¥ä»£æ›¿
> Iteratorè¿­ä»£å™¨
> ï¼Œå¯ä»¥æŠŠå®ƒçœ‹åšç®€åŒ–ç‰ˆçš„Iteratorï¼Œå’Œè¿­ä»£å™¨æœ¬è´¨ä¸€æ ·ï¼Œå…¶å®å®ƒçš„åº•å±‚å®ç°å°±æ˜¯Iteratorè¿­ä»£å™¨ï¼Œåªèƒ½ç”¨äº
> éå†é›†åˆæˆ–æ•°ç»„
> ã€‚

#### ğŸ“ªåŸºæœ¬è¯­æ³•

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/80e05a43aa84c98b2ec8f29aa76b5e64.png)

#### ğŸ“¬å¢å¼ºforå¾ªç¯çš„ä½¿ç”¨

```java
import java.util.ArrayList;
import java.util.List;

public class TestDemo03 {
    public static void main(String[] args) {
        List<Integer> list = new ArrayList<>();
        list.add(111);
        list.add(222);
        list.add(333);

        System.out.println("====å¢å¼ºforå¾ªç¯éå†é›†åˆ====");
        for(Integer i : list) {
            System.out.print(i + " ");
        }
        System.out.println();

        System.out.println("====å¢å¼ºforå¾ªç¯éå†æ•°ç»„====");
        int[] arr = {1,2,3,4,5,6};
        for (int i : arr) {
            System.out.print(i + " ");
        }

    }
}


```

**è¿è¡Œç»“æœï¼š**
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/0415173fee40886edff894660d9cb6f8.png)

#### ğŸ“­å¢å¼ºforå¾ªç¯çš„å¿«æ·é”®

ä¸è¿­ä»£å™¨ä¸€æ ·ï¼Œå¢å¼ºforå¾ªç¯ä¹Ÿæœ‰å¿«æ·é”®ï¼Œè¾“å…¥
`I`
å›è½¦å³å¯å¿«é€Ÿç”Ÿæˆã€‚
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/7bdf6867108dd8856e7ae2c1f6c60982.gif)