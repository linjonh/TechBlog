---
layout: post
title: "微信小程序云开发多个云函数共享依赖库解决方案之一"
date: 2024-08-20 02:33:33 +0800
description: "小程序云函数开发时，每个函数单独部署，当引入共享依赖（如引用 ../../common/util.j"
keywords: "两个小程序使用一个云函数"
categories: ['编码', '手记']
tags: ['小程序', '前端', '云开发', 'Git']
artid: "115407581"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=115407581
    alt: "微信小程序云开发多个云函数共享依赖库解决方案之一"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=115407581
featuredImagePreview: https://bing.ee123.net/img/rand?artid=115407581
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微信小程序云开发多个云函数共享依赖库解决方案之一
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     小程序云函数开发时，每个函数单独部署，当引入共享依赖（如引用
     <span style="color:#f33b45;">
      ../../common/util.js
     </span>
     ）时，部署的时候IDE并不会帮你上传相关文件，只会上传本函数文件夹下的文件。
    </p>
    <p>
     搜了一下看到这个帖子：
     <a href="https://developers.weixin.qq.com/community/develop/doc/0006e808c94e80b848672c2e056000" rel="nofollow">
      https://developers.weixin.qq.com/community/develop/doc/0006e808c94e80b848672c2e056000
     </a>
     啊哈哈，3年了并未解决。
    </p>
    <p>
     我尝试使用了
     <span style="color:#f33b45;">
      git submodule
     </span>
     来解决，在操作复杂程度上还可以接受吧。高端操作可以去尝试打包 npm 包，哈哈。
    </p>
    <p>
     前提：小程序项目已经使用 git 来管理了，没使用的得初始化一下。
    </p>
    <h3>
     <strong>
      下面为操作与测试过程
     </strong>
    </h3>
    <p>
     我使用的是微信的代码托管
     <a href="https://git.weixin.qq.com" rel="nofollow">
      https://git.weixin.qq.com
     </a>
    </p>
    <p>
     1、为共享的依赖库新建一个 git 项目，并增加一些内容。
    </p>
    <p>
     我新建的仓为
     <span style="color:#86ca5e;">
      git@git.weixin.qq.com:taills/wx-cloud-functions-common.git
     </span>
    </p>
    <p>
     内有测试文件 util.js，文件内容如下：
    </p>
    <pre><code class="language-javascript">function add(a,b){
  return a + b
}
function getTimestamp(){
  return (new Date()).getTime()
}

module.exports = {
  add : add,
  getTimestamp: getTimestamp
}</code></pre>
    <p>
    </p>
    <p>
     2、在小程序中新建 2 个云函数，我新建的云函数为
     <span style="color:#e579b6;">
      orderAdmin
     </span>
     、
     <span style="color:#e579b6;">
      userCenter
     </span>
     ，如图：
    </p>
    <p>
     <img alt="" height="690" src="https://i-blog.csdnimg.cn/blog_migrate/62fd280e013b9f00e0ac482802fac2e5.png" width="704"/>
    </p>
    <p>
     3、为两个函数增加 git module ，云函数多可自己重复以下操作即可。
    </p>
    <pre><code class="language-bash">git submodule add git@git.weixin.qq.com:taills/wx-cloud-functions-common.git cloudfunctions/userCenter/common

git submodule add git@git.weixin.qq.com:taills/wx-cloud-functions-common.git cloudfunctions/orderAdmin/common</code></pre>
    <p>
     4、保存更改。
    </p>
    <pre><code class="language-bash">git add .
git commit -am 'add cloud functions'</code></pre>
    <p>
     5、修改
     <span style="color:#86ca5e;">
      wx-cloud-functions-common.git
     </span>
     项目内容并push，如增加 readme 等等，做为测试。
    </p>
    <p>
    </p>
    <p>
     6、更新小程序所有云函数下的公共函数库，结果如图
    </p>
    <pre><code class="language-bash">git submodule foreach git pull</code></pre>
    <p>
     <img alt="" height="696" src="https://i-blog.csdnimg.cn/blog_migrate/952d89877ab22cfb57f64df2215a700b.png" width="836"/>
    </p>
    <p>
     7、这样操作之后，公共依赖库就可以统一管理了。
    </p>
    <p>
     当某个云函数下 common 有更改了，把它 commit &amp; push 后，执行第6步操作，就可以把更改同步到其他云函数当中，也可以多人、多项目公用。
    </p>
    <p>
    </p>
    <p>
     8、函数调用测试。
    </p>
    <p>
     <img alt="" height="1086" src="https://i-blog.csdnimg.cn/blog_migrate/d4e37039bbd8e9331914b200fd4410b1.png" width="1200"/>
    </p>
    <p>
    </p>
    <p>
     <img alt="" height="336" src="https://i-blog.csdnimg.cn/blog_migrate/4df0656d7f91da599672e574bcbffce1.png" width="950"/>
    </p>
    <p>
    </p>
    <p>
     9、小程序代码仓库显示为
    </p>
    <p>
     <img alt="" height="654" src="https://i-blog.csdnimg.cn/blog_migrate/bd229a6f803270e4dde31a75dbd84219.png" width="1200"/>
    </p>
    <p>
     小程序的仓库本身并不存储 公共依赖库的文件，只存储了一个链接。当 clone 小程序代码后，需要执行第 6 步，把 submodule 都拉下来。
    </p>
    <p>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34353931393631362f:61727469636c652f64657461696c732f313135343037353831" class_="artid" style="display:none">
 </p>
</div>


