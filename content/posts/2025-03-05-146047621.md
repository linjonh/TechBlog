---
layout: post
title: "16.-断言SVA立即断言并发断言"
date: 2025-03-05 17:39:12 +0800
description: "立即断言适用于组合逻辑的即时检查，并发断言擅长时序协议监控。关键技巧为并发断言显式指定时钟使用|->（重叠蕴含）和|=>（非重叠蕴含）区分时序关系结合覆盖率分析断言触发场景通过合理使用SVA，可显著提高验证效率和设计可靠性。"
keywords: "16. 断言(SVA)：立即断言/并发断言"
categories: ['Uvm']
tags: ['测试用例', '学习', 'Verilog', 'Uvm', 'Sv']
artid: "146047621"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146047621
    alt: "16.-断言SVA立即断言并发断言"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146047621
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146047621
cover: https://bing.ee123.net/img/rand?artid=146047621
image: https://bing.ee123.net/img/rand?artid=146047621
img: https://bing.ee123.net/img/rand?artid=146047621
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     16. 断言(SVA)：立即断言/并发断言
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <hr/>
    <h2>
     <a id="_4">
     </a>
     前言
    </h2>
    <p>
     以下是SystemVerilog断言(SVA)的详细解析，包含立即断言与并发断言的核心概念、实现方式、应用场景及完整仿真示例：
    </p>
    <hr/>
    <h2>
     <a id="_10">
     </a>
     一、断言类型对比
    </h2>
    <ol>
     <li>
      <strong>
       立即断言（Immediate Assertions）
      </strong>
      <ul>
       <li>
        <strong>
         概念
        </strong>
        ：立即断言在过程块（如
        <code>
         always
        </code>
        、
        <code>
         initial
        </code>
        ）中直接执行，当代码执行到该行时立即检查条件是否成立，
        <strong>
         无需依赖时钟信号
        </strong>
        。
       </li>
       <li>
        <strong>
         通俗理解
        </strong>
        ：就像在代码中临时插入一个“检查点”，只要执行到这里，就立刻验证某个条件是否满足。
       </li>
       <li>
        <strong>
         示例
        </strong>
        ：
       </li>
      </ul>
     </li>
    </ol>
    <pre><code class="prism language-c">     always_comb begin
       assert_handshake<span class="token operator">:</span> <span class="token function">assert</span> <span class="token punctuation">(</span>req <span class="token operator">-&gt;</span> ack<span class="token punctuation">)</span> <span class="token keyword">else</span> $<span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"握手失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     end
</code></pre>
    <p>
     <em>
      当
      <code>
       req
      </code>
      信号有效时，必须立即检测
      <code>
       ack
      </code>
      是否有效，否则报错
     </em>
     。
    </p>
    <ol start="2">
     <li>
      <strong>
       并发断言（Concurrent Assertions）
      </strong>
      <ul>
       <li>
        <strong>
         概念
        </strong>
        ：基于时钟周期检查时序逻辑，跨周期验证属性（如信号序列），需通过
        <code>
         property
        </code>
        和
        <code>
         assert property
        </code>
        定义。
       </li>
       <li>
        <strong>
         通俗理解
        </strong>
        ：像一个“定时监控器”，在时钟边沿触发检查，确保信号在时间轴上符合预期。
       </li>
       <li>
        <strong>
         示例
        </strong>
        ：
       </li>
      </ul>
     </li>
    </ol>
    <pre><code class="prism language-c">     property p_data_stable<span class="token punctuation">;</span>
       @<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span> disable <span class="token function">iff</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> $<span class="token function">stable</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
     endproperty
     assert_data<span class="token operator">:</span> assert <span class="token function">property</span> <span class="token punctuation">(</span>p_data_stable<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <em>
      每个时钟上升沿检查
      <code>
       data
      </code>
      是否稳定（除非复位）
     </em>
     。
    </p>
    <table>
     <thead>
      <tr>
       <th>
        <strong>
         类型
        </strong>
       </th>
       <th>
        <strong>
         立即断言
        </strong>
       </th>
       <th>
        <strong>
         并发断言
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         触发时机
        </strong>
       </td>
       <td>
        在程序执行到该语句时立即检查
       </td>
       <td>
        持续监控信号，与时钟同步
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         适用场景
        </strong>
       </td>
       <td>
        组合逻辑条件检查
       </td>
       <td>
        时序逻辑检查（跨时钟周期）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         语法结构
        </strong>
       </td>
       <td>
        <code>
         assert (condition)
        </code>
       </td>
       <td>
        <code>
         assert property (@(event) sequence)
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         仿真行为
        </strong>
       </td>
       <td>
        类似普通if判断
       </td>
       <td>
        生成状态机监控信号
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         错误报告
        </strong>
       </td>
       <td>
        立即报错
       </td>
       <td>
        在时钟边沿报错
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h2>
     <a id="_47">
     </a>
     二、立即断言详解
    </h2>
    <h3>
     <a id="1__48">
     </a>
     1. 概念与通俗理解
    </h3>
    <ul>
     <li>
      <strong>
       作用
      </strong>
      ：在代码执行到断言位置时立即检查条件，类似“岗亭检查员”。
     </li>
     <li>
      <strong>
       示例
      </strong>
      ：检查FIFO写操作时，写指针是否超过深度限制。
     </li>
    </ul>
    <h3>
     <a id="2__52">
     </a>
     2. 实现方式
    </h3>
    <p>
     <strong>
      立即断言实现
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       语法
      </strong>
      ：
      <code>
       assert (条件) [else 动作]
      </code>
      ，可嵌入过程块中。
     </li>
     <li>
      <strong>
       通俗理解
      </strong>
      ：类似软件中的
      <code>
       if
      </code>
      检查，但失败时会触发仿真错误。
     </li>
     <li>
      <strong>
       示例
      </strong>
      ：
     </li>
    </ul>
    <pre><code class="prism language-c">     always @<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span> begin
       <span class="token keyword">if</span> <span class="token punctuation">(</span>start<span class="token punctuation">)</span> begin
         <span class="token function">assert</span> <span class="token punctuation">(</span>data_valid<span class="token punctuation">)</span> <span class="token keyword">else</span> $<span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"启动时数据无效"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       end
     end
</code></pre>
    <p>
     <em>
      启动时若
      <code>
       data_valid
      </code>
      无效则报错
     </em>
     。
    </p>
    <pre><code class="prism language-c">always_comb begin
    <span class="token comment">// 立即断言：检查写指针不越界</span>
    <span class="token function">assert</span> <span class="token punctuation">(</span>wr_ptr <span class="token operator">&lt;</span> FIFO_DEPTH<span class="token punctuation">)</span> 
    <span class="token keyword">else</span> $<span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Write pointer overflow!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
end
</code></pre>
    <h3>
     <a id="3__74">
     </a>
     3. 应用场景
    </h3>
    <p>
     <strong>
      立即断言适用场景
     </strong>
    </p>
    <ul>
     <li>
      <p>
       <strong>
        组合逻辑检查
       </strong>
       ：如输入信号约束（
       <code>
        if (a &gt; 0) assert (b != 0)
       </code>
       ）。
      </p>
     </li>
     <li>
      <p>
       <strong>
        实时错误捕捉
       </strong>
       ：如握手协议的非时序性检查。
      </p>
     </li>
     <li>
      <p>
       <strong>
        组合逻辑检查
       </strong>
       ：输入信号合法性检查
      </p>
     </li>
    </ul>
    <pre><code class="prism language-c">  <span class="token function">assert</span> <span class="token punctuation">(</span>a <span class="token operator">!=</span> b<span class="token punctuation">)</span> <span class="token keyword">else</span> $<span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"a and b cannot be equal!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      <strong>
       仿真调试
      </strong>
      ：快速定位明显错误
     </li>
    </ul>
    <pre><code class="prism language-c">  <span class="token function">assert</span> <span class="token punctuation">(</span>data <span class="token operator">!=</span><span class="token operator">=</span> 'x<span class="token punctuation">)</span> <span class="token keyword">else</span> $<span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">"Data is undefined!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="4__88">
     </a>
     4. 常见误区
    </h3>
    <p>
     <strong>
      立即断言误用
     </strong>
    </p>
    <ul>
     <li>
      <p>
       <strong>
        误区
       </strong>
       ：在时序逻辑中使用立即断言，导致竞争条件（如未同步到时钟边沿）。
      </p>
     </li>
     <li>
      <p>
       <strong>
        正确做法
       </strong>
       ：仅用于组合逻辑或非时钟依赖的检查。
      </p>
     </li>
     <li>
      <p>
       <strong>
        组合逻辑环路
       </strong>
       ：断言条件影响被检查信号
      </p>
     </li>
    </ul>
    <pre><code class="prism language-c">  <span class="token comment">// 错误示例：可能导致组合环路</span>
  always_comb begin
      <span class="token function">assert</span> <span class="token punctuation">(</span>data <span class="token operator">==</span> processed_data<span class="token punctuation">)</span> <span class="token keyword">else</span> data <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  end
</code></pre>
    <hr/>
    <h2>
     <a id="_104">
     </a>
     三、并发断言详解
    </h2>
    <h3>
     <a id="1__105">
     </a>
     1. 概念与通俗理解
    </h3>
    <ul>
     <li>
      <strong>
       作用
      </strong>
      ：持续监控信号时序关系，类似“交通摄像头”。
     </li>
     <li>
      <strong>
       示例
      </strong>
      ：检查AXI握手信号
      <code>
       VALID
      </code>
      与
      <code>
       READY
      </code>
      的时序关系。
     </li>
    </ul>
    <h3>
     <a id="2__109">
     </a>
     2. 实现方式
    </h3>
    <p>
     <strong>
      并发断言实现
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       步骤
      </strong>
      ：
      <ol>
       <li>
        定义
        <code>
         sequence
        </code>
        描述时序事件；
       </li>
       <li>
        通过
        <code>
         property
        </code>
        封装序列和触发条件；
       </li>
       <li>
        用
        <code>
         assert property
        </code>
        绑定属性。
       </li>
      </ol>
     </li>
     <li>
      <strong>
       示例
      </strong>
      ：
     </li>
    </ul>
    <pre><code class="prism language-c">     sequence s_ack_delay<span class="token punctuation">;</span>
       req ##<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span> ack<span class="token punctuation">;</span>
     endsequence
     property p_ack_valid<span class="token punctuation">;</span>
       @<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span> req <span class="token operator">|</span><span class="token operator">-&gt;</span> s_ack_delay<span class="token punctuation">;</span>
     endproperty
     assert_ack<span class="token operator">:</span> assert <span class="token function">property</span> <span class="token punctuation">(</span>p_ack_valid<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <em>
      请求
      <code>
       req
      </code>
      发出后，1~3周期内必须收到应答
      <code>
       ack
      </code>
     </em>
     。
    </p>
    <pre><code class="prism language-c"><span class="token comment">// 并发断言：AXI协议握手检查</span>
property axi_handshake<span class="token punctuation">;</span>
    @<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span> 
    $<span class="token function">rose</span><span class="token punctuation">(</span>valid<span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">-&gt;</span> ##<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">]</span> $<span class="token function">rose</span><span class="token punctuation">(</span>ready<span class="token punctuation">)</span><span class="token punctuation">;</span>
endproperty
assert <span class="token function">property</span> <span class="token punctuation">(</span>axi_handshake<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="3__136">
     </a>
     3. 应用场景
    </h3>
    <p>
     <strong>
      并发断言适用场景
     </strong>
    </p>
    <ul>
     <li>
      <p>
       <strong>
        协议验证
       </strong>
       ：如 AXI 总线中的时序序列检查（
       <code>
        addr
       </code>
       有效后
       <code>
        data
       </code>
       必须在指定周期内有效）。
      </p>
     </li>
     <li>
      <p>
       <strong>
        状态机监控
       </strong>
       ：确保状态转换符合预期（如状态
       <code>
        S1
       </code>
       必须跳转到
       <code>
        S2
       </code>
       而非
       <code>
        S3
       </code>
       ）。
      </p>
     </li>
     <li>
      <p>
       <strong>
        协议时序检查
       </strong>
       ：
      </p>
     </li>
    </ul>
    <pre><code class="prism language-c">  <span class="token comment">// AXI写响应必须在写请求后1-8周期返回</span>
  property axi_write_response<span class="token punctuation">;</span>
      @<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span>
      $<span class="token function">rose</span><span class="token punctuation">(</span>awvalid<span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">-&gt;</span> ##<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">]</span> $<span class="token function">rose</span><span class="token punctuation">(</span>bvalid<span class="token punctuation">)</span><span class="token punctuation">;</span>
  endproperty
</code></pre>
    <ul>
     <li>
      <strong>
       状态机跳转检查
      </strong>
      ：
     </li>
    </ul>
    <pre><code class="prism language-c">  <span class="token comment">// 状态机必须从IDLE跳转到WORK后再进入DONE</span>
  property fsm_transition<span class="token punctuation">;</span>
      @<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span>
      <span class="token punctuation">(</span>state <span class="token operator">==</span> IDLE<span class="token punctuation">)</span> <span class="token operator">|=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> WORK<span class="token punctuation">)</span> <span class="token operator">|=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> DONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
  endproperty
</code></pre>
    <h3>
     <a id="4__158">
     </a>
     4. 常见误区
    </h3>
    <p>
     <strong>
      并发断言陷阱
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       误区
      </strong>
      ：忽略多时钟域同步问题，导致断言误报。
     </li>
     <li>
      <strong>
       正确做法
      </strong>
      ：使用
      <code>
       synchronize
      </code>
      或
      <code>
       cross
      </code>
      处理跨时钟域信号。
     </li>
     <li>
      <strong>
       示例
      </strong>
      ：
     </li>
    </ul>
    <pre><code class="prism language-c">     property p_cross_clock<span class="token punctuation">;</span>
       @<span class="token punctuation">(</span>posedge clk1<span class="token punctuation">)</span> $<span class="token function">rose</span><span class="token punctuation">(</span>sig1<span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">-&gt;</span> ##<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span> @<span class="token punctuation">(</span>posedge clk2<span class="token punctuation">)</span> sig2<span class="token punctuation">;</span>
     endproperty
</code></pre>
    <p>
     <em>
      跨时钟域信号需明确时序窗口
     </em>
     。
    </p>
    <ul>
     <li>
      <strong>
       时钟域错误
      </strong>
      ：未正确指定采样时钟
     </li>
    </ul>
    <pre><code class="prism language-c">  <span class="token comment">// 错误：缺少时钟声明</span>
  property p<span class="token punctuation">;</span> a <span class="token operator">|</span><span class="token operator">-&gt;</span> b<span class="token punctuation">;</span> endproperty
</code></pre>
    <ul>
     <li>
      <strong>
       覆盖不全
      </strong>
      ：未考虑所有可能时序窗口
     </li>
    </ul>
    <pre><code class="prism language-c">  <span class="token comment">// 错误：仅检查最小延迟，未覆盖最大延迟</span>
  a <span class="token operator">|</span><span class="token operator">-&gt;</span> ##<span class="token number">2</span> b<span class="token punctuation">;</span>
</code></pre>
    <hr/>
    <h2>
     <a id="_183">
     </a>
     四、练习任务
    </h2>
    <h3>
     <a id="1FIFO_184">
     </a>
     任务1：FIFO满标志检查
    </h3>
    <pre><code class="prism language-c"><span class="token comment">// 当FIFO满时，写使能必须无效</span>
property fifo_full_check<span class="token punctuation">;</span>
    @<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span> 
    fifo_full <span class="token operator">|</span><span class="token operator">-&gt;</span> <span class="token operator">!</span>write_enable<span class="token punctuation">;</span>
endproperty
assert <span class="token function">property</span> <span class="token punctuation">(</span>fifo_full_check<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="2_194">
     </a>
     任务2：状态机合法跳转
    </h3>
    <pre><code class="prism language-c"><span class="token comment">// 状态机不能直接从IDLE跳转到ERROR</span>
property fsm_illegal_transition<span class="token punctuation">;</span>
    @<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span>
    <span class="token punctuation">(</span>state <span class="token operator">==</span> IDLE<span class="token punctuation">)</span> <span class="token operator">|=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>state <span class="token operator">!=</span> ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>
endproperty
assert <span class="token function">property</span> <span class="token punctuation">(</span>fsm_illegal_transition<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="3_204">
     </a>
     任务3：立即断言验证握手协议
    </h3>
    <ul>
     <li>
      <strong>
       要求
      </strong>
      ：当
      <code>
       req
      </code>
      拉高时，
      <code>
       ack
      </code>
      必须同一时刻拉高。
     </li>
     <li>
      <strong>
       代码
      </strong>
      ：
     </li>
    </ul>
    <pre><code class="prism language-c">  always_comb begin
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">)</span> begin
      assert_ack<span class="token operator">:</span> <span class="token function">assert</span> <span class="token punctuation">(</span>ack<span class="token punctuation">)</span> <span class="token keyword">else</span> $<span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"req激活时ack未响应"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    end
  end
</code></pre>
    <p>
     <em>
      错误示例：若
      <code>
       req
      </code>
      与
      <code>
       ack
      </code>
      有延迟，立即断言会误报
     </em>
     。
    </p>
    <h3>
     <a id="4_216">
     </a>
     任务4：并发断言验证数据稳定性
    </h3>
    <ul>
     <li>
      <strong>
       要求
      </strong>
      ：复位后，
      <code>
       data
      </code>
      需在 2 个周期内保持稳定。
     </li>
     <li>
      <strong>
       代码
      </strong>
      ：
     </li>
    </ul>
    <pre><code class="prism language-c">  property p_data_post_reset<span class="token punctuation">;</span>
    @<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span> disable <span class="token function">iff</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> 
    $<span class="token function">fell</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">-&gt;</span> ##<span class="token number">2</span> $<span class="token function">stable</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  endproperty
  assert_data<span class="token operator">:</span> assert <span class="token function">property</span> <span class="token punctuation">(</span>p_data_post_reset<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <em>
      复位结束后的两个周期内，
      <code>
       data
      </code>
      不得变化
     </em>
     。
    </p>
    <h3>
     <a id="5FIFO_228">
     </a>
     任务5：设计FIFO的并发断言‌
    </h3>
    <p>
     要求‌：检查FIFO满时push操作被阻塞。
     <br/>
     代码‌：
    </p>
    <pre><code class="prism language-c">property fifo_full_block_push<span class="token punctuation">;</span>  
	@<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span> fifo_full <span class="token operator">|</span><span class="token operator">-&gt;</span> <span class="token operator">!</span>fifo_push<span class="token punctuation">;</span>  <span class="token comment">// FIFO满时禁止push‌:ml-citation{ref="2" data="citationList"}  </span>
endproperty  
assert <span class="token function">property</span> <span class="token punctuation">(</span>fifo_full_block_push<span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre>
    <p>
     解析‌：通过
     <code>
      |-&gt;
     </code>
     确保条件成立时后续动作符合预期。
    </p>
    <hr/>
    <h2>
     <a id="_241">
     </a>
     五、完整仿真示例
    </h2>
    <h3>
     <a id="ack_242">
     </a>
     示例一：寄存器ack检查
    </h3>
    <h4>
     <a id="1__243">
     </a>
     1. 代码示例
    </h4>
    <pre><code class="prism language-c">module sva_demo<span class="token punctuation">;</span>
    bit clk<span class="token punctuation">;</span>
    logic req<span class="token punctuation">,</span> ack<span class="token punctuation">;</span>
    
    <span class="token comment">// 时钟生成</span>
    always #<span class="token number">5</span> clk <span class="token operator">=</span> <span class="token operator">~</span>clk<span class="token punctuation">;</span>
    
    <span class="token comment">// 并发断言：req拉高后ack必须在1-3周期内响应</span>
    property req_ack_check<span class="token punctuation">;</span>
        @<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span> 
        $<span class="token function">rose</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">-&gt;</span> ##<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span> $<span class="token function">rose</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span><span class="token punctuation">;</span>
    endproperty
    assert <span class="token function">property</span> <span class="token punctuation">(</span>req_ack_check<span class="token punctuation">)</span> <span class="token keyword">else</span> $<span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"ACK timeout!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 测试逻辑</span>
    initial begin
        <span class="token comment">// 正常场景</span>
        #<span class="token number">10</span> req <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        #<span class="token number">10</span> ack <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 2周期后响应（符合要求）</span>
        #<span class="token number">20</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 异常场景</span>
        req <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ack <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        #<span class="token number">10</span> req <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        #<span class="token number">40</span> ack <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 4周期后响应（触发断言报错）</span>
        #<span class="token number">20</span> $finish<span class="token punctuation">;</span>
    end
endmodule
</code></pre>
    <h4>
     <a id="2__275">
     </a>
     2. 仿真指令
    </h4>
    <pre><code class="prism language-bash">xrun <span class="token parameter variable">-sv</span> sva_demo.sv <span class="token parameter variable">-access</span> +rw <span class="token parameter variable">-coverage</span> all
</code></pre>
    <h4>
     <a id="3__280">
     </a>
     3. 预期输出
    </h4>
    <pre><code class="prism language-c">Error<span class="token operator">:</span> Assertion <span class="token char">'req_ack_check'</span> failed at <span class="token number">65</span>ns
</code></pre>
    <h3>
     <a id="xrun_285">
     </a>
     示例二：完整示例与xrun仿真
    </h3>
    <h4>
     <a id="1__286">
     </a>
     1. 代码示例
    </h4>
    <p>
     <strong>
      代码示例
     </strong>
     ：
    </p>
    <pre><code class="prism language-c">module <span class="token function">sva_demo</span> <span class="token punctuation">(</span>
  input logic clk<span class="token punctuation">,</span> reset<span class="token punctuation">,</span> req<span class="token punctuation">,</span> ack<span class="token punctuation">,</span>
  input logic <span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> data
<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 立即断言：检查握手信号</span>
  always_comb begin
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">)</span> begin
      assert_handshake<span class="token operator">:</span> <span class="token function">assert</span> <span class="token punctuation">(</span>ack<span class="token punctuation">)</span> <span class="token keyword">else</span> $<span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Error: ack未响应"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    end
  end

  <span class="token comment">// 并发断言：检查复位后数据稳定</span>
  property p_data_stable<span class="token punctuation">;</span>
    @<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span> disable <span class="token function">iff</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> 
    $<span class="token function">fell</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">-&gt;</span> ##<span class="token number">2</span> $<span class="token function">stable</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  endproperty
  assert_data<span class="token operator">:</span> assert <span class="token function">property</span> <span class="token punctuation">(</span>p_data_stable<span class="token punctuation">)</span><span class="token punctuation">;</span>

endmodule
</code></pre>
    <h4>
     <a id="2__311">
     </a>
     2. 仿真步骤
    </h4>
    <ol>
     <li>
      <strong>
       编译与仿真命令
      </strong>
      ：
     </li>
    </ol>
    <pre><code class="prism language-bash">   xrun <span class="token parameter variable">-sv</span> sva_demo.sv <span class="token parameter variable">-access</span> +rwc <span class="token parameter variable">-coverage</span> all
</code></pre>
    <p>
     <em>
      启用代码覆盖率和断言检查
     </em>
     。
    </p>
    <ol start="2">
     <li>
      <strong>
       查看结果
      </strong>
      ：
      <ul>
       <li>
        断言失败时，日志会输出
        <code>
         $error
        </code>
        信息。
       </li>
       <li>
        覆盖率报告（如
        <code>
         imc
        </code>
        工具）可显示断言触发情况。
       </li>
      </ul>
     </li>
    </ol>
    <h3>
     <a id="FIFO_323">
     </a>
     示例三：设计FIFO空满保护断言
    </h3>
    <h4>
     <a id="1__324">
     </a>
     1. 代码示例
    </h4>
    <pre><code class="prism language-c">module <span class="token function">fifo_assertions</span><span class="token punctuation">(</span>
    input clk<span class="token punctuation">,</span> rst_n<span class="token punctuation">,</span>
    input wr_en<span class="token punctuation">,</span> rd_en<span class="token punctuation">,</span>
    input <span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> wdata<span class="token punctuation">,</span> rdata<span class="token punctuation">,</span>
    input full<span class="token punctuation">,</span> empty
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 立即断言：写满时禁止写入</span>
always @<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span> begin
    <span class="token keyword">if</span> <span class="token punctuation">(</span>full<span class="token punctuation">)</span> begin
        <span class="token function">assert</span> <span class="token punctuation">(</span><span class="token operator">!</span>wr_en<span class="token punctuation">)</span> <span class="token keyword">else</span> $<span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"满状态写入!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    end
end

<span class="token comment">// 并发断言：连续写不越界</span>
property p_write_flow<span class="token punctuation">;</span>
    @<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span> disable <span class="token function">iff</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span>
    wr_en <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>full <span class="token operator">|=</span><span class="token operator">&gt;</span> <span class="token operator">!</span>full until rd_en<span class="token punctuation">;</span>
endproperty
assert <span class="token function">property</span><span class="token punctuation">(</span>p_write_flow<span class="token punctuation">)</span><span class="token punctuation">;</span>

endmodule
</code></pre>
    <h4>
     <a id="2__350">
     </a>
     2. 仿真验证
    </h4>
    <ol>
     <li>
      文件结构
     </li>
    </ol>
    <pre><code>    fifo_assertions.sv    # 断言模块
    tb_fifo.sv            # 测试平台
</code></pre>
    <ol start="2">
     <li>
      使用xrun仿真：
     </li>
    </ol>
    <pre><code class="prism language-bash">
xrun <span class="token parameter variable">-64bit</span> <span class="token parameter variable">-access</span> +rwc <span class="token punctuation">\</span>
    <span class="token parameter variable">-sv</span> fifo_assertions.sv tb_fifo.sv <span class="token punctuation">\</span>
    +define+ASSERT_ON <span class="token punctuation">\</span>
    <span class="token parameter variable">-covoverwrite</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">-nowarn</span> UEXPSC
</code></pre>
    <ol start="3">
     <li>
      典型输出解析：
     </li>
    </ol>
    <pre><code class="prism language-c">Assertion failed<span class="token operator">:</span> fifo_assertions<span class="token punctuation">.</span>p_write_flow
  Time<span class="token operator">:</span> <span class="token number">550</span>ns  Scope<span class="token operator">:</span> tb_fifo<span class="token punctuation">.</span>fifo_assertions
</code></pre>
    <p>
     表示在550ns时检测到写操作越界
    </p>
    <hr/>
    <h2>
     <a id="_377">
     </a>
     六、覆盖率收集
    </h2>
    <h3>
     <a id="1__378">
     </a>
     1. 功能覆盖率与断言结合
    </h3>
    <pre><code class="prism language-c"><span class="token comment">// 覆盖req到ack的延迟周期数</span>
covergroup ack_latency_cg @<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span><span class="token punctuation">;</span>
    latency<span class="token operator">:</span> coverpoint $time <span class="token operator">-</span> req_time <span class="token punctuation">{<!-- --></span>
        bins fast <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        bins slow <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
endgroup
</code></pre>
    <h3>
     <a id="2__389">
     </a>
     2. 查看覆盖率报告
    </h3>
    <pre><code class="prism language-bash">xrun <span class="token parameter variable">-covoverwrite</span> sva_demo.sv
imc <span class="token parameter variable">-exec</span> <span class="token string">'load_test sva_demo; report_coverage'</span>
</code></pre>
    <hr/>
    <h2>
     <a id="_397">
     </a>
     七、总结
    </h2>
    <p>
     <strong>
      立即断言
     </strong>
     适用于组合逻辑的即时检查，
     <strong>
      并发断言
     </strong>
     擅长时序协议监控。
     <br/>
     <strong>
      关键技巧
     </strong>
     ：
    </p>
    <ol>
     <li>
      为并发断言显式指定时钟
     </li>
     <li>
      使用
      <code>
       |-&gt;
      </code>
      （重叠蕴含）和
      <code>
       |=&gt;
      </code>
      （非重叠蕴含）区分时序关系
     </li>
     <li>
      结合覆盖率分析断言触发场景
     </li>
    </ol>
    <p>
     通过合理使用SVA，可显著提高验证效率和设计可靠性。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34363136333838352f:61727469636c652f64657461696c732f313436303437363231" class_="artid" style="display:none">
 </p>
</div>


