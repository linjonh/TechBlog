---
layout: post
title: "Mysql数据库管理脚本"
date: 2024-06-16 10:30:11 +0800
description: "前言测试环境系统：cenros7数据库版本： Mysql5.7功能介绍列出所有库使用情况  【数据库"
keywords: "数据库表名记录数数据容量(mb)索引容量(mb)"
categories: ['Shell', 'Mysql']
tags: ['运维', 'Shell', 'Mysql', 'Linux']
artid: "111600439"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=111600439
    alt: "Mysql数据库管理脚本"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=111600439
featuredImagePreview: https://bing.ee123.net/img/rand?artid=111600439
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Mysql数据库管理脚本
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     前言
    </h2>
    <h3>
     <a id="_2">
     </a>
     测试环境
    </h3>
    <p>
     <strong>
      系统
     </strong>
     ：cenros7
     <br/>
     <strong>
      数据库版本
     </strong>
     ： Mysql5.7
    </p>
    <h3>
     <a id="_6">
     </a>
     功能介绍
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b29bddfef39fd043a69ca559400e2f77.png"/>
    </p>
    <ol>
     <li>
      列出所有库使用情况 【数据库 记录数 数据容量(MB) 索引容量(MB) 】
     </li>
     <li>
      列出所有表的使用情况 【数据库 表名 记录数 数据容量(MB) 索引容量(MB)】
     </li>
     <li>
      导出库和表的所有数据到当前脚本路径
     </li>
     <li>
      导出指定表的所有数据到当前脚本
     </li>
     <li>
      自定义创建一个新库，导入还原指定库或者表的备份数据
     </li>
     <li>
      退出脚本
     </li>
    </ol>
    <pre><code class="prism language-python">
<span class="token comment">#!/bin/bash</span>
<span class="token comment">#作用：Mysql数据库管理小脚本</span>
<span class="token comment">#日期：2020-12-23</span>

read <span class="token operator">-</span>p<span class="token string">"请输入数据库账号:  "</span> USERNAME 
<span class="token keyword">if</span> <span class="token punctuation">[</span> $? <span class="token operator">-</span>eq <span class="token number">0</span>  <span class="token punctuation">]</span> <span class="token punctuation">;</span>then echo  <span class="token string">"请输入密码 ： "</span>  <span class="token punctuation">;</span> <span class="token keyword">else</span>  echo <span class="token string">"请输入规范账号！！"</span> <span class="token punctuation">;</span> fi
read <span class="token operator">-</span>p  <span class="token string">""</span>  <span class="token operator">-</span>s  PASSWORD
<span class="token keyword">while</span> <span class="token punctuation">:</span>
do

<span class="token punctuation">[</span> $? <span class="token operator">-</span>eq <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>  echo <span class="token operator">-</span>e  "<span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span>\n
<span class="token operator">*</span><span class="token operator">|</span>     <span class="token number">1</span><span class="token punctuation">.</span> 查 看 库 测 容 量      <span class="token operator">|</span>     <span class="token number">2</span><span class="token punctuation">.</span>  查 看 表 的 容 量     <span class="token operator">|</span><span class="token operator">*</span>\n
<span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span>\n
<span class="token operator">*</span><span class="token operator">|</span>     <span class="token number">3</span><span class="token punctuation">.</span> 导出数据库到当前目录   <span class="token operator">|</span>     <span class="token number">4</span><span class="token punctuation">.</span> 导出数据表到当前目录   <span class="token operator">|</span><span class="token operator">*</span>\n                                                                                                  
<span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span>\n
<span class="token operator">*</span><span class="token operator">|</span>     <span class="token number">5</span><span class="token punctuation">.</span> 导入还原备份的库       <span class="token operator">|</span>     <span class="token number">6</span><span class="token punctuation">.</span>     退  出  脚  本     <span class="token operator">|</span><span class="token operator">*</span>\n<span class="token string">" || echo "</span>查看账号密码的输入i"
echo <span class="token string">"输入操作项的编号：   "</span>
read <span class="token operator">-</span>p <span class="token string">""</span> ku
<span class="token keyword">if</span> 
    <span class="token punctuation">[</span> $ku <span class="token operator">-</span>eq <span class="token number">1</span> <span class="token punctuation">]</span>
then
mysql <span class="token operator">-</span>u$USERNAME <span class="token operator">-</span>p$PASSWORD <span class="token operator">&lt;&lt;</span>EOF
select
table_schema <span class="token keyword">as</span> <span class="token string">'数据库'</span><span class="token punctuation">,</span>
<span class="token builtin">sum</span><span class="token punctuation">(</span>table_rows<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'记录数'</span><span class="token punctuation">,</span>
<span class="token builtin">sum</span><span class="token punctuation">(</span>truncate<span class="token punctuation">(</span>data_length<span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'数据容量(MB)'</span><span class="token punctuation">,</span>
<span class="token builtin">sum</span><span class="token punctuation">(</span>truncate<span class="token punctuation">(</span>index_length<span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'索引容量(MB)'</span>
<span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>tables
group by table_schema<span class="token punctuation">;</span>
EOF
<span class="token punctuation">[</span> $? <span class="token operator">-</span>eq <span class="token number">0</span>  <span class="token punctuation">]</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> echo <span class="token string">"    ↑↑↑↑↑↑ 库的使用情况如上所示 ↑↑↑↑↑↑     "</span> <span class="token operator">|</span><span class="token operator">|</span> echo <span class="token string">" 请检查数据库是否启动 "</span>
<span class="token keyword">elif</span>
    <span class="token punctuation">[</span> $ku <span class="token operator">-</span>eq <span class="token number">2</span>  <span class="token punctuation">]</span>
then
mysql <span class="token operator">-</span>u$USERNAME  <span class="token operator">-</span>p$PASSWORD  <span class="token operator">&lt;&lt;</span>EOF
select
table_schema <span class="token keyword">as</span> <span class="token string">'数据库'</span><span class="token punctuation">,</span>
table_name <span class="token keyword">as</span> <span class="token string">'表名'</span><span class="token punctuation">,</span>
table_rows <span class="token keyword">as</span> <span class="token string">'记录数'</span><span class="token punctuation">,</span>
truncate<span class="token punctuation">(</span>data_length<span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'数据容量(MB)'</span><span class="token punctuation">,</span>
truncate<span class="token punctuation">(</span>index_length<span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'索引容量(MB)'</span>
<span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>tables
order by data_length desc<span class="token punctuation">,</span> index_length desc<span class="token punctuation">;</span>
EOF
<span class="token punctuation">[</span> $? <span class="token operator">-</span>eq <span class="token number">0</span>   <span class="token punctuation">]</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> echo <span class="token string">"    ↑↑↑↑↑↑ 表的容量情况如上所示 ↑↑↑↑↑↑     "</span> <span class="token operator">|</span><span class="token operator">|</span> echo <span class="token string">" 请检查数据库是否启动 "</span>
<span class="token keyword">elif</span>
    <span class="token punctuation">[</span> $ku <span class="token operator">-</span>eq <span class="token number">3</span> <span class="token punctuation">]</span>
then 
    read <span class="token operator">-</span>p <span class="token string">"请输入要导出的库名:     "</span> database
    read <span class="token operator">-</span>p <span class="token string">"请给备份库命名:     "</span> databases
    mysqldump <span class="token operator">-</span>u$USERNAME  <span class="token operator">-</span>p$PASSWORD  $database  <span class="token operator">&gt;</span> $databases<span class="token punctuation">.</span>sql
    <span class="token punctuation">[</span> $? <span class="token operator">-</span>eq <span class="token number">0</span>  <span class="token punctuation">]</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> echo <span class="token string">" $databases.sql  备份库已导入当前路径 "</span> <span class="token operator">|</span><span class="token operator">|</span> echo <span class="token string">"请检查要备份的库名输入是否正确"</span>
<span class="token keyword">elif</span>
    <span class="token punctuation">[</span> $ku <span class="token operator">-</span>eq <span class="token number">4</span>  <span class="token punctuation">]</span>
then 
    read <span class="token operator">-</span>p <span class="token string">"请输入要导出的表所在的库:     "</span>  database
    read <span class="token operator">-</span>p <span class="token string">"请输入要导出的表名:     "</span>  table_name
   read <span class="token operator">-</span>p <span class="token string">"请给备份表命名:     "</span> table_new
    mysqldump <span class="token operator">-</span>u$USERNAME  <span class="token operator">-</span>p$PASSWORD  $database  $table_name  <span class="token operator">&gt;</span> $table_new<span class="token punctuation">.</span>sql
   <span class="token punctuation">[</span> $? <span class="token operator">-</span>eq <span class="token number">0</span>   <span class="token punctuation">]</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> echo <span class="token string">" $table_new.sql  备份表已导入当前路径 "</span> <span class="token operator">|</span><span class="token operator">|</span> echo <span class="token string">"请检查要备份的表名输入是否正确"</span>
<span class="token keyword">elif</span>
    <span class="token punctuation">[</span> $ku <span class="token operator">-</span>eq <span class="token number">5</span> <span class="token punctuation">]</span>
then
    read <span class="token operator">-</span>p <span class="token string">"请输入备份文件所在的位置：   "</span>  location
    read <span class="token operator">-</span>p <span class="token string">"需要定义一个新库名来存放：   "</span>  newdatabases
    mysql <span class="token operator">-</span>u$USERNAME  <span class="token operator">-</span>p$PASSWORD  <span class="token operator">&lt;&lt;</span>EOF
    create database $newdatabases<span class="token punctuation">;</span>
    exit
EOF
    mysql  <span class="token operator">-</span>u$USERNAME  <span class="token operator">-</span>p$PASSWORD $newdatabases <span class="token operator">&lt;</span> $location
    echo  <span class="token string">"导入成功！！"</span>
    mysql <span class="token operator">-</span>u$USERNAME <span class="token operator">-</span>p$PASSWORD <span class="token operator">&lt;&lt;</span>EOF
    select
        table_schema <span class="token keyword">as</span> <span class="token string">'数据库'</span><span class="token punctuation">,</span>
        <span class="token builtin">sum</span><span class="token punctuation">(</span>table_rows<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'记录数'</span><span class="token punctuation">,</span>
        <span class="token builtin">sum</span><span class="token punctuation">(</span>truncate<span class="token punctuation">(</span>data_length<span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'数据容量(MB)'</span><span class="token punctuation">,</span>
        <span class="token builtin">sum</span><span class="token punctuation">(</span>truncate<span class="token punctuation">(</span>index_length<span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'索引容量(MB)'</span>                                                                                                         
    
        <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>tables
        group by table_schema<span class="token punctuation">;</span>
EOF
<span class="token keyword">elif</span>
     <span class="token punctuation">[</span> $ku <span class="token operator">-</span>eq <span class="token number">6</span>  <span class="token punctuation">]</span>
then
    exit

<span class="token keyword">else</span>
    echo <span class="token string">"请输入正确的序号"</span>

fi
done
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f32363132393431332f:61727469636c652f64657461696c732f313131363030343339" class_="artid" style="display:none">
 </p>
</div>


