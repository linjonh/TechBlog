---
layout: post
title: "UniApp-IOS打包之后,首次安装ipa包,白屏,监听网络状态"
date: 2025-03-11 14:46:49 +0800
description: "首先说一下，我遇到的情况，IOSIPA包首次安装的时候，大家都知道，会有一个IOS，自带的系统提示，如下这里的时候，UniApp 在你选择之前就已经把接口跑完了，你再去点击这些允许，都是没啥用的这时候，我们应该把接口放在，用户选择之后再发起请求。"
keywords: "UniApp IOS打包之后，首次安装ipa包，白屏，监听网络状态"
categories: ['未分类']
tags: ['App']
artid: "146178617"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146178617
    alt: "UniApp-IOS打包之后,首次安装ipa包,白屏,监听网络状态"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146178617
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146178617
cover: https://bing.ee123.net/img/rand?artid=146178617
image: https://bing.ee123.net/img/rand?artid=146178617
img: https://bing.ee123.net/img/rand?artid=146178617
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     UniApp IOS打包之后，首次安装ipa包，白屏，监听网络状态
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     首先说一下，我遇到的情况，IOS
     <code>
      IPA
     </code>
     包
     <code>
      首次
     </code>
     安装的时候，大家都知道，会有一个IOS，自带的系统提示，如下
    </p>
    <p style="text-align:center">
     <img alt="" src="https://i-blog.csdnimg.cn/direct/51334fda340447d693195375b6b265ad.png"/>
    </p>
    <p style="text-align:center">
    </p>
    <p>
     这里的时候，UniApp 在你
     <code>
      选择之前
     </code>
     就已经把接口跑完了，你再去点击这些允许，都是没啥用的
    </p>
    <p>
     这时候，我们应该把接口放在，用户
     <code>
      选择之后
     </code>
     再发起请求
    </p>
    <p>
    </p>
    <h4>
     轮询网络状态
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        轮询
       </strong>
       : 使用
       <code>
        setInterval
       </code>
       每秒检查一次网络状态，直到检测到网络类型不为
       <code>
        none
       </code>
       。
      </p>
      <ul>
       <li>
        每秒执行一次
        <code>
         uni.getNetworkType
        </code>
        来获取网络状态。
       </li>
       <li>
        如果网络类型不是
        <code>
         none
        </code>
        ，表示网络恢复，
        <code>
         that.typee
        </code>
        被设置为
        <code>
         2
        </code>
        ，并清除定时器
        <code>
         clearInterval(time)
        </code>
        ，停止轮询。
       </li>
      </ul>
     </li>
    </ol>
    <p>
    </p>
    <p>
     vue2代码如下：
     <br/>
    </p>
    <pre><code class="hljs">onLoad() {
			
			
			//苹果要先检查网络，有网时执行，无网不显示
			let s = 0;
			let time = setInterval(() =&gt; {
			  console.log('6666');
			  uni.getNetworkType({
			    success: (res) =&gt; {
			      console.log(res.networkType, s);
			      if (res.networkType !== 'none') {
			        this.typee = 2;
			        clearInterval(time);
			        console.log('清楚网络..');//有网络就加载

					//写逻辑代码，（包含接口文件和网络接口的）
					
			      }
				  else{
					  console.log('没有网络')
				  }
			    }
			  });
			  s++;
			}, 1000);	
			
			
			
		},</code></pre>
    <h4>
     初始网络检查
    </h4>
    <p>
     1.
     <a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Fapi%2Fsystem%2Fnetwork.html" rel="nofollow" title="uni.getNetworkType">
      uni.getNetworkType
     </a>
     : 这个 API 用于获取当前的网络类型，具体详情，可以去官网看，，我这里就不写了
    </p>
    <p>
     这里肯定是要用到轮询的，轮询判断网络是否连接上了
    </p>
    <ul>
     <li>
      我这里随便写一个demo，
      <code>
       Vue2
      </code>
      的，底下再写一个
      <code>
       Vue3
      </code>
      的
     </li>
     <li>
      如果网络类型是
      <code>
       none
      </code>
      ，表示没有网络，
      <code>
       that.typee
      </code>
      被设置为
      <code>
       1
      </code>
      ，并弹出提示“网络不佳,请重新打开”。
     </li>
     <li>
      如果有网络，
      <code>
       that.typee
      </code>
      被设置为
      <code>
       2
      </code>
      ，并弹出提示“网络不佳,请重新打开”。
     </li>
     <li>
      typee 要记得在 data 定义
     </li>
    </ul>
    <p>
    </p>
    <p>
    </p>
    <pre><code class="hljs">uni.getNetworkType({
  success: function(res) {
    console.log(res.networkType);
    setTimeout(function() {
      if (res.networkType === "none") {
        that.typee = 1;
        console.log("当前无网络", that.typee);
        uni.showToast({
          title: '网络不佳,请重新打开........',
          duration: 20000
        });
      } else {
        that.typee = 2;
        console.log("有网络", that.typee);
        uni.showToast({
          title: '网络不佳,请重新打开........',
          duration: 2000
        });
      }
    }, 3000);
  }
});
</code></pre>
    <h4>
     轮询网络状态
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        轮询
       </strong>
       : 使用
       <code>
        setInterval
       </code>
       每秒检查一次网络状态，直到检测到网络类型不为
       <code>
        none
       </code>
       。
      </p>
      <ul>
       <li>
        每秒执行一次
        <code>
         uni.getNetworkType
        </code>
        来获取网络状态。
       </li>
       <li>
        如果网络类型不是
        <code>
         none
        </code>
        ，表示网络恢复，
        <code>
         that.typee
        </code>
        被设置为
        <code>
         2
        </code>
        ，并清除定时器
        <code>
         clearInterval(time)
        </code>
        ，停止轮询。
       </li>
      </ul>
     </li>
    </ol>
    <pre><code class="hljs">let s = 0;
let time = setInterval(() =&gt; {
  console.log('6666');
  uni.getNetworkType({
    success: (res) =&gt; {
      console.log(res.networkType, s);
      if (res.networkType !== 'none') {
        that.typee = 2;
        clearInterval(time);
        console.log('清楚网络..');
      }
    }
  });
  s++;
}, 1000);
</code></pre>
    <ul>
     <li>
      <strong>
       初始网络检查
      </strong>
      ：在页面加载完成时立即检查网络状态，并显示提示。
     </li>
     <li>
      <strong>
       轮询网络状态
      </strong>
      ：每秒检查一次网络状态，直到检测到网络可用，然后停止检查。
     </li>
    </ul>
    <h5>
     Vue3版本
    </h5>
    <pre><code class="hljs">&lt;template&gt;
  &lt;div&gt;
    &lt;!-- 可以在这里显示网络状态 --&gt;
    &lt;p v-if="networkStatus === 1"&gt;当前无网络&lt;/p&gt;
    &lt;p v-if="networkStatus === 2"&gt;网络连接正常&lt;/p&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, onMounted } from 'vue';
import { showToast, getNetworkType } from '@dcloudio/uni-app'; // 假设你使用的是 UniApp

const networkStatus = ref(1); // 默认无网络

const checkNetworkStatus = () =&gt; {
  getNetworkType({
    success: (res) =&gt; {
      if (res.networkType === 'none') {
        networkStatus.value = 1;
        showToast({
          title: '网络不佳,请重新打开........',
          duration: 20000
        });
      } else {
        networkStatus.value = 2;
        showToast({
          title: '网络正常',
          duration: 2000
        });
      }
    }
  });
};

const startPolling = () =&gt; {
  const interval = setInterval(() =&gt; {
    getNetworkType({
      success: (res) =&gt; {
        if (res.networkType !== 'none') {
          networkStatus.value = 2;
          clearInterval(interval);
          showToast({
            title: '网络已恢复',
            duration: 2000
          });
        }
      }
    });
  }, 1000);
};

onMounted(() =&gt; {
  // 初次检查网络状态
  checkNetworkStatus();

  // 开始轮询
  startPolling();
});
&lt;/script&gt;
</code></pre>
    <p>
     可以使用 WebSocket 来进行网络监听，这样可以更实时地监控网络连接状态。WebSocket 提供了持久化的连接，可以用来接收网络状态变化的通知。以下是一个使用 Vue 3 和 WebSocket 实现网络监听的示例。
    </p>
    <h3>
     这里写一个 搭配 WebSocket 的网络判断（可能不够准确）
    </h3>
    <h4>
     1. WebSocket 服务器设置
    </h4>
    <p>
     首先，你需要一个 WebSocket 服务器来发送网络状态信息。假设你有一个 WebSocket 服务器，它会推送网络状态变化的信息到客户端。
    </p>
    <h4>
     2. Vue 3 组件
    </h4>
    <p>
     下面是一个使用 Vue 3 和 WebSocket 实现网络监听的示例：
    </p>
    <pre><code class="hljs">&lt;template&gt;
  &lt;div&gt;
    &lt;!-- 显示网络状态 --&gt;
    &lt;p v-if="networkStatus === 1"&gt;当前无网络&lt;/p&gt;
    &lt;p v-if="networkStatus === 2"&gt;网络连接正常&lt;/p&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, onMounted, onUnmounted } from 'vue';

const networkStatus = ref(1); // 默认无网络
let socket = null;

const connectWebSocket = () =&gt; {
  socket = new WebSocket('ws://your-websocket-server-url'); // 替换为你的 WebSocket 服务器地址

  socket.onopen = () =&gt; {
    console.log('WebSocket 连接已打开');
  };

  socket.onmessage = (event) =&gt; {
    const message = JSON.parse(event.data);
    if (message.type === 'network_status') {
      networkStatus.value = message.status;
    }
  };

  socket.onclose = () =&gt; {
    console.log('WebSocket 连接已关闭');
  };

  socket.onerror = (error) =&gt; {
    console.error('WebSocket 错误:', error);
  };
};

onMounted(() =&gt; {
  connectWebSocket();
});

onUnmounted(() =&gt; {
  if (socket) {
    socket.close();
  }
});
&lt;/script&gt;
</code></pre>
    <h4>
     代码解释
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        <code>
         &lt;template&gt;
        </code>
        部分
       </strong>
       :
      </p>
      <ul>
       <li>
        显示网络状态，根据
        <code>
         networkStatus
        </code>
        的值显示不同的消息。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        <code>
         &lt;script setup&gt;
        </code>
        部分
       </strong>
       :
      </p>
      <ul>
       <li>
        使用 Vue 3 的 Composition API。
       </li>
       <li>
        <code>
         networkStatus
        </code>
        是一个
        <code>
         ref
        </code>
        ，用于存储网络状态。
       </li>
       <li>
        <code>
         connectWebSocket
        </code>
        函数负责创建和管理 WebSocket 连接。
        <ul>
         <li>
          <code>
           socket.onopen
          </code>
          事件处理程序在 WebSocket 连接打开时执行。
         </li>
         <li>
          <code>
           socket.onmessage
          </code>
          事件处理程序处理从服务器接收到的消息。在这个示例中，我们假设消息的格式为
          <code>
           { type: 'network_status', status: 1 }
          </code>
          或
          <code>
           { type: 'network_status', status: 2 }
          </code>
          。
         </li>
         <li>
          <code>
           socket.onclose
          </code>
          事件处理程序在 WebSocket 连接关闭时执行。
         </li>
         <li>
          <code>
           socket.onerror
          </code>
          事件处理程序处理 WebSocket 错误。
         </li>
        </ul>
       </li>
       <li>
        <code>
         onMounted
        </code>
        钩子在组件挂载时调用
        <code>
         connectWebSocket
        </code>
        函数。
       </li>
       <li>
        <code>
         onUnmounted
        </code>
        钩子在组件卸载时关闭 WebSocket 连接，清理资源。
       </li>
      </ul>
     </li>
    </ol>
    <h4>
     服务器端消息格式
    </h4>
    <p>
     为了让这个示例工作，你的 WebSocket 服务器需要发送类似如下的 JSON 消息：
    </p>
    <pre><code class="hljs">{
  "type": "network_status",
  "status": 2
}</code></pre>
    <p>
     这里的
     <code>
      status
     </code>
     可以是
     <code>
      1
     </code>
     （无网络）或
     <code>
      2
     </code>
     （网络正常），根据实际需要调整。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f6e656c6c793532312f:61727469636c652f64657461696c732f313436313738363137" class_="artid" style="display:none">
 </p>
</div>


