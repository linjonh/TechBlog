---
layout: post
title: "AS_Path过滤器应用灵活配置示例"
date: 2025-03-11 09:50:59 +0800
description: "针对RouterB不接收始发于AS 400的BGP路由的要求，可以在RouterA上配置向RouterB发布路由时通过AS_Path Filter进行过滤，也可以在RouterB上配置接收来自RouterA的路由时通过AS_Path Filter进行过滤，均拒绝AS_Path列表中第一个AS号（最右边的AS号）为400的BGP路由通过。另外，一台BGP路由器不接收来自某个AS的路由也有两种配置方式，一是在发送端的AS边界路由器上配置，一种是接收方端的AS边界路由器上配置。（1）配置各路由器的接口IP地址。"
keywords: "AS_Path过滤器应用灵活配置示例"
categories: ['未分类']
tags: ['网络', '华为Hcipdatacom', 'Filter', 'Bgp', 'As', 'As']
artid: "146170427"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146170427
    alt: "AS_Path过滤器应用灵活配置示例"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146170427
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146170427
cover: https://bing.ee123.net/img/rand?artid=146170427
image: https://bing.ee123.net/img/rand?artid=146170427
img: https://bing.ee123.net/img/rand?artid=146170427
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     AS_Path过滤器应用灵活配置示例
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     本文摘自笔者编辑出版的
     <a class="link-info" href="https://item.jd.com/13993371.html" rel="nofollow" title="《华为HCIP-Datacom路由交换学习指南》">
      <strong>
       《华为HCIP-Datacom路由交换学习指南》
      </strong>
     </a>
     ，通过示例演示了BGP AS_Path过滤器在BGP路由过滤方面的灵活应用。
    </p>
    <p style="text-align:center">
     <img alt="" src="https://i-blog.csdnimg.cn/direct/ecc8496334fe4999bf22f2305849df1b.png"/>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     如图8-73所示，相邻路由器间建立EBGP对等体关系，并在RouterA、RouterB和RouterD上把对应的Loopback0接口所代表的网段路由引入到了BGP路由表中。现要通过AS_Path Filter实现以下目的。
    </p>
    <ul>
     <li style="text-align: justify;">
      RouterB不接收始发于AS 400的BGP路由；
     </li>
     <li style="text-align: justify;">
      RouterD不接收包含AS 100的BGP路由。
     </li>
    </ul>
    <p>
     <img alt="" height="365" src="https://i-blog.csdnimg.cn/direct/15fb970bdcda4b98b4490df254df36e6.png" width="689"/>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:center">
     图8-73 AS_Path Filter应用配置示例的拓扑结构
    </p>
    <ol>
     <li style="text-align:justify">
      基本配置思路分析
     </li>
    </ol>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     AS_Path Filter的应用有两种方式，一种是直接在BGP地址族视图下调用，一种是在路由策略中调用。另外，一台BGP路由器不接收来自某个AS的路由也有两种配置方式，一是在发送端的AS边界路由器上配置，一种是接收方端的AS边界路由器上配置。本示例将分别予以介绍。
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     针对RouterB不接收始发于AS 400的BGP路由的要求，可以在RouterA上配置向RouterB发布路由时通过AS_Path Filter进行过滤，也可以在RouterB上配置接收来自RouterA的路由时通过AS_Path Filter进行过滤，均拒绝AS_Path列表中第一个AS号（最右边的AS号）为400的BGP路由通过。此时，RouterB将学习不到RouterD引入的172.16.1.0/24网段BGP路由。
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     针对RouterD不接收包含AS 100的BGP路由的要求，可以在RouterC上配置向RouterD发布路由时通过AS_Path Filter进行过滤，也可以在RouterD上配置接收来自RouterC的路由时通过AS_Path Filter进行过滤，均拒绝AS_Path列表中包含AS 100的BGP路由通过。此时，RouterD将同时学习不到RouterA上的192.168.1.0/24网段BGP路由和RouterB上的192.168.2.0/24网段BGP路由。
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     基于AS_Path Filter的BGP路由过滤是在完成BGP路由基本功能配置基础上进行的，根据以上分析可得出本示例的基本配置思路如下：
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     （1）配置各路由器接口的IP地址。
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     （2）配置各路由器的BGP基本功能，并分别将RouterA、RouterB和RouterD上的Loopback0接口所在网段的路由通过
     <strong>
      network
     </strong>
     命令（也可以是
     <strong>
      import-route
     </strong>
     命令）引入到BGP路由表中。
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     （3）在RouterA上配置AS_Path Filter，拒绝向RouterB通告AS_Path属性中最右边AS号为400的BGP路由；或者在RouterB上配置AS_Path Filter，拒绝从RouterA接收AS_Path列表中最右边AS号为400的BGP路由。
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     （4）在RouterC上配置AS_Path Filter，拒绝向RouterD通告AS_Path属性中包含AS 100的BGP路由；或者在RouterD上配置AS_Path Filter，拒绝从RouterC接收AS_Path列表中包含AS 100的BGP路由。
    </p>
    <p>
     2. 配置和验证
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     （1）配置各路由器的接口IP地址。在此仅介绍RouterA上的配置，其他路由器上的配置方法一样，略。
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      &lt;RouterA&gt;
      <strong>
       system-view
      </strong>
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA]
      <strong>
       interface
      </strong>
      gigabitethernet 0/0/0
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA-GigabitEthernet0/0/0]
      <strong>
       ip address
      </strong>
      10.1.1.1 24
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA-GigabitEthernet0/0/0]
      <strong>
       quit
      </strong>
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA]
      <strong>
       interface
      </strong>
      gigabitethernet 0/0/1
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA-GigabitEthernet0/0/1]
      <strong>
       ip address
      </strong>
      10.1.2.1 24
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA-GigabitEthernet0/0/1]
      <strong>
       quit
      </strong>
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA]
      <strong>
       interface
      </strong>
      loopback0
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA-Loopback0]
      <strong>
       ip address
      </strong>
      192.168.1.1 24
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA-Loopback0]
      <strong>
       quit
      </strong>
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     （2）配置各路由器的BGP基本功能。EBGP对等体间使用直连物理接口建立TCP连接，RouterA~RouterD四台路由器的Router ID分别配置为1.1.1.1~4.4.4.4，并在RouterA、RouterB、RouterD上Loopback0接口对应网段路由引入到BGP路由表中。
    </p>
    <ul>
     <li style="text-align: justify;">
      RouterA上的配置。
     </li>
    </ul>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA]
      <strong>
       bgp
      </strong>
      100
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA-bgp]
      <strong>
       router
      </strong>
      -
      <strong>
       id
      </strong>
      1.1.1.1
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA-bgp]
      <strong>
       peer
      </strong>
      10.1.1.2
      <strong>
       as
      </strong>
      -
      <strong>
       number
      </strong>
      200
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA-bgp]
      <strong>
       peer
      </strong>
      10.1.2.2
      <strong>
       as
      </strong>
      -
      <strong>
       number
      </strong>
      300
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA-bgp]
      <strong>
       network
      </strong>
      192.168.1.0 24
     </span>
    </p>
    <ul>
     <li style="text-align: justify;">
      RouterB上的配置。
     </li>
    </ul>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterB]
      <strong>
       bgp
      </strong>
      200
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterB-bgp]
      <strong>
       router
      </strong>
      -
      <strong>
       id
      </strong>
      2.2.2.2
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterB-bgp]
      <strong>
       peer
      </strong>
      10.1.1.1
      <strong>
       as
      </strong>
      -
      <strong>
       number
      </strong>
      100
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterB-bgp]
      <strong>
       network
      </strong>
      192.168.2.0 24
     </span>
    </p>
    <ul>
     <li style="text-align: justify;">
      RouterC上的配置。
     </li>
    </ul>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterC]
      <strong>
       bgp
      </strong>
      300
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterC-bgp]
      <strong>
       router
      </strong>
      -
      <strong>
       id
      </strong>
      3.3.3.3
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterC-bgp]
      <strong>
       peer
      </strong>
      10.1.2.1
      <strong>
       as
      </strong>
      -
      <strong>
       number
      </strong>
      100
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterC-bgp]
      <strong>
       peer
      </strong>
      10.1.3.2
      <strong>
       as
      </strong>
      -
      <strong>
       number
      </strong>
      400
     </span>
    </p>
    <ul>
     <li style="text-align: justify;">
      RouterD上的配置。
     </li>
    </ul>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterD]
      <strong>
       bgp
      </strong>
      400
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterD-bgp]
      <strong>
       router
      </strong>
      -
      <strong>
       id
      </strong>
      4.4.4.4
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterD-bgp]
      <strong>
       peer
      </strong>
      10.1.3.1
      <strong>
       as
      </strong>
      -
      <strong>
       number
      </strong>
      300
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterD-bgp]
      <strong>
       network
      </strong>
      172.16.1.0 24
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     以上配置好后，在RouterB上执行
     <strong>
      display bgp routing-table
     </strong>
     命令，可看到他已学习到了RouterA和RouterD上所引入的两个网段的BGP路由，如图8-74所示。在RouterD上执行
     <strong>
      display bgp routing-table
     </strong>
     命令，可看到他已学习到了RouterA和RouterB上所引入的两个网段的BGP路由，如图8-75所示。
    </p>
    <p class="img-center">
     <img alt="" height="252" src="https://i-blog.csdnimg.cn/direct/8293c51a350c432a8e02ce7a5beb73d9.png" width="584"/>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:center">
     图8-74  RouterB上学习到的RouterA和RouterD所引入的两个网段BGP路由
    </p>
    <p class="img-center">
     <img alt="" height="258" src="https://i-blog.csdnimg.cn/direct/3ee9d3f28d554beaaa1667ddceaed4c4.png" width="605"/>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:center">
     图8-75  RouterD上学习到的RouterA和RouterB所引入的两个网段BGP路由
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     （3）在RouterA上配置AS_Path Filter，拒绝向RouterB通告AS_Path列表中最右边AS号为400的BGP路由；或者在RouterB上配置AS_Path Filter，拒绝从RouterA接收AS_Path列表中最右边个AS号为400的BGP路由。下面是这两种配置方案的具体配置方法。
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     方案一：在RouterA上配置AS_Path Filter
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA]
      <strong>
       ip as-path-filter
      </strong>
      1
      <strong>
       deny
      </strong>
      _400$   #---拒绝AS_Path表列中以AS 400结束的BGP路由
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA]
      <strong>
       ip
      </strong>
      <strong>
       as-path
      </strong>
      -
      <strong>
       filter
      </strong>
      1
      <strong>
       permit
      </strong>
      .*  #---允许其他所有BGP路由通过。必须要配置，以允许其他路由通过，因为AS_Path过滤器的缺省匹配模式为deny
     </span>
    </p>
    <ul>
     <li style="text-align: justify;">
      采用直接调用AS_Path Filter的配置方式：
     </li>
    </ul>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA]
      <strong>
       bgp
      </strong>
      100
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA-bgp]
      <strong>
       peer
      </strong>
      10.1.1.2
      <strong>
       as
      </strong>
      -
      <strong>
       path
      </strong>
      -
      <strong>
       filter
      </strong>
      1
      <strong>
       export
      </strong>
      #---向对等体RouterB通告路由时调用1号AS_Path过滤器
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     以上配置好后，再在RouterB上执行
     <strong>
      display bgp routing-table
     </strong>
     命令，可看到原来学习到的位于AS 400的172.16.1.0/24网段BGP路由没有了（对比图8-74），如图8-76所示。
    </p>
    <p class="img-center">
     <img alt="" height="248" src="https://i-blog.csdnimg.cn/direct/b4f681cc593e40388123510677044d7c.png" width="629"/>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:center">
     图8-76 在RouterA上配置并应用好AS_Path Filter后，RouterB上的BGP路由表
    </p>
    <ul>
     <li style="text-align: justify;">
      采用路由策略调用AS_Path Filter的配置方式：
     </li>
    </ul>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA]
      <strong>
       route
      </strong>
      -
      <strong>
       policy
      </strong>
      as-path
      <strong>
       permit
      </strong>
      <strong>
       node
      </strong>
      10
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA-route-policy]
      <strong>
       if
      </strong>
      -
      <strong>
       match
      </strong>
      <strong>
       as
      </strong>
      -
      <strong>
       path
      </strong>
      -
      <strong>
       filter
      </strong>
      1
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA-route-policy]
      <strong>
       quit
      </strong>
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA]
      <strong>
       bgp
      </strong>
      100
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterA-bgp]
      <strong>
       peer
      </strong>
      10.1.1.2
      <strong>
       route
      </strong>
      -
      <strong>
       policy
      </strong>
      as-path
      <strong>
       export
      </strong>
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     以上配置好后，再在RouterB上执行
     <strong>
      display bgp routing-table
     </strong>
     命令，得到的效果与图8-76一样，同样没有了以前学习到的172.16.1.0/24网段BGP路由。
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     方案二：在RouterB上配置AS_Path Filter
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterB]
      <strong>
       ip as-path-filter
      </strong>
      1
      <strong>
       deny
      </strong>
      _400$
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterB]
      <strong>
       ip
      </strong>
      <strong>
       as-path
      </strong>
      -
      <strong>
       filter
      </strong>
      1
      <strong>
       permit
      </strong>
      .*
     </span>
    </p>
    <ul>
     <li style="text-align: justify;">
      采用直接调用AS_Path Filter的配置方式：
     </li>
    </ul>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterB]
      <strong>
       bgp
      </strong>
      200
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterB-bgp]
      <strong>
       peer
      </strong>
      10.1.1.1
      <strong>
       as
      </strong>
      -
      <strong>
       path
      </strong>
      -
      <strong>
       filter
      </strong>
      1
      <strong>
       import
      </strong>
      #---从对等体RouterA学习路由时调用1号AS_Path Filter
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     以上配置好后，再在RouterB上执行
     <strong>
      display bgp routing-table
     </strong>
     命令，得到的效果一样，参见图8-76。
    </p>
    <ul>
     <li style="text-align: justify;">
      采用路由策略调用AS_Path Filter的配置方式：
     </li>
    </ul>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterB]
      <strong>
       route
      </strong>
      -
      <strong>
       policy
      </strong>
      as-path
      <strong>
       permit
      </strong>
      <strong>
       node
      </strong>
      10
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterB-route-policy]
      <strong>
       if
      </strong>
      -
      <strong>
       match
      </strong>
      <strong>
       as
      </strong>
      -
      <strong>
       path
      </strong>
      -
      <strong>
       filter
      </strong>
      1
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterB-route-policy]
      <strong>
       quit
      </strong>
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterB]
      <strong>
       bgp
      </strong>
      200
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterB-bgp]
      <strong>
       peer
      </strong>
      10.1.1.1
      <strong>
       route
      </strong>
      -
      <strong>
       policy
      </strong>
      as-path
      <strong>
       import
      </strong>
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     以上配置好后，再在RouterB上执行
     <strong>
      display bgp routing-table
     </strong>
     命令，得到的效果一样，参见图8-76。
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     （4）在RouterC上配置AS_Path Filter，拒绝向RouterD通告AS_Path列表中包含AS 100的BGP路由；或者在RouterD上配置AS_Path Filter，拒绝从RouterC接收AS_Path列表中包含AS 100的BGP路由。
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     方案一：在RouterC上配置AS_Path Filter
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterC]
      <strong>
       ip as-path-filter
      </strong>
      2
      <strong>
       deny
      </strong>
      _100_   #---拒绝AS_Path表列中包含AS 100的BGP路由
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterC]
      <strong>
       ip
      </strong>
      <strong>
       as-path
      </strong>
      -
      <strong>
       filter
      </strong>
      2
      <strong>
       permit
      </strong>
      .*  #---允许其他所有BGP路由通过
     </span>
    </p>
    <p style="text-align:justify">
     此处仅采用直接调用AS_Path Filter的配置方式。
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterC]
      <strong>
       bgp
      </strong>
      300
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterC-bgp]
      <strong>
       peer
      </strong>
      10.1.3.2
      <strong>
       as
      </strong>
      -
      <strong>
       path
      </strong>
      -
      <strong>
       filter
      </strong>
      2
      <strong>
       export
      </strong>
      #---向对等体RouterD通告路由时调用1号AS_Path Filter
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     以上配置好后，再在RouterD上执行
     <strong>
      display bgp routing-table
     </strong>
     命令，可看到原来学习到的位于AS 100的192.168.1.0/24和位于AS 200的192.168.2.0/24两网段的BGP路由同时没有了（对比图8-75），如图8-77所示。因为原来在RouterD上的这两个网段的BGP路由的AS_Path表中都包含了AS 100。
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:center">
     <img alt="" height="227" src="https://i-blog.csdnimg.cn/direct/87731478657a45baa34aae8a07f5dca9.png" width="653"/>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:center">
     图8-77 在RouterC上配置并应用好AS_Path Filter后，RouterD上的BGP路由表
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     方案二：在RouterD上配置AS_Path Filter
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterD]
      <strong>
       ip as-path-filter
      </strong>
      2
      <strong>
       deny
      </strong>
      _100_
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterD]
      <strong>
       ip
      </strong>
      <strong>
       as-path
      </strong>
      -
      <strong>
       filter
      </strong>
      2
      <strong>
       permit
      </strong>
      .*
     </span>
    </p>
    <ul>
     <li style="text-align: justify;">
      采用直接调用AS_Path Filter的配置方式：
     </li>
    </ul>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterD]
      <strong>
       bgp
      </strong>
      200
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterD-bgp]
      <strong>
       peer
      </strong>
      10.1.3.1
      <strong>
       as
      </strong>
      -
      <strong>
       path
      </strong>
      -
      <strong>
       filter
      </strong>
      2
      <strong>
       import
      </strong>
      #---从对等体RouterA学习路由时调用1号AS_Path Filter
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     以上配置好后，再在RouterD上执行
     <strong>
      display bgp routing-table
     </strong>
     命令，得到的效果一样，参见图8-77。
    </p>
    <ul>
     <li style="text-align: justify;">
      采用路由策略调用AS_Path Filter的配置方式：
     </li>
    </ul>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterD]
      <strong>
       route
      </strong>
      -
      <strong>
       policy
      </strong>
      as-path
      <strong>
       permit
      </strong>
      <strong>
       node
      </strong>
      10
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterD-route-policy]
      <strong>
       if
      </strong>
      -
      <strong>
       match
      </strong>
      <strong>
       as
      </strong>
      -
      <strong>
       path
      </strong>
      -
      <strong>
       filter
      </strong>
      2
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterD-route-policy]
      <strong>
       quit
      </strong>
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterD]
      <strong>
       bgp
      </strong>
      200
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <span style="background-color:#e6e6e6">
      [RouterD-bgp]
      <strong>
       peer
      </strong>
      10.1.3.1
      <strong>
       route
      </strong>
      -
      <strong>
       policy
      </strong>
      as-path
      <strong>
       import
      </strong>
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     以上配置好后，再在RouterD上执行
     <strong>
      display bgp routing-table
     </strong>
     命令，得到的效果一样，参见图8-77。
    </p>
    <p>
     通过以上配置即完全实现了本示例的目的。
    </p>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f6c7963625f677a2f:61727469636c652f64657461696c732f313436313730343237" class_="artid" style="display:none">
 </p>
</div>


