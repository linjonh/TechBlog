---
layout: post
title: "Qt状态更新设计"
date: 2025-03-10 14:02:55 +0800
description: "在动平衡仪的使用过程中，配置参数的动态切换（如切换传感器通道、切换单位）需要实时反映在界面显示和计算方法上。为了实现这种动态响应，可以采用。通过观察者模式和事件驱动架构，可以实现配置参数的动态切换，并确保相关界面和功能实时更新。配置管理模块使用观察者模式，当配置参数发生变化时，通知所有观察者。，并结合分层架构设计。如果需要更详细的实现或工具使用指导，可以进一步探讨！算法模块监听单位配置变化事件，动态调整算法。界面模块监听配置变化事件，动态更新界面。"
keywords: "Qt状态更新设计"
categories: ['Qt']
tags: ['数据库', 'Qt', 'Java']
artid: "146153388"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146153388
    alt: "Qt状态更新设计"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146153388
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146153388
cover: https://bing.ee123.net/img/rand?artid=146153388
image: https://bing.ee123.net/img/rand?artid=146153388
img: https://bing.ee123.net/img/rand?artid=146153388
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Qt状态更新设计
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在动平衡仪的使用过程中，配置参数的动态切换（如切换传感器通道、切换单位）需要实时反映在界面显示和计算方法上。为了实现这种动态响应，可以采用
     <strong>
      观察者模式（Observer Pattern）
     </strong>
     和
     <strong>
      事件驱动架构（Event-Driven Architecture）
     </strong>
     ，并结合分层架构设计。以下是详细的设计思路和实现方法：
    </p>
    <hr/>
    <h3>
     <a id="1__4">
     </a>
     <strong>
      1. 设计思路
     </strong>
    </h3>
    <h4>
     <a id="11__6">
     </a>
     <strong>
      1.1 核心需求
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       动态响应
      </strong>
      ：当配置参数（如单位、传感器通道、结果显示选项）发生变化时，相关界面和功能需要实时更新。
     </li>
     <li>
      <strong>
       解耦
      </strong>
      ：配置管理模块与其他模块（如界面、算法、传感器管理）之间应保持低耦合。
     </li>
     <li>
      <strong>
       可扩展性
      </strong>
      ：新增配置项或功能时，不应影响现有代码。
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="12__13">
     </a>
     <strong>
      1.2 设计模式
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       观察者模式
      </strong>
      ：
      <ul>
       <li>
        配置管理模块作为被观察者（Subject），其他模块（如界面、算法、传感器管理）作为观察者（Observer）。
       </li>
       <li>
        当配置参数发生变化时，配置管理模块通知所有观察者。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       事件驱动架构
      </strong>
      ：
      <ul>
       <li>
        使用事件机制传递配置变化的消息，进一步解耦模块之间的依赖。
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="13__22">
     </a>
     <strong>
      1.3 分层架构
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       用户界面层（UI Layer）
      </strong>
      ：
      <ul>
       <li>
        负责显示配置界面和动平衡界面。
       </li>
       <li>
        监听配置变化事件，动态更新界面。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       业务逻辑层（Business Logic Layer）
      </strong>
      ：
      <ul>
       <li>
        负责动平衡算法、传感器管理等功能。
       </li>
       <li>
        监听配置变化事件，动态调整算法和传感器通道。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       数据访问层（Data Access Layer）
      </strong>
      ：
      <ul>
       <li>
        负责配置参数的持久化（保存和加载）。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       配置管理层（Configuration Layer）
      </strong>
      ：
      <ul>
       <li>
        集中管理所有配置项。
       </li>
       <li>
        提供接口供其他模块读取和修改配置。
       </li>
       <li>
        触发配置变化事件。
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="2__38">
     </a>
     <strong>
      2. 体系结构设计
     </strong>
    </h3>
    <h4>
     <a id="21__40">
     </a>
     <strong>
      2.1 模块划分
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       配置管理模块
      </strong>
      ：
      <ul>
       <li>
        管理所有配置项（如单位、传感器通道、结果显示选项）。
       </li>
       <li>
        提供接口供其他模块读取和修改配置。
       </li>
       <li>
        触发配置变化事件。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       持久化模块
      </strong>
      ：
      <ul>
       <li>
        负责将配置参数保存到文件或数据库中，并在启动时加载。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       界面模块
      </strong>
      ：
      <ul>
       <li>
        显示配置界面和动平衡界面。
       </li>
       <li>
        监听配置变化事件，动态更新界面。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       算法模块
      </strong>
      ：
      <ul>
       <li>
        根据单位配置调用不同的算法。
       </li>
       <li>
        监听配置变化事件，动态调整算法。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       传感器管理模块
      </strong>
      ：
      <ul>
       <li>
        根据传感器通道设置开启或关闭传感器通道。
       </li>
       <li>
        监听配置变化事件，动态调整传感器通道。
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="22__59">
     </a>
     <strong>
      2.2 层次结构
     </strong>
    </h4>
    <pre><code>+-------------------+
| 用户界面层 (UI)   |
+-------------------+
| - 配置界面        |
| - 动平衡界面      |
+-------------------+
           |
           v
+-------------------+
| 业务逻辑层 (BL)   |
+-------------------+
| - 算法模块        |
| - 传感器管理模块  |
+-------------------+
           |
           v
+-------------------+
| 配置管理层 (CL)   |
+-------------------+
| - 配置管理模块    |
| - 持久化模块      |
+-------------------+
</code></pre>
    <hr/>
    <h3>
     <a id="3__87">
     </a>
     <strong>
      3. 实现方法
     </strong>
    </h3>
    <h4>
     <a id="31__89">
     </a>
     <strong>
      3.1 配置管理模块
     </strong>
    </h4>
    <p>
     配置管理模块使用观察者模式，当配置参数发生变化时，通知所有观察者。
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">// ConfigManager.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">CONFIGMANAGER_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CONFIGMANAGER_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QObject&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QMap&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">ConfigManager</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QObject</span></span> <span class="token punctuation">{<!-- --></span>
    Q_OBJECT

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">Unit</span> <span class="token punctuation">{<!-- --></span> Grams<span class="token punctuation">,</span> Ounces<span class="token punctuation">,</span> Millimeters<span class="token punctuation">,</span> Inches <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">DisplayOption</span> <span class="token punctuation">{<!-- --></span> Amplitude<span class="token punctuation">,</span> Phase<span class="token punctuation">,</span> RPM <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">ConfigManager</span><span class="token punctuation">(</span>QObject<span class="token operator">*</span> parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">setUnit</span><span class="token punctuation">(</span>Unit unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Unit <span class="token function">getUnit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">setSensorChannels</span><span class="token punctuation">(</span><span class="token keyword">const</span> QMap<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> channels<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QMap<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">getSensorChannels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">setDisplayOptions</span><span class="token punctuation">(</span><span class="token keyword">const</span> QMap<span class="token operator">&lt;</span>DisplayOption<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QMap<span class="token operator">&lt;</span>DisplayOption<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">getDisplayOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

signals<span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">unitChanged</span><span class="token punctuation">(</span>Unit unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">sensorChannelsChanged</span><span class="token punctuation">(</span><span class="token keyword">const</span> QMap<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> channels<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">displayOptionsChanged</span><span class="token punctuation">(</span><span class="token keyword">const</span> QMap<span class="token operator">&lt;</span>DisplayOption<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    Unit m_unit<span class="token punctuation">;</span>
    QMap<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> m_sensorChannels<span class="token punctuation">;</span>
    QMap<span class="token operator">&lt;</span>DisplayOption<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> m_displayOptions<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// CONFIGMANAGER_H</span></span>
</code></pre>
    <pre><code class="prism language-cpp"><span class="token comment">// ConfigManager.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ConfigManager.h"</span></span>

<span class="token class-name">ConfigManager</span><span class="token double-colon punctuation">::</span><span class="token function">ConfigManager</span><span class="token punctuation">(</span>QObject<span class="token operator">*</span> parent<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">QObject</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_unit</span><span class="token punctuation">(</span>Unit<span class="token double-colon punctuation">::</span>Grams<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">ConfigManager</span><span class="token double-colon punctuation">::</span><span class="token function">setUnit</span><span class="token punctuation">(</span>Unit unit<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>m_unit <span class="token operator">!=</span> unit<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        m_unit <span class="token operator">=</span> unit<span class="token punctuation">;</span>
        emit <span class="token function">unitChanged</span><span class="token punctuation">(</span>unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ConfigManager<span class="token double-colon punctuation">::</span>Unit <span class="token class-name">ConfigManager</span><span class="token double-colon punctuation">::</span><span class="token function">getUnit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> m_unit<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">ConfigManager</span><span class="token double-colon punctuation">::</span><span class="token function">setSensorChannels</span><span class="token punctuation">(</span><span class="token keyword">const</span> QMap<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> channels<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>m_sensorChannels <span class="token operator">!=</span> channels<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        m_sensorChannels <span class="token operator">=</span> channels<span class="token punctuation">;</span>
        emit <span class="token function">sensorChannelsChanged</span><span class="token punctuation">(</span>channels<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

QMap<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token class-name">ConfigManager</span><span class="token double-colon punctuation">::</span><span class="token function">getSensorChannels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> m_sensorChannels<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">ConfigManager</span><span class="token double-colon punctuation">::</span><span class="token function">setDisplayOptions</span><span class="token punctuation">(</span><span class="token keyword">const</span> QMap<span class="token operator">&lt;</span>DisplayOption<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> options<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>m_displayOptions <span class="token operator">!=</span> options<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        m_displayOptions <span class="token operator">=</span> options<span class="token punctuation">;</span>
        emit <span class="token function">displayOptionsChanged</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

QMap<span class="token operator">&lt;</span>ConfigManager<span class="token double-colon punctuation">::</span>DisplayOption<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token class-name">ConfigManager</span><span class="token double-colon punctuation">::</span><span class="token function">getDisplayOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> m_displayOptions<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="32__174">
     </a>
     <strong>
      3.2 界面模块
     </strong>
    </h4>
    <p>
     界面模块监听配置变化事件，动态更新界面。
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">// BalancingUI.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">BALANCINGUI_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BALANCINGUI_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QWidget&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ConfigManager.h"</span></span>

<span class="token keyword">class</span> <span class="token class-name">BalancingUI</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QWidget</span></span> <span class="token punctuation">{<!-- --></span>
    Q_OBJECT

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">BalancingUI</span><span class="token punctuation">(</span>ConfigManager<span class="token operator">*</span> configManager<span class="token punctuation">,</span> QWidget<span class="token operator">*</span> parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> slots<span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">onUnitChanged</span><span class="token punctuation">(</span>ConfigManager<span class="token double-colon punctuation">::</span>Unit unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">onDisplayOptionsChanged</span><span class="token punctuation">(</span><span class="token keyword">const</span> QMap<span class="token operator">&lt;</span>ConfigManager<span class="token double-colon punctuation">::</span>DisplayOption<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    ConfigManager<span class="token operator">*</span> m_configManager<span class="token punctuation">;</span>
    QLabel<span class="token operator">*</span> m_unitLabel<span class="token punctuation">;</span>
    QLabel<span class="token operator">*</span> m_amplitudeLabel<span class="token punctuation">;</span>
    QLabel<span class="token operator">*</span> m_phaseLabel<span class="token punctuation">;</span>
    QLabel<span class="token operator">*</span> m_rpmLabel<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// BALANCINGUI_H</span></span>
</code></pre>
    <pre><code class="prism language-cpp"><span class="token comment">// BalancingUI.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"BalancingUI.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QVBoxLayout&gt;</span></span>

<span class="token class-name">BalancingUI</span><span class="token double-colon punctuation">::</span><span class="token function">BalancingUI</span><span class="token punctuation">(</span>ConfigManager<span class="token operator">*</span> configManager<span class="token punctuation">,</span> QWidget<span class="token operator">*</span> parent<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">QWidget</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_configManager</span><span class="token punctuation">(</span>configManager<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    m_unitLabel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QLabel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_amplitudeLabel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QLabel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_phaseLabel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QLabel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_rpmLabel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QLabel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    QVBoxLayout<span class="token operator">*</span> layout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QVBoxLayout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    layout<span class="token operator">-&gt;</span><span class="token function">addWidget</span><span class="token punctuation">(</span>m_unitLabel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    layout<span class="token operator">-&gt;</span><span class="token function">addWidget</span><span class="token punctuation">(</span>m_amplitudeLabel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    layout<span class="token operator">-&gt;</span><span class="token function">addWidget</span><span class="token punctuation">(</span>m_phaseLabel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    layout<span class="token operator">-&gt;</span><span class="token function">addWidget</span><span class="token punctuation">(</span>m_rpmLabel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setLayout</span><span class="token punctuation">(</span>layout<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 监听配置变化事件</span>
    <span class="token function">connect</span><span class="token punctuation">(</span>m_configManager<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ConfigManager<span class="token double-colon punctuation">::</span>unitChanged<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>BalancingUI<span class="token double-colon punctuation">::</span>onUnitChanged<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">connect</span><span class="token punctuation">(</span>m_configManager<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ConfigManager<span class="token double-colon punctuation">::</span>displayOptionsChanged<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>BalancingUI<span class="token double-colon punctuation">::</span>onDisplayOptionsChanged<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 初始化界面</span>
    <span class="token function">onUnitChanged</span><span class="token punctuation">(</span>m_configManager<span class="token operator">-&gt;</span><span class="token function">getUnit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">onDisplayOptionsChanged</span><span class="token punctuation">(</span>m_configManager<span class="token operator">-&gt;</span><span class="token function">getDisplayOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">BalancingUI</span><span class="token double-colon punctuation">::</span><span class="token function">onUnitChanged</span><span class="token punctuation">(</span>ConfigManager<span class="token double-colon punctuation">::</span>Unit unit<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    QString unitText <span class="token operator">=</span> <span class="token punctuation">(</span>unit <span class="token operator">==</span> ConfigManager<span class="token double-colon punctuation">::</span>Unit<span class="token double-colon punctuation">::</span>Grams<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">"Grams"</span> <span class="token operator">:</span> <span class="token string">"Ounces"</span><span class="token punctuation">;</span>
    m_unitLabel<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"Unit: "</span> <span class="token operator">+</span> unitText<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">BalancingUI</span><span class="token double-colon punctuation">::</span><span class="token function">onDisplayOptionsChanged</span><span class="token punctuation">(</span><span class="token keyword">const</span> QMap<span class="token operator">&lt;</span>ConfigManager<span class="token double-colon punctuation">::</span>DisplayOption<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> options<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">[</span>ConfigManager<span class="token double-colon punctuation">::</span>DisplayOption<span class="token double-colon punctuation">::</span>Amplitude<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        m_amplitudeLabel<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"Amplitude: 10.5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        m_amplitudeLabel<span class="token operator">-&gt;</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">[</span>ConfigManager<span class="token double-colon punctuation">::</span>DisplayOption<span class="token double-colon punctuation">::</span>Phase<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        m_phaseLabel<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"Phase: 45°"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        m_phaseLabel<span class="token operator">-&gt;</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">[</span>ConfigManager<span class="token double-colon punctuation">::</span>DisplayOption<span class="token double-colon punctuation">::</span>RPM<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        m_rpmLabel<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"RPM: 3000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        m_rpmLabel<span class="token operator">-&gt;</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="33__260">
     </a>
     <strong>
      3.3 算法模块
     </strong>
    </h4>
    <p>
     算法模块监听单位配置变化事件，动态调整算法。
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">// BalancingAlgorithm.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">BALANCINGALGORITHM_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BALANCINGALGORITHM_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ConfigManager.h"</span></span>

<span class="token keyword">class</span> <span class="token class-name">BalancingAlgorithm</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">BalancingAlgorithm</span><span class="token punctuation">(</span>ConfigManager<span class="token operator">*</span> configManager<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> slots<span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">onUnitChanged</span><span class="token punctuation">(</span>ConfigManager<span class="token double-colon punctuation">::</span>Unit unit<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    ConfigManager<span class="token operator">*</span> m_configManager<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// BALANCINGALGORITHM_H</span></span>
</code></pre>
    <pre><code class="prism language-cpp"><span class="token comment">// BalancingAlgorithm.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"BalancingAlgorithm.h"</span></span>

<span class="token class-name">BalancingAlgorithm</span><span class="token double-colon punctuation">::</span><span class="token function">BalancingAlgorithm</span><span class="token punctuation">(</span>ConfigManager<span class="token operator">*</span> configManager<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">m_configManager</span><span class="token punctuation">(</span>configManager<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">connect</span><span class="token punctuation">(</span>m_configManager<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ConfigManager<span class="token double-colon punctuation">::</span>unitChanged<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>BalancingAlgorithm<span class="token double-colon punctuation">::</span>onUnitChanged<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">BalancingAlgorithm</span><span class="token double-colon punctuation">::</span><span class="token function">onUnitChanged</span><span class="token punctuation">(</span>ConfigManager<span class="token double-colon punctuation">::</span>Unit unit<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>unit<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> ConfigManager<span class="token double-colon punctuation">::</span>Unit<span class="token double-colon punctuation">::</span>Grams<span class="token operator">:</span>
            <span class="token comment">// 调用克单位的算法</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ConfigManager<span class="token double-colon punctuation">::</span>Unit<span class="token double-colon punctuation">::</span>Ounces<span class="token operator">:</span>
            <span class="token comment">// 调用盎司单位的算法</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="4__307">
     </a>
     <strong>
      4. 总结
     </strong>
    </h3>
    <p>
     通过观察者模式和事件驱动架构，可以实现配置参数的动态切换，并确保相关界面和功能实时更新。这种设计具有以下优势：
    </p>
    <ul>
     <li>
      <strong>
       解耦
      </strong>
      ：各模块通过事件交互，降低耦合度。
     </li>
     <li>
      <strong>
       动态响应
      </strong>
      ：配置变化实时反映在界面和功能上。
     </li>
     <li>
      <strong>
       可扩展性
      </strong>
      ：新增配置项或功能时，只需添加新的观察者即可。
     </li>
    </ul>
    <p>
     如果需要更详细的实现或工具使用指导，可以进一步探讨！
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f35353537363239302f:61727469636c652f64657461696c732f313436313533333838" class_="artid" style="display:none">
 </p>
</div>


