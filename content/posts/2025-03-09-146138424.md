---
layout: post
title: "cpu-多级缓存L1L2L3-与主存关系"
date: 2025-03-09 20:57:04 +0800
description: "多级缓存（L1、L2、L3）和主存构成了现代 CPU 的内存层次结构，通过减少内存访问延迟和提高数据访问速度来优化性能。缓存的设计和性能对 CPU 的整体性能有重大影响，程序设计和内存分配可以通过优化缓存使用来进一步提升性能。"
keywords: "小核心l1l2l3分别代表什么"
categories: ['未分类']
tags: ['缓存', '系统架构']
artid: "146138424"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146138424
    alt: "cpu-多级缓存L1L2L3-与主存关系"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146138424
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146138424
cover: https://bing.ee123.net/img/rand?artid=146138424
image: https://bing.ee123.net/img/rand?artid=146138424
img: https://bing.ee123.net/img/rand?artid=146138424
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     cpu 多级缓存L1、L2、L3 与主存关系
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     现代 CPU 的多级缓存（L1、L2、L3）和主存（DRAM）构成了一个层次化的内存系统，旨在通过减少内存访问延迟和提高数据访问速度来优化计算性能。以下是对多级缓存和主存的详细解析：
    </p>
    <hr/>
    <h4>
     1.
     <strong>
      缓存层次结构
     </strong>
    </h4>
    <p>
     现代 CPU 通常采用三级缓存结构：L1、L2 和 L3。每一级缓存的容量、速度和访问延迟都不同，形成了一个从快到慢、从小到大的层次结构。
    </p>
    <h5>
     <strong>
      L1 缓存（一级缓存）
     </strong>
    </h5>
    <ul>
     <li>
      <p>
       <strong>
        位置
       </strong>
       ：最接近 CPU 核心，通常每个核心独享。
      </p>
     </li>
     <li>
      <p>
       <strong>
        容量
       </strong>
       ：最小，通常为 32KB 到 64KB（分为 L1 指令缓存和 L1 数据缓存）。
      </p>
     </li>
     <li>
      <p>
       <strong>
        速度
       </strong>
       ：最快，访问延迟通常为 1-3 个时钟周期。
      </p>
     </li>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：存储 CPU 核心最频繁使用的指令和数据，提供最快的访问速度。
      </p>
     </li>
    </ul>
    <h5>
     <strong>
      L2 缓存（二级缓存）
     </strong>
    </h5>
    <ul>
     <li>
      <p>
       <strong>
        位置
       </strong>
       ：位于 L1 缓存和 L3 缓存之间，通常每个核心独享或共享。
      </p>
     </li>
     <li>
      <p>
       <strong>
        容量
       </strong>
       ：中等，通常为 256KB 到 1MB。
      </p>
     </li>
     <li>
      <p>
       <strong>
        速度
       </strong>
       ：比 L1 慢，访问延迟通常为 10-20 个时钟周期。
      </p>
     </li>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：作为 L1 缓存的补充，存储更多的指令和数据，减少对 L3 缓存的访问。
      </p>
     </li>
    </ul>
    <h5>
     <strong>
      L3 缓存（三级缓存）
     </strong>
    </h5>
    <ul>
     <li>
      <p>
       <strong>
        位置
       </strong>
       ：位于 L2 缓存和主存之间，通常由多个核心共享。
      </p>
     </li>
     <li>
      <p>
       <strong>
        容量
       </strong>
       ：最大，通常为几 MB 到几十 MB。
      </p>
     </li>
     <li>
      <p>
       <strong>
        速度
       </strong>
       ：比 L2 慢，访问延迟通常为 30-50 个时钟周期。
      </p>
     </li>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：作为 L2 缓存的补充，存储更多的数据，减少对主存的访问。
      </p>
     </li>
    </ul>
    <h5>
     <strong>
      主存（DRAM）
     </strong>
    </h5>
    <ul>
     <li>
      <p>
       <strong>
        位置
       </strong>
       ：位于缓存层次结构的最外层，通过内存控制器与 CPU 通信。
      </p>
     </li>
     <li>
      <p>
       <strong>
        容量
       </strong>
       ：最大，通常为几 GB 到几百 GB。
      </p>
     </li>
     <li>
      <p>
       <strong>
        速度
       </strong>
       ：最慢，访问延迟通常为 100-300 个时钟周期。
      </p>
     </li>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：存储所有运行程序的数据和指令，是 CPU 访问的最终数据源。
      </p>
     </li>
     <li>
      图示如下：
     </li>
     <li>
      <p>
       <img alt="" height="300" src="https://i-blog.csdnimg.cn/direct/2a20efc196084ef2ab0feaf3c481a38e.png" width="535"/>
      </p>
     </li>
    </ul>
    <hr/>
    <h4>
     2.
     <strong>
      缓存的工作原理
     </strong>
    </h4>
    <p>
     缓存的核心思想是利用
     <strong>
      局部性原理
     </strong>
     （Locality Principle），包括时间局部性和空间局部性：
    </p>
    <ul>
     <li>
      <p>
       <strong>
        时间局部性
       </strong>
       ：如果一个数据被访问，那么它很可能在不久的将来再次被访问。
      </p>
     </li>
     <li>
      <p>
       <strong>
        空间局部性
       </strong>
       ：如果一个数据被访问，那么它附近的数据也可能被访问。
      </p>
     </li>
    </ul>
    <p>
     缓存通过以下机制工作：
    </p>
    <ul>
     <li>
      <p>
       <strong>
        缓存行（Cache Line）
       </strong>
       ：缓存以缓存行为单位存储数据，通常为 64 字节。当 CPU 访问一个数据时，整个缓存行会被加载到缓存中。
      </p>
     </li>
     <li>
      <p>
       <strong>
        缓存命中（Cache Hit）
       </strong>
       ：如果 CPU 需要的数据在缓存中，则直接从缓存中读取，速度极快。
      </p>
     </li>
     <li>
      <p>
       <strong>
        缓存未命中（Cache Miss）
       </strong>
       ：如果数据不在缓存中，则需要从下一级缓存或主存中加载，导致较高的延迟。
      </p>
     </li>
    </ul>
    <hr/>
    <h4>
     3.
     <strong>
      缓存一致性（Cache Coherence）
     </strong>
    </h4>
    <p>
     在多核 CPU 中，每个核心都有自己的 L1 和 L2 缓存，而 L3 缓存通常是共享的。为了确保多个核心访问同一数据时的一致性，CPU 使用
     <strong>
      缓存一致性协议
     </strong>
     （如 MESI 协议）来管理缓存数据的状态：
    </p>
    <ul>
     <li>
      <p>
       <strong>
        MESI 协议
       </strong>
       ：缓存行可以处于以下四种状态：
      </p>
      <ul>
       <li>
        <p>
         <strong>
          Modified（M）
         </strong>
         ：缓存行已被修改，与主存不一致。
        </p>
       </li>
       <li>
        <p>
         <strong>
          Exclusive（E）
         </strong>
         ：缓存行未被修改，且只存在于当前缓存中。
        </p>
       </li>
       <li>
        <p>
         <strong>
          Shared（S）
         </strong>
         ：缓存行未被修改，且可能存在于多个缓存中。
        </p>
       </li>
       <li>
        <p>
         <strong>
          Invalid（I）
         </strong>
         ：缓存行无效，不能使用。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <p>
     通过缓存一致性协议，CPU 可以确保多个核心对同一数据的访问是正确且一致的。
    </p>
    <p>
    </p>
    <p>
     <img alt="" height="881" src="https://i-blog.csdnimg.cn/direct/9da5a7c6dd2342f9b03d6f880c4482c4.png" width="1325"/>
    </p>
    <hr/>
    <h4>
     4.
     <strong>
      缓存对性能的影响
     </strong>
    </h4>
    <p>
     缓存的设计和性能对 CPU 的整体性能有重大影响：
    </p>
    <ul>
     <li>
      <p>
       <strong>
        缓存命中率
       </strong>
       ：缓存命中率越高，CPU 访问内存的延迟越低，性能越好。
      </p>
     </li>
     <li>
      <p>
       <strong>
        缓存未命中惩罚
       </strong>
       ：缓存未命中会导致 CPU 等待数据从下一级缓存或主存中加载，增加了延迟。
      </p>
     </li>
     <li>
      <p>
       <strong>
        伪共享（False Sharing）
       </strong>
       ：当多个核心频繁修改同一缓存行中的不同数据时，会导致缓存行在不同核心之间频繁无效化，降低性能。
      </p>
     </li>
    </ul>
    <hr/>
    <h4>
     5.
     <strong>
      缓存与主存的对比
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        <strong>
         特性
        </strong>
       </th>
       <th>
        <strong>
         L1 缓存
        </strong>
       </th>
       <th>
        <strong>
         L2 缓存
        </strong>
       </th>
       <th>
        <strong>
         L3 缓存
        </strong>
       </th>
       <th>
        <strong>
         主存（DRAM）
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         容量
        </strong>
       </td>
       <td>
        32KB - 64KB
       </td>
       <td>
        256KB - 1MB
       </td>
       <td>
        几 MB - 几十 MB
       </td>
       <td>
        几 GB - 几百 GB
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         速度
        </strong>
       </td>
       <td>
        最快（1-3 周期）
       </td>
       <td>
        较快（10-20 周期）
       </td>
       <td>
        较慢（30-50 周期）
       </td>
       <td>
        最慢（100-300 周期）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         位置
        </strong>
       </td>
       <td>
        每个核心独享
       </td>
       <td>
        每个核心独享或共享
       </td>
       <td>
        多个核心共享
       </td>
       <td>
        所有核心共享
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         作用
        </strong>
       </td>
       <td>
        存储最频繁使用的数据
       </td>
       <td>
        补充 L1 缓存
       </td>
       <td>
        补充 L2 缓存
       </td>
       <td>
        存储所有数据
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h4>
     6.
     <strong>
      优化缓存使用的策略
     </strong>
    </h4>
    <p>
     为了充分利用多级缓存，程序设计和内存分配可以采取以下策略：
    </p>
    <ul>
     <li>
      <p>
       <strong>
        局部性分配
       </strong>
       ：将相关的数据分配在相邻的内存区域中，提高缓存命中率。
      </p>
     </li>
     <li>
      <p>
       <strong>
        减少伪共享
       </strong>
       ：通过填充或对齐数据，避免多个核心频繁修改同一缓存行。
      </p>
     </li>
     <li>
      <p>
       <strong>
        数据预取
       </strong>
       ：通过预取技术提前将数据加载到缓存中，减少缓存未命中。
      </p>
     </li>
     <li>
      <p>
       <strong>
        缓存友好的算法
       </strong>
       ：设计算法时考虑缓存行的大小和访问模式，减少缓存未命中。
      </p>
     </li>
    </ul>
    <hr/>
    <h4>
     总结
    </h4>
    <p>
     多级缓存（L1、L2、L3）和主存构成了现代 CPU 的内存层次结构，通过减少内存访问延迟和提高数据访问速度来优化性能。缓存的设计和性能对 CPU 的整体性能有重大影响，程序设计和内存分配可以通过优化缓存使用来进一步提升性能。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33333737353737342f:61727469636c652f64657461696c732f313436313338343234" class_="artid" style="display:none">
 </p>
</div>


