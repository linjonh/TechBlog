---
layout: post
title: "python量化交易金融数据管理最佳实践使用qteasy大批量自动拉取金融数据"
date: 2025-03-05 21:39:53 +0800
description: "网上有很多金融数据（价格行情数据、基本面数据等）工具可用，但是，不是速度慢、就是限流量，或者收费高。有什么工具可以定期大批量将数据拉取过来，清洗干净，保存到本地，并集中统一管理呢？如果还能顺便做交易策略回测、优化并实盘交易更好？本文介绍如何用qteasy解决上面所有的痛点。"
keywords: "qteasy"
categories: ['量化交易', 'Qteasy', 'Python']
tags: ['金融', '量化交易', 'Python']
artid: "146053555"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146053555
    alt: "python量化交易金融数据管理最佳实践使用qteasy大批量自动拉取金融数据"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146053555
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146053555
cover: https://bing.ee123.net/img/rand?artid=146053555
image: https://bing.ee123.net/img/rand?artid=146053555
img: https://bing.ee123.net/img/rand?artid=146053555
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     python量化交易——金融数据管理最佳实践——使用qteasy大批量自动拉取金融数据
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-dracula" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <br/>
    <code>
     qteasy
    </code>
    是一个功能全面且易用的量化交易策略框架，
    <a href="https://github.com/shepherdpp/qteasy">
     Github地址
    </a>
    在这里。使用它，能轻松地获取历史数据，创建交易策略并完成回测和优化，还能实盘运行。
    <a href="https://qteasy.readthedocs.io/zh/latest/" rel="nofollow">
     项目文档
    </a>
    在这里。
    <p>
    </p>
    <p>
     使用
     <code>
      qteasy
     </code>
     ,您可以非常容易地在本地（本地电脑或者NAS服务器上）创建一个金融数据源，并自动从网上拉取大量金融数据保存在其中，以管理您的金融数据。这是一篇系列文章，前几篇文章的链接在这里：
    </p>
    <ul>
     <li>
      <a href="https://blog.csdn.net/Shepherdppz/article/details/145915580">
       创建本地数据源
      </a>
     </li>
     <li>
      <a href="https://blog.csdn.net/Shepherdppz/article/details/145951333">
       管理本地数据源
      </a>
     </li>
    </ul>
    <p>
     这篇文章介绍如何自动从网络拉取金融数据。
    </p>
    <h2>
     <a id="_9">
     </a>
     使用数据获取渠道自动填充数据
    </h2>
    <p>
     前面介绍过
     <code>
      DataSource
     </code>
     对象的基本操作方法，但是在实际使用中，我们需要往
     <code>
      DataSource
     </code>
     对象中填充大量数据，如果使用前面章节介绍的
     <code>
      DataSource.update_table_data()
     </code>
     方法手动填充数据，这样的工作量是非常大的。
    </p>
    <p>
     这里我们介绍如何使用数据获取渠道自动填充数据。
    </p>
    <h3>
     <a id="QTEASY_15">
     </a>
     QTEASY数据拉取功能
    </h3>
    <p>
     <code>
      QTEASY
     </code>
     数据管理模块:
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9d76327ea58540f7a88956b84e9c36cd.png#pic_center"/>
    </p>
    <p>
     如上图所示，
     <code>
      qteasy
     </code>
     的数据功能分为三层，第一层包括多种数据下载接口，用于从网络数据提供商获取数据，这个过程称为
     <code>
      DataFetching
     </code>
     。
    </p>
    <h3>
     <a id="refill_data_source_24">
     </a>
     数据拉取接口
     <code>
      refill_data_source()
     </code>
    </h3>
    <p>
     <code>
      qteasy
     </code>
     提供了一个自动化数据下载接口
     <code>
      qteasy.refill_data_source()
     </code>
     ，可以从多个不同的网络数据提供商拉取多种金融数据，满足不同用户的使用习惯。
     <code>
      qteasy
     </code>
     提供的数据拉取API具备强大的多线程并行下载、数据分块下载、下载流量控制和错误延时重试功能，以适应不同数据供应商各种变态的流量限制，同时数据拉取API可以方便地定期自动运行完成数据批量下载任务，不用担心错过高频数据。
    </p>
    <p>
     下面先用一个例子解释如何使用
     <code>
      qteasy.refill_data_source()
     </code>
     接口自动填充数据。我们先创建一个不含数据的
     <code>
      DataSource
     </code>
     对象，并向其中填充最基本的数据。
    </p>
    <pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> qteasy <span class="token keyword">as</span> qt
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> ds <span class="token operator">=</span> qt<span class="token punctuation">.</span>DataSource<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 检查数据源中是否有数据</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> ds<span class="token punctuation">.</span>overview<span class="token punctuation">(</span><span class="token punctuation">)</span>
Analyzing local data source tables<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> depending on size of tables<span class="token punctuation">,</span> it may take a few minutes
<span class="token punctuation">[</span><span class="token comment">########################################]104/104-100.0%  A...zing completed!</span>
Finished analyzing datasource<span class="token punctuation">:</span> 
<span class="token builtin">file</span><span class="token punctuation">:</span><span class="token operator">//</span>csv@qt_root<span class="token operator">/</span>data<span class="token operator">/</span>
<span class="token number">3</span> table<span class="token punctuation">(</span>s<span class="token punctuation">)</span> out of <span class="token number">104</span> contain local data <span class="token keyword">as</span> summary below<span class="token punctuation">,</span> to view complete <span class="token builtin">list</span><span class="token punctuation">,</span> <span class="token keyword">print</span> returned DataFrame
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>tables <span class="token keyword">with</span> local data<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
               Has_data Size_on_disk Record_count Record_start Record_end
table                                                                    
trade_calendar   <span class="token boolean">True</span>       <span class="token number">1</span><span class="token punctuation">.</span>8MB         70K          CFFEX        SZSE 
stock_basic      <span class="token boolean">True</span>       852KB          5K           <span class="token boolean">None</span>        <span class="token boolean">None</span> 
stock_daily      <span class="token boolean">True</span>      <span class="token number">98</span><span class="token punctuation">.</span>8MB        <span class="token number">1</span><span class="token punctuation">.</span>3M       <span class="token number">20211112</span>    <span class="token number">20241231</span> 
</code></pre>
    <p>
     我们可以看到，
     <code>
      DataSource
     </code>
     对象中已经有了一些数据表，为了进行下面的测试，我们将首先删除
     <code>
      trade_calendar
     </code>
     以及
     <code>
      stock_daily
     </code>
     两张数据表中的数据，然后再使用数据拉取接口自动填充它们。
    </p>
    <p>
     首先删除两张数据表，为了删除数据表，首先将数据源的
     <code>
      allow_drop_table
     </code>
     属性设置为
     <code>
      True
     </code>
     ，然后再删除数据表。
    </p>
    <pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> ds<span class="token punctuation">.</span>allow_drop_table <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> ds<span class="token punctuation">.</span>drop_table_data<span class="token punctuation">(</span><span class="token string">'trade_calendar'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> ds<span class="token punctuation">.</span>drop_table_data<span class="token punctuation">(</span><span class="token string">'stock_daily'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> ds<span class="token punctuation">.</span>allow_drop_table <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> overview <span class="token operator">=</span> ds<span class="token punctuation">.</span>overview<span class="token punctuation">(</span><span class="token punctuation">)</span>
Analyzing local data source tables<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> depending on size of tables<span class="token punctuation">,</span> it may take a few minutes
<span class="token punctuation">[</span><span class="token comment">########################################]104/104-100.0%  A...zing completed!</span>
Finished analyzing datasource<span class="token punctuation">:</span> 
<span class="token builtin">file</span><span class="token punctuation">:</span><span class="token operator">//</span>csv@qt_root<span class="token operator">/</span>data<span class="token operator">/</span>
<span class="token number">1</span> table<span class="token punctuation">(</span>s<span class="token punctuation">)</span> out of <span class="token number">104</span> contain local data <span class="token keyword">as</span> summary below<span class="token punctuation">,</span> to view complete <span class="token builtin">list</span><span class="token punctuation">,</span> <span class="token keyword">print</span> returned DataFrame
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>tables <span class="token keyword">with</span> local data<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
            Has_data Size_on_disk Record_count Record_start Record_end
table                                                                 
stock_basic   <span class="token boolean">True</span>       852KB         5K          <span class="token boolean">None</span>        <span class="token boolean">None</span>   
</code></pre>
    <p>
     可以看到，
     <code>
      trade_calendar
     </code>
     和
     <code>
      stock_daily
     </code>
     两张数据表中的数据已经被删除。
    </p>
    <p>
     接下来，我们使用
     <code>
      qteasy.refill_data_source()
     </code>
     接口自动填充数据，代码很简单，只有一行，剩下的工作
     <code>
      qteasy
     </code>
     会自动完成。
    </p>
    <pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> qt<span class="token punctuation">.</span>refill_data_source<span class="token punctuation">(</span>
        tables<span class="token operator">=</span><span class="token string">'stock_daily'</span><span class="token punctuation">,</span>  <span class="token comment"># 指定要填充的数据表：股票日K线数据</span>
        channel<span class="token operator">=</span><span class="token string">'tushare'</span><span class="token punctuation">,</span>  <span class="token comment"># 指定数据下载渠道</span>
        data_source<span class="token operator">=</span>ds<span class="token punctuation">,</span>  <span class="token comment"># 指定需要填充的数据源对象</span>
        start_date<span class="token operator">=</span><span class="token string">'20210101'</span><span class="token punctuation">,</span>  <span class="token comment"># 指定数据下载的起始日期</span>
        end_date<span class="token operator">=</span><span class="token string">'20211231'</span><span class="token punctuation">,</span>  <span class="token comment"># 指定数据下载的结束日期</span>
<span class="token punctuation">)</span>

Filling data source <span class="token builtin">file</span><span class="token punctuation">:</span><span class="token operator">//</span>csv@qt_root<span class="token operator">/</span>data<span class="token operator">/</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
into <span class="token number">2</span> table<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">(</span>parallely<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'stock_daily'</span><span class="token punctuation">,</span> <span class="token string">'trade_calendar'</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token comment">########################################]243/243-100.0%  &lt;stock_daily&gt; 2398764 wrtn in about 16 sec                 </span>
<span class="token punctuation">[</span><span class="token comment">########################################]7/7-100.0%  &lt;trade_calendar&gt; 70054 wrtn in about 1 sec                     </span>
                    
Data refill completed! <span class="token number">2468818</span> rows written into <span class="token number">2</span><span class="token operator">/</span><span class="token number">2</span> table<span class="token punctuation">(</span>s<span class="token punctuation">)</span>!
</code></pre>
    <p>
     拉取并填充数据后，可以检查数据已经下载成功了：
    </p>
    <pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> ds<span class="token punctuation">.</span>read_table_data<span class="token punctuation">(</span><span class="token string">'stock_daily'</span><span class="token punctuation">,</span> shares<span class="token operator">=</span><span class="token string">'000001.SZ, 000002.SZ'</span><span class="token punctuation">,</span> start<span class="token operator">=</span><span class="token string">'20211111'</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'20211131'</span><span class="token punctuation">)</span>

                       <span class="token builtin">open</span>   high    low  close  pre_close  change  pct_chg  \
ts_code   trade_date                                                           
<span class="token number">000001</span><span class="token punctuation">.</span>SZ <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">11</span>  <span class="token number">17.35</span>  <span class="token number">18.43</span>  <span class="token number">17.32</span>  <span class="token number">18.35</span>      <span class="token number">17.40</span>    <span class="token number">0.95</span>   <span class="token number">5.4598</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12</span>  <span class="token number">18.31</span>  <span class="token number">18.63</span>  <span class="token number">18.11</span>  <span class="token number">18.27</span>      <span class="token number">18.35</span>   <span class="token operator">-</span><span class="token number">0.08</span>  <span class="token operator">-</span><span class="token number">0.4360</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>  <span class="token number">18.35</span>  <span class="token number">18.63</span>  <span class="token number">18.20</span>  <span class="token number">18.43</span>      <span class="token number">18.27</span>    <span class="token number">0.16</span>   <span class="token number">0.8758</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">16</span>  <span class="token number">18.36</span>  <span class="token number">18.54</span>  <span class="token number">18.17</span>  <span class="token number">18.22</span>      <span class="token number">18.43</span>   <span class="token operator">-</span><span class="token number">0.21</span>  <span class="token operator">-</span><span class="token number">1.1394</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span>  <span class="token number">18.15</span>  <span class="token number">18.30</span>  <span class="token number">17.98</span>  <span class="token number">18.11</span>      <span class="token number">18.22</span>   <span class="token operator">-</span><span class="token number">0.11</span>  <span class="token operator">-</span><span class="token number">0.6037</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">18</span>  <span class="token number">18.09</span>  <span class="token number">18.12</span>  <span class="token number">17.73</span>  <span class="token number">17.80</span>      <span class="token number">18.11</span>   <span class="token operator">-</span><span class="token number">0.31</span>  <span class="token operator">-</span><span class="token number">1.7118</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">19</span>  <span class="token number">17.80</span>  <span class="token number">18.24</span>  <span class="token number">17.70</span>  <span class="token number">18.15</span>      <span class="token number">17.80</span>    <span class="token number">0.35</span>   <span class="token number">1.9663</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">22</span>  <span class="token number">18.03</span>  <span class="token number">18.25</span>  <span class="token number">17.90</span>  <span class="token number">18.12</span>      <span class="token number">18.15</span>   <span class="token operator">-</span><span class="token number">0.03</span>  <span class="token operator">-</span><span class="token number">0.1653</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">23</span>  <span class="token number">18.11</span>  <span class="token number">18.35</span>  <span class="token number">17.68</span>  <span class="token number">17.88</span>      <span class="token number">18.12</span>   <span class="token operator">-</span><span class="token number">0.24</span>  <span class="token operator">-</span><span class="token number">1.3245</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">24</span>  <span class="token number">17.77</span>  <span class="token number">17.95</span>  <span class="token number">17.66</span>  <span class="token number">17.87</span>      <span class="token number">17.88</span>   <span class="token operator">-</span><span class="token number">0.01</span>  <span class="token operator">-</span><span class="token number">0.0559</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">25</span>  <span class="token number">17.74</span>  <span class="token number">17.79</span>  <span class="token number">17.63</span>  <span class="token number">17.68</span>      <span class="token number">17.87</span>   <span class="token operator">-</span><span class="token number">0.19</span>  <span class="token operator">-</span><span class="token number">1.0632</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">26</span>  <span class="token number">17.62</span>  <span class="token number">17.67</span>  <span class="token number">17.52</span>  <span class="token number">17.58</span>      <span class="token number">17.68</span>   <span class="token operator">-</span><span class="token number">0.10</span>  <span class="token operator">-</span><span class="token number">0.5656</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">29</span>  <span class="token number">17.41</span>  <span class="token number">17.57</span>  <span class="token number">17.36</span>  <span class="token number">17.51</span>      <span class="token number">17.58</span>   <span class="token operator">-</span><span class="token number">0.07</span>  <span class="token operator">-</span><span class="token number">0.3982</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">30</span>  <span class="token number">17.54</span>  <span class="token number">17.68</span>  <span class="token number">17.35</span>  <span class="token number">17.44</span>      <span class="token number">17.51</span>   <span class="token operator">-</span><span class="token number">0.07</span>  <span class="token operator">-</span><span class="token number">0.3998</span>   
<span class="token number">000002</span><span class="token punctuation">.</span>SZ <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">11</span>  <span class="token number">18.95</span>  <span class="token number">20.84</span>  <span class="token number">18.89</span>  <span class="token number">20.79</span>      <span class="token number">18.98</span>    <span class="token number">1.81</span>   <span class="token number">9.5364</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12</span>  <span class="token number">20.50</span>  <span class="token number">20.50</span>  <span class="token number">19.41</span>  <span class="token number">19.76</span>      <span class="token number">20.79</span>   <span class="token operator">-</span><span class="token number">1.03</span>  <span class="token operator">-</span><span class="token number">4.9543</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>  <span class="token number">19.56</span>  <span class="token number">19.59</span>  <span class="token number">19.12</span>  <span class="token number">19.40</span>      <span class="token number">19.76</span>   <span class="token operator">-</span><span class="token number">0.36</span>  <span class="token operator">-</span><span class="token number">1.8219</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">16</span>  <span class="token number">19.29</span>  <span class="token number">19.57</span>  <span class="token number">19.21</span>  <span class="token number">19.24</span>      <span class="token number">19.40</span>   <span class="token operator">-</span><span class="token number">0.16</span>  <span class="token operator">-</span><span class="token number">0.8247</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span>  <span class="token number">19.23</span>  <span class="token number">19.53</span>  <span class="token number">19.09</span>  <span class="token number">19.46</span>      <span class="token number">19.24</span>    <span class="token number">0.22</span>   <span class="token number">1.1435</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">18</span>  <span class="token number">19.35</span>  <span class="token number">19.40</span>  <span class="token number">18.98</span>  <span class="token number">19.09</span>      <span class="token number">19.46</span>   <span class="token operator">-</span><span class="token number">0.37</span>  <span class="token operator">-</span><span class="token number">1.9013</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">19</span>  <span class="token number">19.01</span>  <span class="token number">20.28</span>  <span class="token number">18.92</span>  <span class="token number">19.90</span>      <span class="token number">19.09</span>    <span class="token number">0.81</span>   <span class="token number">4.2431</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">22</span>  <span class="token number">19.90</span>  <span class="token number">19.95</span>  <span class="token number">19.19</span>  <span class="token number">19.22</span>      <span class="token number">19.90</span>   <span class="token operator">-</span><span class="token number">0.68</span>  <span class="token operator">-</span><span class="token number">3.4171</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">23</span>  <span class="token number">19.19</span>  <span class="token number">19.44</span>  <span class="token number">19.10</span>  <span class="token number">19.24</span>      <span class="token number">19.22</span>    <span class="token number">0.02</span>   <span class="token number">0.1041</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">24</span>  <span class="token number">19.12</span>  <span class="token number">19.38</span>  <span class="token number">19.00</span>  <span class="token number">19.30</span>      <span class="token number">19.24</span>    <span class="token number">0.06</span>   <span class="token number">0.3119</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">25</span>  <span class="token number">19.22</span>  <span class="token number">19.35</span>  <span class="token number">19.07</span>  <span class="token number">19.22</span>      <span class="token number">19.30</span>   <span class="token operator">-</span><span class="token number">0.08</span>  <span class="token operator">-</span><span class="token number">0.4145</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">26</span>  <span class="token number">19.15</span>  <span class="token number">19.15</span>  <span class="token number">18.95</span>  <span class="token number">18.99</span>      <span class="token number">19.22</span>   <span class="token operator">-</span><span class="token number">0.23</span>  <span class="token operator">-</span><span class="token number">1.1967</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">29</span>  <span class="token number">18.75</span>  <span class="token number">18.87</span>  <span class="token number">18.35</span>  <span class="token number">18.46</span>      <span class="token number">18.99</span>   <span class="token operator">-</span><span class="token number">0.53</span>  <span class="token operator">-</span><span class="token number">2.7909</span>   
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">30</span>  <span class="token number">18.44</span>  <span class="token number">18.66</span>  <span class="token number">18.16</span>  <span class="token number">18.26</span>      <span class="token number">18.46</span>   <span class="token operator">-</span><span class="token number">0.20</span>  <span class="token operator">-</span><span class="token number">1.0834</span>   

                             vol       amount  
ts_code   trade_date                           
<span class="token number">000001</span><span class="token punctuation">.</span>SZ <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">11</span>  <span class="token number">2084729.00</span>  <span class="token number">3752413.858</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12</span>   <span class="token number">957546.46</span>  <span class="token number">1753072.716</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>   <span class="token number">655089.99</span>  <span class="token number">1203764.095</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">16</span>   <span class="token number">601110.48</span>  <span class="token number">1099113.409</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span>   <span class="token number">664640.38</span>  <span class="token number">1203859.180</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">18</span>   <span class="token number">799843.77</span>  <span class="token number">1430058.311</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">19</span>   <span class="token number">786371.56</span>  <span class="token number">1414506.380</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">22</span>   <span class="token number">738617.80</span>  <span class="token number">1337768.172</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">23</span>  <span class="token number">1235977.96</span>  <span class="token number">2213817.590</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">24</span>   <span class="token number">741310.84</span>  <span class="token number">1316774.397</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">25</span>   <span class="token number">603532.70</span>  <span class="token number">1068221.304</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">26</span>   <span class="token number">694499.88</span>  <span class="token number">1219937.312</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">29</span>   <span class="token number">512594.71</span>   <span class="token number">895105.981</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">30</span>   <span class="token number">733616.06</span>  <span class="token number">1280384.552</span>  
<span class="token number">000002</span><span class="token punctuation">.</span>SZ <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">11</span>  <span class="token number">3151015.76</span>  <span class="token number">6352746.112</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12</span>  <span class="token number">2065924.12</span>  <span class="token number">4100076.111</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>   <span class="token number">959331.52</span>  <span class="token number">1852352.374</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">16</span>   <span class="token number">593989.40</span>  <span class="token number">1149085.955</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span>   <span class="token number">623749.71</span>  <span class="token number">1205064.294</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">18</span>   <span class="token number">609995.75</span>  <span class="token number">1168010.581</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">19</span>  <span class="token number">1308293.09</span>  <span class="token number">2570652.947</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">22</span>   <span class="token number">877584.30</span>  <span class="token number">1697701.639</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">23</span>   <span class="token number">563435.65</span>  <span class="token number">1083646.252</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">24</span>   <span class="token number">827366.98</span>  <span class="token number">1587246.249</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">25</span>   <span class="token number">518123.06</span>   <span class="token number">995473.890</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">26</span>   <span class="token number">504023.33</span>   <span class="token number">959331.064</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">29</span>   <span class="token number">718595.81</span>  <span class="token number">1334479.867</span>  
          <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">30</span>   <span class="token number">713092.22</span>  <span class="token number">1305310.857</span>
</code></pre>
    <h3>
     <a id="API_157">
     </a>
     数据拉取API的功能特性
    </h3>
    <p>
     分析数据拉取的过程，我们可以看到，
     <code>
      qteasy
     </code>
     自动完成了下面的工作：
    </p>
    <ul>
     <li>
      <strong>
       自动查找依赖表
      </strong>
      —— 虽然我们只指定了
      <code>
       stock_daily
      </code>
      数据表，但是
      <code>
       qteasy
      </code>
      自动检测到
      <code>
       trade_calendar
      </code>
      数据表也是空的，且
      <code>
       stock_daily
      </code>
      表依赖交易日历表，所以也自动填充了
      <code>
       trade_calendar
      </code>
      数据表。
     </li>
     <li>
      <strong>
       下载进度可视化
      </strong>
      ——
      <code>
       qteasy
      </code>
      提供了下载进度可视化，可以看到每个数据分块的下载进度，以及总体下载进度，过程中可以显示剩余时间，方便用户查看数据下载的情况。
     </li>
     <li>
      <strong>
       大数据量自动分块
      </strong>
      —— 上面的代码下载了2021年全年所有股票的日K线数据，这些数据量共有239万行，不管从任何数据渠道，这么大量的数据都不可能一次性下载下来，因此，
      <code>
       qteasy
      </code>
      自动将数据分块，每一块只有一天的数据，可以看到整年的数据被分成了243块，数据分块下载显著降低了每次网络申请的数据量，提高成功率且降低了被阻断的风险。
     </li>
     <li>
      <strong>
       多线程并行下载
      </strong>
      —— 实行数据分块下载后，
      <code>
       qteasy
      </code>
      自动使用多线程并行下载，加快数据下载速度，243个数据分块并行下载总共耗时仅16秒。
     </li>
    </ul>
    <p>
     有了上面这些特性，
     <code>
      qteasy
     </code>
     的数据拉取功能可以满足几乎所有用户的数据获取需求，不管是下载大量数据，还是下载高频数据，
     <code>
      qteasy
     </code>
     都能提供高效的数据下载服务。
    </p>
    <p>
     当然，除了上面提到的这些特性之外，
     <code>
      qteasy
     </code>
     还提供了更多的功能特性，以针对下载过程中出现的各种状况，这些功能特性我们在后面会逐步介绍：
    </p>
    <ul>
     <li>
      <strong>
       多渠道下载
      </strong>
      ——
      <code>
       qteasy
      </code>
      提供了多种数据下载渠道，很多数据表可以从多个不同的渠道下载，而且随着版本更新，数据拉取渠道也在不断增加。
     </li>
     <li>
      <strong>
       流量控制
      </strong>
      —— 有些数据渠道对数据下载有流量限制，
      <code>
       qteasy
      </code>
      提供了流量控制功能，可以限制数据下载的速度，即下载一定分块数量的数据后，可以暂停一段时间，例如每下载300个分块的数据，就暂停一分钟，避免被数据渠道封禁。
     </li>
     <li>
      <strong>
       错误重试
      </strong>
      —— 有些数据渠道下载数据时，可能会出现网络错误，
      <code>
       qteasy
      </code>
      提供了错误重试功能，可以在下载失败后，自动重试下载，如果重试不成功，会延长重试等待时间再试，直到下载成功或超过重试次数并报错。
     </li>
     <li>
      <strong>
       日志记录
      </strong>
      ——
      <code>
       qteasy
      </code>
      提供了数据下载日志记录功能，可以记录每次数据下载的详细信息，包括下载的数据量、下载的时间、下载的速度等，方便用户查看数据下载的情况。
     </li>
    </ul>
    <h4>
     <a id="_175">
     </a>
     多渠道拉取数据
    </h4>
    <p>
     <code>
      qteasy
     </code>
     提供了多种数据下载渠道，很多数据表可以从多个不同的渠道下载，而且随着版本更新，数据拉取渠道也在不断增加。
    </p>
    <p>
     refill_data_source()接口的channel参数可以指定数据下载渠道，如果不指定，
     <code>
      qteasy
     </code>
     会自动选择一个默认的数据下载渠道
     <code>
      tushare
     </code>
     ，但是用户也可以手动指定数据下载渠道，例如 ：
    </p>
    <p>
     下面的代码尝试从
     <code>
      eastmoney
     </code>
     数据渠道下载
     <code>
      stock_daily
     </code>
     数据表从2025年最初两个月的日K线数据：
    </p>
    <pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> qt<span class="token punctuation">.</span>refill_data_source<span class="token punctuation">(</span>
        tables<span class="token operator">=</span><span class="token string">'stock_daily'</span><span class="token punctuation">,</span> 
        channel<span class="token operator">=</span><span class="token string">'eastmoney'</span><span class="token punctuation">,</span>   <span class="token comment"># 指定数据下载渠道为东方财经</span>
        data_source<span class="token operator">=</span>ds<span class="token punctuation">,</span> 
        start_date<span class="token operator">=</span><span class="token string">'20250101'</span><span class="token punctuation">,</span> 
        end_date<span class="token operator">=</span><span class="token string">'20250301'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

Filling data source <span class="token builtin">file</span><span class="token punctuation">:</span><span class="token operator">//</span>csv@qt_root<span class="token operator">/</span>data<span class="token operator">/</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
into <span class="token number">2</span> table<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">(</span>parallely<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'stock_daily'</span><span class="token punctuation">,</span> <span class="token string">'stock_basic'</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token comment">########################################]11078/11078-100.0%  &lt;stock_daily&gt; 131264304 wrtn in about 17 min           </span>
<span class="token punctuation">[</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token punctuation">]</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">0.0</span><span class="token operator">%</span>  <span class="token operator">&lt;</span>stock_basic<span class="token operator">&gt;</span> can't be fetched <span class="token keyword">from</span> channel<span class="token punctuation">:</span>eastmoney!
          
Data refill completed! <span class="token number">131264304</span> rows written into <span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span> table<span class="token punctuation">(</span>s<span class="token punctuation">)</span>!
</code></pre>
    <p>
     验证一下数据是否下载成功：
    </p>
    <pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> ds<span class="token punctuation">.</span>read_table_data<span class="token punctuation">(</span><span class="token string">'stock_daily'</span><span class="token punctuation">,</span> shares<span class="token operator">=</span><span class="token string">'000001.SZ, 000002.SZ'</span><span class="token punctuation">,</span> start<span class="token operator">=</span><span class="token string">'20250101'</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'20250103'</span><span class="token punctuation">)</span>

                       <span class="token builtin">open</span>   high    low  close  pre_close  change  pct_chg  \
ts_code   trade_date                                                           
<span class="token number">000001</span><span class="token punctuation">.</span>SZ <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">13</span>  <span class="token number">11.25</span>  <span class="token number">11.26</span>  <span class="token number">11.08</span>  <span class="token number">11.20</span>      <span class="token number">11.30</span>   <span class="token operator">-</span><span class="token number">0.10</span>  <span class="token operator">-</span><span class="token number">0.8850</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">14</span>  <span class="token number">11.20</span>  <span class="token number">11.40</span>  <span class="token number">11.19</span>  <span class="token number">11.38</span>      <span class="token number">11.20</span>    <span class="token number">0.18</span>   <span class="token number">1.6071</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">15</span>  <span class="token number">11.38</span>  <span class="token number">11.58</span>  <span class="token number">11.36</span>  <span class="token number">11.48</span>      <span class="token number">11.38</span>    <span class="token number">0.10</span>   <span class="token number">0.8787</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">16</span>  <span class="token number">11.55</span>  <span class="token number">11.59</span>  <span class="token number">11.47</span>  <span class="token number">11.57</span>      <span class="token number">11.48</span>    <span class="token number">0.09</span>   <span class="token number">0.7840</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">17</span>  <span class="token number">11.53</span>  <span class="token number">11.55</span>  <span class="token number">11.42</span>  <span class="token number">11.45</span>      <span class="token number">11.57</span>   <span class="token operator">-</span><span class="token number">0.12</span>  <span class="token operator">-</span><span class="token number">1.0372</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">20</span>  <span class="token number">11.50</span>  <span class="token number">11.52</span>  <span class="token number">11.40</span>  <span class="token number">11.42</span>      <span class="token number">11.45</span>   <span class="token operator">-</span><span class="token number">0.03</span>  <span class="token operator">-</span><span class="token number">0.2620</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">21</span>  <span class="token number">11.45</span>  <span class="token number">11.45</span>  <span class="token number">11.32</span>  <span class="token number">11.33</span>      <span class="token number">11.42</span>   <span class="token operator">-</span><span class="token number">0.09</span>  <span class="token operator">-</span><span class="token number">0.7881</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">22</span>  <span class="token number">11.32</span>  <span class="token number">11.33</span>  <span class="token number">11.08</span>  <span class="token number">11.09</span>      <span class="token number">11.33</span>   <span class="token operator">-</span><span class="token number">0.24</span>  <span class="token operator">-</span><span class="token number">2.1183</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span>  <span class="token number">11.17</span>  <span class="token number">11.40</span>  <span class="token number">11.17</span>  <span class="token number">11.32</span>      <span class="token number">11.09</span>    <span class="token number">0.23</span>   <span class="token number">2.0739</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">24</span>  <span class="token number">11.32</span>  <span class="token number">11.39</span>  <span class="token number">11.22</span>  <span class="token number">11.34</span>      <span class="token number">11.32</span>    <span class="token number">0.02</span>   <span class="token number">0.1767</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">27</span>  <span class="token number">11.38</span>  <span class="token number">11.55</span>  <span class="token number">11.38</span>  <span class="token number">11.47</span>      <span class="token number">11.34</span>    <span class="token number">0.13</span>   <span class="token number">1.1464</span>   
<span class="token number">000002</span><span class="token punctuation">.</span>SZ <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">13</span>   <span class="token number">6.60</span>   <span class="token number">6.77</span>   <span class="token number">6.55</span>   <span class="token number">6.76</span>       <span class="token number">6.69</span>    <span class="token number">0.07</span>   <span class="token number">1.0463</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">14</span>   <span class="token number">6.76</span>   <span class="token number">6.93</span>   <span class="token number">6.75</span>   <span class="token number">6.91</span>       <span class="token number">6.76</span>    <span class="token number">0.15</span>   <span class="token number">2.2189</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">15</span>   <span class="token number">6.88</span>   <span class="token number">6.96</span>   <span class="token number">6.79</span>   <span class="token number">6.86</span>       <span class="token number">6.91</span>   <span class="token operator">-</span><span class="token number">0.05</span>  <span class="token operator">-</span><span class="token number">0.7236</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">16</span>   <span class="token number">6.90</span>   <span class="token number">7.07</span>   <span class="token number">6.84</span>   <span class="token number">6.88</span>       <span class="token number">6.86</span>    <span class="token number">0.02</span>   <span class="token number">0.2915</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">17</span>   <span class="token number">6.58</span>   <span class="token number">6.65</span>   <span class="token number">6.45</span>   <span class="token number">6.63</span>       <span class="token number">6.88</span>   <span class="token operator">-</span><span class="token number">0.25</span>  <span class="token operator">-</span><span class="token number">3.6337</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">20</span>   <span class="token number">6.60</span>   <span class="token number">6.94</span>   <span class="token number">6.48</span>   <span class="token number">6.85</span>       <span class="token number">6.63</span>    <span class="token number">0.22</span>   <span class="token number">3.3183</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">21</span>   <span class="token number">6.84</span>   <span class="token number">7.54</span>   <span class="token number">6.82</span>   <span class="token number">7.36</span>       <span class="token number">6.85</span>    <span class="token number">0.51</span>   <span class="token number">7.4453</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">22</span>   <span class="token number">7.27</span>   <span class="token number">7.36</span>   <span class="token number">6.98</span>   <span class="token number">7.02</span>       <span class="token number">7.36</span>   <span class="token operator">-</span><span class="token number">0.34</span>  <span class="token operator">-</span><span class="token number">4.6196</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span>   <span class="token number">7.15</span>   <span class="token number">7.70</span>   <span class="token number">7.08</span>   <span class="token number">7.36</span>       <span class="token number">7.02</span>    <span class="token number">0.34</span>   <span class="token number">4.8433</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">24</span>   <span class="token number">7.33</span>   <span class="token number">7.54</span>   <span class="token number">7.21</span>   <span class="token number">7.39</span>       <span class="token number">7.36</span>    <span class="token number">0.03</span>   <span class="token number">0.4076</span>   
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">27</span>   <span class="token number">7.38</span>   <span class="token number">7.56</span>   <span class="token number">7.22</span>   <span class="token number">7.27</span>       <span class="token number">7.39</span>   <span class="token operator">-</span><span class="token number">0.12</span>  <span class="token operator">-</span><span class="token number">1.6238</span>   

                            vol       amount  
ts_code   trade_date                          
<span class="token number">000001</span><span class="token punctuation">.</span>SZ <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">13</span>   <span class="token number">934966.0</span>  <span class="token number">1044904.416</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">14</span>   <span class="token number">824629.0</span>   <span class="token number">934467.766</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">15</span>  <span class="token number">1031631.0</span>  <span class="token number">1185403.653</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">16</span>   <span class="token number">872964.0</span>  <span class="token number">1007689.274</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">17</span>   <span class="token number">689765.0</span>   <span class="token number">791230.419</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">20</span>   <span class="token number">832029.0</span>   <span class="token number">953092.179</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">21</span>   <span class="token number">902069.0</span>  <span class="token number">1024879.174</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">22</span>  <span class="token number">1347129.0</span>  <span class="token number">1504818.607</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span>  <span class="token number">1514920.0</span>  <span class="token number">1715172.472</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">24</span>   <span class="token number">944944.0</span>  <span class="token number">1069899.088</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">27</span>  <span class="token number">1151935.0</span>  <span class="token number">1324270.607</span>  
<span class="token number">000002</span><span class="token punctuation">.</span>SZ <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">13</span>   <span class="token number">911147.0</span>   <span class="token number">611005.036</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">14</span>  <span class="token number">1116454.0</span>   <span class="token number">765177.082</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">15</span>   <span class="token number">887294.0</span>   <span class="token number">608363.557</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">16</span>  <span class="token number">1110545.0</span>   <span class="token number">771648.218</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">17</span>  <span class="token number">3620283.0</span>  <span class="token number">2369977.993</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">20</span>  <span class="token number">2988167.0</span>  <span class="token number">2009728.944</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">21</span>  <span class="token number">5849397.0</span>  <span class="token number">4290640.172</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">22</span>  <span class="token number">3448728.0</span>  <span class="token number">2457396.391</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span>  <span class="token number">4416581.0</span>  <span class="token number">3245710.622</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">24</span>  <span class="token number">2555024.0</span>  <span class="token number">1885566.128</span>  
          <span class="token number">2025</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">27</span>  <span class="token number">2151753.0</span>  <span class="token number">1580357.769</span>  
</code></pre>
    <p>
     数据下载显然也是成功的。分析上面的下载过程，可以发现几个特点：
    </p>
    <ul>
     <li>
      不同渠道下载的数据格式是相同的，这是
      <code>
       qteasy
      </code>
      的设计原则，不同的数据下载渠道下载的数据会经历相同的清洗过程，这样用户可以方便地切换不同的数据下载渠道，而不用担心数据格式不同导致的数据处理问题。
     </li>
     <li>
      不同的渠道下载分块方式不同，导致下载速度不同，
      <code>
       eastmoney
      </code>
      数据渠道下载速度较慢，需要约17分钟才能下载完成。这是由于不同下载渠道的特殊限制决定的。
     </li>
     <li>
      不同渠道的下载可以下载的数据表也不同，有些数据表无法通过某些渠道下载，可能是因为权限限制或者其他因素导致的，如果某个数据表无法下载，
      <code>
       qteasy
      </code>
      会自动跳过这个数据表，不会影响其他数据表的下载。
     </li>
    </ul>
    <p>
     因此，用户需要根据自身的情况选择不同的渠道拉取数据。
    </p>
    <h4>
     <a id="_263">
     </a>
     实现下载流量控制
    </h4>
    <p>
     <code>
      qteasy
     </code>
     的
     <code>
      refill_data_source
     </code>
     提供了流量控制功能，可以限制数据下载的速度，即下载一定分块数量的数据后，可以暂停一段时间，例如每下载300个分块的数据，就暂停一分钟，避免被数据渠道封禁。
    </p>
    <p>
     这个功能通过refill_data_source()接口的
     <code>
      download_batch_size
     </code>
     和
     <code>
      download_batch_interval
     </code>
     两个参数实现：
    </p>
    <ul>
     <li>
      <code>
       download_batch_size
      </code>
      参数指定每次下载的数据分块数量，如果设置为300，则在下载300个数据分块后，会暂停一段时间。
     </li>
     <li>
      <code>
       download_batch_interval
      </code>
      参数指定每次下载数据分块后的暂停时间，默认为0，即不暂停。
     </li>
    </ul>
    <p>
     下面的代码演示了如何使用
     <code>
      download_batch_size
     </code>
     和
     <code>
      download_batch_interval
     </code>
     参数实现下载流量控制：
    </p>
    <pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> qt<span class="token punctuation">.</span>refill_data_source<span class="token punctuation">(</span>
        tables<span class="token operator">=</span><span class="token string">'stock_daily'</span><span class="token punctuation">,</span>
        channel<span class="token operator">=</span><span class="token string">'tushare'</span><span class="token punctuation">,</span>
        data_source<span class="token operator">=</span>ds<span class="token punctuation">,</span> 
        start_date<span class="token operator">=</span><span class="token string">'20250101'</span><span class="token punctuation">,</span> 
        end_date<span class="token operator">=</span><span class="token string">'20250301'</span><span class="token punctuation">,</span> 
        download_batch_size<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span>  <span class="token comment"># 每次下载300个数据分块</span>
        download_batch_interval<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span>  <span class="token comment"># 每次下载300个数据分块后暂停60秒</span>
<span class="token punctuation">)</span>
</code></pre>
    <p>
     如果是用流量控制，当然下载时间会变长，但是对于某些数据渠道，这是必须的，否则可能会被封禁或报错导致下载失败。
    </p>
    <h4>
     <a id="_288">
     </a>
     实现错误重试
    </h4>
    <p>
     需要注意的是，数据下载过程中出错，
     <code>
      qteasy
     </code>
     会自动重试下载，重试机制如下：
    </p>
    <ul>
     <li>
      第一次下载失败后重试之前会等待一段时间，默认等待时间为1.0秒
     </li>
     <li>
      每次重试失败后，等待时间都会增加，默认等待时间增加为2倍，即第一次等待1.0秒，第二次等待2.0秒，第三次等待4.0秒，以此类推。
     </li>
     <li>
      重试超过最大限额后停止重试并报错，默认情况下最多重复7次。
     </li>
    </ul>
    <p>
     以上三个错误重试参数都是通过
     <code>
      qteasy
     </code>
     的配置文件在设定的，用户可以通过
     <code>
      qt.config()
     </code>
     接口查看或修改这些参数，也可以在
     <code>
      qteasy
     </code>
     的初始配置文件中修改这些参数。
    </p>
    <ul>
     <li>
      <code>
       hist_dnld_retry_cnt
      </code>
      - 最大重试次数，默认为7次
     </li>
     <li>
      <code>
       hist_dnld_retry_wait
      </code>
      - 第一次重试等待时间，默认为1.0秒
     </li>
     <li>
      <code>
       hist_dnld_backoff
      </code>
      - 重试等待时间增加倍数，默认为2.0
     </li>
    </ul>
    <p>
     关于如何修改配置文件，或者使用
     <code>
      qteasy
     </code>
     的初始配置文件，请参考
     <a href="https://qteasy.readthedocs.io/zh-cn/latest/api/api_reference.html" rel="nofollow">
      <code>
       qteasy
      </code>
      的配置文件章节
     </a>
     。
    </p>
    <h4>
     <a id="_304">
     </a>
     日志记录
    </h4>
    <p>
     <code>
      qteasy
     </code>
     提供了数据下载日志记录功能，可以记录每次数据下载的详细信息，包括下载的数据量、下载的时间、下载的速度等，方便用户查看数据下载的情况。
    </p>
    <h4>
     <a id="_308">
     </a>
     其他功能
    </h4>
    <p>
     <code>
      qteasy
     </code>
     的
     <code>
      refill_data_source()
     </code>
     接口还提供了其他一些功能，例如：
    </p>
    <ul>
     <li>
      限制下载数据的范围，可以通过
      <code>
       start_date
      </code>
      和
      <code>
       end_date
      </code>
      参数限制下载数据的时间范围，通过
      <code>
       shares
      </code>
      参数限制下载数据的股票范围。
     </li>
     <li>
      设置是否并行下载，可以通过
      <code>
       parallel
      </code>
      参数设置是否并行下载，如果设置为False，则会串行下载，否则会并行下载。
     </li>
     <li>
      设置是否下载依赖表，可以通过
      <code>
       download_dependent
      </code>
      参数设置是否下载依赖表，如果设置为False，则不会下载依赖表，否则会下载依赖表。
     </li>
     <li>
      设置是否强制更新交易日历表。
     </li>
    </ul>
    <p>
     其他更多关于该接口的解释，请参见
     <code>
      qteasy
     </code>
     的
     <a href="https://qteasy.readthedocs.io/zh-cn/latest/api/history_data.html" rel="nofollow">
      API文档
     </a>
     。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f536865706865726470707a2f:61727469636c652f64657461696c732f313436303533353535" class_="artid" style="display:none">
 </p>
</div>


