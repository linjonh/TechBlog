---
layout: post
title: "Redisè°ƒä¼˜ä»è€ç‰›è½¦åˆ°ç£æ‚¬æµ®çš„é£™è½¦æŒ‡å—"
date: 2025-03-16 00:08:28 +0800
description: "å„ä½è¢«Redisæ€§èƒ½æŒ‰åœ¨åœ°ä¸Šæ‘©æ“¦çš„è½¦æ‰‹ä»¬ï¼ä»Šå¤©æˆ‘ä»¬è¦æŠŠè¿™è¾†è€ç‰›ç ´è½¦æ”¹è£…æˆè´´åœ°é£è¡Œçš„ç£æ‚¬æµ®ï¼ä»æ¯ç§’æ’‘æ­»å‡ åƒQPSçš„ç»æœ›ï¼Œåˆ°ç™¾ä¸‡çº§ååé‡çš„çœŸé¦™ç°åœºï¼Œç³»å¥½å®‰å…¨å¸¦ï¼Œå‡†å¤‡å¼€å¯æ€§èƒ½å‹æ¦¨çš„ç‹‚æš´æ¨¡å¼ï¼ç°åœ¨ä½ çš„Rediså·²ç»å˜èº«æ€§èƒ½æ€ªå…½ï¼ä¸è¿‡å‹æƒ…æç¤ºâ€”â€”è¿™ä¸ªçº§åˆ«çš„ä¼˜åŒ–æˆæœï¼Œå¯èƒ½ä¼šè®©è¿ç»´åŒäº‹ä»¥ä¸ºä½ ç»™Rediså—‘äº†å…´å¥‹å‰‚ï¼ï¼ˆå‰©ä¸‹1%è¯·å‡çº§ç¡¬ä»¶è§£å†³ï¼‰"
keywords: "Redisè°ƒä¼˜ï¼šä»è€ç‰›è½¦åˆ°ç£æ‚¬æµ®çš„é£™è½¦æŒ‡å—"
categories: ['ä¸šåŠ¡ç³»ç»Ÿåº”ç”¨æŠ€æœ¯', 'Java']
tags: ['ç¼“å­˜', 'æ•°æ®åº“', 'Spring', 'Redis', 'Java', 'Boot']
artid: "146288157"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146288157
    alt: "Redisè°ƒä¼˜ä»è€ç‰›è½¦åˆ°ç£æ‚¬æµ®çš„é£™è½¦æŒ‡å—"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146288157
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146288157
cover: https://bing.ee123.net/img/rand?artid=146288157
image: https://bing.ee123.net/img/rand?artid=146288157
img: https://bing.ee123.net/img/rand?artid=146288157
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Redisè°ƒä¼˜ï¼šä»è€ç‰›è½¦åˆ°ç£æ‚¬æµ®çš„é£™è½¦æŒ‡å—
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     å„ä½è¢«Redisæ€§èƒ½æŒ‰åœ¨åœ°ä¸Šæ‘©æ“¦çš„è½¦æ‰‹ä»¬ï¼ä»Šå¤©æˆ‘ä»¬è¦æŠŠè¿™è¾†è€ç‰›ç ´è½¦æ”¹è£…æˆè´´åœ°é£è¡Œçš„ç£æ‚¬æµ®ï¼ä»æ¯ç§’æ’‘æ­»å‡ åƒQPSçš„ç»æœ›ï¼Œåˆ°ç™¾ä¸‡çº§ååé‡çš„çœŸé¦™ç°åœºï¼Œç³»å¥½å®‰å…¨å¸¦ï¼Œå‡†å¤‡å¼€å¯æ€§èƒ½å‹æ¦¨çš„ç‹‚æš´æ¨¡å¼ï¼ ğŸï¸ğŸ’¨
    </p>
    <hr/>
    <h4>
     <a id="_6">
     </a>
     <strong>
      ç¬¬ä¸€å¹•ï¼šå¼•æ“æ”¹è£…â€”â€”å†…å­˜è°ƒä¼˜ã®é»‘ç§‘æŠ€
     </strong>
    </h4>
    <p>
     <strong>
      1. å†…å­˜ç¢ç‰‡æ•´ç†æœ¯
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># æŸ¥çœ‹ç¢ç‰‡ç‡ï¼ˆ&gt;1.5å°±è¯¥åŠ¨æ‰‹äº†ï¼‰  </span>
redis-cli info memory <span class="token operator">|</span> <span class="token function">grep</span> mem_fragmentation_ratio  

<span class="token comment"># æš´åŠ›æ•´ç†ï¼ˆä¸»çº¿ç¨‹å¡é¡¿è­¦å‘Šï¼‰  </span>
redis-cli memory purge  
<span class="token comment"># æ¸©æŸ”ç–—æ³•ï¼ˆ4.0+ç‰ˆæœ¬ä¸“å±ï¼‰  </span>
config <span class="token builtin class-name">set</span> activedefrag <span class="token function">yes</span>  
</code></pre>
    <p>
     <strong>
      2. å¯¹è±¡å›æ”¶ã®ä¸‰åå…­è®¡
     </strong>
    </p>
    <pre><code class="prism language-bash">maxmemory 100gb  <span class="token comment"># åˆ«è®©å†…å­˜è£¸å¥”ï¼  </span>
maxmemory-policy allkeys-lfu  <span class="token comment"># æŠŠä¸å¸¸ç”¨çš„å†·å®«æ•°æ®è¸¢å‡ºå»  </span>
<span class="token comment"># ç‰¹æ®Šåœºæ™¯å¯é€‰volatile-ttlï¼šä¼˜å…ˆæ¸…ç†è¿‡æœŸKey  </span>
</code></pre>
    <p>
     <strong>
      3. å°å¯¹è±¡å‹ç¼©ã®ç¼©éª¨åŠŸ
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># åœ¨redis.confé‡Œæ¿€æ´»å‹ç¼©  </span>
hash-max-ziplist-entries <span class="token number">512</span>  <span class="token comment"># Hashå…ƒç´ â‰¤512ç”¨å‹ç¼©  </span>
hash-max-ziplist-value <span class="token number">64</span>     <span class="token comment"># å•ä¸ªå…ƒç´ â‰¤64å­—èŠ‚ç”¨å‹ç¼©  </span>
list-max-ziplist-size <span class="token parameter variable">-2</span>      <span class="token comment"># Listå…ƒç´ â‰¤64KBç”¨å‹ç¼©  </span>
</code></pre>
    <hr/>
    <h4>
     <a id="IO_36">
     </a>
     <strong>
      ç¬¬äºŒå¹•ï¼šä¼ åŠ¨ç³»ç»Ÿâ€”â€”ç½‘ç»œä¸IOä¼˜åŒ–
     </strong>
    </h4>
    <p>
     <strong>
      1. è¿æ¥æ± ã®æ¶¡è½®å¢å‹
     </strong>
    </p>
    <pre><code class="prism language-java"><span class="token class-name">JedisPoolConfig</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JedisPoolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
config<span class="token punctuation">.</span><span class="token function">setMaxTotal</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// ç§‹åå±±å¼¯é“çº§å¹¶å‘  </span>
config<span class="token punctuation">.</span><span class="token function">setMaxIdle</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ä¿æŒå¾…å‘½è½¦æ‰‹æ•°é‡  </span>
config<span class="token punctuation">.</span><span class="token function">setMinIdle</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// æœ€ä½é¢„å¤‡å½¹  </span>
config<span class="token punctuation">.</span><span class="token function">setTestOnBorrow</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ¯æ¬¡å–è¿æ¥åšå¥åº·æ£€æŸ¥  </span>
</code></pre>
    <p>
     <strong>
      2. ç®¡é“æ“ä½œã®æ°®æ°”åŠ é€Ÿ
     </strong>
    </p>
    <pre><code class="prism language-python"><span class="token keyword">with</span> redis<span class="token punctuation">.</span>pipeline<span class="token punctuation">(</span>transaction<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pipe<span class="token punctuation">:</span>  
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
        pipe<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"key_</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>i<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  
    results <span class="token operator">=</span> pipe<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># ç½‘ç»œäº¤äº’ä»1ä¸‡æ¬¡â†’1æ¬¡  </span>
</code></pre>
    <p>
     <strong>
      3. å†…æ ¸å‚æ•°ã®ç§˜å¯†æ”¹è£…
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># è°ƒæ•´TCP backlogé˜Ÿåˆ—  </span>
<span class="token builtin class-name">echo</span> <span class="token number">511</span> <span class="token operator">&gt;</span> /proc/sys/net/core/somaxconn  
<span class="token comment"># å¢åŠ æ–‡ä»¶å¥æŸ„ä¸Šé™  </span>
<span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-n</span> <span class="token number">1000000</span>  
<span class="token comment"># ç¦ç”¨é€æ˜å¤§é¡µï¼ˆé˜²æ­¢å†…å­˜å»¶è¿Ÿæ³¢åŠ¨ï¼‰  </span>
<span class="token builtin class-name">echo</span> never <span class="token operator">&gt;</span> /sys/kernel/mm/transparent_hugepage/enabled  
</code></pre>
    <hr/>
    <h4>
     <a id="_67">
     </a>
     <strong>
      ç¬¬ä¸‰å¹•ï¼šåº•ç›˜å¼ºåŒ–â€”â€”æ•°æ®ç»“æ„ã®é­”æ”¹
     </strong>
    </h4>
    <p>
     <strong>
      1. çƒ­ç‚¹Keyã®åˆ†ç­‹é”™éª¨
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># åŸå§‹å¤§Keyï¼ˆæ‰¾æ­»è¡Œä¸ºï¼‰  </span>
<span class="token builtin class-name">set</span> user:10001:history <span class="token string">"1,2,3,...1000000"</span>  

<span class="token comment"># æ”¹é€ æ–¹æ¡ˆï¼ˆSSDåˆ†ä½“å¼å­˜å‚¨ï¼‰ï¼š  </span>
hmset user:10001:history_part1 <span class="token string">"0-5000"</span> <span class="token string">"1,2,...,5000"</span>  
hmset user:10001:history_part2 <span class="token string">"5001-10000"</span> <span class="token string">"5001,..."</span>  
</code></pre>
    <p>
     <strong>
      2. å¤šç»´æŸ¥è¯¢ã®ç©ºé—´æŠ˜å 
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># åŸå§‹ä½æ•ˆæŸ¥è¯¢  </span>
zrangebyscore temperature <span class="token parameter variable">-inf</span> +inf  <span class="token comment"># å…¨è¡¨æ‰«æè­¦å‘Š  </span>

<span class="token comment"># å»ºç«‹äºŒçº§ç´¢å¼•ï¼ˆæ—¶ç©ºæ”¹é€ ï¼‰ï¼š  </span>
sadd station:1001:days <span class="token number">20230101</span> <span class="token number">20230102</span><span class="token punctuation">..</span>.  
zadd temperature:1001:20230101 <span class="token number">25.3</span> <span class="token number">162000</span>  
</code></pre>
    <p>
     <strong>
      3. ç»Ÿè®¡è®¡æ•°ã®é‡å­å‹ç¼©
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># ä¼ ç»Ÿæ–¹æ¡ˆï¼ˆå†…å­˜çˆ†ç‚¸ï¼‰  </span>
sadd page:view:20230810 user1 user2<span class="token punctuation">..</span>.user1000000  

<span class="token comment"># é»‘ç§‘æŠ€æ–¹æ¡ˆï¼ˆè¯¯å·®1%ä½†çœ95%å†…å­˜ï¼‰ï¼š  </span>
pfadd page:view:20230810 user1  
pfcount page:view:20230810  
</code></pre>
    <hr/>
    <h4>
     <a id="_101">
     </a>
     <strong>
      ç¬¬å››å¹•ï¼šæ¶¡è½®å¢å‹â€”â€”é›†ç¾¤è°ƒä¼˜
     </strong>
    </h4>
    <p>
     <strong>
      1. æ•°æ®åˆ†ç‰‡ã®ç©ºé—´è·³è·ƒ
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># ä½¿ç”¨Hash Tagå¼ºåˆ¶åŒslotå­˜å‚¨  </span>
<span class="token builtin class-name">set</span> user:<span class="token punctuation">{<!-- --></span><span class="token number">10001</span><span class="token punctuation">}</span>.profile <span class="token string">"xxx"</span>  
<span class="token builtin class-name">set</span> order:<span class="token punctuation">{<!-- --></span><span class="token number">10001</span><span class="token punctuation">}</span>.20230810 <span class="token string">"yyy"</span>  
<span class="token comment"># ä¿è¯ç”¨æˆ·ç›¸å…³æ•°æ®åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹  </span>
</code></pre>
    <p>
     <strong>
      2. è·¨èŠ‚ç‚¹äº‹åŠ¡ã®ç›¸å¯¹è®º
     </strong>
    </p>
    <pre><code class="prism language-lua"><span class="token comment">-- ä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§  </span>
<span class="token keyword">local</span> key1 <span class="token operator">=</span> KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  
<span class="token keyword">local</span> key2 <span class="token operator">=</span> KEYS<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>  
<span class="token keyword">local</span> val <span class="token operator">=</span> ARGV<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  
redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'set'</span><span class="token punctuation">,</span> key1<span class="token punctuation">,</span> val<span class="token punctuation">)</span>  
redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'incr'</span><span class="token punctuation">,</span> key2<span class="token punctuation">)</span>  
<span class="token operator">#</span> æ‰€æœ‰æ“ä½œåœ¨å•ä¸ªèŠ‚ç‚¹æ‰§è¡Œ  
</code></pre>
    <p>
     <strong>
      3. å…¨çƒå¤šæ´»ã®æ›²ç‡å¼•æ“
     </strong>
    </p>
    <pre><code class="prism language-yaml"><span class="token comment"># ä¸‰åœ°é›†ç¾¤é…ç½®  </span>
ä¸œäº¬é›†ç¾¤ï¼šå¤„ç†äºšæ´²è®¢å•  
æ³•å…°å…‹ç¦é›†ç¾¤ï¼šæœåŠ¡æ¬§æ´²ç”¨æˆ·  
å¼—å‰å°¼äºšé›†ç¾¤ï¼šè¦†ç›–ç¾æ´²ä¸šåŠ¡  
<span class="token comment"># é€šè¿‡CRDTå®ç°æœ€ç»ˆä¸€è‡´æ€§  </span>
</code></pre>
    <hr/>
    <h4>
     <a id="_133">
     </a>
     <strong>
      ç¬¬äº”å¹•ï¼šæ°®æ°”åŠ é€Ÿâ€”â€”æé™å‹æ¦¨
     </strong>
    </h4>
    <p>
     <strong>
      1. å†…å­˜ç›˜ã®ç¦å¿Œé­”æ³•
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># æŠŠAOFæ—¥å¿—æ”¾åˆ°å†…å­˜ç›˜ï¼ˆåœŸè±ªç©æ³•ï¼‰  </span>
<span class="token function">mount</span> <span class="token parameter variable">-t</span> tmpfs <span class="token parameter variable">-o</span> <span class="token assign-left variable">size</span><span class="token operator">=</span>20G tmpfs /mnt/ramdisk  
<span class="token comment"># ä¿®æ”¹redisé…ç½®ï¼š  </span>
<span class="token function">dir</span> /mnt/ramdisk  
</code></pre>
    <p>
     <strong>
      2. å†…æ ¸æ—è·¯ã®ç»ˆæå¤§æ‹›
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># ä½¿ç”¨DPDKæ¥ç®¡ç½‘å¡ï¼ˆéœ€è¦å®šåˆ¶Redisï¼‰  </span>
./configure --with-dpdk  
<span class="token comment"># ç½‘ç»œå¤„ç†é€Ÿåº¦æå‡10å€ï¼  </span>
</code></pre>
    <p>
     <strong>
      3. ç¡¬ä»¶ã®é»‘æš—æ”¹é€ 
     </strong>
    </p>
    <ul>
     <li>
      ä¸Šæ¶²å†·æœåŠ¡å™¨ï¼ˆå‹åˆ¶CPUé«˜æ¸©ï¼‰
     </li>
     <li>
      æ¢OptaneæŒä¹…å†…å­˜ï¼ˆé™ä½AOFå»¶è¿Ÿï¼‰
     </li>
     <li>
      è£…100Gbpsç½‘å¡ï¼ˆç½‘ç»œä¸å†æˆç“¶é¢ˆï¼‰
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_157">
     </a>
     <strong>
      ç»ˆæå¤§æ‹›ï¼šè°ƒä¼˜å¤§å¸ˆã®ä¿å‘½ç¬¦
     </strong>
    </h4>
    <p>
     <strong>
      1. æ¸è¿›å¼ä¼˜åŒ–æ³•åˆ™
     </strong>
    </p>
    <pre><code class="prism language-bash">æ¯æ¬¡åªæ”¹ä¸€ä¸ªå‚æ•° â†’ è§‚å¯Ÿç›‘æ§ â†’ è®°å½•æ•ˆæœ  
<span class="token comment"># ç¦æ­¢åœ¨å‘¨äº”ä¸‹åˆåšæ¿€è¿›çš„å‚æ•°è°ƒæ•´ï¼  </span>
</code></pre>
    <p>
     <strong>
      2. æ··æ²Œå·¥ç¨‹ã®å‹åŠ›æµ‹è¯•
     </strong>
    </p>
    <pre><code class="prism language-bash">memtier_benchmark <span class="token parameter variable">--threads</span><span class="token operator">=</span><span class="token number">64</span> <span class="token parameter variable">--clients</span><span class="token operator">=</span><span class="token number">1000</span> <span class="token punctuation">\</span>  
--test-time<span class="token operator">=</span><span class="token number">60</span> <span class="token parameter variable">--ratio</span><span class="token operator">=</span><span class="token number">1</span>:1 <span class="token parameter variable">--pipeline</span><span class="token operator">=</span><span class="token number">100</span>  
<span class="token comment"># æŠŠé›†ç¾¤é€¼åˆ°æé™æ‰èƒ½å‘ç°çœŸé—®é¢˜  </span>
</code></pre>
    <p>
     <strong>
      3. å›æ»šé¢„æ¡ˆã®æ—¶ç©ºä¼ é€é—¨
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># æ¯æ¬¡è°ƒä¼˜å‰ï¼š  </span>
<span class="token number">1</span>. å¤‡ä»½é…ç½®æ–‡ä»¶  
<span class="token number">2</span>. è®°å½•å½“å‰ç›‘æ§æŒ‡æ ‡  
<span class="token number">3</span>. å‡†å¤‡ç§’çº§å›æ»šè„šæœ¬  
</code></pre>
    <hr/>
    <p>
     æœ€åé€ä¸Šæ€§èƒ½è°ƒä¼˜ã®å®‡å®™çœŸç†ï¼š
     <br/>
     <strong>
      æ²¡æœ‰é“¶å¼¹ï¼99%çš„æ€§èƒ½é—®é¢˜éƒ½æ˜¯é”™è¯¯ä½¿ç”¨å¯¼è‡´çš„ï¼
     </strong>
     <br/>
     ï¼ˆå‰©ä¸‹1%è¯·å‡çº§ç¡¬ä»¶è§£å†³ï¼‰
    </p>
    <p>
     ç°åœ¨ä½ çš„Rediså·²ç»å˜èº«æ€§èƒ½æ€ªå…½ï¼ä¸è¿‡å‹æƒ…æç¤ºâ€”â€”è¿™ä¸ªçº§åˆ«çš„ä¼˜åŒ–æˆæœï¼Œå¯èƒ½ä¼šè®©è¿ç»´åŒäº‹ä»¥ä¸ºä½ ç»™Rediså—‘äº†å…´å¥‹å‰‚ï¼ ğŸ’Š
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f77616e673534333230332f:61727469636c652f64657461696c732f313436323838313537" class_="artid" style="display:none">
 </p>
</div>


