---
layout: post
title: "STM32-进阶-定时器"
date: 2025-03-06 17:27:21 +0800
description: "的计数器，所以它最大时2的24次方，计数器每计数一次的时间为1s / SYSCLK---下面是验算过程，可以看到如果时72M时钟频率，那么多大是233ms触发中断。2、死区时间，是指在互补信号中的一条信号加一掉段延迟，防止两条信号线同时产生跳变，保护了H桥电路，也就是说，在延迟的这段时间H桥电路中的MOS管可以进行放电，保护H桥电路。1、高级定时器的通道1/2/3可以分别输出2路互补信号，互补信号用来驱动H桥电路，H桥电路通常用于驱动电流较大的负载，比如电机。)不同，产生不同的输出，高电平或者低电平。"
keywords: "STM32 进阶 定时器"
categories: ['Stm']
tags: ['嵌入式硬件', '单片机', 'Stm']
artid: "146042147"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146042147
    alt: "STM32-进阶-定时器"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146042147
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146042147
cover: https://bing.ee123.net/img/rand?artid=146042147
image: https://bing.ee123.net/img/rand?artid=146042147
img: https://bing.ee123.net/img/rand?artid=146042147
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     STM32 进阶 定时器
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h3>
     在stm32中定时器大概分为4类
    </h3>
    <p>
     1、系统定时器：属于arm内核，内嵌在NVIC中
    </p>
    <p>
     2、高级定时器：可以用来刹车和死区
    </p>
    <p>
     3、通用定时器：可以用来输出pwm方波
    </p>
    <p>
     4、基本定时器：只能记数
    </p>
    <h3>
     系统定时器注意：
    </h3>
    <p>
     1、系统定时器多长时间
     <span style="color:#a2e043">
      触发中断计算
     </span>
     ：首先它是24位
     <span style="color:#a2e043">
      向下递减
     </span>
     的计数器，所以它最大时2的24次方，计数器每计数一次的时间为1s / SYSCLK---下面是验算过程，可以看到如果时72M时钟频率，那么多大是233ms触发中断。---通过这个计算可以
     <span style="color:#a2e043">
      计算其reloard的值
     </span>
     配置多少。
    </p>
    <p>
     <img alt="" height="433" src="https://i-blog.csdnimg.cn/direct/29cd35f757944689b0f5d6aa2f2f9709.png" width="1109"/>
    </p>
    <p>
     2、hal库中的NVIC中断system tick使能和寄存器STRL中断TICKINT使能位
     <span style="color:#a2e043">
      同时
     </span>
     置1才算开启中断
    </p>
    <p>
     3、
     <span style="color:#a2e043">
      内核中断
     </span>
     是
     <span style="color:#a2e043">
      没有明确的标识位
     </span>
     ，count flag时计数标志位，不是中断标志位，所以使用systick中断时，不需要标志位清零操作。
    </p>
    <p>
     4、可以使用
     <span style="color:#a2e043">
      systick_config
     </span>
     函数，直接配置systick寄存器，只需要传输重装在寄存器的值也就是reload 的值。
    </p>
    <h3 style="background-color:transparent">
     基本定时器：tim6/tim7
    </h3>
    <p>
     16位自动装载计数器
    </p>
    <p>
     向上计数
    </p>
    <p>
     没有外部引脚，所以只能计时，且不能对外部脉冲就行计数
    </p>
    <h4>
     功能：
    </h4>
    <p>
     定时中断、主模式、触发DAC
    </p>
    <h4>
     注意
    </h4>
    <p>
     通过手册可以知道不管什么定时器都经过分频变成
     <span style="color:#a2e043">
      72MHz
     </span>
    </p>
    <p>
     基本定时器：
     <span style="color:#a2e043">
      只有一个时钟源
     </span>
     就是总线时钟、一般为72MHz，而高级和通用可以通过引脚来调节
    </p>
    <p>
     基本定时器的内部的时基单元要比systick多一个
     <span style="color:#a2e043">
      预分频器
     </span>
     ，可以进行自我调节---计数器频率
    </p>
    <p>
     还有
     <span style="color:#a2e043">
      影子寄存器：防止定时器出现不可控的状态（计数器跑飞）
     </span>
    </p>
    <h3>
     通用定时器：tim2/3/4/5
    </h3>
    <h4>
     功能：
    </h4>
    <p>
     1、多种时钟源
    </p>
    <p>
     2、计数方向：向上/向下计数，也可以先加后减---但是我们通常配置向上计数和基本定时器一样
    </p>
    <p>
     3、输出捕获
    </p>
    <p>
     4、输出比较和pwm生成：输出比较功能专门用来生成pwm方波的
    </p>
    <p>
     5、支持针对定位的增量（正交）编码器和霍尔传感器电路
    </p>
    <h4>
     注意
    </h4>
    <p>
     1、每个通用定时器都有
     <span style="color:#a2e043">
      四个通道
     </span>
     ，但是只有
     <span style="color:#a2e043">
      通道1和2
     </span>
     可以作为时钟信号源---对标72MHz
    </p>
    <p>
     2、PWM（脉冲宽度调制 Pulse-width modulation）---脉冲也就是电平，pwm就是控制电平的持续时长
    </p>
    <p>
     3、PWM有三个参数
    </p>
    <blockquote>
     <p>
      周期：两个上升沿或者两个下降沿的时间
     </p>
     <p>
      频率：周期的倒数，1秒多少个周期
     </p>
     <p>
      占空比：
      <span style="color:#a2e043">
       高电平在整个周期站的时间
      </span>
      ---高电平宽度T---如果时电机那么它影响转速，如果是led等它影响亮度。
     </p>
    </blockquote>
    <p>
     4、输出比较功能如何输入pwm方波，因为有四个通道所以可以同时实现四路比较，比较寄存器的值和计数器的值进行比较，(
     <span style="color:#a2e043">
      &gt;=&lt;
     </span>
     )不同，产生不同的输出，高电平或者低电平。总过8个模式，最重要的是3个。最最
     <span style="color:#a2e043">
      常用的是模式7
     </span>
     。
    </p>
    <p>
     翻转比较：等于会进行高低电平翻转最后的结果就是占空比为50%。
    </p>
    <p>
     模式7pwm模式1：
     <span style="color:#a2e043">
      CNT&lt;CCR 输出有效电平，CNT&gt;= CCR输出无效电平----OCxM配置110
     </span>
    </p>
    <p>
     模式8PWM模式2：CNT&lt;CCR 输出
     <span style="color:#a2e043">
      无效
     </span>
     电平，CNT&gt;= CCR输出
     <span style="color:#a2e043">
      有效
     </span>
     电平
    </p>
    <p>
     5、
     <span style="color:#a2e043">
      捕获（输入）和比较（输出）只能选一个
     </span>
     。
    </p>
    <h3>
     高级定时器：tim1/tim8
    </h3>
    <h4>
     功能：
    </h4>
    <p>
     1、通用寄存器所有功能
    </p>
    <p>
     2、死区时间可编程的互补输出
    </p>
    <p>
     3、短路输入信号（刹车输入信号）
    </p>
    <p>
     4、重复计数器。---计数器减到0，重复计数器减1，直到到0才触发中断。
    </p>
    <h4>
     注意：
    </h4>
    <p>
     1、高级定时器的通道1/2/3可以分别输出2路互补信号，互补信号用来驱动H桥电路，H桥电路通常用于驱动电流较大的负载，比如电机。
    </p>
    <p>
     2、死区时间，是指在互补信号中的一条信号加一掉段延迟，防止两条信号线同时产生跳变，保护了H桥电路，也就是说，在延迟的这段时间H桥电路中的MOS管可以进行放电，保护H桥电路。
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f36343231393836372f:61727469636c652f64657461696c732f313436303432313437" class_="artid" style="display:none">
 </p>
</div>


