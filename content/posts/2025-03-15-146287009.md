---
layout: post
title: "tsfresh时间序列特征自动提取与应用"
date: 2025-03-15 22:47:16 +0800
description: "本文系统介绍了 tsfresh 从基础特征提取到高级策略开发，结合实战案例，详细讲解了如何利用 tsfresh 构建量化投资策略，并优化风险控制。"
keywords: "tsfresh：时间序列特征自动提取与应用"
categories: ['金融科技', 'Python']
tags: ['风险控制', '量化策略', '策略回测', 'Tsfresh', 'Sklearn', 'Python']
artid: "146287009"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146287009
    alt: "tsfresh时间序列特征自动提取与应用"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146287009
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146287009
cover: https://bing.ee123.net/img/rand?artid=146287009
image: https://bing.ee123.net/img/rand?artid=146287009
img: https://bing.ee123.net/img/rand?artid=146287009
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     tsfresh：时间序列特征自动提取与应用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     tsfresh：时间序列特征自动提取与应用
    </p>
    <blockquote>
     <p>
      本文系统介绍了 tsfresh 技术在 A 股市场数据分析与量化投资中的应用。从基础特征提取到高级策略开发，结合实战案例，详细讲解了如何利用 tsfresh 构建量化投资策略，并优化风险控制，助力读者全面掌握时间序列特征提取在量化领域的技术应用。
      <br/>
      <em>
       文中内容仅限技术学习与代码实践参考，市场存在不确定性，技术分析需谨慎验证，不构成任何投资建议。适合量化新手建立系统认知，为策略开发打下基础。
      </em>
     </p>
    </blockquote>
    <h2>
     <a id="tsfresh__5">
     </a>
     第一章：tsfresh 技术概述与环境搭建
    </h2>
    <h3>
     <a id="11_tsfresh__7">
     </a>
     1.1 tsfresh 简介
    </h3>
    <p>
     tsfresh 是一个用于时间序列特征提取的 Python 库，它能够自动从时间序列数据中提取大量特征，并通过统计检验筛选出与目标变量相关的特征，简化了时间序列数据分析流程，广泛应用于预测维护、金融分析等领域。
    </p>
    <h3>
     <a id="12__11">
     </a>
     1.2 环境搭建
    </h3>
    <h4>
     <a id="tsfresh__13">
     </a>
     tsfresh 安装
    </h4>
    <pre><code class="prism language-bash">pip <span class="token function">install</span> <span class="token string">"tsfresh[dask]"</span>
</code></pre>
    <p>
     推荐阅读：
     <a href="https://stock.blog.csdn.net/article/details/146264849" rel="nofollow">
      Dask：Python高效并行计算利器 🔥
     </a>
    </p>
    <h4>
     <a id="_20">
     </a>
     验证安装成功与否
    </h4>
    <p>
     安装完成后，可以通过以下Python代码验证tsfresh是否安装成功：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> tsfresh
<span class="token keyword">print</span><span class="token punctuation">(</span>tsfresh<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
</code></pre>
    <p>
     如果输出了版本号，说明安装成功。
    </p>
    <h4>
     <a id="_31">
     </a>
     相关依赖库安装
    </h4>
    <pre><code class="prism language-bash"><span class="token comment"># 安装 pandas、numpy、matplotlib 等库</span>
pip <span class="token function">install</span> pandas numpy matplotlib
</code></pre>
    <h4>
     <a id="Tushare__38">
     </a>
     Tushare 数据接口申请与配置
    </h4>
    <ol>
     <li>
      访问
      <a href="https://tushare.pro/" rel="nofollow">
       Tushare 官网
      </a>
      注册账号并获取 API Token。
     </li>
     <li>
      安装 Tushare Python SDK：
     </li>
    </ol>
    <pre><code class="prism language-bash">pip <span class="token function">install</span> tushare
</code></pre>
    <ol start="3">
     <li>
      配置 Tushare API：
     </li>
    </ol>
    <pre><code class="prism language-python"><span class="token keyword">import</span> tushare <span class="token keyword">as</span> ts
ts<span class="token punctuation">.</span>set_token<span class="token punctuation">(</span><span class="token string">"your_token"</span><span class="token punctuation">)</span>  <span class="token comment"># 替换为你的Tushare Token</span>
pro <span class="token operator">=</span> ts<span class="token punctuation">.</span>pro_api<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="13__55">
     </a>
     1.3 数据准备
    </h3>
    <h4>
     <a id="_Tushare__A__57">
     </a>
     使用 Tushare 获取 A 股市场数据
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token comment"># 获取某股票的历史日线数据</span>
<span class="token keyword">def</span> <span class="token function">get_stock_data</span><span class="token punctuation">(</span>ts_code<span class="token punctuation">,</span> start_date<span class="token punctuation">,</span> end_date<span class="token punctuation">)</span><span class="token punctuation">:</span>
    df <span class="token operator">=</span> pro<span class="token punctuation">.</span>daily<span class="token punctuation">(</span>ts_code<span class="token operator">=</span>ts_code<span class="token punctuation">,</span> start_date<span class="token operator">=</span>start_date<span class="token punctuation">,</span> end_date<span class="token operator">=</span>end_date<span class="token punctuation">)</span>
    <span class="token keyword">return</span> df

<span class="token comment"># 示例：获取股票 000001.SZ 的 2024年数据</span>
stock_data <span class="token operator">=</span> get_stock_data<span class="token punctuation">(</span><span class="token string">"000001.SZ"</span><span class="token punctuation">,</span> <span class="token string">"20240101"</span><span class="token punctuation">,</span> <span class="token string">"20241231"</span><span class="token punctuation">)</span>
stock_data<span class="token punctuation">[</span><span class="token string">"trade_date"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>stock_data<span class="token punctuation">[</span><span class="token string">"trade_date"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
stock_data<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>stock_data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_74">
     </a>
     数据存储与管理
    </h4>
    <p>
     Parquet是一种高效的列式存储格式，适用于大数据处理。它具有高压缩比和快速读取的特点，适合存储大规模数据。
    </p>
    <p>
     推荐阅读:
    </p>
    <ul>
     <li>
      <a href="https://blog.csdn.net/weixin_47339916/article/details/146050258">
       Pandas+PyArrow：股票数据存储 Parquet 入门指引 🔥
      </a>
     </li>
     <li>
      <a href="https://blog.csdn.net/weixin_47339916/article/details/146022244">
       A股数据存储实战：Parquet技术深度解析 🔥
      </a>
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token comment"># 将获取的数据存储为Parquet文件</span>
stock_data<span class="token punctuation">.</span>to_parquet<span class="token punctuation">(</span><span class="token string">"./data/000001.SZ.parquet"</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token comment"># 从Parquet文件读取数据</span>
stock_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_parquet<span class="token punctuation">(</span><span class="token string">"./data/000001.SZ.parquet"</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>stock_data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_93">
     </a>
     数据清洗与预处理
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># 检查缺失值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>stock_data<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 处理缺失值，例如用前一日数据填充</span>
stock_data<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"ffill"</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 按交易日期排序</span>
stock_data<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>
    <h2>
     <a id="_106">
     </a>
     第二章：时间序列特征提取基础
    </h2>
    <h3>
     <a id="21__108">
     </a>
     2.1 时间序列特征提取概述
    </h3>
    <p>
     时间序列特征提取是从时间序列数据中提取出能够代表其主要特征的信息，这些特征可以用于后续的数据分析、建模和预测。在金融领域，时间序列特征提取可以帮助我们理解市场趋势、识别交易模式、构建预测模型等。
    </p>
    <p>
     tsfresh 提供了全面的特征提取功能，能够自动从时间序列数据中提取大量特征，并通过统计检验筛选出与目标变量相关的特征，大大简化了特征工程的流程。
    </p>
    <h3>
     <a id="22__114">
     </a>
     2.2 基本特征提取方法
    </h3>
    <h4>
     <a id="_116">
     </a>
     统计特征
    </h4>
    <p>
     统计特征是最基本的特征类型，包括均值、方差、中位数、极值等。这些特征能够反映时间序列数据的集中趋势和离散程度。
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> tsfresh <span class="token keyword">import</span> extract_features


<span class="token comment"># 假设 stock_data 是之前获取的股票数据，包含 'close' 列</span>
<span class="token comment"># 为 tsfresh 准备数据，需要将时间序列数据整理成特定格式</span>
<span class="token keyword">def</span> <span class="token function">prepare_tsfresh_data</span><span class="token punctuation">(</span>stock_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 为每行数据添加一个唯一标识符，表示属于同一个时间序列</span>
    stock_data<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>stock_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 选择需要的列，包括标识符、时间戳和目标值</span>
    ts_data <span class="token operator">=</span> stock_data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"trade_date"</span><span class="token punctuation">,</span> <span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> ts_data


ts_data <span class="token operator">=</span> prepare_tsfresh_data<span class="token punctuation">(</span>stock_data<span class="token punctuation">)</span>

<span class="token comment"># 提取统计特征</span>
statistical_features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
    default_fc_parameters<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"mean"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        <span class="token string">"variance"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        <span class="token string">"median"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        <span class="token string">"maximum"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        <span class="token string">"minimum"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>statistical_features<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_153">
     </a>
     时间域特征
    </h4>
    <p>
     时间域特征关注时间序列在时间维度上的变化特性，如趋势、周期性、波动性等。
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 定义要提取的时间域特征</span>
time_domain_features <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"abs_energy"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
    <span class="token string">"absolute_sum_of_changes"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
    <span class="token string">"cid_ce"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"normalize"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"normalize"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"friedrich_coefficients"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"coeff"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"m"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"linear_trend"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"attr"</span><span class="token punctuation">:</span> <span class="token string">"pvalue"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"attr"</span><span class="token punctuation">:</span> <span class="token string">"rvalue"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"attr"</span><span class="token punctuation">:</span> <span class="token string">"intercept"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"attr"</span><span class="token punctuation">:</span> <span class="token string">"slope"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"attr"</span><span class="token punctuation">:</span> <span class="token string">"stderr"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"spkt_welch_density"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"coeff"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"binned_entropy"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"max_bins"</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment"># 提取时间域特征</span>
td_features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
    default_fc_parameters<span class="token operator">=</span>time_domain_features<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>td_features<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_186">
     </a>
     频域特征
    </h4>
    <p>
     频域特征通过傅里叶变换等方法将时间序列数据转换到频域，提取频率成分、功率谱等信息。
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 提取频域特征</span>
frequency_domain_features <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"fft_aggregated"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"aggtype"</span><span class="token punctuation">:</span> <span class="token string">"centroid"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"aggtype"</span><span class="token punctuation">:</span> <span class="token string">"variance"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"aggtype"</span><span class="token punctuation">:</span> <span class="token string">"skew"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"aggtype"</span><span class="token punctuation">:</span> <span class="token string">"kurtosis"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"fft_coefficient"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"coeff"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"attr"</span><span class="token punctuation">:</span> <span class="token string">"real"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"coeff"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"attr"</span><span class="token punctuation">:</span> <span class="token string">"real"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"index_mass_quantile"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"q"</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"number_peaks"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"n"</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

fd_features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
    default_fc_parameters<span class="token operator">=</span>frequency_domain_features<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>fd_features<span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="23__A__214">
     </a>
     2.3 实战：对 A 股某股票的历史价格数据进行基本特征提取
    </h3>
    <pre><code class="prism language-python"><span class="token comment"># 综合提取统计特征、时间域特征和频域特征</span>
<span class="token keyword">from</span> tsfresh<span class="token punctuation">.</span>feature_extraction <span class="token keyword">import</span> ComprehensiveFCParameters

<span class="token comment"># 定义综合特征提取参数</span>
comprehensive_features <span class="token operator">=</span> ComprehensiveFCParameters<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 移除不需要的特征</span>
comprehensive_features<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"fft_aggregated"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
comprehensive_features<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"fft_coefficient"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
comprehensive_features<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"index_mass_quantile"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
comprehensive_features<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"number_peaks"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
comprehensive_features<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"spectral_entropy"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>

<span class="token comment"># 提取综合特征</span>
all_features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
    default_fc_parameters<span class="token operator">=</span>comprehensive_features<span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># 查看提取的特征</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>all_features<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 特征可视化</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># 绘制收盘价走势图</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>stock_data<span class="token punctuation">[</span><span class="token string">"trade_date"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stock_data<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Stock Closing Price Trend"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"Trade Date"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Closing Price"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制提取的特征分布</span>
<span class="token keyword">import</span> random

sampled_features <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>
    all_features<span class="token punctuation">.</span>columns<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">25</span>
<span class="token punctuation">)</span>  <span class="token comment"># 随机选取25个特征示例</span>
all_features<span class="token punctuation">[</span>sampled_features<span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    kind<span class="token operator">=</span><span class="token string">"hist"</span><span class="token punctuation">,</span> subplots<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> layout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h2>
     <a id="_265">
     </a>
     第三章：高级时间序列特征提取
    </h2>
    <h3>
     <a id="31__267">
     </a>
     3.1 高级特征提取技术
    </h3>
    <h4>
     <a id="_269">
     </a>
     自动特征提取
    </h4>
    <p>
     tsfresh 的强大之处在于其能够自动从时间序列数据中提取大量特征，无需手动定义每个特征。
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> tsfresh <span class="token keyword">import</span> extract_features
<span class="token keyword">from</span> tsfresh<span class="token punctuation">.</span>feature_extraction <span class="token keyword">import</span> ComprehensiveFCParameters

<span class="token comment"># 定义自动特征提取参数</span>
automatic_features <span class="token operator">=</span> ComprehensiveFCParameters<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 提取自动特征</span>
auto_features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
    default_fc_parameters<span class="token operator">=</span>automatic_features<span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># 查看提取的特征数量和部分特征</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Extracted </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>auto_features<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> features."</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>auto_features<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_294">
     </a>
     特征筛选与选择
    </h4>
    <p>
     提取大量特征后，需要进行筛选以选择与目标变量相关的特征，减少维度并提高模型性能。
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> tsfresh <span class="token keyword">import</span> select_features

<span class="token comment"># 假设我们有一个目标变量，例如股票的未来收益率</span>
<span class="token comment"># 这里需要根据实际情况构建目标变量</span>
<span class="token comment"># target = ...</span>

<span class="token comment"># 筛选与目标变量相关的特征</span>
selected_features <span class="token operator">=</span> select_features<span class="token punctuation">(</span>auto_features<span class="token punctuation">,</span> target<span class="token punctuation">)</span>

<span class="token comment"># 查看筛选后的特征数量和部分特征</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Selected </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>selected_features<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> features."</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>selected_features<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_313">
     </a>
     特征工程技巧
    </h4>
    <ul>
     <li>
      <strong>
       特征组合
      </strong>
      ：将多个基础特征组合成新的特征，例如计算两个时间序列的比率或差值。
     </li>
     <li>
      <strong>
       时间窗口特征
      </strong>
      ：在不同时间窗口上提取特征，捕捉短期和长期趋势。
     </li>
     <li>
      <strong>
       滞后特征
      </strong>
      ：创建滞后版本的时间序列，用于捕捉过去值对当前值的影响。
     </li>
    </ul>
    <h3>
     <a id="32__A__319">
     </a>
     3.2 实战：深入提取 A 股市场时间序列特征
    </h3>
    <h4>
     <a id="_321">
     </a>
     多只股票数据的特征提取
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">from</span> tsfresh <span class="token keyword">import</span> extract_features
<span class="token keyword">from</span> tsfresh<span class="token punctuation">.</span>feature_extraction <span class="token keyword">import</span> ComprehensiveFCParameters

<span class="token comment"># 定义自动特征提取参数</span>
automatic_features <span class="token operator">=</span> ComprehensiveFCParameters<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment"># 为 tsfresh 准备数据</span>
<span class="token keyword">def</span> <span class="token function">prepare_tsfresh_data_multi</span><span class="token punctuation">(</span>stocks_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    stocks_data<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
        stocks_data<span class="token punctuation">[</span><span class="token string">"ts_code"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"_"</span> <span class="token operator">+</span> stocks_data<span class="token punctuation">[</span><span class="token string">"trade_date"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    ts_data_multi <span class="token operator">=</span> stocks_data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"trade_date"</span><span class="token punctuation">,</span> <span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> ts_data_multi


ts_data_multi <span class="token operator">=</span> prepare_tsfresh_data_multi<span class="token punctuation">(</span>stocks_data<span class="token punctuation">)</span>

<span class="token comment"># 提取多只股票的特征</span>
auto_features_multi <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data_multi<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
    default_fc_parameters<span class="token operator">=</span>automatic_features<span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># 查看提取的特征</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>auto_features_multi<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_355">
     </a>
     不同时间周期数据的特征对比
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># 获取日线、周线、月线数据</span>
<span class="token keyword">def</span> <span class="token function">get_data_different_timeframes</span><span class="token punctuation">(</span>ts_code<span class="token punctuation">,</span> start_date<span class="token punctuation">,</span> end_date<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 日线数据</span>
    daily_data <span class="token operator">=</span> pro<span class="token punctuation">.</span>daily<span class="token punctuation">(</span>ts_code<span class="token operator">=</span>ts_code<span class="token punctuation">,</span> start_date<span class="token operator">=</span>start_date<span class="token punctuation">,</span> end_date<span class="token operator">=</span>end_date<span class="token punctuation">)</span>
    <span class="token comment"># 周线数据</span>
    weekly_data <span class="token operator">=</span> pro<span class="token punctuation">.</span>weekly<span class="token punctuation">(</span>ts_code<span class="token operator">=</span>ts_code<span class="token punctuation">,</span> start_date<span class="token operator">=</span>start_date<span class="token punctuation">,</span> end_date<span class="token operator">=</span>end_date<span class="token punctuation">)</span>
    <span class="token comment"># 月线数据</span>
    monthly_data <span class="token operator">=</span> pro<span class="token punctuation">.</span>monthly<span class="token punctuation">(</span>
        ts_code<span class="token operator">=</span>ts_code<span class="token punctuation">,</span> start_date<span class="token operator">=</span>start_date<span class="token punctuation">,</span> end_date<span class="token operator">=</span>end_date
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> daily_data<span class="token punctuation">,</span> weekly_data<span class="token punctuation">,</span> monthly_data


<span class="token comment"># 示例：获取某股票的不同时间周期数据</span>
daily<span class="token punctuation">,</span> weekly<span class="token punctuation">,</span> monthly <span class="token operator">=</span> get_data_different_timeframes<span class="token punctuation">(</span>
    <span class="token string">"000001.SZ"</span><span class="token punctuation">,</span> <span class="token string">"20240101"</span><span class="token punctuation">,</span> <span class="token string">"20241231"</span>
<span class="token punctuation">)</span>

<span class="token comment"># 分别提取不同时间周期的特征</span>
<span class="token keyword">def</span> <span class="token function">extract_features_timeframe</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> timeframe<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>timeframe <span class="token operator">+</span> <span class="token string">"_"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    ts_data <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"trade_date"</span><span class="token punctuation">,</span> <span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
        ts_data<span class="token punctuation">,</span>
        column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
        column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
        column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
        default_fc_parameters<span class="token operator">=</span>automatic_features<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> features


daily_features <span class="token operator">=</span> extract_features_timeframe<span class="token punctuation">(</span>daily<span class="token punctuation">,</span> <span class="token string">"daily"</span><span class="token punctuation">)</span>
weekly_features <span class="token operator">=</span> extract_features_timeframe<span class="token punctuation">(</span>weekly<span class="token punctuation">,</span> <span class="token string">"weekly"</span><span class="token punctuation">)</span>
monthly_features <span class="token operator">=</span> extract_features_timeframe<span class="token punctuation">(</span>monthly<span class="token punctuation">,</span> <span class="token string">"monthly"</span><span class="token punctuation">)</span>

<span class="token comment"># 合并不同时间周期的特征</span>
all_timeframe_features <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>daily_features<span class="token punctuation">,</span> weekly_features<span class="token punctuation">,</span> monthly_features<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>all_timeframe_features<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_399">
     </a>
     特征可视化与解读
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># 可视化某只股票的特征分布</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># 选择某只股票的特征数据</span>
stock_features <span class="token operator">=</span> auto_features_multi<span class="token punctuation">[</span>
    auto_features_multi<span class="token punctuation">.</span>index<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">"000001.SZ"</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>

<span class="token comment"># 去除 NaN 值</span>
stock_features <span class="token operator">=</span> stock_features<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制部分特征的分布</span>
fig<span class="token punctuation">,</span> axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>nrows<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> ncols<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
axes <span class="token operator">=</span> axes<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span>

feature_columns <span class="token operator">=</span> stock_features<span class="token punctuation">.</span>columns<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>  <span class="token comment"># 选择前 9 个特征进行可视化</span>

<span class="token keyword">for</span> i<span class="token punctuation">,</span> feature <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>feature_columns<span class="token punctuation">)</span><span class="token punctuation">:</span>
    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>hist<span class="token punctuation">(</span>stock_features<span class="token punctuation">[</span>feature<span class="token punctuation">]</span><span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span>feature<span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h2>
     <a id="_427">
     </a>
     第四章：时间序列分类与回归应用
    </h2>
    <h3>
     <a id="41__429">
     </a>
     4.1 时间序列分类基础
    </h3>
    <p>
     时间序列分类是根据时间序列的特征将其划分到不同的类别中。在 A 股市场中，可以用于股票的行业分类、风格分类等。
    </p>
    <h4>
     <a id="_433">
     </a>
     常见分类算法
    </h4>
    <ul>
     <li>
      <strong>
       逻辑回归
      </strong>
      ：适用于二分类问题。
     </li>
     <li>
      <strong>
       支持向量机
      </strong>
      ：适用于高维数据分类。
     </li>
     <li>
      <strong>
       随机森林
      </strong>
      ：基于集成学习的分类算法，具有较高的准确性和鲁棒性。
     </li>
     <li>
      <strong>
       神经网络
      </strong>
      ：适用于复杂模式识别。
     </li>
    </ul>
    <h3>
     <a id="42__tsfresh__440">
     </a>
     4.2 使用 tsfresh 进行时间序列分类
    </h3>
    <h4>
     <a id="_442">
     </a>
     特征提取与选择
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">from</span> tsfresh <span class="token keyword">import</span> extract_features<span class="token punctuation">,</span> select_features

<span class="token comment"># 假设我们有多只股票的数据，ts_data 包含 'id'、'trade_date' 和 'close' 列</span>
<span class="token comment"># 提取特征</span>
features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># 假设我们有一个目标分类标签，例如股票的行业分类</span>
<span class="token comment"># labels = ...</span>

<span class="token comment"># 筛选与分类相关的特征</span>
selected_features <span class="token operator">=</span> select_features<span class="token punctuation">(</span>features<span class="token punctuation">,</span> labels<span class="token punctuation">)</span>

<span class="token comment"># 查看筛选后的特征</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>selected_features<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_466">
     </a>
     分类模型训练与评估
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> accuracy_score<span class="token punctuation">,</span> classification_report

<span class="token comment"># 数据集划分</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>
    selected_features<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span>
<span class="token punctuation">)</span>

<span class="token comment"># 模型训练</span>
clf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

<span class="token comment"># 模型评估</span>
y_pred <span class="token operator">=</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Accuracy: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_A__488">
     </a>
     实战：对 A 股股票进行分类
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># 获取多只股票的数据并提取特征</span>
<span class="token comment"># 假设我们已经获取了多只股票的数据并存储在 stocks_data 中</span>

<span class="token comment"># 为 tsfresh 准备数据</span>
ts_data <span class="token operator">=</span> prepare_tsfresh_data_multi<span class="token punctuation">(</span>stocks_data<span class="token punctuation">)</span>

<span class="token comment"># 提取特征</span>
features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># 假设我们有一个行业分类标签字典，key 为股票代码，value 为行业分类</span>
<span class="token comment"># industry_labels = ...</span>

<span class="token comment"># 将标签与特征数据对齐</span>
labels <span class="token operator">=</span> <span class="token punctuation">[</span>industry_labels<span class="token punctuation">[</span><span class="token builtin">id</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"_"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">for</span> <span class="token builtin">id</span> <span class="token keyword">in</span> features<span class="token punctuation">.</span>index<span class="token punctuation">]</span>

<span class="token comment"># 筛选特征</span>
selected_features <span class="token operator">=</span> select_features<span class="token punctuation">(</span>features<span class="token punctuation">,</span> labels<span class="token punctuation">)</span>

<span class="token comment"># 数据集划分与模型训练</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>
    selected_features<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span>
<span class="token punctuation">)</span>
clf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

<span class="token comment"># 评估模型</span>
y_pred <span class="token operator">=</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Accuracy: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="43__527">
     </a>
     4.3 时间序列回归分析
    </h3>
    <p>
     时间序列回归是根据时间序列的特征预测一个连续的目标值，如股票的未来价格。
    </p>
    <h4>
     <a id="_531">
     </a>
     常见回归算法
    </h4>
    <ul>
     <li>
      <strong>
       线性回归
      </strong>
      ：简单的线性模型。
     </li>
     <li>
      <strong>
       决策树回归
      </strong>
      ：适用于非线性关系。
     </li>
     <li>
      <strong>
       梯度提升回归
      </strong>
      ：基于梯度提升的回归算法，具有较高的预测精度。
     </li>
     <li>
      <strong>
       神经网络回归
      </strong>
      ：适用于复杂函数逼近。
     </li>
    </ul>
    <h4>
     <a id="_tsfresh__538">
     </a>
     使用 tsfresh 进行时间序列回归
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> GradientBoostingRegressor
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> mean_squared_error<span class="token punctuation">,</span> r2_score

<span class="token comment"># 假设我们已经提取了特征并存储在 features 中</span>
<span class="token comment"># 假设我们有一个目标值，例如股票的未来收益率</span>
<span class="token comment"># target = ...</span>

<span class="token comment"># 数据集划分</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>
    features<span class="token punctuation">,</span> target<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span>
<span class="token punctuation">)</span>

<span class="token comment"># 模型训练</span>
regressor <span class="token operator">=</span> GradientBoostingRegressor<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
regressor<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

<span class="token comment"># 模型评估</span>
y_pred <span class="token operator">=</span> regressor<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"RMSE: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>mean_squared_error<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> squared<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"R^2: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>r2_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_A__564">
     </a>
     实战：预测 A 股股票的未来价格走势
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># 获取股票历史数据并提取特征</span>
<span class="token comment"># 假设我们已经获取了股票数据并存储在 stock_data 中</span>

<span class="token comment"># 构建目标值，例如未来 5 天的收盘价</span>
stock_data<span class="token punctuation">[</span><span class="token string">"future_close"</span><span class="token punctuation">]</span> <span class="token operator">=</span> stock_data<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment"># 删除未来数据缺失的行</span>
stock_data<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"future_close"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 为 tsfresh 准备数据</span>
ts_data <span class="token operator">=</span> prepare_tsfresh_data<span class="token punctuation">(</span>stock_data<span class="token punctuation">)</span>

<span class="token comment"># 提取特征</span>
features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># 将目标值与特征数据对齐</span>
target <span class="token operator">=</span> stock_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>features<span class="token punctuation">.</span>index<span class="token punctuation">,</span> <span class="token string">"future_close"</span><span class="token punctuation">]</span>

<span class="token comment"># 数据集划分与模型训练</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>
    features<span class="token punctuation">,</span> target<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span>
<span class="token punctuation">)</span>
regressor <span class="token operator">=</span> GradientBoostingRegressor<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
regressor<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

<span class="token comment"># 评估模型</span>
y_pred <span class="token operator">=</span> regressor<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"RMSE: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>mean_squared_error<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> squared<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"R^2: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>r2_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre>
    <h2>
     <a id="tsfresh__603">
     </a>
     第五章：tsfresh 在量化投资中的高级应用
    </h2>
    <h3>
     <a id="51__605">
     </a>
     5.1 量化投资概述
    </h3>
    <p>
     量化投资是利用数学模型和计算机技术，对金融市场进行分析、预测，并制定投资策略的过程。时间序列分析在量化投资中占据重要地位，通过对历史价格、成交量等时间序列数据的分析，可以挖掘市场规律、预测价格走势。
    </p>
    <h3>
     <a id="52__tsfresh__609">
     </a>
     5.2 使用 tsfresh 构建量化投资策略
    </h3>
    <h4>
     <a id="_611">
     </a>
     特征工程与策略设计
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">from</span> tsfresh <span class="token keyword">import</span> extract_features<span class="token punctuation">,</span> select_features
<span class="token keyword">from</span> tsfresh<span class="token punctuation">.</span>utilities<span class="token punctuation">.</span>dataframe_functions <span class="token keyword">import</span> impute
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> mean_squared_error
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> GradientBoostingRegressor
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd


<span class="token comment"># 获取股票数据</span>
<span class="token keyword">def</span> <span class="token function">get_stock_data</span><span class="token punctuation">(</span>ts_code<span class="token punctuation">,</span> start_date<span class="token punctuation">,</span> end_date<span class="token punctuation">)</span><span class="token punctuation">:</span>
    df <span class="token operator">=</span> pro<span class="token punctuation">.</span>daily<span class="token punctuation">(</span>ts_code<span class="token operator">=</span>ts_code<span class="token punctuation">,</span> start_date<span class="token operator">=</span>start_date<span class="token punctuation">,</span> end_date<span class="token operator">=</span>end_date<span class="token punctuation">)</span>
    <span class="token keyword">return</span> df


<span class="token comment"># 构建目标变量（例如未来5天的收益率）</span>
<span class="token keyword">def</span> <span class="token function">build_target_variable</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data<span class="token punctuation">[</span><span class="token string">"trade_date"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"trade_date"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    data<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    data<span class="token punctuation">[</span><span class="token string">"future_close"</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span>periods<span class="token punctuation">)</span>
    data<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"future_close"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    data<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    data<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    data<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> data


<span class="token comment"># 提取特征</span>
<span class="token keyword">def</span> <span class="token function">feature_engineering</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    extracted_features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
        data<span class="token punctuation">,</span>
        column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
        column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
        column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># 处理缺失值</span>
    impute<span class="token punctuation">(</span>extracted_features<span class="token punctuation">)</span>

    target_variable <span class="token operator">=</span> <span class="token punctuation">(</span>
        data<span class="token punctuation">[</span><span class="token string">"future_close"</span><span class="token punctuation">]</span> <span class="token operator">-</span> data<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>  <span class="token comment"># 目标变量为未来5天的收盘价变化 data["future_return"]</span>

    selected_features <span class="token operator">=</span> select_features<span class="token punctuation">(</span>extracted_features<span class="token punctuation">,</span> target_variable<span class="token punctuation">)</span>

    <span class="token keyword">return</span> selected_features<span class="token punctuation">,</span> target_variable


<span class="token comment"># 策略设计</span>
<span class="token keyword">def</span> <span class="token function">strategy_development</span><span class="token punctuation">(</span>features<span class="token punctuation">,</span> variable<span class="token punctuation">,</span> variables<span class="token punctuation">)</span><span class="token punctuation">:</span>
    X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>
        features<span class="token punctuation">,</span> variable<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># 模型训练</span>
    model <span class="token operator">=</span> GradientBoostingRegressor<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

    y_pred <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
    mse <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"均方误差（MSE）：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>mse<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token comment"># 策略信号生成</span>
    variables<span class="token punctuation">[</span><span class="token string">"predicted_future_change"</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>features<span class="token punctuation">)</span>
    variables<span class="token punctuation">[</span><span class="token string">"predicted_future_close"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
        variables<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span> <span class="token operator">+</span> variables<span class="token punctuation">[</span><span class="token string">"predicted_future_change"</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># 根据信号生成持仓信号</span>
    variables<span class="token punctuation">[</span><span class="token string">"signal"</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>
        variables<span class="token punctuation">[</span><span class="token string">"predicted_future_close"</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> variables<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">)</span>
    variables<span class="token punctuation">[</span><span class="token string">"strategy_returns"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
        variables<span class="token punctuation">[</span><span class="token string">"signal"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> variables<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    cumulative_returns <span class="token operator">=</span> <span class="token punctuation">(</span>variables<span class="token punctuation">[</span><span class="token string">"strategy_returns"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cumprod<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 绘制结果</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>cumulative_returns<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"Strategy Returns"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>stock_data<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cumsum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"Buy and Hold"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Strategy Performance"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"Date"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Cumulative Returns"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> variables

<span class="token comment"># 实战：构建基于 tsfresh 的量化投资策略</span>
stock_data <span class="token operator">=</span> get_stock_data<span class="token punctuation">(</span><span class="token string">'000001.SZ'</span><span class="token punctuation">,</span> <span class="token string">'20200101'</span><span class="token punctuation">,</span> <span class="token string">'20201231'</span><span class="token punctuation">)</span>
target_variables <span class="token operator">=</span> build_target_variable<span class="token punctuation">(</span>stock_data<span class="token punctuation">)</span>
selected_features<span class="token punctuation">,</span> target_variable <span class="token operator">=</span> feature_engineering<span class="token punctuation">(</span>target_variables<span class="token punctuation">)</span>
strategy_data <span class="token operator">=</span> strategy_development<span class="token punctuation">(</span>
    selected_features<span class="token punctuation">,</span> target_variable<span class="token punctuation">,</span> target_variables
<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_712">
     </a>
     策略回测与评估
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token comment"># 策略回测</span>
<span class="token keyword">def</span> <span class="token function">strategy_backtest</span><span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    strategy_data<span class="token punctuation">[</span><span class="token string">"return"</span><span class="token punctuation">]</span> <span class="token operator">=</span> strategy_data<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> strategy_data<span class="token punctuation">[</span>
        <span class="token string">"signal"</span>
    <span class="token punctuation">]</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    strategy_data<span class="token punctuation">[</span><span class="token string">"cumulative_return"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> strategy_data<span class="token punctuation">[</span><span class="token string">"return"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cumprod<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> strategy_data


<span class="token comment"># 策略评估</span>
<span class="token keyword">def</span> <span class="token function">strategy_evaluation</span><span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 计算年化收益率</span>
    annual_return <span class="token operator">=</span> <span class="token punctuation">(</span>strategy_data<span class="token punctuation">[</span><span class="token string">"cumulative_return"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token punctuation">(</span>
        <span class="token number">252</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token comment"># 计算最大回撤</span>
    cumulative_return <span class="token operator">=</span> strategy_data<span class="token punctuation">[</span><span class="token string">"cumulative_return"</span><span class="token punctuation">]</span>
    peak <span class="token operator">=</span> cumulative_return<span class="token punctuation">.</span>expanding<span class="token punctuation">(</span>min_periods<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    drawdown <span class="token operator">=</span> <span class="token punctuation">(</span>cumulative_return <span class="token operator">-</span> peak<span class="token punctuation">)</span> <span class="token operator">/</span> peak
    max_drawdown <span class="token operator">=</span> drawdown<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 计算夏普比率</span>
    daily_return <span class="token operator">=</span> strategy_data<span class="token punctuation">[</span><span class="token string">"return"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sharpe_ratio <span class="token operator">=</span> daily_return<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> daily_return<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token number">252</span><span class="token punctuation">)</span>
    <span class="token comment"># 打印结果</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Annual Return: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>annual_return<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Max Drawdown: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>max_drawdown<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Sharpe Ratio: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>sharpe_ratio<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> annual_return<span class="token punctuation">,</span> max_drawdown<span class="token punctuation">,</span> sharpe_ratio


<span class="token comment"># 可视化策略表现</span>
<span class="token keyword">def</span> <span class="token function">plot_strategy_performance</span><span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>strategy_data<span class="token punctuation">[</span><span class="token string">"trade_date"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> strategy_data<span class="token punctuation">[</span><span class="token string">"cumulative_return"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Strategy Performance"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"Trade Date"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Cumulative Return"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment"># 执行策略回测与评估</span>
strategy_data <span class="token operator">=</span> strategy_backtest<span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
strategy_evaluation<span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
plot_strategy_performance<span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_765">
     </a>
     风险控制与优化
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># 风险控制</span>
<span class="token keyword">def</span> <span class="token function">risk_management</span><span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置止损止盈</span>
    strategy_data<span class="token punctuation">[</span><span class="token string">"stop_loss"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.05</span>  <span class="token comment"># 止损5%</span>
    strategy_data<span class="token punctuation">[</span><span class="token string">"stop_profit"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.1</span>  <span class="token comment"># 止盈10%</span>
    <span class="token comment"># 调整仓位</span>
    strategy_data<span class="token punctuation">[</span><span class="token string">"signal"</span><span class="token punctuation">]</span> <span class="token operator">=</span> strategy_data<span class="token punctuation">[</span><span class="token string">"signal"</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">0.5</span>  <span class="token comment"># 降低仓位50%</span>
    <span class="token keyword">return</span> strategy_data


<span class="token comment"># 策略优化</span>
<span class="token keyword">def</span> <span class="token function">strategy_optimization</span><span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 参数优化</span>
    <span class="token comment"># 可以通过网格搜索、随机搜索等方法优化模型参数</span>
    <span class="token comment"># 这里以调整预测周期为例</span>
    target_variables <span class="token operator">=</span> build_target_variable<span class="token punctuation">(</span>stock_data<span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 预测3天收益率</span>
    <span class="token comment"># 重新进行特征提取、模型训练和策略开发</span>
    selected_features<span class="token punctuation">,</span> target_variable <span class="token operator">=</span> feature_engineering<span class="token punctuation">(</span>target_variables<span class="token punctuation">)</span>
    strategy_data <span class="token operator">=</span> strategy_development<span class="token punctuation">(</span>
        selected_features<span class="token punctuation">,</span> target_variable<span class="token punctuation">,</span> target_variables
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> strategy_data


<span class="token comment"># 执行风险控制与策略优化</span>
strategy_data <span class="token operator">=</span> risk_management<span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
strategy_data <span class="token operator">=</span> strategy_optimization<span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
<span class="token comment"># 执行策略回测与评估</span>
strategy_data <span class="token operator">=</span> strategy_backtest<span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
strategy_evaluation<span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
plot_strategy_performance<span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="53__801">
     </a>
     5.3 项目中的挑战与解决方案
    </h3>
    <ul>
     <li>
      <strong>
       数据质量问题
      </strong>
      ：A 股市场数据可能存在缺失、异常等情况，通过数据清洗、插值等方法进行处理。
     </li>
     <li>
      <strong>
       特征提取的难点
      </strong>
      ：时间序列数据具有复杂的波动性和季节性，通过综合运用多种特征提取方法和参数调整，确保提取的特征具有代表性和预测能力。
     </li>
     <li>
      <strong>
       模型过拟合问题
      </strong>
      ：通过交叉验证、正则化等手段，避免模型对训练数据的过度拟合，提高模型的泛化能力。
     </li>
    </ul>
    <h2>
     <a id="_807">
     </a>
     附录
    </h2>
    <p>
     以下是
     <code>
      tsfresh
     </code>
     提供的预定义字典及其说明：
    </p>
    <ol>
     <li>
      <strong>
       ComprehensiveFCParameters
      </strong>
     </li>
    </ol>
    <ul>
     <li>
      <strong>
       说明
      </strong>
      ：包含所有特征提取函数，以及所有可能的参数组合。这是
      <code>
       tsfresh
      </code>
      默认的特征提取设置，如果不指定
      <code>
       default_fc_parameters
      </code>
      ，则会使用此设置。
     </li>
     <li>
      <strong>
       特点
      </strong>
      ：计算全面，但计算成本较高。
     </li>
    </ul>
    <ol start="2">
     <li>
      <strong>
       MinimalFCParameters
      </strong>
     </li>
    </ol>
    <ul>
     <li>
      <strong>
       说明
      </strong>
      ：只包含少量特征提取函数，用于快速测试。
     </li>
     <li>
      <strong>
       特点
      </strong>
      ：计算速度快，但特征覆盖范围有限。
     </li>
    </ul>
    <ol start="3">
     <li>
      <strong>
       EfficientFCParameters
      </strong>
     </li>
    </ol>
    <ul>
     <li>
      <strong>
       说明
      </strong>
      ：与
      <code>
       ComprehensiveFCParameters
      </code>
      类似，但去掉了标记为“高计算成本”的特征。
     </li>
     <li>
      <strong>
       特点
      </strong>
      ：在计算效率和特征覆盖之间取得了平衡，适合对运行时间要求较高的场景。
     </li>
    </ul>
    <h3>
     <a id="ComprehensiveFCParameters_826">
     </a>
     ComprehensiveFCParameters
    </h3>
    <p>
     <code>
      ComprehensiveFCParameters
     </code>
     是
     <code>
      tsfresh
     </code>
     提供的一个预定义字典，用于提取时间序列的全面特征集合。它包含了所有无参数的特征提取函数，以及所有有参数的特征提取函数及其不同的参数组合。
    </p>
    <table>
     <thead>
      <tr>
       <th>
        特征提取函数名称
       </th>
       <th>
        参数
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         abs_energy
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         absolute_sum_of_changes
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         agg_autocorrelation
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         lag
        </code>
        和
        <code>
         aggtype
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         agg_linear_trend
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         chunk_len
        </code>
        和
        <code>
         f_agg
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         approximate_entropy
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         m
        </code>
        和
        <code>
         r
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         ar_coefficient
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         coeff
        </code>
        和
        <code>
         k
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         augmented_dickey_fuller
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         attr
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         autocorrelation
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         lag
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         binned_entropy
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         max_bins
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         c3
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         lag
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         change_quantiles
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         ql
        </code>
        ,
        <code>
         qh
        </code>
        ,
        <code>
         isabs
        </code>
        , 和
        <code>
         f_agg
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         cid_ce
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : normalize：布尔值（True 或 False）
       </td>
      </tr>
      <tr>
       <td>
        <code>
         count_above
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         t
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         count_above_mean
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         count_below
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         t
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         count_below_mean
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         cwt_coefficients
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         widths
        </code>
        ,
        <code>
         coeff
        </code>
        , 和
        <code>
         w
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         energy_ratio_by_chunks
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         num_segments
        </code>
        和
        <code>
         segment_focus
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         fft_aggregated
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         aggtype
        </code>
        的字典列表：“centroid”、“variance”、“skew”、“kurtosis”
       </td>
      </tr>
      <tr>
       <td>
        <code>
         fft_coefficient
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         coeff
        </code>
        和
        <code>
         attr
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         first_location_of_maximum
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         first_location_of_minimum
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         friedrich_coefficients
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         m
        </code>
        ,
        <code>
         r
        </code>
        , 和
        <code>
         coeff
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         has_duplicate
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         has_duplicate_max
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         has_duplicate_min
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         index_mass_quantile
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         q
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         kurtosis
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         large_standard_deviation
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         r
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         last_location_of_maximum
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         last_location_of_minimum
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         length
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         linear_trend
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         attr
        </code>
        的字典列表：
        <code>
         "pvalue"
        </code>
        ：线性回归的 p 值。
        <code>
         "rvalue"
        </code>
        ：线性回归的相关系数。
        <code>
         "intercept"
        </code>
        ：线性回归的截距。
        <code>
         "slope"
        </code>
        ：线性回归的斜率。
        <code>
         "stderr"
        </code>
        ：线性回归的标准误差。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         longest_strike_above_mean
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         longest_strike_below_mean
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_abs_change
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_change
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_second_derivative_central
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         median
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         number_crossing_m
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         m
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         number_cwt_peaks
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         n
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         number_peaks
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         n
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         partial_autocorrelation
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         lag
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         percentage_of_reoccurring_datapoints_to_all_datapoints
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         percentage_of_reoccurring_values_to_all_values
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         quantile
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         q
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         range_count
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         min
        </code>
        和
        <code>
         max
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         ratio_beyond_r_sigma
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         r
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         ratio_value_number_to_time_series_length
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         skewness
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         spkt_welch_density
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         coeff
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         standard_deviation
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         sum_of_reoccurring_data_points
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         sum_of_reoccurring_values
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         sum_of_values
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         symmetry_looking
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         r
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         time_reversal_asymmetry_statistic
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         lag
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         variance
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         variance_larger_than_standard_deviation
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="MinimalFCParameters_893">
     </a>
     MinimalFCParameters
    </h3>
    <p>
     <code>
      EfficientFCParameters
     </code>
     是
     <code>
      tsfresh
     </code>
     提供的一种预定义特征提取参数设置，旨在平衡计算效率和特征覆盖范围。它去掉了计算成本较高且冗余的特征，适合在实际应用中快速提取有效特征。
    </p>
    <table>
     <thead>
      <tr>
       <th>
        特征提取函数名称
       </th>
       <th>
        参数
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         abs_energy
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         median
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         std
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         variance
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         minimum
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         maximum
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_abs_change
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_change
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_second_derivative_central
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         first_location_of_maximum
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         first_location_of_minimum
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         last_location_of_maximum
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         last_location_of_minimum
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         longest_strike_above_mean
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         longest_strike_below_mean
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         count_above_mean
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         count_below_mean
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         ratio_value_number_to_time_series_length
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         autocorrelation
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         lag
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         fft_coefficient
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         coeff
        </code>
        和
        <code>
         attr
        </code>
        的字典列表：coeff 是傅里叶系数的索引，attr 是系数的属性，可以是 “real”、“imag”、“abs”、“angle”
       </td>
      </tr>
      <tr>
       <td>
        <code>
         linear_trend
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         attr
        </code>
        的字典列表
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="EfficientFCParameters_922">
     </a>
     EfficientFCParameters
    </h3>
    <p>
     <code>
      EfficientFCParameters
     </code>
     是
     <code>
      tsfresh
     </code>
     提供的一种预定义特征提取参数设置，旨在平衡计算效率和特征覆盖范围。它去掉了计算成本较高且冗余的特征，适合在实际应用中快速提取有效特征。
    </p>
    <table>
     <thead>
      <tr>
       <th>
        特征提取函数名称
       </th>
       <th>
        参数
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         abs_energy
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         median
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         std
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         variance
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         minimum
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         maximum
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_abs_change
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_change
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_second_derivative_central
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         first_location_of_maximum
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         first_location_of_minimum
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         last_location_of_maximum
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         last_location_of_minimum
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         longest_strike_above_mean
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         longest_strike_below_mean
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         count_above_mean
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         count_below_mean
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         ratio_value_number_to_time_series_length
        </code>
       </td>
       <td>
        无参数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         autocorrelation
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         lag
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         fft_coefficient
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         coeff
        </code>
        和
        <code>
         attr
        </code>
        的字典列表
       </td>
      </tr>
      <tr>
       <td>
        <code>
         linear_trend
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : 包含
        <code>
         attr
        </code>
        的字典列表
       </td>
      </tr>
     </tbody>
    </table>
    <blockquote>
     <p>
      <strong>
       风险提示与免责声明
      </strong>
      <br/>
      本文内容基于公开信息研究整理，不构成任何形式的投资建议。历史表现不应作为未来收益保证，市场存在不可预见的波动风险。投资者需结合自身财务状况及风险承受能力独立决策，并自行承担交易结果。作者及发布方不对任何依据本文操作导致的损失承担法律责任。市场有风险，投资须谨慎。
     </p>
    </blockquote>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34373333393931362f:61727469636c652f64657461696c732f313436323837303039" class_="artid" style="display:none">
 </p>
</div>


