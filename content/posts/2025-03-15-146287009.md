---
layout: post
title: "tsfreshæ—¶é—´åºåˆ—ç‰¹å¾è‡ªåŠ¨æå–ä¸åº”ç”¨"
date: 2025-03-15 22:47:16 +0800
description: "æœ¬æ–‡ç³»ç»Ÿä»‹ç»äº† tsfresh ä»åŸºç¡€ç‰¹å¾æå–åˆ°é«˜çº§ç­–ç•¥å¼€å‘ï¼Œç»“åˆå®æˆ˜æ¡ˆä¾‹ï¼Œè¯¦ç»†è®²è§£äº†å¦‚ä½•åˆ©ç”¨ tsfresh æ„å»ºé‡åŒ–æŠ•èµ„ç­–ç•¥ï¼Œå¹¶ä¼˜åŒ–é£é™©æ§åˆ¶ã€‚"
keywords: "tsfreshï¼šæ—¶é—´åºåˆ—ç‰¹å¾è‡ªåŠ¨æå–ä¸åº”ç”¨"
categories: ['é‡‘èç§‘æŠ€', 'Python']
tags: ['é£é™©æ§åˆ¶', 'é‡åŒ–ç­–ç•¥', 'ç­–ç•¥å›æµ‹', 'Tsfresh', 'Sklearn', 'Python']
artid: "146287009"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146287009
    alt: "tsfreshæ—¶é—´åºåˆ—ç‰¹å¾è‡ªåŠ¨æå–ä¸åº”ç”¨"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146287009
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146287009
cover: https://bing.ee123.net/img/rand?artid=146287009
image: https://bing.ee123.net/img/rand?artid=146287009
img: https://bing.ee123.net/img/rand?artid=146287009
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     tsfreshï¼šæ—¶é—´åºåˆ—ç‰¹å¾è‡ªåŠ¨æå–ä¸åº”ç”¨
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     tsfreshï¼šæ—¶é—´åºåˆ—ç‰¹å¾è‡ªåŠ¨æå–ä¸åº”ç”¨
    </p>
    <blockquote>
     <p>
      æœ¬æ–‡ç³»ç»Ÿä»‹ç»äº† tsfresh æŠ€æœ¯åœ¨ A è‚¡å¸‚åœºæ•°æ®åˆ†æä¸é‡åŒ–æŠ•èµ„ä¸­çš„åº”ç”¨ã€‚ä»åŸºç¡€ç‰¹å¾æå–åˆ°é«˜çº§ç­–ç•¥å¼€å‘ï¼Œç»“åˆå®æˆ˜æ¡ˆä¾‹ï¼Œè¯¦ç»†è®²è§£äº†å¦‚ä½•åˆ©ç”¨ tsfresh æ„å»ºé‡åŒ–æŠ•èµ„ç­–ç•¥ï¼Œå¹¶ä¼˜åŒ–é£é™©æ§åˆ¶ï¼ŒåŠ©åŠ›è¯»è€…å…¨é¢æŒæ¡æ—¶é—´åºåˆ—ç‰¹å¾æå–åœ¨é‡åŒ–é¢†åŸŸçš„æŠ€æœ¯åº”ç”¨ã€‚
      <br/>
      <em>
       æ–‡ä¸­å†…å®¹ä»…é™æŠ€æœ¯å­¦ä¹ ä¸ä»£ç å®è·µå‚è€ƒï¼Œå¸‚åœºå­˜åœ¨ä¸ç¡®å®šæ€§ï¼ŒæŠ€æœ¯åˆ†æéœ€è°¨æ…éªŒè¯ï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚é€‚åˆé‡åŒ–æ–°æ‰‹å»ºç«‹ç³»ç»Ÿè®¤çŸ¥ï¼Œä¸ºç­–ç•¥å¼€å‘æ‰“ä¸‹åŸºç¡€ã€‚
      </em>
     </p>
    </blockquote>
    <h2>
     <a id="tsfresh__5">
     </a>
     ç¬¬ä¸€ç« ï¼štsfresh æŠ€æœ¯æ¦‚è¿°ä¸ç¯å¢ƒæ­å»º
    </h2>
    <h3>
     <a id="11_tsfresh__7">
     </a>
     1.1 tsfresh ç®€ä»‹
    </h3>
    <p>
     tsfresh æ˜¯ä¸€ä¸ªç”¨äºæ—¶é—´åºåˆ—ç‰¹å¾æå–çš„ Python åº“ï¼Œå®ƒèƒ½å¤Ÿè‡ªåŠ¨ä»æ—¶é—´åºåˆ—æ•°æ®ä¸­æå–å¤§é‡ç‰¹å¾ï¼Œå¹¶é€šè¿‡ç»Ÿè®¡æ£€éªŒç­›é€‰å‡ºä¸ç›®æ ‡å˜é‡ç›¸å…³çš„ç‰¹å¾ï¼Œç®€åŒ–äº†æ—¶é—´åºåˆ—æ•°æ®åˆ†ææµç¨‹ï¼Œå¹¿æ³›åº”ç”¨äºé¢„æµ‹ç»´æŠ¤ã€é‡‘èåˆ†æç­‰é¢†åŸŸã€‚
    </p>
    <h3>
     <a id="12__11">
     </a>
     1.2 ç¯å¢ƒæ­å»º
    </h3>
    <h4>
     <a id="tsfresh__13">
     </a>
     tsfresh å®‰è£…
    </h4>
    <pre><code class="prism language-bash">pip <span class="token function">install</span> <span class="token string">"tsfresh[dask]"</span>
</code></pre>
    <p>
     æ¨èé˜…è¯»ï¼š
     <a href="https://stock.blog.csdn.net/article/details/146264849" rel="nofollow">
      Daskï¼šPythoné«˜æ•ˆå¹¶è¡Œè®¡ç®—åˆ©å™¨ ğŸ”¥
     </a>
    </p>
    <h4>
     <a id="_20">
     </a>
     éªŒè¯å®‰è£…æˆåŠŸä¸å¦
    </h4>
    <p>
     å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹Pythonä»£ç éªŒè¯tsfreshæ˜¯å¦å®‰è£…æˆåŠŸï¼š
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> tsfresh
<span class="token keyword">print</span><span class="token punctuation">(</span>tsfresh<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
</code></pre>
    <p>
     å¦‚æœè¾“å‡ºäº†ç‰ˆæœ¬å·ï¼Œè¯´æ˜å®‰è£…æˆåŠŸã€‚
    </p>
    <h4>
     <a id="_31">
     </a>
     ç›¸å…³ä¾èµ–åº“å®‰è£…
    </h4>
    <pre><code class="prism language-bash"><span class="token comment"># å®‰è£… pandasã€numpyã€matplotlib ç­‰åº“</span>
pip <span class="token function">install</span> pandas numpy matplotlib
</code></pre>
    <h4>
     <a id="Tushare__38">
     </a>
     Tushare æ•°æ®æ¥å£ç”³è¯·ä¸é…ç½®
    </h4>
    <ol>
     <li>
      è®¿é—®
      <a href="https://tushare.pro/" rel="nofollow">
       Tushare å®˜ç½‘
      </a>
      æ³¨å†Œè´¦å·å¹¶è·å– API Tokenã€‚
     </li>
     <li>
      å®‰è£… Tushare Python SDKï¼š
     </li>
    </ol>
    <pre><code class="prism language-bash">pip <span class="token function">install</span> tushare
</code></pre>
    <ol start="3">
     <li>
      é…ç½® Tushare APIï¼š
     </li>
    </ol>
    <pre><code class="prism language-python"><span class="token keyword">import</span> tushare <span class="token keyword">as</span> ts
ts<span class="token punctuation">.</span>set_token<span class="token punctuation">(</span><span class="token string">"your_token"</span><span class="token punctuation">)</span>  <span class="token comment"># æ›¿æ¢ä¸ºä½ çš„Tushare Token</span>
pro <span class="token operator">=</span> ts<span class="token punctuation">.</span>pro_api<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="13__55">
     </a>
     1.3 æ•°æ®å‡†å¤‡
    </h3>
    <h4>
     <a id="_Tushare__A__57">
     </a>
     ä½¿ç”¨ Tushare è·å– A è‚¡å¸‚åœºæ•°æ®
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token comment"># è·å–æŸè‚¡ç¥¨çš„å†å²æ—¥çº¿æ•°æ®</span>
<span class="token keyword">def</span> <span class="token function">get_stock_data</span><span class="token punctuation">(</span>ts_code<span class="token punctuation">,</span> start_date<span class="token punctuation">,</span> end_date<span class="token punctuation">)</span><span class="token punctuation">:</span>
    df <span class="token operator">=</span> pro<span class="token punctuation">.</span>daily<span class="token punctuation">(</span>ts_code<span class="token operator">=</span>ts_code<span class="token punctuation">,</span> start_date<span class="token operator">=</span>start_date<span class="token punctuation">,</span> end_date<span class="token operator">=</span>end_date<span class="token punctuation">)</span>
    <span class="token keyword">return</span> df

<span class="token comment"># ç¤ºä¾‹ï¼šè·å–è‚¡ç¥¨ 000001.SZ çš„ 2024å¹´æ•°æ®</span>
stock_data <span class="token operator">=</span> get_stock_data<span class="token punctuation">(</span><span class="token string">"000001.SZ"</span><span class="token punctuation">,</span> <span class="token string">"20240101"</span><span class="token punctuation">,</span> <span class="token string">"20241231"</span><span class="token punctuation">)</span>
stock_data<span class="token punctuation">[</span><span class="token string">"trade_date"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>stock_data<span class="token punctuation">[</span><span class="token string">"trade_date"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
stock_data<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>stock_data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_74">
     </a>
     æ•°æ®å­˜å‚¨ä¸ç®¡ç†
    </h4>
    <p>
     Parquetæ˜¯ä¸€ç§é«˜æ•ˆçš„åˆ—å¼å­˜å‚¨æ ¼å¼ï¼Œé€‚ç”¨äºå¤§æ•°æ®å¤„ç†ã€‚å®ƒå…·æœ‰é«˜å‹ç¼©æ¯”å’Œå¿«é€Ÿè¯»å–çš„ç‰¹ç‚¹ï¼Œé€‚åˆå­˜å‚¨å¤§è§„æ¨¡æ•°æ®ã€‚
    </p>
    <p>
     æ¨èé˜…è¯»:
    </p>
    <ul>
     <li>
      <a href="https://blog.csdn.net/weixin_47339916/article/details/146050258">
       Pandas+PyArrowï¼šè‚¡ç¥¨æ•°æ®å­˜å‚¨ Parquet å…¥é—¨æŒ‡å¼• ğŸ”¥
      </a>
     </li>
     <li>
      <a href="https://blog.csdn.net/weixin_47339916/article/details/146022244">
       Aè‚¡æ•°æ®å­˜å‚¨å®æˆ˜ï¼šParquetæŠ€æœ¯æ·±åº¦è§£æ ğŸ”¥
      </a>
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token comment"># å°†è·å–çš„æ•°æ®å­˜å‚¨ä¸ºParquetæ–‡ä»¶</span>
stock_data<span class="token punctuation">.</span>to_parquet<span class="token punctuation">(</span><span class="token string">"./data/000001.SZ.parquet"</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token comment"># ä»Parquetæ–‡ä»¶è¯»å–æ•°æ®</span>
stock_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_parquet<span class="token punctuation">(</span><span class="token string">"./data/000001.SZ.parquet"</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>stock_data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_93">
     </a>
     æ•°æ®æ¸…æ´—ä¸é¢„å¤„ç†
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># æ£€æŸ¥ç¼ºå¤±å€¼</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>stock_data<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># å¤„ç†ç¼ºå¤±å€¼ï¼Œä¾‹å¦‚ç”¨å‰ä¸€æ—¥æ•°æ®å¡«å……</span>
stock_data<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"ffill"</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># æŒ‰äº¤æ˜“æ—¥æœŸæ’åº</span>
stock_data<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>
    <h2>
     <a id="_106">
     </a>
     ç¬¬äºŒç« ï¼šæ—¶é—´åºåˆ—ç‰¹å¾æå–åŸºç¡€
    </h2>
    <h3>
     <a id="21__108">
     </a>
     2.1 æ—¶é—´åºåˆ—ç‰¹å¾æå–æ¦‚è¿°
    </h3>
    <p>
     æ—¶é—´åºåˆ—ç‰¹å¾æå–æ˜¯ä»æ—¶é—´åºåˆ—æ•°æ®ä¸­æå–å‡ºèƒ½å¤Ÿä»£è¡¨å…¶ä¸»è¦ç‰¹å¾çš„ä¿¡æ¯ï¼Œè¿™äº›ç‰¹å¾å¯ä»¥ç”¨äºåç»­çš„æ•°æ®åˆ†æã€å»ºæ¨¡å’Œé¢„æµ‹ã€‚åœ¨é‡‘èé¢†åŸŸï¼Œæ—¶é—´åºåˆ—ç‰¹å¾æå–å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£å¸‚åœºè¶‹åŠ¿ã€è¯†åˆ«äº¤æ˜“æ¨¡å¼ã€æ„å»ºé¢„æµ‹æ¨¡å‹ç­‰ã€‚
    </p>
    <p>
     tsfresh æä¾›äº†å…¨é¢çš„ç‰¹å¾æå–åŠŸèƒ½ï¼Œèƒ½å¤Ÿè‡ªåŠ¨ä»æ—¶é—´åºåˆ—æ•°æ®ä¸­æå–å¤§é‡ç‰¹å¾ï¼Œå¹¶é€šè¿‡ç»Ÿè®¡æ£€éªŒç­›é€‰å‡ºä¸ç›®æ ‡å˜é‡ç›¸å…³çš„ç‰¹å¾ï¼Œå¤§å¤§ç®€åŒ–äº†ç‰¹å¾å·¥ç¨‹çš„æµç¨‹ã€‚
    </p>
    <h3>
     <a id="22__114">
     </a>
     2.2 åŸºæœ¬ç‰¹å¾æå–æ–¹æ³•
    </h3>
    <h4>
     <a id="_116">
     </a>
     ç»Ÿè®¡ç‰¹å¾
    </h4>
    <p>
     ç»Ÿè®¡ç‰¹å¾æ˜¯æœ€åŸºæœ¬çš„ç‰¹å¾ç±»å‹ï¼ŒåŒ…æ‹¬å‡å€¼ã€æ–¹å·®ã€ä¸­ä½æ•°ã€æå€¼ç­‰ã€‚è¿™äº›ç‰¹å¾èƒ½å¤Ÿåæ˜ æ—¶é—´åºåˆ—æ•°æ®çš„é›†ä¸­è¶‹åŠ¿å’Œç¦»æ•£ç¨‹åº¦ã€‚
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> tsfresh <span class="token keyword">import</span> extract_features


<span class="token comment"># å‡è®¾ stock_data æ˜¯ä¹‹å‰è·å–çš„è‚¡ç¥¨æ•°æ®ï¼ŒåŒ…å« 'close' åˆ—</span>
<span class="token comment"># ä¸º tsfresh å‡†å¤‡æ•°æ®ï¼Œéœ€è¦å°†æ—¶é—´åºåˆ—æ•°æ®æ•´ç†æˆç‰¹å®šæ ¼å¼</span>
<span class="token keyword">def</span> <span class="token function">prepare_tsfresh_data</span><span class="token punctuation">(</span>stock_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ä¸ºæ¯è¡Œæ•°æ®æ·»åŠ ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œè¡¨ç¤ºå±äºåŒä¸€ä¸ªæ—¶é—´åºåˆ—</span>
    stock_data<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>stock_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># é€‰æ‹©éœ€è¦çš„åˆ—ï¼ŒåŒ…æ‹¬æ ‡è¯†ç¬¦ã€æ—¶é—´æˆ³å’Œç›®æ ‡å€¼</span>
    ts_data <span class="token operator">=</span> stock_data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"trade_date"</span><span class="token punctuation">,</span> <span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> ts_data


ts_data <span class="token operator">=</span> prepare_tsfresh_data<span class="token punctuation">(</span>stock_data<span class="token punctuation">)</span>

<span class="token comment"># æå–ç»Ÿè®¡ç‰¹å¾</span>
statistical_features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
    default_fc_parameters<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"mean"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        <span class="token string">"variance"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        <span class="token string">"median"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        <span class="token string">"maximum"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        <span class="token string">"minimum"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>statistical_features<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_153">
     </a>
     æ—¶é—´åŸŸç‰¹å¾
    </h4>
    <p>
     æ—¶é—´åŸŸç‰¹å¾å…³æ³¨æ—¶é—´åºåˆ—åœ¨æ—¶é—´ç»´åº¦ä¸Šçš„å˜åŒ–ç‰¹æ€§ï¼Œå¦‚è¶‹åŠ¿ã€å‘¨æœŸæ€§ã€æ³¢åŠ¨æ€§ç­‰ã€‚
    </p>
    <pre><code class="prism language-python"><span class="token comment"># å®šä¹‰è¦æå–çš„æ—¶é—´åŸŸç‰¹å¾</span>
time_domain_features <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"abs_energy"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
    <span class="token string">"absolute_sum_of_changes"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
    <span class="token string">"cid_ce"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"normalize"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"normalize"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"friedrich_coefficients"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"coeff"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"m"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"linear_trend"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"attr"</span><span class="token punctuation">:</span> <span class="token string">"pvalue"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"attr"</span><span class="token punctuation">:</span> <span class="token string">"rvalue"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"attr"</span><span class="token punctuation">:</span> <span class="token string">"intercept"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"attr"</span><span class="token punctuation">:</span> <span class="token string">"slope"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"attr"</span><span class="token punctuation">:</span> <span class="token string">"stderr"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"spkt_welch_density"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"coeff"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"binned_entropy"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"max_bins"</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment"># æå–æ—¶é—´åŸŸç‰¹å¾</span>
td_features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
    default_fc_parameters<span class="token operator">=</span>time_domain_features<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>td_features<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_186">
     </a>
     é¢‘åŸŸç‰¹å¾
    </h4>
    <p>
     é¢‘åŸŸç‰¹å¾é€šè¿‡å‚…é‡Œå¶å˜æ¢ç­‰æ–¹æ³•å°†æ—¶é—´åºåˆ—æ•°æ®è½¬æ¢åˆ°é¢‘åŸŸï¼Œæå–é¢‘ç‡æˆåˆ†ã€åŠŸç‡è°±ç­‰ä¿¡æ¯ã€‚
    </p>
    <pre><code class="prism language-python"><span class="token comment"># æå–é¢‘åŸŸç‰¹å¾</span>
frequency_domain_features <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"fft_aggregated"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"aggtype"</span><span class="token punctuation">:</span> <span class="token string">"centroid"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"aggtype"</span><span class="token punctuation">:</span> <span class="token string">"variance"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"aggtype"</span><span class="token punctuation">:</span> <span class="token string">"skew"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"aggtype"</span><span class="token punctuation">:</span> <span class="token string">"kurtosis"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"fft_coefficient"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"coeff"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"attr"</span><span class="token punctuation">:</span> <span class="token string">"real"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"coeff"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"attr"</span><span class="token punctuation">:</span> <span class="token string">"real"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"index_mass_quantile"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"q"</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"number_peaks"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"n"</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

fd_features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
    default_fc_parameters<span class="token operator">=</span>frequency_domain_features<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>fd_features<span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="23__A__214">
     </a>
     2.3 å®æˆ˜ï¼šå¯¹ A è‚¡æŸè‚¡ç¥¨çš„å†å²ä»·æ ¼æ•°æ®è¿›è¡ŒåŸºæœ¬ç‰¹å¾æå–
    </h3>
    <pre><code class="prism language-python"><span class="token comment"># ç»¼åˆæå–ç»Ÿè®¡ç‰¹å¾ã€æ—¶é—´åŸŸç‰¹å¾å’Œé¢‘åŸŸç‰¹å¾</span>
<span class="token keyword">from</span> tsfresh<span class="token punctuation">.</span>feature_extraction <span class="token keyword">import</span> ComprehensiveFCParameters

<span class="token comment"># å®šä¹‰ç»¼åˆç‰¹å¾æå–å‚æ•°</span>
comprehensive_features <span class="token operator">=</span> ComprehensiveFCParameters<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># ç§»é™¤ä¸éœ€è¦çš„ç‰¹å¾</span>
comprehensive_features<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"fft_aggregated"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
comprehensive_features<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"fft_coefficient"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
comprehensive_features<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"index_mass_quantile"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
comprehensive_features<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"number_peaks"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
comprehensive_features<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"spectral_entropy"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>

<span class="token comment"># æå–ç»¼åˆç‰¹å¾</span>
all_features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
    default_fc_parameters<span class="token operator">=</span>comprehensive_features<span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># æŸ¥çœ‹æå–çš„ç‰¹å¾</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>all_features<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># ç‰¹å¾å¯è§†åŒ–</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># ç»˜åˆ¶æ”¶ç›˜ä»·èµ°åŠ¿å›¾</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>stock_data<span class="token punctuation">[</span><span class="token string">"trade_date"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stock_data<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Stock Closing Price Trend"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"Trade Date"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Closing Price"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># ç»˜åˆ¶æå–çš„ç‰¹å¾åˆ†å¸ƒ</span>
<span class="token keyword">import</span> random

sampled_features <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>
    all_features<span class="token punctuation">.</span>columns<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">25</span>
<span class="token punctuation">)</span>  <span class="token comment"># éšæœºé€‰å–25ä¸ªç‰¹å¾ç¤ºä¾‹</span>
all_features<span class="token punctuation">[</span>sampled_features<span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    kind<span class="token operator">=</span><span class="token string">"hist"</span><span class="token punctuation">,</span> subplots<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> layout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h2>
     <a id="_265">
     </a>
     ç¬¬ä¸‰ç« ï¼šé«˜çº§æ—¶é—´åºåˆ—ç‰¹å¾æå–
    </h2>
    <h3>
     <a id="31__267">
     </a>
     3.1 é«˜çº§ç‰¹å¾æå–æŠ€æœ¯
    </h3>
    <h4>
     <a id="_269">
     </a>
     è‡ªåŠ¨ç‰¹å¾æå–
    </h4>
    <p>
     tsfresh çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå…¶èƒ½å¤Ÿè‡ªåŠ¨ä»æ—¶é—´åºåˆ—æ•°æ®ä¸­æå–å¤§é‡ç‰¹å¾ï¼Œæ— éœ€æ‰‹åŠ¨å®šä¹‰æ¯ä¸ªç‰¹å¾ã€‚
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> tsfresh <span class="token keyword">import</span> extract_features
<span class="token keyword">from</span> tsfresh<span class="token punctuation">.</span>feature_extraction <span class="token keyword">import</span> ComprehensiveFCParameters

<span class="token comment"># å®šä¹‰è‡ªåŠ¨ç‰¹å¾æå–å‚æ•°</span>
automatic_features <span class="token operator">=</span> ComprehensiveFCParameters<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># æå–è‡ªåŠ¨ç‰¹å¾</span>
auto_features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
    default_fc_parameters<span class="token operator">=</span>automatic_features<span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># æŸ¥çœ‹æå–çš„ç‰¹å¾æ•°é‡å’Œéƒ¨åˆ†ç‰¹å¾</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Extracted </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>auto_features<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> features."</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>auto_features<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_294">
     </a>
     ç‰¹å¾ç­›é€‰ä¸é€‰æ‹©
    </h4>
    <p>
     æå–å¤§é‡ç‰¹å¾åï¼Œéœ€è¦è¿›è¡Œç­›é€‰ä»¥é€‰æ‹©ä¸ç›®æ ‡å˜é‡ç›¸å…³çš„ç‰¹å¾ï¼Œå‡å°‘ç»´åº¦å¹¶æé«˜æ¨¡å‹æ€§èƒ½ã€‚
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> tsfresh <span class="token keyword">import</span> select_features

<span class="token comment"># å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç›®æ ‡å˜é‡ï¼Œä¾‹å¦‚è‚¡ç¥¨çš„æœªæ¥æ”¶ç›Šç‡</span>
<span class="token comment"># è¿™é‡Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µæ„å»ºç›®æ ‡å˜é‡</span>
<span class="token comment"># target = ...</span>

<span class="token comment"># ç­›é€‰ä¸ç›®æ ‡å˜é‡ç›¸å…³çš„ç‰¹å¾</span>
selected_features <span class="token operator">=</span> select_features<span class="token punctuation">(</span>auto_features<span class="token punctuation">,</span> target<span class="token punctuation">)</span>

<span class="token comment"># æŸ¥çœ‹ç­›é€‰åçš„ç‰¹å¾æ•°é‡å’Œéƒ¨åˆ†ç‰¹å¾</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Selected </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>selected_features<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> features."</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>selected_features<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_313">
     </a>
     ç‰¹å¾å·¥ç¨‹æŠ€å·§
    </h4>
    <ul>
     <li>
      <strong>
       ç‰¹å¾ç»„åˆ
      </strong>
      ï¼šå°†å¤šä¸ªåŸºç¡€ç‰¹å¾ç»„åˆæˆæ–°çš„ç‰¹å¾ï¼Œä¾‹å¦‚è®¡ç®—ä¸¤ä¸ªæ—¶é—´åºåˆ—çš„æ¯”ç‡æˆ–å·®å€¼ã€‚
     </li>
     <li>
      <strong>
       æ—¶é—´çª—å£ç‰¹å¾
      </strong>
      ï¼šåœ¨ä¸åŒæ—¶é—´çª—å£ä¸Šæå–ç‰¹å¾ï¼Œæ•æ‰çŸ­æœŸå’Œé•¿æœŸè¶‹åŠ¿ã€‚
     </li>
     <li>
      <strong>
       æ»åç‰¹å¾
      </strong>
      ï¼šåˆ›å»ºæ»åç‰ˆæœ¬çš„æ—¶é—´åºåˆ—ï¼Œç”¨äºæ•æ‰è¿‡å»å€¼å¯¹å½“å‰å€¼çš„å½±å“ã€‚
     </li>
    </ul>
    <h3>
     <a id="32__A__319">
     </a>
     3.2 å®æˆ˜ï¼šæ·±å…¥æå– A è‚¡å¸‚åœºæ—¶é—´åºåˆ—ç‰¹å¾
    </h3>
    <h4>
     <a id="_321">
     </a>
     å¤šåªè‚¡ç¥¨æ•°æ®çš„ç‰¹å¾æå–
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">from</span> tsfresh <span class="token keyword">import</span> extract_features
<span class="token keyword">from</span> tsfresh<span class="token punctuation">.</span>feature_extraction <span class="token keyword">import</span> ComprehensiveFCParameters

<span class="token comment"># å®šä¹‰è‡ªåŠ¨ç‰¹å¾æå–å‚æ•°</span>
automatic_features <span class="token operator">=</span> ComprehensiveFCParameters<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment"># ä¸º tsfresh å‡†å¤‡æ•°æ®</span>
<span class="token keyword">def</span> <span class="token function">prepare_tsfresh_data_multi</span><span class="token punctuation">(</span>stocks_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    stocks_data<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
        stocks_data<span class="token punctuation">[</span><span class="token string">"ts_code"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"_"</span> <span class="token operator">+</span> stocks_data<span class="token punctuation">[</span><span class="token string">"trade_date"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    ts_data_multi <span class="token operator">=</span> stocks_data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"trade_date"</span><span class="token punctuation">,</span> <span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> ts_data_multi


ts_data_multi <span class="token operator">=</span> prepare_tsfresh_data_multi<span class="token punctuation">(</span>stocks_data<span class="token punctuation">)</span>

<span class="token comment"># æå–å¤šåªè‚¡ç¥¨çš„ç‰¹å¾</span>
auto_features_multi <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data_multi<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
    default_fc_parameters<span class="token operator">=</span>automatic_features<span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># æŸ¥çœ‹æå–çš„ç‰¹å¾</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>auto_features_multi<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_355">
     </a>
     ä¸åŒæ—¶é—´å‘¨æœŸæ•°æ®çš„ç‰¹å¾å¯¹æ¯”
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># è·å–æ—¥çº¿ã€å‘¨çº¿ã€æœˆçº¿æ•°æ®</span>
<span class="token keyword">def</span> <span class="token function">get_data_different_timeframes</span><span class="token punctuation">(</span>ts_code<span class="token punctuation">,</span> start_date<span class="token punctuation">,</span> end_date<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># æ—¥çº¿æ•°æ®</span>
    daily_data <span class="token operator">=</span> pro<span class="token punctuation">.</span>daily<span class="token punctuation">(</span>ts_code<span class="token operator">=</span>ts_code<span class="token punctuation">,</span> start_date<span class="token operator">=</span>start_date<span class="token punctuation">,</span> end_date<span class="token operator">=</span>end_date<span class="token punctuation">)</span>
    <span class="token comment"># å‘¨çº¿æ•°æ®</span>
    weekly_data <span class="token operator">=</span> pro<span class="token punctuation">.</span>weekly<span class="token punctuation">(</span>ts_code<span class="token operator">=</span>ts_code<span class="token punctuation">,</span> start_date<span class="token operator">=</span>start_date<span class="token punctuation">,</span> end_date<span class="token operator">=</span>end_date<span class="token punctuation">)</span>
    <span class="token comment"># æœˆçº¿æ•°æ®</span>
    monthly_data <span class="token operator">=</span> pro<span class="token punctuation">.</span>monthly<span class="token punctuation">(</span>
        ts_code<span class="token operator">=</span>ts_code<span class="token punctuation">,</span> start_date<span class="token operator">=</span>start_date<span class="token punctuation">,</span> end_date<span class="token operator">=</span>end_date
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> daily_data<span class="token punctuation">,</span> weekly_data<span class="token punctuation">,</span> monthly_data


<span class="token comment"># ç¤ºä¾‹ï¼šè·å–æŸè‚¡ç¥¨çš„ä¸åŒæ—¶é—´å‘¨æœŸæ•°æ®</span>
daily<span class="token punctuation">,</span> weekly<span class="token punctuation">,</span> monthly <span class="token operator">=</span> get_data_different_timeframes<span class="token punctuation">(</span>
    <span class="token string">"000001.SZ"</span><span class="token punctuation">,</span> <span class="token string">"20240101"</span><span class="token punctuation">,</span> <span class="token string">"20241231"</span>
<span class="token punctuation">)</span>

<span class="token comment"># åˆ†åˆ«æå–ä¸åŒæ—¶é—´å‘¨æœŸçš„ç‰¹å¾</span>
<span class="token keyword">def</span> <span class="token function">extract_features_timeframe</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> timeframe<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>timeframe <span class="token operator">+</span> <span class="token string">"_"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    ts_data <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"trade_date"</span><span class="token punctuation">,</span> <span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
        ts_data<span class="token punctuation">,</span>
        column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
        column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
        column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
        default_fc_parameters<span class="token operator">=</span>automatic_features<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> features


daily_features <span class="token operator">=</span> extract_features_timeframe<span class="token punctuation">(</span>daily<span class="token punctuation">,</span> <span class="token string">"daily"</span><span class="token punctuation">)</span>
weekly_features <span class="token operator">=</span> extract_features_timeframe<span class="token punctuation">(</span>weekly<span class="token punctuation">,</span> <span class="token string">"weekly"</span><span class="token punctuation">)</span>
monthly_features <span class="token operator">=</span> extract_features_timeframe<span class="token punctuation">(</span>monthly<span class="token punctuation">,</span> <span class="token string">"monthly"</span><span class="token punctuation">)</span>

<span class="token comment"># åˆå¹¶ä¸åŒæ—¶é—´å‘¨æœŸçš„ç‰¹å¾</span>
all_timeframe_features <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>daily_features<span class="token punctuation">,</span> weekly_features<span class="token punctuation">,</span> monthly_features<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>all_timeframe_features<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_399">
     </a>
     ç‰¹å¾å¯è§†åŒ–ä¸è§£è¯»
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># å¯è§†åŒ–æŸåªè‚¡ç¥¨çš„ç‰¹å¾åˆ†å¸ƒ</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># é€‰æ‹©æŸåªè‚¡ç¥¨çš„ç‰¹å¾æ•°æ®</span>
stock_features <span class="token operator">=</span> auto_features_multi<span class="token punctuation">[</span>
    auto_features_multi<span class="token punctuation">.</span>index<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">"000001.SZ"</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>

<span class="token comment"># å»é™¤ NaN å€¼</span>
stock_features <span class="token operator">=</span> stock_features<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># ç»˜åˆ¶éƒ¨åˆ†ç‰¹å¾çš„åˆ†å¸ƒ</span>
fig<span class="token punctuation">,</span> axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>nrows<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> ncols<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
axes <span class="token operator">=</span> axes<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span>

feature_columns <span class="token operator">=</span> stock_features<span class="token punctuation">.</span>columns<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>  <span class="token comment"># é€‰æ‹©å‰ 9 ä¸ªç‰¹å¾è¿›è¡Œå¯è§†åŒ–</span>

<span class="token keyword">for</span> i<span class="token punctuation">,</span> feature <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>feature_columns<span class="token punctuation">)</span><span class="token punctuation">:</span>
    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>hist<span class="token punctuation">(</span>stock_features<span class="token punctuation">[</span>feature<span class="token punctuation">]</span><span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span>feature<span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h2>
     <a id="_427">
     </a>
     ç¬¬å››ç« ï¼šæ—¶é—´åºåˆ—åˆ†ç±»ä¸å›å½’åº”ç”¨
    </h2>
    <h3>
     <a id="41__429">
     </a>
     4.1 æ—¶é—´åºåˆ—åˆ†ç±»åŸºç¡€
    </h3>
    <p>
     æ—¶é—´åºåˆ—åˆ†ç±»æ˜¯æ ¹æ®æ—¶é—´åºåˆ—çš„ç‰¹å¾å°†å…¶åˆ’åˆ†åˆ°ä¸åŒçš„ç±»åˆ«ä¸­ã€‚åœ¨ A è‚¡å¸‚åœºä¸­ï¼Œå¯ä»¥ç”¨äºè‚¡ç¥¨çš„è¡Œä¸šåˆ†ç±»ã€é£æ ¼åˆ†ç±»ç­‰ã€‚
    </p>
    <h4>
     <a id="_433">
     </a>
     å¸¸è§åˆ†ç±»ç®—æ³•
    </h4>
    <ul>
     <li>
      <strong>
       é€»è¾‘å›å½’
      </strong>
      ï¼šé€‚ç”¨äºäºŒåˆ†ç±»é—®é¢˜ã€‚
     </li>
     <li>
      <strong>
       æ”¯æŒå‘é‡æœº
      </strong>
      ï¼šé€‚ç”¨äºé«˜ç»´æ•°æ®åˆ†ç±»ã€‚
     </li>
     <li>
      <strong>
       éšæœºæ£®æ—
      </strong>
      ï¼šåŸºäºé›†æˆå­¦ä¹ çš„åˆ†ç±»ç®—æ³•ï¼Œå…·æœ‰è¾ƒé«˜çš„å‡†ç¡®æ€§å’Œé²æ£’æ€§ã€‚
     </li>
     <li>
      <strong>
       ç¥ç»ç½‘ç»œ
      </strong>
      ï¼šé€‚ç”¨äºå¤æ‚æ¨¡å¼è¯†åˆ«ã€‚
     </li>
    </ul>
    <h3>
     <a id="42__tsfresh__440">
     </a>
     4.2 ä½¿ç”¨ tsfresh è¿›è¡Œæ—¶é—´åºåˆ—åˆ†ç±»
    </h3>
    <h4>
     <a id="_442">
     </a>
     ç‰¹å¾æå–ä¸é€‰æ‹©
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">from</span> tsfresh <span class="token keyword">import</span> extract_features<span class="token punctuation">,</span> select_features

<span class="token comment"># å‡è®¾æˆ‘ä»¬æœ‰å¤šåªè‚¡ç¥¨çš„æ•°æ®ï¼Œts_data åŒ…å« 'id'ã€'trade_date' å’Œ 'close' åˆ—</span>
<span class="token comment"># æå–ç‰¹å¾</span>
features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç›®æ ‡åˆ†ç±»æ ‡ç­¾ï¼Œä¾‹å¦‚è‚¡ç¥¨çš„è¡Œä¸šåˆ†ç±»</span>
<span class="token comment"># labels = ...</span>

<span class="token comment"># ç­›é€‰ä¸åˆ†ç±»ç›¸å…³çš„ç‰¹å¾</span>
selected_features <span class="token operator">=</span> select_features<span class="token punctuation">(</span>features<span class="token punctuation">,</span> labels<span class="token punctuation">)</span>

<span class="token comment"># æŸ¥çœ‹ç­›é€‰åçš„ç‰¹å¾</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>selected_features<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_466">
     </a>
     åˆ†ç±»æ¨¡å‹è®­ç»ƒä¸è¯„ä¼°
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> accuracy_score<span class="token punctuation">,</span> classification_report

<span class="token comment"># æ•°æ®é›†åˆ’åˆ†</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>
    selected_features<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span>
<span class="token punctuation">)</span>

<span class="token comment"># æ¨¡å‹è®­ç»ƒ</span>
clf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

<span class="token comment"># æ¨¡å‹è¯„ä¼°</span>
y_pred <span class="token operator">=</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Accuracy: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_A__488">
     </a>
     å®æˆ˜ï¼šå¯¹ A è‚¡è‚¡ç¥¨è¿›è¡Œåˆ†ç±»
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># è·å–å¤šåªè‚¡ç¥¨çš„æ•°æ®å¹¶æå–ç‰¹å¾</span>
<span class="token comment"># å‡è®¾æˆ‘ä»¬å·²ç»è·å–äº†å¤šåªè‚¡ç¥¨çš„æ•°æ®å¹¶å­˜å‚¨åœ¨ stocks_data ä¸­</span>

<span class="token comment"># ä¸º tsfresh å‡†å¤‡æ•°æ®</span>
ts_data <span class="token operator">=</span> prepare_tsfresh_data_multi<span class="token punctuation">(</span>stocks_data<span class="token punctuation">)</span>

<span class="token comment"># æå–ç‰¹å¾</span>
features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¡Œä¸šåˆ†ç±»æ ‡ç­¾å­—å…¸ï¼Œkey ä¸ºè‚¡ç¥¨ä»£ç ï¼Œvalue ä¸ºè¡Œä¸šåˆ†ç±»</span>
<span class="token comment"># industry_labels = ...</span>

<span class="token comment"># å°†æ ‡ç­¾ä¸ç‰¹å¾æ•°æ®å¯¹é½</span>
labels <span class="token operator">=</span> <span class="token punctuation">[</span>industry_labels<span class="token punctuation">[</span><span class="token builtin">id</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"_"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">for</span> <span class="token builtin">id</span> <span class="token keyword">in</span> features<span class="token punctuation">.</span>index<span class="token punctuation">]</span>

<span class="token comment"># ç­›é€‰ç‰¹å¾</span>
selected_features <span class="token operator">=</span> select_features<span class="token punctuation">(</span>features<span class="token punctuation">,</span> labels<span class="token punctuation">)</span>

<span class="token comment"># æ•°æ®é›†åˆ’åˆ†ä¸æ¨¡å‹è®­ç»ƒ</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>
    selected_features<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span>
<span class="token punctuation">)</span>
clf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

<span class="token comment"># è¯„ä¼°æ¨¡å‹</span>
y_pred <span class="token operator">=</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Accuracy: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="43__527">
     </a>
     4.3 æ—¶é—´åºåˆ—å›å½’åˆ†æ
    </h3>
    <p>
     æ—¶é—´åºåˆ—å›å½’æ˜¯æ ¹æ®æ—¶é—´åºåˆ—çš„ç‰¹å¾é¢„æµ‹ä¸€ä¸ªè¿ç»­çš„ç›®æ ‡å€¼ï¼Œå¦‚è‚¡ç¥¨çš„æœªæ¥ä»·æ ¼ã€‚
    </p>
    <h4>
     <a id="_531">
     </a>
     å¸¸è§å›å½’ç®—æ³•
    </h4>
    <ul>
     <li>
      <strong>
       çº¿æ€§å›å½’
      </strong>
      ï¼šç®€å•çš„çº¿æ€§æ¨¡å‹ã€‚
     </li>
     <li>
      <strong>
       å†³ç­–æ ‘å›å½’
      </strong>
      ï¼šé€‚ç”¨äºéçº¿æ€§å…³ç³»ã€‚
     </li>
     <li>
      <strong>
       æ¢¯åº¦æå‡å›å½’
      </strong>
      ï¼šåŸºäºæ¢¯åº¦æå‡çš„å›å½’ç®—æ³•ï¼Œå…·æœ‰è¾ƒé«˜çš„é¢„æµ‹ç²¾åº¦ã€‚
     </li>
     <li>
      <strong>
       ç¥ç»ç½‘ç»œå›å½’
      </strong>
      ï¼šé€‚ç”¨äºå¤æ‚å‡½æ•°é€¼è¿‘ã€‚
     </li>
    </ul>
    <h4>
     <a id="_tsfresh__538">
     </a>
     ä½¿ç”¨ tsfresh è¿›è¡Œæ—¶é—´åºåˆ—å›å½’
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> GradientBoostingRegressor
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> mean_squared_error<span class="token punctuation">,</span> r2_score

<span class="token comment"># å‡è®¾æˆ‘ä»¬å·²ç»æå–äº†ç‰¹å¾å¹¶å­˜å‚¨åœ¨ features ä¸­</span>
<span class="token comment"># å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç›®æ ‡å€¼ï¼Œä¾‹å¦‚è‚¡ç¥¨çš„æœªæ¥æ”¶ç›Šç‡</span>
<span class="token comment"># target = ...</span>

<span class="token comment"># æ•°æ®é›†åˆ’åˆ†</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>
    features<span class="token punctuation">,</span> target<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span>
<span class="token punctuation">)</span>

<span class="token comment"># æ¨¡å‹è®­ç»ƒ</span>
regressor <span class="token operator">=</span> GradientBoostingRegressor<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
regressor<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

<span class="token comment"># æ¨¡å‹è¯„ä¼°</span>
y_pred <span class="token operator">=</span> regressor<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"RMSE: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>mean_squared_error<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> squared<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"R^2: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>r2_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_A__564">
     </a>
     å®æˆ˜ï¼šé¢„æµ‹ A è‚¡è‚¡ç¥¨çš„æœªæ¥ä»·æ ¼èµ°åŠ¿
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># è·å–è‚¡ç¥¨å†å²æ•°æ®å¹¶æå–ç‰¹å¾</span>
<span class="token comment"># å‡è®¾æˆ‘ä»¬å·²ç»è·å–äº†è‚¡ç¥¨æ•°æ®å¹¶å­˜å‚¨åœ¨ stock_data ä¸­</span>

<span class="token comment"># æ„å»ºç›®æ ‡å€¼ï¼Œä¾‹å¦‚æœªæ¥ 5 å¤©çš„æ”¶ç›˜ä»·</span>
stock_data<span class="token punctuation">[</span><span class="token string">"future_close"</span><span class="token punctuation">]</span> <span class="token operator">=</span> stock_data<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment"># åˆ é™¤æœªæ¥æ•°æ®ç¼ºå¤±çš„è¡Œ</span>
stock_data<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"future_close"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># ä¸º tsfresh å‡†å¤‡æ•°æ®</span>
ts_data <span class="token operator">=</span> prepare_tsfresh_data<span class="token punctuation">(</span>stock_data<span class="token punctuation">)</span>

<span class="token comment"># æå–ç‰¹å¾</span>
features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
    ts_data<span class="token punctuation">,</span>
    column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
    column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
    column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># å°†ç›®æ ‡å€¼ä¸ç‰¹å¾æ•°æ®å¯¹é½</span>
target <span class="token operator">=</span> stock_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>features<span class="token punctuation">.</span>index<span class="token punctuation">,</span> <span class="token string">"future_close"</span><span class="token punctuation">]</span>

<span class="token comment"># æ•°æ®é›†åˆ’åˆ†ä¸æ¨¡å‹è®­ç»ƒ</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>
    features<span class="token punctuation">,</span> target<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span>
<span class="token punctuation">)</span>
regressor <span class="token operator">=</span> GradientBoostingRegressor<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
regressor<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

<span class="token comment"># è¯„ä¼°æ¨¡å‹</span>
y_pred <span class="token operator">=</span> regressor<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"RMSE: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>mean_squared_error<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> squared<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"R^2: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>r2_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre>
    <h2>
     <a id="tsfresh__603">
     </a>
     ç¬¬äº”ç« ï¼štsfresh åœ¨é‡åŒ–æŠ•èµ„ä¸­çš„é«˜çº§åº”ç”¨
    </h2>
    <h3>
     <a id="51__605">
     </a>
     5.1 é‡åŒ–æŠ•èµ„æ¦‚è¿°
    </h3>
    <p>
     é‡åŒ–æŠ•èµ„æ˜¯åˆ©ç”¨æ•°å­¦æ¨¡å‹å’Œè®¡ç®—æœºæŠ€æœ¯ï¼Œå¯¹é‡‘èå¸‚åœºè¿›è¡Œåˆ†æã€é¢„æµ‹ï¼Œå¹¶åˆ¶å®šæŠ•èµ„ç­–ç•¥çš„è¿‡ç¨‹ã€‚æ—¶é—´åºåˆ—åˆ†æåœ¨é‡åŒ–æŠ•èµ„ä¸­å æ®é‡è¦åœ°ä½ï¼Œé€šè¿‡å¯¹å†å²ä»·æ ¼ã€æˆäº¤é‡ç­‰æ—¶é—´åºåˆ—æ•°æ®çš„åˆ†æï¼Œå¯ä»¥æŒ–æ˜å¸‚åœºè§„å¾‹ã€é¢„æµ‹ä»·æ ¼èµ°åŠ¿ã€‚
    </p>
    <h3>
     <a id="52__tsfresh__609">
     </a>
     5.2 ä½¿ç”¨ tsfresh æ„å»ºé‡åŒ–æŠ•èµ„ç­–ç•¥
    </h3>
    <h4>
     <a id="_611">
     </a>
     ç‰¹å¾å·¥ç¨‹ä¸ç­–ç•¥è®¾è®¡
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">from</span> tsfresh <span class="token keyword">import</span> extract_features<span class="token punctuation">,</span> select_features
<span class="token keyword">from</span> tsfresh<span class="token punctuation">.</span>utilities<span class="token punctuation">.</span>dataframe_functions <span class="token keyword">import</span> impute
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> mean_squared_error
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> GradientBoostingRegressor
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd


<span class="token comment"># è·å–è‚¡ç¥¨æ•°æ®</span>
<span class="token keyword">def</span> <span class="token function">get_stock_data</span><span class="token punctuation">(</span>ts_code<span class="token punctuation">,</span> start_date<span class="token punctuation">,</span> end_date<span class="token punctuation">)</span><span class="token punctuation">:</span>
    df <span class="token operator">=</span> pro<span class="token punctuation">.</span>daily<span class="token punctuation">(</span>ts_code<span class="token operator">=</span>ts_code<span class="token punctuation">,</span> start_date<span class="token operator">=</span>start_date<span class="token punctuation">,</span> end_date<span class="token operator">=</span>end_date<span class="token punctuation">)</span>
    <span class="token keyword">return</span> df


<span class="token comment"># æ„å»ºç›®æ ‡å˜é‡ï¼ˆä¾‹å¦‚æœªæ¥5å¤©çš„æ”¶ç›Šç‡ï¼‰</span>
<span class="token keyword">def</span> <span class="token function">build_target_variable</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data<span class="token punctuation">[</span><span class="token string">"trade_date"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"trade_date"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    data<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    data<span class="token punctuation">[</span><span class="token string">"future_close"</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span>periods<span class="token punctuation">)</span>
    data<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"future_close"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    data<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    data<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    data<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> data


<span class="token comment"># æå–ç‰¹å¾</span>
<span class="token keyword">def</span> <span class="token function">feature_engineering</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    extracted_features <span class="token operator">=</span> extract_features<span class="token punctuation">(</span>
        data<span class="token punctuation">,</span>
        column_id<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span>
        column_sort<span class="token operator">=</span><span class="token string">"trade_date"</span><span class="token punctuation">,</span>
        column_value<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># å¤„ç†ç¼ºå¤±å€¼</span>
    impute<span class="token punctuation">(</span>extracted_features<span class="token punctuation">)</span>

    target_variable <span class="token operator">=</span> <span class="token punctuation">(</span>
        data<span class="token punctuation">[</span><span class="token string">"future_close"</span><span class="token punctuation">]</span> <span class="token operator">-</span> data<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>  <span class="token comment"># ç›®æ ‡å˜é‡ä¸ºæœªæ¥5å¤©çš„æ”¶ç›˜ä»·å˜åŒ– data["future_return"]</span>

    selected_features <span class="token operator">=</span> select_features<span class="token punctuation">(</span>extracted_features<span class="token punctuation">,</span> target_variable<span class="token punctuation">)</span>

    <span class="token keyword">return</span> selected_features<span class="token punctuation">,</span> target_variable


<span class="token comment"># ç­–ç•¥è®¾è®¡</span>
<span class="token keyword">def</span> <span class="token function">strategy_development</span><span class="token punctuation">(</span>features<span class="token punctuation">,</span> variable<span class="token punctuation">,</span> variables<span class="token punctuation">)</span><span class="token punctuation">:</span>
    X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>
        features<span class="token punctuation">,</span> variable<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># æ¨¡å‹è®­ç»ƒ</span>
    model <span class="token operator">=</span> GradientBoostingRegressor<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

    y_pred <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
    mse <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰ï¼š</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>mse<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token comment"># ç­–ç•¥ä¿¡å·ç”Ÿæˆ</span>
    variables<span class="token punctuation">[</span><span class="token string">"predicted_future_change"</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>features<span class="token punctuation">)</span>
    variables<span class="token punctuation">[</span><span class="token string">"predicted_future_close"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
        variables<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span> <span class="token operator">+</span> variables<span class="token punctuation">[</span><span class="token string">"predicted_future_change"</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># æ ¹æ®ä¿¡å·ç”ŸæˆæŒä»“ä¿¡å·</span>
    variables<span class="token punctuation">[</span><span class="token string">"signal"</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>
        variables<span class="token punctuation">[</span><span class="token string">"predicted_future_close"</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> variables<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">)</span>
    variables<span class="token punctuation">[</span><span class="token string">"strategy_returns"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
        variables<span class="token punctuation">[</span><span class="token string">"signal"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> variables<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    cumulative_returns <span class="token operator">=</span> <span class="token punctuation">(</span>variables<span class="token punctuation">[</span><span class="token string">"strategy_returns"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cumprod<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># ç»˜åˆ¶ç»“æœ</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>cumulative_returns<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"Strategy Returns"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>stock_data<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cumsum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"Buy and Hold"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Strategy Performance"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"Date"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Cumulative Returns"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> variables

<span class="token comment"># å®æˆ˜ï¼šæ„å»ºåŸºäº tsfresh çš„é‡åŒ–æŠ•èµ„ç­–ç•¥</span>
stock_data <span class="token operator">=</span> get_stock_data<span class="token punctuation">(</span><span class="token string">'000001.SZ'</span><span class="token punctuation">,</span> <span class="token string">'20200101'</span><span class="token punctuation">,</span> <span class="token string">'20201231'</span><span class="token punctuation">)</span>
target_variables <span class="token operator">=</span> build_target_variable<span class="token punctuation">(</span>stock_data<span class="token punctuation">)</span>
selected_features<span class="token punctuation">,</span> target_variable <span class="token operator">=</span> feature_engineering<span class="token punctuation">(</span>target_variables<span class="token punctuation">)</span>
strategy_data <span class="token operator">=</span> strategy_development<span class="token punctuation">(</span>
    selected_features<span class="token punctuation">,</span> target_variable<span class="token punctuation">,</span> target_variables
<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_712">
     </a>
     ç­–ç•¥å›æµ‹ä¸è¯„ä¼°
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token comment"># ç­–ç•¥å›æµ‹</span>
<span class="token keyword">def</span> <span class="token function">strategy_backtest</span><span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    strategy_data<span class="token punctuation">[</span><span class="token string">"return"</span><span class="token punctuation">]</span> <span class="token operator">=</span> strategy_data<span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> strategy_data<span class="token punctuation">[</span>
        <span class="token string">"signal"</span>
    <span class="token punctuation">]</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    strategy_data<span class="token punctuation">[</span><span class="token string">"cumulative_return"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> strategy_data<span class="token punctuation">[</span><span class="token string">"return"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cumprod<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> strategy_data


<span class="token comment"># ç­–ç•¥è¯„ä¼°</span>
<span class="token keyword">def</span> <span class="token function">strategy_evaluation</span><span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># è®¡ç®—å¹´åŒ–æ”¶ç›Šç‡</span>
    annual_return <span class="token operator">=</span> <span class="token punctuation">(</span>strategy_data<span class="token punctuation">[</span><span class="token string">"cumulative_return"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token punctuation">(</span>
        <span class="token number">252</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token comment"># è®¡ç®—æœ€å¤§å›æ’¤</span>
    cumulative_return <span class="token operator">=</span> strategy_data<span class="token punctuation">[</span><span class="token string">"cumulative_return"</span><span class="token punctuation">]</span>
    peak <span class="token operator">=</span> cumulative_return<span class="token punctuation">.</span>expanding<span class="token punctuation">(</span>min_periods<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    drawdown <span class="token operator">=</span> <span class="token punctuation">(</span>cumulative_return <span class="token operator">-</span> peak<span class="token punctuation">)</span> <span class="token operator">/</span> peak
    max_drawdown <span class="token operator">=</span> drawdown<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># è®¡ç®—å¤æ™®æ¯”ç‡</span>
    daily_return <span class="token operator">=</span> strategy_data<span class="token punctuation">[</span><span class="token string">"return"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sharpe_ratio <span class="token operator">=</span> daily_return<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> daily_return<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token number">252</span><span class="token punctuation">)</span>
    <span class="token comment"># æ‰“å°ç»“æœ</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Annual Return: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>annual_return<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Max Drawdown: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>max_drawdown<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Sharpe Ratio: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>sharpe_ratio<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> annual_return<span class="token punctuation">,</span> max_drawdown<span class="token punctuation">,</span> sharpe_ratio


<span class="token comment"># å¯è§†åŒ–ç­–ç•¥è¡¨ç°</span>
<span class="token keyword">def</span> <span class="token function">plot_strategy_performance</span><span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>strategy_data<span class="token punctuation">[</span><span class="token string">"trade_date"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> strategy_data<span class="token punctuation">[</span><span class="token string">"cumulative_return"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Strategy Performance"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"Trade Date"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Cumulative Return"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment"># æ‰§è¡Œç­–ç•¥å›æµ‹ä¸è¯„ä¼°</span>
strategy_data <span class="token operator">=</span> strategy_backtest<span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
strategy_evaluation<span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
plot_strategy_performance<span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_765">
     </a>
     é£é™©æ§åˆ¶ä¸ä¼˜åŒ–
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># é£é™©æ§åˆ¶</span>
<span class="token keyword">def</span> <span class="token function">risk_management</span><span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># è®¾ç½®æ­¢æŸæ­¢ç›ˆ</span>
    strategy_data<span class="token punctuation">[</span><span class="token string">"stop_loss"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.05</span>  <span class="token comment"># æ­¢æŸ5%</span>
    strategy_data<span class="token punctuation">[</span><span class="token string">"stop_profit"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.1</span>  <span class="token comment"># æ­¢ç›ˆ10%</span>
    <span class="token comment"># è°ƒæ•´ä»“ä½</span>
    strategy_data<span class="token punctuation">[</span><span class="token string">"signal"</span><span class="token punctuation">]</span> <span class="token operator">=</span> strategy_data<span class="token punctuation">[</span><span class="token string">"signal"</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">0.5</span>  <span class="token comment"># é™ä½ä»“ä½50%</span>
    <span class="token keyword">return</span> strategy_data


<span class="token comment"># ç­–ç•¥ä¼˜åŒ–</span>
<span class="token keyword">def</span> <span class="token function">strategy_optimization</span><span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># å‚æ•°ä¼˜åŒ–</span>
    <span class="token comment"># å¯ä»¥é€šè¿‡ç½‘æ ¼æœç´¢ã€éšæœºæœç´¢ç­‰æ–¹æ³•ä¼˜åŒ–æ¨¡å‹å‚æ•°</span>
    <span class="token comment"># è¿™é‡Œä»¥è°ƒæ•´é¢„æµ‹å‘¨æœŸä¸ºä¾‹</span>
    target_variables <span class="token operator">=</span> build_target_variable<span class="token punctuation">(</span>stock_data<span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># é¢„æµ‹3å¤©æ”¶ç›Šç‡</span>
    <span class="token comment"># é‡æ–°è¿›è¡Œç‰¹å¾æå–ã€æ¨¡å‹è®­ç»ƒå’Œç­–ç•¥å¼€å‘</span>
    selected_features<span class="token punctuation">,</span> target_variable <span class="token operator">=</span> feature_engineering<span class="token punctuation">(</span>target_variables<span class="token punctuation">)</span>
    strategy_data <span class="token operator">=</span> strategy_development<span class="token punctuation">(</span>
        selected_features<span class="token punctuation">,</span> target_variable<span class="token punctuation">,</span> target_variables
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> strategy_data


<span class="token comment"># æ‰§è¡Œé£é™©æ§åˆ¶ä¸ç­–ç•¥ä¼˜åŒ–</span>
strategy_data <span class="token operator">=</span> risk_management<span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
strategy_data <span class="token operator">=</span> strategy_optimization<span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
<span class="token comment"># æ‰§è¡Œç­–ç•¥å›æµ‹ä¸è¯„ä¼°</span>
strategy_data <span class="token operator">=</span> strategy_backtest<span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
strategy_evaluation<span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
plot_strategy_performance<span class="token punctuation">(</span>strategy_data<span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="53__801">
     </a>
     5.3 é¡¹ç›®ä¸­çš„æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ
    </h3>
    <ul>
     <li>
      <strong>
       æ•°æ®è´¨é‡é—®é¢˜
      </strong>
      ï¼šA è‚¡å¸‚åœºæ•°æ®å¯èƒ½å­˜åœ¨ç¼ºå¤±ã€å¼‚å¸¸ç­‰æƒ…å†µï¼Œé€šè¿‡æ•°æ®æ¸…æ´—ã€æ’å€¼ç­‰æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚
     </li>
     <li>
      <strong>
       ç‰¹å¾æå–çš„éš¾ç‚¹
      </strong>
      ï¼šæ—¶é—´åºåˆ—æ•°æ®å…·æœ‰å¤æ‚çš„æ³¢åŠ¨æ€§å’Œå­£èŠ‚æ€§ï¼Œé€šè¿‡ç»¼åˆè¿ç”¨å¤šç§ç‰¹å¾æå–æ–¹æ³•å’Œå‚æ•°è°ƒæ•´ï¼Œç¡®ä¿æå–çš„ç‰¹å¾å…·æœ‰ä»£è¡¨æ€§å’Œé¢„æµ‹èƒ½åŠ›ã€‚
     </li>
     <li>
      <strong>
       æ¨¡å‹è¿‡æ‹Ÿåˆé—®é¢˜
      </strong>
      ï¼šé€šè¿‡äº¤å‰éªŒè¯ã€æ­£åˆ™åŒ–ç­‰æ‰‹æ®µï¼Œé¿å…æ¨¡å‹å¯¹è®­ç»ƒæ•°æ®çš„è¿‡åº¦æ‹Ÿåˆï¼Œæé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚
     </li>
    </ul>
    <h2>
     <a id="_807">
     </a>
     é™„å½•
    </h2>
    <p>
     ä»¥ä¸‹æ˜¯
     <code>
      tsfresh
     </code>
     æä¾›çš„é¢„å®šä¹‰å­—å…¸åŠå…¶è¯´æ˜ï¼š
    </p>
    <ol>
     <li>
      <strong>
       ComprehensiveFCParameters
      </strong>
     </li>
    </ol>
    <ul>
     <li>
      <strong>
       è¯´æ˜
      </strong>
      ï¼šåŒ…å«æ‰€æœ‰ç‰¹å¾æå–å‡½æ•°ï¼Œä»¥åŠæ‰€æœ‰å¯èƒ½çš„å‚æ•°ç»„åˆã€‚è¿™æ˜¯
      <code>
       tsfresh
      </code>
      é»˜è®¤çš„ç‰¹å¾æå–è®¾ç½®ï¼Œå¦‚æœä¸æŒ‡å®š
      <code>
       default_fc_parameters
      </code>
      ï¼Œåˆ™ä¼šä½¿ç”¨æ­¤è®¾ç½®ã€‚
     </li>
     <li>
      <strong>
       ç‰¹ç‚¹
      </strong>
      ï¼šè®¡ç®—å…¨é¢ï¼Œä½†è®¡ç®—æˆæœ¬è¾ƒé«˜ã€‚
     </li>
    </ul>
    <ol start="2">
     <li>
      <strong>
       MinimalFCParameters
      </strong>
     </li>
    </ol>
    <ul>
     <li>
      <strong>
       è¯´æ˜
      </strong>
      ï¼šåªåŒ…å«å°‘é‡ç‰¹å¾æå–å‡½æ•°ï¼Œç”¨äºå¿«é€Ÿæµ‹è¯•ã€‚
     </li>
     <li>
      <strong>
       ç‰¹ç‚¹
      </strong>
      ï¼šè®¡ç®—é€Ÿåº¦å¿«ï¼Œä½†ç‰¹å¾è¦†ç›–èŒƒå›´æœ‰é™ã€‚
     </li>
    </ul>
    <ol start="3">
     <li>
      <strong>
       EfficientFCParameters
      </strong>
     </li>
    </ol>
    <ul>
     <li>
      <strong>
       è¯´æ˜
      </strong>
      ï¼šä¸
      <code>
       ComprehensiveFCParameters
      </code>
      ç±»ä¼¼ï¼Œä½†å»æ‰äº†æ ‡è®°ä¸ºâ€œé«˜è®¡ç®—æˆæœ¬â€çš„ç‰¹å¾ã€‚
     </li>
     <li>
      <strong>
       ç‰¹ç‚¹
      </strong>
      ï¼šåœ¨è®¡ç®—æ•ˆç‡å’Œç‰¹å¾è¦†ç›–ä¹‹é—´å–å¾—äº†å¹³è¡¡ï¼Œé€‚åˆå¯¹è¿è¡Œæ—¶é—´è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ã€‚
     </li>
    </ul>
    <h3>
     <a id="ComprehensiveFCParameters_826">
     </a>
     ComprehensiveFCParameters
    </h3>
    <p>
     <code>
      ComprehensiveFCParameters
     </code>
     æ˜¯
     <code>
      tsfresh
     </code>
     æä¾›çš„ä¸€ä¸ªé¢„å®šä¹‰å­—å…¸ï¼Œç”¨äºæå–æ—¶é—´åºåˆ—çš„å…¨é¢ç‰¹å¾é›†åˆã€‚å®ƒåŒ…å«äº†æ‰€æœ‰æ— å‚æ•°çš„ç‰¹å¾æå–å‡½æ•°ï¼Œä»¥åŠæ‰€æœ‰æœ‰å‚æ•°çš„ç‰¹å¾æå–å‡½æ•°åŠå…¶ä¸åŒçš„å‚æ•°ç»„åˆã€‚
    </p>
    <table>
     <thead>
      <tr>
       <th>
        ç‰¹å¾æå–å‡½æ•°åç§°
       </th>
       <th>
        å‚æ•°
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         abs_energy
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         absolute_sum_of_changes
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         agg_autocorrelation
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         lag
        </code>
        å’Œ
        <code>
         aggtype
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         agg_linear_trend
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         chunk_len
        </code>
        å’Œ
        <code>
         f_agg
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         approximate_entropy
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         m
        </code>
        å’Œ
        <code>
         r
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         ar_coefficient
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         coeff
        </code>
        å’Œ
        <code>
         k
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         augmented_dickey_fuller
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         attr
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         autocorrelation
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         lag
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         binned_entropy
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         max_bins
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         c3
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         lag
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         change_quantiles
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         ql
        </code>
        ,
        <code>
         qh
        </code>
        ,
        <code>
         isabs
        </code>
        , å’Œ
        <code>
         f_agg
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         cid_ce
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : normalizeï¼šå¸ƒå°”å€¼ï¼ˆTrue æˆ– Falseï¼‰
       </td>
      </tr>
      <tr>
       <td>
        <code>
         count_above
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         t
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         count_above_mean
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         count_below
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         t
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         count_below_mean
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         cwt_coefficients
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         widths
        </code>
        ,
        <code>
         coeff
        </code>
        , å’Œ
        <code>
         w
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         energy_ratio_by_chunks
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         num_segments
        </code>
        å’Œ
        <code>
         segment_focus
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         fft_aggregated
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         aggtype
        </code>
        çš„å­—å…¸åˆ—è¡¨ï¼šâ€œcentroidâ€ã€â€œvarianceâ€ã€â€œskewâ€ã€â€œkurtosisâ€
       </td>
      </tr>
      <tr>
       <td>
        <code>
         fft_coefficient
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         coeff
        </code>
        å’Œ
        <code>
         attr
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         first_location_of_maximum
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         first_location_of_minimum
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         friedrich_coefficients
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         m
        </code>
        ,
        <code>
         r
        </code>
        , å’Œ
        <code>
         coeff
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         has_duplicate
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         has_duplicate_max
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         has_duplicate_min
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         index_mass_quantile
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         q
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         kurtosis
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         large_standard_deviation
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         r
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         last_location_of_maximum
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         last_location_of_minimum
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         length
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         linear_trend
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         attr
        </code>
        çš„å­—å…¸åˆ—è¡¨ï¼š
        <code>
         "pvalue"
        </code>
        ï¼šçº¿æ€§å›å½’çš„ p å€¼ã€‚
        <code>
         "rvalue"
        </code>
        ï¼šçº¿æ€§å›å½’çš„ç›¸å…³ç³»æ•°ã€‚
        <code>
         "intercept"
        </code>
        ï¼šçº¿æ€§å›å½’çš„æˆªè·ã€‚
        <code>
         "slope"
        </code>
        ï¼šçº¿æ€§å›å½’çš„æ–œç‡ã€‚
        <code>
         "stderr"
        </code>
        ï¼šçº¿æ€§å›å½’çš„æ ‡å‡†è¯¯å·®ã€‚
       </td>
      </tr>
      <tr>
       <td>
        <code>
         longest_strike_above_mean
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         longest_strike_below_mean
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_abs_change
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_change
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_second_derivative_central
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         median
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         number_crossing_m
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         m
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         number_cwt_peaks
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         n
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         number_peaks
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         n
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         partial_autocorrelation
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         lag
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         percentage_of_reoccurring_datapoints_to_all_datapoints
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         percentage_of_reoccurring_values_to_all_values
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         quantile
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         q
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         range_count
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         min
        </code>
        å’Œ
        <code>
         max
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         ratio_beyond_r_sigma
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         r
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         ratio_value_number_to_time_series_length
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         skewness
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         spkt_welch_density
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         coeff
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         standard_deviation
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         sum_of_reoccurring_data_points
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         sum_of_reoccurring_values
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         sum_of_values
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         symmetry_looking
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         r
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         time_reversal_asymmetry_statistic
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         lag
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         variance
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         variance_larger_than_standard_deviation
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="MinimalFCParameters_893">
     </a>
     MinimalFCParameters
    </h3>
    <p>
     <code>
      EfficientFCParameters
     </code>
     æ˜¯
     <code>
      tsfresh
     </code>
     æä¾›çš„ä¸€ç§é¢„å®šä¹‰ç‰¹å¾æå–å‚æ•°è®¾ç½®ï¼Œæ—¨åœ¨å¹³è¡¡è®¡ç®—æ•ˆç‡å’Œç‰¹å¾è¦†ç›–èŒƒå›´ã€‚å®ƒå»æ‰äº†è®¡ç®—æˆæœ¬è¾ƒé«˜ä¸”å†—ä½™çš„ç‰¹å¾ï¼Œé€‚åˆåœ¨å®é™…åº”ç”¨ä¸­å¿«é€Ÿæå–æœ‰æ•ˆç‰¹å¾ã€‚
    </p>
    <table>
     <thead>
      <tr>
       <th>
        ç‰¹å¾æå–å‡½æ•°åç§°
       </th>
       <th>
        å‚æ•°
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         abs_energy
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         median
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         std
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         variance
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         minimum
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         maximum
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_abs_change
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_change
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_second_derivative_central
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         first_location_of_maximum
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         first_location_of_minimum
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         last_location_of_maximum
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         last_location_of_minimum
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         longest_strike_above_mean
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         longest_strike_below_mean
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         count_above_mean
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         count_below_mean
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         ratio_value_number_to_time_series_length
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         autocorrelation
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         lag
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         fft_coefficient
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         coeff
        </code>
        å’Œ
        <code>
         attr
        </code>
        çš„å­—å…¸åˆ—è¡¨ï¼šcoeff æ˜¯å‚…é‡Œå¶ç³»æ•°çš„ç´¢å¼•ï¼Œattr æ˜¯ç³»æ•°çš„å±æ€§ï¼Œå¯ä»¥æ˜¯ â€œrealâ€ã€â€œimagâ€ã€â€œabsâ€ã€â€œangleâ€
       </td>
      </tr>
      <tr>
       <td>
        <code>
         linear_trend
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         attr
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="EfficientFCParameters_922">
     </a>
     EfficientFCParameters
    </h3>
    <p>
     <code>
      EfficientFCParameters
     </code>
     æ˜¯
     <code>
      tsfresh
     </code>
     æä¾›çš„ä¸€ç§é¢„å®šä¹‰ç‰¹å¾æå–å‚æ•°è®¾ç½®ï¼Œæ—¨åœ¨å¹³è¡¡è®¡ç®—æ•ˆç‡å’Œç‰¹å¾è¦†ç›–èŒƒå›´ã€‚å®ƒå»æ‰äº†è®¡ç®—æˆæœ¬è¾ƒé«˜ä¸”å†—ä½™çš„ç‰¹å¾ï¼Œé€‚åˆåœ¨å®é™…åº”ç”¨ä¸­å¿«é€Ÿæå–æœ‰æ•ˆç‰¹å¾ã€‚
    </p>
    <table>
     <thead>
      <tr>
       <th>
        ç‰¹å¾æå–å‡½æ•°åç§°
       </th>
       <th>
        å‚æ•°
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         abs_energy
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         median
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         std
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         variance
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         minimum
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         maximum
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_abs_change
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_change
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         mean_second_derivative_central
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         first_location_of_maximum
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         first_location_of_minimum
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         last_location_of_maximum
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         last_location_of_minimum
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         longest_strike_above_mean
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         longest_strike_below_mean
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         count_above_mean
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         count_below_mean
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         ratio_value_number_to_time_series_length
        </code>
       </td>
       <td>
        æ— å‚æ•°
       </td>
      </tr>
      <tr>
       <td>
        <code>
         autocorrelation
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         lag
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         fft_coefficient
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         coeff
        </code>
        å’Œ
        <code>
         attr
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
      <tr>
       <td>
        <code>
         linear_trend
        </code>
       </td>
       <td>
        <code>
         param
        </code>
        : åŒ…å«
        <code>
         attr
        </code>
        çš„å­—å…¸åˆ—è¡¨
       </td>
      </tr>
     </tbody>
    </table>
    <blockquote>
     <p>
      <strong>
       é£é™©æç¤ºä¸å…è´£å£°æ˜
      </strong>
      <br/>
      æœ¬æ–‡å†…å®¹åŸºäºå…¬å¼€ä¿¡æ¯ç ”ç©¶æ•´ç†ï¼Œä¸æ„æˆä»»ä½•å½¢å¼çš„æŠ•èµ„å»ºè®®ã€‚å†å²è¡¨ç°ä¸åº”ä½œä¸ºæœªæ¥æ”¶ç›Šä¿è¯ï¼Œå¸‚åœºå­˜åœ¨ä¸å¯é¢„è§çš„æ³¢åŠ¨é£é™©ã€‚æŠ•èµ„è€…éœ€ç»“åˆè‡ªèº«è´¢åŠ¡çŠ¶å†µåŠé£é™©æ‰¿å—èƒ½åŠ›ç‹¬ç«‹å†³ç­–ï¼Œå¹¶è‡ªè¡Œæ‰¿æ‹…äº¤æ˜“ç»“æœã€‚ä½œè€…åŠå‘å¸ƒæ–¹ä¸å¯¹ä»»ä½•ä¾æ®æœ¬æ–‡æ“ä½œå¯¼è‡´çš„æŸå¤±æ‰¿æ‹…æ³•å¾‹è´£ä»»ã€‚å¸‚åœºæœ‰é£é™©ï¼ŒæŠ•èµ„é¡»è°¨æ…ã€‚
     </p>
    </blockquote>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34373333393931362f:61727469636c652f64657461696c732f313436323837303039" class_="artid" style="display:none">
 </p>
</div>


