---
layout: post
title: "rust-中的packagecratemodule"
date: 2025-03-14 08:03:21 +0800
description: "初学rust，对crate和mod的使用总是感到不太顺利，特此记录一下。当我们用cargo 创建一个新项目时，默认就创建了一个package。crate：一个模块的树形结构，它形成了库或二进制项目。module：一个module是用来组织代码的逻辑单位，用于拆分一个crate中的代码。"
keywords: "rust 中的package、crate、module"
categories: ['未分类']
tags: ['Rust']
artid: "146247395"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146247395
    alt: "rust-中的packagecratemodule"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146247395
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146247395
cover: https://bing.ee123.net/img/rand?artid=146247395
image: https://bing.ee123.net/img/rand?artid=146247395
img: https://bing.ee123.net/img/rand?artid=146247395
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     rust 中的package、crate、module
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     初学rust，对crate和mod的使用总是感到不太顺利，特此记录一下。
    </p>
    <p>
     当我们用cargo 创建一个新项目时，默认就创建了一个package。
    </p>
    <blockquote>
     <p>
      PS D:\test\rust_test&gt; cargo new myproject
      <br/>
      Creating binary (application) `myproject`
      <strong>
       package
      </strong>
      <br/>
      note: see more `Cargo.toml` keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html
      <br/>
      PS D:\test\rust_test&gt;
     </p>
    </blockquote>
    <p>
     crate：一个模块的树形结构，它形成了库或二进制项目。
    </p>
    <p>
     module：一个
     <code>
      module
     </code>
     是用来组织代码的逻辑单位，用于拆分一个
     <code>
      crate
     </code>
     中的代码。
    </p>
    <p>
     大致关系如下：
    </p>
    <p>
     <img alt="" height="1164" src="https://i-blog.csdnimg.cn/direct/c7b81027d93b4f30b716fbd03d604fdb.png" width="2404"/>
    </p>
    <ul>
     <li>
      1个Package里，至少要有1种Crate(要么是Library Crate，要么是Binary Crate)
     </li>
     <li>
      1个Package里，最多只能有1个Library Crate
     </li>
     <li>
      1个Package里，可以有0或多个Binary Crate
     </li>
     <li>
      1个Crate里，可以创建0或多个mod
     </li>
    </ul>
    <h3>
     场景一
    </h3>
    <p>
     先看一个最简单的例子：
    </p>
    <pre><code class="language-rust">mod database{
    pub fn mysql(){
        println!("I am mysql"); 
    }
}

fn main() {
    database::mysql();
}</code></pre>
    <p>
     运行：
    </p>
    <blockquote>
     <p>
      PS D:\test\rust_test\myproject&gt; cargo run
      <br/>
      Compiling myproject v0.1.0 (D:\test\rust_test\myproject)
      <br/>
      Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.59s
      <br/>
      Running `target\debug\myproject.exe`
      <br/>
      <strong>
       I am mysql
      </strong>
     </p>
    </blockquote>
    <p>
     说明：
    </p>
    <p>
     1、需要加pub关键字将模块内的函数mysql()公开，否则main函数发现不到mysql()的存在。
    </p>
    <p>
     2、main函数调用mysql时需要加上模块名称，database::mysql()。否则编译器也找不到mysql()。
    </p>
    <h3>
     场景二
    </h3>
    <p>
     再来看一个复杂点的例子：
    </p>
    <pre><code class="language-rust">mod database{
    pub fn mysql(){
        println!("I am mysql"); 
    }
    
    pub mod action{
        pub fn action_mysql(){
            super::mysql();     //子模块调用父模块，加super
        } 
    }

    pub fn print_mysql(){
        mysql();
    }
}

fn main() {
    database::print_mysql();
    use database::action;      //使用use简化调用路径
    action::action_mysql();
}</code></pre>
    <p>
     运行：
    </p>
    <blockquote>
     <p>
      PS D:\test\rust_test\myproject&gt; cargo run
      <br/>
      Compiling myproject v0.1.0 (D:\test\rust_test\myproject)
      <br/>
      Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.17s
      <br/>
      Running `target\debug\myproject.exe`
      <br/>
      I am mysql
      <br/>
      I am mysql
     </p>
    </blockquote>
    <p>
     说明：
    </p>
    <p>
     1、可以使用use关键字简化路径。
    </p>
    <p>
     2、子模块调用父模块时，要加super关键字。
    </p>
    <h3>
     场景三
    </h3>
    <p>
     再来看一下多目录，多文件的场景：
    </p>
    <p>
     在src目录下建立两个目录，folder_a和folder_b,然后folder_a下创建文件a1.rs, folder_b下创建文件b1.rs。目录结构看起来是下面这个样子的：
    </p>
    <blockquote>
     <p>
      ├─src
      <br/>
      │  │  main.rs
      <br/>
      │  ├─folder_a
      <br/>
      │  │      a1.rs
      <br/>
      │  └─folder_b
      <br/>
      │          b1.rs
     </p>
    </blockquote>
    <p>
     a1.rs内容如下：
    </p>
    <pre><code class="language-rust">pub mod inner{
    pub fn action_a1(){
        println!("action_a1");
    }
}</code></pre>
    <p>
     b1.rs内容如下：
    </p>
    <pre><code class="language-rust">pub mod b1{
    pub fn action_b1(){
        println!("action_b1");
    }
}
</code></pre>
    <p>
     那么main.rs如何才能调用到action_a1()和action_b1()呢？需要做如下操作：
    </p>
    <p>
     1、在src目录下新建三个文件，分别是lib.rs, folder_a.rs, folder_b.rs。
    </p>
    <blockquote>
     <p>
      ├─src
      <br/>
      │  │  folder_a.rs
      <br/>
      │  │  folder_b.rs
      <br/>
      │  │  lib.rs
      <br/>
      │  │  main.rs
      <br/>
      │  ├─folder_a
      <br/>
      │  │      a1.rs
      <br/>
      │  └─folder_b
      <br/>
      │          b1.rs
     </p>
    </blockquote>
    <p>
     lib.rs内容如下：
    </p>
    <pre><code class="language-rust">pub mod folder_a;
pub mod folder_b;</code></pre>
    <p>
     folder_a.rs内容如下：
    </p>
    <pre><code class="language-rust">pub mod a1;</code></pre>
    <p>
     folder_b.rs内容如下：
    </p>
    <pre><code class="language-rust">pub mod b1;</code></pre>
    <p>
     2.修改main.rs文件
    </p>
    <pre><code class="language-rust">use myproject::folder_a;   //myproject为Cargo.toml里面的package name
use myproject::folder_b;

fn main() {
    folder_a::a1::inner::action_a1();
    folder_b::b1::b1::action_b1();       //两个b1， 第一个b1把b1.rs认为一个mod，第二个b1是pub mod b1{}
}
</code></pre>
    <p>
     运行成功！
    </p>
    <blockquote>
     <p>
      PS D:\test\rust_test\myproject&gt; cargo run
      <br/>
      Compiling myproject v0.1.0 (D:\test\rust_test\myproject)
      <br/>
      Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.50s
      <br/>
      Running `target\debug\myproject.exe`
      <br/>
      action_a1
      <br/>
      action_b1
     </p>
    </blockquote>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f79696e68657a68616e7368656e2f:61727469636c652f64657461696c732f313436323437333935" class_="artid" style="display:none">
 </p>
</div>


