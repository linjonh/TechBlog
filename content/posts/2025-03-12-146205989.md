---
layout: post
title: "浅拷贝和深拷贝AI"
date: 2025-03-12 15:13:29 +0800
description: "浅拷贝：适合只需要复制对象的第一层属性的情况。深拷贝：适合需要完整复制整个对象树的情况，推荐使用 Lodash 的cloneDeep或者自己实现递归函数。：简单快捷，但不支持函数、循环引用等复杂情况。第三方库：如 Lodash 和 Immer 提供了更强大且灵活的解决方案。通过选择合适的方法，你可以确保在修改新对象时不会影响到原对象的数据。"
keywords: "浅拷贝和深拷贝AI"
categories: ['未分类']
tags: ['前端', 'Vue', 'Javascript']
artid: "146205989"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146205989
    alt: "浅拷贝和深拷贝AI"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146205989
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146205989
cover: https://bing.ee123.net/img/rand?artid=146205989
image: https://bing.ee123.net/img/rand?artid=146205989
img: https://bing.ee123.net/img/rand?artid=146205989
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     浅拷贝和深拷贝AI
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <br/>
    在 Vue 3 中，当你希望复制一个对象并确保对新对象的修改不会影响到原对象时，可以使用多种方法来实现这一点。以下是所有常见的解决方法及其适用场景：
    <p>
    </p>
    <h4>
     <a id="1__3">
     </a>
     1. 浅拷贝
    </h4>
    <p>
     浅拷贝只复制对象的第一层属性，对于嵌套的对象或数组，仍然会引用原始对象中的内容。
    </p>
    <h5>
     <a id="_7">
     </a>
     使用结构赋值
    </h5>
    <pre><code class="prism language-javascript"><span class="token keyword">const</span> original <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> shallowCopy <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token operator">...</span>original <span class="token punctuation">}</span><span class="token punctuation">;</span>
shallowCopy<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 这会影响到原对象中的 `b` 对象</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>original<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 3</span>
</code></pre>
    <h5>
     <a id="_Objectassign_15">
     </a>
     使用
     <code>
      Object.assign
     </code>
    </h5>
    <pre><code class="prism language-javascript"><span class="token keyword">const</span> original <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> shallowCopy <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> original<span class="token punctuation">)</span><span class="token punctuation">;</span>
shallowCopy<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 这会影响到原对象中的 `b` 对象</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>original<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 3</span>
</code></pre>
    <h4>
     <a id="2__23">
     </a>
     2. 深拷贝
    </h4>
    <p>
     深拷贝会递归地复制对象的所有层次，包括嵌套的对象和数组，生成一个完全独立的新对象。
    </p>
    <h5>
     <a id="_JSONparseJSONstringify_27">
     </a>
     使用
     <code>
      JSON.parse(JSON.stringify())
     </code>
    </h5>
    <p>
     适用于简单的对象结构，但不支持函数、循环引用等复杂情况。
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">const</span> original <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> deepCopy <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>original<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
deepCopy<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 不会影响到原对象</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>original<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 2</span>
</code></pre>
    <h5>
     <a id="_Lodash__cloneDeep_36">
     </a>
     使用 Lodash 的
     <code>
      cloneDeep
     </code>
    </h5>
    <p>
     Lodash 提供了一个强大的工具函数来处理复杂的对象结构。
     <br/>
     首先安装 Lodash：
    </p>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> lodash
</code></pre>
    <p>
     然后在代码中使用：
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> original <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> deepCopy <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">cloneDeep</span><span class="token punctuation">(</span>original<span class="token punctuation">)</span><span class="token punctuation">;</span>
deepCopy<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 不会影响到原对象</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>original<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 2</span>
</code></pre>
    <h5>
     <a id="_52">
     </a>
     使用递归函数手动实现深拷贝
    </h5>
    <p>
     如果你不想依赖外部库，也可以自己实现一个深拷贝函数。
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> obj <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> arrCopy <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> obj<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            arrCopy<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> arrCopy<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> objCopy <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            objCopy<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> objCopy<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> original <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> deepCopy <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>original<span class="token punctuation">)</span><span class="token punctuation">;</span>
deepCopy<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 不会影响到原对象</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>original<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 2</span>
</code></pre>
    <h4>
     <a id="3__Vue_3__83">
     </a>
     3. 使用 Vue 3 的响应式系统相关工具
    </h4>
    <p>
     Vue 3 提供了一些工具函数来处理响应式数据，虽然它们的主要用途不是用于深拷贝，但在某些情况下可能会有所帮助。
    </p>
    <h5>
     <a id="_toRaw_87">
     </a>
     使用
     <code>
      toRaw
     </code>
    </h5>
    <p>
     获取响应式对象的原始对象。
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> reactive<span class="token punctuation">,</span> toRaw <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> original <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> rawOriginal <span class="token operator">=</span> <span class="token function">toRaw</span><span class="token punctuation">(</span>original<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 注意：toRaw 只是获取原始对象，并不创建副本</span>
</code></pre>
    <h5>
     <a id="_markRaw_97">
     </a>
     使用
     <code>
      markRaw
     </code>
    </h5>
    <p>
     标记一个对象永远不应该被转换为响应式对象。
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> markRaw <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> original <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> markedRaw <span class="token operator">=</span> <span class="token function">markRaw</span><span class="token punctuation">(</span>original<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 标记后，Vue 将不会尝试将这个对象变为响应式</span>
</code></pre>
    <h4>
     <a id="4__107">
     </a>
     4. 使用第三方库
    </h4>
    <p>
     除了 Lodash 之外，还有其他一些流行的第三方库可以帮助你进行深拷贝。
    </p>
    <h5>
     <a id="_structuredClone_111">
     </a>
     使用
     <code>
      structuredClone
     </code>
     （现代浏览器支持）
    </h5>
    <p>
     这是 JavaScript 原生提供的一个方法，支持深拷贝，但需要注意浏览器兼容性。
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">const</span> original <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> deepCopy <span class="token operator">=</span> <span class="token function">structuredClone</span><span class="token punctuation">(</span>original<span class="token punctuation">)</span><span class="token punctuation">;</span>
deepCopy<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 不会影响到原对象</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>original<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 2</span>
</code></pre>
    <h5>
     <a id="_immer_120">
     </a>
     使用
     <code>
      immer
     </code>
    </h5>
    <p>
     Immer 是一个用于处理不可变数据的库，特别适合处理复杂的状态管理。
     <br/>
     首先安装 Immer：
    </p>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> immer
</code></pre>
    <p>
     然后在代码中使用：
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> produce <span class="token keyword">from</span> <span class="token string">'immer'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> original <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> deepCopy <span class="token operator">=</span> <span class="token function">produce</span><span class="token punctuation">(</span>original<span class="token punctuation">,</span> <span class="token parameter">draft</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    draft<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>original<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>deepCopy<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 3</span>
</code></pre>
    <h4>
     <a id="_138">
     </a>
     总结
    </h4>
    <p>
     根据你的具体需求选择合适的拷贝方法：
    </p>
    <ul>
     <li>
      <strong>
       浅拷贝
      </strong>
      ：适合只需要复制对象的第一层属性的情况。
     </li>
     <li>
      <strong>
       深拷贝
      </strong>
      ：适合需要完整复制整个对象树的情况，推荐使用 Lodash 的
      <code>
       cloneDeep
      </code>
      或者自己实现递归函数。
     </li>
     <li>
      <strong>
       <code>
        JSON.parse(JSON.stringify())
       </code>
      </strong>
      ：简单快捷，但不支持函数、循环引用等复杂情况。
     </li>
     <li>
      <strong>
       第三方库
      </strong>
      ：如 Lodash 和 Immer 提供了更强大且灵活的解决方案。
     </li>
    </ul>
    <p>
     通过选择合适的方法，你可以确保在修改新对象时不会影响到原对象的数据。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f35353439333333302f:61727469636c652f64657461696c732f313436323035393839" class_="artid" style="display:none">
 </p>
</div>


