---
layout: post
title: "QT实现绘图功能"
date: 2025-03-05 22:39:12 +0800
description: "【代码】QT实现绘图功能。"
keywords: "QT实现绘图功能"
categories: ['未分类']
tags: ['算法', '开发语言', 'Qt']
artid: "146054273"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146054273
    alt: "QT实现绘图功能"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146054273
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146054273
cover: https://bing.ee123.net/img/rand?artid=146054273
image: https://bing.ee123.net/img/rand?artid=146054273
img: https://bing.ee123.net/img/rand?artid=146054273
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     QT实现绘图功能
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <img alt="" height="285" src="https://i-blog.csdnimg.cn/direct/e8ae56cc1d594685a96fd4329b1a2676.png" width="702"/>
    </p>
    <p>
     widget.h
    </p>
    <pre><code class="hljs">#ifndef WIDGET_H
#define WIDGET_H

#include &lt;QWidget&gt;
#include &lt;QPaintEvent&gt;
#include &lt;QPainter&gt;
#include &lt;QDebug&gt;
#include &lt;QMouseEvent&gt;
#include &lt;QLine&gt;
#include &lt;QVector&gt;
#include &lt;QColorDialog&gt;
#include &lt;QKeyEvent&gt;

struct Lineinfo{
    QLine line;
    QColor color;
    int width;
};


QT_BEGIN_NAMESPACE
namespace Ui { class Widget; }
QT_END_NAMESPACE

class Widget : public QWidget
{
    Q_OBJECT

public:
    Widget(QWidget *parent = nullptr);
    ~Widget();

private:
    Ui::Widget *ui;
    QPainter painter;
    QPen pen;
    QPoint start;
    QPoint end;
    QVector&lt;Lineinfo&gt; lines;
    QVector&lt;QPoint&gt; lines_last;
    QColor color;
    QColor recolor;
    int width=1;
    int re=0;

protected:
    virtual void paintEvent(QPaintEvent *event) override;
    virtual void mouseMoveEvent(QMouseEvent *event) override;
    virtual void mousePressEvent(QMouseEvent *event) override;
    virtual void mouseReleaseEvent(QMouseEvent *event) override;
    virtual void keyPressEvent(QKeyEvent *event) override;

private slots:
    void on_pushButton_clicked();
    void on_pushButton_2_clicked();
    void on_pushButton_3_clicked();
    void on_pushButton_4_clicked();
    void on_pushButton_5_clicked();
    void on_pushButton_6_clicked();
};
#endif // WIDGET_H
</code></pre>
    <p>
     widget.cpp
    </p>
    <pre><code class="hljs">#include "widget.h"
#include "ui_widget.h"

Widget::Widget(QWidget *parent)
    : QWidget(parent)
    , ui(new Ui::Widget)
{
    ui-&gt;setupUi(this);
}

Widget::~Widget()
{
    delete ui;
}

void Widget::paintEvent(QPaintEvent *event)
{
    painter.begin(this);

    for(auto perline:lines){
        pen.setColor(perline.color);
        pen.setWidth(perline.width);
        painter.setPen(pen);
        painter.drawLine(perline.line);
    }

    painter.end();
}

void Widget::mouseMoveEvent(QMouseEvent *event)
{
    end = event-&gt;pos();
    QLine line(start,end);
    Lineinfo lineinfo;
    lineinfo.color=color;
    lineinfo.line=line;
    lineinfo.width=width;
    lines.append(lineinfo);

    // 将鼠标绘制的每一跟线段存入QVector里面，也就是lines里面

    start = end;
    update();
}

void Widget::mousePressEvent(QMouseEvent *event)
{
    start = event-&gt;pos();
        lines_last&lt;&lt;start;
}

void Widget::mouseReleaseEvent(QMouseEvent *event)
{
    end = event-&gt;pos();

}

void Widget::keyPressEvent(QKeyEvent *event)
{
      if(event-&gt;modifiers() == Qt::ControlModifier &amp;&amp; event-&gt;key() == Qt::Key_Z)
      {
         if(!lines_last.isEmpty()){
            while(lines.last().line.p1() != lines_last.last())
              {
                  lines.removeLast();
              }
          lines_last.removeLast();
          lines.removeLast();
         }
     }

     update();
}

// 打开调色板
void Widget::on_pushButton_clicked()
{
    color = QColorDialog::getColor(Qt::black,this,"选择颜色");
}

void Widget::on_pushButton_2_clicked()
{
    width = 1;
    if(re==1){color=recolor;}
}

void Widget::on_pushButton_3_clicked()
{
    width = 5;
     if(re==1){color=recolor;}
}

void Widget::on_pushButton_4_clicked()
{
    width = 10;
     if(re==1){color=recolor;}
}

void Widget::on_pushButton_5_clicked()
{
    recolor=color;
    color=palette().color(QPalette::Window);
    re=1;
}


</code></pre>
    <p>
    </p>
    <p>
    </p>
    <p style="text-align:center">
     <img alt="" src="https://i-blog.csdnimg.cn/direct/0a50e9ce2b674366b512d33be6d80e98.gif"/>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f36343838313931382f:61727469636c652f64657461696c732f313436303534323733" class_="artid" style="display:none">
 </p>
</div>


