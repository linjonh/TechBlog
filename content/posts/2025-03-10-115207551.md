---
layout: post
title: "TCPIP原理详细解析"
date: 2025-03-10 23:32:18 +0800
description: "面向有连接型面向有连接型中，在发送数据之前，需要在收发主机之间连接一条通信线路。举个例子就是，人们平常打电话，输入完对方电话号码拨出之后，只有对端拿起电话才能真正通48话，通话结束后将电话机扣上就如同切断电源。因此在面向有连接的方式下，必须在通信传输前后，专门进行建立和断开连接的处理。如果与对端之间无法通信，就可以避免发送无谓的数据。面向无连接型面向无连接型则不要求建立和断开连接。发送端可于任何时候自由发送数据（面向无链接型采用分组交换（1.7.2）的情况要多一些。此时，可以直接将数据理解为分组数据"
keywords: "网络通信时需要使用与下图类似的 ip 数据包(域名会转换成 ip 地址)。请写出一个ip"
categories: ['未分类']
tags: ['网络协议', '网络', 'Tcp']
artid: "115207551"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=115207551
    alt: "TCPIP原理详细解析"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=115207551
featuredImagePreview: https://bing.ee123.net/img/rand?artid=115207551
cover: https://bing.ee123.net/img/rand?artid=115207551
image: https://bing.ee123.net/img/rand?artid=115207551
img: https://bing.ee123.net/img/rand?artid=115207551
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     TCP/IP原理详细解析
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <hr/>
    <h4>
     <a id="_2">
     </a>
     <strong>
      前言
     </strong>
    </h4>
    <p>
     TCP/IP是一种面向连接，可靠的传输，传输数据大小无限制的。通常情况下，系统与系统之间的http连接需要三次握手和四次挥手，这个执行过程会产生等待时间。这方面在日常开发时需要注意一下。
    </p>
    <p>
     TCP/IP 是互联网的核心协议族，定义了数据如何在网络中进行传输、路由和接收。其设计遵循分层模型（四层或五层），各层独立工作，通过协议协同实现端到端通信。以下章节是其核心原理的逐层解析。
    </p>
    <hr/>
    <h4>
     <a id="TCPIP__9">
     </a>
     <strong>
      一、TCP/IP 分层模型
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        <strong>
         分层
        </strong>
       </th>
       <th>
        <strong>
         核心功能
        </strong>
       </th>
       <th>
        <strong>
         典型协议
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         应用层
        </strong>
       </td>
       <td>
        提供用户接口和应用程序服务
       </td>
       <td>
        HTTP、FTP、DNS、SMTP、MQTT
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         传输层
        </strong>
       </td>
       <td>
        提供端到端的数据传输控制
       </td>
       <td>
        TCP（可靠）、UDP（不可靠）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         网络层
        </strong>
       </td>
       <td>
        负责数据包的路由和寻址
       </td>
       <td>
        IP、ICMP、ARP、OSPF、BGP
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         链路层
        </strong>
       </td>
       <td>
        管理物理介质上的数据帧传输
       </td>
       <td>
        Ethernet、Wi-Fi（802.11）、PPP
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h4>
     <a id="IP__20">
     </a>
     <strong>
      二、网络层（IP 协议）
     </strong>
    </h4>
    <h5>
     <a id="1_IP__22">
     </a>
     <strong>
      1. IP 协议的核心功能
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       寻址
      </strong>
      ：通过
      <strong>
       IP 地址
      </strong>
      （IPv4 32位，IPv6 128位）唯一标识网络中的设备。
     </li>
     <li>
      <strong>
       路由
      </strong>
      ：根据路由表选择最佳路径，将数据包从源主机传递到目标主机。
     </li>
     <li>
      <strong>
       分片与重组
      </strong>
      ：根据
      <strong>
       MTU（最大传输单元）
      </strong>
      拆分大数据包，接收端重组。
     </li>
    </ul>
    <h5>
     <a id="2_IP__27">
     </a>
     <strong>
      2. IP 数据包格式
     </strong>
    </h5>
    <p>
     总体上可分为控制信息，与数据体，控制信息包括原地址、目的地址。 首部校验和是对数据进行校验，以保证数据的可靠性。
    </p>
    <pre><code class="prism language-plaintext">| 版本 (4) | 首部长度 (4) | 服务类型 (8) | 总长度 (16)       |
| 标识 (16)        | 标志 (3) | 片偏移 (13)    |
| 生存时间 TTL (8) | 协议 (8) | 首部校验和 (16) |
| 源 IP 地址 (32)                                   |
| 目标 IP 地址 (32)                                  |
| 选项（可选）                                       |
| 数据（Payload）                                    |
</code></pre>
    <ul>
     <li>
      <strong>
       关键字段
      </strong>
      ：
      <ul>
       <li>
        <strong>
         TTL（Time To Live）
        </strong>
        ：每经过一个路由器减1，防止数据包无限循环。
       </li>
       <li>
        <strong>
         协议字段
        </strong>
        ：标识上层协议（如 TCP=6，UDP=17）。
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="3__42">
     </a>
     <strong>
      3. 路由机制
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       静态路由
      </strong>
      ：手动配置路由表。
     </li>
     <li>
      <strong>
       动态路由协议
      </strong>
      ：
      <ul>
       <li>
        <strong>
         内部网关协议（IGP）
        </strong>
        ：如 OSPF（基于链路状态）、RIP（基于距离向量）。
       </li>
       <li>
        <strong>
         外部网关协议（EGP）
        </strong>
        ：如 BGP（用于跨自治系统路由）。
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="TCPUDP_50">
     </a>
     <strong>
      三、传输层（TCP/UDP）
     </strong>
    </h4>
    <h5>
     <a id="1_TCP_52">
     </a>
     <strong>
      1. TCP（传输控制协议）
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       核心特性
      </strong>
      ：
      <ul>
       <li>
        <strong>
         面向连接
        </strong>
        ：通过三次握手建立连接，四次挥手释放连接。
       </li>
       <li>
        <strong>
         可靠传输
        </strong>
        ：通过序列号、确认应答、超时重传保证数据完整。
       </li>
       <li>
        <strong>
         流量控制
        </strong>
        ：通过滑动窗口机制动态调整发送速率。
       </li>
       <li>
        <strong>
         拥塞控制
        </strong>
        ：通过慢启动、拥塞避免、快重传、快恢复算法避免网络过载。
       </li>
      </ul>
     </li>
    </ul>
    <h6>
     <a id="TCP__59">
     </a>
     <strong>
      TCP 三次握手（建立连接）
     </strong>
    </h6>
    <pre><code class="prism language-plaintext">1. Client → Server：SYN=1, Seq=x
2. Server → Client：SYN=1, ACK=1, Seq=y, Ack=x+1
3. Client → Server：ACK=1, Seq=x+1, Ack=y+1
</code></pre>
    <ul>
     <li>
      <strong>
       目的
      </strong>
      ：协商初始序列号，确认双方收发能力。
     </li>
    </ul>
    <h6>
     <a id="TCP__67">
     </a>
     <strong>
      TCP 四次挥手（释放连接）
     </strong>
    </h6>
    <pre><code class="prism language-plaintext">1. Client → Server：FIN=1, Seq=u
2. Server → Client：ACK=1, Ack=u+1
3. Server → Client：FIN=1, Seq=v, Ack=u+1
4. Client → Server：ACK=1, Seq=u+1, Ack=v+1
</code></pre>
    <ul>
     <li>
      <strong>
       目的
      </strong>
      ：确保双方数据均传输完毕，安全关闭连接。
     </li>
    </ul>
    <h6>
     <a id="TCP__76">
     </a>
     <strong>
      TCP 滑动窗口
     </strong>
    </h6>
    <ul>
     <li>
      <strong>
       原理
      </strong>
      ：接收方通过窗口大小告知发送方可接收的数据量，实现动态流量控制。
     </li>
    </ul>
    <h6>
     <a id="_79">
     </a>
     <strong>
      拥塞控制算法
     </strong>
    </h6>
    <ul>
     <li>
      <strong>
       慢启动
      </strong>
      ：初始窗口指数增长，直到阈值或出现丢包。
     </li>
     <li>
      <strong>
       拥塞避免
      </strong>
      ：窗口线性增长，谨慎探测带宽上限。
     </li>
     <li>
      <strong>
       快重传
      </strong>
      ：收到3个重复ACK时立即重传丢失报文。
     </li>
     <li>
      <strong>
       快恢复
      </strong>
      ：丢包后窗口降为阈值，而非重置为1。
     </li>
    </ul>
    <h5>
     <a id="2_UDP_85">
     </a>
     <strong>
      2. UDP（用户数据报协议）
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       核心特性
      </strong>
      ：
      <ul>
       <li>
        <strong>
         无连接
        </strong>
        ：无需建立连接，直接发送数据。
       </li>
       <li>
        <strong>
         不可靠
        </strong>
        ：不保证数据到达顺序或是否丢失。
       </li>
       <li>
        <strong>
         低开销
        </strong>
        ：首部仅8字节（TCP首部20字节+选项）。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       适用场景
      </strong>
      ：实时音视频、DNS查询、物联网传感器数据。
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_94">
     </a>
     <strong>
      四、应用层协议
     </strong>
    </h4>
    <h5>
     <a id="1_HTTP_96">
     </a>
     <strong>
      1. HTTP（超文本传输协议）
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       无状态协议
      </strong>
      ：每次请求独立，依赖 Cookie/Session 维持状态。
     </li>
     <li>
      <strong>
       方法
      </strong>
      ：GET、POST、PUT、DELETE 等。
     </li>
     <li>
      <strong>
       版本演进
      </strong>
      ：
      <ul>
       <li>
        HTTP/1.1：持久连接、管道化。
       </li>
       <li>
        HTTP/2：多路复用、头部压缩。
       </li>
       <li>
        HTTP/3：基于 QUIC（UDP），解决队头阻塞。
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="2_DNS_104">
     </a>
     <strong>
      2. DNS（域名解析协议）
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       功能
      </strong>
      ：将域名（如
      <code>
       www.example.com
      </code>
      ）解析为 IP 地址。
     </li>
     <li>
      <strong>
       查询过程
      </strong>
      ：递归查询（客户端→本地DNS→根DNS→权威DNS）。
     </li>
    </ul>
    <h5>
     <a id="3_MQTT_108">
     </a>
     <strong>
      3. MQTT（物联网消息协议）
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       特点
      </strong>
      ：轻量级、发布-订阅模式，适合低带宽、高延迟环境。
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_113">
     </a>
     <strong>
      五、关键辅助协议
     </strong>
    </h4>
    <h5>
     <a id="1_ARP_115">
     </a>
     <strong>
      1. ARP（地址解析协议）
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       功能
      </strong>
      ：通过 IP 地址查询 MAC 地址。
     </li>
     <li>
      <strong>
       过程
      </strong>
      ：广播 ARP 请求，目标主机单播回复。
     </li>
    </ul>
    <h5>
     <a id="2_ICMP_119">
     </a>
     <strong>
      2. ICMP（互联网控制消息协议）
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       功能
      </strong>
      ：传递网络错误信息（如
      <code>
       ping
      </code>
      基于 ICMP Echo Request/Reply）。
     </li>
     <li>
      <strong>
       典型应用
      </strong>
      ：Traceroute 诊断网络路径。
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_125">
     </a>
     <strong>
      六、数据封装与分用
     </strong>
    </h4>
    <h5>
     <a id="1__127">
     </a>
     <strong>
      1. 数据封装流程（发送端）
     </strong>
    </h5>
    <pre><code class="prism language-plaintext">应用层数据 → 添加TCP/UDP首部 → 添加IP首部 → 添加帧头帧尾 → 物理比特流
</code></pre>
    <h5>
     <a id="2__132">
     </a>
     <strong>
      2. 数据分用流程（接收端）
     </strong>
    </h5>
    <pre><code class="prism language-plaintext">物理比特流 → 解析帧头 → 解析IP首部 → 解析TCP/UDP首部 → 交付应用层
</code></pre>
    <hr/>
    <h4>
     <a id="TCPIP__139">
     </a>
     <strong>
      七、TCP/IP 的典型问题与优化
     </strong>
    </h4>
    <h5>
     <a id="1__141">
     </a>
     <strong>
      1. 粘包与拆包
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       原因
      </strong>
      ：TCP 是字节流协议，无消息边界。
     </li>
     <li>
      <strong>
       解决方案
      </strong>
      ：
      <ul>
       <li>
        定长消息。
       </li>
       <li>
        分隔符（如
        <code>
         \n
        </code>
        ）。
       </li>
       <li>
        消息头声明长度（如 HTTP 的
        <code>
         Content-Length
        </code>
        ）。
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="2_NAT_148">
     </a>
     <strong>
      2. NAT（网络地址转换）
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       功能
      </strong>
      ：将私有 IP 映射为公网 IP，解决 IPv4 地址不足。
     </li>
     <li>
      <strong>
       类型
      </strong>
      ：静态 NAT、动态 NAT、PAT（端口复用）。
     </li>
    </ul>
    <h5>
     <a id="3__152">
     </a>
     <strong>
      3. 性能优化
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       TCP 优化
      </strong>
      ：调整窗口大小、启用快速打开（TFO）。
     </li>
     <li>
      <strong>
       HTTP 优化
      </strong>
      ：启用持久连接、压缩、缓存。
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="TCPIP__158">
     </a>
     <strong>
      总结：TCP/IP 的设计哲学
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       分层解耦
      </strong>
      ：各层独立演进，互不影响（如 HTTP/3 替换 TCP 为 QUIC）。
     </li>
     <li>
      <strong>
       端到端原则
      </strong>
      ：复杂逻辑尽量放在终端，保持网络核心简单高效。
     </li>
     <li>
      <strong>
       鲁棒性
      </strong>
      ：通过冗余（如多路径路由）、容错（如重传）保障可靠性。
     </li>
    </ul>
    <p>
     理解 TCP/IP 协议原理，是掌握网络编程、运维和架构设计的基础。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33393132363131352f:61727469636c652f64657461696c732f313135323037353531" class_="artid" style="display:none">
 </p>
</div>


