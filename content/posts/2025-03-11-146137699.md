---
layout: post
title: "llvm数据流分析"
date: 2025-03-11 22:28:46 +0800
description: "dataflow分析"
keywords: "llvm数据流分析"
categories: ['程序分析']
tags: ['程序分析']
artid: "146137699"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146137699
    alt: "llvm数据流分析"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146137699
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146137699
cover: https://bing.ee123.net/img/rand?artid=146137699
image: https://bing.ee123.net/img/rand?artid=146137699
img: https://bing.ee123.net/img/rand?artid=146137699
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     llvm数据流分析
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <p>
     相关参考文档：
     <a href="https://github.com/llvm/llvm-project/blob/main/clang/docs/DataFlowAnalysisIntro.md">
      DataFlowAnalysisIntro
     </a>
     、
     <a href="https://rec.ustc.edu.cn/share/ec735a10-8372-11ee-a33f-3f4ce56e99ac" rel="nofollow">
      ustc编译原理课程
     </a>
     、
     <a href="https://cs.nju.edu.cn/tiantan/software-analysis/DFA-AP.pdf" rel="nofollow">
      南大程序分析课程1
     </a>
     、
     <a href="https://cs.nju.edu.cn/tiantan/software-analysis/DFA-FD.pdf" rel="nofollow">
      南大程序分析课程2
     </a>
     。
    </p>
    <h2>
     <a id="1_4">
     </a>
     1.数据流分析
    </h2>
    <p>
     数据流分析在编译优化等程序分析任务上都有重要应用。通常数据流分析可被抽象为一个IFDS-based worklist算法。核心是给每个CFG结点
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        s 
        
       
      
        s
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.4306em;">
         </span>
         <span class="mord mathnormal">
          s
         </span>
        </span>
       </span>
      </span>
     </span>
     (结点表示一个语句或者基本块)计算两个集合
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        IN 
        
       
         [ 
        
       
         s 
        
       
         ] 
        
       
      
        \text{IN}[s]
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord text">
          <span class="mord">
           IN
          </span>
         </span>
         <span class="mopen">
          [
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mclose">
          ]
         </span>
        </span>
       </span>
      </span>
     </span>
     和
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        OUT 
        
       
         [ 
        
       
         s 
        
       
         ] 
        
       
      
        \text{OUT}[s]
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord text">
          <span class="mord">
           OUT
          </span>
         </span>
         <span class="mopen">
          [
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mclose">
          ]
         </span>
        </span>
       </span>
      </span>
     </span>
     。
    </p>
    <ul>
     <li>
      <p>
       meet运算:
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          IN 
          
         
           [ 
          
         
           s 
          
         
           ] 
          
         
           = 
          
          
          
            meet 
           
           
            
            
              s 
             
            
              i 
             
            
           
             ∈ 
            
           
             prev 
            
           
             ( 
            
           
             s 
            
           
             ) 
            
           
          
         
           OUT 
          
         
           [ 
          
          
          
            s 
           
          
            i 
           
          
         
           ] 
          
         
        
          \text{IN}[s] = \text{meet}_{s_i \in \text{prev}(s)} \text{OUT}[s_i]
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             IN
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord mathnormal">
            s
           </span>
           <span class="mclose">
            ]
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            =
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1.1052em; vertical-align: -0.3552em;">
           </span>
           <span class="mord">
            <span class="mord text">
             <span class="mord">
              meet
             </span>
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.3448em;">
                <span class="" style="top: -2.5198em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mtight">
                   <span class="mord mtight">
                    <span class="mord mathnormal mtight">
                     s
                    </span>
                    <span class="msupsub">
                     <span class="vlist-t vlist-t2">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.3281em;">
                        <span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714em;">
                         <span class="pstrut" style="height: 2.5em;">
                         </span>
                         <span class="sizing reset-size3 size1 mtight">
                          <span class="mord mathnormal mtight">
                           i
                          </span>
                         </span>
                        </span>
                       </span>
                       <span class="vlist-s">
                        ​
                       </span>
                      </span>
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.143em;">
                        <span class="">
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="mrel mtight">
                    ∈
                   </span>
                   <span class="mord text mtight">
                    <span class="mord mtight">
                     prev
                    </span>
                   </span>
                   <span class="mopen mtight">
                    (
                   </span>
                   <span class="mord mathnormal mtight">
                    s
                   </span>
                   <span class="mclose mtight">
                    )
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.3552em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mord text">
            <span class="mord">
             OUT
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord">
            <span class="mord mathnormal">
             s
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.3117em;">
                <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mathnormal mtight">
                   i
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.15em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mclose">
            ]
           </span>
          </span>
         </span>
        </span>
       </span>
       ，
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          meet 
          
         
           [ 
          
         
           s 
          
         
           ] 
          
         
           = 
          
          
          
            ∪ 
           
           
            
            
              s 
             
            
              i 
             
            
           
             ∈ 
            
           
             next 
            
           
             ( 
            
           
             s 
            
           
             ) 
            
           
          
         
           IN 
          
         
           [ 
          
          
          
            s 
           
          
            i 
           
          
         
           ] 
          
         
        
          \text{meet}[s] = \cup_{s_i \in \text{next}(s)} \text{IN}[s_i]
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             meet
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord mathnormal">
            s
           </span>
           <span class="mclose">
            ]
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            =
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1.1052em; vertical-align: -0.3552em;">
           </span>
           <span class="mord">
            <span class="mbin">
             ∪
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.3448em;">
                <span class="" style="top: -2.5198em; margin-left: 0em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mtight">
                   <span class="mord mtight">
                    <span class="mord mathnormal mtight">
                     s
                    </span>
                    <span class="msupsub">
                     <span class="vlist-t vlist-t2">
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.3281em;">
                        <span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714em;">
                         <span class="pstrut" style="height: 2.5em;">
                         </span>
                         <span class="sizing reset-size3 size1 mtight">
                          <span class="mord mathnormal mtight">
                           i
                          </span>
                         </span>
                        </span>
                       </span>
                       <span class="vlist-s">
                        ​
                       </span>
                      </span>
                      <span class="vlist-r">
                       <span class="vlist" style="height: 0.143em;">
                        <span class="">
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="mrel mtight">
                    ∈
                   </span>
                   <span class="mord text mtight">
                    <span class="mord mtight">
                     next
                    </span>
                   </span>
                   <span class="mopen mtight">
                    (
                   </span>
                   <span class="mord mathnormal mtight">
                    s
                   </span>
                   <span class="mclose mtight">
                    )
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.3552em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mord text">
            <span class="mord">
             IN
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord">
            <span class="mord mathnormal">
             s
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.3117em;">
                <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mathnormal mtight">
                   i
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.15em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mclose">
            ]
           </span>
          </span>
         </span>
        </span>
       </span>
       (反向数据流传播任务)。
      </p>
     </li>
     <li>
      <p>
       update:
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          OUT 
          
         
           [ 
          
         
           s 
          
         
           ] 
          
         
           = 
          
         
           gen 
          
         
           [ 
          
         
           s 
          
         
           ] 
          
         
           ∪ 
          
         
           ( 
          
         
           IN 
          
         
           [ 
          
         
           s 
          
         
           ] 
          
         
           − 
          
         
           kill 
          
         
           [ 
          
         
           s 
          
         
           ] 
          
         
           ) 
          
         
        
          \text{OUT}[s] = \text{gen}[s] \cup (\text{IN}[s] - \text{kill}[s])
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             OUT
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord mathnormal">
            s
           </span>
           <span class="mclose">
            ]
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            =
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             gen
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord mathnormal">
            s
           </span>
           <span class="mclose">
            ]
           </span>
           <span class="mspace" style="margin-right: 0.2222em;">
           </span>
           <span class="mbin">
            ∪
           </span>
           <span class="mspace" style="margin-right: 0.2222em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mopen">
            (
           </span>
           <span class="mord text">
            <span class="mord">
             IN
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord mathnormal">
            s
           </span>
           <span class="mclose">
            ]
           </span>
           <span class="mspace" style="margin-right: 0.2222em;">
           </span>
           <span class="mbin">
            −
           </span>
           <span class="mspace" style="margin-right: 0.2222em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             kill
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord mathnormal">
            s
           </span>
           <span class="mclose">
            ])
           </span>
          </span>
         </span>
        </span>
       </span>
       ,
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          IN 
          
         
           [ 
          
         
           s 
          
         
           ] 
          
         
           = 
          
         
           gen 
          
         
           [ 
          
         
           s 
          
         
           ] 
          
         
           ∪ 
          
         
           ( 
          
         
           OUT 
          
         
           [ 
          
         
           s 
          
         
           ] 
          
         
           − 
          
         
           kill 
          
         
           [ 
          
         
           s 
          
         
           ] 
          
         
           ) 
          
         
        
          \text{IN}[s] = \text{gen}[s] \cup (\text{OUT}[s] - \text{kill}[s])
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             IN
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord mathnormal">
            s
           </span>
           <span class="mclose">
            ]
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            =
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             gen
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord mathnormal">
            s
           </span>
           <span class="mclose">
            ]
           </span>
           <span class="mspace" style="margin-right: 0.2222em;">
           </span>
           <span class="mbin">
            ∪
           </span>
           <span class="mspace" style="margin-right: 0.2222em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mopen">
            (
           </span>
           <span class="mord text">
            <span class="mord">
             OUT
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord mathnormal">
            s
           </span>
           <span class="mclose">
            ]
           </span>
           <span class="mspace" style="margin-right: 0.2222em;">
           </span>
           <span class="mbin">
            −
           </span>
           <span class="mspace" style="margin-right: 0.2222em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             kill
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord mathnormal">
            s
           </span>
           <span class="mclose">
            ])
           </span>
          </span>
         </span>
        </span>
       </span>
       (反向数据流传播任务)。通常具体实现中
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          gen 
          
         
        
          \text{gen}
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.625em; vertical-align: -0.1944em;">
           </span>
           <span class="mord text">
            <span class="mord">
             gen
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       和
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          kill 
          
         
        
          \text{kill}
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.6944em;">
           </span>
           <span class="mord text">
            <span class="mord">
             kill
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       可由update操作完成。
      </p>
     </li>
    </ul>
    <p>
     数据流分析的worklist算法 (前向) 如下。worklist算法会不断循环直到
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        IN 
        
       
         [ 
        
       
         s 
        
       
         ] 
        
       
      
        \text{IN}[s]
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord text">
          <span class="mord">
           IN
          </span>
         </span>
         <span class="mopen">
          [
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mclose">
          ]
         </span>
        </span>
       </span>
      </span>
     </span>
     和
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        OUT 
        
       
         [ 
        
       
         s 
        
       
         ] 
        
       
      
        \text{OUT}[s]
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord text">
          <span class="mord">
           OUT
          </span>
         </span>
         <span class="mopen">
          [
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mclose">
          ]
         </span>
        </span>
       </span>
      </span>
     </span>
     收敛（集合不再变大）为止。
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        IN 
        
       
         [ 
        
       
         s 
        
       
         ] 
        
       
      
        \text{IN}[s]
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord text">
          <span class="mord">
           IN
          </span>
         </span>
         <span class="mopen">
          [
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mclose">
          ]
         </span>
        </span>
       </span>
      </span>
     </span>
     和
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        OUT 
        
       
         [ 
        
       
         s 
        
       
         ] 
        
       
      
        \text{OUT}[s]
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord text">
          <span class="mord">
           OUT
          </span>
         </span>
         <span class="mopen">
          [
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mclose">
          ]
         </span>
        </span>
       </span>
      </span>
     </span>
     的元素为fact，fact的具体类型视数据流分析任务而定。需要注意的是这个分析框架是flow-sensitive &amp; path-insensitive的，path-sensitive的分析（符号执行）不会有
     <code>
      meet
     </code>
     操作，而是直接将当前分析状态
     <code>
      fork
     </code>
     多份然后将每个
     <code>
      fork
     </code>
     后的状态单独添加到 worklist中。
    </p>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">DataFlowAnalysis</span><span class="token punctuation">(</span>cfg<span class="token punctuation">:</span> CFG<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> stmt <span class="token keyword">in</span> CFG<span class="token punctuation">:</span>
	    worklist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
	    Out<span class="token punctuation">[</span>stmt<span class="token punctuation">]</span><span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>!worklist<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        cur_stmt <span class="token operator">=</span> worklist<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> prev_stmt <span class="token keyword">in</span> Prev<span class="token punctuation">(</span>cur_stmt<span class="token punctuation">)</span><span class="token punctuation">:</span>
            meet<span class="token punctuation">(</span>In<span class="token punctuation">[</span>cur_stmt<span class="token punctuation">]</span><span class="token punctuation">,</span> Out<span class="token punctuation">[</span>prev_stmt<span class="token punctuation">]</span><span class="token punctuation">)</span>
        changed <span class="token operator">=</span> update<span class="token punctuation">(</span>cur_stmt<span class="token punctuation">,</span> Out<span class="token punctuation">[</span>cur_stmt<span class="token punctuation">]</span><span class="token punctuation">,</span> In<span class="token punctuation">[</span>cur_stmt<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>changed<span class="token punctuation">)</span><span class="token punctuation">:</span>
            worklist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cur_stmt<span class="token punctuation">)</span>
</code></pre>
    <table>
     <thead>
      <tr>
       <th>
        数据流分析任务
       </th>
       <th>
        方向
       </th>
       <th>
        meet操作
       </th>
       <th>
        fact
       </th>
       <th>
        示例
       </th>
       <th>
        <code>
         gen
        </code>
       </th>
       <th>
        <code>
         kill
        </code>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        到达定值分析 (reaching-define analysis)
       </td>
       <td>
        前向
       </td>
       <td>
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           ∪ 
           
          
         
           \cup
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.5556em;">
            </span>
            <span class="mord">
             ∪
            </span>
           </span>
          </span>
         </span>
        </span>
       </td>
       <td>
        变量定义
       </td>
       <td>
        <code>
         l: x = a
        </code>
       </td>
       <td>
        <code>
         x: l
        </code>
       </td>
       <td>
        <code>
         x: prevL
        </code>
        ,
        <code>
         prevL
        </code>
        为上一个定义
        <code>
         x
        </code>
        的语句
       </td>
      </tr>
      <tr>
       <td>
        常量传播 (constant propagation)
       </td>
       <td>
        前向
       </td>
       <td>
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           ∪ 
           
          
         
           \cup
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.5556em;">
            </span>
            <span class="mord">
             ∪
            </span>
           </span>
          </span>
         </span>
        </span>
       </td>
       <td>
        变量值
       </td>
       <td>
        <code>
         x = a
        </code>
       </td>
       <td>
        <code>
         x: val(a)
        </code>
        ,
        <code>
         val(a)
        </code>
        表示
        <code>
         a
        </code>
        的值
       </td>
       <td>
        <code>
         x: _
        </code>
        ,
        <code>
         _
        </code>
        表示之前的值
       </td>
      </tr>
      <tr>
       <td>
        活跃变量分析 (live variabiles analysis)
       </td>
       <td>
        反向
       </td>
       <td>
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           ∪ 
           
          
         
           \cup
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.5556em;">
            </span>
            <span class="mord">
             ∪
            </span>
           </span>
          </span>
         </span>
        </span>
       </td>
       <td>
        变量
       </td>
       <td>
        <code>
         x = n
        </code>
       </td>
       <td>
        <code>
         n
        </code>
       </td>
       <td>
        <code>
         x
        </code>
       </td>
      </tr>
      <tr>
       <td>
        可用表达式分析 (available expressions analysis)
       </td>
       <td>
        前向
       </td>
       <td>
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           ∩ 
           
          
         
           \cap
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.5556em;">
            </span>
            <span class="mord">
             ∩
            </span>
           </span>
          </span>
         </span>
        </span>
       </td>
       <td>
        表达式
       </td>
       <td>
        <code>
         a = x op y
        </code>
       </td>
       <td>
        <code>
         x op q
        </code>
       </td>
       <td>
        所有涉及
        <code>
         a
        </code>
        的表达式
       </td>
      </tr>
     </tbody>
    </table>
    <ul>
     <li>
      <p>
       1.reaching-define的结果可以用来构造数据依赖图（参考
       <a href="https://github.com/joernio/joern/blob/v4.0.263/dataflowengineoss/src/main/scala/io/joern/dataflowengineoss/passes/reachingdef/ReachingDefPass.scala">
        Joern
       </a>
       ），比如
       <code>
        l: x = a
       </code>
       ，中
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          OUT 
          
         
           [ 
          
         
           l 
          
         
           ] 
          
         
           = 
          
         
           { 
          
         
           ( 
          
         
           a 
          
         
           , 
          
          
          
            l 
           
          
            1 
           
          
         
           ) 
          
         
           , 
          
         
           ( 
          
         
           x 
          
         
           , 
          
         
           l 
          
         
           ) 
          
         
           } 
          
         
        
          \text{OUT}[l] = \{(a, l_1), (x, l)\}
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             OUT
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord mathnormal" style="margin-right: 0.0197em;">
            l
           </span>
           <span class="mclose">
            ]
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            =
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mopen">
            {(
           </span>
           <span class="mord mathnormal">
            a
           </span>
           <span class="mpunct">
            ,
           </span>
           <span class="mspace" style="margin-right: 0.1667em;">
           </span>
           <span class="mord">
            <span class="mord mathnormal" style="margin-right: 0.0197em;">
             l
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.3011em;">
                <span class="" style="top: -2.55em; margin-left: -0.0197em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mtight">
                   1
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.15em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mclose">
            )
           </span>
           <span class="mpunct">
            ,
           </span>
           <span class="mspace" style="margin-right: 0.1667em;">
           </span>
           <span class="mopen">
            (
           </span>
           <span class="mord mathnormal">
            x
           </span>
           <span class="mpunct">
            ,
           </span>
           <span class="mspace" style="margin-right: 0.1667em;">
           </span>
           <span class="mord mathnormal" style="margin-right: 0.0197em;">
            l
           </span>
           <span class="mclose">
            )}
           </span>
          </span>
         </span>
        </span>
       </span>
       ，那么可以知道引用的
       <code>
        a
       </code>
       在
       <code>
        l1
       </code>
       出定义，添加边
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          l 
           
          
            1 
           
          
          
           
            
            
              → 
             
            
           
             a 
            
           
          
         
           l 
          
         
        
          l_1 \stackrel{a}{\rightarrow} l
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 1.1183em; vertical-align: -0.15em;">
           </span>
           <span class="mord">
            <span class="mord mathnormal" style="margin-right: 0.0197em;">
             l
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.3011em;">
                <span class="" style="top: -2.55em; margin-left: -0.0197em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mtight">
                   1
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.15em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            <span class="mop op-limits">
             <span class="vlist-t">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.9683em;">
                <span class="" style="top: -3em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="">
                  <span class="mop">
                   →
                  </span>
                 </span>
                </span>
                <span class="" style="top: -3.5669em; margin-left: 0em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mtight">
                   <span class="mord mathnormal mtight">
                    a
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 0.6944em;">
           </span>
           <span class="mord mathnormal" style="margin-right: 0.0197em;">
            l
           </span>
          </span>
         </span>
        </span>
       </span>
       。同时对于循环中的
       <code>
        x = y op z
       </code>
       ，如果
       <code>
        y
       </code>
       和
       <code>
        z
       </code>
       的定义在循环外，那么可以把
       <code>
        y op z
       </code>
       移动到循环外。
      </p>
     </li>
     <li>
      <p>
       2.常量传播的结果
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          OUT 
          
         
           [ 
          
         
           s 
          
         
           ] 
          
         
        
          \text{OUT}[s]
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             OUT
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord mathnormal">
            s
           </span>
           <span class="mclose">
            ]
           </span>
          </span>
         </span>
        </span>
       </span>
       表示
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          s 
          
         
        
          s
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.4306em;">
           </span>
           <span class="mord mathnormal">
            s
           </span>
          </span>
         </span>
        </span>
       </span>
       处为常量的变量情况。可以用来对变量进行常量替换。
      </p>
     </li>
     <li>
      <p>
       3.活跃变量的分析结果中
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          IN 
          
         
           [ 
          
         
           s 
          
         
           ] 
          
         
        
          \text{IN}[s]
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             IN
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord mathnormal">
            s
           </span>
           <span class="mclose">
            ]
           </span>
          </span>
         </span>
        </span>
       </span>
       表示
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          s 
          
         
        
          s
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.4306em;">
           </span>
           <span class="mord mathnormal">
            s
           </span>
          </span>
         </span>
        </span>
       </span>
       处的活跃变量，可以用来优化寄存器分配。
      </p>
     </li>
     <li>
      <p>
       4.可用表达式的分析结果可以用来删除公共子表达式减少多余计算。
      </p>
     </li>
    </ul>
    <p>
     除了上述提到的经典问题外，flow-sensitive的
     <strong>
      指针分析
     </strong>
     、
     <strong>
      抽象解释
     </strong>
     也是一个数据流分析问题。指针分析的fact是指向关系 (比如
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        x 
        
       
         → 
        
       
         o 
        
       
      
        x \rightarrow o
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.4306em;">
         </span>
         <span class="mord mathnormal">
          x
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          →
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.4306em;">
         </span>
         <span class="mord mathnormal">
          o
         </span>
        </span>
       </span>
      </span>
     </span>
     表示
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        x 
        
       
      
        x
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.4306em;">
         </span>
         <span class="mord mathnormal">
          x
         </span>
        </span>
       </span>
      </span>
     </span>
     可能指向
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        o 
        
       
      
        o
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.4306em;">
         </span>
         <span class="mord mathnormal">
          o
         </span>
        </span>
       </span>
      </span>
     </span>
     )，meet操作是
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        ∪ 
        
       
      
        \cup
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.5556em;">
         </span>
         <span class="mord">
          ∪
         </span>
        </span>
       </span>
      </span>
     </span>
     ，
     <code>
      gen
     </code>
     和
     <code>
      kill
     </code>
     则需要考虑strong update和weak update。具体可参考
     <a href="https://blog.csdn.net/qq_44370676/article/details/141390987?sharetype=blogdetail&amp;sharerId=141390987&amp;sharerefer=PC&amp;sharesource=qq_44370676&amp;spm=1011.2480.3001.8118">
      blog
     </a>
     。
    </p>
    <ul>
     <li>
      <p>
       对于赋值语句
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          s 
          
         
           : 
          
         
           x 
          
         
           = 
          
         
           y 
          
         
        
          s: x = y
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.4306em;">
           </span>
           <span class="mord mathnormal">
            s
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            :
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 0.4306em;">
           </span>
           <span class="mord mathnormal">
            x
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            =
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 0.625em; vertical-align: -0.1944em;">
           </span>
           <span class="mord mathnormal" style="margin-right: 0.0359em;">
            y
           </span>
          </span>
         </span>
        </span>
       </span>
       ，
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          gen 
          
         
           [ 
          
         
           s 
          
         
           ] 
          
         
           = 
          
         
           { 
          
         
           x 
          
         
           → 
          
         
           o 
          
         
           ∣ 
          
         
           ∀ 
          
         
           o 
          
         
           ∈ 
          
         
           pts 
          
         
           ( 
          
         
           y 
          
         
           ) 
          
         
           } 
          
         
        
          \text{gen}[s] = \{x \rightarrow o \mid \forall o \in \text{pts}(y)\}
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             gen
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord mathnormal">
            s
           </span>
           <span class="mclose">
            ]
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            =
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mopen">
            {
            <!-- -->
           </span>
           <span class="mord mathnormal">
            x
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            →
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord mathnormal">
            o
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            ∣
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 0.7335em; vertical-align: -0.0391em;">
           </span>
           <span class="mord">
            ∀
           </span>
           <span class="mord mathnormal">
            o
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            ∈
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             pts
            </span>
           </span>
           <span class="mopen">
            (
           </span>
           <span class="mord mathnormal" style="margin-right: 0.0359em;">
            y
           </span>
           <span class="mclose">
            )}
           </span>
          </span>
         </span>
        </span>
       </span>
       ，
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          kill 
          
         
           [ 
          
         
           s 
          
         
           ] 
          
         
           = 
          
         
           { 
          
         
           x 
          
         
           → 
          
         
           _ 
          
         
           } 
          
         
        
          \text{kill}[s] = \{x \rightarrow \_ \}
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             kill
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord mathnormal">
            s
           </span>
           <span class="mclose">
            ]
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            =
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mopen">
            {
            <!-- -->
           </span>
           <span class="mord mathnormal">
            x
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            →
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1.06em; vertical-align: -0.31em;">
           </span>
           <span class="mord" style="margin-right: 0.0278em;">
            _
           </span>
           <span class="mclose">
            }
           </span>
          </span>
         </span>
        </span>
       </span>
       ，进行strong update。
      </p>
     </li>
     <li>
      <p>
       对于
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          s 
          
         
           : 
          
         
           ∗ 
          
         
           x 
          
         
           = 
          
         
           y 
          
         
        
          s: *x = y
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.4306em;">
           </span>
           <span class="mord mathnormal">
            s
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            :
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 0.4653em;">
           </span>
           <span class="mord">
            ∗
           </span>
           <span class="mord mathnormal">
            x
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            =
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 0.625em; vertical-align: -0.1944em;">
           </span>
           <span class="mord mathnormal" style="margin-right: 0.0359em;">
            y
           </span>
          </span>
         </span>
        </span>
       </span>
       ，
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          gen 
          
         
           [ 
          
         
           s 
          
         
           ] 
          
         
           = 
          
         
           { 
          
         
           z 
          
         
           → 
          
         
           o 
          
         
           ∣ 
          
         
           ∀ 
          
         
           z 
          
         
           ∈ 
          
         
           pts 
          
         
           ( 
          
         
           x 
          
         
           ) 
            
         
           ∀ 
          
         
           o 
          
         
           ∈ 
          
         
           pts 
          
         
           ( 
          
         
           y 
          
         
           ) 
          
         
           } 
          
         
        
          \text{gen}[s] = \{z \rightarrow o \mid \forall z \in \text{pts}(x) \; \forall o \in \text{pts}(y) \}
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             gen
            </span>
           </span>
           <span class="mopen">
            [
           </span>
           <span class="mord mathnormal">
            s
           </span>
           <span class="mclose">
            ]
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            =
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mopen">
            {
            <!-- -->
           </span>
           <span class="mord mathnormal" style="margin-right: 0.044em;">
            z
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            →
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord mathnormal">
            o
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            ∣
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 0.7335em; vertical-align: -0.0391em;">
           </span>
           <span class="mord">
            ∀
           </span>
           <span class="mord mathnormal" style="margin-right: 0.044em;">
            z
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            ∈
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             pts
            </span>
           </span>
           <span class="mopen">
            (
           </span>
           <span class="mord mathnormal">
            x
           </span>
           <span class="mclose">
            )
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mord">
            ∀
           </span>
           <span class="mord mathnormal">
            o
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            ∈
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 1em; vertical-align: -0.25em;">
           </span>
           <span class="mord text">
            <span class="mord">
             pts
            </span>
           </span>
           <span class="mopen">
            (
           </span>
           <span class="mord mathnormal" style="margin-right: 0.0359em;">
            y
           </span>
           <span class="mclose">
            )}
           </span>
          </span>
         </span>
        </span>
       </span>
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          kill 
          
         
        
          \text{kill}
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.6944em;">
           </span>
           <span class="mord text">
            <span class="mord">
             kill
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       情况就比较复杂。
      </p>
      <ul>
       <li>
        <p>
         如果
         <span class="katex--inline">
          <span class="katex">
           <span class="katex-mathml">
            x 
            
           
          
            x
           </span>
           <span class="katex-html">
            <span class="base">
             <span class="strut" style="height: 0.4306em;">
             </span>
             <span class="mord mathnormal">
              x
             </span>
            </span>
           </span>
          </span>
         </span>
         只指向内存对象
         <span class="katex--inline">
          <span class="katex">
           <span class="katex-mathml">
            z 
            
           
          
            z
           </span>
           <span class="katex-html">
            <span class="base">
             <span class="strut" style="height: 0.4306em;">
             </span>
             <span class="mord mathnormal" style="margin-right: 0.044em;">
              z
             </span>
            </span>
           </span>
          </span>
         </span>
         ，那么
         <span class="katex--inline">
          <span class="katex">
           <span class="katex-mathml">
            kill 
            
           
             [ 
            
           
             s 
            
           
             ] 
            
           
             = 
            
           
             { 
            
           
             z 
            
           
             → 
            
           
             _ 
            
           
             } 
            
           
          
            \text{kill}[s] = \{z \rightarrow \_ \}
           </span>
           <span class="katex-html">
            <span class="base">
             <span class="strut" style="height: 1em; vertical-align: -0.25em;">
             </span>
             <span class="mord text">
              <span class="mord">
               kill
              </span>
             </span>
             <span class="mopen">
              [
             </span>
             <span class="mord mathnormal">
              s
             </span>
             <span class="mclose">
              ]
             </span>
             <span class="mspace" style="margin-right: 0.2778em;">
             </span>
             <span class="mrel">
              =
             </span>
             <span class="mspace" style="margin-right: 0.2778em;">
             </span>
            </span>
            <span class="base">
             <span class="strut" style="height: 1em; vertical-align: -0.25em;">
             </span>
             <span class="mopen">
              {
              <!-- -->
             </span>
             <span class="mord mathnormal" style="margin-right: 0.044em;">
              z
             </span>
             <span class="mspace" style="margin-right: 0.2778em;">
             </span>
             <span class="mrel">
              →
             </span>
             <span class="mspace" style="margin-right: 0.2778em;">
             </span>
            </span>
            <span class="base">
             <span class="strut" style="height: 1.06em; vertical-align: -0.31em;">
             </span>
             <span class="mord" style="margin-right: 0.0278em;">
              _
             </span>
             <span class="mclose">
              }
             </span>
            </span>
           </span>
          </span>
         </span>
         ，依旧可以进行strong update。
        </p>
       </li>
       <li>
        <p>
         如果
         <span class="katex--inline">
          <span class="katex">
           <span class="katex-mathml">
            x 
            
           
          
            x
           </span>
           <span class="katex-html">
            <span class="base">
             <span class="strut" style="height: 0.4306em;">
             </span>
             <span class="mord mathnormal">
              x
             </span>
            </span>
           </span>
          </span>
         </span>
         可能指向好几块内存对象，那么
         <span class="katex--inline">
          <span class="katex">
           <span class="katex-mathml">
            kill 
            
           
             [ 
            
           
             s 
            
           
             ] 
            
           
             = 
            
           
             { 
            
           
             } 
            
           
          
            \text{kill}[s] = \{\}
           </span>
           <span class="katex-html">
            <span class="base">
             <span class="strut" style="height: 1em; vertical-align: -0.25em;">
             </span>
             <span class="mord text">
              <span class="mord">
               kill
              </span>
             </span>
             <span class="mopen">
              [
             </span>
             <span class="mord mathnormal">
              s
             </span>
             <span class="mclose">
              ]
             </span>
             <span class="mspace" style="margin-right: 0.2778em;">
             </span>
             <span class="mrel">
              =
             </span>
             <span class="mspace" style="margin-right: 0.2778em;">
             </span>
            </span>
            <span class="base">
             <span class="strut" style="height: 1em; vertical-align: -0.25em;">
             </span>
             <span class="mopen">
              {
              <!-- -->
             </span>
             <span class="mclose">
              }
             </span>
            </span>
           </span>
          </span>
         </span>
         ，此时进行的是weak update。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <p>
     抽象解释可参考
     <a href="https://blog.csdn.net/qq_44370676/article/details/144981162">
      blog
     </a>
     ，fact为变量值域，SVF的抽象解释模块对
     <code>
      p = c
     </code>
     (
     <code>
      c
     </code>
     为整型常量，
     <code>
      p
     </code>
     为整型变量) 生成的fact为
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        p 
        
       
         → 
        
       
         ⟨ 
        
       
         [ 
        
       
         c 
        
       
         , 
        
       
         c 
        
       
         ] 
        
       
         , 
        
       
         ⊤ 
        
       
         ⟩ 
        
       
      
        p \rightarrow \langle [c, c], \top \rangle
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.625em; vertical-align: -0.1944em;">
         </span>
         <span class="mord mathnormal">
          p
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          →
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mopen">
          ⟨[
         </span>
         <span class="mord mathnormal">
          c
         </span>
         <span class="mpunct">
          ,
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mord mathnormal">
          c
         </span>
         <span class="mclose">
          ]
         </span>
         <span class="mpunct">
          ,
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mord">
          ⊤
         </span>
         <span class="mclose">
          ⟩
         </span>
        </span>
       </span>
      </span>
     </span>
     ，包括值域
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        [ 
        
       
         c 
        
       
         , 
        
       
         c 
        
       
         ] 
        
       
      
        [c, c]
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mopen">
          [
         </span>
         <span class="mord mathnormal">
          c
         </span>
         <span class="mpunct">
          ,
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mord mathnormal">
          c
         </span>
         <span class="mclose">
          ]
         </span>
        </span>
       </span>
      </span>
     </span>
     和指向集
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        ⊤ 
        
       
      
        \top
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord">
          ⊤
         </span>
        </span>
       </span>
      </span>
     </span>
     ，同时进行抽象解释和指针分析（也就是对应
     <a href="https://dl.acm.org/doi/pdf/10.1145/3597503.3639220?casa_token=srF_cd4rWQEAAAAA:rlYzsh4zthj90kPhg8NA6TgDgm3Aimq_4YfYmd6ZU7LHGLPn7WKrhh1fatQCZMZnQoHHkxr7rBAZ" rel="nofollow">
      paper
     </a>
     提到的Combined Abstract Domains）。和指针分析一样，抽象解释中
     <code>
      store
     </code>
     指令可能涉及到
     <code>
      kill
     </code>
     操作，也需要考虑strong update和weak update。
    </p>
    <p>
     <strong>
      难点
     </strong>
     ：C/C++中别名的存在是数据流分析的一大难点（参考
     <a href="https://blog.csdn.net/dashuniuniu/article/details/50768676?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522e85f992d69edc8414c749d043f0a3287%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=e85f992d69edc8414c749d043f0a3287&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-4-50768676-null-null.nonecase&amp;utm_term=%E6%95%B0%E6%8D%AE%E6%B5%81&amp;spm=1018.2226.3001.4450">
      blog
     </a>
     ），不同变量对同一内存的引用导致多个定义可能指向一个变量，通常
     <strong>
      数组
     </strong>
     、
     <strong>
      指针
     </strong>
     、
     <strong>
      结构体
     </strong>
     的使用可能带来别名关系，为了保证soundness，越保守的策略通常越不会
     <code>
      kill
     </code>
     不确定的fact。通常可以先进行一个指针分析来确定大致别名关系。或者参考
     <a href="https://github.com/ucsb-seclab/dr_checker">
      Dr.Checker
     </a>
     和
     <a href="https://dl.acm.org/doi/pdf/10.1145/3656400" rel="nofollow">
      Falcon
     </a>
     将
     <strong>
      指针分析和到达定值一起分析
     </strong>
     。考虑到二者到达收敛的循环次数可能不一致，Dr.Checker预设了一个循环次数上限，不过这种策略可能会导致指针分析不够可靠（unsound）。对于Falcon，它用到了两个集合
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        E 
        
       
      
        E
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0576em;">
          E
         </span>
        </span>
       </span>
      </span>
     </span>
     和
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        S 
        
       
      
        S
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0576em;">
          S
         </span>
        </span>
       </span>
      </span>
     </span>
     来分别保存top-level pointer的指向集和address-taken object的到达定值，
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        ( 
        
       
         π 
        
       
         , 
        
       
         l 
        
       
         , 
        
       
         q 
        
       
         ) 
        
       
         ∈ 
        
       
         S 
        
       
         ( 
        
       
         o 
        
       
         ) 
        
       
      
        (\pi, l, q) \in S(o)
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0359em;">
          π
         </span>
         <span class="mpunct">
          ,
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0197em;">
          l
         </span>
         <span class="mpunct">
          ,
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0359em;">
          q
         </span>
         <span class="mclose">
          )
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          ∈
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0576em;">
          S
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord mathnormal">
          o
         </span>
         <span class="mclose">
          )
         </span>
        </span>
       </span>
      </span>
     </span>
     表示
     <code>
      store
     </code>
     语句
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        l 
        
       
         : 
        
       
         ∗ 
        
       
         p 
        
       
         = 
        
       
         q 
        
       
      
        l: *p = q
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0197em;">
          l
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          :
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.6597em; vertical-align: -0.1944em;">
         </span>
         <span class="mord">
          ∗
         </span>
         <span class="mord mathnormal">
          p
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          =
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.625em; vertical-align: -0.1944em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0359em;">
          q
         </span>
        </span>
       </span>
      </span>
     </span>
     中
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        o 
        
       
         ∈ 
        
       
         pts 
        
       
         ( 
        
       
         p 
        
       
         ) 
        
       
      
        o \in \text{pts}(p)
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.5782em; vertical-align: -0.0391em;">
         </span>
         <span class="mord mathnormal">
          o
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          ∈
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord text">
          <span class="mord">
           pts
          </span>
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord mathnormal">
          p
         </span>
         <span class="mclose">
          )
         </span>
        </span>
       </span>
      </span>
     </span>
     因此
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        o 
        
       
      
        o
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.4306em;">
         </span>
         <span class="mord mathnormal">
          o
         </span>
        </span>
       </span>
      </span>
     </span>
     在
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        l 
        
       
      
        l
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0197em;">
          l
         </span>
        </span>
       </span>
      </span>
     </span>
     处的到达定值为
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        ( 
        
       
         π 
        
       
         , 
        
       
         q 
        
       
         ) 
        
       
      
        (\pi, q)
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0359em;">
          π
         </span>
         <span class="mpunct">
          ,
         </span>
         <span class="mspace" style="margin-right: 0.1667em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0359em;">
          q
         </span>
         <span class="mclose">
          )
         </span>
        </span>
       </span>
      </span>
     </span>
     (
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        π 
        
       
      
        \pi
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.4306em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0359em;">
          π
         </span>
        </span>
       </span>
      </span>
     </span>
     是路径条件，Falcon采用路径敏感的分析策略)，Falcon中只有
     <code>
      store
     </code>
     语句会更新
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        S 
        
       
      
        S
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0576em;">
          S
         </span>
        </span>
       </span>
      </span>
     </span>
     集合，其它语句(
     <code>
      load
     </code>
     ,
     <code>
      gep
     </code>
     等) 会查询
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        S 
        
       
      
        S
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0576em;">
          S
         </span>
        </span>
       </span>
      </span>
     </span>
     并更新top-level variable对应
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        E 
        
       
      
        E
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0576em;">
          E
         </span>
        </span>
       </span>
      </span>
     </span>
     集合。
    </p>
    <h2>
     <a id="2LLVM_62">
     </a>
     2.LLVM实现
    </h2>
    <h3>
     <a id="21_65">
     </a>
     2.1.常量传播
    </h3>
    <p>
     llvm提供了source code level和LLVM IR level的常量传播算法，source code level通过
     <a href="https://github.com/llvm/llvm-project/blob/main/clang/unittests/Analysis/FlowSensitive/SingleVarConstantPropagationTest.cpp">
      ConstantPropagationAnalysis
     </a>
     类实现，不过由于只是简单实现没法适用到real-world环境下，因此只是放到
     <a href="https://github.com/llvm/llvm-project/blob/main/clang/unittests">
      unittests
     </a>
     下。在这个实现中变量值有上界
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        ⊤ 
        
       
      
        \top
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord">
          ⊤
         </span>
        </span>
       </span>
      </span>
     </span>
     , 下届
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        ⊥ 
        
       
      
        \bot
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord">
          ⊥
         </span>
        </span>
       </span>
      </span>
     </span>
     , 常量值
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        c 
        
       
      
        c
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.4306em;">
         </span>
         <span class="mord mathnormal">
          c
         </span>
        </span>
       </span>
      </span>
     </span>
     3种类型。用
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        a 
        
       
      
        a
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.4306em;">
         </span>
         <span class="mord mathnormal">
          a
         </span>
        </span>
       </span>
      </span>
     </span>
     表示任意值，其中有
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        ⊥ 
        
       
         ∪ 
        
       
         a 
        
       
         = 
        
       
         a 
        
       
      
        \bot \cup a = a
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord">
          ⊥
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          ∪
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.4306em;">
         </span>
         <span class="mord mathnormal">
          a
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          =
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.4306em;">
         </span>
         <span class="mord mathnormal">
          a
         </span>
        </span>
       </span>
      </span>
     </span>
     ，
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        ⊤ 
        
       
         ∪ 
        
       
         a 
        
       
         = 
        
       
         ⊤ 
        
       
      
        \top \cup a = \top
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord">
          ⊤
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          ∪
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.4306em;">
         </span>
         <span class="mord mathnormal">
          a
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          =
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord">
          ⊤
         </span>
        </span>
       </span>
      </span>
     </span>
     ,
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        c 
        
       
         ∪ 
        
       
         c 
        
       
         = 
        
       
         c 
        
       
      
        c \cup c = c
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.5556em;">
         </span>
         <span class="mord mathnormal">
          c
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          ∪
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.4306em;">
         </span>
         <span class="mord mathnormal">
          c
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          =
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.4306em;">
         </span>
         <span class="mord mathnormal">
          c
         </span>
        </span>
       </span>
      </span>
     </span>
     ,
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        c 
         
        
          1 
         
        
       
         ∪ 
        
        
        
          c 
         
        
          2 
         
        
       
         = 
        
       
         ⊤ 
        
       
      
        c_1 \cup c_2 = \top
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.7056em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal">
           c
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3011em;">
              <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 1
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          ∪
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.5806em; vertical-align: -0.15em;">
         </span>
         <span class="mord">
          <span class="mord mathnormal">
           c
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3011em;">
              <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mtight">
                 2
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
         <span class="mrel">
          =
         </span>
         <span class="mspace" style="margin-right: 0.2778em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord">
          ⊤
         </span>
        </span>
       </span>
      </span>
     </span>
     。对于给定
     <code>
      Stmt* S
     </code>
     ,
     <code>
      ConstantPropagationAnalysis
     </code>
     类通过AST分析识别其中是否存在: 1.变量声明并初始化 (
     <code>
      int x = 42
     </code>
     )、2.赋值语句 (
     <code>
      x = 24
     </code>
     )、3.复合赋值 (
     <code>
      x += 4
     </code>
     )。对于前两种语句
     <code>
      ConstantPropagationAnalysis
     </code>
     会尝试计算右表达式的常量值，如果不是常量则设置左表达式对应变量为
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        ⊤ 
        
       
      
        \top
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord">
          ⊤
         </span>
        </span>
       </span>
      </span>
     </span>
     ，反之设置为具体值。对于复合赋值直接将左变量设置为
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        ⊤ 
        
       
      
        \top
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord">
          ⊤
         </span>
        </span>
       </span>
      </span>
     </span>
     。这里会调用
     <code>
      Expr::EvaluateAsInt
     </code>
     对表达式进行求值。
     <code>
      x = a
     </code>
     中，如果
     <code>
      a
     </code>
     是常量那么返回常量值，如果
     <code>
      a
     </code>
     是变量似乎不会再递归求值直接返回
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        ⊤ 
        
       
      
        \top
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6944em;">
         </span>
         <span class="mord">
          ⊤
         </span>
        </span>
       </span>
      </span>
     </span>
     。
    </p>
    <p>
     LLVM IR level的通过
     <a href="https://github.com/llvm/llvm-project/blob/main/llvm/include/llvm/Transforms/Scalar/SCCP.h">
      SCCPPass
     </a>
     来进行函数内Sparse Conditional Constant Propagation (SCCP)。跨函数传播通过
     <a href="https://github.com/llvm/llvm-project/blob/main/llvm/include/llvm/Transforms/IPO/SCCP.h">
      IPSCCPPass
     </a>
     实现。SCCP相比普通常量传播的改进在于增加对分支条件的处理。普通常量传播不会考虑分支条件为常量 (
     <code>
      true
     </code>
     或
     <code>
      false
     </code>
     )，SCCP则会基于分支条件的常量值删除不可达分支。根据这个
     <a href="https://stackoverflow.com/questions/36836589/constant-propagation-in-llvm" rel="nofollow">
      stackoverflow post
     </a>
     ，启用常量传播pass的前提条件应该是先使用
     <a href="https://llvm.org/docs/Passes.html#mem2reg-promote-memory-to-register" rel="nofollow">
      mem2reg
     </a>
     优化。
    </p>
    <p>
     函数内常量传播的入口为
     <a href="https://github.com/llvm/llvm-project/blob/main/llvm/lib/Transforms/Scalar/SCCP.cpp#L55">
      runSCCP
     </a>
     函数，lattice定义为
     <a href="https://github.com/llvm/llvm-project/blob/main/llvm/include/llvm/Analysis/ValueLattice.h#L26">
      ValueLatticeElement
     </a>
     ，变量值通常通常有以下状态。
    </p>
    <table>
     <thead>
      <tr>
       <th>
        状态
       </th>
       <th>
        含义
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         unknown
        </code>
       </td>
       <td>
        该值尚无已知信息，可以转换为任何其他状态。通常作为起始状态
       </td>
      </tr>
      <tr>
       <td>
        <code>
         undef
        </code>
       </td>
       <td>
        该值是
        <code>
         UndefValue
        </code>
        或产生
        <code>
         undef
        </code>
        ，可以与
        <code>
         constant
        </code>
        或
        <code>
         constantrange
        </code>
        meet后转化为
        <code>
         constant
        </code>
        。可以转换为
        <code>
         constant
        </code>
        、
        <code>
         constantrange_including_undef
        </code>
        或
        <code>
         overdefined
        </code>
        。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         constant
        </code>
       </td>
       <td>
        该值是一个特定的常量，不能是
        <code>
         undef
        </code>
        。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         notconstant
        </code>
       </td>
       <td>
        该值已知不是某个特定常量（适用于非整数类型）。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         constantrange
        </code>
       </td>
       <td>
        该值属于某个范围（仅适用于整数类型）。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         constantrange_including_undef
        </code>
       </td>
       <td>
        该值属于某个范围，但也可能是
        <code>
         undef
        </code>
        。
        <code>
         undef
        </code>
        与
        <code>
         constantrange
        </code>
        meet后为
        <code>
         constantrange_including_undef
        </code>
        。与其他fact meet后仍为
        <code>
         constantrange_including_undef
        </code>
        。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        该值无法精确建模，即可能具有多个动态值，不再进行任何状态转换。相当于
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           ⊥ 
           
          
         
           \bot
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.6944em;">
            </span>
            <span class="mord">
             ⊥
            </span>
           </span>
          </span>
         </span>
        </span>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     涉及到merge (meet)操作时，状态转移关系定义在
     <a href="https://github.com/llvm/llvm-project/blob/main/llvm/include/llvm/Analysis/ValueLattice.h#L399">
      ValueLatticeElement::mergeIn
     </a>
     ，状态转移关系如下。对于
     <code>
      res = lhs op rhs
     </code>
     ，运算结果如下：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        lhs\rhs
       </th>
       <th>
        <code>
         unknown
        </code>
       </th>
       <th>
        <code>
         overdefined
        </code>
       </th>
       <th>
        <code>
         undef
        </code>
       </th>
       <th>
        <code>
         constant
        </code>
       </th>
       <th>
        <code>
         constantrange
        </code>
       </th>
       <th>
        <code>
         notconstant
        </code>
       </th>
       <th>
        <code>
         constantrange_including_undef
        </code>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         unknown
        </code>
       </td>
       <td>
        <code>
         unknown
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         undef
        </code>
       </td>
       <td>
        <code>
         constant
        </code>
       </td>
       <td>
        <code>
         constantrange
        </code>
       </td>
       <td>
        <code>
         notconstant
        </code>
       </td>
       <td>
        <code>
         constantrange_including_undef
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         undef
        </code>
       </td>
       <td>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         undef
        </code>
       </td>
       <td>
        <code>
         constant
        </code>
       </td>
       <td>
        <code>
         constantrange
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         constant
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         constant
        </code>
       </td>
       <td>
        <code>
         constant
        </code>
        (lhs == rhs),
        <code>
         overdefined
        </code>
        (lhs != rhs)
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         notconstant
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         notconstant
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         constantrange
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         constantrange
        </code>
        (值域会进行union)
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
       <td>
        <code>
         overdefined
        </code>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     其中还有一个辅助类
     <a href="https://github.com/llvm/llvm-project/blob/main/llvm/lib/Transforms/Utils/SCCPSolver.cpp#L398">
      SCCPInstVisitor
     </a>
     来收集中间结果。
    </p>
    <table>
     <thead>
      <tr>
       <th>
        成员变量
       </th>
       <th>
        类型
       </th>
       <th>
        作用
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         BBExecutable
        </code>
       </td>
       <td>
        <code>
         SmallPtrSet&lt;BasicBlock *, 8&gt;
        </code>
       </td>
       <td>
        记录可执行的基本块
       </td>
      </tr>
      <tr>
       <td>
        <code>
         ValueState
        </code>
       </td>
       <td>
        <code>
         DenseMap&lt;Value *, ValueLatticeElement&gt;
        </code>
       </td>
       <td>
        记录
        <code>
         Value
        </code>
        的lattice状态,
        <code>
         Value
        </code>
        通常对应1个llvm指令
       </td>
      </tr>
      <tr>
       <td>
        <code>
         StructValueState
        </code>
       </td>
       <td>
        <code>
         DenseMap&lt;std::pair&lt;Value *, unsigned&gt;, ValueLatticeElement&gt;
        </code>
       </td>
       <td>
        记录结构体字段的 lattice 状态
       </td>
      </tr>
      <tr>
       <td>
        <code>
         TrackedGlobals
        </code>
       </td>
       <td>
        <code>
         DenseMap&lt;GlobalVariable *, ValueLatticeElement&gt;
        </code>
       </td>
       <td>
        记录全局变量的lattice状态
       </td>
      </tr>
      <tr>
       <td>
        <code>
         TrackedRetVals
        </code>
       </td>
       <td>
        <code>
         MapVector&lt;Function *, ValueLatticeElement&gt;
        </code>
       </td>
       <td>
        记录单返回值函数的返回值状态
       </td>
      </tr>
      <tr>
       <td>
        <code>
         TrackedMultipleRetVals
        </code>
       </td>
       <td>
        <code>
         MapVector&lt;std::pair&lt;Function *, unsigned&gt;, ValueLatticeElement&gt;
        </code>
       </td>
       <td>
        记录多返回值函数的返回值状态
       </td>
      </tr>
      <tr>
       <td>
        <code>
         MRVFunctionsTracked
        </code>
       </td>
       <td>
        <code>
         SmallPtrSet&lt;Function *, 16&gt;
        </code>
       </td>
       <td>
        存储
        <code>
         TrackedMultipleRetVals
        </code>
        中的函数，方便查找
       </td>
      </tr>
      <tr>
       <td>
        <code>
         MustPreserveReturnsInFunctions
        </code>
       </td>
       <td>
        <code>
         SmallPtrSet&lt;Function *, 16&gt;
        </code>
       </td>
       <td>
        存储返回值不可修改的函数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         TrackingIncomingArguments
        </code>
       </td>
       <td>
        <code>
         SmallPtrSet&lt;Function *, 16&gt;
        </code>
       </td>
       <td>
        存储需要分析参数的函数
       </td>
      </tr>
      <tr>
       <td>
        <code>
         OverdefinedInstWorkList
        </code>
       </td>
       <td>
        <code>
         SmallVector&lt;Value *, 64&gt;
        </code>
       </td>
       <td>
        记录即将
        <code>
         overdefined
        </code>
        的指令，加速SCCP收敛
       </td>
      </tr>
      <tr>
       <td>
        <code>
         InstWorkList
        </code>
       </td>
       <td>
        <code>
         SmallVector&lt;Value *, 64&gt;
        </code>
       </td>
       <td>
        记录待 SCCP 处理的指令，加速SCCP收敛
       </td>
      </tr>
      <tr>
       <td>
        <code>
         BBWorkList
        </code>
       </td>
       <td>
        <code>
         SmallVector&lt;BasicBlock *, 64&gt;
        </code>
       </td>
       <td>
        记录待 SCCP 处理的基本块 ，主worklist
       </td>
      </tr>
      <tr>
       <td>
        <code>
         KnownFeasibleEdges
        </code>
       </td>
       <td>
        <code>
         DenseSet&lt;Edge&gt;
        </code>
       </td>
       <td>
        记录已确认的CFG边，避免重复计算
       </td>
      </tr>
      <tr>
       <td>
        <code>
         AnalysisResults
        </code>
       </td>
       <td>
        <code>
         DenseMap&lt;Function *, AnalysisResultsForFn&gt;
        </code>
       </td>
       <td>
        存储函数SCCP分析结果
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     这里worklist算法大致如下，相比原版worklist算法再次做了些优化：
    </p>
    <ul>
     <li>
      <p>
       1.
       <code>
        visit(BB)
       </code>
       表示对basic block
       <code>
        BB
       </code>
       下的所有指令 (
       <code>
        Value
       </code>
       ) 进行
       <code>
        meet
       </code>
       和
       <code>
        update
       </code>
       。
      </p>
     </li>
     <li>
      <p>
       2.
       <code>
        markUsersAsChanged
       </code>
       会对
       <code>
        I
       </code>
       的所有
       <code>
        users
       </code>
       进行
       <code>
        visit
       </code>
       ，也就是优先处理
       <code>
        OverdefinedInstWorkList
       </code>
       中的元素和非
       <code>
        overdefined
       </code>
       的结构体元素。
      </p>
     </li>
     <li>
      <p>
       3.优先处理
       <code>
        OverdefinedInstWorkList
       </code>
       的原因是如果变量 (
       <code>
        Value
       </code>
       )
       <code>
        I
       </code>
       的状态为
       <code>
        Overdefined
       </code>
       ，它的
       <code>
        user
       </code>
       状态多半为
       <code>
        Overdefined
       </code>
       ，没法再收敛了，减少这部分的迭代次数能加速SCCP收敛。
      </p>
     </li>
     <li>
      <p>
       4.
       <code>
        InstWorkList
       </code>
       主要用于处理值从
       <code>
        undef
       </code>
       变成
       <code>
        constant
       </code>
       的情况。尽早传播
       <code>
        constant
       </code>
       ，让更多值变成
       <code>
        constant
       </code>
       ，提高优化效果。
      </p>
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">SCCP_Worklist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> !BBWorkList<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> !OverdefinedInstWorkList<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> !InstWorkList<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 优先处理 OverdefinedInstWorkList，尽快传播 overdefined 状态</span>
        <span class="token keyword">while</span> !OverdefinedInstWorkList<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            I <span class="token operator">=</span> OverdefinedInstWorkList<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
            markUsersAsChanged<span class="token punctuation">(</span>I<span class="token punctuation">)</span>

        <span class="token comment"># 处理普通指令工作列表</span>
        <span class="token keyword">while</span> !InstWorkList<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            I <span class="token operator">=</span> InstWorkList<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># 只处理未 overdefined 的值</span>
            <span class="token keyword">if</span> isStructType<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">not</span> isOverdefined<span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">:</span>
                markUsersAsChanged<span class="token punctuation">(</span>I<span class="token punctuation">)</span>

        <span class="token comment"># 处理基本块工作列表</span>
        <span class="token keyword">while</span> !BBWorkList<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            BB <span class="token operator">=</span> BBWorkList<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
            visit<span class="token punctuation">(</span>BB<span class="token punctuation">)</span>
</code></pre>
    <p>
     具体的
     <code>
      update
     </code>
     规则可以参考
     <code>
      SCCP::visitXXInst
     </code>
     函数。这里有意思的是:
    </p>
    <ul>
     <li>
      <p>
       1.
       <a href="https://github.com/llvm/llvm-project/blob/main/llvm/lib/Transforms/Utils/SCCPSolver.cpp#L1681">
        SCCPInstVisitor::visitStoreInst
       </a>
       ，其中只对全局变量进行处理，也就是局部变量的
       <code>
        store
       </code>
       都不操作。
      </p>
     </li>
     <li>
      <p>
       2.
       <a href="https://github.com/llvm/llvm-project/blob/main/llvm/lib/Transforms/Utils/SCCPSolver.cpp#L1724">
        SCCPInstVisitor::visitLoadInst
       </a>
       中如果加载的是结构体变量直接为
       <code>
        overdefined
       </code>
       (
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          ⊥ 
          
         
        
          \bot
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.6944em;">
           </span>
           <span class="mord">
            ⊥
           </span>
          </span>
         </span>
        </span>
       </span>
       )，
       <a href="https://github.com/llvm/llvm-project/blob/main/llvm/lib/Transforms/Utils/SCCPSolver.cpp#L2109">
        SCCPInstVisitor::resolvedUndefsIn
       </a>
       中对于其它
       <code>
        load
       </code>
       将值设为
       <code>
        undef
       </code>
       。这可能是考虑到别名的一种保守处理。根据这个
       <a href="https://stackoverflow.com/questions/36836589/constant-propagation-in-llvm" rel="nofollow">
        stackoverflow post
       </a>
       ，对于下面代码，llvm编译器压根没做优化。原因是
       <code>
        c = a + b
       </code>
       中存在
       <code>
        load a
       </code>
       与
       <code>
        load b
       </code>
       和
       <code>
        store 1, a
       </code>
       ,
       <code>
        store 2, b
       </code>
       操作。而
       <code>
        SCCPPass
       </code>
       没有详细地处理，因此，没能优化。也是因此开启该优化的一个前提是先用
       <code>
        mem2reg
       </code>
       。
      </p>
     </li>
    </ul>
    <pre><code class="prism language-cpp"><span class="token keyword">int</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">;</span>
a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
c <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      <p>
       3.
       <a href="https://github.com/llvm/llvm-project/blob/main/llvm/lib/Transforms/Utils/SCCPSolver.cpp#L1603">
        SCCPInstVisitor::visitCmpInst
       </a>
       中调用
       <a href="https://github.com/llvm/llvm-project/blob/main/llvm/include/llvm/Analysis/ValueLattice.h#L470">
        ValueLatticeElement::getCompare
       </a>
       对
       <code>
        r = cmp op1, op2
       </code>
       计算
       <code>
        r
       </code>
       的值，最终结果有
       <code>
        overdefined
       </code>
       ,
       <code>
        constant(1)
       </code>
       ,
       <code>
        constant(0)
       </code>
       3种。
      </p>
     </li>
     <li>
      <p>
       4.
       <a href="https://github.com/llvm/llvm-project/blob/main/llvm/lib/Transforms/Utils/SCCPSolver.cpp#L1460">
        SCCPInstVisitor::visitSelectInst
       </a>
       中会根据
       <code>
        cmp
       </code>
       的计算结果计算当前值。如果
       <code>
        cond
       </code>
       的常量值为
       <code>
        1
       </code>
       ，则选
       <code>
        true
       </code>
       branch的值，反之亦然；如果为
       <code>
        overdefined
       </code>
       ，则合并两个分支的常量值。
      </p>
     </li>
    </ul>
    <p>
     <a href="https://github.com/llvm/llvm-project/blob/main/llvm/lib/Transforms/Scalar/SCCP.cpp#L110">
      runSCCP
     </a>
     结尾会调用
     <a href="https://github.com/llvm/llvm-project/blob/main/llvm/lib/Transforms/Utils/SCCPSolver.cpp#L235">
      SCCPSolver::simplifyInstsInBlock
     </a>
     对变量进行常量替换以及删除无用指令并调用
     <a href="https://github.com/llvm/llvm-project/blob/main/llvm/lib/Transforms/Utils/SCCPSolver.cpp#L1460">
      removeNonFeasibleEdges
     </a>
     删除infeasible CFG edge以及随后删除无用基本块。
    </p>
    <h3>
     <a id="22_170">
     </a>
     2.2.活跃性分析
    </h3>
    <p>
     llvm提供两个level的活跃性（包括活跃变量和可用表达式）分析：source code和machine code，source code level可通过clang static analyzer的
     <a href="https://github.com/llvm/llvm-project/blob/main/clang/lib/StaticAnalyzer/Checkers/DebugCheckers.cpp#L110">
      LiveVariablesDumper
     </a>
     (CSA参数为
     <code>
      debug.DumpLiveVars
     </code>
     ) 以及
     <a href="https://github.com/llvm/llvm-project/blob/main/clang/lib/StaticAnalyzer/Checkers/DebugCheckers.cpp#L134">
      LiveExpressionsDumper
     </a>
     (CSA参数为
     <code>
      debug.DumpLiveExprs
     </code>
     )打印活跃变量信息。在machine code level会通过
     <a href="https://github.com/llvm/llvm-project/blob/main/llvm/include/llvm/CodeGen/LiveVariables.h#L304">
      LiveVariablesAnalysis
     </a>
     进行活跃变量分析。
    </p>
    <p>
     source code level的活跃性分析这位大佬的两篇blog（
     <a href="https://blog.csdn.net/dashuniuniu/article/details/50723930">
      clang中的活跃性分析
     </a>
     讲解源码,
     <a href="https://blog.csdn.net/dashuniuniu/article/details/53087374?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522e85f992d69edc8414c749d043f0a3287%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=e85f992d69edc8414c749d043f0a3287&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-12-53087374-null-null.nonecase&amp;utm_term=%E6%95%B0%E6%8D%AE%E6%B5%81&amp;spm=1018.2226.3001.4450">
      clang中的活跃性分析（续）
     </a>
     给出示例）对clang的源代码进行了具体说明。负责活跃性分析的包括
     <a href="https://github.com/llvm/llvm-project/blob/main/clang/include/clang/Analysis/Analyses/LiveVariables.h#L28">
      LiveVariables
     </a>
     和
     <a href="https://github.com/llvm/llvm-project/blob/main/clang/include/clang/Analysis/Analyses/LiveVariables.h#L112">
      RelaxedLiveVariables
     </a>
     类，后者相比前者分析结果更不精确，不过source code level的活跃性分析主要是辅助clang static analyzer而不是编译优化，因此在analyzer中反而应用了
     <code>
      RelaxedLiveVariables
     </code>
     ，而
     <code>
      LiveVariables
     </code>
     纯粹只是用来dump source code level的活跃变量信息。transfer function的定义在
     <a href="https://github.com/llvm/llvm-project/blob/main/clang/lib/Analysis/LiveVariables.cpp#L160">
      TransferFunctions
     </a>
     中，活跃性分析的dataflow fact分别用
     <a href="https://github.com/llvm/llvm-project/blob/main/clang/include/clang/AST/Decl.h#L886">
      VarDecl*
     </a>
     (变量分析)和
     <a href="https://github.com/llvm/llvm-project/blob/main/clang/include/clang/AST/Expr.h#L110">
      Expr*
     </a>
     (表达式分析)表示。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34343337303637362f:61727469636c652f64657461696c732f313436313337363939" class_="artid" style="display:none">
 </p>
</div>


