---
layout: post
title: "第四章深入理解框架之-GUI-模块"
date: 2025-03-11 01:34:51 +0800
description: "通过继承QWidget实现自定义绘制。"
keywords: "第四章：深入理解框架之 GUI 模块"
categories: ['Qt']
tags: ['Qt']
artid: "146167903"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146167903
    alt: "第四章深入理解框架之-GUI-模块"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146167903
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146167903
cover: https://bing.ee123.net/img/rand?artid=146167903
image: https://bing.ee123.net/img/rand?artid=146167903
img: https://bing.ee123.net/img/rand?artid=146167903
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     第四章：深入理解框架之 GUI 模块
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h4>
     <a id="_GUI__0">
     </a>
     <strong>
      第四章：深入理解框架之 GUI 模块
     </strong>
    </h4>
    <p>
     Qt 的 GUI 模块（
     <code>
      QtGui
     </code>
     ）提供了图形化应用开发的核心功能，包括 2D 图形绘制、事件处理、字体与颜色管理、图像操作等。GUI 模块是构建丰富用户界面的重要组成部分。本章将从基础到高级，全面讲解 GUI 模块的核心概念和实际应用。
    </p>
    <hr/>
    <h5>
     <a id="41_GUI__6">
     </a>
     <strong>
      4.1 GUI 模块概述
     </strong>
    </h5>
    <h6>
     <a id="411__8">
     </a>
     4.1.1 核心功能
    </h6>
    <p>
     <code>
      QtGui
     </code>
     模块主要用于图形和多媒体应用的开发，以下是其核心功能：
    </p>
    <ul>
     <li>
      <strong>
       2D 图形绘制：
      </strong>
      绘制点、线、矩形、椭圆等基本图形。
     </li>
     <li>
      <strong>
       文本与字体：
      </strong>
      管理字体样式、颜色以及文本绘制。
     </li>
     <li>
      <strong>
       图像处理：
      </strong>
      支持多种格式图像加载、保存及操作。
     </li>
     <li>
      <strong>
       输入事件：
      </strong>
      捕捉键盘、鼠标等用户输入。
     </li>
    </ul>
    <h6>
     <a id="412_GUI__15">
     </a>
     4.1.2 GUI 模块的应用场景
    </h6>
    <p>
     <code>
      QtGui
     </code>
     模块常用于：
    </p>
    <ul>
     <li>
      绘制复杂的自定义组件。
     </li>
     <li>
      实现数据可视化（如图表和图形界面）。
     </li>
     <li>
      图像编辑器、矢量绘图工具等图形应用开发。
     </li>
    </ul>
    <hr/>
    <h5>
     <a id="42_2D__23">
     </a>
     <strong>
      4.2 2D 图形绘制
     </strong>
    </h5>
    <h6>
     <a id="421_QPainter__25">
     </a>
     4.2.1 QPainter 基础
    </h6>
    <p>
     <code>
      QPainter
     </code>
     是 Qt 中的绘图工具类，用于在窗口或组件上绘制内容。
    </p>
    <p>
     示例：绘制简单图形
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QApplication&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QWidget&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QPainter&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">MyWidget</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QWidget</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">paintEvent</span><span class="token punctuation">(</span>QPaintEvent <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
        QPainter <span class="token function">painter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 设置画笔和画刷</span>
        painter<span class="token punctuation">.</span><span class="token function">setPen</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>blue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token punctuation">.</span><span class="token function">setBrush</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>yellow<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 绘制矩形</span>
        painter<span class="token punctuation">.</span><span class="token function">drawRect</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 绘制椭圆</span>
        painter<span class="token punctuation">.</span><span class="token function">setBrush</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>red<span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token punctuation">.</span><span class="token function">drawEllipse</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    QApplication <span class="token function">app</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    MyWidget widget<span class="token punctuation">;</span>
    widget<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    widget<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <strong>
       关键点：
      </strong>
      <ul>
       <li>
        <code>
         setPen()
        </code>
        和
        <code>
         setBrush()
        </code>
        用于设置线条颜色和填充样式。
       </li>
       <li>
        绘制形状的方法如
        <code>
         drawRect()
        </code>
        和
        <code>
         drawEllipse()
        </code>
        。
       </li>
      </ul>
     </li>
    </ul>
    <h6>
     <a id="422__64">
     </a>
     4.2.2 高级绘图
    </h6>
    <p>
     <code>
      QPainter
     </code>
     还支持复杂绘图功能，例如抗锯齿、渐变填充和变换操作。
    </p>
    <p>
     示例：渐变填充与抗锯齿
    </p>
    <pre><code class="prism language-cpp">painter<span class="token punctuation">.</span><span class="token function">setRenderHint</span><span class="token punctuation">(</span>QPainter<span class="token double-colon punctuation">::</span>Antialiasing<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 开启抗锯齿</span>
QLinearGradient <span class="token function">gradient</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gradient<span class="token punctuation">.</span><span class="token function">setColorAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>red<span class="token punctuation">)</span><span class="token punctuation">;</span>
gradient<span class="token punctuation">.</span><span class="token function">setColorAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>blue<span class="token punctuation">)</span><span class="token punctuation">;</span>
painter<span class="token punctuation">.</span><span class="token function">setBrush</span><span class="token punctuation">(</span>gradient<span class="token punctuation">)</span><span class="token punctuation">;</span>
painter<span class="token punctuation">.</span><span class="token function">drawEllipse</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <hr/>
    <h5>
     <a id="43__79">
     </a>
     <strong>
      4.3 文本与字体管理
     </strong>
    </h5>
    <h6>
     <a id="431__81">
     </a>
     4.3.1 字体设置
    </h6>
    <p>
     <code>
      QFont
     </code>
     类用于管理字体样式和大小。
    </p>
    <p>
     示例：绘制文本并设置字体
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QApplication&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QWidget&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QPainter&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">FontWidget</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QWidget</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">paintEvent</span><span class="token punctuation">(</span>QPaintEvent <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
        QPainter <span class="token function">painter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        QFont <span class="token function">font</span><span class="token punctuation">(</span><span class="token string">"Arial"</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> QFont<span class="token double-colon punctuation">::</span>Bold<span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token punctuation">.</span><span class="token function">setFont</span><span class="token punctuation">(</span>font<span class="token punctuation">)</span><span class="token punctuation">;</span>

        painter<span class="token punctuation">.</span><span class="token function">drawText</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token string">"Hello, Qt!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    QApplication <span class="token function">app</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    FontWidget widget<span class="token punctuation">;</span>
    widget<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    widget<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <strong>
       关键点：
      </strong>
      <ul>
       <li>
        <code>
         QFont
        </code>
        构造函数支持字体名称、大小、加粗等属性。
       </li>
       <li>
        <code>
         drawText()
        </code>
        用于绘制文本。
       </li>
      </ul>
     </li>
    </ul>
    <h6>
     <a id="432__114">
     </a>
     4.3.2 字体测量
    </h6>
    <p>
     可以使用
     <code>
      QFontMetrics
     </code>
     测量文本尺寸：
    </p>
    <pre><code class="prism language-cpp">QFontMetrics <span class="token function">metrics</span><span class="token punctuation">(</span>font<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> width <span class="token operator">=</span> metrics<span class="token punctuation">.</span><span class="token function">horizontalAdvance</span><span class="token punctuation">(</span><span class="token string">"Hello, Qt!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> height <span class="token operator">=</span> metrics<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <hr/>
    <h5>
     <a id="44__124">
     </a>
     <strong>
      4.4 图像处理
     </strong>
    </h5>
    <h6>
     <a id="441__126">
     </a>
     4.4.1 加载与显示图像
    </h6>
    <p>
     <code>
      QPixmap
     </code>
     和
     <code>
      QImage
     </code>
     用于加载和显示图像。
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QApplication&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QLabel&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QPixmap&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    QApplication <span class="token function">app</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>

    QLabel label<span class="token punctuation">;</span>
    QPixmap <span class="token function">pixmap</span><span class="token punctuation">(</span><span class="token string">":/resources/image.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用资源文件加载图像</span>
    label<span class="token punctuation">.</span><span class="token function">setPixmap</span><span class="token punctuation">(</span>pixmap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    label<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h6>
     <a id="442__145">
     </a>
     4.4.2 图像操作
    </h6>
    <p>
     通过
     <code>
      QImage
     </code>
     可进行像素级操作：
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QImage&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QColor&gt;</span></span>

QImage <span class="token function">image</span><span class="token punctuation">(</span><span class="token string">"example.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> image<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> image<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>y<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        QColor color <span class="token operator">=</span> image<span class="token punctuation">.</span><span class="token function">pixelColor</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        color<span class="token punctuation">.</span><span class="token function">setRed</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 修改红色通道</span>
        image<span class="token punctuation">.</span><span class="token function">setPixelColor</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
image<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">"modified.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <hr/>
    <h5>
     <a id="45__164">
     </a>
     <strong>
      4.5 输入事件处理
     </strong>
    </h5>
    <h6>
     <a id="451__166">
     </a>
     4.5.1 鼠标事件
    </h6>
    <p>
     通过重写
     <code>
      mousePressEvent()
     </code>
     、
     <code>
      mouseMoveEvent()
     </code>
     等方法捕捉鼠标输入。
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QApplication&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QWidget&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QMouseEvent&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QDebug&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">MouseWidget</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QWidget</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">mousePressEvent</span><span class="token punctuation">(</span>QMouseEvent <span class="token operator">*</span>event<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Mouse pressed at:"</span> <span class="token operator">&lt;&lt;</span> event<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    QApplication <span class="token function">app</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    MouseWidget widget<span class="token punctuation">;</span>
    widget<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    widget<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h6>
     <a id="452__190">
     </a>
     4.5.2 键盘事件
    </h6>
    <p>
     通过重写
     <code>
      keyPressEvent()
     </code>
     捕捉键盘输入。
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">keyPressEvent</span><span class="token punctuation">(</span>QKeyEvent <span class="token operator">*</span>event<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> Qt<span class="token double-colon punctuation">::</span>Key_Escape<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Escape key pressed!"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h5>
     <a id="46__203">
     </a>
     <strong>
      4.6 自定义组件
     </strong>
    </h5>
    <h6>
     <a id="461__205">
     </a>
     4.6.1 基本自定义组件
    </h6>
    <p>
     通过继承
     <code>
      QWidget
     </code>
     实现自定义绘制。
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QWidget&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QPainter&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">CustomWidget</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QWidget</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">paintEvent</span><span class="token punctuation">(</span>QPaintEvent <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
        QPainter <span class="token function">painter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token punctuation">.</span><span class="token function">drawText</span><span class="token punctuation">(</span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>AlignCenter<span class="token punctuation">,</span> <span class="token string">"Custom Widget"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h6>
     <a id="462__220">
     </a>
     4.6.2 添加交互功能
    </h6>
    <p>
     结合鼠标和键盘事件，为自定义组件增加交互能力。
    </p>
    <hr/>
    <h5>
     <a id="47__225">
     </a>
     <strong>
      4.7 实战：绘制一个简单的图形编辑器
     </strong>
    </h5>
    <p>
     综合运用本章知识，构建一个支持简单绘图的图形编辑器：
    </p>
    <ul>
     <li>
      支持矩形、圆形的绘制。
     </li>
     <li>
      支持颜色选择。
     </li>
     <li>
      支持保存绘制结果为图片文件。
     </li>
    </ul>
    <p>
     以下是部分关键代码：
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QApplication&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QWidget&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QPainter&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QMouseEvent&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QFileDialog&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">SimpleEditor</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QWidget</span></span> <span class="token punctuation">{<!-- --></span>
    QPoint start<span class="token punctuation">,</span> end<span class="token punctuation">;</span>
    QVector<span class="token operator">&lt;</span>QRect<span class="token operator">&gt;</span> shapes<span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">mousePressEvent</span><span class="token punctuation">(</span>QMouseEvent <span class="token operator">*</span>event<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
        start <span class="token operator">=</span> event<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">mouseReleaseEvent</span><span class="token punctuation">(</span>QMouseEvent <span class="token operator">*</span>event<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
        end <span class="token operator">=</span> event<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        shapes<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">QRect</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 触发重绘</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">paintEvent</span><span class="token punctuation">(</span>QPaintEvent <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
        QPainter <span class="token function">painter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token punctuation">.</span><span class="token function">setPen</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>black<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> QRect <span class="token operator">&amp;</span>rect <span class="token operator">:</span> shapes<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            painter<span class="token punctuation">.</span><span class="token function">drawRect</span><span class="token punctuation">(</span>rect<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    QApplication <span class="token function">app</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    SimpleEditor editor<span class="token punctuation">;</span>
    editor<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    editor<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h5>
     <a id="48__274">
     </a>
     <strong>
      4.8 小结
     </strong>
    </h5>
    <p>
     本章详细介绍了 Qt GUI 模块的功能，包括 2D 绘图、字体管理、图像处理以及输入事件处理，并通过综合示例展示了模块的实际应用。通过这些内容，您可以开始构建高质量、交互性强的图形界面应用程序。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f776569736f6e5f782f:61727469636c652f64657461696c732f313436313637393033" class_="artid" style="display:none">
 </p>
</div>


