---
layout: post
title: "腾讯云物联网服务器与微信小程序设计讲解设备如何上云,如何对接微信小程序"
date: 2023-12-02 23:51:45 +0800
description: "本文介绍了如何利用腾讯云物联网开发平台创建产品、设备，同时，详细"
keywords: "请问有物联网c端硬件设备连接小程序吗"
categories: ['智能家居与物联网项目实战']
tags: ['腾讯云', '物联网', '服务器']
artid: "134759828"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=134759828
    alt: "腾讯云物联网服务器与微信小程序设计讲解设备如何上云,如何对接微信小程序"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=134759828
featuredImagePreview: https://bing.ee123.net/img/rand?artid=134759828
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     腾讯云物联网服务器与微信小程序设计（讲解设备如何上云，如何对接微信小程序）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night-eighties" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#_2" rel="nofollow">
        一、前言
       </a>
      </li>
      <li>
       <a href="#_14" rel="nofollow">
        二、设计需求
       </a>
      </li>
      <li>
       <a href="#_22" rel="nofollow">
        三、腾讯云平台与微信小程序设计
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#31__24" rel="nofollow">
          3.1 登录云平台
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#1_28" rel="nofollow">
            【1】选择物联网平台
           </a>
          </li>
          <li>
           <a href="#2_36" rel="nofollow">
            【2】进入产品控制台
           </a>
          </li>
          <li>
           <a href="#3_44" rel="nofollow">
            【3】选择公共实例
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#32__52" rel="nofollow">
          3.2 新建项目
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#1_54" rel="nofollow">
            【1】新建项目
           </a>
          </li>
          <li>
           <a href="#2_60" rel="nofollow">
            【2】填写项目名称
           </a>
          </li>
          <li>
           <a href="#3_64" rel="nofollow">
            【3】项目创建完成
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#33__70" rel="nofollow">
          3.3 产品开发
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#1_72" rel="nofollow">
            【1】进入产品页
           </a>
          </li>
          <li>
           <a href="#2_80" rel="nofollow">
            【2】新建产品
           </a>
          </li>
          <li>
           <a href="#3_86" rel="nofollow">
            【3】填写产品信息
           </a>
          </li>
          <li>
           <a href="#4_94" rel="nofollow">
            【4】产品创建完成
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#34__100" rel="nofollow">
          3.4 设备开发
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#1_102" rel="nofollow">
            【1】进入设备配置页
           </a>
          </li>
          <li>
           <a href="#2_110" rel="nofollow">
            【2】配置物模型
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#1MQ2_118" rel="nofollow">
              （1）MQ2烟雾浓度
             </a>
            </li>
            <li>
             <a href="#2MQ135_124" rel="nofollow">
              （2）MQ135空气质量
             </a>
            </li>
            <li>
             <a href="#3MQ4_130" rel="nofollow">
              （3）MQ4有毒气体
             </a>
            </li>
            <li>
             <a href="#4MQ7_136" rel="nofollow">
              （4）MQ7一氧化碳
             </a>
            </li>
            <li>
             <a href="#5_142" rel="nofollow">
              （5）环境温度
             </a>
            </li>
            <li>
             <a href="#6_148" rel="nofollow">
              （6）环境湿度
             </a>
            </li>
            <li>
             <a href="#6_154" rel="nofollow">
              （6）添加完成
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#3_164" rel="nofollow">
            【3】设备开发-主题列表
           </a>
          </li>
          <li>
           <a href="#4_181" rel="nofollow">
            【4】交互开发-配置小程序
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#1_183" rel="nofollow">
              （1）产品展示页
             </a>
            </li>
            <li>
             <a href="#2_195" rel="nofollow">
              （2）快捷入口配置
             </a>
            </li>
            <li>
             <a href="#3_203" rel="nofollow">
              （3）编辑面板
             </a>
            </li>
            <li>
             <a href="#4_209" rel="nofollow">
              （4）产品页面
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#5_217" rel="nofollow">
            【5】设备调试-新建设备
           </a>
          </li>
          <li>
           <a href="#6APP_248" rel="nofollow">
            【6】配置手机APP
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#35__260" rel="nofollow">
          3.5 设备登录
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#1MQTT_262" rel="nofollow">
            【1】MQTT协议
           </a>
          </li>
          <li>
           <a href="#2MQTT_278" rel="nofollow">
            【2】获取MQTT登录参数
           </a>
          </li>
          <li>
           <a href="#3MQTT_347" rel="nofollow">
            【3】MQTT主题订阅与发布
           </a>
          </li>
          <li>
           <a href="#4_IP_389" rel="nofollow">
            【4】 物联网平台端口号与IP
           </a>
          </li>
          <li>
           <a href="#5_411" rel="nofollow">
            【5】模拟设备登录
           </a>
          </li>
          <li>
           <a href="#6_435" rel="nofollow">
            【6】腾讯连连微信小程序
           </a>
          </li>
         </ul>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_477" rel="nofollow">
        四、总结
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="_2">
     </a>
     一、前言
    </h2>
    <p>
     腾讯云物联网开发平台是一个标准的MQTT服务器。 这篇文章介绍如何利用
     <code>
      腾讯云物联网开发平台
     </code>
     创建自己的产品、设备、使用MQTT设备端登录服务器，完成数据上传，命令下发响应，以及开发微信小程序，完成一条龙的
     <code>
      物联网产品开发
     </code>
     。
    </p>
    <p>
     腾讯云物联网开发平台（IoT Explorer）为各行业的设备制造商、方案商及应用开发商提供一站式设备智能化服务。平台提供海量设备连接与管理能力及小程序应用开发能力，并打通腾讯云基础产品及 AI 能力，提升传统行业设备智能化的效率，降低用户的开发运维成本，助力用户业务发展。
    </p>
    <p>
     腾讯云物联网开发平台（IoT Explorer）是面向智慧生活与产业互联应用的物联网 PaaS 平台，为基于物联网的各行业设备制造商、方案商及应用开发商提供一站式设备智能化服务。平台提供海量设备连接与管理能力及基于腾讯连连的小程序应用开发能力，并打通腾讯云基础产品及 AI 能力，聚合腾讯生态内容能力。从而提升传统行业设备智能化的效率，降低用户的开发运维成本。
    </p>
    <h2>
     <a id="_14">
     </a>
     二、设计需求
    </h2>
    <p>
     当前以
     <code>
      环境检测
     </code>
     项目为原型，从0开始介绍使用
     <code>
      腾讯云物联网开发平台
     </code>
     完成自己物联网产品模型搭建，微信小程序开发，与设备实现通讯，完成数据上传、命令下发等功能。 实现一个正常的物联网产品的开发流程。
    </p>
    <h2>
     <a id="_22">
     </a>
     三、腾讯云平台与微信小程序设计
    </h2>
    <h3>
     <a id="31__24">
     </a>
     3.1 登录云平台
    </h3>
    <p>
     地址：https://cloud.tencent.com/
    </p>
    <h4>
     <a id="1_28">
     </a>
     【1】选择物联网平台
    </h4>
    <p>
     微信扫描即可快速登录，然后选择产品，物联网，选择物联网开发平台。
    </p>
    <p>
     <img alt="image-20230214150512203" src="https://i-blog.csdnimg.cn/blog_migrate/ec64d5e88bbd500d0257d70ad34b559b.png"/>
    </p>
    <h4>
     <a id="2_36">
     </a>
     【2】进入产品控制台
    </h4>
    <p>
     链接： https://console.cloud.tencent.com/iotexplorer
    </p>
    <p>
     <img alt="image-20230214150829922" src="https://i-blog.csdnimg.cn/blog_migrate/1a3185051d69dbf8fad650334d1f3cb9.png"/>
    </p>
    <h4>
     <a id="3_44">
     </a>
     【3】选择公共实例
    </h4>
    <p>
     <img alt="image-20230214151152916" src="https://i-blog.csdnimg.cn/blog_migrate/9dcb21310f6e239d8ed16d2fa1162fbd.png"/>
    </p>
    <h3>
     <a id="32__52">
     </a>
     3.2 新建项目
    </h3>
    <h4>
     <a id="1_54">
     </a>
     【1】新建项目
    </h4>
    <p>
     <img alt="image-20230214152509611" src="https://i-blog.csdnimg.cn/blog_migrate/d02b072b4eff10152209c301a9e0f25a.png"/>
    </p>
    <h4>
     <a id="2_60">
     </a>
     【2】填写项目名称
    </h4>
    <p>
     <img alt="image-20230221134920547" src="https://i-blog.csdnimg.cn/blog_migrate/ebec37f3f880823cbdaf963cc8b1d708.png"/>
    </p>
    <h4>
     <a id="3_64">
     </a>
     【3】项目创建完成
    </h4>
    <p>
     <img alt="image-20230221134952139" src="https://i-blog.csdnimg.cn/blog_migrate/56736369ff9d699385309861c4a39ea0.png"/>
    </p>
    <h3>
     <a id="33__70">
     </a>
     3.3 产品开发
    </h3>
    <h4>
     <a id="1_72">
     </a>
     【1】进入产品页
    </h4>
    <p>
     点击项目名称，进入产品开发页面。
    </p>
    <p>
     <img alt="image-20230221135007711" src="https://i-blog.csdnimg.cn/blog_migrate/be495daf0baa6043d05c22c0eea9c70c.png"/>
    </p>
    <h4>
     <a id="2_80">
     </a>
     【2】新建产品
    </h4>
    <p>
     <img alt="image-20230214152856439" src="https://i-blog.csdnimg.cn/blog_migrate/f0fcc655a16392c96ceafd4296f6ab1f.png"/>
    </p>
    <h4>
     <a id="3_86">
     </a>
     【3】填写产品信息
    </h4>
    <p>
     产品品类选择
     <code>
      自定义产品品类
     </code>
     。
    </p>
    <p>
     <img alt="image-20230221135057620" src="https://i-blog.csdnimg.cn/blog_migrate/3c7b5e8c4f2ab3fc7e8b59aa21a9cd92.png"/>
    </p>
    <h4>
     <a id="4_94">
     </a>
     【4】产品创建完成
    </h4>
    <p>
     <img alt="image-20230221135114752" src="https://i-blog.csdnimg.cn/blog_migrate/a6e7731d5759b1010575a23773dc618c.png"/>
    </p>
    <h3>
     <a id="34__100">
     </a>
     3.4 设备开发
    </h3>
    <h4>
     <a id="1_102">
     </a>
     【1】进入设备配置页
    </h4>
    <p>
     点击产品名称，进入设备配置页面。
    </p>
    <p>
     <img alt="image-20230221135135589" src="https://i-blog.csdnimg.cn/blog_migrate/7169e8d94132e7fe439c5eaad0593d65.png"/>
    </p>
    <h4>
     <a id="2_110">
     </a>
     【2】配置物模型
    </h4>
    <p>
     选择自定义品类。
    </p>
    <p>
     <img alt="image-20230221135202626" src="https://i-blog.csdnimg.cn/blog_migrate/a02007f11ecfb786d353a28450e1ad1a.png"/>
    </p>
    <h5>
     <a id="1MQ2_118">
     </a>
     （1）MQ2烟雾浓度
    </h5>
    <p>
     <img alt="image-20230221135327636" src="https://i-blog.csdnimg.cn/blog_migrate/9acad38c5ca306e4fd039cd6c19b971e.png"/>
    </p>
    <h5>
     <a id="2MQ135_124">
     </a>
     （2）MQ135空气质量
    </h5>
    <p>
     <img alt="image-20230221141933515" src="https://i-blog.csdnimg.cn/blog_migrate/76a8bcc88c806d45f44692efc7d69e19.png"/>
    </p>
    <h5>
     <a id="3MQ4_130">
     </a>
     （3）MQ4有毒气体
    </h5>
    <p>
     <img alt="image-20230221135431329" src="https://i-blog.csdnimg.cn/blog_migrate/ef2cc4a5dbe1e6e7cf3ed4e2fdefd42d.png"/>
    </p>
    <h5>
     <a id="4MQ7_136">
     </a>
     （4）MQ7一氧化碳
    </h5>
    <p>
     <img alt="image-20230221135455326" src="https://i-blog.csdnimg.cn/blog_migrate/e9bd12d2a40e99e3ccb8003a03e77845.png"/>
    </p>
    <h5>
     <a id="5_142">
     </a>
     （5）环境温度
    </h5>
    <p>
     <img alt="image-20230221135519170" src="https://i-blog.csdnimg.cn/blog_migrate/ffba7f87cd3641a5d7fd77b26f04fe7d.png"/>
    </p>
    <h5>
     <a id="6_148">
     </a>
     （6）环境湿度
    </h5>
    <p>
     <img alt="image-20230221135537391" src="https://i-blog.csdnimg.cn/blog_migrate/7e75c686dfd6874ec58fa768c6377067.png"/>
    </p>
    <h5>
     <a id="6_154">
     </a>
     （6）添加完成
    </h5>
    <p>
     <img alt="image-20230221141904759" src="https://i-blog.csdnimg.cn/blog_migrate/c1030096d4e7db5e9689f26c14222a58.png"/>
    </p>
    <p>
     然后翻到最下面，点击下一步。
    </p>
    <h4>
     <a id="3_164">
     </a>
     【3】设备开发-主题列表
    </h4>
    <p>
     设备开发页面有一个主题列表。可以了解到当前的主题信息。
    </p>
    <p>
     <img alt="image-20230221135613135" src="https://i-blog.csdnimg.cn/blog_migrate/6d8e8169c971e90221f3ec2258d71537.png"/>
    </p>
    <pre><code class="prism language-cpp">$thing<span class="token operator">/</span>up<span class="token operator">/</span>property<span class="token operator">/</span>CS0SLTKSYA<span class="token operator">/</span>$<span class="token punctuation">{<!-- --></span>deviceName<span class="token punctuation">}</span>	   发布	属性上报
$thing<span class="token operator">/</span>down<span class="token operator">/</span>property<span class="token operator">/</span>CS0SLTKSYA<span class="token operator">/</span>$<span class="token punctuation">{<!-- --></span>deviceName<span class="token punctuation">}</span>	订阅	属性下发与属性上报响应
</code></pre>
    <p>
     这个页面不需要做什么，直接点击下一步即可。
    </p>
    <p>
     <img alt="image-20230221135655844" src="https://i-blog.csdnimg.cn/blog_migrate/dca57081e8c1327969ed3e70481c2c99.png"/>
    </p>
    <h4>
     <a id="4_181">
     </a>
     【4】交互开发-配置小程序
    </h4>
    <h5>
     <a id="1_183">
     </a>
     （1）产品展示页
    </h5>
    <p>
     <img alt="image-20230214164020963" src="https://i-blog.csdnimg.cn/blog_migrate/bb3cd6cb2c17e0adc730081d43c11d14.png"/>
    </p>
    <p>
     <strong>
      设置信息：
     </strong>
    </p>
    <p>
     <img alt="image-20230221135728946" src="https://i-blog.csdnimg.cn/blog_migrate/3d73c5601a7cd0b909ced3071059c2ba.png"/>
    </p>
    <h5>
     <a id="2_195">
     </a>
     （2）快捷入口配置
    </h5>
    <p>
     <img alt="image-20230214165631798" src="https://i-blog.csdnimg.cn/blog_migrate/e216897437186f1d3e28c38c5dc57ce5.png"/>
    </p>
    <p>
     <img alt="image-20230221135806342" src="https://i-blog.csdnimg.cn/blog_migrate/475924da61b64a9ffb66157e82fef5b5.png"/>
    </p>
    <h5>
     <a id="3_203">
     </a>
     （3）编辑面板
    </h5>
    <p>
     <img alt="image-20230221140149316" src="https://i-blog.csdnimg.cn/blog_migrate/cf1917a2d97009282e24b422e715a77c.png"/>
    </p>
    <h5>
     <a id="4_209">
     </a>
     （4）产品页面
    </h5>
    <p>
     <img alt="image-20230214170637213" src="https://i-blog.csdnimg.cn/blog_migrate/75b78d0df231b4ae6ada23b78a8f85a3.png"/>
    </p>
    <p>
     <img alt="image-20230221140214020" src="https://i-blog.csdnimg.cn/blog_migrate/fde8088d5ce3c9b3621e59136f97bc06.png"/>
    </p>
    <h4>
     <a id="5_217">
     </a>
     【5】设备调试-新建设备
    </h4>
    <p>
     <img alt="image-20230221140235679" src="https://i-blog.csdnimg.cn/blog_migrate/6a7500694475531518d28551cb9cd500.png"/>
    </p>
    <p>
     <img alt="image-20230221140247828" src="https://i-blog.csdnimg.cn/blog_migrate/58c7b7f710712279b2c85b0e498c599d.png"/>
    </p>
    <p>
     创建完成。
    </p>
    <p>
     <img alt="image-20230221140257647" src="https://i-blog.csdnimg.cn/blog_migrate/219de62a0a7c3f115a9d93e44d9c4ec7.png"/>
    </p>
    <p>
     设备的二维码： （打开微信小程序，搜索
     <code>
      腾讯连连
     </code>
     ，打开腾讯连连，扫描下面的二维码就可以绑定设备了）
    </p>
    <p>
     <img alt="image-20230221140309880" src="https://i-blog.csdnimg.cn/blog_migrate/b00ea74b621d4bdc8e53855a2c48282b.png"/>
    </p>
    <p>
     设备信息：
    </p>
    <p>
     <img alt="image-20230221140326972" src="https://i-blog.csdnimg.cn/blog_migrate/2524cb2d1eaf9a990e88e1081d8d1799.png"/>
    </p>
    <pre><code class="prism language-cpp">产品密匙：IyXmUW5sU<span class="token operator">/</span>q1vnb5yzTkeQ<span class="token operator">==</span>
产品ID：CS0SLTKSYA
</code></pre>
    <h4>
     <a id="6APP_248">
     </a>
     【6】配置手机APP
    </h4>
    <p>
     如果除了小程序之外，还想使用手机APP，可以配置手机APP页面。
    </p>
    <p>
     <img alt="image-20230214180051423" src="https://i-blog.csdnimg.cn/blog_migrate/c6009469a0a0899bc3970f1b3737bff6.png"/>
    </p>
    <p>
     配置步骤和上面的微信程序一样。
    </p>
    <h3>
     <a id="35__260">
     </a>
     3.5 设备登录
    </h3>
    <h4>
     <a id="1MQTT_262">
     </a>
     【1】MQTT协议
    </h4>
    <p>
     MQTT协议介绍：https://mcxiaoke.gitbooks.io/mqtt-cn/content/mqtt/01-Introduction.html
    </p>
    <pre><code class="prism language-cpp">目前物联网通信支持 MQTT 标准协议接入<span class="token punctuation">(</span>兼容<span class="token number">3.1</span><span class="token punctuation">.</span><span class="token number">1</span>版本协议<span class="token punctuation">)</span>，具体的协议请参见 MQTT <span class="token number">3.1</span><span class="token punctuation">.</span><span class="token number">1</span> 协议文档。
和标准 MQTT 区别

<span class="token number">1.</span> 支持 MQTT 的 PUB、SUB、PING、PONG、CONNECT、DISCONNECT、UNSUB 等报文。
<span class="token number">2.</span> 支持 cleanSession。
<span class="token number">3.</span> 不支持 will、retain msg。
<span class="token number">4.</span> 不支持 QOS2。
</code></pre>
    <h4>
     <a id="2MQTT_278">
     </a>
     【2】获取MQTT登录参数
    </h4>
    <p>
     就像我们登录QQ、登录微信需要账号密码一样，设备登录物联网平台也需要类似的东西。
    </p>
    <p>
     官方文档地址： https://cloud.tencent.com/document/product/634/32546
    </p>
    <p>
     <strong>
      生成密匙直接使用python代码获取：
     </strong>
    </p>
    <pre><code class="prism language-cpp">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>python
# <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span> coding<span class="token operator">:</span> UTF<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span>
<span class="token keyword">import</span> <span class="token module">base64</span>
<span class="token keyword">import</span> <span class="token module">hashlib</span>
<span class="token keyword">import</span> <span class="token module">hmac</span>
<span class="token keyword">import</span> <span class="token module">random</span>
<span class="token keyword">import</span> <span class="token module">string</span>
<span class="token keyword">import</span> <span class="token module">time</span>
<span class="token keyword">import</span> <span class="token module">sys</span>
# 生成指定长度的随机字符串
def <span class="token function">RandomConnid</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">return</span>  <span class="token char">''</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span><span class="token function">choice</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span>ascii_uppercase <span class="token operator">+</span> string<span class="token punctuation">.</span>digits<span class="token punctuation">)</span> <span class="token keyword">for</span> _ in <span class="token function">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>
# 生成接入物联网通信平台需要的各参数
def <span class="token function">IotHmac</span><span class="token punctuation">(</span>productID<span class="token punctuation">,</span> devicename<span class="token punctuation">,</span> devicePsk<span class="token punctuation">)</span><span class="token operator">:</span>
     # <span class="token number">1.</span> 生成 connid 为一个随机字符串，方便后台定位问题
     connid   <span class="token operator">=</span> <span class="token function">RandomConnid</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
     # <span class="token number">2.</span> 生成过期时间，表示签名的过期时间<span class="token punctuation">,</span>从纪元<span class="token number">1970</span>年<span class="token number">1</span>月<span class="token number">1</span>日 <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> UTC 时间至今秒数的 UTF8 字符串
     expiry   <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">30</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span><span class="token number">365</span>
     # <span class="token number">3.</span> 生成 MQTT 的 clientid 部分<span class="token punctuation">,</span> 格式为 $<span class="token punctuation">{<!-- --></span>productid<span class="token punctuation">}</span>$<span class="token punctuation">{<!-- --></span>devicename<span class="token punctuation">}</span>
     clientid <span class="token operator">=</span> <span class="token string">"{}{}"</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>productID<span class="token punctuation">,</span> devicename<span class="token punctuation">)</span>
     # <span class="token number">4.</span> 生成 MQTT 的 username 部分<span class="token punctuation">,</span> 格式为 $<span class="token punctuation">{<!-- --></span>clientid<span class="token punctuation">}</span><span class="token punctuation">;</span>$<span class="token punctuation">{<!-- --></span>sdkappid<span class="token punctuation">}</span><span class="token punctuation">;</span>$<span class="token punctuation">{<!-- --></span>connid<span class="token punctuation">}</span><span class="token punctuation">;</span>$<span class="token punctuation">{<!-- --></span>expiry<span class="token punctuation">}</span>
     username <span class="token operator">=</span> <span class="token string">"{};12010126;{};{}"</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>clientid<span class="token punctuation">,</span> connid<span class="token punctuation">,</span> expiry<span class="token punctuation">)</span>
     # <span class="token number">5.</span> 对 username 进行签名，生成token
     secret_key <span class="token operator">=</span> devicePsk<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token char">'utf-8'</span><span class="token punctuation">)</span>  # convert to bytes
     data_to_sign <span class="token operator">=</span> username<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token char">'utf-8'</span><span class="token punctuation">)</span>  # convert to bytes
     secret_key <span class="token operator">=</span> base64<span class="token punctuation">.</span><span class="token function">b64decode</span><span class="token punctuation">(</span>secret_key<span class="token punctuation">)</span>  # <span class="token keyword">this</span> is still bytes
     token <span class="token operator">=</span> hmac<span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>secret_key<span class="token punctuation">,</span> data_to_sign<span class="token punctuation">,</span> digestmod<span class="token operator">=</span>hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hexdigest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     # <span class="token number">6.</span> 根据物联网通信平台规则生成 password 字段
     password <span class="token operator">=</span> <span class="token string">"{};{}"</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token string">"hmacsha256"</span><span class="token punctuation">)</span>
     <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"clientid"</span> <span class="token operator">:</span> clientid<span class="token punctuation">,</span>
        <span class="token string">"username"</span> <span class="token operator">:</span> username<span class="token punctuation">,</span>
        <span class="token string">"password"</span> <span class="token operator">:</span> password
     <span class="token punctuation">}</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token char">'__main__'</span><span class="token operator">:</span>
    # 参数分别填入<span class="token operator">:</span> 产品ID<span class="token punctuation">,</span>设备名称<span class="token punctuation">,</span>设备密匙
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">IotHmac</span><span class="token punctuation">(</span><span class="token string">"CS0SLTKSYA"</span><span class="token punctuation">,</span><span class="token string">"dev1"</span><span class="token punctuation">,</span><span class="token string">"IyXmUW5sU/q1vnb5yzTkeQ=="</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	
</code></pre>
    <p>
     <strong>
      上面python的代码需要填入的参数从下面截图里获取：
     </strong>
    </p>
    <p>
     <img alt="image-20230221140657179" src="https://i-blog.csdnimg.cn/blog_migrate/62fe47febbd408eac16470d7551b3525.png"/>
    </p>
    <p>
     <strong>
      运行得到的结果：
     </strong>
    </p>
    <p>
     <img alt="image-20230221140821203" src="https://i-blog.csdnimg.cn/blog_migrate/5e96c19d12ac9cb734bc72044bf02dae.png"/>
    </p>
    <pre><code>clientid CS0SLTKSYAdev1
username CS0SLTKSYAdev1;12010126;ZR5GT;2623045740
password 2debdc61b009ef8d09597f106f6f8ca36f101415459b0623780a81e711e7257c;hmacsha256
</code></pre>
    <h4>
     <a id="3MQTT_347">
     </a>
     【3】MQTT主题订阅与发布
    </h4>
    <p>
     <img alt="image-20230221141031020" src="https://i-blog.csdnimg.cn/blog_migrate/3b0fcc9af31c8ce47a66d2dc4936dc49.png"/>
    </p>
    <p>
     如果设备端想要得到APP页面的按钮状态就需要订阅属性下发和属性上报的响应，主题格式就是这样的：
    </p>
    <p>
     <strong>
      主题订阅：
     </strong>
    </p>
    <pre><code class="prism language-cpp">$thing<span class="token operator">/</span>down<span class="token operator">/</span>property<span class="token operator">/</span>CS0SLTKSYA<span class="token operator">/</span>dev1
</code></pre>
    <p>
     <strong>
      主题发布：
     </strong>
    </p>
    <pre><code class="prism language-cpp">$thing<span class="token operator">/</span>up<span class="token operator">/</span>property<span class="token operator">/</span>CS0SLTKSYA<span class="token operator">/</span>dev1
</code></pre>
    <p>
     <strong>
      设备端向APP页面上报属性时，需要上传具体的数据，数据流的格式如下：
     </strong>
    </p>
    <p>
     官方文档: https://cloud.tencent.com/document/product/1081/34916
    </p>
    <p>
     <strong>
      比如：我的设备里有MQ2、MQ4、MQ7、MQ135、温度、湿度参数信息。
     </strong>
    </p>
    <p>
     上传的格式如下。
    </p>
    <pre><code class="prism language-cpp"><span class="token punctuation">{<!-- --></span><span class="token string">"method"</span><span class="token operator">:</span><span class="token string">"report"</span><span class="token punctuation">,</span><span class="token string">"clientToken"</span><span class="token operator">:</span><span class="token string">"123"</span><span class="token punctuation">,</span><span class="token string">"params"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token string">"MQ2"</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token string">"MQ135"</span><span class="token operator">:</span><span class="token number">95</span><span class="token punctuation">,</span><span class="token string">"MQ4"</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token string">"MQ7"</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">"DHT11_T"</span><span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token string">"DHT11_H"</span><span class="token operator">:</span><span class="token number">70</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="image-20230221141841039" src="https://i-blog.csdnimg.cn/blog_migrate/ac64cfb4e37f05addc5a6371c86e06ee.png"/>
    </p>
    <h4>
     <a id="4_IP_389">
     </a>
     【4】 物联网平台端口号与IP
    </h4>
    <p>
     官方文档: https://cloud.tencent.com/document/product/634/32546
    </p>
    <p>
     <img alt="image-20230214173705710" src="https://i-blog.csdnimg.cn/blog_migrate/28ebb2a0521280e4e1a5441838b5c878.png"/>
    </p>
    <p>
     域名格式：&lt;产品ID&gt;.iotcloud.tencentdevices.com
    </p>
    <pre><code class="prism language-cpp">CS0SLTKSYA<span class="token punctuation">.</span>iotcloud<span class="token punctuation">.</span>tencentdevices<span class="token punctuation">.</span>com
</code></pre>
    <p>
     <img alt="image-20230221141430236" src="https://i-blog.csdnimg.cn/blog_migrate/490a17d7d1a9283bc55c0c410cd82fe0.png"/>
    </p>
    <p>
     **得到域名对应的IP地址： **
     <code>
      175.178.30.200
     </code>
    </p>
    <p>
     <img alt="image-20230221141458089" src="https://i-blog.csdnimg.cn/blog_migrate/9ffd7504e338290e3bd5fedf0f0e764b.png"/>
    </p>
    <h4>
     <a id="5_411">
     </a>
     【5】模拟设备登录
    </h4>
    <p>
     为了方便测试，先使用MQTT客户端软件模拟硬件设备登录服务器。
    </p>
    <p>
     依次填入参数之后，
     <strong>
      点击订阅主题、发布主题。
     </strong>
    </p>
    <p>
     <img alt="image-20230221141958628" src="https://i-blog.csdnimg.cn/blog_migrate/e6adfd831d18f049bd73579b9fc90074.png"/>
    </p>
    <p>
     <strong>
      在设备调试页面，可以看到设备已经在线了：
     </strong>
    </p>
    <p>
     <img alt="image-20230221142020570" src="https://i-blog.csdnimg.cn/blog_migrate/cc3c3bd796b01342ac87ba943f7abe2d.png"/>
    </p>
    <p>
     <strong>
      打开设备页面，就能看到设备上传的数据：
     </strong>
    </p>
    <p>
     <img alt="image-20230221142044589" src="https://i-blog.csdnimg.cn/blog_migrate/1eebdaf16ec258c62f0da281e5c6d918.png"/>
    </p>
    <h4>
     <a id="6_435">
     </a>
     【6】腾讯连连微信小程序
    </h4>
    <p>
     打开
     <code>
      腾讯连连微信
     </code>
     小程序绑定设备，就可以看到设备的数据了。
    </p>
    <p>
     <strong>
      步骤如下：
     </strong>
    </p>
    <p>
     打开微信，找到小程序。
    </p>
    <p>
     <img alt="image-20230221142431199" src="https://i-blog.csdnimg.cn/blog_migrate/a0694b152418592919a13137d98afe43.png"/>
    </p>
    <p>
     右上角搜索，腾讯连接。
    </p>
    <p>
     <img alt="image-20230221142511430" src="https://i-blog.csdnimg.cn/blog_migrate/112282a6911fa90b90f7b5309ae4e861.png"/>
    </p>
    <p>
     然后打开腾讯连连，添加设备，扫描设备的二维码。
    </p>
    <p>
     <img alt="image-20230221142534169" src="https://i-blog.csdnimg.cn/blog_migrate/48faf18c3557f08f1ee49d2c3f4a04dd.png"/>
    </p>
    <p>
     添加成功。
    </p>
    <p>
     <img alt="image-20230221142612317" src="https://i-blog.csdnimg.cn/blog_migrate/5c9fc8e9d4c5c3f6bd0285de0e70b2c8.png"/>
    </p>
    <p>
     <strong>
      看到的信息：
     </strong>
    </p>
    <p>
     <img alt="image-20230221142629781" src="https://i-blog.csdnimg.cn/blog_migrate/208c7addef72591393126f9a983a145d.png"/>
    </p>
    <p>
     到此，腾讯物联网云平台部署完成。
    </p>
    <h2>
     <a id="_477">
     </a>
     四、总结
    </h2>
    <p>
     到此，我们的
     <code>
      腾讯云IOT平台
     </code>
     的云端开发完成了。如果大家详细阅读了文章，并且跟着步骤操作了一次，相信你此刻对
     <code>
      腾讯云IOT平台
     </code>
     应该有所认识了。我是
     <code>
      DS小龙哥
     </code>
     ，欢迎关注我，后续会有更多的技术文章、项目文章发布。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e637364:6e2e6e65742f7869616f6c6f6e67313132363632363439372f:61727469636c652f64657461696c732f313334373539383238" class_="artid" style="display:none">
 </p>
</div>


