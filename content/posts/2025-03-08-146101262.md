---
layout: post
title: "如何在Ubuntu上直接编译Apache-Doris"
date: 2025-03-08 08:08:18 +0800
description: "linux环境编译Doris"
keywords: "如何在Ubuntu上直接编译Apache Doris"
categories: ['Doris']
tags: ['Doris']
artid: "146101262"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146101262
    alt: "如何在Ubuntu上直接编译Apache-Doris"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146101262
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146101262
cover: https://bing.ee123.net/img/rand?artid=146101262
image: https://bing.ee123.net/img/rand?artid=146101262
img: https://bing.ee123.net/img/rand?artid=146101262
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     如何在Ubuntu上直接编译Apache Doris
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-dracula" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     以下是在
     <strong>
      Ubuntu 22.04
     </strong>
     上直接编译
     <strong>
      Apache Doris
     </strong>
     的完整流程，综合多个版本和环境的最佳实践：
    </p>
    <hr/>
    <h4>
     <a id="UbuntuVMware20G50G_3">
     </a>
     注意：Ubuntu的数据盘VMware默认是20G，编译不够用，给到50G以上吧
    </h4>
    <h4>
     <a id="_4">
     </a>
     <strong>
      一、环境准备
     </strong>
    </h4>
    <h5>
     <a id="1__5">
     </a>
     <strong>
      1. 安装系统依赖
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 基础构建工具链</span>
<span class="token function">apt</span> <span class="token function">install</span> <span class="token function">vim</span> <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> openssh-server <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> build-essential <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> openjdk-8-jdk <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> maven <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> cmake <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> byacc <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> flex <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> automake <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> libtool-bin <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> bison <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> binutils-dev <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> libiberty-dev <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> <span class="token function">zip</span> <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> <span class="token function">unzip</span> <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> libncurses5-dev <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> <span class="token function">curl</span> <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> <span class="token function">git</span> <span class="token parameter variable">-y</span>
<span class="token function">apt</span> <span class="token function">install</span> ninja-build <span class="token parameter variable">-y</span>
<span class="token comment"># 采坑：我的系统默认装完后/usr/bin下只有python2和python3，需要手动ln -s /usr/bin/python2 /usr/bin/python</span>
<span class="token function">apt</span> <span class="token function">install</span> python <span class="token parameter variable">-y</span>
<span class="token comment"># 到了build.sh编译报错采坑，才知道还要装clang</span>
<span class="token function">apt</span> <span class="token function">install</span> clang <span class="token parameter variable">-y</span>
add-apt-repository ppa:ubuntu-toolchain-r/ppa
<span class="token function">apt</span> update
<span class="token function">apt</span> <span class="token function">install</span> gcc-10 g++-10 <span class="token parameter variable">-y</span>
<span class="token function">apt-get</span> <span class="token function">install</span> autoconf automake libtool autopoint <span class="token parameter variable">-y</span>
<span class="token comment"># python装完后，需要手动软连接下默认版本2</span>
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/bin/python2 /usr/bin/python
</code></pre>
    <h5>
     <a id="2__39">
     </a>
     <strong>
      2. 调整系统参数
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 修改最大文件句柄数（避免 BE 启动失败）</span>
<span class="token function">sudo</span> <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">'echo "* soft nofile 65536" &gt;&gt; /etc/security/limits.conf'</span>
<span class="token function">sudo</span> <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">'echo "* hard nofile 65536" &gt;&gt; /etc/security/limits.conf'</span>
<span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-n</span> <span class="token number">65536</span>  <span class="token comment"># 临时生效</span>

<span class="token comment"># 调整虚拟内存映射限制</span>
<span class="token function">sudo</span> <span class="token function">sysctl</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">vm.max_map_count</span><span class="token operator">=</span><span class="token number">2000000</span>
<span class="token function">sudo</span> <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">'echo "vm.max_map_count=2000000" &gt;&gt; /etc/sysctl.conf'</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_53">
     </a>
     <strong>
      二、源码获取与配置
     </strong>
    </h4>
    <h5>
     <a id="1__54">
     </a>
     <strong>
      1. 克隆源码
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># github或者官网下载源码都行：https://doris.apache.org/download/</span>
<span class="token function">git</span> clone https://github.com/apache/doris.git
<span class="token comment"># 浏览器下载：https://downloads.apache.org/doris/2.1/2.1.8.1/apache-doris-2.1.8.1-src.tar.gz</span>
<span class="token builtin class-name">cd</span> doris
</code></pre>
    <h5>
     <a id="2__61">
     </a>
     <strong>
      2. 统一下载第三方包，本机公网下载
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token function">wget</span> https://github.com/apache/doris-thirdparty/releases/download/automation/doris-thirdparty-source.tgz
<span class="token comment"># 采坑：上边的包默认还少2个包，需要单独下载：</span>
<span class="token function">wget</span> https://github.com/apache/doris-thirdparty/archive/refs/tags/hadoop-3.3.6.3-for-doris.tar.gz
<span class="token function">wget</span> https://github.com/intel/hyperscan/archive/refs/tags/v5.4.2.tar.gz
<span class="token comment"># doris-thirdparty-hadoop-3.3.6.3-for-doris.tar.gz需要mv改名为hadoop-3.3.6.3-for-doris.tar.gz</span>
</code></pre>
    <p>
     <strong>
      将上面的包解压后，会生成一个src目录，下面放得所有3方依赖的gz包，cp到${doris_home}/thirdparty/src/下面
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> doris-thirdparty-source.tgz
<span class="token function">mv</span> src/* <span class="token variable">${DORIS_HOME}</span>/thirdparty/
<span class="token comment"># 注意：不要漏了上面采坑的两个gz包：\</span>
<span class="token comment"># hadoop-3.3.6.3-for-doris.tar.gz和hyperscan-5.4.2.tar.gz</span>
</code></pre>
    <h5>
     <a id="3_java_78">
     </a>
     <strong>
      3. 配置java编译环境（如若没有）
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 设置 Java 环境变量（根据实际路径调整），Doris2.X需要jdk1.8，master版本需要jdk17+</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/lib/jvm/java-8-openjdk-amd64
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span>
exprot <span class="token assign-left variable">DORIS_HOME</span><span class="token operator">=</span><span class="token variable">${doris_home：默认你的doris下载包的路径}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_88">
     </a>
     <strong>
      三、编译流程
     </strong>
    </h4>
    <h5>
     <a id="1_GitHub2_89">
     </a>
     <strong>
      1. 编译第三方依赖，依赖从GitHub上下载三方包，二.2操作后，忽略下面步骤
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 如果已经离线下载，这步不需要执行</span>
<span class="token builtin class-name">cd</span> <span class="token variable">${doris_home}</span>/thirdparty
./build-thirdparty.sh  <span class="token comment"># 自动下载并编译 gflags/glog 等依赖</span>
</code></pre>
    <h5>
     <a id="2__Doris__96">
     </a>
     <strong>
      2. 编译 Doris 核心组件
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> <span class="token variable">${doris_home}</span>
<span class="token comment"># 支持 AVX2 的机器（默认）</span>
<span class="token comment"># sh build.sh --clean --be --fe  # 首次编译建议加 --clean</span>
<span class="token comment"># 上面步骤采坑，如果用的操作系统是Ubuntu，执行build.sh使用bash，不然报错</span>
<span class="token comment"># 编译这一步预计得个几十分钟，主要看编译机器的配置</span>
<span class="token function">bash</span> build.sh

<span class="token comment"># 不支持 AVX2 的机器（如虚拟机）</span>
<span class="token assign-left variable">USE_AVX2</span><span class="token operator">=</span><span class="token number">0</span> <span class="token function">sh</span> build.sh <span class="token parameter variable">--be</span> <span class="token parameter variable">--fe</span>
</code></pre>
    <h5>
     <a id="3__109">
     </a>
     <strong>
      3. 编译输出
     </strong>
    </h5>
    <p>
     •
     <strong>
      编译产物
     </strong>
     ：位于
     <code>
      output/
     </code>
     目录，包含
     <code>
      be
     </code>
     、
     <code>
      fe
     </code>
     、
     <code>
      udf
     </code>
     等子目录
     <br/>
     •
     <strong>
      部署文件
     </strong>
     ：可直接将
     <code>
      output
     </code>
     目录拷贝到生产环境使用
    </p>
    <hr/>
    <h4>
     <a id="_115">
     </a>
     <strong>
      四、安装与启动
     </strong>
    </h4>
    <h5>
     <a id="1_FE__116">
     </a>
     <strong>
      1. FE 配置与启动
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 修改配置文件 fe/conf/fe.conf</span>
meta_dir <span class="token operator">=</span> /opt/doris/fe/meta  <span class="token comment"># 元数据存储路径</span>
priority_networks <span class="token operator">=</span> <span class="token number">192.168</span>.1.0/24  <span class="token comment"># 绑定 IP 段</span>

<span class="token comment"># 启动 FE（需提前创建元数据目录）</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /opt/doris/fe/meta
./output/fe/bin/start_fe.sh <span class="token parameter variable">--daemon</span>
</code></pre>
    <h5>
     <a id="2_BE__127">
     </a>
     <strong>
      2. BE 配置与启动
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 修改配置文件 be/conf/be.conf</span>
storage_root_path <span class="token operator">=</span> /opt/doris/be/storage  <span class="token comment"># 数据存储路径</span>

<span class="token comment"># 启动 BE</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /opt/doris/be/storage
./output/be/bin/start_be.sh <span class="token parameter variable">--daemon</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_139">
     </a>
     <strong>
      五、验证与调试
     </strong>
    </h4>
    <h5>
     <a id="1__140">
     </a>
     <strong>
      1. 检查服务状态
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 查看 FE 日志</span>
<span class="token function">tail</span> <span class="token parameter variable">-f</span> output/fe/log/fe.log

<span class="token comment"># 查看 BE 日志</span>
<span class="token function">tail</span> <span class="token parameter variable">-f</span> output/be/log/be.out
</code></pre>
    <h5>
     <a id="2__MySQL__149">
     </a>
     <strong>
      2. 通过 MySQL 客户端连接
     </strong>
    </h5>
    <pre><code class="prism language-bash">mysql <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-P</span> <span class="token number">9030</span> <span class="token parameter variable">-uroot</span>  <span class="token comment"># 默认无密码</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_156">
     </a>
     <strong>
      六、常见问题解决
     </strong>
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        编译失败：protobuf 版本冲突
       </strong>
       <br/>
       手动安装 Protocol Buffers 3.21.12 并更新动态链接库：
      </p>
      <pre><code class="prism language-bash"><span class="token function">wget</span> https://github.com/protocolbuffers/protobuf/releases/download/v3.21.12/protobuf-3.21.12.tar.gz
<span class="token function">tar</span> zxvf protobuf-3.21.12.tar.gz <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> protobuf-3.21.12
./configure <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr/local <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> -j<span class="token variable"><span class="token variable">$(</span>nproc<span class="token variable">)</span></span> <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
<span class="token function">sudo</span> ldconfig
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        BE 启动报错：内存不足
       </strong>
       <br/>
       修改
       <code>
        be.conf
       </code>
       中的 JVM 参数：
      </p>
      <pre><code class="prism language-properties">JAVA_OPTS="-Xms4g -Xmx8g"  # 根据机器配置调整
</code></pre>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_174">
     </a>
     <strong>
      注意事项
     </strong>
    </h4>
    <p>
     •
     <strong>
      版本兼容性
     </strong>
     ：Doris 3.x 需 JDK17，低版本需降级至 JDK8
     <br/>
     •
     <strong>
      硬件要求
     </strong>
     ：生产环境建议 16GB+ 内存，SSD 存储
     <br/>
     •
     <strong>
      集群扩展
     </strong>
     ：通过
     <code>
      ALTER SYSTEM ADD BACKEND
     </code>
     添加更多 BE 节点
    </p>
    <p>
     以上步骤已覆盖 Ubuntu 直接编译的核心流程，如需 Docker 容器化编译，可参考
     <a href="https://doris.apache.org/docs/dev/install/build-source" rel="nofollow">
      官方镜像文档
     </a>
     。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e63:73646e2e6e65742f7a70665f3934303831303635333834322f:61727469636c652f64657461696c732f313436313031323632" class_="artid" style="display:none">
 </p>
</div>


