---
layout: post
title: "扩散模型中三种加入条件的方式Vanilla-Guidance,Classifier-Guidance-以及-Classifier-Free-Guidance"
date: 2025-03-08 22:18:22 +0800
description: "在生成过程中，模型从一个随机噪声开始，通过多次迭代去噪，最终生成有意义的数据，比如图像。这时候，如果需要生成特定类别的数据，比如生成猫的图像而不是狗的，就需要加入条件引导，控制生成的方向。这就是条件扩散模型的作用。而Classifier-Free Guidance则是在训练时，有时告诉模型生成猫，有时不告诉任何条件，然后在推理时通过调整条件和非条件的权重来加强条件的影响，比如让条件预测的权重更大，从而生成更符合要求的猫的图像。通过理解这三种方法的差异，可根据具体任务需求选择最适合的条件引导策略。"
keywords: "扩散模型中三种加入条件的方式：Vanilla Guidance，Classifier Guidance 以及 Classifier-Free Guidance"
categories: ['Models', 'Diffusion']
tags: ['计算机视觉', '深度学习', '机器学习']
artid: "146123857"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146123857
    alt: "扩散模型中三种加入条件的方式Vanilla-Guidance,Classifier-Guidance-以及-Classifier-Free-Guidance"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146123857
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146123857
cover: https://bing.ee123.net/img/rand?artid=146123857
image: https://bing.ee123.net/img/rand?artid=146123857
img: https://bing.ee123.net/img/rand?artid=146123857
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     扩散模型中三种加入条件的方式：Vanilla Guidance，Classifier Guidance 以及 Classifier-Free Guidance
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <strong>
      扩散模型
     </strong>
     主要包括两个过程：
     <code>
      前向扩散
     </code>
     过程和
     <code>
      反向去噪
     </code>
     过程。前向过程逐渐给数据添加噪声，直到数据变成纯噪声；反向过程则是学习如何从噪声中逐步恢复出原始数据。在生成过程中，模型从一个随机噪声开始，通过多次迭代去噪，最终生成有意义的数据，比如图像。这时候，如果需要生成特定类别的数据，比如生成猫的图像而不是狗的，就需要加入条件引导，控制生成的方向。这就是条件扩散模型的作用。
    </p>
    <hr/>
    <p>
     Vanilla Guidance、Classifier Guidance和Classifier-Free Guidance，是在反向过程中如何利用条件信息的不同策略:
    </p>
    <ol>
     <li>
      <strong>
       Vanilla Guidance
      </strong>
      : 指的是最基本的条件加入方式，也就是在模型训练时直接将条件信息（比如类别标签，时间标签）作为输入的一部分。例如，在UNet的结构中，除了输入噪声图像和时间步信息外，还会将条件向量拼接或嵌入到网络中，让模型在训练时学会根据条件生成对应的图像。这种方法可能的问题是需要大量带标签的数据，并且在推理时可以通过替换不同的条件来生成不同类别的图像。不过，可能控制的效果有限，或者需要更多的调整。
     </li>
     <li>
      <strong>
       Classifier Guidance
      </strong>
      ：这个方法是需要预训练一个分类器，在反向过程中利用分类器的梯度来调整生成的方向，使得生成的图像符合给定的条件。具体来说，在每一步去噪的时候，不仅根据扩散模型的预测去噪，还会计算分类器对当前中间图像的梯度，将梯度信息加入到噪声预测中，从而使得生成的图像在分类器看来属于目标类别。这种方法的好处是不需要在扩散模型本身中加入条件，而是通过外部分类器来引导生成，可能更加灵活。不过缺点是需要额外训练分类器，并且分类器需要在带噪声的数据上进行训练，因为扩散过程的中间结果是有噪声的，可能影响分类器的准确性。
     </li>
     <li>
      <strong>
       Classifier-Free Guidance
      </strong>
      ：不需要单独的分类器，而是通过训练时的条件和非条件生成来隐式地引导生成方向。具体来说，可能是在训练时随机地忽略条件信息（比如以一定概率将条件置空），让模型同时学习有条件生成和无条件生成。在推理时，通过调整条件和非条件预测的权重，来增强条件的影响。比如，将条件预测的结果和无条件预测的结果进行线性组合，从而在不需要外部分类器的情况下实现更强的条件控制。这种方法结合了两者的优点，既不需要额外的分类器，又能有效利用条件信息，但可能需要更大的模型或更复杂的训练策略。
     </li>
    </ol>
    <p>
     举个例子，假设我要生成一个带有“猫”标签的图像。
     <br/>
     Vanilla Guidance在训练时将“猫”的标签编码后输入到模型中，让模型在生成过程中始终考虑这个条件。
     <br/>
     Classifier Guidance则是在生成过程中，每一步都使用一个已经训练好的猫分类器，对中间图像计算梯度，调整生成方向。
     <br/>
     而Classifier-Free Guidance则是在训练时，有时告诉模型生成猫，有时不告诉任何条件，然后在推理时通过调整条件和非条件的权重来加强条件的影响，比如让条件预测的权重更大，从而生成更符合要求的猫的图像。
    </p>
    <p>
     总结：
    </p>
    <ul>
     <li>
      Vanilla Guidance：在模型训练时将条件信息作为输入，直接训练条件生成模型。生成时通过输入不同的条件来控制输出。但可能缺乏对条件的强引导，导致控制不够精准。
     </li>
     <li>
      Classifier Guidance：在反向过程中使用预训练的分类器梯度来调整生成方向，强化条件信号。需要额外训练分类器，并且分类器需要适应带噪声的输入，但能够更精确地控制生成结果。
     </li>
     <li>
      Classifier-Free Guidance：在训练时同时学习有条件和无条件生成，推理时通过组合两者的预测来增强条件效果。不需要外部分类器，通过模型自身的条件和非条件预测差异来引导生成，灵活性高，效果较好，但训练时需要更多的策略（如随机丢弃条件）。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="1_Vanilla_Guidance_24">
     </a>
     <strong>
      1. Vanilla Guidance（朴素引导）
     </strong>
    </h3>
    <ul>
     <li>
      <strong>
       核心思想
      </strong>
      ：在训练时直接将条件信息（如类别标签、文本描述）作为模型输入的一部分，通过端到端学习条件生成。
     </li>
     <li>
      <strong>
       实现方式
      </strong>
      ：
      <ul>
       <li>
        条件信息（如类别嵌入或文本编码）通过拼接、相加或多层感知机（MLP）注入到模型的每一层（如UNet的残差块中）。
       </li>
       <li>
        模型直接学习基于条件的噪声预测，无需额外引导机制。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       优点
      </strong>
      ：
      <ul>
       <li>
        实现简单，直接融入模型结构。
       </li>
       <li>
        推理时通过替换条件输入灵活控制生成内容。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       缺点
      </strong>
      ：
      <ul>
       <li>
        条件控制较弱，尤其在复杂任务（如细粒度文本生成图像）中可能生成与条件无关的结果。
       </li>
       <li>
        依赖大量带标注数据，且条件信息可能未被充分建模。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       典型应用
      </strong>
      ：早期的条件扩散模型（如DDPM的类别条件生成）。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="2_Classifier_Guidance_40">
     </a>
     <strong>
      2. Classifier Guidance（分类器引导）
     </strong>
    </h3>
    <ul>
     <li>
      <strong>
       核心思想
      </strong>
      ：利用预训练的分类器梯度，在反向去噪过程中调整生成方向，使输出符合目标条件。
     </li>
     <li>
      <strong>
       实现方式
      </strong>
      ：
      <ul>
       <li>
        <strong>
         训练阶段
        </strong>
        ：扩散模型可无条件训练，同时额外训练一个噪声鲁棒的分类器（适应各时间步的噪声数据）。
       </li>
       <li>
        <strong>
         推理阶段
        </strong>
        ：
        <ol>
         <li>
          在每一步去噪时，计算分类器对中间图像的条件概率梯度。
         </li>
         <li>
          将梯度信息加权后注入噪声预测：
          <br/>
          <span class="katex--display">
           <span class="katex-display">
            <span class="katex">
             <span class="katex-mathml">
              ϵ 
               
              
                θ 
               
              
             
               ( 
              
              
              
                x 
               
              
                t 
               
              
             
               , 
              
             
               t 
              
             
               ) 
              
             
               → 
              
              
              
                ϵ 
               
              
                θ 
               
              
             
               ( 
              
              
              
                x 
               
              
                t 
               
              
             
               , 
              
             
               t 
              
             
               ) 
              
             
               + 
              
             
               s 
              
             
               ⋅ 
              
              
              
                ∇ 
               
               
               
                 x 
                
               
                 t 
                
               
              
             
               log 
              
             
               ⁡ 
              
              
              
                p 
               
              
                ϕ 
               
              
             
               ( 
              
             
               y 
              
             
               ∣ 
              
              
              
                x 
               
              
                t 
               
              
             
               ) 
              
             
            
              \epsilon_\theta(x_t, t) \rightarrow \epsilon_\theta(x_t, t) + s \cdot \nabla_{x_t} \log p_\phi(y \mid x_t)
             </span>
             <span class="katex-html">
              <span class="base">
               <span class="strut" style="height: 1em; vertical-align: -0.25em;">
               </span>
               <span class="mord">
                <span class="mord mathnormal">
                 ϵ
                </span>
                <span class="msupsub">
                 <span class="vlist-t vlist-t2">
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.3361em;">
                    <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                     <span class="pstrut" style="height: 2.7em;">
                     </span>
                     <span class="sizing reset-size6 size3 mtight">
                      <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                       θ
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="vlist-s">
                    ​
                   </span>
                  </span>
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.15em;">
                    <span class="">
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="mopen">
                (
               </span>
               <span class="mord">
                <span class="mord mathnormal">
                 x
                </span>
                <span class="msupsub">
                 <span class="vlist-t vlist-t2">
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.2806em;">
                    <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                     <span class="pstrut" style="height: 2.7em;">
                     </span>
                     <span class="sizing reset-size6 size3 mtight">
                      <span class="mord mathnormal mtight">
                       t
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="vlist-s">
                    ​
                   </span>
                  </span>
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.15em;">
                    <span class="">
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="mpunct">
                ,
               </span>
               <span class="mspace" style="margin-right: 0.1667em;">
               </span>
               <span class="mord mathnormal">
                t
               </span>
               <span class="mclose">
                )
               </span>
               <span class="mspace" style="margin-right: 0.2778em;">
               </span>
               <span class="mrel">
                →
               </span>
               <span class="mspace" style="margin-right: 0.2778em;">
               </span>
              </span>
              <span class="base">
               <span class="strut" style="height: 1em; vertical-align: -0.25em;">
               </span>
               <span class="mord">
                <span class="mord mathnormal">
                 ϵ
                </span>
                <span class="msupsub">
                 <span class="vlist-t vlist-t2">
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.3361em;">
                    <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                     <span class="pstrut" style="height: 2.7em;">
                     </span>
                     <span class="sizing reset-size6 size3 mtight">
                      <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                       θ
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="vlist-s">
                    ​
                   </span>
                  </span>
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.15em;">
                    <span class="">
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="mopen">
                (
               </span>
               <span class="mord">
                <span class="mord mathnormal">
                 x
                </span>
                <span class="msupsub">
                 <span class="vlist-t vlist-t2">
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.2806em;">
                    <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                     <span class="pstrut" style="height: 2.7em;">
                     </span>
                     <span class="sizing reset-size6 size3 mtight">
                      <span class="mord mathnormal mtight">
                       t
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="vlist-s">
                    ​
                   </span>
                  </span>
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.15em;">
                    <span class="">
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="mpunct">
                ,
               </span>
               <span class="mspace" style="margin-right: 0.1667em;">
               </span>
               <span class="mord mathnormal">
                t
               </span>
               <span class="mclose">
                )
               </span>
               <span class="mspace" style="margin-right: 0.2222em;">
               </span>
               <span class="mbin">
                +
               </span>
               <span class="mspace" style="margin-right: 0.2222em;">
               </span>
              </span>
              <span class="base">
               <span class="strut" style="height: 0.4445em;">
               </span>
               <span class="mord mathnormal">
                s
               </span>
               <span class="mspace" style="margin-right: 0.2222em;">
               </span>
               <span class="mbin">
                ⋅
               </span>
               <span class="mspace" style="margin-right: 0.2222em;">
               </span>
              </span>
              <span class="base">
               <span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;">
               </span>
               <span class="mord">
                <span class="mord">
                 ∇
                </span>
                <span class="msupsub">
                 <span class="vlist-t vlist-t2">
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.1514em;">
                    <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                     <span class="pstrut" style="height: 2.7em;">
                     </span>
                     <span class="sizing reset-size6 size3 mtight">
                      <span class="mord mtight">
                       <span class="mord mtight">
                        <span class="mord mathnormal mtight">
                         x
                        </span>
                        <span class="msupsub">
                         <span class="vlist-t vlist-t2">
                          <span class="vlist-r">
                           <span class="vlist" style="height: 0.2963em;">
                            <span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714em;">
                             <span class="pstrut" style="height: 2.5em;">
                             </span>
                             <span class="sizing reset-size3 size1 mtight">
                              <span class="mord mathnormal mtight">
                               t
                              </span>
                             </span>
                            </span>
                           </span>
                           <span class="vlist-s">
                            ​
                           </span>
                          </span>
                          <span class="vlist-r">
                           <span class="vlist" style="height: 0.143em;">
                            <span class="">
                            </span>
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="vlist-s">
                    ​
                   </span>
                  </span>
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.2501em;">
                    <span class="">
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="mspace" style="margin-right: 0.1667em;">
               </span>
               <span class="mop">
                lo
                <span style="margin-right: 0.0139em;">
                 g
                </span>
               </span>
               <span class="mspace" style="margin-right: 0.1667em;">
               </span>
               <span class="mord">
                <span class="mord mathnormal">
                 p
                </span>
                <span class="msupsub">
                 <span class="vlist-t vlist-t2">
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.3361em;">
                    <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                     <span class="pstrut" style="height: 2.7em;">
                     </span>
                     <span class="sizing reset-size6 size3 mtight">
                      <span class="mord mathnormal mtight">
                       ϕ
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="vlist-s">
                    ​
                   </span>
                  </span>
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.2861em;">
                    <span class="">
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="mopen">
                (
               </span>
               <span class="mord mathnormal" style="margin-right: 0.0359em;">
                y
               </span>
               <span class="mspace" style="margin-right: 0.2778em;">
               </span>
               <span class="mrel">
                ∣
               </span>
               <span class="mspace" style="margin-right: 0.2778em;">
               </span>
              </span>
              <span class="base">
               <span class="strut" style="height: 1em; vertical-align: -0.25em;">
               </span>
               <span class="mord">
                <span class="mord mathnormal">
                 x
                </span>
                <span class="msupsub">
                 <span class="vlist-t vlist-t2">
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.2806em;">
                    <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                     <span class="pstrut" style="height: 2.7em;">
                     </span>
                     <span class="sizing reset-size6 size3 mtight">
                      <span class="mord mathnormal mtight">
                       t
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="vlist-s">
                    ​
                   </span>
                  </span>
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.15em;">
                    <span class="">
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="mclose">
                )
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <br/>
          其中，
          <span class="katex--inline">
           <span class="katex">
            <span class="katex-mathml">
             s 
             
            
           
             s
            </span>
            <span class="katex-html">
             <span class="base">
              <span class="strut" style="height: 0.4306em;">
              </span>
              <span class="mord mathnormal">
               s
              </span>
             </span>
            </span>
           </span>
          </span>
          为引导尺度，控制条件强度。
         </li>
        </ol>
       </li>
      </ul>
     </li>
     <li>
      <strong>
       优点
      </strong>
      ：
      <ul>
       <li>
        通过梯度调整实现精准条件控制，生成质量高。
       </li>
       <li>
        扩散模型与分类器解耦，可复用预训练分类器。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       缺点
      </strong>
      ：
      <ul>
       <li>
        需额外训练噪声适应的分类器，增加训练成本。
       </li>
       <li>
        分类器在强噪声下可能失效，影响引导效果。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       典型应用
      </strong>
      ：OpenAI的Guided Diffusion（2021）。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="3_ClassifierFree_Guidance_62">
     </a>
     <strong>
      3. Classifier-Free Guidance（无分类器引导）
     </strong>
    </h3>
    <ul>
     <li>
      <strong>
       核心思想
      </strong>
      ：隐式学习条件与无条件生成的差异，通过混合预测结果增强条件控制，无需外部分类器。
     </li>
     <li>
      <strong>
       实现方式
      </strong>
      ：
      <ul>
       <li>
        <strong>
         训练阶段
        </strong>
        ：
        <ul>
         <li>
          随机以概率
          <span class="katex--inline">
           <span class="katex">
            <span class="katex-mathml">
             p 
             
            
           
             p
            </span>
            <span class="katex-html">
             <span class="base">
              <span class="strut" style="height: 0.625em; vertical-align: -0.1944em;">
              </span>
              <span class="mord mathnormal">
               p
              </span>
             </span>
            </span>
           </span>
          </span>
          丢弃条件（替换为空白标识），使模型同时学习条件生成（
          <span class="katex--inline">
           <span class="katex">
            <span class="katex-mathml">
             p 
             
            
              ( 
             
            
              y 
             
            
              ∣ 
             
            
              x 
             
            
              ) 
             
            
           
             p(y \mid x)
            </span>
            <span class="katex-html">
             <span class="base">
              <span class="strut" style="height: 1em; vertical-align: -0.25em;">
              </span>
              <span class="mord mathnormal">
               p
              </span>
              <span class="mopen">
               (
              </span>
              <span class="mord mathnormal" style="margin-right: 0.0359em;">
               y
              </span>
              <span class="mspace" style="margin-right: 0.2778em;">
              </span>
              <span class="mrel">
               ∣
              </span>
              <span class="mspace" style="margin-right: 0.2778em;">
              </span>
             </span>
             <span class="base">
              <span class="strut" style="height: 1em; vertical-align: -0.25em;">
              </span>
              <span class="mord mathnormal">
               x
              </span>
              <span class="mclose">
               )
              </span>
             </span>
            </span>
           </span>
          </span>
          ）和无条件生成（
          <span class="katex--inline">
           <span class="katex">
            <span class="katex-mathml">
             p 
             
            
              ( 
             
            
              x 
             
            
              ) 
             
            
           
             p(x)
            </span>
            <span class="katex-html">
             <span class="base">
              <span class="strut" style="height: 1em; vertical-align: -0.25em;">
              </span>
              <span class="mord mathnormal">
               p
              </span>
              <span class="mopen">
               (
              </span>
              <span class="mord mathnormal">
               x
              </span>
              <span class="mclose">
               )
              </span>
             </span>
            </span>
           </span>
          </span>
          ）。
         </li>
         <li>
          例如，在文本到图像任务中，以一定概率将文本描述替换为空字符串。
         </li>
        </ul>
       </li>
       <li>
        <strong>
         推理阶段
        </strong>
        ：
        <ul>
         <li>
          混合条件预测
          <span class="katex--inline">
           <span class="katex">
            <span class="katex-mathml">
             ϵ 
              
             
               θ 
              
             
            
              ( 
             
             
             
               x 
              
             
               t 
              
             
            
              , 
             
            
              t 
             
            
              , 
             
            
              y 
             
            
              ) 
             
            
           
             \epsilon_\theta(x_t, t, y)
            </span>
            <span class="katex-html">
             <span class="base">
              <span class="strut" style="height: 1em; vertical-align: -0.25em;">
              </span>
              <span class="mord">
               <span class="mord mathnormal">
                ϵ
               </span>
               <span class="msupsub">
                <span class="vlist-t vlist-t2">
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.3361em;">
                   <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                    <span class="pstrut" style="height: 2.7em;">
                    </span>
                    <span class="sizing reset-size6 size3 mtight">
                     <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                      θ
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="vlist-s">
                   ​
                  </span>
                 </span>
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.15em;">
                   <span class="">
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="mopen">
               (
              </span>
              <span class="mord">
               <span class="mord mathnormal">
                x
               </span>
               <span class="msupsub">
                <span class="vlist-t vlist-t2">
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.2806em;">
                   <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                    <span class="pstrut" style="height: 2.7em;">
                    </span>
                    <span class="sizing reset-size6 size3 mtight">
                     <span class="mord mathnormal mtight">
                      t
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="vlist-s">
                   ​
                  </span>
                 </span>
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.15em;">
                   <span class="">
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="mpunct">
               ,
              </span>
              <span class="mspace" style="margin-right: 0.1667em;">
              </span>
              <span class="mord mathnormal">
               t
              </span>
              <span class="mpunct">
               ,
              </span>
              <span class="mspace" style="margin-right: 0.1667em;">
              </span>
              <span class="mord mathnormal" style="margin-right: 0.0359em;">
               y
              </span>
              <span class="mclose">
               )
              </span>
             </span>
            </span>
           </span>
          </span>
          和无条件预测
          <span class="katex--inline">
           <span class="katex">
            <span class="katex-mathml">
             ϵ 
              
             
               θ 
              
             
            
              ( 
             
             
             
               x 
              
             
               t 
              
             
            
              , 
             
            
              t 
             
            
              , 
             
            
              ∅ 
             
            
              ) 
             
            
           
             \epsilon_\theta(x_t, t, \emptyset)
            </span>
            <span class="katex-html">
             <span class="base">
              <span class="strut" style="height: 1em; vertical-align: -0.25em;">
              </span>
              <span class="mord">
               <span class="mord mathnormal">
                ϵ
               </span>
               <span class="msupsub">
                <span class="vlist-t vlist-t2">
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.3361em;">
                   <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                    <span class="pstrut" style="height: 2.7em;">
                    </span>
                    <span class="sizing reset-size6 size3 mtight">
                     <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                      θ
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="vlist-s">
                   ​
                  </span>
                 </span>
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.15em;">
                   <span class="">
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="mopen">
               (
              </span>
              <span class="mord">
               <span class="mord mathnormal">
                x
               </span>
               <span class="msupsub">
                <span class="vlist-t vlist-t2">
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.2806em;">
                   <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                    <span class="pstrut" style="height: 2.7em;">
                    </span>
                    <span class="sizing reset-size6 size3 mtight">
                     <span class="mord mathnormal mtight">
                      t
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="vlist-s">
                   ​
                  </span>
                 </span>
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.15em;">
                   <span class="">
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="mpunct">
               ,
              </span>
              <span class="mspace" style="margin-right: 0.1667em;">
              </span>
              <span class="mord mathnormal">
               t
              </span>
              <span class="mpunct">
               ,
              </span>
              <span class="mspace" style="margin-right: 0.1667em;">
              </span>
              <span class="mord">
               ∅
              </span>
              <span class="mclose">
               )
              </span>
             </span>
            </span>
           </span>
          </span>
          ：
          <br/>
          <span class="katex--display">
           <span class="katex-display">
            <span class="katex">
             <span class="katex-mathml">
              ϵ 
               
              
                guided 
               
              
             
               = 
              
              
              
                ϵ 
               
              
                θ 
               
              
             
               ( 
              
              
              
                x 
               
              
                t 
               
              
             
               , 
              
             
               t 
              
             
               , 
              
             
               ∅ 
              
             
               ) 
              
             
               + 
              
             
               s 
              
             
               ⋅ 
              
             
               ( 
              
              
              
                ϵ 
               
              
                θ 
               
              
             
               ( 
              
              
              
                x 
               
              
                t 
               
              
             
               , 
              
             
               t 
              
             
               , 
              
             
               y 
              
             
               ) 
              
             
               − 
              
              
              
                ϵ 
               
              
                θ 
               
              
             
               ( 
              
              
              
                x 
               
              
                t 
               
              
             
               , 
              
             
               t 
              
             
               , 
              
             
               ∅ 
              
             
               ) 
              
             
               ) 
              
             
            
              \epsilon_\text{guided} = \epsilon_\theta(x_t, t, \emptyset) + s \cdot (\epsilon_\theta(x_t, t, y) - \epsilon_\theta(x_t, t, \emptyset))
             </span>
             <span class="katex-html">
              <span class="base">
               <span class="strut" style="height: 0.7167em; vertical-align: -0.2861em;">
               </span>
               <span class="mord">
                <span class="mord mathnormal">
                 ϵ
                </span>
                <span class="msupsub">
                 <span class="vlist-t vlist-t2">
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.3361em;">
                    <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                     <span class="pstrut" style="height: 2.7em;">
                     </span>
                     <span class="sizing reset-size6 size3 mtight">
                      <span class="mord text mtight">
                       <span class="mord mtight">
                        guided
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="vlist-s">
                    ​
                   </span>
                  </span>
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.2861em;">
                    <span class="">
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="mspace" style="margin-right: 0.2778em;">
               </span>
               <span class="mrel">
                =
               </span>
               <span class="mspace" style="margin-right: 0.2778em;">
               </span>
              </span>
              <span class="base">
               <span class="strut" style="height: 1em; vertical-align: -0.25em;">
               </span>
               <span class="mord">
                <span class="mord mathnormal">
                 ϵ
                </span>
                <span class="msupsub">
                 <span class="vlist-t vlist-t2">
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.3361em;">
                    <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                     <span class="pstrut" style="height: 2.7em;">
                     </span>
                     <span class="sizing reset-size6 size3 mtight">
                      <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                       θ
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="vlist-s">
                    ​
                   </span>
                  </span>
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.15em;">
                    <span class="">
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="mopen">
                (
               </span>
               <span class="mord">
                <span class="mord mathnormal">
                 x
                </span>
                <span class="msupsub">
                 <span class="vlist-t vlist-t2">
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.2806em;">
                    <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                     <span class="pstrut" style="height: 2.7em;">
                     </span>
                     <span class="sizing reset-size6 size3 mtight">
                      <span class="mord mathnormal mtight">
                       t
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="vlist-s">
                    ​
                   </span>
                  </span>
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.15em;">
                    <span class="">
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="mpunct">
                ,
               </span>
               <span class="mspace" style="margin-right: 0.1667em;">
               </span>
               <span class="mord mathnormal">
                t
               </span>
               <span class="mpunct">
                ,
               </span>
               <span class="mspace" style="margin-right: 0.1667em;">
               </span>
               <span class="mord">
                ∅
               </span>
               <span class="mclose">
                )
               </span>
               <span class="mspace" style="margin-right: 0.2222em;">
               </span>
               <span class="mbin">
                +
               </span>
               <span class="mspace" style="margin-right: 0.2222em;">
               </span>
              </span>
              <span class="base">
               <span class="strut" style="height: 0.4445em;">
               </span>
               <span class="mord mathnormal">
                s
               </span>
               <span class="mspace" style="margin-right: 0.2222em;">
               </span>
               <span class="mbin">
                ⋅
               </span>
               <span class="mspace" style="margin-right: 0.2222em;">
               </span>
              </span>
              <span class="base">
               <span class="strut" style="height: 1em; vertical-align: -0.25em;">
               </span>
               <span class="mopen">
                (
               </span>
               <span class="mord">
                <span class="mord mathnormal">
                 ϵ
                </span>
                <span class="msupsub">
                 <span class="vlist-t vlist-t2">
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.3361em;">
                    <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                     <span class="pstrut" style="height: 2.7em;">
                     </span>
                     <span class="sizing reset-size6 size3 mtight">
                      <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                       θ
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="vlist-s">
                    ​
                   </span>
                  </span>
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.15em;">
                    <span class="">
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="mopen">
                (
               </span>
               <span class="mord">
                <span class="mord mathnormal">
                 x
                </span>
                <span class="msupsub">
                 <span class="vlist-t vlist-t2">
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.2806em;">
                    <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                     <span class="pstrut" style="height: 2.7em;">
                     </span>
                     <span class="sizing reset-size6 size3 mtight">
                      <span class="mord mathnormal mtight">
                       t
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="vlist-s">
                    ​
                   </span>
                  </span>
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.15em;">
                    <span class="">
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="mpunct">
                ,
               </span>
               <span class="mspace" style="margin-right: 0.1667em;">
               </span>
               <span class="mord mathnormal">
                t
               </span>
               <span class="mpunct">
                ,
               </span>
               <span class="mspace" style="margin-right: 0.1667em;">
               </span>
               <span class="mord mathnormal" style="margin-right: 0.0359em;">
                y
               </span>
               <span class="mclose">
                )
               </span>
               <span class="mspace" style="margin-right: 0.2222em;">
               </span>
               <span class="mbin">
                −
               </span>
               <span class="mspace" style="margin-right: 0.2222em;">
               </span>
              </span>
              <span class="base">
               <span class="strut" style="height: 1em; vertical-align: -0.25em;">
               </span>
               <span class="mord">
                <span class="mord mathnormal">
                 ϵ
                </span>
                <span class="msupsub">
                 <span class="vlist-t vlist-t2">
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.3361em;">
                    <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                     <span class="pstrut" style="height: 2.7em;">
                     </span>
                     <span class="sizing reset-size6 size3 mtight">
                      <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                       θ
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="vlist-s">
                    ​
                   </span>
                  </span>
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.15em;">
                    <span class="">
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="mopen">
                (
               </span>
               <span class="mord">
                <span class="mord mathnormal">
                 x
                </span>
                <span class="msupsub">
                 <span class="vlist-t vlist-t2">
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.2806em;">
                    <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                     <span class="pstrut" style="height: 2.7em;">
                     </span>
                     <span class="sizing reset-size6 size3 mtight">
                      <span class="mord mathnormal mtight">
                       t
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="vlist-s">
                    ​
                   </span>
                  </span>
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.15em;">
                    <span class="">
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="mpunct">
                ,
               </span>
               <span class="mspace" style="margin-right: 0.1667em;">
               </span>
               <span class="mord mathnormal">
                t
               </span>
               <span class="mpunct">
                ,
               </span>
               <span class="mspace" style="margin-right: 0.1667em;">
               </span>
               <span class="mord">
                ∅
               </span>
               <span class="mclose">
                ))
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <br/>
          其中，
          <span class="katex--inline">
           <span class="katex">
            <span class="katex-mathml">
             s 
             
            
              &gt; 
             
            
              1 
             
            
           
             s &gt; 1
            </span>
            <span class="katex-html">
             <span class="base">
              <span class="strut" style="height: 0.5782em; vertical-align: -0.0391em;">
              </span>
              <span class="mord mathnormal">
               s
              </span>
              <span class="mspace" style="margin-right: 0.2778em;">
              </span>
              <span class="mrel">
               &gt;
              </span>
              <span class="mspace" style="margin-right: 0.2778em;">
              </span>
             </span>
             <span class="base">
              <span class="strut" style="height: 0.6444em;">
              </span>
              <span class="mord">
               1
              </span>
             </span>
            </span>
           </span>
          </span>
          时增强条件效应，
          <span class="katex--inline">
           <span class="katex">
            <span class="katex-mathml">
             s 
             
            
              = 
             
            
              1 
             
            
           
             s=1
            </span>
            <span class="katex-html">
             <span class="base">
              <span class="strut" style="height: 0.4306em;">
              </span>
              <span class="mord mathnormal">
               s
              </span>
              <span class="mspace" style="margin-right: 0.2778em;">
              </span>
              <span class="mrel">
               =
              </span>
              <span class="mspace" style="margin-right: 0.2778em;">
              </span>
             </span>
             <span class="base">
              <span class="strut" style="height: 0.6444em;">
              </span>
              <span class="mord">
               1
              </span>
             </span>
            </span>
           </span>
          </span>
          退化为普通条件生成。
         </li>
        </ul>
       </li>
      </ul>
     </li>
     <li>
      <strong>
       优点
      </strong>
      ：
      <ul>
       <li>
        无需外部分类器，简化训练流程。
       </li>
       <li>
        通过调整引导尺度
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           s 
           
          
         
           s
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.4306em;">
            </span>
            <span class="mord mathnormal">
             s
            </span>
           </span>
          </span>
         </span>
        </span>
        灵活平衡生成质量与多样性。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       缺点
      </strong>
      ：
      <ul>
       <li>
        训练时需同时建模条件与无条件生成，可能增加模型容量需求。
       </li>
       <li>
        条件丢弃概率需调优，否则影响收敛稳定性。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       典型应用
      </strong>
      ：Stable Diffusion、DALL·E 2等主流文本到图像模型。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_85">
     </a>
     <strong>
      对比总结
     </strong>
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        <strong>
         特性
        </strong>
       </th>
       <th>
        <strong>
         Vanilla Guidance
        </strong>
       </th>
       <th>
        <strong>
         Classifier Guidance
        </strong>
       </th>
       <th>
        <strong>
         Classifier-Free Guidance
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         是否需要分类器
        </strong>
       </td>
       <td>
        否
       </td>
       <td>
        是（噪声适应）
       </td>
       <td>
        否
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         训练复杂度
        </strong>
       </td>
       <td>
        低（端到端条件训练）
       </td>
       <td>
        中（需训练分类器）
       </td>
       <td>
        中（条件随机丢弃策略）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         推理灵活性
        </strong>
       </td>
       <td>
        低（直接替换条件）
       </td>
       <td>
        中（依赖分类器）
       </td>
       <td>
        高（通过
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           s 
           
          
         
           s
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.4306em;">
            </span>
            <span class="mord mathnormal">
             s
            </span>
           </span>
          </span>
         </span>
        </span>
        调节控制强度）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         生成质量与条件控制
        </strong>
       </td>
       <td>
        一般
       </td>
       <td>
        高（依赖分类器质量）
       </td>
       <td>
        高（自适应调节）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         典型场景
        </strong>
       </td>
       <td>
        简单条件生成
       </td>
       <td>
        高精度条件生成（需分类器可靠）
       </td>
       <td>
        复杂条件生成（如文本到图像）
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h3>
     <a id="_97">
     </a>
     <strong>
      选择建议
     </strong>
    </h3>
    <ul>
     <li>
      <strong>
       数据充足且条件简单
      </strong>
      ：Vanilla Guidance足够高效。
     </li>
     <li>
      <strong>
       需高精度控制且分类器可靠
      </strong>
      ：Classifier Guidance适合特定领域（如医学图像生成）。
     </li>
     <li>
      <strong>
       通用复杂条件生成
      </strong>
      ：Classifier-Free Guidance更优，已成为当前主流（如Stable Diffusion）。
     </li>
    </ul>
    <p>
     通过理解这三种方法的差异，可根据具体任务需求选择最适合的条件引导策略。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34333036393230332f:61727469636c652f64657461696c732f313436313233383537" class_="artid" style="display:none">
 </p>
</div>


