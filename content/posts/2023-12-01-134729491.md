---
layout: post
title: "内网环境下通过docker-compose部署python项目详解"
date: 2023-12-01 14:46:29 +0800
description: "在企业中基于安全情况考虑，大多数服务器是无法访问互联网的，只能内网使用，如果通过docker部署py"
keywords: "docker compose python"
categories: ['Docker']
tags: ['容器', 'Python', 'Docker']
artid: "134729491"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=134729491
    alt: "内网环境下通过docker-compose部署python项目详解"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=134729491
featuredImagePreview: https://bing.ee123.net/img/rand?artid=134729491
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     内网环境下通过docker-compose部署python项目（详解）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     一、引言
    </h2>
    <p>
     Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从 Apache2.0 协议开源。Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app）,更重要的是容器性能开销极低。
    </p>
    <h2>
     <a id="_2">
     </a>
     二、本文简介
    </h2>
    <p>
     上篇文件讲到通过docker-compose部署python项目，但在企业中基于安全情况考虑，大多数服务器是无法访问互联网的，只能内网使用，如果通过docker部署python项目，无法访问docker.io致使python环境镜像无法拉取，本文则针对这种情况，详细讲解内网服务器中通过docker-compose部属python项目（前置条件：服务器已安装完成docker）
    </p>
    <h2>
     <a id="dockerpython_4">
     </a>
     三、内网服务器docker部署python镜像安装
    </h2>
    <ol>
     <li>
      在内网中是无法安装docker镜像的，此时我们需要借助可以访问互联网的机器安装docker镜像，然后通过导出+导入的方式实现内网服务docker的安装
     </li>
     <li>
      可访问互联网的服务器安装docker镜像（以python:3.9-alpine为例）
      <br/>
      2.1. 拉取python镜像（如果速度慢docker可配置为国内镜像源地址，可自行百度）
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token function">docker</span> pull python:3.9-alpine
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e97f91905e02df2a5930d4cc7130a222.png"/>
    </p>
    <ol start="3">
     <li>
      创建容器，并在容器内安装python库
      <br/>
      3.1. 创建容器，主要为了在镜像中安装python项目所需的python库
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token comment"># 创建容器（若未指定容器名时容器名随机生成）</span>
<span class="token function">docker</span> run <span class="token parameter variable">-itd</span> python:3.9-alpine
<span class="token comment"># 查看容器是否创建成功</span>
<span class="token function">docker</span> <span class="token function">ps</span> 
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c6c620934487a8a498516a6d77dd79d8.png"/>
    </p>
    <p>
     3.2. 将python库文件requirements.txt复制到容器interesting_easley中/目录下
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token function">cp</span> requirements.txt interesting_easley:/
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7992997685b4557dd8d8994276d8a562.png">
      <br/>
      3.3. 进入容器interesting_easley，安装python项目所需的python库（注意：确保上步python库文件已复制到容器内）
     </img>
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> interesting_easley /bin/sh
pip <span class="token function">install</span> <span class="token parameter variable">-i</span> https://mirrors.aliyun.com/pypi/simple/ <span class="token parameter variable">-r</span> requirements.txt
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e725bf159db3ef15f4daf274891f95cd.png">
      <br/>
      3.4. 退出容器
     </img>
    </p>
    <pre><code class="prism language-bash"><span class="token builtin class-name">exit</span>
</code></pre>
    <ol start="4">
     <li>
      导出含有容器interesting_easley的python镜像python_3.9-alpine.tar（导出镜像分为export和save，export导出为镜像内容含容器，save导出为镜像不含容器；此处需要容器内安装的python库，所以需要用到export进行导出）
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token builtin class-name">export</span> interesting_easley <span class="token operator">&gt;</span> python_3.9-alpine.tar
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9db523d9c7aba586a2994a707f980d29.png"/>
    </p>
    <ol start="5">
     <li>
      将导出镜像文件python_3.9-alpine.tar上传至内网服务器，在内网服务器进行导入镜像python:3.9-alpine（镜像命可自定义）
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token function">import</span> python_3.9-alpine.tar python:3.9-alpine
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0b1f1496ffdbe2bd22e17e0ef4964980.png"/>
    </p>
    <h2>
     <a id="python_50">
     </a>
     四、内网服务器python项目部署
    </h2>
    <ol>
     <li>
      内网服务项目结构
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/111a0c36867b591d3c05fc61ec8dec64.png"/>
     </li>
     <li>
      编写python项目docker-compose文件
      <br/>
      2.1. 新建docker-compose.yaml文件
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token function">touch</span> docker-compose.yaml
</code></pre>
    <p>
     2.2. 编写内容
    </p>
    <pre><code class="prism language-bash"><span class="token function">vim</span> docker-compose.yaml
</code></pre>
    <pre><code class="prism language-bash">version: <span class="token string">'3'</span>
services:
  files_server:
    working_dir: /root/fileServer
    image: python:3.9-alpine
    container_name: files_server
    environment:
      - <span class="token assign-left variable">TZ</span><span class="token operator">=</span>Asia/Shanghai
      - <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8
    restart: always
    volumes:
      - <span class="token punctuation">..</span>/FilesServer:/root/fileServer
      - /home/:/home/
    command: python /root/fileServer/application.py
    ports:
      - <span class="token string">"5000:5000"</span>
    network_mode: bridge
    logging:
      options:
        max-size: <span class="token string">"12m"</span>
        max-file: <span class="token string">"5"</span>
      driver: json-file
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9a49d58c3a31aa20787a6ae415669004.png"/>
    </p>
    <p>
     2.3. 编写注意
    </p>
    <blockquote>
     <p>
      files_server：容器名称，启动需要 image：镜像名称，上面导入的镜像名称
      <br/>
      volumes：文件挂载，服务器python项目文件与容器文件实现互通，修改服务器文件内容，可同步至容器内（这里同步的是整个项目文件夹，也可同步单个需要的文件）
      <br/>
      command：启动命令，此处路径为容器内路径（服务器文件挂载的启动文件路径） 内容缩进：编写时注意文件内容的缩进
     </p>
    </blockquote>
    <h2>
     <a id="dockercomposepython_93">
     </a>
     五、通过docker-compose启动python项目容器
    </h2>
    <ol>
     <li>
      启动容器（files_server：docker-compose中容器名称）
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span> files_server
</code></pre>
    <ol start="2">
     <li>
      查看容器运行是否正常，可通过查看容器docker日志，查看是否报错，及通过报错信息定位问题；通过日志可以看到项目已启动成功
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token function">docker</span> logs <span class="token parameter variable">-f</span> <span class="token parameter variable">--tail</span> <span class="token number">200</span> files_server
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/13b74c3e2bc29e6c5fe3616733bb6888.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f6c77313535383533333839332f:61727469636c652f64657461696c732f313334373239343931" class_="artid" style="display:none">
 </p>
</div>


