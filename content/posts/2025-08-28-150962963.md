---
layout: post
title: "STM32G030单片机的窗口看门狗"
date: 2025-08-28T21:56:35+0800
description: "窗口看门狗适合需要精确时序控制的场合，在一个受限的窗口期内喂狗，如果递减计数器还没有到窗口值就喂狗，会触发复位如果一直不喂狗，也会触发复位，和之前的独立看门狗的窗口选项有点类似需要指出的是，有些STM32单片机的独立看门狗是不具备窗口功能的，例如常见的F103C8T6递减计数器有7位，由于计数值 &gt;= 窗口值 &gt;= 64，则计数器最高位亦即T6就必定是1只要使能了窗口看门狗，WDGA就是1，右上方的与门是否输出1就取决于前一级的或门。"
keywords: "【STM32】G030单片机的窗口看门狗"
categories: ['Stm']
tags: ['嵌入式硬件', '单片机', 'Stm']
artid: "150962963"
arturl: "https://blog.csdn.net/weixin_56719449/article/details/150962963"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=150962963
    alt: "STM32G030单片机的窗口看门狗"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=150962963
featuredImagePreview: https://bing.ee123.net/img/rand?artid=150962963
cover: https://bing.ee123.net/img/rand?artid=150962963
image: https://bing.ee123.net/img/rand?artid=150962963
img: https://bing.ee123.net/img/rand?artid=150962963
---



# 【STM32】G030单片机的窗口看门狗



### 一、简单介绍

![](https://i-blog.csdnimg.cn/direct/cea96f339b6f4d64a350f943e72ff8e5.png)

窗口看门狗适合需要精确时序控制的场合，在一个受限的窗口期内喂狗，如果递减计数器还没有到窗口值就喂狗，会触发复位

如果一直不喂狗，也会触发复位，和之前的独立看门狗的窗口选项有点类似

需要指出的是，有些STM32单片机的独立看门狗是不具备窗口功能的，例如常见的F103C8T6

![](https://i-blog.csdnimg.cn/direct/88b3bb4eef8047efad5af39a5c7f0e3b.png)

![](https://i-blog.csdnimg.cn/direct/fe13fc8c6dce4b9984b1dbde6e2ac8e8.png)

递减计数器有7位，由于计数值 >= 窗口值 >= 64，则计数器最高位亦即T6就必定是1

只要使能了窗口看门狗，WDGA就是1，右上方的与门是否输出1就取决于前一级的或门

或门的一个输入是T6，窗口期的大小就是T[5:0]这6个位，当这6位数递减至0时，最高位发生翻转，T6变成0就会触发复位

或门的另一个输入是比较器，当比较器发现计数值比窗口值还大时且有喂狗动作就输出1，也会立刻复位

## 二、特性

![](https://i-blog.csdnimg.cn/direct/62b4fb7dbde44034bb3dfbcaaa6af088.png)

如果递减计数器还没有到窗口值就喂狗，会触发复位

如果递减计数器值小于0x40，会触发复位

具有一个早起中断，在复位前会执行这个中断

## 三、设置窗口值

![](https://i-blog.csdnimg.cn/direct/074dc31457664109a17ae3108463d319.png)

笔者设置系统时钟为64MHz，同时也是64MHz的pclk，使用16分频，则计数频率为64MHz / 4096 / 16 = 0.976kHz，周期为1.024ms

在窗口内喂狗后计数器被赋值为T[6:0]，也就是cubemx里counter的值

当计数器值介于down counter和window之间时不允许喂狗，只有计数器值介于window和0x3F之间才可以喂狗

## 四、cubemx配置

### 系统时钟

![](https://i-blog.csdnimg.cn/direct/38c9bd5ce84346398098d7f613b115b5.png)

### 窗口看门狗

![](https://i-blog.csdnimg.cn/direct/7536b390167b4fa8a25e1d0794bdf59c.png)

设置counter为127，window为70，则只有在第58.36~64.51ms的范围内(计数器落在[70:63])喂狗才不会复位（因为每计数一次大约1.024ms）

开启early wakeup中断

![](https://i-blog.csdnimg.cn/direct/5c7de87f8b254b2a8742c65ecbd530ea.png)

### 定时器

配置定时并开启中断

![](https://i-blog.csdnimg.cn/direct/c8ed0c1882184a1cad50815a20933bb7.png)

![](https://i-blog.csdnimg.cn/direct/c1b8bc017b1d4dac9727861f5af4d710.png)

### 中断优先级

![](https://i-blog.csdnimg.cn/direct/8b9c86cf7bdb48d2822b9ef9e77bd28d.png)

需要给看门狗中断较高的优先级

## 五、测试代码

主循环显示递增数，定时器喂狗次数和看门狗中断喂狗次数

```

/**
  * @brief  The application entry point.
  * @retval int
  */
int main(void)
{

  /* USER CODE BEGIN 1 */

  /* USER CODE END 1 */

  /* MCU Configuration--------------------------------------------------------*/

  /* Reset of all peripherals, Initializes the Flash interface and the Systick. */
  HAL_Init();

  /* USER CODE BEGIN Init */

  /* USER CODE END Init */

  /* Configure the system clock */
  SystemClock_Config();

  /* USER CODE BEGIN SysInit */

  /* USER CODE END SysInit */

  /* Initialize all configured peripherals */
  MX_GPIO_Init();
  MX_DMA_Init();
  MX_SPI1_Init();
  MX_TIM17_Init();
//   MX_WWDG_Init();
  /* USER CODE BEGIN 2 */
   
   ST7735_Init();
   
   ST7735_ShowString(0, 0, "RESET", Font_11x18, RED, BLACK);
   HAL_Delay(1000);
   ST7735_Clear(BLACK);
   MX_WWDG_Init();
   HAL_TIM_Base_Start_IT(&htim17);
  /* USER CODE END 2 */

  /* Infinite loop */
  /* USER CODE BEGIN WHILE */
  while (1)
  {
   static uint16_t wdg = 0;
   static uint16_t timer = 0;

   count++;
   sprintf(str, "%d  ", count % 999);
   ST7735_ShowString(0, 0, str, Font_11x18, GREEN, BLACK);
   
   if (wdg != wdgcnt)
   {
      wdg = wdgcnt;
      sprintf(str, "%d", wdgcnt);
      ST7735_ShowString(0, 30, str, Font_11x18, RED, BLACK);
   }
   if (timer != timercnt)
   {
      timer = timercnt;
      sprintf(str, "%d", timercnt);
      ST7735_ShowString(0, 60, str, Font_11x18, BLUE, BLACK);
   }
   
    /* USER CODE END WHILE */

    /* USER CODE BEGIN 3 */
  }
  /* USER CODE END 3 */
}
```

在看门狗中断内喂狗

```

void HAL_WWDG_EarlyWakeupCallback(WWDG_HandleTypeDef *hwwdg)
{
   wdgcnt++;
   HAL_WWDG_Refresh(hwwdg);
   wdgFeedFlg = 1;
}
```

看门狗早起中断内进行喂狗，并将喂狗标志位置位

 在1ms定时器中断内进行喂狗，判断是否已经通过看门狗中断喂过。如果喂过了，递减计数器会被重置，就不必再喂了

```

void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim)
{
   static uint8_t cnt = 0;

   if (cnt == 60)
   {
      if (wdgFeedFlg == 0)
      {
         HAL_WWDG_Refresh(&hwwdg);
         timercnt++;
      }
      else
      {
         wdgFeedFlg = 0;
      }

      cnt = 0;
   }
   cnt++;
}
```

实验证明确实如此，如果cnt等于58就喂狗也会触发复位，只有59~64才是合适的范围

## 六、现象

当定时器喂狗时，屏幕最底下蓝色的数字显示通过定时器喂狗的次数

![](https://i-blog.csdnimg.cn/direct/e8ffa7b2f2e04a84932d191acfbd8e0c.png)

当看门狗中断喂狗时，屏幕中间红色的数字显示看门狗中断喂狗次数

![](https://i-blog.csdnimg.cn/direct/3bfb51d8d0324ef6b71b214bb7f1c3e7.png)

## 七、工程链接



