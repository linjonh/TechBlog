---
layout: post
title: "gbase8s-rss集群通信流程"
date: 2025-03-10 11:40:01 +0800
description: "如果主服务器发生故障，那么备用服务器可以接管，直到主服务器恢复运行为止。基于逻辑日志的复制技术，需要传输大量的逻辑日志,数据库需启用日志模式。最大允许主节点发送64个log buffers 后返回ack。如下线程主要作用为解析主机发送的逻辑日志然后在备机重做。RSS是一种将数据从主服务器复制到备服务器的方法。实例级别的复制 (所有启用日志记录功能的数据库)RSS 节点不能提升为主节点，只能提升为标准节点。RSS 节点不能提升为HDR备节点。DRAUTO 必须使用CM切换。HDR备节点可降级为RSS节点。"
keywords: "gbase8s rss集群通信流程"
categories: ['Gbase']
tags: ['数据库']
artid: "146149152"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146149152
    alt: "gbase8s-rss集群通信流程"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146149152
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146149152
cover: https://bing.ee123.net/img/rand?artid=146149152
image: https://bing.ee123.net/img/rand?artid=146149152
img: https://bing.ee123.net/img/rand?artid=146149152
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     gbase8s rss集群通信流程
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     什么是rss
    </p>
    <p>
     RSS是一种将数据从主服务器复制到备服务器的方法
     <br/>
     实例级别的复制 (所有启用日志记录功能的数据库)
     <br/>
     基于逻辑日志的复制技术，需要传输大量的逻辑日志,数据库需启用日志模式
     <br/>
     通过网络持续将数据复制到备节点
     <br/>
     如果主服务器发生故障，那么备用服务器可以接管，直到主服务器恢复运行为止
    </p>
    <p>
     <br/>
     RSS特点
    </p>
    <p>
     与HDR相比可以有多个备节点
     <br/>
     每个节点拥有它自己的存储设备
     <br/>
     能承受服务器软硬件故障
     <br/>
     支持异步检查点
     <br/>
     不能升级为HRD集群
     <br/>
     使用索引页日志记录
    </p>
    <p>
     搭建步骤
    </p>
    <p>
     主                                                                      备
     <br/>
     onmode -wf  LOG_INDEX_BUILDS=1
     <br/>
     onmode –d add RSS &lt;rssname&gt;
     <br/>
     ontape –s –L 0
     <br/>
     ontape -p
     <br/>
     onmode –d RSS &lt;priname&gt;
    </p>
    <p>
     <br/>
     <br/>
     与HDR相比切换的差异
     <br/>
     DRAUTO 必须使用CM切换
     <br/>
     RSS 节点不能提升为主节点，只能提升为标准节点
     <br/>
     RSS 节点不能提升为HDR备节点
     <br/>
     HDR备节点可降级为RSS节点
    </p>
    <p>
     通信流程如下
    </p>
    <p>
     <img alt="" height="573" src="https://i-blog.csdnimg.cn/direct/f2143d6eeea34340b90b38e910998adf.png" width="1180"/>
    </p>
    <p>
     图片来源于网络
    </p>
    <p>
     相关线程
    </p>
    <p>
     主节点
     <br/>
     smx相关线程，同HDR集群
     <br/>
     smxrcv gbase02
     <br/>
     smxsnd gbase02
     <br/>
     smxRecvSnd
    </p>
    <p>
     RSS_Send_gbase02
     <br/>
     主要函数  cloneStdSend()
     <br/>
     作用
     <br/>
     向RSS节点发送 log buffers
     <br/>
     启动线程cloneSourceRecvThread 接收RSS 返回的ack
     <br/>
     最大允许主节点发送64个log buffers 后返回ack
    </p>
    <p>
     RSS_Recv_gbase02
     <br/>
     接收RSS端ack消息
    </p>
    <p>
     备节点
     <br/>
     smx相关线程，同HDR集群
     <br/>
     smxsnd gbase01
     <br/>
     smxrcv gbase01
     <br/>
     smxRecvSnd
    </p>
    <p>
     RSS_Recv
     <br/>
     主要函数 cloneRecvThread()
     <br/>
     作用
     <br/>
     接收主节点logical log buffer pages
     <br/>
     遍历日志记录并将其排队等待RSS_apply线程处理
     <br/>
     向主节点发送ack消息
    </p>
    <p>
     如下线程主要作用为解析主机发送的逻辑日志然后在备机重做
     <br/>
     RSS_apply
     <br/>
     logrecover
     <br/>
     bld_logrecs
     <br/>
     logredo
     <br/>
     xchg_*
    </p>
    <p>
     <br/>
     监控
     <br/>
     onstat -g cluster
     <br/>
     onstat -g rss
     <br/>
     onstat -g rss verbose
     <br/>
     onstat -g rss log
     <br/>
     onstat -g smx
    </p>
    <p>
     追踪数据库集群交互的通信过程
    </p>
    <p>
     xtrace on
     <br/>
     xtrace size 10000
     <br/>
     xtrace heavy -c XTF_CLONE -f XTF_SMX_MSG
    </p>
    <p>
     将环形队列信息导出到文件
     <br/>
     xtrace -t fview &gt; result.txt
    </p>
    <p>
     关闭
     <br/>
     xtrace off
    </p>
    <p>
     xtrace部分输出如下
    </p>
    <p>
     <img alt="" height="712" src="https://i-blog.csdnimg.cn/direct/bd0627d4f55647a79d022856c1a678ef.png" width="1882"/>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f77616e67797830312f:61727469636c652f64657461696c732f313436313439313532" class_="artid" style="display:none">
 </p>
</div>


