---
layout: post
title: "项目基于FreeRTOS的STM32四轴飞行器-七.遥控器按键"
date: 2025-03-09 20:40:37 +0800
description: "进行了遥控器按键的学习"
keywords: "[项目]基于FreeRTOS的STM32四轴飞行器: 七.遥控器按键"
categories: ['基于Freertos的Stm32四轴飞行器']
tags: ['嵌入式硬件', '单片机', 'Stm', 'Mcu']
artid: "146124562"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146124562
    alt: "项目基于FreeRTOS的STM32四轴飞行器-七.遥控器按键"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146124562
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146124562
cover: https://bing.ee123.net/img/rand?artid=146124562
image: https://bing.ee123.net/img/rand?artid=146124562
img: https://bing.ee123.net/img/rand?artid=146124562
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     [项目]基于FreeRTOS的STM32四轴飞行器: 七.遥控器按键
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="_1">
     </a>
     一.遥控器按键摇杆功能说明
    </h2>
    <p>
     两个手柄四个ADC。
     <br/>
     <strong>
      左侧手柄
     </strong>
     ：
     <br/>
     前后推为飞控油门，左右推为控制飞机偏航角。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/0b1ba957525545be901e623a60c90125.png">
      <br/>
      <strong>
       右侧手柄
      </strong>
      ：
      <br/>
      控制飞机飞行方向，向前飞向后飞。
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8d33983b45394a50a396b9924b1533b3.png">
       <br/>
       <strong>
        按键：
       </strong>
       <br/>
       可以用于控制飞行微调或者定义一键关机一键定高等功能。
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7195a93f8d464e318f2e7911ab6687da.png"/>
      </img>
     </img>
    </p>
    <h2>
     <a id="_12">
     </a>
     二.摇杆和按键的配置
    </h2>
    <p>
     <strong>
      按键原理图：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/50783136b10844168436446e5344d2b6.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e6877f50c5be47f9b57de822ce5a03a0.png">
       <br/>
       观察按键电路配置，按下为低电平所以设置为
       <strong>
        上拉输入
       </strong>
       ：
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/30d11b3dd7ab418dac29d0d0dd517e81.png">
        <br/>
        <strong>
         摇杆原理图：
        </strong>
        <br/>
        左侧手柄上下控制ADC1-1，左右控制ADC1-6。
        <br/>
        右侧手柄上下控制ADC1-2，左右控制ADC1-3。
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/81d2a207b42a4d69bdae333b0ffe3d60.png">
         <br/>
         <strong>
          配置：
         </strong>
         <br/>
         ADC的时钟不能超过14MHZ，因为超过会导致ADC时钟精度下降结果不准，HAL库强制不让超过。
         <br/>
         <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/cff71232933c4d4b959f2ff139afc558.png">
          <br/>
          <strong>
           数据对齐方式：
          </strong>
          <br/>
          左对齐和右对齐，数据寄存器只有8，16，32位，ADC采集到的数据只有12位，所以可以放在左侧12位或右侧12位，一般右对齐。
          <br/>
          <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ed3870e3fdcb4c5588d2d8c719c11c71.png"/>
          <br/>
          <strong>
           扫描模式：
          </strong>
          <br/>
          将使用的ADC1通道挨个扫描一遍，当多通道时一定要开扫描模式。
          <br/>
          <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c221a08a43d84016ad9d3a686af8cd74.png"/>
          <br/>
          先将Number Of conversion设为4：
          <br/>
          <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9e7cdee59bfc432e845339abfa0f3c30.png"/>
          <br/>
          这时可以Enabled：
          <br/>
          <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a42293effd9649a6b07b715a83ee9463.png"/>
          <br/>
          连续模式（Continuous Conversion Mode）：
          <br/>
          在扫描完一次后扫描第二次，要设置为Enable。
          <br/>
          <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2a2e84ea31124cf7acd5fc4924bdebf5.png"/>
          <br/>
          <strong>
           ADC规则转换模式：
          </strong>
          <br/>
          一般使用规则转换，四个通道只有一个数字寄存器，必须开启DMA，外部触发源使用软件触发。
          <br/>
          之后会开启DMA长度为四的数组存储数据，Rank决定了数据放在DMA数组的哪个位置。
          <br/>
          <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/729191ab9671412b9219f99af8312835.png"/>
          <br/>
          <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1b6436b0ef994fc49343be22a016fce7.png"/>
          <br/>
          根据原理图配置Rank，设置Sampling Time为13.5 Cycles：
          <br/>
          <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d635b14420a14223a4108645cbe6a7ac.png"/>
          <br/>
          <strong>
           配置DMA：
          </strong>
          <br/>
          选择Normal（循环）模式，数据宽度选择Half Word，因为ADC的值都为uint16使用uint16类型。
          <br/>
          <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/0b15f12e49654679a6f550464ab76004.png"/>
          <br/>
          还要
          <strong>
           将DMA中断关闭
          </strong>
          ，如果不关中断，转换完后进入中断函数，不会执行正常代码。
          <br/>
          <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a46dc863aa1d453b9d3a15d8976b5ea6.png"/>
         </img>
        </img>
       </img>
      </img>
     </img>
    </p>
    <h2>
     <a id="_50">
     </a>
     三.按键扫描
    </h2>
    <p>
     <strong>
      摇杆初始化：
     </strong>
     <br/>
     先使用ADC校准，再启动ADC转换。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d11c5b746f524360a278653950ff0d91.png"/>
     <br/>
     <strong>
      创建按键枚举类型：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f4ff016b879c4415a826394affa085ab.png"/>
     <br/>
     <strong>
      定义读取按键：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/5e9af7a885414367bae0484b101fd60c.png"/>
     <br/>
     <strong>
      扫描按键：
     </strong>
     <br/>
     这时按键为短按的情况。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9edf22e4f84a4bb08e11f152d9a8b870.png"/>
     <br/>
     <strong>
      处理长按逻辑：
     </strong>
     <br/>
     处理手柄左上角和右上角的按键长按逻辑，定义time变量记录时间，while判断按键按下且time&lt;12增加time数值，在按键松开或者time&gt;12跳出while，继续执行下面的判断time&lt;=5就是短按，否则为长按，继续使用while判断按键是否松开，最后返回枚举长按值。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/0eb12a228c67479888843d312cde7a17.png"/>
     <br/>
     在将该处while注释后，长按逻辑会有问题，因为在最后松开长按时可能time&lt;=5，
     <strong>
      发生误识别
     </strong>
     ：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2fd0ed13e55a46dc8c0dd545fd7d2905.png"/>
     <br/>
     <strong>
      创建按键扫描任务：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7c0594028dc5488492e363cb0f5a0b06.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9f67eb9a7dc644edaad288c32749e52d.png"/>
     <br/>
     <strong>
      查看串口数据打印正常：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c76ce2aa49884e31b658b060e50dfe16.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f37343736393835342f:61727469636c652f64657461696c732f313436313234353632" class_="artid" style="display:none">
 </p>
</div>


