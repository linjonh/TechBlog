---
layout: post
title: "golang坐标转换-gomap3d库"
date: 2025-03-08 18:02:24 +0800
description: "写了一个坐标转换库，支持Go和c++，大家可以使用提提意见"
keywords: "golang坐标转换 gomap3d库"
categories: ['未分类']
tags: ['天文', '坐标转换', 'Golang']
artid: "146119942"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146119942
    alt: "golang坐标转换-gomap3d库"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146119942
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146119942
cover: https://bing.ee123.net/img/rand?artid=146119942
image: https://bing.ee123.net/img/rand?artid=146119942
img: https://bing.ee123.net/img/rand?artid=146119942
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     golang坐标转换 gomap3d库
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="gomap3d_1">
     </a>
     gomap3d
    </h2>
    <p>
     Go语言实现的多坐标系转换库，支持天文学/航天领域常用坐标系转换 基础算子支持c++
     <br/>
     <a href="https://github.com/PingPongCode/gomap3d">
      gomap3d
     </a>
    </p>
    <h3>
     <a id="_5">
     </a>
     特性
    </h3>
    <ul>
     <li>
      <p>
       支持5种坐标系互转：
      </p>
      <ul>
       <li>
        站心坐标系 (AER)
       </li>
       <li>
        东北天坐标系 (ENU)
       </li>
       <li>
        地心地固坐标系 (ECEF)
       </li>
       <li>
        地心惯性坐标系 (ECI)
       </li>
       <li>
        大地坐标系 (LLA)
       </li>
      </ul>
     </li>
     <li>
      <p>
       支持多种参考椭球体：
      </p>
      <ul>
       <li>
        WGS-84
       </li>
       <li>
        CGCS2000
       </li>
       <li>
        月球
       </li>
       <li>
        火星
       </li>
      </ul>
     </li>
     <li>
      <p>
       精确天文计算：
      </p>
      <ul>
       <li>
        儒略日计算
       </li>
       <li>
        格林威治恒星时
       </li>
       <li>
        ECI/ECEF时变转换
       </li>
      </ul>
     </li>
    </ul>
    <h3>
     <a id="_26">
     </a>
     安装
    </h3>
    <pre><code class="prism language-bash">go get github.com/PingPongCode/gomap3d
</code></pre>
    <h3>
     <a id="_32">
     </a>
     使用示例
    </h3>
    <h4>
     <a id="_34">
     </a>
     基本转换
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"time"</span>
	<span class="token string">"github.com/PingPongCode/gomap3d"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 创建WGS84椭球体</span>
	ell<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> gomap3d<span class="token punctuation">.</span><span class="token function">NewEllipsoid</span><span class="token punctuation">(</span><span class="token string">"wgs84"</span><span class="token punctuation">)</span>

	<span class="token comment">// 大地坐标（北京）</span>
	beijing <span class="token operator">:=</span> gomap3d<span class="token punctuation">.</span>Geodetic<span class="token punctuation">{<!-- --></span>
		Latitude<span class="token punctuation">:</span>  <span class="token number">39.9042</span><span class="token punctuation">,</span> 
		Longitude<span class="token punctuation">:</span> <span class="token number">116.4074</span><span class="token punctuation">,</span>
		Altitude<span class="token punctuation">:</span>  <span class="token number">43.5</span><span class="token punctuation">,</span>
		Ell<span class="token punctuation">:</span>       ell<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 转换为ECEF</span>
	ecef <span class="token operator">:=</span> beijing<span class="token punctuation">.</span><span class="token function">ToECEF</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ECEF坐标: %.2f, %.2f, %.2f\n"</span><span class="token punctuation">,</span> ecef<span class="token punctuation">.</span>X<span class="token punctuation">,</span> ecef<span class="token punctuation">.</span>Y<span class="token punctuation">,</span> ecef<span class="token punctuation">.</span>Z<span class="token punctuation">)</span>

	<span class="token comment">// 转换为ENU（以上海为参考点）</span>
	shanghai <span class="token operator">:=</span> gomap3d<span class="token punctuation">.</span>Geodetic<span class="token punctuation">{<!-- --></span>
		Latitude<span class="token punctuation">:</span>  <span class="token number">31.2304</span><span class="token punctuation">,</span>
		Longitude<span class="token punctuation">:</span> <span class="token number">121.4737</span><span class="token punctuation">,</span>
		Altitude<span class="token punctuation">:</span>  <span class="token number">4.0</span><span class="token punctuation">,</span>
		Ell<span class="token punctuation">:</span>       ell<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	enu <span class="token operator">:=</span> beijing<span class="token punctuation">.</span><span class="token function">ToENU</span><span class="token punctuation">(</span>shanghai<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ENU坐标: 东%.2fm, 北%.2fm, 上%.2fm\n"</span><span class="token punctuation">,</span> enu<span class="token punctuation">.</span>East<span class="token punctuation">,</span> enu<span class="token punctuation">.</span>North<span class="token punctuation">,</span> enu<span class="token punctuation">.</span>Up<span class="token punctuation">)</span>

	<span class="token comment">// 时间相关转换（ECI）</span>
	t <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Date</span><span class="token punctuation">(</span><span class="token number">2023</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>UTC<span class="token punctuation">)</span>
	eci <span class="token operator">:=</span> ecef<span class="token punctuation">.</span><span class="token function">ToECI</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ECI坐标: %.2f, %.2f, %.2f\n"</span><span class="token punctuation">,</span> eci<span class="token punctuation">.</span>X<span class="token punctuation">,</span> eci<span class="token punctuation">.</span>Y<span class="token punctuation">,</span> eci<span class="token punctuation">.</span>Z<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_78">
     </a>
     坐标链转换
    </h4>
    <pre><code class="prism language-go"><span class="token comment">// AER -&gt; ENU -&gt; ECEF -&gt; Geodetic</span>
aer <span class="token operator">:=</span> gomap3d<span class="token punctuation">.</span>AER<span class="token punctuation">{<!-- --></span>
	Azimuth<span class="token punctuation">:</span>   <span class="token number">45.0</span><span class="token punctuation">,</span>
	Elevation<span class="token punctuation">:</span> <span class="token number">30.0</span><span class="token punctuation">,</span>
	SRange<span class="token punctuation">:</span>    <span class="token number">1000.0</span><span class="token punctuation">,</span>
	Ell<span class="token punctuation">:</span>       ell<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

enu <span class="token operator">:=</span> aer<span class="token punctuation">.</span><span class="token function">ToENU</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ecef <span class="token operator">:=</span> enu<span class="token punctuation">.</span><span class="token function">ToECEF</span><span class="token punctuation">(</span>shanghai<span class="token punctuation">)</span>
geo <span class="token operator">:=</span> ecef<span class="token punctuation">.</span><span class="token function">ToGeodetic</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"转换结果: 纬度%.4f°, 经度%.4f°, 高度%.1fm"</span><span class="token punctuation">,</span> 
	geo<span class="token punctuation">.</span>Latitude<span class="token punctuation">,</span> geo<span class="token punctuation">.</span>Longitude<span class="token punctuation">,</span> geo<span class="token punctuation">.</span>Altitude<span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_97">
     </a>
     基本函数
    </h3>
    <p>
     基本函数见base.go,参考pymap3d编写
    </p>
    <pre><code class="prism language-go"><span class="token comment">// ENU2AER 将ENU坐标转换为方位角、仰角和斜距</span>
<span class="token keyword">func</span> <span class="token function">ENU2AER</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> n<span class="token punctuation">,</span> u <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>az<span class="token punctuation">,</span> el<span class="token punctuation">,</span> srange <span class="token builtin">float64</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token comment">// AER2ENU 将方位角、仰角和斜距转换为ENU坐标</span>
<span class="token keyword">func</span> <span class="token function">AER2ENU</span><span class="token punctuation">(</span>az<span class="token punctuation">,</span> el<span class="token punctuation">,</span> srange <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> n<span class="token punctuation">,</span> u <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token comment">// Geodetic2ECEF 将地理坐标转换为ECEF坐标</span>
<span class="token keyword">func</span> <span class="token function">Geodetic2ECEF</span><span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">,</span> alt <span class="token builtin">float64</span><span class="token punctuation">,</span> ell <span class="token operator">*</span>Ellipsoid<span class="token punctuation">)</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token comment">// ECEF2Geodetic 将ECEF坐标转换为地理坐标</span>
<span class="token keyword">func</span> <span class="token function">ECEF2Geodetic</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token builtin">float64</span><span class="token punctuation">,</span> ell <span class="token operator">*</span>Ellipsoid<span class="token punctuation">)</span> <span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">,</span> alt <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token comment">// 天文计算相关函数</span>
<span class="token comment">// juliandate 计算给定时间的儒略日</span>
<span class="token keyword">func</span> <span class="token function">juliandate</span><span class="token punctuation">(</span>t time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token comment">// greenwichsrt 计算格林威治恒星时（弧度）</span>
<span class="token keyword">func</span> <span class="token function">greenwichsrt</span><span class="token punctuation">(</span>jd <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token comment">// rotationMatrix3 生成绕Z轴旋转x弧度的矩阵</span>
<span class="token keyword">func</span> <span class="token function">rotationMatrix3</span><span class="token punctuation">(</span>x <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token comment">// multiplyMatrixVector 矩阵乘以向量</span>
<span class="token keyword">func</span> <span class="token function">multiplyMatrixVector</span><span class="token punctuation">(</span>matrix <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">,</span> vector <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token comment">// ECI2ECEF 将ECI坐标转换为ECEF坐标</span>
<span class="token keyword">func</span> <span class="token function">ECI2ECEF</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token builtin">float64</span><span class="token punctuation">,</span> t time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token punctuation">(</span>xEcef<span class="token punctuation">,</span> yEcef<span class="token punctuation">,</span> zEcef <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token comment">// ECEF2ECI 将ECEF坐标转换为ECI坐标</span>
<span class="token keyword">func</span> <span class="token function">ECEF2ECI</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token builtin">float64</span><span class="token punctuation">,</span> t time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token punctuation">(</span>xEci<span class="token punctuation">,</span> yEci<span class="token punctuation">,</span> zEci <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token comment">// ECEF2ENU 将ECEF坐标转换为ENU坐标</span>
<span class="token keyword">func</span> <span class="token function">ECEF2ENU</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> lat0<span class="token punctuation">,</span> lon0<span class="token punctuation">,</span> h0 <span class="token builtin">float64</span><span class="token punctuation">,</span> ell <span class="token operator">*</span>Ellipsoid<span class="token punctuation">)</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> n<span class="token punctuation">,</span> u <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token comment">// ENU2ECEF 将ENU坐标转换为ECEF坐标</span>
<span class="token keyword">func</span> <span class="token function">ENU2ECEF</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> n<span class="token punctuation">,</span> u<span class="token punctuation">,</span> lat0<span class="token punctuation">,</span> lon0<span class="token punctuation">,</span> h0 <span class="token builtin">float64</span><span class="token punctuation">,</span> ell <span class="token operator">*</span>Ellipsoid<span class="token punctuation">)</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_140">
     </a>
     贡献
    </h3>
    <p>
     欢迎提交Issue和PR。提交代码前请确保：
    </p>
    <ol>
     <li>
      通过所有测试
      <code>
       go test
      </code>
     </li>
     <li>
      添加新功能的测试用例
     </li>
     <li>
      更新相关文档
     </li>
    </ol>
    <h3>
     <a id="_148">
     </a>
     许可证
    </h3>
    <p>
     MIT License
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34343933303933372f:61727469636c652f64657461696c732f313436313139393432" class_="artid" style="display:none">
 </p>
</div>


