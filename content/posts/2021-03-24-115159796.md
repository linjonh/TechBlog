---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f746869737761795f6469792f:61727469636c652f64657461696c732f313135313539373936"
layout: post
title: "嵌入式-C-语言上"
date: 2021-03-24 09:21:09 +08:00
description: "目录基础知识数据类型const 用法作用域与 static 用法"
keywords: "嵌入式c语言"
categories: ['单片机F103开发大全']
tags: ['编程语言', '嵌入式', '单片机', 'C']
artid: "115159796"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=115159796
    alt: "嵌入式-C-语言上"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=115159796
featuredImagePreview: https://bing.ee123.net/img/rand?artid=115159796
---

# 嵌入式 C 语言（上）
#### 目录
* + [基础知识](#_2)
+ [数据类型](#_26)
+ [const 用法](#const__37)
+ [作用域与 static 用法](#_static__106)
+ [extern 用法](#extern__180)
### 基础知识
嵌入式C语言和普通C语言在语法上几乎没有差别，其主要差别在于普通C语言的运行环境是OS之上，有很多的标准库函数支撑调用，分配的内存是电脑的内存，其处理器就是电脑的CPU；而在嵌入式环境中，会涉及到底层的硬件，而硬件本身是没有标准库可以调用的，因而就需要开发者使用C语言编程调试硬件，使其可以工作，对于开发某一款芯片，有针对的编译器（或者交叉编译环境），可以分配的内存则是芯片的RAM、Flash，处理器则是芯片自身带的MCU，例如ARM、DSP等。
例如C语言编程的入门课：打印“Hello World！”，在普通C语言编程中，直接调用printf()函数即可在PC上打印出；而在嵌入式中，则需要开发者使用C语言去将芯片的串口调试成功，然后将printf()函数重新实现，方可调用打印。
嵌入式C语言的基本结构及其特点：
1. 所有的C语言程序都需要包含main()函数，代码从main()函数开始执行；这一条在嵌入式中不一定完
全正确，在执行main()函数之前也有开发者可以操纵的空间，因而开始函数可以不是main()，例如
也可以是myMain()这样的函数，而这所涉及到的知识已经超过基础知识的范围，会在后续详细说
明；
2. C语言的语句以用分号“;”结束；
3. C语言的注释有行注释(“//”)和段注释(“/
*…*
/”)；
4. 函数是C语言的基本结构，每个C程序都是由至少一个函数组成；
5. C语言的文件有两种格式：源文件.c文件和头文件.h文件，通常.c文件用于功能函数的实现，而.h文
件用于预处理、宏定义和声明等；在嵌入式中，通常将某个硬件模块的功能实现函数及其声明和包
含的全局变量声明分别处理到一个.c和.h文件中，例如led.c、hello.c和led.h、hello.h就分别对应于LED
灯的功能函数及其声明和hello的功能函数及其声明；
6. 我们将这种基于某个模块的独立设计称之为模块化设计，在一个系统中通常是由许许多多的模块
共同组成的，因而模块化设计是一个非常科学且非常值得学习的程序设计方法；
7. 除了模块化设计，通常嵌入式的编程设计还有层次化设计。在一个工程系统中，硬件驱动仅仅只是
第一步，对硬件的应用则是一个功能丰富的系统的更进一步的设计，通常在这一块会设计到例如图
像处理、数据处理等算法；我们可以笼统的将一个嵌入式工程系统分为驱动层和应用层。
### 数据类型
在C语言中，数据类型指的是用于声明不同类型的变量或函数的一个广泛的系统，变量的类型决定了变量存储占用的空间以及如何解释存储的位模式。
在嵌入式系统中，芯片的容量是有限的，且对比于PC机容量通常都是比较小的，因而了解变量所占用的存储空间是嵌入式开发者应当掌握的一项技能，所以对于不同数据类型在不同位数的芯片中（例如STM32xxx就表示此款芯片是32bit的芯片，STM8xxx表示此款芯片是8bit的芯片）的长度开发者也应该掌握。
C语言中的数据类型有以下几种：
![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/2f0a6810d68458c23a67f61dc03f7fb6.png)
就以STM32F103ZE这一款芯片为例，这是一块32bit的MCU，基本数据类型在此款芯片中的数据长度，以及在HAL库函数中的定义（stdint.h文件中的定义，采用C99标准）如图 5.3.2 所示。这里建议开发者在开发过程中使用库定义的数据类型，来定义变量或函数，比如unsigned char a，使用uint8\_t a。
![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/e22937a1ed227d98a72905c78512eab9.png)
### const 用法
C语言中const关键字是constant的缩写，译为常量、常数等，但const关键字不仅仅是用于定义常量，还可以用于修饰数组、指针、函数参数等。
**修饰变量**
C语言中使用const修饰变量，功能是对变量声明为只读特性，并保护变量值以防被修改。例如：
```c
const int i = 5;
```
这个例子表明整形变量i具有只读性，不能够被修改；若想对其重新赋值，例如i=10则是错误的用法。需
要注意的是，const定义变量的同时还必须对其初始化，const可以放在数据类型的前面或者后面，比如上述
例子也可以写成：
```c
int const i = 5;
```
此外，const修饰变量还起到了节约空间的目的，通常编译器并不给普通const只读变量分配空间，而是将它们保存在符号列表中，无需读写内存操作，程序执行效率也会提高。
**修饰数组**
C语言中const还可以修饰数组，例如：
```c
const int array[5] = {0, 1, 2, 3, 4};
// 或
int const array[5] = {0, 1, 2, 3, 4};
```
const关键字修饰数组与修饰变量类似，表明此数组具有只读性，不可修改，一旦被更改程序会出错，例
如上述例子如果：
```c
array[1] = 10;
```
则程序将会提示错误。
**修饰指针**
C语言中const修饰指针需要特别注意，共有两种形式，一种是用来限定指向空间的值不可修改；另一种
是限定指针不可修改，例如：
```c
int i = 5;
int k = 10;
int const *p1 = &i
int * const p2 = &k
```
对于指针p1，const修饰的是*p1，即p1指向的空间的值不可改变，例如*p1 = 20;就是错误的用法；但是p1的值是可以改变的，例如p1 = &k则没有任何问题。
对于指针p2，const修饰的是p2，即指针本身p2不可更改，而指针指向空间的值是可以改变的，例如*p2 = 15;是没有问题的，而p2 = &i则是错误的用法。
**修饰函数参数**
在C语言中const修饰函数参数对参数起限定作用，防止其在函数内部被意外修改，所限定的参数可以是
普通变量也可以是指针变量，如：
```c
void fun(const int x)
{
...
x = 10; // 对 x 的值进行了修改，错误
}
void fun1(const int *p)
{
...
(*p)++; // 对 p 指向空间的值进行了修改，错误
}
```
### 作用域与 static 用法
在了解static关键字的用法之前，我们需要先了解C语言中的作用域、局部变量和全局变量的概念。
一个C变量的作用域可以是块作用域、函数作用域、函数原型作用域或文件作用域。
块是用一对花括号“{}”括起来的代码区域，定义在块中的变量具有块作用域。块作用域的可见范围是从定义处到包含该定义的块的末尾。以前，具有块作用域的变量都必须声明在块的开头，C99标准放宽了这一限制，允许在块中的任意位置声明变量。例如不支持C99标准的的for循环需要这样写：
```c
void fun1(void) {
int i = 0;
for(i=0; i<10; i++) {
...
} }
```
在函数fun的开头定义了局部变量i，然后在for循环中调用此变量，变量i的作用域是函数fun内，当函数fun执行完毕之后变量i会被释放。而C99标准下可以这样写：
```c
void fun2(void) {
for(int i = 0; i<10; i++) {
...
}
}
```
这样写的话，变量i的作用域则在for循环体内，当循环结束后，变量就会被释放，可见其作用域缩小了，这样的好处是增加了安全性和灵活性。
在函数fun1中，变量i被声明在函数体内，我们称这样的变量为局部变量，其有效范围是在被定义的函数内，函数执行完毕后变量即被释放；如果把这个变量定义在函数体外，如：
```c
int k = 0;
void fun3(void) {
for(k=0; k<10; k++) {
...
} }
```
我们则将定义在函数体外的变量称之为全局变量，其作用范围为当前源文件和工程，若其它源文件想要调用用此变量需要在文件内使用关键字extern声明，如extern int k。简单的总结下局部变量和全局变量的特点：
1. 局部变量会在每次声明的时候被重新初始化（如果在声明的时候有初始化赋值），不具有记忆能力，
其作用范围仅在某个块作用域可见；
2. 全局变量只会被初始化一次，之后会在程序的某个地方被修改，其作用范围可以是当前的整个源文
件或者工程；
鉴于两种变量的局限性，就引入了静态变量（静态局部变量和静态全局变量），使用关键字static来修饰。其中静态局部变量满足局部变量的作用范围，但是其拥有记忆能力，不会在每次生命的时候都初始化一次，这个作用在用来实现计数功能的时候非常方便，例如：
```c
void cnt(void) {
static int num = 0;
num++; }
```
在这个函数中，变量num就是静态局部变量，在第一次进入cnt函数的时候被声明，然后执行自加操作，num的值就等于1；当第二次进入cnt函数的时候，num不会被重新初始化变成0，而是保持1，再自增则变成了2，以此类推，其作用域仍然是cnt这个函数体内。静态全局变量则将全局变量的作用域缩减到了只当前源文件可见，其它文件不可见，简单例子如下：
```c
static int k = 0;
void set_k(void) { k = 1; }
void reset_k(void) { k = 0; }
int get_k(void) {
return k;
}
```
静态全局变量的优势是增强了程序的安全性和健壮性，因为对于变量k而言，我们假设我们不期望其它的文件有修改变量k的能力，但是其它的文件又需要变量k的值来进行逻辑运算，那我们就可以向上述例子那样做，在源文件中定义一个静态全局变量，同时使用函数对其的值进行修改和获取，对外只提供函数接口即
可，其它文件通过函数接口间接的使用这个变量。这样做同时也可以提高可移植性。
静态全局变量只在本文件可见，因而其它文件也可以定义相同名字的静态局部变量，例如我们可以在source1.c里面定义static int k = 0;的同时也可以在source2.c里面也定义一个static int k = 0;这样做是不会有问题的，但是我们一点都不建议如此做，因为这不利于程序的可读性和可维护性，也容易让开发变得混乱。
在C语言中static关键字除了用来修饰变量之外，还可以用来修饰函数，让函数仅在本文件可见，其它文件无法对其进行调用，例如在example1.c文件里面进行了如下定义：
```c
static void gt_fun(void) {
...
}
```
那么gt\_fun这个函数就只能在example1.c中被调用，在example2.c中就无法调用这个函数。而如果不使 用static来修饰这个函数，那么只需要在example2.c中使用extern关键字写下语句extern void gt\_fun(void)；即可调用gt\_fun这个函数。
在嵌入式C语言编程中，static是一个非常灵活非常好用的关键字，它可以让程序更简洁、更安全、更具有可移植性，在嵌入式系统中这三点都是非常重要的编程思想，需要认真掌握。
### extern 用法
在上一小节有提到过extern这个关键字，那么这节就来详细说一说这个关键字。在C语言中，extern关键字用于指明函数或变量定义在其它文件中，提示编译器遇到此函数或者变量的时候到其它模块去寻找其定义，这样被extern声明的函数或变量就可以被本模块或其它模块使用。因而，extern关键字修饰的函数或者变量是一个声明而不是定义，例如：
```c
/* example.c */
uint16_t a = 0;
uint16_t max(uint16_t i, uint16_t j)
{
return ((i>j)?i:j);
}
```
```c
/* main.c */
#include 
extern uint16_t a;
extern uint16_t max(uint16_t i, uint16_t j);
void main(void) {
printf("a=%d\r\n", a);
printf("Max number between 5 and 9: %d\r\n", max(5, 9)); }
```
extern关键字还有一个重要的作用，就是如果在C++程序中要引用C语言的文件，则需要用以下格式：
```c
#ifdef __cplusplus
extern "C"{
#endif /* #ifdef __cplusplus */
......
#ifdef __cplusplus
}
#endif /* #ifdef __cplusplus */
```
这段代码的含义是，如果当前是C++环境（\_cplusplus是C++编译器中定义的宏），要编译花括号{}里面的内容需要使用C语言的文件格式进行编译，而extern “C”就是向编译器指明这个功能的语句。
百问网技术论坛：
百问网嵌入式视频官网：
百问网开发板：
淘宝：
天猫：
技术交流群（鸿蒙开发/Linux/嵌入式/驱动/资料下载）
QQ群：869222007
单片机-嵌入式Linux交流群：
QQ群：536785813