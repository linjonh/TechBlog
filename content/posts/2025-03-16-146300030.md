---
layout: post
title: "使用python反射,实现pytest读取yaml并发送请求"
date: 2025-03-16 19:42:27 +0800
description: "【代码】使用python反射，实现pytest读取yaml并发送请求。"
keywords: "使用python反射，实现pytest读取yaml并发送请求"
categories: ['Python']
tags: ['Python', 'Pytest']
artid: "146300030"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146300030
    alt: "使用python反射,实现pytest读取yaml并发送请求"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146300030
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146300030
cover: https://bing.ee123.net/img/rand?artid=146300030
image: https://bing.ee123.net/img/rand?artid=146300030
img: https://bing.ee123.net/img/rand?artid=146300030
---

# 使用python反射，实现pytest读取yaml并发送请求
## pytest + yaml
### yaml
- feature: 用户模块
story: 登录
title: 添加用户
request:
method: POST
url: /system/user/list
headers: null
params: null
validate: null
### read\_yaml\_all
def read\_yaml\_all(path):
with open(path, 'r', encoding='utf-8') as f:
value = yaml.safe\_load(f)
return value
### dataclass.py
from dataclasses import dataclass
@dataclass
class CaseInfo:
feature: str
story: str
title: str
request: dict
validate: dict
def verify\_yaml(case\_info: dict):
"""
通过解包的方式，校验yaml格式是否正确
:param case\_info:
:return:
"""
try:
case = CaseInfo(\*\*case\_info)
return case
except Exception:
raise Exception("YAML测试用例不符合规范！")
### test\_yaml\_class.py
from pathlib import Path
import pytest
from lib import read\_yaml\_all, verify\_yaml
class TestYamlCases:
pass
def create\_case\_by\_yaml(yaml\_path):
# 读取yaml
@pytest.mark.parametrize('case', read\_yaml\_all(yaml\_path))
def yaml\_function(self, session, case):
"""
:param self: TestYamlCases类对象
:param session: 夹具
:param case: 参数化
:return:
"""
# 校验yaml格式是否与数据类字段一致
case\_info = verify\_yaml(case)
# 发送请求
session.request(\*\*case\_info.request)
# return方法与def平级，切记
return yaml\_function
test\_case\_yaml\_paths = Path(\_\_file\_\_).parent
case\_yaml\_list = test\_case\_yaml\_paths.glob("\*\*/\*.yaml")
for yaml\_file in case\_yaml\_list:
print(yaml\_file)
print(yaml\_file.stem)
# python 反射，通过反射的方式将pytest的测试用例传入TestYamlCases中
setattr(TestYamlCases, "test\_" + yaml\_file.stem, create\_case\_by\_yaml(yaml\_file))
### 成功
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/d25935893cdb48f7b7c7aec0881c97c6.png)