---
layout: post
title: "Grafana-备份配置文件数据库数据-和-仪表盘定义"
date: 2025-03-15 00:36:57 +0800
description: "三个核心部分。"
keywords: "Grafana 备份配置文件、数据库数据 和 仪表盘定义"
categories: ['未分类']
tags: ['数据库', 'Grafana']
artid: "146271173"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146271173
    alt: "Grafana-备份配置文件数据库数据-和-仪表盘定义"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146271173
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146271173
cover: https://bing.ee123.net/img/rand?artid=146271173
image: https://bing.ee123.net/img/rand?artid=146271173
img: https://bing.ee123.net/img/rand?artid=146271173
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Grafana 备份配置文件、数据库数据 和 仪表盘定义
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     Grafana 的备份需要覆盖
     <strong>
      配置文件
     </strong>
     、
     <strong>
      数据库数据
     </strong>
     和
     <strong>
      仪表盘定义
     </strong>
     三个核心部分。以下是详细的备份方案及操作步骤：
    </p>
    <hr/>
    <h4>
     <a id="_4">
     </a>
     <strong>
      一、配置文件备份
     </strong>
    </h4>
    <h5>
     <a id="1__5">
     </a>
     1. 核心配置文件
    </h5>
    <ul>
     <li>
      <strong>
       路径
      </strong>
      ：
      <code>
       /etc/grafana/grafana.ini
      </code>
      （默认路径）
     </li>
     <li>
      <strong>
       备份命令
      </strong>
      ：
      <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">cp</span> /etc/grafana/grafana.ini /backup/grafana/grafana.ini.bak
</code></pre>
     </li>
    </ul>
    <h5>
     <a id="2_Provisioning__12">
     </a>
     2. Provisioning 配置（数据源/仪表盘预配置）
    </h5>
    <ul>
     <li>
      <strong>
       路径
      </strong>
      ：
      <code>
       /etc/grafana/provisioning/
      </code>
     </li>
     <li>
      <strong>
       备份命令
      </strong>
      ：
      <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">tar</span> <span class="token parameter variable">-czvf</span> /backup/grafana/provisioning.tar.gz /etc/grafana/provisioning/
</code></pre>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_21">
     </a>
     <strong>
      二、数据库备份
     </strong>
    </h4>
    <p>
     Grafana 的元数据（用户、仪表盘、组织等）存储在数据库中，需根据实际数据库类型操作：
    </p>
    <h5>
     <a id="1_SQLite_24">
     </a>
     1.
     <strong>
      SQLite
     </strong>
     （默认数据库）
    </h5>
    <ul>
     <li>
      <strong>
       数据库路径
      </strong>
      ：
      <code>
       /var/lib/grafana/grafana.db
      </code>
     </li>
     <li>
      <strong>
       备份命令
      </strong>
      ：
      <pre><code class="prism language-bash"><span class="token function">sudo</span> sqlite3 /var/lib/grafana/grafana.db <span class="token string">".backup '/backup/grafana/grafana.db.bak'"</span>
</code></pre>
     </li>
    </ul>
    <h5>
     <a id="2_MySQLMariaDB_31">
     </a>
     2.
     <strong>
      MySQL/MariaDB
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       备份命令
      </strong>
      ：
      <pre><code class="prism language-bash">mysqldump <span class="token parameter variable">-u</span> <span class="token punctuation">[</span>用户名<span class="token punctuation">]</span> -p<span class="token punctuation">[</span>密码<span class="token punctuation">]</span> grafana <span class="token operator">&gt;</span> /backup/grafana/grafana_mysql.sql
</code></pre>
     </li>
    </ul>
    <h5>
     <a id="3_PostgreSQL_37">
     </a>
     3.
     <strong>
      PostgreSQL
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       备份命令
      </strong>
      ：
      <pre><code class="prism language-bash">pg_dump <span class="token parameter variable">-U</span> <span class="token punctuation">[</span>用户名<span class="token punctuation">]</span> <span class="token parameter variable">-d</span> grafana <span class="token parameter variable">-f</span> /backup/grafana/grafana_pg.sql
</code></pre>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_45">
     </a>
     <strong>
      三、仪表盘单独备份
     </strong>
    </h4>
    <h5>
     <a id="1__Web__46">
     </a>
     1. 手动导出（通过 Web 界面）
    </h5>
    <ul>
     <li>
      访问仪表盘 → 点击设置（齿轮图标）→
      <strong>
       Export
      </strong>
      → 保存为 JSON 文件。
     </li>
    </ul>
    <h5>
     <a id="2_API__49">
     </a>
     2. 自动化导出（API 批量导出）
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 获取所有仪表盘 UID</span>
<span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-H</span> <span class="token string">"Authorization: Bearer [API_KEY]"</span> http://localhost:3000/api/search <span class="token operator">|</span> jq <span class="token string">'.[].uid'</span> <span class="token operator">&gt;</span> dashboards.list

<span class="token comment"># 批量导出 JSON</span>
<span class="token function">mkdir</span> /backup/grafana/dashboards/
<span class="token keyword">while</span> <span class="token builtin class-name">read</span> uid<span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-H</span> <span class="token string">"Authorization: Bearer [API_KEY]"</span> <span class="token punctuation">\</span>
    http://localhost:3000/api/dashboards/uid/<span class="token variable">$uid</span> <span class="token operator">|</span> jq <span class="token string">'.dashboard'</span> <span class="token operator">&gt;</span> <span class="token string">"/backup/grafana/dashboards/<span class="token variable">${uid}</span>.json"</span>
<span class="token keyword">done</span> <span class="token operator">&lt;</span> dashboards.list
</code></pre>
    <hr/>
    <h4>
     <a id="_64">
     </a>
     <strong>
      四、插件备份
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       插件目录
      </strong>
      ：
      <code>
       /var/lib/grafana/plugins/
      </code>
     </li>
     <li>
      <strong>
       备份命令
      </strong>
      ：
      <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">tar</span> <span class="token parameter variable">-czvf</span> /backup/grafana/plugins.tar.gz /var/lib/grafana/plugins/
</code></pre>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_73">
     </a>
     <strong>
      五、自动化备份脚本
     </strong>
    </h4>
    <pre><code class="prism language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">BACKUP_DIR</span><span class="token operator">=</span><span class="token string">"/backup/grafana/<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d<span class="token variable">)</span></span>"</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$BACKUP_DIR</span>

<span class="token comment"># 备份配置文件</span>
<span class="token function">sudo</span> <span class="token function">cp</span> /etc/grafana/grafana.ini <span class="token variable">$BACKUP_DIR</span>/
<span class="token function">sudo</span> <span class="token function">tar</span> <span class="token parameter variable">-czvf</span> <span class="token variable">$BACKUP_DIR</span>/provisioning.tar.gz /etc/grafana/provisioning/

<span class="token comment"># 备份数据库（以 SQLite 为例）</span>
<span class="token function">sudo</span> sqlite3 /var/lib/grafana/grafana.db <span class="token string">".backup '<span class="token variable">$BACKUP_DIR</span>/grafana.db.bak'"</span>

<span class="token comment"># 备份插件</span>
<span class="token function">sudo</span> <span class="token function">tar</span> <span class="token parameter variable">-czvf</span> <span class="token variable">$BACKUP_DIR</span>/plugins.tar.gz /var/lib/grafana/plugins/

<span class="token comment"># 清理7天前的备份</span>
<span class="token function">find</span> /backup/grafana/ <span class="token parameter variable">-type</span> d <span class="token parameter variable">-mtime</span> +7 <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token punctuation">\</span><span class="token punctuation">;</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_95">
     </a>
     <strong>
      六、恢复流程
     </strong>
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        恢复配置文件
       </strong>
       ：
      </p>
      <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">cp</span> /backup/grafana.ini /etc/grafana/grafana.ini
<span class="token function">sudo</span> <span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> provisioning.tar.gz <span class="token parameter variable">-C</span> /
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        恢复数据库
       </strong>
       ：
      </p>
      <ul>
       <li>
        SQLite：
        <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">cp</span> grafana.db.bak /var/lib/grafana/grafana.db
<span class="token function">sudo</span> <span class="token function">chown</span> grafana:grafana /var/lib/grafana/grafana.db
</code></pre>
       </li>
       <li>
        MySQL：
        <pre><code class="prism language-bash">mysql <span class="token parameter variable">-u</span> <span class="token punctuation">[</span>用户<span class="token punctuation">]</span> -p<span class="token punctuation">[</span>密码<span class="token punctuation">]</span> grafana <span class="token operator">&lt;</span> grafana_mysql.sql
</code></pre>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        恢复插件
       </strong>
       ：
      </p>
      <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> plugins.tar.gz <span class="token parameter variable">-C</span> /
</code></pre>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_120">
     </a>
     <strong>
      七、最佳实践建议
     </strong>
    </h4>
    <ol>
     <li>
      <strong>
       加密敏感数据
      </strong>
      ：备份文件若含密码等敏感信息，建议使用
      <code>
       gpg
      </code>
      加密。
     </li>
     <li>
      <strong>
       异地存储
      </strong>
      ：将备份同步至云存储（如 AWS S3）或异地服务器。
     </li>
     <li>
      <strong>
       定期验证
      </strong>
      ：每季度执行一次恢复演练，确保备份有效性。
     </li>
     <li>
      <strong>
       版本控制
      </strong>
      ：对导出的 JSON 仪表盘使用 Git 管理变更历史。
     </li>
    </ol>
    <p>
     通过此方案，可实现 Grafana 的全量灾备，确保在系统崩溃或误操作时快速恢复服务。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33343036383434302f:61727469636c652f64657461696c732f313436323731313733" class_="artid" style="display:none">
 </p>
</div>


