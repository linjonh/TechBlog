---
layout: post
title: "nagios监控二之监控windows-server服务器"
date: 2025-01-07 13:01:14 +0800
description: "摘要 本文介绍了如何使用nagios通过nsclient监控windows主机。 此次实验环境基于上"
keywords: "window进程监控 nssm sup"
categories: ['Linux']
tags: ['Windows', 'Server', 'Nagios']
artid: "79168806"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=79168806
    alt: "nagios监控二之监控windows-server服务器"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=79168806
featuredImagePreview: https://bing.ee123.net/img/rand?artid=79168806
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     nagios监控（二）之监控windows server服务器
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-github-gist" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <strong>
      摘要
     </strong>
     <br/>
     本文介绍了如何使用nagios通过nsclient监控windows主机。
     <br/>
     此次实验环境基于
     <a href="http://blog.csdn.net/u013562625/article/details/79137811">
      上篇文章
     </a>
     ，监控端在Linux环境下，Windows服务器使用的时windows server 2012。
    </p>
    <p>
     <strong>
      1. 安装NSClient++
     </strong>
     <br/>
     访问
     <a href="http://nsclient.org/nscp/" rel="nofollow">
      http://nsclient.org/nscp/
     </a>
     下载NSClient++，这里我使用的是NSCP-0.4.3.143-x64的msi安装包。下载之后直接安装，过程中会提示输入Nagios监控服务器地址和密码。地址填写正确，密码不用设置。Nagios监控服务器事先在监控Linux服务器时候已经搭建好，需要的小伙伴看
     <a href="http://blog.csdn.net/u013562625/article/details/79137811">
      这里
     </a>
     。
    </p>
    <p>
     <strong>
      2.配置NSClient++
     </strong>
     <br/>
     在 NSClient++ 的安装目录打开 nsclient.ini，将监控服务器的IP地址加到 allowed hosts 指令后面。
     <br/>
     <img alt="这里写图片描述" src="https://img-blog.csdn.net/20180125175521714?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzU2MjYyNQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title="">
      <br/>
      然后检查下12489端口是否正常监听
      <br/>
      netstat -an | more
     </img>
    </p>
    <p>
     因为安装时候需要的模块已经勾选了，所以配置文件中不用再作设置。否则可以通过去掉每个模块前的;来启用该模块。
    </p>
    <p>
     到这里即完成了Windows Server 2012上的配置。接下来我们设置Nagios监控服务器。
    </p>
    <p>
     <strong>
      3.Nagios监控服务器设置
     </strong>
     <br/>
     vi /usr/local/nagios/etc/nagios.cfg
     <br/>
     搜索找到：
     <br/>
     Definitions for monitoring a Windows machine
     <br/>
     cfg_file=/usr/local/nagios/etc/objects/windows.cfg
     <br/>
     将第二行的#去掉打开Nagios监控的Windows模块，然后保存。
     <br/>
     <img alt="这里写图片描述" src="https://img-blog.csdn.net/20180125180434354?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzU2MjYyNQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
    </p>
    <p>
     接着编辑
     <br/>
     找到并设置监控的服务器：
     <br/>
     设置被监控主机名和被监控的Windows服务器地址。
     <br/>
     <strong>
      此地址为Linux服务端的ip地址
     </strong>
    </p>
    <pre class="prettyprint"><code class="hljs applescript">vi /usr/<span class="hljs-keyword">local</span>/nagios/etc/objects/windows.cfg
define host{
use windows-server ; Inherit default values <span class="hljs-keyword">from</span> a template
host_name winserver ; The <span class="hljs-property">name</span> we're giving <span class="hljs-keyword">to</span> this host
<span class="hljs-type">alias</span> My Windows Server ; A longer <span class="hljs-property">name</span> associated <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> host
address <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span> ; IP address <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> host
}</code></pre>
    <p>
     <img alt="这里写图片描述" src="https://img-blog.csdn.net/20180126090631955?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzU2MjYyNQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
    </p>
    <p>
     接下来搜索各种监控的服务并设置：
    </p>
    <pre class="prettyprint"><code class="hljs applescript"><span class="hljs-comment">#监控NSClient版本。</span>
Create a service <span class="hljs-keyword">for</span> monitoring <span class="hljs-keyword">the</span> <span class="hljs-property">version</span> <span class="hljs-keyword">of</span> NSCLient++ <span class="hljs-keyword">that</span> <span class="hljs-keyword">is</span> installed
Change <span class="hljs-keyword">the</span> host_name <span class="hljs-keyword">to</span> match <span class="hljs-keyword">the</span> <span class="hljs-property">name</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> host you defined <span class="hljs-keyword">above</span>

define service{
use generic-service
host_name winserver
service_description NSClient++ Version
check_command check_nt!CLIENTVERSION
}

<span class="hljs-comment">#监控服务器在线时间。</span>
Create a service <span class="hljs-keyword">for</span> monitoring <span class="hljs-keyword">the</span> uptime <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> server
Change <span class="hljs-keyword">the</span> host_name <span class="hljs-keyword">to</span> match <span class="hljs-keyword">the</span> <span class="hljs-property">name</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> host you defined <span class="hljs-keyword">above</span>

define service{
use generic-service
host_name winserver
service_description Uptime
check_command check_nt!UPTIME
}


<span class="hljs-comment">#监控服务器CPU负载。</span>
Create a service <span class="hljs-keyword">for</span> monitoring CPU load
Change <span class="hljs-keyword">the</span> host_name <span class="hljs-keyword">to</span> match <span class="hljs-keyword">the</span> <span class="hljs-property">name</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> host you defined <span class="hljs-keyword">above</span>

define service{
use generic-service
host_name winserver
service_description CPU Load
check_command check_nt!CPULOAD!-l <span class="hljs-number">20</span>,<span class="hljs-number">30</span>,<span class="hljs-number">50</span>
}


<span class="hljs-comment">#监控服务器的内存占用。</span>
 Create a service <span class="hljs-keyword">for</span> monitoring memory usage
 Change <span class="hljs-keyword">the</span> host_name <span class="hljs-keyword">to</span> match <span class="hljs-keyword">the</span> <span class="hljs-property">name</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> host you defined <span class="hljs-keyword">above</span>

define service{
use generic-service
host_name winserver
service_description Memory Usage
check_command check_nt!MEMUSE!-w <span class="hljs-number">80</span> -c <span class="hljs-number">90</span>
}


<span class="hljs-comment">#监控系统C盘的磁盘占用。</span>
Create a service <span class="hljs-keyword">for</span> monitoring C:\ disk usage
Change <span class="hljs-keyword">the</span> host_name <span class="hljs-keyword">to</span> match <span class="hljs-keyword">the</span> <span class="hljs-property">name</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> host you defined <span class="hljs-keyword">above</span>

define service{
use generic-service
host_name winserver
service_description C:\ Drive Space
check_command check_nt!USEDDISKSPACE!-l c -w <span class="hljs-number">80</span> -c <span class="hljs-number">90</span>
}</code></pre>
    <p>
     进入目录 /usr/local/nagios/libexec/
     <br/>
     在nagios监控端验证是否可以监控到windows主机，用命令./check_nt -H 192.168.13.132 -p 12489 -v UPTIME可以检测到Windows服务器已经启动的时长，也表示可以从Windows服务器拿到数据了。
     <br/>
     <img alt="这里写图片描述" src="https://img-blog.csdn.net/20180126093055560?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzU2MjYyNQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
    </p>
    <p>
     现在就可以登录到nagios的web界面，查看你的监控信息了
     <br/>
     <img alt="这里写图片描述" src="https://img-blog.csdn.net/20180126093303518?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzU2MjYyNQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f75303133353632363235:2f61727469636c652f64657461696c732f3739313638383036" class_="artid" style="display:none">
 </p>
</div>


