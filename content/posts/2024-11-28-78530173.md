---
layout: post
title: "个人微信小程序生活服务整体设计"
date: 2024-11-28 10:36:08 +0800
description: "之前在狗东买书凑单买了本微信小程序开发的书，然后不务正业摸索了一下小程序开发，发现还是比较好上手的，"
keywords: "微信 生活服务 程序"
categories: ['微信小程序']
tags: ['微信小程序']
artid: "78530173"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=78530173
    alt: "个人微信小程序生活服务整体设计"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=78530173
featuredImagePreview: https://bing.ee123.net/img/rand?artid=78530173
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     个人微信小程序（生活服务）——整体设计
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     之前在狗东买书凑单买了本微信小程序开发的书，然后不务正业摸索了一下小程序开发，发现还是比较好上手的，我前端知识仅限于一点JS和HTML+CSS，只能一边码一边学了。
    </p>
    <blockquote>
     <p>
      主要用到了几个网上的demo:
      <br/>
      城市切换器：
      <a href="http://www.wxapp-union.com/forum.php?mod=viewthread&amp;tid=10983" rel="nofollow">
       http://www.wxapp-union.com/forum.php?mod=viewthread&amp;tid=10983
      </a>
      <br/>
      豆瓣电影：
      <a href="https://github.com/songhaoreact/weixin">
       https://github.com/songhaoreact/weixin
      </a>
      <br/>
      天气：
      <a href="http://blog.csdn.net/Inite/article/details/74906945">
       http://blog.csdn.net/Inite/article/details/74906945
      </a>
      <br/>
      百度POI：
      <a href="http://lbsyun.baidu.com/index.php?title=wxjsapi/guide/getpoi" rel="nofollow">
       http://lbsyun.baidu.com/index.php?title=wxjsapi/guide/getpoi
      </a>
     </p>
    </blockquote>
    <p>
     新闻页面提交审核未过，则被阉割掉了。
    </p>
    <blockquote>
     <p>
      调用的API（都是支持https的）：
      <br/>
      城市定位：自带+腾讯地图
      <br/>
      豆瓣电影：豆瓣API
      <br/>
      天气：和风天气API
      <br/>
      百度POI：百度API
      <br/>
      新闻：聚合数据新闻API
     </p>
    </blockquote>
    <p>
     <strong>
      代码github地址：
      <a href="https://github.com/imcy/MyWeixin">
       https://github.com/imcy/MyWeixin
      </a>
     </strong>
     <br/>
     <strong>
      小程序二维码：
     </strong>
     <br/>
     微信扫一扫可以直接进入
     <br/>
     <img alt="这里写图片描述" src="https://img-blog.csdn.net/20171206131007116?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzk0ODAxMA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
    </p>
    <p>
     <strong>
      注意在调用API前要看下它是不是支持https，因为微信小程序只允许https的网站接入数据，不然是无法提交上线使用的。
     </strong>
    </p>
    <h4 id="程序目录">
     程序目录
    </h4>
    <p>
     <img alt="这里写图片描述" src="https://img-blog.csdn.net/20171114140623907?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzk0ODAxMA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
    </p>
    <blockquote>
     <p>
      pages：
      <br/>
      index:主页
      <br/>
      map:百度地图页面
      <br/>
      movies:电影
      <br/>
      switchcity:城市切换页面
      <br/>
      weather:天气页面
      <br/>
      news:新闻（被阉割）
      <br/>
      detail:还未实现的新闻详情页
     </p>
    </blockquote>
    <p>
     <strong>
      app.json
     </strong>
     <br/>
     定义上方导航栏和写入所有要用到的页面
    </p>
    <pre class="prettyprint"><code class="language-json hljs">{
  "<span class="hljs-attribute">pages</span>": <span class="hljs-value">[
    <span class="hljs-string">"pages/index/index"</span>,
    <span class="hljs-string">"pages/movies/movies"</span>,
    <span class="hljs-string">"pages/switchcity/switchcity"</span>,
    <span class="hljs-string">"pages/weather/weather"</span>,
    <span class="hljs-string">"pages/news/news"</span>,
    <span class="hljs-string">"pages/detail/detail"</span>,
    <span class="hljs-string">"pages/movies/movie-detail/movie-detail"</span>,
    <span class="hljs-string">"pages/movies/more-movie/more-movie"</span>,
    <span class="hljs-string">"pages/map/map"</span>
  ]</span>,
  "<span class="hljs-attribute">window</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">backgroundTextStyle</span>": <span class="hljs-value"><span class="hljs-string">"light"</span></span>,
    "<span class="hljs-attribute">navigationBarBackgroundColor</span>": <span class="hljs-value"><span class="hljs-string">"#689F38"</span></span>,
    "<span class="hljs-attribute">navigationBarTitleText</span>": <span class="hljs-value"><span class="hljs-string">"蜗牛生活服务"</span></span>,
    "<span class="hljs-attribute">navigationBarTextStyle</span>": <span class="hljs-value"><span class="hljs-string">"white"</span>
  </span>}</span>,
  "<span class="hljs-attribute">tabBar</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">position</span>": <span class="hljs-value"><span class="hljs-string">"top"</span></span>,
    "<span class="hljs-attribute">backgroundColor</span>": <span class="hljs-value"><span class="hljs-string">"#689F38"</span></span>,
    "<span class="hljs-attribute">color</span>": <span class="hljs-value"><span class="hljs-string">"#DCEDC8"</span></span>,
    "<span class="hljs-attribute">selectedColor</span>": <span class="hljs-value"><span class="hljs-string">"#DCEDC8"</span></span>,
    "<span class="hljs-attribute">list</span>": <span class="hljs-value">[
      {
        "<span class="hljs-attribute">pagePath</span>": <span class="hljs-value"><span class="hljs-string">"pages/index/index"</span></span>,
        "<span class="hljs-attribute">text</span>": <span class="hljs-value"><span class="hljs-string">"首页"</span>
      </span>},
      {
        "<span class="hljs-attribute">pagePath</span>": <span class="hljs-value"><span class="hljs-string">"pages/map/map"</span></span>,
        "<span class="hljs-attribute">text</span>": <span class="hljs-value"><span class="hljs-string">"周边"</span>
      </span>},
      {
        "<span class="hljs-attribute">pagePath</span>": <span class="hljs-value"><span class="hljs-string">"pages/movies/movies"</span></span>,
        "<span class="hljs-attribute">text</span>": <span class="hljs-value"><span class="hljs-string">"电影"</span>
      </span>},
      {
        "<span class="hljs-attribute">pagePath</span>": <span class="hljs-value"><span class="hljs-string">"pages/switchcity/switchcity"</span></span>,
        "<span class="hljs-attribute">text</span>": <span class="hljs-value"><span class="hljs-string">"城市"</span>
      </span>},
      {
        "<span class="hljs-attribute">pagePath</span>": <span class="hljs-value"><span class="hljs-string">"pages/weather/weather"</span></span>,
        "<span class="hljs-attribute">text</span>": <span class="hljs-value"><span class="hljs-string">"天气"</span>
      </span>}
    ]
  </span>}
</span>}</code></pre>
    <p>
     <strong>
      app.js
     </strong>
     <br/>
     在原有的里面添加一些全局的变量，以便后面的调用，这样的好处是许多数据只需访问一次API即可（有一些API一天限制访问次数）
    </p>
    <pre class="prettyprint"><code class="language-javascript hljs">  globalData: {
    defaultCity: <span class="hljs-string">'广州市'</span>,
    defaultCounty: <span class="hljs-string">'番禺区'</span>,
    weatherData: <span class="hljs-string">''</span>,
    air: <span class="hljs-string">''</span>,
    day:<span class="hljs-string">''</span>,
    doubanBase: <span class="hljs-string">"https://api.douban.com"</span>,
    curBook:<span class="hljs-string">""</span>
  }</code></pre>
    <p>
     <strong>
      utils
     </strong>
     <br/>
     这里定义了一些需要用到的全局函数
     <br/>
     config.js:用于写入访问腾讯地图的key
    </p>
    <pre class="prettyprint"><code class="hljs fsharp"><span class="hljs-comment">//应写入腾讯地图的key</span>
<span class="hljs-keyword">module</span>.exports = {
  key: <span class="hljs-string">"你申请到的key"</span>,
}</code></pre>
    <p>
     util.js：这里是一些全局的函数，有区县定位的和豆瓣电影
    </p>
    <h4 id="主页">
     主页
    </h4>
    <p>
     主页是这样的，布局是上面一个滚动图片swiper,然后显示定位和天气，最下面显示最近上映的电影
     <br/>
     <img alt="这里写图片描述" src="https://img-blog.csdn.net/20171114140145490?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzk0ODAxMA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
    </p>
    <p>
     <img alt="这里写图片描述" src="https://img-blog.csdn.net/20171114140210582?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzk0ODAxMA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
    </p>
    <h4 id="主页xml文件">
     主页xml文件
    </h4>
    <p>
     <strong>
      滑动的图片
     </strong>
    </p>
    <pre class="prettyprint"><code class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-title">view</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">'customSwiper'</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">swiper</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">'banner'</span> <span class="hljs-attribute">autoplay</span>=<span class="hljs-value">'true'</span> <span class="hljs-attribute">interval</span>=<span class="hljs-value">'2000'</span> <span class="hljs-attribute">duration</span>=<span class="hljs-value">'300'</span> <span class="hljs-attribute">bindchange</span>=<span class="hljs-value">'switchTab'</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">block</span> <span class="hljs-attribute">wx:for</span>=<span class="hljs-value">"{<!-- -->{sliderList}}"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">swiper-item</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">image</span> <span class="hljs-attribute">style</span>=<span class="hljs-value">'width:100%;height:100%;'</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"{<!-- -->{item.imageSource}}"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">image</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">swiper-item</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">block</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">swiper</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">view</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"tab"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">block</span> <span class="hljs-attribute">wx:for</span>=<span class="hljs-value">"{<!-- -->{sliderList}}"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">view</span> <span class="hljs-attribute">wx:if</span>=<span class="hljs-value">"{<!-- -->{item.selected}}"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">'tab-item selected'</span>&gt;</span>{<!-- -->{index+1}}<span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">view</span> <span class="hljs-attribute">wx:else</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"tab-item"</span>&gt;</span>{<!-- -->{index+1}}<span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-title">block</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span></code></pre>
    <p>
     <strong>
      天气定位部分
     </strong>
    </p>
    <pre class="prettyprint"><code class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-title">view</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"index"</span>&gt;</span>
    <span class="hljs-comment">&lt;!--&lt;text&gt;点击地名以更换城市&lt;/text&gt;--&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">view</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"hotcity-common"</span> <span class="hljs-attribute">style</span>=<span class="hljs-value">"display:inline;"</span>&gt;</span>当前位置:  <span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">view</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"thisCityName"</span>&gt;</span>{<!-- -->{location}}{<!-- -->{county}}<span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">view</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"thisCityName"</span> <span class="hljs-attribute">bindtap</span>=<span class="hljs-value">"jump"</span>&gt;</span>更改定位<span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">view</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"content"</span> <span class="hljs-attribute">bindtap</span>=<span class="hljs-value">'gotoWeather'</span>&gt;</span>
    <span class="hljs-comment">&lt;!--显示当天的天气信息--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">view</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"info"</span>&gt;</span>
      <span class="hljs-comment">&lt;!--城市名称 当前日期--&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">view</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"city"</span>&gt;</span>{<!-- -->{location}} ({<!-- -->{today}})<span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
      <span class="hljs-comment">&lt;!--当天温度--&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">view</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"temp"</span>&gt;</span>{<!-- -->{weatherData.tmp}}℃<span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
      <span class="hljs-comment">&lt;!--其他描述--&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">view</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"weather"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">view</span>&gt;</span>{<!-- -->{weatherData.cond_txt}}<span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">view</span>&gt;</span>{<!-- -->{weatherData.wind_dir}}<span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">view</span>&gt;</span>{<!-- -->{weatherData.wind_sc}}<span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">view</span>&gt;</span>PM2.5: {<!-- -->{air.pm25}}<span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">view</span>&gt;</span>{<!-- -->{air.qlty}}<span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">view</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"life"</span>&gt;</span>{<!-- -->{dress.txt}}<span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span></code></pre>
    <p>
     <strong>
      豆瓣电影部分
     </strong>
     <br/>
     这部分比较复杂，调用了豆瓣电影demo里面定义的一些模板
    </p>
    <pre class="prettyprint"><code class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-title">import</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"../movies/movie-list/movie-list-template.wxml"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">import</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"../movies/movie-grid/movie-grid-template.wxml"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">view</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container"</span> <span class="hljs-attribute">wx:if</span>=<span class="hljs-value">"{<!-- -->{containerShow}}"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">view</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"movies-template"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">template</span> <span class="hljs-attribute">is</span>=<span class="hljs-value">"movieListTemplate"</span> <span class="hljs-attribute">data</span>=<span class="hljs-value">"{<!-- -->{...inTheaters}}"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">view</span>&gt;</span></code></pre>
    <p>
     <strong>
      主页wxss
     </strong>
     <br/>
     这里的主色调是原谅色，用到的颜色是#8BC34A，许多都是照着改成这个颜色
    </p>
    <pre class="prettyprint"><code class="language-css hljs"><span class="hljs-comment">/**index.wxss**/</span>
<span class="hljs-at_rule">@<span class="hljs-keyword">import</span> <span class="hljs-string">"../movies/movies.wxss"</span></span>;
<span class="hljs-class">.index</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">min-height</span>:<span class="hljs-value"> <span class="hljs-number">100</span>vh</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-number">24</span>px</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> white</span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-class">.location</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">border</span>:<span class="hljs-value"> <span class="hljs-number">2</span>rpx solid <span class="hljs-hexcolor">#FF5252</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border-radius</span>:<span class="hljs-value"> <span class="hljs-number">30</span>px</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">400</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-number">20</span>rpx auto <span class="hljs-number">40</span>rpx auto</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">10</span>rpx <span class="hljs-number">10</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#FF5252</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-class">.thisCityName</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> inline-block</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border</span>:<span class="hljs-value"> <span class="hljs-number">1</span>rpx solid <span class="hljs-hexcolor">#8BC34A</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border-radius</span>:<span class="hljs-value"> <span class="hljs-number">8</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">10</span>rpx <span class="hljs-number">10</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-number">30</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#8BC34A</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value"> center</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">min-width</span>:<span class="hljs-value"> <span class="hljs-number">149.5</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-number">16</span>rpx</span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-class">.hotcity-common</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-number">30</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#666</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">padding-bottom</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-number">8</span>rpx <span class="hljs-number">0</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">margin-left</span>:<span class="hljs-value"> <span class="hljs-number">16</span>rpx</span></span>;
<span class="hljs-rule">}</span></span>
<span class="hljs-class">.banner</span><span class="hljs-rules">{<!-- --><span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">400</span>px</span></span>;<span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#ddd</span></span></span>;<span class="hljs-rule">}</span></span>

<span class="hljs-class">.customSwiper</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">420</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">position</span>:<span class="hljs-value"> relative</span></span>;
  <span class="hljs-rule">}</span></span>
<span class="hljs-class">.customSwiper</span> <span class="hljs-tag">swiper</span><span class="hljs-rules">{<!-- --><span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">100</span>%</span></span>;<span class="hljs-rule">}</span></span>
<span class="hljs-class">.tab</span><span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">7</span>orpx</span></span>;<span class="hljs-rule"><span class="hljs-attribute">position</span>:<span class="hljs-value"> absolute</span></span>;<span class="hljs-rule"><span class="hljs-attribute">bottom</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value">flex</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">100</span>%</span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value"> center</span></span>;<span class="hljs-rule"><span class="hljs-attribute">justify-content</span>:<span class="hljs-value">center</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">align-items</span>:<span class="hljs-value"> center</span></span>;
<span class="hljs-rule">}</span></span>
<span class="hljs-class">.tab</span> <span class="hljs-class">.tab-item</span><span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#ccc</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">50</span>rpx</span></span>;<span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">50</span>rpx</span></span>;
<span class="hljs-rule"><span class="hljs-attribute">line-height</span>:<span class="hljs-value"> <span class="hljs-number">50</span>rpx</span></span>;<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">12</span>rpx</span></span>;<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#fff</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">border-radius</span>:<span class="hljs-value"> <span class="hljs-number">4</span>px</span></span>;
<span class="hljs-rule"><span class="hljs-attribute">margin-right</span>:<span class="hljs-value"><span class="hljs-number">10</span>px</span></span>;<span class="hljs-rule">}</span></span>
<span class="hljs-class">.tab</span> <span class="hljs-class">.tab-item</span><span class="hljs-class">.selected</span><span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#8BC34A</span></span></span>;<span class="hljs-rule">}</span></span>

<span class="hljs-class">.content</span><span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">100</span>%</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value">flex</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">flex-direction</span>:<span class="hljs-value">column</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">box-sizing</span>:<span class="hljs-value">border-box</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"><span class="hljs-number">15</span>rpx <span class="hljs-number">15</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">margin-left</span>:<span class="hljs-value"> <span class="hljs-number">15</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">margin-right</span>:<span class="hljs-value"> <span class="hljs-number">15</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">margin-top</span>:<span class="hljs-value"> <span class="hljs-number">10</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value">  <span class="hljs-hexcolor">#666</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">15</span>px</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#f5f5f5</span></span></span>;
<span class="hljs-rule">}</span></span>
<span class="hljs-comment">/*当天天气信息*/</span>
<span class="hljs-class">.info</span><span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">margin-top</span>:<span class="hljs-value"><span class="hljs-number">20</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"><span class="hljs-number">100</span>%</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"><span class="hljs-number">200</span>px</span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-comment">/*城市名称*/</span>
<span class="hljs-class">.city</span><span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-number">20</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border-bottom</span>:<span class="hljs-value"><span class="hljs-number">1</span>px solid <span class="hljs-hexcolor">#8BC34A</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-comment">/*当天温度*/</span>
<span class="hljs-class">.temp</span><span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-number">100</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">line-height</span>:<span class="hljs-value"> <span class="hljs-number">130</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value"> center</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">padding-top</span>:<span class="hljs-value"><span class="hljs-number">20</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#8BC34A</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-comment">/*感冒描述*/</span>
<span class="hljs-class">.weather</span><span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">line-height</span>:<span class="hljs-value"> <span class="hljs-number">22</span>px</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-number">20</span>rpx</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">0</span> <span class="hljs-number">10</span>px</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> flex</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">flex-direction</span>:<span class="hljs-value"> row</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">justify-content</span>:<span class="hljs-value">space-around</span></span>;
<span class="hljs-rule">}</span></span>
<span class="hljs-class">.life</span><span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">line-height</span>:<span class="hljs-value"> <span class="hljs-number">22</span>px</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-number">5</span>px <span class="hljs-number">0</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">0</span> <span class="hljs-number">5</span>px</span></span>;
<span class="hljs-rule">}</span></span></code></pre>
    <p>
     <strong>
      主页js
     </strong>
     <br/>
     数据部分,包括滑动栏的图片地址（本地文件夹），天气数据，空气质量，穿衣指数等
    </p>
    <pre class="prettyprint"><code class="language-javascript hljs"><span class="hljs-comment">/**
   * 页面的初始数据
   */</span>
  data: {
    location: <span class="hljs-string">''</span>,
    county: <span class="hljs-string">''</span>,
    sliderList: [
      { selected: <span class="hljs-literal">true</span>, imageSource: <span class="hljs-string">'../../images/1.jpg'</span> },
      { selected: <span class="hljs-literal">false</span>, imageSource: <span class="hljs-string">'../../images/2.jpg'</span> },
      { selected: <span class="hljs-literal">false</span>, imageSource: <span class="hljs-string">'../../images/3.jpg'</span> },
    ],
    today:<span class="hljs-string">""</span>,
    inTheaters: {},
    containerShow: <span class="hljs-literal">true</span>,
    weatherData: <span class="hljs-string">''</span> ,
    air:<span class="hljs-string">''</span>,
    dress:<span class="hljs-string">''</span>
  },</code></pre>
    <p>
     <strong>
      onLoad和onShow函数
     </strong>
     <br/>
     这里用到了日期更新，并调用定位API和豆瓣电影API,onShow则是获取天气和空气质量
    </p>
    <pre class="prettyprint"><code class="language-javascript hljs"><span class="hljs-comment">/**
   * 生命周期函数--监听页面加载
   */</span>
  onLoad: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(options)</span> {<!-- --></span>
    app.globalData.day = util.formatTime(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).split(<span class="hljs-string">' '</span>)[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">this</span>.setData({
      today: app.globalData.day  <span class="hljs-comment">//更新当前日期</span>
    });
    <span class="hljs-keyword">this</span>.getLocation();
    <span class="hljs-keyword">var</span> inTheatersUrl = app.globalData.doubanBase +
      <span class="hljs-string">"/v2/movie/in_theaters"</span> + <span class="hljs-string">"?start=0&amp;count=6"</span>;
    <span class="hljs-keyword">this</span>.getMovieListData(inTheatersUrl, <span class="hljs-string">"inTheaters"</span>, <span class="hljs-string">"正在热映"</span>);
  },
  <span class="hljs-comment">/**
   * 生命周期函数--监听页面显示
   */</span>
  onShow: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {<!-- --></span>
    <span class="hljs-keyword">this</span>.setData({
      location: app.globalData.defaultCity,
      county: app.globalData.defaultCounty
    });
    <span class="hljs-keyword">this</span>.getWeather();
    <span class="hljs-keyword">this</span>.getAir();
  },</code></pre>
    <p>
     访问豆瓣电影api并得到数据进行处理
    </p>
    <pre class="prettyprint"><code class="language-javascript hljs"> getMovieListData: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(url, settedKey, categoryTitle)</span> {<!-- --></span>
    wx.showNavigationBarLoading()
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    wx.request({
      url: url,
      method: <span class="hljs-string">'GET'</span>, <span class="hljs-comment">// OPTIONS, GET, HEAD, POST, PUT, DELETE, TRACE, CONNECT</span>
      header: {
        <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"json"</span>
      },
      success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(res)</span> {<!-- --></span>
        that.processDoubanData(res.data, settedKey, categoryTitle)
      },
      fail: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(error)</span> {<!-- --></span>
        <span class="hljs-comment">// fail</span>
        console.log(error)
      }
    })
  }, 
  processDoubanData: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(moviesDouban, settedKey, categoryTitle)</span> {<!-- --></span>
    <span class="hljs-keyword">var</span> movies = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> idx <span class="hljs-keyword">in</span> moviesDouban.subjects) {
      <span class="hljs-keyword">var</span> subject = moviesDouban.subjects[idx];
      <span class="hljs-keyword">var</span> title = subject.title;
      <span class="hljs-keyword">if</span> (title.length &gt;= <span class="hljs-number">6</span>) {
        title = title.substring(<span class="hljs-number">0</span>, <span class="hljs-number">6</span>) + <span class="hljs-string">"..."</span>;
      }
      <span class="hljs-comment">// [1,1,1,1,1] [1,1,1,0,0]</span>
      <span class="hljs-keyword">var</span> temp = {
        stars: util.convertToStarsArray(subject.rating.stars),
        title: title,
        average: subject.rating.average,
        coverageUrl: subject.images.large,
        movieId: subject.id
      }
      movies.push(temp)
    }
    <span class="hljs-keyword">var</span> readyData = {};
    readyData[settedKey] = {
      categoryTitle: categoryTitle,
      movies: movies
    }
    <span class="hljs-keyword">this</span>.setData(readyData);
    console.log(readyData)
    wx.hideNavigationBarLoading();
  },
  onMoreTap: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> {<!-- --></span>
    wx.switchTab({
      url: <span class="hljs-string">'../movies/movies'</span>
    });
  },</code></pre>
    <p>
     调用腾讯地图API获取定位
    </p>
    <pre class="prettyprint"><code class="language-javascript hljs"><span class="hljs-comment">//定位当前城市的函数</span>
  getLocation: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {<!-- --></span>
    console.log(<span class="hljs-string">"正在定位城市"</span>);
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    wx.getLocation({
      type: <span class="hljs-string">'wgs84'</span>,
      success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(res)</span> {<!-- --></span>
        <span class="hljs-comment">//当前的经度和纬度</span>
        <span class="hljs-keyword">let</span> latitude = res.latitude
        <span class="hljs-keyword">let</span> longitude = res.longitude
        wx.request({
          url: `https:<span class="hljs-comment">//apis.map.qq.com/ws/geocoder/v1/?location=${latitude},${longitude}&amp;key=${config.key}`,</span>
          success: res =&gt; {
            console.log(res);
            app.globalData.defaultCity = res.data.result.ad_info.city;
            app.globalData.defaultCounty=res.data.result.ad_info.district;
            that.setData({
              location: app.globalData.defaultCity,
              county: app.globalData.defaultCounty
            });
            console.log(app.globalData.defaultCity);
            console.log(app.globalData.defaultCounty);
            <span class="hljs-comment">//that.getWeather();</span>
            <span class="hljs-comment">//that.getAir();</span>
          }
        })
      }
    })
  },</code></pre>
    <p>
     <strong>
      获取天气
     </strong>
     <br/>
     访问和风天气的API接口获取天气和空气质量，和风天气非会员可访问到三日天气
    </p>
    <pre class="prettyprint"><code class="language-javascript hljs"><span class="hljs-comment">//获取天气</span>
  getWeather:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>{<!-- --></span>
    <span class="hljs-keyword">var</span> city = <span class="hljs-keyword">this</span>.data.location.slice(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">//分割字符串</span>
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> url = <span class="hljs-string">"https://free-api.heweather.com/s6/weather"</span>;
    <span class="hljs-keyword">var</span> param = {
      key: <span class="hljs-string">"你的key"</span>,
      location: city
    };
    <span class="hljs-comment">//发出请求</span>
    wx.request({
      url: url,
      data: param,
      header: {
        <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'application/json'</span>
      },
      success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(res)</span> {<!-- --></span>
        console.log(res);
        app.globalData.weatherData = res.data.HeWeather6[<span class="hljs-number">0</span>];
        that.setData({
          weatherData: app.globalData.weatherData.now, <span class="hljs-comment">//今天天气情况数组 </span>
          dress: res.data.HeWeather6[<span class="hljs-number">0</span>].lifestyle[<span class="hljs-number">1</span>] <span class="hljs-comment">//生活指数</span>
        });
      }
    })
  },
  getAir: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span>{<!-- --></span>
    <span class="hljs-keyword">var</span> city = <span class="hljs-keyword">this</span>.data.location.slice(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">//分割字符串</span>
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> url = <span class="hljs-string">"https://free-api.heweather.com/s6/air/now"</span>;
    <span class="hljs-keyword">var</span> param = {
      key: <span class="hljs-string">"你的key"</span>,
      location: city
    };
    <span class="hljs-comment">//发出请求</span>
    wx.request({
      url: url,
      data: param,
      header: {
        <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'application/json'</span>
      },
      success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(res)</span> {<!-- --></span>
        console.log(res);
        app.globalData.air = res.data.HeWeather6[<span class="hljs-number">0</span>].air_now_city;
        that.setData({
          air: app.globalData.air
        });
      }
    })
  },</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f75303133393438303130:2f61727469636c652f64657461696c732f3738353330313733" class_="artid" style="display:none">
 </p>
</div>


