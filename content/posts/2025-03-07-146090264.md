---
layout: post
title: "用Ruby的Faraday库来进行网络请求抓取数据"
date: 2025-03-07 10:58:56 +0800
description: "在 Ruby 中，Faraday 是一个非常强大的 HTTP 客户端库，它可以用于发送 HTTP 请求并处理响应。你可以使用 Faraday 来抓取网页数据，处理 API 请求等任务。下面我将向你展示如何使用 Faraday 库进行网络请求，抓取数据并处理响应。"
keywords: "用Ruby的Faraday库来进行网络请求抓取数据"
categories: ['未分类']
tags: ['开发语言', '后端', 'Ruby']
artid: "146090264"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146090264
    alt: "用Ruby的Faraday库来进行网络请求抓取数据"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146090264
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146090264
cover: https://bing.ee123.net/img/rand?artid=146090264
image: https://bing.ee123.net/img/rand?artid=146090264
img: https://bing.ee123.net/img/rand?artid=146090264
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     用Ruby的Faraday库来进行网络请求抓取数据
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在 Ruby 中，
     <code>
      Faraday
     </code>
     是一个非常强大的 HTTP 客户端库，它可以用于发送 HTTP 请求并处理响应。你可以使用
     <code>
      Faraday
     </code>
     来抓取网页数据，处理 API 请求等任务。下面我将向你展示如何使用
     <code>
      Faraday
     </code>
     库进行网络请求，抓取数据并处理响应。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f36b2c1f8622420692df121a43e5f6a5.png#pic_center"/>
    </p>
    <h4>
     <a id="1__Faraday_5">
     </a>
     1.
     <strong>
      安装
      <code>
       Faraday
      </code>
     </strong>
    </h4>
    <p>
     如果你还没有安装
     <code>
      Faraday
     </code>
     ，可以通过
     <code>
      gem
     </code>
     来安装：
    </p>
    <pre><code class="prism language-bash">gem <span class="token function">install</span> faraday
</code></pre>
    <p>
     或者如果你使用
     <code>
      Bundler
     </code>
     ，你可以将其添加到你的
     <code>
      Gemfile
     </code>
     中：
    </p>
    <pre><code class="prism language-ruby">gem <span class="token string-literal"><span class="token string">'faraday'</span></span>
</code></pre>
    <p>
     然后运行：
    </p>
    <pre><code class="prism language-bash">bundle <span class="token function">install</span>
</code></pre>
    <h4>
     <a id="2__Faraday__HTTP__25">
     </a>
     2.
     <strong>
      使用
      <code>
       Faraday
      </code>
      发送 HTTP 请求
     </strong>
    </h4>
    <p>
     以下是使用
     <code>
      Faraday
     </code>
     库的基本示例：
    </p>
    <h5>
     <a id="1__Faraday_29">
     </a>
     (1)
     <strong>
      导入
      <code>
       Faraday
      </code>
     </strong>
    </h5>
    <p>
     首先，你需要导入
     <code>
      Faraday
     </code>
     库：
    </p>
    <pre><code class="prism language-ruby"><span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'faraday'</span></span>
</code></pre>
    <h5>
     <a id="2__GET__37">
     </a>
     (2)
     <strong>
      发送 GET 请求
     </strong>
    </h5>
    <p>
     如果你想发送一个 GET 请求来抓取数据（例如从某个 API 或网站获取内容），可以使用以下代码：
    </p>
    <pre><code class="prism language-ruby"><span class="token comment"># 创建一个 Faraday 客户端</span>
conn <span class="token operator">=</span> <span class="token class-name">Faraday</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token symbol">url</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'https://jsonplaceholder.typicode.com'</span></span><span class="token punctuation">)</span>

<span class="token comment"># 发送 GET 请求，获取一个假数据 API</span>
response <span class="token operator">=</span> conn<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'/posts/1'</span></span><span class="token punctuation">)</span>

<span class="token comment"># 打印响应状态码</span>
puts <span class="token string-literal"><span class="token string">"Status: </span><span class="token interpolation"><span class="token delimiter punctuation">#{<!-- --></span><span class="token content">response<span class="token punctuation">.</span>status</span><span class="token delimiter punctuation">}</span></span><span class="token string">"</span></span>

<span class="token comment"># 打印响应体内容</span>
puts <span class="token string-literal"><span class="token string">"Body: </span><span class="token interpolation"><span class="token delimiter punctuation">#{<!-- --></span><span class="token content">response<span class="token punctuation">.</span>body</span><span class="token delimiter punctuation">}</span></span><span class="token string">"</span></span>
</code></pre>
    <p>
     在这个例子中，我们使用
     <code>
      Faraday.new
     </code>
     创建了一个
     <code>
      conn
     </code>
     对象，设置了请求的基础 URL。然后，使用
     <code>
      get
     </code>
     方法发送一个 GET 请求，获取 JSON 数据。
    </p>
    <ul>
     <li>
      <code>
       response.status
      </code>
      ：打印 HTTP 响应状态码（例如
      <code>
       200
      </code>
      表示成功）。
     </li>
     <li>
      <code>
       response.body
      </code>
      ：打印响应体内容，这是返回的实际数据。
     </li>
    </ul>
    <h5>
     <a id="3__JSON__60">
     </a>
     (3)
     <strong>
      处理 JSON 数据
     </strong>
    </h5>
    <p>
     如果响应体是 JSON 格式的数据，你可以使用
     <code>
      JSON
     </code>
     库解析它：
    </p>
    <pre><code class="prism language-ruby"><span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'faraday'</span></span>
<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'json'</span></span>

conn <span class="token operator">=</span> <span class="token class-name">Faraday</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token symbol">url</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'https://jsonplaceholder.typicode.com'</span></span><span class="token punctuation">)</span>
response <span class="token operator">=</span> conn<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'/posts/1'</span></span><span class="token punctuation">)</span>

<span class="token comment"># 将响应体转换为 Ruby 哈希</span>
data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span>parse<span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span>

<span class="token comment"># 打印返回的数据</span>
puts data
</code></pre>
    <p>
     <code>
      JSON.parse
     </code>
     方法将 JSON 字符串解析为 Ruby 哈希，方便你进一步操作数据。
    </p>
    <h5>
     <a id="4__POST__80">
     </a>
     (4)
     <strong>
      发送 POST 请求
     </strong>
    </h5>
    <p>
     如果你需要发送 POST 请求，可以这样做：
    </p>
    <pre><code class="prism language-ruby"><span class="token comment"># 创建一个 Faraday 客户端</span>
conn <span class="token operator">=</span> <span class="token class-name">Faraday</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token symbol">url</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'https://jsonplaceholder.typicode.com'</span></span><span class="token punctuation">)</span>

<span class="token comment"># 发送 POST 请求，模拟创建一个新的帖子</span>
response <span class="token operator">=</span> conn<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'/posts'</span></span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>req<span class="token operator">|</span>
  req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'Content-Type'</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'application/json'</span></span>
  req<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token symbol">title</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'foo'</span></span><span class="token punctuation">,</span> <span class="token symbol">body</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'bar'</span></span><span class="token punctuation">,</span> <span class="token symbol">userId</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">.</span>to_json
<span class="token keyword">end</span>

<span class="token comment"># 打印响应状态码和返回数据</span>
puts <span class="token string-literal"><span class="token string">"Status: </span><span class="token interpolation"><span class="token delimiter punctuation">#{<!-- --></span><span class="token content">response<span class="token punctuation">.</span>status</span><span class="token delimiter punctuation">}</span></span><span class="token string">"</span></span>
puts <span class="token string-literal"><span class="token string">"Response Body: </span><span class="token interpolation"><span class="token delimiter punctuation">#{<!-- --></span><span class="token content">response<span class="token punctuation">.</span>body</span><span class="token delimiter punctuation">}</span></span><span class="token string">"</span></span>
</code></pre>
    <p>
     这里我们使用
     <code>
      conn.post
     </code>
     来发送 POST 请求，并设置请求头和请求体。请求体通过
     <code>
      to_json
     </code>
     方法转化为 JSON 格式。
    </p>
    <h5>
     <a id="5__101">
     </a>
     (5)
     <strong>
      设置请求头
     </strong>
    </h5>
    <p>
     你可以在请求中设置各种 HTTP 请求头，例如
     <code>
      User-Agent
     </code>
     或
     <code>
      Authorization
     </code>
     头。比如：
    </p>
    <pre><code class="prism language-ruby"><span class="token comment"># 创建 Faraday 客户端</span>
conn <span class="token operator">=</span> <span class="token class-name">Faraday</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token symbol">url</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'https://jsonplaceholder.typicode.com'</span></span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>faraday<span class="token operator">|</span>
  faraday<span class="token punctuation">.</span>adapter Faraday<span class="token punctuation">.</span>default_adapter
<span class="token keyword">end</span>

<span class="token comment"># 发送带有请求头的 GET 请求</span>
response <span class="token operator">=</span> conn<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'/posts/1'</span></span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>req<span class="token operator">|</span>
  req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'User-Agent'</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'MyRubyClient/1.0'</span></span>
<span class="token keyword">end</span>

<span class="token comment"># 打印响应内容</span>
puts response<span class="token punctuation">.</span>body
</code></pre>
    <h5>
     <a id="6__120">
     </a>
     (6)
     <strong>
      处理错误
     </strong>
    </h5>
    <p>
     你可以通过
     <code>
      rescue
     </code>
     来捕获错误，确保程序不会因为请求失败而崩溃。例如，捕获
     <code>
      Faraday::ConnectionFailed
     </code>
     错误：
    </p>
    <pre><code class="prism language-ruby"><span class="token keyword">begin</span>
  response <span class="token operator">=</span> conn<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'/nonexistent_path'</span></span><span class="token punctuation">)</span>
  puts response<span class="token punctuation">.</span>body
<span class="token keyword">rescue</span> Faraday<span class="token double-colon punctuation">::</span>ConnectionFailed <span class="token operator">=&gt;</span> e
  puts <span class="token string-literal"><span class="token string">"Connection failed: </span><span class="token interpolation"><span class="token delimiter punctuation">#{<!-- --></span><span class="token content">e<span class="token punctuation">.</span>message</span><span class="token delimiter punctuation">}</span></span><span class="token string">"</span></span>
<span class="token keyword">end</span>
</code></pre>
    <h4>
     <a id="3__133">
     </a>
     3.
     <strong>
      完整示例：抓取并解析网页内容
     </strong>
    </h4>
    <p>
     假设你想抓取一个网页的 HTML 内容并解析其中的一部分。下面是一个完整的示例，使用
     <code>
      Faraday
     </code>
     获取网页内容并使用
     <code>
      Nokogiri
     </code>
     解析它。
    </p>
    <p>
     首先，安装
     <code>
      nokogiri
     </code>
     （如果还没有安装）：
    </p>
    <pre><code class="prism language-bash">gem <span class="token function">install</span> nokogiri
</code></pre>
    <p>
     然后，你可以编写如下代码：
    </p>
    <pre><code class="prism language-ruby"><span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'faraday'</span></span>
<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'nokogiri'</span></span>

<span class="token comment"># 创建 Faraday 客户端</span>
conn <span class="token operator">=</span> <span class="token class-name">Faraday</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token symbol">url</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'https://www.example.com'</span></span><span class="token punctuation">)</span>

<span class="token comment"># 获取网页 HTML 内容</span>
response <span class="token operator">=</span> conn<span class="token punctuation">.</span>get

<span class="token comment"># 解析 HTML 内容</span>
doc <span class="token operator">=</span> Nokogiri<span class="token double-colon punctuation">::</span><span class="token constant">HTML</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span>

<span class="token comment"># 查找网页中的所有 &lt;h1&gt; 元素</span>
doc<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'h1'</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>h1<span class="token operator">|</span>
  puts h1<span class="token punctuation">.</span>text
<span class="token keyword">end</span>
</code></pre>
    <p>
     在这个例子中，我们使用
     <code>
      Nokogiri::HTML
     </code>
     解析 HTML 内容，并查找所有的
     <code>
      &lt;h1&gt;
     </code>
     标签，将其文本输出到控制台。
    </p>
    <h4>
     <a id="4__166">
     </a>
     4.
     <strong>
      总结
     </strong>
    </h4>
    <p>
     通过
     <code>
      Faraday
     </code>
     库，我们可以非常方便地发送 HTTP 请求（包括 GET、POST 请求），抓取数据，并进行处理。你可以根据具体需求进一步调整请求参数、处理响应数据，以及处理错误。
    </p>
    <h5>
     <a id="_170">
     </a>
     主要功能：
    </h5>
    <ul>
     <li>
      发送 GET 和 POST 请求
     </li>
     <li>
      处理 JSON 和 HTML 响应
     </li>
     <li>
      设置请求头
     </li>
     <li>
      错误处理
     </li>
    </ul>
    <p>
     <code>
      Faraday
     </code>
     是一个功能强大且灵活的 HTTP 客户端库，非常适合用于抓取数据、与 API 进行交互等任务。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34343631373635312f:61727469636c652f64657461696c732f313436303930323634" class_="artid" style="display:none">
 </p>
</div>


