---
layout: post
title: "记Python开发小工具过程"
date: 2022-06-30 15:48:32 +0800
description: "学习开发一个GUI界面，将之打包成exe小工具。这里记录一下整个学习流程。_如何开发一个小工具使项目"
keywords: "如何开发一个小工具使项目从头到尾执行一遍"
categories: ['工具', 'Python']
tags: ['无标签']
artid: "125541624"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=125541624
    alt: "记Python开发小工具过程"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=125541624
featuredImagePreview: https://bing.ee123.net/img/rand?artid=125541624
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     记Python开发小工具过程
    </h1>
   </div>
   <div class="ai-article-tag" id="ai-article-tag">
    <div class="ai-article-tag-box">
     <p class="ai-article-tag-item-active">
      <img alt="" class="item-target" src="https://img-home.csdnimg.cn/images/20240711112329.png"/>
     </p>
     <a class="ai-article-tag-item" data-report-click='{"spm":"3001.10231","extra":{"searchword":"python"}}' data-report-query="spm=1001.2101.3001.10231" data-report-view='{"spm":"3001.10231","extra":{"searchword":"python"}}' href="https://so.csdn.net/so/search/s.do?q=python&amp;t=all&amp;o=vip&amp;s=&amp;l=&amp;f=&amp;viparticle=&amp;from_tracking_code=tag_word&amp;from_code=app_blog_art" target="_blank">
      <span>
       python
      </span>
     </a>
    </div>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     前言
    </h3>
    <p>
     因为压测一个系统，需要大量的id。网上找的工具一次最多生成500个，完全是杯水车薪了。就找了python生成的代码，修改成一次生成36万个，这次够用了。为了方便以后使用，就学习开发一个GUI界面，将之打包成exe小工具。这里记录一下整个学习流程。
     <br/>
     选择使用wxPython配套的开发工具wxFormBuilder，它的图形可视化界面可以快速直观的帮助我搭建起GUI界面。
    </p>
    <h3>
     <a id="wxPython_3">
     </a>
     一、wxPython环境准备
    </h3>
    <p>
     1、wxPython可以从官方网站http://wxpython.org下载，或者使用pip下载wxPython依赖库。
    </p>
    <pre><code class="prism language-python">pip installer wxPython
</code></pre>
    <p>
     2、安装图形可视化生成工具
     <br/>
     wxFormBuilder 是一款开源的跨平台WYSIWYG GUI构建器，可将wxWidget GUI设计转换为C ++，Python，PHP或XML格式。
     <br/>
     github项目地址https://github.com/wxFormBuilder/wxFormBuilder，
     <br/>
     这里下载最新版https://github.com/wxFormBuilder/wxFormBuilder/releases，安装到本地。默认安装。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7ec806939b7a7e297ca15f5f13c1027a.png"/>
    </p>
    <h3>
     <a id="wxFormBuild_13">
     </a>
     二、wxFormBuild创建工具图形可视化界面
    </h3>
    <p>
     1、先选择项目保存代码为python，代码文件名称window。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/aca08e9027aed876b44d3210db76fbe6.png"/>
    </p>
    <p>
     2、选择Frame控件、Layout方式等，这里参考学习：https://blog.csdn.net/abc6368765/article/details/121796397
     <br/>
     https://zhuanlan.zhihu.com/p/107451739?utm_source=wechat_session
     <br/>
     建立以下界面，可以输入年份，选择地区，然后生成，下方可以选择文件夹保存生成的txt文件。
     <br/>
     点击‘开始生成’按钮后，程序开始运行，建立txt文件，进度条实时更新。
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/579ebd4d3d4de7c33630d997948ae64a.png">
      <br/>
      3、建立报错与成功提示弹窗Dialog，在选择错误地址与生成完成时，弹窗提示。
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1b618d3bd31732dd47431d76594cfb4e.png">
       <br/>
       添加事件绑定，按钮与进度条方法
       <br/>
       4、F8保存代码，或者复制python页面的代码使用。
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/fea42b82334513d2d81ce5041f3afb25.png"/>
      </img>
     </img>
    </p>
    <h3>
     <a id="_26">
     </a>
     三、界面方法调试
    </h3>
    <p>
     1、将上面生成的window.py文件放到项目下面，主文件内导入GUI界面
     <br/>
     import window。因为上面自动生成的window.py内容会随着界面变化而变化，所以不要直接修改这个文件。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/26ea8abe0745ec7981a61236ae6221d9.png">
      <br/>
      2、初始化窗口，完善进度条与生成按钮的方法。
      <br/>
      将生成id代码，放在按钮函数下面。（太长就不粘了）
     </img>
    </p>
    <pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python </span>
<span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token keyword">import</span> wx               <span class="token comment">#wxPython</span>
<span class="token keyword">import</span> window


<span class="token keyword">class</span> <span class="token class-name">ff1</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>MyDialog1<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''失败提示弹窗'''</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">:</span>
        window<span class="token punctuation">.</span>MyDialog1<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">ff2</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>MyDialog11<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''成功提示弹窗'''</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">:</span>
        window<span class="token punctuation">.</span>MyDialog11<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">MainWindow</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>sfz<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''主窗口程序'''</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">:</span>
        window<span class="token punctuation">.</span>sfz<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span>parent<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>jindutiao<span class="token operator">=</span><span class="token number">0</span>                           <span class="token comment">#进度条值</span>


    <span class="token keyword">def</span> <span class="token function">m_gauge1OnChar</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''进度条'''</span>
        self<span class="token punctuation">.</span>m_gauge1<span class="token punctuation">.</span>SetValue<span class="token punctuation">(</span>self<span class="token punctuation">.</span>jindutiao<span class="token punctuation">)</span>      <span class="token comment">#更新进度条</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>jindutiao <span class="token operator">==</span> <span class="token number">100</span> <span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>m_button1<span class="token punctuation">.</span>Enable<span class="token punctuation">(</span><span class="token punctuation">)</span>                 <span class="token comment">#启用按钮</span>
            dialog<span class="token operator">=</span>ff2<span class="token punctuation">(</span>main_win<span class="token punctuation">)</span>                    <span class="token comment">#成功弹窗</span>
            dialog<span class="token punctuation">.</span>ShowModal<span class="token punctuation">(</span><span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">gennerator</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        生成按钮：获取年份、地区、保存地址等
        '''</span>
        self<span class="token punctuation">.</span>jindutiao<span class="token operator">=</span><span class="token number">0</span>                        <span class="token comment">#按下按钮，置为0。不报错后续置灰按钮</span>
        year<span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>year1<span class="token punctuation">.</span>GetValue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">#年份   GetValue()返回当前文本框中的所有文案</span>
        where<span class="token operator">=</span>self<span class="token punctuation">.</span>where1<span class="token punctuation">.</span>GetStringSelection<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#地区   GetStringSelection() 返回当前文本框中选中的文本</span>
        <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> bianma<span class="token punctuation">.</span>AREA_INFO<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> value <span class="token operator">==</span> where<span class="token punctuation">:</span>
                AREA2 <span class="token operator">=</span> key                     <span class="token comment">#地区编码</span>

        path<span class="token operator">=</span>self<span class="token punctuation">.</span>path<span class="token punctuation">.</span>GetPath<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">#保存路径判断</span>
        <span class="token keyword">if</span> path <span class="token operator">==</span> <span class="token string">"不选地址，文件默认保存在桌面"</span><span class="token punctuation">:</span>
            path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>expanduser<span class="token punctuation">(</span><span class="token string">"~"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'Desktop'</span><span class="token punctuation">)</span> <span class="token comment">#获取桌面路径</span>
        <span class="token keyword">elif</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>      <span class="token comment">#判断路径是否存在</span>
            path <span class="token operator">=</span> self<span class="token punctuation">.</span>path<span class="token punctuation">.</span>GetPath<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            dialog<span class="token operator">=</span>ff1<span class="token punctuation">(</span>main_win<span class="token punctuation">)</span>                <span class="token comment">#错误提示框</span>
            dialog<span class="token punctuation">.</span>ShowModal<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>jindutiao<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>jindutiao<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">:</span>
            event<span class="token punctuation">.</span>GetEventObject<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Disable<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">#禁用按钮</span>
</code></pre>
    <p>
     3、启动GUI界面
    </p>
    <pre><code class="prism language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app <span class="token operator">=</span> wx<span class="token punctuation">.</span>App<span class="token punctuation">(</span><span class="token punctuation">)</span>                  <span class="token comment">#每一个wxPython应用程序都是一个wx.App实例</span>
    main_win <span class="token operator">=</span> MainWindow<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span>     <span class="token comment">#None表示这个frame是顶层的框架，没有父框架</span>
    main_win<span class="token punctuation">.</span>Show<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>             <span class="token comment">#show()方法激活窗体，True显示这个Frame(窗口)；False，隐藏窗口；</span>
    app<span class="token punctuation">.</span>MainLoop<span class="token punctuation">(</span><span class="token punctuation">)</span>                  <span class="token comment">#运行程序</span>
</code></pre>
    <p>
     4、运行程序，点击生成按钮，程序在桌面成功建立了txt文件，本来以为可以完工了，但工具界面立马提示未响应，程序假死。。。
     <br/>
     <img alt="大家都在发" src="https://i-blog.csdnimg.cn/blog_migrate/4c74314598552d919bfa5b6f56489740.png"/>
    </p>
    <h3>
     <a id="wxpython_101">
     </a>
     四、线程解决wxpython界面无响应假死问题
    </h3>
    <p>
     1、出问题了，百度说计算时间太长，ui界面反应不了，程序就无响应。这当然要解决，思路是调用线程计算耗时的代码，pubsub在线程与界面之间通讯。
     <br/>
     参考：
     <br/>
     https://www.bajins.com/Python/PythonGUI.html#多线程防假死动态刷新界面
     <br/>
     https://blog.csdn.net/rockcandy123/article/details/121310660
    </p>
    <p>
     2、主程序新增pub.subscribe(self.m_gauge1OnChar, “update”)，订阅
    </p>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">MainWindow</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>sfz<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''主窗口程序'''</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">:</span>
        window<span class="token punctuation">.</span>sfz<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span>parent<span class="token punctuation">)</span>
        pub<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span>self<span class="token punctuation">.</span>m_gauge1OnChar<span class="token punctuation">,</span> <span class="token string">"update"</span><span class="token punctuation">)</span><span class="token comment">#发布一个叫update的主题，触发m_gauge1OnChar函数</span>
    <span class="token keyword">def</span> <span class="token function">m_gauge1OnChar</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''进度条'''</span>
        self<span class="token punctuation">.</span>jindutiao <span class="token operator">=</span> event
        self<span class="token punctuation">.</span>m_gauge1<span class="token punctuation">.</span>SetValue<span class="token punctuation">(</span>self<span class="token punctuation">.</span>jindutiao<span class="token punctuation">)</span>      <span class="token comment">#更新进度条</span>
</code></pre>
    <p>
     3、生成程序放线程里面，用pub向GUI发消息。
     <br/>
     经调试，假死问题解决。
    </p>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">TestThread</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''多线程防假死与线程间传递消息'''</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>year<span class="token punctuation">,</span>where<span class="token punctuation">,</span>path<span class="token punctuation">,</span>AREA2<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>year<span class="token operator">=</span>year
        self<span class="token punctuation">.</span>where<span class="token operator">=</span>where
        self<span class="token punctuation">.</span>path<span class="token operator">=</span>path
        self<span class="token punctuation">.</span>AREA2<span class="token operator">=</span>AREA2
        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>         <span class="token comment">#线程实例化时立即启动</span>
        self<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>jindutiao<span class="token operator">=</span><span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""线程执行合成身份证代码"""</span>
       <span class="token triple-quoted-string string">'''计算耗时的代码略'''</span>
            pub<span class="token punctuation">.</span>sendMessage<span class="token punctuation">(</span><span class="token string">"update"</span><span class="token punctuation">,</span> event<span class="token operator">=</span>self<span class="token punctuation">.</span>jindutiao<span class="token punctuation">)</span>     <span class="token comment">#发update消息，指定event参数的值</span>

</code></pre>
    <h3>
     <a id="pyinstaller_142">
     </a>
     五、pyinstaller打包
    </h3>
    <p>
     1、首先安装pyinstaller 包
    </p>
    <pre><code class="prism language-python">pip install pyinstaller
</code></pre>
    <p>
     在代码文件夹内，打开cmd，使用命令打包成一个exe.
    </p>
    <pre><code class="prism language-python">pyinstaller <span class="token operator">-</span>F <span class="token operator">-</span>w <span class="token operator">-</span>i logo<span class="token punctuation">.</span>ico sfz<span class="token punctuation">.</span>py
</code></pre>
    <p>
     生成exe文件在dist里面。但是又发现一个问题，生成的文件偏大，这不能忍。百度去。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d1fcd70407b7fac014d47935ca965570.png">
      <br/>
      2、网上说主要原因是pyinstaller会把python环境中的很多项目没有用到的包都一起打包进去，这样就增大了exe的大小。
      <br/>
      解决方法是使用虚拟环境，如：pipenv库、anaconda创建的虚拟环境
      <br/>
      参考：
      <br/>
      https://blog.csdn.net/yueyi0221/article/details/121717471
      <br/>
      https://zhuanlan.zhihu.com/p/348120084
      <br/>
      3、两个环境都试了，都可以用，打包的程序差不多大小。最后工具9M多点点。
     </img>
    </p>
    <h3>
     <a id="_160">
     </a>
     总结
    </h3>
    <p>
     制作小工具之路，一步一坑，但也学到了wxPython、pub等基础使用，以后再有类似开发相信会更得心应手。
     <br/>
     人生苦短，我学python。
     <br/>
     工具与代码放盘里了，链接：https://pan.baidu.com/s/18sJiBU6cmVOeitVNgjyT1Q
     <br/>
     提取码：b2ie
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34333832303831332f:61727469636c652f64657461696c732f313235353431363234" class_="artid" style="display:none">
 </p>
</div>


