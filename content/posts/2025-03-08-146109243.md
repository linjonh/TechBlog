---
layout: post
title: "可狱可囚的爬虫系列课程-17lxml模块的使用"
date: 2025-03-08 01:32:30 +0800
description: "lxml 是 Python 语言中用于处理 XML 和 HTML 的功能最丰富且易于使用的库。它利用XPath就可以实现对XML和HTML进行数据解析。XML 指可扩展标记语言，XML 是一种很像HTML的标记语言。但是 XML 被设计用来传输和存储数据，HTML 被设计用来显示数据。因为 XML 和 HTML 很像，所以只讲其中一种，另一种大家便可以很简单的融汇贯通。XML长这个样子👇👇👇👇，这是我自己编写的一个 XML 用例。"
keywords: "可狱可囚的爬虫系列课程 17：lxml模块的使用"
categories: ['爬虫']
tags: ['爬虫', 'Python']
artid: "146109243"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146109243
    alt: "可狱可囚的爬虫系列课程-17lxml模块的使用"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146109243
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146109243
cover: https://bing.ee123.net/img/rand?artid=146109243
image: https://bing.ee123.net/img/rand?artid=146109243
img: https://bing.ee123.net/img/rand?artid=146109243
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     可狱可囚的爬虫系列课程 17：lxml模块的使用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atelier-sulphurpool-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在
     <a href="https://blog.csdn.net/weixin_42788769/article/details/135098591">
      可狱可囚的爬虫系列课程 07：BeautifulSoup4（bs4）库的使用
     </a>
     中讲到了使用 CSS 选择器进行数据的爬取，其实还有另一种方式可以更好更快的抓取数据，那就是使用 XPath（XML 路径语言）。至于 XPath 和 CSS 选择器的区别，请听我娓娓道来：
    </p>
    <h3 id="zQUao">
     一、什么是lxml
    </h3>
    lxml 是 Python 语言中用于处理 XML 和 HTML 的功能最丰富且易于使用的库。它利用XPath就可以实现对XML和HTML进行数据解析。
    <h3 id="NGSvN">
     二、什么是XML
    </h3>
    XML 指可扩展标记语言，XML 是一种很像HTML的标记语言。但是 XML 被设计用来传输和存储数据，HTML 被设计用来显示数据。
    <p>
     因为 XML 和 HTML 很像，所以只讲其中一种，另一种大家便可以很简单的融汇贯通。
    </p>
    <p>
     XML长这个样子👇👇👇👇，这是我自己编写的一个 XML 用例。
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>supermarket</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--  这是一条平平无奇的注释  --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>沃尔玛<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>address</span><span class="token punctuation">&gt;</span></span>中国四川成都<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>address</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>staffs</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span> <span class="token attr-name">age</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>20<span class="token punctuation">"</span></span> <span class="token attr-name">sex</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>男<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>张三<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span> <span class="token attr-name">age</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30<span class="token punctuation">"</span></span> <span class="token attr-name">sex</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>男<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>李四<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span> <span class="token attr-name">age</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>23<span class="token punctuation">"</span></span> <span class="token attr-name">gender</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>女<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>王五<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>staffs</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goods</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span> <span class="token attr-name">price</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>啤酒
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>count</span><span class="token punctuation">&gt;</span></span>12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>count</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span> <span class="token attr-name">price</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>饮料
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>count</span><span class="token punctuation">&gt;</span></span>5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>count</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span> <span class="token attr-name">price</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">count</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>矿泉水<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span> <span class="token attr-name">price</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>花生<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span> <span class="token attr-name">price</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>瓜子<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span> <span class="token attr-name">price</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>火腿肠<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goods</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>supermarket</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h3 id="poxJK">
     三、什么是XPath
    </h3>
    XPath是一门在 XML 文档中查找信息的语言，用 XPath 写出的路径表达式可以在 XML 文档中进行导航。
    <p>
     使用 XPath 编写的路径表达式，和我们常使用的相对路径、绝对路径非常相似。那么XPath的语法是怎样的呢，我们一起来看。
    </p>
    <h3 id="jThvw">
     四、XPath语法
    </h3>
    首先先来说下XPath需要理解的概念，有树、节点、根节点、元素节点、属性节点、注释节点、文本节点。
    <ul>
     <li>
      树：整个html或者xml文档。
     </li>
     <li>
      节点：树结构中的每个部分（标签、文本、属性、注释等）就是一个节点。
     </li>
     <li>
      根节点：树结构中的第一个节点就是根节点（网页对应的根节点是html标签）。
     </li>
     <li>
      元素节点：一个标签就是一个元素节点，例如：
      <code>
       &lt;name&gt;沃尔玛&lt;/name&gt;
      </code>
      。
     </li>
     <li>
      属性节点：标签内的一个属性就是一个属性节点，例如：
      <code>
       age="20"
      </code>
      。
     </li>
     <li>
      注释节点：树结构中的一个注释就是一个注释节点，例如：
      <code>
       &lt;!-- 这是一条平平无奇的注释 --&gt;
      </code>
      。
     </li>
     <li>
      文本节点：标签内的文字内容就是一个文本节点，例如：
      <code>
       沃尔玛
      </code>
      。
     </li>
    </ul>
    <p>
     记住这些概念，就能很好的去寻找节点提取内容了。
    </p>
    <h3 id="qa3hc">
     五、解析
    </h3>
    我们需要使用 lxml 模块中的 etree 包提供的 XML 方法或者 HTML 方法针对于字符串类型的 XML 或者 HTML 进行解析，返回一个 _Element 对象，针对 _Element 对象，可以使用 xpath 方法根据路径表达式进行导航。
    <p>
     （1）先看一下如何进行 XML 或 HTML 的解析。
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree

xmlStr <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
&lt;supermarket&gt;
	  &lt;!--  这是一条平平无奇的注释  --&gt;
    &lt;name&gt;沃尔玛&lt;/name&gt;
    &lt;address&gt;中国四川成都&lt;/address&gt;
    &lt;staffs&gt;
        &lt;name age="20" sex="男"&gt;张三&lt;/name&gt;
        &lt;name age="30" sex="男"&gt;李四&lt;/name&gt;
        &lt;name age="23" gender="女"&gt;王五&lt;/name&gt;
    &lt;/staffs&gt;
    &lt;goods&gt;
        &lt;name price="8"&gt;啤酒
            &lt;count&gt;12&lt;/count&gt;
        &lt;/name&gt;
        &lt;name price="3"&gt;饮料
            &lt;count&gt;5&lt;/count&gt;
        &lt;/name&gt;
        &lt;name price="1" count="10"&gt;矿泉水&lt;/name&gt;
        &lt;name price="5"&gt;花生&lt;/name&gt;
        &lt;name price="6"&gt;瓜子&lt;/name&gt;
        &lt;name price="2"&gt;火腿肠&lt;/name&gt;
    &lt;/goods&gt;
&lt;/supermarket&gt;
"""</span>

root <span class="token operator">=</span> etree<span class="token punctuation">.</span>XML<span class="token punctuation">(</span>xmlStr<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
<span class="token comment"># &lt;Element supermarket at 0x1047401c0&gt;</span>
</code></pre>
    <p>
     上述代码通过 etree 中的 XML方法将 XML 文档转化成了一个节点对象，且已经告知我们此处的节点为 supermarket。
    </p>
    <p>
     （2）继续向下看，我们学习 xpath 语法提取具体内容。
    </p>
    <p>
     先来看xpath方法的语法：
     <code>
      节点对象.xpath(路径表达式)
     </code>
    </p>
    <p>
     路径表达式分为绝对路径、相对路径。但是，一般我们都是使用相对路径，所以只需要精通相对路径即可。
    </p>
    <ul>
     <li>
      绝对路径：不管是哪个节点对象在调用xpath方法，都是以
      <code>
       /
      </code>
      开头，然后从根节点开始一层一层写起，节点和节点之间使用。
     </li>
     <li>
      相对路径：哪个节点对象在调用xpath方法，这个节点就使用
      <code>
       .
      </code>
      表示，然后从此处一层一层开始写。
     </li>
    </ul>
    <p>
     注意：节点和节点之间使用
     <code>
      /
     </code>
     间隔，跨越节点要使用
     <code>
      //
     </code>
     。
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 问题一：使用相对路径获取staffs节点下的三个name节点</span>
nameList <span class="token operator">=</span> root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./staffs/name'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>nameList<span class="token punctuation">)</span>
<span class="token comment"># [&lt;Element name at 0x105551940&gt;, &lt;Element name at 0x105551980&gt;, &lt;Element name at 0x1055519c0&gt;]</span>
<span class="token comment"># 结果为上述注释，注意，因为此处的root为supermarket节点，下一级便是staffs节点，此处使用的相对路径，所以.表示的便是supermarket节点</span>

<span class="token comment"># 问题二：使用绝对路径获取staffs节点下的三个name节点</span>
nameList <span class="token operator">=</span> root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'/supermarket/staffs/name'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>nameList<span class="token punctuation">)</span>
<span class="token comment"># [&lt;Element name at 0x105551940&gt;, &lt;Element name at 0x105551980&gt;, &lt;Element name at 0x1055519c0&gt;]</span>

<span class="token comment"># 问题三：获取所有的name节点</span>
nameList <span class="token operator">=</span> root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//name'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>nameList<span class="token punctuation">)</span>
<span class="token comment"># [&lt;Element name at 0x105551a00&gt;, &lt;Element name at 0x105551940&gt;, &lt;Element name at 0x105551980&gt;, &lt;Element name at 0x1055519c0&gt;, &lt;Element name at 0x105551a40&gt;, &lt;Element name at 0x105551ac0&gt;, &lt;Element name at 0x105551b00&gt;, &lt;Element name at 0x105551b40&gt;, &lt;Element name at 0x105551b80&gt;, &lt;Element name at 0x105551a80&gt;]</span>
</code></pre>
    <p>
     在路径的最后添加
     <code>
      /text()
     </code>
     ，可以得到此节点里面的内容；添加
     <code>
      /@属性名
     </code>
     ，可以得到此节点中属性对应的值。
    </p>
    <pre><code class="prism language-python">nameList <span class="token operator">=</span> root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./staffs/name/text()'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>nameList<span class="token punctuation">)</span>
<span class="token comment"># ['张三', '李四', '王五']</span>

sexList <span class="token operator">=</span> root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./staffs/name/@sex'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sexList<span class="token punctuation">)</span>
<span class="token comment"># ['男', '男']</span>
</code></pre>
    <p>
     谓语，在路径中需要添加条件的节点后面添加[]，在[]中写条件。
    </p>
    <ul>
     <li>
      [N]：表示获取第N个节点，从数字1开始。
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token comment"># 获取第二个员工的姓名</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./staffs/name[2]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># ['李四']</span>
</code></pre>
    <ul>
     <li>
      [last()]：表示获取最后一个节点。
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token comment"># 获取倒数第二个员工的姓名</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./staffs/name[last()-1]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># ['李四']</span>
</code></pre>
    <ul>
     <li>
      position()：获取某些位置的标签
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token comment"># 获取前两个员工的年龄</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./staffs/name[position()&lt;=2]/@age'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./staffs/name[position()&lt;3]/@age'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># ['20', '30']</span>

<span class="token comment"># 获取后两个员工的年龄</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./staffs/name[position()&gt;=last()-1]/@age'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./staffs/name[position()&gt;last()-2]/@age'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># ['30', '23']</span>
</code></pre>
    <ul>
     <li>
      [@属性名]
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token comment"># 获取有年龄信息的员工姓名</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./staffs/name[@age]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># ['张三', '李四', '王五']</span>
</code></pre>
    <ul>
     <li>
      [@属性名=属性值]
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token comment"># 获取属性sex="男"的员工的姓名</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./staffs/name[@sex="男"]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># ['张三', '李四']</span>
</code></pre>
    <ul>
     <li>
      [子标签名=值]、[子标签名&gt;值]等
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token comment"># 获取有count子标签且标签内容等于12的父标签的内容</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./goods/name[count=12]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># ['啤酒\n            ', '\n        ']</span>
</code></pre>
    <p>
     分支（
     <strong>
      ｜
     </strong>
     ）：将多个路径选择器使用
     <code>
      |
     </code>
     间隔，同时获取多个元素。
    </p>
    <pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./staffs/name/text()|./staffs/name/@age'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># ['20', '张三', '30', '李四', '23', '王五']</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./staffs/name/text()|./staffs/name/@sex'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># ['男', '张三', '男', '李四', '王五']</span>
</code></pre>
    <p>
     总结，与CSS选择器一样，
     <strong>
      XPath路径选择器也需要灵活运用
     </strong>
     。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34323738383736392f:61727469636c652f64657461696c732f313436313039323433" class_="artid" style="display:none">
 </p>
</div>


