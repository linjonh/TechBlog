---
layout: post
title: "在-CLion-中使用-Google-Test-进行单元测试"
date: 2025-03-06 11:33:44 +0800
description: "本博客将介绍如何在不同平台（Windows、macOS、Linux）上，使用CLion配置Google Test进行C++单元测试，包括安装Google Test、配置CMakeLists.txt、编写和运行测试代码，以及如何测试类和使用测试夹具。"
keywords: "在 CLion 中使用 Google Test 进行单元测试"
categories: ['单元测试']
tags: ['单元测试', 'C']
artid: "146062514"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146062514
    alt: "在-CLion-中使用-Google-Test-进行单元测试"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146062514
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146062514
cover: https://bing.ee123.net/img/rand?artid=146062514
image: https://bing.ee123.net/img/rand?artid=146062514
img: https://bing.ee123.net/img/rand?artid=146062514
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     在 CLion 中使用 Google Test 进行单元测试
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     <strong>
      介绍
     </strong>
    </h3>
    <p>
     Google Test（GTest）是 Google 开源的 C++ 单元测试框架，提供了丰富的断言、测试夹具（Fixtures）和测试管理功能，使 C++ 开发者能够编写高效的单元测试。
    </p>
    <p>
     本博客将介绍如何在不同平台（Windows、macOS、Linux）上，使用 CLion 配置 Google Test 进行 C++ 单元测试，包括安装 Google Test、配置 CMakeLists.txt、编写和运行测试代码，以及如何测试类和使用测试夹具。
    </p>
    <hr/>
    <h3>
     <a id="1__Google_Test_8">
     </a>
     <strong>
      1. 安装 Google Test
     </strong>
    </h3>
    <p>
     Google Test 可以通过以下方式安装：
    </p>
    <h4>
     <a id="_1_12">
     </a>
     <strong>
      方法 1：使用包管理器安装（推荐）
     </strong>
    </h4>
    <p>
     <strong>
      Windows（vcpkg）：
     </strong>
    </p>
    <pre><code class="prism language-sh"><span class="token function">git</span> clone https://github.com/microsoft/vcpkg.git
<span class="token builtin class-name">cd</span> <span class="token function">vcpkg</span>
bootstrap-vcpkg.bat
<span class="token function">vcpkg</span> <span class="token function">install</span> gtest
</code></pre>
    <p>
     也可以直接在 CLion 的 vcpkg 安装 gtest：
    </p>
    <p>
     <img alt="显示 Vcpkg" src="https://i-blog.csdnimg.cn/direct/fc1963d8237c4d03aba024dc593d4118.png"/>
    </p>
    <p>
     <img alt="vcpkg搜索gtest" src="https://i-blog.csdnimg.cn/direct/a0d7c82fc70c4cd38417aacaa6807ec6.png"/>
    </p>
    <p>
     <strong>
      macOS（Homebrew）：
     </strong>
    </p>
    <pre><code class="prism language-sh">brew <span class="token function">install</span> googletest
</code></pre>
    <p>
     <strong>
      Linux（APT）：
     </strong>
    </p>
    <pre><code class="prism language-sh"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> libgtest-dev
</code></pre>
    <p>
     安装完成后，库文件存放在 vcpkg/Homebrew/系统库路径下。
    </p>
    <h4>
     <a id="_2_Git__43">
     </a>
     <strong>
      方法 2：使用 Git 直接拉取源码
     </strong>
    </h4>
    <pre><code class="prism language-sh"><span class="token function">git</span> clone https://github.com/google/googletest.git
<span class="token builtin class-name">cd</span> googletest
<span class="token function">mkdir</span> build <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> build
cmake <span class="token punctuation">..</span> <span class="token parameter variable">-DBUILD_GMOCK</span><span class="token operator">=</span>OFF
cmake <span class="token parameter variable">--build</span> <span class="token builtin class-name">.</span>
</code></pre>
    <h4>
     <a id="_3_53">
     </a>
     <strong>
      方法 3：手动下载和编译
     </strong>
    </h4>
    <p>
     从
     <a href="https://github.com/google/googletest/releases">
      Google Test 官方 GitHub
     </a>
     下载
     <code>
      .zip
     </code>
     源码包，解压后放入你的项目目录。
    </p>
    <hr/>
    <h3>
     <a id="2__CLion__59">
     </a>
     <strong>
      2. 创建 CLion 项目
     </strong>
    </h3>
    <ol>
     <li>
      打开 CLion，选择
      <code>
       New Project
      </code>
      。
     </li>
     <li>
      选择
      <code>
       C++ Executable
      </code>
      ，然后点击
      <code>
       Create
      </code>
      创建一个项目。
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="3__CMakeListstxt_66">
     </a>
     <strong>
      3. 配置 CMakeLists.txt
     </strong>
    </h3>
    <p>
     根据不同安装方式修改
     <code>
      CMakeLists.txt
     </code>
     。
    </p>
    <h4>
     <a id="_1vcpkgHomebrew_70">
     </a>
     <strong>
      方法 1：使用包管理器（vcpkg/Homebrew）
     </strong>
    </h4>
    <p>
     <img alt="配置 CMakeLists" src="https://i-blog.csdnimg.cn/direct/ec8b9c8e5a3d41feb5c48aa91a56b0a0.png"/>
    </p>
    <p>
     如果报错也没事，在输出的地方点击修复就可以了。
    </p>
    <pre><code class="prism language-cmake">cmake_minimum_required(VERSION 3.30)
project(MyTest)

set(CMAKE_CXX_STANDARD 20)

# 查找 Google Test
find_package(GTest REQUIRED)
include_directories(${GTEST_INCLUDE_DIRS})

# 添加测试文件
add_executable(MyTest main.cpp)

# 链接 Google Test 库
target_link_libraries(MyTest GTest::GTest GTest::Main pthread)

# 启用测试
enable_testing()
add_test(NAME MyTest COMMAND MyTest)
</code></pre>
    <h4>
     <a id="_2Git__97">
     </a>
     <strong>
      方法 2：Git 拉取或手动下载
     </strong>
    </h4>
    <pre><code class="prism language-cmake">include(FetchContent)
FetchContent_Declare(
    googletest
    URL https://github.com/google/googletest/archive/refs/heads/main.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(my_test test.cpp)
target_link_libraries(my_test gtest gtest_main)

enable_testing()
</code></pre>
    <hr/>
    <h3>
     <a id="4__115">
     </a>
     <strong>
      4. 编写测试代码
     </strong>
    </h3>
    <p>
     创建
     <code>
      main.cpp
     </code>
     ，编写 Google Test 代码：
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;gtest/gtest.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">int</span> nA<span class="token punctuation">,</span> <span class="token keyword">int</span> nB<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> nA <span class="token operator">+</span> nB<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">TEST</span><span class="token punctuation">(</span>AddTest<span class="token punctuation">,</span> HandlesAddition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token double-colon punctuation">::</span>testing<span class="token double-colon punctuation">::</span><span class="token function">InitGoogleTest</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">RUN_ALL_TESTS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="5__Google_Test_139">
     </a>
     <strong>
      5. 运行 Google Test
     </strong>
    </h3>
    <h4>
     <a id="_1_141">
     </a>
     <strong>
      方法 1：手动运行
     </strong>
    </h4>
    <pre><code class="prism language-sh">cmake <span class="token parameter variable">--build</span> <span class="token builtin class-name">.</span>
./MyTest
</code></pre>
    <h4>
     <a id="_2CLion__148">
     </a>
     <strong>
      方法 2：CLion 直接运行
     </strong>
    </h4>
    <ol>
     <li>
      不能
      <strong>
       右键
       <code>
        main.cpp
       </code>
       ，选择
       <code>
        Run 'main.cpp'
       </code>
      </strong>
      。
     </li>
     <li>
      <strong>
       在 CLion 配置 Google Test
      </strong>
      <ul>
       <li>
        打开
        <strong>
         “Run” &gt; “Edit Configurations…”
        </strong>
       </li>
       <li>
        点击
        <strong>
         “+”
        </strong>
        号，选择
        <strong>
         Google Test
        </strong>
       </li>
       <li>
        选择
        <code>
         Target
        </code>
        ，然后应用并运行
       </li>
      </ul>
     </li>
     <li>
      <strong>
       查看测试结果
      </strong>
      <br/>
      在 CLion 底部的 “Test Runner” 窗口查看测试结果。
     </li>
    </ol>
    <p>
     <img alt="测试结果" src="https://i-blog.csdnimg.cn/direct/d1accd9dc7064323bae4222647593872.png"/>
    </p>
    <hr/>
    <h3>
     <a id="6__Google_Test__162">
     </a>
     <strong>
      6. 处理 Google Test 断言
     </strong>
    </h3>
    <pre><code class="prism language-cpp"><span class="token function">TEST</span><span class="token punctuation">(</span>SampleTest<span class="token punctuation">,</span> Example<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">ASSERT_EQ</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过</span>
    <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 失败，但继续执行</span>
    <span class="token function">ASSERT_EQ</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 失败，测试终止</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="7__Google_Test_Fixtures_174">
     </a>
     <strong>
      7. 使用 Google Test Fixtures（测试夹具）
     </strong>
    </h3>
    <p>
     如果类有状态，可以使用
     <code>
      TEST_F()
     </code>
     共享测试数据。
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">MyTestFixture</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token double-colon punctuation">::</span>testing<span class="token double-colon punctuation">::</span><span class="token class-name">Test</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">SetUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span> nValue <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">TearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
    <span class="token keyword">int</span> nValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">TEST_F</span><span class="token punctuation">(</span>MyTestFixture<span class="token punctuation">,</span> TestAddition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span>nValue <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="8__193">
     </a>
     <strong>
      8. 解决可能遇到的问题
     </strong>
    </h3>
    <h4>
     <a id="_Google_Test_195">
     </a>
     <strong>
      找不到 Google Test
     </strong>
    </h4>
    <ul>
     <li>
      确保
      <code>
       find_package(GTest REQUIRED)
      </code>
      位置正确。
     </li>
     <li>
      使用
      <code>
       vcpkg integrate install
      </code>
      让 CMake 识别
      <code>
       vcpkg
      </code>
      。
     </li>
    </ul>
    <h4>
     <a id="undefined_reference_to_testingInitGoogleTest_200">
     </a>
     <strong>
      链接错误（undefined reference to ‘testing::InitGoogleTest’）
     </strong>
    </h4>
    <ul>
     <li>
      忘记
      <code>
       target_link_libraries(my_test GTest::GTest GTest::Main)
      </code>
     </li>
     <li>
      版本不兼容，尝试
      <code>
       FetchContent
      </code>
      方式获取最新版本。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_207">
     </a>
     <strong>
      总结
     </strong>
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        方法
       </th>
       <th>
        适用情况
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         包管理器（vcpkg/Homebrew/APT）
        </strong>
       </td>
       <td>
        推荐，简单易用
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         Git 方式（FetchContent）
        </strong>
       </td>
       <td>
        适用于不同平台
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         手动下载
        </strong>
       </td>
       <td>
        适用于无法联网的情况
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         使用预编译库
        </strong>
       </td>
       <td>
        适用于固定版本
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         Conan 包管理器
        </strong>
       </td>
       <td>
        适用于大型项目
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     不同的方法适用于不同的需求，你可以根据自己的情况选择最佳方案！🚀
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f35383634383839302f:61727469636c652f64657461696c732f313436303632353134" class_="artid" style="display:none">
 </p>
</div>


