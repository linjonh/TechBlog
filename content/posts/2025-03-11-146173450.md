---
layout: post
title: "QT系列教程19-Qt-MVC结构之QItemDelegate介绍"
date: 2025-03-11 11:04:40 +0800
description: "实现item编辑时特定的效果，比如在item编辑时我们设置一个QSpinBox返回。接下来我们在MainWindow的构造函数里创建两个model和view，我们对其中的一个view使用我们自定义的delegate。updateEditorGeometry是刷新editor的矩形区域，因为随着item变大或者拉伸，它的区域也要随之刷新。setEditorData是在item被双击进入编辑状态时，将model的内容写入editor中。运行程序后，双击两个view的item，可以看到效果的不同。"
keywords: "QT系列教程(19) Qt MVC结构之QItemDelegate介绍"
categories: ['Qt', 'C']
tags: ['开发语言', 'Qt', 'Mvc']
artid: "146173450"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146173450
    alt: "QT系列教程19-Qt-MVC结构之QItemDelegate介绍"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146173450
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146173450
cover: https://bing.ee123.net/img/rand?artid=146173450
image: https://bing.ee123.net/img/rand?artid=146173450
img: https://bing.ee123.net/img/rand?artid=146173450
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     QT系列教程(19) Qt MVC结构之QItemDelegate介绍
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="QItemDelegate_0">
     </a>
     QItemDelegate
    </h3>
    <p>
     当我们想重新实现一个代理时，可以子类化QItemDelegate。实现item编辑时特定的效果，比如在item编辑时我们设置一个QSpinBox返回。
     <br/>
     创建一个QApplication项目，然后我们新增一个类，类名叫做spinboxdelegate。
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">SpinBoxDelegate</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QItemDelegate</span></span>
<span class="token punctuation">{<!-- --></span>
     Q_OBJECT
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">SpinBoxDelegate</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span> parent<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QWidget <span class="token operator">*</span> <span class="token function">createEditor</span><span class="token punctuation">(</span>QWidget<span class="token operator">*</span> parent<span class="token punctuation">,</span>   <span class="token keyword">const</span> QStyleOptionViewItem <span class="token operator">&amp;</span>option<span class="token punctuation">,</span>
                           <span class="token keyword">const</span> QModelIndex <span class="token operator">&amp;</span>index<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">override</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">setEditorData</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>editor<span class="token punctuation">,</span> <span class="token keyword">const</span> QModelIndex <span class="token operator">&amp;</span>index<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">override</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">setModelData</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>editor<span class="token punctuation">,</span> QAbstractItemModel <span class="token operator">*</span>model<span class="token punctuation">,</span> <span class="token keyword">const</span> QModelIndex <span class="token operator">&amp;</span>index<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">override</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">updateEditorGeometry</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>editor<span class="token punctuation">,</span>
                              <span class="token keyword">const</span> QStyleOptionViewItem <span class="token operator">&amp;</span>option<span class="token punctuation">,</span>
                              <span class="token keyword">const</span> QModelIndex <span class="token operator">&amp;</span>index<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">override</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     SpinBoxDelegate类中声明了几个函数，这些函数在QItemDelegate继承而来，通过重写实现我们自己定义的代理功能。
     <br/>
     createEditor函数是在item被双击后进入编辑状态时触发的，返回一个QWidget控件用来管理编辑。
     <br/>
     setModelData是在item被修改后触发的，将改动的内容写入model中。
     <br/>
     setEditorData是在item被双击进入编辑状态时，将model的内容写入editor中。
     <br/>
     updateEditorGeometry是刷新editor的矩形区域，因为随着item变大或者拉伸，它的区域也要随之刷新。
    </p>
    <h3>
     <a id="_27">
     </a>
     具体实现
    </h3>
    <p>
     1 创建editor， 返回一个spinbox
    </p>
    <pre><code class="prism language-cpp">QWidget <span class="token operator">*</span> <span class="token class-name">SpinBoxDelegate</span><span class="token double-colon punctuation">::</span><span class="token function">createEditor</span><span class="token punctuation">(</span>QWidget<span class="token operator">*</span> parent<span class="token punctuation">,</span>   <span class="token keyword">const</span> QStyleOptionViewItem <span class="token operator">&amp;</span>option<span class="token punctuation">,</span>
                                        <span class="token keyword">const</span> QModelIndex <span class="token operator">&amp;</span>index<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{<!-- --></span>
    QSpinBox <span class="token operator">*</span> editor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QSpinBox</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    editor<span class="token operator">-&gt;</span><span class="token function">setMinimum</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    editor<span class="token operator">-&gt;</span><span class="token function">setMaximum</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> editor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     2 在编辑状态时，将model的数据写入editor
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">SpinBoxDelegate</span><span class="token double-colon punctuation">::</span><span class="token function">setEditorData</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>editor<span class="token punctuation">,</span> <span class="token keyword">const</span> QModelIndex <span class="token operator">&amp;</span>index<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> value <span class="token operator">=</span> index<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">data</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>EditRole<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QSpinBox <span class="token operator">*</span> spinBox <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>QSpinBox<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>editor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    spinBox<span class="token operator">-&gt;</span><span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     3 编辑完成时将editor的内容写入model
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">SpinBoxDelegate</span><span class="token double-colon punctuation">::</span><span class="token function">setModelData</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>editor<span class="token punctuation">,</span> QAbstractItemModel <span class="token operator">*</span>model<span class="token punctuation">,</span> <span class="token keyword">const</span> QModelIndex <span class="token operator">&amp;</span>index<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
    QSpinBox <span class="token operator">*</span> spinBox <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>QSpinBox<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>editor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    spinBox<span class="token operator">-&gt;</span><span class="token function">interpretText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> value <span class="token operator">=</span> spinBox<span class="token operator">-&gt;</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token operator">-&gt;</span><span class="token function">setData</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> value<span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>EditRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     4 刷新矩形区域
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">SpinBoxDelegate</span><span class="token double-colon punctuation">::</span><span class="token function">updateEditorGeometry</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>editor<span class="token punctuation">,</span>
                          <span class="token keyword">const</span> QStyleOptionViewItem <span class="token operator">&amp;</span>option<span class="token punctuation">,</span>
                          <span class="token keyword">const</span> QModelIndex <span class="token operator">&amp;</span>index<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
    editor<span class="token operator">-&gt;</span><span class="token function">setGeometry</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>rect<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     接下来我们在MainWindow的构造函数里创建两个model和view，我们对其中的一个view使用我们自定义的delegate
    </p>
    <pre><code class="prism language-cpp"><span class="token class-name">MainWindow</span><span class="token double-colon punctuation">::</span><span class="token function">MainWindow</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent<span class="token punctuation">)</span> <span class="token operator">:</span>
    <span class="token function">QMainWindow</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">ui</span><span class="token punctuation">(</span><span class="token keyword">new</span> Ui<span class="token double-colon punctuation">::</span>MainWindow<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    ui<span class="token operator">-&gt;</span><span class="token function">setupUi</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    QStandardItemModel <span class="token operator">*</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QStandardItemModel</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> row<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> row <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> row<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> column <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> column <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> column<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            QStandardItem <span class="token operator">*</span> item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QStandardItem</span><span class="token punctuation">(</span><span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"%1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>row<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span>column<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            model<span class="token operator">-&gt;</span><span class="token function">setItem</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> column<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

   QTableView<span class="token operator">*</span> _table_view <span class="token operator">=</span> <span class="token keyword">new</span> QTableView<span class="token punctuation">;</span>
    _table_view<span class="token operator">-&gt;</span><span class="token function">setModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setCentralWidget</span><span class="token punctuation">(</span>_table_view<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span><span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    QTableView<span class="token operator">*</span> _table_view2 <span class="token operator">=</span> <span class="token keyword">new</span> QTableView<span class="token punctuation">;</span>
    SpinBoxDelegate <span class="token operator">*</span> delegate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">SpinBoxDelegate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QStandardItemModel <span class="token operator">*</span> model2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QStandardItemModel</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> row<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> row <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> row<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> column <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> column <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> column<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            QStandardItem <span class="token operator">*</span> item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QStandardItem</span><span class="token punctuation">(</span><span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"%1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>row<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span>column<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            model2<span class="token operator">-&gt;</span><span class="token function">setItem</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> column<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
     _table_view2<span class="token operator">-&gt;</span><span class="token function">setModel</span><span class="token punctuation">(</span>model2<span class="token punctuation">)</span><span class="token punctuation">;</span>
     _table_view2<span class="token operator">-&gt;</span><span class="token function">setItemDelegate</span><span class="token punctuation">(</span>delegate<span class="token punctuation">)</span><span class="token punctuation">;</span>
     _table_view2<span class="token operator">-&gt;</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     _table_view2<span class="token operator">-&gt;</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span><span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     运行程序后，双击两个view的item，可以看到效果的不同
     <br/>
     <img alt="https://cdn.llfc.club/1671606628462.jpg" src="https://i-blog.csdnimg.cn/img_convert/fa491cf51d45ea4e2cd1cecdc5ef489a.jpeg"/>
    </p>
    <h3>
     <a id="_102">
     </a>
     源码链接
    </h3>
    <p>
     源码链接
     <br/>
     <a href="https://gitee.com/secondtonone1/qt-learning-notes" rel="nofollow">
      https://gitee.com/secondtonone1/qt-learning-notes
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f7365636f6e64746f6e6f6e65312f:61727469636c652f64657461696c732f313436313733343530" class_="artid" style="display:none">
 </p>
</div>


