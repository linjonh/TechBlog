---
layout: post
title: "蓝桥杯单片机第十五届省赛真题代码题解析-思路整理"
date: 2025-03-12 11:29:11 +0800
description: "蓝桥杯第十五届省赛 代码题 思路整理 【大模板：西风大模板2024版】"
keywords: "【蓝桥杯—单片机】第十五届省赛真题代码题解析 | 思路整理"
categories: ['蓝桥杯']
tags: ['蓝桥杯', '笔记', '学习方法', '单片机', 'C']
artid: "145964840"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=145964840
    alt: "蓝桥杯单片机第十五届省赛真题代码题解析-思路整理"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=145964840
featuredImagePreview: https://bing.ee123.net/img/rand?artid=145964840
cover: https://bing.ee123.net/img/rand?artid=145964840
image: https://bing.ee123.net/img/rand?artid=145964840
img: https://bing.ee123.net/img/rand?artid=145964840
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【蓝桥杯—单片机】第十五届省赛真题代码题解析 | 思路整理
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="_1">
     </a>
     前言
    </h2>
    <p>
     本文是对蓝桥杯第十五届省赛真题的代码题做的解题笔记。
     <br/>
     我在看完西风老师的解析视频后，自己重新写了一遍，做了点整理也加入了一点个人的思考，因此在细节上（比方说：变量名…）会有一点出入。
    </p>
    <p>
     思路参考西风第二十三讲内容（资料链接已经在下方给出）
    </p>
    <blockquote>
     <p>
      https://www.bilibili.com/video/BV1TR4y1k7iz?p=23&amp;vd_source=e2191f89c557f5ac44bb6c7aa3967c7c
     </p>
    </blockquote>
    <p>
     关于蓝桥杯第十五届省赛真题可以在官网查看（资料链接已经在下方给出）
    </p>
    <blockquote>
     <p>
      https://www.lanqiao.cn/courses/2786/learning/?id=2870978&amp;compatibility=false
     </p>
    </blockquote>
    <h2>
     <a id="_11">
     </a>
     赛题代码思路笔记
    </h2>
    <h3>
     <a id="_12">
     </a>
     竞赛板配置
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/435196dc2df0490eaa3d04a46b8154ff.png"/>
    </p>
    <h3>
     <a id="_14">
     </a>
     建立模板
    </h3>
    <p>
     根据赛题中的硬件框图确定本赛题的框架
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/41ca311a3472491891740974e11de8c1.png">
      <br/>
      如图，在Driver文件夹里建立LED、数码管、按键、iic模块（DAC输出）、DS1302，在User文件夹中建立主函数模块（大模板参考西风老师的2024版大模板）。
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/abe3e07269f64d3f96006d4b56fc5b8b.png"/>
     </img>
    </p>
    <h3>
     <a id="_19">
     </a>
     明确基本要求
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f1e474da7614496598234f7af61a792f.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8535a662e1d7401ab4ef50a04238764a.png"/>
     </img>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/direct/cf7d33f9751f45bab220e84c94983f88.png">
      <br/>
      <mark>
       注意1.的内容：
      </mark>
     </img>
    </p>
    <ul>
     <li>
      <strong>
       P34引脚和矩阵按键有冲突
      </strong>
      ，写按键模块（Key.h）时注意屏蔽掉P34=0的情况
     </li>
     <li>
      <strong>
       板子的P34口和SIGNAL的跳帽要接上
      </strong>
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d65af9f83fe34bcab8e7a0d2d2c284ab.png">
      <br/>
      <mark>
       注意2.的内容：
      </mark>
     </img>
    </p>
    <ul>
     <li>
      <strong>
       按键延迟时间要控制在100ms以内
      </strong>
     </li>
    </ul>
    <pre><code class="prism language-c">	<span class="token comment">/*按键10ms的减速*/</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Slow_Down <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Key_Flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/5db6c5e6ee054ccbad0b94d8f80b58d9.png">
      <br/>
      <mark>
       注意第三点的内容：
      </mark>
     </img>
    </p>
    <ul>
     <li>
      <strong>
       数码管延迟时间要控制在100ms以内
      </strong>
     </li>
    </ul>
    <pre><code class="prism language-c">    <span class="token comment">/*数码管90ms的减速*/</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>Slow_Down <span class="token operator">==</span> <span class="token number">90</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Seg_Flag <span class="token operator">=</span> Slow_Down <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f04daec552424ea9a0748e68b818dae4.png"/>
    </p>
    <h3>
     <a id="_55">
     </a>
     显示功能部分
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/854bb80271f140ba92f21e8c92e85bda.png"/>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9753be876c2f467997bea44bd8b5a3dd.png"/>
    </p>
    <ol>
     <li>
      显示部分一共4个界面，定义一个变量
      <strong>
       界面显示模式变量Seg_Disp_Mode
      </strong>
      各个界面。
      <br/>
      后续通过对
      <strong>
       Seg_Disp_Mode
      </strong>
      （界面显示模式变量）的判断切换不同的界面。
     </li>
    </ol>
    <pre><code class="prism language-c"><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Seg_Disp_Mode<span class="token punctuation">;</span>           <span class="token comment">//界面显示模式变量 0-频率界面 1-参数界面 2-时间界面 3-回显界面</span>
</code></pre>
    <pre><code class="prism language-c">	<span class="token keyword">switch</span><span class="token punctuation">(</span>Seg_Disp_Mode<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span><span class="token comment">//频率界面</span>
		
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		
		<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span><span class="token comment">//参数界面</span>
			
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		
		<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span><span class="token comment">//时间界面</span>
			
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		
		<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span><span class="token comment">//回显界面</span>
			
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre>
    <ol start="2">
     <li>
      在显示功能部分中，
      <strong>
       需要显示的字符有：0-9、熄灭、A、F、H、P、-
      </strong>
      ，在seg.c文件段选数组中添加对应的十六进制表示。
     </li>
    </ol>
    <pre><code class="prism language-c">code <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Seg_dula<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0xc0</span><span class="token punctuation">,</span><span class="token number">0xf9</span><span class="token punctuation">,</span><span class="token number">0xa4</span><span class="token punctuation">,</span><span class="token number">0xb0</span><span class="token punctuation">,</span><span class="token number">0x99</span><span class="token punctuation">,</span><span class="token number">0x92</span><span class="token punctuation">,</span><span class="token number">0x82</span><span class="token punctuation">,</span><span class="token number">0xf8</span><span class="token punctuation">,</span><span class="token number">0x80</span><span class="token punctuation">,</span><span class="token number">0x90</span><span class="token punctuation">,</span><span class="token number">0xff</span><span class="token punctuation">,</span><span class="token number">0x88</span><span class="token punctuation">,</span><span class="token number">0x8e</span><span class="token punctuation">,</span><span class="token number">0x89</span><span class="token punctuation">,</span><span class="token number">0x8c</span><span class="token punctuation">,</span><span class="token number">0xBF</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//0-9，10-熄灭,11-A,12-F,13-H,14-P,15--</span>
</code></pre>
    <h4>
     <a id="_96">
     </a>
     频率界面
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a2e385c16743450cb4ca992d1fd09ca5.png"/>
    </p>
    <p>
     频率界面由三部分组成：
    </p>
    <ul>
     <li>
      <strong>
       第一部分
      </strong>
      为编号（
      <strong>
       Seg_Buf[0]
      </strong>
      ），在该界面下全程显示字母F。
     </li>
     <li>
      <strong>
       第二部分
      </strong>
      熄灭部分(
      <strong>
       Seg_Buf[1] - Seg_Buf[2]
      </strong>
      )，在该界面下全程熄灭。
     </li>
     <li>
      <strong>
       第三部分
      </strong>
      为频率显示部分(
      <strong>
       Seg_Buf[3] - Seg_Buf[7]
      </strong>
      )，用NE555实时计算频率。
     </li>
    </ul>
    <h5>
     <a id="_103">
     </a>
     正常显示
    </h5>
    <p>
     在
     <strong>
      数码管显示数组
     </strong>
     （
     <strong>
      Seg_Buf[]
     </strong>
     ）对应的数码管中输入要显示的字符在seg.c文件
     <strong>
      段选数组
     </strong>
     （
     <strong>
      Seg_dula[]
     </strong>
     ）对应的十六进制表示的位置。
    </p>
    <pre><code class="prism language-c">			Seg_Buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span><span class="token comment">//F</span>
		  	Seg_Buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> Freq <span class="token operator">/</span> <span class="token number">10000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
		  	Seg_Buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> Freq <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
		  	Seg_Buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> Freq <span class="token operator">/</span> <span class="token number">100</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> Freq <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> Freq <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre>
    <h5>
     <a id="_114">
     </a>
     高位熄灭
    </h5>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4d960d6b80604636aeead5430a33412b.png"/>
     <br/>
     用
     <strong>
      while循环
     </strong>
     从
     <strong>
      高位开始检测
     </strong>
     ，当高位是0时，将该位置的数码管置为熄灭状态。
    </p>
    <p>
     <mark>
      注意：
     </mark>
     <br/>
     <strong>
      显示最小为0
     </strong>
     ，即
     <strong>
      数码管的最后一位（Seg_Buf[7]）不论是否为0都要保证正常显示
     </strong>
     ，所以在while循环中不对最后一位检测。
    </p>
    <pre><code class="prism language-c">	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>

 <span class="token comment">/*高位为0时熄灭*/</span>
		  <span class="token keyword">while</span><span class="token punctuation">(</span>Seg_Buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Seg_Buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>i <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		  <span class="token keyword">break</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="_132">
     </a>
     参数界面
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/0dc81b7cc4c245569ca8693dba49d274.png"/>
     <br/>
     参数界面中又有
     <strong>
      两个子界面
     </strong>
     ，定义
     <strong>
      参数界面模式变量Seg_DM1_Mode
     </strong>
     对两个子界面标记。
    </p>
    <pre><code class="prism language-c">bit Seg_DM1_Mode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                      <span class="token comment">//参数界面模式变量 0-超限参数界面 1-校准值参数界面</span>
</code></pre>
    <p>
     定义
     <strong>
      参数数组Seg_Set_Arr
     </strong>
     ，存储两个界面下的参数值。
     <br/>
     介于校准值界面的参数值有负数的情况，可以将参数数组（Seg_Set_Arr）直接定义为有符号的数组，后续只要对校准值变量的正负进行判断就可以确定校准值的符号位要不要点亮。
    </p>
    <pre><code class="prism language-c"><span class="token keyword">int</span> Seg_Set_Arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">2000</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>         <span class="token comment">//参数数组 [0]-超限参数 [1]-校准值变量</span>
</code></pre>
    <h5>
     <a id="_146">
     </a>
     基础写法：两个界面分开来写
    </h5>
    <ol>
     <li>
      <strong>
       if 判断当前子界面
      </strong>
      ：Seg_DM1_Mode（参数界面模式变量）为0，处于超限参数界面；反之，处于校准值参数界面。
     </li>
     <li>
      在
      <strong>
       超限参数界面
      </strong>
      （逻辑和频率界面的正常显示部分相同，不再赘述）
     </li>
     <li>
      在
      <strong>
       校准值参数界面
      </strong>
      时：
      <br/>
      用if检测校准值，分为
      <strong>
       校准值参数不为0
      </strong>
      和
      <strong>
       校准值参数为0
      </strong>
      两种情况。
      <br/>
      当
      <strong>
       校准值参数不为0
      </strong>
      时：用一组 if 判断校准值的正负性，
      <strong>
       先确定符号位
      </strong>
      ，再对数值进行显示。
      <br/>
      注意：校准值是有符号的数据，要取出各位数可以对他先取它的绝对值（
      <strong>
       math.h文件中的abs函数
      </strong>
      ）
      <br/>
      当校准值参数为0时：显示一位0。
     </li>
    </ol>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"math.h"</span>  <span class="token comment">//abs函数</span></span>
</code></pre>
    <pre><code class="prism language-c"> 		    <span class="token keyword">if</span><span class="token punctuation">(</span>Seg_DM1_Mode <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//超限参数界面</span>
			<span class="token punctuation">{<!-- --></span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Set_Arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span><span class="token number">1000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Set_Arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span><span class="token number">100</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Set_Arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span><span class="token number">10</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Set_Arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span><span class="token comment">//校准值参数界面</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token comment">/*确定符号位*/</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
						Seg_Buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span><span class="token comment">//-</span>
					<span class="token keyword">else</span> 
						Seg_Buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">//熄灭</span>
					
					
					Seg_Buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token number">100</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				 	Seg_Buf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token number">10</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				  	Seg_Buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					Seg_Buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Buf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
				  	Seg_Buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>				
			<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_191">
     </a>
     优化写法：两个界面合一起写
    </h5>
    <p>
     <em>
      （这个部分是我对本套题解析视频做的笔记，西风老师这个写法的思路真的蛮好的）
     </em>
    </p>
    <p>
     先看到具体代码：
    </p>
    <pre><code class="prism language-c">		Seg_Buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">;</span><span class="token comment">//P</span>
		Seg_Buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">)</span>Seg_DM1_Mode<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
		Seg_Buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	    Seg_Buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_DM1_Mode<span class="token operator">?</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">+</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">abs</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token number">1000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
		Seg_Buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token number">100</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
	    Seg_Buf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token number">10</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
		Seg_Buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
		  
		  <span class="token comment">/*校准值为0时，只显示一位0*/</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Buf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     优化写法重点在于：
    </p>
    <ol>
     <li>
      <strong>
       Seg_DM1_Mode（参数界面模式变量）和显示相关变量的代数关系
      </strong>
     </li>
     <li>
      <strong>
       条件运算符
      </strong>
     </li>
    </ol>
    <blockquote>
     <p>
      简单回顾一下条件运算符：
      <br/>
      <strong>
       &lt;表达式1&gt;?&lt;表达式2&gt;:&lt;表达式3&gt;
      </strong>
      <br/>
      当表达式1为真，返回表达式2的值;如果为假，则返回表达式3的值。
     </p>
    </blockquote>
    <p>
     基础的显示不再赘述，在此对
     <strong>
      Seg_Buf[1]
     </strong>
     和
     <strong>
      Seg_Buf[4]
     </strong>
     做简单的分析：
    </p>
    <ol>
     <li>
      <strong>
       Seg_Buf[1]：
      </strong>
      <br/>
      由题目所给信息可知，
      <strong>
       Seg_Buf[1]在1和2之间变化，对应的是两个子界面
      </strong>
      。
      <br/>
      在此前我们已经给这两个界面定义好了
      <strong>
       标志变量Seg_DM1_Mode（参数界面模式变量），它在0和1之间变化
      </strong>
      。
      <br/>
      不难得出，Seg_Buf[1]和Seg_DM1_Mode之间的
      <strong>
       代数关系
      </strong>
      ，即
      <strong>
       Seg_Buf[1]的值比Seg_DM1_Mode大1
      </strong>
      。
      <br/>
      <mark>
       注意：
      </mark>
      <strong>
       Seg_DM1_Mode是bit型数据
      </strong>
      ，不能到达2，所以让Seg_DM1_Mode直接+1不能达到效果。那么需要解决的问题是
      <strong>
       增大它数值的可变区间
      </strong>
      ，可以用强制类型转换。
     </li>
     <li>
      <strong>
       Seg_Buf[4]：
      </strong>
      <br/>
      <strong>
       Seg_Buf[4]对应了两种显示状态
      </strong>
      ，即
      <strong>
       超限参数界面下的高位
      </strong>
      和
      <strong>
       校准值参数界面下的符号位
      </strong>
      。
      <br/>
      用
      <strong>
       条件运算符对Seg_DM1_Mode（参数界面模式变量）进行判断，可以划分出两种状态
      </strong>
      ，即当Seg_DM1_Mode为真（Seg_DM1_Mode为1）时，是校准值参数界面；当Seg_DM1_Mode为假（Seg_DM1_Mode为0）时，是超限参数界面。
      <br/>
      那么，只要
      <strong>
       找出Seg_Buf[4]在两种显示状态下的数值在段选数组（Seg.h文件下的Seg_dula[]）中的位置
      </strong>
      就可以完成显示。
      <br/>
      当
      <strong>
       Seg_Buf[4]在超限参数界面下的高位状态
      </strong>
      时（
      <strong>
       Seg_DM1_Mode为0
      </strong>
      ）：只要
      <strong>
       获取超限参数（Seg_Set_Arr[0]）的最高位
      </strong>
      就行。
      <br/>
      当
      <strong>
       Seg_Buf[4]在校准值参数界面下的符号位状态
      </strong>
      时（
      <strong>
       Seg_DM1_Mode为1
      </strong>
      ）：Seg_Buf[4]在Seg_Set_Arr[1]（校准值参数）为正，Seg_Buf[4]不点亮；Seg_Set_Arr[1]（校准值参数）为负，Seg_Buf[4]才点亮，显示符号位。所以还要
      <strong>
       找熄灭对应的位置和负号对应的位置之间的关系
      </strong>
      。
      <br/>
      （
      <em>
       这里我觉得比较妙的一点是用条件是否为真（Seg_Set_Arr[Seg_DM1_Mode] &lt; 0）进行了熄灭和负号点亮之间的切换。）
      </em>
     </li>
    </ol>
    <h4>
     <a id="_231">
     </a>
     时间界面
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/3307e712e1dd4b6680d4ea01714618c8.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/877f6f0a1b8f45f5a0bbe8fc90b539d0.png"/>
     <br/>
     定义**时间参数数组ucRtc[]**用来存储时分秒的数据。
    </p>
    <pre><code class="prism language-c"><span class="token keyword">unsigned</span> <span class="token keyword">char</span> ucRtc<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">05</span><span class="token punctuation">}</span><span class="token punctuation">;</span>   <span class="token comment">//时间参数数组 [0]-时 [1]-分 [2]-秒</span>
</code></pre>
    <p>
     调用ds1302里写入的函数
     <strong>
      Set_Rtc()
     </strong>
     ，将
     <strong>
      初始显示状态的数据在上电时写入
     </strong>
     。
    </p>
    <pre><code class="prism language-c">	<span class="token function">Set_Rtc</span><span class="token punctuation">(</span>ucRtc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     每次进入信息处理函数时
     <strong>
      读取（Read_Rtc()）时钟信息
     </strong>
     ，
     <strong>
      更新时间参数数组ucRtc[]
     </strong>
     的数据，为后续显示做准备。
    </p>
    <pre><code class="prism language-c">	<span class="token function">Read_Rtc</span><span class="token punctuation">(</span>ucRtc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <em>
      （显示可以一位数码管一位数码管写，和频率界面的正常显示相似，就不再赘述了。）
     </em>
     <br/>
     用
     <strong>
      for循环
     </strong>
     将数码管显示的时分秒数据写入。
     <br/>
     这里要
     <strong>
      找出时分秒在数码管的位置之间的代数关系
     </strong>
     ，时分秒的高位分别占0 3 6，低位占1 4 7，可知高位满足 y = 3x ，低位满足 y = 3x+1。
     <br/>
     在一次循环里实现一组高低位的取值。
    </p>
    <pre><code class="prism language-c">			<span class="token keyword">for</span><span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Seg_Buf<span class="token punctuation">[</span>j <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> ucRtc<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span>
				Seg_Buf<span class="token punctuation">[</span>j <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> ucRtc<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span><span class="token comment">//-</span>
</code></pre>
    <h4>
     <a id="_262">
     </a>
     回显界面
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/38e41e800c654c6591980bb07b48ec8d.png"/>
     <br/>
     回显界面也有
     <strong>
      两个子界面
     </strong>
     ，声明
     <strong>
      回显界面模式变量bit Seg_DM3_Mode
     </strong>
     标记两个子界面。
     <br/>
     频率回显界面要显示最大频率值，时间回显界面要显示最大频率发生时间，分别声明
     <strong>
      最大频率值变量Max_Freq
     </strong>
     和**最大频率发生时间数组Max_Freq_Time[3]**存储这两个值。
    </p>
    <pre><code class="prism language-c">bit Seg_DM3_Mode<span class="token punctuation">;</span>                      <span class="token comment">//回显界面模式变量 0-频率回显界面 1-时间回显界面</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> Max_Freq<span class="token punctuation">;</span>                 <span class="token comment">//最大频率值变量</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> Max_Freq_Time<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          <span class="token comment">//最大频率发生时间数组</span>
</code></pre>
    <p>
     每次进入信息处理函数后获取最大频率及其发生时间，存到对应的变量里，以供后续调用。
    </p>
    <pre><code class="prism language-c"><span class="token comment">/*获取最大频率及其发生时间*/</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Max_Freq <span class="token operator">&lt;</span> Freq<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Max_Freq <span class="token operator">=</span> Freq<span class="token punctuation">;</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>j <span class="token operator">++</span><span class="token punctuation">)</span>
			Max_Freq_Time<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> ucRtc<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      频率回显界面要注意高位熄灭
     </strong>
     <br/>
     时间回显界面用循环获取时间的话，和时间界面相似，要找出各位之间的代数关系。
    </p>
    <pre><code class="prism language-c">			Seg_Buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span><span class="token comment">//H</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_DM3_Mode <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//频率回显界面</span>
			<span class="token punctuation">{<!-- --></span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span><span class="token comment">//F</span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> Max_Freq <span class="token operator">/</span> <span class="token number">10000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> Max_Freq <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> Max_Freq <span class="token operator">/</span> <span class="token number">100</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> Max_Freq <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> Max_Freq <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				
				<span class="token comment">/*高位为0时熄灭*/</span>
				<span class="token keyword">while</span><span class="token punctuation">(</span>Seg_Buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					Seg_Buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>i <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span><span class="token comment">//时间回显界面</span>
			<span class="token punctuation">{<!-- --></span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span><span class="token comment">//A</span>
				<span class="token keyword">for</span><span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>j <span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					Seg_Buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>j<span class="token punctuation">]</span> <span class="token operator">=</span>  Max_Freq_Time<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span>
					Seg_Buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span>  Max_Freq_Time<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_312">
     </a>
     校准
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/5c9871e5740346fcb5c21945ab387b40.png"/>
    </p>
    <h5>
     <a id="_314">
     </a>
     校准过程
    </h5>
    <p>
     显示的频率都是实时频率加上校准值后的结果，那么只要在
     <strong>
      计算完频率之后加上校准值
     </strong>
     即可。
    </p>
    <pre><code class="prism language-c">Freq <span class="token operator">+=</span> Seg_Set_Arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//加上校准值</span>
</code></pre>
    <h5>
     <a id="_319">
     </a>
     校准错误显示
    </h5>
    <p>
     校准错误显示
     <strong>
      在频率显示界面（Seg_Disp_Mode为0）下实现
     </strong>
     。
     <br/>
     可以将显示
     <strong>
      分为两种情况
     </strong>
     ：
    </p>
    <ol>
     <li>
      频率正常
     </li>
     <li>
      频率错误
     </li>
    </ol>
    <p>
     用
     <strong>
      if 对校准后的频率进行判断
     </strong>
     ，当频率大于0时，正常读取正常显示；当频率小于0时，只显示首位的编号和末两位的LL。
    </p>
    <pre><code class="prism language-c">		<span class="token keyword">if</span><span class="token punctuation">(</span>Freq <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> Freq <span class="token operator">/</span> <span class="token number">10000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
		  Seg_Buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> Freq <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
		  Seg_Buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> Freq <span class="token operator">/</span> <span class="token number">100</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> Freq <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> Freq <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
			
			 <span class="token comment">/*高位为0时熄灭*/</span>
		  <span class="token keyword">while</span><span class="token punctuation">(</span>Seg_Buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Seg_Buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>i <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">//熄灭</span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span><span class="token comment">//LL</span>
		<span class="token punctuation">}</span> 
</code></pre>
    <p>
     <mark>
      注意：
     </mark>
     <strong>
      Freq要用 long int型
     </strong>
     。
     <br/>
     考虑两个点 ：
    </p>
    <ol>
     <li>
      <strong>
       频率的正负
      </strong>
      。因为加上校验值后频率可能为负数，如果用无符号型无论如何都得不到
      <strong>
       负数
      </strong>
      ，所以要用
      <strong>
       有符号型
      </strong>
      的数据。
     </li>
     <li>
      <strong>
       范围
      </strong>
      。int型的取值范围为 -32768 到 32767 ，用来存储单纯的频率是够用的，但是加上校验值后就可能产生
      <strong>
       数据溢出
      </strong>
      的问题，使得显示数据不准，所以要
      <strong>
       扩大取值范围
      </strong>
      。
     </li>
    </ol>
    <h3>
     <a id="DAC_353">
     </a>
     DAC输出部分
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/017576f1859d4561974c62c4d6026477.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e3a2da46a0be47cbb2cdf6b277c19f80.png"/>
     <br/>
     声明
     <strong>
      输出电压变量V_OutPut
     </strong>
     ，存储要输出的电压大小。
    </p>
    <pre><code class="prism language-c"><span class="token keyword">float</span> V_OutPut<span class="token punctuation">;</span>                         <span class="token comment">//输出电压变量</span>
</code></pre>
    <p>
     整体的输出可以把分成四段：
    </p>
    <ol>
     <li>
      频率错误（Frqe&lt;0）时，DAC输出0V。
     </li>
     <li>
      频率大于等于0且小于500Hz时，DAC输出1V
     </li>
     <li>
      频率大于超限参数时，DAC输出5V
     </li>
     <li>
      频率在500Hz和超过限制频率之间时，DAC输出要求出该斜线的表达式。
      <br/>
      易得数学表达式：
      <br/>
      V = ( ( 5 - 1 ) / ( 超限参数 - 500 ) ) * (F-500) + 1
     </li>
     <li>
      频率错误时，DAC输出0V。
     </li>
    </ol>
    <p>
     <mark>
      注意：
     </mark>
     <strong>
      V_OutPut（输出电压变量）写入的 0-5 的值是需要输出的模拟输出值
     </strong>
     ，而在调用
     <strong>
      DAC输出函数（Da_Write）时写入的参数是 0 - 255 范围内的数字输入值
     </strong>
     。如果直接用V_OutPut的值写入参数，那么实际输出的电压值将会很小，所以在此要
     <strong>
      将 0-5 范围的值线性映射成 0-255 范围的量值
     </strong>
     ，不难得出这两个范围的倍数关系是51，因此只要对小的值（输出电压变量V_OutPut）乘上51即可完成映射。
    </p>
    <pre><code class="prism language-c"><span class="token comment">/*DAC相关*/</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Freq <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> V_OutPut <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Freq <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> Freq <span class="token operator">&lt;=</span> <span class="token number">500</span><span class="token punctuation">)</span> V_OutPut <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Freq <span class="token operator">&gt;=</span> Seg_Set_Arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> V_OutPut <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> V_OutPut <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">5.0</span> <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>Freq <span class="token operator">-</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Da_Write</span><span class="token punctuation">(</span>V_OutPut <span class="token operator">*</span> <span class="token number">51</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="_381">
     </a>
     按键功能部分
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9efc4edc8a8f4c4f98cca8b24a734e7f.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9347786ef4534f8a87c5b263916c0cc7.png"/>
    </p>
    <pre><code class="prism language-c"><span class="token comment">/*按键处理函数*/</span>
<span class="token keyword">void</span> <span class="token function">Key_Proc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Key_Flag<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
	Key_Flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	
	Key_Val <span class="token operator">=</span> <span class="token function">Key_Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Key_Down <span class="token operator">=</span> Key_Val <span class="token operator">&amp;</span> <span class="token punctuation">(</span>Key_Val <span class="token operator">^</span> Key_Old<span class="token punctuation">)</span><span class="token punctuation">;</span>
	Key_Old <span class="token operator">=</span> Key_Val<span class="token punctuation">;</span>
	
	<span class="token keyword">switch</span><span class="token punctuation">(</span>Key_Down<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span><span class="token comment">//“界面”按键</span>
		
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		
		<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span><span class="token comment">//“选择”按键</span>
			
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		
		<span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span><span class="token comment">//“加”按键</span>
			
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		
		<span class="token keyword">case</span> <span class="token number">9</span><span class="token operator">:</span><span class="token comment">//“减”按键</span>
			
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="S4_417">
     </a>
     S4：“界面”按键
    </h5>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/985253fd18ca4e9a90172b31fc10e8f1.png"/>
    </p>
    <p>
     界面切换要
     <strong>
      考虑模式变量的取值情况
     </strong>
     。
     <br/>
     按键按下一次模式切换一次，即 Seg_Disp_Mode（界面显示模式变量）+1。Seg_Disp_Mode在 0-3 之间变化，对应4个模式，最大值不能为3，所以当 Seg_Disp_Mode 加到4时，要将它重新赋0，以此形成一个
     <strong>
      循环的切换
     </strong>
     。
    </p>
    <pre><code class="prism language-c"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>Seg_Disp_Mode <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> Seg_Disp_Mode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre>
    <h5>
     <a id="S5_426">
     </a>
     S5：“选择”按键
    </h5>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a7320d65d6f34b7489f7a74e958e8037.png"/>
     <br/>
     分成两种情况对各自界面下的模式变量操作。
     <br/>
     因为这两个界面下的模式变量都是bit型，可以不用像“界面”按键那里一样进行加法操作，可以用异或。
     <br/>
     这里用异或，其实就相当于取反。因为bit型数据本身就只有0和1两个数值，0异或后为1，1异或后为0。
    </p>
    <pre><code class="prism language-c">			<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Disp_Mode <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
				Seg_DM1_Mode <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Disp_Mode <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
				Seg_DM3_Mode <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <mark>
      注意：
     </mark>
    </p>
    <ol>
     <li>
      频率界面切换到参数界面和时间界面切换到回显界面时，有
      <strong>
       默认显示的子界面
      </strong>
      ，所以在每次在完成这两种切换时，都要保证当前显示处于默认子界面，但是在上面的操作中并不能实现。
     </li>
     <li>
      <strong>
       默认子界面的显示是在按下“界面”按键时生效的（Key_Down为4）
      </strong>
      ，即要对“界面”按键按下后将要显示的界面进行判断，决定是否要
      <strong>
       重置子界面的模式变量
      </strong>
      。
     </li>
    </ol>
    <pre><code class="prism language-c">            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>Seg_Disp_Mode <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>  Seg_DM1_Mode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   <span class="token comment">//默认显示超限参数子界面</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Disp_Mode <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>  Seg_DM3_Mode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>     <span class="token comment">//默认显示频率回显子界面</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Disp_Mode <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>  Seg_Disp_Mode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">//退回到最初界面</span>
</code></pre>
    <h6>
     <a id="_446">
     </a>
     优化写法
    </h6>
    <p>
     上面是对按键按下后的界面进行了判断后才执行重置。但是，其实不进行判断也是可以的。因为子界面模式变量的值是多少对于另外两个界面的显示没有任何影响，所以可以省去判断的那一步，在每次按下按键就重置。
    </p>
    <pre><code class="prism language-c">			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>Seg_Disp_Mode <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> 
				Seg_DM1_Mode <span class="token operator">=</span> Seg_DM3_Mode <span class="token operator">=</span> Seg_Disp_Mode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre>
    <h5>
     <a id="S8S9___454">
     </a>
     S8、S9：“加”按键 、“减”按键
    </h5>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/49d9961b971740078379649edaf2beec.png"/>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f255cc3ab0b44c9e8537c848d2b09e9e.png"/>
     <br/>
     “加”按键和“减”按键逻辑类似，此处只对“加”按键做简单的解析。
     <br/>
     在进行加法运算时，要考虑
     <strong>
      单次加的单位值大小
     </strong>
     和
     <strong>
      参数的上限值
     </strong>
     。
     <br/>
     此处是对同界面下的两个子界面的参数进行的加法，所以可以将两个子界面的单次加的单位值和参数上限值分组后分别存在两个数组中（
     <strong>
      单次加减大小数组Step_Arr[2]
     </strong>
     、
     <strong>
      上限值数组Max_Arr[2]
     </strong>
     ），前一个数是超限参数对应的值，后一个数是校准参数对应的值。
    </p>
    <pre><code class="prism language-c"><span class="token comment">//按键功能相关变量</span>
<span class="token keyword">int</span> code Step_Arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">;</span>     <span class="token comment">//单次加减大小数组 [0]-超限参数单次增加量/减小量 [1]-校准参数单次增加量/减小量</span>
<span class="token keyword">int</span> code Max_Arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">9000</span><span class="token punctuation">,</span><span class="token number">900</span><span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token comment">//上限值数组 [0]-超限参数上限值 [1]-校准参数上限值</span>
<span class="token keyword">int</span> code Min_Arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">900</span><span class="token punctuation">}</span><span class="token punctuation">;</span>     <span class="token comment">//下限值数组 [0]-超限参数下限值 [1]-校准参数下限值</span>
</code></pre>
    <p>
     通过
     <strong>
      参数界面模式变量（Seg_DM1_Mode）
     </strong>
     根据当前界面的不同获取对应的值，进行加法处理。
     <br/>
     每次加完都要对当前数值进行判断，
     <strong>
      避免超出限制
     </strong>
     。
     <br/>
     <em>
      （减法运算逻辑类似，不赘述）
     </em>
    </p>
    <pre><code class="prism language-c">			<span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span><span class="token comment">//“加”按键</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Disp_Mode <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span> <span class="token operator">+=</span> Step_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span> <span class="token operator">&gt;</span> Max_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">)</span>
					Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span> <span class="token operator">=</span> Max_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		
		<span class="token keyword">case</span> <span class="token number">9</span><span class="token operator">:</span><span class="token comment">//“减”按键</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Disp_Mode <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span> <span class="token operator">-=</span> Step_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span> <span class="token operator">&lt;</span> Min_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">)</span>
					Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span> <span class="token operator">=</span> Min_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="LED_490">
     </a>
     LED指示灯功能部分
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8f87675d080248dbae962ce8b296875c.png"/>
     <br/>
     这块的重点是两个地方：
    </p>
    <ol>
     <li>
      <strong>
       0.2s间隔的闪烁。
      </strong>
     </li>
     <li>
      <strong>
       亮、灭状态的切换。
      </strong>
     </li>
    </ol>
    <p>
     声明
     <strong>
      闪烁间隔计时变量Time_200ms
     </strong>
     ，后续用于0.2间隔闪烁的计时。
     <br/>
     声明
     <strong>
      闪烁标志位Led_Flag
     </strong>
     ，用于标记亮灭状态，并且通过它的改变实现亮灭的切换。
    </p>
    <pre><code class="prism language-c"><span class="token comment">//LED指示灯功能相关变量</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Time_200ms<span class="token punctuation">;</span>              <span class="token comment">//闪烁间隔计时变量</span>
bit Led_Flag<span class="token punctuation">;</span>                          <span class="token comment">//闪烁标志位</span>
</code></pre>
    <p>
     在定时中断服务函数中完成。
     <br/>
     <strong>
      每计时满200ms重新开始计时，并且改变一次亮灭状态。
     </strong>
    </p>
    <pre><code class="prism language-c"><span class="token comment">/*LED闪烁200ms计时*/</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>Time_200ms <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Time_200ms <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		Led_Flag <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre>
    <p>
     <em>
      （在实现点亮时，可以用最基础的 if 的方式一步一步判断，这个逻辑很简单，暂时先不写了。下面这个是西风老师的逻辑，我认为比最基础版写法更好，因为更能体现你对C语言运算符运用，对此我做个简要的分析一下）
     </em>
     <br/>
     题目涉及的LED只有L1和L2，所以只要对Led控制数组（ucLed[]）前两位进行操作。
    </p>
    <ol>
     <li>
      <strong>
       L1在频率界面下生效（Seg_Disp_Mode为0）
      </strong>
      ，用逻辑非运算符（ !） 对 Seg_Disp_Mode 的逻辑值取反。即Seg_Disp_Mode为 0时（当前处于频率界面），那逻辑值就是假，! 运算之后的结果就是 1；Seg_Disp_Mode若不为 0（当前不处于频率界面），那逻辑值就是真，! 运算之后的结果就是 0。
      <br/>
      再和闪烁标志位（Led_Flag）进行
      <strong>
       逻辑与
      </strong>
      （有0出0）的运算，那么当Seg_Disp_Mode为 0时（当前处于频率界面），
      <strong>
       L1的点亮状态全由 Led_Flag（闪烁标志位）决定
      </strong>
      。
     </li>
     <li>
      <strong>
       L2在频率大于超限参数 或者 频率为负数时生效
      </strong>
      ，因为两种情况中任意满足一种它就生效，所以可以对这两个情况进行
      <strong>
       逻辑或运算
      </strong>
      （其中一个操作数的逻辑值为真，整个表达式的结果就为真）。
      <br/>
      当
      <strong>
       处于频率大于超限参数时
      </strong>
      ，在这
      <strong>
       可以直接对频率判断
      </strong>
      也 可以
      <strong>
       对DAC输出电压变量（V_OutPut）进行判断
      </strong>
      。对 V_OutPut 判断（回顾DAC输出部分），当 V_OutPut 为 5 时表示当前处于频率大于超限参数的状态，要实现L2闪烁。那么只要对
      <code>
       V_OutPut == 5
      </code>
      进行真假逻辑的判断就可以用1和0来表示
      <strong>
       频率大于超限参数（L2闪烁）
      </strong>
      和
      <strong>
       频率不大于超限参数（L2不闪烁）
      </strong>
      两种情况。此时就和L1的思路相似，将
      <code>
       V_OutPut == 5
      </code>
      逻辑真假的输出值和闪烁标志位（Led_Flag）进行
      <strong>
       逻辑与
      </strong>
      （有0出0）的运算，那么当逻辑为真（频率大于超限参数（L2闪烁））时，L2 的点亮状态全由 Led_Flag（闪烁标志位）决定。
      <br/>
      当
      <strong>
       处于频率为负数时
      </strong>
      ，直接对
      <code>
       Freq &lt; 0
      </code>
      进行逻辑判断，那么当频率为负数是输出为1，此时L1点亮。
     </li>
    </ol>
    <pre><code class="prism language-c">	<span class="token comment">/**LED相关**/</span>
	ucLed<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Led_Flag <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>Seg_Disp_Mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
	ucLed<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Led_Flag <span class="token operator">&amp;</span> <span class="token punctuation">(</span>V_OutPut <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>Freq <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre>
    <h4>
     <a id="_528">
     </a>
     调试时发现的问题
    </h4>
    <h2>
     <a id="_530">
     </a>
     最终代码
    </h2>
    <h3>
     <a id="User_531">
     </a>
     User文件
    </h3>
    <h4>
     <a id="mainc_532">
     </a>
     main.c
    </h4>
    <pre><code class="prism language-c"><span class="token comment">/*头文件声明区*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;STC15F2K60S2.H&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Init.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Seg.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Key.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Led.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"iic.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ds1302.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"math.h"</span></span>

<span class="token comment">/*变量声明区*/</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Key_Down<span class="token punctuation">,</span>Key_Val<span class="token punctuation">,</span>Key_Up<span class="token punctuation">,</span>Key_Old<span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Seg_Buf<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Seg_Point<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Seg_Pos<span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> ucLed<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> Slow_Down<span class="token punctuation">;</span>
bit Seg_Flag<span class="token punctuation">,</span>Key_Flag<span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> Time_1s<span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token keyword">int</span> Freq<span class="token punctuation">;</span>

<span class="token comment">//界面相关变量</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Seg_Disp_Mode<span class="token punctuation">;</span>           <span class="token comment">//界面显示模式变量 0-频率界面 1-参数界面 2-时间界面 3-回显界面</span>
bit Seg_DM1_Mode<span class="token punctuation">;</span>                      <span class="token comment">//参数界面模式变量 0-超限参数界面 1-校准值参数界面</span>
<span class="token keyword">int</span> Seg_Set_Arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">2000</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>         <span class="token comment">//参数数组 [0]-超限参数 [1]-校准值变量</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> ucRtc<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">05</span><span class="token punctuation">}</span><span class="token punctuation">;</span>   <span class="token comment">//时间参数数组 [0]-时 [1]-分 [2]-秒</span>
bit Seg_DM3_Mode<span class="token punctuation">;</span>                      <span class="token comment">//回显界面模式变量 0-频率回显界面 1-时间回显界面</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> Max_Freq<span class="token punctuation">;</span>                 <span class="token comment">//最大频率值变量</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> Max_Freq_Time<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>         <span class="token comment">//最大频率发生时间数组</span>

<span class="token comment">//DAC相关变量</span>
<span class="token keyword">float</span> V_OutPut<span class="token punctuation">;</span>                        <span class="token comment">//输出电压变量</span>


<span class="token comment">//按键功能相关变量</span>
<span class="token keyword">int</span> code Step_Arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">;</span>     <span class="token comment">//单次加减大小数组 [0]-超限参数单次增加量/减小量 [1]-校准参数单次增加量/减小量</span>
<span class="token keyword">int</span> code Max_Arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">9000</span><span class="token punctuation">,</span><span class="token number">900</span><span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token comment">//上限值数组 [0]-超限参数上限值 [1]-校准参数上限值</span>
<span class="token keyword">int</span> code Min_Arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">900</span><span class="token punctuation">}</span><span class="token punctuation">;</span>     <span class="token comment">//下限值数组 [0]-超限参数下限值 [1]-校准参数下限值</span>

<span class="token comment">//LED指示灯功能相关变量</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Time_200ms<span class="token punctuation">;</span>              <span class="token comment">//闪烁间隔计时变量</span>
bit Led_Flag<span class="token punctuation">;</span>                          <span class="token comment">//闪烁标志位</span>

<span class="token comment">/*按键处理函数*/</span>
<span class="token keyword">void</span> <span class="token function">Key_Proc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Key_Flag<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
	Key_Flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	
	Key_Val <span class="token operator">=</span> <span class="token function">Key_Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Key_Down <span class="token operator">=</span> Key_Val <span class="token operator">&amp;</span> <span class="token punctuation">(</span>Key_Val <span class="token operator">^</span> Key_Old<span class="token punctuation">)</span><span class="token punctuation">;</span>
	Key_Old <span class="token operator">=</span> Key_Val<span class="token punctuation">;</span>
	
	<span class="token keyword">switch</span><span class="token punctuation">(</span>Key_Down<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span><span class="token comment">//“界面”按键</span>
<span class="token comment">//			 /*分开写*/</span>
<span class="token comment">//			if(++Seg_Disp_Mode == 1)  Seg_DM1_Mode = 0;   //默认显示超限参数子界面</span>
<span class="token comment">//			if(Seg_Disp_Mode == 3)  Seg_DM3_Mode = 0;     //默认显示频率回显子界面</span>
<span class="token comment">//			if(Seg_Disp_Mode == 4)  Seg_Disp_Mode = 0;    //退回到最初界面</span>
			
		   <span class="token comment">/*合在一起写*/</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>Seg_Disp_Mode <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> 
				Seg_DM1_Mode <span class="token operator">=</span> Seg_DM3_Mode <span class="token operator">=</span> Seg_Disp_Mode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		
		<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span><span class="token comment">//“选择”按键</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Disp_Mode <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
				Seg_DM1_Mode <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Disp_Mode <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
				Seg_DM3_Mode <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		
		<span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span><span class="token comment">//“加”按键</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Disp_Mode <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span> <span class="token operator">+=</span> Step_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> Max_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">)</span>
					Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span> <span class="token operator">=</span> Max_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		
		<span class="token keyword">case</span> <span class="token number">9</span><span class="token operator">:</span><span class="token comment">//“减”按键</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Disp_Mode <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span> <span class="token operator">-=</span> Step_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span> <span class="token operator">&lt;</span> Min_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">)</span>
					Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span> <span class="token operator">=</span> Min_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/*信息处理函数*/</span>
<span class="token keyword">void</span> <span class="token function">Seg_Proc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Flag<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
	Seg_Flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	
	<span class="token comment">/*更新时钟*/</span>
	<span class="token function">Read_Rtc</span><span class="token punctuation">(</span>ucRtc<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">/*获取最大频率及其发生时间*/</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Max_Freq <span class="token operator">&lt;</span> Freq<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Max_Freq <span class="token operator">=</span> Freq<span class="token punctuation">;</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>j <span class="token operator">++</span><span class="token punctuation">)</span>
			Max_Freq_Time<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> ucRtc<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">switch</span><span class="token punctuation">(</span>Seg_Disp_Mode<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span><span class="token comment">//频率界面</span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span><span class="token comment">//F</span>
		  Seg_Buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>Freq <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> Freq <span class="token operator">/</span> <span class="token number">10000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
		  Seg_Buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> Freq <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
		  Seg_Buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> Freq <span class="token operator">/</span> <span class="token number">100</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> Freq <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> Freq <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
			
			 <span class="token comment">/*高位为0时熄灭*/</span>
		  <span class="token keyword">while</span><span class="token punctuation">(</span>Seg_Buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Seg_Buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>i <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">//熄灭</span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span><span class="token comment">//LL</span>
		<span class="token punctuation">}</span> 
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		
		<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span><span class="token comment">//参数界面</span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">;</span><span class="token comment">//P</span>
		  Seg_Buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">)</span>Seg_DM1_Mode<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
		  Seg_Buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
		
<span class="token comment">//		  if(Seg_DM1_Mode == 0)//超限参数界面</span>
<span class="token comment">//			{<!-- --></span>
<span class="token comment">//				Seg_Buf[4] = Seg_Set_Arr[0] /1000 % 10;</span>
<span class="token comment">//				Seg_Buf[5] = Seg_Set_Arr[0] /100 % 10;</span>
<span class="token comment">//				Seg_Buf[6] = Seg_Set_Arr[0] /10 % 10;</span>
<span class="token comment">//				Seg_Buf[7] = Seg_Set_Arr[0] % 10;</span>
<span class="token comment">//			}</span>
<span class="token comment">//			else//校准值参数界面</span>
<span class="token comment">//			{<!-- --></span>
<span class="token comment">//				if(Seg_Set_Arr[1] != 0)</span>
<span class="token comment">//				{<!-- --></span>
<span class="token comment">//					/*确定符号位*/</span>
<span class="token comment">//					if(Seg_Set_Arr[1] &lt; 0)</span>
<span class="token comment">//						Seg_Buf[4] = 15;//-</span>
<span class="token comment">//					else </span>
<span class="token comment">//						Seg_Buf[4] = 10;//熄灭</span>
<span class="token comment">//					</span>
<span class="token comment">//					</span>
<span class="token comment">//					Seg_Buf[5] = abs(Seg_Set_Arr[1]) /100 % 10;</span>
<span class="token comment">//				  Seg_Buf[6] = abs(Seg_Set_Arr[1]) /10 % 10;</span>
<span class="token comment">//				  Seg_Buf[7] = abs(Seg_Set_Arr[1]) % 10;</span>
<span class="token comment">//				}</span>
<span class="token comment">//				else</span>
<span class="token comment">//				{<!-- --></span>
<span class="token comment">//					Seg_Buf[5] = Seg_Buf[6] = 10;</span>
<span class="token comment">//				  Seg_Buf[7] = 0;</span>
<span class="token comment">//				}				</span>
<span class="token comment">//			}</span>

			Seg_Buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_DM1_Mode<span class="token operator">?</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">+</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">abs</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token number">1000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token number">100</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
	    Seg_Buf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token number">10</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
		  
		  <span class="token comment">/*校准值为0时，只显示一位0*/</span>
		  <span class="token keyword">if</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span>Seg_DM1_Mode<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Buf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
   	<span class="token keyword">break</span><span class="token punctuation">;</span>
		
		<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span><span class="token comment">//时间界面</span>
			<span class="token keyword">for</span><span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Seg_Buf<span class="token punctuation">[</span>j <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> ucRtc<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span>
				Seg_Buf<span class="token punctuation">[</span>j <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> ucRtc<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seg_Buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span><span class="token comment">//-</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		
		<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span><span class="token comment">//回显界面</span>
			Seg_Buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span><span class="token comment">//H</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>Seg_DM3_Mode <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//频率回显界面</span>
			<span class="token punctuation">{<!-- --></span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span><span class="token comment">//F</span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> Max_Freq <span class="token operator">/</span> <span class="token number">10000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> Max_Freq <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> Max_Freq <span class="token operator">/</span> <span class="token number">100</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> Max_Freq <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> Max_Freq <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				
				<span class="token comment">/*高位为0时熄灭*/</span>
				<span class="token keyword">while</span><span class="token punctuation">(</span>Seg_Buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					Seg_Buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>i <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span><span class="token comment">//时间回显界面</span>
			<span class="token punctuation">{<!-- --></span>
				Seg_Buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span><span class="token comment">//A</span>
				<span class="token keyword">for</span><span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>j <span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					Seg_Buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>j<span class="token punctuation">]</span> <span class="token operator">=</span>  Max_Freq_Time<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span>
					Seg_Buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span>  Max_Freq_Time<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/*其他显示函数*/</span>
<span class="token keyword">void</span> <span class="token function">Led_Proc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">/*DAC相关*/</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Freq <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> V_OutPut <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Freq <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> Freq <span class="token operator">&lt;=</span> <span class="token number">500</span><span class="token punctuation">)</span> V_OutPut <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Freq <span class="token operator">&gt;=</span> Seg_Set_Arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> V_OutPut <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> V_OutPut <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">5.0</span> <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>Seg_Set_Arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>Freq <span class="token operator">-</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Da_Write</span><span class="token punctuation">(</span>V_OutPut <span class="token operator">*</span> <span class="token number">51</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">/**LED相关**/</span>
	ucLed<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Led_Flag <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>Seg_Disp_Mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
	ucLed<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Led_Flag <span class="token operator">&amp;</span> <span class="token punctuation">(</span>V_OutPut <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>Freq <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*定时器0初始化函数*/</span>
<span class="token keyword">void</span> <span class="token function">Timer0Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>		<span class="token comment">//1毫秒@12.000MHz</span>
<span class="token punctuation">{<!-- --></span>
	AUXR <span class="token operator">&amp;=</span> <span class="token number">0x7F</span><span class="token punctuation">;</span>		<span class="token comment">//定时器时钟12T模式</span>
	TMOD <span class="token operator">&amp;=</span> <span class="token number">0xF0</span><span class="token punctuation">;</span>		<span class="token comment">//设置定时器模式</span>
	TMOD <span class="token operator">|=</span> <span class="token number">0x05</span><span class="token punctuation">;</span>		
	TL0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>		<span class="token comment">//设置定时初值</span>
	TH0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>		<span class="token comment">//设置定时初值</span>
	TF0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>		<span class="token comment">//清除TF0标志</span>
	TR0 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>		<span class="token comment">//定时器0开始计时</span>
<span class="token punctuation">}</span>

<span class="token comment">/*定时器1初始化函数*/</span>
<span class="token keyword">void</span> <span class="token function">Timer1Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>		<span class="token comment">//1毫秒@12.000MHz</span>
<span class="token punctuation">{<!-- --></span>
	AUXR <span class="token operator">&amp;=</span> <span class="token number">0xBF</span><span class="token punctuation">;</span>		<span class="token comment">//定时器时钟12T模式</span>
	TMOD <span class="token operator">&amp;=</span> <span class="token number">0x0F</span><span class="token punctuation">;</span>		<span class="token comment">//设置定时器模式</span>
	TL1 <span class="token operator">=</span> <span class="token number">0x18</span><span class="token punctuation">;</span>		<span class="token comment">//设置定时初值</span>
	TH1 <span class="token operator">=</span> <span class="token number">0xFC</span><span class="token punctuation">;</span>		<span class="token comment">//设置定时初值</span>
	TF1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>		<span class="token comment">//清除TF1标志</span>
	TR1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>		<span class="token comment">//定时器1开始计时</span>
	ET1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	EA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*定时器1中断服务函数*/</span>
<span class="token keyword">void</span> <span class="token function">Timer1_Isr</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> interrupt <span class="token number">3</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">/*数码管90ms的减速*/</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>Slow_Down <span class="token operator">==</span> <span class="token number">90</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Seg_Flag <span class="token operator">=</span> Slow_Down <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/*按键10ms的减速*/</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Slow_Down <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Key_Flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/*1s的计数*/</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>Time_1s <span class="token operator">==</span> <span class="token number">1000</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Time_1s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		Freq <span class="token operator">=</span> TH0 <span class="token operator">&lt;&lt;</span> <span class="token number">8</span> <span class="token operator">|</span> TL0<span class="token punctuation">;</span>   <span class="token comment">//计算频率</span>
		Freq <span class="token operator">+=</span> Seg_Set_Arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//加上校准值</span>
		TH0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		TL0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/*信息处理*/</span>
	<span class="token function">Seg_Disp</span><span class="token punctuation">(</span>Slow_Down <span class="token operator">%</span> <span class="token number">8</span><span class="token punctuation">,</span> Seg_Buf<span class="token punctuation">[</span>Slow_Down <span class="token operator">%</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>Seg_Point<span class="token punctuation">[</span>Slow_Down <span class="token operator">%</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Led_Disp</span><span class="token punctuation">(</span>Slow_Down <span class="token operator">%</span> <span class="token number">8</span><span class="token punctuation">,</span>ucLed<span class="token punctuation">[</span>Slow_Down <span class="token operator">%</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">/*LED闪烁200ms计时*/</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>Time_200ms <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Time_200ms <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		Led_Flag <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/*主函数*/</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">Sys_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Timer0Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Timer1Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Set_Rtc</span><span class="token punctuation">(</span>ucRtc<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">Key_Proc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">Seg_Proc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">Led_Proc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="Driver_852">
     </a>
     Driver文件
    </h3>
    <h4>
     <a id="initc_853">
     </a>
     init.c
    </h4>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Init.h"</span></span>

<span class="token keyword">void</span> <span class="token function">Sys_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	P0 <span class="token operator">=</span> <span class="token number">0xff</span><span class="token punctuation">;</span>
	P2 <span class="token operator">=</span> P2 <span class="token operator">&amp;</span> <span class="token number">0x1f</span> <span class="token operator">|</span> <span class="token number">0x80</span><span class="token punctuation">;</span>
	P2 <span class="token operator">&amp;=</span> <span class="token number">0x1f</span><span class="token punctuation">;</span>
	
	P0 <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>
	P2 <span class="token operator">=</span> P2 <span class="token operator">&amp;</span> <span class="token number">0x1f</span> <span class="token operator">|</span> <span class="token number">0xa0</span><span class="token punctuation">;</span>
	P2 <span class="token operator">&amp;=</span> <span class="token number">0x1f</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="Keyc_869">
     </a>
     Key.c
    </h4>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Key.h"</span></span>

<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">Key_Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> temp<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	
	P44 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> P42 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> P35 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> P34 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P33 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> temp <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P32 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> temp <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P31 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> temp <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P30 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> temp <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
	
	P44 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> P42 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> P35 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> P34 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P33 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> temp <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P32 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> temp <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P31 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> temp <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P30 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> temp <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
	
	P44 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> P42 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> P35 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> P34 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P33 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> temp <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P32 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> temp <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P31 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> temp <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P30 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> temp <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
	
	  <span class="token comment">/*P34引脚和NE555冲突*/</span>
<span class="token comment">//	P44 = 1; P42 = 1; P35 = 1; P34 = 0;</span>
<span class="token comment">//	if(P33 == 0) temp = 16;</span>
<span class="token comment">//	if(P32 == 0) temp = 17;</span>
<span class="token comment">//	if(P31 == 0) temp = 18;</span>
<span class="token comment">//	if(P30 == 0) temp = 19;</span>

	<span class="token keyword">return</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="Ledc_906">
     </a>
     Led.c
    </h4>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Led.h"</span></span>

<span class="token keyword">void</span> <span class="token function">Led_Disp</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> addr<span class="token punctuation">,</span>enable<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> temp <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> temp_old <span class="token operator">=</span> <span class="token number">0xff</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>enable<span class="token punctuation">)</span>
		temp <span class="token operator">|=</span> <span class="token number">0x01</span> <span class="token operator">&lt;&lt;</span> addr<span class="token punctuation">;</span>
	<span class="token keyword">else</span>
		temp <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x01</span> <span class="token operator">&lt;&lt;</span> addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>temp <span class="token operator">!=</span> temp_old<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		P0 <span class="token operator">=</span> <span class="token operator">~</span>temp<span class="token punctuation">;</span>
	  P2 <span class="token operator">=</span> P2 <span class="token operator">&amp;</span> <span class="token number">0x1f</span> <span class="token operator">|</span> <span class="token number">0x80</span><span class="token punctuation">;</span>
	  P2 <span class="token operator">&amp;=</span> <span class="token number">0x1f</span><span class="token punctuation">;</span>
		temp_old <span class="token operator">=</span> temp<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="Segc_930">
     </a>
     Seg.c
    </h4>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Seg.h"</span></span>

code <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Seg_wela<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0x01</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x04</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x80</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
code <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Seg_dula<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0xc0</span><span class="token punctuation">,</span><span class="token number">0xf9</span><span class="token punctuation">,</span><span class="token number">0xa4</span><span class="token punctuation">,</span><span class="token number">0xb0</span><span class="token punctuation">,</span><span class="token number">0x99</span><span class="token punctuation">,</span><span class="token number">0x92</span><span class="token punctuation">,</span><span class="token number">0x82</span><span class="token punctuation">,</span><span class="token number">0xf8</span><span class="token punctuation">,</span><span class="token number">0x80</span><span class="token punctuation">,</span><span class="token number">0x90</span><span class="token punctuation">,</span><span class="token number">0xff</span><span class="token punctuation">,</span><span class="token number">0x88</span><span class="token punctuation">,</span><span class="token number">0x8e</span><span class="token punctuation">,</span><span class="token number">0x89</span><span class="token punctuation">,</span><span class="token number">0x8c</span><span class="token punctuation">,</span><span class="token number">0xBF</span><span class="token punctuation">,</span><span class="token number">0xC7</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//0-9，10-熄灭,11-A,12-F,13-H,14-P,15--,16-L</span>

<span class="token keyword">void</span> <span class="token function">Seg_Disp</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> wela<span class="token punctuation">,</span>dula<span class="token punctuation">,</span>point<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	P0 <span class="token operator">=</span> <span class="token number">0xff</span><span class="token punctuation">;</span>
	P2 <span class="token operator">=</span> P2 <span class="token operator">&amp;</span> <span class="token number">0x1f</span> <span class="token operator">|</span> <span class="token number">0xe0</span><span class="token punctuation">;</span>
	P2 <span class="token operator">&amp;=</span> <span class="token number">0x1f</span><span class="token punctuation">;</span>
	
	P0 <span class="token operator">=</span> Seg_wela<span class="token punctuation">[</span>wela<span class="token punctuation">]</span><span class="token punctuation">;</span>
	P2 <span class="token operator">=</span> P2 <span class="token operator">&amp;</span> <span class="token number">0x1f</span> <span class="token operator">|</span> <span class="token number">0xc0</span><span class="token punctuation">;</span>
	P2 <span class="token operator">&amp;=</span> <span class="token number">0x1f</span><span class="token punctuation">;</span>
	
	P0 <span class="token operator">=</span> Seg_dula<span class="token punctuation">[</span>dula<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span>
		P0 <span class="token operator">&amp;=</span> <span class="token number">0x7f</span><span class="token punctuation">;</span>
	P2 <span class="token operator">=</span> P2 <span class="token operator">&amp;</span> <span class="token number">0x1f</span> <span class="token operator">|</span> <span class="token number">0xe0</span><span class="token punctuation">;</span>
	P2 <span class="token operator">&amp;=</span> <span class="token number">0x1f</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="iicc_956">
     </a>
     iic.c
    </h4>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"iic.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"intrins.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DELAY_TIME</span>	<span class="token expression"><span class="token number">10</span></span></span>

sbit scl <span class="token operator">=</span> P2 <span class="token operator">^</span> <span class="token number">0</span><span class="token punctuation">;</span>
sbit sda <span class="token operator">=</span> P2 <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">//</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">I2C_Delay</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">do</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
    <span class="token punctuation">}</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      	
<span class="token punctuation">}</span>

<span class="token comment">//</span>
<span class="token keyword">void</span> <span class="token function">I2CStart</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    sda <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    scl <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">I2C_Delay</span><span class="token punctuation">(</span>DELAY_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sda <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">I2C_Delay</span><span class="token punctuation">(</span>DELAY_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
    scl <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>

<span class="token comment">//</span>
<span class="token keyword">void</span> <span class="token function">I2CStop</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    sda <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    scl <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">I2C_Delay</span><span class="token punctuation">(</span>DELAY_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sda <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">I2C_Delay</span><span class="token punctuation">(</span>DELAY_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//</span>
<span class="token keyword">void</span> <span class="token function">I2CSendByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> byt<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        scl <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token function">I2C_Delay</span><span class="token punctuation">(</span>DELAY_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>byt <span class="token operator">&amp;</span> <span class="token number">0x80</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            sda <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            sda <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
		<span class="token function">I2C_Delay</span><span class="token punctuation">(</span>DELAY_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
        scl <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        byt <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">I2C_Delay</span><span class="token punctuation">(</span>DELAY_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	
    scl <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>

<span class="token comment">//</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">I2CReceiveByte</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> da<span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>   
		scl <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">I2C_Delay</span><span class="token punctuation">(</span>DELAY_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
		da <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>sda<span class="token punctuation">)</span> 
			da <span class="token operator">|=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>
		scl <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token function">I2C_Delay</span><span class="token punctuation">(</span>DELAY_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> da<span class="token punctuation">;</span>    
<span class="token punctuation">}</span>

<span class="token comment">//</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">I2CWaitAck</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> ackbit<span class="token punctuation">;</span>
	
    scl <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">I2C_Delay</span><span class="token punctuation">(</span>DELAY_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ackbit <span class="token operator">=</span> sda<span class="token punctuation">;</span> 
    scl <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">I2C_Delay</span><span class="token punctuation">(</span>DELAY_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">return</span> ackbit<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//</span>
<span class="token keyword">void</span> <span class="token function">I2CSendAck</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> ackbit<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    scl <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    sda <span class="token operator">=</span> ackbit<span class="token punctuation">;</span> 
	<span class="token function">I2C_Delay</span><span class="token punctuation">(</span>DELAY_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
    scl <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">I2C_Delay</span><span class="token punctuation">(</span>DELAY_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
    scl <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
	sda <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">I2C_Delay</span><span class="token punctuation">(</span>DELAY_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Da_Write</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> dat<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">I2CStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2CSendByte</span><span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2CWaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2CSendByte</span><span class="token punctuation">(</span><span class="token number">0x41</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2CWaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2CSendByte</span><span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2CWaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2CStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="ds1302c_1078">
     </a>
     ds1302.c
    </h4>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ds1302.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"intrins.h"</span></span>

sbit SCK <span class="token operator">=</span> P1 <span class="token operator">^</span> <span class="token number">7</span><span class="token punctuation">;</span>
sbit SDA <span class="token operator">=</span> P2 <span class="token operator">^</span> <span class="token number">3</span><span class="token punctuation">;</span>
sbit RST <span class="token operator">=</span> P1 <span class="token operator">^</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token comment">//</span>
<span class="token keyword">void</span> <span class="token function">Write_Ds1302</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span>  <span class="token keyword">char</span> temp<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>     	
	<span class="token punctuation">{<!-- --></span> 
		SCK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		SDA <span class="token operator">=</span> temp<span class="token operator">&amp;</span><span class="token number">0x01</span><span class="token punctuation">;</span>
		temp<span class="token operator">&gt;&gt;=</span><span class="token number">1</span><span class="token punctuation">;</span> 
		SCK<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>   

<span class="token comment">//</span>
<span class="token keyword">void</span> <span class="token function">Write_Ds1302_Byte</span><span class="token punctuation">(</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> address<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> dat <span class="token punctuation">)</span>     
<span class="token punctuation">{<!-- --></span>
 	RST<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 	SCK<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 	RST<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> 	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
 	<span class="token function">Write_Ds1302</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>	
 	<span class="token function">Write_Ds1302</span><span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">;</span>		
 	RST<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token comment">//</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">Read_Ds1302_Byte</span> <span class="token punctuation">(</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> address <span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
 	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">,</span>temp<span class="token operator">=</span><span class="token number">0x00</span><span class="token punctuation">;</span>
 	RST<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 	SCK<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 	RST<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token function">Write_Ds1302</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 	
 	<span class="token punctuation">{<!-- --></span>		
		SCK<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		temp<span class="token operator">&gt;&gt;=</span><span class="token number">1</span><span class="token punctuation">;</span>	
 		<span class="token keyword">if</span><span class="token punctuation">(</span>SDA<span class="token punctuation">)</span>
 		temp<span class="token operator">|=</span><span class="token number">0x80</span><span class="token punctuation">;</span>	
 		SCK<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> 
 	RST<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 	SCK<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	SCK<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	SDA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	SDA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>			
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Set_Rtc</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>ucRtc<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	
	<span class="token function">Write_Ds1302_Byte</span><span class="token punctuation">(</span><span class="token number">0x8e</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token function">Write_Ds1302_Byte</span><span class="token punctuation">(</span><span class="token number">0x84</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> i<span class="token punctuation">,</span> ucRtc<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span> <span class="token operator">|</span> ucRtc<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Write_Ds1302_Byte</span><span class="token punctuation">(</span><span class="token number">0x8e</span><span class="token punctuation">,</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Read_Rtc</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>ucRtc<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> temp<span class="token punctuation">;</span>
	
	<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		temp <span class="token operator">=</span> <span class="token function">Read_Ds1302_Byte</span><span class="token punctuation">(</span><span class="token number">0x85</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
		ucRtc<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> temp <span class="token operator">/</span><span class="token number">16</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> temp <span class="token operator">%</span> <span class="token number">16</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre>
    <h3>
     <a id="_1159">
     </a>
     结语
    </h3>
    <p>
     这套题整理也花了不少时间，但在整理的同时也让我对这套题的解法和思路有了更清晰的认知，收获还是蛮大的。
     <br/>
     感谢你能看到这里，希望这篇笔记不仅对我有所帮助，也能对你能有所启发。
     <br/>
     那么，文章里面有问题的话，也感谢大家指出。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f7a696368656e675f472f:61727469636c652f64657461696c732f313435393634383430" class_="artid" style="display:none">
 </p>
</div>


