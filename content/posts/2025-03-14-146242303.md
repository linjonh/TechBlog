---
layout: post
title: "MySQL连接较慢原因分析及解决措施"
date: 2025-03-14 07:00:00 +0800
description: "在使用MySQL的时候经常遇到**连接比较缓慢**的问题，总结了一下原因和结局措施"
keywords: "连接上mysql 但是里边操作很慢"
categories: ['Mysql']
tags: ['数据库', 'Mysql']
artid: "146242303"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146242303
    alt: "MySQL连接较慢原因分析及解决措施"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146242303
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146242303
cover: https://bing.ee123.net/img/rand?artid=146242303
image: https://bing.ee123.net/img/rand?artid=146242303
img: https://bing.ee123.net/img/rand?artid=146242303
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     MySQL连接较慢原因分析及解决措施
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-dracula" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <br/>
    <strong>
     摘要：
    </strong>
    MySQL连接较慢原因分析及解决措施
    <p>
    </p>
    <p>
     <strong>
      关键词：
     </strong>
     MySQL、连接缓慢、客户端、参数设置
    </p>
    <h2>
     <a id="_5">
     </a>
     整体说明
    </h2>
    <p>
     在使用MySQL的时候经常遇到
     <strong>
      连接比较缓慢
     </strong>
     的问题，总结了一下原因和结局措施，具体的做法，大致如下：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/4ad5c04b23a46ef5f3f6f86c185399fa.png"/>
    </p>
    <h2>
     <a id="_11">
     </a>
     一、问题现象
    </h2>
    <ul>
     <li>
      <p>
       连接过程卡住，很久才能进入
      </p>
      <p>
       每次登录 MySQL 输入了如下指令之后，都会卡个几分钟，才能进入
      </p>
      <pre><code class="prism language-shell">mysql <span class="token parameter variable">-h</span> <span class="token operator">&lt;</span>host<span class="token operator">&gt;</span> <span class="token parameter variable">-u</span> <span class="token operator">&lt;</span>user<span class="token operator">&gt;</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-A</span>
</code></pre>
     </li>
     <li>
      <p>
       连接过程提示使用 -A 字样，并很久才能进入
      </p>
      <p>
       有的时候输入上面指令的时候，进去是进入了页面，但是会提示我，增加 -A 这样的信息，并且进入的时候也很慢
      </p>
     </li>
    </ul>
    <h2>
     <a id="_25">
     </a>
     二、问题分析
    </h2>
    <h3>
     <a id="21DNS_27">
     </a>
     2.1、DNS反向解析问题
    </h3>
    <ul>
     <li>
      <p>
       <strong>
        问题原因：
       </strong>
      </p>
      <p>
       MySQL默认会尝试将客户端IP反向解析为域名，若DNS服务器响应慢或配置不当，会导致连接延迟
      </p>
     </li>
     <li>
      <p>
       <strong>
        解决方法
       </strong>
       ：
      </p>
      <ol>
       <li>
        <strong>
         修改MySQL配置
        </strong>
        ：
        <br/>
        在
        <code>
         my.cnf
        </code>
        （Linux）或
        <code>
         my.ini
        </code>
        （Windows）中添加以下配置，跳过反向DNS解析：
       </li>
      </ol>
     </li>
    </ul>
    <pre><code>[mysqld]
skip-name-resolve
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/2c2201f5ff6e52112cd8692c8724551b.png"/>
    </p>
    <p>
     ​
     <strong>
      注意
     </strong>
     ：启用后，授权表中的主机名（如
     <code>
      user@hostname
     </code>
     ）将失效，需改用IP或通配符（
     <code>
      %
     </code>
     ）。
    </p>
    <pre><code>2. **重启MySQL服务**：
</code></pre>
    <pre><code class="prism language-shell">systemctl restart mysql  <span class="token comment"># Linux</span>
</code></pre>
    <h3>
     <a id="22_53">
     </a>
     2.2、网络问题
    </h3>
    <ul>
     <li>
      <p>
       <strong>
        问题原因：
       </strong>
       高延迟或网络不稳定会导致连接缓慢。
      </p>
     </li>
     <li>
      <p>
       <strong>
        解决办法：
       </strong>
      </p>
      <ol>
       <li>
        <p>
         <strong>
          测试网络延迟：
         </strong>
        </p>
        <pre><code class="prism language-she">ping &lt;MySQL服务器IP&gt;
traceroute &lt;MySQL服务器IP&gt;  # Linux
tracert &lt;MySQL服务器IP&gt;      # Windows
</code></pre>
       </li>
       <li>
        <p>
         <strong>
          使用内网连接：
         </strong>
        </p>
        <p>
         如果服务器与客户端在同一内网，优先使用内网IP连接
        </p>
       </li>
      </ol>
     </li>
    </ul>
    <h3>
     <a id="23SSLTLS_71">
     </a>
     2.3、SSL/TLS协商问题
    </h3>
    <ul>
     <li>
      <p>
       <strong>
        问题原因：
       </strong>
       若启用SSL加密但配置不当，可能导致协商耗时增加
      </p>
     </li>
     <li>
      <p>
       <strong>
        解决办法：
       </strong>
      </p>
      <ol>
       <li>
        <p>
         <strong>
          临时禁用SSL测试
         </strong>
         ：
         <br/>
         在连接字符串中添加
         <code>
          ?useSSL=false
         </code>
         ：
        </p>
        <pre><code class="prism language-bash">mysql <span class="token parameter variable">-h</span> <span class="token operator">&lt;</span>host<span class="token operator">&gt;</span> <span class="token parameter variable">-u</span> <span class="token operator">&lt;</span>user<span class="token operator">&gt;</span> <span class="token parameter variable">-p</span> --ssl-mode<span class="token operator">=</span>DISABLED
</code></pre>
        <p>
         若速度恢复，需检查服务器SSL配置或更新证书。
        </p>
       </li>
      </ol>
     </li>
    </ul>
    <h3>
     <a id="24_86">
     </a>
     2.4、自动补全的延迟
    </h3>
    <ul>
     <li>
      <p>
       <strong>
        问题原因：
       </strong>
      </p>
      <ul>
       <li>
        <strong>
         <code>
          -A
         </code>
         的作用
        </strong>
        <br/>
        <code>
         -A
        </code>
        （或
        <code>
         --disable-auto-rehash
        </code>
        ）是 MySQL 客户端的参数，用于
        <strong>
         禁用自动补全
        </strong>
        功能。默认情况下，MySQL 客户端在连接成功后会自动加载数据库的元数据（如表名、列名），以支持交互式命令的 Tab 补全。
        <ul>
         <li>
          <strong>
           未使用
           <code>
            -A
           </code>
          </strong>
          ：客户端会预加载所有表结构信息，导致连接时卡顿（尤其是数据库表较多或结构复杂时）。
         </li>
         <li>
          <strong>
           使用
           <code>
            -A
           </code>
          </strong>
          ：客户端跳过预加载，直接进入交互界面，但后续手动输入命令时无法自动补全。
         </li>
        </ul>
       </li>
       <li>
        <strong>
         卡顿的根源
        </strong>
        <br/>
        如果未使用
        <code>
         -A
        </code>
        ，客户端在连接时会向服务器发起元数据查询（如
        <code>
         SHOW TABLES
        </code>
        、
        <code>
         SHOW COLUMNS
        </code>
        ），如果数据库表数量大、网络延迟高或服务器负载高，这一过程会显著变慢。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        解决办法1：
       </strong>
      </p>
      <p>
       强制使用
       <code>
        -A
       </code>
       跳过预加载
      </p>
      <pre><code class="prism language-shell">mysql <span class="token parameter variable">-h</span> <span class="token operator">&lt;</span>host<span class="token operator">&gt;</span> <span class="token parameter variable">-u</span> <span class="token operator">&lt;</span>user<span class="token operator">&gt;</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-A</span>
</code></pre>
      <p>
       <strong>
        优点
       </strong>
       ：连接速度立即恢复。
      </p>
      <p>
       <strong>
        缺点
       </strong>
       ：后续交互式操作中无法使用 Tab 补全表名或列名。
      </p>
     </li>
     <li>
      <p>
       <strong>
        解决办法2：
       </strong>
      </p>
      <p>
       在 MySQL 客户端的配置文件（如
       <code>
        ~/.my.cnf
       </code>
       ）中永久禁用自动补全：
      </p>
      <pre><code class="prism language-shell"><span class="token punctuation">[</span>mysql<span class="token punctuation">]</span>
disable-auto-rehash  <span class="token comment"># 等效于 -A</span>
</code></pre>
      <p>
       <img alt="" src="https://i-blog.csdnimg.cn/img_convert/d7ca4fc6043c7aa3e0837fc6df8dab93.png"/>
      </p>
     </li>
    </ul>
    <h2>
     <a id="_123">
     </a>
     三、问题解决
    </h2>
    <p>
     最开始的两个问题解决办法总结如下：
    </p>
    <ul>
     <li>
      优先启用
      <code>
       skip-name-resolve
      </code>
      ，解决DNS反向解析问题。
     </li>
     <li>
      检查网络延迟。
     </li>
     <li>
      测试SSL影响，必要时优化配置。
     </li>
     <li>
      若连接卡顿由元数据预加载引起，添加
      <code>
       -A
      </code>
      参数是最直接的解决方案
     </li>
     <li>
      若需保留自动补全功能，需优化数据库结构或提升服务器性能
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f70656e6770656e6868682f:61727469636c652f64657461696c732f313436323432333033" class_="artid" style="display:none">
 </p>
</div>


