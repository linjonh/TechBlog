/*! build time: 20250826 161119  */
!function(){"use strict";function e(e){const t=new URL(e),c=t.pathname;if(!t.protocol.startsWith("http"))return!1;for(const e of s.urlPrefixes)if(t.href.startsWith(e))return!1;for(const e of s.paths)if(c.startsWith(e))return!1;for(const e of s.hostNames)if(t.hostname.includes(e))return!1;return!0}importScripts("./js/swconfig.js");const t=swconf.purge,s=swconf.interceptor;self.addEventListener("install",(e=>{e.waitUntil(caches.open(swconf.cacheName).then((e=>e.addAll(swconf.resources))))})),self.addEventListener("activate",(e=>{e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>t||e!==swconf.cacheName?caches.delete(e):void 0))))))})),self.addEventListener("message",(e=>{"SKIP_WAITING"===e.data&&self.skipWaiting(),console.log("event.data="+e.data)}));const c="https://cors-proxy-rho-red.vercel.app/",r="https://cors-proxy-rho-red.vercel.app",n=["csdnimg.cn","https://www.cloudflare-terms-of-service-abuse.com/","info-database.csdn.net"];function a(s,c){const r=c.url;s.respondWith(caches.match(r).then((s=>s||fetch(c).then((s=>{if(t||"GET"!==c.method||!e(r))return s;let n=s.clone();return caches.open(swconf.cacheName).then((e=>{e.put(r,n)})),s})).catch((e=>Promise.resolve(new Response("请求失败",{status:500,statusText:`${e}`})))))))}self.addEventListener("fetch",(s=>{let o=s.request;if(!o.headers.has("range"))if(n.some((e=>o.url.includes(e)))&&!o.url.includes(r)){const e=o.url;a(s,new Request(c+e,{method:o.method,headers:o.headers,body:o.body,mode:o.mode,credentials:o.credentials,cache:o.cache,redirect:o.redirect,referrer:r,integrity:o.integrity}))}else o.url.includes(r)&&o.url.endsWith(".ts")?function(s,n){s.waitUntil((async()=>{const s=await caches.match(n);if(s)return s;let a=n.url.replace(r+"/","");const o=await caches.keys();for(const s of o){const o=await caches.open(s),i=await o.keys();for(const s of i){const i=await o.match(s),d=await i.text();let h=s.url;if(h.endsWith(".m3u8")&&d.includes(a)){let o=decodeURIComponent(h);o=o.replace(c,"");let i=new URL(a,o.substring(0,o.lastIndexOf("/")+1));i=c+i.href;const d=new Request(i,{method:n.method,headers:n.headers,body:n.body,mode:n.mode,credentials:n.credentials,cache:n.cache,redirect:n.redirect,referrer:r,integrity:n.integrity});let l;const f=await fetch(d);if(f.redirected){const e=c+f.url;l=await fetch(e),l.status}else l=f;const u=s.url;if(t||"GET"!==s.method||!e(u))return l;let m=l.clone();return(await caches.open(swconf.cacheName)).put(s,m),l}}}return fetch(n)})())}(s,o):a(s,o)}))}();
