---
layout: post
title: "申通的云原生实践之路如何实现应用基于容器的微服务改造"
date: 2020-08-12 11:17:16 +0800
description: "随着云计算的普及与云原生的广泛应用，越来越多的从业者、决策者清晰地认识到「云原生化将成为 企业技术创"
keywords: "云原生实践之路"
categories: ['我是程序员', '云栖号技术分享']
tags: ['运维', '数据库']
artid: "107953236"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=107953236
    alt: "申通的云原生实践之路如何实现应用基于容器的微服务改造"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     申通的云原生实践之路：如何实现应用基于容器的微服务改造？
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <img alt="头图.png" src="https://i-blog.csdnimg.cn/blog_migrate/0b813d16838baae1416262fb1f83e78a.png"/>
    </p>
    <p>
     随着云计算的普及与云原生的广泛应用，越来越多的从业者、决策者清晰地认识到
     <strong>
      「云原生化将成为 企业技术创新的关键要素，也是完成企业数字化转型的最短路径」
     </strong>
     。
    </p>
    <p>
     因此，具有前瞻思维的互联网企业从应用诞生之初就扎根于云端，谨慎稳重的新零售、政府、金融、医疗等领域的企业与机构也逐渐将业务应用迁移上云，深度使用云原生技术与云原生架构。面对架构设计、开发方式到部署运维等不同业务场景，基于云原生架构的应用通常针对云的技术特性进行技术生命周期设计，最大限度利用云平台的弹性、分布式、自助、按需等产品优势。
    </p>
    <p>
     作为发展最为迅猛的物流企业之一，申通快递一直积极探索技术创新赋能商业增长之路，以期达到降本提效目的。目前，申通快递日订单处理量已达千万量级，亿级别物流轨迹处理量，每天产生数据已达到 TB 级别，使用 1300+ 个计算节点来实时处理业务。
    </p>
    <h2>
     当业务飞速发展遭遇运维瓶颈
    </h2>
    <p>
     过往申通快递的核心业务应用运行在 IDC 机房，原有 IDC 系统帮助申通安稳度过早期业务快速发展期。但伴随着业务体量指数级增长，业务形式愈发多元化。原有系统暴露出不少问题，传统 IOE 架构、各系统架构的不规范、 稳定性、研发效率都限制了业务高速发展的可能。软件交付周期过长，大促保障对资源的特殊要求难实现、系统稳定性难以保障等业务问题逐渐暴露。
    </p>
    <p>
     在与阿里云进行多次需求沟通与技术验证后，申通最终确定阿里云为唯一合作伙伴，采用云原生技术和架构实现核心业务搬迁上阿里云。2019 年开始将业务逐步从 IDC 迁移至阿里云。目前，核心业务系统已经在阿里云上完成流量承接，为申通提供稳定而高效的计算能力。
    </p>
    <h2>
     全面改造云原生升级，助力业务发展
    </h2>
    <p>
     申通核心业务系统原架构基于 Vmware+Oracle 数据库进行搭建。随着搬迁上阿里云，架构全面转型为基于 Kubernetes 的云原生架构体系。其中，引入云原生数据库并完成应用基于容器的微服务改造是整个应用服务架构重构的关键点。
    </p>
    <ul>
     <li>
      引入云原生数据库
     </li>
    </ul>
    <p>
     通过引入 OLTP 跟 OLAP 型数据库，将在线数据与离线分析逻辑拆分到两种数据库中，改变此前完全依赖 Oracle 数据库的现状。满足在处理历史数据查询场景下 Oracle 数据库所无法支持的实际业务需求。
    </p>
    <ul>
     <li>
      应用容器化
     </li>
    </ul>
    <p>
     伴随着容器化技术的引进，通过应用容器化有效解决了环境不一致的问题，确保应用在开发、测试、生产环 境的一致性。与虚拟机相比，容器化提供了效率与速度的双重提升，让应用更适合微服务场景，有效提升产研效率。
    </p>
    <ul>
     <li>
      微服务改造
     </li>
    </ul>
    <p>
     由于过往很多业务是基于 Oracle 的存储过程及触发器完成的，系统间的服务依赖也需要 Oracle 数据库 OGG 同步完成。这样带来的问题就是系统维护难度高且稳定性差。通过引入 Kubernetes 的服务发现，组建微服务解决方案，将业务按业务域进行拆分，让整个系统更易于维护。
    </p>
    <p>
     综合考虑申通实际业务需求与技术特征，最终选择了
     <strong>
      「阿里云 ACK+ 神龙 + 云数据库」
     </strong>
     的云原生解决方案，从而实现核心应用迁移上阿里云。
    </p>
    <p>
     <img alt="1.png" src="https://i-blog.csdnimg.cn/blog_migrate/01d0a071fb2e711b94ef07c02c712e01.png"/>
    </p>
    <h3>
     1. 架构阐述
    </h3>
    <p>
     基础设施，全部计算资源取自阿里云的神龙裸金属服务器。相较于一般云服务器(ECS)，Kubernetes 搭配神龙服务器能够获得更优性能及更合理的资源利用率且云上资源按需取量，对于拥有大促活动等短期大流量业务场景的申通而言极为重要。相较于线下自建机房、常备机器，云上资源随取随用。在大促活动结束后，云上资源使用完毕后即可释放，管理与采购成本更低，相应效率。
    </p>
    <p>
     流量接入，阿里云提供两套流量接入，一套是面向公网请求，另外一套是服务内部调用。域名解析采用云 DNS 及 PrivateZone。借助 Kubernetes 的 Ingress 能力实现统一的域名转发，以节省公网 SLB 的数量，提高运维管理效率。
    </p>
    <h3>
     2. 平台层
    </h3>
    <p>
     基于 Kubernetes 打造的云原生 PaaS 平台优势明显突出。
    </p>
    <p>
     打通 DevOps 闭环，统一测试，集成，预发、生产环境; 天生资源隔离，机器资源利用率高; 流量接入可实现精细化管理; 集成了日志、链路诊断、Metrics 平台;
    </p>
    <p>
     统一 ApiServer 接口和扩展，天生支持多云跟混合云部署。
    </p>
    <h3>
     3. 应用服务层
    </h3>
    <p>
     每个应用都在 Kubernetes 上面创建单独的一个 Namespace，应用跟应用之间实现资源隔离。通过定义各个 应用的配置 Yaml 模板，当应用在部署时直接编辑其中的镜像版本即可快速完成版本升级，当需要回滚时直接在本地启动历史版本的镜像快速回滚。
    </p>
    <h3>
     4. 运维管理
    </h3>
    <p>
     线上 Kubernetes 集群采用阿里云托管版容器服务，免去了运维 Master 节点的工作，只需要制定 Worker 节点上线及下线流程即可。同时业务系统均通过阿里云的 PaaS 平台完成业务日志搜索，按照业务需求投交扩容任务，系统自动完成扩容操作，降低了直接操作 Kubernetes 集群带来的业务风险。
    </p>
    <h2>
     全面释放云原生技术红利
    </h2>
    <p>
     <strong>
      成本方面
     </strong>
     ：使用公有云作为计算平台，可以让企业不必因为业务突发增长需求，而一次性投入大量资金成本用于采购服务器及扩充机柜。在公共云上可以做到随用随付，对于一些创新业务想做技术调研十分便捷。用完即释放， 按量付费。另外云产品都免运维自行托管在云端，有效节省人工运维成本，让企业更专注于核心业务。
    </p>
    <p>
     <strong>
      稳定性方面
     </strong>
     ：首先，云上产品提供至少 5 个 9 以上的 SLA 服务确保系统稳定，而自建系统稳定性相去甚远。其次，部分开源软件可能存在功能 bug，造成故障隐患。最后，在数据安全方面云上数据可以轻松实现异地备份，阿里云数据存储体系下的归档存储产品具备高可靠、低成本、安全性、存储无限等特点，让企业数据更安全。
    </p>
    <p>
     <strong>
      效率方面
     </strong>
     ：借助与云产品深度集成，研发人员可以完成一站式研发、运维工作。从业务需求立项到拉取分支开发， 再到测试环境功能回归验证，最终部署到预发验证及上线，整个持续集成流程耗时可缩短至分钟级。排查问题方面，研发人员直接选择所负责的应用，并通过集成的 SLS 日志控制台快速检索程序的异常日志进行问题定位，免去了登录机器查日志的麻烦。
    </p>
    <p>
     <strong>
      赋能业务
     </strong>
     ：阿里云提供超过 300 余种的云上组件，组件涵盖计算、AI、大数据、IOT 等等诸多领域。研发人员开箱即用，有效节省业务创新带来的技术成本。
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     <a href="https://yq.aliyun.com/articles/769826?utm_content=g_1000170047" rel="nofollow">
      原文链接
     </a>
     <br/>
     本文为阿里云原创内容，未经允许不得转载。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f79756e7169696e73696768742f:61727469636c652f64657461696c732f313037393533323336" class_="artid" style="display:none">
 </p>
</div>


