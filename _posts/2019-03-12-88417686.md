---
layout: post
title: "freeswitch-使用sipjs-jssip-webrtc网页音视频通话"
date: 2019-03-12 11:57:09 +0800
description: "关于linphone手机端开发参考https://blog.csdn.net/Java_lilin/"
keywords: "jssip实现视频"
categories: ['Freeswitch']
tags: ['音视频通话', 'Webrtc', 'Sipjs', 'Linphone', 'Jssip', 'Freeswitch', 'Freeswitch']
artid: "88417686"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=88417686
    alt: "freeswitch-使用sipjs-jssip-webrtc网页音视频通话"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     freeswitch 使用sipjs 、jssip webrtc网页音视频通话
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     关于linphone手机端开发参考
     <a href="https://blog.csdn.net/Java_lilin/article/details/80539116" title="基于linphone android sdk 的voip语音、视频通话 教程一、注册_Java_lilin的专栏-CSDN博客">
      基于linphone android sdk 的voip语音、视频通话 教程一、注册_Java_lilin的专栏-CSDN博客
     </a>
    </p>
    <p>
     配置帮助群:261074724
    </p>
    <h3>
     <span style="color:#fe2c24;">
      呼叫系统参考
     </span>
     <a href="https://item.taobao.com/item.htm?id=653611115230" rel="nofollow" title="https://item.taobao.com/item.htm?id=653611115230">
      https://item.taobao.com/item.htm?id=653611115230
     </a>
    </h3>
    <p>
     sipjs 官网
     <a href="http://sipjs.com/" rel="nofollow" title="SIP Signaling JavaScript Library for WebRTC Developers | SIP.js">
      SIP Signaling JavaScript Library for WebRTC Developers | SIP.js
     </a>
    </p>
    <p>
     参考官网说明 写法如下:
    </p>
    <p>
     &lt;body&gt;
     <br/>
     &lt;div id="id_msg"&gt;&lt;/div&gt;
     <br/>
     &lt;input id="id_to" value="10000"/&gt;
     <br/>
     &lt;button οnclick="call()"&gt;call&lt;/button&gt;
     <br/>
     &lt;button οnclick="gua()"&gt;gua&lt;/button&gt;
     <br/>
     &lt;br/&gt;
     <br/>
     &lt;video id="remoteVideo" style="width:200px;height:400px;"&gt;&lt;/video&gt;
     <br/>
     &lt;video id="localVideo"  muted="muted"&gt;&lt;/video&gt;
    </p>
    <p>
     &lt;script src="sip-0.13.6.min.js"&gt;&lt;/script&gt;
     <br/>
     &lt;script src="vconsole.min.js"&gt;&lt;/script&gt;
     <br/>
     &lt;script type="text/javascript"&gt;
     <br/>
     var vConsole = new VConsole();
     <br/>
     var config = {
     <!-- -->
     <br/>
     // Replace this IP address with your FreeSWITCH IP address
     <br/>
     uri: '10001@xx:9060',
    </p>
    <p>
     // Replace this IP address with your FreeSWITCH IP address
     <br/>
     // and replace the port with your FreeSWITCH ws port
     <br/>
     transportOptions: {
     <!-- -->
     <br/>
     wsServers: ['wss://xx:7443']
     <br/>
     },
     <br/>
     // FreeSWITCH Default Username
     <br/>
     authorizationUser: '10001',
    </p>
    <p>
     // FreeSWITCH Default Password
     <br/>
     password: 'test1'
     <br/>
     };
    </p>
    <p>
     var userAgent = new SIP.UA(config);
    </p>
    <p>
     var remoteVideo = document.getElementById('remoteVideo');
     <br/>
     var localVideo = document.getElementById('localVideo');
     <br/>
     var sipsession = null;
     <br/>
     userAgent.on('registered', function () {
     <!-- -->
     <br/>
     document.getElementById('id_msg').innerText="ok";
     <br/>
     });
     <br/>
     userAgent.on('invite', function(session) {
     <!-- -->
     <br/>
     var url = session.remoteIdentity.uri.toString()+"---&gt;call";
     <br/>
     var isaccept = confirm(url);
     <br/>
     if(isaccept)
     <br/>
     {
     <br/>
     //接受来电
     <br/>
     session.accept({
     <!-- -->
     <br/>
     sessionDescriptionHandlerOptions: {
     <!-- -->
     <br/>
     constraints: {
     <!-- -->
     <br/>
     audio: true,
     <br/>
     video: true
     <br/>
     }
     <br/>
     }
     <br/>
     });
     <br/>
     sipsession = session;
     <br/>
     session.on('accepted', function() {//
     <br/>
     // We need to check the peer connection to determine which track was added
     <br/>
     <br/>
     var pc = session.sessionDescriptionHandler.peerConnection;
     <br/>
     console.log(pc);
     <br/>
     console.log(pc.getLocalStreams());
     <br/>
     // Gets remote tracks
     <br/>
     var remoteStream = new MediaStream();
     <br/>
     pc.getReceivers().forEach(function(receiver) {
     <br/>
     remoteStream.addTrack(receiver.track);
     <br/>
     });
     <br/>
     remoteVideo.srcObject = remoteStream;
     <br/>
     remoteVideo.play();
     <br/>
     <br/>
     if(pc.getSenders() ){
     <!-- -->
     <br/>
     var localStream = new MediaStream();
     <br/>
     pc.getSenders().forEach(function(sender) {
     <!-- -->
     <br/>
     localStream.addTrack(sender.track);
     <br/>
     });
     <br/>
     localVideo.srcObject = localStream;
     <br/>
     localVideo.play();
     <br/>
     }
     <br/>
     <br/>
     });
     <br/>
     }
     <br/>
     else
     <br/>
     {
     <!-- -->
     <br/>
     //拒绝来电
     <br/>
     session.reject();
     <br/>
     }
     <br/>
     } );
    </p>
    <p>
     function gua(){
     <!-- -->
     <br/>
     sipsession.terminate();
     <br/>
     }
     <br/>
     function  call( ){
     <br/>
     var to =document.getElementById('id_to').value;
     <br/>
     sipsession = userAgent.invite(to+'@xx:7443',{
     <!-- -->
     <br/>
     sessionDescriptionHandlerOptions: {
     <!-- -->
     <br/>
     constraints: {
     <!-- -->
     <br/>
     audio: true,  video: true
     <br/>
     }
     <br/>
     }
     <br/>
     });
    </p>
    <p>
     sipsession.on('accepted', function() {
     <!-- -->
     <br/>
     // We need to check the peer connection to determine which track was added
    </p>
    <p>
     var pc = sipsession.sessionDescriptionHandler.peerConnection;
    </p>
    <p>
     // Gets remote tracks
     <br/>
     var remoteStream = new MediaStream();
     <br/>
     pc.getReceivers().forEach(function(receiver) {
     <br/>
     remoteStream.addTrack(receiver.track);261074724
     <br/>
     });
     <br/>
     remoteVideo.srcObject = remoteStream;
     <br/>
     remoteVideo.play();
    </p>
    <p>
     // Gets local tracks
     <br/>
     if(pc.getSenders() ){
     <!-- -->
     <br/>
     var localStream = new MediaStream();
     <br/>
     pc.getSenders().forEach(function(sender) {
     <!-- -->
     <br/>
     localStream.addTrack(sender.track);
     <br/>
     });
     <br/>
     localVideo.srcObject = localStream;
     <br/>
     localVideo.play();
     <br/>
     }
     <br/>
     });
    </p>
    <p>
     }
    </p>
    <p>
     <br/>
     &lt;/script&gt;
     <br/>
     <br/>
     &lt;/body&gt;
    </p>
    <p>
     ................
    </p>
    <p>
     测试结果如下
    </p>
    <table border="1" cellpadding="1" cellspacing="1">
     <tbody>
      <tr>
       <td>
       </td>
       <td>
        局域网
       </td>
       <td>
        外网(nat ok)
       </td>
       <td>
        音视频
       </td>
       <td>
        linphone
       </td>
       <td>
        正常接听
       </td>
      </tr>
      <tr>
       <td>
        pc浏览器
       </td>
       <td>
        支持
       </td>
       <td>
        支持
       </td>
       <td>
        支持
       </td>
       <td>
        支持
       </td>
       <td>
        ok
       </td>
      </tr>
      <tr>
       <td>
        手机浏览器
       </td>
       <td>
        支持
       </td>
       <td>
        支持
       </td>
       <td>
        支持
       </td>
       <td>
        支持
       </td>
       <td>
        ok
       </td>
      </tr>
      <tr>
       <td>
        微信网页
       </td>
       <td>
        支持
       </td>
       <td>
        支持
       </td>
       <td>
        支持
       </td>
       <td>
        支持
       </td>
       <td>
        ok
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     手机端须改动一点地方 可以加群讨论:261074724
    </p>
    <p>
     测试挺好的这个
    </p>
    <p>
     /
    </p>
    <p>
     jssip 官网
     <a href="https://jssip.net/" rel="nofollow" title="JsSIP - the Javascript SIP library">
      JsSIP - the Javascript SIP library
     </a>
    </p>
    <p>
     页面参考
    </p>
    <p>
     <a href="https://blog.csdn.net/foruok/article/details/74321214" title="WebRTC + JsSIP + freeSWITCH一对一视频聊天_安晓辉生涯——聚焦程序员的职业规划与成长-CSDN博客_freeswitch webrtc">
      WebRTC + JsSIP + freeSWITCH一对一视频聊天_安晓辉生涯——聚焦程序员的职业规划与成长-CSDN博客_freeswitch webrtc
     </a>
    </p>
    <p>
     经个人测试 jssip 在内网效果很好
    </p>
    <p>
     在外网配置turn后呼叫有点慢 接通好像有点问题
    </p>
    <p>
     和linphone集成的交流群 :261074724
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f4a6176615f6c696c696e:2f61727469636c652f64657461696c732f3838343137363836" class_="artid" style="display:none">
 </p>
</div>


