---
layout: post
title: "Docker-容器之间的通信"
date: 2025-01-09 13:51:27 +0800
description: "通过网络端口通信默认情况容器和主机之间的网络通信是封闭的, 如果要让容器能够被外部网络访问, 需要在"
keywords: "docker 启动的127.0.0.1的镜像,服务器能连上吗"
categories: ['其他']
tags: ['容器通信', '容器', 'Docker']
artid: "82587437"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=82587437
    alt: "Docker-容器之间的通信"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Docker - 容器之间的通信
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h3 id="通过网络端口通信">
     通过网络端口通信
    </h3>
    <p>
     默认情况容器和主机之间的网络通信是封闭的, 如果要让容器能够被外部网络访问, 需要在启动容器的时候指定要开放的端口, 这样我们就能通过主机的网络访问容器内提供的的服务了.我们在容器中运行了一个Web服务器,用户需要访问这个容器内的资源, 这里为了方便,直接使用官方手册里的示例:
    </p>
    <table>
     <tbody>
      <tr>
       <td>
        <pre>1
</pre>
       </td>
       <td>
        <pre>root@localhost:/# docker run -d -p 5000:5000 training/webapp python app.py
</pre>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     命令行分解:
    </p>
    <ul>
     <li>
      <code>
       -p
      </code>
      标志指定了端口映射,形式为:
      <code>
       &lt;主机端口&gt;:&lt;容器端口&gt;
      </code>
      , 注意不要弄反了.
     </li>
     <li>
      <code>
       -d
      </code>
      标志表示让容器在后台运行
     </li>
     <li>
      <code>
       training/webapp
      </code>
      表示镜像名称
     </li>
     <li>
      <code>
       python app.py
      </code>
      表示要在容器内运行的
      <code>
       SHELL
      </code>
      命令
     </li>
    </ul>
    <p>
     <a id="more">
     </a>
    </p>
    <h4 id="端口绑定模式">
     端口绑定模式
    </h4>
    <p>
     本文把
     <code>
      docker
     </code>
     服务所在的操作系统成为
     <code>
      宿主系统
     </code>
     , 通过
     <code>
      -p
     </code>
     标志绑定端口又如下几种方式:
    </p>
    <ul>
     <li>
      容器端口绑定到宿主系统特定接口的特定端口上
     </li>
    </ul>
    <table>
     <tbody>
      <tr>
       <td>
        <pre>1
</pre>
       </td>
       <td>
        <pre>-p 127.0.0.1:5000:5000
</pre>
       </td>
      </tr>
     </tbody>
    </table>
    <ul>
     <li>
      绑定到宿主系统的随机端口上(49000~49900)
     </li>
    </ul>
    <table>
     <tbody>
      <tr>
       <td>
        <pre>1
</pre>
       </td>
       <td>
        <pre>-p 127.0.0.1::5000
</pre>
       </td>
      </tr>
     </tbody>
    </table>
    <ul>
     <li>
      绑定到宿主系统的所有接口上(0.0.0.0)
     </li>
    </ul>
    <table>
     <tbody>
      <tr>
       <td>
        <pre>1
</pre>
       </td>
       <td>
        <pre>-p 5000:5000
</pre>
       </td>
      </tr>
     </tbody>
    </table>
    <ul>
     <li>
      还可以指定协议(TCP或UDP,等)
     </li>
    </ul>
    <table>
     <tbody>
      <tr>
       <td>
        <pre>1
</pre>
       </td>
       <td>
        <pre>-p 127.0.0.1:5000:5000/udp
</pre>
       </td>
      </tr>
     </tbody>
    </table>
    <ul>
     <li>
      <code>
       -p
      </code>
      标记可以使用多次,同时绑定多个端口
     </li>
    </ul>
    <table>
     <tbody>
      <tr>
       <td>
        <pre>1
</pre>
       </td>
       <td>
        <pre>-p 127.0.0.1:5000:5000 -p 127.0.0.1:5001:5001
</pre>
       </td>
      </tr>
     </tbody>
    </table>
    <h3 id="容器链接">
     容器链接
    </h3>
    <p>
     网络端口不是容器之间相互链接的唯一方式, Docker 还有一个链接系统能够把多个容器链接到一起.通过
     <code>
      Linking
     </code>
     , 容器之间能够相互发现,并能够安全地传输信息. 当创建
     <code>
      Linking
     </code>
     时,实际上是在
     <code>
      源
     </code>
     容器和
     <code>
      目标
     </code>
     容器之间建立了一根管道(
     <code>
      Conduit
     </code>
     ). 要创建
     <code>
      Linking
     </code>
     ,需要使用
     <code>
      --link
     </code>
     标志, 首先创建一个新容器,其中包含我们要访问的数据库:
    </p>
    <p>
     从镜像
     <code>
      training/postgres
     </code>
     创建一个叫做
     <code>
      db
     </code>
     的容器, 其中包含PostgreSQL数据库.
    </p>
    <table>
     <tbody>
      <tr>
       <td>
        <pre>1
</pre>
       </td>
       <td>
        <pre>docker run -d --name db training/postgres:latest
</pre>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     创建一个
     <code>
      web
     </code>
     容器,并链接到
     <code>
      db
     </code>
     容器
    </p>
    <table>
     <tbody>
      <tr>
       <td>
        <pre>1
</pre>
       </td>
       <td>
        <pre>docker run -d -P --name web --link db:db training/webapp python app.py
</pre>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     要建立容器之间的链接,必须在启动时通过参数
     <code>
      --name $container_name
     </code>
     给容器命名,例如:
    </p>
    <table>
     <tbody>
      <tr>
       <td>
        <pre>1
</pre>
       </td>
       <td>
        <pre>docker run -d -P --name web training/webapp python app.py
</pre>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     <code>
      --link
     </code>
     标志的形式如下:
    </p>
    <table>
     <tbody>
      <tr>
       <td>
        <pre>1
</pre>
       </td>
       <td>
        <pre>--link name:alias
</pre>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     其中
     <code>
      name
     </code>
     为被链接的容器名称
     <code>
      alias
     </code>
     为链接的别名
    </p>
    <p>
     我们启动
     <code>
      db
     </code>
     容器的时候并没有指定
     <code>
      -P
     </code>
     或
     <code>
      -p
     </code>
     参数,在这个例子中,
     <code>
      web
     </code>
     容器作为
     <code>
      接受者(recipient)
     </code>
     把自己的信息暴露给作为
     <code>
      source(源)
     </code>
     的
     <code>
      db
     </code>
     , Docker在两个容器之间创建了一个安全的隧道,这是链接的巨大优势, 通过连接,我们不需要向外部网络暴露端口.
    </p>
    <p>
     Docker通过两种方式把链接暴露给
     <code>
      recipient(接受者)
     </code>
     容器:
    </p>
    <ul>
     <li>
      环境变量
     </li>
     <li>
      更新
      <code>
       /etc/hosts
      </code>
      文件
     </li>
    </ul>
    <p>
     Docker设置了一堆环境变量, 可以使用
     <code>
      env
     </code>
     命令列出指定容器的环境变量:
    </p>
    <table>
     <tbody>
      <tr>
       <td>
        <pre>1
</pre>
       </td>
       <td>
        <pre>root@localhost:~# sudo docker run --rm --name web2 --link db:db training/webapp env
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
HOSTNAME=7f3a2434b08a
DB_PORT=tcp://172.17.0.21:5432
DB_PORT_5432_TCP=tcp://172.17.0.21:5432
DB_PORT_5432_TCP_ADDR=172.17.0.21
DB_PORT_5432_TCP_PORT=5432
DB_PORT_5432_TCP_PROTO=tcp
DB_NAME=/web2/db
DB_ENV_PG_VERSION=9.3
HOME=/
</pre>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     转自：
    </p>
    <p>
     <a href="http://developerworks.github.io/2014/09/04/docker-communicate-with-containers/" rel="nofollow">
      http://developerworks.github.io/2014/09/04/docker-communicate-with-containers/
     </a>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f6672616e6b5f676f6f64:2f61727469636c652f64657461696c732f3832353837343337" class_="artid" style="display:none">
 </p>
</div>


