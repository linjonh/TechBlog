---
layout: post
title: "前端上传图片到阿里云oss服务器简单上传和分片上传"
date: 2022-03-18 16:38:21 +0800
description: "前端上传图片到阿里云oss服务器(简单上传和分片上传)_前端怎么将图片免费存到阿里云服务器里面"
keywords: "前端怎么将图片免费存到阿里云服务器里面"
categories: ["未分类"]
tags: ["Layui", "Javascript", "Html"]
artid: "123578215"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=123578215
  alt: "前端上传图片到阿里云oss服务器简单上传和分片上传"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     前端上传图片到阿里云oss服务器(简单上传和分片上传)
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="oss_0">
     </a>
     前端上传文件到阿里云oss服务器(简单上传和分片上传)
    </h3>
    <p>
     最近做的项目用到了阿里云oss服务器，所以在此记录一下。
     <br/>
     1.首先需要申请阿里云oss服务器，然后拿到相关的配置参数
     <br/>
     2.然后在js文件中封装上传相关方法就可以了，此处用的layui的upload方法，通过日期创建文件目录和随机id防止图片存储重复。
     <br/>
     3.记得要引入aliyun-oss-sdk.min.js。
     <br/>
     直接上代码吧~
    </p>
    <pre><code class="prism language-javascript">  <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSS</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// yourRegion填写Bucket所在地域。以华东1（杭州）为例，yourRegion填写为oss-cn-hangzhou。</span>
        <span class="token literal-property property">region</span><span class="token operator">:</span> <span class="token string">'yourRegion'</span><span class="token punctuation">,</span>
        <span class="token comment">// 从STS服务获取的临时访问密钥（AccessKey ID和AccessKey Secret）。</span>
        <span class="token literal-property property">accessKeyId</span><span class="token operator">:</span> <span class="token string">'yourAccessKeyId'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">accessKeySecret</span><span class="token operator">:</span> <span class="token string">'yourAccessKeySecret'</span><span class="token punctuation">,</span>
        <span class="token comment">// 从STS服务获取的安全令牌（SecurityToken）。</span>
        <span class="token literal-property property">stsToken</span><span class="token operator">:</span> <span class="token string">'yourSecurityToken'</span><span class="token punctuation">,</span>
        <span class="token comment">// 填写Bucket名称。</span>
        <span class="token literal-property property">bucket</span><span class="token operator">:</span> <span class="token string">'examplebucket'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
     <span class="token comment">// 指定该Object被下载时网页的缓存行为。</span>
     <span class="token comment">// 'Cache-Control': 'no-cache', </span>
     <span class="token comment">// 指定该Object被下载时的名称。</span>
     <span class="token comment">// 'Content-Disposition': 'oss_download.txt', </span>
     <span class="token comment">//Object生成时会创建相应的ETag ，ETag用于标识一个Object的内容。</span>
     <span class="token comment">// 对于PutObject请求创建的Object，ETag值是其内容的MD5值。</span>
     <span class="token comment">// 对于其他方式创建的Object，ETag值是基于一定计算规则生成的唯一值，但不是其内容的MD5值。</span>
     <span class="token comment">//'ETag':'',</span>
     <span class="token comment">// 指定PutObject操作时是否覆盖同名Object</span>
     <span class="token string-property property">'x-oss-forbid-overwrite'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
      <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取分片上传进度、断点和返回值。</span>
        <span class="token function-variable function">progress</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">p<span class="token punctuation">,</span> cpt<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">//实时返回上传进度（百分比实时渲染，upload-progress容器ID名）</span>
            <span class="token comment">// console.log(p);</span>
            <span class="token keyword">var</span> progress <span class="token operator">=</span> p<span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token comment">// $('#upload-progress').text(progress+'%')//可以在页面设置进度条</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 设置并发上传的分片数量。</span>
        <span class="token literal-property property">parallel</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token comment">// 设置分片大小。默认值为1 MB，最小值为100 KB。</span>
        <span class="token literal-property property">partSize</span><span class="token operator">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
        <span class="token comment">// headers,</span>
        <span class="token comment">// 自定义元数据，通过HeadObject接口可以获取Object的元数据。</span>
        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">year</span><span class="token operator">:</span> <span class="token number">2020</span><span class="token punctuation">,</span> <span class="token literal-property property">people</span><span class="token operator">:</span> <span class="token string">"test"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">mime</span><span class="token operator">:</span> <span class="token string">"text/plain"</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//oss简单上传</span>
   <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">putObject</span><span class="token punctuation">(</span><span class="token parameter">fileName<span class="token punctuation">,</span> data<span class="token punctuation">,</span> fileDir<span class="token punctuation">,</span> dom<span class="token punctuation">,</span> doneCallback<span class="token punctuation">,</span> loading</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">let</span> curDate <span class="token operator">=</span> <span class="token function">formatDate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>fileDir <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> curDate <span class="token operator">+</span> <span class="token string">'/'</span><span class="token operator">+</span> fileName<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
             headers
         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment">//此result.url里面就是上传到阿里云里面的链接</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>doneCallback<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
             <span class="token function">doneCallback</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
         <span class="token punctuation">}</span>
         layer<span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span><span class="token string">'上传成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         layer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>loading<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
     <span class="token comment">// oss分片上传</span>
    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">multipartUploadFn</span><span class="token punctuation">(</span><span class="token parameter">fileName<span class="token punctuation">,</span> data<span class="token punctuation">,</span> fileDir<span class="token punctuation">,</span> dom<span class="token punctuation">,</span> doneCallback<span class="token punctuation">,</span> loading</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">let</span> dateStr <span class="token operator">=</span> <span class="token function">formatDate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> curDate <span class="token operator">=</span> dateStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\-</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 分片上传。</span>
            <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">multipartUpload</span><span class="token punctuation">(</span>fileDir <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> curDate <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> fileName<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
              <span class="token operator">...</span>options<span class="token punctuation">,</span>
              <span class="token comment">// 设置上传回调</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
            <span class="token keyword">var</span> uint8Array <span class="token operator">=</span> res<span class="token punctuation">.</span>res<span class="token punctuation">.</span>data<span class="token punctuation">;</span><span class="token comment">//此时返回的是一个字节，需要转成字符串</span>
            <span class="token keyword">const</span> decoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个TextDecoder对象</span>
            <span class="token keyword">const</span> decodedString <span class="token operator">=</span> decoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>uint8Array<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将Uint8Array转换为字符串</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'decodedString'</span><span class="token punctuation">,</span> decodedString<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">var</span> xmlDoc <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">parseXML</span><span class="token punctuation">(</span>decodedString<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 解析XML字符串为XML文档对象</span>
            <span class="token keyword">var</span> $xml <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>xmlDoc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将XML文档对象转换为jQuery对象</span>

            <span class="token keyword">var</span> statename <span class="token operator">=</span> $xml<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'Key'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 查找并获取Key元素的文本内容</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"statename"</span><span class="token punctuation">,</span> statename<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//此时的statename直接就是一个服务器上的路径，可以拼接上你自己的服务器进行查看了。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </span>

            <span class="token keyword">let</span> result<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">}</span>
            result<span class="token punctuation">.</span>url<span class="token operator">=</span>statename
            <span class="token keyword">if</span> <span class="token punctuation">(</span>doneCallback<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">doneCallback</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            layer<span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span><span class="token string">'上传成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            layer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>loading<span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token parameter">dom<span class="token punctuation">,</span> fileDir<span class="token punctuation">,</span> doneCallback<span class="token punctuation">,</span> ext</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">var</span> exts <span class="token operator">=</span> <span class="token string">'pdf|bmp|jpg|jpeg|png|gif|webp|doc|docx'</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>ext<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
exts <span class="token operator">=</span> ext
<span class="token punctuation">}</span>
<span class="token keyword">var</span> uploadcom<span class="token operator">=</span>upload<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
<span class="token literal-property property">elem</span><span class="token operator">:</span> dom<span class="token punctuation">,</span>
<span class="token literal-property property">accept</span><span class="token operator">:</span> <span class="token string">'file'</span><span class="token punctuation">,</span>
<span class="token literal-property property">multiple</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
<span class="token literal-property property">exts</span><span class="token operator">:</span> exts<span class="token punctuation">,</span>
<span class="token literal-property property">auto</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token function-variable function">choose</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">var</span> loading <span class="token operator">=</span> layer<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
obj<span class="token punctuation">.</span><span class="token function">preview</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> file<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span>
<span class="token keyword">var</span> fileName <span class="token operator">=</span> file<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
<span class="token keyword">var</span> suffix <span class="token operator">=</span> fileName<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileName <span class="token operator">=</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> suffix<span class="token punctuation">[</span>suffix<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>size <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">50</span> <span class="token operator">_</span> <span class="token number">1024</span> <span class="token operator">_</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token comment">// 判断小于 50M 正常上传，大于则需要进行分片</span>
<span class="token function">putObject</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> file<span class="token punctuation">,</span> fileDir<span class="token punctuation">,</span> domStr<span class="token punctuation">,</span> doneCallback<span class="token punctuation">,</span> loading<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
<span class="token function">multipartUploadFn</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> file<span class="token punctuation">,</span> fileDir<span class="token punctuation">,</span> domStr<span class="token punctuation">,</span> doneCallback<span class="token punctuation">,</span> loading<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token punctuation">}</span>
             <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">// 清空历史上传文件，解决choose只执行一次的问题！！！</span>
             uploadcom<span class="token punctuation">.</span>config<span class="token punctuation">.</span>elem<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token comment">//每次随机产生一个唯一的 ID。</span>
<span class="token keyword">function</span> <span class="token function">sId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">\*</span> <span class="token number">0x10000</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">sId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">sId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> <span class="token function">sId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> <span class="token function">sId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> <span class="token function">sId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> <span class="token function">sId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">sId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">sId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 时间戳转时间</span>
<span class="token keyword">function</span> <span class="token function">formatDate</span><span class="token punctuation">(</span><span class="token parameter">date<span class="token punctuation">,</span> isTime</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token constant">YY</span> <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token constant">MM</span> <span class="token operator">=</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token string">'0'</span> <span class="token operator">+</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token constant">DD</span> <span class="token operator">=</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token string">'0'</span> <span class="token operator">+</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> hh <span class="token operator">=</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token string">'0'</span> <span class="token operator">+</span> date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">':'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> mm <span class="token operator">=</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token string">'0'</span> <span class="token operator">+</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">':'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ss <span class="token operator">=</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token string">'0'</span> <span class="token operator">+</span> date<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> date<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>isTime<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">return</span> <span class="token constant">YY</span> <span class="token operator">+</span> <span class="token constant">MM</span> <span class="token operator">+</span> <span class="token constant">DD</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> hh <span class="token operator">+</span> mm <span class="token operator">+</span> ss<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">return</span> <span class="token constant">YY</span> <span class="token operator">+</span> <span class="token constant">MM</span> <span class="token operator">+</span> <span class="token constant">DD</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>

   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f6170706c656261646d2f:61727469636c652f64657461696c732f313233353738323135" class_="artid" style="display:none">
 </p>
</div>
