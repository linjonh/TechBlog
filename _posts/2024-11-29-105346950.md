---
layout: post
title: "我的UWB学习之旅一-硬件篇"
date: 2024-11-29 10:41:00 +0800
description: "我的UWB学习之旅（一）------- 硬件篇前言方案选择UWB方案MCU方案数据上传方案原理图部分"
keywords: "uwb基站 pcb"
categories: ['']
tags: ['经验分享', '单片机']
artid: "105346950"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=105346950
    alt: "我的UWB学习之旅一-硬件篇"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     我的UWB学习之旅（一）------- 硬件篇
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      我的UWB学习之旅（一）------- 硬件篇
     </h4>
     <ul>
      <li>
       <a href="#_2" rel="nofollow">
        前言
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_6" rel="nofollow">
          方案选择
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#UWB_7" rel="nofollow">
            UWB方案
           </a>
          </li>
          <li>
           <a href="#MCU_10" rel="nofollow">
            MCU方案
           </a>
          </li>
          <li>
           <a href="#_12" rel="nofollow">
            数据上传方案
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#_15" rel="nofollow">
          原理图部分
         </a>
        </li>
        <li>
         <a href="#PCB_31" rel="nofollow">
          PCB示例
         </a>
        </li>
        <li>
         <a href="#_33" rel="nofollow">
          资料参考
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="_2">
     </a>
     前言
    </h2>
    <p>
     博主本人目前是一名大四学生，由于大一时期的某个辣鸡比赛导致了我本人在大学四年一直对室内定位技术抱有奇妙的感情。然而大学四年整天都在忙于一些奇奇怪怪的小项目或其他事情，一直没有涉足这个领域。临近毕业的时候才算是想到要给自己这个奇妙的感情一个交代，于是便选择了UWB室内定位方面的应用作为我的毕业设计。我会尽量在这里记录我做毕业设计的整个过程，也算是为后来其他要学习这方面的大佬们当一当垫脚石把（笑）。其他废话就不说了，我们直入正题。
    </p>
    <h3>
     <a id="_6">
     </a>
     方案选择
    </h3>
    <h4>
     <a id="UWB_7">
     </a>
     UWB方案
    </h4>
    <p>
     UWB的方案当然是采用炙手可热的Decawave公司生产的
     <strong>
      DW1000
     </strong>
     芯片（说实话我也没去找其他）。然而我自己本身也是个穷人，买不起那么多个该公司已经做好的成品模块DWM1000，所以我决定直接采用芯片，自行寻找资料来设计外部电路。
    </p>
    <h4>
     <a id="MCU_10">
     </a>
     MCU方案
    </h4>
    <p>
     控制器我直接选用了
     <strong>
      stm32f103c8t6
     </strong>
     ，这个芯片可能是目前最热门的低端控制器（之一）了吧，几乎每一个电类大学生都接触过这个芯片，本身价格也相对美丽。Decawave官方提供的工程也是按照这个系列的芯片来建立的，所以也方便我们后续编程的时候库的移植。不过在此我先说明一下，stm32f103系列芯片是
     <strong>
      不带
     </strong>
     硬件浮点运算单元（FPU）的，所以选择这个系列的芯片最好是打消本地进行TDOA或TOA运算的念头。不带浮点运算单元的处理器计算小数是很慢的，这会对整个UWB系统的实时性带来极大的影响（切身体会。。。）。
    </p>
    <h4>
     <a id="_12">
     </a>
     数据上传方案
    </h4>
    <p>
     数据上传方面我采用了安信可公司（经用户qq_39277294指正）的WIFI模块
     <strong>
      ESP-12S
     </strong>
     。说实话本来我是打算直接一个串口连一个蓝牙发到电脑了事的，但是毕设嘛，总想搞点花里胡哨的东西hhh，况且自己写个TCP上位机也没多难。
    </p>
    <h3>
     <a id="_15">
     </a>
     原理图部分
    </h3>
    <p>
     DW1000的应用原理图其实官方已经给出，各位翻一翻datasheet或者硬件设计文档（APH001 DW1000 HW Design Guide v1.1）就可以找到。但是为了方便一些英语不好的同学，我决定还是在这个地方把它贴出来：
     <br/>
     <img alt="Decawave官方提供的DW1000芯片应用原理图" src="https://i-blog.csdnimg.cn/blog_migrate/2adfd1a7e8bc6c5cbaf74d031ef9f662.png#pic_center">
      <br/>
      这里面有几点很坑的地方：
     </img>
    </p>
    <ol>
     <li>
      <p>
       芯片的16和17脚，即RF_N和RF_P这两个引脚是芯片的射频信号接收脚，有过设计基础的同学都知道这里到应该走
       <strong>
        差分线
       </strong>
       来减小噪声，保证信号的正常。不过官方图这里并没有标出，所以在此先提个醒，如果是第一次做这类的话，请保证16和17脚到两个12pF的电容，两个电容到T1变压器的走线一定要走差分线。如果不知道如何在AD中添加差分线的话可以看看下面这个链接
       <a href="https://www.bilibili.com/video/BV1p4411V7vH?from=search&amp;seid=3767794084069416128" rel="nofollow">
        Altium Designer 19全套入门技巧：差分线的添加走线与蛇形等长
       </a>
       （PS：B站真的是个好东西，有啥不会的就去上面找找吧，八成都有视频讲解）。
      </p>
     </li>
     <li>
      <p>
       还是这两个脚，在给出的途中可以看到天线到变压器的连线上有一个Trace 50R，引脚到电容的连线上有一个Trace 100R，这两个地方的意思是天线到变压器之间的走线需要满足50欧姆的单端阻抗，而电容到引脚之间的走线需要满足100欧姆的双端阻抗。那么问题就来了，我查了好多资料，一般都是在设计四层或以上层数的PCB时才会考虑阻抗匹配问题，以至于你拿个双层板去找PCB打样厂商说要做阻抗匹配别人都不会鸟你（切身经历。。。），那怎么办呢？
       <br/>
       答案就是不管他
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ff6e5d0af1171365ba689c57bfa98947.png">
        在我搞了大半天以后，我发现我直接拿7mil和35mil的线直接连上以后居然什么问题都没有，接收发送一切正常。由于我在画射频板方面也是个菜鸡，所以具体这个阻抗问题如何应用就交给大佬们来研究了。不过有一点，射频端的器件一定不要分的太开了，走线一定要短，emmmm，还有不要在周围铺地。
       </img>
      </p>
     </li>
     <li>
      <p>
       DW1000这个芯片是有内置锁相环的，而它锁相环的滤波器却是外置的，就是8和12这两个引脚。PDF上对这两个引脚的解释如下：
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3cc413fc9372fd9b7c79cd11db31e53b.png#pic_center">
        意思就是锁相环的外部滤波器接口，8脚与VDDCLK（9脚）构成一个RC滤波器，12脚与VCCVCO（11脚）构成RC滤波器。这两个外接RC滤波器的布线一定要多注意，不要弄成弯弯曲曲来回绕的了，不然可能会由于外部噪声过大导致内部锁相环失锁。
       </img>
      </p>
     </li>
     <li>
      <p>
       最头疼的就是VDDLDOD（26脚）和VDDLDOA（48脚），这两个脚手册上给出的是连接1.8V电源，对他们的介绍也只是说明了他们分别是模拟和数字的外部供电引脚，
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7d490cd69323bc4fed37950beb1a34e3.png#pic_center">
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d47f4dc185364ced578b13860707a348.png#pic_center">
         <br/>
         支持1.6V到3.6V的输入并且推荐1.8V，
         <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9460ca8c888b5178f8e7c9ac06416a21.png#pic_center">
          但是我在实际使用的时候，1.8V供电时会产生误码，在以1Hz的频率发送1000次数据包后累计错误达到117次，我也不知道为啥会产生这么高的误码率。直到好死不死有一次我把这两个引脚直接接到3.3V电源以后，我连续发送了一下午一个误码都没有。这个问题我也实在没想明白，所以建议大家自己设计完板子后自己两种供电方式都测试一下，如果1.8V情况下没有我这么高的误码的话还是用1.8V吧，毕竟这样功耗会小不少。
         </img>
        </img>
       </img>
      </p>
     </li>
     <li>
      <p>
       最后就是选1.8VDC-DC芯片的时候，一定要注意选一个功率稍微高一点的，官方在芯片的直流特性上是这样给出的
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ad12165eb76a4373fd164786c22b6c3a.png#pic_center">
        <br/>
        也就是说，它在接收信号的时候，1.8V供电的引脚端电流会飙升到
        <strong>
         210mA
        </strong>
        ，而发送信号时也有
        <strong>
         90mA
        </strong>
        。如果选用功率较低的芯片供电的话是会直接被拖垮的，然后你就会看到0x0F这个寄存器内锁相环失锁的标志位再一次被置一了。。。顺便一提，官方用的1.8VDC-DC芯片是这个：LXDC2HL-18A
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3b7eca9633018a112dc58ae6895b9d33.png"/>
        ，我就是用它搞出了解决10%的误码率，各位使用的话自行斟酌吧。。。
       </img>
      </p>
     </li>
    </ol>
    <h3>
     <a id="PCB_31">
     </a>
     PCB示例
    </h3>
    <p>
     我把我自己画的PCB贴出来供大家参考一下。我自己布线的本领也不是很好，所以大佬就可以直接跳过吧，小白的话可以参考一下哦。
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6df4b10ed1502e88c300a00c6eaf1308.png#pic_center"/>
    </p>
    <h3>
     <a id="_33">
     </a>
     资料参考
    </h3>
    <p>
     我把我的资料和官方资料分别打包上传了，官方资料不要积分，大家如果需要的话可以去下载：
     <br/>
     <a href="https://download.csdn.net/download/qq_36982736/12308519">
      UWB基站硬件（我的资料）
     </a>
     <br/>
     <a href="https://download.csdn.net/download/qq_36982736/12308576">
      DWM1000Solfware（官方资料）
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33363938323733362f:61727469636c652f64657461696c732f313035333436393530" class_="artid" style="display:none">
 </p>
</div>


