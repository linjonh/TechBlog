---
layout: post
title: "串口通信"
date: 2024-03-25 14:16:09 +0800
description: "概念串口通信（Serial Communications）的概念非常简单，串口按位（bit）发送和接"
keywords: "通信端口com有256个"
categories: ["未分类"]
tags: ["网络", "嵌入式", "Matlab"]
artid: "101727911"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=101727911
  alt: "串口通信"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     串口通信
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <div class="blogpost-body" id="cnblogs_post_body">
     <div class="Section0">
      <p align="center">
       <span style="font-family:'仿宋';">
       </span>
      </p>
     </div>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        概念
       </strong>
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <a href="https://baike.baidu.com/item/%E4%B8%B2%E5%8F%A3" rel="nofollow">
        串口
       </a>
       通信（Serial Communications）的概念非常简单，串口按位（bit）发送和接收
       <a href="https://baike.baidu.com/item/%E5%AD%97%E8%8A%82" rel="nofollow">
        字节
       </a>
       。与串行通信相对的是并行通信。数据传输一般都是以字节传输的，一个字节8个位。拿一个并行通信举例来说，也就是会有8根线，每一根线代表一个位。一次传输就可以传一个字节，而串口通信，就是传数据只有一根线传输，一次只能传一个位，要传一个字节就需要传8次。就像小虎队那首歌一样，把你的心，我的心，串一串，再烤一烤。。串口通信就是把数据串在一根线上传输，所以就叫串口吧。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        通信方式
       </strong>
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       一般情况下，设备之间的通信方式可以分成
       <strong>
        并行通信和串行通信
       </strong>
       两种。它们的区别是：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/e59f312c55d461d2fe4b02c6b1f135e7.png"/>
      </span>
     </p>
     <p>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        串行通信分类
       </strong>
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        1、
       </strong>
       <strong>
        按照数据传送方向
       </strong>
       <strong>
        分为
       </strong>
       <strong>
        ：
       </strong>
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        单工
       </strong>
       ：数据传输只支持数据在一个方向上传输；
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        半双工
       </strong>
       ：允许数据在两个方向上传输。但是，在某一时刻，只允许数据在一个方向上传输，它实际上是一种切换方向的单工通信；它不需要独立的接收端和发送端，两者可以合并一起使用一个端口。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       全双工：允许数据同时在两个方向上传输。因此，全双工通信是两个单工通信方式的结合，需要独立的接收端和发送端。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/307157f4d9a2499622f4c531639b90e4.png"/>
      </span>
     </p>
     <p>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        2、按照通信方式分为：
       </strong>
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        同步通信
       </strong>
       ：带时钟同步信号传输。比如：SPI，IIC通信接口。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        异步通信
       </strong>
       ：不带时钟同步信号。比如：UART(通用异步收发器)，单总线。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/8cec9d42834cc7dc84113d0f5e8b562d.png"/>
      </span>
     </p>
     <p>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       异步通信的两个关键：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       第一，数据单元——帧，它是双方约定好的数据格式；
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       第二，波特率，它决定了‘帧’里每一位的时间长度。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        异步通信的特点
       </strong>
       ：不要求收发双方时钟的严格一致，实现容易，设备开销较小，但每个字符要附加2～3位用于起止位，各帧之间还有间隔，因此传输效率不高。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       在同步通讯中，收发设备上方会使用一根信号线传输信号，在时钟信号的驱动下双方进行协调，同步数据。例如，通讯中通常双方会统一规定在时钟信号的上升沿或者下降沿对数据线进行采样。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       在异步通讯中不使用时钟信号进行数据同步，它们直接在数据信号中穿插一些用于同步的信号位，或者将主题数据进行打包，以数据帧的格式传输数据。通讯中还需要双方规约好数据的传输速率（也就是波特率）等，以便更好地同步。常用的
       <a href="#_%E6%B3%A2%E7%89%B9%E7%8E%87%E6%A6%82%E5%BF%B5" rel="nofollow">
        <span style="text-decoration:underline;">
         波特率
        </span>
       </a>
       有4800bps、9600bps、115200bps等。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       在同步通讯中，数据信号所传输的内容绝大部分是有效数据，而异步通讯中会则会包含数据帧的各种标识符，所以同步通讯效率高，但是同步通讯双方的时钟允许误差小，稍稍时钟出错就可能导致数据错乱，异步通讯双方的时钟允许误差较大。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        串口通讯的数据格式
       </strong>
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/77c297d20ba10498e56e51b09eb83b92.png"/>
      </span>
     </p>
     <p>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       一个字符一个字符地传输，每个字符一位一位地传输，并且传输一个字符时，总是以“起始位”开始，以“停止位”结束，字符之间没有固定的时间间隔要求。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       每一个字符的前面都有一位起始位(低电平)，字符本身由7位数据位组成，接着字符后面是一位校验位(检验位可以是奇校验、偶校验或无校验位)，最后是一位或一位半或二位停止位，停止位后面是不定长的空闲位，停止位和空闲位都规定为高电平。实际传输时每一位的信号宽度与波特率有关，波特率越高，宽度越小，在进行传输之前，双方一定要使用同一个波特率设置。
      </span>
     </p>
     <h3>
      <span style="font-family:'仿宋';">
       <strong>
        偶校验与奇校验
       </strong>
      </span>
     </h3>
     <p>
      <span style="font-family:'仿宋';">
       在标准ASCII码中，其最高位(b7)用作奇偶校验位。所谓奇偶校验，是指在代码传送过程中用来检验是否出现错误的一种方法，一般分奇校验和偶校验两种。奇校验规定：正确的代码一个字节中1的个数必须是奇数，若非奇数，则在最高位b7添1；偶校验规定：正确的代码一个字节中1的个数必须是偶数，若非偶数，则在最高位b7添1。
      </span>
     </p>
     <h3>
      <span style="font-family:'仿宋';">
       <strong>
        停止位
       </strong>
      </span>
     </h3>
     <p>
      <span style="font-family:'仿宋';">
       停止位是按长度来算的。串行异步通信从计时开始，以单位时间为间隔（一个单位时间就是波特率的倒数），依次接受所规定的数据位和奇偶校验位，并拼装成一个字符的并行字节；此后应接收到规定长度的停止位“1”。所以说，停止位都是“1”，1.5是它的长度，即停止位的高电平保持1.5个单位时间长度。一般来讲，停止位有1，1.5，2个单位时间三种长度
      </span>
     </p>
     <h3>
      <span style="font-family:'仿宋';">
       <strong>
        常见的串行通信接口
       </strong>
      </span>
     </h3>
     <p>
      <span style="font-family:'仿宋';">
       <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/713cb9fb13877707e9c5a6ed9ad6a605.png"/>
      </span>
     </p>
     <p>
     </p>
     <h3>
      <span style="font-family:'仿宋';">
       <strong>
        原理
       </strong>
      </span>
     </h3>
     <p>
      <span style="font-family:'仿宋';">
       尽管比按字节（byte）的
       <a href="https://baike.baidu.com/item/%E5%B9%B6%E8%A1%8C%E9%80%9A%E4%BF%A1" rel="nofollow">
        并行通信
       </a>
       慢，但是串口可以在使用一根线发送数据的同时用另一根线接收数据。它很简单并且能够实现远距离通信。比如
       <a href="https://baike.baidu.com/item/IEEE" rel="nofollow">
        IEEE
       </a>
       488定义并行通行状态时，规定设备线总长不得超过20米，并且任意两个设备间的长度不得超过2米；而对于串口而言，长度可达1200米。典型地，串口用于
       <a href="https://baike.baidu.com/item/ASCII%E7%A0%81" rel="nofollow">
        ASCII码
       </a>
       字符的传输。通信使用3根线完成，分别是地线、发送、接收。由于串口通信是异步的，端口能够在一根线上发送数据同时在另一根线上接收数据。其他线用于握手，但不是必须的。串口通信最重要的参数是
       <a href="https://baike.baidu.com/item/%E6%B3%A2%E7%89%B9%E7%8E%87" rel="nofollow">
        波特率
       </a>
       、
       <a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E4%BD%8D" rel="nofollow">
        数据位
       </a>
       、停止位和
       <a href="https://baike.baidu.com/item/%E5%A5%87%E5%81%B6%E6%A0%A1%E9%AA%8C" rel="nofollow">
        奇偶校验
       </a>
       。对于两个进行通信的端口，这些参数必须匹配。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/2ede90247a1370220a8b9690e7315b8a.png"/>
      </span>
     </p>
     <p>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       参数介绍：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       a，波特率：这是一个衡量符号传输速率的参数。指的是信号被调制以后在单位时间内的变化，即单位时间内
       <a href="https://baike.baidu.com/item/%E8%BD%BD%E6%B3%A2" rel="nofollow">
        载波
       </a>
       参数变化的次数，如每秒钟传送240个字符，而每个字符格式包含10位（1个起始位，1个停止位，8个数据位），这时的波特率为240Bd，比特率为10位*240个/秒=2400bps。一般调制速率大于波特率，比如曼彻斯特编码）。通常电话线的波特率为14400，28800和36600。波特率可以远远大于这些值，但是波特率和距离成反比。高波特率常常用于放置的很近的仪器间的通信，典型的例子就是GPIB设备的通信。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       b，
       <a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E4%BD%8D" rel="nofollow">
        数据位
       </a>
       ：这是衡量通信中实际数据位的参数。当计算机发送一个信息包，实际的数据往往不会是8位的，标准的值是6、7和8位。如何设置取决于你想传送的信息。比如，标准的ASCII码是0～127（7位）。扩展的ASCII码是0～255（8位）。如果数据使用简单的文本（标准 ASCII码），那么每个
       <a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%8C%85" rel="nofollow">
        数据包
       </a>
       使用7位数据。每个包是指一个
       <a href="https://baike.baidu.com/item/%E5%AD%97%E8%8A%82" rel="nofollow">
        字节
       </a>
       ，包括开始/停止位，数据位和
       <a href="https://baike.baidu.com/item/%E5%A5%87%E5%81%B6%E6%A0%A1%E9%AA%8C%E4%BD%8D" rel="nofollow">
        奇偶校验位
       </a>
       。由于实际数据位取决于
       <a href="https://baike.baidu.com/item/%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE" rel="nofollow">
        通信协议
       </a>
       的选取，术语“包”指任何通信的情况。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       c，停止位：用于表示单个包的最后一位。典型的值为1，1.5和2位。由于数据是在传输线上定时的，并且每一个设备有其自己的时钟，很可能在通信中两台
       <a href="https://baike.baidu.com/item/%E8%AE%BE%E5%A4%87%E9%97%B4" rel="nofollow">
        设备间
       </a>
       出现了小小的不同步。因此停止位不仅仅是表示传输的结束，并且提供计算机校正
       <a href="https://baike.baidu.com/item/%E6%97%B6%E9%92%9F%E5%90%8C%E6%AD%A5" rel="nofollow">
        时钟同步
       </a>
       的机会。适用于停止位的位数越多，不同时钟同步的容忍程度越大，但是数据传输率同时也越慢。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       d，奇偶校验位：在
       <a href="https://baike.baidu.com/item/%E4%B8%B2%E5%8F%A3" rel="nofollow">
        串口
       </a>
       通信中一种简单的检错方式。有四种检错方式：偶、奇、高和低。当然没有校验位也是可以的。对于偶和
       <a href="https://baike.baidu.com/item/%E5%A5%87%E6%A0%A1%E9%AA%8C" rel="nofollow">
        奇校验
       </a>
       的情况，串口会设置校验位（
       <a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E4%BD%8D" rel="nofollow">
        数据位
       </a>
       后面的一位），用一个值确保传输的数据有偶个或者奇个逻辑高位。例如，如果数据是011，那么对于
       <a href="https://baike.baidu.com/item/%E5%81%B6%E6%A0%A1%E9%AA%8C" rel="nofollow">
        偶校验
       </a>
       ，校验位为0，保证逻辑高的位数是偶数个。如果是奇校验，校验位为1，这样就有3个逻辑高位。高位和低位不真正的检查数据，简单置位逻辑高或者逻辑低校验。这样使得接收设备能够知道一个位的状态，有机会判断是否有噪声干扰了通信或者是否传输和接收数据是否不同步。
      </span>
     </p>
     <h3>
      <span style="font-family:'仿宋';">
       <strong>
       </strong>
      </span>
     </h3>
     <h3>
      <span style="font-family:'仿宋';">
       <strong>
        串口通信过程
       </strong>
      </span>
     </h3>
     <h3>
      <span style="font-family:'仿宋';">
       <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/c322d5998529375b3bb343c5aba6acb9.png"/>
      </span>
     </h3>
     <p>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <h3>
      <span style="font-family:'仿宋';">
       <strong>
        结构
       </strong>
      </span>
     </h3>
     <p>
      <span style="font-family:'仿宋';">
       串口通信是指外设和计算机间，通过数据信号线 、地线、控制线等，按位进行传输数据的一种通讯方式。这种通信方式使用的数据线少，在远距离通信中可以节约通信成本，但其传输速度比并行传输低。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <a href="https://baike.baidu.com/item/%E4%B8%B2%E5%8F%A3" rel="nofollow">
        串口
       </a>
       是计算机上一种非常通用的设备通信协议。大多数计算机（不包括笔记本电脑）包含两个基于
       <a href="https://baike.baidu.com/item/RS-232" rel="nofollow">
        RS-232
       </a>
       的串口。串口同时也是仪器仪表设备通用的通信协议；很多
       <a href="https://baike.baidu.com/item/GPIB" rel="nofollow">
        GPIB
       </a>
       兼容的设备也带有RS-232口。同时，
       <a href="https://baike.baidu.com/item/%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE" rel="nofollow">
        串口通信协议
       </a>
       也可以用于获取远程采集设备的数据。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       RS-232（ANSI/EIA-232标准）是IBM-PC及其兼容机上的串行连接标准。可用于许多用途，比如连接鼠标、
       <a href="https://baike.baidu.com/item/%E6%89%93%E5%8D%B0%E6%9C%BA" rel="nofollow">
        打印机
       </a>
       或者Modem，同时也可以接工业仪器仪表。用于驱动和连线的改进，实际应用中RS-232的传输长度或者速度常常超过标准的值。RS-232只限于PC串口和设备间点对点的通信。RS-232串口通信最远距离是50英尺。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        串口通信协议
       </strong>
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       在串口通信中，常用的协议包括RS-232、RS-422和RS-485。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       RS-232（ANSI/EIA-232标准）是IBM-PC及其兼容机上的串行连接标准。可用于许多用途，比如连接鼠标、打印机或者Modem，同时也可以接工业仪器仪表。用于驱动和连线的改进，实际应用中RS-232的传输长度或者速度常常超过标准的值。RS-232只限于PC串口和
       <a href="https://baike.baidu.com/item/%E8%AE%BE%E5%A4%87%E9%97%B4" rel="nofollow">
        设备间
       </a>
       点对点的通信。RS-232
       <a href="https://baike.baidu.com/item/%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1" rel="nofollow">
        串口通信
       </a>
       最远距离是50英尺。
      </span>
     </p>
     <h3>
      <span style="font-family:'仿宋';">
       <strong>
        RS-
       </strong>
       <strong>
        232
       </strong>
      </span>
     </h3>
     <p>
      <span style="font-family:'仿宋';">
       在我们电脑上，一般都会有一个9针的串行接口，这个串行接口叫做RS232接口，它和UART通信有关联，但是由于现在笔记本电脑不带9针串口，所以和单片机通信越来越趋于使用USB虚拟串口。它以全双工方式工作，需要地线、发送线和接收线三条线。RS232只能实现点对点的通信方式。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       九针串口分工头和母头：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       公头上5下4，上5从左到右为1.2.3.4.5；下4从左到右为6.7.8.9；
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       母头上5下4，上5从左到右为5.4.3.2.1；下4从左到右为9.8.7.6；
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       DB-9针连接头(常见的RS232串口)
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/9d5c0d76e782e34690cab598203b1914.png"/>
      </span>
     </p>
     <p>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       RS-232针脚的功能：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        数据
       </strong>
       ：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       TXD（pin 3）：串口
       <a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E8%BE%93%E5%87%BA" rel="nofollow">
        数据输出
       </a>
       (Transmit Data)
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       RXD（pin 2）：串口数据输入(Receive Data)
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        握手：
       </strong>
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       RTS（pin 7）：发送数据请求(Request to Send)
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       CTS（pin 8）：
       <a href="https://baike.baidu.com/item/%E6%B8%85%E9%99%A4%E5%8F%91%E9%80%81" rel="nofollow">
        清除发送
       </a>
       (Clear to Send)
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       DSR（pin 6）：数据发送就绪(Data Send Ready)
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       DCD（pin 1）：数据载波检测(Data Carrier Detect)
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       DTR（pin 4）：数据终端就绪(Data Terminal Ready)
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        地线：
       </strong>
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       GND（pin 5）：地线
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       其它
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       RI（pin 9）：铃声指示
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        RS232串口缺点
       </strong>
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       1. 接口信号电平值较高，接口电路芯片容易损坏。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       2. 传输速率低，最高波特率19200bps。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       3. 抗干扰能力较差。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       4. 传输距离有限，一般在15m以内。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       5. 只能实现点对点的通讯方式。
      </span>
     </p>
     <h3>
      <span style="font-family:'仿宋';">
       <strong>
        RS-422
       </strong>
      </span>
     </h3>
     <p>
      <span style="font-family:'仿宋';">
       RS-422（EIA RS-422-AStandard）是Apple的Macintosh计算机的
       <a href="https://baike.baidu.com/item/%E4%B8%B2%E5%8F%A3%E8%BF%9E%E6%8E%A5" rel="nofollow">
        串口连接
       </a>
       标准。RS-422使用差分信号，RS-232使用非平衡参考地的信号。差分传输使用两根线发送和接收信号，对比RS-232，它能更好的抗噪声和有更远的传输距离。在工业环境中更好的抗噪性和更远的传输距离是一个很大的优点。
      </span>
     </p>
     <h3>
      <span style="font-family:'仿宋';">
       <strong>
        RS-485
       </strong>
       <strong>
        (半双工)
       </strong>
      </span>
     </h3>
     <p>
      <span style="font-family:'仿宋';">
       <a href="https://baike.baidu.com/item/RS-485" rel="nofollow">
        RS-485
       </a>
       （
       <a href="https://baike.baidu.com/item/EIA-485" rel="nofollow">
        EIA-485
       </a>
       标准）是RS-422的改进，因为它增加了设备的个数，从10个增加到32个，同时定义了在最大设备个数情况下的电气特性，以保证足够的信号电压。有了多个设备的能力，你可以使用一个单个RS-485口建立设备网络。出色抗噪和多设备能力，在工业应用中建立连向PC机的分布式设备网络、其他
       <a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E6%94%B6%E9%9B%86" rel="nofollow">
        数据收集
       </a>
       控制器、HMI或者其他操作时，串行连接会选择RS-485。RS-485是RS-422的超集，因此所有的RS-422设备可以被RS-485控制。RS-485可以用超过4000英尺的线进行串行通行。
      </span>
     </p>
     <h3>
      <span style="font-family:'仿宋';font-size:15px;">
       <strong>
        RS485串口特点
       </strong>
       <strong>
        :
       </strong>
      </span>
      <br/>
      <span style="font-family:'仿宋';font-size:15px;">
       1. RS485采用平衡发送和差分接收，具有良好的抗干扰能力,信号能传输上千米。
      </span>
      <br/>
      <span style="font-family:'仿宋';font-size:15px;">
       2. RS485有两线制和四线制两种接线。采用四线制时，只能实现点对多的通讯(即只能有一个主设备，其余为从设备)。四线制现在很少采用，现在多采用两线制接线方式。
      </span>
      <br/>
      <span style="font-family:'仿宋';font-size:15px;">
       3. 两线制RS485只能以半双式方式工作，收发不能同时进行。
      </span>
      <br/>
      <span style="font-family:'仿宋';font-size:15px;">
       4. RS485在同一总线上最多可以接32个结点，可实现真正的多点通讯，但一般采用的是主从通信方式，即一个主机带多个从机。
      </span>
      <br/>
      <span style="font-family:'仿宋';font-size:15px;">
       5. 因RS485接口具有良好的抗干扰能力，长的传输距离和多站能力等优点使其成为首选的串行接口。
      </span>
     </h3>
     <p>
      <span style="font-family:'仿宋';">
       <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/0c0e465c6f1fb0e64383274edfc8f5de.png"/>
      </span>
     </p>
     <p>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       图6-1 485抑制共模干扰示意图
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       RS485串口接口定义:
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       A或Data+(D+)或+：信号正
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       B或Data-(D-)或-：信号负
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        计算机与RS485仪表通讯
       </strong>
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       计算机自带的串口只有RS232，没有RS485，如果计算机要与RS485串口的仪表进行通讯，必须使用串口转换器或装上RS485串口转换卡后才能进行通讯。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        R
       </strong>
       <strong>
        S485串口的终端电阻
       </strong>
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       1. 一般情况下不需要增加终端电阻，只有在RS485通信距离超过100米的情况下，要在RS485通讯的开始端和结束端增加终端电阻，RS485典型终端电阻是120欧。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       2. 终端电阻是为了消除在通信电缆中的信号反射在通信过程中，有两种信号因导致信号反射：阻抗不连续和阻抗不匹配。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       3. 阻抗不连续，信号在传输线末端突然遇到电缆阻抗很小甚至没有，信号在这个地方就会引起反射。消除这种反射的方法，就必须在电缆的末端跨接一个与电缆的特性阻抗同样大小的终端电阻，使电缆的阻抗连续。由于信号在电缆上的传输是双向的，因此，在通讯电缆的另一端可跨接一个同样大小的终端电阻。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       4. 引起信号反射的另一原因是数据收发器与传输电缆之间的阻抗不匹配。这种原因引起的反射，主要表现在通讯线路处在空闲方式时，整个网络数据混乱。要减弱反射信号对通讯线路的影响，通常采用噪声抑制和加偏置电阻的方法。在实际应用中，对于比较小的反射信号，为简单方便，经常采用加偏置电阻的方法。
      </span>
     </p>
     <h3>
      <span style="font-family:'仿宋';">
       <strong>
       </strong>
      </span>
     </h3>
     <h3>
      <span style="font-family:'仿宋';">
       <strong>
        USB转串口通信
       </strong>
      </span>
     </h3>
     <p>
      <span style="font-family:'仿宋';">
       <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/635a428095149686d7a1edaf1b920b82.png"/>
      </span>
     </p>
     <p>
     </p>
     <p align="justify" class="p">
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p align="justify" class="p">
      <span style="font-family:'仿宋';">
       随着技术的发展，工业上还有RS232串口通信的大量使用，但是商业技术的应用上，已经慢慢的使用USB转UART技术取代了RS232串口，绝大多数笔记本电脑已经没有串口这个东西了，那我们要实现单片机和电脑之间的通信该怎么办呢？
      </span>
     </p>
     <p align="justify" class="p">
      <span style="font-family:'仿宋';">
       们只需要在电路上添加一个USB转串口芯片，就可以成功实现USB通信协议和标准UART串行通信协议的转换，在我们的开发板上，我们使用的是CH340T这个芯片
      </span>
     </p>
     <p align="justify" class="p">
      <span style="font-family:'仿宋';">
       我们需要用跳线帽把中间和下边的针短接在一起。右侧的CH340T这个电路很简单，把电源、晶振接好后，6脚和7脚的DP和DM分别接USB口的2个数据引脚上去，3脚和4脚通过跳线接到了我们单片机的TXD和RXD上去。
      </span>
     </p>
     <p align="justify" class="p">
      <span style="font-family:'仿宋';">
       CH340T的电路里3脚位置加了个4148的二极管，是一个小技巧。因为STC89C52这个单片机下载程序时需要冷启动，就是先点下载后上电，上电瞬间单片机会先检测需要不需要下载程序。虽然单片机的VCC是由开关来控制，但是由于CH340T的3脚是输出引脚，如果没有此二极管，开关后级单片机在断电的情况下，CH340T的3脚和单片机的P3.0（即RXD）引脚连在一起，有电流会通过这个引脚流入后级电路并且给后级的电容充电，造成后级有一定幅度的电压，这个电压值虽然只有两三伏左右，但是可能会影响到正常的冷启动。加了二极管后，一方面不影响通信，另外一个方面还可以消除这种不良影响。这个地方可以暂时作为了解，大家如果自己做这类电路，可以参考一下。
      </span>
     </p>
     <h3>
      <span style="font-family:'仿宋';">
       <strong>
        IO口模拟UART串口通信
       </strong>
      </span>
     </h3>
     <p align="justify" class="p">
      <span style="font-family:'仿宋';">
       UART串口波特率，常用的值是300、600、1200、2400、4800、9600、14400、19200、28800、38400、57600、115200等速率。IO口模拟UART串行通信程序是一个简单的演示程序，我们使用串口调试助手下发一个数据，数据加1后，再自动返回。
      </span>
     </p>
     <p align="justify" class="p">
      <span style="font-family:'仿宋';">
       串口调试助手，这里我们直接使用STC-ISP软件自带的串口调试助手，先把串口调试助手的使用给大家说一下，如图11-6所示。第一步要选择串口助手菜单，第二步选择十六进制显示，第三步选择十六进制发送，第四步选择COM口，这个COM口要和自己电脑设备管理器里的那个COM口一致，波特率按我们程序设定好的选择，我们程序中让一个数据位持续时间是1/9600秒，那这个地方选择波特率就是选9600，校验位选N，数据位8，停止位1。
      </span>
     </p>
     <p align="justify" class="p">
      <span style="font-family:'仿宋';">
       串口调试助手的实质就是利用电脑上的UART通信接口，发送数据给我们的单片机，也可以把我们的单片机发送的数据接收到这个调试助手界面上。
      </span>
     </p>
     <p align="justify" class="p">
      <span style="font-family:'仿宋';">
       因为初次接触通信方面的技术，所以我把后面的IO模拟串口通信程序进行一下解释，大家可以边看我的解释边看程序，把底层原理先彻底弄懂。
      </span>
     </p>
     <p align="justify" class="p">
      <span style="font-family:'仿宋';">
       变量定义部分就不用说了，直接看main主函数。首先是对通信的波特率的设定，在这里我们配置的波特率是9600，那么串口调试助手也得是9600。配置波特率的时候，我们用的是定时器T0的模式2。模式2中，不再是TH0代表高8位，TL0代表低8位了，而只有TL0在进行计数，当TL0溢出后，不仅仅会让TF0变1，而且还会将TH0中的内容重新自动装到TL0中。这样有一个好处，就是我们可以把想要的定时器初值提前存在TH0中，当TL0溢出后，TH0自动把初值就重新送入TL0了，全自动的，不需要程序中再给TL0重新赋值了，配置方式很简单，大家可以自己看下程序并且计算一下初值。
      </span>
     </p>
     <p align="justify" class="p">
      <span style="font-family:'仿宋';">
       波特率设置好以后，打开中断，然后等待接收串口调试助手下发的数据。接收数据的时候，首先要进行低电平检测while（PIN_RXD），若没有低电平则说明没有数据，一旦检测到低电平，就进入启动接收函数StartRXD（）。接收函数最开始启动半个波特率周期，初学可能这里不是很明白。大家回头看一下我们的图11-2里边的串口数据示意图，如果在数据位电平变化的时候去读取，因为时序上的误差以及信号稳定性的问题很容易读错数据，所以我们希望在信号最稳定的时候去读数据。除了信号变化的那个沿的位置外，其它位置都很稳定，那么我们现在就约定在信号中间位置去读取电平状态，这样能够保证我们读的一定是正确的。
      </span>
     </p>
     <p align="justify" class="p">
      <span style="font-family:'仿宋';">
       一旦读到了起始信号，我们就把当前状态设定成接收状态，并且打开定时器中断，第一次是半个周期进入中断后，对起始位进行二次判断一下，确认一下起始位是低电平，而不是一个干扰信号。以后每经过1/9600秒进入一次中断，并且把这个引脚的状态读到RxdBuf里边。等待接收完毕之后，我们再把这个RxdBuf加1，再通过TXD引脚发送出去，同样需要先发一位起始位，然后发8个数据位，再发结束位，发送完毕后，程序运行到while（PIN_RXD），等待第二轮信号接收的开始。
      </span>
     </p>
     <h3>
      <span style="font-family:'仿宋';">
       <strong>
        握手
       </strong>
      </span>
     </h3>
     <p>
      <span style="font-family:'仿宋';">
       RS-232通信方式允许简单连接三线：Tx、Rx和地线。但是对于数据传输，双方必须对数据定时采用使用相同的
       <a href="https://baike.baidu.com/item/%E6%B3%A2%E7%89%B9%E7%8E%87" rel="nofollow">
        波特率
       </a>
       。尽管这种方法对于大多数应用已经足够，但是对于接收方过载的情况这种使用受到限制。这时需要串口的握手功能。在这一部分，我们讨论三种最常用的
       <strong>
        RS-232握手形式：软件握手、硬件握手和Xmodem。
       </strong>
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        a，软件握手：
       </strong>
       我们讨论的第一种握手是软件握手。通常用在实际数据是
       <a href="https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E5%AD%97%E7%AC%A6" rel="nofollow">
        控制字符
       </a>
       的情况，类似于GPIB使用命令字符串的方式。必须的线仍然是三根：Tx，Rx和地线，因为控制字符在传输线上和普通字符没有区别，函数SetXModem允许用户使用或者禁止用户使用两个控制字符XON和XOFF。这些字符在通信中由接收方发送，使发送方暂停。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       例如：假设发送方以高
       <a href="https://baike.baidu.com/item/%E6%B3%A2%E7%89%B9%E7%8E%87" rel="nofollow">
        波特率
       </a>
       发送数据。在传输中，接收方发现由于CPU忙于其他工作，输入buffer已经满了。为了暂时停止传输，接收方发送XOFF，典型的值是十进制19，即十六进制13，直到输入buffer空了。一旦接收方准备好接收，它发送XON，典型的值是十进制17，即十六进制11，继续通信。输入buffer半满时，LabWindows发送XOFF。此外，如果XOFF传输被打断，LabWindows会在buffer达到75%和90%时发送XOFF。显然，发送方必须遵循此守则以保证传输继续。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        b，硬件握手：
       </strong>
       第二种是使用硬件线握手。和Tx和Rx线一样，RTS/CTS和DTR/DSR一起工作，一个作为输出，另一个作为输入。第一组线是RTS（Request to Send）和CTS（Clear toSend）。当接收方准备好接收数据，它置高RTS线表示它准备好了，如果发送方也就绪，它置高CTS，表示它即将发送数据。另一组线是DTR（DataTerminal Ready）和DSR（Data SetReady）。这些线主要用于Modem通信。使得串口和Modem通信他们的状态。例如：当Modem已经准备好接收来自PC的数据，它置高DTR线，表示和电话线的连接已经建立。读取DSR线置高，PC机开始发送数据。一个简单的规则是DTR/DSR用于表示系统通信就绪，而RTS/CTS用于单个
       <a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%8C%85" rel="nofollow">
        数据包
       </a>
       的传输。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       在LabWindows，函数SetCTSMode使能或者禁止使用硬件握手。如果CTS模式使能，LabWindows使用如下规则：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       当PC发送数据：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       RS-232库必须检测CTS线高后才能发送数据。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       当PC接收数据：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       如果端口打开，且输入队列有空接收数据，库函数置高RTS和DTR。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       如果输入队列90%满，
       <a href="https://baike.baidu.com/item/%E5%BA%93%E5%87%BD%E6%95%B0" rel="nofollow">
        库函数
       </a>
       置低RTS，但使DTR维持高电平。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       如果端口队列近乎空了，库函数置高RTS，但使DTR维持高电平。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       如果端口关闭，库函数置低RTS和DTR。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        c，XModem握手：
       </strong>
       最后讨论的握手叫做XModem文件传输协议。这个协议在Modem通信中非常通用。尽管它通常使用在Modem通信中，XModem协议能够直接在其他遵循这个协议的设备通信中使用。在LabWindows中，实际的XModem应用对用户隐藏了。只要PC和其他设备使用XModem协议，在文件传输中就使用LabWindows的XModem函数。函数是XModemConfig，XModemSend和XModemReceive。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       XModem使用介于如下参数的协议：start_of_data、end_of_data、neg_ack、wait_delay、start_delay、max_tries、packet_size。这些参数需要通信双方认定，标准的XModem有一个标准的定义：然而，可以通过XModemConfig函数修改，以满足具体需要。这些参数的使用方法由接收方发送的字符neg_ack确定。这通知发送方其准备接收数据。它开始尝试发送，有一个超时参数start_delay；当超时的尝试超过max_ties次数，或者收到接收方发送的start_of_data，发送方停止尝试。如果从发送方收到start_of_data，接收方将读取后继信息
       <a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%8C%85" rel="nofollow">
        数据包
       </a>
       。包中含有包的数目、包数目的补码作为错误校验、packet_size字节大小的实际数据包，和进一步错误检查的
       <a href="https://baike.baidu.com/item/%E6%B1%82%E5%92%8C%E6%A0%A1%E9%AA%8C" rel="nofollow">
        求和校验
       </a>
       值。在读取数据后，接收方会调用wait_delay，然后向发送方发送响应。如果发送方没有收到响应，它会重新发送数据包，直到收到响应或者超过重发次数的最大值max_tries。如果一直没有收到响应，发送方通知用户传输数据失败。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       由于数据必须以pack_size个字节按包发送，当最后一个数据包发送时，如果数据不够放满一个数据包，后面会填充ASCII码NULL（0）字节。这导致接收的数据比原数据多。在XModem情况下一定不要使用
       <a href="https://baike.baidu.com/item/XON/XOFF" rel="nofollow">
        XON/XOFF
       </a>
       ，因为XModem发送方发出包的数目很可能增加到XON/OFF
       <a href="https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E5%AD%97%E7%AC%A6" rel="nofollow">
        控制字符
       </a>
       的值，从而导致通信故障。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <h3>
      <span style="font-family:'仿宋';">
       <strong>
        波特率概念以及选择
       </strong>
      </span>
     </h3>
     <p>
      <span style="font-family:'仿宋';">
       波特率表示每秒钟传送的码元符号的个数，是衡量数据传送速率的指标，它用单位时间内载波调制状态改变的次数来表示。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       在信息传输通道中，携带数据信息的信号单元叫码元，每秒钟通过信道传输的码元数称为码元传输速率，简称波特率。波特率是传输通道频宽的指标。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        中文名
       </strong>
       <strong>
        外文名
       </strong>
       <strong>
        其它名
       </strong>
       <strong>
        作用
       </strong>
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       波特率 Baud rat 码元速率 度量符号传输速率
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       波特率(Boud Rate)就是在串口通信中每秒能够发送的位数(bits/second)。MCS-51串行端口在四种工作模式下有不同的波特率计算方法。其中，模式0和模式2波特率计算很简单;模式1和模式3的波特率选择相同，故在此仅以工作模式1为例来说明串口通信波特率的选择。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       在串行端口工作于模式1，其波特率将由计时/计数器1来产生，通常设置定时器工作于模式2(自动再加模式)。在此模式下波特率计算公式为：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       波特率=(1+SMOD)*晶振频率/(384*(256-TH1))
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       其中，SMOD——寄存器PCON的第7位，称为波特率倍增位;
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       TH1——定时器的重载值。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       在选择波特率的时候需要考虑两点：首先，系统需要的通信速率。这要根据系统的运作特点，确定通信的频率范围。然后考虑通信时钟误差。使用同一晶振频率在选择不同的通信速率时通信时钟误差会有很大差别。为了通信的稳定，我们应该尽量选择时钟误差最小的频率进行通信。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       下面举例说明波特率选择过程：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       假设系统要求的通信频率在20000bit/s以下，晶振频率为12MHz，设置SMOD=1(即波特率倍增)。则
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       TH1=256-62500/波特率
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       根据波特率取值表，我们知道可以选取的波特率有：1200，2400，4800，9600，19200。列计数器重载值，通信误差如下表：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/04512ed2be654317e417cea776499de4.png"/>
      </span>
     </p>
     <p>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       因此，在通信中，最好选用波特率为1200，2400，4800中的一个。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        单片机与matlab的串口通信
       </strong>
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       Matlab提供了对串口进行打开、关闭、以及串口参数设置等操作的一系列函数。利用这些函数可以选择串口号、 设置串口通信参数( 波特率、 数据位、停止位、 校验位等)、进行中断控制、流控制。从建立串口通信到结束串口通信的完整流程包括以下几个步骤:
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       1、创建串口对象，实现该功能的函数为：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       obj=serial(port,'PropertyName',PropertyValue,....);
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       例如:obj= serial(com3,'BaudRate'4800)
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       或使用以下默认设置，创建串口对象，在命令串口输入以下代码，第二句是查看其obj默认状态
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       obj = serial('com3');
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       obj
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       其中有两个重要设置项
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       BaudRate: 9600 % 波特率默认9600
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       Terminator: 'LF' %串口触发字符“换行符”
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       2、设置或者修改串口通信参数，实现该功能的函数为：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       set(obj,'PropertyName',PropertyValue,);
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       例如：set(obj,'BaudRate'4800);
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       这样，我们就发现串口的一些基本设置，可以在创建串口时设置，也可以创建串口之后再进行设置。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       3、打开串口，实现该功能的函数为：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       fopen(obj);
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       obj即为前边创建的串口对象。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       其中，步骤2和3顺序是完全可以颠倒的。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       4、从串口读写数据，在前面三个步骤正常完成后, 即可以从串口读数据或者向串口写数据, 也就是接
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       收或者发送数据。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       这里我介绍几个常用函数，读函数：fread,fscanf;写函数：fwrite,fprintf.
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       A = fread(obj,size); %从串口obj读取size字节长短的二进制数据，以数组形式存于A
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       str = fscanf(obj); %从串口obj读取字符或字符串(ASCII码)形式数据，以字符数组形式存于str
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       fwrite(obj,A); % 以二进制形式向obj写入数据A
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       fprintf( obj,str); %以字符(ASCII码)形式向串口写数据str(字符或字符串)
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       5、关闭串口以及释放串口对象占用的存储空间。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       fclose(obj); % 关闭串口
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       delete(obj); % 释放串口对象占用的内存空间,
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       clear obj; % 释放串口对象在Matlab工作区中占用的存储空间
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       下一篇讲解着几个函数在实际的应用及不足。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       实例1：在51单片机下载串口代码后，在matlab上执行如下代码：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       [plain] view plain copysr3 = serial('COM3'); % 使用默认设置创建串口sr3
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       fopen(sr3); %打开串口
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       fprintf(sr3,'xxx'); % 给串口写入数据
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       str = fscanf(sr3) %读取串口数据(无分号，可在Matlab工作区实时查看)
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       fclose(sr3); %关闭串口
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       delete(sr3);
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       clear sr3;
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       串口中断设置及中断处理函数
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       要实现自动收发数据,还需要定义串口中断处理函数以及触发串口中断的方式。定义触发串口中断的方式其目的是为了在串口检测到接收数据的时候,通知并启动串口数据接收函数进行数据接收操作; 在串口输出缓存为空的时候, 通知启动串口数据发送函数。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       1、触发串口中断的方式。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       Matlab检测到串口通信事件,从而触发串口中断。串口读写的事件包括: Bytes available,Outputempty。其中Bytes available事件有两种: 一种是接收到的字符数达到人工设定的数目时,则系统产生该事件; 另一种是当接收到指定字符时, 系统产生该事件。Output empty事件是在系统检测到输出缓存区为空时, 产生该事件。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       2、中断方式设置
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       Bytes available 事件
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       set(obj,'BytesAvailableFcnMode','byte');
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       set(obj,'BytesAvailableFcnCount', 240); %串口检测到输入缓存中到达了240个字符数据时,触发串口中断。或 ：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       set(obj,'BytesAvailableFcnMode','terminator');
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       set(obj,'terminator','H'); %当串口检测到字符H时,则触发串口中断
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       Output empty事件
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       输出缓存为空事件的产生。该事件由系统自动检测产生，不需要用户特别设置。该事件一般在输出缓存中的最后一个字符发送完毕后产生。用户可以定义该事件引起的串口中断处理函数。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       3、串口中断处理函数
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       串口中断处理函数是重点中的重点，我查阅过一些文档，串口通信时接收数据一般分两种方式，一种是查询方式，一种是中断处理方式，了解处理器工作的人知道，使用查询方式需不断查询，耗用内存，效率十分低。所以实际通信过程中都使用中断方式，这就需要设置中断触发方式，中断处理函数。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       很多参考文档都是使用matlab自带回调函数，再添加自己的代码，在最开始我也尝试这种方法，但发现实在太麻烦，还是选择自己写，其实很简单，只要注意几个细节问题，就能得到正常运行的函数。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       串口中断处理函数定义：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       obj. BytesAvailableFcn=@ReceiveCallback;
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       再自行编写中断处理函数。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       实例2：51单片机端依然使用串口代码，matlab执行如下函数：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/d583e384bc4b6f21461c1797dc8e9f8e.png"/>
      </span>
     </p>
     <p>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <h3>
      <span style="font-family:'仿宋';font-size:14px;">
       <strong>
        串口通讯硬件常见的注意事项
       </strong>
      </span>
     </h3>
     <h3>
      <span style="font-family:'仿宋';font-size:14px;">
       1. 通讯电缆端子一定接牢，不可有任何松动，否则，可能会烧坏仪表或上位机的通讯板。
      </span>
      <br/>
      <span style="font-family:'仿宋';font-size:14px;">
       2. 不可带电拔插通讯端子，否则，可能会烧坏仪表或上位机的通讯板，一定要关闭仪表电源后才能去拔插通讯端子或接通讯线。
      </span>
      <br/>
      <span style="font-family:'仿宋';font-size:14px;">
       3. 通讯用的屏蔽电缆最好选用双层隔离型屏蔽电缆，其次选用单层屏蔽电缆，最好不要选用无屏蔽层的电缆,且电缆屏蔽层一定要能完全屏蔽，有些质量差的电缆，屏蔽层很松散，根本起不到屏蔽的作用。单层屏蔽的电缆屏蔽层应一端接地，双层屏蔽的电缆屏蔽层其外层（含铠装）应两端接地，内层屏蔽则应一端接地。
      </span>
      <br/>
      <span style="font-family:'仿宋';font-size:14px;">
       4. 仪表使用RS232通讯时，通讯电缆长度不得超过15米。
      </span>
      <br/>
      <span style="font-family:'仿宋';font-size:14px;">
       5. 一般RS485协议的接头没有固定的标准，可能根据厂家的不同引脚顺序和管脚功能可能不尽相同，用户可以查阅相关产品RS485的引脚图。
      </span>
      <br/>
      <span style="font-family:'仿宋';font-size:14px;">
       6. RS485通讯电缆最好选用阻阬匹配、低衰减的RS485专用通讯电缆（双绞线），不要使用普通的双绞电缆或质量较差的通讯电缆。因为普通电缆或质量差的通讯电缆，可能阻抗不匹配、衰减大、绞合度不够、屏蔽层太松散，这样会导致干扰将非常大，会造成通讯不畅，甚至通讯不上。
      </span>
      <br/>
      <span style="font-family:'仿宋';font-size:14px;">
       7. 仪表使用RS485通讯时，每台仪表必须手牵手地串下去，不可以有星型连接或者分叉，如果有星型连接或者分叉，干扰将非常大，会造成通讯不畅，甚至通讯不上。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       <strong>
        <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/706ccea15f53eac439b8e10176757028.png"/>
       </strong>
      </span>
     </h3>
     <p>
      <strong>
       <span style="font-family:'仿宋';">
        8. 485总线结构理论上传输距离达到1200米，一般是指通讯线材优质达标，波特率9600，只有一台485设备才能使得通讯距离达到1200米，而且能通讯并不代表每次通讯都正常，所以通常485总线实际的稳定通讯距离远远达不到1200米。负载485设备多，线材阻抗不同时，通讯距离更短。
       </span>
      </strong>
      <br/>
      <strong>
       <span style="font-family:'仿宋';">
        9. 仪表使用RS485通讯时，必要时，请接入终端电阻，以增强系统的抗干扰性，典型的终端电阻阻值是120欧。
       </span>
      </strong>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <h3>
      <span style="font-family:'仿宋';">
       <strong>
        有关通讯的一些基本概念
       </strong>
      </span>
     </h3>
     <p>
      <span style="font-family:'仿宋';">
       主机与从机：在通讯系统中起主要作用、发布主要命令的称为主机，接受命令的称为从机。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       1. 连续方式：指主机不需要发布命令，从机就能自动地向主机发送数据。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       2. 指令方式：指主机向从机发布命令，从机根据指令执行动作，并将结果“应 答”给主机的模式。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       3. 输出数据类型：指在连续方式通讯时，从机输出给主机的数据类型。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       4. 通讯协议：指主机与从机通讯时，按哪一种编码规则来通讯。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       5. 波特率：主从机之间通讯的速度。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       6. 数据位：每次传输数据时，数据由几位组成。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       7. 校验位：数据传输错误检测，可以是奇校验、偶校验或无校验。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       8. 地址：每一台从机的编号。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        主从机之间通讯设置要点
       </strong>
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       要点一：主/从RS232/485硬件有无设置正确，通讯线有无接对。有些通讯板卡是RS4与RS485共用的，依靠板上跳线来实现的，有些仪表RS232/485也需要通讯跳 线来实现。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       要点二：主机上的通讯端口有无设置正确；超时（一般设置为2s）、通讯延时（一般置为5～20ms)、ACK信号延时（一般设置为0ms)有无设置正确。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       要点三：主/从机通讯协议有无选择正确。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       要点四：主/从机波特率有无选择正确。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       要点五：主/从机数据位有无选择正确。数据位可以选择7位，8位。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       要点六：主/从机校验位有无选择正确。校验位一般可选择偶校验、奇校验、无校验。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       要点七：主/从机停止位有无选择正确。停止位可以选择1位、1.5位还是2位。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       要点八：从机地址有无选择正确。
      </span>
      <br/>
      <span style="font-family:'仿宋';">
       要点九：主/从机的通讯方式有无选择正确。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       USB转串口通信
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       随着技术的发展，工业上还有RS232串口通信的大量使用，但是商业技术的应用上，已经慢慢的使用USB转UART技术取代了RS232串口，绝大多数笔记本电脑已经没有串口这个东西了，那我们要实现单片机和电脑之间的通信该如何办呢？
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       我们只需要在我们电路上添加一个USB转串口芯片，就可以成功实现USB通信协议和标准UART串行通信协议的转换，在我们的开发板上，我们使用的是CH340G这个芯片，如图11-1所示。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/b7390cffb0e0cacc24bfbbf6b5116e88.png"/>
      </span>
     </p>
     <p>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       图11-1 USB转串口电路
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       CH340G这个电路很简单，把电源电路，晶振电路接好后，6脚和7脚的UD+和UD-分别接USB口的2个数据引脚上去，3脚和4脚接到了我们单片机的TXD和RXD上去。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       CH340G的电路里2脚位置加了个4148的二极管，是一个小技巧。因为我们的STC89C52RC这个单片机下载程序需要冷启动，就是先点下载后上电，上电瞬间单片机会先检测需要不需要下载程序。虽然单片机的VCC是由开关来控制，但是由于CH340G的2脚是输出引脚，如果没有此二极管，开关后级单片机在断电的情况下，CH340G的2脚和单片机的P3.0（即RXD）引脚连在一起，有电流会通过这个引脚流入后级电路并且给后级的电容充电，造成后级有一定幅度的电压，这个电压值虽然只有两三伏左右，但是可能会影响到我们的冷启动。加了二极管后，一方面不影响通信，另外一个方面还可以消除这种问题。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <strong>
        软件协议
       </strong>
      </span>
     </p>
     <ol>
      <li>
       <span style="font-family:'仿宋';">
        <strong>
         OSI协议和TCP/IP协议
        </strong>
       </span>
      </li>
     </ol>
     <p>
      <span style="font-family:'仿宋';">
       （1）OSI协议
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       OSI七层参考模型不是通讯标准，它只给出一个不会由于技术发展而必须修改的稳定模型，使有关标准和协议能在模型定义的范围内开发和相互配合。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       一般的通讯协议只符合OSI七层模型的某几层，如： EIA-RS-232-C：实现了物理层。 IBM的SDLC（同步数据链路控制规程）：数据链路层。ANSI的ADCCP
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       （先进数据通讯规程）：数据链路层。IBM的BSC（二进制同步通讯协议）：数据链路层。应用层的电子邮件协议SMTP只负责寄信、POP3只负责收信。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       （2）TCP/IP协议
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       实现了五层协议：
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       （1）物理层：对应OSI的物理层。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       （2）网络接口层：类似于OSI的数据链路层。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       （3）Internet层：OSI模型在Internet网使用前提出，未考虑网间连接。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       （4）传输层：对应OSI的传输层。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       （5）应用层：对应OSI的表示层和应用层。
      </span>
     </p>
     <p>
      <span style="font-family:'仿宋';">
       <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/2d723431e6202f9e7888691703de8e75.png"/>
      </span>
     </p>
     <p>
     </p>
    </div>
    <p>
     转载于:https://www.cnblogs.com/cstdio1/p/11175762.html
    </p>
   </div>
  </div>
  <div id="recommendDown">
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f33303736383137352f:61727469636c652f64657461696c732f313031373237393131" class_="artid" style="display:none">
 </p>
</div>
