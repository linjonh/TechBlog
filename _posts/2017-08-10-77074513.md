---
layout: post
title: "ZIGBEE-AD-转换-片内温度学习总结"
date: 2017-08-10 22:38:03 +0800
description: "/*本程序讲解AD控制（片内温度计）主讲  王加辉*/#include#include\\\"stdio"
keywords: "p0sel=0x3c是什么意思"
categories: ['Zigbee']
tags: ['无标签']
artid: "77074513"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=77074513
    alt: "ZIGBEE-AD-转换-片内温度学习总结"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ZIGBEE AD 转换 片内温度学习总结
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <span style="font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:25.2px">
     /*
    </span>
    <br style="word-wrap:break-word; font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:25.2px"/>
    <span style="font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:25.2px">
     本程序讲解AD控制（片内温度计）
    </span>
    <br style="word-wrap:break-word; font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:25.2px"/>
    <span style="font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:25.2px">
     主讲  王加辉
    </span>
    <br style="word-wrap:break-word; font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:25.2px"/>
    <span style="font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:25.2px">
     */
    </span>
    <br style="word-wrap:break-word; font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:25.2px"/>
    <span style="font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:25.2px">
     #include
    </span>
    <br style="word-wrap:break-word"/>
    #include\"stdio.h\"
    <br style="word-wrap:break-word"/>
    #define uchar  unsigned char
    <br style="word-wrap:break-word"/>
    #define uint   unsigned int
    <br style="word-wrap:break-word"/>
    void init_UART0(void)/*初始化串口*/
    <br style="word-wrap:break-word"/>
    {
    <br style="word-wrap:break-word"/>
    P0SEL|=0X3C;/*这里我们是选择P0_2,P0_3,P0_4,P0_5最为串口通信的I/O口*/
    <br style="word-wrap:break-word"/>
    P2DIR&amp;=~0XC0;/*在这里我们设置串口0的优先级大于串口1，也就是设置使用串口0*/
    <br style="word-wrap:break-word"/>
    PERCFG=0X00;/*PERCFG是接口控制寄存器，这里我们选择串口0位置1，就是选择P0-2和P0-3为串口通信接口*/
    <br style="word-wrap:break-word"/>
    <br style="word-wrap:break-word"/>
    U0CSR|=0X80;/*选择串口的工作方式，我们选择为异步通信*/
    <br style="word-wrap:break-word"/>
    U0GCR|=11;/*结合U0BAUD设置波特率为115200，请各位查找手册*/
    <br style="word-wrap:break-word"/>
    U0BAUD|=216;
    <br style="word-wrap:break-word"/>
    UTX0IF=0;/*UTX0IF为串口0发送中断标志位，我们将其置零*/
    <br style="word-wrap:break-word"/>
    }
    <br style="word-wrap:break-word"/>
    <br style="word-wrap:break-word"/>
    float recieve_AD(void)/*AD转换，读取片内温度计实时电压*/
    <br style="word-wrap:break-word"/>
    {
    <br style="word-wrap:break-word"/>
    uint value=0;/*无符号整型变量，用来储存AD转换值*/
    <br style="word-wrap:break-word"/>
    ADCCON1|=0X30;/*选择AD转换启动的方式为手动启动*/
    <br style="word-wrap:break-word"/>
    ADCCON3=0X3E;/*设置AD转换的信息源为片内温度传感器、选择内部参考电压为1.25V，设置单通道AD转换的分辨率为512dec,12位，此处要对照AD寄存器手册查看*/
    <br style="word-wrap:break-word"/>
    ADCCON1|=0X40;/*手动启动AD转换*/
    <br style="word-wrap:break-word"/>
    while(!(ADCCON1&amp;0X80));/*等待AD一次转换完成*/
    <br style="word-wrap:break-word"/>
    value=ADCL&gt;&gt;4;/*CC2530的AD转换数据是由高到低存储的，ADCL低4位无效，所以我们要向右移动去掉无效四位，
    <br style="word-wrap:break-word"/>
    这我也是在CC2430学校视频上看到的，暂时我不能给出确切解释，有懂得请补充一下，谢谢*/
    <br style="word-wrap:break-word"/>
    value|=(uint)ADCH&lt;&lt;4;/*视频上解释高位数据向左移动4位是为了和低位对应，然后相加，我无法做出准确解释，我找到相关资料再做补充解释*/
    <br style="word-wrap:break-word"/>
    return value*0.06229-303.3-4;/*温度的计算公式为：温度=（（测量电压-某一电压）/温度系数）-温度的误差值*/
    <br style="word-wrap:break-word"/>
    }
    <br style="word-wrap:break-word"/>
    <br style="word-wrap:break-word"/>
    void init_tempurature()/*初始化温度传感器*/
    <br style="word-wrap:break-word"/>
    {
    <br style="word-wrap:break-word"/>
    IEN0=IEN1=IEN2=0;/*因为AD转换会产生中断，所以此处我们先关掉所用中断，对于AD中断的使用大家可以参考手册，查看其中断源*/
    <br style="word-wrap:break-word"/>
    CLKCONCMD&amp;=~0X40;/*设置时钟频率，在前面的串口通信中我们也曾讲过*/
    <br style="word-wrap:break-word"/>
    while(CLKCONSTA&amp;0X40);
    <br style="word-wrap:break-word"/>
    CLKCONCMD&amp;=~0X47;
    <br style="word-wrap:break-word"/>
    TR0=0X01;/*这里我让AD和温度传感器相连*/
    <br style="word-wrap:break-word"/>
    ATEST=0X01;/*启动温度传感器*/
    <br style="word-wrap:break-word"/>
    }
    <br style="word-wrap:break-word"/>
    <br style="word-wrap:break-word"/>
    void data_UART0(char *character,int length)/*串口数据输出函数*/
    <br style="word-wrap:break-word"/>
    {
    <br style="word-wrap:break-word"/>
    int i;
    <br style="word-wrap:break-word"/>
    for(i=0;i&lt;length;i++)
    <br style="word-wrap:break-word"/>
    {
    <br style="word-wrap:break-word"/>
    U0DBUF=*character++;
    <br style="word-wrap:break-word"/>
    while(UTX0IF==0);/*每次发送数据完成后串口发送中断位硬件自动置一*/
    <br style="word-wrap:break-word"/>
    UTX0IF=0;/*这里我们要软件将其置一*/
    <br style="word-wrap:break-word"/>
    }
    <br style="word-wrap:break-word"/>
    U0DBUF=0X0A;/*这句是在串口中输出一个换行，大家可以试试*/
    <br style="word-wrap:break-word"/>
    while(UTX0IF==0);
    <br style="word-wrap:break-word"/>
    UTX0IF=0;
    <br style="word-wrap:break-word"/>
    }
    <br style="word-wrap:break-word"/>
    /*告诉大家一个在串口通信中将数字转换成字符输出的简单方法，就是在数字后面加0x30，大家可以尝试*/
    <br style="word-wrap:break-word"/>
    void delay_ms(int ti)/*延迟函数*/
    <br style="word-wrap:break-word"/>
    {
    <br style="word-wrap:break-word"/>
    int x,y;
    <br style="word-wrap:break-word"/>
    for(x=0;x&lt;ti;x++)
    <br style="word-wrap:break-word"/>
    for(y=0;y&lt;526;y++);
    <br style="word-wrap:break-word"/>
    }
    <br style="word-wrap:break-word"/>
    void main()
    <br style="word-wrap:break-word"/>
    {
    <br style="word-wrap:break-word"/>
    int turn=0;
    <br style="word-wrap:break-word"/>
    float ADTEMP=0;
    <br style="word-wrap:break-word"/>
    char temp[6]={0};
    <br style="word-wrap:break-word"/>
    init_tempurature();//初始化温度传感器
    <br style="word-wrap:break-word"/>
    init_UART0();//初始化串口通信
    <br style="word-wrap:break-word"/>
    while(1)
    <br style="word-wrap:break-word"/>
    {
    <br style="word-wrap:break-word"/>
    for(turn=0;turn&lt;60;turn++)/*累计60次的温度*/
    <br style="word-wrap:break-word"/>
    ADTEMP+=recieve_AD();
    <br style="word-wrap:break-word"/>
    ADTEMP=ADTEMP/60;/*求60次温度的平均值*/
    <br style="word-wrap:break-word"/>
    temp[0]=(uchar)(ADTEMP)/10+48;/*将温度的数值存入数组temp中*/
    <br style="word-wrap:break-word"/>
    temp[1]=(uchar)(ADTEMP)%10+48;
    <br style="word-wrap:break-word"/>
    temp[2]=\'.\';
    <br style="word-wrap:break-word"/>
    temp[3]=(uchar)(ADTEMP*10)%10+48;
    <br style="word-wrap:break-word"/>
    temp[4]=(uchar)(ADTEMP*100)%10+48;
    <br style="word-wrap:break-word"/>
    data_UART0(temp,5);//串口输出温度值
    <br style="word-wrap:break-word"/>
    delay_ms(2000);//控制每次输出的时间间隔
    <br style="word-wrap:break-word"/>
    }
    <br style="word-wrap:break-word"/>
    }
    <br style="word-wrap:break-word"/>
    /*zigbee cc2530的AD控制（片内温度计）就讲到这里，祝大家学的愉快*/
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f646f75646f756475647531333134:2f61727469636c652f64657461696c732f3737303734353133" class_="artid" style="display:none">
 </p>
</div>


