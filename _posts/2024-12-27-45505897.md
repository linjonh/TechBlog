---
layout: post
title: "单片机各种通信协议详解"
date: 2024-12-27 21:05:55 +0800
description: "CAN->sFilterRegister[0].FR1=0X12设置要接收的ID//21--32标准"
keywords: "单片机通信协议怎么看"
categories: ['Stm']
tags: ['Stm', 'Html']
artid: "45505897"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=45505897
    alt: "单片机各种通信协议详解"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     单片机各种通信协议详解
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     <span style="color:#fe2c24;">
      一、IIC通信协议
     </span>
    </h2>
    <p style="margin-left:0;">
     <strong>
      （1）概述
     </strong>
    </p>
    <p style="margin-left:0;">
     I2C(Inter-Integrated Circuit BUS) 集成电路总线，该总线由NXP（原PHILIPS）公司设计，多用于主控制器和从器件间的主从通信，在小数据量场合使用，传输距离短，任意时刻只能有一个主机等特性。
    </p>
    <p style="margin-left:0;">
     经常IIC和SPI接口被认为指定是一种硬件设备，但其实这样的说法是不尽准确的，严格的说他们都是人们所定义的软硬结合体，分为物理层（四线结构）和协议层（主机，从机，时钟极性，时钟相位）。
    </p>
    <p style="margin-left:0;">
     IIC，SPI的区别不仅在与物理层，IIC比SPI有着一套更为复杂的协议层定义。下面来分别说明一下IIC的物理层和协议层。
    </p>
    <p style="margin-left:0;">
     <span style="color:#4da8ee;">
      <strong>
       (2)  IIC的物理层
      </strong>
     </span>
    </p>
    <p style="margin-left:0;">
     A 只要求两条总线线路，一条是串行数据线ＳＤＡ，一条是串行时钟线ＳＣＬ。（IIC是半双工，而不是全双工）。
    </p>
    <p style="margin-left:0;">
     b.  每个连接到总线的器件都可以通过唯一的地址和其它器件通信，主机/从机角色和地址可配置，主机可以作为主机发送器和主机接收器。
    </p>
    <p style="margin-left:0;">
     c.  IIC是真正的多主机总线，（而这个SPI在每次通信前都需要把主机定死，而IIC可以在通讯过程中，改变主机），如果两个或更多的主机同时请求总线，可以通过冲突检测和仲裁防止总线数据被破坏。
    </p>
    <p style="margin-left:0;">
     d. 传输速率在标准模式下可以达到100kb/s,快速模式下可以达到400kb/s。
    </p>
    <p style="margin-left:0;">
     e. 连接到总线的IC数量只是受到总线的最大负载电容400pf限制。
    </p>
    <p style="margin-left:0;">
     <span style="color:#fe2c24;">
      <strong>
       I2C总线特征总结
      </strong>
     </span>
    </p>
    <p style="margin-left:0;">
     I2C总线上的每一个设备都可以作为主设备或者从设备，而且每一个设备都会对应一个唯一的地址(可以从I2C器件的数据手册得知)，主从设备之间就通过这个地址来确定与哪个器件进行通信，在通常的应用中，
    </p>
    <p style="margin-left:0;">
     我们把CPU带I2C总线接口的模块作为主设备，把挂接在总线上的其他设备都作为从设备。I2C总线上可挂接的设备数量受总线的最大电容400pF限制，如果所挂接的是相同型号的器件，则还受器件地位的限制。I2C总线数据传输速率在标准模式下可达   100kbit/s，快速模式下可达  400kbit/s，高速模式下可达3.4Mbit/s。一般通过 I2C总线接口可编程时钟来实现传输速率的调整。I2C总线上的主设备与从设备之间以字节(8位)为单位进行双向的数据传。
    </p>
    <p style="margin-left:0;">
    </p>
    <h2 style="margin-left:0px;">
     <span style="color:#fe2c24;">
      二、SPI 协议
     </span>
    </h2>
    <p style="margin-left:0;">
     1.   通常SPI通信要求4根线，分别是MOSI(mast output salve input), MISO, CLK, CS。
    </p>
    <p style="margin-left:0;">
     2.  当发送和接受数据的工作都准备好了，只要有时钟CLK,就发送数据，没有时钟就不发送，而且一个时钟周期发送一位(bit)数据，所以发送数据的快慢由时钟频率来控制。
    </p>
    <p style="margin-left:0;">
     3.  至于时钟和数据的相位没有特别严格的要求（而IIC中，数据的变化只能在SCL是低电平的时候发生），SPI数据的变化是一个时钟周期一次，这样的方法来传输数据就简单多了。我们可以根据需求对时钟的极性和相位做调整，看看是在时钟上升沿还是下降沿来发送数据，还有停止发送时时钟的极性，是保持高电平还是低电平。
    </p>
    <p style="margin-left:0;">
     4.  另外在多机通信时，SPI只是简单的通过一个片选信号来选择哪个设备占用总线，但是IIC是通过发送从设备地址来自动选择的。
    </p>
    <p style="margin-left:0;">
     <img alt="" height="862" src="https://i-blog.csdnimg.cn/blog_migrate/02a794a56c5f723c8bfb570138d1634b.png" width="1200"/>
    </p>
    <h2 style="margin-left:0px;">
     <span style="color:#fe2c24;">
      三、什么是TTL电平、CMOS电平？
     </span>
    </h2>
    <p style="margin-left:0;">
     TL电平信号被利用的最多是因为通常数据表示采用二进制规定，+5V等价于逻辑"1"，0V等价于逻辑"0"，这被称做TTL(晶体管-晶体管逻辑电平)信号系统，这是计算机处理器控制的设备内部各部分之间通信的标准技术。
    </p>
    <p style="margin-left:0;">
     CMOS电平和TTL电平：CMOS电平电压范围在3～15V，比如：当5V供电时，输出在4.6以上为高电平，输出在0.05V以下为低电平。输入在3.5V以上为高电平，输入在1.5V以下为低电平。而对于TTL芯片，供电范围在0～5V，常见都是5V，如74系列5V供电，输出在2.7V以上为高电平，输出在0.5V以下为低电平，输入在2V以上为高电平，在0.8V以下为低电平。因此，CMOS电路与TTL电路就有一个电平转换的问题，使两者电平域值能匹配。
    </p>
    <p style="margin-left:0;">
     <strong>
      <span style="color:#FF0000;">
       TTL
      </span>
     </strong>
     <strong>
      <span style="color:#FF0000;">
       高电平
      </span>
      <span style="color:#FF0000;">
       3.6~5V
      </span>
     </strong>
     <strong>
      <span style="color:#FF0000;">
       ，低电平
      </span>
      <span style="color:#FF0000;">
       0V~2.4V
      </span>
     </strong>
    </p>
    <p style="margin-left:0;">
     <strong>
      <span style="color:#FF0000;">
       CMOS
      </span>
     </strong>
     <strong>
      <span style="color:#FF0000;">
       电平
      </span>
      <span style="color:#FF0000;">
       Vcc
      </span>
     </strong>
     <strong>
      <span style="color:#FF0000;">
       可达到
      </span>
      <span style="color:#FF0000;">
       12V
      </span>
     </strong>
    </p>
    <p style="margin-left:0;">
    </p>
    <h2 style="margin-left:0px;">
     <span style="color:#fe2c24;">
      四、RS-232协议
     </span>
    </h2>
    <p style="margin-left:0;">
     RS232（异步传输标准接口），是个人计算机上的通讯接口之一，也称
     <strong>
      <span style="color:#FF0000;">
       串口
      </span>
     </strong>
     或串行通讯接口。
    </p>
    <p style="margin-left:0;">
     由电子工业协会(Electronic Industries Association，EIA) 所制定的异步传输标准接口。通常 RS-232 接口以9个引脚 (DB-9) 或是25个引脚 (DB-25) 的型态出现，一般个人计算机上会有两组 RS-232 接口，分别称为 COM1 和 COM2。是目前最常用的一种串行通讯接口。
    </p>
    <p style="margin-left:0;">
     标准RS232接口：
     <strong>
      <span style="color:#FF0000;">
       常用串口只需要
      </span>
      <span style="color:#FF0000;">
       TX
      </span>
     </strong>
     <strong>
      <span style="color:#FF0000;">
       与
      </span>
      <span style="color:#FF0000;">
       RX
      </span>
     </strong>
     <strong>
      <span style="color:#FF0000;">
       即可。
      </span>
     </strong>
     <strong>
      <span style="color:#FF0000;">
       USB
      </span>
     </strong>
     <strong>
      <span style="color:#FF0000;">
       转
      </span>
      <span style="color:#FF0000;">
       RS232
      </span>
     </strong>
     <strong>
      <span style="color:#FF0000;">
       串口线
      </span>
     </strong>
    </p>
    <p style="margin-left:0;">
    </p>
    <h2 style="margin-left:0px;">
     <span style="color:#fe2c24;">
      五、CAN总线
     </span>
    </h2>
    <p style="margin-left:0;">
     CAN是控制器局域网络(Controller Area Network, CAN)的简称，是由以研发和生产汽车电子产品著称的德国BOSCH公司开发的，并最终成为国际标准（ISO 11898），是国际上应用最广泛的现场总线之一。 在北美和西欧，CAN总线协议已经成为汽车计算机控制系统和嵌入式工业控制局域网的标准总线，并且拥有以CAN为底层协议专为大型货车和重工机械车辆设计的J1939协议。
    </p>
    <p style="margin-left:0;">
     CAN 是Controller Area Network 的缩写（以下称为CAN），是ISO国际标准化的串行通信协议。在汽车产业中，出于对安全性、舒适性、方便性、低公害、低成本的要求，各种各样的电子控制系统被开发了出来。由于这些系统之间通信所用的数据类型及对可靠性的要求不尽相同，由多条总线构成的情况很多，线束的数量也随之增加。为适应“减少线束的数量”、“通过多个LAN，进行大量数据的高速通信”的需要，1986 年德国电气商博世公司开发出面向汽车的CAN 通信协议。此后，CAN 通过ISO11898 及ISO11519 进行了标准化，在欧洲已是汽车网络的标准协议。
    </p>
    <p style="margin-left:0;">
     CAN 的高性能和可靠性已被认同，并被广泛地应用于工业自动化、船舶、医疗设备、工业设备等方面。现场总线是当今自动化领域技术发展的热点之一，被誉为自动化领域的计算机局域网。它的出现为分布式控制系统实现各节点之间实时、可靠的数据通信提供了强有力的技术支持。
    </p>
    <p style="margin-left:0;">
     <strong>
      CAN的报文格式
     </strong>
    </p>
    <p style="margin-left:0;">
     在总线中传送的报文，每帧由7部分组成。CAN协议支持两种报文格式，其唯一的不同是标识符（ID）长度不同，标准格式为11位，扩展格式为29位。
    </p>
    <p style="margin-left:0;">
     在标准格式中，报文的起始位称为帧起始（SOF），然后是由11位标识符和远程发送请求位 (RTR）组成的仲裁场。RTR位标明是数据帧还是请求帧，在请求帧中没有数据字节。
    </p>
    <p style="margin-left:0;">
     控制场包括标识符扩展位（IDE），指出是标准格式还是扩展格式。它还包括一个保留位 (ro），为将来扩展使用。它的最后四个位用来指明数据场中数据的长度（DLC）。数据场范围为0～8个字节,其后有一个检测数据错误的循环冗余检查(CRC）。
    </p>
    <p style="margin-left:0;">
     应答场（ACK）包括应答位和应答分隔符。发送站发送的这两位均为隐性电平（逻辑1），这时正确接收报文的接收站发送主控电平（逻辑0）覆盖它。用这种方法，发送站可以保证网络中至少有一个站能正确接收到报文。
    </p>
    <p style="margin-left:0;">
     报文的尾部由帧结束标出。在相邻的两条报文间有一很短的间隔位，如果这时没有站进行总线存取，总线将处于空闲状态。
    </p>
    <p style="margin-left:0;">
     <span style="color:#fe2c24;">
      <strong>
       CAN屏蔽位设置：
      </strong>
     </span>
    </p>
    <p>
     <span style="color:#0000ff;">
      CAN-&gt;sFilterRegister[0].FR1=0X12&lt;&lt;21;       //设置要接收的ID         //21--32标准帧
     </span>
    </p>
    <p>
     <span style="color:#0000ff;">
      CAN-&gt;sFilterRegister[0].FR2=0X00000000;  //设置屏蔽寄存器
     </span>
     <span style="color:#0000ff;">
     </span>
     <span style="color:#0000ff;">
      高11位为标准帧
     </span>
    </p>
    <p>
     <span style="color:#0000ff;">
      0表示不关心  1表示关心
     </span>
    </p>
    <p>
     <span style="color:#0000ff;">
      0X12是我们设置要接收的ID
     </span>
    </p>
    <p>
     <span style="color:#0000ff;">
      0X12 的二进制 ：0000 0001 0010 0000 0000 0000 0000 0000
     </span>
    </p>
    <p>
    </p>
    <p>
     如果屏蔽寄存器设置为：0XFFFFFFFF
     <span style="color:#ff0000;">
      1111 1111 11
     </span>
     <span style="color:#ff0000;">
      1
     </span>
     1 1111 1111 1111 1111 1111
    </p>
    <p>
     就只能接收  0X12这个ID的数据
    </p>
    <p>
     如果屏蔽寄存器设置为：0XFFDFFFFF
     <span style="color:#ff0000;">
      1111 11
     </span>
     <span style="color:#ff0000;">
      1
     </span>
     <span style="color:#ff0000;">
      1 11
     </span>
     <span style="color:#ff0000;">
      0
     </span>
     1 1111 1111 1111 1111 1111
    </p>
    <p>
     就只能接收  0X12 0X13这两个ID的数据
    </p>
    <p>
     <span style="color:#0000ff;">
      因为
     </span>
     <span style="color:#0000ff;">
      0X12 的二进制 ：0000 0001 001
     </span>
     <span style="color:#ff9900;">
      0
     </span>
     <span style="color:#0000ff;">
      0000 0000 0000 0000 0000
     </span>
    </p>
    <p>
     <span style="color:#0000ff;">
     </span>
     <span style="color:#0000ff;">
      0X1
     </span>
     <span style="color:#0000ff;">
      3
     </span>
     <span style="color:#0000ff;">
      的二进制 ：0000 0001 001
     </span>
     <span style="color:#ff9900;">
      1
     </span>
     <span style="color:#0000ff;">
      0000 0000 0000 0000 0000
     </span>
    </p>
    <p>
     如果屏蔽寄存器设置为：0XFF9FFFFF
     <span style="color:#ff0000;">
      1111 11
     </span>
     <span style="color:#ff0000;">
      1
     </span>
     <span style="color:#ff0000;">
      1 1
     </span>
     <span style="color:#ff9900;">
      00
     </span>
     1 1111 1111 1111 1111 1111
    </p>
    <p>
     就只能接收  0X12 0X13 0X11 0X10这四个ID的数据
    </p>
    <p>
     <span style="color:#0000ff;">
      因为
     </span>
     <span style="color:#0000ff;">
      0X12 的二进制 ：0000 0001 00
     </span>
     <span style="color:#ff9900;">
      1
     </span>
     <span style="color:#ff9900;">
      0
     </span>
     <span style="color:#0000ff;">
      0000 0000 0000 0000 0000
     </span>
    </p>
    <p>
     <span style="color:#0000ff;">
     </span>
     <span style="color:#0000ff;">
      0X1
     </span>
     <span style="color:#0000ff;">
      3
     </span>
     <span style="color:#0000ff;">
      的二进制 ：0000 0001 00
     </span>
     <span style="color:#ff9900;">
      1
     </span>
     <span style="color:#ff9900;">
      1
     </span>
     <span style="color:#0000ff;">
      0000 0000 0000 0000 0000
     </span>
    </p>
    <p>
     <span style="color:#0000ff;">
     </span>
     <span style="color:#0000ff;">
      0X1
     </span>
     <span style="color:#0000ff;">
      1
     </span>
     <span style="color:#0000ff;">
      的二进制 ：0000 0001 00
     </span>
     <span style="color:#ff9900;">
      0
     </span>
     <span style="color:#ff9900;">
      1
     </span>
     <span style="color:#0000ff;">
      0000 0000 0000 0000 0000
     </span>
    </p>
    <p>
     <span style="color:#0000ff;">
      0
     </span>
     <span style="color:#0000ff;">
      X1
     </span>
     <span style="color:#0000ff;">
      0
     </span>
     <span style="color:#0000ff;">
      的二进制
     </span>
     <span style="color:#0000ff;">
     </span>
     <span style="color:#0000ff;">
      ：0000 0001 00
     </span>
     <span style="color:#ff9900;">
      00
     </span>
     <span style="color:#0000ff;">
      0000 0000 0000 0000 0000
     </span>
    </p>
    <p>
    </p>
    <h2 style="margin-left:0px;">
     <span style="color:#fe2c24;">
      六、485总线
     </span>
    </h2>
    <p style="margin-left:0;">
     在要求通信距 离为几十米到上千米时，广泛采用RS-485串行总线标准。RS-485采用平衡发送和差分接收，因此具有抑制共模干扰的能力。
    </p>
    <p style="margin-left:0;">
     <strong>
      <span style="color:#FF0000;">
       RS232
      </span>
     </strong>
     <strong>
      <span style="color:#FF0000;">
       串口可以与
      </span>
      <span style="color:#FF0000;">
       485
      </span>
     </strong>
     <strong>
      <span style="color:#FF0000;">
       之间互转，在单片机上使用
      </span>
      <span style="color:#FF0000;">
       485
      </span>
     </strong>
     <strong>
      <span style="color:#FF0000;">
       总线与使用
      </span>
      <span style="color:#FF0000;">
       RS232
      </span>
     </strong>
     <strong>
      <span style="color:#FF0000;">
       串口一样，需要使用芯片转换电平即可！
      </span>
     </strong>
    </p>
    <p style="margin-left:0;">
    </p>
    <h2 style="margin-left:0px;">
     <span style="color:#fe2c24;">
      七、Modbus通讯协议
     </span>
    </h2>
    <p style="margin-left:0;">
     Modbus协议是应用于电子控制器上的一种通用语言。通过此协议，控制器相互之间、控制器经由网络（例如以太网）和其它设备之间可以通信。它已经成为一种通用工业标准。有了它，不同厂商生产的控制设备可以连成工业网络，进行集中监控。此协议定义了一个控制器能认识使用的消息结构，而不管它们是经过何种网络进行通信的。它描述了一个控制器请求访问其它设备的过程，如何回应来自其它设备的请求，以及怎样侦测错误并记录。它制定了消息域格局和内容的公共格式。
    </p>
    <p style="margin-left:0;">
     当在同一Modbus网络上通信时，此协议决定了每个控制器需要知道它们的设备地址，识别按地址发来的消息，决定要产生何种行动。如果需要回应，控制器将生成反馈信息并用Modbus协议发出。在其它网络上，包含了Modbus协议的消息转换为在此网络上使用的帧或包结构。这种转换也扩展了根据具体的网络解决节地址、路由路径及错误检测的方法。
    </p>
    <p style="margin-left:0;">
     此协议支持传统的RS-232、RS-422、RS-485和以太网设备。许多工业设备，包括PLC，DCS，智能仪表等都在使用Modbus协议作为他们之间的通信标准。
    </p>
    <p style="margin-left:0;">
     <span style="color:#4da8ee;">
      <strong>
       Modbus具有以下几个特点：
      </strong>
     </span>
    </p>
    <p style="margin-left:0;">
     （1）标准、开放，用户可以免费、放心地使用Modbus协议，不需要交纳许可证费，也不会侵犯知识产权。目前，支持Modbus的厂家超过400家，支持Modbus的产品超过600种。
    </p>
    <p style="margin-left:0;">
     （2）Modbus可以支持多种电气接口，如RS-232、RS-485等，还可以在各种介质上传送，如双绞线、光纤、无线等
    </p>
    <p style="margin-left:0;">
     （3）Modbus的帧格式简单、紧凑，通俗易懂。用户使用容易，厂商开发简单。
    </p>
   </div>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e6373:646e2e6e65742f7869616f6c6f6e6731313236363236343937:2f61727469636c652f64657461696c732f3435353035383937" class_="artid" style="display:none">
 </p>
</div>


