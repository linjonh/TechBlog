---
layout: post
title: "前端性能优化图片篇"
date: 2022-12-16 18:12:12 +0800
description: "在一些官网或者电商项目中，往往存在大量的图片，如 banner 广告图，菜单导航图，商家列表头图等。"
keywords: "前端图片"
categories: ['性能优化']
tags: ['前端', 'Javascript', 'Css']
artid: "128344561"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=128344561
    alt: "前端性能优化图片篇"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     前端性能优化——图片篇
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      前端性能优化——图片篇
     </h4>
     <ul>
      <li>
       <a href="#_4" rel="nofollow">
        前言
       </a>
      </li>
      <li>
       <a href="#_11" rel="nofollow">
        一、图片压缩
       </a>
      </li>
      <li>
       <a href="#_26" rel="nofollow">
        二、使用雪碧图
       </a>
      </li>
      <li>
       <a href="#_43" rel="nofollow">
        三、图片懒加载
       </a>
      </li>
      <li>
       <a href="#_122" rel="nofollow">
        四、图片预加载
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1_cssJavaScript_124" rel="nofollow">
          1. 用css和JavaScript实现预加载
         </a>
        </li>
        <li>
         <a href="#2_JavaScript_132" rel="nofollow">
          2. 使用JavaScript实现预加载
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_186" rel="nofollow">
        五、渐进式图片
       </a>
      </li>
      <li>
       <a href="#imgbackgroundurl_189" rel="nofollow">
        六、用img标签代替background-url的属性
       </a>
      </li>
      <li>
       <a href="#_202" rel="nofollow">
        总结
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <hr/>
    <h2>
     <a id="_4">
     </a>
     前言
    </h2>
    <p>
     在一些官网或者电商项目中，往往存在大量的图片，如 banner 广告图，菜单导航图，商家列表头图等。图片过多以及图片体积过大往往会影响页面加载速度，造成不良的用户体验，所以对图片进行优化势在必行。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/55c26e13205df6250a7bb6c8f0030a9a.png"/>
    </p>
    <hr/>
    <h2>
     <a id="_11">
     </a>
     一、图片压缩
    </h2>
    <p>
     F12打开控制台，找到 Network，点击 Img，我们可以看到当前网页所有的图片资源；点击Size，对图片进行从大到小的排序，我们可以对超过100kB的图片进行压缩。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/769c98db928c598888b8bc58f2f5b2f8.png"/>
    </p>
    <p>
     压缩地址：
     <a href="https://www.iloveimg.com/zh-cn/compress-image" rel="nofollow">
      在线压缩图像
     </a>
    </p>
    <p>
     注意：选择批量压缩会更方便，压缩之后需要进行检查，若压缩过后的图片仍然大于100kB，需要进行二次压缩。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d9cbcef518028af7fcac0ca8f7b854f9.png"/>
    </p>
    <p>
     页面效果：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1fd2f4379e04e736e59fa92c39237a3a.png"/>
    </p>
    <h2>
     <a id="_26">
     </a>
     二、使用雪碧图
    </h2>
    <p>
     把诸多小图片合成一张大图，利用
     <strong>
      backround-position
     </strong>
     属性值来确定图片呈现的位置，可以有效的较少请求个数，而不影响开发体验，使用构建插件可以做到对开发者透明，适用于页面图片多且丰富的场景。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/8dc9006bc14a5c9299c807421eb60cfc.png"/>
    </p>
    <pre><code class="prism language-javascript"><span class="token punctuation">.</span>img<span class="token operator">-</span>tab<span class="token operator">-</span>top a<span class="token punctuation">.</span>on<span class="token punctuation">{<!-- --></span> 
	background<span class="token operator">:</span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token string">"../ossweb-img/spr.png"</span><span class="token punctuation">)</span> no<span class="token operator">-</span>repeat<span class="token punctuation">;</span>
    background<span class="token operator">-</span>position<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">566</span>px <span class="token operator">-</span><span class="token number">150</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">.</span>arr<span class="token operator">-</span>right<span class="token punctuation">{<!-- --></span> 
	background<span class="token operator">:</span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token string">"../ossweb-img/spr.png"</span><span class="token punctuation">)</span> no<span class="token operator">-</span>repeat <span class="token operator">-</span><span class="token number">863</span>px <span class="token operator">-</span><span class="token number">150</span>px<span class="token punctuation">;</span> 
	position<span class="token operator">:</span> absolute<span class="token punctuation">;</span>
	width<span class="token operator">:</span> <span class="token number">31</span>px<span class="token punctuation">;</span> 
	height<span class="token operator">:</span> <span class="token number">30</span>px<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="_43">
     </a>
     三、图片懒加载
    </h2>
    <p>
     在一些图片比较多的网站上，由于图片是非常多的，如果我们在打开网页的一瞬间就把网站的所有图片加载出来，很有可能造成卡顿和白屏的现象，用户体验变得极差。
    </p>
    <p>
     由于图片真的很多，一瞬间就把网站的所有图片加载出来，浏览器短时间内根本处理不完。实际上，当我们打开网站的那一瞬间仅仅只能看到视口内的图片。只去加载视口内的图片，就是懒加载技术。
    </p>
    <p>
     懒加载的原理其实很简单，就是预先将图片真实的
     <mark>
      src
     </mark>
     放在我们自定义的属性里面（比如：
     <mark>
      data-src
     </mark>
     ），当图片出现在了我们的视口范围之内的时候，再把
     <mark>
      data-src
     </mark>
     赋值给
     <mark>
      src
     </mark>
     属性，完成图片加载。
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">/**
 * 懒加载
 * @description 可加载`&lt;img&gt;`、`&lt;video&gt;`、`&lt;audio&gt;`等一些引用资源路径的标签
 * @param {object} params 传参对象
 * @param {string?} params.lazyAttr 自定义加载的属性（可选）
 * @param {"src"|"background"} params.loadType 加载的类型（默认为`src`）
 * @param {string?} params.errorPath 加载失败时显示的资源路径，仅在`loadType`设置为`src`中可用（可选）
 */</span>
<span class="token keyword">function</span> <span class="token function">lazyLoad</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> attr <span class="token operator">=</span> params<span class="token punctuation">.</span>lazyAttr <span class="token operator">||</span> <span class="token string">"lazy"</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> type <span class="token operator">=</span> params<span class="token punctuation">.</span>loadType <span class="token operator">||</span> <span class="token string">"src"</span><span class="token punctuation">;</span>

  <span class="token comment">/** 更新整个文档的懒加载节点 */</span>
  <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> els <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>attr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> els<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> el <span class="token operator">=</span> els<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 加载图片
   * @param {HTMLImageElement} el 图片节点
   */</span>
  <span class="token keyword">function</span> <span class="token function">loadImage</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> cache <span class="token operator">=</span> el<span class="token punctuation">.</span>src<span class="token punctuation">;</span> <span class="token comment">// 缓存当前`src`加载失败时候用</span>
    el<span class="token punctuation">.</span>src <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    el<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      el<span class="token punctuation">.</span>src <span class="token operator">=</span> params<span class="token punctuation">.</span>errorPath <span class="token operator">||</span> cache<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 加载单个节点
   * @param {HTMLElement} el 
   */</span>
  <span class="token keyword">function</span> <span class="token function">loadElement</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">case</span> <span class="token string">"src"</span><span class="token operator">:</span>
        <span class="token function">loadImage</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">"background"</span><span class="token operator">:</span>
        el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundImage <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>el<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    el<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    observer<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** 
   * 监听器 
   * [MDN说明](https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver)
  */</span>
  <span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> entries<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> item <span class="token operator">=</span> entries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">loadElement</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
    observer<span class="token punctuation">,</span>
    update
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="_122">
     </a>
     四、图片预加载
    </h2>
    <p>
     图片预加载，是指在一些需要展示大量图片的网站，将图片提前加载到本地缓存中，从而提升用户体验。
    </p>
    <h3>
     <a id="1_cssJavaScript_124">
     </a>
     1. 用css和JavaScript实现预加载
    </h3>
    <pre><code class="prism language-javascript">#preload<span class="token operator">-</span><span class="token number">01</span> <span class="token punctuation">{<!-- --></span> background<span class="token operator">:</span> <span class="token function">url</span><span class="token punctuation">(</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>domain<span class="token punctuation">.</span>tld<span class="token operator">/</span>image<span class="token operator">-</span><span class="token number">01.</span>png<span class="token punctuation">)</span> no<span class="token operator">-</span>repeat <span class="token operator">-</span><span class="token number">9999</span>px <span class="token operator">-</span><span class="token number">9999</span>px<span class="token punctuation">;</span> <span class="token punctuation">}</span>  

#preload<span class="token operator">-</span><span class="token number">02</span> <span class="token punctuation">{<!-- --></span> background<span class="token operator">:</span> <span class="token function">url</span><span class="token punctuation">(</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>domain<span class="token punctuation">.</span>tld<span class="token operator">/</span>image<span class="token operator">-</span><span class="token number">02.</span>png<span class="token punctuation">)</span> no<span class="token operator">-</span>repeat <span class="token operator">-</span><span class="token number">9999</span>px <span class="token operator">-</span><span class="token number">9999</span>px<span class="token punctuation">;</span> <span class="token punctuation">}</span>  

#preload<span class="token operator">-</span><span class="token number">03</span> <span class="token punctuation">{<!-- --></span> background<span class="token operator">:</span> <span class="token function">url</span><span class="token punctuation">(</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>domain<span class="token punctuation">.</span>tld<span class="token operator">/</span>image<span class="token operator">-</span><span class="token number">03.</span>png<span class="token punctuation">)</span> no<span class="token operator">-</span>repeat <span class="token operator">-</span><span class="token number">9999</span>px <span class="token operator">-</span><span class="token number">9999</span>px<span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="2_JavaScript_132">
     </a>
     2. 使用JavaScript实现预加载
    </h3>
    <pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">preloader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  

    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>images<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  

        <span class="token keyword">var</span> img1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

        <span class="token keyword">var</span> img2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

        <span class="token keyword">var</span> img3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

        img1<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"http://domain.tld/path/to/image-001.gif"</span><span class="token punctuation">;</span>  

        img2<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"http://domain.tld/path/to/image-002.gif"</span><span class="token punctuation">;</span>  

        img3<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"http://domain.tld/path/to/image-003.gif"</span><span class="token punctuation">;</span>  

    <span class="token punctuation">}</span>  

<span class="token punctuation">}</span>  

<span class="token keyword">function</span> <span class="token function">addLoadEvent</span><span class="token punctuation">(</span><span class="token parameter">func</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  

    <span class="token keyword">var</span> oldonload <span class="token operator">=</span> window<span class="token punctuation">.</span>onload<span class="token punctuation">;</span>  

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window<span class="token punctuation">.</span>onload <span class="token operator">!=</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  

        window<span class="token punctuation">.</span>onload <span class="token operator">=</span> func<span class="token punctuation">;</span>  

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>  

        window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  

            <span class="token keyword">if</span> <span class="token punctuation">(</span>oldonload<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  

                <span class="token function">oldonload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

            <span class="token punctuation">}</span>  

            <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

        <span class="token punctuation">}</span>  

    <span class="token punctuation">}</span>  

<span class="token punctuation">}</span>  

<span class="token function">addLoadEvent</span><span class="token punctuation">(</span>preloader<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h2>
     <a id="_186">
     </a>
     五、渐进式图片
    </h2>
    <p>
     渐进式图片的意思是在高画质图像加载完之前会先显示低画质版本。低画质版本由于画质低、压缩率高，尺寸很小，加载很快。在两者之间我们也可以根据需要显示不同画质的版本。
    </p>
    <h2>
     <a id="imgbackgroundurl_189">
     </a>
     六、用img标签代替background-url的属性
    </h2>
    <p>
     在做移动端项目的时候，出现了弹窗弹出，但是背景图没有显示的问题：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/830cd2447a9aa0bad4d1123ba8123c9c.png">
      <br/>
      首先是看了一下背景图，发现图片在4M左右，所以先对背景图进行了压缩，但是在微信开发者程序上测试，发现无效；
     </img>
    </p>
    <p>
     然后将
     <strong>
      bgc
     </strong>
     的方式更换成了
     <strong>
      img
     </strong>
     的方式：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ffc946d5aa34c02750b16dff15b663ce.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/802b9a35509bb98bb31b5ed9b8c483d7.png">
       <br/>
       发现弹框弹出正常：
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/fdd79d363ea90a76ff72ffb6c30d2e93.png"/>
      </img>
     </img>
    </p>
    <hr/>
    <h2>
     <a id="_202">
     </a>
     总结
    </h2>
    <p>
     请参考：
     <a href="https://juejin.cn/post/6965761736083243044" rel="nofollow">
      前端性能优化——图片篇
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33383337343238362f:61727469636c652f64657461696c732f313238333434353631" class_="artid" style="display:none">
 </p>
</div>


