---
layout: post
title: "ABB机器人与PC进行Windows下的Socket通信的C代码实现客户端"
date: 2024-02-10 17:13:46 +0800
description: "文章目录前言编译器选项建立Socket连接通信成功验证客户端完整代码实现效果前言ABB机器人的二次开"
keywords: "abb机器人与上位机通信"
categories: ['Abb']
tags: ['网络协议', 'Tcpip', 'Socket', 'Cpp']
artid: "119246072"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=119246072
    alt: "ABB机器人与PC进行Windows下的Socket通信的C代码实现客户端"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ABB机器人与PC进行Windows下的Socket通信的C代码实现（客户端）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <ul>
        <li>
         <a href="#_1" rel="nofollow">
          前言
         </a>
        </li>
        <li>
         <a href="#_5" rel="nofollow">
          编译器选项
         </a>
        </li>
        <li>
         <a href="#Socket_10" rel="nofollow">
          建立Socket连接
         </a>
        </li>
        <li>
         <a href="#_33" rel="nofollow">
          通信成功验证
         </a>
        </li>
        <li>
         <a href="#_65" rel="nofollow">
          客户端完整代码
         </a>
        </li>
        <li>
         <a href="#_149" rel="nofollow">
          实现效果
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h3>
     <a id="_1">
     </a>
     前言
    </h3>
    <p>
     ABB机器人的二次开发中，如果需要开发能让机器人与PC通信的上位机，可以采取TCP/IP、UDP或者串口通信的方式。
     <br/>
     本文采取TCP/IP中Socket的方式实现两者的通信。其中PC做为客户端，机器人作为服务端，至于两者谁做客户端谁做服务端视具体情况而定。
    </p>
    <h3>
     <a id="_5">
     </a>
     编译器选项
    </h3>
    <p>
     本文采用DevC++来编译，编译前需要在编译器选项中加入如下命令：
     <br/>
     -lwsock32
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9890addc7e6b8ccc4476277a9f50a0fc.png"/>
    </p>
    <h3>
     <a id="Socket_10">
     </a>
     建立Socket连接
    </h3>
    <p>
     本文采取的是本地网络IP：127.0.0.1，在PC的ABB机器人虚拟软件RobotStudio上进行通信，端口号自定。
     <br/>
     去到现场则需要根据ABB机器人的实际地址进行更改，一般为192.168.125.1
    </p>
    <pre><code class="prism language-c"><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> serAddr<span class="token punctuation">;</span>
	serAddr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
	serAddr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">55000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//目标地址端口号 </span>
	serAddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>S_un<span class="token punctuation">.</span>S_addr <span class="token operator">=</span> <span class="token function">inet_addr</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*目标地址IP，这里设为本机*/</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">connect</span><span class="token punctuation">(</span>sclient<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>serAddr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>serAddr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> SOCKET_ERROR<span class="token punctuation">)</span><span class="token comment">/*建立socket*/</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"connect error !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">closesocket</span><span class="token punctuation">(</span>sclient<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"connect success\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//将接收数据打入buf，参数分别是句柄，储存处，最大长度，其他信息（设为0即可）。</span>
		<span class="token function">recv</span><span class="token punctuation">(</span>sclient<span class="token punctuation">,</span> buf1<span class="token punctuation">,</span> MAX_DATA<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Received:%s\n"</span><span class="token punctuation">,</span>buf1<span class="token punctuation">)</span><span class="token punctuation">;</span>			
	<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_33">
     </a>
     通信成功验证
    </h3>
    <p>
     建立Socket通信后，可以让服务端和客户端互相发信息，验证通信是否成功，或者采用抓包软件wireshark抓包，检查TCP/IP的三次握手。
     <br/>
     本文由PC给机器人发送字符串，机器人收到后便开始移动，当到达指定位置后，给PC发送Arrive Pisition-i的字符串。PC再给机器人发送移到下一位置的字符串。实现机器人的自动化作业，并且PC可以开发相应的上位机控制机器人。
     <mark>
      本文只提供了客户端的代码，至于服务端的代码，可以进入主页查看
     </mark>
     <a href="https://blog.csdn.net/weixin_39383155/article/details/119252251">
      ABB机器人与上位机进行Socket通信的RAPID代码实现（服务端）
     </a>
    </p>
    <pre><code class="prism language-c"><span class="token comment">//开始发命令，接受机器人反馈 </span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">12</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">send</span><span class="token punctuation">(</span>sclient<span class="token punctuation">,</span> <span class="token string">"move"</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">"move"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//wsprintf(str1,"%s%d",pos,i);//拼接str1="Arrive Pisition-i"</span>
		<span class="token comment">//printf("%s\n",str1);</span>
		ret <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sclient<span class="token punctuation">,</span> buf2<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">"10"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
		<span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>		 
			<span class="token keyword">break</span><span class="token punctuation">;</span> 
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">==</span> SOCKET_ERROR<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"recv() 失败: %d\n"</span> <span class="token punctuation">,</span> <span class="token function">WSAGetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//机器人到达指定位置，扫描相机开始工作 </span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Received:\t%s\n"</span><span class="token punctuation">,</span>buf2<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//Sleep(5000);	</span>
			<span class="token comment">//在此处插入发给扫描相机的信号 </span>
		<span class="token punctuation">}</span>
		 
	<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_65">
     </a>
     客户端完整代码
    </h3>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;winsock2.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">comment</span><span class="token punctuation">(</span>lib<span class="token punctuation">,</span></span><span class="token string">"ws2_32.lib"</span><span class="token expression"><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAX_DATA</span> <span class="token expression"><span class="token number">100</span></span><span class="token comment">//接收到的数据最大程度</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	WORD sockVersion <span class="token operator">=</span> <span class="token function">MAKEWORD</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*加载Winsock DLL*/</span> 
	WSADATA data<span class="token punctuation">;</span>
	<span class="token keyword">int</span> ret<span class="token punctuation">;</span>
	<span class="token keyword">char</span> buf1<span class="token punctuation">[</span>MAX_DATA<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//储存接收数据 </span>
	<span class="token keyword">char</span> buf2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> str1<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//储存"Arrive Pisition-i" </span>
	<span class="token keyword">char</span> pos<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"Arrive Pisition-"</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">WSAStartup</span><span class="token punctuation">(</span>sockVersion<span class="token punctuation">,</span> <span class="token operator">&amp;</span>data<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Winsock 初始化失败!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
 
	SOCKET sclient <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> IPPROTO_TCP<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>sclient <span class="token operator">==</span> INVALID_SOCKET<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"invalid socket !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
 
	<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> serAddr<span class="token punctuation">;</span>
	serAddr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
	serAddr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">55000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//目标地址端口号 </span>
	serAddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>S_un<span class="token punctuation">.</span>S_addr <span class="token operator">=</span> <span class="token function">inet_addr</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*目标地址IP，这里设为本机*/</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">connect</span><span class="token punctuation">(</span>sclient<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>serAddr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>serAddr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> SOCKET_ERROR<span class="token punctuation">)</span><span class="token comment">/*建立socket*/</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"connect error !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">closesocket</span><span class="token punctuation">(</span>sclient<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"connect success\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//将接收数据打入buf，参数分别是句柄，储存处，最大长度，其他信息（设为0即可）。</span>
		<span class="token function">recv</span><span class="token punctuation">(</span>sclient<span class="token punctuation">,</span> buf1<span class="token punctuation">,</span> MAX_DATA<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Received:%s\n"</span><span class="token punctuation">,</span>buf1<span class="token punctuation">)</span><span class="token punctuation">;</span>			
	<span class="token punctuation">}</span>
	
	<span class="token comment">//开始发命令，接受机器人反馈 </span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">12</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">send</span><span class="token punctuation">(</span>sclient<span class="token punctuation">,</span> <span class="token string">"move"</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">"move"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//wsprintf(str1,"%s%d",pos,i);//拼接str1="Arrive Pisition-i"</span>
		<span class="token comment">//printf("%s\n",str1);</span>
		ret <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sclient<span class="token punctuation">,</span> buf2<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">"10"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
		<span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>		 
			<span class="token keyword">break</span><span class="token punctuation">;</span> 
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">==</span> SOCKET_ERROR<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"recv() 失败: %d\n"</span> <span class="token punctuation">,</span> <span class="token function">WSAGetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//机器人到达指定位置，扫描相机开始工作 </span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Received:\t%s\n"</span><span class="token punctuation">,</span>buf2<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//Sleep(5000);	</span>
			<span class="token comment">//在此处插入发给扫描相机的信号 </span>
		<span class="token punctuation">}</span>
		 
	<span class="token punctuation">}</span>
	<span class="token function">closesocket</span><span class="token punctuation">(</span>sclient<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">WSACleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 


</code></pre>
    <h3>
     <a id="_149">
     </a>
     实现效果
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2028c39b51084472ee145dff5e2186bc.png">
      <br/>
      <em>
       <mark>
        <strong>
         客户端端接受服务端的反馈：
        </strong>
       </mark>
      </em>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3d909d8bbba79b05a8c39cabd5e2246b.gif">
       <br/>
       <em>
        <strong>
         <mark>
          服务端收到客户端的指令后开始执行程序：
         </mark>
        </strong>
       </em>
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/fe497a53a3b8ca8ed4d7af4003bb7353.gif"/>
      </img>
     </img>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f33393338333135352f:61727469636c652f64657461696c732f313139323436303732" class_="artid" style="display:none">
 </p>
</div>


