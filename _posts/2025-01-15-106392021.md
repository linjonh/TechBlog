---
layout: post
title: "vscode通过跳板机连接远程服务器"
date: 2025-01-15 11:20:07 +0800
description: "使用背景一般实验室等环境的服务器是设置在内网环境中的，无法直接使用笔记本在公共环境下直接连接。但是由"
keywords: "vscode,remote-ssh,跳板机"
categories: ['技术文档']
tags: ['无标签']
artid: "106392021"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=106392021
    alt: "vscode通过跳板机连接远程服务器"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     vscode通过跳板机连接远程服务器
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     使用背景
    </h3>
    <p>
     一般实验室等环境的服务器是设置在内网环境中的，无法直接使用笔记本在公共环境下直接连接。但是由于种种原因，会出现在这样的场景下需要连接服务器的需求，而通过跳板机是一种常见的办法。
    </p>
    <p>
     一般通过ssh先后连接跳板机再跳转至服务器的方法，在编程时仅能通过vim等工具使用命令行环境，十分不方便。
    </p>
    <p>
     本文在vscode的环境下，通过跳板机连接到远程服务器，从而实现在服务器编写程序时，与在本地vscode编程环境一样便捷的效果。
    </p>
    <h3>
     <a id="_7">
     </a>
     准备工具
    </h3>
    <ol>
     <li>
      vscode (自行安装，不赘述)
     </li>
     <li>
      ssh (windows自带的可能版本过低，推荐下载使用openssh，或者在电脑中安装git的话，也可以使用git自带的ssh)
     </li>
    </ol>
    <h3>
     <a id="_11">
     </a>
     配置步骤
    </h3>
    <ol>
     <li>
      <p>
       在vscode的扩展中安装
       <code>
        Remote - SSH
       </code>
       插件
      </p>
     </li>
     <li>
      <p>
       在安装中的插件中，选择
       <code>
        Configure
       </code>
       ，然后选择config文件，如下填写
      </p>
      <pre><code class="prism language-shell">Host JumpMachine             <span class="token comment">#跳板机名称</span>
    HostName XXX.XXX.XXX.XXX <span class="token comment">#跳板机IP </span>
    Port XXX                 <span class="token comment">#跳板机ssh端口</span>
    User root                <span class="token comment">#跳板机用户名</span>

Host TargetMachine           <span class="token comment">#远程服务器名称</span>
    HostName XXX.XXX.XXX.XXX <span class="token comment">#远程服务器IP</span>
    Port XXX                 <span class="token comment">#远程服务器ssh端口</span>
    User root                <span class="token comment">#远程服务器用户名</span>
    ProxyCommand <span class="token function">ssh</span> -W %h:%p JumpMachine
</code></pre>
      <p>
       注：
       <code>
        ProxyCommand
       </code>
       中的
       <code>
        ssh
       </code>
       换成准备工具中安装的ssh的地址，例如
       <code>
        C:\Windows\System32\OpenSSH\ssh.exe
       </code>
      </p>
     </li>
     <li>
      <p>
       由于ssh连接时需要密码，连接时输入密码太过繁琐，因此可以将笔记本电脑的公钥发送至跳板机和远程服务器上
      </p>
      <p>
       3.1 若电脑上没有秘钥，可以首先先生成一个公钥秘钥对
      </p>
      <pre><code class="prism language-shell">ssh-keygen -t rsa -b 4096
</code></pre>
      <p>
       并根据提示找到秘钥的生成位置，如
       <code>
        C:\Users\XXX\.ssh
       </code>
       目录下，并切换到该目录下
      </p>
      <p>
       3.2 为防止发送公钥时覆盖了目标机器上的
       <code>
        authorized_keys
       </code>
       文件，可以使用
       <code>
        ssh-copy-id
       </code>
       命令来复制公钥
      </p>
      <pre><code class="prism language-shell">ssh-copy-id -i id_rsa.pub  <span class="token string">"-p 跳板机ssh端口 用户名@跳板机IP"</span>
</code></pre>
      <p>
       3.3 将笔记本的公钥也同样的发送到远程服务器中
      </p>
      <p>
       可以先使用scp将公钥发送至跳板机
      </p>
      <pre><code>scp -P 跳板机ssh端口 id_rsa.pub  跳板机用户名@跳板机IP:~/.ssh/temp
</code></pre>
      <p>
       再通过ssh连接至跳板机，并切换到
       <code>
        ~/.ssh
       </code>
       目录下，将其发送至远程服务器
      </p>
      <pre><code>scp -P 远程服务器ssh端口 temp 远程服务器用户名@远程服务器IP:~/.ssh/temp
</code></pre>
      <p>
       最后通过ssh连接至远程服务器，切换到
       <code>
        ~/.ssh
       </code>
       目录下，手动将公钥拼接到authorized_keys中
      </p>
      <pre><code>cat temp &gt;&gt; authorized_keys
</code></pre>
     </li>
    </ol>
    <p>
     此时就大功告成了，可以打开vscode中的
     <code>
      Remote-SSH
     </code>
     扩展，在左边文件栏中
     <code>
      SSH TARGETS
     </code>
     就会看到前面配置的
     <code>
      JumpMachine
     </code>
     和
     <code>
      TargetMachine
     </code>
     ，选择
     <code>
      TargetMachine
     </code>
     进行连接即可完成远程使用vscode进行编程，第一次打开会在远程服务器中安装一些远程工具，可能会花费一些时间
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f6875697461696c616e67797a2f:61727469636c652f64657461696c732f313036333932303231" class_="artid" style="display:none">
 </p>
</div>


