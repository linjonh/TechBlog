---
layout: post
title: "Java使用OpenCV3.2实现视频读取与播放"
date: 2024-12-25 09:28:53 +0800
description: "Java使用OpenCV3.2实现视频读取与播放OpenCV从3.x版本开始其JAVA语言的SDK支"
keywords: "java opencv 播放视频"
categories: ['图像处理']
tags: ['视频分析', '视频', '图像处理', 'Opencv', 'Java']
artid: "69934353"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=69934353
    alt: "Java使用OpenCV3.2实现视频读取与播放"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Java使用OpenCV3.2实现视频读取与播放
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3 id="java使用opencv32实现视频读取与播放">
     Java使用OpenCV3.2实现视频读取与播放
    </h3>
    <p>
     <font size="4">
      OpenCV从3.x版本开始其JAVA语言的SDK支持视频文件读写，这样就极大的方便了广大Java语言开发者学习与使用OpenCV，通过摄像头或者视频文件读取帧的内容与播放，完成视频内容分析与对象跟踪等各种应用开发任务。可以说OpenCV C++ SDK可以做到绝大多数事情，在OpenCV3.x版本上用Java都可以完成，这样就为很多Java开发者学习OpenCV打开了方便之门。
     </font>
    </p>
    <h4 id="实现思路">
     实现思路
    </h4>
    <p>
     <font size="4">
      首先用OpenCV相关API读取视频流或者视频文件的每一帧，然后通过Swing JComponent组件实现视频每一帧的更新显示，我模仿了C++的HIGHGUI里面创建窗口与显示图像接口，基于Swing实现了一个视频播放窗口类，把读取到的每一帧都传给它就可以实现连续显示即播放。每帧之间相隔100毫秒，我是通过Java线程Sleep方法实现。
     </font>
    </p>
    <h4 id="运行效果-usb摄像头读取每帧">
     运行效果 - USB摄像头读取每帧
    </h4>
    <p>
     <img alt="这里写图片描述" src="https://img-blog.csdn.net/20170409194308394?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhMjAwMDM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
    </p>
    <h4 id="运行效果-视频文件读取每帧">
     运行效果 - 视频文件读取每帧
    </h4>
    <p>
     <img alt="这里写图片描述" src="https://img-blog.csdn.net/20170409195549173?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhMjAwMDM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
    </p>
    <h4 id="代码实现">
     代码实现
    </h4>
    <p>
     <font size="5">
      视频文件读取
     </font>
    </p>
    <pre class="prettyprint"><code class="hljs java"><span class="hljs-keyword">package</span> com.gloomyfish.video.demo;

<span class="hljs-keyword">import</span> java.awt.Dimension;
<span class="hljs-keyword">import</span> java.awt.image.BufferedImage;

<span class="hljs-keyword">import</span> org.opencv.core.Core;
<span class="hljs-keyword">import</span> org.opencv.core.Mat;
<span class="hljs-keyword">import</span> org.opencv.videoio.VideoCapture;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VideoDemo</span> {<!-- --></span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(String[] args) {
        System.loadLibrary(Core.NATIVE_LIBRARY_NAME);
        <span class="hljs-comment">// 打开摄像头或者视频文件</span>
        VideoCapture capture = <span class="hljs-keyword">new</span> VideoCapture();
        <span class="hljs-comment">//capture.open(0);</span>
        capture.open(<span class="hljs-string">"D:/vcprojects/images/768x576.avi"</span>);
        <span class="hljs-keyword">if</span>(!capture.isOpened()) {
            System.out.println(<span class="hljs-string">"could not load video data..."</span>);
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">int</span> frame_width = (<span class="hljs-keyword">int</span>)capture.get(<span class="hljs-number">3</span>);
        <span class="hljs-keyword">int</span> frame_height = (<span class="hljs-keyword">int</span>)capture.get(<span class="hljs-number">4</span>);
        ImageGUI gui = <span class="hljs-keyword">new</span> ImageGUI();
        gui.createWin(<span class="hljs-string">"OpenCV + Java视频读与播放演示"</span>, <span class="hljs-keyword">new</span> Dimension(frame_width, frame_height));
        Mat frame = <span class="hljs-keyword">new</span> Mat();
        <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>) {
            <span class="hljs-keyword">boolean</span> have = capture.read(frame);
            Core.flip(frame, frame, <span class="hljs-number">1</span>);<span class="hljs-comment">// Win上摄像头</span>
            <span class="hljs-keyword">if</span>(!have) <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">if</span>(!frame.empty()) {
                gui.imshow(conver2Image(frame));
                gui.repaint();
            }
            <span class="hljs-keyword">try</span> {
                Thread.sleep(<span class="hljs-number">100</span>);
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                e.printStackTrace();
            }
        }

    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BufferedImage <span class="hljs-title">conver2Image</span>(Mat mat) {
        <span class="hljs-keyword">int</span> width = mat.cols();
        <span class="hljs-keyword">int</span> height = mat.rows();
        <span class="hljs-keyword">int</span> dims = mat.channels();
        <span class="hljs-keyword">int</span>[] pixels = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[width*height];
        <span class="hljs-keyword">byte</span>[] rgbdata = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[width*height*dims];
        mat.get(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, rgbdata);
        BufferedImage image = <span class="hljs-keyword">new</span> BufferedImage(width, height, BufferedImage.TYPE_INT_ARGB);
        <span class="hljs-keyword">int</span> index = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">int</span> r=<span class="hljs-number">0</span>, g=<span class="hljs-number">0</span>, b=<span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> row=<span class="hljs-number">0</span>; row&lt;height; row++) {
            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> col=<span class="hljs-number">0</span>; col&lt;width; col++) {
                <span class="hljs-keyword">if</span>(dims == <span class="hljs-number">3</span>) {
                    index = row*width*dims + col*dims;
                    b = rgbdata[index]&amp;<span class="hljs-number">0xff</span>;
                    g = rgbdata[index+<span class="hljs-number">1</span>]&amp;<span class="hljs-number">0xff</span>;
                    r = rgbdata[index+<span class="hljs-number">2</span>]&amp;<span class="hljs-number">0xff</span>;
                    pixels[row*width+col] = ((<span class="hljs-number">255</span>&amp;<span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>) | ((r&amp;<span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span>) | ((g&amp;<span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span>) | b&amp;<span class="hljs-number">0xff</span>; 
                }
                <span class="hljs-keyword">if</span>(dims == <span class="hljs-number">1</span>) {
                    index = row*width + col;
                    b = rgbdata[index]&amp;<span class="hljs-number">0xff</span>;
                    pixels[row*width+col] = ((<span class="hljs-number">255</span>&amp;<span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>) | ((b&amp;<span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span>) | ((b&amp;<span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span>) | b&amp;<span class="hljs-number">0xff</span>; 
                }
            }
        }
        setRGB( image, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height, pixels);
        <span class="hljs-keyword">return</span> image;
    }

    <span class="hljs-javadoc">/**
     * A convenience method for setting ARGB pixels in an image. This tries to avoid the performance
     * penalty of BufferedImage.setRGB unmanaging the image.
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setRGB</span>( BufferedImage image, <span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height, <span class="hljs-keyword">int</span>[] pixels ) {
        <span class="hljs-keyword">int</span> type = image.getType();
        <span class="hljs-keyword">if</span> ( type == BufferedImage.TYPE_INT_ARGB || type == BufferedImage.TYPE_INT_RGB )
            image.getRaster().setDataElements( x, y, width, height, pixels );
        <span class="hljs-keyword">else</span>
            image.setRGB( x, y, width, height, pixels, <span class="hljs-number">0</span>, width );
    }

}
</code></pre>
    <p>
     <font size="5">
      视频与图像显示窗口类
     </font>
    </p>
    <pre class="prettyprint"><code class="hljs java"><span class="hljs-keyword">package</span> com.gloomyfish.video.demo;

<span class="hljs-keyword">import</span> java.awt.BorderLayout;
<span class="hljs-keyword">import</span> java.awt.Color;
<span class="hljs-keyword">import</span> java.awt.Dimension;
<span class="hljs-keyword">import</span> java.awt.Graphics;
<span class="hljs-keyword">import</span> java.awt.Graphics2D;
<span class="hljs-keyword">import</span> java.awt.image.BufferedImage;

<span class="hljs-keyword">import</span> javax.swing.JComponent;
<span class="hljs-keyword">import</span> javax.swing.JDialog;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageGUI</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JComponent</span> {<!-- --></span>
    <span class="hljs-javadoc">/**
     * 
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1</span>L;
    <span class="hljs-keyword">private</span> BufferedImage image;

    <span class="hljs-keyword">public</span> <span class="hljs-title">ImageGUI</span>() {

    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">paintComponent</span>(Graphics g) {
        Graphics2D g2d = (Graphics2D)g;
        <span class="hljs-keyword">if</span>(image == <span class="hljs-keyword">null</span>)  {
            g2d.setPaint(Color.BLACK);
            g2d.fillRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.getWidth(), <span class="hljs-keyword">this</span>.getHeight());
        } <span class="hljs-keyword">else</span> {
            g2d.drawImage(image, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.getWidth(), <span class="hljs-keyword">this</span>.getHeight(), <span class="hljs-keyword">null</span>);
            System.out.println(<span class="hljs-string">"show frame..."</span>);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createWin</span>(String title) {
        JDialog ui = <span class="hljs-keyword">new</span> JDialog();
        ui.setTitle(title);
        ui.getContentPane().setLayout(<span class="hljs-keyword">new</span> BorderLayout());
        ui.getContentPane().add(<span class="hljs-keyword">this</span>, BorderLayout.CENTER);
        ui.setSize(<span class="hljs-keyword">new</span> Dimension(<span class="hljs-number">330</span>, <span class="hljs-number">240</span>));
        ui.setVisible(<span class="hljs-keyword">true</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createWin</span>(String title, Dimension size) {
        JDialog ui = <span class="hljs-keyword">new</span> JDialog();
        ui.setTitle(title);
        ui.getContentPane().setLayout(<span class="hljs-keyword">new</span> BorderLayout());
        ui.getContentPane().add(<span class="hljs-keyword">this</span>, BorderLayout.CENTER);
        ui.setSize(size);
        ui.setVisible(<span class="hljs-keyword">true</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">imshow</span>(BufferedImage image) {
        <span class="hljs-keyword">this</span>.image = image;
        <span class="hljs-keyword">this</span>.repaint();
    }

}
</code></pre>
    <p>
     <font size="4">
      关注公众号，获取更多图像处理知识与OpenCV相关知识
      <br/>
      <font color="red" size="4">
       <strong>
        【gloomyfish-贾志刚】
        <strong>
        </strong>
       </strong>
      </font>
     </font>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f6a69613230303033:2f61727469636c652f64657461696c732f3639393334333533" class_="artid" style="display:none">
 </p>
</div>


