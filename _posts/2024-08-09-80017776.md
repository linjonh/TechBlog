---
layout: post
title: "前端生成gif动态图下载"
date: 2024-08-09 07:13:32 +0800
description: "最近公司的某产品中，有动态热图的展现，分别展现某个时间段的热图时间变化，例如：最近一周七天内，每天的"
keywords: "html2canvas gif"
categories: ['Javascript', 'Html']
tags: ['生成Gif图片', 'Html', 'Gif']
artid: "80017776"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=80017776
    alt: "前端生成gif动态图下载"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     前端生成gif动态图下载
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     最近公司的某产品中，有动态热图的展现，分别展现某个时间段的热图时间变化，例如：最近一周七天内，每天的热图分布变化图；客户提出一个需求，这个动态变化的图生成一个gif图提供下载是否可行？
     <br/>
     <br/>
     <strong>
      实现方案：
     </strong>
     <br/>
     1.可通过服务端生成对应gif，然后前端请求下载
     <br/>
     2.前端自己实现生成gif图片，自行下载
     <br/>
     <br/>
     <strong>
      采用方案：
     </strong>
     <br/>
     前端实现方式，于是在网上找各种相关的几款组件调研，均有利弊，推荐两款好用并且稳定的组件：
     <br/>
     1 html2canvas.js 官网：
     <a href="http://html2canvas.hertzen.com/" rel="nofollow">
      http://html2canvas.hertzen.com/
     </a>
    </p>
    <p>
     2 gif.js 官网：
     <a href="https://jnordberg.github.io/gif.js/" rel="nofollow">
      https://jnordberg.github.io/gif.js/
     </a>
    </p>
    <p>
    </p>
    <p>
     <strong>
      下面具体记录下方案2的实现过程，逻辑拆分为3步：
     </strong>
    </p>
    <p>
     1.html元素生成base64位图片
     <br/>
     2.生成的图片对象转化为gif动态图
     <br/>
     3.下载gif图片
    </p>
    <p>
     话不多说，直接上主要代码：
    </p>
    <p>
     html2canvas有node包版本的
    </p>
    <p>
    </p>
    <p>
     <span style="color:#af00db;">
      import
     </span>
     <span style="color:#001080;">
      html2canvas
     </span>
     <span style="color:#af00db;">
      from
     </span>
     <span style="color:#a31515;">
      'html2canvas'
     </span>
     ;
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     但gif.js暂未发现node包版本，可采用cdn方式引入
    </p>
    <p>
     <span style="color:#800000;">
      &lt;script
     </span>
     <span style="color:#ff0000;">
      type
     </span>
     =
     <span style="color:#0000ff;">
      "text/javascript"
     </span>
     <span style="color:#ff0000;">
      src
     </span>
     =
     <span style="color:#0000ff;">
      "https://imgss.github.io/demo/gif/gif.js"
     </span>
     <span style="color:#800000;">
      &gt;
     </span>
     <span style="color:#800000;">
      &lt;
     </span>
     <span style="color:#800000;">
      /script&gt;
     </span>
    </p>
    <p>
    </p>
    <p>
    </p>
    <pre class="has"><code class="language-javascript">      //要转换为图片的dom对象
      var element = document.querySelector('.real-map');
      //要显示图片的img标签
      var image = document.querySelector('#imgaaa');
      var imageccc = document.querySelector('#imgccc');

      html2canvas(element,{allowTaint: true}).then(function(canvas) {  
              
                  var imageData = canvas.toDataURL(1);
                  image.src = imageData;

                  var arr=[
                    image,
                    imageccc
                  ];

                  setTimeout(function(){

                      //调用gif对象方法
                      var gif = new window.GIF({
                        workers: 2,
                        quality: 10,
                        workerScript:'https://imgss.github.io/demo/gif/gif.worker.js'
                      });
                      
                      //遍历图片对象
                      arr.map(item=&gt;{
                        gif.addFrame(item, {delay: 1000});
                      });

                      gif.on('finished', function(blob) {
                        
                        //下载动作
                        var el = document.createElement('a');
                        el.href = URL.createObjectURL(blob);
                        el.download = 'demo-name'; //设置下载文件名称
                        document.body.appendChild(el);
                        var evt = document.createEvent("MouseEvents");
                        evt.initEvent("click", false, false);
                        el.dispatchEvent(evt);
                        document.body.removeChild(el);

                      });
                      
                      gif.render();

                  },1000)
                  

          }  
      );  </code></pre>
    <p>
     以下为Demo：
    </p>
    <p>
     js部分：
    </p>
    <pre class="has"><code class="language-javascript">import pic1 from './images/1.png'

document.getElementById('imgccc').src=pic1

//要转换为图片的dom对象
var element = document.querySelector('.real-map');
//要显示图片的img标签
var image = document.querySelector('#imgaaa');
var imageccc = document.querySelector('#imgccc');

var btn = document.querySelector('#btn');

btn.onclick=()=&gt;{
  
  html2canvas(element,{allowTaint: true}).then(function(canvas) {  
        
    var imageData = canvas.toDataURL(1);
    image.src = imageData;

    var arr=[
      image,
      imageccc
    ];

    setTimeout(function(){

        //调用gif对象方法
        var gif = new window.GIF({
          workers: 2,
          quality: 10,
          workerScript:'https://imgss.github.io/demo/gif/gif.worker.js'
        });
        
        //遍历图片对象
        arr.map(item=&gt;{
          gif.addFrame(item, {delay: 1000});
        });

        gif.on('finished', function(blob) {
          
          //下载动作
          var el = document.createElement('a');
          el.href = URL.createObjectURL(blob);
          el.download = 'demo-name'; //设置下载文件名称
          document.body.appendChild(el);
          var evt = document.createEvent("MouseEvents");
          evt.initEvent("click", false, false);
          el.dispatchEvent(evt);
          document.body.removeChild(el);

        });
        
        gif.render();

    },1000)
    
  }); 
}</code></pre>
    <p>
     html部分：
    </p>
    <pre class="has"><code class="language-html">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"&gt;
&lt;head&gt;
	&lt;meta http-equiv="Content-Type" content="text/html;charset=UTF-8" /&gt;
	&lt;title&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

	&lt;!-- 用户生成图片的div区域，将付给imgaaa --&gt;
	&lt;div class="real-map"&gt;
		&lt;div&gt;
			这里是html的元素内容区域
		&lt;/div&gt;
		&lt;div&gt;
			这里是html的元素内容区域2
		&lt;/div&gt;
	&lt;/div&gt;

	&lt;img id="imgaaa" /&gt;
	&lt;img id="imgccc" src="" /&gt;

	&lt;button id="btn"&gt;点击生成&lt;/button&gt;
	
	&lt;script type="text/javascript" src="https://imgss.github.io/demo/gif/gif.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
    <p>
     css部分
    </p>
    <pre class="has"><code class="language-css">.real-map{
	width:100px;
	height:100px;
	border:1px solid #ccc;
	line-height:24px;
}
#imgccc{
	background:#fff;
	width:100px;
	height:100px;
}</code></pre>
    <p>
     效果：
    </p>
    <p>
     <img alt="" class="has" height="658" src="https://i-blog.csdnimg.cn/blog_migrate/d03083a7d8d846036fb08bbf30899e07.gif" width="469"/>
    </p>
    <p>
     <br/>
     <strong>
      简简单单，兢兢业业，走你！
     </strong>
    </p>
    <p>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f7877353035353031393336:2f61727469636c652f64657461696c732f3830303137373736" class_="artid" style="display:none">
 </p>
</div>


