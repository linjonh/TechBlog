---
layout: post
title: "简单的TCP程序服务器与客户端的简单通信"
date: 2024-12-29 13:19:16 +0800
description: "基础TCP程序：服务器与客户端的简单通信编译环境：IDEA 2021JDK:\tJDK11编写TCP程"
keywords: "编写一个tcp通讯程序,包括客户端和服务器端"
categories: ['Java']
tags: ['Java']
artid: "118116437"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=118116437
    alt: "简单的TCP程序服务器与客户端的简单通信"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     简单的TCP程序：服务器与客户端的简单通信
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <pre><code>操作系统：Windows10 
编译器：IDEA 2021
JDK版本：jdk11

本文会一步一步的带领大家编写一个简单的TCP程序，并实现简单的服务器与客户端的通信。
</code></pre>
    <blockquote>
     <p>
      <strong>
       编写TCP程序时，一般都会编写两个Demo，一个是服务器端，一个是客户端。二者想要通信需要用到Socket：套接字。套接字的作用类似于手机，两个人想要通电话必须都得有手机，服务器与客户端之间的通信都是基于Socket进行的。
      </strong>
     </p>
    </blockquote>
    <h6>
     <a id="1_8">
     </a>
     1.搭建一个简单的服务器
    </h6>
    <blockquote>
     <p>
      搭建服务器使用的是ServerSocket类，需要传入参数port，也就是端口号。端口号范围为0~65535，但一般使用的时候都会从1025开始使用，因为前面的端口号几乎已经被知名的软件或者操作系统给占用了。
     </p>
    </blockquote>
    <pre><code class="prism language-java">	<span class="token comment">/*ServerDemo*/</span>
    ServerSocket server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">12345</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     这样子我们就搭建了一个最基础的服务器，IP地址为：localhost或者说是127.0.0.1，端口号：12345。
    </p>
    <h6>
     <a id="2_15">
     </a>
     2.使服务器能够被客户端连接
    </h6>
    <blockquote>
     <p>
      服务器想要被客户端连接需要用到 public Socket accept()方法，返回值为Socket套接字，这个套接字就是服务器与客户端通信的站点。
     </p>
    </blockquote>
    <pre><code class="prism language-java"><span class="token comment">/*ServerDemo*/</span>
     Socket socket <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h6>
     <a id="3_21">
     </a>
     3.创建一个客户端并连接到已搭建的服务器
    </h6>
    <blockquote>
     <p>
      客户端连接服务器的过程就是新建一个Socket对象的过程，需要传入服务器的IP地址以及端口号。
     </p>
    </blockquote>
    <pre><code class="prism language-java"><span class="token comment">/*ClientDemo*/</span>
	Socket socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span><span class="token number">12345</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h6>
     <a id="4_27">
     </a>
     4.服务器与客户端的通信
    </h6>
    <blockquote>
     <p>
      二者之间通信用到的方法是Socket类中的 public InputStream getInputStream()方法与public OutputStream getOutputStream()方法。前者的返回值是InputStream字节输入流，后者返回值是OutputStream字节输出流。这里的输入输出的概念是相对的，对于服务器来说，如果想要给客户端发送信息需要用到输出流，如果想要接收来自客户端的信息需要用到输入流。对于客户端来说也是如此。
     </p>
    </blockquote>
    <blockquote>
     <p>
      还需要我们注意的是，服务器发送信息与之对应的客户端必须要有接收动作，二者之间的通信必须交替进行。
     </p>
    </blockquote>
    <blockquote>
     <p>
      下面我们要从服务器向客户端发送一条信息，与此同时，客户端需要接收这条信息。
     </p>
    </blockquote>
    <pre><code class="prism language-java"><span class="token comment">/*ServerDemo*/</span>
<span class="token comment">/*首先需要获得一个字节输出流*/</span>
   OutputStream os <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
将字节输出流转换为字符打印流
这里也可以将其转换为字符打印流，不过字符打印流在打印消息之后需要使用flush()方法强制刷新缓冲区才能将消息发送出去。比较麻烦，所以我们还是选择字节打印流。
*/</span>
   PrintStream ps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintStram</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">;</span>
   ps<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"欢迎连接服务器。"</span><span class="token punctuation">)</span>


<span class="token comment">/*下面我们需要在客户端接收这条消息*/</span>
       
       
<span class="token comment">/*
ClientDemo
*/</span>
<span class="token comment">/*首先需要获取一个字节输入流*/</span>
   InputStream is <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*将字节输入流转换为缓存流(参数应该是一个Reader对象，所以我们应该将InputStream转换为Reader)*/</span>
   BufferedReader br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*将接收到的消息打印出来*/</span>
   String text <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"来自服务器的消息："</span> <span class="token operator">+</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h6>
     <a id="5_60">
     </a>
     5.关闭服务器与套接字，释放端口号
    </h6>
    <pre><code class="prism language-java"><span class="token comment">/*ServerDemo*/</span>
   socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*ClientDemo*/</span>
   socket<span class="token punctuation">,</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h6>
     <a id="6__68">
     </a>
     6. 完整代码
    </h6>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">{<!-- --></span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{<!-- --></span>
       ServerSocket server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">12345</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"服务器已启动，等待客户端连接..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       Socket socket <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"客户端已连接。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//向客户端发送一条消息</span>
       OutputStream os <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       PrintStream ps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintStream</span><span class="token punctuation">(</span>os<span class="token punctuation">)</span><span class="token punctuation">;</span>
       ps<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"你好，我是Server。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//接收客户端的信息</span>
       InputStream is <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       BufferedReader br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       String text <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"来自客户端的信息："</span> <span class="token operator">+</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//关闭服务器</span>
       System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"服务器关闭。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{<!-- --></span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{<!-- --></span>
       Socket socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span><span class="token number">12345</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//接收来自服务器的消息。</span>
       InputStream is <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       BufferedReader br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       String text <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"来自服务器的信息："</span> <span class="token operator">+</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//向服务器发送一条消息</span>
       OutputStream os <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       PrintStream ps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintStream</span><span class="token punctuation">(</span>os<span class="token punctuation">)</span><span class="token punctuation">;</span>
       ps<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"你好，我是Client。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//关闭客户端</span>
       System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"客户端退出。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34343333303635362f:61727469636c652f64657461696c732f313138313136343337" class_="artid" style="display:none">
 </p>
</div>


