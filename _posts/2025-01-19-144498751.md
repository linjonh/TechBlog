---
layout: post
title: "用JAVA实现人工智能采用框架Spring-AI-Java"
date: 2025-01-19 08:15:09 +0800
description: "过去，Java在AI应用框架方面存在不足，Spring AI应运"
keywords: "java人工智能框架"
categories: ['未分类']
tags: ['人工智能', 'Spring', 'Java']
artid: "144498751"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=144498751
    alt: "用JAVA实现人工智能采用框架Spring-AI-Java"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     用JAVA实现人工智能：采用框架Spring AI Java
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2 id="%E2%80%8B%E7%BC%96%E8%BE%91">
     <img alt="" height="364" src="https://i-blog.csdnimg.cn/direct/e6a85e28ce5a41e9959e3a2e2b20cdc3.png" width="800"/>
    </h2>
    <p>
    </p>
    <h2 id="Kopdh">
     Spring AI 集成人工智能，为Java项目添加AI功能指南
    </h2>
    <p>
     本文主旨是用实际的可操作的代码，介绍Java怎么通过spring ai 接入大模型。
    </p>
    <p>
     例子使用spring ai alibaba QWen千问api完成，你可以跑通以后换自己的实现。QWen目前有100万免费Token额度，可以快速实现需求。同时，因为qwen也是个开源的模型，我们可以自己搭建模型来实现免费使用。
    </p>
    <p id="u508070c5">
    </p>
    <p id="main-toc">
     <strong>
      目录
     </strong>
    </p>
    <p id="%E2%80%8B%E7%BC%96%E8%BE%91-toc" style="margin-left:0px;">
     <a href="#%E2%80%8B%E7%BC%96%E8%BE%91" rel="nofollow">
      ​编辑
     </a>
    </p>
    <p id="Kopdh-toc" style="margin-left:0px;">
     <a href="#Kopdh" rel="nofollow">
      Spring AI 集成人工智能，为Java项目添加AI功能指南
     </a>
    </p>
    <p id="EID1r-toc" style="margin-left:40px;">
     <a href="#EID1r" rel="nofollow">
      Spring AI 介绍：为Java引入统一的AI开发框架
     </a>
    </p>
    <p id="UbQmv-toc" style="margin-left:40px;">
     <a href="#UbQmv" rel="nofollow">
      Spring AI的主要功能介绍
     </a>
    </p>
    <p id="c2Ida-toc" style="margin-left:80px;">
     <a href="#c2Ida" rel="nofollow">
      模型 Model
     </a>
    </p>
    <p id="TUNM2-toc" style="margin-left:80px;">
     <a href="#TUNM2" rel="nofollow">
      提示 Prompt
     </a>
    </p>
    <p id="Z82Az-toc" style="margin-left:80px;">
     <a href="#Z82Az" rel="nofollow">
      提示词模板 Prompt Template
     </a>
    </p>
    <p id="R1bKL-toc" style="margin-left:80px;">
     <a href="#R1bKL" rel="nofollow">
      嵌入 Embedding
     </a>
    </p>
    <p id="rw9Ky-toc" style="margin-left:80px;">
     <a href="#rw9Ky" rel="nofollow">
      结构化输出 Structured Output
     </a>
    </p>
    <p id="JRoU9-toc" style="margin-left:80px;">
     <a href="#JRoU9" rel="nofollow">
      检索增强生成 RAG
     </a>
    </p>
    <p id="TyW1h-toc" style="margin-left:80px;">
     <a href="#TyW1h" rel="nofollow">
      智能体 Agent
     </a>
    </p>
    <p id="LZ0zi-toc" style="margin-left:80px;">
     <a href="#LZ0zi" rel="nofollow">
      函数调用 Function Calling
     </a>
    </p>
    <p id="gAwor-toc" style="margin-left:80px;">
     <a href="#gAwor" rel="nofollow">
      向量存储 Vector Store
     </a>
    </p>
    <p id="odpNH-toc" style="margin-left:40px;">
     <a href="#odpNH" rel="nofollow">
      Spring AI Alibaba 介绍 ：接入阿里云百炼大模型的开发工具
     </a>
    </p>
    <p id="EWmxC-toc" style="margin-left:40px;">
     <a href="#EWmxC" rel="nofollow">
      阿里云通义千问介绍
     </a>
    </p>
    <p id="gFpJB-toc" style="margin-left:40px;">
     <a href="#gFpJB" rel="nofollow">
      使用Spring AI Alibaba构建聊天API的详细指南
     </a>
    </p>
    <p id="YdvtQ-toc" style="margin-left:80px;">
     <a href="#YdvtQ" rel="nofollow">
      1. 环境准备
     </a>
    </p>
    <p id="juBVy-toc" style="margin-left:80px;">
     <a href="#juBVy" rel="nofollow">
      2. 获取API Key
     </a>
    </p>
    <p id="bhTD6-toc" style="margin-left:80px;">
     <a href="#bhTD6" rel="nofollow">
      3. 配置API Key
     </a>
    </p>
    <p id="UDust-toc" style="margin-left:80px;">
     <a href="#UDust" rel="nofollow">
      4. Maven仓库与依赖配置
     </a>
    </p>
    <p id="rdmc7-toc" style="margin-left:80px;">
     <a href="#rdmc7" rel="nofollow">
      5. ChatClient的初始化与控制器实现
     </a>
    </p>
    <p id="F2TxN-toc" style="margin-left:80px;">
     <a href="#F2TxN" rel="nofollow">
      6. 测试
     </a>
    </p>
    <p id="uoBnK-toc" style="margin-left:0px;">
    </p>
    <hr id="hr-toc"/>
    <p>
    </p>
    <p>
    </p>
    <h3 id="EID1r">
     Spring AI 介绍：为Java引入统一的AI开发框架
    </h3>
    <p id="u868a33f1">
     过去，Java在AI应用框架方面存在不足，缺乏一个能够良好支持AI开发的统一框架。Spring AI应运而生，它是一个专为AI工程设计的应用框架，旨在将Spring生态系统的设计原则如可移植性和模块化引入AI领域。Spring AI的核心优势在于它提供了一套标准化接口，使得开发者可以轻松地切换不同的AI服务提供商，仅需修改配置即可。此外，Spring AI与现有的Spring生态兼容性极好，同时也完美地融入了Java面向对象编程的特点。这不仅简化了开发流程，还极大地减少了迁移和维护的成本。
    </p>
    <p id="ud6234c7c">
    </p>
    <h3 id="UbQmv">
     Spring AI的主要功能介绍
    </h3>
    <h4 id="c2Ida">
     模型 Model
    </h4>
    <p id="ucd78607e">
     一句话说明：提供与阿里云通义大模型交互的能力。
     <br/>
     输入：用户查询或指令。
     <br/>
     输出：基于大模型生成的响应。
     <br/>
     举例：通过ChatClient调用通义千问，实现聊天对话。
    </p>
    <h4 id="TUNM2">
     提示 Prompt
    </h4>
    <p id="u256dff19">
     一句话说明：作为有组织的一系列消息和请求选项的容器。
     <br/>
     输入：一系列消息及请求选项。
     <br/>
     输出：AI模型的响应结果。
     <br/>
     举例：使用ChatModel的call()方法传递Prompt实例，获取AI回复。
    </p>
    <h4 id="Z82Az">
     提示词模板 Prompt Template
    </h4>
    <p id="u8dfbf614">
     一句话说明：用于构建动态提示内容的模板机制。
     <br/>
     输入：占位符参数值。
     <br/>
     输出：完整的提示字符串。
     <br/>
     举例：从文件加载模板并替换参数后发送给AI模型，如生成笑话。
    </p>
    <h4 id="R1bKL">
     嵌入 Embedding
    </h4>
    <p id="u548827ab">
     一句话说明：将文本转换为向量表示，便于相似度计算等操作。
     <br/>
     输入：原始文本。
     <br/>
     输出：对应的向量形式。
     <br/>
     举例：将用户输入转换成向量，用于后续处理如检索增强生成。
    </p>
    <h4 id="rw9Ky">
     结构化输出 Structured Output
    </h4>
    <p id="u63c04cbe">
     一句话说明：将AI模型的非结构化输出转换为结构化的Java对象。
     <br/>
     输入：AI模型生成的非结构化文本。
     <br/>
     输出：映射到指定Java Bean的数据。
     <br/>
     举例：将描述演员及其电影列表的文字自动转换为ActorsFilms类的对象。
    </p>
    <h4 id="JRoU9">
     检索增强生成 RAG
    </h4>
    <p id="u83634eca">
     一句话说明：结合外部数据源提高生成内容的质量和准确性。
     <br/>
     输入：用户查询及相关背景信息。
     <br/>
     输出：基于检索结果生成的更准确回答。
     <br/>
     举例：利用阿里巴巴财报PDF中的信息回答关于财报的问题。
    </p>
    <h4 id="TyW1h">
     智能体 Agent
    </h4>
    <p id="uc76095b8">
     一句话说明：代表执行特定任务的逻辑实体。
     <br/>
     输入：任务相关的参数。
     <br/>
     输出：任务执行的结果。
     <br/>
     举例：定义一个数学工具函数供LLM在需要时调用进行计算。
    </p>
    <h4 id="LZ0zi">
     函数调用 Function Calling
    </h4>
    <p id="u2867da4d">
     一句话说明：允许大型语言模型调用开发者定义的功能。
     <br/>
     输入：函数名及所需参数。
     <br/>
     输出：函数执行后的结果。
     <br/>
     举例：通过定义MessageStatusService查询消息状态，并由LLM决定何时调用。
    </p>
    <h4 id="gAwor">
     向量存储 Vector Store
    </h4>
    <p id="u4c4173c3">
     一句话说明：管理和查询文档向量数据库。
     <br/>
     输入：文档及其元数据。
     <br/>
     输出：按相似度排序的匹配文档列表。
     <br/>
     举例：上传PDF文件至知识库，随后基于查询向量检索相关片段。
    </p>
    <p id="uada1c022">
    </p>
    <h3 id="odpNH">
     Spring AI Alibaba 介绍 ：接入阿里云百炼大模型的开发工具
    </h3>
    <p id="ubd209aef">
     Spring AI Alibaba 是基于 Spring AI 的实现，它专为接入阿里云百炼系列大模型而设计。通过 Spring AI Alibaba，开发者能够轻松使用阿里云通义提供的聊天、图片生成或语音生成等AI应用。
    </p>
    <p>
     Spring AI Alibaba 提供了包括对话、文生图、文生语音等功能在内的多种生成式模型适配，并支持OutputParser、Prompt Template以及让AI模型接入外部数据的能力。
    </p>
    <p>
     这使得开发者可以快速构建具备智能对话和其他AI功能的应用程序。
    </p>
    <p>
     其核心优势在于标准化了不同AI提供者的接口实现，允许一次编写代码后只需更改配置即可切换不同的AI服务提供商。此外，它直接兼容Flux流输出，简化了与市场上多数基于流的机器人模型的集成过程。
    </p>
    <p id="ud98c0057">
    </p>
    <h3 id="EWmxC">
     阿里云通义千问介绍
    </h3>
    <p id="ue491ee1a">
     通义千问是由阿里集团提供的开源大模型服务，支持全尺寸、多模态的大规模模型。在中文开源模型领域中，通义千问展现了卓越的能力，在多项客观评测指标上超越了Llama 3 70B，并在国内的思南大模型竞技场排名中名列前茅。
    </p>
    <p id="uc13bb6a1">
    </p>
    <p class="img-center">
     <img alt="" height="1080" id="T9WkT" src="https://i-blog.csdnimg.cn/img_convert/eef19c06e7a22f95ce8536f8dd23bc6d.png" width="1200"/>
    </p>
    <p id="ue28e4388">
    </p>
    <p id="ue8359398">
    </p>
    <p class="img-center">
     <img alt="" height="684" id="IlNVc" src="https://i-blog.csdnimg.cn/img_convert/74bb15fabf793df2c8e67e011531bcdf.png" width="1200"/>
    </p>
    <p id="ub1a32091">
     通义千问的核心优势包括：1）能力排名靠前；2）可访问性和合规性；3）完全开源；4）价格合适。其中，Qwen和Qwen vl两个模态的模型在开源榜单上均位居国内第一。调用API的成本较低，且有100万免费token可以使用，甚至可以选择自己构建以实现免费使用。
    </p>
    <p id="ua743f2c7">
     对于大模型的客观测评方法，通常采用基准测试和人类评估两种方式。基准测试通过设置考题和答案来评分，常见的基准测试包括GSM-8K、MMLU、TheoremQA和GPQA等。而人类评估或竞技场模式则是由人根据偏好选择更优的答案，这种模式更加贴近实际应用场景，但可能存在主观性偏差。结合使用这两种方法可以获得更为全面的大模型性能评价。
    </p>
    <p id="uc0a5b6ae">
     参考链接：
    </p>
    <ul>
     <li id="ubf405807">
      <a href="https://huggingface.co/spaces/open-llm-leaderboard/open_llm_leaderboard" rel="nofollow" title="https://huggingface.co/spaces/open-llm-leaderboard/open_llm_leaderboard">
       https://huggingface.co/spaces/open-llm-leaderboard/open_llm_leaderboard
      </a>
     </li>
    </ul>
    <ul>
     <li id="u4399b5b5">
      <a href="https://lmarena.ai" rel="nofollow" title="https://lmarena.ai">
       https://lmarena.ai
      </a>
     </li>
    </ul>
    <ul>
     <li id="ufeb2e478">
      <a href="https://arena.opencompass.org.cn/" rel="nofollow" title="CompassArena">
       CompassArena
      </a>
     </li>
    </ul>
    <p id="u658499ee">
    </p>
    <h3 id="gFpJB">
     使用Spring AI Alibaba构建聊天API的详细指南
    </h3>
    <p id="uf7641d4c">
     为了实现基于Spring AI Alibaba的聊天API，允许用户输入信息并通过流式返回结果，我们需遵循以下步骤。这个过程包括了环境配置、依赖管理、API Key设置、ChatClient的注入以及具体的Controller实现等环节。以下是详细的执行步骤：
    </p>
    <h4 id="YdvtQ">
     1. 环境准备
    </h4>
    <p id="ud36a22fd">
     确保你的开发环境满足如下要求：
    </p>
    <ul>
     <li id="u3835e31d">
      JDK版本：JDK 17 或更高。
     </li>
    </ul>
    <ul>
     <li id="uf38fdaa1">
      Spring Boot版本：3.3.x 或更高。
     </li>
    </ul>
    <h4 id="juBVy">
     2. 获取API Key
    </h4>
    <p id="udfa6a1ff">
     访问
     <a href="https://www.aliyun.com/product/bailian" rel="nofollow" title="阿里云百炼页面">
      阿里云百炼页面
     </a>
     ，登录后开通“百炼大模型推理”服务，并创建一个新的API Key。请妥善保存此Key，后续需要在项目中使用。
    </p>
    <h4 id="bhTD6">
     3. 配置API Key
    </h4>
    <p id="ud249989b">
     在启动你的应用程序前，请确保已在环境中设置了
     <code>
      AI_DASHSCOPE_API_KEY
     </code>
     环境变量，其值为上一步获取到的API Key。例如，在Unix-like系统中可通过命令行设置：
    </p>
    <pre id="HAoBK"><code>export AI_DASHSCOPE_API_KEY=your_api_key_here</code></pre>
    <p id="u3ec10302">
     同时，在
     <code>
      application.properties
     </code>
     文件里添加以下内容以供Spring Boot应用读取：
    </p>
    <pre id="qKH8t"><code>spring.ai.dashscope.api-key=${AI_DASHSCOPE_API_KEY}</code></pre>
    <h4 id="UDust">
     4. Maven仓库与依赖配置
    </h4>
    <p id="u0d220099">
     由于Spring AI Alibaba相关组件尚未发布到Maven中心仓库，因此你需要将Spring官方的里程碑和快照仓库添加至项目的
     <code>
      pom.xml
     </code>
     文件中。此外还需添加Spring AI Alibaba的starter依赖和其他必要的Spring Boot依赖项。
    </p>
    <pre id="xHXR8"><code>&lt;repositories&gt;
    &lt;repository&gt;
        &lt;id&gt;sonatype-snapshots&lt;/id&gt;

        &lt;url&gt;https://oss.sonatype.org/content/repositories/snapshots&lt;/url&gt;

        &lt;snapshots&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;

        &lt;/snapshots&gt;

    &lt;/repository&gt;

    &lt;repository&gt;
        &lt;id&gt;spring-milestones&lt;/id&gt;

        &lt;name&gt;Spring Milestones&lt;/name&gt;

        &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;

        &lt;snapshots&gt;
            &lt;enabled&gt;false&lt;/enabled&gt;

        &lt;/snapshots&gt;

    &lt;/repository&gt;

    &lt;repository&gt;
        &lt;id&gt;spring-snapshots&lt;/id&gt;

        &lt;name&gt;Spring Snapshots&lt;/name&gt;

        &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt;

        &lt;releases&gt;
            &lt;enabled&gt;false&lt;/enabled&gt;

        &lt;/releases&gt;

    &lt;/repository&gt;

&lt;/repositories&gt;

&lt;dependencies&gt;
    &lt;!-- Spring Boot parent project --&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;

        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;

        &lt;version&gt;3.3.4&lt;/version&gt;

        &lt;relativePath/&gt;
    &lt;/parent&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;com.alibaba.cloud.ai&lt;/groupId&gt;

        &lt;artifactId&gt;spring-ai-alibaba-starter&lt;/artifactId&gt;

        &lt;version&gt;1.0.0-M3.1&lt;/version&gt;

    &lt;/dependency&gt;

    &lt;!-- Other dependencies as needed --&gt;
&lt;/dependencies&gt;
</code></pre>
    <h4 id="rdmc7">
     5. ChatClient的初始化与控制器实现
    </h4>
    <p id="u818ecb77">
     接下来，我们需要在Controller中注入
     <code>
      ChatClient
     </code>
     实例，并通过它来处理来自用户的请求。这里展示了一个简单的示例，该示例接收用户输入并利用Flux流式返回AI生成的回答。
    </p>
    <pre id="jXAWF"><code>@RestController
@RequestMapping("/ai")
@CrossOrigin(origins = "*")
public class ChatController {

    private final ChatClient chatClient;
    
    @Value("classpath:correct-and-expand.st")
    Resource resource;

    public ChatController(ChatClient.Builder builder) {
        this.chatClient = builder.build();
    }

    @GetMapping("/chat")
    public String chat(String input) {
        return this.chatClient.prompt()
                .user(input)
                .call()
                .content();
    }

    @GetMapping(value = "/chatStream")
    public Flux&lt;String&gt; chatSteam(@RequestParam String input, HttpServletResponse response) {
        // 如果遇到乱码问题，可增加编码设置
        response.setCharacterEncoding("UTF-8");
        
        PromptTemplate promptTemplate = new PromptTemplate(resource);
        Prompt prompt = promptTemplate.create(Map.of("input", input));
        return chatClient.prompt(prompt).stream().content();
    }
}</code></pre>
    <p id="uf4c7c192">
     以上代码展示了如何构建一个简单的聊天API端点，其中
     <code>
      /chat
     </code>
     用于非流式响应，而
     <code>
      /chatStream
     </code>
     则支持基于Reactor的流式响应。
    </p>
    <h4 id="F2TxN">
     6. 测试
    </h4>
    <p id="u2428ff58">
     完成上述步骤后，你可以通过向
     <code>
      http://localhost:8080/ai/chat?input=你好
     </code>
     发送GET请求来测试聊天功能是否正常工作。对于流式响应，尝试访问
     <code>
      http://localhost:8080/ai/chatStream?input=你好
     </code>
     查看效果。
    </p>
    <p id="u40e851e7">
     通过按照上述步骤操作，你就能成功集成Spring AI Alibaba框架，搭建起一个基本但功能完整的聊天API服务。
    </p>
    <p id="u27e910eb">
    </p>
    <p id="u9916ebfc">
    </p>
    <h2 id="uoBnK">
    </h2>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f776869737065727a7a7a612f:61727469636c652f64657461696c732f313434343938373531" class_="artid" style="display:none">
 </p>
</div>


