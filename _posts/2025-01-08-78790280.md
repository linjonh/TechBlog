---
layout: post
title: "服务器负载均衡原理及实现"
date: 2025-01-08 18:45:48 +0800
description: "背景：当系统面临大量用户访问，负载过高的时候，通常会使用增加服务器数量来进行横向扩展，使用集群和负载"
keywords: "利用服务器做负载"
categories: ['服务器', '其他']
tags: ['集群', '负载均衡', '服务器']
artid: "78790280"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=78790280
    alt: "服务器负载均衡原理及实现"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     服务器负载均衡原理及实现
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     背景：当系统面临大量用户访问，负载过高的时候，通常会使用增加服务器数量来进行横向扩展，使用集群和负载均衡提高整个系统的处理能力。
    </p>
    <p>
     在此先感谢两位作者：
     <br/>
     1.作者：知乎用户
     <br/>
     链接：
     <a href="https://www.zhihu.com/question/22610352/answer/138542422" rel="nofollow">
      https://www.zhihu.com/question/22610352/answer/138542422
     </a>
     <br/>
     来源：知乎
     <br/>
     著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处
    </p>
    <p>
     2.作者：GiraffeLin
     <br/>
     链接：
     <a href="https://www.douban.com/note/325866291/?type=like" rel="nofollow">
      https://www.douban.com/note/325866291/?type=like
     </a>
     <br/>
     来源：豆瓣
     <br/>
     著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处
    </p>
    <p>
     而我们讨论的负载均衡一般分为两种，一种是基于DNS，另一种基于IP报文。更详细的在这里就不说了。
    </p>
    <p>
     下面给出几种负载均衡的原理图，也是我从网上扒的。
     <br/>
     1.HTTP重定向
     <br/>
     <img alt="HTTP重定向" src="https://img-blog.csdn.net/20171213114959342?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvR3lfX015/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title="">
      <br/>
      2.DNS负载均衡
      <br/>
      <img alt="DNS负载均衡" src="https://img-blog.csdn.net/20171213115032077?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvR3lfX015/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title="">
       <br/>
       3.反向代理负载均衡
       <br/>
       <img alt="反向代理负载均衡" src="https://img-blog.csdn.net/20171213115119533?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvR3lfX015/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title="">
        <br/>
        4. IP负载均衡
        <br/>
        <img alt="IP负载均衡" src="https://img-blog.csdn.net/20171213115202604?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvR3lfX015/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title="">
         <br/>
         5.直接路由
         <br/>
         <img alt="这里写图片描述" src="https://img-blog.csdn.net/20171213115240441?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvR3lfX015/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title="">
          <br/>
          这是我在网上查到的几种负载均衡原理图，还是挺直观的。下面说具体实现，也为了以后自己可以方便查阅
         </img>
        </img>
       </img>
      </img>
     </img>
    </p>
    <p>
     测试环境
     <br/>
     由于没有服务器，所以本次测试直接host指定域名，然后在VMware里安装了三台CentOS。
     <br/>
     测试域名 ：a.com
     <br/>
     A服务器IP ：192.168.5.149 （主）
     <br/>
     B服务器IP ：192.168.5.27
     <br/>
     C服务器IP ：192.168.5.126
     <br/>
     部署思路
     <br/>
     A服务器做为主服务器，域名直接解析到A服务器（192.168.5.149）上，由A服务器负载均衡到B服务器（192.168.5.27）与C服务器（192.168.5.126）上。
    </p>
    <p>
     域名解析
     <br/>
     由于不是真实环境，域名就随便使用一个a.com用作测试，所以a.com的解析只能在hosts文件设置。
     <br/>
     打开：C:WindowsSystem32driversetchosts
     <br/>
     在末尾添加
     <br/>
     192.168.5.149 a.com
     <br/>
     保存退出，然后启动命令模式ping下看看是否已设置成功
    </p>
    <p>
     从截图上看已成功将a.com解析到192.168.5.149IP
     <br/>
     A服务器nginx.conf设置
     <br/>
     打开nginx.conf，文件位置在nginx安装目录的conf目录下。
     <br/>
     在http段加入以下代码
     <br/>
     upstream a.com {
     <br/>
     server 192.168.5.126:80;
     <br/>
     server 192.168.5.27:80;
     <br/>
     }
    </p>
    <p>
     server{
     <br/>
     listen 80;
     <br/>
     server_name a.com;
     <br/>
     location / {
     <br/>
     proxy_pass
     <a href="http://a.com" rel="nofollow">
      http://a.com
     </a>
     ;
     <br/>
     proxy_set_header Host
     <span class="MathJax_Preview">
     </span>
     <span class="MathJax" id="MathJax-Element-29-Frame" style="">
      <span class="math" id="MathJax-Span-897" style="width: 15.217em; display: inline-block;">
       <span style="display: inline-block; position: relative; width: 14.615em; height: 0px; font-size: 104%;">
        <span style="position: absolute; clip: rect(1.689em, 1000em, 3.007em, -0.558em); top: -2.564em; left: 0em;">
         <span class="mrow" id="MathJax-Span-898">
          <span class="mi" id="MathJax-Span-899" style="font-family: STIXGeneral-Italic;">
           h
          </span>
          <span class="mi" id="MathJax-Span-900" style="font-family: STIXGeneral-Italic;">
           o
          </span>
          <span class="mi" id="MathJax-Span-901" style="font-family: STIXGeneral-Italic;">
           s
          </span>
          <span class="mi" id="MathJax-Span-902" style="font-family: STIXGeneral-Italic;">
           t
           <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;">
           </span>
          </span>
          <span class="mo" id="MathJax-Span-903" style="font-family: STIXGeneral-Regular;">
           ;
          </span>
          <span class="mi" id="MathJax-Span-904" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">
           p
          </span>
          <span class="mi" id="MathJax-Span-905" style="font-family: STIXGeneral-Italic;">
           r
           <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.023em;">
           </span>
          </span>
          <span class="mi" id="MathJax-Span-906" style="font-family: STIXGeneral-Italic;">
           o
          </span>
          <span class="mi" id="MathJax-Span-907" style="font-family: STIXGeneral-Italic;">
           x
           <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;">
           </span>
          </span>
          <span class="msubsup" id="MathJax-Span-908">
           <span style="display: inline-block; position: relative; width: 0.908em; height: 0px;">
            <span style="position: absolute; clip: rect(1.931em, 1000em, 2.962em, -0.601em); top: -2.564em; left: 0em;">
             <span class="mi" id="MathJax-Span-909" style="font-family: STIXGeneral-Italic;">
              y
             </span>
             <span style="display: inline-block; width: 0px; height: 2.564em;">
             </span>
            </span>
            <span style="position: absolute; top: -2.002em; left: 0.513em;">
             <span class="mi" id="MathJax-Span-910" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">
              s
             </span>
             <span style="display: inline-block; width: 0px; height: 2.244em;">
             </span>
            </span>
           </span>
          </span>
          <span class="mi" id="MathJax-Span-911" style="font-family: STIXGeneral-Italic;">
           e
          </span>
          <span class="msubsup" id="MathJax-Span-912">
           <span style="display: inline-block; position: relative; width: 0.762em; height: 0px;">
            <span style="position: absolute; clip: rect(1.826em, 1000em, 2.767em, -0.539em); top: -2.564em; left: 0em;">
             <span class="mi" id="MathJax-Span-913" style="font-family: STIXGeneral-Italic;">
              t
              <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;">
              </span>
             </span>
             <span style="display: inline-block; width: 0px; height: 2.564em;">
             </span>
            </span>
            <span style="position: absolute; top: -2.094em; left: 0.303em;">
             <span class="mi" id="MathJax-Span-914" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">
              h
             </span>
             <span style="display: inline-block; width: 0px; height: 2.244em;">
             </span>
            </span>
           </span>
          </span>
          <span class="mi" id="MathJax-Span-915" style="font-family: STIXGeneral-Italic;">
           e
          </span>
          <span class="mi" id="MathJax-Span-916" style="font-family: STIXGeneral-Italic;">
           a
          </span>
          <span class="mi" id="MathJax-Span-917" style="font-family: STIXGeneral-Italic;">
           d
           <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;">
           </span>
          </span>
          <span class="mi" id="MathJax-Span-918" style="font-family: STIXGeneral-Italic;">
           e
          </span>
          <span class="mi" id="MathJax-Span-919" style="font-family: STIXGeneral-Italic;">
           r
           <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.023em;">
           </span>
          </span>
          <span class="mi" id="MathJax-Span-920" style="font-family: STIXGeneral-Italic;">
           X
           <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.044em;">
           </span>
          </span>
          <span class="mo" id="MathJax-Span-921" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">
           −
          </span>
          <span class="mi" id="MathJax-Span-922" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">
           R
          </span>
          <span class="mi" id="MathJax-Span-923" style="font-family: STIXGeneral-Italic;">
           e
          </span>
          <span class="mi" id="MathJax-Span-924" style="font-family: STIXGeneral-Italic;">
           a
          </span>
          <span class="mi" id="MathJax-Span-925" style="font-family: STIXGeneral-Italic;">
           l
           <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;">
           </span>
          </span>
          <span class="mo" id="MathJax-Span-926" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">
           −
          </span>
          <span class="mi" id="MathJax-Span-927" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">
           I
           <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.051em;">
           </span>
          </span>
          <span class="mi" id="MathJax-Span-928" style="font-family: STIXGeneral-Italic;">
           P
          </span>
         </span>
         <span style="display: inline-block; width: 0px; height: 2.564em;">
         </span>
        </span>
       </span>
       <span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.104em; vertical-align: -0.327em;">
       </span>
      </span>
     </span>
     remote_addr;
     <br/>
     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
     <br/>
     }
     <br/>
     }
     <br/>
     保存重启nginx
     <br/>
     B、C服务器nginx.conf设置
     <br/>
     打开nginx.confi，在http段加入以下代码
     <br/>
     server{
     <br/>
     listen 80;
     <br/>
     server_name a.com;
     <br/>
     index index.html;
     <br/>
     root /data0/htdocs/www;
     <br/>
     }
     <br/>
     保存重启nginx
     <br/>
     测试
     <br/>
     当访问a.com的时候，为了区分是转向哪台服务器处理我分别在B、C服务器下写一个不同内容的index.html文件，以作区分。
     <br/>
     打开浏览器访问a.com结果，刷新会发现所有的请求均分别被主服务器（192.168.5.149）分配到B服务器（192.168.5.27）与C服务器（192.168.5.126）上，实现了负载均衡效果。
     <br/>
     B服务器处理页面
    </p>
    <p>
     C服务器处理页面
    </p>
    <p>
     假如其中一台服务器宕机会怎样？
     <br/>
     当某台服务器宕机了，是否会影响访问呢？
     <br/>
     我们先来看看实例，根据以上例子，假设C服务器192.168.5.126这台机子宕机了（由于无法模拟宕机，所以我就把C服务器关机）然后再来访问看看。
     <br/>
     访问结果：
    </p>
    <p>
     我们发现，虽然C服务器（192.168.5.126）宕机了，但不影响网站访问。这样，就不会担心在负载均衡模式下因为某台机子宕机而拖累整个站点了。
     <br/>
     如果b.com也要设置负载均衡怎么办？
     <br/>
     很简单，跟a.com设置一样。如下：
     <br/>
     假设b.com的主服务器IP是192.168.5.149，负载均衡到192.168.5.150和192.168.5.151机器上
     <br/>
     现将域名b.com解析到192.168.5.149IP上。
     <br/>
     在主服务器(192.168.5.149)的nginx.conf加入以下代码：
     <br/>
     upstream b.com {
     <br/>
     server 192.168.5.150:80;
     <br/>
     server 192.168.5.151:80;
     <br/>
     }
    </p>
    <p>
     server{
     <br/>
     listen 80;
     <br/>
     server_name b.com;
     <br/>
     location / {
     <br/>
     proxy_pass
     <a href="http://b.com" rel="nofollow">
      http://b.com
     </a>
     ;
     <br/>
     proxy_set_header Host
     <span class="MathJax_Preview">
     </span>
     <span class="MathJax" id="MathJax-Element-30-Frame" style="">
      <span class="math" id="MathJax-Span-929" style="width: 15.217em; display: inline-block;">
       <span style="display: inline-block; position: relative; width: 14.615em; height: 0px; font-size: 104%;">
        <span style="position: absolute; clip: rect(1.689em, 1000em, 3.007em, -0.558em); top: -2.564em; left: 0em;">
         <span class="mrow" id="MathJax-Span-930">
          <span class="mi" id="MathJax-Span-931" style="font-family: STIXGeneral-Italic;">
           h
          </span>
          <span class="mi" id="MathJax-Span-932" style="font-family: STIXGeneral-Italic;">
           o
          </span>
          <span class="mi" id="MathJax-Span-933" style="font-family: STIXGeneral-Italic;">
           s
          </span>
          <span class="mi" id="MathJax-Span-934" style="font-family: STIXGeneral-Italic;">
           t
           <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;">
           </span>
          </span>
          <span class="mo" id="MathJax-Span-935" style="font-family: STIXGeneral-Regular;">
           ;
          </span>
          <span class="mi" id="MathJax-Span-936" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">
           p
          </span>
          <span class="mi" id="MathJax-Span-937" style="font-family: STIXGeneral-Italic;">
           r
           <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.023em;">
           </span>
          </span>
          <span class="mi" id="MathJax-Span-938" style="font-family: STIXGeneral-Italic;">
           o
          </span>
          <span class="mi" id="MathJax-Span-939" style="font-family: STIXGeneral-Italic;">
           x
           <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;">
           </span>
          </span>
          <span class="msubsup" id="MathJax-Span-940">
           <span style="display: inline-block; position: relative; width: 0.908em; height: 0px;">
            <span style="position: absolute; clip: rect(1.931em, 1000em, 2.962em, -0.601em); top: -2.564em; left: 0em;">
             <span class="mi" id="MathJax-Span-941" style="font-family: STIXGeneral-Italic;">
              y
             </span>
             <span style="display: inline-block; width: 0px; height: 2.564em;">
             </span>
            </span>
            <span style="position: absolute; top: -2.002em; left: 0.513em;">
             <span class="mi" id="MathJax-Span-942" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">
              s
             </span>
             <span style="display: inline-block; width: 0px; height: 2.244em;">
             </span>
            </span>
           </span>
          </span>
          <span class="mi" id="MathJax-Span-943" style="font-family: STIXGeneral-Italic;">
           e
          </span>
          <span class="msubsup" id="MathJax-Span-944">
           <span style="display: inline-block; position: relative; width: 0.762em; height: 0px;">
            <span style="position: absolute; clip: rect(1.826em, 1000em, 2.767em, -0.539em); top: -2.564em; left: 0em;">
             <span class="mi" id="MathJax-Span-945" style="font-family: STIXGeneral-Italic;">
              t
              <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;">
              </span>
             </span>
             <span style="display: inline-block; width: 0px; height: 2.564em;">
             </span>
            </span>
            <span style="position: absolute; top: -2.094em; left: 0.303em;">
             <span class="mi" id="MathJax-Span-946" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">
              h
             </span>
             <span style="display: inline-block; width: 0px; height: 2.244em;">
             </span>
            </span>
           </span>
          </span>
          <span class="mi" id="MathJax-Span-947" style="font-family: STIXGeneral-Italic;">
           e
          </span>
          <span class="mi" id="MathJax-Span-948" style="font-family: STIXGeneral-Italic;">
           a
          </span>
          <span class="mi" id="MathJax-Span-949" style="font-family: STIXGeneral-Italic;">
           d
           <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;">
           </span>
          </span>
          <span class="mi" id="MathJax-Span-950" style="font-family: STIXGeneral-Italic;">
           e
          </span>
          <span class="mi" id="MathJax-Span-951" style="font-family: STIXGeneral-Italic;">
           r
           <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.023em;">
           </span>
          </span>
          <span class="mi" id="MathJax-Span-952" style="font-family: STIXGeneral-Italic;">
           X
           <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.044em;">
           </span>
          </span>
          <span class="mo" id="MathJax-Span-953" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">
           −
          </span>
          <span class="mi" id="MathJax-Span-954" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">
           R
          </span>
          <span class="mi" id="MathJax-Span-955" style="font-family: STIXGeneral-Italic;">
           e
          </span>
          <span class="mi" id="MathJax-Span-956" style="font-family: STIXGeneral-Italic;">
           a
          </span>
          <span class="mi" id="MathJax-Span-957" style="font-family: STIXGeneral-Italic;">
           l
           <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;">
           </span>
          </span>
          <span class="mo" id="MathJax-Span-958" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">
           −
          </span>
          <span class="mi" id="MathJax-Span-959" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">
           I
           <span style="display: inline-block; overflow: hidden; height: 1px; width: 0.051em;">
           </span>
          </span>
          <span class="mi" id="MathJax-Span-960" style="font-family: STIXGeneral-Italic;">
           P
          </span>
         </span>
         <span style="display: inline-block; width: 0px; height: 2.564em;">
         </span>
        </span>
       </span>
       <span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.104em; vertical-align: -0.327em;">
       </span>
      </span>
     </span>
     <script id="MathJax-Element-30" type="math/tex">
      host;   
        proxy_set_header   X-Real-IP
     </script>
     remote_addr;
     <br/>
     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
     <br/>
     }
     <br/>
     }
     <br/>
     保存重启nginx
     <br/>
     在192.168.5.150与192.168.5.151机器上设置nginx，打开nginx.conf在末尾添加以下代码：
     <br/>
     server{
     <br/>
     listen 80;
     <br/>
     server_name b.com;
     <br/>
     index index.html;
     <br/>
     root /data0/htdocs/www;
     <br/>
     }
     <br/>
     保存重启nginx
     <br/>
     完成以后步骤后即可实现b.com的负载均衡配置。
     <br/>
     主服务器不能提供服务吗？
     <br/>
     以上例子中，我们都是应用到了主服务器负载均衡到其它服务器上，那么主服务器本身能不能也加在服务器列表中，这样就不会白白浪费拿一台服务器纯当做转发功能，而是也参与到提供服务中来。
     <br/>
     如以上案例三台服务器：
     <br/>
     A服务器IP ：192.168.5.149 （主）
     <br/>
     B服务器IP ：192.168.5.27
     <br/>
     C服务器IP ：192.168.5.126
     <br/>
     我们把域名解析到A服务器，然后由A服务器转发到B服务器与C服务器，那么A服务器只做一个转发功能，现在我们让A服务器也提供站点服务。
     <br/>
     我们先来分析一下，如果添加主服务器到upstream中，那么可能会有以下两种情况发生：
     <br/>
     1、主服务器转发到了其它IP上，其它IP服务器正常处理；
     <br/>
     2、主服务器转发到了自己IP上，然后又进到主服务器分配IP那里，假如一直分配到本机，则会造成一个死循环。
     <br/>
     怎么解决这个问题呢？因为80端口已经用来监听负载均衡的处理，那么本服务器上就不能再使用80端口来处理a.com的访问请求，得用一个新的。于是我们把主服务器的nginx.conf加入以下一段代码：
     <br/>
     server{
     <br/>
     listen 8080;
     <br/>
     server_name a.com;
     <br/>
     index index.html;
     <br/>
     root /data0/htdocs/www;
     <br/>
     }
    </p>
    <p>
     重启nginx，在浏览器输入a.com:8080试试看能不能访问。结果可以正常访问
    </p>
    <p>
     既然能正常访问，那么我们就可以把主服务器添加到upstream中，但是端口要改一下，如下代码：
     <br/>
     upstream a.com {
     <br/>
     server 192.168.5.126:80;
     <br/>
     server 192.168.5.27:80;
     <br/>
     server 127.0.0.1:8080;
     <br/>
     }
     <br/>
     由于这里可以添加主服务器IP192.168.5.149或者127.0.0.1均可以，都表示访问自己。
     <br/>
     重启Nginx，然后再来访问a.com看看会不会分配到主服务器上。
    </p>
    <p>
     主服务器也能正常加入服务了。
     <br/>
     最后
     <br/>
     一、负载均衡不是nginx独有，著名鼎鼎的apache也有，但性能可能不如nginx。
     <br/>
     二、多台服务器提供服务，但域名只解析到主服务器，而真正的服务器IP不会被ping下即可获得，增加一定安全性。
    </p>
    <p>
     三、upstream里的IP不一定是内网，外网IP也可以。不过经典的案例是，局域网中某台IP暴露在外网下，域名直接解析到此IP。然后又这台主服务器转发到内网服务器IP中。
     <br/>
     四、某台服务器宕机、不会影响网站正常运行，Nginx不会把请求转发到已宕机的IP上
    </p>
    <p>
     最后推荐一本书：《构建高性能Web站点》，里面有很多醍醐灌顶的东西。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <script>
  $(function() {
      setTimeout(function () {
        var mathcodeList = document.querySelectorAll('.htmledit_views img.mathcode');
        if (mathcodeList.length > 0) {
          for (let i = 0; i < mathcodeList.length; i++) {
            if (mathcodeList[i].complete) {
              if (mathcodeList[i].naturalWidth === 0 || mathcodeList[i].naturalHeight === 0) {
                var alt = mathcodeList[i].alt;
                alt = '\\(' + alt + '\\)';
                var curSpan = $('<span class="img-codecogs"></span>');
                curSpan.text(alt);
                $(mathcodeList[i]).before(curSpan);
                $(mathcodeList[i]).remove();
              }
            } else {
              mathcodeList[i].onerror = function() {
                var alt = mathcodeList[i].alt;
                alt = '\\(' + alt + '\\)';
                var curSpan = $('<span class="img-codecogs"></span>');
                curSpan.text(alt);
                $(mathcodeList[i]).before(curSpan);
                $(mathcodeList[i]).remove();
              };
            }
          }
          MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
        }
      }, 500)
    });
 </script>
 <p alt="687474:70733a2f2f626c6f672e6373646e2e6e65742f47795f5f4d79:2f61727469636c652f64657461696c732f3738373930323830" class_="artid" style="display:none">
 </p>
</div>


