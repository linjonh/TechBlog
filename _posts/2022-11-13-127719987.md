---
layout: post
title: "用C语言写个控制台扫雷游戏附完整代码"
date: 2022-11-13 12:58:29 +0800
description: "C语言编写控制台扫雷游戏_控制台窗口游戏"
keywords: "控制台窗口游戏"
categories: ['学习', 'C']
tags: ['开发语言', 'Windows', 'C']
artid: "127719987"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=127719987
    alt: "用C语言写个控制台扫雷游戏附完整代码"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     用C语言写个控制台扫雷游戏（附完整代码）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_1">
     </a>
     前言
    </h2>
    <p>
     扫雷游戏大家应该都玩过，虽然win10以后更新了，但还是win7版的好用，在代码写烦了来上几把换换脑子还是不错滴。
    </p>
    <p>
     下面用c语言模仿win7版的写一个控制台扫雷游戏。
    </p>
    <hr/>
    <h2>
     <a id="_8">
     </a>
     一、对控制台的控制
    </h2>
    <p>
     游戏中要对控制台的大小、文字颜色、光标大小、光标位置、鼠标输入等需要进行一些设置，下面列出所需要的一些函数。
    </p>
    <h3>
     <a id="1_10">
     </a>
     1.控制台大小
    </h3>
    <p>
     控制台大小通过mode命令设置。这个命令中的大小是指行和列的字符数而非像素。
    </p>
    <pre><code class="prism language-c"><span class="token comment">//设置控制台大小</span>
<span class="token keyword">void</span> <span class="token function">SetSize</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> uCol<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> uLine<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">char</span> cmd<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">sprintf</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> <span class="token string">"mode con cols=%d lines=%d"</span><span class="token punctuation">,</span> uCol<span class="token punctuation">,</span> uLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">system</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="2_22">
     </a>
     2.控制台颜色
    </h3>
    <p>
     控制台颜色设置详情可查看：
     <a href="https://apull.blog.csdn.net/article/details/127721675" rel="nofollow">
      用C代码设置Windows控制台颜色
     </a>
    </p>
    <pre><code class="prism language-c"><span class="token comment">//更改文字颜色</span>
<span class="token comment">// color为每一种颜色所代表的数字，范围是0~15</span>
<span class="token keyword">void</span> <span class="token function">setColor</span><span class="token punctuation">(</span>WORD color<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    HANDLE HOutput <span class="token operator">=</span> <span class="token function">GetStdHandle</span><span class="token punctuation">(</span>STD_OUTPUT_HANDLE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取标准输出的句柄</span>
    <span class="token function">SetConsoleTextAttribute</span><span class="token punctuation">(</span>HOutput<span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="3_34">
     </a>
     3.控制台光标样式
    </h3>
    <p>
     更改光标样式要用到结构体CONSOLE_CURSOR_INFO 和控制台API函数SetConsoleCursorInfo，通过这个结构体和函数可以设置光标的可见性和大小。
    </p>
    <pre><code class="prism language-c"><span class="token comment">// 设置光标样式</span>
<span class="token keyword">void</span> <span class="token function">SetCursorType</span><span class="token punctuation">(</span>BOOL bVisible<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    HANDLE HOutput <span class="token operator">=</span> <span class="token function">GetStdHandle</span><span class="token punctuation">(</span>STD_OUTPUT_HANDLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    CONSOLE_CURSOR_INFO curInfo<span class="token punctuation">;</span>
    curInfo<span class="token punctuation">.</span>bVisible <span class="token operator">=</span> bVisible<span class="token punctuation">;</span> <span class="token comment">//更改光标显示状态，TRUE显示光标，FALSE隐藏光标</span>
    curInfo<span class="token punctuation">.</span>dwSize <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>        <span class="token comment">// 光标大小1到100之间。 范围从完全填充单元格到单元底部的水平线条。</span>
    <span class="token function">SetConsoleCursorInfo</span><span class="token punctuation">(</span>HOutput<span class="token punctuation">,</span> <span class="token operator">&amp;</span>curInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="4_49">
     </a>
     4.控制台光标位置
    </h3>
    <p>
     这个函数用的比较多，用来定位要输出的字符的位置。
    </p>
    <pre><code class="prism language-c"><span class="token comment">//设置光标位置，起点从1开始</span>
<span class="token keyword">void</span> <span class="token function">MoveCursorTo</span><span class="token punctuation">(</span><span class="token keyword">int</span> nCols<span class="token punctuation">,</span> <span class="token keyword">int</span> nRows<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    COORD crdLocation <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>nCols<span class="token punctuation">,</span> nRows<span class="token punctuation">}</span><span class="token punctuation">;</span>
    HANDLE HOutput <span class="token operator">=</span> <span class="token function">GetStdHandle</span><span class="token punctuation">(</span>STD_OUTPUT_HANDLE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取标准输出的句柄</span>
    <span class="token function">SetConsoleCursorPosition</span><span class="token punctuation">(</span>HOutput<span class="token punctuation">,</span> crdLocation<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置光标位置</span>
<span class="token punctuation">}</span>

</code></pre>
    <h3>
     <a id="5_61">
     </a>
     5.获取控制台光标位置字符
    </h3>
    <p>
     这个函数用的比较多，用来定位要输出的字符的位置。
    </p>
    <pre><code class="prism language-c"><span class="token comment">/// 提取出窗口中第x行y列的位置的字符</span>
<span class="token comment">/// @return 返回指定位置显示的字符，空白处返回空格</span>
<span class="token keyword">char</span> <span class="token function">GetCursorStr</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    COORD pos <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>x<span class="token punctuation">,</span> y<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> str <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    DWORD read<span class="token punctuation">;</span>
    <span class="token comment">// HANDLE HOutput = GetStdHandle(STD_OUTPUT_HANDLE); //获取标准输出的句柄</span>
    <span class="token function">ReadConsoleOutputCharacterA</span><span class="token punctuation">(</span>HOutput<span class="token punctuation">,</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> pos<span class="token punctuation">,</span> <span class="token operator">&amp;</span>read<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="6_77">
     </a>
     6.控制台显示位置
    </h3>
    <p>
     通过API函数MoveWindow设置窗口的位置。在设置窗口位置之前，要先取得控制台窗口大小和屏幕大小，通过计算得出屏幕居中的位置。
    </p>
    <pre><code class="prism language-c"><span class="token comment">//居中显示控制台</span>
BOOL <span class="token function">MoveConsoleWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//获取屏幕大小</span>
    HDC hdc <span class="token operator">=</span> <span class="token function">GetDC</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> cx <span class="token operator">=</span> <span class="token function">GetDeviceCaps</span><span class="token punctuation">(</span>hdc<span class="token punctuation">,</span> DESKTOPHORZRES<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//窗口左侧位置</span>
    <span class="token keyword">int</span> cy <span class="token operator">=</span> <span class="token function">GetDeviceCaps</span><span class="token punctuation">(</span>hdc<span class="token punctuation">,</span> DESKTOPVERTRES<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//窗口顶部位置</span>
    <span class="token function">ReleaseDC</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> hdc<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//获取控制台大小</span>
    HWND HOutput <span class="token operator">=</span> <span class="token function">GetConsoleWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    RECT rect<span class="token punctuation">;</span>
    <span class="token function">GetWindowRect</span><span class="token punctuation">(</span>HOutput<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rect<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> w <span class="token operator">=</span> rect<span class="token punctuation">.</span>right <span class="token operator">-</span> rect<span class="token punctuation">.</span>left<span class="token punctuation">;</span> <span class="token comment">//窗口宽度</span>
    <span class="token keyword">int</span> h <span class="token operator">=</span> rect<span class="token punctuation">.</span>bottom <span class="token operator">-</span> rect<span class="token punctuation">.</span>top<span class="token punctuation">;</span> <span class="token comment">//窗口高度</span>
    cx <span class="token operator">=</span> <span class="token punctuation">(</span>cx <span class="token operator">-</span> w<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    cy <span class="token operator">=</span> <span class="token punctuation">(</span>cy <span class="token operator">-</span> h<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">MoveWindow</span><span class="token punctuation">(</span>HOutput<span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">,</span> TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="7_102">
     </a>
     7.控制台鼠标操作设置
    </h3>
    <p>
     除了上面，还需要对控制台的鼠标操作进行屏蔽。
    </p>
    <pre><code class="prism language-c">
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DISABLE_QUICK_EDIT_MODE</span> <span class="token expression"><span class="token number">0x01</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DISABLE_INSERT_MODE</span> <span class="token expression"><span class="token number">0x02</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DISABLE_MOUSE_INPUT</span> <span class="token expression"><span class="token number">0x03</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DISABLE_ALL</span> <span class="token expression"><span class="token punctuation">(</span>DISABLE_QUICK_EDIT_MODE <span class="token operator">|</span> DISABLE_INSERT_MODE <span class="token operator">|</span> DISABLE_MOUSE_INPUT<span class="token punctuation">)</span></span></span>

<span class="token comment">//执行控制台相关设置</span>
<span class="token keyword">void</span> <span class="token function">CloseConsoleMode</span><span class="token punctuation">(</span>UINT uTag<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    HANDLE HInput <span class="token operator">=</span> <span class="token function">GetStdHandle</span><span class="token punctuation">(</span>STD_INPUT_HANDLE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这里用标准输入设备</span>
    DWORD mode<span class="token punctuation">;</span>
    <span class="token function">GetConsoleMode</span><span class="token punctuation">(</span>HInput<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>uTag <span class="token operator">&amp;</span> DISABLE_QUICK_EDIT_MODE<span class="token punctuation">)</span>
        mode <span class="token operator">&amp;=</span> <span class="token operator">~</span>ENABLE_QUICK_EDIT_MODE<span class="token punctuation">;</span> <span class="token comment">//移除快速编辑模式</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>uTag <span class="token operator">&amp;</span> DISABLE_INSERT_MODE<span class="token punctuation">)</span>
        mode <span class="token operator">&amp;=</span> <span class="token operator">~</span>ENABLE_INSERT_MODE<span class="token punctuation">;</span> <span class="token comment">//移除插入模式</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>uTag <span class="token operator">&amp;</span> DISABLE_MOUSE_INPUT<span class="token punctuation">)</span>
        mode <span class="token operator">&amp;=</span> <span class="token operator">~</span>ENABLE_MOUSE_INPUT<span class="token punctuation">;</span> <span class="token comment">//移除鼠标输入</span>
    <span class="token function">SetConsoleMode</span><span class="token punctuation">(</span>HInput<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
    </p>
    <h2>
     <a id="_127">
     </a>
     二、游戏界面
    </h2>
    <h3>
     <a id="1_128">
     </a>
     1.游戏难度选择界面
    </h3>
    <p>
     win版的扫雷有3种难度和自定义难度，这里通过选择界面选择游戏难度。
     <br/>
     先看看效果
     <br/>
     <img alt="选择界面_自定义" src="https://i-blog.csdnimg.cn/blog_migrate/c6fb1c9f8735b8dae3bee7f83afe5211.png#pic_center"/>
    </p>
    <h4>
     <a id="11__132">
     </a>
     1.1 基本定义
    </h4>
    <p>
     定义结构体保存游戏的格子数量和地雷数量。
    </p>
    <pre><code class="prism language-c">
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CONSOLEWIDTH</span> <span class="token expression"><span class="token number">80</span>  </span><span class="token comment">//控制台宽度</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CONSOLEHEIGHT</span> <span class="token expression"><span class="token number">40</span> </span><span class="token comment">//控制台高度</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DEFCOLOR</span> <span class="token expression"><span class="token number">0x7</span>     </span><span class="token comment">//控制台默认文字颜色</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_point</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">short</span> x<span class="token punctuation">;</span>
    <span class="token keyword">short</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span> Point<span class="token punctuation">;</span>

<span class="token comment">//格子大小</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_MapSize</span>
<span class="token punctuation">{<!-- --></span>
    Point MapSize<span class="token punctuation">;</span> <span class="token comment">//格子数量</span>
    <span class="token keyword">short</span> Mine_Count<span class="token punctuation">;</span> <span class="token comment">//地雷数量</span>
<span class="token punctuation">}</span> Map_Size<span class="token punctuation">;</span>

<span class="token comment">//按照win扫雷定义尺寸和雷数</span>
Map_Size defMapSize<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre>
    <h4>
     <a id="12_158">
     </a>
     1.2显示标题信息
    </h4>
    <ul>
     <li>
      使用setColor更改文字颜色
     </li>
     <li>
      sprintf给buf输出字符宽度控制居中显示。
     </li>
     <li>
      显示输出后文字颜色改回默认颜色
     </li>
    </ul>
    <pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">PrintName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0x2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token punctuation">(</span>CONSOLEWIDTH <span class="token operator">-</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token function">sprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"\n%%%ds\n"</span><span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"欢迎来到扫雷小游戏"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"%%%ds\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>CONSOLEWIDTH <span class="token operator">-</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"-- by Apull --"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span>DEFCOLOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
    <h4>
     <a id="13_177">
     </a>
     1.3显示难度选项
    </h4>
    <ul>
     <li>
      不同难度使用不同颜色显示
     </li>
     <li>
      游戏界面中横向格子之间用空格隔开，因此在选定难度后，横向格子数量需要翻倍，更改为MapSize.MapSize.x * 2 - 1
     </li>
    </ul>
    <pre><code class="prism language-c"><span class="token comment">//难度选择</span>
<span class="token keyword">void</span> <span class="token function">Choose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    MapSize <span class="token operator">=</span> defMapSize<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">PrintName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t\t选择游戏难度：\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0xA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t\t  1、初级：%dx%d,共%d个地雷\n"</span><span class="token punctuation">,</span> defMapSize<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x<span class="token punctuation">,</span> defMapSize<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y<span class="token punctuation">,</span> defMapSize<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Mine_Count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0xE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t\t  2、中级：%dx%d,共%d个地雷\n"</span><span class="token punctuation">,</span> defMapSize<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x<span class="token punctuation">,</span> defMapSize<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y<span class="token punctuation">,</span> defMapSize<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Mine_Count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0xc</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t\t  3、高级：%dx%d,共%d个地雷\n"</span><span class="token punctuation">,</span> defMapSize<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x<span class="token punctuation">,</span> defMapSize<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y<span class="token punctuation">,</span> defMapSize<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Mine_Count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0x9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t\t  4、自定义难度\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span>DEFCOLOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t\t  0、退出\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t\t输入你的选择(回车默认选择1): "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">char</span> ch<span class="token punctuation">;</span>
    BOOL inputOK <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>inputOK<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        ch <span class="token operator">=</span> <span class="token function">_getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>ch<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token char">'1'</span><span class="token operator">:</span>
        <span class="token keyword">case</span> Key_ENTER<span class="token operator">:</span>
            MapSize <span class="token operator">=</span> defMapSize<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            inputOK <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token char">'2'</span><span class="token operator">:</span>
            MapSize <span class="token operator">=</span> defMapSize<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            inputOK <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token char">'3'</span><span class="token operator">:</span>
            MapSize <span class="token operator">=</span> defMapSize<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            inputOK <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token char">'4'</span><span class="token operator">:</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">OptMines</span><span class="token punctuation">(</span><span class="token string">"\t\t  高度："</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">OptMines</span><span class="token punctuation">(</span><span class="token string">"\t\t  宽度："</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            MapSize<span class="token punctuation">.</span>Mine_Count <span class="token operator">=</span> <span class="token function">OptMines</span><span class="token punctuation">(</span><span class="token string">"\t\t  雷数："</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">668</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            inputOK <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token char">'0'</span><span class="token operator">:</span>
        <span class="token keyword">case</span> Key_ESC<span class="token operator">:</span>
            <span class="token function">EXIT</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x <span class="token operator">=</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
    <h4>
     <a id="14__239">
     </a>
     1.4 选择自定义难度
    </h4>
    <ul>
     <li>
      为了防止输入错误后的无限循环，这里使用字符串接收输入，再转换成int类型。
     </li>
     <li>
      设定地雷数量是所有格子数量的20%
     </li>
     <li>
      输入错误使用红色文字提示
     </li>
    </ul>
    <pre><code class="prism language-c"><span class="token comment">//自定义难度</span>
<span class="token keyword">int</span> <span class="token function">OptMines</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">,</span> <span class="token keyword">int</span> min<span class="token punctuation">,</span> <span class="token keyword">int</span> max<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> x<span class="token punctuation">;</span>
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>max <span class="token operator">&gt;</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token comment">// max &gt; 30 表示输入的是雷数</span>
    <span class="token punctuation">{<!-- --></span>
        max <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x <span class="token operator">*</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//地雷数量是所有格子数的20%</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"(%d-%d)："</span><span class="token punctuation">,</span> min<span class="token punctuation">,</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">gets_s</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'0'</span><span class="token punctuation">)</span>
            <span class="token function">EXIT</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        x <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> min <span class="token operator">||</span> x <span class="token operator">&gt;</span> max<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0x04</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t\t输入超出范围，请重新输入。\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setColor</span><span class="token punctuation">(</span>DEFCOLOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
            <span class="token keyword">return</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="2__275">
     </a>
     2 游戏界面
    </h3>
    <p>
     <img alt="游戏界面" src="https://i-blog.csdnimg.cn/blog_migrate/b5f7a280206dc9c86bf7aa1e3463367d.png#pic_center"/>
    </p>
    <h4>
     <a id="21__278">
     </a>
     2.1 基本定义
    </h4>
    <h5>
     <a id="211__281">
     </a>
     2.1.1 定义地雷格子结构
    </h5>
    <p>
     结构体
     <strong>
      struct _mine
     </strong>
     中定义一个格子要显示的字符、周围8个方向上地雷数量以及格子本身的状态。
    </p>
    <pre><code class="prism language-c"><span class="token comment">//定义地雷格子状态</span>
<span class="token keyword">enum</span> <span class="token class-name">Mine_STATU</span>
<span class="token punctuation">{<!-- --></span>
    HIDDEN_SAFE<span class="token punctuation">,</span> 
    VISIBLE_SAFE<span class="token punctuation">,</span>
    HIDDEN_MINE
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//地雷格子定义</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_mine</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">char</span> ch<span class="token punctuation">;</span>
    <span class="token keyword">char</span> hasMines<span class="token punctuation">;</span>
    <span class="token keyword">enum</span> <span class="token class-name">Mine_STATU</span> statu<span class="token punctuation">;</span>
<span class="token punctuation">}</span> Mine<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">FLAG</span> <span class="token char">'@'</span>		<span class="token comment">//标记的地雷</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAPNORMAL</span> <span class="token char">'o'</span>	<span class="token comment">//正常格子</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MINEICO</span> <span class="token char">'*'</span>		<span class="token comment">//地雷</span></span>

</code></pre>
    <h5>
     <a id="212__306">
     </a>
     2.1.2 填充地雷格子
    </h5>
    <p>
     使用二维数组
     <strong>
      minefield
     </strong>
     存储每个格子，根据难度选择给二维数组分配内存大小。
    </p>
    <pre><code class="prism language-c">Mine <span class="token operator">*</span><span class="token operator">*</span>minefield <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>    <span class="token comment">//格子数组</span>

<span class="token comment">//生成格子数组，并填充显示字符</span>
Mine <span class="token operator">*</span><span class="token operator">*</span><span class="token function">initMapArr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    Mine <span class="token operator">*</span><span class="token operator">*</span>minefield <span class="token operator">=</span> <span class="token punctuation">(</span>Mine <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span>MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Mine <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>minefield <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"内存分配错误！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">EXIT</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        minefield<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Mine <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span>MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Mine<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>minefield <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"内存分配错误！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">EXIT</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>

            minefield<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>ch <span class="token operator">=</span> <span class="token punctuation">(</span>j <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token char">' '</span> <span class="token operator">:</span> MAPNORMAL<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> minefield<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre>
    <h5>
     <a id="213__339">
     </a>
     2.1.3 产生地雷
    </h5>
    <ul>
     <li>
      使用动态数组
      <strong>
       MinesPos
      </strong>
      保存地雷所在位置
     </li>
     <li>
      用随机数产生地雷
     </li>
     <li>
      检索重复项，有重复的则重新生成地雷。
     </li>
    </ul>
    <pre><code class="prism language-c">Point <span class="token operator">*</span>MinesPos <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>     <span class="token comment">//地雷所在位置</span>
Point <span class="token operator">*</span>FindMinesPos <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">//标记的地雷所在位置</span>
<span class="token keyword">int</span> MineCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>          <span class="token comment">//地雷总数</span>

<span class="token comment">//产生地雷</span>
<span class="token keyword">void</span> <span class="token function">init_Mine</span><span class="token punctuation">(</span>Point <span class="token operator">*</span>point<span class="token punctuation">,</span> <span class="token keyword">int</span> MineCount<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    Point pot<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j<span class="token punctuation">;</span> MineCount <span class="token operator">&gt;</span> i<span class="token punctuation">;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">do</span>
        <span class="token punctuation">{<!-- --></span>
            pot<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>pot<span class="token punctuation">.</span>x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        pot<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>point<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">==</span> pot<span class="token punctuation">.</span>x <span class="token operator">&amp;&amp;</span> point<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">==</span> pot<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> j<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            point<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> pot<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
            point<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> pot<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
            i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="214__374">
     </a>
     2.1.4 将地雷放置到格子中
    </h5>
    <p>
     数组
     <strong>
      MinesPos
     </strong>
     中保存着地雷的坐标，直接在格子中把这些坐标标记为地雷。
    </p>
    <pre><code class="prism language-c"><span class="token comment">//写入雷的位置</span>
<span class="token keyword">void</span> <span class="token function">init_Map</span><span class="token punctuation">(</span>Mine <span class="token operator">*</span><span class="token operator">*</span>minefield<span class="token punctuation">,</span> Point <span class="token operator">*</span>point<span class="token punctuation">,</span> <span class="token keyword">int</span> MineCount<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MineCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        minefield<span class="token punctuation">[</span>point<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>point<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>statu <span class="token operator">=</span> HIDDEN_MINE<span class="token punctuation">;</span>
        minefield<span class="token punctuation">[</span>point<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>point<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>hasMines <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="215__387">
     </a>
     2.1.5 计算周围地雷数量
    </h5>
    <ul>
     <li>
      按行列扫描所有格子
     </li>
     <li>
      对一个格子的周围8个位置的地雷数量进行统计
     </li>
     <li>
      将统计数量保存到格子的
      <strong>
       hasMines
      </strong>
      属性中
     </li>
    </ul>
    <pre><code class="prism language-c"><span class="token comment">//计算周围地雷数量</span>
<span class="token keyword">void</span> <span class="token function">calMine</span><span class="token punctuation">(</span>Mine <span class="token operator">*</span><span class="token operator">*</span>minefield<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> count<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x<span class="token punctuation">;</span> j <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>minefield<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>statu <span class="token operator">==</span> HIDDEN_MINE<span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>

            count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> minefield<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>statu <span class="token operator">==</span> HIDDEN_MINE<span class="token punctuation">)</span> <span class="token comment">//左上角</span>
                count<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> minefield<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>statu <span class="token operator">==</span> HIDDEN_MINE<span class="token punctuation">)</span> <span class="token comment">//上面</span>
                count<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> minefield<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>statu <span class="token operator">==</span> HIDDEN_MINE<span class="token punctuation">)</span> <span class="token comment">//右上角</span>
                count<span class="token operator">++</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> minefield<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>statu <span class="token operator">==</span> HIDDEN_MINE<span class="token punctuation">)</span> <span class="token comment">//右面</span>
                count<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> minefield<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>statu <span class="token operator">==</span> HIDDEN_MINE<span class="token punctuation">)</span> <span class="token comment">//右下角</span>
                count<span class="token operator">++</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> minefield<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>statu <span class="token operator">==</span> HIDDEN_MINE<span class="token punctuation">)</span> <span class="token comment">//下面</span>
                count<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> minefield<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>statu <span class="token operator">==</span> HIDDEN_MINE<span class="token punctuation">)</span> <span class="token comment">//左下角</span>
                count<span class="token operator">++</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> minefield<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>statu <span class="token operator">==</span> HIDDEN_MINE<span class="token punctuation">)</span> <span class="token comment">//左面</span>
                count<span class="token operator">++</span><span class="token punctuation">;</span>
                
            minefield<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>hasMines <span class="token operator">=</span> count<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="216__429">
     </a>
     2.1.6 其他变量
    </h5>
    <p>
    </p>
    <pre><code class="prism language-c">Point StatuRow<span class="token punctuation">;</span>             <span class="token comment">//状态显示行位置</span>
<span class="token class-name">clock_t</span> <span class="token class-name">start_t</span><span class="token punctuation">,</span> <span class="token class-name">end_t</span><span class="token punctuation">;</span>     <span class="token comment">//记录游戏时间</span>
<span class="token comment">//格子范围，限定地雷显示和操作的范围</span>
<span class="token keyword">int</span> top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> right <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> bottom <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="22__438">
     </a>
     2.2 显示游戏介绍
    </h4>
    <p>
     显示游戏介绍，并返回显示的行数。
    </p>
    <pre><code class="prism language-c"><span class="token comment">// 输出游戏介绍</span>
<span class="token keyword">int</span> <span class="token function">intro</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> line <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">//加上之前的标题信息2行</span>
    line <span class="token operator">+=</span> <span class="token number">7</span><span class="token punctuation">;</span>
    StatuRow<span class="token punctuation">.</span>y <span class="token operator">=</span> line <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>
    StatuRow<span class="token punctuation">.</span>x <span class="token operator">=</span> left<span class="token punctuation">;</span>

    <span class="token function">PrintName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示标题信息</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t\t游戏方法介绍：\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0xE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t\t  W、S、A、D/↑、↓、←、→"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span>DEFCOLOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"：控制光标上下左右移动\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0xE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t\t  PageUP、PageDown、Home、End"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span>DEFCOLOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"：控制光标跳到四边位置\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0xE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t\t  空格"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span>DEFCOLOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"：打开当前格子"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0xE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  R"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span>DEFCOLOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"：回到选择界面"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0xE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  ESC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span>DEFCOLOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"：结束游戏\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">ShowStatu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> line<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="23__484">
     </a>
     2.3 显示游戏状态
    </h4>
    <p>
     显示游戏信息和游戏时间，光标移动到要输出的位置，输出内容覆盖就内容，完成状态刷新。
     <br/>
     在输出状态的时候要移动光标，游戏过程中会看到光标跳到状态显示位置后有会跳回格子中，为避免这种情况，在开始输出状态时使用
     <strong>
      SetCursorType
     </strong>
     隐藏光标，输出完毕后再显示光标
    </p>
    <pre><code class="prism language-c"><span class="token comment">//显示游戏状态</span>
<span class="token keyword">void</span> <span class="token function">ShowStatu</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">total_t</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">end_t</span> <span class="token operator">=</span> <span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">total_t</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">end_t</span> <span class="token operator">-</span> <span class="token class-name">start_t</span><span class="token punctuation">)</span> <span class="token operator">/</span> CLOCKS_PER_SEC<span class="token punctuation">;</span>
    <span class="token function">SetCursorType</span><span class="token punctuation">(</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">MoveCursorTo</span><span class="token punctuation">(</span>StatuRow<span class="token punctuation">.</span>x<span class="token punctuation">,</span> StatuRow<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t\t共有雷数：%-3d  剩余雷数：%-3d  用时：%ds   "</span><span class="token punctuation">,</span> MapSize<span class="token punctuation">.</span>Mine_Count<span class="token punctuation">,</span> MineCount<span class="token punctuation">,</span> <span class="token class-name">total_t</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">SetCursorType</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="24__500">
     </a>
     2.4 显示地雷格子
    </h4>
    <ul>
     <li>
      根据上面显示的信息行数得到地图格子要显示的起始行
     </li>
     <li>
      根据上面
      <strong>
       基本定义
      </strong>
      的宽度
      <strong>
       CONSOLEWIDTH
      </strong>
      计算居中显示的起始列
     </li>
     <li>
      每一行光标移动到左边起始列后输出行
     </li>
    </ul>
    <pre><code class="prism language-c">
<span class="token comment">//确定绘制地雷格子范围</span>
<span class="token keyword">void</span> <span class="token function">DrawMine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    left <span class="token operator">=</span> right <span class="token operator">=</span> bottom <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    top <span class="token operator">=</span> <span class="token function">intro</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">drawMap</span><span class="token punctuation">(</span>minefield<span class="token punctuation">)</span><span class="token punctuation">;</span>

    right <span class="token operator">=</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x <span class="token operator">+</span> left<span class="token punctuation">;</span>
    bottom <span class="token operator">+=</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y <span class="token operator">+</span> top <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">MoveCursorTo</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">start_t</span> <span class="token operator">=</span> <span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//开始计时</span>
<span class="token punctuation">}</span>

<span class="token comment">//绘制地雷格子和外框，设置各边范围</span>
<span class="token keyword">void</span> <span class="token function">drawMap</span><span class="token punctuation">(</span>Mine <span class="token operator">*</span><span class="token operator">*</span>minefield<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token punctuation">(</span>CONSOLEWIDTH <span class="token operator">-</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>l <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        l<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> t <span class="token operator">=</span> top<span class="token punctuation">;</span>
    <span class="token function">MoveCursorTo</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> t<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"┌"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"─"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"┐\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">MoveCursorTo</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> t<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 输出中间部分</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"│ "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span> minefield<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"│\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">MoveCursorTo</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> t<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"└"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"─"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"┘\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    top <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    left <span class="token operator">=</span> l <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     至此地雷界面绘制基本完成，下面来看看操作部分。
     <br/>
    </p>
    <h2>
     <a id="_559">
     </a>
     三、游戏操作
    </h2>
    <p>
    </p>
    <h3>
     <a id="1__561">
     </a>
     1 游戏按键输入
    </h3>
    <h4>
     <a id="11__563">
     </a>
     1.1 定义按键
    </h4>
    <p>
     定义出后面要用到达按键变量
    </p>
    <pre><code class="prism language-c"><span class="token comment">//按键定义</span>
<span class="token keyword">enum</span> <span class="token class-name">KB_KEY</span>
<span class="token punctuation">{<!-- --></span>
    Key_FN <span class="token operator">=</span> <span class="token number">0xE0</span><span class="token punctuation">,</span>       <span class="token comment">// 功能键标志</span>
    Key_Up <span class="token operator">=</span> <span class="token number">0x48</span><span class="token punctuation">,</span>       <span class="token comment">// 向上方向键 　　</span>
    Key_Down <span class="token operator">=</span> <span class="token number">0x50</span><span class="token punctuation">,</span>     <span class="token comment">// 向下方向键</span>
    Key_Left <span class="token operator">=</span> <span class="token number">0x4b</span><span class="token punctuation">,</span>     <span class="token comment">// 向左方向键</span>
    Key_Right <span class="token operator">=</span> <span class="token number">0x4d</span><span class="token punctuation">,</span>    <span class="token comment">// 向右方向键</span>
    Key_Home <span class="token operator">=</span> <span class="token number">0x47</span><span class="token punctuation">,</span>     <span class="token comment">// Home键</span>
    Key_End <span class="token operator">=</span> <span class="token number">0x4f</span><span class="token punctuation">,</span>      <span class="token comment">// End键</span>
    Key_PageUp <span class="token operator">=</span> <span class="token number">0x49</span><span class="token punctuation">,</span>   <span class="token comment">// PageUp键</span>
    Key_PageDown <span class="token operator">=</span> <span class="token number">0x51</span><span class="token punctuation">,</span> <span class="token comment">// PageDown键</span>
    Key_ESC <span class="token operator">=</span> <span class="token number">0x1B</span><span class="token punctuation">,</span>      <span class="token comment">// ESC键</span>
    Key_ENTER <span class="token operator">=</span> <span class="token number">0xD</span><span class="token punctuation">,</span>     <span class="token comment">// 回车键</span>
    Key_SPACE <span class="token operator">=</span> <span class="token number">0x20</span><span class="token punctuation">,</span>    <span class="token comment">// 空格键</span>
    Key_A <span class="token operator">=</span> <span class="token char">'A'</span><span class="token punctuation">,</span>
    Key_a <span class="token operator">=</span> <span class="token char">'a'</span><span class="token punctuation">,</span>
    Key_D <span class="token operator">=</span> <span class="token char">'D'</span><span class="token punctuation">,</span>
    Key_d <span class="token operator">=</span> <span class="token char">'d'</span><span class="token punctuation">,</span>
    Key_W <span class="token operator">=</span> <span class="token char">'W'</span><span class="token punctuation">,</span>
    Key_w <span class="token operator">=</span> <span class="token char">'w'</span><span class="token punctuation">,</span>
    Key_S <span class="token operator">=</span> <span class="token char">'S'</span><span class="token punctuation">,</span>
    Key_s <span class="token operator">=</span> <span class="token char">'s'</span><span class="token punctuation">,</span>
    Key_R <span class="token operator">=</span> <span class="token char">'R'</span><span class="token punctuation">,</span>
    Key_r <span class="token operator">=</span> <span class="token char">'r'</span>
<span class="token punctuation">}</span> KEY<span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="12__594">
     </a>
     1.2 读取按键输入
    </h4>
    <ul>
     <li>
      需要注意的是方向键的输入，方向键是先输入0xE0或0，再输入对应的键值，因此输入方向键的输入需要读取2次才能确定。
     </li>
     <li>
      使用
      <strong>
       row
      </strong>
      和
      <strong>
       col
      </strong>
      记录当前光标位置，列使用奇数位，因此列的移动要±2。
     </li>
     <li>
      检测移动后光标会不会超出现实范围，如果有超出情况则取消移动。
     </li>
     <li>
      <strong>
       回车
      </strong>
      标记地雷
     </li>
     <li>
      <strong>
       空格
      </strong>
      点开地雷格子
     </li>
     <li>
      <strong>
       R
      </strong>
      结束游戏回到选择界面
     </li>
     <li>
      <strong>
       ESC
      </strong>
      退出游戏
     </li>
    </ul>
    <pre><code class="prism language-c"><span class="token keyword">int</span> row <span class="token operator">=</span> top<span class="token punctuation">;</span> <span class="token comment">//行</span>
<span class="token keyword">int</span> col <span class="token operator">=</span> left<span class="token punctuation">;</span> <span class="token comment">//列</span>

<span class="token keyword">char</span> ch<span class="token punctuation">;</span>
<span class="token keyword">int</span> chInput <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> isGame <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//游戏继续标志</span>
<span class="token keyword">int</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>isGame<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_kbhit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//当_kbhit返回值不为0的时候，代表用户有按键按下。</span>
	<span class="token punctuation">{<!-- --></span>
		chInput <span class="token operator">=</span> <span class="token function">_getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>chInput <span class="token operator">==</span> Key_FN <span class="token operator">||</span> chInput <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 方向键读2次</span>
			chInput <span class="token operator">=</span> <span class="token function">_getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">switch</span> <span class="token punctuation">(</span>chInput<span class="token punctuation">)</span> <span class="token comment">//控制操作</span>
		<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">case</span> <span class="token char">'a'</span><span class="token operator">:</span>
		<span class="token keyword">case</span> <span class="token char">'A'</span><span class="token operator">:</span>
		<span class="token keyword">case</span> Key_Left<span class="token operator">:</span>
			col <span class="token operator">-=</span> <span class="token number">2</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>col <span class="token operator">&lt;=</span> left<span class="token punctuation">)</span>
				col <span class="token operator">=</span> left<span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token char">'d'</span><span class="token operator">:</span>
		<span class="token keyword">case</span> <span class="token char">'D'</span><span class="token operator">:</span>
		<span class="token keyword">case</span> Key_Right<span class="token operator">:</span>
			col <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>col <span class="token operator">&gt;=</span> right<span class="token punctuation">)</span>
				col <span class="token operator">=</span> right <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token char">'w'</span><span class="token operator">:</span>
		<span class="token keyword">case</span> <span class="token char">'W'</span><span class="token operator">:</span>
		<span class="token keyword">case</span> Key_Up<span class="token operator">:</span>
			row<span class="token operator">--</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>row <span class="token operator">&lt;=</span> top<span class="token punctuation">)</span>
				row <span class="token operator">=</span> top<span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token char">'s'</span><span class="token operator">:</span>
		<span class="token keyword">case</span> <span class="token char">'S'</span><span class="token operator">:</span>
		<span class="token keyword">case</span> Key_Down<span class="token operator">:</span>
			row<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>row <span class="token operator">&gt;=</span> bottom<span class="token punctuation">)</span>
				row <span class="token operator">=</span> bottom<span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> Key_SPACE<span class="token operator">:</span> <span class="token comment">//空格点开</span>
			<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> Key_ENTER<span class="token operator">:</span> <span class="token comment">//标记地雷</span>
			<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> Key_Home<span class="token operator">:</span> <span class="token comment">//跳到第一列</span>
			col <span class="token operator">=</span> left<span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> Key_End<span class="token operator">:</span> <span class="token comment">//跳到最后一列</span>
			col <span class="token operator">=</span> right <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> Key_PageUp<span class="token operator">:</span> <span class="token comment">//跳到第一行</span>
			row <span class="token operator">=</span> top<span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> Key_PageDown<span class="token operator">:</span> <span class="token comment">//跳到最后一行</span>
			row <span class="token operator">=</span> bottom<span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> Key_ESC<span class="token operator">:</span> <span class="token comment">//退出游戏</span>
			isGame <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> Key_R<span class="token operator">:</span>
		<span class="token keyword">case</span> Key_r<span class="token operator">:</span> <span class="token comment">//复位到选择界面</span>
			<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">DrawMine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span> <span class="token comment">//其他输入字符不动作</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token function">MoveCursorTo</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> row<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ShowStatu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">MoveCursorTo</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> row<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="2__687">
     </a>
     2 标记地雷
    </h3>
    <ul>
     <li>
      按
      <strong>
       回车
      </strong>
      标记地雷。
     </li>
     <li>
      读取光标处的字符，光标处是未点开格子则标记地雷。
     </li>
     <li>
      标记的地雷坐标保存到
      <strong>
       FindMinesPos
      </strong>
      数组中。
     </li>
     <li>
      如果该位置已标记则取消标记，同时从
      <strong>
       FindMinesPos
      </strong>
      数组中删除。
     </li>
     <li>
      标记后判断所有的地雷是否都已标记，如果都已标记则判赢
     </li>
     <li>
      标记后光标右移到下一个地雷格子
     </li>
    </ul>
    <pre><code class="prism language-c"><span class="token keyword">case</span> Key_ENTER<span class="token operator">:</span> <span class="token comment">//标记地雷</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">flagMine</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">GameOver</span><span class="token punctuation">(</span>WIN_GAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
	col <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>col <span class="token operator">&gt;=</span> right<span class="token punctuation">)</span>
		col <span class="token operator">=</span> right <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">break</span><span class="token punctuation">;</span>
</code></pre>
    <pre><code class="prism language-c"><span class="token comment">//标记地雷</span>
BOOL <span class="token function">flagMine</span><span class="token punctuation">(</span><span class="token keyword">int</span> row<span class="token punctuation">,</span> <span class="token keyword">int</span> col<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">char</span> ch<span class="token punctuation">;</span>
    BOOL iswin <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
    ch <span class="token operator">=</span> <span class="token function">GetCursorStr</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> row<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取光标处字符</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">==</span> FLAG <span class="token operator">&amp;&amp;</span> MineCount <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>Mine_Count<span class="token punctuation">)</span> <span class="token comment">//切换已标记</span>
    <span class="token punctuation">{<!-- --></span>
        FindMinesPos<span class="token punctuation">[</span>MineCount<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> FindMinesPos<span class="token punctuation">[</span>MineCount<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token function">setColor</span><span class="token punctuation">(</span>DEFCOLOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span>MAPNORMAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        MineCount<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">==</span> MAPNORMAL <span class="token operator">&amp;&amp;</span> MineCount <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        MineCount<span class="token operator">--</span><span class="token punctuation">;</span>
        FindMinesPos<span class="token punctuation">[</span>MineCount<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> col <span class="token operator">-</span> left<span class="token punctuation">;</span>
        FindMinesPos<span class="token punctuation">[</span>MineCount<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> row <span class="token operator">-</span> top<span class="token punctuation">;</span>

        <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0xC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span>FLAG<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>MineCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">int</span> i<span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>Mine_Count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">// 确定是否标记了所有的雷</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">findMine4Pos</span><span class="token punctuation">(</span>FindMinesPos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> FindMinesPos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">==</span> FALSE<span class="token punctuation">)</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            iswin <span class="token operator">=</span> i <span class="token operator">==</span> MapSize<span class="token punctuation">.</span>Mine_Count<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">setColor</span><span class="token punctuation">(</span>DEFCOLOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ShowStatu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//更新标记的雷数</span>
    <span class="token function">MoveCursorTo</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> row<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> iswin<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="3__746">
     </a>
     3 点开地雷操作
    </h3>
    <h4>
     <a id="31__747">
     </a>
     3.1 点开地雷格子
    </h4>
    <ul>
     <li>
      按
      <strong>
       空格
      </strong>
      点开地雷格子
     </li>
     <li>
      读取光标位置字符，如果是已标记地雷则结束点开操作。
     </li>
     <li>
      如果点开的位置是地雷，游戏结束，显示游戏结束画面
     </li>
     <li>
      点开位置安全，则自动点开相连的安全区域。
     </li>
     <li>
      自动点开后判断是否一点开所有安全区，判断胜负。
     </li>
     <li>
      点开后光标右移到下一个地雷格子
     </li>
    </ul>
    <pre><code class="prism language-c"><span class="token keyword">case</span> Key_SPACE<span class="token operator">:</span> <span class="token comment">//空格点开</span>
	x <span class="token operator">=</span> col <span class="token operator">-</span> left<span class="token punctuation">;</span>
	y <span class="token operator">=</span> row <span class="token operator">-</span> top<span class="token punctuation">;</span>
	ch <span class="token operator">=</span> <span class="token function">GetCursorStr</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> row<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">==</span> FLAG<span class="token punctuation">)</span> <span class="token comment">//忽略点开已标记地雷</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>minefield<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>statu <span class="token operator">==</span> HIDDEN_MINE<span class="token punctuation">)</span> <span class="token comment">//点开雷，游戏结束</span>
	<span class="token punctuation">{<!-- --></span>
		isGame <span class="token operator">=</span> <span class="token function">GameOver</span><span class="token punctuation">(</span>LOSS_GAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
		row <span class="token operator">=</span> top<span class="token punctuation">;</span>
		col <span class="token operator">=</span> left<span class="token punctuation">;</span>
		<span class="token keyword">continue</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token comment">//自动点开连续的安全区</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">SetCursorType</span><span class="token punctuation">(</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">OpenMine</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">SetCursorType</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isWin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			isGame <span class="token operator">=</span> <span class="token function">GameOver</span><span class="token punctuation">(</span>WIN_GAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
			row <span class="token operator">=</span> top<span class="token punctuation">;</span>
			col <span class="token operator">=</span> left<span class="token punctuation">;</span>
			<span class="token keyword">continue</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	col <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>col <span class="token operator">&gt;=</span> right<span class="token punctuation">)</span>
		col <span class="token operator">=</span> right <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">break</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="32__790">
     </a>
     3.2 自动展开安全区域
    </h4>
    <ul>
     <li>
      递归对当前格子周围的安全区域进行展开操作
     </li>
     <li>
      递归到边界或已点开区域终止
     </li>
     <li>
      点开时使用不用的颜色显示格子周围地雷数。
     </li>
     <li>
      格子周围地雷数为0的显示为
      <strong>
       空格’ ’
      </strong>
     </li>
    </ul>
    <pre><code class="prism language-c"><span class="token comment">//自动打开安全区</span>
<span class="token keyword">void</span> <span class="token function">OpenMine</span><span class="token punctuation">(</span><span class="token keyword">int</span> row<span class="token punctuation">,</span> <span class="token keyword">int</span> col<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    x <span class="token operator">=</span> col <span class="token operator">+</span> left<span class="token punctuation">;</span>
    <span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    y <span class="token operator">=</span> row <span class="token operator">+</span> top<span class="token punctuation">;</span>
    <span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>row <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> row <span class="token operator">&gt;=</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>col <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> col <span class="token operator">&gt;=</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>minefield<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>statu <span class="token operator">==</span> VISIBLE_SAFE<span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>minefield<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>hasMines <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        ch <span class="token operator">=</span> <span class="token char">' '</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>minefield<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>hasMines <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        ch <span class="token operator">=</span> minefield<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>hasMines <span class="token operator">+</span> <span class="token char">'0'</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>minefield<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>hasMines <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">MoveCursorTo</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> n <span class="token operator">=</span> minefield<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>hasMines<span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>n<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
            <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0x9</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//淡蓝色</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
            <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0x2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//绿色</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
            <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0xC</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//淡红色</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
            <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0x1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//蓝色</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span>
            <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0x4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//红色</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span>
            <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0xD</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//淡紫色</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span>
            <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0x5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//紫色</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span>
            <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0x6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//黄色</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setColor</span><span class="token punctuation">(</span>DEFCOLOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
        minefield<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>ch <span class="token operator">=</span> ch<span class="token punctuation">;</span>
        minefield<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>statu <span class="token operator">=</span> VISIBLE_SAFE<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">!=</span> <span class="token char">' '</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>row <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token function">OpenMine</span><span class="token punctuation">(</span>row <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>col <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
        <span class="token function">OpenMine</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> col <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>row <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
        <span class="token function">OpenMine</span><span class="token punctuation">(</span>row <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>col <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> col <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token function">OpenMine</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> col <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="_870">
     </a>
     四、游戏胜负
    </h2>
    <h3>
     <a id="1__871">
     </a>
     1 胜负判定
    </h3>
    <ul>
     <li>
      游戏过程中如果点开了地雷，则直接判负。
     </li>
     <li>
      比对所有未点开的地雷格子和地雷数组的坐标，如果刚好符合则判赢。
     </li>
    </ul>
    <pre><code class="prism language-c"><span class="token comment">//检查标记地雷是否都正确</span>
BOOL <span class="token function">isWin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    BOOL iswin <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
    <span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>minefield<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>ch <span class="token operator">==</span> MAPNORMAL<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">findMine4Pos</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">==</span> FALSE<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    i <span class="token operator">=</span> MapSize<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                cnt<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    iswin <span class="token operator">=</span> cnt <span class="token operator">==</span> MapSize<span class="token punctuation">.</span>Mine_Count<span class="token punctuation">;</span>

    <span class="token keyword">return</span> iswin<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="2__902">
     </a>
     2 胜负界面
    </h3>
    <ul>
     <li>
      外部函数判断胜负后传递胜负结果变量给
      <strong>
       GameOver
      </strong>
      函数。
     </li>
     <li>
      根据参数使用不同颜色显示不同提示。
     </li>
     <li>
      光标定位到地雷格子往下2行位置输出胜负信息。
     </li>
     <li>
      根据提示返回是否继续游戏
     </li>
    </ul>
    <pre><code class="prism language-c"><span class="token comment">//胜负结果变量</span>
<span class="token keyword">enum</span> <span class="token class-name">GAME_RESULT</span>
<span class="token punctuation">{<!-- --></span>
    WIN_GAME<span class="token punctuation">,</span>
    LOSS_GAME
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//游戏结束画面</span>
BOOL <span class="token function">GameOver</span><span class="token punctuation">(</span><span class="token keyword">enum</span> <span class="token class-name">GAME_RESULT</span> statu<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">MoveCursorTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> bottom <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>statu <span class="token operator">==</span> WIN_GAME<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// system("color 2F");//改变背景为绿色</span>
        <span class="token function">showMine</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0x02</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t    恭喜，你找出了所有的地雷！\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>statu <span class="token operator">==</span> LOSS_GAME<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// system("color 4F"); //改变背景为红色</span>
        <span class="token function">showMine</span><span class="token punctuation">(</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0x04</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t    哦吼，踩到雷了！\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span>DEFCOLOR<span class="token punctuation">)</span><span class="token punctuation">;</span>

    BOOL rst <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
    <span class="token keyword">char</span> ch<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\t  是否重新开始游戏(Y/N): "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fflush</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">do</span>
    <span class="token punctuation">{<!-- --></span>
        ch <span class="token operator">=</span> <span class="token function">_getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">==</span> <span class="token char">'Y'</span> <span class="token operator">||</span> ch <span class="token operator">==</span> <span class="token char">'y'</span> <span class="token operator">||</span> ch <span class="token operator">==</span> Key_ENTER<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">DrawMine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            rst <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">==</span> <span class="token char">'N'</span> <span class="token operator">||</span> ch <span class="token operator">==</span> <span class="token char">'n'</span> <span class="token operator">||</span> ch <span class="token operator">==</span> Key_ESC<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            rst <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> rst<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     胜利界面
     <br/>
     <img alt="胜利界面" src="https://i-blog.csdnimg.cn/blog_migrate/65f4cfd27708453e2c5390234c817d26.png#pic_center"/>
    </p>
    <p>
     <br/>
     失败界面
     <br/>
     <img alt="失败界面" src="https://i-blog.csdnimg.cn/blog_migrate/15e11e2deda1f3dd71de308a01dfb48f.png#pic_center"/>
    </p>
    <hr/>
    <h2>
     <a id="_972">
     </a>
     五、总结
    </h2>
    <p>
     没有总结
     <br/>
    </p>
    <p>
     完整代码已上传到GitCode，需要的移步
     <a href="https://gitcode.net/apull/Mines_Console" rel="nofollow">
      https://gitcode.net/apull/Mines_Console
     </a>
     <br/>
     <br/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="687474:70733a2f2f626c6f672e6373646e2e6e65742f6170756c6c2f:61727469636c652f64657461696c732f313237373139393837" class_="artid" style="display:none">
 </p>
</div>


