---
layout: post
title: "智能一代云平台二十一生产环境Nginx报-502-Bad-Gateway-问题复现及解决方案"
date: 2024-12-28 18:29:29 +0800
description: "【前言】 系统最近出现了一个问题，经过相应的排查解决了；在此记录一下解决的整个过程，如果大家遇到类似"
keywords: "用了小皮启动项目,nginx 502 bad gateway"
categories: ['智能一代云平台', '●项目实战']
tags: ['Nginx', 'Badgateway', '502']
artid: "70992263"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=70992263
    alt: "智能一代云平台二十一生产环境Nginx报-502-Bad-Gateway-问题复现及解决方案"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     智能一代云平台（二十一）:生产环境Nginx报 502 Bad Gateway 问题复现及解决方案
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     强烈推荐一个大神的人工智能的教程：
     <a href="http://www.captainbed.net/zhanghan" rel="nofollow">
      http://www.captainbed.net/zhanghan
     </a>
    </p>
    <h2>
     【前言】
    </h2>
    <p>
     系统最近出现了一个问题，经过相应的排查解决了；在此记录一下解决的整个过程，如果大家遇到类似问题以供参考，另外由于经验有限，如果小编有没有考虑到地方，欢迎在评论中留言。
    </p>
    <h2>
     【问题—复现—原因—解决】
    </h2>
    <p>
     <strong>
      一、问题
     </strong>
    </p>
    <p>
     我们项目线上环境是部署在阿里云上，相关的部署情况是之前博文《
     <a href="http://blog.csdn.net/zhanghan18333611647/article/details/61614270">
      高校云平台（十五）:Keepalived+Nginx实现高可用，反向代理---Nginx安装及配置
     </a>
     》中的效果图，大家有兴趣可以参考一下；
    </p>
    <p>
     上线后发现一个蹊跷的问题，线上偶尔会报502 Bad Gateway（如下图）；频率大概每天会出现三到五次，每次持续五分钟左右。
    </p>
    <p>
     <img alt="" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/e73cbb912a27e428916a12020c05bc89.png"/>
    </p>
    <p>
     <strong>
      二、复现
     </strong>
    </p>
    <p>
    </p>
    <p>
     1、排查过程中只能等出现这个问题并没有将问题复现出来，为了复现问题，自己写了相关流程，让相关人员辅助确定问题；结果是并没有复现问题。
    </p>
    <p>
     （1）前提:当访问环境出现502时进行如下测试步骤
    </p>
    <p>
     （2）访问部署在nginx另外测试环境，可能出现三种情况：
    </p>
    <p>
     ①同样显示 502页面
    </p>
    <p>
     ②显示系统备案（在Nginx中做出现502错误导向图）
    </p>
    <p>
     <img alt="" class="has" height="162" src="https://i-blog.csdnimg.cn/blog_migrate/712f2bc6be6447fc558759a16919bd88.png" width="732"/>
    </p>
    <p>
     ③显示正常页面（自己做的测试页面）
    </p>
    <p>
     <img alt="" class="has" height="197" src="https://i-blog.csdnimg.cn/blog_migrate/45a077334ac1bbf7dbd81afe17a9de43.png" width="694"/>
    </p>
    <p>
     （3）在浏览器中输入环境所对应的IP地址访问，查看出现情况：
    </p>
    <p>
     ①出现502错误界面
    </p>
    <p>
     ②能正常访问到系统登录界面
    </p>
    <p>
     （4）在浏览器中直接访问公司机房映射到外网的IP进行访问，查看出现情况：
    </p>
    <p>
     ①出现502错误界面
     <br/>
     ②正常访问到系统登录界面
    </p>
    <p>
     （5）出现其他情况
    </p>
    <p>
     2、询问阿里云客服，没有确定问题
    </p>
    <p>
     我们线上环境是使用的阿里云的服务器，于是和阿里云方面进行沟通，进行了相关排除，排除方面是参考阿里云的社区文章---
     <a href="https://help.aliyun.com/knowledge_detail/39481.html" rel="nofollow">
      负载均衡返回 HTTP 500/502/504 错误的处理
     </a>
     并没有确定问题；
    </p>
    <p>
     3、复现问题：
    </p>
    <p>
     在我们录制系统视频的时候，终于将这个问题再次复现出来---当点击某个功能时系统出现502，经过尝试已经确定这个事件可以使场景复现。
    </p>
    <p>
     <strong>
      三、原因
     </strong>
    </p>
    <p>
     复现问题后，迅速进行了问题出现的原因，查看阿里云Nginx的错误日志，根据时间找到了问题的根源，中文乱码，如下图：
    </p>
    <p>
     <img alt="" class="has" height="263" src="https://i-blog.csdnimg.cn/blog_migrate/5d6eb2ae6dac877cfefdb85d2f039174.png" width="780"/>
    </p>
    <p>
     <strong>
      四、解决
     </strong>
    </p>
    <p>
     1、解决：
    </p>
    <p>
     确定中文问题后，核实相关代码及服务器的配置，发现导致中文转码失败的是web容器的配置文件中忘记加转码注释导致的。web容器配置文件加转码注释截图如下：
    </p>
    <p>
     <img alt="" class="has" height="76" src="https://i-blog.csdnimg.cn/blog_migrate/72f00e29f52255ae870813d3be525a12.png" width="633">
     </img>
    </p>
    <p>
     2、测试：
    </p>
    <p>
     重新再次点触发502的功能，发现这次正常了。
    </p>
    <p>
     3、关于转码问题：
    </p>
    <p>
     （1）正确配置情况：
    </p>
    <p>
     ①代码中进行转码配置，web容器中没有进行转码配置；代码中转码配置如下：
    </p>
    <p>
     <img alt="" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/22d7ac3c1af9d5b5530bc1abc9731fe0.png"/>
    </p>
    <p>
     ②web容器中进行转码配置，代码中没有进行转码位置；
    </p>
    <p>
     （2）错误配置情况：
    </p>
    <p>
     ①代码中和web容器中都没有进行转码配置；
    </p>
    <p>
     ②代码中和web容器中都进行转码配置。
    </p>
    <h2>
     【总结】
    </h2>
    <p>
    </p>
    <p>
     1、出现问题后要从错误日志文件着手快速定位问题；
    </p>
    <p>
     2、现在已经确定导致502出现一个原因，并不能保证没有其他的原因，以后可能还会出现502到时候再排查。
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f75303132383239313234:2f61727469636c652f64657461696c732f3730393932323633" class_="artid" style="display:none">
 </p>
</div>


