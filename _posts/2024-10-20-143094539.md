---
layout: post
title: "前端如何下载后端传输的文件"
date: 2024-10-20 17:16:11 +0800
description: "接收文件的blob -> 通过fileReader -> 转成base64URL -> 给到对应的预"
keywords: "后端传给前端下载连接,前端怎么下载"
categories: ['前端学习笔记']
tags: ['前端']
artid: "143094539"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=143094539
    alt: "前端如何下载后端传输的文件"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     前端如何下载后端传输的文件
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     视频：
     <a href="https://www.bilibili.com/video/BV1Ua4y1M7Xj" rel="nofollow">
      bilibili
     </a>
     <br/>
     方式：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/79b7bbc0448e4e98a6d3eae40458040e.png"/>
    </p>
    <ol>
     <li>
      window.open
      <br/>
      缺点：①无法给文件命名，②请求没有通过项目去发，而是直接打开了一个窗口，相当于是通过浏览器去请求的，没有token，无法验证请求是否合法
     </li>
    </ol>
    <pre><code class="prism language-javascript"><span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8000/download"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <ol start="2">
     <li>
      a标签
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/fcf31ed68d2047c38dbc9be777a188c0.png">
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f9b1a17c385a4c77b313fdf9dd2de4d5.png"/>
      </img>
     </li>
    </ol>
    <pre><code class="prism language-javascript"><span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//1,按blob请求接口(用 blob 接收后端传过来的二进制文件，将二进制字符串转为文件流)</span>
	axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8000/download"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> responseTypе<span class="token operator">:</span> <span class="token string">"blob"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>msSaveBlob<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// IE -兼容IE 第三个参数为文件名</span>
			window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span><span class="token function">msSaveBlob</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
			<span class="token punctuation">{<!-- --></span> type<span class="token operator">:</span> <span class="token string">"application/vnd.openxmlformats-officedocument.presentationml.presentation"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">"test.ppt"</span>
			<span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">//2,创建blob的本地url</span>
			<span class="token keyword">let</span> blobURL <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createobjectURL</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blobURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//3,创建标签</span>
			<span class="token keyword">let</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"а"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//4,设置href</span>
			link<span class="token punctuation">.</span>href <span class="token operator">=</span> blobURL
			<span class="token comment">//5,设置download（告诉a标签其行为是下载）</span>
			link<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token string">"test2.ppt"</span>
			link<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"none"</span><span class="token punctuation">;</span>
			link<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>blobURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     console.log(res.data); 的结果：
     <br/>
     没有指定 { responseTypе: “blob” }之前
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9ce090e6c2be4598816b3622a848d1df.png">
      <br/>
      指定之后：
     </img>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a586128e2a4b46989c1d4b6a1f8ea69b.png"/>
    </p>
    <ol start="3">
     <li>
      file-saver
     </li>
    </ol>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> saveAs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"file-saver"</span>

<span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//1,按blob请求接口(用 blob 接收后端传过来的二进制文件，将二进制字符串转为文件流)</span>
	axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8000/download"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> responseTypе<span class="token operator">:</span> <span class="token string">"blob"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">saveAs</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token string">"fileSaveDownload.ppt"</span><span class="token punctuation">)</span><span class="token operator">:</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     预览：
     <br/>
     图片，excel ， word -&gt; 给一个地址url就行了
     <br/>
     url -&gt; 线上地址 or base64URL
     <br/>
     base64URL:
     <br/>
     接收文件的blob -&gt; 通过fileReader -&gt; 转成base64URL -&gt; 给到对应的预览处
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f37333038373236302f:61727469636c652f64657461696c732f313433303934353339" class_="artid" style="display:none">
 </p>
</div>


