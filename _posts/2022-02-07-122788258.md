---
layout: post
title: "python处理-TIFF-格式数据"
date: 2022-02-07 16:35:36 +0800
description: "Python读取 tiff 格式数据前言一、读取TIFF文件二、使用步骤1.引入库2.读入数据总结前"
keywords: "python tiff"
categories: ['遥感数据Python编程']
tags: ['开发语言', 'Python']
artid: "122788258"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=122788258
    alt: "python处理-TIFF-格式数据"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     python处理 TIFF 格式数据
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      Python处理 TIFF 格式数据
     </h4>
     <ul>
      <li>
       <a href="#_8" rel="nofollow">
        简介
       </a>
      </li>
      <li>
       <a href="#TIFF_15" rel="nofollow">
        一、读取TIFF文件
       </a>
      </li>
      <li>
       <a href="#_49" rel="nofollow">
        二、经纬度、行列号、投影坐标之间的转换
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1xy_50" rel="nofollow">
          1.经纬度转投影坐标xy
         </a>
        </li>
        <li>
         <a href="#2xy_99" rel="nofollow">
          2.投影坐标xy转经纬度
         </a>
        </li>
        <li>
         <a href="#3_127" rel="nofollow">
          3.行列号转投影或地理坐标
         </a>
        </li>
        <li>
         <a href="#4_150" rel="nofollow">
          4.投影或地理坐标转行列号
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_177" rel="nofollow">
        三、获取指定位置的值
       </a>
      </li>
      <li>
       <a href="#SHPTIFF_201" rel="nofollow">
        四、使用SHP文件裁剪TIFF文件
       </a>
      </li>
      <li>
       <a href="#TIFF_235" rel="nofollow">
        五、保存TIFF文件
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <hr color="#000000" size='1"'/>
    <h2>
     <a id="_8">
     </a>
     简介
    </h2>
    <p>
     参考文献
     <sup class="footnote-ref">
      <a href="#fn1" id="fnref1" rel="nofollow">
       1
      </a>
     </sup>
    </p>
    <ul>
     <li>
      GDAL 是一个开源的操作栅格数据和矢量数据的库，本文记录下用 Python 中 GDAL 库操作 TIFF （GeoTIFF）的常见代码，包括读写、获取坐标系、获取指定位置像元值等。
     </li>
     <li>
      TIFF 简单理解就是一种图像格式，类似于 jpg、png 等。
     </li>
     <li>
      GeoTIFF 就是在普通 TIFF 文件上增加了地理位置、投影信息、坐标信息等，常用于遥感数据。
     </li>
    </ul>
    <h2>
     <a id="TIFF_15">
     </a>
     一、读取TIFF文件
    </h2>
    <pre><code class="prism language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> gdal<span class="token punctuation">,</span> osr

filename<span class="token operator">=</span><span class="token string">r'F:\GOSIF_2001065.tif'</span>
tiff_path<span class="token operator">=</span><span class="token string">r'F:\GOSIF\8day'</span>

<span class="token keyword">def</span> <span class="token function">GetTifInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    dataset <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>  <span class="token comment"># 打开文件</span>
    im_width <span class="token operator">=</span> dataset<span class="token punctuation">.</span>RasterXSize  <span class="token comment"># 栅格矩阵的列数</span>
    im_height <span class="token operator">=</span> dataset<span class="token punctuation">.</span>RasterYSize  <span class="token comment"># 栅格矩阵的行数</span>
    im_bands <span class="token operator">=</span> dataset<span class="token punctuation">.</span>RasterCount  <span class="token comment"># 波段数</span>
    <span class="token comment"># print(im_bands)</span>
    <span class="token comment">#栅格数据的六参数。</span>
    <span class="token comment"># geoTransform[0]：左上角像素经度</span>
    <span class="token comment"># geoTransform[1]：影像宽度方向上的分辨率(经度范围/像素个数)</span>
    <span class="token comment"># geoTransform[2]：x像素旋转, 0表示上面为北方</span>
    <span class="token comment"># geoTransform[3]：左上角像素纬度</span>
    <span class="token comment"># geoTransform[4]：y像素旋转, 0表示上面为北方</span>
    <span class="token comment"># geoTransform[5]：影像宽度方向上的分辨率(纬度范围/像素个数)</span>
    extent <span class="token operator">=</span> dataset<span class="token punctuation">.</span>GetGeoTransform<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 仿射矩阵，左上角像素的大地坐标和像素分辨率</span>
    var <span class="token operator">=</span> dataset<span class="token punctuation">.</span>GetProjection<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment"># 栅格数据的投影</span>
    <span class="token comment"># osr.SpatialReference 提供描绘和转换坐标系统的服务 地理坐标(用经纬度表示)；投影坐标(如 UTM ，用米等单位量度来定位)。</span>
    pcs <span class="token operator">=</span> osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># ImportFromWkt()函数可以把 WKT坐标系统设置到OGRSpatialReference中</span>
    pcs<span class="token punctuation">.</span>ImportFromWkt<span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>GetProjection<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    gcs <span class="token operator">=</span> pcs<span class="token punctuation">.</span>CloneGeogCS<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#地理空间坐标系</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>gcs<span class="token punctuation">)</span>
    shape <span class="token operator">=</span> <span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>RasterYSize<span class="token punctuation">,</span> dataset<span class="token punctuation">.</span>RasterXSize<span class="token punctuation">)</span>
    img <span class="token operator">=</span> dataset<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ReadAsArray<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># (height, width)</span>
    <span class="token comment"># print(img)</span>
<span class="token comment"># img(ndarray), gdal数据集、地理空间坐标系、投影坐标系、栅格影像大小</span>
    <span class="token keyword">return</span> img<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> gcs<span class="token punctuation">,</span> pcs<span class="token punctuation">,</span> extent<span class="token punctuation">,</span> shape
</code></pre>
    <h2>
     <a id="_49">
     </a>
     二、经纬度、行列号、投影坐标之间的转换
    </h2>
    <h3>
     <a id="1xy_50">
     </a>
     1.经纬度转投影坐标xy
    </h3>
    <p>
     <font color="#999AAA">
      参考文献
      <sup class="footnote-ref">
       <a href="#fn2" id="fnref2" rel="nofollow">
        2
       </a>
      </sup>
     </font>
    </p>
    <font color="#999AAA">
    </font>
    <ul>
     <li>
      地理坐标系（Geographic coordinate system），Geographic coordinate system直译为地理坐标系统，是以经纬度为地图的存储单位的。很明显，Geographic coordinate system是球面坐标系统。
     </li>
     <li>
      Projection coordinate system（投影坐标系统），每一个投影坐标系统都必定会有Geographic Coordinate System的参数。投影坐标系统，实质上便是平面坐标系统，其地图单位通常为米。投影：将球面坐标转化为平面坐标的过程便称为投影。即，投影的条件：
      <br/>
      a、球面坐标
      <br/>
      b、转化过程（也就是算法）
      <br/>
      要得到投影坐标就必须得有一个“拿来”投影的球面坐标，然后才能使用算法去投影
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> gdal<span class="token punctuation">,</span> osr

<span class="token keyword">def</span> <span class="token function">Lonlat2Xy</span><span class="token punctuation">(</span>SourceGcs<span class="token punctuation">,</span> TargetPcs<span class="token punctuation">,</span> lon<span class="token punctuation">,</span> lat<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    :param SourceRef: 源地理坐标系统
    :param TargetRef: 目标投影
    :param lon: 待转换点的longitude值
    :param lat: 待转换点的latitude值
    :return:
    '''</span>
    <span class="token comment">#创建目标空间参考</span>
    spatialref_target<span class="token operator">=</span>osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
    spatialref_target<span class="token punctuation">.</span>ImportFromEPSG<span class="token punctuation">(</span>TargetPcs<span class="token punctuation">)</span> <span class="token comment">#2331为目标空间参考的ESPG编号，西安80 高斯可吕格投影</span>
    <span class="token comment">#创建原始空间参考</span>
    spatialref_source<span class="token operator">=</span>osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
    spatialref_source<span class="token punctuation">.</span>ImportFromEPSG<span class="token punctuation">(</span>SourceGcs<span class="token punctuation">)</span>  <span class="token comment">#4326 为原始空间参考的ESPG编号，WGS84</span>
        <span class="token comment">#构建坐标转换对象，用以转换不同空间参考下的坐标</span>
    trans<span class="token operator">=</span>osr<span class="token punctuation">.</span>CoordinateTransformation<span class="token punctuation">(</span>spatialref_source<span class="token punctuation">,</span>spatialref_target<span class="token punctuation">)</span>
    <span class="token comment"># coordinate_after_trans 是一个Tuple类型的变量包含3个元素， [0]为y方向值，[1]为x方向值，[2]为高度</span>
    coordinate_after_trans<span class="token operator">=</span>trans<span class="token punctuation">.</span>TransformPoint<span class="token punctuation">(</span>lat<span class="token punctuation">,</span>lon<span class="token punctuation">)</span>
    <span class="token comment"># print(coordinate_after_trans)</span>
	 <span class="token comment">#以下为转换多个点（要使用list）</span>
    coordinate_trans_points<span class="token operator">=</span>trans<span class="token punctuation">.</span>TransformPoints<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">117</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>coordinate_trans_points<span class="token punctuation">)</span>
    <span class="token keyword">return</span> coordinate_after_trans
<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span>
	point_trans <span class="token operator">=</span> Lonlat2Xy<span class="token punctuation">(</span><span class="token number">4326</span><span class="token punctuation">,</span> <span class="token number">2331</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span>
    <span class="token comment"># 4326 为原始空间参考的ESPG编号  2331为目标空间参考的ESPG编号</span>
    <span class="token comment"># 120为经度，36为纬度</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>point_trans<span class="token punctuation">)</span>   
</code></pre>
    <p>
     运行结果：
    </p>
    <pre><code>[(4588003.080066519, 19041214.81787683, 0.0), (4196378.172222488, 19406098.190200843, 0.0)]
(4196378.172222488, 19406098.190200843, 0.0)
</code></pre>
    <h3>
     <a id="2xy_99">
     </a>
     2.投影坐标xy转经纬度
    </h3>
    <p>
     <font color="#999AAA">
      代码如下（示例）：
     </font>
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> gdal<span class="token punctuation">,</span> osr

filename<span class="token operator">=</span><span class="token string">r'F:\GOSIF_2001065.tif'</span>

<span class="token keyword">def</span> <span class="token function">Xy2Lonlat</span><span class="token punctuation">(</span>SourcePcs<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
        将投影坐标转为经纬度坐标（具体的投影坐标系由给定数据确定）
        :param SourcePcs:源投影坐标系
        :param x: 投影坐标x
        :param y: 投影坐标y
        :return: 投影坐标(x, y)对应的经纬度坐标(lon, lat)
    '''</span>

    prosrs <span class="token operator">=</span> osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># prosrs投影参考系</span>
    prosrs<span class="token punctuation">.</span>ImportFromEPSG<span class="token punctuation">(</span>SourcePcs<span class="token punctuation">)</span><span class="token comment">#投影坐标的EPSG编号</span>
    <span class="token comment">#geosrs地理参考系</span>
    geosrs <span class="token operator">=</span> osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
    geosrs<span class="token punctuation">.</span>ImportFromEPSG<span class="token punctuation">(</span><span class="token number">4326</span><span class="token punctuation">)</span>            <span class="token comment">#WGS84</span>
    ct <span class="token operator">=</span> osr<span class="token punctuation">.</span>CoordinateTransformation<span class="token punctuation">(</span>prosrs<span class="token punctuation">,</span> geosrs<span class="token punctuation">)</span>
    coords <span class="token operator">=</span> ct<span class="token punctuation">.</span>TransformPoint<span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token punctuation">)</span>
    <span class="token keyword">return</span> coords<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>   <span class="token comment">#(lat,lon)</span>

</code></pre>
    <h3>
     <a id="3_127">
     </a>
     3.行列号转投影或地理坐标
    </h3>
    <p>
     <font color="#999AAA">
      根据原始tiff的坐标系，确定是投影坐标还是地理坐标。
     </font>
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> gdal<span class="token punctuation">,</span> osr

filename<span class="token operator">=</span><span class="token string">r'F:\GOSIF_2001065.tif'</span>

<span class="token comment">#tiff是投影坐标的情况未实测</span>
<span class="token keyword">def</span> <span class="token function">Rowcol2Lonlat</span><span class="token punctuation">(</span>Xpixel<span class="token punctuation">,</span>Ypixel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dataset <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>  <span class="token comment"># 打开文件</span>
    GeoTransform <span class="token operator">=</span> dataset<span class="token punctuation">.</span>GetGeoTransform<span class="token punctuation">(</span><span class="token punctuation">)</span>
    XGeo <span class="token operator">=</span> GeoTransform<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>GeoTransform<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span>Xpixel<span class="token operator">+</span>Ypixel<span class="token operator">*</span>GeoTransform<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    YGeo <span class="token operator">=</span> GeoTransform<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">+</span>GeoTransform<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">*</span>Xpixel<span class="token operator">+</span>Ypixel<span class="token operator">*</span>GeoTransform<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    pcs <span class="token operator">=</span> osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pcs<span class="token punctuation">.</span>ImportFromWkt<span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>GetProjection<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   
    <span class="token keyword">if</span> pcs<span class="token punctuation">.</span>IsGeographic<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 是地理坐标</span>
        <span class="token keyword">return</span> XGeo<span class="token punctuation">,</span>YGeo
    <span class="token keyword">elif</span> pcs<span class="token punctuation">.</span>IsProjected<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment">#是投影坐标</span>
        coords <span class="token operator">=</span> Xy2Lonlat<span class="token punctuation">(</span>pcs<span class="token punctuation">,</span> XGeo<span class="token punctuation">,</span> YGeo<span class="token punctuation">)</span>  
        <span class="token keyword">return</span> coords<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
</code></pre>
    <h3>
     <a id="4_150">
     </a>
     4.投影或地理坐标转行列号
    </h3>
    <p>
     <font color="#999AAA">
      根据原始tiff的坐标系，确定是投影坐标还是地理坐标。
     </font>
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> gdal<span class="token punctuation">,</span> osr

filename<span class="token operator">=</span><span class="token string">r'F:\GOSIF_2001065.tif'</span>

<span class="token comment">#tiff是投影坐标的情况未实测</span>
<span class="token keyword">def</span> <span class="token function">Lonlat2Rowcol</span><span class="token punctuation">(</span>lon<span class="token punctuation">,</span>lat<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dataset <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>  <span class="token comment"># 打开文件</span>
    tiff_geotrans <span class="token operator">=</span> dataset<span class="token punctuation">.</span>GetGeoTransform<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pcs <span class="token operator">=</span> osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pcs<span class="token punctuation">.</span>ImportFromWkt<span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>GetProjection<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> pcs<span class="token punctuation">.</span>IsGeographic<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 是地理坐标</span>
        XGeo<span class="token punctuation">,</span> YGeo <span class="token operator">=</span> lon <span class="token punctuation">,</span> lat
    <span class="token keyword">elif</span> pcs<span class="token punctuation">.</span>IsProjected<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 是投影坐标</span>
        YGeo<span class="token punctuation">,</span> XGeo <span class="token operator">=</span> Lonlat2Xy<span class="token punctuation">(</span><span class="token number">4326</span><span class="token punctuation">,</span> pcs<span class="token punctuation">,</span> lon<span class="token punctuation">,</span> lat<span class="token punctuation">)</span>
    A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>tiff_geotrans<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tiff_geotrans<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 根据公式Xgeo=tiff_geotrans[0]+Xpixel*tiff_geotrans[1]+Yline*tiff_geotrans[2]</span>
         <span class="token punctuation">[</span>tiff_geotrans<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tiff_geotrans<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment"># Ygeo=tiff_geotrans[3]+Xpixel*tiff_geotrans[4]+Yline*tiff_geotrans[5]</span>
    s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>XGeo <span class="token operator">-</span> tiff_geotrans<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 运用矩阵解二元一次方程组求得行列号</span>
         <span class="token punctuation">[</span>YGeo <span class="token operator">-</span> tiff_geotrans<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    r <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>solve<span class="token punctuation">(</span>A<span class="token punctuation">,</span> s<span class="token punctuation">)</span>
    <span class="token comment"># Xpixel, Ypixel = r[0], r[1]</span>
    Xpixel<span class="token punctuation">,</span>Ypixel <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Xpixel<span class="token punctuation">,</span>Ypixel
</code></pre>
    <h2>
     <a id="_177">
     </a>
     三、获取指定位置的值
    </h2>
    <font color="#999AAA">
    </font>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">GetValueByCoordinates</span><span class="token punctuation">(</span>Cox<span class="token punctuation">,</span>Coy<span class="token punctuation">,</span> coordinate_type<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    :param Cox: x轴方向坐标
    :param Coy: y轴方向坐标
    :param coordinate_type: 'rowcol'，'lonlat'，'xy'3个取值，表示3种坐标
    :return: 
    '''</span>
    img<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> gcs<span class="token punctuation">,</span> pcs<span class="token punctuation">,</span> extend<span class="token punctuation">,</span> shape <span class="token operator">=</span> GetTifInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> coordinate_type <span class="token operator">==</span> <span class="token string">'rowcol'</span><span class="token punctuation">:</span>
        value <span class="token operator">=</span> img<span class="token punctuation">[</span>Coy<span class="token punctuation">,</span> Cox<span class="token punctuation">]</span>
    <span class="token keyword">elif</span> coordinate_type <span class="token operator">==</span> <span class="token string">'lonlat'</span><span class="token punctuation">:</span>
        col<span class="token punctuation">,</span> row <span class="token operator">=</span> Lonlat2Rowcol<span class="token punctuation">(</span>Cox<span class="token punctuation">,</span>Coy<span class="token punctuation">)</span>
        value <span class="token operator">=</span> img<span class="token punctuation">[</span>row<span class="token punctuation">,</span> col<span class="token punctuation">]</span>
    <span class="token keyword">elif</span> coordinate_type <span class="token operator">==</span> <span class="token string">'xy'</span><span class="token punctuation">:</span>
        row<span class="token punctuation">,</span> col <span class="token operator">=</span>Lonlat2Rowcol<span class="token punctuation">(</span>Cox<span class="token punctuation">,</span>Coy<span class="token punctuation">)</span>
        value <span class="token operator">=</span> img<span class="token punctuation">[</span>row<span class="token punctuation">,</span> col<span class="token punctuation">]</span>
    Exception<span class="token punctuation">(</span><span class="token string">"coordinated_type error"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> value
</code></pre>
    <h2>
     <a id="SHPTIFF_201">
     </a>
     四、使用SHP文件裁剪TIFF文件
    </h2>
    <p>
     <font color="#999AAA">
      说明待补充
      <br/>
      注意shp的坐标系应该和tiff文件一致，可在arcGIS中修改shp的坐标系
     </font>
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> gdal<span class="token punctuation">,</span> osr<span class="token punctuation">,</span> ogr
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> os
<span class="token keyword">import</span> shapefile

filename<span class="token operator">=</span><span class="token string">r'F:\GOSIF_2001065.tif'</span>
shpfile <span class="token operator">=</span> <span class="token string">r'F:\门源县.shp'</span>
tiff_path<span class="token operator">=</span><span class="token string">r'F:\\'</span>
out_path <span class="token operator">=</span> <span class="token string">r'F:\haibei_GOSIF'</span>

<span class="token keyword">def</span> <span class="token function">TiffCutByShp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    file_list <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>tiff_path<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> file_list<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.tif'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Processing &gt;&gt;&gt; '</span> <span class="token operator">+</span> <span class="token builtin">file</span><span class="token punctuation">)</span>
            in_raster <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>tiff_path<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            out_raster <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>out_path<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">)</span>
            r <span class="token operator">=</span> shapefile<span class="token punctuation">.</span>Reader<span class="token punctuation">(</span>shpfile<span class="token punctuation">)</span>
            ds <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Warp<span class="token punctuation">(</span>out_raster<span class="token punctuation">,</span><span class="token comment"># 裁剪图像保存完整路径（包括文件名）</span>
                   in_raster<span class="token punctuation">,</span><span class="token comment"># 待裁剪的影像</span>
                   <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'GTiff'</span><span class="token punctuation">,</span> <span class="token comment"># 保存图像的格式</span>
                   cutlineDSName<span class="token operator">=</span>shpfile<span class="token punctuation">,</span><span class="token comment"># 矢量文件的完整路径</span>
                           outputBounds<span class="token operator">=</span>r<span class="token punctuation">.</span>bbox<span class="token punctuation">,</span><span class="token comment">#shp文件的外包矩阵</span>
                           <span class="token comment"># cutlineWhere="FIELD = 'whatever'", # clip specific feature</span>
                           dstNodata<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># set nodata value</span>
            ds <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># close dataset</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"No '.tif' file found ..."</span><span class="token punctuation">)</span>
</code></pre>
    <h2>
     <a id="TIFF_235">
     </a>
     五、保存TIFF文件
    </h2>
    <hr color="#000000" size='1"'/>
    未完待续
    <hr class="footnotes-sep"/>
    <section class="footnotes">
     <ol class="footnotes-list">
      <li class="footnote-item" id="fn1">
       <p>
        参考文献:https://laowangblog.com/gdal-read-and-write-tiff-with-python.html
        <br/>
        <font color="#999AAA">
         <a class="footnote-backref" href="#fnref1" rel="nofollow">
          ↩︎
         </a>
        </font>
       </p>
      </li>
      <li class="footnote-item" id="fn2">
       <p>
        参考文献:https://blog.csdn.net/qq_36181130/article/details/83449182
        <a class="footnote-backref" href="#fnref2" rel="nofollow">
         ↩︎
        </a>
       </p>
      </li>
     </ol>
    </section>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f737565786973616e672f:61727469636c652f64657461696c732f313232373838323538" class_="artid" style="display:none">
 </p>
</div>


