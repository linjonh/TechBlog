---
layout: post
title: "微信小程序-小程序全局数据共享笔记"
date: 2025-01-08 15:47:53 +0800
description: "文章目录1. 安装 mobx2. 创建 Store 实例3. 在页面中使用 Store3.1 页面挂"
keywords: "两个小程序直接数据如何互通连接"
categories: ['微信小程序']
tags: ['微信小程序', '小程序']
artid: "124920387"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=124920387
    alt: "微信小程序-小程序全局数据共享笔记"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微信小程序 小程序全局数据共享(笔记)
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <ul>
        <li>
         <ul>
          <li>
           <a href="#1__mobx_1" rel="nofollow">
            1. 安装 mobx
           </a>
          </li>
          <li>
           <a href="#2__Store__17" rel="nofollow">
            2. 创建 Store 实例
           </a>
          </li>
          <li>
           <a href="#3__Store_45" rel="nofollow">
            3. 在页面中使用 Store
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#31__47" rel="nofollow">
              3.1 页面挂载
             </a>
            </li>
            <li>
             <a href="#32__69" rel="nofollow">
              3.2 页面使用
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#4__Store_87" rel="nofollow">
            4. 在组件中使用 Store
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#41__89" rel="nofollow">
              4.1 组件挂载
             </a>
            </li>
            <li>
             <a href="#42__112" rel="nofollow">
              4.2 组件使用
             </a>
            </li>
           </ul>
          </li>
         </ul>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h4>
     <a id="1__mobx_1">
     </a>
     1. 安装 mobx
    </h4>
    <p>
     在小程序中可以安装 mobx 实现全局数据共享，需要 npm 下载两个包
    </p>
    <pre><code class="prism language-js"><span class="token comment">// 用来创建 Store 实例对象</span>
mobx<span class="token operator">-</span>miniprogram 

<span class="token comment">// 用来把 Store 中的共享数据或方法，绑定到组件或页面中使用</span>
mobx<span class="token operator">-</span>miniprogram<span class="token operator">-</span>bindings
</code></pre>
    <blockquote>
     <p>
      在微信小程序中使用 npm 下载包，需要在工具中点击构建 npm，还需要在本地设置中勾选使用 npm 模块
     </p>
    </blockquote>
    <h4>
     <a id="2__Store__17">
     </a>
     2. 创建 Store 实例
    </h4>
    <pre><code class="prism language-js"><span class="token comment">// store/index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> observable<span class="token punctuation">,</span> action <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"mobx-miniprogram"</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 数据</span>
  <span class="token literal-property property">numA</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token literal-property property">numB</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
  
  <span class="token comment">// 计算属性 </span>
  <span class="token keyword">get</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>numA <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>numB
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
  <span class="token comment">// action 方法，用来修改 store 中的数据</span>
  <span class="token literal-property property">setNumA</span><span class="token operator">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  	<span class="token keyword">this</span><span class="token punctuation">.</span>numA <span class="token operator">=</span> value
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">setNumB</span><span class="token operator">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  	<span class="token keyword">this</span><span class="token punctuation">.</span>numB <span class="token operator">=</span> value
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="3__Store_45">
     </a>
     3. 在页面中使用 Store
    </h4>
    <h5>
     <a id="31__47">
     </a>
     3.1 页面挂载
    </h5>
    <pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createStoreBindings <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"mobx-miniprogram-bindings"</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> store <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"store/index"</span>

<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 页面加载时挂载 Store</span>
  <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>storeBindings <span class="token operator">=</span> <span class="token function">createStoreBindings</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
      store<span class="token punctuation">,</span>
      <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"numA"</span><span class="token punctuation">,</span> <span class="token string">"numB"</span><span class="token punctuation">,</span> <span class="token string">"sum"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"setNumA"</span><span class="token punctuation">,</span> <span class="token string">"setNumB"</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 页面卸载时卸载 Store</span>
  <span class="token function">onUnload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>storeBindings<span class="token punctuation">.</span><span class="token function">destroyStoreBindings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="32__69">
     </a>
     3.2 页面使用
    </h5>
    <pre><code class="prism language-html"><span class="token comment">&lt;!-- 在页面中和 data 数据一样，直接使用即可 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span> <span class="token attr-name">data-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{<!-- -->{100}}</span><span class="token punctuation">&gt;</span></span>{<!-- -->{sum}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <pre><code class="prism language-js"><span class="token comment">// 在逻辑中通过 this 直接获取即可</span>
<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token function">btn</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setNumA</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="4__Store_87">
     </a>
     4. 在组件中使用 Store
    </h4>
    <h5>
     <a id="41__89">
     </a>
     4.1 组件挂载
    </h5>
    <pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> storeBindsBehavior <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"mobx-miniprogram-bindings"</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> store <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"store/index"</span>

<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
 <span class="token literal-property property">behaviors</span><span class="token operator">:</span> <span class="token punctuation">[</span>storeBindsBehavior<span class="token punctuation">]</span><span class="token punctuation">,</span>
 <span class="token literal-property property">storeBindings</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    store<span class="token punctuation">,</span>
    <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">numA</span><span class="token operator">:</span> <span class="token string">"numA"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">numB</span><span class="token operator">:</span> <span class="token string">"numB"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">sum</span><span class="token operator">:</span> <span class="token string">"sum"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">setNumA</span><span class="token operator">:</span> <span class="token string">"setNumA"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">setNumB</span><span class="token operator">:</span> <span class="token string">"setNumB"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="42__112">
     </a>
     4.2 组件使用
    </h5>
    <p>
     组件的使用和页面一样
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f36303534373038342f:61727469636c652f64657461696c732f313234393230333837" class_="artid" style="display:none">
 </p>
</div>


