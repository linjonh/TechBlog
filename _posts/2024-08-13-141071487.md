---
layout: post
title: "uni-app如何适配钉钉小程序"
date: 2024-08-13 09:00:00 +0800
description: "在uni-ui组件和自定义组件中直接使用style和class，编译到钉钉小程序平台会出现样式丢失，"
keywords: "uniapp 钉钉小程序"
categories: ['Vue', 'Vite', 'App']
tags: ['钉钉', '小程序', 'App']
artid: "141071487"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=141071487
    alt: "uni-app如何适配钉钉小程序"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     uni-app如何适配钉钉小程序
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     项目配置
    </h2>
    <p>
     在package.json中添加自定钉钉环境变量
    </p>
    <pre><code class="prism language-javascript"><span class="token string-property property">"uni-app"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token string-property property">"mp-dingtalk"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>   
            <span class="token string-property property">"title"</span><span class="token operator">:</span><span class="token string">"钉钉小程序"</span><span class="token punctuation">,</span>   
            <span class="token string-property property">"env"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>   
                <span class="token string-property property">"UNI_PLATFORM"</span><span class="token operator">:</span> <span class="token string">"mp-alipay"</span>   
            <span class="token punctuation">}</span><span class="token punctuation">,</span>  
            <span class="token string-property property">"define"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>   
                <span class="token string-property property">"MP-DINGTALK"</span><span class="token operator">:</span> <span class="token boolean">true</span>   
            <span class="token punctuation">}</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre>
    <p>
     脚本节点添加运行和打包命令（cli项目创建专用）
    </p>
    <pre><code class="prism language-javascript"><span class="token punctuation">{<!-- --></span>
	<span class="token string-property property">"dev:mp-dingtalk"</span><span class="token operator">:</span> <span class="token string">"uni -p mp-dingtalk"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"build:mp-dingtalk"</span><span class="token operator">:</span><span class="token string">"uni build -p mp-dingtalk"</span>
<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="1_24">
     </a>
     调试运行钉钉小程序
     <sup class="footnote-ref">
      <a href="#fn1" id="fnref1" rel="nofollow">
       1
      </a>
     </sup>
    </h2>
    <h3>
     <a id="Hbuilder_25">
     </a>
     Hbuilder开发
    </h3>
    <p>
     使用Hbuilder开发可参考文档
     <a href="https://ask.dcloud.net.cn/article/36353" rel="nofollow">
      uniapp 适配钉钉小程序
     </a>
    </p>
    <h3>
     <a id="cli_27">
     </a>
     cli形式运行
    </h3>
    <p>
     运行启动命令
    </p>
    <pre><code class="prism language-javascript">npm run dev<span class="token operator">:</span>mp<span class="token operator">-</span>dingtalk
</code></pre>
    <p>
     编译完成后打开开发者工具，点击打开项目定位到工程
     <strong>
      dist&gt;dev&gt;mp-alipay
     </strong>
     文件夹
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/6974b51ba91e43128276a09644e1f7cf.png">
      <br/>
      选择企业内部应用（
      <strong>
       开发者工具中企业内部应用才能真机调试
      </strong>
      ）
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/880776d587b2499ebd08a5272986b84e.png"/>
     </img>
    </p>
    <h2>
     <a id="_41">
     </a>
     开发注意事项
    </h2>
    <h3>
     <a id="spanhtml_42">
     </a>
     禁止使用span等html标签
    </h3>
    <p>
     span等html标签在微信小程序中可以被编译成功，但是在钉钉中不能被识别到，应使用view、text组件代替
    </p>
    <h4>
     <a id="_44">
     </a>
     错误写法
    </h4>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span> 错误写法 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h4>
     <a id="_50">
     </a>
     正确写法
    </h4>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span> 正确写法 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h3>
     <a id="uniuistylecalss_54">
     </a>
     不可以在uni-ui、自定义组件中直接写style和calss
    </h3>
    <p>
     在uni-ui组件和自定义组件中直接使用style和class，编译到钉钉小程序平台会出现样式丢失，建议在组件的外层在套一层view组件
    </p>
    <h4>
     <a id="_56">
     </a>
     错误写法
    </h4>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comA</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span>red</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span> 错误写法 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comA</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h4>
     <a id="_62">
     </a>
     正确写法
    </h4>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span>red</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comA</span> <span class="token punctuation">&gt;</span></span> 正确写法 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comA</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h3>
     <a id="_67">
     </a>
     使用条件编译（仅钉钉小程序运行）
    </h3>
    <pre><code class="prism language-javascript"><span class="token comment">// #ifdef MP-DINGTALK</span>
dd<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// #endif</span>
</code></pre>
    <h3>
     <a id="_74">
     </a>
     不可使用透传插槽
    </h3>
    <p>
     使用透传插槽编译到钉钉平台，会导致页面内容出不来，甚至小程序崩溃
    </p>
    <h3>
     <a id="ref_77">
     </a>
     ref使用注意
    </h3>
    <p>
     在vue开发中经常用ref来定位到节点，而vue3的uniapp中在template里面使用在uni-form加ref需在script中也定义相对应的字段，不然在钉钉中就会报错：form is undefined
    </p>
    <pre><code class="prism language-javascript"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>uni<span class="token operator">-</span>forms ref<span class="token operator">=</span><span class="token string">"form"</span><span class="token operator">&gt;</span>
      <span class="token operator">...</span><span class="token punctuation">.</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>uni<span class="token operator">-</span>forms<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span>

<span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre>
    <h3>
     <a id="_90">
     </a>
     使用自定义导航栏注意
    </h3>
    <p>
     在钉钉小程序中要使用自定义导航栏的话需要在
     <code>
      pages.json
     </code>
     中页面配置节点添加如下配置
    </p>
    <pre><code class="prism language-javascript"><span class="token string-property property">"style"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"navigationBarTitleText"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token string-property property">"navigationStyle"</span><span class="token operator">:</span> <span class="token string">"custom"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"transparentTitle"</span><span class="token operator">:</span><span class="token string">"always"</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     其中
     <code>
      transparentTitle
     </code>
     配置是为了让原生导航栏变得透明,
     <code>
      navigationBarTitleText
     </code>
     属性设置为空是为了不出现原生导航栏的字样，，如果不加就会出现如下效果
     <br/>
     <img alt="不加配置的情况" src="https://i-blog.csdnimg.cn/direct/d339220cb60c4074b476c8d0e4c93d9d.png">
      <br/>
      在加完如上配置之后，就会发现加了自定义导航栏的在首页没有什么问题，而在跳转到另外一个配置自定义导航栏页面时会出现返回按钮重叠的情况，如下图所示
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1551bff701a142bd853736b6d891ec46.png">
       <br/>
       出现这种问题估计还是uni-app在编译到钉钉小程序时候的bug，这种问题解决方法是在跳转时要避免使用
       <code>
        uni.navigateTo
       </code>
       Api，转而使用
       <code>
        uni.redirectTo
       </code>
       Api
      </img>
     </img>
    </p>
    <h3>
     <a id="_dd_is_undefined_105">
     </a>
     在内网环境中 dd is undefined
    </h3>
    <p>
     有些时候要在内网环境下开发，在使用
     <code>
      dd.getLocation
     </code>
     等Api时出现报错
     <code>
      dd is undefined
     </code>
     ，这其实是正常现象，钉钉的Api需要在联网环境下使用，使用uni去调的Api编译后并不是直接通过dd的Api的
    </p>
    <h4>
     <a id="_107">
     </a>
     例子
    </h4>
    <p>
     编译前
     <br/>
     <img alt="编译前" src="https://i-blog.csdnimg.cn/direct/e29345062569406391db1f61e541792b.png">
      <br/>
      编译后
      <br/>
      <img alt="编译后" src="https://i-blog.csdnimg.cn/direct/1bb99c3e7f0647b1b049802571dbbefc.png"/>
     </img>
    </p>
    <hr class="footnotes-sep"/>
    <section class="footnotes">
     <ol class="footnotes-list">
      <li class="footnote-item" id="fn1">
       <p>
        这里使用的是
        <a href="https://opendocs.alipay.com/mini/ide/download" rel="nofollow">
         支付宝开发者工具
        </a>
        ，新版的钉钉开发者工具无法在没有登录的情况下进行调试运行，无法在内网环境下运行
        <a class="footnote-backref" href="#fnref1" rel="nofollow">
         ↩︎
        </a>
       </p>
      </li>
     </ol>
    </section>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34333935333138322f:61727469636c652f64657461696c732f313431303731343837" class_="artid" style="display:none">
 </p>
</div>


