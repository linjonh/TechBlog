---
layout: post
title: "java解析office数学公式"
date: 2024-07-25 16:42:30 +0800
description: "一、概述公司的项目遇到一个需求是从office word中导入数据回显到页面当中，里面穿插着一些数学"
keywords: "java解析word数学公式"
categories: ['代码文档']
tags: ['Poi', 'Office', 'Mathml', 'Latex']
artid: "116521013"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=116521013
    alt: "java解析office数学公式"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     java解析office数学公式
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h4>
     <a id="_0">
     </a>
     一、概述
    </h4>
    <p>
     公司的项目遇到一个需求是从office word中导入数据回显到页面当中，里面穿插着一些数学公式，又不想使用图片的方式存储数学公式。所以敲定了将公式转换成latex表达式，然后前端使用
     <a href="https://www.mathjax.org/" rel="nofollow">
      MathJax
     </a>
     渲染出数学公式的方案。
    </p>
    <h5>
     <a id="11___3">
     </a>
     1.1 所需资源
    </h5>
    <table>
     <thead>
      <tr>
       <th>
        名称
       </th>
       <th>
        地址
       </th>
       <th>
        描述
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        mmltx.xsl
       </td>
       <td>
        https://sourceforge.net/projects/xsltml/files/xsltml/
       </td>
       <td>
        MathML转LaTex工具
       </td>
      </tr>
      <tr>
       <td>
        MML2OMML.XSL
       </td>
       <td>
        https://download.csdn.net/download/han949417140/18465121
       </td>
       <td>
        OMML转为MathML的xsl工具
       </td>
      </tr>
     </tbody>
    </table>
    <h5>
     <a id="12__office_9">
     </a>
     1.2 office文档中的公式编辑器
    </h5>
    <ul>
     <li>
      <p>
       office自带公式编辑器
       <br/>
       从2007版开始，Office也自带了一个公式编辑器。
       <br/>
       在2007版中Word与Excel之间不同的是，前者插入的公式对象是Office MathML节点，后者插入的还是ole。
       <br/>
       到了2010版开始，两个产品的公式编辑器插入的都是Office MathML节点了，但是两者对公式对象中的默认文字编码处理不同。
       <br/>
       这些不同点可以看出就算同样属于Office的产品，他们之间也是有很多不统一的地方。
      </p>
     </li>
     <li>
      <p>
       公式表达式
       <br/>
       LaTeX
       <br/>
       LaTeX是一种基于ΤΕΧ的排版系统，它非常适用于生成高印刷质量的科技和数学类文档。
       <br/>
       例如勾股定理用LaTeX表达：
       <br/>
       <span class="katex--display">
        <span class="katex-display">
         <span class="katex">
          <span class="katex-mathml">
           a 
            
           
             2 
            
           
          
            + 
           
           
           
             b 
            
           
             2 
            
           
          
            = 
           
           
           
             c 
            
           
             2 
            
           
          
         
           {a}^{2}+{b}^{2}={c}^{2}
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.947438em; vertical-align: -0.08333em;">
            </span>
            <span class="mord">
             <span class="mord">
              <span class="mord mathdefault">
               a
              </span>
             </span>
             <span class="msupsub">
              <span class="vlist-t">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.864108em;">
                 <span class="" style="top: -3.113em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mord mtight">
                    <span class="mord mtight">
                     2
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.222222em;">
            </span>
            <span class="mbin">
             +
            </span>
            <span class="mspace" style="margin-right: 0.222222em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 0.864108em; vertical-align: 0em;">
            </span>
            <span class="mord">
             <span class="mord">
              <span class="mord mathdefault">
               b
              </span>
             </span>
             <span class="msupsub">
              <span class="vlist-t">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.864108em;">
                 <span class="" style="top: -3.113em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mord mtight">
                    <span class="mord mtight">
                     2
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.277778em;">
            </span>
            <span class="mrel">
             =
            </span>
            <span class="mspace" style="margin-right: 0.277778em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 0.864108em; vertical-align: 0em;">
            </span>
            <span class="mord">
             <span class="mord">
              <span class="mord mathdefault">
               c
              </span>
             </span>
             <span class="msupsub">
              <span class="vlist-t">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.864108em;">
                 <span class="" style="top: -3.113em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mord mtight">
                    <span class="mord mtight">
                     2
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
       <br/>
       常用的LaTeX渲染组件是
       <a href="https://www.mathjax.org/" rel="nofollow">
        MathJax
       </a>
       ,
       <br/>
       vue渲染教程请参考：
       <a href="http://www.manongjc.com/detail/11-pwanxyhkqeiokqi.html" rel="nofollow">
        http://www.manongjc.com/detail/11-pwanxyhkqeiokqi.html
       </a>
       <br/>
       我们在项目中使用的便是LaTeX，所以本次研究就是如何将Office中的公式对象转换成LaTeX表达式。
      </p>
     </li>
     <li>
      <p>
       Mathml
       <br/>
       全称为数学标记语言（Mathematical Markup Language），是一种基于XML的标准，用来在互联网上书写数学符号和公式的置标语言。
      </p>
     </li>
     <li>
      <p>
       Office MathML (OMML)
       <br/>
       在office2007之后版本所编辑的公式对象便是OMML。OMML是office为了配合Office Open Xml制定的数学标记语言。
      </p>
     </li>
    </ul>
    <h5>
     <a id="13__33">
     </a>
     1.3 转换关系
    </h5>
    <p>
     我们在项目中使用到的三者之间转换关系是：
     <mark>
      OMML -&gt; MathML -&gt; LaTex
     </mark>
     <br/>
     Office在安装目录中提供了将OMML转为MathML的xsl工具：MML2OMML.XSL
     <br/>
     MathML转LaTex使用网上找到另一个xsl工具
     <a href="https://sourceforge.net/projects/xsltml/files/xsltml/" rel="nofollow">
      mmltex.xsl
     </a>
     。
    </p>
    <h4>
     <a id="office_39">
     </a>
     二、代码实现office公式解析
    </h4>
    <p>
     <mark>
      首先要说明我们的功能限制：只针对Office2011及以上的Office Open Xml文档，Word和Excel均可。
      <br/>
      这里用Word文档为例子来说明解析过程。
     </mark>
    </p>
    <h5>
     <a id="21__pom_43">
     </a>
     2.1 引入pom包
    </h5>
    <p>
     pom…xml引入office接续所需jar
    </p>
    <pre><code class="prism language-java"><span class="token generics function"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>cn<span class="token punctuation">.</span>afterturn<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>easypoi<span class="token operator">-</span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">4.2</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>exclusions<span class="token punctuation">&gt;</span></span>
                <span class="token generics function"><span class="token punctuation">&lt;</span>exclusion<span class="token punctuation">&gt;</span></span>
                    <span class="token generics function"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
                    <span class="token generics function"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>poi<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>exclusion<span class="token operator">&gt;</span>
                <span class="token generics function"><span class="token punctuation">&lt;</span>exclusion<span class="token punctuation">&gt;</span></span>
                    <span class="token generics function"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
                    <span class="token generics function"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>poi<span class="token operator">-</span>ooxml<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>exclusion<span class="token operator">&gt;</span>
                <span class="token generics function"><span class="token punctuation">&lt;</span>exclusion<span class="token punctuation">&gt;</span></span>
                    <span class="token generics function"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
                    <span class="token generics function"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>poi<span class="token operator">-</span>ooxml<span class="token operator">-</span>schemas<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>exclusion<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>exclusions<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mvnrepository<span class="token punctuation">.</span>com<span class="token operator">/</span>artifact<span class="token operator">/</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token operator">/</span>poi<span class="token operator">-</span>ooxml<span class="token operator">-</span>schemas <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token generics function"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>poi<span class="token operator">-</span>ooxml<span class="token operator">-</span>schemas<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">4.0</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mvnrepository<span class="token punctuation">.</span>com<span class="token operator">/</span>artifact<span class="token operator">/</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token operator">/</span>poi<span class="token operator">-</span>ooxml <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token generics function"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>poi<span class="token operator">-</span>ooxml<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">4.0</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mvnrepository<span class="token punctuation">.</span>com<span class="token operator">/</span>artifact<span class="token operator">/</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token operator">/</span>ooxml<span class="token operator">-</span>schemas <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token generics function"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>ooxml<span class="token operator">-</span>schemas<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.4</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mvnrepository<span class="token punctuation">.</span>com<span class="token operator">/</span>artifact<span class="token operator">/</span>dom4j<span class="token operator">/</span>dom4j <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token generics function"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>dom4j<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>dom4j<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.6</span><span class="token number">.1</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mvnrepository<span class="token punctuation">.</span>com<span class="token operator">/</span>artifact<span class="token operator">/</span>jaxen<span class="token operator">/</span>jaxen <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token generics function"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>jaxen<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>jaxen<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.1</span><span class="token number">.6</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre>
    <h5>
     <a id="22___98">
     </a>
     2.2 导入解析所需工具
    </h5>
    <p>
     将上面下载的资源文件拷贝到项目resources/conventer下，如图：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/eb20ca3d418551d85505c2f2e47f90ae.png"/>
    </p>
    <h5>
     <a id="23__office_102">
     </a>
     2.3 编写代码解析office公式
    </h5>
    <pre><code class="prism language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>hanergy<span class="token punctuation">.</span>out<span class="token punctuation">.</span>utils<span class="token punctuation">;</span>

<span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token punctuation">.</span>xwpf<span class="token punctuation">.</span>usermodel<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span>Document<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span>DocumentException<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span>Element<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span>io<span class="token punctuation">.</span>SAXReader<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>openxmlformats<span class="token punctuation">.</span>schemas<span class="token punctuation">.</span>wordprocessingml<span class="token punctuation">.</span>x2006<span class="token punctuation">.</span>main<span class="token punctuation">.</span>CTP<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span>MultipartFile<span class="token punctuation">;</span>


<span class="token keyword">import</span> javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>StreamResult<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>StreamSource<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>ArrayList<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>


<span class="token comment">/**
 * word内容段落、公式xml标签
 * 正常文本：
 * &lt;w:r&gt; 标签对应一个 XWPFRun对象
 * &lt;w:t xml:space=“preserve”&gt; 标签对应一段在 Word中的字符（也可以是一个字符）
 * 公式：
 * &lt;w:object&gt; 标签对应一个公式（当然我们这里只讲公式，此标签中也可以是一个 Excel也可以是一个 PPT等等）
 * &lt;v:shape&gt; 标签中有个 style属性，这里 style就是图片在 Word中显示的宽高
 * &lt;v:imagedata&gt; 标签关联着显示的图片（ &lt;v:imagedata&gt;为 &lt;v:shape&gt;子标签）
 * &lt;o:OLEObject&gt;标签关联着图片显示公式对应的二进制文件（二进制文件也是最重要的文件，没有这个文件当你在word中双击时，是打不开第三方公式插件的）
 *
 */</span>
<span class="token comment">/**
 * @description:
 * @author: Han LiDong
 * @create: 2021/5/7 10:33
 * @update: 2021/5/7 10:33
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WordUtil</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
<span class="token comment">//        MultipartFile file = null;</span>
<span class="token comment">//        InputStream inputStream = file.getInputStream();</span>
        <span class="token comment">// 所有公式latex表达式集合,借助mathJax可以在页面上进行展示</span>
        List <span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> formulas <span class="token operator">=</span> <span class="token function">getFormulaMap</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"C:\\D\\算法-β系数.docx"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"解析到{}个公式"</span><span class="token punctuation">,</span>formulas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// word解析 公式+文本</span>
        <span class="token function">wordAnalysis</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"C:\\D\\算法-β系数.docx"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

    <span class="token comment">/**
     * word所有内容解析(公式、文本）
     * @param inputStream
     * @throws Exception
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">wordAnalysis</span><span class="token punctuation">(</span>InputStream inputStream<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
        XWPFDocument word <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XWPFDocument</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>IBodyElement ibodyelement <span class="token operator">:</span> word<span class="token punctuation">.</span><span class="token function">getBodyElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ibodyelement<span class="token punctuation">.</span><span class="token function">getElementType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>BodyElementType<span class="token punctuation">.</span>PARAGRAPH<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">//段落</span>
                    XWPFParagraph paragraph <span class="token operator">=</span> <span class="token punctuation">(</span>XWPFParagraph<span class="token punctuation">)</span> ibodyelement<span class="token punctuation">;</span>
                    <span class="token comment">//段落解析</span>
                    String paragraphStr <span class="token operator">=</span> <span class="token function">parseParagraph</span><span class="token punctuation">(</span>paragraph<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ibodyelement<span class="token punctuation">.</span><span class="token function">getElementType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>BodyElementType<span class="token punctuation">.</span>TABLE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>   <span class="token comment">//表格</span>
                    XWPFTable table <span class="token operator">=</span> <span class="token punctuation">(</span>XWPFTable<span class="token punctuation">)</span> ibodyelement<span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span>XWPFTableRow row <span class="token operator">:</span> table<span class="token punctuation">.</span><span class="token function">getRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">//行</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span>XWPFTableCell cell <span class="token operator">:</span> row<span class="token punctuation">.</span><span class="token function">getTableCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>    <span class="token comment">//cell</span>
                            List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> cellMath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">for</span> <span class="token punctuation">(</span>XWPFParagraph paragraph <span class="token operator">:</span> cell<span class="token punctuation">.</span><span class="token function">getParagraphs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">//段落</span>
                                <span class="token comment">//cell段落解析</span>
                                String paragraphStr <span class="token operator">=</span> <span class="token function">parseParagraph</span><span class="token punctuation">(</span>paragraph<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>paragraphStr<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                                    cellMath<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>paragraphStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"当前cell有{}个公式"</span><span class="token punctuation">,</span>cellMath<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            word<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 解析word中公式（转换成latex表达式）
     *
     * @param inputStream  文件流
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> <span class="token function">getFormulaMap</span><span class="token punctuation">(</span>InputStream inputStream<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> DocumentException <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//XWPFDocument xwpfDocument = new XWPFDocument(inputStream);</span>
        Map<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        XWPFDocument word <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XWPFDocument</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//storing the found MathML in a AllayList of strings</span>
        List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> mathMLList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>IBodyElement ibodyelement <span class="token operator">:</span> word<span class="token punctuation">.</span><span class="token function">getBodyElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ibodyelement<span class="token punctuation">.</span><span class="token function">getElementType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>BodyElementType<span class="token punctuation">.</span>PARAGRAPH<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">//段落</span>
                    XWPFParagraph paragraph <span class="token operator">=</span> <span class="token punctuation">(</span>XWPFParagraph<span class="token punctuation">)</span> ibodyelement<span class="token punctuation">;</span>
                    <span class="token comment">//段落解析</span>
                    List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> mathList <span class="token operator">=</span> <span class="token function">parseMathParagraph</span><span class="token punctuation">(</span>paragraph<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mathMLList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>mathList<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ibodyelement<span class="token punctuation">.</span><span class="token function">getElementType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>BodyElementType<span class="token punctuation">.</span>TABLE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//woed表格</span>
                    XWPFTable table <span class="token operator">=</span> <span class="token punctuation">(</span>XWPFTable<span class="token punctuation">)</span> ibodyelement<span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span>XWPFTableRow row <span class="token operator">:</span> table<span class="token punctuation">.</span><span class="token function">getRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span>XWPFTableCell cell <span class="token operator">:</span> row<span class="token punctuation">.</span><span class="token function">getTableCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> cellMath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">for</span> <span class="token punctuation">(</span>XWPFParagraph paragraph <span class="token operator">:</span> cell<span class="token punctuation">.</span><span class="token function">getParagraphs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                <span class="token comment">//cell段落解析</span>
                                List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> mathList <span class="token operator">=</span> <span class="token function">parseMathParagraph</span><span class="token punctuation">(</span>paragraph<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                mathMLList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>mathList<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token comment">//cellMath.addAll(mathList);</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            word<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"当前文档一共有{}个公式"</span><span class="token punctuation">,</span>mathMLList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> mathMLList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 公式段落解析
     * @param xwpfParagraph
     * @throws DocumentException
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> <span class="token function">parseMathParagraph</span><span class="token punctuation">(</span>XWPFParagraph xwpfParagraph<span class="token punctuation">)</span> <span class="token keyword">throws</span> DocumentException <span class="token punctuation">{<!-- --></span>
        CTP ctp <span class="token operator">=</span> xwpfParagraph<span class="token punctuation">.</span><span class="token function">getCTP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String xmlText <span class="token operator">=</span> ctp<span class="token punctuation">.</span><span class="token function">xmlText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        List<span class="token operator">&lt;</span>String <span class="token operator">&gt;</span> mathList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>xmlText<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"&lt;m:oMath&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//得到根节点的值</span>
            SAXReader saxReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SAXReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//将String类型的字符串转换成XML文本对象</span>
            Document doc <span class="token operator">=</span> saxReader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>xmlText<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Element root <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getRootElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 一个段落多个表达式解析</span>
            List<span class="token generics function"><span class="token punctuation">&lt;</span>Element<span class="token punctuation">&gt;</span></span> omMaths <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"//m:oMath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//用xpath得到OMML节点</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>Element ele <span class="token operator">:</span> omMaths<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">/**
                 * OMML -&gt; MathML -&gt; LaTex
                 * Office在安装目录中提供了将OMML转为MathML的xsl工具：MML2OMML.XSL
                 * MathML转LaTex使用网上找到另一个xsl工具mmltex.xsl。
                 */</span>
                String xml <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">asXML</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//xml转 mathml</span>
                String mml <span class="token operator">=</span> <span class="token function">convertOMML2MML</span><span class="token punctuation">(</span>xml<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//mathml转latx</span>
                String latex <span class="token operator">=</span> <span class="token function">convertMML2Latex</span><span class="token punctuation">(</span>mml<span class="token punctuation">)</span><span class="token punctuation">;</span>
                mathList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>latex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"late表达式：{}"</span> <span class="token punctuation">,</span> latex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> mathList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 段落解析
     * @param xwpfParagraph
     * @throws DocumentException
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">parseParagraph</span><span class="token punctuation">(</span>XWPFParagraph xwpfParagraph<span class="token punctuation">)</span> <span class="token keyword">throws</span> DocumentException <span class="token punctuation">{<!-- --></span>
        CTP ctp <span class="token operator">=</span> xwpfParagraph<span class="token punctuation">.</span><span class="token function">getCTP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String xmlText <span class="token operator">=</span> ctp<span class="token punctuation">.</span><span class="token function">xmlText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        StringBuilder sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        if (xmlText.contains("&lt;m:oMath&gt;")) {<!-- --></span>

        <span class="token comment">//段落文本内容</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>xwpfParagraph<span class="token punctuation">.</span><span class="token function">getParagraphText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//段落公式解析</span>
        <span class="token comment">//得到根节点的值</span>
        SAXReader saxReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SAXReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//将String类型的字符串转换成XML文本对象</span>
        Document doc <span class="token operator">=</span> saxReader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>xmlText<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Element root <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getRootElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 一个段落多个表达式解析</span>
        List<span class="token generics function"><span class="token punctuation">&lt;</span>Element<span class="token punctuation">&gt;</span></span> omMaths <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"//m:oMath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//用xpath得到OMML节点</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>omMaths <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>omMaths<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>Element ele <span class="token operator">:</span> omMaths<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">/**
                 * OMML -&gt; MathML -&gt; LaTex
                 * Office在安装目录中提供了将OMML转为MathML的xsl工具：MML2OMML.XSL
                 * MathML转LaTex使用网上找到另一个xsl工具mmltex.xsl。
                 */</span>
                String xml <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">asXML</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//xml转 mathml</span>
                String mathml <span class="token operator">=</span> <span class="token function">convertOMML2MML</span><span class="token punctuation">(</span>xml<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//mathml转latx</span>
                String latex <span class="token operator">=</span> <span class="token function">convertMML2Latex</span><span class="token punctuation">(</span>mathml<span class="token punctuation">)</span><span class="token punctuation">;</span>
                sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>latex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"latex表达式：{}"</span><span class="token punctuation">,</span>latex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"公式个数：{},解析内容：{}"</span><span class="token punctuation">,</span>omMaths<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Description: xsl转换器&lt;/p&gt;
     * @param s  公式xml字符串
     * @param xslpath   转换器路径
     * @param uriResolver xls依赖文件
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">xslConvert</span><span class="token punctuation">(</span>String s<span class="token punctuation">,</span> String xslpath<span class="token punctuation">,</span> URIResolver uriResolver<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        TransformerFactory tFac <span class="token operator">=</span> TransformerFactory<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>uriResolver <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            tFac<span class="token punctuation">.</span><span class="token function">setURIResolver</span><span class="token punctuation">(</span>uriResolver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        StreamSource xslSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StreamSource</span><span class="token punctuation">(</span>WordUtil<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>xslpath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        StringWriter writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            Transformer t <span class="token operator">=</span> tFac<span class="token punctuation">.</span><span class="token function">newTransformer</span><span class="token punctuation">(</span>xslSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Source source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StreamSource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringReader</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Result result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StreamResult</span><span class="token punctuation">(</span>writer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TransformerException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> writer<span class="token punctuation">.</span><span class="token function">getBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * &lt;p&gt;Description: 将mathml转为latx &lt;/p&gt;
     * @param mml mathml字符串
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">convertMML2Latex</span><span class="token punctuation">(</span>String mml<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        mml <span class="token operator">=</span> mml<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>mml<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"?&gt;"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> mml<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//去掉xml的头节点</span>
        URIResolver r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URIResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>  <span class="token comment">//设置xls依赖文件的路径</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> Source <span class="token function">resolve</span><span class="token punctuation">(</span>String href<span class="token punctuation">,</span> String base<span class="token punctuation">)</span> <span class="token keyword">throws</span> TransformerException <span class="token punctuation">{<!-- --></span>
                File f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"/conventer/mml2tex/"</span> <span class="token operator">+</span> href<span class="token punctuation">)</span><span class="token punctuation">;</span>
                InputStream inputStream <span class="token operator">=</span> WordUtil<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"/conventer/mml2tex/"</span> <span class="token operator">+</span> href<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StreamSource</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        String latex <span class="token operator">=</span> <span class="token function">xslConvert</span><span class="token punctuation">(</span>mml<span class="token punctuation">,</span> <span class="token string">"/conventer/mml2tex/mmltex.xsl"</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>latex <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> latex<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            latex <span class="token operator">=</span> latex<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> latex<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> latex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * &lt;p&gt;Description: office xml转为mathml &lt;/p&gt;
     * @param xml  公式xml
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">convertOMML2MML</span><span class="token punctuation">(</span>String xml<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 进行转换的过程中需要借助这个文件,一般来说本机安装office就会有这个文件,找到就可以</span>
        String result <span class="token operator">=</span> <span class="token function">xslConvert</span><span class="token punctuation">(</span>xml<span class="token punctuation">,</span> <span class="token string">"/conventer/OMML2MML.XSL"</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      最终运行结果如图：
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/180f5cac7890147736f44fb52cdf42c1.png"/>
    </p>
    <ul>
     <li>
      word文档示例
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c3e8c2ea57c71202aa26cfcc0fc7567a.png"/>
     </li>
     <li>
      在线解析latex表达式
      <br/>
      从程序运行果果中拷贝一个latex表达式在线解析：x=\frac{-b\pm \sqrt{
      <!-- -->
      {b}^{2}-4ac}}{2a}
      <br/>
      在线解析网址：
      <a href="https://latex.91maths.com/" rel="nofollow">
       https://latex.91maths.com/
      </a>
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9a54bf5d470a8efc4e296d52c4f14717.png"/>
    </p>
    <p>
     参考博客：
     <br/>
     <a href="https://blog.csdn.net/qq_41536778/article/details/108454415">
      https://blog.csdn.net/qq_41536778/article/details/108454415
     </a>
     <br/>
     <a href="https://www.cnblogs.com/wadmwz/p/10460033.html" rel="nofollow">
      https://www.cnblogs.com/wadmwz/p/10460033.html
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f68616e3934393431373134302f:61727469636c652f64657461696c732f313136353231303133" class_="artid" style="display:none">
 </p>
</div>


