---
layout: post
title: "QT连接SQL-Server数据库,并查询显示其中的数据"
date: 2024-12-10 00:12:58 +0800
description: "//连接SQL数据库void OpenDatabase(){    QSqlDatabase db="
keywords: "qt获取vscode的sql数据库的温度并显示"
categories: ['Qt']
tags: ['无标签']
artid: "51247752"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=51247752
    alt: "QT连接SQL-Server数据库,并查询显示其中的数据"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     QT连接SQL Server数据库，并查询显示其中的数据
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#808000">//连接SQL数据库</span></pre>
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#808000">void</span><span style="color:#c0c0c0"> </span>OpenDatabase()</pre>
    <pre style="margin-top:0px; margin-bottom:0px">{<!-- --></pre>
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">    </span><span style="color:#800080">QSqlDatabase</span><span style="color:#c0c0c0"> </span>db=<span style="color:#800080">QSqlDatabase</span>::addDatabase(<span style="color:#008000">"QODBC"</span>);</pre>
    <pre style="margin-top:0px; margin-bottom:0px"></pre>
    <pre style="margin-top:0px; margin-bottom:0px"></pre>
    <pre style="margin-top:0px; margin-bottom:0px"></pre>
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">    </span>db.setDatabaseName(<span style="color:#800080">QString</span>(<span style="color:#008000">"DRIVER={SQL</span><span style="color:#c0c0c0"> </span><span style="color:#008000">SERVER};"</span></pre>
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">                               </span><span style="color:#008000">"SERVER=%1;"</span><span style="color:#c0c0c0"> </span><span style="color:#008000">//服务器名称</span></pre>
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">                               </span><span style="color:#008000">"DATABASE=%2;"//数据库名</span></pre>
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">                               </span><span style="color:#008000">"UID=%3;"</span><span style="color:#c0c0c0">           </span><span style="color:#008000">//登录名</span></pre>
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">                               </span><span style="color:#008000">"PWD=%4;"</span><span style="color:#c0c0c0">        </span><span style="color:#008000">//密码</span></pre>
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">                               </span>).arg(<span style="color:#008000">"192.168.6.113"</span>)<span style="color:#008000">//服务器名称</span></pre>
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">                       </span>.arg(<span style="color:#008000">"TSOMV2"</span>)<span style="color:#008000">//数据库名</span></pre>
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">                       </span>.arg(<span style="color:#008000">"sa"</span>)<span style="color:#008000">//登录名</span></pre>
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">                       </span>.arg(<span style="color:#008000">"123456"</span>)<span style="color:#008000">//密码</span></pre>
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">                       </span>);</pre>
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">    </span><span style="color:#808000">if</span><span style="color:#c0c0c0"> </span>(!db.open())</pre>
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">    </span>{<!-- --></pre>
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">        </span><span style="color:#800080">QMessageBox</span>::critical(<span style="color:#000080">0</span>,<span style="color:#c0c0c0"> </span><span style="color:#000080">qApp</span>-&gt;tr(<span style="color:#008000">"Cannot</span><span style="color:#c0c0c0"> </span><span style="color:#008000">open</span><span style="color:#c0c0c0"> </span><span style="color:#008000">database"</span>),</pre>
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">                              </span>db.lastError().databaseText(),<span style="color:#c0c0c0"> </span><span style="color:#800080">QMessageBox</span>::<span style="color:#800080">Cancel</span>);</pre>
    <pre style="margin-top:0px; margin-bottom:0px"></pre>
    <pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">    </span>}</pre>
    <pre style="margin-top:0px; margin-bottom:0px">}</pre>
    <pre style="margin-top:0px; margin-bottom:0px">
</pre>
    <pre style="margin-top:0px; margin-bottom:0px">//查询数据库中的数据，并显示</pre>
    <pre style="margin-top:0px; margin-bottom:0px">
</pre>
    <pre style="margin-top:0px; margin-bottom:0px"><pre style="margin-top:0px; margin-bottom:0px"><span style="color:#808000">void</span><span style="color:#c0c0c0"> </span><span style="color:#800080">MainWindow</span>::on_pushButton_clicked()</pre><pre style="margin-top:0px; margin-bottom:0px">{<!-- --></pre><pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">    </span><span style="color:#800080">QSqlQueryModel</span><span style="color:#c0c0c0"> </span>*model<span style="color:#c0c0c0"> </span>=<span style="color:#c0c0c0"> </span><span style="color:#808000">new</span><span style="color:#c0c0c0"> </span><span style="color:#800080">QSqlQueryModel</span>;</pre><pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">        </span>model-&gt;setQuery(<span style="color:#008000">"select</span><span style="color:#c0c0c0"> </span><span style="color:#008000">*</span><span style="color:#c0c0c0"> </span><span style="color:#008000">from</span><span style="color:#c0c0c0"> </span><span style="color:#008000">dbo.T_TsInfo"</span>);<span style="color:#008000">//这里直接设置SQL语句，忽略最后一个参数</span></pre><pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">        </span><span style="color:#800000">ui</span>-&gt;<span style="color:#800000">tableView</span>-&gt;<span style="font-style:italic">setModel</span>(model);</pre><pre style="margin-top:0px; margin-bottom:0px"></pre><pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">        </span><span style="color:#008000">//以下是视觉方面的效果，不加也没影响</span></pre><pre style="margin-top:0px; margin-bottom:0px"></pre><pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">        </span><span style="color:#008000">//隔行变色</span></pre><pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">        </span><span style="color:#800000">ui</span>-&gt;<span style="color:#800000">tableView</span>-&gt;setAlternatingRowColors(<span style="color:#808000">true</span>);</pre><pre style="margin-top:0px; margin-bottom:0px"></pre><pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">        </span><span style="color:#008000">//设置行高</span></pre><pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">        </span><span style="color:#808000">int</span><span style="color:#c0c0c0"> </span>row_count<span style="color:#c0c0c0"> </span>=<span style="color:#c0c0c0"> </span>model-&gt;<span style="font-style:italic">rowCount</span>();</pre><pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">        </span><span style="color:#808000">for</span>(<span style="color:#808000">int</span><span style="color:#c0c0c0"> </span>i<span style="color:#c0c0c0"> </span>=<span style="color:#000080">0</span>;<span style="color:#c0c0c0"> </span>i<span style="color:#c0c0c0"> </span>&lt;<span style="color:#c0c0c0"> </span>row_count;<span style="color:#c0c0c0"> </span>i++)</pre><pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">        </span>{<!-- --></pre><pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">            </span><span style="color:#800000">ui</span>-&gt;<span style="color:#800000">tableView</span>-&gt;setRowHeight(i,<span style="color:#c0c0c0"> </span><span style="color:#000080">20</span>);</pre><pre style="margin-top:0px; margin-bottom:0px"><span style="color:#c0c0c0">        </span>}</pre><pre style="margin-top:0px; margin-bottom:0px">}</pre><br/></pre>
    <pre style="margin-top:0px; margin-bottom:0px">//运行，显示效果</pre>
    <pre style="margin-top:0px; margin-bottom:0px">
</pre>
    <pre style="margin-top:0px; margin-bottom:0px"><img alt="" src="https://img-blog.csdn.net/20160426091917650?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
</img></pre>
    <pre style="margin-top:0px; margin-bottom:0px">
</pre>
    <pre style="margin-top:0px; margin-bottom:0px">
</pre>
    <pre style="margin-top:0px; margin-bottom:0px">//源码下载链接：http://download.csdn.net/detail/liangzhuangdongtou/9502155</pre>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e6373:646e2e6e65742f6c69616e677a6875616e67646f6e67746f75:2f61727469636c652f64657461696c732f3531323437373532" class_="artid" style="display:none">
 </p>
</div>


