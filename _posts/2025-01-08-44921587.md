---
layout: post
title: H2数据库
date: 2025-01-08 17:16:22 +0800
description: 文章浏览阅读6.6k次。H2作为一个嵌入型的数据库，它最大的好处就是可以嵌入到我们的Web应用中，和
keywords: h2 alias
categories: ['未分类']
tags: ['无标签']
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=44921587
  alt: H2数据库
artid: 44921587
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     H2数据库
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     H2作为一个嵌入型的数据库，它最大的好处就是可以嵌入到我们的Web应用中，和我们的Web应用绑定在一起，成为我们Web应用的一部分。下面来演示一下如何将H2数据库嵌入到我们的Web应用中。
    </p>
    <p>
     <br/>
    </p>
    <p>
    </p>
    <h3 id="blogTitle3">
     二、在Java中操作H2数据库
    </h3>
    <h4 id="blogTitle4">
     2.1、以嵌入式(本地)连接方式连接H2数据库
    </h4>
    <p>
    </p>
    <p>
     这种连接方式默认情况下只允许有一个客户端连接到H2数据库，有客户端连接到H2数据库之后，此时数据库文件就会被锁定，那么其他客户端就无法再连接了。
    </p>
    <p>
     连接语法：jdbc:h2:[file:][&lt;path&gt;]&lt;databaseName&gt;
    </p>
    <p>
     例如：
     <br/>
     jdbc:h2:~/test //连接位于用户目录下的test数据库
     <br/>
     jdbc:h2:file:/data/sample
     <br/>
     jdbc:h2:file:E:/H2/gacl(Windows only)
    </p>
    <p>
     编写测试代码，如下：
    </p>
    <div class="cnblogs_code">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
     <pre><span style="color:#008080"> 1</span> <span style="color:#008000">/**</span>
<span style="color:#008080"> 2</span> <span style="color:#008000"> * 
</span><span style="color:#008080"> 3</span>  <span style="color:#008000">*/</span>
<span style="color:#008080"> 4</span> <span style="color:#0000ff">package</span> jdbc.conn.h2.test;
<span style="color:#008080"> 5</span> 
<span style="color:#008080"> 6</span> <span style="color:#0000ff">import</span> java.sql.Connection;
<span style="color:#008080"> 7</span> <span style="color:#0000ff">import</span> java.sql.DriverManager;
<span style="color:#008080"> 8</span> <span style="color:#0000ff">import</span> java.sql.ResultSet;
<span style="color:#008080"> 9</span> <span style="color:#0000ff">import</span> java.sql.Statement;
<span style="color:#008080">10</span> <span style="color:#0000ff">import</span> java.util.UUID;
<span style="color:#008080">11</span> 
<span style="color:#008080">12</span> <span style="color:#008000">/**</span>
<span style="color:#008080">13</span> <span style="color:#008000"> * &lt;p&gt;ClassName: H2ConnTest1&lt;p&gt;
</span><span style="color:#008080">14</span> <span style="color:#008000"> * &lt;p&gt;Description: Java通过JDBC方式连接H2数据库&lt;p&gt;
</span><span style="color:#008080">15</span> <span style="color:#008000"> * </span><span style="color:#808080">@author</span><span style="color:#008000"> xudp
</span><span style="color:#008080">16</span> <span style="color:#008000"> * </span><span style="color:#808080">@version</span><span style="color:#008000"> 1.0 V
</span><span style="color:#008080">17</span> <span style="color:#008000"> * @createTime 2014-12-18 上午11:22:12
</span><span style="color:#008080">18</span>  <span style="color:#008000">*/</span>
<span style="color:#008080">19</span> <span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> H2ConnTest1 {
<span style="color:#008080">20</span>     <span style="color:#008000">//</span><span style="color:#008000">数据库连接URL，当前连接的是E:/H2目录下的gacl数据库</span>
<span style="color:#008080">21</span>     <span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">final</span> String JDBC_URL = "jdbc:h2:E:/H2/gacl";
<span style="color:#008080">22</span>     <span style="color:#008000">//</span><span style="color:#008000">连接数据库时使用的用户名</span>
<span style="color:#008080">23</span>     <span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">final</span> String USER = "gacl";
<span style="color:#008080">24</span>     <span style="color:#008000">//</span><span style="color:#008000">连接数据库时使用的密码</span>
<span style="color:#008080">25</span>     <span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">final</span> String PASSWORD = "123";
<span style="color:#008080">26</span>     <span style="color:#008000">//</span><span style="color:#008000">连接H2数据库时使用的驱动类，org.h2.Driver这个类是由H2数据库自己提供的，在H2数据库的jar包中可以找到</span>
<span style="color:#008080">27</span>     <span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">final</span> String DRIVER_CLASS="org.h2.Driver";
<span style="color:#008080">28</span>     
<span style="color:#008080">29</span>     <span style="color:#0000ff">public</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">void</span> main(String[] args) <span style="color:#0000ff">throws</span> Exception {
<span style="color:#008080">30</span>         <span style="color:#008000">//</span><span style="color:#008000"> 加载H2数据库驱动</span>
<span style="color:#008080">31</span>         Class.forName(DRIVER_CLASS);
<span style="color:#008080">32</span>         <span style="color:#008000">//</span><span style="color:#008000"> 根据连接URL，用户名，密码获取数据库连接</span>
<span style="color:#008080">33</span>         Connection conn = DriverManager.getConnection(JDBC_URL, USER, PASSWORD);
<span style="color:#008080">34</span>         Statement stmt = conn.createStatement();
<span style="color:#008080">35</span>         <span style="color:#008000">//</span><span style="color:#008000">如果存在USER_INFO表就先删除USER_INFO表</span>
<span style="color:#008080">36</span>         stmt.execute("DROP TABLE IF EXISTS USER_INFO");
<span style="color:#008080">37</span>         <span style="color:#008000">//</span><span style="color:#008000">创建USER_INFO表</span>
<span style="color:#008080">38</span>         stmt.execute("CREATE TABLE USER_INFO(id VARCHAR(36) PRIMARY KEY,name VARCHAR(100),sex VARCHAR(4))");
<span style="color:#008080">39</span>         <span style="color:#008000">//</span><span style="color:#008000">新增</span>
<span style="color:#008080">40</span>         stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','大日如来','男')");
<span style="color:#008080">41</span>         stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','青龙','男')");
<span style="color:#008080">42</span>         stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','白虎','男')");
<span style="color:#008080">43</span>         stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','朱雀','女')");
<span style="color:#008080">44</span>         stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','玄武','男')");
<span style="color:#008080">45</span>         stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','苍狼','男')");
<span style="color:#008080">46</span>         <span style="color:#008000">//</span><span style="color:#008000">删除</span>
<span style="color:#008080">47</span>         stmt.executeUpdate("DELETE FROM USER_INFO WHERE name='大日如来'");
<span style="color:#008080">48</span>         <span style="color:#008000">//</span><span style="color:#008000">修改</span>
<span style="color:#008080">49</span>         stmt.executeUpdate("UPDATE USER_INFO SET name='孤傲苍狼' WHERE name='苍狼'");
<span style="color:#008080">50</span>         <span style="color:#008000">//</span><span style="color:#008000">查询</span>
<span style="color:#008080">51</span>         ResultSet rs = stmt.executeQuery("SELECT * FROM USER_INFO");
<span style="color:#008080">52</span>         <span style="color:#008000">//</span><span style="color:#008000">遍历结果集</span>
<span style="color:#008080">53</span>         <span style="color:#0000ff">while</span> (rs.next()) {
<span style="color:#008080">54</span>             System.out.println(rs.getString("id") + "," + rs.getString("name")+ "," + rs.getString("sex"));
<span style="color:#008080">55</span>         }
<span style="color:#008080">56</span>         <span style="color:#008000">//</span><span style="color:#008000">释放资源</span>
<span style="color:#008080">57</span>         stmt.close();
<span style="color:#008080">58</span>         <span style="color:#008000">//</span><span style="color:#008000">关闭连接</span>
<span style="color:#008080">59</span>         conn.close();
<span style="color:#008080">60</span>     }
<span style="color:#008080">61</span> }</pre>
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
    </div>
    <p>
     执行结果如下：
    </p>
    <p>
     <img alt="" src="" style="border:1px solid black"/>
    </p>
    <p>
     登录到H2控制台当中也可以看到创建好的USER_INFO表和表里面的数据，如下图所示：
    </p>
    <p>
     <img alt="" src="" style="border:1px solid black"/>
    </p>
    <p>
     这里需要说明一下使用这种"jdbc:h2:E:/H2/gacl"这种方式连接H2数据库容易遇到的问题，如果已经在H2的WebConsole控制台中登录gacl数据库，如下图所示：
    </p>
    <p>
     <img alt="" src=""/>
    </p>
    <p>
     此时gacl数据库就会被锁定，此时通过java代码连接gacl数据库时就会出现如下的错误，如所示：
    </p>
    <div class="cnblogs_code">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
     <pre><span style="color:#008080"> 1</span> Exception in thread "main" org.h2.jdbc.JdbcSQLException: Database may be already in use: "E:/H2/gacl.mv.db". Possible solutions: close all other connection(s); use the server mode [90020-183]
<span style="color:#008080"> 2</span>     at org.h2.message.DbException.getJdbcSQLException(DbException.java:345)
<span style="color:#008080"> 3</span>     at org.h2.message.DbException.get(DbException.java:168)
<span style="color:#008080"> 4</span>     at org.h2.mvstore.db.MVTableEngine.init(MVTableEngine.java:108)
<span style="color:#008080"> 5</span>     at org.h2.engine.Database.getPageStore(Database.java:2376)
<span style="color:#008080"> 6</span>     at org.h2.engine.Database.open(Database.java:666)
<span style="color:#008080"> 7</span>     at org.h2.engine.Database.openDatabase(Database.java:266)
<span style="color:#008080"> 8</span>     at org.h2.engine.Database.&lt;init&gt;(Database.java:260)
<span style="color:#008080"> 9</span>     at org.h2.engine.Engine.openSession(Engine.java:60)
<span style="color:#008080">10</span>     at org.h2.engine.Engine.openSession(Engine.java:167)
<span style="color:#008080">11</span>     at org.h2.engine.Engine.createSessionAndValidate(Engine.java:145)
<span style="color:#008080">12</span>     at org.h2.engine.Engine.createSession(Engine.java:128)
<span style="color:#008080">13</span>     at org.h2.engine.Engine.createSession(Engine.java:26)
<span style="color:#008080">14</span>     at org.h2.engine.SessionRemote.connectEmbeddedOrServer(SessionRemote.java:347)
<span style="color:#008080">15</span>     at org.h2.jdbc.JdbcConnection.&lt;init&gt;(JdbcConnection.java:108)
<span style="color:#008080">16</span>     at org.h2.jdbc.JdbcConnection.&lt;init&gt;(JdbcConnection.java:92)
<span style="color:#008080">17</span>     at org.h2.Driver.connect(Driver.java:72)
<span style="color:#008080">18</span>     at java.sql.DriverManager.getConnection(DriverManager.java:571)
<span style="color:#008080">19</span>     at java.sql.DriverManager.getConnection(DriverManager.java:215)
<span style="color:#008080">20</span>     at jdbc.conn.h2.test.H2ConnTest1.main(H2ConnTest1.java:33)
<span style="color:#008080">21</span> Caused by: java.lang.IllegalStateException: The file is locked: nio:E:/H2/gacl.mv.db [1.4.183/7]
<span style="color:#008080">22</span>     at org.h2.mvstore.DataUtils.newIllegalStateException(DataUtils.java:768)
<span style="color:#008080">23</span>     at org.h2.mvstore.FileStore.open(FileStore.java:170)
<span style="color:#008080">24</span>     at org.h2.mvstore.MVStore.&lt;init&gt;(MVStore.java:346)
<span style="color:#008080">25</span>     at org.h2.mvstore.MVStore$Builder.open(MVStore.java:2754)
<span style="color:#008080">26</span>     at org.h2.mvstore.db.MVTableEngine$Store.&lt;init&gt;(MVTableEngine.java:162)
<span style="color:#008080">27</span>     at org.h2.mvstore.db.MVTableEngine.init(MVTableEngine.java:98)
<span style="color:#008080">28</span>     ... 16 more</pre>
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
    </div>
    <p>
     引起这个错误的原因是因为gacl数据库对应的文件已经被锁定了，所以java代码这边无法再访问，为了能够让Java代码能够正常访问，必须把WebConsole控制台那边的连接先断开，
    </p>
    <p>
     <img alt="" src=""/>
    </p>
    <p>
     断开数据库连接之后，Java代码这边就可以连接上去了。
    </p>
    <h4 id="blogTitle5">
     2.2、使用TCP/IP的服务器模式(远程连接)方式连接H2数据库(推荐)
    </h4>
    <p>
     这种连接方式就和其他数据库类似了，是基于Service的形式进行连接的，因此允许多个客户端同时连接到H2数据库
    </p>
    <p>
     连接语法：jdbc:h2:tcp://&lt;server&gt;[:&lt;port&gt;]/[&lt;path&gt;]&lt;databaseName&gt;
     <br/>
     范例：jdbc:h2:tcp://localhost/~/test
    </p>
    <p>
     测试代码如下：
    </p>
    <div class="cnblogs_code">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
     <pre><span style="color:#008080"> 1</span> <span style="color:#008000">/**</span>
<span style="color:#008080"> 2</span> <span style="color:#008000"> * 
</span><span style="color:#008080"> 3</span>  <span style="color:#008000">*/</span>
<span style="color:#008080"> 4</span> <span style="color:#0000ff">package</span> jdbc.conn.h2.test;
<span style="color:#008080"> 5</span> 
<span style="color:#008080"> 6</span> <span style="color:#0000ff">import</span> java.sql.Connection;
<span style="color:#008080"> 7</span> <span style="color:#0000ff">import</span> java.sql.DriverManager;
<span style="color:#008080"> 8</span> <span style="color:#0000ff">import</span> java.sql.ResultSet;
<span style="color:#008080"> 9</span> <span style="color:#0000ff">import</span> java.sql.Statement;
<span style="color:#008080">10</span> <span style="color:#0000ff">import</span> java.util.UUID;
<span style="color:#008080">11</span> 
<span style="color:#008080">12</span> <span style="color:#008000">/**</span>
<span style="color:#008080">13</span> <span style="color:#008000"> * &lt;p&gt;ClassName: H2ConnTest1&lt;p&gt;
</span><span style="color:#008080">14</span> <span style="color:#008000"> * &lt;p&gt;Description: Java通过JDBC方式连接H2数据库&lt;p&gt;
</span><span style="color:#008080">15</span> <span style="color:#008000"> * </span><span style="color:#808080">@author</span><span style="color:#008000"> xudp
</span><span style="color:#008080">16</span> <span style="color:#008000"> * </span><span style="color:#808080">@version</span><span style="color:#008000"> 1.0 V
</span><span style="color:#008080">17</span> <span style="color:#008000"> * @createTime 2014-12-18 上午11:22:12
</span><span style="color:#008080">18</span>  <span style="color:#008000">*/</span>
<span style="color:#008080">19</span> <span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> H2ConnTest2 {
<span style="color:#008080">20</span>     <span style="color:#008000">//</span><span style="color:#008000">数据库连接URL，通过使用TCP/IP的服务器模式（远程连接），当前连接的是E:/H2目录下的gacl数据库
</span><span style="color:#008080">21</span>     <span style="color:#008000">//</span><span style="color:#008000">private static final String JDBC_URL = "jdbc:h2:tcp:</span><span style="color:#008000">//</span><span style="color:#008000">localhost/E:/H2/gacl";
</span><span style="color:#008080">22</span>     <span style="color:#008000">//</span><span style="color:#008000">private static final String JDBC_URL = "jdbc:h2:tcp:</span><span style="color:#008000">//</span><span style="color:#008000">127.0.0.1/E:/H2/gacl";</span>
<span style="color:#008080">23</span>     <span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">final</span> String JDBC_URL = "jdbc:h2:tcp://192.168.1.144/data/gacl";
<span style="color:#008080">24</span>     <span style="color:#008000">//</span><span style="color:#008000">连接数据库时使用的用户名</span>
<span style="color:#008080">25</span>     <span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">final</span> String USER = "gacl";
<span style="color:#008080">26</span>     <span style="color:#008000">//</span><span style="color:#008000">连接数据库时使用的密码</span>
<span style="color:#008080">27</span>     <span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">final</span> String PASSWORD = "123";
<span style="color:#008080">28</span>     <span style="color:#008000">//</span><span style="color:#008000">连接H2数据库时使用的驱动类，org.h2.Driver这个类是由H2数据库自己提供的，在H2数据库的jar包中可以找到</span>
<span style="color:#008080">29</span>     <span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">final</span> String DRIVER_CLASS="org.h2.Driver";
<span style="color:#008080">30</span>     
<span style="color:#008080">31</span>     <span style="color:#0000ff">public</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">void</span> main(String[] args) <span style="color:#0000ff">throws</span> Exception {
<span style="color:#008080">32</span>         <span style="color:#008000">//</span><span style="color:#008000"> 加载H2数据库驱动</span>
<span style="color:#008080">33</span>         Class.forName(DRIVER_CLASS);
<span style="color:#008080">34</span>         <span style="color:#008000">//</span><span style="color:#008000"> 根据连接URL，用户名，密码获取数据库连接</span>
<span style="color:#008080">35</span>         Connection conn = DriverManager.getConnection(JDBC_URL, USER, PASSWORD);
<span style="color:#008080">36</span>         Statement stmt = conn.createStatement();
<span style="color:#008080">37</span>         <span style="color:#008000">//</span><span style="color:#008000">如果存在USER_INFO表就先删除USER_INFO表</span>
<span style="color:#008080">38</span>         stmt.execute("DROP TABLE IF EXISTS USER_INFO");
<span style="color:#008080">39</span>         <span style="color:#008000">//</span><span style="color:#008000">创建USER_INFO表</span>
<span style="color:#008080">40</span>         stmt.execute("CREATE TABLE USER_INFO(id VARCHAR(36) PRIMARY KEY,name VARCHAR(100),sex VARCHAR(4))");
<span style="color:#008080">41</span>         <span style="color:#008000">//</span><span style="color:#008000">新增</span>
<span style="color:#008080">42</span>         stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','大日如来','男')");
<span style="color:#008080">43</span>         stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','青龙','男')");
<span style="color:#008080">44</span>         stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','白虎','男')");
<span style="color:#008080">45</span>         stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','朱雀','女')");
<span style="color:#008080">46</span>         stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','玄武','男')");
<span style="color:#008080">47</span>         stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','苍狼','男')");
<span style="color:#008080">48</span>         <span style="color:#008000">//</span><span style="color:#008000">删除</span>
<span style="color:#008080">49</span>         stmt.executeUpdate("DELETE FROM USER_INFO WHERE name='大日如来'");
<span style="color:#008080">50</span>         <span style="color:#008000">//</span><span style="color:#008000">修改</span>
<span style="color:#008080">51</span>         stmt.executeUpdate("UPDATE USER_INFO SET name='孤傲苍狼' WHERE name='苍狼'");
<span style="color:#008080">52</span>         <span style="color:#008000">//</span><span style="color:#008000">查询</span>
<span style="color:#008080">53</span>         ResultSet rs = stmt.executeQuery("SELECT * FROM USER_INFO");
<span style="color:#008080">54</span>         <span style="color:#008000">//</span><span style="color:#008000">遍历结果集</span>
<span style="color:#008080">55</span>         <span style="color:#0000ff">while</span> (rs.next()) {
<span style="color:#008080">56</span>             System.out.println(rs.getString("id") + "," + rs.getString("name")+ "," + rs.getString("sex"));
<span style="color:#008080">57</span>         }
<span style="color:#008080">58</span>         <span style="color:#008000">//</span><span style="color:#008000">释放资源</span>
<span style="color:#008080">59</span>         stmt.close();
<span style="color:#008080">60</span>         <span style="color:#008000">//</span><span style="color:#008000">关闭连接</span>
<span style="color:#008080">61</span>         conn.close();
<span style="color:#008080">62</span>     }
<span style="color:#008080">63</span> }</pre>
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
    </div>
    <h4 id="blogTitle6">
     2.3、H2数据库的内存模式
    </h4>
    <p>
     H2数据库被称为内存数据库，因为它支持在内存中创建数据库和表
    </p>
    <p>
     范例如下：
    </p>
    <div class="cnblogs_code">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
     <pre><span style="color:#008080"> 1</span> <span style="color:#0000ff">package</span> jdbc.conn.h2.test;
<span style="color:#008080"> 2</span> 
<span style="color:#008080"> 3</span> <span style="color:#0000ff">import</span> java.sql.Connection;
<span style="color:#008080"> 4</span> <span style="color:#0000ff">import</span> java.sql.DriverManager;
<span style="color:#008080"> 5</span> <span style="color:#0000ff">import</span> java.sql.ResultSet;
<span style="color:#008080"> 6</span> <span style="color:#0000ff">import</span> java.sql.Statement;
<span style="color:#008080"> 7</span> <span style="color:#0000ff">import</span> java.util.UUID;
<span style="color:#008080"> 8</span> 
<span style="color:#008080"> 9</span> <span style="color:#008000">/**</span>
<span style="color:#008080">10</span> <span style="color:#008000">* @ClassName: TestMemH2
</span><span style="color:#008080">11</span> <span style="color:#008000">* @Description:H2数据库的内存模式（数据只保存在内存中）
</span><span style="color:#008080">12</span> <span style="color:#008000">* </span><span style="color:#808080">@author</span><span style="color:#008000">: 孤傲苍狼
</span><span style="color:#008080">13</span> <span style="color:#008000">* @date: 2014-12-18 下午10:47:01
</span><span style="color:#008080">14</span> <span style="color:#008000">*
</span><span style="color:#008080">15</span> <span style="color:#008000">*/</span> 
<span style="color:#008080">16</span> <span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> TestMemH2 {
<span style="color:#008080">17</span> 
<span style="color:#008080">18</span>         <span style="color:#008000">//</span><span style="color:#008000">数据库连接URL，通过使用TCP/IP的服务器模式（远程连接），当前连接的是内存里面的gacl数据库</span>
<span style="color:#008080">19</span>         <span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">final</span> String JDBC_URL = "jdbc:h2:tcp://localhost/mem:gacl";
<span style="color:#008080">20</span>         <span style="color:#008000">//</span><span style="color:#008000">连接数据库时使用的用户名</span>
<span style="color:#008080">21</span>         <span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">final</span> String USER = "gacl";
<span style="color:#008080">22</span>         <span style="color:#008000">//</span><span style="color:#008000">连接数据库时使用的密码</span>
<span style="color:#008080">23</span>         <span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">final</span> String PASSWORD = "123";
<span style="color:#008080">24</span>         <span style="color:#008000">//</span><span style="color:#008000">连接H2数据库时使用的驱动类，org.h2.Driver这个类是由H2数据库自己提供的，在H2数据库的jar包中可以找到</span>
<span style="color:#008080">25</span>         <span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">final</span> String DRIVER_CLASS="org.h2.Driver";
<span style="color:#008080">26</span>         
<span style="color:#008080">27</span>         <span style="color:#0000ff">public</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">void</span> main(String[] args) <span style="color:#0000ff">throws</span> Exception {
<span style="color:#008080">28</span>             <span style="color:#008000">//</span><span style="color:#008000"> 加载H2数据库驱动</span>
<span style="color:#008080">29</span>             Class.forName(DRIVER_CLASS);
<span style="color:#008080">30</span>             <span style="color:#008000">//</span><span style="color:#008000"> 根据连接URL，用户名，密码获取数据库连接</span>
<span style="color:#008080">31</span>             Connection conn = DriverManager.getConnection(JDBC_URL, USER, PASSWORD);
<span style="color:#008080">32</span>             Statement stmt = conn.createStatement();
<span style="color:#008080">33</span>             <span style="color:#008000">//</span><span style="color:#008000">如果存在USER_INFO表就先删除USER_INFO表</span>
<span style="color:#008080">34</span>             stmt.execute("DROP TABLE IF EXISTS USER_INFO");
<span style="color:#008080">35</span>             <span style="color:#008000">//</span><span style="color:#008000">创建USER_INFO表</span>
<span style="color:#008080">36</span>             stmt.execute("CREATE TABLE USER_INFO(id VARCHAR(36) PRIMARY KEY,name VARCHAR(100),sex VARCHAR(4))");
<span style="color:#008080">37</span>             <span style="color:#008000">//</span><span style="color:#008000">新增</span>
<span style="color:#008080">38</span>             stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','大日如来','男')");
<span style="color:#008080">39</span>             stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','青龙','男')");
<span style="color:#008080">40</span>             stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','白虎','男')");
<span style="color:#008080">41</span>             stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','朱雀','女')");
<span style="color:#008080">42</span>             stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','玄武','男')");
<span style="color:#008080">43</span>             stmt.executeUpdate("INSERT INTO USER_INFO VALUES('" + UUID.randomUUID()+ "','苍狼','男')");
<span style="color:#008080">44</span>             <span style="color:#008000">//</span><span style="color:#008000">删除</span>
<span style="color:#008080">45</span>             stmt.executeUpdate("DELETE FROM USER_INFO WHERE name='大日如来'");
<span style="color:#008080">46</span>             <span style="color:#008000">//</span><span style="color:#008000">修改</span>
<span style="color:#008080">47</span>             stmt.executeUpdate("UPDATE USER_INFO SET name='孤傲苍狼' WHERE name='苍狼'");
<span style="color:#008080">48</span>             <span style="color:#008000">//</span><span style="color:#008000">查询</span>
<span style="color:#008080">49</span>             ResultSet rs = stmt.executeQuery("SELECT * FROM USER_INFO");
<span style="color:#008080">50</span>             <span style="color:#008000">//</span><span style="color:#008000">遍历结果集</span>
<span style="color:#008080">51</span>             <span style="color:#0000ff">while</span> (rs.next()) {
<span style="color:#008080">52</span>                 System.out.println(rs.getString("id") + "," + rs.getString("name")+ "," + rs.getString("sex"));
<span style="color:#008080">53</span>             }
<span style="color:#008080">54</span>             <span style="color:#008000">//</span><span style="color:#008000">释放资源</span>
<span style="color:#008080">55</span>             stmt.close();
<span style="color:#008080">56</span>             <span style="color:#008000">//</span><span style="color:#008000">关闭连接</span>
<span style="color:#008080">57</span>             conn.close();
<span style="color:#008080">58</span>         }
<span style="color:#008080">59</span> }</pre>
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
    </div>
    <p>
     运行结果如下：
    </p>
    <p>
     <img alt="" src="http://images.cnitblog.com/blog/289233/201412/282003387166153.png" style="border:1px solid black"/>
    </p>
    <p>
     注意：如果使用H2数据库的内存模式，那么我们创建的数据库和表都只是保存在内存中，一旦服务器重启，那么内存中的数据库和表就不存在了。
    </p>
    <p>
     以上就是关于在Web应用程序中使用H2数据库的全部内容。
    </p>
    <br/>
    <h3 id="blogTitle0">
     一、搭建测试环境和项目
    </h3>
    <h4 id="blogTitle1">
     1.1、搭建JavaWeb测试项目
    </h4>
    <p>
     创建一个【H2DBTest】JavaWeb项目，找到H2数据库的jar文件，如下图所示：
    </p>
    <p>
     <img alt="" src="" style="border:1px solid black"/>
    </p>
    <p>
     H2数据库就一个jar文件，这个Jar文件里面包含了使用JDBC方式连接H2数据库时使用的驱动类，将"h2-1.4.183.jar"加入到【H2DBTest】项目中，如下图所示：
    </p>
    <p>
     <img alt="" src="" style="border:1px solid black"/>
    </p>
    <h3 id="blogTitle2">
     二、启动H2数据库
    </h3>
    <p>
     既然是要将H2数据库作为我们Web应用的一部分嵌入进来，那么我们就要在Web应用中启动H2数据库的服务，这样我们才能够连接到H2数据库，因此我们可以编写一个专门用于启动H2数据库服务的监听器(Listener)，监听器示例代码如下：
    </p>
    <div class="cnblogs_code">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
     <pre><span style="color:#008080"> 1</span> <span style="color:#0000ff">package</span> me.gacl.web.listener;
<span style="color:#008080"> 2</span> 
<span style="color:#008080"> 3</span> <span style="color:#0000ff">import</span> java.sql.SQLException;
<span style="color:#008080"> 4</span> <span style="color:#0000ff">import</span> javax.servlet.ServletContextEvent;
<span style="color:#008080"> 5</span> <span style="color:#0000ff">import</span> javax.servlet.ServletContextListener;
<span style="color:#008080"> 6</span> <span style="color:#0000ff">import</span> org.h2.tools.Server;
<span style="color:#008080"> 7</span> 
<span style="color:#008080"> 8</span> <span style="color:#008000">/**</span>
<span style="color:#008080"> 9</span> <span style="color:#008000">* @ClassName: H2DBServerStartListener
</span><span style="color:#008080">10</span> <span style="color:#008000">* @Description: 用于启动H2数据库服务的监听器，在应用系统初始化时就启动H2数据库的服务
</span><span style="color:#008080">11</span> <span style="color:#008000">* </span><span style="color:#808080">@author</span><span style="color:#008000">: 孤傲苍狼
</span><span style="color:#008080">12</span> <span style="color:#008000">* @date: 2014-12-20 下午11:43:39
</span><span style="color:#008080">13</span> <span style="color:#008000">*
</span><span style="color:#008080">14</span> <span style="color:#008000">*/</span> 
<span style="color:#008080">15</span> <span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> H2DBServerStartListener <span style="color:#0000ff">implements</span> ServletContextListener {
<span style="color:#008080">16</span> 
<span style="color:#008080">17</span>     <span style="color:#008000">//</span><span style="color:#008000">H2数据库服务器启动实例</span>
<span style="color:#008080">18</span>     <span style="color:#0000ff">private</span> Server server;
<span style="color:#008080">19</span>     <span style="color:#008000">/*</span> 
<span style="color:#008080">20</span> <span style="color:#008000">     * Web应用初始化时启动H2数据库
</span><span style="color:#008080">21</span>      <span style="color:#008000">*/</span>
<span style="color:#008080">22</span>     <span style="color:#0000ff">public</span> <span style="color:#0000ff">void</span> contextInitialized(ServletContextEvent sce) {
<span style="color:#008080">23</span>         <span style="color:#0000ff">try</span> {  
<span style="color:#008080">24</span>             System.out.println("正在启动h2数据库...");
<span style="color:#008080">25</span>             <span style="color:#008000">//</span><span style="color:#008000">使用org.h2.tools.Server这个类创建一个H2数据库的服务并启动服务，由于没有指定任何参数，那么H2数据库启动时默认占用的端口就是8082</span>
<span style="color:#008080">26</span>             server = Server.createTcpServer().start(); 
<span style="color:#008080">27</span>             System.out.println("h2数据库启动成功...");
<span style="color:#008080">28</span>         } <span style="color:#0000ff">catch</span> (SQLException e) {  
<span style="color:#008080">29</span>             System.out.println("启动h2数据库出错：" + e.toString());  
<span style="color:#008080">30</span>             e.printStackTrace();  
<span style="color:#008080">31</span>             <span style="color:#0000ff">throw</span> <span style="color:#0000ff">new</span> RuntimeException(e);  
<span style="color:#008080">32</span>         }  
<span style="color:#008080">33</span>     }
<span style="color:#008080">34</span> 
<span style="color:#008080">35</span>     <span style="color:#008000">/*</span> 
<span style="color:#008080">36</span> <span style="color:#008000">     * Web应用销毁时停止H2数据库
</span><span style="color:#008080">37</span>      <span style="color:#008000">*/</span>
<span style="color:#008080">38</span>     <span style="color:#0000ff">public</span> <span style="color:#0000ff">void</span> contextDestroyed(ServletContextEvent sce) {
<span style="color:#008080">39</span>         <span style="color:#0000ff">if</span> (<span style="color:#0000ff">this</span>.server != <span style="color:#0000ff">null</span>) {
<span style="color:#008080">40</span>             <span style="color:#008000">//</span><span style="color:#008000"> 停止H2数据库</span>
<span style="color:#008080">41</span>             <span style="color:#0000ff">this</span>.server.stop();
<span style="color:#008080">42</span>             <span style="color:#0000ff">this</span>.server = <span style="color:#0000ff">null</span>;
<span style="color:#008080">43</span>         }
<span style="color:#008080">44</span>     }
<span style="color:#008080">45</span> }</pre>
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
    </div>
    <p>
     监听器写好之后，我们在Web.xml文件中注册这个监听器，另外，因为我们要将H2数据库嵌入到我们的Web应用当中，为了能够方便访问H2数据库提供的Console，我们可以在Web.xml文件中配置用于访问H2数据库Console的Servlet。
    </p>
    <p>
     Web.xml文件的配置如下：
    </p>
    <div class="cnblogs_code">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
     <pre><span style="color:#008080"> 1</span> <span style="color:#008000">&lt;!--</span><span style="color:#008000"> 使用监听器启动和停止数据库 </span><span style="color:#008000">--&gt;</span>
<span style="color:#008080"> 2</span>       <span style="color:#0000ff">&lt;</span><span style="color:#800000">listener</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080"> 3</span>         <span style="color:#0000ff">&lt;</span><span style="color:#800000">listener-class</span><span style="color:#0000ff">&gt;</span>me.gacl.web.listener.H2DBServerStartListener<span style="color:#0000ff">&lt;/</span><span style="color:#800000">listener-class</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080"> 4</span>     <span style="color:#0000ff">&lt;/</span><span style="color:#800000">listener</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080"> 5</span>     
<span style="color:#008080"> 6</span>     <span style="color:#008000">&lt;!--</span><span style="color:#008000"> 使用H2控制台的Servlet H2控制台是一个独立的应用程序，包括它自己的Web服务器，但它可以作为一个servlet作为</span><span style="color:#008000">--&gt;</span>
<span style="color:#008080"> 7</span>     <span style="color:#0000ff">&lt;</span><span style="color:#800000">servlet</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080"> 8</span>         <span style="color:#0000ff">&lt;</span><span style="color:#800000">servlet-name</span><span style="color:#0000ff">&gt;</span>H2Console<span style="color:#0000ff">&lt;/</span><span style="color:#800000">servlet-name</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080"> 9</span>         <span style="color:#0000ff">&lt;</span><span style="color:#800000">servlet-class</span><span style="color:#0000ff">&gt;</span>org.h2.server.web.WebServlet<span style="color:#0000ff">&lt;/</span><span style="color:#800000">servlet-class</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080">10</span>          <span style="color:#0000ff">&lt;</span><span style="color:#800000">init-param</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080">11</span>             <span style="color:#0000ff">&lt;</span><span style="color:#800000">param-name</span><span style="color:#0000ff">&gt;</span>webAllowOthers<span style="color:#0000ff">&lt;/</span><span style="color:#800000">param-name</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080">12</span>             <span style="color:#0000ff">&lt;</span><span style="color:#800000">param-value</span><span style="color:#0000ff">&gt;&lt;/</span><span style="color:#800000">param-value</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080">13</span>         <span style="color:#0000ff">&lt;/</span><span style="color:#800000">init-param</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080">14</span>         <span style="color:#0000ff">&lt;</span><span style="color:#800000">init-param</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080">15</span>             <span style="color:#0000ff">&lt;</span><span style="color:#800000">param-name</span><span style="color:#0000ff">&gt;</span>trace<span style="color:#0000ff">&lt;/</span><span style="color:#800000">param-name</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080">16</span>             <span style="color:#0000ff">&lt;</span><span style="color:#800000">param-value</span><span style="color:#0000ff">&gt;&lt;/</span><span style="color:#800000">param-value</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080">17</span>         <span style="color:#0000ff">&lt;/</span><span style="color:#800000">init-param</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080">18</span>         <span style="color:#0000ff">&lt;</span><span style="color:#800000">load-on-startup</span><span style="color:#0000ff">&gt;</span>1<span style="color:#0000ff">&lt;/</span><span style="color:#800000">load-on-startup</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080">19</span>     <span style="color:#0000ff">&lt;/</span><span style="color:#800000">servlet</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080">20</span>     <span style="color:#008000">&lt;!--</span><span style="color:#008000"> 映射H2控制台的访问路径 </span><span style="color:#008000">--&gt;</span>
<span style="color:#008080">21</span>     <span style="color:#0000ff">&lt;</span><span style="color:#800000">servlet-mapping</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080">22</span>         <span style="color:#0000ff">&lt;</span><span style="color:#800000">servlet-name</span><span style="color:#0000ff">&gt;</span>H2Console<span style="color:#0000ff">&lt;/</span><span style="color:#800000">servlet-name</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080">23</span>         <span style="color:#0000ff">&lt;</span><span style="color:#800000">url-pattern</span><span style="color:#0000ff">&gt;</span>/console/*<span style="color:#0000ff">&lt;/</span><span style="color:#800000">url-pattern</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080">24</span>     <span style="color:#0000ff">&lt;/</span><span style="color:#800000">servlet-mapping</span><span style="color:#0000ff">&gt;</span></pre>
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
    </div>
    <p>
     配置好Listener和访问Console的Servlet之后，我们就可以把H2数据库当作是我们Web应用中的一部分来使用了。
    </p>
    <p>
     将Web应用部署到Tomcat服务器，当启动Tomcat服务器时，在控制台就可以看到H2数据库启动成功的消息，如下图所示：
    </p>
    <p>
     <img alt="" src="http://images.cnitblog.com/blog/289233/201412/282038550137279.png" style="border:1px solid black"/>
    </p>
    <p>
     为了进一步验证H2数据库是否真的是通过监听器正常启动了，我们可以访问一下H2数据库的Console，输入访问地址："http://localhost:8080/H2DBTest/console/"进行访问，如下图所示：
    </p>
    <p>
     <img alt="" src="http://images.cnitblog.com/blog/289233/201412/282046307788839.png"/>
    </p>
    <p>
     能够看到H2数据库Console的登录页面，说明了H2数据库已经正常启动了。
    </p>
    <h3 id="blogTitle3">
     三、向H2数据库注册自定义的数据库函数
    </h3>
    <p>
     H2作为一个数据库，和其他类型的数据库一样，会自带有一些数据库函数给我们使用，但是H2数据库提供的数据库函数有限，无法满足我们开发中的需求，幸运的是，H2数据库支持自定义数据库函数的，因此我们可以根据开发中的实际应用场景编写满足我们需求的数据库函数。
    </p>
    <p>
     下面就来说一下如何实现H2数据库的自定义函数
    </p>
    <p>
     在MySQL数据库中有一个UUID函数是用来生成UUID的，执行"SELECT UUID()"就可以看到UUID函数生成的UUID，如下图所示：
    </p>
    <p>
     <img alt="" src="http://images.cnitblog.com/blog/289233/201412/272251323587503.png" style="border:1px solid black"/>
    </p>
    <p>
     而默认情况下，H2数据库是没有提供有UUID这个函数给我们使用的，如下图所示：
    </p>
    <p>
     <img alt="" src="http://images.cnitblog.com/blog/289233/201412/282317024663809.png" style="border:1px solid black"/>
    </p>
    <p>
     那么我们现在就来实现一个UUID函数，然后注册到H2数据库当中，这样H2数据库就支持UUID函数了，具体做法分为两个步骤：
    </p>
    <p>
     (1) 使用Java实现自定义函数的方法。
    </p>
    <p>
     (2) 将Java的自定义函数注册到H2数据库中。
    </p>
    <p>
     首先我们来实现这个UUID函数，在java中，生成一个UUID的方法是使用java.util.UUID这个类里面的一个randomUUID()方法生成的，封装成一个uuid方法，代码如下：
    </p>
    <div class="cnblogs_code">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
     <pre><span style="color:#008080"> 1</span> <span style="color:#0000ff">package</span> h2db.function.ext;
<span style="color:#008080"> 2</span> 
<span style="color:#008080"> 3</span> <span style="color:#0000ff">import</span> java.util.UUID;
<span style="color:#008080"> 4</span> 
<span style="color:#008080"> 5</span> <span style="color:#008000">/**</span>
<span style="color:#008080"> 6</span> <span style="color:#008000">* @ClassName: H2DBFunctionExt
</span><span style="color:#008080"> 7</span> <span style="color:#008000">* @Description: 针对H2数据库函数的扩展
</span><span style="color:#008080"> 8</span> <span style="color:#008000">* </span><span style="color:#808080">@author</span><span style="color:#008000">: 孤傲苍狼
</span><span style="color:#008080"> 9</span> <span style="color:#008000">* @date: 2014-12-20 下午11:20:34
</span><span style="color:#008080">10</span> <span style="color:#008000">*
</span><span style="color:#008080">11</span> <span style="color:#008000">*/</span> 
<span style="color:#008080">12</span> <span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> H2DBFunctionExt {
<span style="color:#008080">13</span> 
<span style="color:#008080">14</span>     <span style="color:#008000">/**</span>
<span style="color:#008080">15</span> <span style="color:#008000">    * 用法：SELECT uuid();
</span><span style="color:#008080">16</span> <span style="color:#008000">    * H2数据库注册uuid函数：CREATE ALIAS uuid FOR "h2db.function.ext.H2DBFunctionExt.uuid";
</span><span style="color:#008080">17</span> <span style="color:#008000">    * @Method: uuid
</span><span style="color:#008080">18</span> <span style="color:#008000">    * @Description: 实现MySQL数据库的uuid函数，用于生成UUID
</span><span style="color:#008080">19</span> <span style="color:#008000">    * @Anthor:孤傲苍狼
</span><span style="color:#008080">20</span> <span style="color:#008000">    *
</span><span style="color:#008080">21</span> <span style="color:#008000">    * </span><span style="color:#808080">@return</span>
<span style="color:#008080">22</span>     <span style="color:#008000">*/</span> 
<span style="color:#008080">23</span>     <span style="color:#0000ff">public</span> <span style="color:#0000ff">static</span> String uuid(){
<span style="color:#008080">24</span>         <span style="color:#0000ff">return</span> UUID.randomUUID().toString();
<span style="color:#008080">25</span>     }
<span style="color:#008080">26</span> }</pre>
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
    </div>
    <p>
     这样，我们的uuid函数就算是编写好了，需要注意的是，类和方法必须是公共(Public)的,且方法需为静态(static)的，如方法中使用了Connection对象需将其关闭。
    </p>
    <p>
     接下来我们要将其注册到H2数据库中，须执行"CREATE ALIAS"语句，SQL语法如下：
    </p>
    <div class="cnblogs_code">
     <pre><span style="color:#008080">1</span> <span style="color:#0000ff">CREATE</span> ALIAS <span style="color:#ff0000">[</span><span style="color:#ff0000">IF NOT EXISTS</span><span style="color:#ff0000">]</span> newFunctionAliasName <span style="color:#ff0000">[</span><span style="color:#ff0000">DETERMINISTIC</span><span style="color:#ff0000">]</span> <span style="color:#0000ff">FOR</span> classAndMethodName</pre>
    </div>
    <p>
     其中[]括起来的部分是可选的，本例须执行的语句为：
     <span class="cnblogs_code">
      <span style="color:#0000ff">
       CREATE
      </span>
      ALIAS UUID
      <span style="color:#0000ff">
       FOR
      </span>
      "h2db.
      <span style="color:#0000ff">
       function
      </span>
      .ext.H2DBFunctionExt.uuid"
     </span>
     ，执行结果如下图所示：
    </p>
    <p>
     <img alt="" src="http://images.cnitblog.com/blog/289233/201412/282334007783508.png"/>
    </p>
    <p>
     这样H2数据库中就多了一个UUID函数可以使用了，我们再次执行"SELECT UUID()"语句就可以被H2数据库正常解析了，执行结果如下图所示：
    </p>
    <p>
     <img alt="" src="http://images.cnitblog.com/blog/289233/201412/282338172635818.png"/>
    </p>
    <p>
     以上就是针对H2数据库函数的一个扩展，我们向H2数据库新增加了一个UUID函数用于生成uuid。因此当H2数据库提供的函数不满足我们开发中的实际需求时，就可以使用这种方式来扩展H2数据库的函数了。接下来演示一下一次性向H2数据库扩展多个函数，我们编写一个H2DBFunctionExt类，在类中编写针对H2数据库的扩展函数，代码如下：
    </p>
    <div class="cnblogs_code">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
     <pre><span style="color:#008080"> 1</span> <span style="color:#0000ff">package</span> h2db.function.ext;
<span style="color:#008080"> 2</span> 
<span style="color:#008080"> 3</span> <span style="color:#0000ff">import</span> java.net.InetAddress;
<span style="color:#008080"> 4</span> <span style="color:#0000ff">import</span> java.net.UnknownHostException;
<span style="color:#008080"> 5</span> <span style="color:#0000ff">import</span> java.text.ParseException;
<span style="color:#008080"> 6</span> <span style="color:#0000ff">import</span> java.text.SimpleDateFormat;
<span style="color:#008080"> 7</span> <span style="color:#0000ff">import</span> java.util.Date;
<span style="color:#008080"> 8</span> <span style="color:#0000ff">import</span> java.util.UUID;
<span style="color:#008080"> 9</span> 
<span style="color:#008080">10</span> <span style="color:#008000">/**</span>
<span style="color:#008080">11</span> <span style="color:#008000">* @ClassName: H2DBFunctionExt
</span><span style="color:#008080">12</span> <span style="color:#008000">* @Description: 针对H2数据库函数的扩展
</span><span style="color:#008080">13</span> <span style="color:#008000">* </span><span style="color:#808080">@author</span><span style="color:#008000">: 孤傲苍狼
</span><span style="color:#008080">14</span> <span style="color:#008000">* @date: 2014-12-20 下午11:20:34
</span><span style="color:#008080">15</span> <span style="color:#008000">*
</span><span style="color:#008080">16</span> <span style="color:#008000">*/</span> 
<span style="color:#008080">17</span> <span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> H2DBFunctionExt {
<span style="color:#008080">18</span> 
<span style="color:#008080">19</span>     <span style="color:#008000">/**</span>
<span style="color:#008080">20</span> <span style="color:#008000">    * 用法：SELECT uuid();
</span><span style="color:#008080">21</span> <span style="color:#008000">    * H2数据库注册uuid函数：CREATE ALIAS IF NOT EXISTS uuid FOR "h2db.function.ext.H2DBFunctionExt.uuid";
</span><span style="color:#008080">22</span> <span style="color:#008000">    * @Method: uuid
</span><span style="color:#008080">23</span> <span style="color:#008000">    * @Description: 实现MySQL数据库的uuid函数，用于生成UUID
</span><span style="color:#008080">24</span> <span style="color:#008000">    * @Anthor:孤傲苍狼
</span><span style="color:#008080">25</span> <span style="color:#008000">    *
</span><span style="color:#008080">26</span> <span style="color:#008000">    * </span><span style="color:#808080">@return</span>
<span style="color:#008080">27</span>     <span style="color:#008000">*/</span> 
<span style="color:#008080">28</span>     <span style="color:#0000ff">public</span> <span style="color:#0000ff">static</span> String uuid(){
<span style="color:#008080">29</span>         <span style="color:#0000ff">return</span> UUID.randomUUID().toString();
<span style="color:#008080">30</span>     }
<span style="color:#008080">31</span> 
<span style="color:#008080">32</span>     <span style="color:#008000">/**</span>
<span style="color:#008080">33</span> <span style="color:#008000">    * H2数据库注册currentTime函数：CREATE ALIAS IF NOT EXISTS currentTime FOR "h2db.function.ext.H2DBFunctionExt.now";
</span><span style="color:#008080">34</span> <span style="color:#008000">    * @Method: now
</span><span style="color:#008080">35</span> <span style="color:#008000">    * @Description: 实现MySQL数据库的now()函数，用于生成当前系统时间
</span><span style="color:#008080">36</span> <span style="color:#008000">    * @Anthor:孤傲苍狼
</span><span style="color:#008080">37</span> <span style="color:#008000">    *
</span><span style="color:#008080">38</span> <span style="color:#008000">    * </span><span style="color:#808080">@return</span>
<span style="color:#008080">39</span>     <span style="color:#008000">*/</span> 
<span style="color:#008080">40</span>     <span style="color:#0000ff">public</span> <span style="color:#0000ff">static</span> String now(){
<span style="color:#008080">41</span>         <span style="color:#0000ff">return</span> <span style="color:#0000ff">new</span> Date().toLocaleString();
<span style="color:#008080">42</span>     }
<span style="color:#008080">43</span>     
<span style="color:#008080">44</span>     <span style="color:#008000">/**</span>
<span style="color:#008080">45</span> <span style="color:#008000">     * H2数据库注册IP函数：CREATE ALIAS IF NOT EXISTS IP FOR "h2db.function.ext.H2DBFunctionExt.getIp";
</span><span style="color:#008080">46</span> <span style="color:#008000">    * @Method: getIp
</span><span style="color:#008080">47</span> <span style="color:#008000">    * @Description: 
</span><span style="color:#008080">48</span> <span style="color:#008000">    * @Anthor:孤傲苍狼
</span><span style="color:#008080">49</span> <span style="color:#008000">    *
</span><span style="color:#008080">50</span> <span style="color:#008000">    * </span><span style="color:#808080">@return</span>
<span style="color:#008080">51</span>     <span style="color:#008000">*/</span> 
<span style="color:#008080">52</span>     <span style="color:#0000ff">public</span> <span style="color:#0000ff">static</span> String getIp(){
<span style="color:#008080">53</span>         <span style="color:#0000ff">try</span> {
<span style="color:#008080">54</span>             InetAddress addr = InetAddress.getLocalHost();
<span style="color:#008080">55</span>             <span style="color:#008000">//</span><span style="color:#008000">获得本机IP</span>
<span style="color:#008080">56</span>             <span style="color:#0000ff">return</span> addr.getHostAddress();
<span style="color:#008080">57</span>         } <span style="color:#0000ff">catch</span> (UnknownHostException e) {
<span style="color:#008080">58</span>             e.printStackTrace();
<span style="color:#008080">59</span>             <span style="color:#0000ff">return</span> "未知的IP地址";
<span style="color:#008080">60</span>         } 
<span style="color:#008080">61</span>     }
<span style="color:#008080">62</span>     
<span style="color:#008080">63</span>     <span style="color:#008000">/**</span>
<span style="color:#008080">64</span> <span style="color:#008000">    * H2数据库注册date_format函数：CREATE ALIAS IF NOT EXISTS date_format FOR "h2db.function.ext.H2DBFunctionExt.date_format";
</span><span style="color:#008080">65</span> <span style="color:#008000">    * @Method: date_format
</span><span style="color:#008080">66</span> <span style="color:#008000">    * @Description: 实现MySQL数据库的date_format()函数，用于格式化日期
</span><span style="color:#008080">67</span> <span style="color:#008000">    * @Anthor:孤傲苍狼
</span><span style="color:#008080">68</span> <span style="color:#008000">    * </span><span style="color:#808080">@param</span><span style="color:#008000"> date
</span><span style="color:#008080">69</span> <span style="color:#008000">    * </span><span style="color:#808080">@param</span><span style="color:#008000"> pattern
</span><span style="color:#008080">70</span> <span style="color:#008000">    * </span><span style="color:#808080">@return</span>
<span style="color:#008080">71</span>     <span style="color:#008000">*/</span> 
<span style="color:#008080">72</span>     <span style="color:#0000ff">public</span> <span style="color:#0000ff">static</span> String date_format(String date,String pattern){
<span style="color:#008080">73</span>         <span style="color:#0000ff">if</span> (date != <span style="color:#0000ff">null</span>) {
<span style="color:#008080">74</span>             SimpleDateFormat sdf = <span style="color:#0000ff">new</span> SimpleDateFormat(pattern);
<span style="color:#008080">75</span>             <span style="color:#0000ff">try</span> {
<span style="color:#008080">76</span>                 Date temp = sdf.parse(date);
<span style="color:#008080">77</span>                 <span style="color:#0000ff">return</span> sdf.format(temp);
<span style="color:#008080">78</span>             } <span style="color:#0000ff">catch</span> (ParseException e) {
<span style="color:#008080">79</span>                 e.printStackTrace();
<span style="color:#008080">80</span>             }
<span style="color:#008080">81</span>         }
<span style="color:#008080">82</span>         <span style="color:#0000ff">return</span> "";
<span style="color:#008080">83</span>     }
<span style="color:#008080">84</span> }</pre>
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
    </div>
    <p>
     为了实现批量注册H2数据库的扩展函数，我们可以编写一个Servlet，专门用于注册扩展函数，代码如下：
    </p>
    <div class="cnblogs_code">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
     <pre><span style="color:#008080"> 1</span> <span style="color:#0000ff">package</span> me.gacl.sys.init;
<span style="color:#008080"> 2</span> 
<span style="color:#008080"> 3</span> 
<span style="color:#008080"> 4</span> <span style="color:#0000ff">import</span> java.sql.Connection;
<span style="color:#008080"> 5</span> <span style="color:#0000ff">import</span> java.sql.Statement;
<span style="color:#008080"> 6</span> 
<span style="color:#008080"> 7</span> <span style="color:#0000ff">import</span> javax.servlet.ServletException;
<span style="color:#008080"> 8</span> <span style="color:#0000ff">import</span> javax.servlet.http.HttpServlet;
<span style="color:#008080"> 9</span> 
<span style="color:#008080">10</span> <span style="color:#0000ff">import</span> me.gacl.util.JdbcUtil;
<span style="color:#008080">11</span> 
<span style="color:#008080">12</span> <span style="color:#008000">/**</span>
<span style="color:#008080">13</span> <span style="color:#008000">* @ClassName: RegisterH2ExtFuncServlet
</span><span style="color:#008080">14</span> <span style="color:#008000">* @Description:注册H2数据库的扩展函数
</span><span style="color:#008080">15</span> <span style="color:#008000">* </span><span style="color:#808080">@author</span><span style="color:#008000">: 孤傲苍狼
</span><span style="color:#008080">16</span> <span style="color:#008000">* @date: 2014-12-20 下午11:47:03
</span><span style="color:#008080">17</span> <span style="color:#008000">*
</span><span style="color:#008080">18</span> <span style="color:#008000">*/</span> 
<span style="color:#008080">19</span> <span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> RegisterH2ExtFuncServlet <span style="color:#0000ff">extends</span> HttpServlet {
<span style="color:#008080">20</span> 
<span style="color:#008080">21</span>     <span style="color:#008000">/**</span>
<span style="color:#008080">22</span> <span style="color:#008000">    * @Field: serialVersionUID
</span><span style="color:#008080">23</span>     <span style="color:#008000">*/</span> 
<span style="color:#008080">24</span>     <span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">final</span> <span style="color:#0000ff">long</span> serialVersionUID = 4379248469825545593L;
<span style="color:#008080">25</span> 
<span style="color:#008080">26</span>     <span style="color:#0000ff">public</span> <span style="color:#0000ff">void</span> init() <span style="color:#0000ff">throws</span> ServletException {
<span style="color:#008080">27</span>         <span style="color:#008000">//</span><span style="color:#008000">1、注册uuid函数的SQL语句</span>
<span style="color:#008080">28</span>         String sql1 = "CREATE ALIAS IF NOT EXISTS uuid FOR \"h2db.function.ext.H2DBFunctionExt.uuid\"";
<span style="color:#008080">29</span>         <span style="color:#008000">//</span><span style="color:#008000">2、注册currentTime函数的SQL语句</span>
<span style="color:#008080">30</span>         String sql2 = "CREATE ALIAS IF NOT EXISTS currentTime FOR \"h2db.function.ext.H2DBFunctionExt.now\"";
<span style="color:#008080">31</span>         <span style="color:#008000">//</span><span style="color:#008000">3、注册IP函数的SQL语句</span>
<span style="color:#008080">32</span>         String sql3 = "CREATE ALIAS IF NOT EXISTS IP FOR \"h2db.function.ext.H2DBFunctionExt.getIp\"";
<span style="color:#008080">33</span>         <span style="color:#008000">//</span><span style="color:#008000">4、注册date_format函数的SQL语句</span>
<span style="color:#008080">34</span>         String sql4 = "CREATE ALIAS IF NOT EXISTS date_format FOR \"h2db.function.ext.H2DBFunctionExt.date_format\"";
<span style="color:#008080">35</span>         Connection connection = <span style="color:#0000ff">null</span>;
<span style="color:#008080">36</span>         Statement stmt = <span style="color:#0000ff">null</span>;
<span style="color:#008080">37</span>         <span style="color:#0000ff">try</span> {
<span style="color:#008080">38</span>             <span style="color:#008000">//</span><span style="color:#008000">获取数据库连接</span>
<span style="color:#008080">39</span>             connection = JdbcUtil.getConnection();
<span style="color:#008080">40</span>             <span style="color:#008000">//</span><span style="color:#008000">获取Statement对象</span>
<span style="color:#008080">41</span>             stmt = connection.createStatement();
<span style="color:#008080">42</span>             <span style="color:#008000">//</span><span style="color:#008000">添加要执行的SQL</span>
<span style="color:#008080">43</span>             stmt.addBatch(sql1);
<span style="color:#008080">44</span>             stmt.addBatch(sql2);
<span style="color:#008080">45</span>             stmt.addBatch(sql3);
<span style="color:#008080">46</span>             stmt.addBatch(sql4);
<span style="color:#008080">47</span>             <span style="color:#008000">//</span><span style="color:#008000">批量执行上述的4条SQL</span>
<span style="color:#008080">48</span>             stmt.executeBatch();
<span style="color:#008080">49</span>             System.out.println("H2数据库扩展函数注册成功！");
<span style="color:#008080">50</span>             stmt.clearBatch();
<span style="color:#008080">51</span>         } <span style="color:#0000ff">catch</span> (Exception e) {
<span style="color:#008080">52</span>             System.out.println("H2数据库扩展函数注册失败！");
<span style="color:#008080">53</span>             e.printStackTrace();
<span style="color:#008080">54</span>         }<span style="color:#0000ff">finally</span>{
<span style="color:#008080">55</span>             <span style="color:#0000ff">try</span> {
<span style="color:#008080">56</span>                 stmt.close();
<span style="color:#008080">57</span>                 connection.close();
<span style="color:#008080">58</span>             } <span style="color:#0000ff">catch</span> (Exception e2) {
<span style="color:#008080">59</span>                 e2.printStackTrace();
<span style="color:#008080">60</span>             }
<span style="color:#008080">61</span>         }
<span style="color:#008080">62</span>     }
<span style="color:#008080">63</span> }</pre>
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
    </div>
    <p>
     在Web.xml中注册RegisterH2ExtFuncServlet
    </p>
    <div class="cnblogs_code">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
     <pre><span style="color:#008080"> 1</span> <span style="color:#0000ff">&lt;</span><span style="color:#800000">servlet</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080"> 2</span>     <span style="color:#0000ff">&lt;</span><span style="color:#800000">description</span><span style="color:#0000ff">&gt;</span>注册H2数据库的扩展函数<span style="color:#0000ff">&lt;/</span><span style="color:#800000">description</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080"> 3</span>     <span style="color:#0000ff">&lt;</span><span style="color:#800000">servlet-name</span><span style="color:#0000ff">&gt;</span>RegisterH2DBExtFunction<span style="color:#0000ff">&lt;/</span><span style="color:#800000">servlet-name</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080"> 4</span>     <span style="color:#0000ff">&lt;</span><span style="color:#800000">servlet-class</span><span style="color:#0000ff">&gt;</span>me.gacl.sys.init.RegisterH2ExtFuncServlet<span style="color:#0000ff">&lt;/</span><span style="color:#800000">servlet-class</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080"> 5</span>     <span style="color:#008000">&lt;!--</span> 
<span style="color:#008080"> 6</span> <span style="color:#008000">    1、load-on-startup元素标记容器是否在启动的时候就加载这个servlet(实例化并调用其init()方法)。
</span><span style="color:#008080"> 7</span> <span style="color:#008000">    2、它的值必须是一个整数，表示servlet应该被载入的顺序
</span><span style="color:#008080"> 8</span> <span style="color:#008000">    3、当值为0或者大于0时，表示容器在应用启动时就加载并初始化这个servlet；
</span><span style="color:#008080"> 9</span> <span style="color:#008000">    4、当值小于0或者没有指定时，则表示容器在该servlet被选择时才会去加载。
</span><span style="color:#008080">10</span> <span style="color:#008000">    5、正数的值越小，该servlet的优先级越高，应用启动时就越先加载。
</span><span style="color:#008080">11</span> <span style="color:#008000">    6、当值相同时，容器就会自己选择顺序来加载。
</span><span style="color:#008080">12</span> <span style="color:#008000">    所以，&lt;load-on-startup&gt;x&lt;/load-on-startup&gt;，中x的取值1，2，3，4，5代表的是优先级，而非启动延迟时间。
</span><span style="color:#008080">13</span>      <span style="color:#008000">--&gt;</span>
<span style="color:#008080">14</span>      <span style="color:#0000ff">&lt;</span><span style="color:#800000">load-on-startup</span><span style="color:#0000ff">&gt;</span>1<span style="color:#0000ff">&lt;/</span><span style="color:#800000">load-on-startup</span><span style="color:#0000ff">&gt;</span>
<span style="color:#008080">15</span> <span style="color:#0000ff">&lt;/</span><span style="color:#800000">servlet</span><span style="color:#0000ff">&gt;</span></pre>
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
    </div>
    <p>
     RegisterH2ExtFuncServlet要批量执行SQL语句，因此需要连接上H2数据库才能够执行，工具类JdbcUtil提供了获取数据库连接的方法，JdbcUtil的代码如下：
    </p>
    <div class="cnblogs_code">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
     <pre><span style="color:#008080"> 1</span> <span style="color:#008000">/**</span>
<span style="color:#008080"> 2</span> <span style="color:#008000"> * 
</span><span style="color:#008080"> 3</span>  <span style="color:#008000">*/</span>
<span style="color:#008080"> 4</span> <span style="color:#0000ff">package</span> me.gacl.util;
<span style="color:#008080"> 5</span> 
<span style="color:#008080"> 6</span> <span style="color:#0000ff">import</span> java.io.InputStream;
<span style="color:#008080"> 7</span> <span style="color:#0000ff">import</span> java.sql.Connection;
<span style="color:#008080"> 8</span> <span style="color:#0000ff">import</span> java.util.Properties;
<span style="color:#008080"> 9</span> <span style="color:#0000ff">import</span> org.h2.jdbcx.JdbcConnectionPool;
<span style="color:#008080">10</span> 
<span style="color:#008080">11</span> <span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> JdbcUtil {
<span style="color:#008080">12</span> 
<span style="color:#008080">13</span>     <span style="color:#008000">/**</span>
<span style="color:#008080">14</span> <span style="color:#008000">     * H2数据库自带的连接池
</span><span style="color:#008080">15</span>      <span style="color:#008000">*/</span>
<span style="color:#008080">16</span>     <span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> JdbcConnectionPool cp = <span style="color:#0000ff">null</span>;
<span style="color:#008080">17</span>     
<span style="color:#008080">18</span>     <span style="color:#0000ff">static</span>{
<span style="color:#008080">19</span>         <span style="color:#0000ff">try</span> {
<span style="color:#008080">20</span>             <span style="color:#008000">//</span><span style="color:#008000">加载src目录下的h2config.properties</span>
<span style="color:#008080">21</span>             InputStream in = JdbcUtil.<span style="color:#0000ff">class</span>.getClassLoader().getResourceAsStream("h2config.properties");
<span style="color:#008080">22</span>             Properties prop = <span style="color:#0000ff">new</span> Properties();
<span style="color:#008080">23</span>             prop.load(in);
<span style="color:#008080">24</span>             <span style="color:#008000">//</span><span style="color:#008000">创建数据库连接池</span>
<span style="color:#008080">25</span>             cp = JdbcConnectionPool.create(prop.getProperty("JDBC_URL"), prop.getProperty("USER"), prop.getProperty("PASSWORD"));
<span style="color:#008080">26</span>         } <span style="color:#0000ff">catch</span> (Exception e) {
<span style="color:#008080">27</span>             System.out.println("连接池初始化异常");
<span style="color:#008080">28</span>             e.printStackTrace();
<span style="color:#008080">29</span>         }
<span style="color:#008080">30</span>     }
<span style="color:#008080">31</span>     
<span style="color:#008080">32</span>     <span style="color:#008000">/**</span>
<span style="color:#008080">33</span> <span style="color:#008000">    * @Method: getConnection
</span><span style="color:#008080">34</span> <span style="color:#008000">    * @Description:获取数据库连接
</span><span style="color:#008080">35</span> <span style="color:#008000">    * @Anthor:孤傲苍狼
</span><span style="color:#008080">36</span> <span style="color:#008000">    * </span><span style="color:#808080">@return</span>
<span style="color:#008080">37</span> <span style="color:#008000">    * </span><span style="color:#808080">@throws</span><span style="color:#008000"> Exception
</span><span style="color:#008080">38</span>     <span style="color:#008000">*/</span> 
<span style="color:#008080">39</span>     <span style="color:#0000ff">public</span> <span style="color:#0000ff">static</span> Connection getConnection() <span style="color:#0000ff">throws</span> Exception{
<span style="color:#008080">40</span>         <span style="color:#0000ff">return</span> cp.getConnection();
<span style="color:#008080">41</span>     }
<span style="color:#008080">42</span> 
<span style="color:#008080">43</span>     <span style="color:#0000ff">public</span> <span style="color:#0000ff">static</span> JdbcConnectionPool getCp() {
<span style="color:#008080">44</span>         <span style="color:#0000ff">return</span> cp;
<span style="color:#008080">45</span>     }
<span style="color:#008080">46</span> }</pre>
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
      </span>
     </div>
    </div>
    <p>
     h2config.properties的配置信息如下：
    </p>
    <div class="cnblogs_code">
     <pre>JDBC_URL=jdbc:h2:tcp://localhost/~/h2db
USER=gacl
PASSWORD=123</pre>
    </div>
    <p>
     当web应用启动时，就会执行RegisterH2ExtFuncServlet这个Servlet中的init方法，init方法内部的处理就是通过JdbcUtil工具类获取一个H2的数据库连接，然后创建Statement对象，再由Statement对象批量执行SQL向H2数据库注册扩展函数。
    </p>
    <p>
     RegisterH2ExtFuncServlet执行的过程中如果没有出现任何错误，那就说明所有的针对H2数据库的扩展函数都注册成功了，我们可以到H2的Console去验证一下上述的4个扩展函数，如下图所示：
    </p>
    <p>
     <img alt="" src="http://images.cnitblog.com/blog/289233/201412/290041385286375.png" style="border:1px solid black"/>
    </p>
    <p>
     关于在Web应用中嵌入使用H2数据库，以及针对H2数据库函数的扩展的内容就讲解这么多了。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f71715f3235303333313335:2f61727469636c652f64657461696c732f3434393231353837" class_="artid" style="display:none">
 </p>
</div>
