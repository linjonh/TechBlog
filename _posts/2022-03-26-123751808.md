---
layout: post
title: "西电Pintos操作系统课程设计-实验三"
date: 2022-03-26 10:40:31 +0800
description: "通过修改thread_create(), thread_yiel"
keywords: "西电操作系统课程设计"
categories: ['西电计科']
tags: ['课程设计', '西电', '操作系统']
artid: "123751808"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=123751808
    alt: "西电Pintos操作系统课程设计-实验三"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     西电Pintos操作系统课程设计 实验三
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="Priority_Scheduling_0">
     </a>
     实验三：Priority Scheduling
    </h3>
    <p>
     <strong>
      一、实验目的
     </strong>
    </p>
    <p>
     原始Pintos系统中对于线程的调度，没有考虑优先级问题，采用的是最为简单的FCFS策略。本实验要求为Pintos建立优先级调度机制，并确保任何时刻CPU上运行的都是最高优先级线程。
    </p>
    <p>
     <strong>
      二、详细实现
     </strong>
    </p>
    <ol>
     <li>
      修改thread.c中的thread_create()函数，在结尾处加上比较语句，若该新建的线程的优先级高于正在执行的线程的优先级，则用thread_yield()函数把正在运行的线程送入ready_list。
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/dec84fb400b69711105229dd430c0277.png"/>
     </li>
     <li>
      修改thread_yield()函数，使其具有将ready_list中的线程按优先级降序排列的功能。
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c8160833710daf3dcc91bad49e8f61f6.png"/>
     </li>
     <li>
      修改thread_unblock()函数，同样地，使其具有将ready_list中的线程按优先级降序排列的功能。
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b294cc1df1e6ff53eb168dd321ad555a.png"/>
     </li>
     <li>
      在thread.c中增加优先级比较函数thread_cmp()，以便被插入排序函数list_insert_ordered()作为参数调用。此外，还需在thread.h中声明该函数。
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7ec5d488baf2d6f1735e55fda448bad0.png"/>
     </li>
     <li>
      修改thread_set_priority()函数，使其在为当前运行的线程t赋新优先级后，比较新优先级与ready_list中队首线程的优先级，若t的新优先级低于队首线程优先级，则用thread_yield()将t送入ready_list中。
      <br/>
      说明：第二个if语句中的list_entry()函数用于获取ready_list列表的头线程对应的结构体。
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b1c2d7100210c7051a8bea357a3f2ebb.png"/>
     </li>
     <li>
      在synch.c中修改sema_up()函数，在末尾添加thread_priority_check()函数，使其在执行V操作唤醒一个线程后，将当前运行的线程的优先级和ready_list队首线程的优先级进行比较。
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/cb47a9b3a69604867b5fdbfade5d1e5c.png"/>
     </li>
     <li>
      在thread.c中添加thread_check_priority()函数以实现步骤6中提到的优先级判断功能。然后再在thread.h中对该函数进行声明。
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2ce380bdf3a8e3b995bda0a58b0171d8.png"/>
     </li>
     <li>
      在synch.c中修改sema_down()函数，使其在执行P操作阻塞一个线程然后将该线程插入该信号量的wait_list后，对wait_list中的线程按优先级降序排列。
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a62455e0c431f1b7d979284d44e4704d.png"/>
     </li>
     <li>
      在synch.c中修改结构体semaphore_elem，添加priority属性，便于后续处理条件变量的wait_list中的线程时需要进行优先级比较。
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/bbc39d7aa558dcdafe6a9e81648da4d3.png">
       <br/>
       10.在synch.c中定义cond_cmp()函数，作为条件变量的wait_list对线程进行插入排序时需要的参数。
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5d65cf5250e9a106620af397849e32b2.png"/>
      </img>
     </li>
     <li>
      修改cond_wait()函数，利用插入排序函数对条件变量的wait_list中的线程按照优先级降序排列。
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2b9ef429916d73200d97ad2416ba5cbe.png"/>
      <br/>
      <strong>
       三、实验结果
      </strong>
     </li>
    </ol>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e7a89ec43c3f30597dd911f470b06226.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34353731373432352f:61727469636c652f64657461696c732f313233373531383038" class_="artid" style="display:none">
 </p>
</div>


