---
layout: post
title: "游戏修改器的基本工作原理"
date: 2024-12-18 15:30:51 +0800
description: "文章浏览阅读1w次，点赞8次，所谓游戏修改器，主要是通过修改游戏程序的内存数据或存盘文件来修改游戏中"
keywords: "改游戏代码是什么原理"
categories: ['C']
tags: ['游戏', '工作', 'Windows', 'Hook', 'Dll', 'Api']
artid: "5491183"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=5491183
    alt: "游戏修改器的基本工作原理"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     游戏修改器的基本工作原理
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      所谓游戏修改器，主要是通过修改游戏程序的内存数据或存盘文件来修改游戏中的相关数据，使之达到
      <span lang="EN-US">
       “
      </span>
      无敌
      <span lang="EN-US">
       ”
      </span>
      等效果。
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      游戏修改器主要分为两类：单一游戏的修改器和通用游戏修改器。顾名思义，前者只能修改特定的游戏，此类修改器也叫
      <span lang="EN-US">
       “
      </span>
      无敌引导程序
      <span lang="EN-US">
       ”
      </span>
      或
      <span lang="EN-US">
       “
      </span>
      游戏作弊器
      <span lang="EN-US">
       ”
      </span>
      ；而后 者则能够以
      <span lang="EN-US">
       “
      </span>
      不变应万变
      <span lang="EN-US">
       ”
      </span>
      ，可以修改大多数的游戏。本文主要讨论后者，相比之下，前者是后者只留下修改功能的
      <span lang="EN-US">
       “
      </span>
      简化版
      <span lang="EN-US">
       ”
      </span>
      。
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      总的来说，游戏修改器主要的功能便是反复搜索并筛选某一特定内存地址并将其按照固定的周期修改为特定的值（所谓的
      <span lang="EN-US">
       “
      </span>
      锁定
      <span lang="EN-US">
       ”
      </span>
      ），当然，将
      <span lang="EN-US">
       “
      </span>
      内存
      <span lang="EN-US">
       ”
      </span>
      换为
      <span lang="EN-US">
       “
      </span>
      文件
      <span lang="EN-US">
       ”
      </span>
      便可以以同样的方式搜索文件了。
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      搜索和筛选是如何实现的呢？假如我们已经可以访问游戏的内存，我们将游戏的内存分块读入一个缓冲区，然后借由下面的函数搜索：
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      //
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      在一个内存块中搜索内容
      <span lang="EN-US">
       <br/>
       //
      </span>
      成功返回位置
      <span lang="EN-US">
       <br/>
       //
      </span>
      失败返回
      <span lang="EN-US">
       -1
       <br/>
       //(SE:
      </span>
      现在我发现这个顺序查找函数完全可以用
      <span lang="EN-US">
       STL
      </span>
      的
      <span lang="EN-US">
       std::find()
      </span>
      函数取代，原因是写文章的时候我还不太了解
      <span lang="EN-US">
       STL:)
       <br/>
       int MemFind(int iStartPosition, LPBYTE pDestBuffer, int iDestBufferLength, LPBYTE pPatternBuffer, int iPatternBufferLength)
       <br/>
       {
       <br/>
       signed int iFoundPosition, i;
       <br/>
       iFoundPosition = -1;
       <br/>
       if(iStartPosition &gt; iDestBufferLength)return -1;
       <br/>
       for(i = iStartPosition; i &lt; (iDestBufferLength + 1); i++)
       <br/>
       {
       <br/>
       if(memcmp(&amp;pDestBuffer[i], pPatternBuffer, iPatternBufferLength) == 0)
       <br/>
       {
       <br/>
       iFoundPosition = i;
       <br/>
       break;
       <br/>
       }
       <br/>
       }
       <br/>
       return iFoundPosition;
       <br/>
       }
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      由于游戏在内存或文件中保存的数据是二进制格式，因此，当我们搜索一个为
      <span lang="EN-US">
       123
      </span>
      的整数时应用如下的格式：
      <span lang="EN-US">
       <br/>
       int nPattern = 123
      </span>
      ；
      <span lang="EN-US">
       <br/>
       dwOffset = MemFind(nStartPosition, pDestBuffer, nDestBufferLength, (LPBYTE)(&amp;nPattern), sizeof(nPattern))
       <br/>
      </span>
      同样，可以这样搜索浮点类型：
      <span lang="EN-US">
       <br/>
       float rPattern = 123
      </span>
      ；
      <span lang="EN-US">
       <br/>
       dwOffset = MemFind(nStartPosition, pDestBuffer, nDestBufferLength, (LPBYTE)(&amp;rPattern), sizeof(rPattern))
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      由于内存中肯定会存在许多相同的数据，所以第一次我们肯定会搜索到许多地址，而真正我们要找的地址一定包含在其中。所以，我们建立一个临时文件将这些地址保存起来，并设置
      <span lang="EN-US">
       “
      </span>
      有效
      <span lang="EN-US">
       ”
      </span>
      标志，如下代码所示：
      <span lang="EN-US">
       <br/>
       struct CTempItem
       <br/>
       {
       <br/>
       DWORD dwAddress;
       <br/>
       BOOL bEnable;
       <br/>
       };
       <br/>
       CTempItem item;
       <br/>
       item.dwAddress = ?????????;
       <br/>
       item.bEnable = TRUE;
       <br/>
       fwrite(&amp;item, sizeof(item), 1, fp);
       <br/>
      </span>
      接下来，当用户进行第二次搜索时，将这些保存在临时文件中的数据取出来，先看
      <span lang="EN-US">
       item.bEnable
      </span>
      若等于
      <span lang="EN-US">
       FALSE
      </span>
      则跳过，否则读取
      <span lang="EN-US">
       item.dwAddress
      </span>
      所指示的游戏内存，并于用户第二次输入的数值相比较，若发现相同，则设置
      <span lang="EN-US">
       item.bEnable =&amp; nbsp;TRUE
      </span>
      ；若不同设置
      <span lang="EN-US">
       item.bEnable=FALSE
      </span>
      ，表示废弃。完成之后，再次把
      <span lang="EN-US">
       item
      </span>
      写回文件，当所有
      <span lang="EN-US">
       item
      </span>
      分析完之后，我们就 完成了第二次搜索。再接下来，
      <span lang="EN-US">
       bEnable=TRUE
      </span>
      的地址还有很多，则仍然用第二次搜索的方式反复搜索，直到剩下
      <span lang="EN-US">
       1-2
      </span>
      个地址为止。
      <span lang="EN-US">
       &amp; nbsp;
      </span>
      （
      <span lang="EN-US">
       SE:
      </span>
      应用读写缓冲区，即成批地读写，可以大大加快速度）
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      由以上介绍可以看出，游戏修改器的搜索分为
      <span lang="EN-US">
       2
      </span>
      个阶段：第一次搜索和第
      <span lang="EN-US">
       2
      </span>
      、
      <span lang="EN-US">
       3
      </span>
      、
      <span lang="EN-US">
       4……
      </span>
      次搜索，游戏修改器在第一次搜索出的很多地址中分析出与用户输入的数据 始终相同的地址。当我们有了目标地址，就可以按照用户的意愿定时或手动方式写入用户指定的数据，这便是游戏修改器的基本原理。
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      当然，这只是基本原理，当具体编写修改器将遇到许多具体的技术困难，以下章节将为您一一解答。
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      如何访问游戏程序的内存
      <span lang="EN-US">
       <br/>
      </span>
      当我们的修改器运行于
      <span lang="EN-US">
       Windows
      </span>
      时，首先遇到的问题便是如何访问游戏的内存。
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      首先，在访问游戏的内存前我们还必须获得游戏进程的句柄，这可以通过
      <span lang="EN-US">
       ToolHelp
      </span>
      函数获取系统中当前运行的所有进程的列表和各进程的
      <span lang="EN-US">
       ID
      </span>
      ，经由用户选择之后通过
      <span lang="EN-US">
       OpenProcess
      </span>
      函数来获取。若您的修改器运行于后台，而前台是游戏的话，可以在用户按下
      <span lang="EN-US">
       “
      </span>
      弹出
      <span lang="EN-US">
       ”
      </span>
      热键时使用
      <span lang="EN-US">
       GetForegroundWindow
      </span>
      函数获取游戏窗口的
      <span lang="EN-US">
       HWND
      </span>
      ，再使用
      <span lang="EN-US">
       GetWindowThreadProcessId
      </span>
      转换成游戏进程的
      <span lang="EN-US">
       ID
      </span>
      ，再 使用
      <span lang="EN-US">
       OpenProcess
      </span>
      函数获取游戏进程的句柄。
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      有了游戏 进程的句柄之后，便可以使用
      <span lang="EN-US">
       Windows
      </span>
      提供的
      <span lang="EN-US">
       ReadProcessMemory
      </span>
      和
      <span lang="EN-US">
       WriteProcessMemory
      </span>
      这两个
      <span lang="EN-US">
       API
      </span>
      来读写游戏的内 存了。但是，在
      <span lang="EN-US">
       Windows9x
      </span>
      中每个进程均拥有各自独立的
      <span lang="EN-US">
       1GB
      </span>
      虚拟地址空间，而在
      <span lang="EN-US">
       Win2000/XP
      </span>
      下更是达到了
      <span lang="EN-US">
       2GB
      </span>
      。显然，搜索这样大的地址 空间是不现实的，而且游戏也仅仅用了其中的几十到几百
      <span lang="EN-US">
       MB
      </span>
      。所以，我们需要使用
      <span lang="EN-US">
       VirtualQueryEx
      </span>
      这个函数来查询哪些是已经分配的地址，哪些是未用的地址。以下查询与搜索相结合的示范代码：
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      DWORD dwBaseAddress;
      <br/>
      SYSTEM_INFO si;
      <br/>
      GetSystemInfo(si);
      <br/>
      dwBaseAddress = si.lpMinimumApplicationAddress;
      <br/>
      while(dwBaseAddress &lt; si.lpMaximumApplicationAddress)
      <br/>
      {
      <br/>
      mbi.BaseAddress = (LPVOID)dwBaseAddress;
      <br/>
      ProcessMem.Query((PVOID)dwBaseAddress, &amp;mbi);
      <br/>
      VirtualQueryEx(hProcess, (LPVOID)dwAddress), mbi, sizeof(mbi)
      <br/>
      dwBaseAddress = (DWORD)mbi.BaseAddress + mbi.RegionSize;
      <br/>
      if(mbi.State !=&amp; nbsp;MEM_COMMIT || mbi.AllocationProtect !=  PAGE_READWRITE); //
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      跳过未分配或不可读写的区域
      <span lang="EN-US">
       <br/>
       {
       <br/>
       continue;
       <br/>
       }
       <br/>
       //
      </span>
      搜索这块内存区域
      <span lang="EN-US">
       <br/>
       }
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      资源：请到
      <span lang="EN-US">
      </span>
     </span>
     <span lang="EN-US">
      <a href="http://alphasun.betajin.com/" rel="nofollow noopener noreferrer" target="_blank">
       <span style="font-family: 宋体; color: blue; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
        http://alphasun.betajin.com
       </span>
      </a>
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      下载我写的一个很
      <span lang="EN-US">
       “
      </span>
      简陋
      <span lang="EN-US">
       ”
      </span>
      的游戏修改器
      <span lang="EN-US">
       ——GameProbe
      </span>
      的源程序。
      <span lang="EN-US">
       <br/>
      </span>
      如何实现热键
      <span lang="EN-US">
       <br/>
      </span>
      热键的原理很简单，使用全局键盘
      <span lang="EN-US">
       HOOK
      </span>
      就可以了，鉴于这方面的资料较多，具体的
      <span lang="EN-US">
       Hook
      </span>
      使用方法请参阅
      <span lang="EN-US">
       MSDN
      </span>
      或相关资料。
      <span lang="EN-US">
       <br/>
      </span>
      如何实现暂停游戏
      <span lang="EN-US">
       <br/>
      </span>
      这是游戏修改器必须具备的一项功能了，若不暂停游戏，搜索之前数值很可能会改变，从而造成找不到数据的现象。暂停游戏的办法有很多种，主要有：
      <span lang="EN-US">
       <br/>
       1. Debug
      </span>
      法，这种方法利用
      <span lang="EN-US">
       DebugActiveProcess
      </span>
      这个
      <span lang="EN-US">
       Windows API
      </span>
      将游戏修改器作为游戏的调试程序，游戏修改器可通过
      <span lang="EN-US">
       Windows
      </span>
      提供的调试事件（
      <span lang="EN-US">
       DebugEvents
      </span>
      ）来获取游戏的各个线程的句柄。但此法有一个缺点就是不能在关闭游戏前关闭修改器，否则
      <span lang="EN-US">
       Windows
      </span>
      将会自动终止游戏的运行，运用此方法的典型是
      <span lang="EN-US">
       FPE2000
      </span>
      。
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      2.
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      通过使用
      <span lang="EN-US">
       ToolHelp
      </span>
      系列函数获取游戏进程的所有线程，并使用公开的
      <span lang="EN-US">
       OpenThread
      </span>
      这个
      <span lang="EN-US">
       API
      </span>
      来获得各线程的句柄并使用
      <span lang="EN-US">
       SuspendThread
      </span>
      和
      <span lang="EN-US">
       ResumeThread
      </span>
      来暂停或恢复游戏的运行，目前大部分程序运用此法。（
      <span lang="EN-US">
       BTW:
      </span>
      著名 的
      <span lang="EN-US">
       GameMaster
      </span>
      使用的是
      <span lang="EN-US">
       CreateProcess
      </span>
      并通过
      <span lang="EN-US">
       Suspend
      </span>
      游戏主线程的方法暂停游戏的，很显然，若游戏采用了多线程，此方法是欠妥的。）
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      但恼人的是
      <span lang="EN-US">
       Win9x
      </span>
      下并没有
      <span lang="EN-US">
       OpenThread
      </span>
      这个
      <span lang="EN-US">
       API
      </span>
      ，不过我们可以通过一个未公开的使用
      <span lang="EN-US">
       TCB
      </span>
      的方法在
      <span lang="EN-US">
       Win9x
      </span>
      下替代
      <span lang="EN-US">
       OpenThread
      </span>
      而获取 线程的句柄，从而达到了暂停游戏运行的目的。您可以到
      <span lang="EN-US">
      </span>
     </span>
     <span lang="EN-US">
      <a href="http://www.windrun.com/%C2%A0" rel="nofollow noopener noreferrer" target="_blank">
       <span style="font-family: 宋体; color: blue; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
        http://www.windrun.com/
       </span>
      </a>
     </span>
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      ;
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      下载
      <span lang="EN-US">
       Ligtest
      </span>
      前辈编写的
      <span lang="EN-US">
       PauseProcess
      </span>
      程序的源代码来学习，或者下载我的
      <span lang="EN-US">
       TestPopup
      </span>
      。
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      如何在游戏中弹出自己的界面
      <span lang="EN-US">
       <br/>
      </span>
      这个问题可以和热键问题一并解决：众所周知，
      <span lang="EN-US">
       Windows
      </span>
      是一个消息驱动的
      <span lang="EN-US">
       32
      </span>
      位操作系统。在
      <span lang="EN-US">
       Windows
      </span>
      中，所有正在运的进程都有一个独立的
      <span lang="EN-US">
       2GB
      </span>
      的虚拟地址空间，进程之间相互不可见。
      <span lang="EN-US">
       Windows
      </span>
      的绝大多数
      <span lang="EN-US">
       API
      </span>
      与消息是不能跨越进程的。
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      “Hook”
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      在
      <span lang="EN-US">
       Windows
      </span>
      中主要是用来截取消息的，形象说，就是用来
      <span lang="EN-US">
       “
      </span>
      钩
      <span lang="EN-US">
       ”
      </span>
      消息的。
      <span lang="EN-US">
       Hook
      </span>
      实际上是一个处理消息的程序段，每当特定的消息发出，在没有到达目的窗口前，
      <span lang="EN-US">
       Hook
      </span>
      函数就先捕获该消息，即
      <span lang="EN-US">
       Hook
      </span>
      函数先得到处理消息的控制权。而且如果你把
      <span lang="EN-US">
       Hook
      </span>
      实现在
      <span lang="EN-US">
       DLL
      </span>
      文件中，那么
      <span lang="EN-US">
       Hook
      </span>
      函数将会自动被系统映射到会处理那个特定消息的窗口所在的进程虚拟地址空间中。例如，你可以用
      <span lang="EN-US">
       Hook
      </span>
      来捕获系统中所有的键盘输入消息（
      <span lang="EN-US">
       WM_KEYDOWN
      </span>
      ）来 实现对电脑使用者的输入进行记录（关于
      <span lang="EN-US">
       Windows
      </span>
      进程管理与
      <span lang="EN-US">
       Hook
      </span>
      的详细用法，请参阅
      <span lang="EN-US">
       MSDN
      </span>
      与相关资料）。
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      微软的
      <span lang="EN-US">
       DirectX
      </span>
      为
      <span lang="EN-US">
       Windows
      </span>
      下的游戏带来了华丽的声光效果。但是由于
      <span lang="EN-US">
       DirectX
      </span>
      采用直接访问硬件的方法提高多媒体与游戏程序的速度，因此导致了人们误以为在
      <span lang="EN-US">
       DirectX
      </span>
      （确切地说是
      <span lang="EN-US">
       DirectDraw
      </span>
      ）下不能显示普通的
      <span lang="EN-US">
       Windows
      </span>
      对话 框。
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      幸运的是，
      <span lang="EN-US">
       DirectX
      </span>
      是支持
      <span lang="EN-US">
       GDI
      </span>
      的，也 就是说游戏程序可以用常规的方法在
      <span lang="EN-US">
       DirectX
      </span>
      下显示对话框（在微软
      <span lang="EN-US">
       DirectX 8 SDK
      </span>
      中有名为
      <span lang="EN-US">
       “FullScreenDialog”
      </span>
      的例子）。所以现在我们的问题变为：如上所述，如何让我们的程序进入游戏的程序的内部并显示对话框。
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      这似乎是一个很棘手的问题。但是，有了上面所讲的
      <span lang="EN-US">
       Hook
      </span>
      情况就大为不同了。我们知道既然
      <span lang="EN-US">
       Hook
      </span>
      可以映射到别的进程内部，那么只要将显示对话框的函数以及对话框资源包括在
      <span lang="EN-US">
       Hook DLL
      </span>
      中不就可以调用
      <span lang="EN-US">
       DialogBox()
      </span>
      了吗？完全正确！我们用
      <span lang="EN-US">
       SetWindowsHookEx()
      </span>
      为系统设置一个键盘消息
      <span lang="EN-US">
       Hook
      </span>
      ，系统会自动将这个
      <span lang="EN-US">
       DLL
      </span>
      映射到游戏的进程中。每当有键 盘消息，我们只要判断是不是我们所设定的热键，如果是就调用
      <span lang="EN-US">
       DialogBox()
      </span>
      显示对话框即可。
      <span lang="EN-US">
       (SE:
      </span>
      还有一种方法可以把
      <span lang="EN-US">
       DLL
      </span>
      插入别的进程，那就是利 用
      <span lang="EN-US">
       RemoteThread
      </span>
      远线程，具体程序请参阅上文提到的
      <span lang="EN-US">
       PauseProcess
      </span>
      程 序。
      <span lang="EN-US">
       )
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      您可以参阅我的
      <span lang="EN-US">
       TestPopup
      </span>
      程序，就演示了在
      <span lang="EN-US">
       DirectX
      </span>
      下弹出界面、暂停游戏、热键等功能。
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      如何调整游戏速度
      <span lang="EN-US">
       <br/>
      </span>
      游戏通常是通过
      <span lang="EN-US">
       timeGetTime
      </span>
      、
      <span lang="EN-US">
       GetTickCount
      </span>
      等几个与时间相关的
      <span lang="EN-US">
       API
      </span>
      来控制速度的。因此，我们只要抢在游戏调用这些
      <span lang="EN-US">
       API
      </span>
      之前调用 它们，并修改返回值，便可以调整游戏的速度了。具体的程序可以参阅我的
      <span lang="EN-US">
       SpeedMan
      </span>
      ，您可以免费下载它的源程序。
      <span lang="EN-US">
       SpeedMan
      </span>
      使用了《
      <span lang="EN-US">
       Windows
      </span>
      核心编程》所提供的
      <span lang="EN-US">
       CApiHook
      </span>
      类来拦 截
      <span lang="EN-US">
       timeGetTime
      </span>
      等
      <span lang="EN-US">
       Windows API
      </span>
      。
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      抓图功能
      <span lang="EN-US">
       <br/>
      </span>
      抓图功能很好实现。具体就是先暂停游戏，再通过使用
      <span lang="EN-US">
       GetForegroundWindow
      </span>
      函数获取游戏窗口的
      <span lang="EN-US">
       HWND
      </span>
      ，最后
      <span lang="EN-US">
       DC
      </span>
      就可以获得
      <span lang="EN-US">
       Bitmap
      </span>
      格式的屏幕图像了，至于如何保存成文件，或转换为
      <span lang="EN-US">
       Jpeg
      </span>
      （可以使用
      <span lang="EN-US">
       IJLib
      </span>
      ）等，则不在本文讨论范围里了。
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <span style="font-family: 宋体; color: red; font-size: 14pt; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">
      获取进程代码：
     </span>
     <span lang="EN-US" style="color: red; font-size: 14pt;">
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      #include "stdafx.h"
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      #include &lt;windows.h&gt;
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      #include &lt;tlhelp32.h&gt;
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      int main(int argc, char* argv[])
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      {
      <!-- -->
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      HANDLE hSnapshot = CreateToolhelp32Snapshot (TH32CS_SNAPPROCESS, 0);
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      if (!hSnapshot){
      <!-- -->
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 2;">
      </span>
      printf("CreateToolhelp32Snapshot ERROR!/n");
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 2;">
      </span>
      return 1;
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      }
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      PROCESSENTRY32 pe32;
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      pe32.dwSize = sizeof(PROCESSENTRY32 );
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      if (!Process32First (hSnapshot, &amp;pe32))
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      {
      <!-- -->
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 2;">
      </span>
      printf("Process32First ERROR!/n");
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      }
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      do
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      {
      <!-- -->
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 2;">
      </span>
      printf("ProcID:%d---%s/n",pe32.th32ProcessID ,pe32.szExeFile );
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      }while(Process32Next (hSnapshot, &amp;pe32));
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      return 0;
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      }
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      #include "stdafx.h"
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      #include "windows.h"
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      #include "tlhelp32.h"
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      #include "stdio.h"
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      int main(int argc, char* argv[])
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      {
      <!-- -->
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      PROCESSENTRY32 pe32;
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      pe32.dwSize = sizeof(pe32);
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      HANDLE hProcessSnap = ::CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS,0);
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      if (hProcessSnap == INVALID_HANDLE_VALUE)
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      {
      <!-- -->
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 2;">
      </span>
      printf("CreateToolhelp32Snapshot
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      调用失败
      <span lang="EN-US">
       ./n");
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 2;">
      </span>
      return -1;
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      }
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      BOOL bMore = ::Process32First(hProcessSnap,&amp;pe32);
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      while (bMore)
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      {
      <!-- -->
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 2;">
      </span>
      printf("
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      进程名称：
      <span lang="EN-US">
       %s/n",pe32.szExeFile);
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 2;">
      </span>
      printf("
     </span>
     <span style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      进程
      <span lang="EN-US">
       ID
      </span>
      ：
      <span lang="EN-US">
       %u/n/n",pe32.th32ProcessID);
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 2;">
      </span>
      bMore = ::Process32Next(hProcessSnap,&amp;pe32);
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      }
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      ::CloseHandle(hProcessSnap);
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      <span style="mso-tab-count: 1;">
      </span>
      return 0;
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      }
     </span>
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
    </p>
    <p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-family: 宋体; font-size: 9pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt;">
      转自
      <a href="http://hack.gameres.com/showthread.asp?threadid=75739" rel="nofollow">
       http://hack.gameres.com/showthread.asp?threadid=75739
      </a>
     </span>
    </p>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f676f646672657939:302f61727469636c652f64657461696c732f35343931313833" class_="artid" style="display:none">
 </p>
</div>


