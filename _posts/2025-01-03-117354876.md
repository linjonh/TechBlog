---
layout: post
title: "harmonyos刷机,别找了,这可能是全网最全的鸿蒙OpenHarmony刷机指南"
date: 2025-01-03 14:47:49 +0800
description: "摘要：相信很多同学都玩过鸿蒙(HarmonyOS)了，不过估计大多数同学都只是用鸿蒙开发App，与开"
keywords: "把harmony 设备修改为 openharmony"
categories: ['未分类']
tags: ['Harmonyos']
artid: "117354876"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=117354876
  alt: "harmonyos刷机,别找了,这可能是全网最全的鸿蒙OpenHarmony刷机指南"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     harmonyos刷机,别找了，这可能是全网最全的鸿蒙（OpenHarmony）刷机指南
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <div style="font-size:16px;">
     <p align="center">
      <img alt="e74269f742bb91f41fe175db0dbf57c7.png" src="https://i-blog.csdnimg.cn/blog_migrate/4e55ede50efce8809289994b083390b5.png"/>
     </p>
     <p>
      摘要：相信很多同学都玩过鸿蒙(HarmonyOS)了，不过估计大多数同学都只是用鸿蒙开发App，与开发Android App也没啥区别。不过鸿蒙还有更有意思的玩法，那就是与硬件结合，也就是IoT。本文将教大家如何将鸿蒙刷到开发板上，通过这些开发板可以控制更多的硬件。
     </p>
     <p>
      本文的目的是将鸿蒙2.0刷到润和Hi3861、Hi3516和Hi3518开发板上。目前网上已经有很多关于刷鸿蒙2.0的文章，我整理了一下，并结合自己的经验，在本文中阐述了从配置环境，到编译鸿蒙源代码，再到刷机的全过程。
     </p>
     <p>
      注意：这里的Hi3861相当于Ardiuno，价格也差不多，主要用于控制外设，本身并没有多少计算能力，Hi3516和Hi3518的配置相对较高，支持GUI。有点类似于树莓派。
     </p>
     <p>
      本文主要以Hi3861为例，其他两个开发板的编译和刷机过程类似。
     </p>
     <p>
      Hi3581需要分为编译环境和烧录环境，目前编译环境只能是Linux，推荐使用Ubuntu Linux 20.04，用这个版本你会少了很多麻烦。至少Python环境直接是3.8.5了，大家可以不用理会Python了，因为编译HarmonyOS，Python的版本是3.7或以上版本即可，经过测试，Python 3.9也没问题。
     </p>
     <p>
      Hi3581的刷机环境需要使用Windows，推荐使用Windows 10，Home版、专业版都经过了测试，没问题，企业版的Windows还没测试，但大概率也没问题。
     </p>
     <p>
      所以这里是重点：需要准备Ubuntu 20.04和Windows 10。 Ubuntu 20.04可以安装的虚拟机中，我用的是VMWare，这样可以通过快照在不同状态之前切换。
     </p>
     <p>
      1. 配置编译环境
     </p>
     <p>
      现在开始配置Ubuntu 20.04的编译环境，读者需要按着如下几步操作：
     </p>
     <p>
      (1)配置 repo 工具
     </p>
     <p>
      如果你的Linux系统上还没有配置repo命令，需要先按下面的操作下载并配置repo命令行工具：
     </p>
     <p>
      mkdir ~/bin/
     </p>
     <p>
      curl https://gitee.com/oschina/repo/raw/fork_flow/repo-py3 &gt; ~/bin/repo
     </p>
     <p>
      chmod +x ~/bin/repo
     </p>
     <p>
      echo 'export PATH=~/bin:$PATH'&gt;&gt; ~/.bashrc
     </p>
     <p>
      source ~/.bashrc
     </p>
     <p>
      如果还没有curl命令，需要先执行下面的命令下载curl：
     </p>
     <p>
      sudo apt install curl
     </p>
     <p>
      (2)下载HarmonyOS源代码
     </p>
     <p>
      读者可按下面的操作下载HarmonyOS的最新源代码
     </p>
     <p>
      mkdir -p ~/harmonyos/openharmony &amp;&amp; cd ~/harmonyos/openharmony
     </p>
     <p>
      sudo apt install --no-install-recommends git python # repo工具本身是python脚本，它会调用git命令下载单个代码仓
     </p>
     <p>
      git config --global user.name "yourname"
     </p>
     <p>
      git config --global user.email "your-email-address"
     </p>
     <p>
      repo init -u https://gitee.com/openharmony/manifest.git -b master --no-repo-verify
     </p>
     <p>
      repo sync -c  # 以后每天同步远程仓的修改，只需要执行这一条命令即可
     </p>
     <p>
      读者需要将yourname改成自己的名字，将your-email-address改成自己的email。
     </p>
     <p>
      (3)检测mkfs.vfat和mcopy命令是否安装
     </p>
     <p>
      在终端执行这两个命令，如果没有安装，使用apt安装这两个命令
     </p>
     <p>
      (4)安装各种工具和包
     </p>
     <p>
      在终端执行下面的命令进行安装：
     </p>
     <p>
      sudo apt-get install dosfstools mtools  # 官方文档说明的两个文件系统打包工具
     </p>
     <p>
      sudo apt-get install zip       # 官方文档虽然没有写，但是打包rootfs过程中需要使用
     </p>
     <p>
      sudo apt install mtd-utils     # 3518需要打包 jffs2 镜像的mkfs.jffs2 命令，需要安装这个包
     </p>
     <p>
      sudo apt install build-essential # 安装gcc/g++/make等工具，ffmpeg的测试过程中需要使用
     </p>
     <p>
      (5)下载各种编译器和工具包
     </p>
     <p>
      下面的命令分别下载了gn、ninja、LLVM、hc-gen包，一步到位
     </p>
     <p>
      # 下载gn/ninja/LLVM/hc-gen包
     </p>
     <p>
      URL_PREFIX=https://repo.huaweicloud.com/harmonyos/compiler
     </p>
     <p>
      DOWNLOAD_DIR=~/Downloads                # 下载目录，可自行修改
     </p>
     <p>
      TOOLCHAIN_DIR=~/harmonyos/toolchain     # 工具链存放目录，可自行修改
     </p>
     <p>
      [ -e $DOWNLOAD_DIR ] || mkdir $DOWNLOAD_DIR
     </p>
     <p>
      [ -e $TOOLCHAIN_DIR ] || mkdir -p $TOOLCHAIN_DIR
     </p>
     <p>
      wget -P $DOWNLOAD_DIR $URL_PREFIX/gn/1523/linux/gn.1523.tar
     </p>
     <p>
      wget -P $DOWNLOAD_DIR $URL_PREFIX/ninja/1.9.0/linux/ninja.1.9.0.tar
     </p>
     <p>
      wget -P $DOWNLOAD_DIR $URL_PREFIX/clang/9.0.0-34042/linux/llvm-linux-9.0.0-34042.tar
     </p>
     <p>
      wget -P $DOWNLOAD_DIR $URL_PREFIX/hc-gen/0.65/linux/hc-gen-0.65-linux.tar
     </p>
     <p>
      # 编译 hi3861 需要 riscv 编译工具链
     </p>
     <p>
      wget -P $DOWNLOAD_DIR $URL_PREFIX/gcc_riscv32/7.3.0/linux/gcc_riscv32-linux-7.3.0.tar.gz
     </p>
     <p>
      # 解压gn/ninja/LLVM/hc-gen包：
     </p>
     <p>
      tar -C $TOOLCHAIN_DIR/ -xvf $DOWNLOAD_DIR/gn.1523.tar
     </p>
     <p>
      tar -C $TOOLCHAIN_DIR/ -xvf $DOWNLOAD_DIR/ninja.1.9.0.tar
     </p>
     <p>
      tar -C $TOOLCHAIN_DIR/ -xvf $DOWNLOAD_DIR/llvm-linux-9.0.0-34042.tar
     </p>
     <p>
      tar -C $TOOLCHAIN_DIR/ -xvf $DOWNLOAD_DIR/hc-gen-0.65-linux.tar
     </p>
     <p>
      tar -C $TOOLCHAIN_DIR/ -xvf $DOWNLOAD_DIR/gcc_riscv32-linux-7.3.0.tar.gz
     </p>
     <p>
      # 向 ~/.bashrc 中追加gn/ninja/LLVM/hc-gen路径配置：
     </p>
     <p>
      cat &lt;&gt; ~/.bashrc
     </p>
     <p>
      TOOLCHAIN_DIR=$TOOLCHAIN_DIR
     </p>
     <p>
      export PATH=\$TOOLCHAIN_DIR/gn:\$PATH
     </p>
     <p>
      export PATH=\$TOOLCHAIN_DIR/ninja:\$PATH
     </p>
     <p>
      export PATH=\$TOOLCHAIN_DIR/llvm/bin:\$PATH
     </p>
     <p>
      export PATH=\$TOOLCHAIN_DIR/hc-gen:\$PATH
     </p>
     <p>
      export PATH=\$TOOLCHAIN_DIR/gcc_riscv32/bin:\$PATH
     </p>
     <p>
      export PATH=~/.local/bin:\$PATH       # 用户pip二进制工具目录
     </p>
     <p>
      EOF
     </p>
     <p>
      # 生效环境变量
     </p>
     <p>
      source ~/.bashrc
     </p>
     <p>
      (6)改变pip源，加速下载
     </p>
     <p>
      执行下面的命令重新配置pip.conf文件
     </p>
     <p>
      mkdir ~/.pip/
     </p>
     <p>
      cat &lt; ~/.pip/pip.conf
     </p>
     <p>
      [global]
     </p>
     <p>
      index-url = https://mirrors.huaweicloud.com/repository/pypi/simple
     </p>
     <p>
      trusted-host = mirrors.huaweicloud.com
     </p>
     <p>
      timeout = 120
     </p>
     <p>
      EOF
     </p>
     <p>
      另外，如果没有pip命令，是因为默认叫pip3，可以执行下面的命令创建pip命令。
     </p>
     <p>
      ln -s /usr/bin/pip3 /usr/bin/pip
     </p>
     <p>
      (7)继续安装各种包
     </p>
     <p>
      # 安装 setuptools 和 kconfiglib
     </p>
     <p>
      pip3 install setuptools kconfiglib
     </p>
     <p>
      # 安装编译hi3861需要的pip包
     </p>
     <p>
      pip3 install scons ecdsa pycryptodome
     </p>
     <p>
      2. 编译HarmonyOS源代码
     </p>
     <p>
      (1)查看支持的平台
     </p>
     <p>
      通过执行python build.py -h命令，可以查看HarmonyOS当前支持哪些平台，如图1所示。
     </p>
     <p align="center">
      <img alt="63f4d89f438b97c0d0fc5be50a700472.png" src="https://i-blog.csdnimg.cn/blog_migrate/f785a379aadc0e0e4750174eaa88080a.png"/>
     </p>
     <p>
      第1个是hi3561，第2个是hi3518，第3个是hi3861。
     </p>
     <p>
      (2)分别执行和3个命令来编译这3个版本的目标文件
     </p>
     <p>
      如果要增加调试信息，后面可以加-b debug
     </p>
     <p>
      # 编译hi3561
     </p>
     <p>
      python build.py ipcamera_hi3516dv300 -b debug
     </p>
     <p>
      # 编译hi3518
     </p>
     <p>
      python build.py ipcamera_hi3518dv300 -b debug
     </p>
     <p>
      # 编译hi3861
     </p>
     <p>
      python build.py wifiiot
     </p>
     <p>
      执行这3行命令，会在
     </p>
     <p>
      编译完的二进制文件下载方式在本文后面。
     </p>
     <p>
      3. 烧录HarmonyOS
     </p>
     <p>
      本文以Hi3861开发板为例，开发板样式如图2所示。
     </p>
     <p align="center">
      <img alt="79649d3b3896ff05f803796f67d8935b.png" src="https://i-blog.csdnimg.cn/blog_migrate/06bfb6ea21c2a289dc7d1c97c29693c2.png"/>
     </p>
     <p>
      需要按下面的步骤进行烧录。
     </p>
     <p>
      (1)将Hi3861_wifiiot_app_allinone.bin文件复制到Windows10中(随便放一个目录就可以)。
     </p>
     <p>
      (2)用Hi3861连接线将开发板与PC连接。
     </p>
     <p>
      (3)检查设备管理器，看看是否正确识别Hi3861开发板，如果正确识别，如图3所示。
     </p>
     <p align="center">
      <img alt="710e8a6464d389e56433284228bc4802.png" src="https://i-blog.csdnimg.cn/blog_migrate/e47deaaae26b6559ab9f813d77e3a01e.png"/>
     </p>
     <p>
      如果设备管理器没有“端口(COM和LPT)”节点，那是因为被隐藏了，点击“查看”&gt;“显示隐藏的设备”菜单项，就会显示，如图4所示。
     </p>
     <p align="center">
      <img alt="c0ef43a68862ab0c9055181f87b21f83.png" src="https://i-blog.csdnimg.cn/blog_migrate/7e4714177f334364f70291d5367bfddb.png"/>
     </p>
     <p>
      通常Windows 10会自动安装驱动，如果不幸没有自动安装驱动，那么可以自行下载。Hi3861使用的是CH340G芯片，读者可自己在google搜索该芯片驱动的下载地址，也可以在本文后面下载驱动文件。
     </p>
     <p>
      (4)运行HiBurn.exe
     </p>
     <p>
      这个工具是海思做的，用于烧录开发板，华为推出的驱动开发工具内置了该工具，读者也可以在本文后面下载该工具。
     </p>
     <p>
      运行后，在COM中选择图3看到的COM端口号(如图5所示)，本例是COM4。
     </p>
     <p align="center">
      <img alt="8f124824706ef6d10704c76bd469f28c.png" src="https://i-blog.csdnimg.cn/blog_migrate/402edd1327a460ca98051992631f2061.png"/>
     </p>
     <p>
      (5)选择传输速率
     </p>
     <p>
      点击HiBurn中的Setting &gt; com settings菜单项，弹出Com settings对话框，在Baud中选择3000000，让烧录速度更快，如图6所示。
     </p>
     <p align="center">
      <img alt="4f8777c7ecb123198d90d2c82ee02ee6.png" src="https://i-blog.csdnimg.cn/blog_migrate/1104937ae845e17f6956196ab1f8d193.png"/>
     </p>
     <p>
      (6)点击Select file按钮，选择Hi3861_wifiiot_app_allinone.bin文件，在下方列表中会出现如图7所示的3个烧录项。这个文件其实是多个烧录项的合体。
     </p>
     <p align="center">
      <img alt="5bcdf41fe6e1083bc5b8d22c2c459784.png" src="https://i-blog.csdnimg.cn/blog_migrate/7822aa6bf49968db663cfbb5ca906b67.png"/>
     </p>
     <p>
      (7)开始烧录
     </p>
     <p>
      选中Send file按钮旁边的Auto burn复选框，然后点击上方的connect按钮，这时下方日志栏会出现Connecting字样，如图8所示。
     </p>
     <p align="center">
      <img alt="988839bbd3bc096ea13194e279846546.png" src="https://i-blog.csdnimg.cn/blog_migrate/afc96e379ee1e99c2dbbaf7b329bf996.png"/>
     </p>
     <p>
      (8)最后按一下图2所示开发板上的Reset Key，就会开始烧录，如图9所示。
     </p>
     <p>
      这是因为Hi3861开发板需要重启，才会检测boot动作，如果遇到烧录的指令，就会烧录，否则就会正常启动。
     </p>
     <p>
      如果烧录成功，会显示如图9所示的信息。
     </p>
     <p align="center">
      <img alt="8125e5db19ded1fd31c10b50e0d2dec6.png" src="https://i-blog.csdnimg.cn/blog_migrate/2c8fc9832b8eb0360bc836be06c3af03.png"/>
     </p>
     <p>
      另外，AI Camera和DIY IPC套件附赠的USB串口线中集成了PL2302芯片，需要安装USB-to-Serial Comm Port.exe驱动才可以被Windows识别，下载地址： http://www.hihope.org/download
     </p>
     <p>
      OK，然后就可以愉快滴玩耍了。后期会推出基于HI3861以及其他HarmonyOS开发板的有趣的IoT项目的文章和视频课程，敬请期待。
     </p>
     <p>
      文章后续内容和相关附件可以点击下面的原文链接前往学习
     </p>
     <p align="center">
      <img alt="f85dcc3a28b63ceb1372ebe04bb96d66.png" src="https://i-blog.csdnimg.cn/blog_migrate/615b8582dacc24fb1cd8575cd832a50c.png"/>
     </p>
     <p>
      【编辑推荐】
     </p>
     <p>
      【责任编辑：jianghua TEL：(010)68476606】
     </p>
     <p>
      点赞 0
     </p>
    </div>
   </div>
  </div>
  <div id="recommendDown">
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f33393633373636312f:61727469636c652f64657461696c732f313137333534383736" class_="artid" style="display:none">
 </p>
</div>
