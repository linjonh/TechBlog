---
layout: post
title: "vue3导入excel并解析excel数据渲染到表格中,纯前端实现"
date: 2023-12-29 17:36:42 +0800
description: "文章讲述了如何在前端使用插件xlsxelementUI的Upload组件实现用户上传Excel文件，"
keywords: "vue3 解析 excel 并上传数据"
categories: ["未分类"]
tags: ["前端", "Vue", "Excel"]
artid: "135291461"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=135291461
  alt: "vue3导入excel并解析excel数据渲染到表格中,纯前端实现"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     vue3导入excel并解析excel数据渲染到表格中，纯前端实现。
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h4>
     需求
    </h4>
    <p>
     用户将已有的excel上传到系统，并将excel数据同步到页面的表格中进行二次编辑，由于excel数据不是最终数据，只是批量的一个初始模板，后端不需要存储，所以该功能由前端独立完成。
    </p>
    <h4>
     吐槽
    </h4>
    <p>
     系统中文件上传下载预览三部曲走了一遍，万万没想到还要自己实现同步数据。
    </p>
    <h4>
     实际
    </h4>
    <p>
     反手各种资料开始查阅，终于找到了可以完美实现该需求的方法，来记录下我的实现方案。希望对有需要的小伙伴有帮助。
    </p>
    <p>
     <strong>
      <span style="color:#fe2c24;">
       注意以下为正文（重要内容），好好阅读，不要漏掉重要知识点奥~
      </span>
     </strong>
    </p>
    <hr/>
    <h4>
     涉及到的主要知识点
    </h4>
    <ul>
     <li>
      插件xlsx
     </li>
     <li>
      elementUI  plus中的Upload 上传组件
     </li>
     <li>
      动态设置 ref
     </li>
    </ul>
    <p>
     展开说说：
    </p>
    <p>
     <strong>
      1、插件xlsx
     </strong>
    </p>
    <pre><code class="language-javascript">// 在项目根路径 安装xlsx
npm install -S xlsx

// 在需要使用的页面引入 xlsx
import \* as xlsx from 'xlsx'</code></pre>
<p>
2、upload 上传组件
</p>
<p>
上传组件的自动上传方法，传参方法，详细可翻阅
<a class="link-info" href="https://element-plus.org/zh-CN/component/upload.html#%E5%B1%9E%E6%80%A7" rel="nofollow" title="elementUI plus官网">
elementUI plus 官网
</a>
</p>
<p>
<strong>
3、动态设置 ref
</strong>
</p>
<p>
涉及到动态设置 ref 的原因：
</p>
<p>
一是由于 upload 组件在设置了 :limit="1"，在上传第一个文件之后，浏览器会保存着我们已经上传的文件，导致我们继续上传文件的时候，页面没有反应；解决该问题需要在 on-success 钩子函数中通过 ref 来清除已经上传的文件。
</p>
<pre><code class="language-javascript">&lt;template&gt;
&lt;div&gt;
&lt;el-upload
ref="importExcelRef"
:action="VITE*APP_API_URL"
:limit="1"
:show-file-list="false"
class="uploadExcelContent"
:on-success="importSuccess"  
 &gt;
&lt;div title="导入 excel"&gt;
&lt;div class="importExcel"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/el-upload&gt;
&lt;/div&gt;
&lt;/template&gt;
&lt;script setup&gt;
import { ref } from 'vue'
const importExcelRef = ref(null)
const importSuccess = ()=&gt;{
importExcelRef.value.clearFiles();
}
&lt;/script&gt;</code></pre>
<p>
二是因为表单中存在多个表格需要导入 excel 作为基础数据进行编辑，且表格数量不固定，是根据后端数据渲染的，所以在清空上传文件的时候，需要处理未知的多个，所以需要动态设置 ref。
</p>
<pre><code class="language-javascript">&lt;template&gt;
&lt;div&gt;
&lt;el-upload :ref="(el) =&gt; handleSetUploadRefMap(el, rowIndex,compIndex)"&gt;
&lt;div title="导入 excel" &gt;
&lt;div class="importExcel"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/el-upload&gt;
&lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
import { ref } from 'vue'
const uploadRefMap = ref({});
// 动态设置 upload Ref
const handleSetUploadRefMap = (el,rowIndex,compIndex) =&gt; {
if (el) {
uploadRefMap.value[`Upload_Ref*${rowIndex}_${compIndex}`] = el
}
}
&lt;/script&gt;</code></pre>
<h4>
需求实现代码
</h4>
<pre><code class="language-javascript">&lt;template&gt;
&lt;div&gt;
&lt;!-- 上传 excel --&gt;
&lt;el-upload
:ref="(el) =&gt; handleSetUploadRefMap(el)"
action=""
:http-request="httpExcelRequest"
:limit="1"
:show-file-list="false"
class="uploadExcelContent"
:data={}
&gt;
&lt;div title="导入 excel" style="cursor: pointer;" &gt;
&lt;div&gt;导入 excel&lt;/div&gt;
&lt;/div&gt;
&lt;/el-upload&gt;

      &lt;!-- 列表 --&gt;
      &lt;div class="excel-content"  v-for="(rowItem,rowIndex) in excelList" :key="rowIndex"&gt;
        &lt;div class="comp" v-for="(comp,compIndex) in rowItem" :key="compIndex"&gt;{<!-- -->{comp}}&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;

&lt;/template&gt;

&lt;script setup name="mainContent"&gt;
import \* as xlsx from 'xlsx'
import {ElMessage} from 'element-plus'
import { ref } from 'vue'
const uploadRefMap = ref({});
const excelList = ref([])

// 动态设置 upload Ref
const handleSetUploadRefMap = (el) =&gt; {
if (el) {
uploadRefMap.value[`Upload_Ref`] = el
}
}

// 文件上传自定义
const httpExcelRequest = async (op) =&gt; {
// 获取除文件之外的参数，具体根据实际业务需求来
console.log(op.data)
// 获取上传的 excel 并解析数据
let file = op.file
let dataBinary = await readFile(file);
let workBook = xlsx.read(dataBinary, { type: "binary", cellDates: true })
let workSheet = workBook.Sheets[workBook.SheetNames[0]]
const excelData = xlsx.utils.sheet_to_json(workSheet,{ header: 1 })
excelList.value = excelData
console.log(excelData)
if(uploadRefMap.value[`Upload_Ref`]){
uploadRefMap.value[`Upload_Ref`].clearFiles();
}
}

const readFile = (file) =&gt; {
return new Promise((resolve) =&gt; {
let reader = new FileReader()
reader.readAsBinaryString(file)
reader.onload = (ev) =&gt; {
resolve(ev.target?.result)
}
})
}

&lt;/script&gt;

&lt;style lang="scss" scoped&gt;
.uploadExcelContent{
display: flex;
flex-direction: row;
}
.excel-content{
display: flex;
flex-direction: row;
align-items: center;
.comp{
width: 200px;
font-size: 12px;
}
}
&lt;/style&gt;</code></pre>
<p>
由于业务需求不同，对表格数据的详细处理逻辑，就不在这里显示了，可根据自己的数据结构进行赋值操作，运行 demo 后可以直接在控制台查看拿到的 excel 数据。
<br/>
<br/>
今天就到这里了，会继续加油的，是亮晶晶的芋头哟~
</p>

   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34303539373637362f:61727469636c652f64657461696c732f313335323931343631" class_="artid" style="display:none">
 </p>
</div>
