---
layout: post
title: 2024-03-11-5.0--数据库完整性详解PRIMARY-KEYREFERENCESCHECKCONSTRAINTDOMAINTRIGGER
date: 2024-03-11 07:30:00 +0800
categories: ['数据库系统概论']
tags: ['Sql', '数据库完整性', 'Oracle', 'S', '数据库系统概论']
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=105359554
  alt: 5.0--数据库完整性详解PRIMARY-KEYREFERENCESCHECKCONSTRAINTDOMAINTRIGGER
artid: 105359554
render_with_liquid: false
---
<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     5.0  数据库完整性详解（PRIMARY KEY、REFERENCES、CHECK、CONSTRAINT、DOMAIN、TRIGGER）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <ul>
        <li>
         <a href="#0_3" rel="nofollow">
          0.思维导图
         </a>
        </li>
        <li>
         <a href="#1_5" rel="nofollow">
          1.数据库完整性概述
         </a>
        </li>
        <li>
         <a href="#2PRIMARY_KEY_28" rel="nofollow">
          2.实体完整性---PRIMARY KEY
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#1_29" rel="nofollow">
            （1）实体完整性的定义
           </a>
          </li>
          <li>
           <a href="#2_72" rel="nofollow">
            （2）实体完整性检查和违约处理
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#2REFERENCES_84" rel="nofollow">
          2.参照完整性---REFERENCES
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#1_85" rel="nofollow">
            （1）参照完整性定义
           </a>
          </li>
          <li>
           <a href="#2_108" rel="nofollow">
            （2）参照完整性检查和违约处理
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#3CHECK_148" rel="nofollow">
          3.用户定义的完整性---CHECK
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#1_152" rel="nofollow">
            （1）属性上的约束条件定义
           </a>
          </li>
          <li>
           <a href="#2_198" rel="nofollow">
            （2）属性上的约束条件检查和处理
           </a>
          </li>
          <li>
           <a href="#3_202" rel="nofollow">
            （3）元组上的约束条件的定义
           </a>
          </li>
          <li>
           <a href="#4_223" rel="nofollow">
            （4）元组上的约束条件检查和违约处理
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#4CONSTRAINT_227" rel="nofollow">
          4.完整性约束命名子句---CONSTRAINT
         </a>
        </li>
        <li>
         <a href="#5DOMAIN_274" rel="nofollow">
          5.域中的完整性限制---DOMAIN
         </a>
        </li>
        <li>
         <a href="#6ASSERTION_300" rel="nofollow">
          6.断言---ASSERTION
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#1_306" rel="nofollow">
            （1）定义断言
           </a>
          </li>
          <li>
           <a href="#2_339" rel="nofollow">
            （2）删除断言
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#7TRIGGER_343" rel="nofollow">
          7.触发器---TRIGGER
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#1_348" rel="nofollow">
            （1）定义触发器
           </a>
          </li>
          <li>
           <a href="#2_430" rel="nofollow">
            （2）激活触发器
           </a>
          </li>
          <li>
           <a href="#3_448" rel="nofollow">
            （3）删除触发器
           </a>
          </li>
         </ul>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <hr/>
    <h3>
     <a id="0_3">
     </a>
     0.思维导图
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4ef87c9ce8979141b49b56d03a19838c.png"/>
    </p>
    <h3>
     <a id="1_5">
     </a>
     1.数据库完整性概述
    </h3>
    <p>
     <strong>
      简单介绍：
     </strong>
    </p>
    <ul>
     <li>
      首先先概述一下数据库完整性指的是什么，
      <code>
       数据库完整性
      </code>
      指的是数据的
      <code>
       正确性
      </code>
      和
      <code>
       相容性
      </code>
      。
     </li>
     <li>
      数据的
      <code>
       正确性
      </code>
      是指数据是符合现实世界语义、反映当前实际状况的;比如说人类的性别，只能是男和女。
     </li>
     <li>
      数据的
      <code>
       相容性
      </code>
      是指数据库同一对象在不同关系表中的数据是符合逻辑的。比如说年龄一般都在1-100岁，当然也有超过一百岁的，反正没有两百岁，三百岁成仙的人类。
     </li>
    </ul>
    <p>
     <strong>
      既然我们学的是数据库，那么数据库管理系统就应该为数据完整性实现如下的功能：
     </strong>
    </p>
    <p>
     1.提供定义完整性约束条件的机制
    </p>
    <ul>
     <li>
      完整约束条件也称
      <code>
       完整性规则
      </code>
      ，是数据库中数据必须满足的语义条件规则
     </li>
     <li>
      为保证数据的正确、有效和相容性的一些规则
     </li>
     <li>
      数据的主码、外码、一些约束规则
     </li>
    </ul>
    <p>
     2.提供完整性检查的方法
    </p>
    <ul>
     <li>
      数据库管理系统中检查数据是否满足完整性规则的机制称为
      <code>
       完整性检查
      </code>
     </li>
     <li>
      一般在执行INSERT、UPDATE、DELETE时检查
     </li>
    </ul>
    <p>
     3.违约处理
    </p>
    <ul>
     <li>
      数据库管理系统若发现用户的操作违背了完整性约束条件将采取一定的动作，如拒绝(NO ACTION)执行该操作或级联(CASCADE)执行其他操作，进行违约处理以保证数据的完整性。
     </li>
    </ul>
    <p>
     <strong>
      此前写的一篇文章提到了关系完整性约束的基本概念
      <a href="https://blog.csdn.net/weixin_43914604/article/details/105104581">
       关系完整性的基本概念
      </a>
      ，而本篇文章讲的是利用SQL如何去实现这些约束机制，如何实现完整性规则
     </strong>
    </p>
    <h3>
     <a id="2PRIMARY_KEY_28">
     </a>
     2.实体完整性—PRIMARY KEY
    </h3>
    <h4>
     <a id="1_29">
     </a>
     （1）实体完整性的定义
    </h4>
    <p>
     <strong>
      关系模型的实体完整性
     </strong>
    </p>
    <ul>
     <li>
      CREATE TABLE中用PRIMARY KEY定义
     </li>
    </ul>
    <p>
     <strong>
      单属性构成的码有两种说明方法
     </strong>
    </p>
    <ul>
     <li>
      定义为列级约束条件
     </li>
     <li>
      定义为表级约束条件
     </li>
    </ul>
    <p>
     <strong>
      对多个属性构成的码只有一种说明方法
     </strong>
    </p>
    <ul>
     <li>
      定义为表级约束条件
     </li>
    </ul>
    <p>
     <code>
      举几个例子
     </code>
    </p>
    <pre><code class="prism language-sql">将Student表中的Sno属性定义为码

<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>在列级定义主码
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Student
<span class="token punctuation">(</span>Sno  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span>，
Sname  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>，     
Ssex  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> ，
Sage  <span class="token keyword">SMALLINT</span>，
Sdept  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>在表级定义主码
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Student
<span class="token punctuation">(</span>Sno  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>，  
Sname  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>，
Ssex  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> ，
Sage  <span class="token keyword">SMALLINT</span>，
Sdept  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>，
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>Sno<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> 

将SC表中的Sno，Cno属性组定义为码
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> SC
<span class="token punctuation">(</span>Sno   <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span>， 
Cno  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span>，  
Grade    <span class="token keyword">SMALLINT</span>，
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>Sno，Cno<span class="token punctuation">)</span>     <span class="token comment">/*只能在表级定义主码*/</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre>
    <h4>
     <a id="2_72">
     </a>
     （2）实体完整性检查和违约处理
    </h4>
    <p>
     <strong>
      插入或对主码列进行更新操作时，RDBMS按照实体完整性规则自动进行检查。包括：
     </strong>
    </p>
    <ol>
     <li>
      检查主码值是否唯一，如果不唯一则拒绝插入或修改
     </li>
     <li>
      检查主码的各个属性是否为空，只要有一个为空就拒绝插入或修改
     </li>
    </ol>
    <p>
     <strong>
      检查记录中主码值是否唯一的一种方法是进行全表扫描
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7d7f829bf854ee6105c0abfc2ba71db7.png"/>
    </p>
    <ul>
     <li>
      全表扫描是十分耗时的。为了避免对基本表进行全表扫描，关系数据库管理系统一般 都在主码上
      <code>
       自动建立一个索引
      </code>
      ，如图5.2的B+树索引，通过索引查找基本表中是否已经存在新的主码值将大大提高效率。
     </li>
     <li>
      例如，如果新插入记录的主码值是25，通过主码索引，从B+树的根结点开始查找，只要读取三个结点就可以知道该主码值已经存在，所以不能插入这条记录。这三个结点是根结点(51)、中间结点(1230)和叶结点(15 20 25)。
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/88bcb48e6d6f2c08719ee5f16cd3d8e5.png"/>
    </p>
    <h3>
     <a id="2REFERENCES_84">
     </a>
     2.参照完整性—REFERENCES
    </h3>
    <h4>
     <a id="1_85">
     </a>
     （1）参照完整性定义
    </h4>
    <p>
     <strong>
      关系模型的参照完整性定义
     </strong>
    </p>
    <ul>
     <li>
      在CREATE TABLE中用
      <code>
       FOREIGN KEY
      </code>
      短语定义哪些列为外码
     </li>
     <li>
      用
      <code>
       REFERENCES
      </code>
      短语指明这些外码参照哪些表的主码
     </li>
    </ul>
    <p>
     <strong>
      举个例子
     </strong>
    </p>
    <pre><code class="prism language-sql">例如，关系SC中一个元组表示一个学生选修的某门课程的成绩，
（Sno，Cno）是主码。
Sno，Cno分别参照引用Student表的主码和Course表的主码 

定义SC中的参照完整性
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> SC
<span class="token punctuation">(</span>Sno    <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span>， 
Cno     <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span>，  
Grade    <span class="token keyword">SMALLINT</span>，
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>Sno， Cno<span class="token punctuation">)</span>，   <span class="token comment">/*在表级定义实体完整性*/</span>
<span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>Sno<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Student<span class="token punctuation">(</span>Sno<span class="token punctuation">)</span>，  
<span class="token comment">/*在表级定义参照完整性*/</span>
<span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>Cno<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Course<span class="token punctuation">(</span>Cno<span class="token punctuation">)</span>    
<span class="token comment">/*在表级定义参照完整性*/</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="2_108">
     </a>
     （2）参照完整性检查和违约处理
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3231b74c6f56aa37530547e9f60d2b86.png"/>
    </p>
    <p>
     <strong>
      参照完整性违约处理
     </strong>
    </p>
    <ol>
     <li>
      <p>
       拒绝(NO ACTION)执行
       <br/>
       默认策略
      </p>
     </li>
     <li>
      <p>
       级联(CASCADE)操作
      </p>
     </li>
     <li>
      <p>
       设置为空值（SET-NULL）
       <br/>
       对于参照完整性，除了应该定义外码，还应定义
       <code>
        外码列是否允许空值
       </code>
      </p>
     </li>
    </ol>
    <pre><code class="prism language-sql">［例<span class="token number">4</span>］  显式说明参照完整性的违约处理示例
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> SC
<span class="token punctuation">(</span>Sno   <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span>，
Cno   <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span>，
Grade  <span class="token keyword">SMALLINT</span>，
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span>（Sno，Cno）， 				
<span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>Sno<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Student<span class="token punctuation">(</span>Sno<span class="token punctuation">)</span> 
<span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span>     <span class="token comment">/*级联删除SC表中相应的元组*/</span>
<span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span>， <span class="token comment">/*级联更新SC表中相应的元组*/</span>
<span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>Cno<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Course<span class="token punctuation">(</span>Cno<span class="token punctuation">)</span> 	                    
<span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">NO</span> <span class="token keyword">ACTION</span> 	
<span class="token comment">/*当删除course 表中的元组造成了与SC表不一致时拒绝删除*/</span>
<span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span>   
<span class="token comment">/*当更新course表中的cno时，级联更新SC表中相应的元组*/</span>
<span class="token punctuation">)</span>；
</code></pre>
    <ul>
     <li>
      经过测试，当UPDATE更新Student和Course表数据时，SC也自动更新
     </li>
     <li>
      当删除Student的数据时，SC同步删除相应数据
     </li>
     <li>
      当删除Course的数据时，拒绝删除，因为SC中有相应的外码数据，并设置了NO ACTION
     </li>
     <li>
      当删除SC的数据时，对Student和Course无影响
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d2a0a756e4c20267eb5a102354efcd66.png"/>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0e3d5e1b9941b8cdb5ef04eb001d7682.png"/>
    </p>
    <h3>
     <a id="3CHECK_148">
     </a>
     3.用户定义的完整性—CHECK
    </h3>
    <ul>
     <li>
      用户定义的完整性就是针对
      <code>
       某一具体应用的数据
      </code>
      必须满足的语义要求
     </li>
     <li>
      RDBMS提供，而不必由应用程序承担
     </li>
    </ul>
    <h4>
     <a id="1_152">
     </a>
     （1）属性上的约束条件定义
    </h4>
    <p>
     <strong>
      CREATE TABLE时定义
     </strong>
    </p>
    <ul>
     <li>
      列值非空（NOT NULL）
     </li>
     <li>
      列值唯一（UNIQUE）
     </li>
     <li>
      检查列值是否满足一个布尔表达式（CHECK）
     </li>
    </ul>
    <pre><code class="prism language-sql"><span class="token number">1.</span>不允许取空值 

［例<span class="token number">5</span>］  在定义SC表时，说明Sno、Cno、Grade属性不允许取空值。

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> SC
<span class="token punctuation">(</span>Sno  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span>，	
Cno  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span>，	
Grade  <span class="token keyword">SMALLINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>，	
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>Sno， Cno<span class="token punctuation">)</span>，  
<span class="token comment">/* 如果在表级定义实体完整性，隐含了Sno，Cno不允许取空值，
则在列级不允许取空值的定义就不必写了 */</span>
）<span class="token punctuation">;</span>

<span class="token number">2.</span>列值唯一 

［例<span class="token number">6</span>］建立部门表DEPT，要求部门名称Dname列取值唯一，
部门编号Deptno列为主码

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DEPT
<span class="token punctuation">(</span>Deptno  <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>，
Dname  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>  <span class="token keyword">UNIQUE</span>，<span class="token comment">/*要求Dname列值唯一*/</span>
Location  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>，
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>Deptno<span class="token punctuation">)</span>
<span class="token punctuation">)</span>；

<span class="token number">3.</span> 用<span class="token keyword">CHECK</span>短语指定列值应该满足的条件

［例<span class="token number">7</span>］Student表的Ssex只允许取“男”或“女”。

    <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Student
        <span class="token punctuation">(</span>Sno  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span>，
          Sname <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>，                     
          Ssex  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>Ssex <span class="token operator">IN</span> <span class="token punctuation">(</span>‘男’，‘女’<span class="token punctuation">)</span> <span class="token punctuation">)</span> ，                
              <span class="token comment">/*性别属性Ssex只允许取'男'或'女' */</span>
          Sage  <span class="token keyword">SMALLINT</span>，
          Sdept  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="2_198">
     </a>
     （2）属性上的约束条件检查和处理
    </h4>
    <ul>
     <li>
      插入元组或修改属性的值时，RDBMS检查属性上的约束条件是否被满足
     </li>
     <li>
      如果不满足则操作被拒绝执行
     </li>
    </ul>
    <h4>
     <a id="3_202">
     </a>
     （3）元组上的约束条件的定义
    </h4>
    <ul>
     <li>
      在CREATE TABLE时可以用
      <code>
       CHECK
      </code>
      短语定义元组上的约束条件，即
      <code>
       元组级的限制
      </code>
     </li>
     <li>
      同属性值限制相比，元组级的限制可以设置不同属性之间的取值的相互约束条件
     </li>
    </ul>
    <pre><code class="prism language-sql">［例<span class="token number">9</span>］  当学生的性别是男时，其名字不能以Ms<span class="token punctuation">.</span>打头。
    <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Student
         <span class="token punctuation">(</span>Sno    <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>， 
          Sname  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>，
          Ssex    <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>，
          Sage   <span class="token keyword">SMALLINT</span>，
          Sdept  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>，
          <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>Sno<span class="token punctuation">)</span>，
          <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>Ssex<span class="token operator">=</span><span class="token string">'女'</span> <span class="token operator">OR</span> Sname <span class="token operator">NOT</span> <span class="token operator">LIKE</span> <span class="token string">'Ms.%'</span><span class="token punctuation">)</span>
          <span class="token comment">/*定义了元组中Sname和 Ssex两个属性值之间的约束条件*/</span>
        <span class="token punctuation">)</span>；
性别是女性的元组都能通过该项检查，因为Ssex<span class="token operator">=</span>‘女’成立；
当性别是男性时，要通过检查则名字一定不能以Ms<span class="token punctuation">.</span>打头
</code></pre>
    <h4>
     <a id="4_223">
     </a>
     （4）元组上的约束条件检查和违约处理
    </h4>
    <ul>
     <li>
      插入元组或修改属性的值时，RDBMS检查元组上的约束条件是否被满足
     </li>
     <li>
      如果不满足则操作被拒绝执行
     </li>
    </ul>
    <h3>
     <a id="4CONSTRAINT_227">
     </a>
     4.完整性约束命名子句—CONSTRAINT
    </h3>
    <p>
     <strong>
      CONSTRAINT 约束语句格式：
     </strong>
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">CONSTRAINT</span> <span class="token operator">&lt;</span>完整性约束条件名<span class="token operator">&gt;</span>
［<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span>短语
   <span class="token operator">|</span><span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span>短语
   <span class="token operator">|</span><span class="token keyword">CHECK</span>短语］
</code></pre>
    <p>
     举个例子：
    </p>
    <pre><code class="prism language-sql">［例<span class="token number">10</span>］  建立学生登记表Student，要求学号在<span class="token number">90000</span><span class="token operator">~</span><span class="token number">99999</span>之间，
姓名不能取空值，年龄小于<span class="token number">30</span>，性别只能是“男”或“女”。
    <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Student
      <span class="token punctuation">(</span>Sno  <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
        <span class="token keyword">CONSTRAINT</span> C1 <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>Sno <span class="token operator">BETWEEN</span> <span class="token number">90000</span> <span class="token operator">AND</span> <span class="token number">99999</span><span class="token punctuation">)</span>，
        Sname  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>  
        <span class="token keyword">CONSTRAINT</span> C2 <span class="token operator">NOT</span> <span class="token boolean">NULL</span>，
        Sage  <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token keyword">CONSTRAINT</span> C3 <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>Sage <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">)</span>，
        Ssex  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">CONSTRAINT</span> C4 <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>Ssex <span class="token operator">IN</span> <span class="token punctuation">(</span> <span class="token string">'男'</span>，<span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>，
        <span class="token keyword">CONSTRAINT</span> StudentKey <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Sno<span class="token punctuation">)</span>
      <span class="token punctuation">)</span>；
在Student表上建立了<span class="token number">5</span>个约束条件，包括主码约束（命名为StudentKey）
以及C1、C2、C3、C4四个列级约束。
</code></pre>
    <ul>
     <li>
      这个没有C2应该是为主键就忽略没显示叭
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/538d87a8c71868dea14d88bc0c03e8eb.png"/>
     </li>
    </ul>
    <p>
     <strong>
      修改表中的完整性限制
     </strong>
    </p>
    <ul>
     <li>
      使用ALTER TABLE语句修改表中的完整性限制
     </li>
    </ul>
    <pre><code class="prism language-sql">［例<span class="token number">13</span>］  修改表Student中的约束条件，要求学号改为在<span class="token number">900000</span><span class="token operator">~</span><span class="token number">999999</span>之间，
年龄由小于<span class="token number">30</span>改为小于<span class="token number">40</span>
可以先删除原来的约束条件，再增加新的约束条件
		<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Student
        <span class="token keyword">DROP</span> <span class="token keyword">CONSTRAINT</span> C1<span class="token punctuation">;</span>
        <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Student
        <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> C1 <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>Sno <span class="token operator">BETWEEN</span> <span class="token number">900000</span> <span class="token operator">AND</span> <span class="token number">999999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Student
        <span class="token keyword">DROP</span> <span class="token keyword">CONSTRAINT</span> C3<span class="token punctuation">;</span>
        <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Student
        <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> C3 <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>Sage <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f1d8868b0079bd5cd583ef398b0e106a.png"/>
    </p>
    <h3>
     <a id="5DOMAIN_274">
     </a>
     5.域中的完整性限制—DOMAIN
    </h3>
    <blockquote>
     <p>
      关于域的定义有些数据库可能不同，或者定义失败，得观看相关的手册深入学习，但是SQL中是有定义DOMAIN，初学先了解一下叭。
     </p>
    </blockquote>
    <p>
     <strong>
      SQL支持域的概念，并可以用
      <code>
       CREATE DOMAIN
      </code>
      语句建立一个域以及该域应该满足的完整性约束条件。
     </strong>
    </p>
    <pre><code class="prism language-sql">［例<span class="token number">14</span>］建立一个性别域，并声明性别域的取值范围
           <span class="token keyword">CREATE</span> DOMAIN GenderDomain <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
           <span class="token keyword">CHECK</span> <span class="token punctuation">(</span><span class="token keyword">VALUE</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'男'</span>，<span class="token string">'女'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
这样［例<span class="token number">10</span>］中对Ssex的说明可以改写为Ssex GenderDomain

［例<span class="token number">15</span>］建立一个性别域GenderDomain，并对其中的限制命名
           <span class="token keyword">CREATE</span> DOMAIN GenderDomain <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
           <span class="token keyword">CONSTRAINT</span> GD <span class="token keyword">CHECK</span> <span class="token punctuation">(</span> <span class="token keyword">VALUE</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'男'</span>，<span class="token string">'女'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
           
［例<span class="token number">16</span>］删除域GenderDomain的限制条件GD。
           <span class="token keyword">ALTER</span>  DOMAIN  GenderDomain  
           <span class="token keyword">DROP</span> <span class="token keyword">CONSTRAINT</span> GD<span class="token punctuation">;</span>
           
［例<span class="token number">17</span>］在域GenderDomain上增加限制条件GDD。
          <span class="token keyword">ALTER</span>  DOMAIN  GenderDomain  
         <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> GDD <span class="token keyword">CHECK</span> <span class="token punctuation">(</span><span class="token keyword">VALUE</span> <span class="token operator">IN</span> <span class="token punctuation">(</span> <span class="token string">'1'</span>，<span class="token string">'0'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
         
通过［例<span class="token number">16</span>］和［例<span class="token number">17</span>］，就把性别的取值范围由<span class="token punctuation">(</span><span class="token string">'男'</span>，<span class="token string">'女'</span><span class="token punctuation">)</span>改为 <span class="token punctuation">(</span> <span class="token string">'1'</span>，<span class="token string">'0'</span><span class="token punctuation">)</span> 
</code></pre>
    <h3>
     <a id="6ASSERTION_300">
     </a>
     6.断言—ASSERTION
    </h3>
    <blockquote>
     <p>
      关于断言还是和域一样，不同的数据库可能实现方式不同，初学先了解，后期再深入
     </p>
    </blockquote>
    <ul>
     <li>
      在SQL中可以使用数据定义语言中的
      <code>
       CREATE ASSERTION
      </code>
      语句，通过声明性断言(declarative assertions)来指定更具一般性的约束。
     </li>
     <li>
      可以定义涉及多个表或聚集操作的比较复杂的完整性约束。
     </li>
     <li>
      断言创建以后，任何对断言中所涉及关系的操作都会触发关系数据库管理系统对断言的检查，任何使断言不为真值的操作都会被拒绝执行。
     </li>
    </ul>
    <h4>
     <a id="1_306">
     </a>
     （1）定义断言
    </h4>
    <p>
     标准语句格式：
    </p>
    <p>
     <code>
      CREATE ASSERTION &lt;断言名&gt; &lt;CHECK子句&gt;
     </code>
    </p>
    <ul>
     <li>
      每个断言都被赋予一个名字，&lt;CHECK子句&gt;中的约束条件与WHERE子句的条件表达式类似。
     </li>
    </ul>
    <pre><code class="prism language-sql"><span class="token punctuation">[</span>例<span class="token number">5.18</span><span class="token punctuation">]</span>限制数据库课程最多 <span class="token number">60</span>名学生选修。
<span class="token keyword">CREATE</span> ASSERTION ASSE_SC_DB_ NUM
<span class="token keyword">CHECK</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token operator">&gt;=</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token comment">/*此断言的谓词涉及聚集操作count的SQL语句*/</span>
<span class="token keyword">FROM</span> Course<span class="token punctuation">,</span>SC
<span class="token keyword">WHERE</span> SC<span class="token punctuation">.</span>Cno<span class="token operator">=</span>Course<span class="token punctuation">.</span>Cno <span class="token operator">AND</span> Course<span class="token punctuation">.</span>Cname<span class="token operator">=</span>数据库<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
每当学生选修课程时，将在SC表中插入一条元组<span class="token punctuation">(</span>Sno<span class="token punctuation">,</span> Cno<span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
ASSE_SC_DB_NUM断言被触发检查。如果选修数据库课程的人数已经超过<span class="token number">60</span>人，
<span class="token keyword">CHECK</span>子句返回值为“假”，对SC表的插入操作被拒绝。

<span class="token punctuation">[</span>例<span class="token number">5.19</span><span class="token punctuation">]</span>限制每一 门课程最多<span class="token number">60</span>名学生选修。 
<span class="token keyword">CREATE</span> ASSERTION ASSE_SC_CNUMI
<span class="token keyword">CHECK</span><span class="token punctuation">(</span> <span class="token number">60</span><span class="token operator">&gt;=</span><span class="token keyword">ALL</span><span class="token punctuation">(</span> <span class="token keyword">SELECT</span> <span class="token function">count</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token comment">/*此断言的谓词，涉及聚集操作count */</span>
<span class="token keyword">FROM</span> SC							<span class="token comment">/*和分组函数group by的SQL语句*/</span>
<span class="token keyword">GROUP</span> <span class="token keyword">by</span> cno <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span>例<span class="token number">5.20</span> 限制每个学期每一门课程最多<span class="token number">60</span>名学生选修<span class="token punctuation">]</span>
首先修改SC表的模式，增加一个“学期<span class="token punctuation">(</span>TERM<span class="token punctuation">)</span>”的属性。
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> SC <span class="token keyword">ADD</span> TERM <span class="token keyword">DATE</span><span class="token punctuation">;</span>
<span class="token comment">/*先修改SC表，增加TERM属性，它的类型是DATE*/</span>

然后定义断言:
<span class="token keyword">CREATE</span> ASSERTION ASSE_SC_CNUM2
<span class="token keyword">CHECK</span> <span class="token punctuation">(</span><span class="token number">60</span><span class="token operator">&gt;=</span><span class="token keyword">ALL</span> <span class="token punctuation">(</span> <span class="token keyword">select</span> <span class="token function">count</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> SC <span class="token keyword">group</span> <span class="token keyword">by</span> Cno<span class="token punctuation">,</span>TERM <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre>
    <h4>
     <a id="2_339">
     </a>
     （2）删除断言
    </h4>
    <p>
     <code>
      DROP ASSERTION &lt;断言名&gt;;
     </code>
    </p>
    <ul>
     <li>
      如果断言很复杂，则系统在检测和维护断言上的开销较高，这是在使用断言时应该注意的。
     </li>
    </ul>
    <h3>
     <a id="7TRIGGER_343">
     </a>
     7.触发器—TRIGGER
    </h3>
    <ul>
     <li>
      触发器（Trigger）是用户定义在关系表上的一类由
      <code>
       事件驱动
      </code>
      的特殊过程
      <br/>
      由服务器自动激活
     </li>
     <li>
      可以进行更为复杂的检查和操作，具有更精细和更强大的数据控制能力
     </li>
    </ul>
    <h4>
     <a id="1_348">
     </a>
     （1）定义触发器
    </h4>
    <p>
     <strong>
      CREATE TRIGGER语法格式:
     </strong>
    </p>
    <pre><code class="prism language-sql">	  <span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> <span class="token operator">&lt;</span>触发器名<span class="token operator">&gt;</span>  
       {BEFORE <span class="token operator">|</span> <span class="token keyword">AFTER</span>} <span class="token operator">&lt;</span>触发事件<span class="token operator">&gt;</span> <span class="token keyword">ON</span> <span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span>
        <span class="token keyword">FOR</span> EACH  {<!-- --><span class="token keyword">ROW</span> <span class="token operator">|</span> STATEMENT}
      ［<span class="token keyword">WHEN</span> <span class="token operator">&lt;</span>触发条件<span class="token operator">&gt;</span>］
        <span class="token operator">&lt;</span>触发动作体<span class="token operator">&gt;</span>
</code></pre>
    <p>
     <strong>
      定义触发器的语法说明:
     </strong>
    </p>
    <ol>
     <li>
      创建者：表的拥有者
     </li>
     <li>
      触发器名
     </li>
     <li>
      表名：触发器的目标表,不能建立在视图上
     </li>
     <li>
      触发事件：INSERT、DELETE、UPDATE
     </li>
     <li>
      触发器类型
      <br/>
      行级触发器（FOR EACH ROW）;
      <br/>
      语句级触发器（FOR EACH STATEMENT）;
     </li>
    </ol>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/91c4fb82da2f0ad1baf43052696efa8f.png"/>
    </p>
    <ul>
     <li>
      例如,假设在［例11］的TEACHER表上创建了一个AFTER UPDATE触发器。如果表TEACHER有1000行，执行如下语句：
      <br/>
      <code>
       UPDATE TEACHER SET Deptno=5;
      </code>
     </li>
     <li>
      如果该触发器为
      <code>
       语句
      </code>
      级触发器，那么执行完该语句后，触发动作只发生一次
     </li>
     <li>
      如果是
      <code>
       行级
      </code>
      触发器，触发动作将执行1000次
     </li>
    </ul>
    <ol start="6">
     <li>
      <p>
       触发条件
       <br/>
       触发条件为真，则执行触发动作体，否则不执行;
       <br/>
       省略WHEN触发条件时，只要触发器激活（触发器事件）则立刻执行触发动作体;
      </p>
     </li>
     <li>
      <p>
       触发动作体
       <br/>
       触发动作体可以是一个匿名PL/SQL过程块;
       <br/>
       也可以是对已创建存储过程的调用;
      </p>
     </li>
    </ol>
    <pre><code class="prism language-sql">［例<span class="token number">18</span>］  定义一个BEFORE行级触发器，
为教师表Teacher定义完整性规则“教授的工资不得低于<span class="token number">4000</span>元，
如果低于<span class="token number">4000</span>元，自动改为<span class="token number">4000</span>元”。
    <span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> Insert_Or_Update_Sal 
         BEFORE <span class="token keyword">INSERT</span> <span class="token operator">OR</span> <span class="token keyword">UPDATE</span> <span class="token keyword">ON</span> Teacher  
        <span class="token comment">/*触发事件是插入或更新操作*/</span>
         <span class="token keyword">FOR EACH ROW</span>                      <span class="token comment">/*行级触发器*/</span>
        <span class="token keyword">AS</span> <span class="token keyword">BEGIN</span>                <span class="token comment">/*定义触发动作体，是PL/SQL过程块*/</span>
              <span class="token keyword">IF</span> <span class="token punctuation">(</span>new<span class="token punctuation">.</span>Job<span class="token operator">=</span><span class="token string">'教授'</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>new<span class="token punctuation">.</span>Sal <span class="token operator">&lt;</span> <span class="token number">4000</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span>   
              new<span class="token punctuation">.</span>Sal :<span class="token operator">=</span><span class="token number">4000</span><span class="token punctuation">;</span>                
              <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
        <span class="token keyword">END</span><span class="token punctuation">;</span>       


［例<span class="token number">19</span>］定义<span class="token keyword">AFTER</span>行级触发器，当教师表Teacher的工资发生变化后
就自动在工资变化表Sal_log中增加一条相应记录

   首先建立工资变化表Sal_log
    <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Sal_log
        <span class="token punctuation">(</span>Eno    <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>  <span class="token keyword">references</span> teacher<span class="token punctuation">(</span>eno<span class="token punctuation">)</span>，
          Sal     <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">7</span>，<span class="token number">2</span><span class="token punctuation">)</span>，
          Username  <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>，
          <span class="token keyword">Date</span>   <span class="token keyword">TIMESTAMP</span>
         <span class="token punctuation">)</span>；
              
 <span class="token punctuation">[</span>例<span class="token number">19</span><span class="token punctuation">]</span>（续）
<span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> Insert_Sal               	
    <span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> Teacher      	<span class="token comment">/*触发事件是INSERT*/</span>
    <span class="token keyword">FOR EACH ROW</span>
    <span class="token keyword">AS</span> <span class="token keyword">BEGIN</span>
        <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Sal_log <span class="token keyword">VALUES</span><span class="token punctuation">(</span>
           new<span class="token punctuation">.</span>Eno，new<span class="token punctuation">.</span>Sal，<span class="token keyword">CURRENT_USER</span>，<span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">END</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span>例<span class="token number">19</span><span class="token punctuation">]</span>（续）
<span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> Update_Sal            	
   <span class="token keyword">AFTER</span> <span class="token keyword">UPDATE</span> <span class="token keyword">ON</span> Teacher    	<span class="token comment">/*触发事件是UPDATE */</span>
   <span class="token keyword">FOR EACH ROW</span>
   <span class="token keyword">AS</span> <span class="token keyword">BEGIN</span> 
     <span class="token keyword">IF</span> <span class="token punctuation">(</span>new<span class="token punctuation">.</span>Sal <span class="token operator">&lt;&gt;</span> old<span class="token punctuation">.</span>Sal<span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Sal_log <span class="token keyword">VALUES</span><span class="token punctuation">(</span>
          new<span class="token punctuation">.</span>Eno，new<span class="token punctuation">.</span>Sal，<span class="token keyword">CURRENT_USER</span>，<span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
  <span class="token keyword">END</span><span class="token punctuation">;</span>
          	
</code></pre>
    <blockquote>
     <p>
      这个可以在Oracle数据库里运行，但是因为我用的是SQL Sever数据库，所以运行不了，不同的数据库，触发器的实现略有不同，详情请查看相关数据库手册。
     </p>
    </blockquote>
    <h4>
     <a id="2_430">
     </a>
     （2）激活触发器
    </h4>
    <ul>
     <li>
      触发器的执行，是由
      <code>
       触发事件激活
      </code>
      的，并由数据库服务器自动执行
      <br/>
      一个数据表上可能定义了
      <code>
       多个触发器
      </code>
     </li>
     <li>
      同一个表上的多个触发器激活时遵循如下的执行顺序：
      <br/>
      （1） 执行该表上的BEFORE触发器；
      <br/>
      （2） 激活触发器的SQL语句；
      <br/>
      （3） 执行该表上的AFTER触发器。
     </li>
    </ul>
    <pre><code class="prism language-sql">［例<span class="token number">20</span>］执行修改某个教师工资的<span class="token keyword">SQL</span>语句，激活上述定义的触发器。
     <span class="token keyword">UPDATE</span> Teacher <span class="token keyword">SET</span> Sal<span class="token operator">=</span><span class="token number">800</span> <span class="token keyword">WHERE</span> Ename<span class="token operator">=</span><span class="token string">'王五'</span><span class="token punctuation">;</span>
执行顺序是：
执行触发器Insert_Or_Update_Sal
执行<span class="token keyword">SQL</span>语句“<span class="token keyword">UPDATE</span> Teacher <span class="token keyword">SET</span> Sal<span class="token operator">=</span><span class="token number">800</span> <span class="token keyword">WHERE</span> Ename<span class="token operator">=</span><span class="token string">'王五'</span><span class="token punctuation">;</span>”
执行触发器Insert_Sal；
执行触发器Update_Sal 
</code></pre>
    <h4>
     <a id="3_448">
     </a>
     （3）删除触发器
    </h4>
    <p>
     <strong>
      删除触发器的SQL语法：
     </strong>
     <br/>
     <code>
      DROP TRIGGER &lt;触发器名&gt; ON &lt;表名&gt;;
     </code>
    </p>
    <p>
     触发器必须是一个已经创建的触发器，并且只能由具有相应权限的用户删除。
    </p>
    <p>
     <strong>
      ［例21］ 删除教师表Teacher上的触发器Insert_Sal
     </strong>
    </p>
    <p>
     <code>
      DROP TRIGGER Insert_Sal ON Teacher;
     </code>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
</div>


<p class="artid" style="display:none">68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34333931343630342f:61727469636c652f64657461696c732f313035333539353534</p>
