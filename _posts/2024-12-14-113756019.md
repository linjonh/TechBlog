---
layout: post
title: "手把手教你用Arduino接入阿里云物联网平台,ESP8266连接阿里云物联网平台必看教程..."
date: 2024-12-14 21:06:39 +0800
description: "本文介绍了如何使用Arduino通过AliyunIoTSDK库连接阿里云物联网平台，详细阐述了从安装"
keywords: "arduino主板连接云平台"
categories: ['服务器', '云服务器', '云主机']
tags: ['阿里云', '腾讯云', '华为云', '云服务器', '云服务']
artid: "113756019"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=113756019
    alt: "手把手教你用Arduino接入阿里云物联网平台,ESP8266连接阿里云物联网平台必看教程..."
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     手把手教你用Arduino接入阿里云物联网平台，ESP8266连接阿里云物联网平台必看教程...
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <blockquote>
     <p>
      使用Ardui no 的方式快速连接
      <a href="https://l.gushuji.site/aliyun" rel="nofollow">
       阿里云
      </a>
      物联网平台。
     </p>
    </blockquote>
    <p>
     文中提到的 AliyunIoTSDK 这个 Arduino 库，可以在 Arduino 库商店里搜索到（搜索 AliyunIoTSDK）
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/568b1ca2926577f329dae9482ef497c8.png">
      <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/be15c5de8bee799f2bac1bb5432f6d30.png"/>
     </img>
    </p>
    <p>
     AliyunIoTSDK可以帮助你快速连接
     <a href="https://l.gushuji.site/aliyun" rel="nofollow">
      阿里云
     </a>
     IoT 平台，通过和
     <a href="https://l.gushuji.site/aliyun" rel="nofollow">
      阿里云
     </a>
     物联网开发平台配合，可快速实现各种硬件应用，包括了很上层的封装，无需自己解析数据体，绑定事件即可，在ESP8266平台充分测试（NodeMCU 1.0）
    </p>
    <p>
     AliyunIoTSDK库，除了上面在Arduino库商店里直接搜索外，还可以手动把 github 上的项目 clone 下来，放到 Arduino 的 library 库下。
    </p>
    <p>
     github 地址：https://github.com/xinyu198736/arduino-aliyun-iot-sdk
    </p>
    <p>
     拷贝上面网址上的测试代码：
     <strong>
      Usage使用示例
     </strong>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/beb6ecc86a66f41ecf1aae6af42c1970.png"/>
    </p>
    <p>
     随意命名文件名，保存代码文件：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/3fc3b1e8876a74886fb08beaa4913b94.png"/>
    </p>
    <p>
     设备管理器中查看当前ESP8266 WiFi所占用的串口号：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/82071b8556d0d0c772145957b8d5d4cb.png"/>
    </p>
    <p>
     Arduino中选择对应的串口号：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/518791e108ad5d42b50835c2aa0a2fc1.png"/>
    </p>
    <p>
     填写三元组和WiFi信息：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/3227969f7be2167399d84291d55ad99f.png"/>
    </p>
    <p>
     点击“√”对号对工程进行编译：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/c39c9c9ef5af5e6c83d003e56ed7ade6.png"/>
    </p>
    <p>
     编译后出错：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/b47748d864510b03ef569f20b0a69da2.png"/>
    </p>
    <p>
     添加：
     <strong>
      ArduinoJson库
     </strong>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/289f974349f0d2c99bf2e6021ed03005.png"/>
    </p>
    <p>
     再次编译仍旧报错：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/f87635358a15d12f2de7019e8eaf8032.png"/>
    </p>
    <p>
     错误信息如下所示：
    </p>
    <pre><code>Arduino:1.8.8&amp;nbsp;(Windows&amp;nbsp;10), 开发板："WeMos&amp;nbsp;D1&amp;nbsp;R1,&amp;nbsp;80&amp;nbsp;MHz,&amp;nbsp;Flash,&amp;nbsp;Legacy&amp;nbsp;(new&amp;nbsp;can&amp;nbsp;return&amp;nbsp;nullptr),&amp;nbsp;All&amp;nbsp;SSL&amp;nbsp;ciphers&amp;nbsp;(most&amp;nbsp;compatible),&amp;nbsp;4MB&amp;nbsp;(FS:2MB&amp;nbsp;OTA:~1019KB),&amp;nbsp;v2&amp;nbsp;Lower&amp;nbsp;Memory,&amp;nbsp;Disabled,&amp;nbsp;None,&amp;nbsp;Only&amp;nbsp;Sketch,&amp;nbsp;115200" 构建选项已变更，全部重新构建C:\Users\juban\Documents\Arduino\libraries\AliyunIoTSDK\src\AliyunIoTSDK.cpp:3:26:&amp;nbsp;fatal&amp;nbsp;error:&amp;nbsp;PubSubClient.h:&amp;nbsp;No&amp;nbsp;such&amp;nbsp;file&amp;nbsp;or&amp;nbsp;directory &amp;nbsp;#include&amp;nbsp;&lt;PubSubClient.h&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;^ compilation&amp;nbsp;terminated. exit&amp;nbsp;status&amp;nbsp;1为开发板 WeMos D1 R1 编译时出错。 在文件&amp;nbsp;-&gt;&amp;nbsp;首选项开启“编译过程中显示详细输出”选项这份报告会包含更多信息。 
</code></pre>
    <p>
     因为AliyunIoTSDK库，底层连接依据 PubSubClient 库，所以继续安装：
     <strong>
      PubSubClient库
     </strong>
     。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/81759d6b6db087c998e96f808097386f.png"/>
    </p>
    <p>
     缺少：SHA256库，继续安装：SHA256库
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/83172c72e08d8832664b0bc9c84b3488.png"/>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/1fcb3bed3755ccf80adbf55b4b9650e3.png"/>
    </p>
    <p>
     <strong>
      “AWS-SDK-ESP8266”库
     </strong>
     。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/4d28a0bafcbdb2fb800289e8bda747df.png"/>
    </p>
    <p>
     再次编译，成功。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/2e4152c14739752b3cb7a2d94c3bb7a0.png"/>
    </p>
    <p>
     编译并下载程序，上传固件至mini D1 WiFi模块。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/b25eae0d34ceef2b23794e28536622c4.png"/>
    </p>
    <p>
     上传成功之后显示如下：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/4044f0246843fe0d282984dae02bbdf2.png"/>
    </p>
    <p>
     arduino上
     <a href="https://l.gushuji.site/aliyun" rel="nofollow">
      阿里云
     </a>
     所需要用到的四个库文件。PubSubClient，ArduinoJson，AliyunIoTSDK，Crypto（SHA256）。
    </p>
    <p>
     PubSubClient.h，是发布/订阅功能的头文件；
    </p>
    <p>
     SHA256.h，是加密功能的头文件（Crypto里面已有包含这个了）；
    </p>
    <p>
     ArduinoJson.h，是支持Json数据格式的头文件；
    </p>
    <p>
     AliyunIoTSDK.h，是
     <a href="https://l.gushuji.site/aliyun" rel="nofollow">
      阿里云
     </a>
     SDK的头文件。
    </p>
    <p>
     打开Arduino软件，工具--&gt;串口监视器，可以查看模块打印输出的信息：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/5774e3d273b3f01256801d169d3cf67b.png"/>
    </p>
    <blockquote>
     <p>
      这个串口号换了，不是上面的COM7了，因为我更换了USB口，所以串口号变化了。
     </p>
    </blockquote>
    <p>
     下面是在PubSubClient.h文件中关于错误类型的定义：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/7f3595dafdb751df5f754f6568c55e06.png"/>
    </p>
    <p>
     报错MQTT Connect err : -2，说明MQTT没有连接。
    </p>
    <p>
     解决方法是更改PubSubClient.h文件中的两个宏MQTT_MAX_PACKET_SIZE和MQTT_KEEPALIVE，将其改大点，比如改成1024和60。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/667ec215ac798d72079fdcacb566b9da.png"/>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/f20ac1c612c098cc9f6d45545eadfb60.png"/>
    </p>
    <p>
     修改后，重新下载程序，然后看到可以正常上传数据了。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/ff508b5506cfd013594c2a008bdc66cc.png"/>
    </p>
    <p>
     登录生活物联网平台--飞燕平台
    </p>
    <p>
     生活物联网平台：https://living.aliyun.com/#/
    </p>
    <p>
     查看飞燕平台，正常应该可以看到设备上线了。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/1b79a9c24ae8faf14e63a142821451ba.png"/>
    </p>
    <p>
     点击上图中设备右边的“
     <strong>
      查看
     </strong>
     ”，然后进入下面的运行状态页面，可以看到我们上传的当前温度：26℃。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/cd9b48f6d39fa4ae94d8ec47911b8d98.png"/>
    </p>
    <p>
     与下面我们代码中设置的值是一致的，进而说明上传属性值成功。
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/2628303e0847fe2c5d7b0a5130fd1008.png"/>
    </p>
    <p>
     在“设备调试”页面，我们选择调试设备为“ZNFS0001”，然后选择一个调试功能，然后选择方法，然后点击发送指令，我们可以在实时日志中查看到下发数据的日志，说明下发数据成功。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/5dcb35be693afdbd3ed7c9184b25c924.png"/>
    </p>
    <p>
     此时查看WiFi模块的打印信息，可以看到模块收到了服务器下发的数据包。
    </p>
    <pre><code>{"method":"thing.service.property.set","id":"2028064192","params":{"PowerSwitch":0},"version":"1.0.0"}
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/7b9995850e7e6ec44a7a53a31d14395a.png"/>
    </p>
    <p>
     我们只需要能够正确解析上面的数据包内容，解析出{"PowerSwitch":0}，然后单片机就可以针对此内容做相应的动作。
    </p>
    <p>
     上面“设备调试”中下发的数据，其实过程跟手机App中点击某个的按钮的动作逻辑是一样的，至此走通了设备属性的上传及设备的无线控制。
    </p>
    <p>
     之后的内容，我们将针对“智能风扇”的具体设计，实现STM32+ESP8266整体与
     <a href="https://l.gushuji.site/aliyun" rel="nofollow">
      阿里云
     </a>
     进行数据交互。
    </p>
    <p>
     完整代码如下：
    </p>
    <pre><code>//&amp;nbsp;引入&amp;nbsp;wifi&amp;nbsp;模块，并实例化，不同的芯片这里的依赖可能不同#include&amp;nbsp;&lt;ESP8266WiFi.h&gt;static&amp;nbsp;WiFiClient&amp;nbsp;espClient; //&amp;nbsp;引入[阿里云](https://l.gushuji.site/aliyun)&amp;nbsp;IoT&amp;nbsp;SDK#include&amp;nbsp;&lt;AliyunIoTSDK.h&gt; //&amp;nbsp;设置产品和设备的信息，从[阿里云](https://l.gushuji.site/aliyun)设备信息里查看#define&amp;nbsp;PRODUCT_KEY&amp;nbsp;"a1xHkDRtfRl"#define&amp;nbsp;DEVICE_NAME&amp;nbsp;"ZNFS0001"#define&amp;nbsp;DEVICE_SECRET&amp;nbsp;"xnOe5VcOkvXFTBAZaik4hz7y67t7IUhI"#define&amp;nbsp;REGION_ID&amp;nbsp;"cn-shanghai" //&amp;nbsp;设置&amp;nbsp;wifi&amp;nbsp;信息#define&amp;nbsp;WIFI_SSID&amp;nbsp;"XXXXXX"#define&amp;nbsp;WIFI_PASSWD&amp;nbsp;"XXXXXXXX" void&amp;nbsp;setup(){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Serial.begin(115200);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;初始化&amp;nbsp;wifi&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;wifiInit(WIFI_SSID,&amp;nbsp;WIFI_PASSWD);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;初始化&amp;nbsp;iot，需传入&amp;nbsp;wifi&amp;nbsp;的&amp;nbsp;client，和设备产品信息&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;AliyunIoTSDK::begin(espClient,&amp;nbsp;PRODUCT_KEY,&amp;nbsp;DEVICE_NAME,&amp;nbsp;DEVICE_SECRET,&amp;nbsp;REGION_ID);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;绑定一个设备属性回调，当远程修改此属性，会触发&amp;nbsp;powerCallback&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;PowerSwitch&amp;nbsp;是在设备产品中定义的物联网模型的&amp;nbsp;id&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;AliyunIoTSDK::bindData("PowerSwitch",&amp;nbsp;powerCallback);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;发送一个数据到云平台，CurrentTemperature&amp;nbsp;是在设备产品中定义的物联网模型的&amp;nbsp;id&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;AliyunIoTSDK::send("CurrentTemperature",&amp;nbsp;26);} void&amp;nbsp;loop(){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;AliyunIoTSDK::loop();} //&amp;nbsp;初始化&amp;nbsp;wifi&amp;nbsp;连接void&amp;nbsp;wifiInit(const&amp;nbsp;char&amp;nbsp;*ssid,&amp;nbsp;const&amp;nbsp;char&amp;nbsp;*passphrase){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;WiFi.mode(WIFI_STA);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;WiFi.begin(ssid,&amp;nbsp;passphrase);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;while&amp;nbsp;(WiFi.status()&amp;nbsp;!=&amp;nbsp;WL_CONNECTED)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;delay(1000);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Serial.println("WiFi&amp;nbsp;not&amp;nbsp;Connect");&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Serial.println("Connected&amp;nbsp;to&amp;nbsp;AP");} //&amp;nbsp;电源属性修改的回调函数void&amp;nbsp;powerCallback(JsonVariant&amp;nbsp;p){&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;int&amp;nbsp;PowerSwitch&amp;nbsp;=&amp;nbsp;p["PowerSwitch"];&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(PowerSwitch&amp;nbsp;==&amp;nbsp;1)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;启动设备&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;}```
</code></pre>
    <p>
     点个“在看”表示朕
    </p>
    <p>
     已阅
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f67:2e6373646e2e6e65742f4e69636f6c61734c6561726e65722f:61727469636c652f64657461696c732f313133373536303139" class_="artid" style="display:none">
 </p>
</div>


