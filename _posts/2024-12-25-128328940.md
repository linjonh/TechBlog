---
layout: post
title: "前端下载base64文件base64转blob"
date: 2024-12-25 21:16:06 +0800
description: "前端下载base64文件；base64转blob_前端下载base64"
keywords: "前端下载base64"
categories: ['文件', '图片']
tags: ['前端下载Base64文件', 'Base']
artid: "128328940"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=128328940
    alt: "前端下载base64文件base64转blob"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     前端下载base64文件；base64转blob
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <blockquote>
     <p>
      场景与思路：1.后端返回base64，可能包含或不包含前缀（自行拼接前缀即可）2.返回文件类型 3.返回文件名称
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/709568fd5e5c40e90df235f5eb95ddc5.png"/>
     </p>
    </blockquote>
    <blockquote>
     <p>
      <strong>
       下载思路：
      </strong>
      <br/>
      1.
      <code>
       在方法dataURLtoBlob上，先将base64通过atob转成blob格式
      </code>
      <br/>
      2.
      <strong>
       再通过URL.createObjectURL()将blob读取出url地址
      </strong>
      <br/>
      3.在使用a标签下载
     </p>
    </blockquote>
    <pre><code class="prism language-c"><span class="token comment">//获取后端返回的不完成base64、文件名、文件类型</span>
    <span class="token function">downladBase64</span> <span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">MyGet</span><span class="token punctuation">(</span>G_CGI_PHP<span class="token punctuation">.</span>invoiceApi<span class="token punctuation">.</span>mobileDownInvoiceBase64 <span class="token operator">+</span> `<span class="token operator">?</span>policyId<span class="token operator">=</span>$<span class="token punctuation">{<!-- --></span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span>`<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          let base64 <span class="token operator">=</span> this<span class="token punctuation">.</span><span class="token function">getBase64Type</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>fileType<span class="token punctuation">)</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data <span class="token comment">//类型拼接后端给的不完整base64</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'拼接完整的base64'</span><span class="token punctuation">,</span> base64<span class="token punctuation">)</span>
          this<span class="token punctuation">.</span><span class="token function">downloadFileByBase64</span><span class="token punctuation">(</span>base64<span class="token punctuation">,</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>fileName<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
          
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
    <span class="token comment">//根据文件后缀 获取base64前缀不同 拼接完整的base64</span>
    <span class="token function">getBase64Type</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token char">'txt'</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token char">'data:text/plain;base64,'</span>
        <span class="token keyword">case</span> <span class="token char">'doc'</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token char">'data:application/msword;base64,'</span>
        <span class="token keyword">case</span> <span class="token char">'docx'</span><span class="token operator">:</span> <span class="token keyword">return</span> 'data<span class="token operator">:</span>application<span class="token operator">/</span>vnd<span class="token punctuation">.</span>openxmlformats<span class="token operator">-</span>officedocument<span class="token punctuation">.</span>wordprocessingml<span class="token punctuation">.</span>document<span class="token punctuation">;</span>base64<span class="token punctuation">,</span>'
        <span class="token keyword">case</span> <span class="token char">'xls'</span><span class="token operator">:</span> <span class="token keyword">return</span> 'data<span class="token operator">:</span>application<span class="token operator">/</span>vnd<span class="token punctuation">.</span>ms<span class="token operator">-</span>excel<span class="token punctuation">;</span>base64<span class="token punctuation">,</span>'
        <span class="token keyword">case</span> <span class="token char">'xlsx'</span><span class="token operator">:</span> <span class="token keyword">return</span> 'data<span class="token operator">:</span>application<span class="token operator">/</span>vnd<span class="token punctuation">.</span>openxmlformats<span class="token operator">-</span>officedocument<span class="token punctuation">.</span>spreadsheetml<span class="token punctuation">.</span>sheet<span class="token punctuation">;</span>base64<span class="token punctuation">,</span>'
        <span class="token keyword">case</span> <span class="token char">'pdf'</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token char">'data:application/pdf;base64,'</span>
        <span class="token keyword">case</span> <span class="token char">'pptx'</span><span class="token operator">:</span> <span class="token keyword">return</span> 'data<span class="token operator">:</span>application<span class="token operator">/</span>vnd<span class="token punctuation">.</span>openxmlformats<span class="token operator">-</span>officedocument<span class="token punctuation">.</span>presentationml<span class="token punctuation">.</span>presentation<span class="token punctuation">;</span>base64<span class="token punctuation">,</span>'
        <span class="token keyword">case</span> <span class="token char">'ppt'</span><span class="token operator">:</span> <span class="token keyword">return</span> 'data<span class="token operator">:</span>application<span class="token operator">/</span>vnd<span class="token punctuation">.</span>ms<span class="token operator">-</span>powerpoint<span class="token punctuation">;</span>base64<span class="token punctuation">,</span>'
        <span class="token keyword">case</span> <span class="token char">'png'</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token char">'data:image/png;base64,'</span>
        <span class="token keyword">case</span> <span class="token char">'jpg'</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token char">'data:image/jpeg;base64,'</span>
        <span class="token keyword">case</span> <span class="token char">'gif'</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token char">'data:image/gif;base64,'</span>
        <span class="token keyword">case</span> <span class="token char">'svg'</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token char">'data:image/svg+xml;base64,'</span>
        <span class="token keyword">case</span> <span class="token char">'ico'</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token char">'data:image/x-icon;base64,'</span>
        <span class="token keyword">case</span> <span class="token char">'bmp'</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token char">'data:image/bmp;base64,'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//将完整的base64转换为blob</span>
    <span class="token function">dataURLtoBlob</span> <span class="token punctuation">(</span>dataurl<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      var arr <span class="token operator">=</span> dataurl<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        mime <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        bstr <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        n <span class="token operator">=</span> bstr<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
        u8arr <span class="token operator">=</span> new <span class="token function">Uint8Array</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        u8arr<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> bstr<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> new <span class="token function">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>u8arr<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> type<span class="token operator">:</span> mime <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// * desc: 下载参数入口</span>
    <span class="token comment">// * @param base64  ：返回数据的blob对象或链接</span>
    <span class="token comment">// * @param fileName  ：下载后文件名标记</span>
    <span class="token function">downloadFileByBase64</span> <span class="token punctuation">(</span>base64<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      var myBlob <span class="token operator">=</span> this<span class="token punctuation">.</span><span class="token function">dataURLtoBlob</span><span class="token punctuation">(</span>base64<span class="token punctuation">)</span>
      var myUrl <span class="token operator">=</span> URL<span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>myBlob<span class="token punctuation">)</span>
      this<span class="token punctuation">.</span><span class="token function">downloadFile</span><span class="token punctuation">(</span>myUrl<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// * desc: 下载方法</span>
    <span class="token comment">// * @param url  ：返回数据的blob对象或链接</span>
    <span class="token comment">// * @param fileName  ：下载后文件名标记</span>
    <span class="token function">downloadFile</span> <span class="token punctuation">(</span>url<span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"What's the fuvk"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'url=='</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span>
      var a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span>
      a<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>
      a<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"download"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
      a<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"target"</span><span class="token punctuation">,</span> <span class="token string">"_blank"</span><span class="token punctuation">)</span>
      let clickEvent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">"MouseEvents"</span><span class="token punctuation">)</span>
      clickEvent<span class="token punctuation">.</span><span class="token function">initEvent</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> true<span class="token punctuation">,</span> true<span class="token punctuation">)</span>
      a<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>clickEvent<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f695f616d5f615f6469762f:61727469636c652f64657461696c732f313238333238393430" class_="artid" style="display:none">
 </p>
</div>


