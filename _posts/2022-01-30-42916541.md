---
layout: post
title: "怎样分析-JAVA-的-Thread-Dumps"
date: 2022-01-30 20:42:59 +0800
description: "文章浏览阅读2.怎样分析 JAVA 的 Thread Dumps注: 该文章的原文是由 Tae Ji"
keywords: "cannot find any thread dumps"
categories: ['Linux', 'Java']
tags: ['多线程']
artid: "42916541"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=42916541
    alt: "怎样分析-JAVA-的-Thread-Dumps"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     怎样分析 JAVA 的 Thread Dumps
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2 class="post-title" style="font-size:22px; margin-top:22px; margin-bottom:20px; font-family:'Droid Serif',Georgia,'Times New Roman',Times,STHeiti,SimSun,serif; line-height:1.125; color:#333333">
     <a href="http://blog.segmentfault.com/yexiaobai/1190000000615690" rel="nofollow noopener noreferrer" style="color:#017e66; background:transparent" target="_blank">
      怎样分析 JAVA 的 Thread Dumps
     </a>
    </h2>
    <div class="post-content fmt" style="color:#333333; font-family:'Droid Serif',Georgia,'Times New Roman',Times,STHeiti,SimSun,serif; line-height:22.399999618530273px">
     <blockquote style="padding:11px 22px; margin:20px 0px; font-size:1em; border-left-width:5px; border-color:#017e66; color:#555555">
      <p style="line-height:1.6">
       注: 该文章的原文是由 Tae Jin Gu 编写，原文地址为
       <a href="http://architects.dzone.com/articles/how-analyze-java-thread-dumps" rel="nofollow noopener noreferrer" style="color:#017e66; background:transparent" target="_blank">
        How to Analyze Java Thread Dumps
       </a>
      </p>
     </blockquote>
     <p style="margin-top:20px; margin-bottom:20px">
      当有障碍，或者是一个基于 JAVA 的 WEB 应用运行的比预期慢的时候，我们需要使用
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread dumps
      </code>
      。如果对于你来说，
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread dumps
      </code>
      是非常复杂的，这篇文章或许能对你有所帮助。在这里我将解释在 JAVA 中什么是
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       threads
      </code>
      ，他们的类型，怎么被创建的，怎样管理它们，你怎样从正在运行的应用中
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       dump threads
      </code>
      ，最后你可以怎样分析它以及确定瓶颈或者是阻塞线程。本文来自于 JAVA 应用程序长期调试经验的结果。
     </p>
     <h2 style="font-size:1.57143em; margin-top:20px; margin-bottom:20px; font-family:inherit; line-height:1.125; color:inherit; padding-bottom:10px; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:#dddddd">
      Java and Thread
     </h2>
     <p style="margin-top:20px; margin-bottom:20px">
      一个 web 服务器使用几十到几百个线程来处理大量并发用户，如果一个或多个线程使用相同的资源，线程之间的竞争就不可避免了，并且有时候可能会发生死锁。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      <strong style="">
       Thread contention
      </strong>
      是一个线程等待锁的一个状态，这个锁被另外一个线程持有，等待被释放，不同的线程频繁访问 WEB 应用的共享资源。例如，记录一条日志，线程尝试记录日志之前必须先获取锁来访问共享资源。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      <strong style="">
       死锁
      </strong>
      是线程竞争的一个特殊状态，一个或是多个线程在等待其他线程完成它们的任务为了完成它们自己的任务。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      线程竞争会引起各种不同的问题，为了分析这些这些问题，你需要使用
      <strong style="">
       dump threads
      </strong>
      ，
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       dump threads
      </code>
      能给你提供每个线程的精确状态信息。
     </p>
     <h2 style="font-size:1.57143em; margin-top:20px; margin-bottom:20px; font-family:inherit; line-height:1.125; color:inherit; padding-bottom:10px; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:#dddddd">
      JAVA 线程的背景资料
     </h2>
     <h3 style="font-family:inherit; line-height:1.125; color:inherit; margin-top:20px; margin-bottom:20px; font-size:1.42857em">
      线程同步
     </h3>
     <p style="margin-top:20px; margin-bottom:20px">
      一个线程可以与其他线程在同一时间内被处理。为了确保一致性，当多个线程试图使用共享资源的时候，通过使用
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       hread synchronization
      </code>
      在同一时间内，应该只有一个线程能访问共享资源
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      JAVA 中的线程同步可以使用监视器，每个 JAVA 对象都有一个单独的监视器，这个监视器仅仅只能被一个线程拥有，对于拥有一个由不同的线程所拥有的监视器的线程，确实需要在队列中等待，以便其他线程释放它的监视器。
     </p>
     <h3 style="font-family:inherit; line-height:1.125; color:inherit; margin-top:20px; margin-bottom:20px; font-size:1.42857em">
      线程状态
     </h3>
     <p style="margin-top:20px; margin-bottom:20px">
      为了分析一个
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread dump
      </code>
      文件，你需要知道线程状态。线程情况在
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       java.lang.Thread.State
      </code>
      中阐明了。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      <img alt="此处输入图片的描述" src="http://www.cubrid.org/files/attach/images/220547/971/295/thread-state-diagram.png" style="vertical-align:middle; max-width:100%"/>
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      <strong style="">
       图1：线程状态
      </strong>
     </p>
     <ul style="margin-top:20px; margin-bottom:20px">
      <li style="margin-top:5px; margin-bottom:5px; margin-left:0px">
       NEW：线程刚被创建，但是还没有被处理。
      </li>
      <li style="margin-top:5px; margin-bottom:5px; margin-left:0px">
       RUNNABLE：线程占用了 CPU 并且处理了一个任务。（或是是在等待状态由于操作系统的资源分配）
      </li>
      <li style="margin-top:5px; margin-bottom:5px; margin-left:0px">
       BLOCKED：该线程正在等待另外的不同的线程释放锁，以便获取监视器锁
      </li>
      <li style="margin-top:5px; margin-bottom:5px; margin-left:0px">
       WAITING：该线程正在等待，通过使用了 wait, join 或者是 park 方法
      </li>
      <li style="margin-top:5px; margin-bottom:5px; margin-left:0px">
       TIMED_WAITING：该线程正在等待，通过使用了 sleep, wait, join 或者是 park 方法。（这个与
       <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
        WAITING
       </code>
       不同是通过方法参数指定了最大等待时间，
       <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
        WAITING
       </code>
       可以通过时间或者是外部的变化解除）
      </li>
     </ul>
     <h3 style="font-family:inherit; line-height:1.125; color:inherit; margin-top:20px; margin-bottom:20px; font-size:1.42857em">
      线程类型
     </h3>
     <p style="margin-top:20px; margin-bottom:20px">
      JAVA 的线程类型分为以下两种：
     </p>
     <ol style="margin-top:20px; margin-bottom:20px">
      <li style="margin-top:5px; margin-bottom:5px; margin-left:0px">
       daemon threads；
      </li>
      <li style="margin-top:5px; margin-bottom:5px; margin-left:0px">
       非 daemon threads。
      </li>
     </ol>
     <p style="margin-top:20px; margin-bottom:20px">
      <strong style="">
       Daemon threads
      </strong>
      将停止工作当没有其他任何非
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       Daemon threads
      </code>
      时。即使你不创建任何线程，JAVA 应用也将默认创建几个线程。他们大部分是
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       daemon threads
      </code>
      。主要用于任务处理比如内存回收或者是
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       JMX
      </code>
      。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      一个运行
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       static void main(String[] args)
      </code>
      方法的线程被作为非
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       daemon threads
      </code>
      线程创建，并且当该线程停止工作的时候，所有任何其他
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       daemon threads
      </code>
      也将停止工作。（这个运行在 main 方法中的线程被称为
      <strong style="">
       VM thread in HotSpot VM
      </strong>
      ）
     </p>
     <h2 style="font-size:1.57143em; margin-top:20px; margin-bottom:20px; font-family:inherit; line-height:1.125; color:inherit; padding-bottom:10px; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:#dddddd">
      获取一个 Thread Dump
     </h2>
     <p style="margin-top:20px; margin-bottom:20px">
      我们将介绍三种最常用的方法，记住，有非常多的其他方法可以获取
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread dump
      </code>
      ，一个
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread dump
      </code>
      仅仅只能在测量的时候显示线程状态。因此为了看得线程状态的变化，建议每隔5秒提取5到10次的记录。
     </p>
     <h3 style="font-family:inherit; line-height:1.125; color:inherit; margin-top:20px; margin-bottom:20px; font-size:1.42857em">
      使用 jstack 获取 Thread Dump
     </h3>
     <p style="margin-top:20px; margin-bottom:20px">
      在 JDK1.6 或者是更高的版本中，通过使用 jstack， 在 MS Windows 平台上可能可以获取到
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       Thread Dump
      </code>
      。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      通过使用
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       jps
      </code>
      检查当前正在运行的JAVA进程的 PID。
     </p>
     <pre class="matlab"><span class="matrix" style="">[user@linux ~]</span>$ jps -v
<span class="number" style="color:#009999">25780</span> RemoteTestRunner -<span class="transposed_variable" style="">Dfile.</span>encoding=UTF-<span class="number" style="color:#009999">8</span>
<span class="number" style="color:#009999">25590</span> <span class="transposed_variable" style="">sub.</span><span class="transposed_variable" style="">rmi.</span><span class="transposed_variable" style="">registry.</span>RegistryImpl <span class="number" style="color:#009999">2999</span> -<span class="transposed_variable" style="">Dapplication.</span>home=/home1/user/java/<span class="transposed_variable" style="">jdk.</span><span class="number" style="color:#009999">1.6</span><span class="number" style="color:#009999">.0</span>_24 -Xms8m
<span class="number" style="color:#009999">26300</span> <span class="transposed_variable" style="">sun.</span><span class="transposed_variable" style="">tools.</span><span class="transposed_variable" style="">jps.</span>Jps -mlvV -<span class="transposed_variable" style="">Dapplication.</span>home=/home1/user/java/<span class="transposed_variable" style="">jdk.</span><span class="number" style="color:#009999">1.6</span><span class="number" style="color:#009999">.0</span>_24 -Xms8m
</pre>
     <p style="margin-top:20px; margin-bottom:20px">
      使用明确的 PID 作为
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       jstack
      </code>
      的参数来获取
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread dumps
      </code>
      。
     </p>
     <pre><code class="language-ruby">[user<span class="variable" style="color:teal">@linux</span> ~]<span class="variable" style="color:teal">$ </span>jstack -f <span class="number" style="color:#009999">5824</span>
</code></pre>
     <h3 style="font-family:inherit; line-height:1.125; color:inherit; margin-top:20px; margin-bottom:20px; font-size:1.42857em">
      使用 jVisualVM 生成 Thread Dump
     </h3>
     <p style="margin-top:20px; margin-bottom:20px">
      通过使用一个程序
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       jVisualVM
      </code>
      来生成
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       Thread Dump
      </code>
      。
      <br style=""/>
      <img alt="此处输入图片的描述" src="http://www.cubrid.org/files/attach/images/220547/971/295/thread-dump-using-jvisualvm.png" style="vertical-align:middle; max-width:100%"/>
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      如上图在左侧的任务表示当前正在运行的进程列表，点击你想要信息的那个线程，然后选择
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread tab
      </code>
      页来检查实时的线程信息。点击右边的
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       Thread Dump
      </code>
      按钮来获取
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread dump
      </code>
      文件。
     </p>
     <h3 style="font-family:inherit; line-height:1.125; color:inherit; margin-top:20px; margin-bottom:20px; font-size:1.42857em">
      在 Linux 控制台生成
     </h3>
     <p style="margin-top:20px; margin-bottom:20px">
      通过使用
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       ps -ef
      </code>
      命令来获取当前正在运行的 JAVA 应用程序的进程 ID。
     </p>
     <pre class="r">[user@linux ~]$ ps - ef | grep java
user      <span class="number" style="color:#009999">2477</span>          <span class="number" style="color:#009999">1</span>    <span class="number" style="color:#009999">0</span> Dec23 ?         <span class="number" style="color:#009999">00</span>:<span class="number" style="color:#009999">10</span>:<span class="number" style="color:#009999">45</span> <span class="keyword" style="font-weight:bold">...</span>
user    <span class="number" style="color:#009999">25780</span> <span class="number" style="color:#009999">25361</span>   <span class="number" style="color:#009999">0</span> <span class="number" style="color:#009999">15</span>:<span class="number" style="color:#009999">02</span> pts/<span class="number" style="color:#009999">3</span>    <span class="number" style="color:#009999">00</span>:<span class="number" style="color:#009999">00</span>:<span class="number" style="color:#009999">02</span> ./jstatd -J -Djava.security.policy=jstatd.all.policy -p <span class="number" style="color:#009999">2999</span>
user    <span class="number" style="color:#009999">26335</span> <span class="number" style="color:#009999">25361</span>   <span class="number" style="color:#009999">0</span> <span class="number" style="color:#009999">15</span>:<span class="number" style="color:#009999">49</span> pts/<span class="number" style="color:#009999">3</span>    <span class="number" style="color:#009999">00</span>:<span class="number" style="color:#009999">00</span>:<span class="number" style="color:#009999">00</span> grep java
</pre>
     <p style="margin-top:20px; margin-bottom:20px">
      使用精确的 pid 作为
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       kill –SIGQUIT(3)
      </code>
      的参数来获取
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread dump
      </code>
      。
     </p>
     <h3 style="font-family:inherit; line-height:1.125; color:inherit; margin-top:20px; margin-bottom:20px; font-size:1.42857em">
      Thread Dump 文件的 线程信息
     </h3>
     <pre class="objectivec"><span class="string" style="color:#dd1144">"pool-1-thread-13"</span> prio=<span class="number" style="color:#009999">6</span> tid=<span class="number" style="color:#009999">0x000000000729a000</span> nid=<span class="number" style="color:#009999">0x2fb4</span> runnable [<span class="number" style="color:#009999">0x0000000007f0f000</span>] java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.State</span>: RUNNABLE
              at java<span class="variable" style="color:teal">.net</span><span class="variable" style="color:teal">.SocketInputStream</span><span class="variable" style="color:teal">.socketRead0</span>(Native Method)

              at java<span class="variable" style="color:teal">.net</span><span class="variable" style="color:teal">.SocketInputStream</span><span class="variable" style="color:teal">.read</span>(SocketInputStream<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">129</span>)

              at sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.cs</span><span class="variable" style="color:teal">.StreamDecoder</span><span class="variable" style="color:teal">.readBytes</span>(StreamDecoder<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">264</span>)

              at sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.cs</span><span class="variable" style="color:teal">.StreamDecoder</span><span class="variable" style="color:teal">.implRead</span>(StreamDecoder<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">306</span>)

              at sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.cs</span><span class="variable" style="color:teal">.StreamDecoder</span><span class="variable" style="color:teal">.read</span>(StreamDecoder<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">158</span>)

              - locked &lt;<span class="number" style="color:#009999">0x0000000780b7e688</span>&gt; (a java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.InputStreamReader</span>)

              at java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.InputStreamReader</span><span class="variable" style="color:teal">.read</span>(InputStreamReader<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">167</span>)

              at java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.BufferedReader</span><span class="variable" style="color:teal">.fill</span>(BufferedReader<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">136</span>)

              at java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.BufferedReader</span><span class="variable" style="color:teal">.readLine</span>(BufferedReader<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">299</span>)

              - locked &lt;<span class="number" style="color:#009999">0x0000000780b7e688</span>&gt; (a java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.InputStreamReader</span>)

              at java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.BufferedReader</span><span class="variable" style="color:teal">.readLine</span>(BufferedReader<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">362</span>)
</pre>
     <ul style="margin-top:20px; margin-bottom:20px">
      <li style="margin-top:5px; margin-bottom:5px; margin-left:0px">
       线程名字：当使用
       <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
        Java.lang.Thread
       </code>
       类生成一个线程的时候，该线程将被命名为
       <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
        Thread-(Number)
       </code>
       。但是当使用
       <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
        java.util.concurrent.ThreadFactory
       </code>
       类的时候，它将被命名为
       <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
        pool-(number)-thread-(number)
       </code>
       。
      </li>
      <li style="margin-top:5px; margin-bottom:5px; margin-left:0px">
       优先级：代表该线程的优先级
      </li>
      <li style="margin-top:5px; margin-bottom:5px; margin-left:0px">
       线程 ID：代表该线程的唯一 ID，（一些有用的信息，比如该线程的 CPU 使用率或者是内存使用率，都能通过该线程 ID 获取到）。
      </li>
      <li style="margin-top:5px; margin-bottom:5px; margin-left:0px">
       线程状态：代表该线程当前的状态
      </li>
      <li style="margin-top:5px; margin-bottom:5px; margin-left:0px">
       线程调用栈：代表该线程的调用栈信息
      </li>
     </ul>
     <h3 style="font-family:inherit; line-height:1.125; color:inherit; margin-top:20px; margin-bottom:20px; font-size:1.42857em">
      Thread Dump Patterns by Type When Unable to Obtain a Lock (BLOCKED)
     </h3>
     <p style="margin-top:20px; margin-bottom:20px">
      这个应用程序的整体性能下降是因为一个线程占用了锁阻止了其他线程获得锁，在下面的示例中，
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       BLOCKED_TEST pool-1-thread-1
      </code>
      线程占用了
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       &lt;0x0000000780a000b0&gt;
      </code>
      锁，然而
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       BLOCKED_TEST pool-1-thread-2
      </code>
      和
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       BLOCKED_TEST pool-1-thread-3 threads
      </code>
      正在等待获取锁。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      <img alt="此处输入图片的描述" src="http://www.cubrid.org/files/attach/images/220547/971/295/when-unable-to-obtain-lock.png" style="vertical-align:middle; max-width:100%"/>
     </p>
     <pre class="objectivec"> <span class="string" style="color:#dd1144">"BLOCKED_TEST pool-1-thread-1"</span> prio=<span class="number" style="color:#009999">6</span> tid=<span class="number" style="color:#009999">0x0000000006904800</span> nid=<span class="number" style="color:#009999">0x28f4</span> runnable [<span class="number" style="color:#009999">0x000000000785f000</span>]
   java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.State</span>: RUNNABLE
                at java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.FileOutputStream</span><span class="variable" style="color:teal">.writeBytes</span>(Native Method)
                at java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.FileOutputStream</span><span class="variable" style="color:teal">.write</span>(FileOutputStream<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">282</span>)
                at java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.BufferedOutputStream</span><span class="variable" style="color:teal">.flushBuffer</span>(BufferedOutputStream<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">65</span>)
                at java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.BufferedOutputStream</span><span class="variable" style="color:teal">.flush</span>(BufferedOutputStream<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">123</span>)
                - locked &lt;<span class="number" style="color:#009999">0x0000000780a31778</span>&gt; (a java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.BufferedOutputStream</span>)
                at java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.PrintStream</span><span class="variable" style="color:teal">.write</span>(PrintStream<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">432</span>)
                - locked &lt;<span class="number" style="color:#009999">0x0000000780a04118</span>&gt; (a java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.PrintStream</span>)
                at sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.cs</span><span class="variable" style="color:teal">.StreamEncoder</span><span class="variable" style="color:teal">.writeBytes</span>(StreamEncoder<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">202</span>)
                at sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.cs</span><span class="variable" style="color:teal">.StreamEncoder</span><span class="variable" style="color:teal">.implFlushBuffer</span>(StreamEncoder<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">272</span>)
                at sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.cs</span><span class="variable" style="color:teal">.StreamEncoder</span><span class="variable" style="color:teal">.flushBuffer</span>(StreamEncoder<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">85</span>)
                - locked &lt;<span class="number" style="color:#009999">0x0000000780a040c0</span>&gt; (a java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.OutputStreamWriter</span>)
                at java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.OutputStreamWriter</span><span class="variable" style="color:teal">.flushBuffer</span>(OutputStreamWriter<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">168</span>)
                at java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.PrintStream</span><span class="variable" style="color:teal">.newLine</span>(PrintStream<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">496</span>)
                - locked &lt;<span class="number" style="color:#009999">0x0000000780a04118</span>&gt; (a java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.PrintStream</span>)
                at java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.PrintStream</span><span class="variable" style="color:teal">.println</span>(PrintStream<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">687</span>)
                - locked &lt;<span class="number" style="color:#009999">0x0000000780a04118</span>&gt; (a java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.PrintStream</span>)
                at com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadBlockedState</span><span class="variable" style="color:teal">.monitorLock</span>(ThreadBlockedState<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">44</span>)
                - locked &lt;<span class="number" style="color:#009999">0x0000000780a000b0</span>&gt; (a com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadBlockedState</span>)
                at com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadBlockedState</span>$<span class="number" style="color:#009999">1.</span>run(ThreadBlockedState<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">7</span>)
                at java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.concurrent</span><span class="variable" style="color:teal">.ThreadPoolExecutor</span>$Worker<span class="variable" style="color:teal">.runTask</span>(ThreadPoolExecutor<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">886</span>)
                at java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.concurrent</span><span class="variable" style="color:teal">.ThreadPoolExecutor</span>$Worker<span class="variable" style="color:teal">.run</span>(ThreadPoolExecutor<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">908</span>)
                at java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.run</span>(Thread<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">662</span>)

   Locked ownable synchronizers:
                - &lt;<span class="number" style="color:#009999">0x0000000780a31758</span>&gt; (a java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.concurrent</span><span class="variable" style="color:teal">.locks</span><span class="variable" style="color:teal">.ReentrantLock</span>$NonfairSync)

<span class="string" style="color:#dd1144">"BLOCKED_TEST pool-1-thread-2"</span> prio=<span class="number" style="color:#009999">6</span> tid=<span class="number" style="color:#009999">0x0000000007673800</span> nid=<span class="number" style="color:#009999">0x260c</span> waiting <span class="keyword" style="font-weight:bold">for</span> monitor entry [<span class="number" style="color:#009999">0x0000000008abf000</span>]
   java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.State</span>: BLOCKED (on object monitor)
                at com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadBlockedState</span><span class="variable" style="color:teal">.monitorLock</span>(ThreadBlockedState<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">43</span>)
                - waiting to lock &lt;<span class="number" style="color:#009999">0x0000000780a000b0</span>&gt; (a com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadBlockedState</span>)
                at com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadBlockedState</span>\$<span class="number" style="color:#009999">2.</span>run(ThreadBlockedState<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">26</span>)
                at java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.concurrent</span><span class="variable" style="color:teal">.ThreadPoolExecutor</span>$Worker<span class="variable" style="color:teal">.runTask</span>(ThreadPoolExecutor<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">886</span>)
                at java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.concurrent</span><span class="variable" style="color:teal">.ThreadPoolExecutor</span>\$Worker<span class="variable" style="color:teal">.run</span>(ThreadPoolExecutor<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">908</span>)
                at java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.run</span>(Thread<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">662</span>)

   Locked ownable synchronizers:
                - &lt;<span class="number" style="color:#009999">0x0000000780b0c6a0</span>&gt; (a java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.concurrent</span><span class="variable" style="color:teal">.locks</span><span class="variable" style="color:teal">.ReentrantLock</span>$NonfairSync)

<span class="string" style="color:#dd1144">"BLOCKED_TEST pool-1-thread-3"</span> prio=<span class="number" style="color:#009999">6</span> tid=<span class="number" style="color:#009999">0x00000000074f5800</span> nid=<span class="number" style="color:#009999">0x1994</span> waiting <span class="keyword" style="font-weight:bold">for</span> monitor entry [<span class="number" style="color:#009999">0x0000000008bbf000</span>]
   java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.State</span>: BLOCKED (on object monitor)
                at com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadBlockedState</span><span class="variable" style="color:teal">.monitorLock</span>(ThreadBlockedState<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">42</span>)
                - waiting to lock &lt;<span class="number" style="color:#009999">0x0000000780a000b0</span>&gt; (a com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadBlockedState</span>)
                at com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadBlockedState</span>\$<span class="number" style="color:#009999">3.</span>run(ThreadBlockedState<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">34</span>)
                at java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.concurrent</span><span class="variable" style="color:teal">.ThreadPoolExecutor</span>$Worker<span class="variable" style="color:teal">.runTask</span>(ThreadPoolExecutor<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">886</span>
                at java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.concurrent</span><span class="variable" style="color:teal">.ThreadPoolExecutor</span>$Worker<span class="variable" style="color:teal">.run</span>(ThreadPoolExecutor<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">908</span>)
                at java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.run</span>(Thread<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">662</span>)

   Locked ownable synchronizers:
                - &lt;<span class="number" style="color:#009999">0x0000000780b0e1b8</span>&gt; (a java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.concurrent</span><span class="variable" style="color:teal">.locks</span><span class="variable" style="color:teal">.ReentrantLock</span>$NonfairSync)

</pre>
     <h3 style="font-family:inherit; line-height:1.125; color:inherit; margin-top:20px; margin-bottom:20px; font-size:1.42857em">
      当在死锁状态
     </h3>
     <p style="margin-top:20px; margin-bottom:20px">
      这是当线程 A 需要获取线程 B 的锁来继续它的任务，然而线程 B 也需要获取线程 A 的锁来继续它的任务的时候发生的。在
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread dump
      </code>
      中，你能看到
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       DEADLOCK_TEST-1
      </code>
      线程持有
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       0x00000007d58f5e48
      </code>
      锁，并且尝试获取
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       0x00000007d58f5e60
      </code>
      锁。你也能看到
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       DEADLOCK_TEST-2
      </code>
      线程持有
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       0x00000007d58f5e60
      </code>
      ，并且尝试获取
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       0x00000007d58f5e78
      </code>
      ，同时
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       DEADLOCK_TEST-3
      </code>
      线程持有
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       0x00000007d58f5e78
      </code>
      ，并且在尝试获取
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       0x00000007d58f5e48
      </code>
      锁，如你所见，每个线程都在等待获取另外一个线程的锁，这状态将不会被改变直到一个线程丢弃了它的锁。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      <img alt="此处输入图片的描述" src="http://www.cubrid.org/files/attach/images/220547/971/295/when-in-deadlock-status.png" style="vertical-align:middle; max-width:100%"/>
     </p>
     <pre class="objectivec"><span class="string" style="color:#dd1144">"DEADLOCK_TEST-1"</span> daemon prio=<span class="number" style="color:#009999">6</span> tid=<span class="number" style="color:#009999">0x000000000690f800</span> nid=<span class="number" style="color:#009999">0x1820</span> waiting <span class="keyword" style="font-weight:bold">for</span> monitor entry [<span class="number" style="color:#009999">0x000000000805f000</span>]
   java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.State</span>: BLOCKED (on object monitor)
                at com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadDeadLockState</span>$DeadlockThread<span class="variable" style="color:teal">.goMonitorDeadlock</span>(ThreadDeadLockState<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">197</span>)
                - waiting to lock &lt;<span class="number" style="color:#009999">0x00000007d58f5e60</span>&gt; (a com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadDeadLockState</span>$Monitor)
                at com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadDeadLockState</span>$DeadlockThread<span class="variable" style="color:teal">.monitorOurLock</span>(ThreadDeadLockState<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">182</span>)
                - locked &lt;<span class="number" style="color:#009999">0x00000007d58f5e48</span>&gt; (a com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadDeadLockState</span>$Monitor)
                at com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadDeadLockState</span>$DeadlockThread<span class="variable" style="color:teal">.run</span>(ThreadDeadLockState<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">135</span>)

   Locked ownable synchronizers:
                - None

<span class="string" style="color:#dd1144">"DEADLOCK_TEST-2"</span> daemon prio=<span class="number" style="color:#009999">6</span> tid=<span class="number" style="color:#009999">0x0000000006858800</span> nid=<span class="number" style="color:#009999">0x17b8</span> waiting <span class="keyword" style="font-weight:bold">for</span> monitor entry [<span class="number" style="color:#009999">0x000000000815f000</span>]
   java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.State</span>: BLOCKED (on object monitor)
                at com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadDeadLockState</span>$DeadlockThread<span class="variable" style="color:teal">.goMonitorDeadlock</span>(ThreadDeadLockState<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">197</span>)
                - waiting to lock &lt;<span class="number" style="color:#009999">0x00000007d58f5e78</span>&gt; (a com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadDeadLockState</span>$Monitor)
                at com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadDeadLockState</span>$DeadlockThread<span class="variable" style="color:teal">.monitorOurLock</span>(ThreadDeadLockState<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">182</span>)
                - locked &lt;<span class="number" style="color:#009999">0x00000007d58f5e60</span>&gt; (a com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadDeadLockState</span>$Monitor)
                at com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadDeadLockState</span>$DeadlockThread<span class="variable" style="color:teal">.run</span>(ThreadDeadLockState<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">135</span>)

   Locked ownable synchronizers:
                - None

<span class="string" style="color:#dd1144">"DEADLOCK_TEST-3"</span> daemon prio=<span class="number" style="color:#009999">6</span> tid=<span class="number" style="color:#009999">0x0000000006859000</span> nid=<span class="number" style="color:#009999">0x25dc</span> waiting <span class="keyword" style="font-weight:bold">for</span> monitor entry [<span class="number" style="color:#009999">0x000000000825f000</span>]
   java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.State</span>: BLOCKED (on object monitor)
                at com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadDeadLockState</span>$DeadlockThread<span class="variable" style="color:teal">.goMonitorDeadlock</span>(ThreadDeadLockState<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">197</span>)
                - waiting to lock &lt;<span class="number" style="color:#009999">0x00000007d58f5e48</span>&gt; (a com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadDeadLockState</span>$Monitor)
                at com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadDeadLockState</span>$DeadlockThread<span class="variable" style="color:teal">.monitorOurLock</span>(ThreadDeadLockState<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">182</span>)
                - locked &lt;<span class="number" style="color:#009999">0x00000007d58f5e78</span>&gt; (a com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadDeadLockState</span>$Monitor)
                at com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadDeadLockState</span>$DeadlockThread<span class="variable" style="color:teal">.run</span>(ThreadDeadLockState<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">135</span>)

   Locked ownable synchronizers:
                - None
</pre>
     <h3 style="font-family:inherit; line-height:1.125; color:inherit; margin-top:20px; margin-bottom:20px; font-size:1.42857em">
      当持续等待从远处服务器接收消息
     </h3>
     <p style="margin-top:20px; margin-bottom:20px">
      该线程是正常的，因为它的状态为
      <strong style="">
       RUNNABLE
      </strong>
      ，尽管如此，当你按照时间顺序排列
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       Thread Dump
      </code>
      ，你会发现
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       socketReadThread
      </code>
      线程正在无限等待读取 socket。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      <img alt="此处输入图片的描述" src="http://www.cubrid.org/files/attach/images/220547/971/295/when-continuosly-waiting-to-receive-message-from-remote-server.png" style="vertical-align:middle; max-width:100%"/>
     </p>
     <pre class="objectivec"><span class="string" style="color:#dd1144">"socketReadThread"</span> prio=<span class="number" style="color:#009999">6</span> tid=<span class="number" style="color:#009999">0x0000000006a0d800</span> nid=<span class="number" style="color:#009999">0x1b40</span> runnable [<span class="number" style="color:#009999">0x00000000089ef000</span>]
   java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.State</span>: RUNNABLE
                at java<span class="variable" style="color:teal">.net</span><span class="variable" style="color:teal">.SocketInputStream</span><span class="variable" style="color:teal">.socketRead0</span>(Native Method)
                at java<span class="variable" style="color:teal">.net</span><span class="variable" style="color:teal">.SocketInputStream</span><span class="variable" style="color:teal">.read</span>(SocketInputStream<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">129</span>)
                at sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.cs</span><span class="variable" style="color:teal">.StreamDecoder</span><span class="variable" style="color:teal">.readBytes</span>(StreamDecoder<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">264</span>)
                at sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.cs</span><span class="variable" style="color:teal">.StreamDecoder</span><span class="variable" style="color:teal">.implRead</span>(StreamDecoder<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">306</span>)
                at sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.cs</span><span class="variable" style="color:teal">.StreamDecoder</span><span class="variable" style="color:teal">.read</span>(StreamDecoder<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">158</span>)
                - locked &lt;<span class="number" style="color:#009999">0x00000007d78a2230</span>&gt; (a java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.InputStreamReader</span>)
                at sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.cs</span><span class="variable" style="color:teal">.StreamDecoder</span><span class="variable" style="color:teal">.read0</span>(StreamDecoder<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">107</span>)
                - locked &lt;<span class="number" style="color:#009999">0x00000007d78a2230</span>&gt; (a java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.InputStreamReader</span>)
                at sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.cs</span><span class="variable" style="color:teal">.StreamDecoder</span><span class="variable" style="color:teal">.read</span>(StreamDecoder<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">93</span>)
                at java<span class="variable" style="color:teal">.io</span><span class="variable" style="color:teal">.InputStreamReader</span><span class="variable" style="color:teal">.read</span>(InputStreamReader<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">151</span>)
                at com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadSocketReadState</span>$<span class="number" style="color:#009999">1.</span>run(ThreadSocketReadState<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">27</span>)
                at java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.run</span>(Thread<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">662</span>)
</pre>
     <h3 style="font-family:inherit; line-height:1.125; color:inherit; margin-top:20px; margin-bottom:20px; font-size:1.42857em">
      当 Waiting 时
     </h3>
     <p style="margin-top:20px; margin-bottom:20px">
      线程保持在
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       Waiting
      </code>
      状态，在
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       Thread Dump
      </code>
      中，
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       IoWaitThread
      </code>
      线程保持等待状态来从
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       LinkedBlockingQueue
      </code>
      接收消息。如果
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       LinkedBlockingQueue
      </code>
      一直没有消息，该线程的状态将不会改变。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      <img alt="此处输入图片的描述" src="http://www.cubrid.org/files/attach/images/220547/971/295/when-waiting.png" style="vertical-align:middle; max-width:100%"/>
     </p>
     <pre class="objectivec"> <span class="string" style="color:#dd1144">"IoWaitThread"</span> prio=<span class="number" style="color:#009999">6</span> tid=<span class="number" style="color:#009999">0x0000000007334800</span> nid=<span class="number" style="color:#009999">0x2b3c</span> waiting on condition [<span class="number" style="color:#009999">0x000000000893f000</span>]
   java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.State</span>: WAITING (parking)
                at sun<span class="variable" style="color:teal">.misc</span><span class="variable" style="color:teal">.Unsafe</span><span class="variable" style="color:teal">.park</span>(Native Method)
                - parking to wait <span class="keyword" style="font-weight:bold">for</span>  &lt;<span class="number" style="color:#009999">0x00000007d5c45850</span>&gt; (a java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.concurrent</span><span class="variable" style="color:teal">.locks</span><span class="variable" style="color:teal">.AbstractQueuedSynchronizer</span>$ConditionObject)
                at java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.concurrent</span><span class="variable" style="color:teal">.locks</span><span class="variable" style="color:teal">.LockSupport</span><span class="variable" style="color:teal">.park</span>(LockSupport<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">156</span>)
                at java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.concurrent</span><span class="variable" style="color:teal">.locks</span><span class="variable" style="color:teal">.AbstractQueuedSynchronizer</span>$ConditionObject<span class="variable" style="color:teal">.await</span>(AbstractQueuedSynchronizer<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">1987</span>)
                at java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.concurrent</span><span class="variable" style="color:teal">.LinkedBlockingDeque</span><span class="variable" style="color:teal">.takeFirst</span>(LinkedBlockingDeque<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">440</span>)
                at java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.concurrent</span><span class="variable" style="color:teal">.LinkedBlockingDeque</span><span class="variable" style="color:teal">.take</span>(LinkedBlockingDeque<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">629</span>)
                at com<span class="variable" style="color:teal">.nbp</span><span class="variable" style="color:teal">.theplatform</span><span class="variable" style="color:teal">.threaddump</span><span class="variable" style="color:teal">.ThreadIoWaitState</span>$IoWaitHandler2<span class="variable" style="color:teal">.run</span>(ThreadIoWaitState<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">89</span>)
                at java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.run</span>(Thread<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">662</span>) 

</pre>
     <h3 style="font-family:inherit; line-height:1.125; color:inherit; margin-top:20px; margin-bottom:20px; font-size:1.42857em">
      当线程的资源不能正常的被组织
     </h3>
     <p style="margin-top:20px; margin-bottom:20px">
      不必要的线程会堆积起来，当线程的资源不能被正常的组织的话，如果这个发送了，建议监控线程组织过程或检查线程终止的条件。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      <img alt="此处输入图片的描述" src="http://www.cubrid.org/files/attach/images/220547/971/295/when-thread-resources-cannot-be-organized-normally.png" style="vertical-align:middle; max-width:100%"/>
     </p>
     <h2 style="font-size:1.57143em; margin-top:20px; margin-bottom:20px; font-family:inherit; line-height:1.125; color:inherit; padding-bottom:10px; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:#dddddd">
      使用 Thread Dump 怎样解决问题
     </h2>
     <h3 style="font-family:inherit; line-height:1.125; color:inherit; margin-top:20px; margin-bottom:20px; font-size:1.42857em">
      示例1：当 CPU 利用率高的异常
     </h3>
     <ol style="margin-top:20px; margin-bottom:20px">
      <li style="margin-top:5px; margin-bottom:5px; margin-left:0px">
       提取获取最高 CPU 使用率的线程。
      </li>
     </ol>
     <pre><code class="language-css"><span class="attr_selector" style="">[user@linux ~]</span>$ <span class="tag" style="color:#000080">ps</span> -<span class="tag" style="color:#000080">mo</span> <span class="tag" style="color:#000080">pid</span><span class="class" style="color:#445588; font-weight:bold">.lwp</span><span class="class" style="color:#445588; font-weight:bold">.stime</span><span class="class" style="color:#445588; font-weight:bold">.time</span><span class="class" style="color:#445588; font-weight:bold">.cpu</span> -<span class="tag" style="color:#000080">C</span> <span class="tag" style="color:#000080">java</span>

     <span class="tag" style="color:#000080">PID</span>         <span class="tag" style="color:#000080">LWP</span>          <span class="tag" style="color:#000080">STIME</span>                  <span class="tag" style="color:#000080">TIME</span>        %<span class="tag" style="color:#000080">CPU</span>
10029               -         <span class="tag" style="color:#000080">Dec07</span>          00<span class="pseudo" style="">:02</span><span class="pseudo" style="">:02</span>           99<span class="class" style="color:#445588; font-weight:bold">.5</span>
         -       10039        <span class="tag" style="color:#000080">Dec07</span>          00<span class="pseudo" style="">:00</span><span class="pseudo" style="">:00</span>              0<span class="class" style="color:#445588; font-weight:bold">.1</span>
         -       10040        <span class="tag" style="color:#000080">Dec07</span>          00<span class="pseudo" style="">:00</span><span class="pseudo" style="">:00</span>           95<span class="class" style="color:#445588; font-weight:bold">.5</span>
</code></pre>
     <p style="margin-top:20px; margin-bottom:20px">
      从这个应用中，发现使用 CPU 最高的线程。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      获取使用 CPU 最多的轻量级进程（LWP），把它的唯一标示码 (10039) 转换成十六进制 (0x2737)。
     </p>
     <ol style="margin-top:20px; margin-bottom:20px">
      <li style="margin-top:5px; margin-bottom:5px; margin-left:0px">
       然后获取进程的
       <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
        Thread Dump
       </code>
       ，检查进程的动作。
      </li>
     </ol>
     <p style="margin-top:20px; margin-bottom:20px">
      通过 PID 10029 来提取应用程序的
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       Thread Dump
      </code>
      ，然后通过一个 nid 0x2737 来找到这个线程。
     </p>
     <pre class="objectivec"><span class="string" style="color:#dd1144">"NioProcessor-2"</span> prio=<span class="number" style="color:#009999">10</span> tid=<span class="number" style="color:#009999">0x0a8d2800</span> nid=<span class="number" style="color:#009999">0x2737</span> runnable [<span class="number" style="color:#009999">0x49aa5000</span>]
java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.State</span>: RUNNABLE
                at sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.ch</span><span class="variable" style="color:teal">.EPollArrayWrapper</span><span class="variable" style="color:teal">.epollWait</span>(Native Method)
                at sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.ch</span><span class="variable" style="color:teal">.EPollArrayWrapper</span><span class="variable" style="color:teal">.poll</span>(EPollArrayWrapper<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">210</span>)
                at sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.ch</span><span class="variable" style="color:teal">.EPollSelectorImpl</span><span class="variable" style="color:teal">.doSelect</span>(EPollSelectorImpl<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">65</span>)
                at sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.ch</span><span class="variable" style="color:teal">.SelectorImpl</span><span class="variable" style="color:teal">.lockAndDoSelect</span>(SelectorImpl<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">69</span>)
                - locked &lt;<span class="number" style="color:#009999">0x74c52678</span>&gt; (a sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.ch</span><span class="variable" style="color:teal">.Util</span>$<span class="number" style="color:#009999">1</span>)
                - locked &lt;<span class="number" style="color:#009999">0x74c52668</span>&gt; (a java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.Collections</span>$UnmodifiableSet)
                - locked &lt;<span class="number" style="color:#009999">0x74c501b0</span>&gt; (a sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.ch</span><span class="variable" style="color:teal">.EPollSelectorImpl</span>)
                at sun<span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.ch</span><span class="variable" style="color:teal">.SelectorImpl</span><span class="variable" style="color:teal">.select</span>(SelectorImpl<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">80</span>)
                at external<span class="variable" style="color:teal">.org</span><span class="variable" style="color:teal">.apache</span><span class="variable" style="color:teal">.mina</span><span class="variable" style="color:teal">.transport</span><span class="variable" style="color:teal">.socket</span><span class="variable" style="color:teal">.nio</span><span class="variable" style="color:teal">.NioProcessor</span><span class="variable" style="color:teal">.select</span>(NioProcessor<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">65</span>)
                at external<span class="variable" style="color:teal">.org</span><span class="variable" style="color:teal">.apache</span><span class="variable" style="color:teal">.mina</span><span class="variable" style="color:teal">.common</span><span class="variable" style="color:teal">.AbstractPollingIoProcessor</span>$Worker<span class="variable" style="color:teal">.run</span>(AbstractPollingIoProcessor<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">708</span>)
                at external<span class="variable" style="color:teal">.org</span><span class="variable" style="color:teal">.apache</span><span class="variable" style="color:teal">.mina</span><span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.NamePreservingRunnable</span><span class="variable" style="color:teal">.run</span>(NamePreservingRunnable<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">51</span>)
                at java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.concurrent</span><span class="variable" style="color:teal">.ThreadPoolExecutor</span>$Worker<span class="variable" style="color:teal">.runTask</span>(ThreadPoolExecutor<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">886</span>)
                at java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.concurrent</span><span class="variable" style="color:teal">.ThreadPoolExecutor</span>$Worker<span class="variable" style="color:teal">.run</span>(ThreadPoolExecutor<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">908</span>)
                at java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.run</span>(Thread<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">662</span>)
</pre>
     <p style="margin-top:20px; margin-bottom:20px">
      每个小时的几个时间提取
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       Thread Dump
      </code>
      ，然后检查线程的状态来确定问题。
     </p>
     <h3 style="font-family:inherit; line-height:1.125; color:inherit; margin-top:20px; margin-bottom:20px; font-size:1.42857em">
      示例2：当进程的性能异常的慢
     </h3>
     <p style="margin-top:20px; margin-bottom:20px">
      多次获得
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread dumps
      </code>
      后，找出
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       BLOCKED
      </code>
      状态的线程列表。
     </p>
     <pre class="objectivec"><span class="string" style="color:#dd1144">" DB-Processor-13"</span> daemon prio=<span class="number" style="color:#009999">5</span> tid=<span class="number" style="color:#009999">0x003edf98</span> nid=<span class="number" style="color:#009999">0xca</span> waiting <span class="keyword" style="font-weight:bold">for</span> monitor entry [<span class="number" style="color:#009999">0x000000000825f000</span>]
java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.State</span>: BLOCKED (on object monitor)
                at beans<span class="variable" style="color:teal">.ConnectionPool</span><span class="variable" style="color:teal">.getConnection</span>(ConnectionPool<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">102</span>)
                - waiting to lock &lt;<span class="number" style="color:#009999">0xe0375410</span>&gt; (a beans<span class="variable" style="color:teal">.ConnectionPool</span>)
                at beans<span class="variable" style="color:teal">.cus</span><span class="variable" style="color:teal">.ServiceCnt</span><span class="variable" style="color:teal">.getTodayCount</span>(ServiceCnt<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">111</span>)
                at beans<span class="variable" style="color:teal">.cus</span><span class="variable" style="color:teal">.ServiceCnt</span><span class="variable" style="color:teal">.insertCount</span>(ServiceCnt<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">43</span>)

<span class="string" style="color:#dd1144">"DB-Processor-14"</span> daemon prio=<span class="number" style="color:#009999">5</span> tid=<span class="number" style="color:#009999">0x003edf98</span> nid=<span class="number" style="color:#009999">0xca</span> waiting <span class="keyword" style="font-weight:bold">for</span> monitor entry [<span class="number" style="color:#009999">0x000000000825f020</span>]
java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.State</span>: BLOCKED (on object monitor)
                at beans<span class="variable" style="color:teal">.ConnectionPool</span><span class="variable" style="color:teal">.getConnection</span>(ConnectionPool<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">102</span>)
                - waiting to lock &lt;<span class="number" style="color:#009999">0xe0375410</span>&gt; (a beans<span class="variable" style="color:teal">.ConnectionPool</span>)
                at beans<span class="variable" style="color:teal">.cus</span><span class="variable" style="color:teal">.ServiceCnt</span><span class="variable" style="color:teal">.getTodayCount</span>(ServiceCnt<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">111</span>)
                at beans<span class="variable" style="color:teal">.cus</span><span class="variable" style="color:teal">.ServiceCnt</span><span class="variable" style="color:teal">.insertCount</span>(ServiceCnt<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">43</span>)

<span class="string" style="color:#dd1144">" DB-Processor-3"</span> daemon prio=<span class="number" style="color:#009999">5</span> tid=<span class="number" style="color:#009999">0x00928248</span> nid=<span class="number" style="color:#009999">0x8b</span> waiting <span class="keyword" style="font-weight:bold">for</span> monitor entry [<span class="number" style="color:#009999">0x000000000825d080</span>]
java<span class="variable" style="color:teal">.lang</span><span class="variable" style="color:teal">.Thread</span><span class="variable" style="color:teal">.State</span>: RUNNABLE
                at oracle<span class="variable" style="color:teal">.jdbc</span><span class="variable" style="color:teal">.driver</span><span class="variable" style="color:teal">.OracleConnection</span><span class="variable" style="color:teal">.isClosed</span>(OracleConnection<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">570</span>)
                - waiting to lock &lt;<span class="number" style="color:#009999">0xe03ba2e0</span>&gt; (a oracle<span class="variable" style="color:teal">.jdbc</span><span class="variable" style="color:teal">.driver</span><span class="variable" style="color:teal">.OracleConnection</span>)
                at beans<span class="variable" style="color:teal">.ConnectionPool</span><span class="variable" style="color:teal">.getConnection</span>(ConnectionPool<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">112</span>)
                - locked &lt;<span class="number" style="color:#009999">0xe0386580</span>&gt; (a java<span class="variable" style="color:teal">.util</span><span class="variable" style="color:teal">.Vector</span>)
                - locked &lt;<span class="number" style="color:#009999">0xe0375410</span>&gt; (a beans<span class="variable" style="color:teal">.ConnectionPool</span>)
                at beans<span class="variable" style="color:teal">.cus</span><span class="variable" style="color:teal">.Cue_1700c</span><span class="variable" style="color:teal">.GetNationList</span>(Cue_1700c<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">66</span>)
                at org<span class="variable" style="color:teal">.apache</span><span class="variable" style="color:teal">.jsp</span><span class="variable" style="color:teal">.cue_1700c_jsp</span><span class="variable" style="color:teal">._jspService</span>(cue_1700c_jsp<span class="variable" style="color:teal">.java</span>:<span class="number" style="color:#009999">120</span>)
</pre>
     <p style="margin-top:20px; margin-bottom:20px">
      在多次获取
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread dumps
      </code>
      后，取得
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       BLOCKED
      </code>
      状态的线程列表。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      如果线程是
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       BLOCKED
      </code>
      的，提取线程尝试获取的相关联的锁。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      通过
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread dumps
      </code>
      ，你能确定线程状态停止在
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       BLOCKED
      </code>
      ，因为锁
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       &lt;0xe0375410&gt;
      </code>
      不能被获取到，这个问题可以通过分析当前夯住的线程的
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       stack trace
      </code>
      来解决。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      使用
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       DBMS
      </code>
      的时候，为什么以上的范例经常出现再应用程序中，这有两个原因。第一个原因是
      <strong style="">
       配置不当
      </strong>
      。尽管事实是该线程仍然在工作，它们不能展示它们最好的性能，因为
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       DBCP
      </code>
      的配置文件没有配置正确。如果你多次提取
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread dumps
      </code>
      并且对比它们，你将经常看到被阻塞的线程之前处于不同的状态。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      第二个原因是不正常的连接。当与
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       DBMS
      </code>
      的连接保持在不正常的状态，线程将等待直到超时。在这个例子中，通过多次提取
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread dumps
      </code>
      并对比它们，你会发现与 DBMS 相关的线程仍然在阻塞状态。通过适当改变一些值，比如超时时间，你可以缩短问题发生的时间。
     </p>
     <h3 style="font-family:inherit; line-height:1.125; color:inherit; margin-top:20px; margin-bottom:20px; font-size:1.42857em">
      为简单的 Thread Dump 命名线程编码
     </h3>
     <p style="margin-top:20px; margin-bottom:20px">
      当使用
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       java.lang.Thread
      </code>
      对象创建线程的时候，线程被命名为 Thread-(Number) 。当使用
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       java.util.concurrent.DefaultThreadFactory
      </code>
      对象创建线程的时候，线程被命名为 named pool-(Number)-thread-(Number)。当为应用程序分析成百上千的线程的时候，如果线程依然用它们默认的名字，分析它们将变得非常困难，因为这是非常难以辨别这些线程来分析的。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      因此，你被建议开发一个命名线程的规则当一个新线程被创建的时候。
     </p>
     <p style="margin-top:20px; margin-bottom:20px">
      当你使用
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       java.lang.Thread
      </code>
      创建线程，你可以通过创建参数给该线程定义个约定俗成的名字。
     </p>
     <pre class="cs"><span class="keyword" style="font-weight:bold">public</span> Thread(Runnable target, String name);
<span class="keyword" style="font-weight:bold">public</span> Thread(ThreadGroup <span class="keyword" style="font-weight:bold">group</span>, String name);
<span class="keyword" style="font-weight:bold">public</span> Thread(ThreadGroup <span class="keyword" style="font-weight:bold">group</span>, Runnable target, String name);
<span class="keyword" style="font-weight:bold">public</span> Thread(ThreadGroup <span class="keyword" style="font-weight:bold">group</span>, Runnable target, String name, <span class="keyword" style="font-weight:bold">long</span> stackSize);
</pre>
     <p style="margin-top:20px; margin-bottom:20px">
      当你使用
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       java.util.concurrent.ThreadFactory
      </code>
      创建线程的时候，你可以通过生成你自己的线程工厂来命名它，如果你不需要特别的功能性，你可以使用
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       MyThreadFactory
      </code>
      作为以下描述：
     </p>
     <pre><code class="language-java"><span class="keyword" style="font-weight:bold">import</span> java.util.concurrent.ConcurrentHashMap;
<span class="keyword" style="font-weight:bold">import</span> java.util.concurrent.ThreadFactory;
<span class="keyword" style="font-weight:bold">import</span> java.util.concurrent.atomic.AtomicInteger;

<span class="keyword" style="font-weight:bold">public</span> <span class="class" style="color:#445588; font-weight:bold"><span class="keyword" style="color:#333333">class</span> <span class="title" style="">MyThreadFactory</span> <span class="keyword" style="color:#333333">implements</span> <span class="title" style="">ThreadFactory</span> {<!-- --></span>
  <span class="keyword" style="font-weight:bold">private</span> <span class="keyword" style="font-weight:bold">static</span> <span class="keyword" style="font-weight:bold">final</span> ConcurrentHashMap&lt;String, AtomicInteger&gt; POOL_NUMBER =
                                                       <span class="keyword" style="font-weight:bold">new</span> ConcurrentHashMap&lt;String, AtomicInteger&gt;();
  <span class="keyword" style="font-weight:bold">private</span> <span class="keyword" style="font-weight:bold">final</span> ThreadGroup group;
  <span class="keyword" style="font-weight:bold">private</span> <span class="keyword" style="font-weight:bold">final</span> AtomicInteger threadNumber = <span class="keyword" style="font-weight:bold">new</span> AtomicInteger(<span class="number" style="color:#009999">1</span>);
  <span class="keyword" style="font-weight:bold">private</span> <span class="keyword" style="font-weight:bold">final</span> String namePrefix;

  <span class="keyword" style="font-weight:bold">public</span> MyThreadFactory(String threadPoolName) {

      <span class="keyword" style="font-weight:bold">if</span> (threadPoolName == <span class="keyword" style="font-weight:bold">null</span>) {
          <span class="keyword" style="font-weight:bold">throw</span> <span class="keyword" style="font-weight:bold">new</span> NullPointerException(<span class="string" style="color:#dd1144">"threadPoolName"</span>);
      }
            POOL_NUMBER.putIfAbsent(threadPoolName, <span class="keyword" style="font-weight:bold">new</span> AtomicInteger());

      SecurityManager securityManager = System.getSecurityManager();
      group = (securityManager != <span class="keyword" style="font-weight:bold">null</span>) ? securityManager.getThreadGroup() :
                                                    Thread.currentThread().getThreadGroup();

      AtomicInteger poolCount = POOL_NUMBER.get(threadPoolName);

      <span class="keyword" style="font-weight:bold">if</span> (poolCount == <span class="keyword" style="font-weight:bold">null</span>) {
            namePrefix = threadPoolName + <span class="string" style="color:#dd1144">" pool-00-thread-"</span>;
      } <span class="keyword" style="font-weight:bold">else</span> {
            namePrefix = threadPoolName + <span class="string" style="color:#dd1144">" pool-"</span> + poolCount.getAndIncrement() + <span class="string" style="color:#dd1144">"-thread-"</span>;
      }
  }

  <span class="keyword" style="font-weight:bold">public</span> Thread newThread(Runnable runnable) {
      Thread thread = <span class="keyword" style="font-weight:bold">new</span> Thread(group, runnable, namePrefix + threadNumber.getAndIncrement(), <span class="number" style="color:#009999">0</span>);

      <span class="keyword" style="font-weight:bold">if</span> (thread.isDaemon()) {
            thread.setDaemon(<span class="keyword" style="font-weight:bold">false</span>);
      }

      <span class="keyword" style="font-weight:bold">if</span> (thread.getPriority() != Thread.NORM_PRIORITY) {
            thread.setPriority(Thread.NORM_PRIORITY);
      }

      <span class="keyword" style="font-weight:bold">return</span> thread;
  }
}
</code></pre>
     <h3 style="font-family:inherit; line-height:1.125; color:inherit; margin-top:20px; margin-bottom:20px; font-size:1.42857em">
      使用 MBean 获取更多的细节信息
     </h3>
     <p style="margin-top:20px; margin-bottom:20px">
      你可以使用 MBean 来获取
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       ThreadInfo
      </code>
      对象。你也可以获取更加多通过 thread dumps 不能获取的信息。通过使用
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       ThreadInfo
      </code>
      。
     </p>
     <pre class="erlang"><span class="variable" style="color:teal">ThreadMXBean</span> mx<span class="variable" style="color:teal">Bean</span> = <span class="variable" style="color:teal">ManagementFactory</span>.get<span class="variable" style="color:teal">ThreadMXBean</span>();
long[] thread<span class="variable" style="color:teal">Ids</span> = mx<span class="variable" style="color:teal">Bean</span>.get<span class="variable" style="color:teal">AllThreadIds</span>();
<span class="variable" style="color:teal">ThreadInfo</span>[] thread<span class="variable" style="color:teal">Infos</span> =
                mx<span class="variable" style="color:teal">Bean</span>.get<span class="variable" style="color:teal">ThreadInfo</span>(thread<span class="variable" style="color:teal">Ids</span>);

<span class="function" style=""><span class="title" style="color:#990000; font-weight:bold">for</span> <span class="params" style="">(<span class="variable" style="color:teal">ThreadInfo</span> thread<span class="variable" style="color:teal">Info</span> : thread<span class="variable" style="color:teal">Infos</span>)</span> {
  S<span class="title" style="color:#990000; font-weight:bold">ystem</span>.<span class="title" style="color:#990000; font-weight:bold">out</span>.<span class="title" style="color:#990000; font-weight:bold">println</span><span class="params" style="">(
      thread<span class="variable" style="color:teal">Info</span>.<span class="function_name" style="">getThreadName</span>())</span>;
  S<span class="title" style="color:#990000; font-weight:bold">ystem</span>.<span class="title" style="color:#990000; font-weight:bold">out</span>.<span class="title" style="color:#990000; font-weight:bold">println</span><span class="params" style="">(
      thread<span class="variable" style="color:teal">Info</span>.<span class="function_name" style="">getBlockedCount</span>())</span>;
  S<span class="title" style="color:#990000; font-weight:bold">ystem</span>.<span class="title" style="color:#990000; font-weight:bold">out</span>.<span class="title" style="color:#990000; font-weight:bold">println</span><span class="params" style="">(
      thread<span class="variable" style="color:teal">Info</span>.<span class="function_name" style="">getBlockedTime</span>())</span>;
  S<span class="title" style="color:#990000; font-weight:bold">ystem</span>.<span class="title" style="color:#990000; font-weight:bold">out</span>.<span class="title" style="color:#990000; font-weight:bold">println</span><span class="params" style="">(
      thread<span class="variable" style="color:teal">Info</span>.<span class="function_name" style="">getWaitedCount</span>())</span>;
  S<span class="title" style="color:#990000; font-weight:bold">ystem</span>.<span class="title" style="color:#990000; font-weight:bold">out</span>.<span class="title" style="color:#990000; font-weight:bold">println</span><span class="params" style="">(
      thread<span class="variable" style="color:teal">Info</span>.<span class="function_name" style="">getWaitedTime</span>())</span>;
}
</span></pre>
     <p style="margin-top:20px; margin-bottom:20px">
      你可以使用方法
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       ThreadInfo
      </code>
      来提取阻塞线程或者是等待线程花费的时间。并利用这一点，你也可以得到那些处于非活动状态的时间异常长的线程列表。
     </p>
     <h2 style="font-size:1.57143em; margin-top:20px; margin-bottom:20px; font-family:inherit; line-height:1.125; color:inherit; padding-bottom:10px; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:#dddddd">
      总结
     </h2>
     <p style="margin-top:20px; margin-bottom:20px">
      在本文中，我关注的是为开发人员提供了大量的多线程编程经验，本素材可能是常识。对于经验较少的开发人员来说，我觉得我直接跳过
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread dumps
      </code>
      ，不提供足够的关于
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread activities
      </code>
      的背景知识。这是由于我的知识缺乏，所以我不能很清晰的简洁明了的解释
      <code style="font-family:Menlo,Monaco,Consolas,'Courier New',monospace; font-size:0.92857em; padding:2px 4px; color:#c7254e; background-color:#f9f2f4">
       thread activities
      </code>
      。我衷心的希望本文能给很多开发人员提供帮助。
     </p>
    </div>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f68756f79756e7368656e3838:2f61727469636c652f64657461696c732f3432393136353431" class_="artid" style="display:none">
 </p>
</div>


