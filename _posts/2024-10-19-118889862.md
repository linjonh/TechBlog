---
layout: post
title: "2机器学习中的调参随机搜索和网格搜索"
date: 2024-10-19 08:22:51 +0800
description: "机器学习中的调参前言1、随机搜索和网格搜索2、 遗传算法前言超参数调优是机器学习中的重要一环，拿随机"
keywords: "随机搜索调参"
categories: ['机器学习']
tags: ['无标签']
artid: "118889862"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=118889862
    alt: "2机器学习中的调参随机搜索和网格搜索"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     2、机器学习中的调参：随机搜索和网格搜索
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      机器学习中的调参
     </h4>
     <ul>
      <li>
       <a href="#_1" rel="nofollow">
        前言
       </a>
      </li>
      <li>
       <a href="#1_3" rel="nofollow">
        1、随机搜索
       </a>
      </li>
      <li>
       <a href="#2__175" rel="nofollow">
        2、 网格搜索
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="_1">
     </a>
     前言
    </h2>
    <p>
     超参数调优是机器学习中的重要一环，拿随机森林算法而言，树的个数，数的深度，剪枝参数等等需要找到最优的参数组合，超参数较少时，我们可以采用for循环遍历所有参数的可能组合，但参数很多时，最优参数的搜寻将会变得困难，本文介绍了常用的调参方法随机搜索和网格搜索，后续如果学到还会更新其他调参算法。其中网格搜索法和随机搜索法采用的是sklearn中的GridSearchCV类和RandomizedSearchCV类，所用实例的数据集
     <a href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques/data?select=test.csv" rel="nofollow">
      点击这下载
     </a>
     ，数据集为爱荷华州住房数据集，为了更好的理解，本文选用超参数很多的随机森林算法作为实例。
    </p>
    <h2>
     <a id="1_3">
     </a>
     1、随机搜索
    </h2>
    <p>
     在参数很多时，一般先使用随机搜索缩小参数搜索空间。
     <br/>
     <strong>
      第一步
     </strong>
     ：导入相关库
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
</code></pre>
    <p>
     <strong>
      第二步
     </strong>
     ：对数据集进行分析与处理
     <br/>
     <strong>
      ①导入训练文件和测试文件并查看
     </strong>
    </p>
    <pre><code class="prism language-python">train_X <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'train.csv'</span><span class="token punctuation">)</span>
train_X<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/086369d19d8093507432f8ecd4677988.png"/>
    </p>
    <pre><code class="prism language-python">test_X <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'test.csv'</span><span class="token punctuation">)</span>
test_X<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4b27b8190333516ff3b3afe191c93aa4.png">
      <br/>
      对比查看可知，最终的预测结果列是ScalePrice。同时我们还可以知道，特征中包括int64、object、float64这三种数值类型，且包含缺失值。因此需要进行处理。
      <br/>
      <strong>
       ②处理缺失值
      </strong>
      <br/>
      提取三种不同数值类型的特征数据，填补确实值之后在合并，对于缺失值较多的，直接删除即可。
     </img>
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 删除缺失值太多的无用特征列</span>
train_X <span class="token operator">=</span> train_X<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'MiscVal'</span><span class="token punctuation">,</span><span class="token string">'Fence'</span><span class="token punctuation">,</span><span class="token string">'PoolQC'</span><span class="token punctuation">,</span><span class="token string">'FireplaceQu'</span><span class="token punctuation">,</span>
              <span class="token string">'Alley'</span><span class="token punctuation">,</span><span class="token string">'MiscFeature'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
test_X <span class="token operator">=</span> test_X<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'MiscVal'</span><span class="token punctuation">,</span><span class="token string">'Fence'</span><span class="token punctuation">,</span><span class="token string">'PoolQC'</span><span class="token punctuation">,</span><span class="token string">'FireplaceQu'</span><span class="token punctuation">,</span>
              <span class="token string">'Alley'</span><span class="token punctuation">,</span><span class="token string">'MiscFeature'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     按照不同的数值类型对训练集和测试集进行缺失值填补：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 提取object类型</span>
train_X_copy <span class="token operator">=</span> train_X<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
test_X_copy <span class="token operator">=</span> test_X<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
Object_feature_train <span class="token operator">=</span> train_X_copy<span class="token punctuation">.</span>select_dtypes<span class="token punctuation">(</span>include<span class="token operator">=</span><span class="token string">'object'</span><span class="token punctuation">)</span>
Object_feature_test <span class="token operator">=</span> test_X<span class="token punctuation">.</span>select_dtypes<span class="token punctuation">(</span>include<span class="token operator">=</span><span class="token string">'object'</span><span class="token punctuation">)</span>


<span class="token comment"># 对object类型进行缺失值填补和数值类型转换</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> OrdinalEncoder
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>impute <span class="token keyword">import</span> SimpleImputer
imputer <span class="token operator">=</span> SimpleImputer<span class="token punctuation">(</span>strategy<span class="token operator">=</span><span class="token string">"most_frequent"</span><span class="token punctuation">)</span>
Object_feature <span class="token operator">=</span> imputer<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>Object_feature_train<span class="token punctuation">)</span>
Object_feature_test <span class="token operator">=</span> imputer<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>Object_feature_test<span class="token punctuation">)</span>
Object_feature_train <span class="token operator">=</span> OrdinalEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>Object_feature<span class="token punctuation">)</span>
Object_feature_test <span class="token operator">=</span> OrdinalEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>Object_feature_test<span class="token punctuation">)</span>
Object_feature_train
Object_feature_test
</code></pre>
    <p>
     显示结果如下：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/dd18f696b9f2d8643f61719e4a4b7764.png"/>
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 对int64和float类型的数值进行提取和处理</span>
Number_feature_train <span class="token operator">=</span> train_X<span class="token punctuation">.</span>select_dtypes<span class="token punctuation">(</span>include<span class="token operator">=</span><span class="token string">"number"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">"SalePrice"</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
Number_feature_test <span class="token operator">=</span> test_X<span class="token punctuation">.</span>select_dtypes<span class="token punctuation">(</span>include<span class="token operator">=</span><span class="token string">'number'</span><span class="token punctuation">)</span>
Number_feature_train
</code></pre>
    <pre><code class="prism language-python"><span class="token comment"># 单独提取出目标变量y</span>
y <span class="token operator">=</span> train_X<span class="token punctuation">.</span>SalePrice
y
</code></pre>
    <pre><code class="prism language-python"><span class="token comment"># 对int64和float类型数值进行缺失值填补</span>
imputer <span class="token operator">=</span> SimpleImputer<span class="token punctuation">(</span>strategy<span class="token operator">=</span><span class="token string">"mean"</span><span class="token punctuation">)</span>
Number_feature_train <span class="token operator">=</span> imputer<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>Number_feature_train<span class="token punctuation">)</span>
Number_feature_test <span class="token operator">=</span> imputer<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>Number_feature_test<span class="token punctuation">)</span>
Number_feature_train
</code></pre>
    <p>
     ③对处理后的object、int64等不同类型的数值特征进行合并
    </p>
    <pre><code class="prism language-python">X_train <span class="token operator">=</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">(</span>Object_feature_train<span class="token punctuation">,</span>Number_feature_train<span class="token punctuation">)</span><span class="token punctuation">)</span>
X_test <span class="token operator">=</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">(</span>Object_feature_test<span class="token punctuation">,</span>Number_feature_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
X_train
</code></pre>
    <p>
     显示结果如下：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c665f4083d3fa64cc8647c3ebe1f1469.png">
      <br/>
      ④对矩阵X_train和X_test以及目标y进行标准化操作
     </img>
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 标准化操作</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler
scaler <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>
scaler<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X_train<span class="token punctuation">)</span>
scaler<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
X_train
</code></pre>
    <p>
     显示结果如下：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/dce7fe253e4b74987fec5cde70a0213e.png"/>
    </p>
    <pre><code class="prism language-python">y <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> y<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>y<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span> y<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
y
</code></pre>
    <p>
     显示结果如下：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ca7aa6025e8b57183260d8d3c666b392.png">
      <br/>
      <strong>
       第三步：不使用调参算法的初步实现
      </strong>
     </img>
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestRegressor
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">)</span>
RFR <span class="token operator">=</span> RandomForestRegressor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"R2 for training set: {RFR.score(X_train, y_train)}"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"R2 for training set: {RFR.score(X_test, y_test)}"</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     训练结果如下：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c883f0bc7b9abb2d49c5e38339c91596.png">
      <br/>
      可以看到，在不进行调参时，模型训练集评分为0.979，测试集上评分仅为0.847，出现过拟合。
      <br/>
      <strong>
       第四步：参数调节
      </strong>
      <br/>
      一般来说，
     </img>
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 查看当前超参数,可以看到RFR有18个超参数，但不会调节所有的</span>
RFR<span class="token punctuation">.</span>get_params<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     显示结果如下：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1f3c8a8b2c8f3e64ba535131c2e11dd5.png"/>
    </p>
    <pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
使用Scikit-learn提供的RandomizedSearchCV类实现随机搜索。他需要两个参数来建立：
一个估计器和超参数的可能值集，也叫参数网络或空间
'''</span>
n_estimators <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> step<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
max_features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"auto"</span><span class="token punctuation">,</span> <span class="token string">"sqrt"</span><span class="token punctuation">,</span> <span class="token string">"log2"</span><span class="token punctuation">]</span>
max_depth <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> step<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span>
min_samples_split <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> step<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
min_samples_leaf <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
bootstrap <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span>
param_grid <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"n_estimators"</span><span class="token punctuation">:</span> n_estimators<span class="token punctuation">,</span>
    <span class="token string">"max_features"</span><span class="token punctuation">:</span> max_features<span class="token punctuation">,</span>
    <span class="token string">"max_depth"</span><span class="token punctuation">:</span> max_depth<span class="token punctuation">,</span>
    <span class="token string">"min_samples_split"</span><span class="token punctuation">:</span> min_samples_split<span class="token punctuation">,</span>
    <span class="token string">"min_samples_leaf"</span><span class="token punctuation">:</span> min_samples_leaf<span class="token punctuation">,</span>
    <span class="token string">"bootstrap"</span><span class="token punctuation">:</span> bootstrap<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
param_grid
</code></pre>
    <p>
     运行结果如下：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6ba134e0eb470dc19d76312201a769a5.png"/>
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> RandomizedSearchCV
<span class="token keyword">import</span> time
start <span class="token operator">=</span> time<span class="token punctuation">.</span>clock<span class="token punctuation">(</span><span class="token punctuation">)</span>
forest <span class="token operator">=</span> RandomForestRegressor<span class="token punctuation">(</span><span class="token punctuation">)</span>

random_cv <span class="token operator">=</span> RandomizedSearchCV<span class="token punctuation">(</span>
    forest<span class="token punctuation">,</span> param_grid<span class="token punctuation">,</span> n_iter<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">"r2"</span><span class="token punctuation">,</span> n_jobs<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>
<span class="token punctuation">)</span>

_ <span class="token operator">=</span> random_cv<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_X<span class="token punctuation">,</span>train_y<span class="token punctuation">)</span>
elapsed <span class="token operator">=</span> <span class="token punctuation">(</span>time<span class="token punctuation">.</span>clock<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>clock<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Best params:\n'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>random_cv<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span>
</code></pre>
    <p>
     由此我们可以得到一下结论：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a7ab9a24421802c798c7d036bc4d6685.png"/>
     <br/>
     我们已经利用随机搜索的方法确定了最优参数的可能存在范围，下面我们还可以用网格搜索进一步精确查找合适的参数。
     <br/>
     <strong>
      小结：
     </strong>
     在上面的整个流程中，我们没有进行特征筛选，特征筛选的方法也有很多，以后我也会单独出一篇博客介绍一下常见的特征筛选方法。
    </p>
    <h2>
     <a id="2__175">
     </a>
     2、 网格搜索
    </h2>
    <p>
     网格搜索法是指定参数值的一种穷举搜索方法，通过将估计函数的参数通过交叉验证的方法进行优化来得到最优的学习算法。也就是说，将各个参数可能的取值进行排列组合，列出所有可能的组合结果生成“网格”。sklearn中用GridSearchCV类来实现。一般参数很多时可以用在随机搜索之后的精确查找。继续接着上面的随机森林算法继续：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV
param_grid <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string">'n_estimators'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1450</span><span class="token punctuation">,</span><span class="token number">1475</span><span class="token punctuation">,</span><span class="token number">1500</span><span class="token punctuation">,</span><span class="token number">1525</span><span class="token punctuation">,</span><span class="token number">1550</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'min_samples_split'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'min_samples_leaf'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

RFR_search <span class="token operator">=</span> RandomForestRegressor<span class="token punctuation">(</span>
                max_features <span class="token operator">=</span> <span class="token string">'sqrt'</span>
                <span class="token punctuation">,</span>max_depth <span class="token operator">=</span> <span class="token number">90</span>
                <span class="token punctuation">,</span>bootstrap <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token punctuation">)</span>
grid_search <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>RFR_search<span class="token punctuation">,</span>param_grid<span class="token punctuation">,</span>cv<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>scoring<span class="token operator">=</span><span class="token string">'r2'</span><span class="token punctuation">)</span>
grid_search<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_X<span class="token punctuation">,</span>train_y<span class="token punctuation">)</span>
grid_search<span class="token punctuation">.</span>best_params_
</code></pre>
    <p>
     返回结果为：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/81216b8cd150ee02368e8a473c64222f.png"/>
     <br/>
     至此，我们所有的参数都已经调整完毕，下面看下这些参数的效果：
    </p>
    <pre><code class="prism language-python">RFR <span class="token operator">=</span> RandomForestRegressor<span class="token punctuation">(</span>
                n_estimators <span class="token operator">=</span> <span class="token number">1550</span>
                <span class="token punctuation">,</span>min_samples_split <span class="token operator">=</span> <span class="token number">3</span>
                <span class="token punctuation">,</span>min_samples_leaf <span class="token operator">=</span> <span class="token number">2</span>
                <span class="token punctuation">,</span>max_features <span class="token operator">=</span> <span class="token string">'sqrt'</span>
                <span class="token punctuation">,</span>max_depth <span class="token operator">=</span> <span class="token number">90</span>
                <span class="token punctuation">,</span>bootstrap <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token punctuation">)</span>
rfr <span class="token operator">=</span> RFR<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_X<span class="token punctuation">,</span>train_y<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"R2 for training set: {rfr.score(test_X, test_y)}"</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     返回结果为：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/eec209400cb6754d59aaa49b3ddec942.png"/>
     <br/>
     可以看到，在测试集上的分数由0.84提升到了0.87。
    </p>
    <p>
     <strong>
      附
     </strong>
     ：GridSearchCV的常用方法和属性：
     <br/>
     ① grid.fit(X) ：运行网格搜索。
     <br/>
     ② grid_scores_ ：给出不同参数情况下的评价结果。
     <br/>
     ③ predict(X) : 使用找到的最佳参数在估计器上调用预测。
     <br/>
     ④ best_params_ ：描述了已取得最佳结果的参数的组合。
     <br/>
     ⑤ best_score_ ：提供优化过程期间观察到的最好的评分。
     <br/>
     ⑥ cv_results_ ：具体用法模型不同参数下交叉验证的结果。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34353637313033362f:61727469636c652f64657461696c732f313138383839383632" class_="artid" style="display:none">
 </p>
</div>


