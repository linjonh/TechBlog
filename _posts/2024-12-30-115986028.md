---
layout: post
title: "鸡肋还是革新Blazor进WinForm"
date: 2024-12-30 22:41:44 +0800
description: "本文介绍了如何将老技术Winform与微软的新宠Blazor结合，利用.NET v6.0.0预览版创"
keywords: "blazorwinform"
categories: ['未分类']
tags: ['Wpf', 'Less', 'Iot', 'Freemarker', 'Bootstrap']
artid: "115986028"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=115986028
  alt: "鸡肋还是革新Blazor进WinForm"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     鸡肋还是革新——Blazor进WinForm
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <div id="js_content">
     <p style="text-align: center">
      <img src="https://i-blog.csdnimg.cn/blog_migrate/549d63bbd708b4c591b0c65b12a82f97.png"/>
     </p>
     <p>
      winform是一老技术，感觉都有点掉牙了（我近20年前就是从winform开始接触.net的
      <img src="https://i-blog.csdnimg.cn/blog_migrate/3c100d99fc91f2bee8579b6ea27a03b1.png">
       ）；blazor，是微软技术圈里的新宠，正在被悉心照顾。当这一老一少的技术碰撞后，会有什么火花？
       <br/>
      </img>
     </p>
     <p>
      .net v6.0.0-preview.3，给winform和blazor结合带来了前提。https://github.com/axzxs2001/Asp.NetCoreExperiment/tree/master/Asp.NetCoreExperiment/Blazor/BlazorWinForm  是我写的一个简单的demo，在winform窗体中引入blazor。
     </p>
     <p>
      先看一下长什么样：
     </p>
     <p style="text-align: center">
      <img src="https://i-blog.csdnimg.cn/blog_migrate/aeb2687bc33586d7a52631bfea6420b1.png"/>
     </p>
     <p>
      是一个简单的用助记码查询药品的例子，输入框查询按钮，table的样式都是Bootstrap5.0的，外层是一个winform的Form窗体。
      <br/>
     </p>
     <p>
      具体实现，先看项目文件csproj的不一样：Sdk要换成Microsoft.NET.Sdk.Razor，然后是要通过nuget引入这些包。
      <br/>
     </p>
     <pre class="has"><code class="language-xml">&lt;Project Sdk="Microsoft.NET.Sdk.Razor"&gt;
  &lt;PropertyGroup&gt;
    &lt;OutputType&gt;WinExe&lt;/OutputType&gt;
    &lt;TargetFramework&gt;net6.0-windows&lt;/TargetFramework&gt;
    &lt;UseWindowsForms&gt;true&lt;/UseWindowsForms&gt;
  &lt;/PropertyGroup&gt;
  &lt;ItemGroup&gt;
    &lt;PackageReference Include="Dapper" Version="2.0.78" /&gt;
    &lt;PackageReference Include="Microsoft.AspNetCore.Components.WebView.WindowsForms" Version="6.0.0-preview.3.21201.13" /&gt;
    &lt;PackageReference Include="Microsoft.Extensions.DependencyInjection" Version="6.0.0-preview.3.21201.4" /&gt;
    &lt;PackageReference Include="Microsoft.NET.Sdk.Razor" Version="5.0.0-preview.8.20414.8" /&gt;
    &lt;PackageReference Include="System.Data.SqlClient" Version="4.8.2" /&gt;
  &lt;/ItemGroup&gt;
  &lt;ItemGroup&gt;
    &lt;Content Update="wwwroot\app.css"&gt;
      &lt;CopyToOutputDirectory&gt;Always&lt;/CopyToOutputDirectory&gt;
    &lt;/Content&gt;
    &lt;Content Update="wwwroot\Query.razor"&gt;
      &lt;CopyToOutputDirectory&gt;Always&lt;/CopyToOutputDirectory&gt;
    &lt;/Content&gt;
    &lt;Content Update="wwwroot\css\bootstrap.min.css"&gt;
      &lt;CopyToOutputDirectory&gt;Always&lt;/CopyToOutputDirectory&gt;
    &lt;/Content&gt;
    &lt;Content Update="wwwroot\index.html"&gt;
      &lt;CopyToOutputDirectory&gt;Always&lt;/CopyToOutputDirectory&gt;
    &lt;/Content&gt;
    &lt;Content Update="wwwroot\js\bootstrap.min.js"&gt;
      &lt;CopyToOutputDirectory&gt;Always&lt;/CopyToOutputDirectory&gt;
    &lt;/Content&gt;
  &lt;/ItemGroup&gt;
  &lt;ItemGroup&gt;
    &lt;None Update="wwwroot\app.css"&gt;
      &lt;CopyToOutputDirectory&gt;PreserveNewest&lt;/CopyToOutputDirectory&gt;
    &lt;/None&gt;
    &lt;None Update="wwwroot\Query.razor"&gt;
      &lt;CopyToOutputDirectory&gt;Always&lt;/CopyToOutputDirectory&gt;
    &lt;/None&gt;
    &lt;None Update="wwwroot\index.html"&gt;
      &lt;CopyToOutputDirectory&gt;Always&lt;/CopyToOutputDirectory&gt;
    &lt;/None&gt;
  &lt;/ItemGroup&gt;
&lt;/Project&gt;
</code></pre>
     <p>
      通过csproj也知道，我是添加了wwwroot文件夹，并添加了一些前端文件：
     </p>
     <p>
      index.html是一个模板页，引入一些css和js
      <br/>
     </p>
     <pre class="has"><code class="language-xml">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
&lt;meta charset="utf-8" /&gt;
&lt;meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" /&gt;
&lt;title&gt;Blazor app&lt;/title&gt;
&lt;base href="/" /&gt;
&lt;link href="{PROJECT NAME}.styles.css" rel="stylesheet" /&gt;
&lt;link href="app.css" rel="stylesheet" /&gt;
&lt;link href="css/bootstrap.min.css" rel="stylesheet" /&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;div id="app" class="container"&gt;&lt;/div&gt;
&lt;div id="blazor-error-ui"&gt;
An unhandled error has occurred.
&lt;a href="" class="reload"&gt;Reload&lt;/a&gt;
&lt;a class="dismiss"&gt;????&lt;/a&gt;
&lt;/div&gt;

    &lt;script src="_framework/blazor.webview.js"&gt;&lt;/script&gt;
    &lt;script src="js/bootstrap.min.js"&gt;&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>
css 和 js 就不说了，是前端的文件，重点看 query.razor，这里实现了主要业务逻辑，业务数据+UI 表现
<br/>
</p>
<pre class="has"><code class="language-cs">@using Microsoft.AspNetCore.Components.Web
@using Dapper
@using System.Data.SqlClient;
&lt;div class="row"&gt;
&lt;div class="col-1"&gt;&lt;/div&gt;
&lt;div class="col-10"&gt;
&lt;div class="input-group mb-3"&gt;
&lt;input type="text" class="form-control" id="zjm" placeholder="请输入助记码" @bind="ZJM" aria-describedby="button-addon2"&gt;
&lt;button class="btn btn-outline-secondary" type="button" @onclick="GetGoods" id="button-addon2"&gt;查询&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="col-1"&gt;&lt;/div&gt;
&lt;/div&gt;
@code {
private string ZJM { get; set; }
List&lt;Goods&gt; list = new List&lt;Goods&gt;();
void GetGoods()
{
using (var con = new SqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings["sqlcon"].ConnectionString))
{
if (string.IsNullOrWhiteSpace(ZJM))
{
list = con.Query&lt;Goods&gt;("select top 30 spid,spmch,shpchd,shpgg from spkfk ").ToList();
}
else
{
list = con.Query&lt;Goods&gt;("select top 30 spid,spmch,shpchd,shpgg from spkfk where zjm like @zjm ",new {zjm="%"+ZJM+"%" }).ToList();
}
}
}
}
&lt;div class="row"&gt;
&lt;table class="table table-striped table-hover"&gt;
&lt;thead&gt;
&lt;tr class="table-dark"&gt;
&lt;th scope="col"&gt;编号&lt;/th&gt;
&lt;th scope="col"&gt;名称&lt;/th&gt;
&lt;th scope="col"&gt;产地&lt;/th&gt;
&lt;th scope="col"&gt;规格&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
@foreach (var item in list)
{
&lt;tr&gt;
&lt;td&gt;@item.spid&lt;/td&gt;
&lt;td&gt;@item.spmch&lt;/td&gt;
         &lt;td&gt;@item.shpchd&lt;/td&gt;
&lt;td&gt;@item.shpgg&lt;/td&gt;
&lt;/tr&gt;
}
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
</code></pre>
<p>
怎么引入到 form 窗体中呢？这里有点像之前的 winform 中引入一个 webview，这里换成了 BlazorWebView。
<br/>
</p>
<pre class="has"><code class="language-cs">using BlazorWinForm.wwwroot;
using Microsoft.AspNetCore.Components.WebView.WindowsForms;
using Microsoft.Extensions.DependencyInjection;
using System.Windows.Forms;

namespace BlazorWinForm
{
public partial class frmMain : Form
{
public frmMain()
{
InitializeComponent();
var serviceCollection = new ServiceCollection();
serviceCollection.AddBlazorWebView();
var blazor = new BlazorWebView()
{
Dock = DockStyle.Fill,
HostPage = "wwwroot/index.html",
Services = serviceCollection.BuildServiceProvider(),
};
blazor.AutoScroll = false;
blazor.RootComponents.Add&lt;Query&gt;("#app");
Controls.Add(blazor);
}
}
class Goods
{
public string spid { get; set; }
public string spmch { get; set; }
public string shpchd { get; set; }
public string shpgg { get; set; }
}
}
</code></pre>
<p>
总体下来，这种把 winform+c#+html,css,js 混合起来编程，即把丰富的前端框架引入进来，让 winform 表现更加灵活，强大，也不丢失 cs 架构对当前电脑的控制力(有很多行业是通过 exe 来对接专有设备的驱动的)。winform 的 UI 之前是通过三方 UI 控件比如 DevExpress 来增强的，虽然有 WPF，但还是在微软自己画的一个圈圈里转，blazor 则是带来了丰富的前端库。另外，与之前 winform 嵌入 webview 不一样的是，blazor 中的 c#，可以方便的和 winform 来互动，语言相通，直接交流，比如你可以很轻松的在 blazor 的页里里 new 一个 form 出来。
<br/>
</p>
<p>
Blazor 进 winform，是鸡肋还是革新？应该是仁者见仁，智者见智了。
</p>
</div>

   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f7344374f39354f2f:61727469636c652f64657461696c732f313135393836303238" class_="artid" style="display:none">
 </p>
</div>
