---
layout: post
title: openstack云平台搭建与使用
date: 2022-05-28 18:04:21 +0800
categories: [openstack]
tags: [运维,人工智能,云计算,linux,centos]
image:
    path: https://img-blog.csdnimg.cn/3d43b1c170af4396bb0e4999bc358fda.png?x-oss-process=image/resize,m_fixed,h_150
    alt: openstack云平台搭建与使用
artid: 125016916
render_with_liquid: false
---
<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     openstack云平台搭建与使用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     概述
    </h2>
    <p>
     使用CentOS 7系统搭建一个OpenStack私有云平台。
    </p>
    <h2>
     <a id="_2">
     </a>
     实验目标
    </h2>
    <p>
     （1）掌握Linux系统的基础操作，包括修改主机名和配置网络等。
     <br/>
     （2）掌握OpenStack私有云平台的搭建。
    </p>
    <h2>
     <a id="_5">
     </a>
     实验环境
    </h2>
    <p>
     准备环境：
     <br/>
     CentOS 7.2 Linux系统。
     <br/>
     <code>
      XianDian-IaaS-v2.2.iso镜像文件
     </code>
    </p>
    <ul>
     <li>
      192.168.0.21 controller
     </li>
     <li>
      192.168.0.20 compute
     </li>
    </ul>
    <h2>
     <a id="_11">
     </a>
     实验步骤
    </h2>
    <ul>
     <li>
      <strong>
       两台节点分别两个网卡，一个是nat模式，另外一个为仅主机模式
      </strong>
     </li>
     <li>
      配置ip
      <ul>
       <li>
        controller节点
       </li>
      </ul>
     </li>
    </ul>
    <pre><code class="prism language-bash">ifdown-ippp        ifdown-Team        ifup-ib            ifup-ppp           init.ipv6-global
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ip a</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span> 
       valid_lft forever preferred_lft forever
<span class="token number">2</span>: eno16777736: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP qlen <span class="token number">1000</span>
    link/ether 00:0c:29:19:16:74 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.0.20/24 brd <span class="token number">192.168</span>.0.255 scope global eno16777736
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fe19:1674/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token number">3</span>: eno33554984: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP qlen <span class="token number">1000</span>
    link/ether 00:0c:29:19:16:7e brd ff:ff:ff:ff:ff:ff
    inet6 fe80::20c:29ff:fe19:167e/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cp /etc/sysconfig/network-scripts/ifcfg-eno16777736 /etc/sysconfig/network-scripts/ifcfg-eno33554984</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/sysconfig/network-scripts/ifcfg-eno33554984</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/sysconfig/network-scripts/ifcfg-eno33554984</span>
<span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet1
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static
<span class="token assign-left variable">DEFROUTE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV4_FAILURE_FATAL</span><span class="token operator">=</span>no
<span class="token assign-left variable">NAME</span><span class="token operator">=</span>eno33554984
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>eno33554984
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">114.114</span>.114.114
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.10.21
<span class="token assign-left variable">PREFIX</span><span class="token operator">=</span><span class="token number">24</span>
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">192.168</span>.10.2
~
<span class="token string">"/etc/sysconfig/network-scripts/ifcfg-eno33554984"</span> 11L, 187C written                 
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart network</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ip a</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span> 
       valid_lft forever preferred_lft forever
<span class="token number">2</span>: eno16777736: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP qlen <span class="token number">1000</span>
    link/ether 00:0c:29:19:16:74 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.0.20/24 brd <span class="token number">192.168</span>.0.255 scope global eno16777736
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fe19:1674/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token number">3</span>: eno33554984: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP qlen <span class="token number">1000</span>
    link/ether 00:0c:29:19:16:7e brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.10.20/24 brd <span class="token number">192.168</span>.10.255 scope global eno33554984
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fe19:167e/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
</code></pre>
    <pre><code> compute
</code></pre>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/sysconfig/network-scripts/ifcfg-eno33554984</span>
<span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet1
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static
<span class="token assign-left variable">DEFROUTE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV4_FAILURE_FATAL</span><span class="token operator">=</span>no
<span class="token assign-left variable">NAME</span><span class="token operator">=</span>eno33554984
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>eno33554984
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">114.114</span>.114.114
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.10.21
<span class="token assign-left variable">PREFIX</span><span class="token operator">=</span><span class="token number">24</span>
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">192.168</span>.10.2

<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart network</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># ip a</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span> 
       valid_lft forever preferred_lft forever
<span class="token number">2</span>: eno16777736: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP qlen <span class="token number">1000</span>
    link/ether 00:0c:29:f6:6f:a1 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.0.21/24 brd <span class="token number">192.168</span>.0.255 scope global eno16777736
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fef6:6fa1/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token number">3</span>: eno33554984: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP qlen <span class="token number">1000</span>
    link/ether 00:0c:29:f6:6f:ab brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.10.21/24 brd <span class="token number">192.168</span>.10.255 scope global eno33554984
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fef6:6fab/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
</code></pre>
    <ul>
     <li>
      ping测试
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ping 192.168.10.21</span>
PING <span class="token number">192.168</span>.10.21 <span class="token punctuation">(</span><span class="token number">192.168</span>.10.21<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">192.168</span>.10.21: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.454</span> ms
<span class="token number">64</span> bytes from <span class="token number">192.168</span>.10.21: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">2.76</span> ms
<span class="token number">64</span> bytes from <span class="token number">192.168</span>.10.21: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.946</span> ms
^C
--- <span class="token number">192.168</span>.10.21 <span class="token function">ping</span> statistics ---
<span class="token number">3</span> packets transmitted, <span class="token number">3</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 2025ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">0.454</span>/1.389/2.769/0.996 ms
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># </span>

</code></pre>
    <ul>
     <li>
      修改主机名
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname controller</span>
<span class="token punctuation">[</span>root@cemtos7 ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname compute</span>
</code></pre>
    <ul>
     <li>
      关闭防火墙（两台节点都要）
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment"># iptables -F</span>
<span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment"># iptables -Z</span>
<span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment"># iptables -X</span>
<span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment"># iptables-save</span>
<span class="token comment"># Generated by iptables-save v1.4.21 on Sat May 28 00:34:45 2022</span>
*filter
:INPUT ACCEPT <span class="token punctuation">[</span><span class="token number">34</span>:2652<span class="token punctuation">]</span>
:FORWARD ACCEPT <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:OUTPUT ACCEPT <span class="token punctuation">[</span><span class="token number">19</span>:2008<span class="token punctuation">]</span>
COMMIT
<span class="token comment"># Completed on Sat May 28 00:34:45 2022</span>
<span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop firewalld</span>
<span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment"># systemctl disable firewalld</span>
<span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/selinux/config </span>
<span class="token comment">##修改SELINUX=disabled</span>
<span class="token comment"># This file controls the state of SELinux on the system.</span>
<span class="token comment"># SELINUX= can take one of these three values:</span>
<span class="token comment">#     enforcing - SELinux security policy is enforced.</span>
<span class="token comment">#     permissive - SELinux prints warnings instead of enforcing.</span>
<span class="token comment">#     disabled - No SELinux policy is loaded.</span>
<span class="token assign-left variable">SELINUX</span><span class="token operator">=</span>disabled
<span class="token comment"># SELINUXTYPE= can take one of three two values:</span>
<span class="token comment">#     targeted - Targeted processes are protected,</span>
<span class="token comment">#     minimum - Modification of targeted policy. Only selected processes are protected. </span>
<span class="token comment">#     mls - Multi Level Security protection.</span>
<span class="token assign-left variable">SELINUXTYPE</span><span class="token operator">=</span>targeted
</code></pre>
    <ul>
     <li>
      添加主机解析
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/hosts</span>
<span class="token number">127.0</span>.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
<span class="token number">192.168</span>.10.20 controller
<span class="token number">192.168</span>.10.21 compute
</code></pre>
    <ul>
     <li>
      挂载xiandian.iso(两台都要)
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># ls</span>
anaconda-ks.cfg  XianDian-IaaS-v2.2.iso
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/fstab</span>
<span class="token comment">#</span>
<span class="token comment"># /etc/fstab</span>
<span class="token comment"># Created by anaconda on Sat Mar 12 04:06:23 2022</span>
<span class="token comment">#</span>
<span class="token comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span>
<span class="token comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span>
<span class="token comment">#</span>
/dev/mapper/centos-root /                       xfs     defaults        <span class="token number">0</span> <span class="token number">0</span>
<span class="token assign-left variable">UUID</span><span class="token operator">=</span>85b39342-ac84-47e5-919c-9faef57e0c58 /boot                   xfs     defaults        <span class="token number">0</span> <span class="token number">0</span>
/dev/mapper/centos-swap swap                    swap    defaults        <span class="token number">0</span> <span class="token number">0</span>
/dev/sr0 /cdrom iso9660 defaults <span class="token number">0</span> <span class="token number">0</span>
/root/XianDian-IaaS-v2.2.iso  /xiandian iso9660 defaults <span class="token number">0</span> <span class="token number">0</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># mount -a</span>
mount: /dev/loop0 is write-protected, mounting read-only
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/yum.repos.d/local.repo </span>
<span class="token punctuation">[</span>local<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>local
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///cdrom
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">[</span>xiandian<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>xiandian
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///xiandian/iaas-repo
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum repolist</span>
Loaded plugins: fastestmirror
<span class="token builtin class-name">local</span>                                                                 <span class="token operator">|</span> <span class="token number">3.6</span> kB  00:00:00     
xiandian                                                              <span class="token operator">|</span> <span class="token number">2.9</span> kB  00:00:00     
xiandian/primary_db                                                   <span class="token operator">|</span> <span class="token number">2.3</span> MB  00:00:00     
Loading mirror speeds from cached hostfile
repo <span class="token function">id</span>                                    repo name                                   status
<span class="token builtin class-name">local</span>                                      <span class="token builtin class-name">local</span>                                       <span class="token number">3,723</span>
xiandian                                   xiandian                                    <span class="token number">1,688</span>
repolist: <span class="token number">5,411</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># </span>

</code></pre>
    <ul>
     <li>
      在controller和compute节点同时安装 iaas-xiandian
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum install iaas-xiandian -y</span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
Resolving Dependencies
--<span class="token operator">&gt;</span> Running transaction check
---<span class="token operator">&gt;</span> Package iaas-xiandian.x86_64 <span class="token number">0</span>:2.2-0 will be installed
--<span class="token operator">&gt;</span> Finished Dependency Resolution

Dependencies Resolved

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
 Package                   Arch               Version             Repository            Size
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Installing:
 iaas-xiandian             x86_64             <span class="token number">2.2</span>-0               xiandian              <span class="token number">22</span> k

Transaction Summary
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Install  <span class="token number">1</span> Package

Total download size: <span class="token number">22</span> k
Installed size: <span class="token number">93</span> k
Downloading packages:
Running transaction check
Running transaction <span class="token builtin class-name">test</span>
Transaction <span class="token builtin class-name">test</span> succeeded
Running transaction
  Installing <span class="token builtin class-name">:</span> iaas-xiandian-2.2-0.x86_64                                                <span class="token number">1</span>/1 
  Verifying  <span class="token builtin class-name">:</span> iaas-xiandian-2.2-0.x86_64                                                <span class="token number">1</span>/1 

Installed:
  iaas-xiandian.x86_64 <span class="token number">0</span>:2.2-0                                                               

Complete<span class="token operator">!</span>
</code></pre>
    <ul>
     <li>
      在两个节点上修改全局配置文件openrc.sh，具体内容参照下面的配置文件填写，具体涉及到的ip得根据实际环境的controller和compute节点的ip来定
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3d479475803d2e3fa2eb739b0f6b937f.png"/>
     </li>
     <li>
      这里compute节点需要先添加两块硬盘，或者分区（这里我是sdb和sdc）
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="token number">8</span>:0    <span class="token number">0</span>   50G  <span class="token number">0</span> disk 
├─sda1            <span class="token number">8</span>:1    <span class="token number">0</span>  500M  <span class="token number">0</span> part /boot
└─sda2            <span class="token number">8</span>:2    <span class="token number">0</span>   24G  <span class="token number">0</span> part 
  ├─centos-root <span class="token number">253</span>:0    <span class="token number">0</span>   20G  <span class="token number">0</span> lvm  /
  └─centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>    4G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
sdb               <span class="token number">8</span>:16   <span class="token number">0</span>   10G  <span class="token number">0</span> disk 
sdc               <span class="token number">8</span>:32   <span class="token number">0</span>   20G  <span class="token number">0</span> disk 
sr0              <span class="token number">11</span>:0    <span class="token number">1</span>    4G  <span class="token number">0</span> rom  /cdrom
loop0             <span class="token number">7</span>:0    <span class="token number">0</span>  <span class="token number">2</span>.7G  <span class="token number">0</span> loop /xiandian
</code></pre>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/xiandian/openrc.sh</span>
<span class="token comment">##--------------------system Config--------------------##</span>
<span class="token comment">##Controller Server Manager IP. example:x.x.x.x</span>
<span class="token assign-left variable">HOST_IP</span><span class="token operator">=</span><span class="token number">192.168</span>.10.20

<span class="token comment">##Controller Server hostname. example:controller</span>
<span class="token assign-left variable">HOST_NAME</span><span class="token operator">=</span>controller

<span class="token comment">##Compute Node Manager IP. example:x.x.x.x</span>
<span class="token assign-left variable">HOST_IP_NODE</span><span class="token operator">=</span><span class="token number">192.168</span>.10.21

<span class="token comment">##Compute Node hostname. example:compute</span>
<span class="token assign-left variable">HOST_NAME_NODE</span><span class="token operator">=</span>compute

<span class="token comment">##--------------------Rabbit Config ------------------##</span>
<span class="token comment">##user for rabbit. example:openstack</span>
<span class="token assign-left variable">RABBIT_USER</span><span class="token operator">=</span>openstack

<span class="token comment">##Password for rabbit user .example:000000</span>
<span class="token assign-left variable">RABBIT_PASS</span><span class="token operator">=</span>000000

<span class="token comment">##--------------------MySQL Config---------------------##</span>
<span class="token comment">##Password for MySQL root user . exmaple:000000</span>
<span class="token assign-left variable">DB_PASS</span><span class="token operator">=</span>000000

<span class="token comment">##--------------------Keystone Config------------------##</span>
<span class="token comment">##Password for Keystore admin user. exmaple:000000</span>
<span class="token assign-left variable">DOMAIN_NAME</span><span class="token operator">=</span>demo
<span class="token assign-left variable">ADMIN_PASS</span><span class="token operator">=</span>000000
<span class="token assign-left variable">DEMO_PASS</span><span class="token operator">=</span>000000

<span class="token comment">##Password for Mysql keystore user. exmaple:000000</span>
<span class="token assign-left variable">KEYSTONE_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">##--------------------Glance Config--------------------##</span>
<span class="token comment">##Password for Mysql glance user. exmaple:000000</span>
<span class="token assign-left variable">GLANCE_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">##Password for Keystore glance user. exmaple:000000</span>
<span class="token assign-left variable">GLANCE_PASS</span><span class="token operator">=</span>000000

<span class="token comment">##--------------------Nova Config----------------------##</span>
<span class="token comment">##Password for Mysql nova user. exmaple:000000</span>
<span class="token assign-left variable">NOVA_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">##Password for Keystore nova user. exmaple:000000</span>
<span class="token assign-left variable">NOVA_PASS</span><span class="token operator">=</span>000000

<span class="token comment">##--------------------Neturon Config-------------------##</span>
<span class="token comment">##Password for Mysql neutron user. exmaple:000000</span>
<span class="token assign-left variable">NEUTRON_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">##Password for Keystore neutron user. exmaple:000000</span>
<span class="token assign-left variable">NEUTRON_PASS</span><span class="token operator">=</span>000000

<span class="token comment">##metadata secret for neutron. exmaple:000000</span>
<span class="token assign-left variable">METADATA_SECRET</span><span class="token operator">=</span>000000

<span class="token comment">##External Network Interface. example:eth1</span>
<span class="token assign-left variable">INTERFACE_NAME</span><span class="token operator">=</span>网卡1的名称（Nat模式那个）

<span class="token comment">##First Vlan ID in VLAN RANGE for VLAN Network. exmaple:101</span>
<span class="token comment">#minvlan=</span>

<span class="token comment">##Last Vlan ID in VLAN RANGE for VLAN Network. example:200</span>
<span class="token comment">#maxvlan=000000</span>

<span class="token comment">##--------------------Cinder Config--------------------##</span>
<span class="token comment">##Password for Mysql cinder user. exmaple:000000</span>
<span class="token assign-left variable">CINDER_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">##Password for Keystore cinder user. exmaple:000000</span>
<span class="token assign-left variable">CINDER_PASS</span><span class="token operator">=</span>000000

<span class="token comment">##Cinder Block Disk. example:md126p3</span>
<span class="token assign-left variable">BLOCK_DISK</span><span class="token operator">=</span>sdb

<span class="token comment">##--------------------Trove Config--------------------##</span>
<span class="token comment">##Password for Mysql Trove User. exmaple:000000</span>
<span class="token assign-left variable">TROVE_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">##Password for Keystore Trove User. exmaple:000000</span>
<span class="token assign-left variable">TROVE_PASS</span><span class="token operator">=</span>000000

<span class="token comment">##--------------------Swift Config---------------------##</span>
<span class="token comment">##Password for Keystore swift user. exmaple:000000</span>
<span class="token assign-left variable">SWIFT_PASS</span><span class="token operator">=</span>000000

<span class="token comment">##The NODE Object Disk for Swift. example:md126p4.</span>
<span class="token assign-left variable">OBJECT_DISK</span><span class="token operator">=</span>sdc

<span class="token comment">##The NODE IP for Swift Storage Network. example:x.x.x.x.</span>
<span class="token assign-left variable">STORAGE_LOCAL_NET_IP</span><span class="token operator">=</span><span class="token number">192.168</span>.0.21

<span class="token comment">##--------------------Heat Config----------------------##</span>
<span class="token comment">##Password for Mysql heat user. exmaple:000000</span>
<span class="token assign-left variable">HEAT_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">##Password for Keystore heat user. exmaple:000000</span>
<span class="token assign-left variable">HEAT_PASS</span><span class="token operator">=</span>000000

<span class="token comment">##--------------------Ceilometer Config----------------##</span>
<span class="token comment">##Password for Mysql ceilometer user. exmaple:000000</span>
<span class="token assign-left variable">CEILOMETER_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">##Password for Keystore ceilometer user. exmaple:000000</span>
<span class="token assign-left variable">CEILOMETER_PASS</span><span class="token operator">=</span>000000

<span class="token comment">##--------------------AODH Config----------------##</span>
<span class="token comment">##Password for Mysql AODH user. exmaple:000000</span>
<span class="token assign-left variable">AODH_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">##Password for Keystore AODH user. exmaple:000000</span>
<span class="token assign-left variable">AODH_PASS</span><span class="token operator">=</span>000000
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># scp /etc/xiandian/openrc.sh root@compute:/etc/xiandian/openrc.sh </span>
The authenticity of <span class="token function">host</span> <span class="token string">'compute (192.168.0.21)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is c8:fe:fe:fa:9d:73:26:60:f9:cb:13:2b:bb:e8:d9:ac.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '</span>compute<span class="token string">' (ECDSA) to the list of known hosts.
root@compute'</span>s password: 
openrc.sh                                                            <span class="token number">100</span>% <span class="token number">3095</span>     <span class="token number">3</span>.0KB/s   00:00  
</code></pre>
    <ul>
     <li>
      同时在controller和compute节点上执行脚本iaas-pre-host.sh进行安装。完成配置后，同时重启两个节点服务器
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-pre-host.sh</span>
  python2-debtcollector.noarch <span class="token number">0</span>:1.3.0-1.el7                                                           
  python2-funcsigs.noarch <span class="token number">0</span>:0.4-2.el7                                                                  
  python2-iso8601.noarch <span class="token number">0</span>:0.1.11-1.el7                                                                
  python2-jsonpatch.noarch <span class="token number">0</span>:1.14-1.el7                                                                
  python2-jsonpointer.noarch <span class="token number">0</span>:1.10-4.el7                                                              
  python2-keystoneauth1.noarch <span class="token number">0</span>:2.4.1-1.el7                                                           
  python2-openstacksdk.noarch <span class="token number">0</span>:0.8.3-1.el7                                                            
  python2-os-client-config.noarch <span class="token number">0</span>:1.16.0-1.el7                                                       
  python2-oslo-config.noarch <span class="token number">2</span>:3.9.0-1.el7                                                             
  python2-oslo-i18n.noarch <span class="token number">0</span>:3.4.0-1.el7                                                               
  python2-oslo-serialization.noarch <span class="token number">0</span>:2.4.0-1.el7                                                      
  python2-oslo-utils.noarch <span class="token number">0</span>:3.7.0-1.el7                                                              
  python2-positional.noarch <span class="token number">0</span>:1.0.1-1.el7                                                              
  python2-pyasn1.noarch <span class="token number">0</span>:0.1.9-6.el7.1                                                                
  python2-pysocks.noarch <span class="token number">0</span>:1.5.6-3.el7                                                                 
  python2-requestsexceptions.noarch <span class="token number">0</span>:1.1.3-1.el7                                                      
  python2-setuptools.noarch <span class="token number">0</span>:22.0.5-1.el7                                                             
  pytz.noarch <span class="token number">0</span>:2012d-5.el7                                                                            
  setools-libs.x86_64 <span class="token number">0</span>:3.3.7-46.el7                                                                   

Complete<span class="token operator">!</span>
Please Reboot or Reconnect the terminal

</code></pre>
    <ul>
     <li>
      在controller节点执行脚本iaas-install-mysql.sh进行数据库及消息列表服务安装
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-mysql.sh</span>
Thanks <span class="token keyword">for</span> using MariaDB<span class="token operator">!</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/mongod.service to /usr/lib/systemd/system/mongod.service.
Created symlink from /etc/systemd/system/multi-user.target.wants/rabbitmq-server.service to /usr/lib/systemd/system/rabbitmq-server.service.
Creating user <span class="token string">"openstack"</span> <span class="token punctuation">..</span>.
Setting permissions <span class="token keyword">for</span> user <span class="token string">"openstack"</span> <span class="token keyword">in</span> vhost <span class="token string">"/"</span> <span class="token punctuation">..</span>.
Created symlink from /etc/systemd/system/multi-user.target.wants/memcached.service to /usr/lib/systemd/system/memcached.service.
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre>
    <ul>
     <li>
      在controller节点执行脚本iaas-install-keystone.sh进行keystone认证服务安装
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#  iaas-install-keystone.sh</span>
+-------------+----------------------------------+
<span class="token operator">|</span> Field       <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-------------+----------------------------------+
<span class="token operator">|</span> description <span class="token operator">|</span> Admin Project                    <span class="token operator">|</span>
<span class="token operator">|</span> domain_id   <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> enabled     <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>          <span class="token operator">|</span> 81ea07237d034c4e99369581c1b4db89 <span class="token operator">|</span>
<span class="token operator">|</span> is_domain   <span class="token operator">|</span> False                            <span class="token operator">|</span>
<span class="token operator">|</span> name        <span class="token operator">|</span> admin                            <span class="token operator">|</span>
<span class="token operator">|</span> parent_id   <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
+-------------+----------------------------------+
+-----------+----------------------------------+
<span class="token operator">|</span> Field     <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-----------+----------------------------------+
<span class="token operator">|</span> domain_id <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> enabled   <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>        <span class="token operator">|</span> 2bee802355b24023968dc6e4bd11c983 <span class="token operator">|</span>
<span class="token operator">|</span> name      <span class="token operator">|</span> admin                            <span class="token operator">|</span>
+-----------+----------------------------------+
+-----------+----------------------------------+
<span class="token operator">|</span> Field     <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-----------+----------------------------------+
<span class="token operator">|</span> domain_id <span class="token operator">|</span> None                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>        <span class="token operator">|</span> 28e00fea5f4344edaa093f617fc55d5a <span class="token operator">|</span>
<span class="token operator">|</span> name      <span class="token operator">|</span> admin                            <span class="token operator">|</span>
+-----------+----------------------------------+
+-------------+----------------------------------+
<span class="token operator">|</span> Field       <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-------------+----------------------------------+
<span class="token operator">|</span> description <span class="token operator">|</span> Service Project                  <span class="token operator">|</span>
<span class="token operator">|</span> domain_id   <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> enabled     <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>          <span class="token operator">|</span> 09ecb096e1034e5b9e5166adfc15a6f0 <span class="token operator">|</span>
<span class="token operator">|</span> is_domain   <span class="token operator">|</span> False                            <span class="token operator">|</span>
<span class="token operator">|</span> name        <span class="token operator">|</span> <span class="token function">service</span>                          <span class="token operator">|</span>
<span class="token operator">|</span> parent_id   <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
+-------------+----------------------------------+
+-------------+----------------------------------+
<span class="token operator">|</span> Field       <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-------------+----------------------------------+
<span class="token operator">|</span> description <span class="token operator">|</span> Demo Project                     <span class="token operator">|</span>
<span class="token operator">|</span> domain_id   <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> enabled     <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>          <span class="token operator">|</span> 5e04233827f848228c4a5a238c1e780b <span class="token operator">|</span>
<span class="token operator">|</span> is_domain   <span class="token operator">|</span> False                            <span class="token operator">|</span>
<span class="token operator">|</span> name        <span class="token operator">|</span> demo                             <span class="token operator">|</span>
<span class="token operator">|</span> parent_id   <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
+-------------+----------------------------------+
+-----------+----------------------------------+
<span class="token operator">|</span> Field     <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-----------+----------------------------------+
<span class="token operator">|</span> domain_id <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> enabled   <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>        <span class="token operator">|</span> ebb2d2324b054189acf2bd5a62b6555a <span class="token operator">|</span>
<span class="token operator">|</span> name      <span class="token operator">|</span> demo                             <span class="token operator">|</span>
+-----------+----------------------------------+
+-----------+----------------------------------+
<span class="token operator">|</span> Field     <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-----------+----------------------------------+
<span class="token operator">|</span> domain_id <span class="token operator">|</span> None                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>        <span class="token operator">|</span> a243425ce82c445c98e98b021165f737 <span class="token operator">|</span>
<span class="token operator">|</span> name      <span class="token operator">|</span> user                             <span class="token operator">|</span>
+-----------+----------------------------------+
</code></pre>
    <ul>
     <li>
      在controller节点执行脚本iaas-install-glance.sh进行glance镜像服务安装。
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-glance.sh</span>
+--------------+----------------------------------+
<span class="token operator">|</span> Field        <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+--------------+----------------------------------+
<span class="token operator">|</span> enabled      <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>           <span class="token operator">|</span> 7505aaf809124ae9b05dfe30de8ce6e0 <span class="token operator">|</span>
<span class="token operator">|</span> interface    <span class="token operator">|</span> internal                         <span class="token operator">|</span>
<span class="token operator">|</span> region       <span class="token operator">|</span> RegionOne                        <span class="token operator">|</span>
<span class="token operator">|</span> region_id    <span class="token operator">|</span> RegionOne                        <span class="token operator">|</span>
<span class="token operator">|</span> service_id   <span class="token operator">|</span> 13051029aec94967a8dc19238e1f9d8c <span class="token operator">|</span>
<span class="token operator">|</span> service_name <span class="token operator">|</span> glance                           <span class="token operator">|</span>
<span class="token operator">|</span> service_type <span class="token operator">|</span> image                            <span class="token operator">|</span>
<span class="token operator">|</span> url          <span class="token operator">|</span> http://controller:9292           <span class="token operator">|</span>
+--------------+----------------------------------+
+--------------+----------------------------------+
<span class="token operator">|</span> Field        <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+--------------+----------------------------------+
<span class="token operator">|</span> enabled      <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>           <span class="token operator">|</span> bc3d5a5d0ea14992baff0b89f470d3ee <span class="token operator">|</span>
<span class="token operator">|</span> interface    <span class="token operator">|</span> admin                            <span class="token operator">|</span>
<span class="token operator">|</span> region       <span class="token operator">|</span> RegionOne                        <span class="token operator">|</span>
<span class="token operator">|</span> region_id    <span class="token operator">|</span> RegionOne                        <span class="token operator">|</span>
<span class="token operator">|</span> service_id   <span class="token operator">|</span> 13051029aec94967a8dc19238e1f9d8c <span class="token operator">|</span>
<span class="token operator">|</span> service_name <span class="token operator">|</span> glance                           <span class="token operator">|</span>
<span class="token operator">|</span> service_type <span class="token operator">|</span> image                            <span class="token operator">|</span>
<span class="token operator">|</span> url          <span class="token operator">|</span> http://controller:9292           <span class="token operator">|</span>
+--------------+----------------------------------+
Option <span class="token string">"verbose"</span> from group <span class="token string">"DEFAULT"</span> is deprecated <span class="token keyword">for</span> removal.  Its value may be silently ignored <span class="token keyword">in</span> the future.
/usr/lib/python2.7/site-packages/oslo_db/sqlalchemy/enginefacade.py:1056: OsloDBDeprecationWarning: EngineFacade is deprecated<span class="token punctuation">;</span> please use oslo_db.sqlalchemy.enginefacade
  <span class="token assign-left variable">expire_on_commit</span><span class="token operator">=</span>expire_on_commit, <span class="token assign-left variable">_conf</span><span class="token operator">=</span>conf<span class="token punctuation">)</span>
/usr/lib/python2.7/site-packages/pymysql/cursors.py:146: Warning: Duplicate index <span class="token string">'ix_image_properties_image_id_name'</span> defined on the table <span class="token string">'glance.image_properties'</span><span class="token builtin class-name">.</span> This is deprecated and will be disallowed <span class="token keyword">in</span> a future release.
  result <span class="token operator">=</span> self._query<span class="token punctuation">(</span>query<span class="token punctuation">)</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-glance-api.service to /usr/lib/systemd/system/openstack-glance-api.service.
Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-glance-registry.service to /usr/lib/systemd/system/openstack-glance-registry.service.
</code></pre>
    <ul>
     <li>
      在controller节点执行脚本iaas-install-nova-controller.sh进行nova计算服务安装
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-nova-controller.sh</span>
Dependency Installed:
  jbigkit-libs.x86_64 <span class="token number">0</span>:2.0-11.el7               libjpeg-turbo.x86_64 <span class="token number">0</span>:1.2.90-5.el7                  
  libtiff.x86_64 <span class="token number">0</span>:4.0.3-25.el7_2                libwebp.x86_64 <span class="token number">0</span>:0.3.0-3.el7                         
  libxslt.x86_64 <span class="token number">0</span>:1.1.28-5.el7                  novnc.noarch <span class="token number">0</span>:0.5.1-2.el7                           
  openstack-nova-common.noarch <span class="token number">1</span>:13.1.0-1.el7    python-cheetah.x86_64 <span class="token number">0</span>:2.4.4-5.el7.centos           
  python-lxml.x86_64 <span class="token number">0</span>:3.2.1-4.el7               python-markdown.noarch <span class="token number">0</span>:2.4.1-1.el7.centos          
  python-nova.noarch <span class="token number">1</span>:13.1.0-1.el7              python-pillow.x86_64 <span class="token number">0</span>:2.0.0-19.gitd1c6db8.el7       
  python-psutil.x86_64 <span class="token number">0</span>:1.2.1-1.el7             python-pygments.noarch <span class="token number">0</span>:2.0.2-4.el7                 
  python-websockify.noarch <span class="token number">0</span>:0.8.0-1.el7         python2-ecdsa.noarch <span class="token number">0</span>:0.13-4.el7                    
  python2-mock.noarch <span class="token number">0</span>:1.3.0-2.el7              python2-os-brick.noarch <span class="token number">0</span>:1.1.0-1.el7                
  python2-oslo-reports.noarch <span class="token number">0</span>:1.6.0-1.el7      python2-oslo-versionedobjects.noarch <span class="token number">0</span>:1.7.0-1.el7   
  python2-paramiko.noarch <span class="token number">0</span>:1.16.1-1.el7         python2-rfc3986.noarch <span class="token number">0</span>:0.3.1-1.el7                 

Complete<span class="token operator">!</span>
/usr/lib/python2.7/site-packages/pymysql/cursors.py:146: Warning: Duplicate index <span class="token string">'block_device_mapping_instance_uuid_virtual_name_device_name_idx'</span> defined on the table <span class="token string">'nova.block_device_mapping'</span><span class="token builtin class-name">.</span> This is deprecated and will be disallowed <span class="token keyword">in</span> a future release.
  result <span class="token operator">=</span> self._query<span class="token punctuation">(</span>query<span class="token punctuation">)</span>
/usr/lib/python2.7/site-packages/pymysql/cursors.py:146: Warning: Duplicate index <span class="token string">'uniq_instances0uuid'</span> defined on the table <span class="token string">'nova.instances'</span><span class="token builtin class-name">.</span> This is deprecated and will be disallowed <span class="token keyword">in</span> a future release.
  result <span class="token operator">=</span> self._query<span class="token punctuation">(</span>query<span class="token punctuation">)</span>
iptables: Saving firewall rules to /etc/sysconfig/iptables: <span class="token punctuation">[</span>  OK  <span class="token punctuation">]</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-nova-api.service to /usr/lib/systemd/system/openstack-nova-api.service.
Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-nova-consoleauth.service to /usr/lib/systemd/system/openstack-nova-consoleauth.service.
Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-nova-scheduler.service to /usr/lib/systemd/system/openstack-nova-scheduler.service.
Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-nova-conductor.service to /usr/lib/systemd/system/openstack-nova-conductor.service.
Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-nova-novncproxy.service to /usr/lib/systemd/system/openstack-nova-novncproxy.service.
</code></pre>
    <ul>
     <li>
      在
      <strong>
       compute
      </strong>
      节点执行脚本iaas-install-nova-compute.sh进行nova安装
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-nova-compute.sh</span>
 qemu-img-ev.x86_64 <span class="token number">10</span>:2.3.0-31.el7.16.1                                                               
  qemu-kvm-common-ev.x86_64 <span class="token number">10</span>:2.3.0-31.el7.16.1                                                        
  qemu-kvm-ev.x86_64 <span class="token number">10</span>:2.3.0-31.el7.16.1                                                               
  quota.x86_64 <span class="token number">1</span>:4.01-11.el7_2.1                                                                        
  quota-nls.noarch <span class="token number">1</span>:4.01-11.el7_2.1                                                                    
  radvd.x86_64 <span class="token number">0</span>:1.9.2-9.el7                                                                            
  rpcbind.x86_64 <span class="token number">0</span>:0.2.0-33.el7_2.1                                                                     
  rsync.x86_64 <span class="token number">0</span>:3.0.9-17.el7                                                                           
  rsyslog-mmjsonparse.x86_64 <span class="token number">0</span>:7.4.7-12.el7                                                             
  scrub.x86_64 <span class="token number">0</span>:2.5.2-5.el7                                                                            
  seabios-bin.noarch <span class="token number">0</span>:1.7.5-11.el7                                                                     
  seavgabios-bin.noarch <span class="token number">0</span>:1.7.5-11.el7                                                                  
  sg3_utils.x86_64 <span class="token number">0</span>:1.37-5.el7                                                                         
  sg3_utils-libs.x86_64 <span class="token number">0</span>:1.37-5.el7                                                                    
  sgabios-bin.noarch <span class="token number">1</span>:0.20110622svn-4.el7                                                              
  spice-server.x86_64 <span class="token number">0</span>:0.12.4-15.el7_2.2                                                               
  supermin5.x86_64 <span class="token number">0</span>:5.1.10-1.2.el7                                                                     
  sysfsutils.x86_64 <span class="token number">0</span>:2.1.0-16.el7                                                                      
  syslinux.x86_64 <span class="token number">0</span>:4.05-12.el7                                                                         
  syslinux-extlinux.x86_64 <span class="token number">0</span>:4.05-12.el7                                                                
  tcp_wrappers.x86_64 <span class="token number">0</span>:7.6-77.el7                                                                      
  unbound-libs.x86_64 <span class="token number">0</span>:1.4.20-26.el7                                                                   
  urw-fonts.noarch <span class="token number">0</span>:2.4-16.el7                                                                         
  usbredir.x86_64 <span class="token number">0</span>:0.6-7.el7                                                                           
  xorg-x11-font-utils.x86_64 <span class="token number">1</span>:7.5-20.el7                                                               
  yajl.x86_64 <span class="token number">0</span>:2.0.4-4.el7                                                                             
  yum-utils.noarch <span class="token number">0</span>:1.1.31-34.el7                                                                      

Dependency Updated:
  cyrus-sasl-lib.x86_64 <span class="token number">0</span>:2.1.26-20.el7_2                 gnutls.x86_64 <span class="token number">0</span>:3.3.8-14.el7_2                

Complete<span class="token operator">!</span>
iptables: Saving firewall rules to /etc/sysconfig/iptables: <span class="token punctuation">[</span>  OK  <span class="token punctuation">]</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-nova-compute.service to /usr/lib/systemd/system/openstack-nova-compute.service.
</code></pre>
    <ul>
     <li>
      在controller节点执行脚本iaas-install-neutron-controller.sh进行neutron网络服务安装
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-neutron-controller.sh</span>
INFO  <span class="token punctuation">[</span>alembic.runtime.migration<span class="token punctuation">]</span> Running upgrade lbaasv2 -<span class="token operator">&gt;</span> 4deef6d81931, <span class="token function">add</span> provisioning and operating statuses
INFO  <span class="token punctuation">[</span>alembic.runtime.migration<span class="token punctuation">]</span> Running upgrade 4deef6d81931 -<span class="token operator">&gt;</span> 4b6d8d5310b8, add_index_tenant_id
INFO  <span class="token punctuation">[</span>alembic.runtime.migration<span class="token punctuation">]</span> Running upgrade 4b6d8d5310b8 -<span class="token operator">&gt;</span> 364f9b6064f0, agentv2
INFO  <span class="token punctuation">[</span>alembic.runtime.migration<span class="token punctuation">]</span> Running upgrade 364f9b6064f0 -<span class="token operator">&gt;</span> lbaasv2_tls, lbaasv2 TLS
INFO  <span class="token punctuation">[</span>alembic.runtime.migration<span class="token punctuation">]</span> Running upgrade lbaasv2_tls -<span class="token operator">&gt;</span> 4ba00375f715, edge_driver
INFO  <span class="token punctuation">[</span>alembic.runtime.migration<span class="token punctuation">]</span> Running upgrade 4ba00375f715 -<span class="token operator">&gt;</span> kilo, kilo
INFO  <span class="token punctuation">[</span>alembic.runtime.migration<span class="token punctuation">]</span> Running upgrade kilo -<span class="token operator">&gt;</span> 3345facd0452, Initial Liberty no-op <span class="token function">expand</span> script.
INFO  <span class="token punctuation">[</span>alembic.runtime.migration<span class="token punctuation">]</span> Running upgrade 3345facd0452 -<span class="token operator">&gt;</span> 4a408dd491c2, Addition of Name <span class="token function">column</span> to lbaas_members and lbaas_healthmonitors table
INFO  <span class="token punctuation">[</span>alembic.runtime.migration<span class="token punctuation">]</span> Running upgrade 4a408dd491c2 -<span class="token operator">&gt;</span> 3426acbc12de, Add flavor <span class="token function">id</span>
INFO  <span class="token punctuation">[</span>alembic.runtime.migration<span class="token punctuation">]</span> Running upgrade 3426acbc12de -<span class="token operator">&gt;</span> 6aee0434f911, independent pools
INFO  <span class="token punctuation">[</span>alembic.runtime.migration<span class="token punctuation">]</span> Running upgrade 6aee0434f911 -<span class="token operator">&gt;</span> 3543deab1547, add_l7_tables
INFO  <span class="token punctuation">[</span>alembic.runtime.migration<span class="token punctuation">]</span> Running upgrade 3543deab1547 -<span class="token operator">&gt;</span> 62deca5010cd, Add tenant-id index <span class="token keyword">for</span> L7 tables
INFO  <span class="token punctuation">[</span>alembic.runtime.migration<span class="token punctuation">]</span> Running upgrade kilo -<span class="token operator">&gt;</span> 130ebfdef43, Initial Liberty no-op contract revision.
  OK
Created symlink from /etc/systemd/system/multi-user.target.wants/openvswitch.service to /usr/lib/systemd/system/openvswitch.service.
Created symlink from /etc/systemd/system/multi-user.target.wants/neutron-server.service to /usr/lib/systemd/system/neutron-server.service.
Created symlink from /etc/systemd/system/multi-user.target.wants/neutron-openvswitch-agent.service to /usr/lib/systemd/system/neutron-openvswitch-agent.service.
Created symlink from /etc/systemd/system/multi-user.target.wants/neutron-dhcp-agent.service to /usr/lib/systemd/system/neutron-dhcp-agent.service.
Created symlink from /etc/systemd/system/multi-user.target.wants/neutron-metadata-agent.service to /usr/lib/systemd/system/neutron-metadata-agent.service.
Created symlink from /etc/systemd/system/multi-user.target.wants/neutron-l3-agent.service to /usr/lib/systemd/system/neutron-l3-agent.service.
</code></pre>
    <ul>
     <li>
      在compute节点执行脚本iaas-install-neutron-compute.sh进行neutron网络服务安装
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-neutron-compute.sh</span>
</code></pre>
    <p>
     Dependency Installed:
     <br/>
     conntrack-tools.x86_64 0:1.4.2-9.el7 dibbler-client.x86_64 0:1.0.1-0.RC1.2.el7
     <br/>
     dnsmasq-utils.x86_64 0:2.66-14.el7_2.1 ipset-libs.x86_64 0:6.19-4.el7
     <br/>
     keepalived.x86_64 0:1.2.13-7.el7 libnetfilter_cthelper.x86_64 0:1.0.0-8.el7
     <br/>
     libnetfilter_cttimeout.x86_64 0:1.0.0-6.el7 libnetfilter_queue.x86_64 0:1.0.2-2.el7
     <br/>
     libxml2-python.x86_64 0:2.9.1-6.el7_2.3 libxslt-python.x86_64 0:1.1.28-5.el7
     <br/>
     lm_sensors-libs.x86_64 0:3.3.4-11.el7 net-snmp-agent-libs.x86_64 1:5.7.2-24.el7_2.1
     <br/>
     net-snmp-libs.x86_64 1:5.7.2-24.el7_2.1 openstack-neutron-common.noarch 1:8.1.2-1.el7
     <br/>
     openvswitch.x86_64 0:2.5.0-2.el7 python-beautifulsoup4.noarch 0:4.4.1-3.el7
     <br/>
     python-designateclient.noarch 0:2.0.0-1.el7 python-html5lib.noarch 1:0.999-5.el7
     <br/>
     python-logutils.noarch 0:0.3.3-3.el7 python-ncclient.noarch 0:0.4.2-2.el7
     <br/>
     python-neutron.noarch 1:8.1.2-1.el7 python-neutron-lib.noarch 0:0.0.2-1.el7
     <br/>
     python-openvswitch.noarch 0:2.5.0-2.el7 python-ryu.noarch 0:3.30-1.el7
     <br/>
     python-simplegeneric.noarch 0:0.8-7.el7 python-waitress.noarch 0:0.8.9-5.el7
     <br/>
     python-webtest.noarch 0:2.0.23-1.el7 python2-pecan.noarch 0:1.0.2-2.el7
     <br/>
     python2-singledispatch.noarch 0:3.4.0.3-4.el7
    </p>
    <p>
     Dependency Updated:
     <br/>
     libxml2.x86_64 0:2.9.1-6.el7_2.3
    </p>
    <p>
     Complete!
     <br/>
     net.ipv4.ip_forward = 1
     <br/>
     net.ipv4.conf.default.rp_filter = 0
     <br/>
     net.ipv4.conf.all.rp_filter = 0
     <br/>
     Created symlink from /etc/systemd/system/multi-user.target.wants/openvswitch.service to /usr/lib/systemd/system/openvswitch.service.
     <br/>
     Created symlink from /etc/systemd/system/multi-user.target.wants/neutron-openvswitch-agent.service to /usr/lib/systemd/system/neutron-openvswitch-agent.service.
     <br/>
     Created symlink from /etc/systemd/system/multi-user.target.wants/neutron-metadata-agent.service to /usr/lib/systemd/system/neutron-metadata-agent.service.
    </p>
    <ul>
     <li>
      在controller节点执行脚本iaas-install-neutron-controller-gre.sh进行gre网络安装配置
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-neutron-controller-gre.sh</span>

INFO  <span class="token punctuation">[</span>alembic.runtime.migration<span class="token punctuation">]</span> Will assume non-transacti
</code></pre>
    <ul>
     <li>
      在compute节点执行脚本iaas-install-neutron-compute-gre.sh进行gre网络安装配置
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-neutron-compute-gre.sh</span>

</code></pre>
    <ul>
     <li>
      在controller节点执行脚本iaas-install-dashboard.sh进行dashboard服务安装
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-dashboard.sh</span>
 python-XStatic-jQuery.noarch <span class="token number">0</span>:1.10.2.1-1.el7                                                        
  python-XStatic-jquery-ui.noarch <span class="token number">0</span>:1.10.4.1-1.el7                                                     
  python-XStatic-smart-table.noarch <span class="token number">0</span>:1.4.5.3-5.el7.1                                                  
  python-XStatic-termjs.noarch <span class="token number">0</span>:0.0.4.2-2.el7                                                         
  python-ceilometerclient.noarch <span class="token number">0</span>:2.3.0-1.el7                                                         
  python-django.noarch <span class="token number">0</span>:1.8.14-1.el7                                                                  
  python-django-appconf.noarch <span class="token number">0</span>:1.0.1-4.el7                                                           
  python-django-bash-completion.noarch <span class="token number">0</span>:1.8.14-1.el7                                                  
  python-django-compressor.noarch <span class="token number">0</span>:2.0-1.el7                                                          
  python-django-horizon.noarch <span class="token number">1</span>:9.0.1-1.el7.centos                                                    
  python-django-openstack-auth.noarch <span class="token number">0</span>:2.2.0-1.el7                                                    
  python-django-pyscss.noarch <span class="token number">0</span>:2.0.2-1.el7                                                            
  python-heatclient.noarch <span class="token number">0</span>:1.0.0-1.el7                                                               
  python-lesscpy.noarch <span class="token number">0</span>:0.9j-4.el7                                                                   
  python-lockfile.noarch <span class="token number">1</span>:0.9.1-4.el7.centos                                                          
  python-pathlib.noarch <span class="token number">0</span>:1.0.1-1.el7                                                                  
  python-pint.noarch <span class="token number">0</span>:0.6-2.el7                                                                       
  python-saharaclient.noarch <span class="token number">0</span>:0.13.0-1.el7                                                            
  python-versiontools.noarch <span class="token number">0</span>:1.9.1-4.el7                                                             
  python2-XStatic-bootswatch.noarch <span class="token number">0</span>:3.3.5.3-2.el7                                                    
  python2-XStatic-mdi.noarch <span class="token number">0</span>:1.1.70.1-5.el7                                                          
  python2-XStatic-roboto-fontface.noarch <span class="token number">0</span>:0.4.3.2-8.el7                                               
  python2-rcssmin.x86_64 <span class="token number">0</span>:1.0.6-2.el7                                                                 
  python2-rjsmin.x86_64 <span class="token number">0</span>:1.0.12-2.el7                                                                 
  python2-scss.x86_64 <span class="token number">0</span>:1.3.4-6.el7                                                                    
  python2-troveclient.noarch <span class="token number">0</span>:2.1.2-2.el7                                                             
  roboto-fontface-common.noarch <span class="token number">0</span>:0.4.3.2-8.el7                                                        
  roboto-fontface-fonts.noarch <span class="token number">0</span>:0.4.3.2-8.el7                                                         
  web-assets-filesystem.noarch <span class="token number">0</span>:5-1.el7                                                               

Complete<span class="token operator">!</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre>
    <ul>
     <li>
      上述操作完成后，打开浏览器，打开网页 http://192.168.10.20/dashboard（根据自己实际情况，填写controller IP）进行验证服务，域、用户名和密码（域：demo 用户名：admin 密码：000000）。
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f1b6a32a3b5d85d686060320d860e2df.png">
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/985e94b44b7f64fac75eb206bd19c5cf.png"/>
      </img>
     </li>
    </ul>
    <h2>
     <a id="Swift_722">
     </a>
     安装Swift服务
    </h2>
    <ul>
     <li>
      在controller节点依次执行iaas-install-swift-controller.sh和compute节点iaas-install-swift-compute.sh脚本即可完成安装
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-swift-controller.sh</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-swift-compute.sh </span>
</code></pre>
    <p>
     <strong>
      注：compute节点安装时，需要输入controller密码（000000）
     </strong>
    </p>
    <ul>
     <li>
      controller节点查看一下Swift的状态
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># source /etc/keystone/admin-openrc.sh</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#  swift stat</span>
        Account: AUTH_81ea07237d034c4e99369581c1b4db89
     Containers: <span class="token number">0</span>
        Objects: <span class="token number">0</span>
          Bytes: <span class="token number">0</span>
X-Put-Timestamp: <span class="token number">1653716829.25598</span>
    X-Timestamp: <span class="token number">1653716829.25598</span>
     X-Trans-Id: txd872259f2fb24b0781102-006291b75c
   Content-Type: text/plain<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
</code></pre>
    <ul>
     <li>
      查看容器
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># swift list</span>
</code></pre>
    <ul>
     <li>
      创建容器（创建一个容器，名称为gw001，并查看）
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># swift post gw001</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># swift list</span>
gw001
</code></pre>
    <ul>
     <li>
      容器操作（上传一个文件到这个容器中，并查看）
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#  swift upload gw001 anaconda-ks.cfg </span>
anaconda-ks.cfg
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#  swift list gw001</span>
anaconda-ks.cfg
</code></pre>
    <ul>
     <li>
      删除这个文件后删除这个容器
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># swift delete gw001 anaconda-ks.cfg</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># swift list gw001</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># swift delete gw001</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># swift list</span>
</code></pre>
    <h2>
     <a id="Cinder_773">
     </a>
     配置Cinder块存储
    </h2>
    <ul>
     <li>
      在controller节点执行下列脚本，按顺序安装Cinder服务
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#  iaas-install-cinder-controller.sh</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment">#iaas-install-cinder-compute.sh</span>
</code></pre>
    <ul>
     <li>
      使用Cinder块存储
      <ul>
       <li>
        登录OpenStack
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f25e44bef3d3351423a49940b545e5df.png"/>
       </li>
       <li>
        修改安全规则（放行所有的协议规则）
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0d0840d666c9a4c48ded00c33ee0b74a.png"/>
       </li>
      </ul>
     </li>
     <li>
      创建网络
      <ul>
       <li>
        <p>
         单击界面左侧“管理员”列表下的“系统面板→网络”按钮，接着在界面右侧单击“创建网络”按钮
        </p>
       </li>
       <li>
        <p>
         首先创建一个网络（外网），在弹出的“创建网络”对话框中，“名称”文本框内输入“ext-net”，单击“项目”下的倒三角按钮▼，在打开的下拉菜单中选择“admin”选项，供应商选择 “GRE”，勾选“共享的”和“外部网络”2个选项，段ID文本框输入“1”，最后单击右下角“提交”按钮，完成创建
         <br/>
         <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/4d49dc56ae8a148ebb6623e5a1f2f472.png"/>
        </p>
       </li>
       <li>
        <p>
         进入ext-net网络详情页面，单击“子网”列表中“创建子网”按钮，进行创建子网。输入相关信息后，点击下一步按钮，进入子网详情界面，直接点击已创建按钮，此时子网创建成功。
         <br/>
         在这里插入图片描述
        </p>
       </li>
      </ul>
     </li>
     <li>
      创建内网网络
      <ul>
       <li>
        弹出的“创建网络”对话框中，“名称”文本框内输入“int-net”，单击“项目”下的倒三角按钮▼，在打开的下拉菜单中选择“admin”选项，最后单击右下角“提交”按钮，完成创建
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f6a4a5144feeca65956ad20e3b321828.png"/>
       </li>
      </ul>
     </li>
     <li>
      为内网创建子网
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/58fb1e26101a911540c6a62ead77deb6.png"/>
     </li>
     <li>
      创建路由
      <ul>
       <li>
        左侧“项目”列表下的“网络→路由”按钮，接着在界面右侧“路由”列表中单击“新建路由”按钮，进行路由的创建
        <br/>
        外部网络选择刚刚新建的外网ext-net
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e2361d30d488a45776c076370cfb2fba.png"/>
       </li>
      </ul>
     </li>
     <li>
      为路由添加新的接口，接口接到我们内网int-net
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e4e400dd8e630b2b741f4e5a827ff1ec.png"/>
     </li>
    </ul>
    <h2>
     <a id="_803">
     </a>
     上传镜像
    </h2>
    <ul>
     <li>
      回到controller节点，使用命令上传镜像
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># glance image-create --name centos --disk-format qcow2  --container-format bare  --progress &lt;  /xiandian/images/CentOS_7.2_x86_64_XD.qcow2 </span>
<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token number">100</span>%
+------------------+--------------------------------------+
<span class="token operator">|</span> Property         <span class="token operator">|</span> Value                                <span class="token operator">|</span>
+------------------+--------------------------------------+
<span class="token operator">|</span> checksum         <span class="token operator">|</span> ea197f4c679b8e1ce34c0aa70ae2a94a     <span class="token operator">|</span>
<span class="token operator">|</span> container_format <span class="token operator">|</span> bare                                 <span class="token operator">|</span>
<span class="token operator">|</span> created_at       <span class="token operator">|</span> <span class="token number">2022</span>-05-28T06:18:00Z                 <span class="token operator">|</span>
<span class="token operator">|</span> disk_format      <span class="token operator">|</span> qcow2                                <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>               <span class="token operator">|</span> 8a3c6a4e-e7a5-4e25-83c4-6e93bbf6c2f2 <span class="token operator">|</span>
<span class="token operator">|</span> min_disk         <span class="token operator">|</span> <span class="token number">0</span>                                    <span class="token operator">|</span>
<span class="token operator">|</span> min_ram          <span class="token operator">|</span> <span class="token number">0</span>                                    <span class="token operator">|</span>
<span class="token operator">|</span> name             <span class="token operator">|</span> centos                               <span class="token operator">|</span>
<span class="token operator">|</span> owner            <span class="token operator">|</span> 81ea07237d034c4e99369581c1b4db89     <span class="token operator">|</span>
<span class="token operator">|</span> protected        <span class="token operator">|</span> False                                <span class="token operator">|</span>
<span class="token operator">|</span> size             <span class="token operator">|</span> <span class="token number">400752640</span>                            <span class="token operator">|</span>
<span class="token operator">|</span> status           <span class="token operator">|</span> active                               <span class="token operator">|</span>
<span class="token operator">|</span> tags             <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                   <span class="token operator">|</span>
<span class="token operator">|</span> updated_at       <span class="token operator">|</span> <span class="token number">2022</span>-05-28T06:18:07Z                 <span class="token operator">|</span>
<span class="token operator">|</span> virtual_size     <span class="token operator">|</span> None                                 <span class="token operator">|</span>
<span class="token operator">|</span> visibility       <span class="token operator">|</span> private                              <span class="token operator">|</span>
+------------------+--------------------------------------+
</code></pre>
    <p>
     <strong>
      注：若执行上述代码报错，需要先运行代码： source /etc/keystone/admin-openrc.sh
     </strong>
    </p>
    <h2>
     <a id="_831">
     </a>
     创建云主机
    </h2>
    <ul>
     <li>
      点击 计算→云主机，开始创建云主机
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/80c78fdd14a0ab90bf5d3cf81eceb798.png"/>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/cab098c1cfcbd0aaf09159500ab178b7.png"/>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/740ac0ff7896f8a028300ea97a12fa12.png"/>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f3bec00a07901d22a0e0559bb1f7a06a.png"/>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f6cfe65cfe22e67c67f47cc254c43be1.png"/>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9d4a1d019ee5106296f1f2c40e725f5f.png"/>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/93d0d16eb7df772c4ba227f86bf74df0.png"/>
     </li>
     <li>
      绑定浮动ip
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/37b785fe058f4445c2b20380947af0ae.png"/>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ea810d1d6c4983979474b33a7be49582.png"/>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4227e8f8a64608e10552265b2ebce5e0.png"/>
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d7c24f9e37404b5b346611cdf68bd89c.png"/>
    </p>
    <ul>
     <li>
      然后通过WEB界面的终端方式进去云主机即可，验证登录OpenStack（密码：000000）
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/cbc353e9b89dccf95d48fa01f9d07d95.png"/>
     </li>
    </ul>
    <h2>
     <a id="_847">
     </a>
     云硬盘挂载使用
    </h2>
    <ul>
     <li>
      到controller节点，创建一个卷设备，名称为test 1，大小为2 G的卷。可以使用命令cinder list查看
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># source /etc/keystone/admin-openrc.sh</span>
You have mail <span class="token keyword">in</span> /var/spool/mail/root
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cinder create --display-name test1 2</span>
+--------------------------------+--------------------------------------+
<span class="token operator">|</span>            Property            <span class="token operator">|</span>                Value                 <span class="token operator">|</span>
+--------------------------------+--------------------------------------+
<span class="token operator">|</span>          attachments           <span class="token operator">|</span>                  <span class="token punctuation">[</span><span class="token punctuation">]</span>                  <span class="token operator">|</span>
<span class="token operator">|</span>       availability_zone        <span class="token operator">|</span>                 nova                 <span class="token operator">|</span>
<span class="token operator">|</span>            bootable            <span class="token operator">|</span>                <span class="token boolean">false</span>                 <span class="token operator">|</span>
<span class="token operator">|</span>      consistencygroup_id       <span class="token operator">|</span>                 None                 <span class="token operator">|</span>
<span class="token operator">|</span>           created_at           <span class="token operator">|</span>      <span class="token number">2022</span>-05-28T06:57:43.000000      <span class="token operator">|</span>
<span class="token operator">|</span>          description           <span class="token operator">|</span>                 None                 <span class="token operator">|</span>
<span class="token operator">|</span>           encrypted            <span class="token operator">|</span>                False                 <span class="token operator">|</span>
<span class="token operator">|</span>               <span class="token function">id</span>               <span class="token operator">|</span> 86c41fb6-cc12-4250-b79e-1474d5f64363 <span class="token operator">|</span>
<span class="token operator">|</span>            metadata            <span class="token operator">|</span>                  <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>                  <span class="token operator">|</span>
<span class="token operator">|</span>        migration_status        <span class="token operator">|</span>                 None                 <span class="token operator">|</span>
<span class="token operator">|</span>          multiattach           <span class="token operator">|</span>                False                 <span class="token operator">|</span>
<span class="token operator">|</span>              name              <span class="token operator">|</span>                test1                 <span class="token operator">|</span>
<span class="token operator">|</span>     os-vol-host-attr:host      <span class="token operator">|</span>                 None                 <span class="token operator">|</span>
<span class="token operator">|</span> os-vol-mig-status-attr:migstat <span class="token operator">|</span>                 None                 <span class="token operator">|</span>
<span class="token operator">|</span> os-vol-mig-status-attr:name_id <span class="token operator">|</span>                 None                 <span class="token operator">|</span>
<span class="token operator">|</span>  os-vol-tenant-attr:tenant_id  <span class="token operator">|</span>   81ea07237d034c4e99369581c1b4db89   <span class="token operator">|</span>
<span class="token operator">|</span>       replication_status       <span class="token operator">|</span>               disabled               <span class="token operator">|</span>
<span class="token operator">|</span>              size              <span class="token operator">|</span>                  <span class="token number">2</span>                   <span class="token operator">|</span>
<span class="token operator">|</span>          snapshot_id           <span class="token operator">|</span>                 None                 <span class="token operator">|</span>
<span class="token operator">|</span>          source_volid          <span class="token operator">|</span>                 None                 <span class="token operator">|</span>
<span class="token operator">|</span>             status             <span class="token operator">|</span>               creating               <span class="token operator">|</span>
<span class="token operator">|</span>           updated_at           <span class="token operator">|</span>                 None                 <span class="token operator">|</span>
<span class="token operator">|</span>            user_id             <span class="token operator">|</span>   2bee802355b24023968dc6e4bd11c983   <span class="token operator">|</span>
<span class="token operator">|</span>          volume_type           <span class="token operator">|</span>                 None                 <span class="token operator">|</span>
+--------------------------------+--------------------------------------+
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cinder list</span>
+--------------------------------------+-----------+-------+------+-------------+----------+-------------+
<span class="token operator">|</span>                  ID                  <span class="token operator">|</span>   Status  <span class="token operator">|</span>  Name <span class="token operator">|</span> Size <span class="token operator">|</span> Volume Type <span class="token operator">|</span> Bootable <span class="token operator">|</span> Attached to <span class="token operator">|</span>
+--------------------------------------+-----------+-------+------+-------------+----------+-------------+
<span class="token operator">|</span> 86c41fb6-cc12-4250-b79e-1474d5f64363 <span class="token operator">|</span> available <span class="token operator">|</span> test1 <span class="token operator">|</span>  <span class="token number">2</span>   <span class="token operator">|</span>      -      <span class="token operator">|</span>  <span class="token boolean">false</span>   <span class="token operator">|</span>             <span class="token operator">|</span>
+--------------------------------------+-----------+-------+------+-------------+----------+-------------+
</code></pre>
    <ul>
     <li>
      在OpenStack主页面中，单击界面左侧“项目”列表下的“计算-&gt;卷”
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d5f6d47113cb98c239e731a9504dc14f.png"/>
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/bcac37e15ad293f2dba76fdcad5d1e4c.png"/>
    </p>
    <ul>
     <li>
      在“卷”页面中可以看到“连接到”中有“在设备/dev/vdb上连接到test”的信息
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/78da1b71573c621c74fa7092de6ea117.png"/>
     </li>
    </ul>
    <h2>
     <a id="Keystone_895">
     </a>
     Keystone管理认证用户
    </h2>
    <h3>
     <a id="_896">
     </a>
     概述
    </h3>
    <p>
     在 OpenStack 框架中，Keystone（OpenStack Identity Service）的功能是负责
     <strong>
      验证身份、校验服务规则和发布服务令牌
     </strong>
     的，它实现了OpenStack的Identity API。Keystone可分解为两个功能，即
     <strong>
      权限管理和服务目录
     </strong>
     。
     <strong>
      权限管理主要用于用户的管理授权。服务目录，类似一个服务总线，或者说是整个OpenStack框架的注册表
     </strong>
     。认证模块提供API服务、token令牌机制、服务目录、规则和认证发布等功能。
    </p>
    <h3>
     <a id="_898">
     </a>
     实验目标
    </h3>
    <ul>
     <li>
      配置并启用认证服务。
     </li>
     <li>
      创建用户账号alice。
     </li>
     <li>
      创建项目acme，用于管理一组账户。
     </li>
     <li>
      创建角色compute-user，用于用户权限的管理。
     </li>
     <li>
      绑定用户和项目的权限。
     </li>
    </ul>
    <h3>
     <a id="_904">
     </a>
     实验环境
    </h3>
    <p>
     大数据实训平台、IaaS_Mitaka_ALLinone.qcow2。
    </p>
    <h4>
     <a id="_906">
     </a>
     实验准备
    </h4>
    <ol>
     <li>
      相关概念
      <br/>
      （1）认证（Authentication）。
      <br/>
      （2）证书（Credentials）。
      <br/>
      （3）令牌（Token）。
      <br/>
      （4）项目（project）。
      <br/>
      （5）用户（User）。
      <br/>
      （6）角色（Role）。
      <br/>
      使用云服务的用户不局限于人，也可以是系统或者服务。用户可以通过指定的令牌登 录系统并调用资源。用户可以被分配到特定项目并执行项目相关操作。
     </li>
     <li>
      认证服务流程
      <br/>
      用户请求云主机的流程涉及认证Keystone服务、计算Nova服务、镜像Glance服务，在服务流程中，令牌（Token）作为流程认证传递，具体服务申请认证机制流程，如图
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c7003118a390cb5fa2b76511c26c56d1.png"/>
     </li>
    </ol>
    <h3>
     <a id="_918">
     </a>
     实验步骤
    </h3>
    <ul>
     <li>
      配置Keystone应用环境
      <ul>
       <li>
        在安装Keystone服务之前需要指定用户名和密码，通过认证服务来进行身份认证，在开始阶段是没有创建任何的用户的，所以必须使用授权令牌和服务的访问接口来创建特定进行身份认证的用户，之后需要创建一个管理用户的环境变量（admin-openrc.sh）来管理最终的凭证和终端。
       </li>
       <li>
        在安装Keystone服务之后，产生的主配置文件存放在/etc/keystone 目录中，名为 keystone.conf，在配置文件中需要配置初始的Token值和数据库的连接地址。
       </li>
       <li>
        Keystone服务安装完毕，可以通过请求身份令牌来验证服务，具体命令如下，（以 admin 用户访问http://xiandian:35357/v3地址获取token值）
       </li>
      </ul>
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack --os-project-name admin --os-domain-name xiandian --os-username admin --os-password 000000 --os-auth-url http://localhost:35357/v3 token issue</span>
+------------+----------------------------------------------------------------------------------------------+
<span class="token operator">|</span> Field      <span class="token operator">|</span> Value                                                                                        <span class="token operator">|</span>
+------------+----------------------------------------------------------------------------------------------+
<span class="token operator">|</span> expires    <span class="token operator">|</span> <span class="token number">2022</span>-05-28T08:24:46.438626Z                                                                  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>         <span class="token operator">|</span> gAAAAABikc4-R-jrAhRef15-hrQxBUPw0zPMzi8WOs-ZhDazFYpPNE-                                      <span class="token operator">|</span>
<span class="token operator">|</span>            <span class="token operator">|</span> M2SVktdWfAuViYImyuHFYKwyFsGe5nxnAkcfnElQZYT3nFC-eRNJAH2JJZ496i0-TCGUv4R-F55vmSSVHYO3kLN1Mj-  <span class="token operator">|</span>
<span class="token operator">|</span>            <span class="token operator">|</span> cdhYjJbW-REAEY2BAUqJFckfzxT4yEe67Om1M                                                        <span class="token operator">|</span>
<span class="token operator">|</span> project_id <span class="token operator">|</span> 81ea07237d034c4e99369581c1b4db89                                                             <span class="token operator">|</span>
<span class="token operator">|</span> user_id    <span class="token operator">|</span> 2bee802355b24023968dc6e4bd11c983                                                             <span class="token operator">|</span>
+------------+----------------------------------------------------------------------------------------------+
</code></pre>
    <p>
     **注意：如执行错误，请等待2-3秒后重新执行该命令。 **
    </p>
    <ul>
     <li>
      管理用户验证
      <br/>
      OpenStack 的用户（user）包括云平台使用者、服务以及系统。用户通过认证登录系统并 调用资源。为方便管理，用户被分配到一个或多个项目（project），项目是用户的集合。为给用户分配不同的权限，Keystone设置了角色（Role），角色是代表用户可以访问的资源等权限。用户可以被添加到任意一个全局的或项目内的角色中。在全局的角色中，用户的角色权限作用于所有的用户，即可以对所有的用户执行角色规定的权限；项目内的角色，用户仅能在当前项目内执行角色规定的权限，下面介绍几种常见操作。
      <ul>
       <li>
        创建用户
        <br/>
        在openstack系统中进行操作需生效环境变量，执行命令如下。
       </li>
       <li>
        创建一个名称为“alice”账户，密码为“mypassword123”，邮箱为“alice@example.com”。执行命令如下。
       </li>
      </ul>
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack user create --password mypassword123 --email alice@example.com --domain demo alice</span>
+-----------+----------------------------------+
<span class="token operator">|</span> Field     <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-----------+----------------------------------+
<span class="token operator">|</span> domain_id <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> email     <span class="token operator">|</span> alice@example.com                <span class="token operator">|</span>
<span class="token operator">|</span> enabled   <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>        <span class="token operator">|</span> 682c3257d62748028d1a1e7cc7ac6efb <span class="token operator">|</span>
<span class="token operator">|</span> name      <span class="token operator">|</span> alice                            <span class="token operator">|</span>
+-----------+----------------------------------+
</code></pre>
    <ul>
     <li>
      创建项目
      <br/>
      一个项目就是一个项目、团队或组织，当请求OpenStack服务时，你必须定义一个项 目。例如，查询计算服务正在运行的云主机实例列表
      <br/>
      创建一个名为“acme”项目
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack project create --domain demo acme</span>
+-------------+----------------------------------+
<span class="token operator">|</span> Field       <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-------------+----------------------------------+
<span class="token operator">|</span> description <span class="token operator">|</span>                                  <span class="token operator">|</span>
<span class="token operator">|</span> domain_id   <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> enabled     <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>          <span class="token operator">|</span> 179cab81dcae4692afee5add4a6399a3 <span class="token operator">|</span>
<span class="token operator">|</span> is_domain   <span class="token operator">|</span> False                            <span class="token operator">|</span>
<span class="token operator">|</span> name        <span class="token operator">|</span> acme                             <span class="token operator">|</span>
<span class="token operator">|</span> parent_id   <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
+-------------+----------------------------------+
</code></pre>
    <ul>
     <li>
      创建角色
      <br/>
      角色限定了用户的操作权限。例如，创建一个角色“compute-user”，执行命令如下。
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack role create compute-user</span>
+-----------+----------------------------------+
<span class="token operator">|</span> Field     <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-----------+----------------------------------+
<span class="token operator">|</span> domain_id <span class="token operator">|</span> None                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>        <span class="token operator">|</span> c7c1a505197246d3a20678746acc04cd <span class="token operator">|</span>
<span class="token operator">|</span> name      <span class="token operator">|</span> compute-user                     <span class="token operator">|</span>
+-----------+----------------------------------+
</code></pre>
    <ul>
     <li>
      绑定用户和项目权限
      <br/>
      添加的用户需要分配一定的权限，这就需要把用户关联绑定到对应的项目和角色。例如，给用户“alice”分配“acme”项目下的“compute-user”角色，执行命令如下。
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack role add --user alice --project acme compute-user</span>
</code></pre>
    <h2>
     <a id="_994">
     </a>
     创建项目、用户并绑定用户权限
    </h2>
    <h3>
     <a id="_995">
     </a>
     概述
    </h3>
    <p>
     权限管理主要用于
     <strong>
      用户的管理授权
     </strong>
     。服务目录，
     <strong>
      类似一个服务总线，或者说是整个OpenStack框架的注册表
     </strong>
     。认证模块提供API服务、token令牌机制、服务目录、规则和认证发布等功能。
    </p>
    <h3>
     <a id="_997">
     </a>
     实验目标
    </h3>
    <ul>
     <li>
      公司有100名员工，其中50名为项目研发部（研发环境），45名为业务部（办公环境），5人IT工程部（运维环境）。
     </li>
     <li>
      根据企业人员部门分配，现构建3个项目，100个用户，管理人员拥有管理员权限，其余人员拥有普通用户权限，规划表见表
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/641a80df91dc874bf2af8f36a5aae06a.png"/>
     </li>
    </ul>
    <h3>
     <a id="_1001">
     </a>
     实验环境
    </h3>
    <p>
     大数据实训平台、IaaS_Mitaka_ALLinone.qcow2。
     <br/>
     【实验准备】
     <br/>
     OpenStack服务（service），如Nova、Glance、Swift、Heat、Ceilometer 等。
    </p>
    <ul>
     <li>
      Nova 提供 云计算服务
     </li>
     <li>
      Glance提供镜像管理服务
     </li>
     <li>
      Swift提供对象存储服务
     </li>
     <li>
      Heat 提供资源编排服务
     </li>
     <li>
      Ceilometer提供告警计费服务
     </li>
     <li>
      Cinder提供块存储服务
     </li>
     <li>
      为了方便用户调用这些服务，OpenStack为每一个服务提供一个用于访问的端点（endpoint）
     </li>
     <li>
      如果需要访问服务，则必须知道它的端点。端点一般为url，我们知道服务的url，就可以访问它。
     </li>
     <li>
      端点的url具有public、private和admin三种权限。
     </li>
     <li>
      public url可以被全局访问，private url只能被局域网访问，admin url被从常规的访问中分离出来。
     </li>
    </ul>
    <h3>
     <a id="_1015">
     </a>
     常用的服务管理命令
    </h3>
    <p>
     （1）创建服务
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># openstack service create</span>
</code></pre>
    <p>
     功能：创建服务。
     <br/>
     格式：
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># openstack service create --name &lt;name&gt; &lt;type&gt;</span>
<span class="token punctuation">[</span>--description <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span><span class="token punctuation">]</span>
</code></pre>
    <p>
     参数说明。
     <br/>
     –name 创建的服务名称。
     <br/>
     创建服务类型。
     <br/>
     –description 创建服务描述。
    </p>
    <p>
     （2）创建服务访问端点
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># openstack endpoint create</span>
</code></pre>
    <p>
     功能：创建服务访问的API端点。
     <br/>
     格式：
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># openstack endpoint create [--region &lt;region-id&gt;] </span>
<span class="token operator">&lt;</span>service<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>interface<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>--enable <span class="token operator">|</span> --disable<span class="token punctuation">]</span>
</code></pre>
    <p>
     参数说明。
     <br/>
     –region 创建端点的区域 id。
     <br/>
     端点创建的使用服务名称。
    </p>
    <p>
     （3）查询服务目录
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># source /etc/keystone/admin-openrc.sh </span>

<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack catalog list</span>
+----------+--------------+-----------------------------------------------------------------------------+
<span class="token operator">|</span> Name     <span class="token operator">|</span> Type         <span class="token operator">|</span> Endpoints                                                                   <span class="token operator">|</span>
+----------+--------------+-----------------------------------------------------------------------------+
<span class="token operator">|</span> swift    <span class="token operator">|</span> object-store <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   internal: http://controller:8080/v1/AUTH_81ea07237d034c4e99369581c1b4db89 <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   admin: http://controller:8080/v1                                          <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   public: http://controller:8080/v1/AUTH_81ea07237d034c4e99369581c1b4db89   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>                                                                             <span class="token operator">|</span>
<span class="token operator">|</span> glance   <span class="token operator">|</span> image        <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   internal: http://controller:9292                                          <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   admin: http://controller:9292                                             <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   public: http://controller:9292                                            <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>                                                                             <span class="token operator">|</span>
<span class="token operator">|</span> cinder   <span class="token operator">|</span> volume       <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   internal: http://controller:8776/v1/81ea07237d034c4e99369581c1b4db89      <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   admin: http://controller:8776/v1/81ea07237d034c4e99369581c1b4db89         <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   public: http://controller:8776/v1/81ea07237d034c4e99369581c1b4db89        <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>                                                                             <span class="token operator">|</span>
<span class="token operator">|</span> nova     <span class="token operator">|</span> compute      <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   admin: http://controller:8774/v2.1/81ea07237d034c4e99369581c1b4db89       <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   internal: http://controller:8774/v2.1/81ea07237d034c4e99369581c1b4db89    <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   public: http://controller:8774/v2.1/81ea07237d034c4e99369581c1b4db89      <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>                                                                             <span class="token operator">|</span>
<span class="token operator">|</span> cinderv2 <span class="token operator">|</span> volumev2     <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   public: http://controller:8776/v2/81ea07237d034c4e99369581c1b4db89        <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   admin: http://controller:8776/v2/81ea07237d034c4e99369581c1b4db89         <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   internal: http://controller:8776/v2/81ea07237d034c4e99369581c1b4db89      <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>                                                                             <span class="token operator">|</span>
<span class="token operator">|</span> keystone <span class="token operator">|</span> identity     <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   internal: http://controller:5000/v3                                       <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   admin: http://controller:35357/v3                                         <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   public: http://controller:5000/v3                                         <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>                                                                             <span class="token operator">|</span>
<span class="token operator">|</span> neutron  <span class="token operator">|</span> network      <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   public: http://controller:9696                                            <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   admin: http://controller:9696                                             <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span> RegionOne                                                                   <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>   internal: http://controller:9696                                          <span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token operator">|</span>              <span class="token operator">|</span>                                                                             <span class="token operator">|</span>
+----------+--------------+-----------------------------------------------------------------------------+
</code></pre>
    <p>
     Service Catalog（服务目录）是Keystone为OpenStack提供的
     <strong>
      一个REST API 端点列表
     </strong>
     ，并以此作为决策参考。显示某个service信息，命令格式如下：
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># openstack catalog show &lt;service&gt; </span>
</code></pre>
    <p>
     参数是指显示某个service。
    </p>
    <h3>
     <a id="_1121">
     </a>
     实验步骤
    </h3>
    <ol>
     <li>
      创建项目
      <br/>
      创建项目研发部（research and development department）名为RD_Dept的项目、业务部（business department）名为BS_Dept的项目、IT 工程部（engineering department）名为IT_Dept的项目。
      <br/>
      在openstack系统中进行操作需生效环境变量，执行命令如下：
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># source /etc/keystone/admin-openrc.sh</span>
</code></pre>
    <ul>
     <li>
      创建一个名为BS_Dept的项目，执行命令如下：
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># source /etc/keystone/admin-openrc.sh</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack project create "BS_Dept" --domain demo --description 业务部门</span>
+-------------+----------------------------------+
<span class="token operator">|</span> Field       <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-------------+----------------------------------+
<span class="token operator">|</span> description <span class="token operator">|</span> 业务部门                         <span class="token operator">|</span>
<span class="token operator">|</span> domain_id   <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> enabled     <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>          <span class="token operator">|</span> a7576f6ab86740cab6c7e3130ccecd82 <span class="token operator">|</span>
<span class="token operator">|</span> is_domain   <span class="token operator">|</span> False                            <span class="token operator">|</span>
<span class="token operator">|</span> name        <span class="token operator">|</span> BS_Dept                          <span class="token operator">|</span>
<span class="token operator">|</span> parent_id   <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
+-------------+----------------------------------+
</code></pre>
    <ul>
     <li>
      获取BS_Dept项目详细信息，执行命令如下：
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack project show BS_Dept</span>
+-------------+----------------------------------+
<span class="token operator">|</span> Field       <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-------------+----------------------------------+
<span class="token operator">|</span> description <span class="token operator">|</span> 业务部门                         <span class="token operator">|</span>
<span class="token operator">|</span> domain_id   <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> enabled     <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>          <span class="token operator">|</span> a7576f6ab86740cab6c7e3130ccecd82 <span class="token operator">|</span>
<span class="token operator">|</span> is_domain   <span class="token operator">|</span> False                            <span class="token operator">|</span>
<span class="token operator">|</span> name        <span class="token operator">|</span> BS_Dept                          <span class="token operator">|</span>
<span class="token operator">|</span> parent_id   <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
+-------------+----------------------------------+
</code></pre>
    <ul>
     <li>
      通过脚本为工程部创建一个名为IT_Dept的项目。
     </li>
     <li>
      编写Keystone-manage-project.sh脚本，执行命令如下：
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vi Keystone-manage-project.sh</span>
<span class="token comment">#!/bin/bash</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span>  -f <span class="token string">"/etc/keystone/admin-openrc.sh"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
        <span class="token builtin class-name">source</span> /etc/keystone/admin-openrc.sh
<span class="token keyword">else</span>
        <span class="token assign-left variable">env_path</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">find</span> / -name admin-openrc.sh<span class="token variable">`</span></span>
        <span class="token builtin class-name">source</span> <span class="token variable">$env_path</span>
<span class="token keyword">fi</span>
    <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mPlease Input new Project name : eg (openstack)<span class="token entity" title="\033">\033</span>[0m "</span>
        <span class="token builtin class-name">read</span> New_Project_Name
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -n <span class="token string">"<span class="token variable">$New_Project_Name</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
            <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mProject Name Is Empty,Exit<span class="token entity" title="\033">\033</span>[0m "</span>
            <span class="token builtin class-name">exit</span> <span class="token number">1</span>
        <span class="token keyword">fi</span>
    <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mPlease Input Project description : eg (openstack description)<span class="token entity" title="\033">\033</span>[0m "</span>
        <span class="token builtin class-name">read</span> New_Project_des
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -n <span class="token string">"<span class="token variable">$New_Project_des</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
             <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mProject  Description  Is Empty,Exit<span class="token entity" title="\033">\033</span>[0m "</span>
             <span class="token builtin class-name">exit</span> <span class="token number">1</span>
        <span class="token keyword">fi</span>
        <span class="token assign-left variable">T_Start</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $New_Project_Range <span class="token operator">|</span><span class="token function">awk</span> -F- <span class="token string">'{ print $1}'</span><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $0+0}'</span><span class="token variable">`</span></span>
        <span class="token assign-left variable">N_Start</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">printf</span> <span class="token string">"%03d<span class="token entity" title="\n">\n</span>"</span> $T_Start<span class="token variable">`</span></span>
        <span class="token assign-left variable">T_End</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $New_Project_Range <span class="token operator">|</span><span class="token function">awk</span> -F- <span class="token string">'{ print $2}'</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $0+0}'</span><span class="token variable">`</span></span>
        <span class="token assign-left variable">N_End</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">printf</span> <span class="token string">"%03d<span class="token entity" title="\n">\n</span>"</span> $T_End<span class="token variable">`</span></span>
        <span class="token assign-left variable">T_End1</span><span class="token operator">=</span>$<span class="token punctuation">[</span><span class="token variable">$T_End</span>+1<span class="token punctuation">]</span>
               openstack project create --domain <span class="token variable">$OS_PROJECT_DOMAIN_NAME</span> --description <span class="token string">"Service Project"</span> <span class="token variable">$New_Project_Name</span>
               <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mKeystone All Project List<span class="token entity" title="\033">\033</span>[0m "</span>
               openstack project list 


~
<span class="token string">"Keystone-manage-project.sh"</span> <span class="token punctuation">[</span>New<span class="token punctuation">]</span> 27L, 1211C written
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># chmod +x Keystone-manage-project.sh</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ./Keystone-manage-project.sh</span>
Please Input new Project name <span class="token builtin class-name">:</span> eg <span class="token punctuation">(</span>openstack<span class="token punctuation">)</span> 
IT_DEpt^H^H^HePt^H^H^C
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ./Keystone-manage-project.sh</span>
Please Input new Project name <span class="token builtin class-name">:</span> eg <span class="token punctuation">(</span>openstack<span class="token punctuation">)</span> 
IT_Dept
Please Input Project description <span class="token builtin class-name">:</span> eg <span class="token punctuation">(</span>openstack description<span class="token punctuation">)</span> 
IT工程部门
+-------------+----------------------------------+
<span class="token operator">|</span> Field       <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-------------+----------------------------------+
<span class="token operator">|</span> description <span class="token operator">|</span> Service Project                  <span class="token operator">|</span>
<span class="token operator">|</span> domain_id   <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> enabled     <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>          <span class="token operator">|</span> d9a68590f02344e48664db501542cec2 <span class="token operator">|</span>
<span class="token operator">|</span> is_domain   <span class="token operator">|</span> False                            <span class="token operator">|</span>
<span class="token operator">|</span> name        <span class="token operator">|</span> IT_Dept                          <span class="token operator">|</span>
<span class="token operator">|</span> parent_id   <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
+-------------+----------------------------------+
Keystone All Project List 
+----------------------------------+---------+
<span class="token operator">|</span> ID                               <span class="token operator">|</span> Name    <span class="token operator">|</span>
+----------------------------------+---------+
<span class="token operator">|</span> 09ecb096e1034e5b9e5166adfc15a6f0 <span class="token operator">|</span> <span class="token function">service</span> <span class="token operator">|</span>
<span class="token operator">|</span> 179cab81dcae4692afee5add4a6399a3 <span class="token operator">|</span> acme    <span class="token operator">|</span>
<span class="token operator">|</span> 5e04233827f848228c4a5a238c1e780b <span class="token operator">|</span> demo    <span class="token operator">|</span>
<span class="token operator">|</span> 81ea07237d034c4e99369581c1b4db89 <span class="token operator">|</span> admin   <span class="token operator">|</span>
<span class="token operator">|</span> a7576f6ab86740cab6c7e3130ccecd82 <span class="token operator">|</span> BS_Dept <span class="token operator">|</span>
<span class="token operator">|</span> d9a68590f02344e48664db501542cec2 <span class="token operator">|</span> IT_Dept <span class="token operator">|</span>
+----------------------------------+---------+
</code></pre>
    <ol start="2">
     <li>
      创建用户账号
     </li>
    </ol>
    <ul>
     <li>
      为项目研发部创建50个用户，分别名为rduser001～rduser050，密码为 cloudpasswd
     </li>
     <li>
      为业务部创建45个用户，分别名为bsuser001～bsuser045，密码为 cloudpasswd
     </li>
     <li>
      为IT工程部创建5个用户，分别名为ituser001～ituser005，密码为cloudpasswd。
     </li>
    </ul>
    <p>
     创建用户rduser002，密码为cloudpasswd，执行命令如下：
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack user create rduser002 --password cloudpasswd --domain demo --email rduser002@example.com</span>
+-----------+----------------------------------+
<span class="token operator">|</span> Field     <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-----------+----------------------------------+
<span class="token operator">|</span> domain_id <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> email     <span class="token operator">|</span> rduser002@example.com            <span class="token operator">|</span>
<span class="token operator">|</span> enabled   <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>        <span class="token operator">|</span> 41cb35e9b08c4846a88e0277547a6fbd <span class="token operator">|</span>
<span class="token operator">|</span> name      <span class="token operator">|</span> rduser002                        <span class="token operator">|</span>
+-----------+----------------------------------+
</code></pre>
    <ul>
     <li>
      通过执Shell脚本Keystone-manage-user.sh为项目研发部创建用户 rduser003～rduser050，密码为cloudpasswd。
     </li>
     <li>
      编写Keystone-manage-user.sh脚本，执行命令如下：
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vi  Keystone-manage-user.sh</span>
<span class="token comment">#!/bin/bash</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span>  -f <span class="token string">"/etc/keystone/admin-openrc.sh"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
        <span class="token builtin class-name">source</span> /etc/keystone/admin-openrc.sh
<span class="token keyword">else</span>
        <span class="token assign-left variable">env_path</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">find</span> / -name admin-openrc.sh<span class="token variable">`</span></span>
        <span class="token builtin class-name">source</span> <span class="token variable">$env_path</span>
<span class="token keyword">fi</span>
        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mPlease Input New User Name : eg (username)<span class="token entity" title="\033">\033</span>[0m "</span>
        <span class="token builtin class-name">read</span> New_User_Name
                <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -n <span class="token string">"<span class="token variable">$New_User_Name</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                         <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mUser Name Is Empty,Exit<span class="token entity" title="\033">\033</span>[0m "</span>
                         <span class="token builtin class-name">exit</span> <span class="token number">1</span>
                <span class="token keyword">fi</span>
        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mPlease Input User Password: eg (000000)<span class="token entity" title="\033">\033</span>[0m "</span>
        <span class="token builtin class-name">read</span> New_User_Pw
                <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -n <span class="token string">"<span class="token variable">$New_User_Pw</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                 <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mPasswd Is Empty,Exit<span class="token entity" title="\033">\033</span>[0m "</span>
                 <span class="token builtin class-name">exit</span> <span class="token number">1</span>
           <span class="token keyword">fi</span>
        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mPlease Input User Email Address,If don't need  press enter: eg (openstack.com)<span class="token entity" title="\033">\033</span>[0m "</span>
        <span class="token builtin class-name">read</span> New_User_Email
                <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -n <span class="token string">"<span class="token variable">$New_User_Email</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                 <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mEmail Address Is Empty,Exit<span class="token entity" title="\033">\033</span>[0m "</span>
                 <span class="token builtin class-name">exit</span> <span class="token number">1</span>
           <span class="token keyword">fi</span>
    <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mPlease Input User   Beginning And End  Number: eg (001-002)<span class="token entity" title="\033">\033</span>[0m "</span>
        <span class="token builtin class-name">read</span> New_User_Range
            <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -n <span class="token string">"<span class="token variable">$New_User_Range</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                    <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mNumber Is Empty,Exit<span class="token entity" title="\033">\033</span>[0m "</span>
                    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
                <span class="token keyword">else</span>
                    <span class="token assign-left variable">U_Start</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $New_User_Range <span class="token operator">|</span><span class="token function">awk</span> -F- <span class="token string">'{ print $1}'</span><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $0+0}'</span><span class="token variable">`</span></span>
                    <span class="token assign-left variable">N_U_Start</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">printf</span> <span class="token string">"%03d<span class="token entity" title="\n">\n</span>"</span> $U_Start<span class="token variable">`</span></span>
                    <span class="token assign-left variable">U_End</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $New_User_Range <span class="token operator">|</span><span class="token function">awk</span> -F- <span class="token string">'{ print $2}'</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $0+0}'</span><span class="token variable">`</span></span>
                    <span class="token assign-left variable">N_U_End</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">printf</span> <span class="token string">"%03d<span class="token entity" title="\n">\n</span>"</span> $U_End<span class="token variable">`</span></span>
                    <span class="token assign-left variable">U_End1</span><span class="token operator">=</span>$<span class="token punctuation">[</span><span class="token variable">$U_End</span>+1<span class="token punctuation">]</span>
                    <span class="token assign-left variable">IF_username_exists</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>openstack user list <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'1,3d'</span><span class="token operator">|</span><span class="token function">sed</span> <span class="token string">'$d'</span><span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print $4}'</span><span class="token variable">`</span></span>
                        <span class="token keyword">for</span> <span class="token for-or-select variable">username_exists</span> <span class="token keyword">in</span> <span class="token variable">$IF_username_exists</span><span class="token punctuation">;</span><span class="token keyword">do</span>
                            <span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span> username_number <span class="token operator">=</span> $U_Start<span class="token punctuation">;</span>username_number <span class="token operator">&lt;</span> $U_End1<span class="token punctuation">;</span>username_number<span class="token operator">++</span> <span class="token punctuation">))</span></span><span class="token punctuation">;</span><span class="token keyword">do</span>
                                <span class="token assign-left variable">real_username_number</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">printf</span> <span class="token string">"%03d<span class="token entity" title="\n">\n</span>"</span> $username_number<span class="token variable">`</span></span>
                                    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$New_User_Name</span><span class="token variable">$real_username_number</span> <span class="token operator">==</span> <span class="token variable">$username_exists</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                                        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mUser <span class="token variable">$New_User_Name</span><span class="token variable">$real_username_number</span> is exists<span class="token entity" title="\033">\033</span>[0m "</span>
                                        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
                                    <span class="token keyword">fi</span>
                            <span class="token keyword">done</span>
                        <span class="token keyword">done</span>
            <span class="token keyword">fi</span>
        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mPlease enter the User belong Roles Name, Press enter for '_member_' role by default: eg (admin)<span class="token entity" title="\033">\033</span>[0m "</span>
        <span class="token builtin class-name">read</span> New_User_Role
            <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -n <span class="token string">"<span class="token variable">$New_User_Role</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                    <span class="token assign-left variable">New_User_Role</span><span class="token operator">=</span>_member_
           <span class="token keyword">else</span>
                    <span class="token assign-left variable">IF_Role_Exists</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>openstack role list <span class="token operator">|</span><span class="token function">sed</span> <span class="token string">'1,3d'</span> <span class="token operator">|</span><span class="token function">sed</span> <span class="token string">'$d'</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print $4}'</span><span class="token variable">`</span></span>
                   <span class="token keyword">if</span>  <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${IF_Role_Exists<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> -w <span class="token string">"<span class="token variable">$New_User_Role</span>"</span> <span class="token operator">&gt;&gt;</span> /dev/null <span class="token punctuation">;</span> <span class="token keyword">then</span>
                           <span class="token builtin class-name">echo</span> <span class="token string">"exists"</span> <span class="token operator">&gt;&gt;</span> /dev/null
                   <span class="token keyword">else</span>
                          <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mRole <span class="token variable">$New_User_Role</span> not exists<span class="token entity" title="\033">\033</span>[0m "</span>
                          <span class="token builtin class-name">exit</span> <span class="token number">1</span>
                  <span class="token keyword">fi</span>
          <span class="token keyword">fi</span>

    <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mPlease Input User belong Project Name: eg (projectname)<span class="token entity" title="\033">\033</span>[0m "</span>
        <span class="token builtin class-name">read</span> New_User_Tenant
                <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -n <span class="token string">"<span class="token variable">$New_User_Tenant</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                         <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mProject Name Is Empty,Exit<span class="token entity" title="\033">\033</span>[0m "</span>
                         <span class="token builtin class-name">exit</span> <span class="token number">1</span>
            <span class="token keyword">else</span>
                    <span class="token assign-left variable">IF_Tenant_Exists</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>openstack project list <span class="token operator">|</span><span class="token function">sed</span> <span class="token string">'1,3d'</span> <span class="token operator">|</span><span class="token function">sed</span> <span class="token string">'$d'</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print $4}'</span><span class="token variable">`</span></span>
                   <span class="token keyword">if</span>  <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${IF_Tenant_Exists<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> -w <span class="token string">"<span class="token variable">$New_User_Tenant</span>"</span> <span class="token operator">&gt;&gt;</span> /dev/null <span class="token punctuation">;</span> <span class="token keyword">then</span>
                           <span class="token builtin class-name">echo</span> <span class="token string">"exists"</span> <span class="token operator">&gt;&gt;</span> /dev/null
                   <span class="token keyword">else</span>
                          <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mProject <span class="token variable">$New_User_Tenant</span> not exists<span class="token entity" title="\033">\033</span>[0m "</span>
                          <span class="token builtin class-name">exit</span> <span class="token number">1</span>
                  <span class="token keyword">fi</span>
             <span class="token keyword">fi</span>
                            <span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span> username_number <span class="token operator">=</span> $U_Start<span class="token punctuation">;</span>username_number<span class="token operator">&lt;</span> $U_End1<span class="token punctuation">;</span>username_number<span class="token operator">++</span> <span class="token punctuation">))</span></span><span class="token punctuation">;</span><span class="token keyword">do</span>
                                <span class="token assign-left variable">real_username_number</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">printf</span> <span class="token string">"%03d<span class="token entity" title="\n">\n</span>"</span> $username_number<span class="token variable">`</span></span>
                                openstack user create --domain <span class="token variable">$OS_PROJECT_DOMAIN_NAME</span> --password <span class="token variable">$New_User_Pw</span> <span class="token variable">$New_User_Name</span><span class="token variable">$real_username_number</span> --email <span class="token variable">$New_User_Name</span><span class="token variable">$real_username_number</span>@<span class="token variable">$New_User_Email</span>
                                openstack role <span class="token function">add</span> --project <span class="token variable">$New_User_Tenant</span> --user <span class="token variable">$New_User_Name</span><span class="token variable">$real_username_number</span> <span class="token variable">$New_User_Role</span>
                            <span class="token keyword">done</span>
                                <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mKeystone All User List<span class="token entity" title="\033">\033</span>[0m "</span>
                                openstack user list
<span class="token string">"Keystone-manage-user.sh"</span> <span class="token punctuation">[</span>New<span class="token punctuation">]</span> 82L, 4518C written
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># chmod +x Keystone-manage-user.sh</span>

</code></pre>
    <ul>
     <li>
      创建研发部门项目，执行命令如下：
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#  openstack project create "RD_Dept" --domain demo  --description 研发部门</span>
+-------------+----------------------------------+
<span class="token operator">|</span> Field       <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-------------+----------------------------------+
<span class="token operator">|</span> description <span class="token operator">|</span> 研发部门                         <span class="token operator">|</span>
<span class="token operator">|</span> domain_id   <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> enabled     <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>          <span class="token operator">|</span> 93ae746f87744d6d9a2056ca08f602c8 <span class="token operator">|</span>
<span class="token operator">|</span> is_domain   <span class="token operator">|</span> False                            <span class="token operator">|</span>
<span class="token operator">|</span> name        <span class="token operator">|</span> RD_Dept                          <span class="token operator">|</span>
<span class="token operator">|</span> parent_id   <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
+-------------+----------------------------------+
</code></pre>
    <ul>
     <li>
      执行该脚本。命令行内按提示输入用户名称、用户密码、电子邮件域名地址、用户角色（这里只能赋予一个角色）和用户所属部门。
     </li>
    </ul>
    <pre><code class="prism language-bash">+-------------+----------------------------------+
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ./Keystone-manage-user.sh </span>
Please Input New User Name <span class="token builtin class-name">:</span> eg <span class="token punctuation">(</span>username<span class="token punctuation">)</span> 
rduser
Please Input User Password: eg <span class="token punctuation">(</span>000000<span class="token punctuation">)</span> 
cloudpasswd
Please Input User Email Address,If don<span class="token string">'t need  press enter: eg (openstack.com) 
example.com
Please Input User   Beginning And End  Number: eg (001-002) 
003-050
Please enter the User belong Roles Name, Press enter for '</span>_member_' role by default: eg <span class="token punctuation">(</span>admin<span class="token punctuation">)</span> 
admin
Please Input User belong Project Name: eg <span class="token punctuation">(</span>projectname<span class="token punctuation">)</span> 
RD_Dept
+-----------+----------------------------------+
<span class="token operator">|</span> Field     <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-----------+----------------------------------+
<span class="token operator">|</span> domain_id <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> email     <span class="token operator">|</span> rduser003@example.com            <span class="token operator">|</span>
<span class="token operator">|</span> enabled   <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>        <span class="token operator">|</span> ea6bd13fff4344019ee57bbc838b25c9 <span class="token operator">|</span>
<span class="token operator">|</span> name      <span class="token operator">|</span> rduser003                        <span class="token operator">|</span>
+-----------+----------------------------------+
+-----------+----------------------------------+
<span class="token operator">|</span> Field     <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-----------+----------------------------------+
<span class="token operator">|</span> domain_id <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> email     <span class="token operator">|</span> rduser004@example.com            <span class="token operator">|</span>
<span class="token operator">|</span> enabled   <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>        <span class="token operator">|</span> e4a66855bc3042cab24588d155c98826 <span class="token operator">|</span>
<span class="token operator">|</span> name      <span class="token operator">|</span> rduser004                        <span class="token operator">|</span>
+-----------+----------------------------------+
Keystone All User List 
+----------------------------------+-----------+
<span class="token operator">|</span> ID                               <span class="token operator">|</span> Name      <span class="token operator">|</span>
+----------------------------------+-----------+
<span class="token operator">|</span> 02a018e6ac3441f2835c817c7a1a207b <span class="token operator">|</span> rduser005 <span class="token operator">|</span>
<span class="token operator">|</span> 03ba69a427474fbaac7599c942f37330 <span class="token operator">|</span> rduser039 <span class="token operator">|</span>
<span class="token operator">|</span> 0499bbd56f72407eaca9f676c3a4bcfc <span class="token operator">|</span> rduser017 <span class="token operator">|</span>
<span class="token operator">|</span> 065a379909d34891add243f46d060e9b <span class="token operator">|</span> rduser043 <span class="token operator">|</span>
<span class="token operator">|</span> 0b744fa5759d43b5ade55586e0eb0af1 <span class="token operator">|</span> rduser007 <span class="token operator">|</span>
<span class="token operator">|</span> 13e0d9dcd4564b7fafaf909b8216262d <span class="token operator">|</span> rduser034 <span class="token operator">|</span>
<span class="token operator">|</span> 26c7ddc343fa4c91a1f682d21be1da7d <span class="token operator">|</span> rduser049 <span class="token operator">|</span>
<span class="token operator">|</span> 2bee802355b24023968dc6e4bd11c983 <span class="token operator">|</span> admin     <span class="token operator">|</span>
<span class="token operator">|</span> 2c4c0a61075a440d8f9783edd86844c6 <span class="token operator">|</span> rduser040 <span class="token operator">|</span>
<span class="token operator">|</span> 2dd5669948a3409aa3296a3057cb0b3a <span class="token operator">|</span> rduser023 <span class="token operator">|</span>
<span class="token operator">|</span> 375024d3247540e5b9048671fe577068 <span class="token operator">|</span> rduser046 <span class="token operator">|</span>
<span class="token operator">|</span> 3a86600a0e5e47d4a6c67a8f5a9f701e <span class="token operator">|</span> rduser021 <span class="token operator">|</span>
<span class="token operator">|</span> 3c70e43caefd4623b7e8a2fbd7e52fd2 <span class="token operator">|</span> rduser035 <span class="token operator">|</span>
<span class="token operator">|</span> 41cb35e9b08c4846a88e0277547a6fbd <span class="token operator">|</span> rduser002 <span class="token operator">|</span>
<span class="token operator">|</span> 4c9e1c3650da4b8a951ca08c0f6f2b3a <span class="token operator">|</span> rduser026 <span class="token operator">|</span>
<span class="token operator">|</span> 520f96d6d8d44ddbbeb5df6573f11da7 <span class="token operator">|</span> rduser006 <span class="token operator">|</span>
<span class="token operator">|</span> 563366420dc44ea89661bc2a8fe33f0b <span class="token operator">|</span> rduser029 <span class="token operator">|</span>
<span class="token operator">|</span> 56e7081689b044cbbb4a1a66ef2132e7 <span class="token operator">|</span> rduser014 <span class="token operator">|</span>
<span class="token operator">|</span> 6099f2288ef34dc5b4d541a3cf85f849 <span class="token operator">|</span> rduser042 <span class="token operator">|</span>
<span class="token operator">|</span> 682c3257d62748028d1a1e7cc7ac6efb <span class="token operator">|</span> alice     <span class="token operator">|</span>
<span class="token operator">|</span> 6d65072d602742cb9adff407a3ad1c94 <span class="token operator">|</span> rduser045 <span class="token operator">|</span>
<span class="token operator">|</span> 70c4160866284154b56bf203171cfd90 <span class="token operator">|</span> neutron   <span class="token operator">|</span>
<span class="token operator">|</span> 717f15d187f14fbca1f36a911e1162a8 <span class="token operator">|</span> rduser019 <span class="token operator">|</span>
<span class="token operator">|</span> 75b1a57e0bf54f1c9d6a5e3a220d3247 <span class="token operator">|</span> rduser027 <span class="token operator">|</span>
<span class="token operator">|</span> 818fbea675314d33a542ee58178c5424 <span class="token operator">|</span> rduser016 <span class="token operator">|</span>
<span class="token operator">|</span> 82b97aaa126b4732b12e5af608f9c07c <span class="token operator">|</span> rduser018 <span class="token operator">|</span>
<span class="token operator">|</span> 84f21a5bbd3846668d21c47a4077ec50 <span class="token operator">|</span> rduser024 <span class="token operator">|</span>
<span class="token operator">|</span> 886b421475b045718fd17a090e7c8226 <span class="token operator">|</span> rduser032 <span class="token operator">|</span>
<span class="token operator">|</span> 8aebf5350d1947f3bac7de41be461219 <span class="token operator">|</span> nova      <span class="token operator">|</span>
<span class="token operator">|</span> 8aefa1e8548f49a2b3abb3884dca2d1a <span class="token operator">|</span> rduser050 <span class="token operator">|</span>
<span class="token operator">|</span> 8e3671518d6b423dbfbf55ffa8249df8 <span class="token operator">|</span> rduser033 <span class="token operator">|</span>
<span class="token operator">|</span> 8e695b3ca86c4a4da7968baeef3c6864 <span class="token operator">|</span> swift     <span class="token operator">|</span>
<span class="token operator">|</span> 95ef2ac87c874250abb3302351c7b63a <span class="token operator">|</span> rduser041 <span class="token operator">|</span>
<span class="token operator">|</span> a4362e11eb9749799228208bbc7660ea <span class="token operator">|</span> rduser036 <span class="token operator">|</span>
<span class="token operator">|</span> a57a5017587b411d871e5f9b312f35ce <span class="token operator">|</span> cinder    <span class="token operator">|</span>
<span class="token operator">|</span> b261500093da4de59c5f931aa0b189d4 <span class="token operator">|</span> rduser048 <span class="token operator">|</span>
<span class="token operator">|</span> b82cc14513a64876a986dcbe716b1801 <span class="token operator">|</span> rduser038 <span class="token operator">|</span>
<span class="token operator">|</span> b88a0cd21e784707ba90a2c0555342d1 <span class="token operator">|</span> rduser022 <span class="token operator">|</span>
<span class="token operator">|</span> c403710a858947aca84d175f31dbf945 <span class="token operator">|</span> rduser025 <span class="token operator">|</span>
<span class="token operator">|</span> c4a2432ee6f64b94b3689adf2684718b <span class="token operator">|</span> rduser020 <span class="token operator">|</span>
<span class="token operator">|</span> c73dbc7aab41451f8de7f06b7bec0c76 <span class="token operator">|</span> rduser013 <span class="token operator">|</span>
<span class="token operator">|</span> c9faecd63f034ba6b84c82cdd284f941 <span class="token operator">|</span> rduser028 <span class="token operator">|</span>
<span class="token operator">|</span> cfa8e2ebd536453daa6218600f7e5dc0 <span class="token operator">|</span> rduser037 <span class="token operator">|</span>
<span class="token operator">|</span> d58cec1f07d94eec8f9e3f62570e56e4 <span class="token operator">|</span> rduser015 <span class="token operator">|</span>
<span class="token operator">|</span> d5f1679ee5a74233b2cd46c74f38f0c0 <span class="token operator">|</span> rduser008 <span class="token operator">|</span>
<span class="token operator">|</span> d88027b6b6944427bda9557318b8c979 <span class="token operator">|</span> rduser030 <span class="token operator">|</span>
<span class="token operator">|</span> e46f397e0f0847be8cfaf173db5529db <span class="token operator">|</span> rduser011 <span class="token operator">|</span>
<span class="token operator">|</span> e4a66855bc3042cab24588d155c98826 <span class="token operator">|</span> rduser004 <span class="token operator">|</span>
<span class="token operator">|</span> ea6bd13fff4344019ee57bbc838b25c9 <span class="token operator">|</span> rduser003 <span class="token operator">|</span>
<span class="token operator">|</span> ebb2d2324b054189acf2bd5a62b6555a <span class="token operator">|</span> demo      <span class="token operator">|</span>
<span class="token operator">|</span> ebc7727d5cb84d2494359cdd235617d9 <span class="token operator">|</span> glance    <span class="token operator">|</span>
<span class="token operator">|</span> f445e8dcdd334b8d80b66c8c256456a7 <span class="token operator">|</span> rduser010 <span class="token operator">|</span>
<span class="token operator">|</span> f603db86e0604034a3b6f1d0205d0dcb <span class="token operator">|</span> rduser031 <span class="token operator">|</span>
<span class="token operator">|</span> f6b329cd87d6415a83ee7a80e292f7f3 <span class="token operator">|</span> rduser012 <span class="token operator">|</span>
<span class="token operator">|</span> f936aead65bb4a1fad2ccc861cb8b359 <span class="token operator">|</span> rduser044 <span class="token operator">|</span>
<span class="token operator">|</span> fc1ee42060ba42bc9962868b3c86c67a <span class="token operator">|</span> rduser009 <span class="token operator">|</span>
<span class="token operator">|</span> fe5ee9633d574c40848732382be797ea <span class="token operator">|</span> rduser047 <span class="token operator">|</span>
+----------------------------------+-----------+
</code></pre>
    <ul>
     <li>
      通过执行Shell 脚本为IT工程部创建用户ituser001～ituser005，密码为 cloudpasswd。
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ./Keystone-manage-user.sh </span>
Please Input New User Name <span class="token builtin class-name">:</span> eg <span class="token punctuation">(</span>username<span class="token punctuation">)</span> 
ituser
Please Input User Password: eg <span class="token punctuation">(</span>000000<span class="token punctuation">)</span> 
cloudpasswd
Please Input User Email Address,If don<span class="token string">'t need  press enter: eg (openstack.com) 
example.com
Please Input User   Beginning And End  Number: eg (001-002) 
001-005
Please enter the User belong Roles Name, Press enter for '</span>_member_' role by default: eg <span class="token punctuation">(</span>admin<span class="token punctuation">)</span> 
admin
Please Input User belong Project Name: eg <span class="token punctuation">(</span>projectname<span class="token punctuation">)</span> 
IT_Dept
+-----------+----------------------------------+
<span class="token operator">|</span> Field     <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-----------+----------------------------------+
<span class="token operator">|</span> domain_id <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> email     <span class="token operator">|</span> ituser001@example.com            <span class="token operator">|</span>
<span class="token operator">|</span> enabled   <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>        <span class="token operator">|</span> ed089ab3014d4c0393439fa6b8bf0f2e <span class="token operator">|</span>
<span class="token operator">|</span> name      <span class="token operator">|</span> ituser001                        <span class="token operator">|</span>
+-----------+----------------------------------+
+-----------+----------------------------------+
<span class="token operator">|</span> Field     <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-----------+----------------------------------+
<span class="token operator">|</span> domain_id <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> email     <span class="token operator">|</span> ituser002@example.com            <span class="token operator">|</span>
<span class="token operator">|</span> enabled   <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>        <span class="token operator">|</span> 8dfceea3982e4bf3875fa559b2e02b5a <span class="token operator">|</span>
<span class="token operator">|</span> name      <span class="token operator">|</span> ituser002                        <span class="token operator">|</span>
+-----------+----------------------------------+
+-----------+----------------------------------+
<span class="token operator">|</span> Field     <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-----------+----------------------------------+
<span class="token operator">|</span> domain_id <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> email     <span class="token operator">|</span> ituser003@example.com            <span class="token operator">|</span>
<span class="token operator">|</span> enabled   <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>        <span class="token operator">|</span> 4fb78b56fcb14175885ea188da68a468 <span class="token operator">|</span>
<span class="token operator">|</span> name      <span class="token operator">|</span> ituser003                        <span class="token operator">|</span>
+-----------+----------------------------------+
+-----------+----------------------------------+
<span class="token operator">|</span> Field     <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-----------+----------------------------------+
<span class="token operator">|</span> domain_id <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> email     <span class="token operator">|</span> ituser004@example.com            <span class="token operator">|</span>
<span class="token operator">|</span> enabled   <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>        <span class="token operator">|</span> 212ae123a4a345c9b05c3cf0852b2197 <span class="token operator">|</span>
<span class="token operator">|</span> name      <span class="token operator">|</span> ituser004                        <span class="token operator">|</span>
+-----------+----------------------------------+
+-----------+----------------------------------+
<span class="token operator">|</span> Field     <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-----------+----------------------------------+
<span class="token operator">|</span> domain_id <span class="token operator">|</span> 942f35ec481245a48d6100c6683a5fcb <span class="token operator">|</span>
<span class="token operator">|</span> email     <span class="token operator">|</span> ituser005@example.com            <span class="token operator">|</span>
<span class="token operator">|</span> enabled   <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>        <span class="token operator">|</span> 1345c045e91e428eb64e355bbae98505 <span class="token operator">|</span>
<span class="token operator">|</span> name      <span class="token operator">|</span> ituser005                        <span class="token operator">|</span>
+-----------+----------------------------------+
Keystone All User List 
+----------------------------------+-----------+
<span class="token operator">|</span> ID                               <span class="token operator">|</span> Name      <span class="token operator">|</span>
+----------------------------------+-----------+
<span class="token operator">|</span> 02a018e6ac3441f2835c817c7a1a207b <span class="token operator">|</span> rduser005 <span class="token operator">|</span>
<span class="token operator">|</span> 03ba69a427474fbaac7599c942f37330 <span class="token operator">|</span> rduser039 <span class="token operator">|</span>
<span class="token operator">|</span> 0499bbd56f72407eaca9f676c3a4bcfc <span class="token operator">|</span> rduser017 <span class="token operator">|</span>
<span class="token operator">|</span> 065a379909d34891add243f46d060e9b <span class="token operator">|</span> rduser043 <span class="token operator">|</span>
<span class="token operator">|</span> 0b744fa5759d43b5ade55586e0eb0af1 <span class="token operator">|</span> rduser007 <span class="token operator">|</span>
<span class="token operator">|</span> 1345c045e91e428eb64e355bbae98505 <span class="token operator">|</span> ituser005 <span class="token operator">|</span>
<span class="token operator">|</span> 13e0d9dcd4564b7fafaf909b8216262d <span class="token operator">|</span> rduser034 <span class="token operator">|</span>
<span class="token operator">|</span> 212ae123a4a345c9b05c3cf0852b2197 <span class="token operator">|</span> ituser004 <span class="token operator">|</span>
<span class="token operator">|</span> 26c7ddc343fa4c91a1f682d21be1da7d <span class="token operator">|</span> rduser049 <span class="token operator">|</span>
<span class="token operator">|</span> 2bee802355b24023968dc6e4bd11c983 <span class="token operator">|</span> admin     <span class="token operator">|</span>
<span class="token operator">|</span> 2c4c0a61075a440d8f9783edd86844c6 <span class="token operator">|</span> rduser040 <span class="token operator">|</span>
<span class="token operator">|</span> 2dd5669948a3409aa3296a3057cb0b3a <span class="token operator">|</span> rduser023 <span class="token operator">|</span>
<span class="token operator">|</span> 375024d3247540e5b9048671fe577068 <span class="token operator">|</span> rduser046 <span class="token operator">|</span>
<span class="token operator">|</span> 3a86600a0e5e47d4a6c67a8f5a9f701e <span class="token operator">|</span> rduser021 <span class="token operator">|</span>
<span class="token operator">|</span> 3c70e43caefd4623b7e8a2fbd7e52fd2 <span class="token operator">|</span> rduser035 <span class="token operator">|</span>
<span class="token operator">|</span> 41cb35e9b08c4846a88e0277547a6fbd <span class="token operator">|</span> rduser002 <span class="token operator">|</span>
<span class="token operator">|</span> 4c9e1c3650da4b8a951ca08c0f6f2b3a <span class="token operator">|</span> rduser026 <span class="token operator">|</span>
<span class="token operator">|</span> 4fb78b56fcb14175885ea188da68a468 <span class="token operator">|</span> ituser003 <span class="token operator">|</span>
<span class="token operator">|</span> 520f96d6d8d44ddbbeb5df6573f11da7 <span class="token operator">|</span> rduser006 <span class="token operator">|</span>
<span class="token operator">|</span> 563366420dc44ea89661bc2a8fe33f0b <span class="token operator">|</span> rduser029 <span class="token operator">|</span>
<span class="token operator">|</span> 56e7081689b044cbbb4a1a66ef2132e7 <span class="token operator">|</span> rduser014 <span class="token operator">|</span>
<span class="token operator">|</span> 6099f2288ef34dc5b4d541a3cf85f849 <span class="token operator">|</span> rduser042 <span class="token operator">|</span>
<span class="token operator">|</span> 682c3257d62748028d1a1e7cc7ac6efb <span class="token operator">|</span> alice     <span class="token operator">|</span>
<span class="token operator">|</span> 6d65072d602742cb9adff407a3ad1c94 <span class="token operator">|</span> rduser045 <span class="token operator">|</span>
<span class="token operator">|</span> 70c4160866284154b56bf203171cfd90 <span class="token operator">|</span> neutron   <span class="token operator">|</span>
<span class="token operator">|</span> 717f15d187f14fbca1f36a911e1162a8 <span class="token operator">|</span> rduser019 <span class="token operator">|</span>
<span class="token operator">|</span> 75b1a57e0bf54f1c9d6a5e3a220d3247 <span class="token operator">|</span> rduser027 <span class="token operator">|</span>
<span class="token operator">|</span> 818fbea675314d33a542ee58178c5424 <span class="token operator">|</span> rduser016 <span class="token operator">|</span>
<span class="token operator">|</span> 82b97aaa126b4732b12e5af608f9c07c <span class="token operator">|</span> rduser018 <span class="token operator">|</span>
<span class="token operator">|</span> 84f21a5bbd3846668d21c47a4077ec50 <span class="token operator">|</span> rduser024 <span class="token operator">|</span>
<span class="token operator">|</span> 886b421475b045718fd17a090e7c8226 <span class="token operator">|</span> rduser032 <span class="token operator">|</span>
<span class="token operator">|</span> 8aebf5350d1947f3bac7de41be461219 <span class="token operator">|</span> nova      <span class="token operator">|</span>
<span class="token operator">|</span> 8aefa1e8548f49a2b3abb3884dca2d1a <span class="token operator">|</span> rduser050 <span class="token operator">|</span>
<span class="token operator">|</span> 8dfceea3982e4bf3875fa559b2e02b5a <span class="token operator">|</span> ituser002 <span class="token operator">|</span>
<span class="token operator">|</span> 8e3671518d6b423dbfbf55ffa8249df8 <span class="token operator">|</span> rduser033 <span class="token operator">|</span>
<span class="token operator">|</span> 8e695b3ca86c4a4da7968baeef3c6864 <span class="token operator">|</span> swift     <span class="token operator">|</span>
<span class="token operator">|</span> 95ef2ac87c874250abb3302351c7b63a <span class="token operator">|</span> rduser041 <span class="token operator">|</span>
<span class="token operator">|</span> a4362e11eb9749799228208bbc7660ea <span class="token operator">|</span> rduser036 <span class="token operator">|</span>
<span class="token operator">|</span> a57a5017587b411d871e5f9b312f35ce <span class="token operator">|</span> cinder    <span class="token operator">|</span>
<span class="token operator">|</span> b261500093da4de59c5f931aa0b189d4 <span class="token operator">|</span> rduser048 <span class="token operator">|</span>
<span class="token operator">|</span> b82cc14513a64876a986dcbe716b1801 <span class="token operator">|</span> rduser038 <span class="token operator">|</span>
<span class="token operator">|</span> b88a0cd21e784707ba90a2c0555342d1 <span class="token operator">|</span> rduser022 <span class="token operator">|</span>
<span class="token operator">|</span> c403710a858947aca84d175f31dbf945 <span class="token operator">|</span> rduser025 <span class="token operator">|</span>
<span class="token operator">|</span> c4a2432ee6f64b94b3689adf2684718b <span class="token operator">|</span> rduser020 <span class="token operator">|</span>
<span class="token operator">|</span> c73dbc7aab41451f8de7f06b7bec0c76 <span class="token operator">|</span> rduser013 <span class="token operator">|</span>
<span class="token operator">|</span> c9faecd63f034ba6b84c82cdd284f941 <span class="token operator">|</span> rduser028 <span class="token operator">|</span>
<span class="token operator">|</span> cfa8e2ebd536453daa6218600f7e5dc0 <span class="token operator">|</span> rduser037 <span class="token operator">|</span>
<span class="token operator">|</span> d58cec1f07d94eec8f9e3f62570e56e4 <span class="token operator">|</span> rduser015 <span class="token operator">|</span>
<span class="token operator">|</span> d5f1679ee5a74233b2cd46c74f38f0c0 <span class="token operator">|</span> rduser008 <span class="token operator">|</span>
<span class="token operator">|</span> d88027b6b6944427bda9557318b8c979 <span class="token operator">|</span> rduser030 <span class="token operator">|</span>
<span class="token operator">|</span> e46f397e0f0847be8cfaf173db5529db <span class="token operator">|</span> rduser011 <span class="token operator">|</span>
<span class="token operator">|</span> e4a66855bc3042cab24588d155c98826 <span class="token operator">|</span> rduser004 <span class="token operator">|</span>
<span class="token operator">|</span> ea6bd13fff4344019ee57bbc838b25c9 <span class="token operator">|</span> rduser003 <span class="token operator">|</span>
<span class="token operator">|</span> ebb2d2324b054189acf2bd5a62b6555a <span class="token operator">|</span> demo      <span class="token operator">|</span>
<span class="token operator">|</span> ebc7727d5cb84d2494359cdd235617d9 <span class="token operator">|</span> glance    <span class="token operator">|</span>
<span class="token operator">|</span> ed089ab3014d4c0393439fa6b8bf0f2e <span class="token operator">|</span> ituser001 <span class="token operator">|</span>
<span class="token operator">|</span> f445e8dcdd334b8d80b66c8c256456a7 <span class="token operator">|</span> rduser010 <span class="token operator">|</span>
<span class="token operator">|</span> f603db86e0604034a3b6f1d0205d0dcb <span class="token operator">|</span> rduser031 <span class="token operator">|</span>
<span class="token operator">|</span> f6b329cd87d6415a83ee7a80e292f7f3 <span class="token operator">|</span> rduser012 <span class="token operator">|</span>
<span class="token operator">|</span> f936aead65bb4a1fad2ccc861cb8b359 <span class="token operator">|</span> rduser044 <span class="token operator">|</span>
<span class="token operator">|</span> fc1ee42060ba42bc9962868b3c86c67a <span class="token operator">|</span> rduser009 <span class="token operator">|</span>
<span class="token operator">|</span> fe5ee9633d574c40848732382be797ea <span class="token operator">|</span> rduser047 <span class="token operator">|</span>
+----------------------------------+-----------+
</code></pre>
    <ul>
     <li>
      通过Shell命令行将项目研发部用户rduser002绑定普通用户权限，执行命令如下：
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack role create  _member_</span>
+-----------+----------------------------------+
<span class="token operator">|</span> Field     <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-----------+----------------------------------+
<span class="token operator">|</span> domain_id <span class="token operator">|</span> None                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>        <span class="token operator">|</span> 9fe2ff9ee4384b1894a90878d3e92bab <span class="token operator">|</span>
<span class="token operator">|</span> name      <span class="token operator">|</span> _member_                         <span class="token operator">|</span>
+-----------+----------------------------------+
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack role add --user rduser002 --project RD_Dept _member_</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack role list --user rduser002 --project RD_Dept</span>
+----------------------------------+----------+---------+-----------+
<span class="token operator">|</span> ID                               <span class="token operator">|</span> Name     <span class="token operator">|</span> Project <span class="token operator">|</span> User      <span class="token operator">|</span>
+----------------------------------+----------+---------+-----------+
<span class="token operator">|</span> 9fe2ff9ee4384b1894a90878d3e92bab <span class="token operator">|</span> _member_ <span class="token operator">|</span> RD_Dept <span class="token operator">|</span> rduser002 <span class="token operator">|</span>
+----------------------------------+----------+---------+-----------+
</code></pre>
    <ul>
     <li>
      编写 脚本将项目IT工程部用ituser001～ituser005绑定普通用户和管理员用户权限
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vi  Keystone-manage-add-role.sh</span>
<span class="token comment">#!/bin/bash</span>
<span class="token comment"># 1st keystone</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span>  -f <span class="token string">"/etc/keystone/admin-openrc.sh"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
        <span class="token builtin class-name">source</span> /etc/keystone/admin-openrc.sh
<span class="token keyword">else</span>
<span class="token assign-left variable">env_path</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">find</span> / -name admin-openrc.sh<span class="token variable">`</span></span>
        <span class="token builtin class-name">source</span> <span class="token variable">$env_path</span>
<span class="token keyword">fi</span>
        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mPlease Enter The User Name<span class="token entity" title="\033">\033</span>[0m "</span>
        <span class="token builtin class-name">read</span> Add_Role_Username
        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mPlease Input User  Beginning And End  Number: eg (001-002)<span class="token entity" title="\033">\033</span>[0m "</span>
        <span class="token builtin class-name">read</span> Add_User_Range
                <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -n <span class="token string">"<span class="token variable">$Add_User_Range</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                    <span class="token assign-left variable">Add_User_Range</span><span class="token operator">=</span><span class="token variable">$Add_User_Range</span>
                <span class="token keyword">else</span>
                    <span class="token assign-left variable">A_R_Start</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $Add_User_Range <span class="token operator">|</span><span class="token function">awk</span> -F- <span class="token string">'{ print $1}'</span><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $0+0}'</span><span class="token variable">`</span></span>
                    <span class="token assign-left variable">A_R_U_Start</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">printf</span> <span class="token string">"%03d<span class="token entity" title="\n">\n</span>"</span> $A_R_Start<span class="token variable">`</span></span>
                    <span class="token assign-left variable">A_R_End</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $Add_User_Range <span class="token operator">|</span><span class="token function">awk</span> -F- <span class="token string">'{ print $2}'</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $0+0}'</span><span class="token variable">`</span></span>
                    <span class="token assign-left variable">A_R_U_End</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">printf</span> <span class="token string">"%03d<span class="token entity" title="\n">\n</span>"</span> $A_R_End<span class="token variable">`</span></span>
                    <span class="token assign-left variable">A_R_End1</span><span class="token operator">=</span>$<span class="token punctuation">[</span><span class="token variable">$A_R_End</span>+1<span class="token punctuation">]</span>
                <span class="token keyword">fi</span>
        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mPlease Enter the Project Name<span class="token entity" title="\033">\033</span>[0m "</span>
        <span class="token builtin class-name">read</span> Add_Role_Tenant
            <span class="token assign-left variable">IF_Tenant_Exists</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>openstack project list <span class="token operator">|</span><span class="token function">sed</span> <span class="token string">'1,3d'</span> <span class="token operator">|</span><span class="token function">sed</span> <span class="token string">'$d'</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print $4}'</span><span class="token variable">`</span></span>
            <span class="token keyword">if</span>  <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${IF_Tenant_Exists<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> -w <span class="token string">"<span class="token variable">$Add_Role_Tenant</span>"</span> <span class="token operator">&gt;&gt;</span> /dev/null <span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"exists"</span> <span class="token operator">&gt;&gt;</span> /dev/null
            <span class="token keyword">else</span>
                <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mProject <span class="token variable">$Add_Role_Tenant</span> not exists<span class="token entity" title="\033">\033</span>[0m "</span>
                <span class="token builtin class-name">exit</span> <span class="token number">1</span>
            <span class="token keyword">fi</span>
        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mPlease Enter the  Role Name<span class="token entity" title="\033">\033</span>[0m "</span>
         <span class="token builtin class-name">read</span> Add_Role_New_Role
            <span class="token assign-left variable">IF_Role_Exists</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>openstack role list <span class="token operator">|</span><span class="token function">sed</span> <span class="token string">'1,3d'</span> <span class="token operator">|</span><span class="token function">sed</span> <span class="token string">'$d'</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print $4}'</span><span class="token variable">`</span></span>
            <span class="token keyword">if</span>  <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${IF_Role_Exists<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> -w <span class="token string">"<span class="token variable">$Add_Role_New_Role</span>"</span> <span class="token operator">&gt;&gt;</span> /dev/null <span class="token punctuation">;</span> <span class="token keyword">then</span>
                 <span class="token builtin class-name">echo</span> <span class="token string">"exists"</span> <span class="token operator">&gt;&gt;</span> /dev/null
            <span class="token keyword">else</span>
                 <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mRole <span class="token variable">$Add_Role_New_Role</span> not exists<span class="token entity" title="\033">\033</span>[0m "</span>
                 <span class="token builtin class-name">exit</span> <span class="token number">1</span>
            <span class="token keyword">fi</span>
        <span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span> username_number<span class="token operator">=</span>$A_R_Start<span class="token punctuation">;</span>username_number<span class="token operator">&lt;</span>$A_R_End1<span class="token punctuation">;</span>username_number<span class="token operator">++</span> <span class="token punctuation">))</span></span><span class="token punctuation">;</span><span class="token keyword">do</span>
                <span class="token assign-left variable">real_username_number</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">printf</span> <span class="token string">"%03d<span class="token entity" title="\n">\n</span>"</span> $username_number<span class="token variable">`</span></span>
                openstack role <span class="token function">add</span> --project <span class="token variable">$Add_Role_Tenant</span> --user <span class="token variable">$Add_Role_Username</span><span class="token variable">$real_username_number</span> <span class="token variable">$Add_Role_New_Role</span>
                <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mKeystone user <span class="token variable">$Add_Role_Username</span><span class="token variable">$real_username_number</span> Project <span class="token variable">$Add_Role_Tenant</span> role list<span class="token entity" title="\033">\033</span>[0m "</span>
                openstack role assignment list --user <span class="token variable">$Add_Role_Username</span><span class="token variable">$real_username_number</span> --project <span class="token variable">$Add_Role_Tenant</span>
        <span class="token keyword">done</span>
~
~
~
~
<span class="token string">"Keystone-manage-add-role.sh"</span> <span class="token punctuation">[</span>New<span class="token punctuation">]</span> 45L, 2377C written
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># chmod +x Keystone-manage-add-role.sh</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ./Keystone-manage-add-role.sh</span>
Please Enter The User Name 
ituser
Please Input User  Beginning And End  Number: eg <span class="token punctuation">(</span>001-002<span class="token punctuation">)</span> 
001-005
Please Enter the Project Name 
IT_Dept
Please Enter the  Role Name 
admin
Keystone user ituser001 Project IT_Dept role list 
+-------------------------+-------------------------+-------+--------------------------+--------+-----------+
<span class="token operator">|</span> Role                    <span class="token operator">|</span> User                    <span class="token operator">|</span> Group <span class="token operator">|</span> Project                  <span class="token operator">|</span> Domain <span class="token operator">|</span> Inherited <span class="token operator">|</span>
+-------------------------+-------------------------+-------+--------------------------+--------+-----------+
<span class="token operator">|</span> 28e00fea5f4344edaa093f6 <span class="token operator">|</span> ed089ab3014d4c0393439fa <span class="token operator">|</span>       <span class="token operator">|</span> d9a68590f02344e48664db50 <span class="token operator">|</span>        <span class="token operator">|</span> False     <span class="token operator">|</span>
<span class="token operator">|</span> 17fc55d5a               <span class="token operator">|</span> 6b8bf0f2e               <span class="token operator">|</span>       <span class="token operator">|</span> 1542cec2                 <span class="token operator">|</span>        <span class="token operator">|</span>           <span class="token operator">|</span>
+-------------------------+-------------------------+-------+--------------------------+--------+-----------+
Keystone user ituser002 Project IT_Dept role list 
+-------------------------+-------------------------+-------+--------------------------+--------+-----------+
<span class="token operator">|</span> Role                    <span class="token operator">|</span> User                    <span class="token operator">|</span> Group <span class="token operator">|</span> Project                  <span class="token operator">|</span> Domain <span class="token operator">|</span> Inherited <span class="token operator">|</span>
+-------------------------+-------------------------+-------+--------------------------+--------+-----------+
<span class="token operator">|</span> 28e00fea5f4344edaa093f6 <span class="token operator">|</span> 8dfceea3982e4bf3875fa55 <span class="token operator">|</span>       <span class="token operator">|</span> d9a68590f02344e48664db50 <span class="token operator">|</span>        <span class="token operator">|</span> False     <span class="token operator">|</span>
<span class="token operator">|</span> 17fc55d5a               <span class="token operator">|</span> 9b2e02b5a               <span class="token operator">|</span>       <span class="token operator">|</span> 1542cec2                 <span class="token operator">|</span>        <span class="token operator">|</span>           <span class="token operator">|</span>
+-------------------------+-------------------------+-------+--------------------------+--------+-----------+
Keystone user ituser003 Project IT_Dept role list 
+-------------------------+-------------------------+-------+--------------------------+--------+-----------+
<span class="token operator">|</span> Role                    <span class="token operator">|</span> User                    <span class="token operator">|</span> Group <span class="token operator">|</span> Project                  <span class="token operator">|</span> Domain <span class="token operator">|</span> Inherited <span class="token operator">|</span>
+-------------------------+-------------------------+-------+--------------------------+--------+-----------+
<span class="token operator">|</span> 28e00fea5f4344edaa093f6 <span class="token operator">|</span> 4fb78b56fcb14175885ea18 <span class="token operator">|</span>       <span class="token operator">|</span> d9a68590f02344e48664db50 <span class="token operator">|</span>        <span class="token operator">|</span> False     <span class="token operator">|</span>
<span class="token operator">|</span> 17fc55d5a               <span class="token operator">|</span> 8da68a468               <span class="token operator">|</span>       <span class="token operator">|</span> 1542cec2                 <span class="token operator">|</span>        <span class="token operator">|</span>           <span class="token operator">|</span>
+-------------------------+-------------------------+-------+--------------------------+--------+-----------+
Keystone user ituser004 Project IT_Dept role list 
+-------------------------+-------------------------+-------+--------------------------+--------+-----------+
<span class="token operator">|</span> Role                    <span class="token operator">|</span> User                    <span class="token operator">|</span> Group <span class="token operator">|</span> Project                  <span class="token operator">|</span> Domain <span class="token operator">|</span> Inherited <span class="token operator">|</span>
+-------------------------+-------------------------+-------+--------------------------+--------+-----------+
<span class="token operator">|</span> 28e00fea5f4344edaa093f6 <span class="token operator">|</span> 212ae123a4a345c9b05c3cf <span class="token operator">|</span>       <span class="token operator">|</span> d9a68590f02344e48664db50 <span class="token operator">|</span>        <span class="token operator">|</span> False     <span class="token operator">|</span>
<span class="token operator">|</span> 17fc55d5a               <span class="token operator">|</span> 0852b2197               <span class="token operator">|</span>       <span class="token operator">|</span> 1542cec2                 <span class="token operator">|</span>        <span class="token operator">|</span>           <span class="token operator">|</span>
+-------------------------+-------------------------+-------+--------------------------+--------+-----------+
Keystone user ituser005 Project IT_Dept role list 
+-------------------------+-------------------------+-------+--------------------------+--------+-----------+
<span class="token operator">|</span> Role                    <span class="token operator">|</span> User                    <span class="token operator">|</span> Group <span class="token operator">|</span> Project                  <span class="token operator">|</span> Domain <span class="token operator">|</span> Inherited <span class="token operator">|</span>
+-------------------------+-------------------------+-------+--------------------------+--------+-----------+
<span class="token operator">|</span> 28e00fea5f4344edaa093f6 <span class="token operator">|</span> 1345c045e91e428eb64e355 <span class="token operator">|</span>       <span class="token operator">|</span> d9a68590f02344e48664db50 <span class="token operator">|</span>        <span class="token operator">|</span> False     <span class="token operator">|</span>
<span class="token operator">|</span> 17fc55d5a               <span class="token operator">|</span> bbae98505               <span class="token operator">|</span>       <span class="token operator">|</span> 1542cec2                 <span class="token operator">|</span>        <span class="token operator">|</span>           <span class="token operator">|</span>
+-------------------------+-------------------------+-------+--------------------------+--------+-----------+
</code></pre>
    <p>
     可以看到创建出来的用户，角色，项目！
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1f930cbedb2e4bc4d788934cf3a9dc91.png"/>
    </p>
    <h2>
     <a id="_1705">
     </a>
     镜像服务
    </h2>
    <h3>
     <a id="_1706">
     </a>
     概述
    </h3>
    <p>
     通过认证服务的学习，我们可以以不同的身份访问企业云平台，可以通过研发部的账户登录研发部，可以通过业务部访问业务部的资源，也可以通过IT工程部的身份登录查看整个系统的运行状况；下面我们继续学习镜像服务（Glance），了解这个组件是如何为平台的正常运行提供支撑的。
    </p>
    <h3>
     <a id="_1708">
     </a>
     实验目标
    </h3>
    <ul>
     <li>
      了解RabbitMQ的基本概念。
     </li>
     <li>
      理解镜像服务的服务流程和工作机制。
     </li>
     <li>
      掌握镜像服务的基本操作以及常见运维。
     </li>
    </ul>
    <h3>
     <a id="_1712">
     </a>
     实验环境
    </h3>
    <p>
     大数据实训平台、IaaS_Mitaka_ALLinone.qcow2。
    </p>
    <h3>
     <a id="_1714">
     </a>
     实验准备
    </h3>
    <ol>
     <li>
      概述Glance镜像服务实现发现、注册、获取虚拟机镜像和镜像元数据，镜像数据支持存储多种的存储系统，可以是
      <strong>
       简单文件系统、对象存储系统
      </strong>
      等。
     </li>
     <li>
      Glance服务架构Glance镜像服务是典型的
      <strong>
       C/S
      </strong>
      架构，
     </li>
    </ol>
    <ul>
     <li>
      Glance架构包括 glance-Client、Glance和 Glance Store
     </li>
     <li>
      Glance 主要包括 REST API、数据库抽象层（DAL）、域控制器（glance domain controller）和注册层（registry layer），Glance 使用集中数据库（Glance DB）在 Glance 各组件间直接共享数据。
     </li>
     <li>
      所有的镜像文件操作都通过 glance_store 库完成，glance_store 库提供了通用接口，对接后端外部不同存储。
     </li>
    </ul>
    <h3>
     <a id="_1720">
     </a>
     实验步骤
    </h3>
    <ol>
     <li>
      查询Glance版本
      <br/>
      （1）检测Glance服务列表
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#  source /etc/keystone/admin-openrc.sh </span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack-service  list | grep glance</span>
openstack-glance-api
openstack-glance-registry
</code></pre>
    <p>
     （2）检测Glance服务是否启动
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack-service status | grep glance</span>
<span class="token assign-left variable">MainPID</span><span class="token operator">=</span><span class="token number">1290</span> <span class="token assign-left variable">Id</span><span class="token operator">=</span>openstack-glance-api.service <span class="token assign-left variable">ActiveState</span><span class="token operator">=</span>active
<span class="token assign-left variable">MainPID</span><span class="token operator">=</span><span class="token number">1270</span> <span class="token assign-left variable">Id</span><span class="token operator">=</span>openstack-glance-registry.service <span class="token assign-left variable">ActiveState</span><span class="token operator">=</span>active
</code></pre>
    <p>
     （3）查询glance-control版本
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># glance-control --version</span>
<span class="token number">12.0</span>.0
</code></pre>
    <ol start="2">
     <li>
      创建镜像
      <br/>
      （1）
      <a href="https://pan.baidu.com/s/1PmGCqVL09_-1RZOfpiHRgQ?pwd=e747" rel="nofollow">
       下载CirrOS镜像
      </a>
      <br/>
      （2）上传到/tmp/images
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># mkdir /tmp/images</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cd /tmp/images</span>
<span class="token punctuation">[</span>root@controller images<span class="token punctuation">]</span><span class="token comment"># ls</span>
cirros-0.3.4-x86_64-disk.img
<span class="token punctuation">[</span>root@controller images<span class="token punctuation">]</span><span class="token comment"># mv cirros-0.3.4-x86_64-disk.img cirros-0.3.2-x86_64-disk.img</span>
<span class="token punctuation">[</span>root@controller images<span class="token punctuation">]</span><span class="token comment"># file cirros-0.3.2-x86_64-disk.img </span>
cirros-0.3.2-x86_64-disk.img: QEMU QCOW Image <span class="token punctuation">(</span>v2<span class="token punctuation">)</span>, <span class="token number">41126400</span> bytes
</code></pre>
    <p>
     （3）使用命令行创建镜像
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller images<span class="token punctuation">]</span><span class="token comment"># glance image-create --name "cirros-0.3.2-x86_64" --disk-format qcow2 --container-format bare --progress &lt; cirros-0.3.2-x86_64-disk.img </span>
<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token number">100</span>%
+------------------+--------------------------------------+
<span class="token operator">|</span> Property         <span class="token operator">|</span> Value                                <span class="token operator">|</span>
+------------------+--------------------------------------+
<span class="token operator">|</span> checksum         <span class="token operator">|</span> ee1eca47dc88f4879d8a229cc70a07c6     <span class="token operator">|</span>
<span class="token operator">|</span> container_format <span class="token operator">|</span> bare                                 <span class="token operator">|</span>
<span class="token operator">|</span> created_at       <span class="token operator">|</span> <span class="token number">2022</span>-05-28T09:05:40Z                 <span class="token operator">|</span>
<span class="token operator">|</span> disk_format      <span class="token operator">|</span> qcow2                                <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>               <span class="token operator">|</span> 2fb8263b-383b-4d2d-ab92-526c08fbdcc2 <span class="token operator">|</span>
<span class="token operator">|</span> min_disk         <span class="token operator">|</span> <span class="token number">0</span>                                    <span class="token operator">|</span>
<span class="token operator">|</span> min_ram          <span class="token operator">|</span> <span class="token number">0</span>                                    <span class="token operator">|</span>
<span class="token operator">|</span> name             <span class="token operator">|</span> cirros-0.3.2-x86_64                  <span class="token operator">|</span>
<span class="token operator">|</span> owner            <span class="token operator">|</span> 81ea07237d034c4e99369581c1b4db89     <span class="token operator">|</span>
<span class="token operator">|</span> protected        <span class="token operator">|</span> False                                <span class="token operator">|</span>
<span class="token operator">|</span> size             <span class="token operator">|</span> <span class="token number">13287936</span>                             <span class="token operator">|</span>
<span class="token operator">|</span> status           <span class="token operator">|</span> active                               <span class="token operator">|</span>
<span class="token operator">|</span> tags             <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                   <span class="token operator">|</span>
<span class="token operator">|</span> updated_at       <span class="token operator">|</span> <span class="token number">2022</span>-05-28T09:05:42Z                 <span class="token operator">|</span>
<span class="token operator">|</span> virtual_size     <span class="token operator">|</span> None                                 <span class="token operator">|</span>
<span class="token operator">|</span> visibility       <span class="token operator">|</span> private                              <span class="token operator">|</span>
+------------------+--------------------------------------+
</code></pre>
    <p>
     （4）查询镜像列表
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller images<span class="token punctuation">]</span><span class="token comment"># glance image-list</span>
+--------------------------------------+---------------------+
<span class="token operator">|</span> ID                                   <span class="token operator">|</span> Name                <span class="token operator">|</span>
+--------------------------------------+---------------------+
<span class="token operator">|</span> 8a3c6a4e-e7a5-4e25-83c4-6e93bbf6c2f2 <span class="token operator">|</span> centos              <span class="token operator">|</span>
<span class="token operator">|</span> 2fb8263b-383b-4d2d-ab92-526c08fbdcc2 <span class="token operator">|</span> cirros-0.3.2-x86_64 <span class="token operator">|</span>
+--------------------------------------+---------------------+
</code></pre>
    <ol start="3">
     <li>
      更改镜像
      <br/>
      可以使用glance image-update更新镜像信息，可以使用glance image-delete删除镜像信息。 如果需要改变镜像启动硬盘最低要求值（min-disk）时，min-disk 默认单位为G。
      <br/>
      （1）获取镜像详细信息
      <br/>
      镜像的ID通过镜像列表查询得出，每个镜像的ID都不同。
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller images<span class="token punctuation">]</span><span class="token comment"># glance image-list</span>
+--------------------------------------+---------------------+
<span class="token operator">|</span> ID                                   <span class="token operator">|</span> Name                <span class="token operator">|</span>
+--------------------------------------+---------------------+
<span class="token operator">|</span> 8a3c6a4e-e7a5-4e25-83c4-6e93bbf6c2f2 <span class="token operator">|</span> centos              <span class="token operator">|</span>
<span class="token operator">|</span> 2fb8263b-383b-4d2d-ab92-526c08fbdcc2 <span class="token operator">|</span> cirros-0.3.2-x86_64 <span class="token operator">|</span>
+--------------------------------------+---------------------+
<span class="token punctuation">[</span>root@controller images<span class="token punctuation">]</span><span class="token comment"># glance image-show 2fb8263b-383b-4d2d-ab92-526c08fbdcc2</span>
+------------------+--------------------------------------+
<span class="token operator">|</span> Property         <span class="token operator">|</span> Value                                <span class="token operator">|</span>
+------------------+--------------------------------------+
<span class="token operator">|</span> checksum         <span class="token operator">|</span> ee1eca47dc88f4879d8a229cc70a07c6     <span class="token operator">|</span>
<span class="token operator">|</span> container_format <span class="token operator">|</span> bare                                 <span class="token operator">|</span>
<span class="token operator">|</span> created_at       <span class="token operator">|</span> <span class="token number">2022</span>-05-28T09:05:40Z                 <span class="token operator">|</span>
<span class="token operator">|</span> disk_format      <span class="token operator">|</span> qcow2                                <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>               <span class="token operator">|</span> 2fb8263b-383b-4d2d-ab92-526c08fbdcc2 <span class="token operator">|</span>
<span class="token operator">|</span> min_disk         <span class="token operator">|</span> <span class="token number">0</span>                                    <span class="token operator">|</span>
<span class="token operator">|</span> min_ram          <span class="token operator">|</span> <span class="token number">0</span>                                    <span class="token operator">|</span>
<span class="token operator">|</span> name             <span class="token operator">|</span> cirros-0.3.2-x86_64                  <span class="token operator">|</span>
<span class="token operator">|</span> owner            <span class="token operator">|</span> 81ea07237d034c4e99369581c1b4db89     <span class="token operator">|</span>
<span class="token operator">|</span> protected        <span class="token operator">|</span> False                                <span class="token operator">|</span>
<span class="token operator">|</span> size             <span class="token operator">|</span> <span class="token number">13287936</span>                             <span class="token operator">|</span>
<span class="token operator">|</span> status           <span class="token operator">|</span> active                               <span class="token operator">|</span>
<span class="token operator">|</span> tags             <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                   <span class="token operator">|</span>
<span class="token operator">|</span> updated_at       <span class="token operator">|</span> <span class="token number">2022</span>-05-28T09:05:42Z                 <span class="token operator">|</span>
<span class="token operator">|</span> virtual_size     <span class="token operator">|</span> None                                 <span class="token operator">|</span>
<span class="token operator">|</span> visibility       <span class="token operator">|</span> private                              <span class="token operator">|</span>
+------------------+--------------------------------------+
</code></pre>
    <p>
     （2）修改镜像启动硬盘所需大小
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller images<span class="token punctuation">]</span><span class="token comment"># glance image-update --min-disk=1 2fb8263b-383b-4d2d-ab92-526c08fbdcc2</span>
+------------------+--------------------------------------+
<span class="token operator">|</span> Property         <span class="token operator">|</span> Value                                <span class="token operator">|</span>
+------------------+--------------------------------------+
<span class="token operator">|</span> checksum         <span class="token operator">|</span> ee1eca47dc88f4879d8a229cc70a07c6     <span class="token operator">|</span>
<span class="token operator">|</span> container_format <span class="token operator">|</span> bare                                 <span class="token operator">|</span>
<span class="token operator">|</span> created_at       <span class="token operator">|</span> <span class="token number">2022</span>-05-28T09:05:40Z                 <span class="token operator">|</span>
<span class="token operator">|</span> disk_format      <span class="token operator">|</span> qcow2                                <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>               <span class="token operator">|</span> 2fb8263b-383b-4d2d-ab92-526c08fbdcc2 <span class="token operator">|</span>
<span class="token operator">|</span> min_disk         <span class="token operator">|</span> <span class="token number">1</span>                                    <span class="token operator">|</span>
<span class="token operator">|</span> min_ram          <span class="token operator">|</span> <span class="token number">0</span>                                    <span class="token operator">|</span>
<span class="token operator">|</span> name             <span class="token operator">|</span> cirros-0.3.2-x86_64                  <span class="token operator">|</span>
<span class="token operator">|</span> owner            <span class="token operator">|</span> 81ea07237d034c4e99369581c1b4db89     <span class="token operator">|</span>
<span class="token operator">|</span> protected        <span class="token operator">|</span> False                                <span class="token operator">|</span>
<span class="token operator">|</span> size             <span class="token operator">|</span> <span class="token number">13287936</span>                             <span class="token operator">|</span>
<span class="token operator">|</span> status           <span class="token operator">|</span> active                               <span class="token operator">|</span>
<span class="token operator">|</span> tags             <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                   <span class="token operator">|</span>
<span class="token operator">|</span> updated_at       <span class="token operator">|</span> <span class="token number">2022</span>-05-28T09:57:47Z                 <span class="token operator">|</span>
<span class="token operator">|</span> virtual_size     <span class="token operator">|</span> None                                 <span class="token operator">|</span>
<span class="token operator">|</span> visibility       <span class="token operator">|</span> private                              <span class="token operator">|</span>
+------------------+--------------------------------------+
</code></pre>
    <p>
     （3）删除镜像
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@controller images<span class="token punctuation">]</span><span class="token comment"># glance image-delete 2fb8263b-383b-4d2d-ab92-526c08fbdcc2</span>
<span class="token punctuation">[</span>root@controller images<span class="token punctuation">]</span><span class="token comment"># glance image-list</span>
+--------------------------------------+--------+
<span class="token operator">|</span> ID                                   <span class="token operator">|</span> Name   <span class="token operator">|</span>
+--------------------------------------+--------+
<span class="token operator">|</span> 8a3c6a4e-e7a5-4e25-83c4-6e93bbf6c2f2 <span class="token operator">|</span> centos <span class="token operator">|</span>
+--------------------------------------+--------+
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
</div>


