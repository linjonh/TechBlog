---
layout: post
title: "使用VUEWebRTC快速实现简单的音视频通话"
date: 2024-01-29 14:24:47 +0800
description: "文章浏览阅读4.2k次，点赞25次，本文将介绍如何快速使用 Vue ZEGO Express SDK"
keywords: "vue webrtc"
categories: ['技术教程']
tags: ['音视频', '视频通话', '直播间', '实时音视频', 'Webrtc', 'Vue']
artid: "135911483"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=135911483
    alt: "使用VUEWebRTC快速实现简单的音视频通话"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     使用VUE+WebRTC快速实现简单的音视频通话
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="1__0">
     </a>
     1 功能简介
    </h3>
    <p>
     本文将介绍如何快速使用 Vue 实现一个简单的实时音视频通话。
    </p>
    <p>
     相关概念解释:
    </p>
    <ul>
     <li>
      ZEGO Express SDK：由 ZEGO 提供的实时音视频 SDK，能够为开发者提供便捷接入、高清流畅、多平台互通、低延迟、高并发的音视频服务。
     </li>
     <li>
      推流：把采集阶段封包好的音视频数据流传输到 ZEGO 实时音视频云的过程。
     </li>
     <li>
      拉流：从 ZEGO 实时音视频云将已有音视频数据流进行拉取的过程。
     </li>
    </ul>
    <h3>
     <a id="2__9">
     </a>
     2 前提条件
    </h3>
    <p>
     在实现基本的实时音视频功能之前，请确保：
    </p>
    <ul>
     <li>
      已在项目中集成 ZEGO Express SDK，详情请参考
      <a href="https://doc-zh.zego.im/article/199?source=csdn&amp;article13" rel="nofollow">
       快速开始 - 集成
      </a>
      。
     </li>
     <li>
      已在
      <a href="https://console.zego.im?source=csdn&amp;article13" rel="nofollow">
       ZEGO 控制台
      </a>
      创建项目，申请有效的 AppID 和 AppSign，详情请参考
      <a href="https://doc-zh.zego.im/article/1265?source=csdn&amp;article13" rel="nofollow">
       控制台 - 项目管理
      </a>
      。
     </li>
    </ul>
    <h3>
     <a id="3__16">
     </a>
     3 示例源码下载
    </h3>
    <p>
     请参考
     <a href="https://doc-zh.zego.im/article/3211?source=csdn&amp;article13" rel="nofollow">
      下载示例源码
     </a>
     获取源码。
    </p>
    <p>
     相关源码请查看 “/express-demo-web/src/Examples/Framework/Vue” 目录下的文件。
    </p>
    <h3>
     <a id="4__21">
     </a>
     4 使用步骤
    </h3>
    <p>
     当前项目使用的 Node 版本为 14.17.3，Vue 版本为 2.4.2。
    </p>
    <p>
     以用户 A 拉取用户 B 的流为例，流程如下图：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/4e99217a00b03b33e4b5b414f867759b.png"/>
    </p>
    <p>
     整个推拉流过程的 API 调用时序如下图：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/f7212dd4da53d28d8f76b0af57e4ee39.png"/>
    </p>
    <h4>
     <a id="41__41">
     </a>
     4.1 创建引擎
    </h4>
    <p>
     <strong>
      1. 创建界面
     </strong>
    </p>
    <p>
     在创建引擎之前，推荐开发者添加以下界面元素，方便实现基本的实时音视频功能。
    </p>
    <ul>
     <li>
      本地预览窗口
     </li>
     <li>
      远端视频窗口
     </li>
     <li>
      结束按钮
     </li>
    </ul>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/c358fff7dfa0532ce685162164107899.png"/>
    </p>
    <p>
     <strong>
      2. 创建引擎
     </strong>
    </p>
    <p>
     创建
     <code>
      ZegoExpressEngine
     </code>
     引擎实例，将申请到的 AppID 传入参数 “appID”，将接入服务器地址传入参数 “server”。
    </p>
    <p>
     “server” 为接入服务器地址，获取方式如下：
    </p>
    <ol>
     <li>
      登录
      <a href="https://console.zego.im?source=csdn&amp;article13" rel="nofollow">
       ZEGO 控制台
      </a>
      。
     </li>
     <li>
      在对应项目下单击“查看”。
     </li>
     <li>
      进入“项目配置”界面，在“项目信息”页签的“配置信息”中，单击 “ServerSecret” 后面的小眼睛按钮即可获取对应的接入服务器地址。
     </li>
    </ol>
    <p>
     在 “/express-demo-web/src/Examples/Framework/Vue/index.html” 文件中引入 vue.js。
    </p>
    <pre><code class="prism language-html">// 引入 vue.js
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.bootcdn.net/ajax/libs/vue/2.4.2/vue.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     初始化实例。
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    el<span class="token operator">:</span><span class="token string">'#page-wrapper'</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        zg<span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">createZegoExpressEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>zg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZegoExpressEngine</span><span class="token punctuation">(</span>appID<span class="token punctuation">,</span> server<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      3. 监听事件回调
     </strong>
    </p>
    <p>
     如果需要注册回调，开发者可根据实际需要，实现 ZegoEvent（包含
     <code>
      ZegoRTCEvent
     </code>
     和
     <code>
      ZegoRTMEvent
     </code>
     ）中的某些方法，创建引擎后可通过调用
     <code>
      on
     </code>
     接口设置回调。
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'roomStateChanged'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">roomID<span class="token punctuation">,</span> reason<span class="token punctuation">,</span> errorCode<span class="token punctuation">,</span> extendData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>Logining<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 登录中</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>Logined<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 登录成功</span>
            <span class="token comment">//只有当房间状态是登录成功或重连成功时，推流（startPublishingStream）、拉流（startPlayingStream）才能正常收发音视频</span>
            <span class="token comment">//将自己的音视频流推送到 ZEGO 音视频云</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>LoginFailed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 登录失败</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>Reconnecting<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 重连中</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>Reconnected<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 重连成功</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>ReconnectFailed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 重连失败</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>Kickout<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 被踢出房间</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>Logout<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 登出成功</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>LogoutFailed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 登出失败</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="42__121">
     </a>
     4.2 检测兼容性
    </h4>
    <p>
     在实现推拉流功能之前，开发者可以调用
     <code>
      checkSystemRequirements
     </code>
     接口检测浏览器的兼容性。
    </p>
    <p>
     SDK 支持的浏览器兼容版本，请参考
     <a href="https://doc-zh.zego.im/article/3211#1_1?source=csdn&amp;article13" rel="nofollow">
      下载示例源码
     </a>
     中的 “1 准备环境”。
    </p>
    <pre><code class="prism language-js"><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">checkSystemRequirements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回的 result 为兼容性检测结果。 webRTC 为 true 时表示支持 webRTC，其他属性含义均可参考接口 API 文档</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// {<!-- --></span>
<span class="token comment">//   webRTC: true,</span>
<span class="token comment">//   customCapture: true,</span>
<span class="token comment">//   camera: true,</span>
<span class="token comment">//   microphone: true,</span>
<span class="token comment">//   videoCodec: { H264: true, H265: false, VP8: true, VP9: true },</span>
<span class="token comment">//   screenSharing: true,</span>
<span class="token comment">//   errInfo: {}</span>
<span class="token comment">// }</span>
</code></pre>
    <p>
     返回结果的各参数含义，请参考
     <code>
      ZegoCapabilityDetection
     </code>
     接口下的参数描述。
    </p>
    <h4>
     <a id="43__145">
     </a>
     4.3 登录房间
    </h4>
    <p>
     <strong>
      1. 生成 Token
     </strong>
    </p>
    <p>
     登录房间需要用于验证身份的 Token，获取方式请参考
     <a href="https://doc-zh.zego.im/article/7646?source=csdn&amp;article13" rel="nofollow">
      使用 Token 鉴权
     </a>
     。如需快速调试，可使用控制台生成临时 Token。
    </p>
    <p>
     <strong>
      2. 登录房间
     </strong>
    </p>
    <p>
     调用
     <code>
      loginRoom
     </code>
     接口，传入房间 ID 参数 “roomID”、“token” 和用户参数 “user”，根据实际情况传入参数 “config”，登录房间。
    </p>
    <ul>
     <li>
      在登录房间之前，请先注册登录房间后需要监听的所有回调。成功登录房间后，即可接收相关的回调。
     </li>
     <li>
      “roomID”、“userID” 和 “userName” 参数的取值都为自定义。
     </li>
     <li>
      “roomID” 和 “userID” 都必须唯一，建议开发者将 “userID” 设置为一个有意义的值，可将其与业务账号系统进行关联。
     </li>
    </ul>
    <pre><code class="prism language-javascript"><span class="token comment">// 登录房间，成功则返回 true</span>
<span class="token comment">// userUpdate 设置为 true 会开启监听 roomUserUpdate 回调，默认情况下不会开启该监听</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">loginRoom</span><span class="token punctuation">(</span>roomID<span class="token punctuation">,</span> token<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>userID<span class="token punctuation">,</span> userName<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>userUpdate<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      3. 监听登录房间后的事件回调
     </strong>
    </p>
    <p>
     根据实际应用需要，在登录房间前监听想要关注的事件通知，比如房间状态更新、用户状态更新、流状态更新等。
    </p>
    <ul>
     <li>
      <p>
       <code>
        roomStateChanged
       </code>
       ：房间状态更新回调。登录房间后，当房间连接状态发生变更（如出现房间断开、登录认证失败等情况），SDK 会通过该回调通知。
      </p>
     </li>
     <li>
      <p>
       <code>
        roomUserUpdate
       </code>
       ：用户状态更新回调。登录房间后，当房间内有用户新增或删除时，SDK 会通过该回调通知。
      </p>
      <p>
       只有调用
       <code>
        loginRoom
       </code>
       接口登录房间时传入
       <code>
        ZegoRoomConfig
       </code>
       配置，且 “userUpdate” 参数取值为 “true” 时，用户才能收到
       <code>
        roomUserUpdate
       </code>
       回调。
      </p>
     </li>
     <li>
      <p>
       <code>
        roomStreamUpdate
       </code>
       ：流状态更新回调。登录房间后，当房间内有用户新推送或删除音视频流时，SDK 会通过该回调通知。
      </p>
     </li>
     <li>
      <p>
       只有调用
       <code>
        loginRoom
       </code>
       接口登录房间时传入
       <code>
        ZegoRoomConfig
       </code>
       配置，且 “userUpdate” 参数取值为 “true” 时，用户才能收到
       <code>
        roomUserUpdate
       </code>
       回调。
      </p>
     </li>
     <li>
      <p>
       通常情况下，如果某个用户想要播放其他用户推送的视频，可以在收到流状态更新（新增）的回调中，调用
       <code>
        startPlayingStream
       </code>
       接口拉取远端推送的音视频流。
      </p>
     </li>
    </ul>
    <pre><code class="prism language-javascript"><span class="token comment">// 房间状态更新回调</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'roomStateChanged'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">roomID<span class="token punctuation">,</span> reason<span class="token punctuation">,</span> errorCode<span class="token punctuation">,</span> extendData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>Logining<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 登录中</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>Logined<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 登录成功</span>
            <span class="token comment">//只有当房间状态是登录成功或重连成功时，推流（startPublishingStream）、拉流（startPlayingStream）才能正常收发音视频</span>
            <span class="token comment">//将自己的音视频流推送到 ZEGO 音视频云</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>LoginFailed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 登录失败</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>Reconnecting<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 重连中</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>Reconnected<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 重连成功</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>ReconnectFailed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 重连失败</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>Kickout<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 被踢出房间</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>Logout<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 登出成功</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> ZegoRoomStateChangedReason<span class="token punctuation">.</span>LogoutFailed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 登出失败</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 用户状态更新回调</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'roomUserUpdate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">roomID<span class="token punctuation">,</span> updateType<span class="token punctuation">,</span> userList</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">roomUserUpdate: room </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>roomID<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, user </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>updateType <span class="token operator">===</span> <span class="token string">'ADD'</span> <span class="token operator">?</span> <span class="token string">'added'</span> <span class="token operator">:</span> <span class="token string">'left'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>userList<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 流状态更新回调</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'roomStreamUpdate'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">roomID<span class="token punctuation">,</span> updateType<span class="token punctuation">,</span> streamList<span class="token punctuation">,</span> extendedData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>updateType <span class="token operator">==</span> <span class="token string">'ADD'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 流新增，开始拉流</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>updateType <span class="token operator">==</span> <span class="token string">'DELETE'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 流删除，停止拉流</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="44__228">
     </a>
     4.4 推流
    </h4>
    <p>
     <strong>
      1. 创建流
     </strong>
    </p>
    <p>
     a. 开始推流前需要创建本端的音视频流，调用
     <code>
      createStream
     </code>
     接口，默认会采集摄像头画面和麦克风声音。
    </p>
    <p>
     调用
     <code>
      createStream
     </code>
     接口后，需要等待 ZEGO 服务器返回流媒体对象才能执行后续操作。
    </p>
    <p>
     HTML 上创建媒体流播放组件的容器
     <code>
      &lt;div&gt;
     </code>
     。
    </p>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>local-video<span class="token punctuation">"</span></span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token style language-css"><span class="token property">width</span><span class="token punctuation">:</span> 320px<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> 240px</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     创建流后播放媒体流。
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// 调用 createStream 接口后，需要等待 ZEGO 服务器返回流媒体对象才能执行后续操作</span>
<span class="token keyword">const</span> localStream <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">createStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建媒体流播放组件</span>
<span class="token keyword">const</span> localView <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">createLocalStreamView</span><span class="token punctuation">(</span>localStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// "local-video" 为容器 DOM 元素 ID。</span>
localView<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">"local-video"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>enableAutoplayDialog<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     b. 设置音视频采集参数
    </p>
    <p>
     可根据需要通过
     <code>
      createStream
     </code>
     接口中的如下属性设置音视频相关采集参数，详情可参考
     <a href="https://doc-zh.zego.im/article/3679?source=csdn&amp;article13" rel="nofollow">
      自定义视频采集
     </a>
     ：
    </p>
    <ul>
     <li>
      <p>
       <code>
        camera
       </code>
       ：摄像头麦克风采集流相关配置
      </p>
     </li>
     <li>
      <p>
       <code>
        screen
       </code>
       ：屏幕捕捉采集流相关配置
      </p>
     </li>
     <li>
      <p>
       <code>
        custom
       </code>
       ：第三方流采集相关配置
      </p>
     </li>
    </ul>
    <p>
     <strong>
      2. 开始推流
     </strong>
    </p>
    <p>
     调用
     <code>
      startPublishingStream
     </code>
     接口，传入流 ID 参数 “streamID” 和创建流得到的流对象 “localStream”，向远端用户发送本端的音视频流。
    </p>
    <ul>
     <li>
      “streamID” 参数的取值为自定义，需要在整个 AppID 内全局唯一。
     </li>
     <li>
      若需要推多条流，则多次调用
      <code>
       startPublishingStream
      </code>
      接口即可，需确保每条流的 “streamID” 不相同。
     </li>
    </ul>
    <pre><code class="prism language-javascript"><span class="token comment">// localStream 为创建流获取的 MediaStream 对象</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">startPublishingStream</span><span class="token punctuation">(</span>streamID<span class="token punctuation">,</span> localStream<span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      3. 监听推流后的事件回调
     </strong>
    </p>
    <p>
     根据实际应用需要，在推流后监听想要关注的事件通知，比如推流状态更新、推流质量等。
    </p>
    <ul>
     <li>
      <code>
       publisherStateUpdate
      </code>
      ：推流状态更新回调。调用推流接口成功后，当推流状态发生变更（如出现网络中断导致推流异常等情况），SDK 在重试推流的同时，会通过该回调通知。
     </li>
     <li>
      <code>
       publishQualityUpdate
      </code>
      ：推流质量回调。调用推流接口成功后，定时回调音视频流质量数据（如分辨率、帧率、码率等）。
     </li>
    </ul>
    <pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'publisherStateUpdate'</span><span class="token punctuation">,</span> <span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 推流状态更新回调</span>
    <span class="token comment">// ... </span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'publishQualityUpdate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">streamID<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 推流质量回调</span>
    <span class="token comment">// ... </span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="45__297">
     </a>
     4.5 拉流
    </h4>
    <p>
     <strong>
      1. 开始拉流
     </strong>
    </p>
    <p>
     调用
     <code>
      startPlayingStream
     </code>
     接口，根据传入的流 ID 参数 “streamID”，拉取远端已推送到 ZEGO 服务器的音视频画面。
    </p>
    <p>
     远端用户推送的 “streamID” 可以从
     <code>
      roomStreamUpdate
     </code>
     回调中获得。
    </p>
    <p>
     HTML 上创建媒体流播放组件的容器
     <code>
      &lt;div&gt;
     </code>
     。
    </p>
    <pre><code>&lt;div id="remote-video" style="width: 320px;height: 240px"&gt;&lt;/div&gt;
</code></pre>
    <p>
     将拉取到远端流在界面播放。
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">const</span> remoteStream <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">startPlayingStream</span><span class="token punctuation">(</span>streamID<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建媒体流播放组件</span>
<span class="token keyword">const</span> remoteView <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">createRemoteStreamView</span><span class="token punctuation">(</span>remoteStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
remoteView<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">"remote-video"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>enableAutoplayDialog<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     “streamID” 需要在整个 AppID 内全局唯一。
    </p>
    <p>
     <strong>
      2. 监听拉流后的事件回调
     </strong>
    </p>
    <p>
     根据实际应用需要，在拉流后监听想要关注的事件通知，如拉流状态变更、拉流质量等。
    </p>
    <ul>
     <li>
      <code>
       playerStateUpdate
      </code>
      ：拉流状态更新回调。调用拉流接口成功后，当拉流状态发生变更（如出现网络中断导致推流异常等情况），SDK 在重试推流的同时，会通过该回调通知。
     </li>
     <li>
      <code>
       playQualityUpdate
      </code>
      ：拉流质量回调。调用拉流接口成功后，定时回调音视频流质量数据（如分辨率、帧率、码率等）。
     </li>
    </ul>
    <pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'playerStateUpdate'</span><span class="token punctuation">,</span> <span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 拉流状态更新回调</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'playQualityUpdate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">streamID<span class="token punctuation">,</span>stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 拉流质量回调</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="46__342">
     </a>
     4.6 体验实时音视频功能
    </h4>
    <p>
     在真机中运行项目，运行成功后，可以看到本端视频画面。
    </p>
    <p>
     为方便体验，ZEGO 提供了一个
     <a href="https://zegodev.gitee.io/zego-express-webrtc-sample/assistDev/index.html?source=csdn&amp;article13" rel="nofollow">
      Web 端调试示例
     </a>
     ，在该页面下，输入相同的 AppID、RoomID，输入一个不同的 UserID，即可加入同一房间与真机设备互通。当成功开始音视频通话时，可以听到远端的音频，看到远端的视频画面。
    </p>
    <h4>
     <a id="47__349">
     </a>
     4.7 停止推拉流
    </h4>
    <p>
     <strong>
      1. 停止推流
     </strong>
    </p>
    <p>
     调用
     <code>
      stopPublishingStream
     </code>
     接口停止向远端用户发送本端的音视频流。
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">stopPublishingStream</span><span class="token punctuation">(</span>streamID<span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      2. 销毁流
     </strong>
    </p>
    <p>
     调用
     <code>
      destroyStream
     </code>
     接口销毁创建的流数据，销毁流后开发需自行销毁 video（停止采集）。
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// localStream 是调用 createStream 接口获取的 MediaStream 对象</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">destroyStream</span><span class="token punctuation">(</span>localStream<span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      3. 停止拉流
     </strong>
    </p>
    <p>
     调用
     <code>
      stopPlayingStream
     </code>
     接口停止拉取远端推送的音视频流。
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">stopPlayingStream</span><span class="token punctuation">(</span>streamID<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="48__376">
     </a>
     4.8 退出房间
    </h4>
    <p>
     调用
     <code>
      logoutRoom
     </code>
     接口退出房间。
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>zg<span class="token punctuation">.</span><span class="token function">logoutRoom</span><span class="token punctuation">(</span>roomID<span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_384">
     </a>
     获取更多支持
    </h3>
    <ul>
     <li>
      获取本文的Demo、开发文档、技术支持，访问
      <a href="https://doc-zh.zego.im/article/5416?source=csdn&amp;article13" rel="nofollow">
       即构文档中心
      </a>
     </li>
     <li>
      近期有开发规划的开发者可上即构官网查看，恰逢即构七周年全线音视频产品1折的优惠，
      <a href="https://www.zego.im/cluesCollect?source=csdn&amp;article13" rel="nofollow">
       联系商务
      </a>
      获取RTC产品优惠；
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f7a65676f5f303631362f:61727469636c652f64657461696c732f313335393131343833" class_="artid" style="display:none">
 </p>
</div>


