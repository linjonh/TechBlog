---
layout: post
title: "前端教程如何监控网页的卡顿"
date: 2024-12-10 08:26:46 +0800
description: "要监控网页的卡顿，我们必须从 FPS 说起。FPS 是来自视频或者游戏里的概念，即是每秒的帧数，代表"
keywords: "网页卡顿和fps有什么关联吗"
categories: ['']
tags: ['编程语言', '游戏', 'Java', 'Html', 'Html']
artid: "105628530"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=105628530
    alt: "前端教程如何监控网页的卡顿"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【前端教程】如何监控网页的卡顿？
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     要监控网页的卡顿，我们必须从 FPS 说起。
    </p>
    <p>
     FPS 是来自视频或者游戏里的概念，即是每秒的帧数，代表视频或者游戏的流畅度，俗话说，就是“不卡”。
    </p>
    <p>
     那在前端开发领域，网页的 FPS 是什么呢？
    </p>
    <h3>
     <a id="_FPShttpsqianduangroupposts5b41dbb29fd64d5a7458a904fps_6">
     </a>
     什么是网页的 FPS？
     <a href="https://qianduan.group/posts/5b41dbb29fd64d5a7458a904#-fps-" rel="nofollow">
     </a>
    </h3>
    <p>
     网页内容在不断变化之中，网页的 FPS 是只浏览器在渲染这些变化时的帧率。帧率越高，用户感觉网页越流畅，反之则会感觉卡顿。
    </p>
    <p>
     在 Chrome 中
     <a href="https://developer.chrome.com/devtools/docs/rendering-settings" rel="nofollow">
      可以通过开发者工具查看网页的 FPS
     </a>
     ：
    </p>
    <p>
     <img alt="Screen Shot 2018-07-08 at 9.31.06 PM.3edc09e644f6.png" src="https://i-blog.csdnimg.cn/blog_migrate/a6b798972dc14fd9f36be3ab79a7e57a.png"/>
    </p>
    <blockquote>
     <p>
      注意，网页不是随时都需要，该工具看到的是每次更新是 FPS 值。
     </p>
    </blockquote>
    <p>
     最优的帧率是 60，即16.5ms 左右渲染一次。
    </p>
    <p>
     通过 Chrome 或者 Firfox 等的性能工具也可以查看浏览器的帧率：
    </p>
    <p>
     <img alt="Screen Shot 2018-07-08 at 9.50.08 PM.1c961c8bd7e4.png" src="https://i-blog.csdnimg.cn/blog_migrate/bbfcdd0fd5f293f4430d2933ede94e40.png"/>
    </p>
    <blockquote>
     <p>
      绿色的直方图即代表在页面重新绘制时的帧率，Frames 为每一帧渲染所花的时间。
     </p>
    </blockquote>
    <h3>
     <a id="_FPS_httpsqianduangroupposts5b41dbb29fd64d5a7458a904fps_24">
     </a>
     另外一种给出网页 FPS 的方式
     <a href="https://qianduan.group/posts/5b41dbb29fd64d5a7458a904#-fps-" rel="nofollow">
     </a>
    </h3>
    <p>
     <a href="https://chrome.google.com/webstore/detail/fps-extension/gdkkmimldhefhmmmlalioafomdlahcog" rel="nofollow">
      FPS extension
     </a>
     是 Chrome 的一个扩展，可以显示当前网页的 FPS 值，即页面是否卡顿。
    </p>
    <p>
     <img alt="Screen Shot 2018-07-08 at 10.02.23 PM.68659bdf8169.png" src="https://i-blog.csdnimg.cn/blog_migrate/9adca465f1f4d7621ac1ef27b3342dd1.png"/>
    </p>
    <p>
     这种工具获取页面 FPS 的方式与浏览器自身给出的方式不同，没有采用浏览器原生的 API（
     <a href="http://wicg.github.io/frame-timing/" rel="nofollow">
      正在制定
     </a>
     ），这类工具独辟蹊径，通过浏览器的 requestAnimationFrame API （可以使用 setInterval polyfill）来实现。
    </p>
    <p>
     代码类似：
    </p>
    <pre><code>var lastTime = performance.now();
var frame = 0;
var lastFameTime = performance.now();

var loop = function(time) {
    var now =  performance.now();
    var fs = (now - lastFameTime);
    lastFameTime = now;
    var fps = Math.round(1000/fs);
    frame++;
    if (now &gt; 1000 + lastTime) {
        var fps = Math.round( ( frame * 1000 ) / ( now - lastTime ) );
        frame = 0;    
        lastTime = now;    
    };           
    window.requestAnimationFrame(loop);   
}

</code></pre>
    <blockquote>
     <p>
      代码摘自淘宝前端团队的
      <a href="http://taobaofed.org/blog/2016/01/13/measuring-fps/" rel="nofollow">
       《无线性能优化：FPS 测试》
      </a>
      。
     </p>
    </blockquote>
    <p>
     通俗地解释就是，通过 requestAnimationFrame API 来定时执行一些 JS 代码，如果浏览器卡顿，无法很好地保证渲染的频率，1s 中 frame 无法达到 60 帧，即可间接地反映浏览器的渲染帧率。关于 requestAnimationFrame API 的细节，可以参看
     <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame" rel="nofollow">
      MDN 上的文档
     </a>
     。
    </p>
    <h3>
     <a id="httpsqianduangroupposts5b41dbb29fd64d5a7458a904_59">
     </a>
     如何监控网页的卡顿？
     <a href="https://qianduan.group/posts/5b41dbb29fd64d5a7458a904#-" rel="nofollow">
     </a>
    </h3>
    <p>
     首先为什么要监控？比如在
     <a href="https://www.quanmin.tv/" rel="nofollow">
      全民直播
     </a>
     ，我们必须重视用户在观看视频的体验，任何网页或者播放器的卡顿都会让用户抓狂。所以必须监控起来，以此来指导优化。
    </p>
    <p>
     最后，回到本文的主题，如何监控网页的卡顿呢？
    </p>
    <p>
     以全民直播的方式为例，使用 FPS extension 类似的方式，每秒中计算一次网页的 FPS 值，获得一列数据：
    </p>
    <p>
     …6,8,11,29,60,58,46,57,57,57,44,59,51,54,0,31,58,56,41,52,51,17,22, 34,51,48,26,26,49,59,59,59,59,52,52,0,45,58,60,59,60,21…
    </p>
    <p>
     然后通过通用的日志通道上报到大数据平台进行分析即可。
    </p>
    <p>
     那如何通过 FPS 确定网页存在卡顿呢？按照我们对卡顿的观察，
     <strong>
      连续出现3个低于20的 FPS
     </strong>
     即可认为网页存在卡顿。
    </p>
    <pre><code>function isBlocking(fpsList, below, last) {
  var count = 0
  for(var i = 0; i &lt; fpsList.length; i++) {
    if (fpsList[i] &amp;&amp; fpsList[i] &lt; below) {
      count++;
    } else {
      count = 0
    }
    if (count &gt;= last) {
      return true
    }
  }
  return false
}

</code></pre>
    <blockquote>
     <p>
      当然这只是一种经验，但可以作为相对的度量。
     </p>
    </blockquote>
    <p>
     通过这种方式，我们得到了网页卡顿的统计数据：
    </p>
    <p>
     <img alt="a.61d8fb124a76.png" src="https://i-blog.csdnimg.cn/blog_migrate/380d501177293341c65d97f0a18cf4c9.png"/>
    </p>
    <p>
     接下来，就可以针对卡顿的问题，在有数据支持的情况下进行优化我们的网页了！
    </p>
    <h3>
     <a id="_100">
     </a>
     服务推荐
    </h3>
    <ul>
     <li>
      <a href="https://proxy.horocn.com/" rel="nofollow">
       蜻蜓代理
      </a>
     </li>
     <li>
      <a href="https://proxy.horocn.com/" rel="nofollow">
       ip代理
      </a>
     </li>
     <li>
      <a href="https://proxy.horocn.com/" rel="nofollow">
       代理ip
      </a>
     </li>
     <li>
      <a href="https://proxy.horocn.com/" rel="nofollow">
       ip代理服务器
      </a>
     </li>
     <li>
      <a href="https://proxy.horocn.com/" rel="nofollow">
       国内ip代理
      </a>
     </li>
     <li>
      <a href="https://proxy.horocn.com/" rel="nofollow">
       代理服务ip
      </a>
     </li>
     <li>
      <a href="https://proxy.horocn.com/" rel="nofollow">
       最新代理服务器
      </a>
     </li>
     <li>
      <a href="https://proxy.horocn.com/" rel="nofollow">
       代理ip网
      </a>
     </li>
     <li>
      <a href="https://proxy.horocn.com/" rel="nofollow">
       中国代理服务器
      </a>
     </li>
     <li>
      <a href="https://proxy.horocn.com/" rel="nofollow">
       付费代理
      </a>
     </li>
     <li>
      <a href="https://proxy.horocn.com/" rel="nofollow">
       企业级ip
      </a>
     </li>
     <li>
      <a href="https://proxy.horocn.com/" rel="nofollow">
       企业级代理ip
      </a>
     </li>
     <li>
      <a href="https://proxy.horocn.com/" rel="nofollow">
       中国代理ip
      </a>
     </li>
     <li>
      <a href="https://proxy.horocn.com/" rel="nofollow">
       最新代理ip
      </a>
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34373134333231302f:61727469636c652f64657461696c732f313035363238353330" class_="artid" style="display:none">
 </p>
</div>


