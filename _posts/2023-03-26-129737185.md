---
layout: post
title: "APPPC客户端抓包小程序公众号"
date: 2023-03-26 15:46:53 +0800
description: "微信小程序、公众号抓包，手机端APP、PC客户端抓包_微信公众号抓包"
keywords: "微信公众号抓包"
categories: ['抓包']
tags: ['网络', '小程序']
artid: "129737185"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=129737185
    alt: "APPPC客户端抓包小程序公众号"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     APP、PC客户端抓包、小程序\公众号
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      APP、小程序、公众号抓包
     </h4>
     <ul>
      <li>
       <a href="#APP_1" rel="nofollow">
        一、APP抓包
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#BurpSuiteHTTP_3" rel="nofollow">
          （一）BurpSuite抓取手机HTTP数据包
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#1IP_9" rel="nofollow">
            1、配置代理IP与端口
           </a>
          </li>
          <li>
           <a href="#2_25" rel="nofollow">
            2、测试
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#BurpSuiteHTTPS_41" rel="nofollow">
          （二）BurpSuite抓取手机HTTPS数据包
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#1_43" rel="nofollow">
            1、安装证书
           </a>
          </li>
          <li>
           <a href="#2_66" rel="nofollow">
            2、测试
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#_78" rel="nofollow">
          （三）抓不到包？
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#1_81" rel="nofollow">
            1、原因
           </a>
          </li>
          <li>
           <a href="#2_88" rel="nofollow">
            2、解决思路
           </a>
          </li>
          <li>
           <a href="#3_94" rel="nofollow">
            3、解决过程
           </a>
          </li>
         </ul>
        </li>
       </ul>
      </li>
      <li>
       <a href="#PC_130" rel="nofollow">
        二、抓取PC端第三方软件数据包
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_141" rel="nofollow">
          流程演示：
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#1_142" rel="nofollow">
            1、安装证书
           </a>
          </li>
          <li>
           <a href="#2Proxifier_147" rel="nofollow">
            2、搭建配置Proxifier
           </a>
          </li>
          <li>
           <a href="#3_198" rel="nofollow">
            3、测试
           </a>
          </li>
         </ul>
        </li>
       </ul>
      </li>
      <li>
       <a href="#BurpSuite_205" rel="nofollow">
        三、BurpSuite抓取微信小程序/公众号数据包
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_213" rel="nofollow">
          流程演示：
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#1_215" rel="nofollow">
            1、安装证书
           </a>
          </li>
          <li>
           <a href="#2Proxifier_225" rel="nofollow">
            2、Proxifier搭建
           </a>
          </li>
          <li>
           <a href="#3_260" rel="nofollow">
            3、测试
           </a>
          </li>
         </ul>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="APP_1">
     </a>
     一、APP抓包
    </h2>
    <h3>
     <a id="BurpSuiteHTTP_3">
     </a>
     （一）BurpSuite抓取手机HTTP数据包
    </h3>
    <p>
     思路：本地主机作为手机的代理服务器，手机APP发送的数据包会直接发给代理服务器，再由代理服务器进行转发。
    </p>
    <p>
     准备工作：手机与本地主机连上同一wifi
    </p>
    <h4>
     <a id="1IP_9">
     </a>
     1、配置代理IP与端口
    </h4>
    <p>
     查看主机IP
     <br/>
     可以在主机使用win+R调出运行框，输入命令cmd进入命令提示符界面，输入ipconfig查看IP：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/bda9db6090b9d3ba39132003ff04c83d.png">
      <br/>
      查看手机IP是否正常配置
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e5e07596d1d048a31fc807b4d6fd64ee.png">
       <br/>
       测试连通性
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f628c3e21c61a55f9761e0ebc405374a.png">
        <br/>
        在手机上设置代理：
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e07bad3ece992338325a7d06b4c6912c.png">
         <br/>
         在BurpSuite设置拦截经过本地主机的数据包：
         <br/>
         打开BurpSuite依次点击：Proxy - Options - Add 添加一个监听IP与端口（端口和IP与手机端添加的代理一致）
         <br/>
         <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d7049f9cfb0f620762de0b80de321202.png">
          <br/>
          设置好了后，在“Proxy - Intercept 下开启“Intercept is on”就可以对安卓APP的网络数据进行抓包了
          <br/>
          <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c8ee90eff240900ca048245131f0b16b.png"/>
         </img>
        </img>
       </img>
      </img>
     </img>
    </p>
    <h4>
     <a id="2_25">
     </a>
     2、测试
    </h4>
    <p>
     手机端随便打开一个app，就会发现数据已经抓到，可以在HTTP history查看
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/64ea8ac4137c82364fdc443d750f927c.png"/>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e9a014952f53ab3b9a4717015784eafe.png"/>
    </p>
    <h3>
     <a id="BurpSuiteHTTPS_41">
     </a>
     （二）BurpSuite抓取手机HTTPS数据包
    </h3>
    <p>
     抓取HTTPS包需要导入Burp的证书。特别注意：一个Burp对应一个证书，就是用哪个Burp抓包就导出哪个的证书，并将该证书在手机上安装。
    </p>
    <h4>
     <a id="1_43">
     </a>
     1、安装证书
    </h4>
    <p>
     有两种方法导出证书：
     <br/>
     一是直接在BurpSuite导出证书，二是手机端直接访问代理服务器的IP加端口
     <br/>
     方法一：
     <br/>
     依次点击 Proxy - Options 选中代理项，点击import\export CA
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0a5c9aa3f8c6f4d8a67c853ebbdd2ff4.png"/>
     <br/>
     选择第一个，然后点击Next
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/47e43a66c7fc21cf1e4682b73fc21f19.png"/>
     <br/>
     选择保存CA证书的路径，注意文件后缀命名为.cer，因为手机只能安装.cer的证书类型，默认的der格式是不能被识别安装的。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/bcf32a40dd0ba2ce4f8732936cd6aadd.png"/>
     <br/>
     方法二：
     <br/>
     手机访问代理服务器192.168.1.5:8888，点击CA Certificate 进行证书的下载
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5526f67fd46153f47a05ad4c2d143ef9.png"/>
     <br/>
     在手机端下载完证书后，依次点击 设置 - 安全 - 从SD卡安装
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/fb6083bba02e9239301661cb9ddbb2b1.png"/>
     <br/>
     找到证书下载的位置点击进行安装
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2808b221f1270d2ba855920b22750168.png"/>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/758e9b34c98b7cffe3037b6bcf7ca555.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7c2242c6136180c8326e13a7fbd7590d.png"/>
     <br/>
     安装完成后可以在 设置 - 安全 - 信任的凭据 看到。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/42fa6994bb41f78506a8f6172c9bc7d0.png"/>
    </p>
    <h4>
     <a id="2_66">
     </a>
     2、测试
    </h4>
    <p>
     随便打开一个APP或者用HTTPS协议访问任意网站
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1cb58efda9e51351d78c116266fc7b26.png"/>
    </p>
    <p>
     成功抓取到数据包
    </p>
    <h3>
     <a id="_78">
     </a>
     （三）抓不到包？
    </h3>
    <p>
     <a href="https://www.cnblogs.com/NoId/p/16500110.html" rel="nofollow">
      参考文档 https://www.cnblogs.com/NoId/p/16500110.html
     </a>
    </p>
    <h4>
     <a id="1_81">
     </a>
     1、原因
    </h4>
    <blockquote>
     <p>
      一般情况下手机在安装了BurpSuite的伪证书后，是可以抓大部分APP数据包的，但APP在安卓7.0或更高的系统下，无法抓取数据包，原因是从安卓7.0开始应用只会信任系统预装的CA证书，而不会信任用户安装的CA证书。
     </p>
    </blockquote>
    <blockquote>
     <p>
      这种的情况下，一个解决方法就是使用低于7.0版本的安卓系统进行抓包，另一个就是把使用的伪证书安装到系统证书目录中，伪装成系统证书。
     </p>
    </blockquote>
    <p>
     下面演示将使用的伪证书安装到系统证书目录中的方法和过程。此方法也适用于抓取微信小程序的数据包。
    </p>
    <h4>
     <a id="2_88">
     </a>
     2、解决思路
    </h4>
    <blockquote>
     <p>
      1 使用openssl将der证书转为pem证书，生成pem证书的hash，生成要使用的证书。
     </p>
     <p>
      2 使用adb调试功能，将证书放到系统证书目录中。
     </p>
    </blockquote>
    <h4>
     <a id="3_94">
     </a>
     3、解决过程
    </h4>
    <p>
     在安卓7.0或者更高的系统下，如果是只把burp证书装到了用户证书中，APP打开后无法正常使用
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e608abd75287304ed3506ef2e999b479.png"/>
     <br/>
     如下，APP加载不出来
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/738c99a24055ace0c5968dae067570c0.png"/>
    </p>
    <p>
     在手机端导出证书（方法和前面一样）
     <br/>
     打开kali终端，依次执行以下命令：
     <br/>
     将导出的证书转pem证书:
    </p>
    <blockquote>
     <p>
      penssl x509 -inform der -in burp.der -out burp.pem
     </p>
    </blockquote>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5d5f30ef1c07e5deea92426828f631b8.png"/>
     <br/>
     生成pem证书的hash：
    </p>
    <blockquote>
     <p>
      openssl x509 -inform PEM -subject_hash_old -in burp.pem
     </p>
    </blockquote>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7b9c40e0da86564c846cf80f779ce8ee.png"/>
    </p>
    <p>
     重命名/复制证书： (将证书文件重命名为“Hash值.0”，如下)
    </p>
    <blockquote>
     <p>
      cp burp.pem 9a5ba575.0
     </p>
    </blockquote>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/da3784e1e8e2bf9f6b50fb693073db28.png"/>
    </p>
    <p>
     之后将证书文件导出，然后上传到手机端的 /system/security/cacerts/ 目录下
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/689315da8f51d23dc0d58390fd8ab3b5.png"/>
    </p>
    <p>
     赋权：长按文件点击属性，下滑，点击权限，给证书文件644权限
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/37c197433eb8104fc4c86a8711202498.png"/>
    </p>
    <p>
     这样就可以正常抓包，正常使用APP内的内容
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/8aaf9b1bddad77c5c769205475da0bde.png"/>
    </p>
    <h2>
     <a id="PC_130">
     </a>
     二、抓取PC端第三方软件数据包
    </h2>
    <p>
     PC客户端的第三方软件一般不支持代理，除了个别会在软件内设置有代理功能，如百度网盘
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/8f9d9443ded1905e00e6e5c3cd346f1c.png"/>
     <br/>
     所以要使用
     <strong>
      Proxifier
     </strong>
     工具，用于解决代理问题。
     <br/>
     关于Proxifier
    </p>
    <blockquote>
     <p>
      Proxifier是一款功能非常强大的socks5客户端，可以让不支持通过代理服务器工作的网络程序能通过HTTPS或SOCKS代理或代理链。
      <br/>
      由于一般的C/S客户端不能设置代理，所以我们FIddler检测不到数据，我们可以通过Proxifer来实现把所有的请求抓发给Fiddler，这样我们就可以在Fiddler分析客户端请求。
     </p>
    </blockquote>
    <p>
     思路：
     <br/>
     使用proxifier添加一台代理服务器，这里是本地主机作为代理服务器，数据包会先经过本地主机，然后使用BurpSuite监听或拦截经过主机的数据。
    </p>
    <h3>
     <a id="_141">
     </a>
     流程演示：
    </h3>
    <h4>
     <a id="1_142">
     </a>
     1、安装证书
    </h4>
    <p>
     首先跟前面手机APP抓包一样，导出证书到本地主机，将导出的证书在本地主机进行安装。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4615f7e424a119d35064f74a2c387d6d.png"/>
     <br/>
     一路点击下一步到结束，将证书成功安装。
    </p>
    <h4>
     <a id="2Proxifier_147">
     </a>
     2、搭建配置Proxifier
    </h4>
    <p>
     ①为proxifier添加代理服务器
    </p>
    <p>
     打开proxifier，点击 配置文件 - 配置代理服务器
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/57942aaf74a96010d1f0387ae1bacabe.png"/>
    </p>
    <p>
     添加代理服务器
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/8fba1e8e530075046161c13e45b47cf3.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b86a8e52cd215628784d2f25598deb20.png"/>
    </p>
    <p>
     ②打开任务管理器，选择客户端进程，找到所在程序目录
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/162c32b95d724926a04da7694289a0a8.png"/>
    </p>
    <p>
     复制该程序的路径
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9b05bb7775f331c6e16a7dfd8a42ac8e.png"/>
    </p>
    <p>
     ③配置代理规则
     <br/>
     点击 选择配置文件 - 配置代理规则
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/454faaa2d2f915328673b9d04496a145.png"/>
    </p>
    <p>
     将默认规则勾选为Direct，然后点击添加
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c1613984bc5d0ab8bf907f494bfa6359.png"/>
     <br/>
     Direct表示数据包直接通过，也可以设置代理，走代理服务器
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ce4766a9d6594329ce5ae2e030c13a9e.png"/>
    </p>
    <p>
     点击浏览，找到复制的路径所在的目录，选择程序
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/14b7481ab9285b324ea8e099ba645aef.png"/>
    </p>
    <p>
     最后选择代理拦截
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/de8ae5800d8b42d55401c873e5364831.png"/>
    </p>
    <p>
     ④启动代理支持
     <br/>
     依次点击 高级 - HTTP代理服务器
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/bb5e4d048dfcb655837ba7fcdb27b689.png"/>
    </p>
    <p>
     勾选 启用HTTP代理服务器支持 功能
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5b078796cd31e8aa334eab75397a4da8.png"/>
    </p>
    <p>
     重新勾选BurpSuite代理选项，就可以抓包了
    </p>
    <h4>
     <a id="3_198">
     </a>
     3、测试
    </h4>
    <p>
     随便点击播放音乐
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2be50cc5626b035a968a7da409ca364d.png"/>
    </p>
    <p>
     成功抓包
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d633866dd026b931b6af071abb841a72.png"/>
    </p>
    <h2>
     <a id="BurpSuite_205">
     </a>
     三、BurpSuite抓取微信小程序/公众号数据包
    </h2>
    <p>
     <a href="https://blog.csdn.net/weixin_45031612/article/details/127416319">
      参考文档：https://blog.csdn.net/weixin_45031612/article/details/12741631
     </a>
    </p>
    <p>
     抓取微信小程序/公众号的包需要抓取指定程序的包，可以在PC端登录微信，这样方便些，在PC端操作就要使用Proxifier工具，用于解决代理问题。
    </p>
    <p>
     下面以小程序抓包作为示例
    </p>
    <h3>
     <a id="_213">
     </a>
     流程演示：
    </h3>
    <h4>
     <a id="1_215">
     </a>
     1、安装证书
    </h4>
    <p>
     首先跟前面手机APP抓包一样，导出证书到本地主机，因为这次是微信小程序抓包，可以直接在本地主机登录微信进行抓包。
     <br/>
     将导出的证书在本地主机进行安装
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4615f7e424a119d35064f74a2c387d6d.png"/>
    </p>
    <p>
     一路点击下一步到结束，将证书成功安装。
    </p>
    <h4>
     <a id="2Proxifier_225">
     </a>
     2、Proxifier搭建
    </h4>
    <p>
     ①添加代理服务器
     <br/>
     打开proxifier，点击 配置文件 - 配置代理服务器
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/57942aaf74a96010d1f0387ae1bacabe.png"/>
    </p>
    <p>
     添加代理服务器
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/8fba1e8e530075046161c13e45b47cf3.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/fdf19a08bb333a7e64b6f45ab5c0bd35.png"/>
    </p>
    <p>
     ②配置代理规则
     <br/>
     点击 选择配置文件 - 配置代理规则
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/20785c303a7d0d50b7e97fbcaa153891.png"/>
    </p>
    <p>
     将默认规则勾选为Direct
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d963b1f42fd9f2a725bdbe88e7d7dca2.png"/>
     <br/>
     默认规则勾选为Direct是为了不影响除测试程序外的其它程序的正常上网。
    </p>
    <p>
     ③打开任务管理器，选择小程序进程，找到所在程序目录
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/48fd9baabc736d8e03ce21c597f1380b.png"/>
    </p>
    <p>
     复制路径打开Proxifier添加代理规则，将微信的应用添加上，设置走刚刚添加的代理服务器
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/993c583b3bc119f615e8cb02336d416f.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/33206519e7d55d0050a7db2b0bfe91da.png"/>
    </p>
    <h4>
     <a id="3_260">
     </a>
     3、测试
    </h4>
    <p>
     打开任意一个小程序，成功抓取到数据包
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4464429ad5c1ceecbbe6553392ca4071.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f35393535343933372f:61727469636c652f64657461696c732f313239373337313835" class_="artid" style="display:none">
 </p>
</div>


