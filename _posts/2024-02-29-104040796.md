---
layout: post
title: "微信小程序-实现元素渐入渐出动画效果-封装方法"
date: 2024-02-29 10:18:07 +0800
description: "效果解决1.寻根问底，发现wx_mini_program(下面称呼微信小程序为wxmp [差点叫成 "
keywords: "微信小程序移入移出动画"
categories: ["未分类"]
tags: ["小程序"]
artid: "104040796"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=104040796
  alt: "微信小程序-实现元素渐入渐出动画效果-封装方法"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微信小程序-实现元素渐入渐出动画效果-封装方法
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     效果
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/77cf5e274670c2a535160a47b4447b59.gif"/>
    </p>
    <h3>
     <a id="_7">
     </a>
     解决
    </h3>
    <p>
     1.寻根问底，发现wx_mini_program(下面称呼微信小程序为wxmp [差点叫成 (*´ﾉ皿`)mmp] )有一个全局的js逻辑文件，叫app.js，有意思，可以往里面塞自己写的object(函数数据等等)，那就从那里入手吧
     <br/>
     2.在app.js中定义全局的动画函数
    </p>
    <pre><code class="prism language-javascript"><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">//渐入，渐出实现 </span>
  show <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>that<span class="token punctuation">,</span>param<span class="token punctuation">,</span>opacity<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> animation <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createAnimation</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token comment">//持续时间800ms</span>
      duration<span class="token punctuation">:</span> <span class="token number">800</span><span class="token punctuation">,</span>
      timingFunction<span class="token punctuation">:</span> <span class="token string">'ease'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//var animation = this.animation</span>
    animation<span class="token punctuation">.</span><span class="token function">opacity</span><span class="token punctuation">(</span>opacity<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//将param转换为key</span>
    <span class="token keyword">var</span> json <span class="token operator">=</span> <span class="token string">'{"'</span> <span class="token operator">+</span> param <span class="token operator">+</span> <span class="token string">'":""}'</span>
    json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    json<span class="token punctuation">[</span>param<span class="token punctuation">]</span> <span class="token operator">=</span> animation<span class="token punctuation">.</span><span class="token keyword">export</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//设置动画</span>
    that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">//滑动渐入渐出</span>
slideupshow<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>that<span class="token punctuation">,</span>param<span class="token punctuation">,</span>px<span class="token punctuation">,</span>opacity<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">var</span> animation <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createAnimation</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
duration<span class="token punctuation">:</span> <span class="token number">800</span><span class="token punctuation">,</span>
timingFunction<span class="token punctuation">:</span> <span class="token string">'ease'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
animation<span class="token punctuation">.</span><span class="token function">translateY</span><span class="token punctuation">(</span>px<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">opacity</span><span class="token punctuation">(</span>opacity<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//将 param 转换为 key</span>
<span class="token keyword">var</span> json <span class="token operator">=</span> <span class="token string">'{"'</span> <span class="token operator">+</span> param <span class="token operator">+</span> <span class="token string">'":""}'</span>
json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
json<span class="token punctuation">[</span>param<span class="token punctuation">]</span> <span class="token operator">=</span> animation<span class="token punctuation">.</span><span class="token keyword">export</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//设置动画</span>
that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">//向右滑动渐入渐出</span>
sliderightshow<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>that<span class="token punctuation">,</span> param<span class="token punctuation">,</span> px<span class="token punctuation">,</span> opacity<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">var</span> animation <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createAnimation</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
duration<span class="token punctuation">:</span> <span class="token number">800</span><span class="token punctuation">,</span>
timingFunction<span class="token punctuation">:</span> <span class="token string">'ease'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
animation<span class="token punctuation">.</span><span class="token function">translateX</span><span class="token punctuation">(</span>px<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">opacity</span><span class="token punctuation">(</span>opacity<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//将 param 转换为 key</span>
<span class="token keyword">var</span> json <span class="token operator">=</span> <span class="token string">'{"'</span> <span class="token operator">+</span> param <span class="token operator">+</span> <span class="token string">'":""}'</span>
json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
json<span class="token punctuation">[</span>param<span class="token punctuation">]</span> <span class="token operator">=</span> animation<span class="token punctuation">.</span><span class="token keyword">export</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//设置动画</span>
that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p> 3.现在我们再看看调用这个函数的具体方法
<br/>
在 wxml 中，只需要设置 animation 绑定即可，以首页 index 为例
</p>
<pre><code class="prism language-javascript"><span class="token comment">// 这里是 pages/page/index.wxml</span>
<span class="token comment">//使用 view 包裹需要动画的元素</span>
<span class="token comment">//class 中定义动画开始前的初始样式，如透明度=0，向下偏移 200px 等，animtion 属性填入绑定值</span>
<span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"init"</span> animation<span class="token operator">=</span><span class="token string">"{<!-- -->{slide_up1}}"</span><span class="token operator">&gt;</span>
</code></pre>
<p> 4.在该页的 js 中
</p>
<pre><code class="prism language-javascript"><span class="token comment">// 这里是 pages/page/index.js</span>
<span class="token comment">//首先获取小程序实例，访问 app.js 中的函数</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//调用 show 函数，传参</span>
<span class="token comment">//注意：查看上面 show 函数定义查看参数含义</span>
<span class="token comment">//第一个参数是当前的页面对象，方便函数 setData 直接返回数据</span>
<span class="token comment">//第二个参数是绑定的数据名,传参给 setData，详细见上面</span>
<span class="token comment">//第三个参数是上下滑动的 px,因为 class="init"定义初始该元素向下偏移了 200px，所以这里使其上移 200px</span>
<span class="token comment">//第四个参数是需要修改为的透明度，这里是 1，表示从初始的 class="init"中定义的透明度 0 修改到 1</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">slideupshow</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'slide_up1'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
<p> 5.让我们完善流程，达到预览图首页的效果(有延时的边上升边出现效果)
<br/>
wxml 就是将各个容器分别绑定不同的变量,一个 view 容器就是一个动画单位(可以这样理解)，如
</p>
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"init"</span> animation<span class="token operator">=</span><span class="token string">"{<!-- -->{slide_up1}}"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>card<span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>card<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"init"</span> animation<span class="token operator">=</span><span class="token string">"{<!-- -->{slide_up2}}"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>card<span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>card<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
</code></pre>
<p>
页面的 js
</p>
<pre><code class="prism language-javascript"><span class="token comment">//onload 时获取小程序实例</span>
onLoad<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">this</span><span class="token punctuation">.</span>app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">//页面展示时，触发动画</span>
onShow<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">slideupshow</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'slide_up1'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">slideupshow</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'slide_up2'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">//页面隐藏时，触发渐出动画</span>
onHide<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">//你可以看到，动画参数的 200,0 与渐入时的-200,1 刚好是相反的，其实也就做到了页面还原的作用，使页面重新打开时重新展示动画</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">slideupshow</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'slide_up1'</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">//延时展现容器 2，做到瀑布流的效果，见上面预览图</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">slideupshow</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'slide_up2'</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>

   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34333935333731302f:61727469636c652f64657461696c732f313034303430373936" class_="artid" style="display:none">
 </p>
</div>
