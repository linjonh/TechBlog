---
layout: post
title: "Java_ElasticSearchES分布式搜索引擎"
date: 2024-08-31 21:16:47 +0800
description: "上述配置文件即表示添加扩展词典ext.dic，它就会在当前配置文件所在的目录中找这个文件。这种方式在"
keywords: "java es"
categories: ['未分类']
tags: ['搜索引擎', 'Java', 'Elasticsearch']
artid: "141302802"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=141302802
  alt: "Java_ElasticSearchES分布式搜索引擎"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Java_ElasticSearch(ES)——分布式搜索引擎
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     介绍：
    </h2>
    <p>
     Elasticsearch是一个开源的分布式搜索和分析引擎，最初由Elastic公司开发。它构建在Apache Lucene搜索引擎库之上，提供了一个强大的全文搜索和分析引擎， 它结合kibana、Logstash、Beats，是一整套技术栈，被叫做ELK，适用于各种用例，包括文本搜索、日志分析、实时数据分析、监控和报警等。
    </p>
    <p>
     <img alt="" height="781" src="https://i-blog.csdnimg.cn/direct/ea7950e8266042708ea27d9f042b3278.png" width="1200"/>
    </p>
    <h3>
     官网：
    </h3>
    <p>
     官网地址：
     <a href="https://www.elastic.co/cn/" rel="nofollow" title="Elastic — The Search AI Company | Elastic">
      Elastic — The Search AI Company | Elastic
     </a>
     ，目前最新的版本是8.x.x，国内大多使用6.x.x和7.x.x。
    </p>
    <h3>
     优势：
    </h3>
    <p>
     elasticsearch具备以下优势：
    </p>
    <p>
     <strong>
      ·
     </strong>
     支持分布式。可水平拓展
    </p>
    <p>
     <strong>
      ·
     </strong>
     提供Restful接口，可被任何语言调用
    </p>
    <p>
     es在处理海量数据搜索时，速度非常的快，是因为它底层采用倒排索引。
    </p>
    <h2>
     ★倒排索引：
    </h2>
    <p>
     首先介绍一下
     <strong>
      正向索引
     </strong>
     ：
    </p>
    <p>
     <img alt="" height="645" src="https://i-blog.csdnimg.cn/direct/d1d11f4c1a174acbb320266ab3effa96.png" width="1200"/>
    </p>
    <p>
     <strong>
      倒排索引
     </strong>
     ：
    </p>
    <p>
     <img alt="" height="646" src="https://i-blog.csdnimg.cn/direct/ee5a830263274514b94efbe08429886c.png" width="1200"/>
    </p>
    <h4>
     总结：
    </h4>
    <p>
     <img alt="" height="305" src="https://i-blog.csdnimg.cn/direct/451d3f23443e4c579aa7bb0decfbe32b.png" width="500"/>
    </p>
    <h2>
     IK分词器：
    </h2>
    <p>
     <img alt="" height="936" src="https://i-blog.csdnimg.cn/direct/bbdcaef27c154e30bac30df0a28322be.png" width="1200"/>
    </p>
    <p>
     <img alt="" height="921" src="https://i-blog.csdnimg.cn/direct/2b46ac58786346098f030264f4b78e69.png" width="1200"/>
    </p>
    <p>
     上述配置文件即表示添加扩展词典ext.dic，它就会在当前配置文件所在的目录中找这个文件。
    </p>
    <h4>
     总结：
    </h4>
    <p>
     <img alt="" height="309" src="https://i-blog.csdnimg.cn/direct/c968cf5fc9784be49fbd673a8e9a98a1.png" width="500"/>
    </p>
    <h2>
     基础概念：
    </h2>
    <p>
     <img alt="" height="602" src="https://i-blog.csdnimg.cn/direct/2c77e1dbce10421eb097302524923103.png" width="1200"/>
    </p>
    <h3>
     与MySQL对比：
    </h3>
    <p>
     <img alt="" height="991" src="https://i-blog.csdnimg.cn/direct/97e5034ca2f24fa38725afee8a61dd1f.png" width="1200"/>
    </p>
    <h2>
     索引库操作
    </h2>
    <h3>
     Mapping映射属性：
    </h3>
    <p>
     <img alt="" height="935" src="https://i-blog.csdnimg.cn/direct/36125d75a27942869da2620600be0636.png" width="1200"/>
    </p>
    <h3>
     索引库操作：
    </h3>
    <p>
     <img alt="" height="583" src="https://i-blog.csdnimg.cn/direct/dbf6d8035c8446d5876f69687b065450.png" width="1200"/>
    </p>
    <p>
     <img alt="" height="924" src="https://i-blog.csdnimg.cn/direct/02adeb8fca92419a8d3b1db0099d6efa.png" width="1200"/>
    </p>
    <p>
     <img alt="" height="917" src="https://i-blog.csdnimg.cn/direct/300603fef4304294894747bef01829c0.png" width="1200"/>
    </p>
    <h4>
     总结：
    </h4>
    <p>
     <img alt="" height="145" src="https://i-blog.csdnimg.cn/direct/dd10dcbb801d4ad79f5e22e6a2fd0e20.png" width="300"/>
    </p>
    <h2>
     文档处理：
    </h2>
    <h3>
     CRUD：
    </h3>
    <h4 style="background-color:transparent;">
     新增：
    </h4>
    <p>
     <img alt="" height="350" src="https://i-blog.csdnimg.cn/direct/76e4123a5cd1434cb8f2dac4dae76d6e.png" width="1200"/>
    </p>
    <h4>
     查找、删除：
    </h4>
    <p>
     <img alt="" height="475" src="https://i-blog.csdnimg.cn/direct/bf5352fa0cf2471d9e2c18b1e696c451.png" width="1137"/>
    </p>
    <h4>
     修改：
    </h4>
    <h5>
     全量修改：
    </h5>
    <p>
     <img alt="" height="286" src="https://i-blog.csdnimg.cn/direct/e6642028ac744b1fb55ee07ff11f49fa.png" width="1200"/>
    </p>
    <p>
     这种方式在文档id不存在时，就会相当于一个新增操作。
    </p>
    <h5>
     增量修改：
    </h5>
    <p>
     <img alt="" height="262" src="https://i-blog.csdnimg.cn/direct/34ed12d070834f7cad58f4eeb852f014.png" width="1200"/>
    </p>
    <h3>
     批量处理：
    </h3>
    <p>
     <img alt="" height="633" src="https://i-blog.csdnimg.cn/direct/08d7e0659f0943928d0f9df1d03f70c5.png" width="1200"/>
    </p>
    <h2 style="background-color:transparent;">
     JavaRestClient：
    </h2>
    <p>
     <img alt="" height="958" src="https://i-blog.csdnimg.cn/direct/b94b314a2e404c77b2c28415ecfc6b1a.png" width="1200"/>
    </p>
    <h3>
     客户端初始化：
    </h3>
    <p>
     <img alt="" height="588" src="https://i-blog.csdnimg.cn/direct/fc07d2f59a48471bbdc7134c432183f1.png" width="1180"/>
    </p>
    <h3>
     商品表Mapping映射：
    </h3>
    <p>
     以商品表举例：
    </p>
    <p>
     <img alt="" height="823" src="https://i-blog.csdnimg.cn/direct/b158af98637141b1868410d7b87dfa14.png" width="1071"/>
    </p>
    <p>
     在kibana中写出即为：
    </p>
    <pre><code>PUT /items
{
  "mappings": {
    "properties": {
      "id": {
        "type":"keyword"
      },
      "name":{
        "type": "text",
        "analyzer": "ik_smart"
      },
      "price":{
        "type": "integer"
      },
      "image":{
        "type": "keyword", 
        "index": false
      },
      "category":{
        "type": "keyword"
      },
      "brand":{
        "type": "keyword"
      },
      "sold":{
        "type": "integer"
      },
      "comment_count":{
        "type": "integer", 
        "index": false
      },
      "isAD":{
        "type": "boolean"
      },
      "update_time":{
        "type": "date"
      }
}</code></pre>
    <h3 style="background-color:transparent;">
     索引库操作：
    </h3>
    <p>
     创建索引库的JavaAPI与Restful接口API对比：
    </p>
    <p>
     <img alt="" height="666" src="https://i-blog.csdnimg.cn/direct/1b006c04c2e245c3b4450680846bc051.png" width="1200"/>
    </p>
    <p>
     <img alt="" height="584" src="https://i-blog.csdnimg.cn/direct/6f02c317c6df449e983a2a788d656a08.png" width="1034"/>
    </p>
    <h4>
     操作步骤：
    </h4>
    <p>
     <img alt="" height="133" src="https://i-blog.csdnimg.cn/direct/406ed417b090433dbe163e5d1cb0738a.png" width="500"/>
    </p>
    <h4>
     代码演示：
    </h4>
    <pre><code class="language-java">class ItemTest {

    private RestHighLevelClient client;

    @BeforeEach
    void setUp() {
        // 初始化 RestHighLevelClient 对象
        client = new RestHighLevelClient(RestClient.builder(
                HttpHost.create("http://192.168.178.130:9200")
        ));
    }

    @AfterEach
    void tearDown() throws IOException {
        client.close();
    }

    @Test
    void testCreateIndex() throws IOException {
        //1.准备Request对象
        CreateIndexRequest request = new CreateIndexRequest("items");
        //2.准备请求参数
        request.source(MAPPING_TEMPLATE, XContentType.JSON);
        //3.发送请求
        client.indices().create(request, RequestOptions.DEFAULT);
    }

    @Test
    void testGetIndex() throws IOException {
        //1.准备Request对象
        GetIndexRequest request = new GetIndexRequest("items");
        //2.发送请求
        boolean exists = client.indices().exists(request, RequestOptions.DEFAULT);
        System.out.println("exists: " + exists);
    }

    @Test
    void testDeleteIndex() throws IOException {
        //1.准备Request对象
        DeleteIndexRequest request = new DeleteIndexRequest("items");
        //2.发送请求
        client.indices().delete(request, RequestOptions.DEFAULT);
    }

    private static final String MAPPING_TEMPLATE = "{\n" +
            "  \"mappings\": {\n" +
            "    \"properties\": {\n" +
            "      \"id\": {\n" +
            "        \"type\":\"keyword\"\n" +
            "      },\n" +
            "      \"name\":{\n" +
            "        \"type\": \"text\",\n" +
            "        \"analyzer\": \"ik_smart\"\n" +
            "      },\n" +
            "      \"price\":{\n" +
            "        \"type\": \"integer\"\n" +
            "      },\n" +
            "      \"image\":{\n" +
            "        \"type\": \"keyword\", \n" +
            "        \"index\": false\n" +
            "      },\n" +
            "      \"category\":{\n" +
            "        \"type\": \"keyword\"\n" +
            "      },\n" +
            "      \"brand\":{\n" +
            "        \"type\": \"keyword\"\n" +
            "      },\n" +
            "      \"sold\":{\n" +
            "        \"type\": \"integer\"\n" +
            "      },\n" +
            "      \"comment_count\":{\n" +
            "        \"type\": \"integer\", \n" +
            "        \"index\": false\n" +
            "      },\n" +
            "      \"isAD\":{\n" +
            "        \"type\": \"boolean\"\n" +
            "      },\n" +
            "      \"update_time\":{\n" +
            "        \"type\": \"date\"\n" +
            "      }\n" +
            "}\n" +
            "}\n" +
            "}";

}</code></pre>
<h3>
文档操作：
</h3>
<h4>
新增文档：
</h4>
<p>
<img alt="" height="494" src="https://i-blog.csdnimg.cn/direct/d6da972296b845d2a75c43d8d9330864.png" width="1200"/>
</p>
<h5>
运行代码：
</h5>
<pre><code class="language-java">@SpringBootTest(properties = "spring.profiles.active=local")
class ESDocTest {

    private RestHighLevelClient client;
    @Autowired
    private IItemService itemService;

    @BeforeEach
    void setUp() {
        // 初始化 RestHighLevelClient 对象
        client = new RestHighLevelClient(RestClient.builder(
                HttpHost.create("http://192.168.178.130:9200")
        ));
    }

    @AfterEach
    void tearDown() throws IOException {
        client.close();
    }

    @Test
    void testIndexDoc() throws IOException {
        //获取数据
        Item item = itemService.getById(317578L);
        ItemDoc itemDoc = BeanUtil.copyProperties(item, ItemDoc.class);
        //创建request对象
        IndexRequest request = new IndexRequest("item").id(itemDoc.getId());
        //准备JSON文档
        request.source(JSONUtil.toJsonStr(itemDoc), XContentType.JSON);
        //发送请求
        client.index(request, RequestOptions.DEFAULT);
    }

}</code></pre>
<h4>
删除文档：
</h4>
<p>
<img alt="" height="306" src="https://i-blog.csdnimg.cn/direct/bb4bb58cf8bb4c69b85927f9fb18b587.png" width="1200"/>
</p>
<h4>
查询文档：
</h4>
<p>
<img alt="" height="559" src="https://i-blog.csdnimg.cn/direct/4ac57beb0888424da9b2968373b4921c.png" width="1200"/>
</p>
<h4>
修改文档：
</h4>
<p>
<img alt="" height="167" src="https://i-blog.csdnimg.cn/direct/82136f1e78ac456b90f1cae1a2556565.png" width="1200"/>
</p>
<p>
全量更新：可以使用新增文档的代码，在得到 ItemDoc 后修改它的属性值在新增即可。
</p>
<p>
局部更新：
</p>
<p>
<img alt="" height="646" src="https://i-blog.csdnimg.cn/direct/ffde7712e1634c63acfbf4caf613013f.png" width="1200"/>
</p>
<h4>
文档操作基本步骤：
</h4>
<p>
<img alt="" height="175" src="https://i-blog.csdnimg.cn/direct/5f563fbc6844400097513155d5d66510.png" width="420"/>
</p>
<h3>
批处理：
</h3>
<p>
<img alt="" height="587" src="https://i-blog.csdnimg.cn/direct/8e78043392694076949d7882bdb2df69.png" width="1200"/>
</p>
<h4>
代码示例：
</h4>
<p>
<img alt="" height="440" src="https://i-blog.csdnimg.cn/direct/71d0ad27b9424f31987bd1380b83f213.png" width="1172"/>
</p>
<h2>
DSL 查询：
</h2>
<p>
<img alt="" height="604" src="https://i-blog.csdnimg.cn/direct/5d1d735232ed4ab28d1f5d64995e959d.png" width="1200"/>
</p>
<p>
<img alt="" height="482" src="https://i-blog.csdnimg.cn/direct/7c3df5d5e48240709a014cb825c4833b.png" width="1200"/>
</p>
<h3>
快速入门：
</h3>
<p>
<img alt="" height="422" src="https://i-blog.csdnimg.cn/direct/ffb7f43a5d984085b9ce206c93d38144.png" width="1200"/>
</p>
<p>
注意：单次查询默认最大数据数为 10000，最多返回 10 条数据
</p>
<h3>
叶子查询：
<br/>
<img alt="" height="459" src="https://i-blog.csdnimg.cn/direct/40e90ea3e09a48df99f3adc6655ee5b9.png" width="1200"/>
</h3>
<h4>
全文检索：
</h4>
<p>
FIELD 为要搜索的字段，TEXT 为要搜索的内容
</p>
<p>
<img alt="" height="923" src="https://i-blog.csdnimg.cn/direct/0460bc22032341baa8de0321d164bad6.png" width="1200"/>
</p>
<h4>
精确查询：
</h4>
<p>
<img alt="" height="572" src="https://i-blog.csdnimg.cn/direct/9f94a87ff73a4af1b5501ec138661c4b.png" width="1200"/>
</p>
<p>
term 查询一般用来搜不分词的字段，比如品牌等。如果搜分词的字段，VALUE 只能写分好的词条，比如“脱脂”、“牛奶”等，才能搜到
</p>
<p>
range 查询中 gte 和 lte 也可以写成 gt 和 lt 这样就是大于和小于。
</p>
<p>
ids 查询：（批量查询 id）
</p>
<p>
<img alt="" height="136" src="https://i-blog.csdnimg.cn/direct/535793d10a5040bca8b35efe48f640d1.png" width="300"/>
</p>
<h4>
总结：
</h4>
<p>
<img alt="" height="234" src="https://i-blog.csdnimg.cn/direct/d61535040f694fcbbabc77c345d11434.png" width="420"/>
</p>
<h3>
复合查询：
</h3>
<p>
<img alt="" height="276" src="https://i-blog.csdnimg.cn/direct/e60bfa1e86984ebb9d689ff1f57842a9.png" width="1195"/>
</p>
<h4>
布尔查询：
</h4>
<p>
<img alt="" height="592" src="https://i-blog.csdnimg.cn/direct/797dc2e911384be496e1fd55b104a64e.png" width="1200"/>
</p>
<h5>
示例：
</h5>
<p>
搜索“智能手机”，但品牌必须是华为，价格必须是 900~1599
</p>
<p>
<img alt="" height="519" src="https://i-blog.csdnimg.cn/direct/d331e775c3684a74aeb0b841fb80ec81.png" width="300"/>
</p>
<h3>
排序和分页：
</h3>
<h4>
排序：
</h4>
<p>
<img alt="" height="508" src="https://i-blog.csdnimg.cn/direct/a07013f86f344e3a96ef756fd1be57f0.png" width="1200"/>
</p>
<h5>
示例：
</h5>
<p>
搜索商品，按照销量排序，销量一样则按照价格排序。
</p>
<p>
<img alt="" height="274" src="https://i-blog.csdnimg.cn/direct/47f31b8c60d744079403d8f84de7fd76.png" width="250"/>
</p>
<h4>
分页：
</h4>
<p>
<img alt="" height="605" src="https://i-blog.csdnimg.cn/direct/7a9aef73452141a0a290c441c6ec0de1.png" width="1200"/>
</p>
<h5>
示例：
</h5>
<p>
搜索商品，查询出销量排名前 10 的商品，销量一样时按照价格升序。
</p>
<p>
<img alt="" height="359" src="https://i-blog.csdnimg.cn/direct/546a5086a5354fa1854f71c940b0f890.png" width="229"/>
</p>
<h5>
深度分页问题：
</h5>
<p>
<img alt="" height="580" src="https://i-blog.csdnimg.cn/direct/be7d81817c684aec9053ef0e8f04c4b5.png" width="1200"/>
</p>
<h6>
解决方案：
</h6>
<p>
<img alt="" height="522" src="https://i-blog.csdnimg.cn/direct/85a5327440334576865bba39cc413d73.png" width="1200"/>
</p>
<h3>
高亮显示：
</h3>
<p>
<img alt="" height="960" src="https://i-blog.csdnimg.cn/direct/bdb738b9153646d8bdb01b599320d165.png" width="1200"/>
</p>
<p>
(↑ 标签默认就为 em)
</p>
<h3>
搜索完整语法：
</h3>
<p>
<img alt="" height="471" src="https://i-blog.csdnimg.cn/direct/874eb9b2409e4beaa10ce6af4081eb0e.png" width="500"/>
</p>
<h2>
JavaRestClient 查询:
</h2>
<h3>
快速入门：
</h3>
<p>
<img alt="" height="952" src="https://i-blog.csdnimg.cn/direct/790958f291cd461eb12b6a71255c5fc6.png" width="1200"/>
</p>
<p>
<img alt="" height="1000" src="https://i-blog.csdnimg.cn/direct/2232dfd6f7404c86841a86f9f72756e6.png" width="1200"/>
</p>
<h3>
构建查询条件：
</h3>
<p>
<img alt="" height="506" src="https://i-blog.csdnimg.cn/direct/5cfa5b91453f42a080a51862f93702fd.png" width="1103"/>
</p>
<h4>
全文检索查询：
</h4>
<p>
<img alt="" height="818" src="https://i-blog.csdnimg.cn/direct/78f0588774364fd48839ac2a14911dfc.png" width="1200"/>
</p>
<h4>
精确查询：
</h4>
<p>
<img alt="" height="824" src="https://i-blog.csdnimg.cn/direct/886dba7777994b53901635bb6c7d1180.png" width="1200"/>
</p>
<h4>
布尔查询：
</h4>
<p>
<img alt="" height="586" src="https://i-blog.csdnimg.cn/direct/28b92c01ab064f3e99303606b8a226f2.png" width="1200"/>
</p>
<p>
</p>
<h3>
排序和分页：
</h3>
<p>
<img alt="" height="520" src="https://i-blog.csdnimg.cn/direct/ac6b0c36a25b473c8eefad88d43ec54a.png" width="1200"/>
</p>
<h3>
高亮显示：
</h3>
<p>
<img alt="" height="948" src="https://i-blog.csdnimg.cn/direct/531036653cf2483ea28a9ced51ce8fca.png" width="1200"/>
</p>
<p>
<img alt="" height="932" src="https://i-blog.csdnimg.cn/direct/7dab2c1e22e9476eaa4f24c1af2f46bc.png" width="1200"/>
</p>
<h2>
聚合：
</h2>
<h3>
聚合的分类：
</h3>
<p>
<img alt="" height="582" src="https://i-blog.csdnimg.cn/direct/c3f03f4b1b404ccab3784aae464d630b.png" width="1200"/>
</p>
<h3>
DSL 实现聚合：
</h3>
<p>
<img alt="" height="906" src="https://i-blog.csdnimg.cn/direct/a85f139d077644c38517497f81ee3507.png" width="1200"/>
</p>
<p>
<img alt="" height="943" src="https://i-blog.csdnimg.cn/direct/b34ee7c001db455f8ceb675da618fa78.png" width="1200"/>
</p>
<p>
<img alt="" height="963" src="https://i-blog.csdnimg.cn/direct/f8273197544f40e59e49a014b38702bf.png" width="1200"/>
</p>
<h3>
Java 客户端实现聚合：
</h3>
<p>
构造请求参数：
</p>
<p>
<img alt="" height="901" src="https://i-blog.csdnimg.cn/direct/6c22cef9fbe74cc3a14a3faf80494f8c.png" width="1200"/>
</p>
<p>
解析结果：
</p>
<p>
<img alt="" height="948" src="https://i-blog.csdnimg.cn/direct/4efe7e0719764502b4f2f8d929b63adb.png" width="1200"/>
</p>
<p>
</p>

   </div>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f777378636a672f:61727469636c652f64657461696c732f313431333032383032" class_="artid" style="display:none">
 </p>
</div>
