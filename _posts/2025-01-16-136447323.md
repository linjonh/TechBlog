---
layout: post
title: "手机浏览器或微信中唤起小程序"
date: 2025-01-16 10:41:47 +0800
description: "需要在手机浏览器或者微信中唤起小程序有两种方式,小程序URL S"
keywords: "浏览器打开小程序"
categories: ["未分类"]
tags: ["Html"]
artid: "136447323"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=136447323
  alt: "手机浏览器或微信中唤起小程序"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     手机浏览器或微信中唤起小程序
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      明文URL Schem唤起小程序
     </h4>
     <ul>
      <li>
       <a href="#_2" rel="nofollow">
        业务需求的场景
       </a>
      </li>
      <li>
       <a href="#_4" rel="nofollow">
        使用文档介绍
       </a>
      </li>
      <li>
       <a href="#_10" rel="nofollow">
        实现过程
       </a>
      </li>
      <li>
       <a href="#_296" rel="nofollow">
        遇到的问题
       </a>
      </li>
      <li>
       <a href="#_300" rel="nofollow">
        注意事项
       </a>
      </li>
      <li>
       <a href="#_304" rel="nofollow">
        相关文档
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="_2">
     </a>
     业务需求的场景
    </h2>
    <p>
     需要在后台管理系统中的列表数据添加复制功能，复制成功的链接能够在手机浏览器或者微信中打开指定的小程序页面（pages/good/detail/index）
    </p>
    <h2>
     <a id="_4">
     </a>
     使用文档介绍
    </h2>
    <p>
     需要在手机浏览器或者微信中唤起小程序有两种方式,
     <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/url-scheme.html" rel="nofollow">
      小程序URL Scheme文档
     </a>
     ，开放范围：
     <strong>
      非个人主体小程序
     </strong>
    </p>
    <ol>
     <li>
      通过加密 URL Scheme （需要后端获取加密 Scheme）
     </li>
     <li>
      通过明文 URL Scheme （可前端直接拼接）
     </li>
    </ol>
    <p>
     <strong>
      注意：iOS系统可以直接打开URL Scheme，Android系统需要使用 H5 页面中转
     </strong>
    </p>
    <h2>
     <a id="_10">
     </a>
     实现过程
    </h2>
    <p>
     当前项目使用的技术是
     <strong>
      vite-vue-ts
     </strong>
     ，使用明文 URL Scheme方式唤起小程序
     <br/>
     <em>
      <strong>
       安装项目：pnpm create vite my-project-name --template vue-ts
      </strong>
     </em>
    </p>
    <p>
     <strong>
      1.列表页复制按钮事件js，实现生成URL Scheme，并复制到剪切板
     </strong>
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">// URL Scheme需要进入的小程序页面</span>
  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token string">'pages/good/detail/index'</span>
  <span class="token comment">// URL Scheme携带的参数</span>
  <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">goodId=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>record<span class="token punctuation">.</span>goodId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;other=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>record<span class="token punctuation">.</span>other<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token comment">// 拼接完整的 URL Scheme</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">weixin://dl/business/?appid=222222222222&amp;path=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;query=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>query<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token comment">// 跳转到新增的H5页面的url（看下文），mpAppId公众号id，appId小程序id</span>
  <span class="token keyword">const</span> goodUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>location<span class="token punctuation">.</span>origin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/good.html?scheme=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;mpAppId=11111111111111&amp;appId=222222222222</span><span class="token template-punctuation string">`</span></span>
  <span class="token comment">// 调用后端的接口生成短链接，并复制到剪切板</span>
  <span class="token keyword">return</span> <span class="token function">myRequest</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">api/short/url</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">url</span><span class="token operator">:</span>goodUrl <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  	  <span class="token comment">// 拷贝到剪切板（看下文utils工具）</span>
      <span class="token function">copyText</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
      Message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'复制成功'</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> resp<span class="token punctuation">.</span>data
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      2.需要在现有的后台管理系统项目新建一个H5页面
     </strong>
     <br/>
     在vite.config.ts中配置项build &gt; rollupOptions &gt; input 中新增配置项 good:
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	<span class="token comment">// ... 其他配置</span>
	build：<span class="token punctuation">{<!-- --></span>
		rollupOptions：<span class="token punctuation">{<!-- --></span>
		  <span class="token comment">// ... 其他配置</span>
		  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		     <span class="token literal-property property">good</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'good.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 新建H5</span>
		     <span class="token literal-property property">index</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 原系统入口页</span>
	      <span class="token punctuation">}</span><span class="token punctuation">,</span>
	      <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
	        <span class="token literal-property property">dir</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 打包输出问价</span>
	      <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     在vite.config.ts同级目录下新建good.html文件，并引入小程序微信开放标签JDK的js文件
    </p>
    <pre><code class="prism language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>link
      rel<span class="token operator">=</span><span class="token string">"icon"</span>
      type<span class="token operator">=</span><span class="token string">"image/svg+xml"</span>
      href<span class="token operator">=</span><span class="token string">"/logo.png"</span>
    <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta
      name<span class="token operator">=</span><span class="token string">"viewport"</span>
      content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1.0"</span>
    <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>跳转中<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
    <span class="token comment">// 小程序微信开放标签</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://res.wx.qq.com/open/js/jweixin-1.6.0.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script
type<span class="token operator">=</span><span class="token string">"module"</span>
src<span class="token operator">=</span><span class="token string">"/src/good.ts"</span>
<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre>
<p>
在 src 下新建 good.ts，挂载页面
</p>
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Auth <span class="token keyword">from</span> <span class="token string">'./Login.vue'</span>
<span class="token keyword">import</span> <span class="token string">'./themes/login.less'</span>
<span class="token function">createApp</span><span class="token punctuation">(</span>Auth<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre>
<p>
在 src 下新建 good.vue 页面(H5 页面)，用来跳转小程序（访问复制出来的 URL 会进入这个页面，然后在点击进入小程序）
</p>
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> eslint<span class="token operator">-</span>disable vue<span class="token operator">/</span>no<span class="token operator">-</span>lone<span class="token operator">-</span>template <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"good"</span><span class="token operator">&gt;</span>
<span class="token comment">// 手机浏览器网页直接打开上文复制出来的 url</span>
<span class="token operator">&lt;</span>div
v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"isWeiXin ? false : isMobile"</span>
<span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"public-web-container"</span>
<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>a
href<span class="token operator">=</span><span class="token string">"javascript:"</span>
<span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"public-web-jump-button"</span>
@click<span class="token operator">=</span><span class="token string">"openWxApp()"</span>
<span class="token operator">&gt;</span>
打开小程序
<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token comment">// 微信中需要使用微信开发标签</span>
<span class="token operator">&lt;</span>div
v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"isWeiXin"</span>
id<span class="token operator">=</span><span class="token string">"weChat-web-container"</span>
<span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"weChat-web-container"</span>
<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>wx<span class="token operator">-</span>open<span class="token operator">-</span>launch<span class="token operator">-</span>weapp
id<span class="token operator">=</span><span class="token string">"launch-btn"</span>
<span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"wx-open-launch-weapp"</span>
<span class="token operator">:</span>appid<span class="token operator">=</span><span class="token string">"appId"</span>
<span class="token operator">:</span>path<span class="token operator">=</span><span class="token string">"weappPath"</span>
<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>component
<span class="token operator">:</span>is<span class="token operator">=</span><span class="token string">"'script'"</span>
type<span class="token operator">=</span><span class="token string">"text/wxtag-template"</span>
<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>button style<span class="token operator">=</span><span class="token string">"width: 200px; height: 45px; text-align: center; font-size: 17px; display: block; margin: 0 auto; padding: 8px 24px; border: none; border-radius: 4px; background-color: #07c160; color: #fff"</span><span class="token operator">&gt;</span>
打开小程序
<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>component<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>wx<span class="token operator">-</span>open<span class="token operator">-</span>launch<span class="token operator">-</span>weapp<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token comment">// 桌面端提示用手机网页</span>
<span class="token operator">&lt;</span>div
v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"isDesktop"</span>
<span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"desktop-web-container"</span>
<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>请使用手机打开网页<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">"ts"</span> setup<span class="token operator">&gt;</span>
<span class="token comment">// 开放标签获取签名（签名需要后端生成）</span>
<span class="token keyword">const</span> <span class="token function-variable function">getSign</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">url</span><span class="token operator">:</span> string <span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/get/sign?url=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>params<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> isWeiXin <span class="token operator">=</span> ref<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> isMobile <span class="token operator">=</span> ref<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> isDesktop <span class="token operator">=</span> ref<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token comment">// mpAppId 公众号 id, appId 小程序 id</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> mpAppId <span class="token operator">=</span> <span class="token string">'11111111111111'</span><span class="token punctuation">,</span> appId <span class="token operator">=</span> <span class="token string">'222222222222'</span><span class="token punctuation">,</span> scheme <span class="token punctuation">}</span> <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>search<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> weappPath <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">errorCb</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'错误原因:'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>errMsg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">// 微信页面需要注册开放标签</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'WeixinOpenTagsError'</span><span class="token punctuation">,</span> errorCb<span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>isWeiXin<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token function">getSign</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'#'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> data <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">.</span>data
<span class="token punctuation">;</span><span class="token punctuation">(</span>window <span class="token keyword">as</span> any<span class="token punctuation">)</span><span class="token punctuation">.</span>wx<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
<span class="token literal-property property">debug</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token literal-property property">appId</span><span class="token operator">:</span> mpAppId<span class="token punctuation">,</span>
<span class="token literal-property property">timestamp</span><span class="token operator">:</span> data<span class="token punctuation">.</span>timestamp<span class="token punctuation">,</span>
<span class="token literal-property property">nonceStr</span><span class="token operator">:</span> data<span class="token punctuation">.</span>noncestr<span class="token punctuation">,</span>
<span class="token literal-property property">signature</span><span class="token operator">:</span> data<span class="token punctuation">.</span>sign<span class="token punctuation">,</span>
<span class="token literal-property property">jsApiList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'uploadImage'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token literal-property property">openTagList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'wx-open-launch-weapp'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'WeixinOpenTagsError'</span><span class="token punctuation">,</span> errorCb<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">onBeforeMount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>scheme<span class="token punctuation">)</span>
<span class="token keyword">const</span> query <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'query'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> string
weappPath<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>query<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// 区分平台</span>
<span class="token keyword">const</span> <span class="token literal-property property">ua</span><span class="token operator">:</span> any <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> isWXWork <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">wxwork</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'wxwork'</span>
isWeiXin<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token operator">!</span>isWXWork <span class="token operator">&amp;&amp;</span> ua<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">micromessenger</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'micromessenger'</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|IEMobile)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
isMobile<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
isDesktop<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">openWxApp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">// 非微信中网页</span>
location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>scheme<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style lang<span class="token operator">=</span><span class="token string">"less"</span> scoped<span class="token operator">&gt;</span>
<span class="token operator">\*</span> <span class="token punctuation">{<!-- --></span>
<span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>good<span class="token punctuation">{<!-- --></span>
<span class="token literal-property property">position</span><span class="token operator">:</span> absolute<span class="token punctuation">;</span>
<span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token literal-property property">bottom</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>weChat<span class="token operator">-</span>web<span class="token operator">-</span>container<span class="token punctuation">,</span>
<span class="token punctuation">.</span>public<span class="token operator">-</span>web<span class="token operator">-</span>container<span class="token punctuation">,</span>
<span class="token punctuation">.</span>desktop<span class="token operator">-</span>web<span class="token operator">-</span>container <span class="token punctuation">{<!-- --></span>
<span class="token literal-property property">display</span><span class="token operator">:</span> flex<span class="token punctuation">;</span>
flex<span class="token operator">-</span>direction<span class="token operator">:</span> column<span class="token punctuation">;</span>
align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>wx<span class="token operator">-</span>open<span class="token operator">-</span>launch<span class="token operator">-</span>weapp <span class="token punctuation">{<!-- --></span>
<span class="token literal-property property">position</span><span class="token operator">:</span> absolute<span class="token punctuation">;</span>
<span class="token literal-property property">bottom</span><span class="token operator">:</span> <span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">;</span>
<span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token literal-property property">display</span><span class="token operator">:</span> flex<span class="token punctuation">;</span>
flex<span class="token operator">-</span>direction<span class="token operator">:</span> column<span class="token punctuation">;</span>
align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>
<span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>public<span class="token operator">-</span>web<span class="token operator">-</span>jump<span class="token operator">-</span>button <span class="token punctuation">{<!-- --></span>
<span class="token literal-property property">position</span><span class="token operator">:</span> absolute<span class="token punctuation">;</span>
<span class="token literal-property property">bottom</span><span class="token operator">:</span> <span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">;</span>
<span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token literal-property property">display</span><span class="token operator">:</span> inline<span class="token operator">-</span>block<span class="token punctuation">;</span>
<span class="token literal-property property">width</span><span class="token operator">:</span> 184px<span class="token punctuation">;</span>
margin<span class="token operator">-</span>left<span class="token operator">:</span> auto<span class="token punctuation">;</span>
margin<span class="token operator">-</span>right<span class="token operator">:</span> auto<span class="token punctuation">;</span>
<span class="token literal-property property">padding</span><span class="token operator">:</span> 8px 24px<span class="token punctuation">;</span>
box<span class="token operator">-</span>sizing<span class="token operator">:</span> border<span class="token operator">-</span>box<span class="token punctuation">;</span>
background<span class="token operator">-</span>color<span class="token operator">:</span> #06ae56<span class="token punctuation">;</span>
<span class="token literal-property property">color</span><span class="token operator">:</span> #fff<span class="token punctuation">;</span>
font<span class="token operator">-</span>weight<span class="token operator">:</span> <span class="token number">700</span><span class="token punctuation">;</span>
font<span class="token operator">-</span>size<span class="token operator">:</span> 17px<span class="token punctuation">;</span>
text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>
text<span class="token operator">-</span>decoration<span class="token operator">:</span> none<span class="token punctuation">;</span>
line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">1.41176471</span><span class="token punctuation">;</span>
border<span class="token operator">-</span>radius<span class="token operator">:</span> 4px<span class="token punctuation">;</span>
<span class="token literal-property property">overflow</span><span class="token operator">:</span> hidden<span class="token punctuation">;</span>
<span class="token operator">-</span>webkit<span class="token operator">-</span>tap<span class="token operator">-</span>highlight<span class="token operator">-</span>color<span class="token operator">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>desktop<span class="token operator">-</span>web<span class="token operator">-</span>container p <span class="token punctuation">{<!-- --></span>
<span class="token literal-property property">position</span><span class="token operator">:</span> absolute<span class="token punctuation">;</span>
<span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">;</span>
<span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>

</code></pre>
<p>
src &gt; utils &gt; index 工具文件
</p>
<pre><code class="prism language-javascript"> <span class="token comment">// 复制剪切板功能</span>
<span class="token keyword">function</span> <span class="token function">fallbackCopyTextToClipboard</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">text</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">let</span> textArea <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'textarea'</span><span class="token punctuation">)</span>
textArea<span class="token punctuation">.</span>value <span class="token operator">=</span> text

<span class="token comment">// Avoid scrolling to bottom</span>
textArea<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token string">'0'</span>
textArea<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token string">'0'</span>
textArea<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">'fixed'</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>textArea<span class="token punctuation">)</span>
textArea<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
textArea<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">let</span> successful <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">'copy'</span><span class="token punctuation">)</span>
<span class="token function">resolve</span><span class="token punctuation">(</span>successful<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>textArea<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> copyText <span class="token operator">=</span> <span class="token punctuation">(</span>text<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>navigator<span class="token punctuation">.</span>clipboard<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">return</span> <span class="token function">fallbackCopyTextToClipboard</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> navigator<span class="token punctuation">.</span>clipboard<span class="token punctuation">.</span><span class="token function">writeText</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre>
<h2>
<a id="_296">
</a>
遇到的问题
</h2>
<ol>
<li>
链接没有加密，打开网页是空白的，使用
<strong>
encodeURIComponent
</strong>
解决
</li>
<li>
链接过长，打开网页是空白的，通过后端生成短链接解决
</li>
<li>
注册开放标签注册失败，也会导致网页是空白的
</li>
</ol>
<h2>
<a id="_300">
</a>
注意事项
</h2>
<ol>
<li>
<strong>
一定要配置 ：在 MP 平台-&gt;设置-&gt;隐私与安全-&gt;明文 Scheme 拉起此小程序声明
</strong>
</li>
<li>
<strong>
微信开发标签一定要配置：登录微信公众平台进入“公众号设置”的“功能设置”里填写“JS 接口安全域名”。
</strong>
</li>
</ol>
<h2>
<a id="_304">
</a>
相关文档
</h2>
<p>
链接:
<a href="https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/qrcode-link/short-link/generateShortLink.html" rel="nofollow">
URL Scheme 文档
</a>
<br/>
链接:
<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/shortlink.html" rel="nofollow">
获取短链接
</a>
<br/>
链接:
<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_Open_Tag.html" rel="nofollow">
开放标签
</a>
</p>

   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f6c61693236303137323333312f:61727469636c652f64657461696c732f313336343437333233" class_="artid" style="display:none">
 </p>
</div>
