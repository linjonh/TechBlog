---
layout: post
title: "U3D游戏开发框架七每日刷新"
date: 2024-10-22 11:16:24 +0800
description: "一：目的任何一款游戏都需要一个每日刷新的机制，例如每日任务所以我们需要一个管理器统一管理每日刷新的相"
keywords: "unity 定时刷新"
categories: ['U']
tags: ['无标签']
artid: "115759627"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=115759627
    alt: "U3D游戏开发框架七每日刷新"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     U3D游戏开发框架（七）——每日刷新
    </h1>
   </div>
   <div class="ai-article-tag" id="ai-article-tag">
    <div class="ai-article-tag-box">
     <p class="ai-article-tag-item-active">
      <img alt="" class="item-target" src="https://img-home.csdnimg.cn/images/20240715101418.png"/>
     </p>
     <a class="ai-article-tag-item" data-report-click='{"spm":"3001.10231","extra":{"searchword":"每日刷新"}}' data-report-query="spm=1001.2101.3001.10231" data-report-view='{"spm":"3001.10231","extra":{"searchword":"每日刷新"}}' href="https://so.csdn.net/so/search/s.do?q=%E6%AF%8F%E6%97%A5%E5%88%B7%E6%96%B0&amp;t=all&amp;o=vip&amp;s=&amp;l=&amp;f=&amp;viparticle=&amp;from_tracking_code=tag_word&amp;from_code=app_blog_art" target="_blank">
      <span>
       每日刷新
      </span>
     </a>
     <a class="ai-article-tag-item" data-report-click='{"spm":"3001.10231","extra":{"searchword":"游戏机制"}}' data-report-query="spm=1001.2101.3001.10231" data-report-view='{"spm":"3001.10231","extra":{"searchword":"游戏机制"}}' href="https://so.csdn.net/so/search/s.do?q=%E6%B8%B8%E6%88%8F%E6%9C%BA%E5%88%B6&amp;t=all&amp;o=vip&amp;s=&amp;l=&amp;f=&amp;viparticle=&amp;from_tracking_code=tag_word&amp;from_code=app_blog_art" target="_blank">
      <span>
       游戏机制
      </span>
     </a>
     <a class="ai-article-tag-item" data-report-click='{"spm":"3001.10231","extra":{"searchword":"数据管理"}}' data-report-query="spm=1001.2101.3001.10231" data-report-view='{"spm":"3001.10231","extra":{"searchword":"数据管理"}}' href="https://so.csdn.net/so/search/s.do?q=%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86&amp;t=all&amp;o=vip&amp;s=&amp;l=&amp;f=&amp;viparticle=&amp;from_tracking_code=tag_word&amp;from_code=app_blog_art" target="_blank">
      <span>
       数据管理
      </span>
     </a>
     <a class="ai-article-tag-item" data-report-click='{"spm":"3001.10231","extra":{"searchword":"存档"}}' data-report-query="spm=1001.2101.3001.10231" data-report-view='{"spm":"3001.10231","extra":{"searchword":"存档"}}' href="https://so.csdn.net/so/search/s.do?q=%E5%AD%98%E6%A1%A3&amp;t=all&amp;o=vip&amp;s=&amp;l=&amp;f=&amp;viparticle=&amp;from_tracking_code=tag_word&amp;from_code=app_blog_art" target="_blank">
      <span>
       存档
      </span>
     </a>
     <a class="ai-article-tag-item" data-report-click='{"spm":"3001.10231","extra":{"searchword":"时间检测"}}' data-report-query="spm=1001.2101.3001.10231" data-report-view='{"spm":"3001.10231","extra":{"searchword":"时间检测"}}' href="https://so.csdn.net/so/search/s.do?q=%E6%97%B6%E9%97%B4%E6%A3%80%E6%B5%8B&amp;t=all&amp;o=vip&amp;s=&amp;l=&amp;f=&amp;viparticle=&amp;from_tracking_code=tag_word&amp;from_code=app_blog_art" target="_blank">
      <span>
       时间检测
      </span>
     </a>
    </div>
    <span class="ai-article-tag-text">
     关键词由CSDN通过智能技术生成
    </span>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h4>
     一：目的
    </h4>
    <p>
     任何一款游戏都需要一个每日刷新的机制，例如每日任务
     <br/>
     所以我们需要一个管理器统一管理每日刷新的相关操作
    </p>
    <hr/>
    <h4>
     二：解决的问题及优点
    </h4>
    <p>
     ——自定义每日几点刷新
    </p>
    <hr/>
    <h4>
     三：使用方法
    </h4>
    <p>
     ——在游戏启动的最开始创建DailyMgr实例： _ = DailyMgr.Ins
     <br/>
     ——设置常量refreshHour
     <br/>
     ——使用自己的存档管理器管理存档数据，替换获取存档和保存存档的逻辑语句：
     <br/>
     int lastDayOfYear = PlayerPrefs.GetInt("lastDayOfYear", -1)
     <br/>
     PlayerPrefs.SetInt("lastDayOfYear", now.DayOfYear)
    </p>
    <hr/>
    <h4>
     四：代码实现
    </h4>
    <pre><code class="language-cs">using System;
using UnityEngine;

/// &lt;summary&gt;
/// 每日刷新管理器
/// &lt;/summary&gt;
public class DailyMgr : MonoSingleton&lt;DailyMgr&gt;
{
    public const int RefreshHour = 5;//几点刷新

    public override void Awake()
    {
        base.Awake();

        CheckRefresh();

        lastCheckTime = Time.realtimeSinceStartup;
    }

    private void OnApplicationPause(bool pause)
    {
        if (!pause)
        {
            CheckRefresh();
        }
    }

    float lastCheckTime;//上一次检测的时间
    private void Update()
    {
        //5秒检测一次
        if (Time.realtimeSinceStartup - lastCheckTime &gt; 5)
        {
            lastCheckTime = Time.realtimeSinceStartup;
            CheckRefresh();
        }
    }

    /// &lt;summary&gt;
    /// 检测刷新
    /// &lt;/summary&gt;
    void CheckRefresh()
    {
        DateTime now = DateTime.Now;
        int lastDayOfYear = PlayerPrefs.GetInt("lastDayOfYear", -1);
        if (now.DayOfYear != lastDayOfYear)
        {
            //同一年
            if (now.DayOfYear &gt; lastDayOfYear)
            {
                //超过一天未登陆
                if (now.DayOfYear - lastDayOfYear &gt;= 2)
                {
                    PlayerPrefs.SetInt("lastDayOfYear", now.DayOfYear);
                    RefreshData();
                }
                //只有一天未登陆
                else
                {
                    if (now.Hour &gt;= RefreshHour)
                    {
                        PlayerPrefs.SetInt("lastDayOfYear", now.DayOfYear);
                        RefreshData();
                    }
                }
            }
            //跨年
            else if (now.DayOfYear &lt; lastDayOfYear)
            {
                int lastYear = now.Year - 1;
                int lastYearTotalDays = lastYear % 4 == 0 ? 366 : 365;
                //超过一天未登陆
                if (lastYearTotalDays + now.DayOfYear - lastDayOfYear &gt;= 2)
                {
                    PlayerPrefs.SetInt("lastDayOfYear", now.DayOfYear);
                    RefreshData();
                }
                //一天未登陆并且到达刷新时间
                else
                {
                    if (now.Hour &gt;= RefreshHour)
                    {
                        PlayerPrefs.SetInt("lastDayOfYear", now.DayOfYear);
                        RefreshData();
                    }
                }
            }
        }
    }

    /// &lt;summary&gt;
    /// 刷新(所有需要每日刷新的数据)
    /// &lt;/summary&gt;
    public void RefreshData()
    {

    }
}</code></pre>
    <h4>
     <br/>
    </h4>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f4c4c4c4c4c5f5f2f:61727469636c652f64657461696c732f313135373539363237" class_="artid" style="display:none">
 </p>
</div>


