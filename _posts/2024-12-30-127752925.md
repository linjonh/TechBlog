---
layout: post
title: "esp8266MQTT固件串口助手连接阿里云服务测试"
date: 2024-12-30 12:12:43 +0800
description: "本文详细介绍了如何使用ESP8266模块烧录MQTT固件，并通过阿里云物联网平台创建产品、设备和配置"
keywords: "esp8266+mqtt"
categories: ["未分类"]
tags: ["阿里云", "运维", "经验分享", "程序人生", "云计算"]
artid: "127752925"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=127752925
  alt: "esp8266MQTT固件串口助手连接阿里云服务测试"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     esp8266(MQTT固件)+串口助手连接阿里云服务测试
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      esp8266+MQTT固件+串口助手连接阿里云服务测试
     </h4>
     <ul>
      <li>
       <ul>
        <li>
         <ul>
          <li>
           <a href="#esp8266MQTThttpsblogcsdnnetHuangBJ200articledetails127745967_2" rel="nofollow">
            esp8266烧录MQTT固件
           </a>
          </li>
          <li>
           <a href="#_4" rel="nofollow">
            阿里云创建产品步骤
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#_7" rel="nofollow">
              创建产品
             </a>
            </li>
            <li>
             <a href="#_12" rel="nofollow">
              添加设备
             </a>
            </li>
            <li>
             <a href="#_17" rel="nofollow">
              在产品中添加功能
             </a>
            </li>
            <li>
             <a href="#_19" rel="nofollow">
              添加自定义功能
             </a>
            </li>
            <li>
             <a href="#_22" rel="nofollow">
              完成
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#ESP8266_26" rel="nofollow">
            ESP8266与阿里云服务通信
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#_27" rel="nofollow">
              阿里云产品发布
             </a>
            </li>
            <li>
             <ul>
              <li>
               <a href="#_28" rel="nofollow">
                点击发布，勾选请确认-&gt;发布
               </a>
              </li>
              <li>
               <a href="#MQTT_34" rel="nofollow">
                查看MQTT连接参数
               </a>
              </li>
              <li>
               <a href="#MQTTMQTT_44" rel="nofollow">
                MQTT连接参数在MQTT指令集中的使用
               </a>
              </li>
             </ul>
            </li>
            <li>
             <a href="#esp8266MQTT___59" rel="nofollow">
              esp8266（MQTT固件） + 串口助手连接阿里云服务
             </a>
            </li>
            <li>
             <a href="#_139" rel="nofollow">
              测试结果
             </a>
            </li>
            <li>
             <ul>
              <li>
               <a href="#_141" rel="nofollow">
                订阅测试
               </a>
              </li>
              <li>
               <a href="#_145" rel="nofollow">
                发布测试
               </a>
              </li>
             </ul>
            </li>
           </ul>
          </li>
         </ul>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h4>
     <a id="esp8266MQTThttpsblogcsdnnetHuangBJ200articledetails127745967_2">
     </a>
     <a href="https://blog.csdn.net/HuangBJ200/article/details/127745967">
      esp8266烧录MQTT固件
     </a>
    </h4>
    <h4>
     <a id="_4">
     </a>
     阿里云创建产品步骤
    </h4>
    <p>
     登录
     <a href="https://www.aliyun.com/" rel="nofollow">
      阿里云
     </a>
     ，没有阿里云账号的需自行注册。
    </p>
    <h5>
     <a id="_7">
     </a>
     创建产品
    </h5>
    <p>
     在物联网平台下，点击 设备管理 -&gt; 产品 -&gt;创建产品
     <br/>
     <img alt="设备管理 -&gt; 产品 -&gt;创建产品" src="https://i-blog.csdnimg.cn/blog_migrate/754ae639da71022229546ae696964f20.png">
      <br/>
      产品名称根据自身需求填写，选择自定义品类，选择直连设备，连网方式选wifi，数据格式选JSON格式（配置可根据自己需求选择）。
      <br/>
      <img alt="新建产品" src="https://i-blog.csdnimg.cn/blog_migrate/37e1b2f13745b3710ff2d4b369a89bfe.png"/>
     </img>
    </p>
    <h5>
     <a id="_12">
     </a>
     添加设备
    </h5>
    <p>
     <img alt="添加设备1" src="https://i-blog.csdnimg.cn/blog_migrate/4c9191cf2bb5fdef22943fc1e9430557.png">
      <br/>
      <img alt="添加设备-定义名称" src="https://i-blog.csdnimg.cn/blog_migrate/9850f4afe72fc51f7a04ad806a0311e9.png">
       <br/>
       <img alt="添加设备-完成" src="https://i-blog.csdnimg.cn/blog_migrate/61453d3929217a16cfe0c388ff38d9d3.png"/>
      </img>
     </img>
    </p>
    <h5>
     <a id="_17">
     </a>
     在产品中添加功能
    </h5>
    <p>
     <img alt="编辑草稿" src="https://i-blog.csdnimg.cn/blog_migrate/72a090fac28dc85ca4781ac7aa772b82.png"/>
    </p>
    <h5>
     <a id="_19">
     </a>
     添加自定义功能
    </h5>
    <p>
     <img alt="添加自定义功能" src="https://i-blog.csdnimg.cn/blog_migrate/a133fe8b59c67c1905ee5f0a174997e3.png"/>
    </p>
    <h5>
     <a id="_22">
     </a>
     完成
    </h5>
    <p>
     <img alt="完成" src="https://i-blog.csdnimg.cn/blog_migrate/4bc9203726029ccf691f7294e3796659.png"/>
    </p>
    <h4>
     <a id="ESP8266_26">
     </a>
     ESP8266与阿里云服务通信
    </h4>
    <h5>
     <a id="_27">
     </a>
     阿里云产品发布
    </h5>
    <h6>
     <a id="_28">
     </a>
     点击发布，勾选请确认-&gt;发布
    </h6>
    <p>
     <img alt="点击发布" src="https://i-blog.csdnimg.cn/blog_migrate/7dba506e928516b0d15c1c3789705db7.png"/>
    </p>
    <p>
     <img alt="勾选请确认-&gt;发布" src="https://i-blog.csdnimg.cn/blog_migrate/2521b74015a4a74d7cbef53ad88721e2.png"/>
     <br/>
     <img alt="确认发布" src="https://i-blog.csdnimg.cn/blog_migrate/639463b5885d71b009411e3c09b0b550.png"/>
    </p>
    <h6>
     <a id="MQTT_34">
     </a>
     查看MQTT连接参数
    </h6>
    <p>
     <img alt="MQTT连接参数" src="https://i-blog.csdnimg.cn/blog_migrate/7e53946c9859cb10f539e23b806ceaca.png"/>
    </p>
    <table>
     <thead>
      <tr>
       <th>
        MQTT连接参数变量名
       </th>
       <th>
        说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        clientId
       </td>
       <td>
        客户端id
       </td>
      </tr>
      <tr>
       <td>
        username
       </td>
       <td>
        客户端名
       </td>
      </tr>
      <tr>
       <td>
        passwd
       </td>
       <td>
        客户端密码
       </td>
      </tr>
      <tr>
       <td>
        mqttHostUrl
       </td>
       <td>
        url地址
       </td>
      </tr>
      <tr>
       <td>
        port
       </td>
       <td>
        端口
       </td>
      </tr>
     </tbody>
    </table>
    <h6>
     <a id="MQTTMQTT_44">
     </a>
     MQTT连接参数在MQTT指令集中的使用
    </h6>
    <table>
     <thead>
      <tr>
       <th>
        指令
       </th>
       <th>
        备注
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        AT+RST
       </td>
       <td>
        复位
       </td>
      </tr>
      <tr>
       <td>
        AT+RESTORE
       </td>
       <td>
        恢复出厂设置
       </td>
      </tr>
      <tr>
       <td>
        AT+CWMODE=1
       </td>
       <td>
        配置wifi模式
       </td>
      </tr>
      <tr>
       <td>
        AT+CIPSNTPCFG=1,8,“ntp1.aliyun.com”
       </td>
       <td>
        开启SNTP服务器，8时域，SNTP服务器为阿里云域名
       </td>
      </tr>
      <tr>
       <td>
        AT+CWJAP=“WIFIname”,“WIFIpasswd”
       </td>
       <td>
        连接wifi
       </td>
      </tr>
      <tr>
       <td>
        AT+MQTTUSERCFG=0,1,“NULL”,“
        <code>
         username
        </code>
        “,”
        <code>
         passwd
        </code>
        “,0,0,“”
       </td>
       <td>
        配置 MQTT 用户属性
       </td>
      </tr>
      <tr>
       <td>
        AT+MQTTCLIENTID=0,“
        <code>
         clientId
        </code>
        ”
       </td>
       <td>
        配置 MQTT 客户端 ID，注意：第二个参数中有逗号的需在逗号前添加 ‘\’ ，AT指令测试时，无斜杠响应error
       </td>
      </tr>
      <tr>
       <td>
        AT+MQTTCONN=0,"
        <code>
         mqttHostUrl
        </code>
        ",
        <code>
         port
        </code>
        ,1
       </td>
       <td>
        连接/查询 MQTT Broker
       </td>
      </tr>
      <tr>
       <td>
        AT+MQTTSUB=0,“topic”,1
       </td>
       <td>
        订阅指令
       </td>
      </tr>
      <tr>
       <td>
        AT+MQTTPUB=0,“topic”,“Json格式内容”,1,0
       </td>
       <td>
        发布指令
       </td>
      </tr>
      <tr>
       <td>
        AT+MQTTCLEN=0
       </td>
       <td>
        断开连接
       </td>
      </tr>
     </tbody>
    </table>
    <h5>
     <a id="esp8266MQTT___59">
     </a>
     esp8266（MQTT固件） + 串口助手连接阿里云服务
    </h5>
    <ol>
     <li>
      AT+RST 复位
     </li>
    </ol>
    <pre><code class="prism language-bash">AT+RST
</code></pre>
    <ol start="2">
     <li>
      恢复出厂设置
     </li>
    </ol>
    <pre><code class="prism language-bash">AT+RESTORE 
</code></pre>
    <ol start="3">
     <li>
      配置wifi模式
     </li>
    </ol>
    <pre><code class="prism language-bash">AT+CWMODE<span class="token operator">=</span><span class="token number">1</span>
</code></pre>
    <ol start="4">
     <li>
      开启SNTP服务器，8时域，SNTP服务器为阿里云域名
     </li>
    </ol>
    <pre><code class="prism language-bash">AT+CIPSNTPCFG<span class="token operator">=</span><span class="token number">1,8</span>,<span class="token string">"ntp1.aliyun.com"</span> 
</code></pre>
    <ol start="5">
     <li>
      连接wifi
     </li>
    </ol>
    <pre><code class="prism language-bash">AT+CWJAP<span class="token operator">=</span><span class="token string">"123"</span>,<span class="token string">"22222222"</span>
</code></pre>
    <ol start="6">
     <li>
      配置 MQTT 用户属性
     </li>
    </ol>
    <pre><code class="prism language-bash">AT+MQTTUSERCFG<span class="token operator">=</span><span class="token number">0,1</span>,<span class="token string">"NULL"</span>,<span class="token string">"username"</span>,<span class="token string">"passwd"</span>,0,0,<span class="token string">""</span> 
</code></pre>
    <p>
     username和passwd：可在
     <code>
      阿里云物联网平台中的设备管理-&gt;设备-&gt;设备信息-&gt;在MQTT连接参数查看
     </code>
     中获取。
     <br/>
     <img alt="MQTT连接参数" src="https://i-blog.csdnimg.cn/blog_migrate/7e53946c9859cb10f539e23b806ceaca.png"/>
    </p>
    <ol start="7">
     <li>
      配置 MQTT 客户端 ID
     </li>
    </ol>
    <pre><code class="prism language-bash">AT+MQTTCLIENTID<span class="token operator">=</span><span class="token number">0</span>,<span class="token string">"clientId"</span> 
</code></pre>
    <blockquote>
     <p>
      注意：第二个参数中有逗号的需在逗号前添加 \ ，在测试中无\ 响应error
     </p>
    </blockquote>
    <p>
     clientId：可在
     <code>
      阿里云物联网平台中的设备管理-&gt;设备-&gt;设备信息-&gt;在MQTT连接参数查看
     </code>
     中获取，如：hvyitwOvYDQ.my001|securemode=2
     <code>
      \,
     </code>
     signmethod=hmacsha256
     <code>
      \,
     </code>
     timestamp=1667914160182|。
     <br/>
     <img alt="MQTT连接参数" src="https://i-blog.csdnimg.cn/blog_migrate/7e53946c9859cb10f539e23b806ceaca.png"/>
    </p>
    <ol start="8">
     <li>
      连接/查询 MQTT Broker
     </li>
    </ol>
    <pre><code class="prism language-bash">AT+MQTTCONN<span class="token operator">=</span><span class="token number">0</span>,<span class="token string">"mqttHostUrl "</span>,port,1
</code></pre>
    <p>
     mqttHostUrl 和 port：可在
     <code>
      阿里云物联网平台中的设备管理-&gt;设备-&gt;设备信息-&gt;在MQTT连接参数查看
     </code>
     中获取。
     <br/>
     <img alt="MQTT连接参数" src="https://i-blog.csdnimg.cn/blog_migrate/7e53946c9859cb10f539e23b806ceaca.png"/>
    </p>
    <ol start="9">
     <li>
      订阅指令
     </li>
    </ol>
    <pre><code class="prism language-bash">AT+MQTTSUB<span class="token operator">=</span><span class="token number">0</span>,<span class="token string">"topic"</span>,1
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ebe9e7cb4cb338cc72c1b200efbf38f5.png"/>
    </p>
    <p>
     复制 /hvyitwOvYDQ/${deviceName}/user/get ，其中deviceName的值如下：
     <br/>
     <img alt="deviceName" src="https://i-blog.csdnimg.cn/blog_migrate/9c137ebf91cd8c3462eaaaa18a171d2f.png"/>
    </p>
    <p>
     topic参数：
     <code>
      /hvyitwOvYDQ/${deviceName}/user/get
     </code>
     <br/>
     示例：`/hvyitwOvYDQ/my001/user/get
    </p>
    <ol start="10">
     <li>
      发布指令
     </li>
    </ol>
    <pre><code class="prism language-bash">AT+MQTTPUB<span class="token operator">=</span><span class="token number">0</span>,<span class="token string">"topic"</span>,<span class="token string">"Json格式内容"</span>,1,0
</code></pre>
    <p>
     <img alt="复制url" src="https://i-blog.csdnimg.cn/blog_migrate/258d2f16e3de4b8aca63e6b8e0df41b2.png"/>
    </p>
    <p>
     复制 /hvyitwOvYDQ/${deviceName}/user/update ，其中deviceName的值如下：
     <br/>
     <img alt="deviceName" src="https://i-blog.csdnimg.cn/blog_migrate/9c137ebf91cd8c3462eaaaa18a171d2f.png"/>
    </p>
    <p>
     topic参数：
     <code>
      /hvyitwOvYDQ/${deviceName}/user/update
     </code>
     <br/>
     示例：
     <code>
      /hvyitwOvYDQ/my001/user/update
     </code>
    </p>
    <ol start="11">
     <li>
      断开连接
     </li>
    </ol>
    <pre><code class="prism language-bash">AT+MQTTCLEAN<span class="token operator">=</span><span class="token number">0</span>
</code></pre>
    <h5>
     <a id="_139">
     </a>
     测试结果
    </h5>
    <h6>
     <a id="_141">
     </a>
     订阅测试
    </h6>
    <p>
     <img alt="串口测试1" src="https://i-blog.csdnimg.cn/blog_migrate/a526aa149a4365b495e4c72e88278472.png"/>
    </p>
    <h6>
     <a id="_145">
     </a>
     发布测试
    </h6>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4d57d70aa1f05d87191ae91ad61fd3bb.png"/>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f09b636f5a449088f770743f9b25d2fe.png"/>
    </p>
    <p>
     参考链接（不迷路）：
     <br/>
     [1]:
     <a href="https://blog.csdn.net/jdhuzb/article/details/119749896?spm=1001.2014.3001.5502">
      STM32+ESP8266+MQTT连接阿里云服务器（二、创建阿里云平台）
     </a>
     <br/>
     [2]:
     <a href="https://blog.csdn.net/jdhuzb/article/details/119827278?spm=1001.2014.3001.5501">
      STM32+ESP8266+MQTT连接阿里云服务器（三、AT指令连接阿里云平台）
     </a>
    </p>
    <p>
     附件1
     <a href="https://pan.baidu.com/s/1_nl_WflrLO-Y73lPXhuzdw" rel="nofollow">
      ESP8266-MQTT指令手册—提取码：1234
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f4875616e67424a3230302f:61727469636c652f64657461696c732f313237373532393235" class_="artid" style="display:none">
 </p>
</div>
