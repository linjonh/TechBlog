---
layout: post
title: å¾®ä¿¡å°ç¨‹åºç™»å½•æµç¨‹ä¸å®ç°
date: 2023-03-26 23:43:13 +0800
categories: ['åŸç”Ÿå¾®ä¿¡å°ç¨‹åº']
tags: ['å¾®ä¿¡å°ç¨‹åº', 'å°ç¨‹åº', 'å‰ç«¯', 'Uniapp', 'Javascript']
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=129785440
    alt: å¾®ä¿¡å°ç¨‹åºç™»å½•æµç¨‹ä¸å®ç°
artid: 129785440
render_with_liquid: false
---
<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     å¾®ä¿¡å°ç¨‹åºç™»å½•æµç¨‹ä¸å®ç°
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     åœ¨äº†è§£å°ç¨‹åºç™»å½•ä¹‹å‰ï¼Œè¯·å¤§å®¶å…ˆäº†è§£å°ç¨‹åºçš„å…¨å±€å®ä¾‹å’Œå…¨å±€ç»„ä»¶ï¼Œä»¥æ–¹ä¾¿ç†è§£æœ¬æ–‡çš„åç»­å†…å®¹ï¼Œå·²ç»äº†è§£çš„å¯ä»¥ç›´æ¥å¼€å§‹ã€‚
     <br/>
     <a href="https://blog.csdn.net/qq_44793507/article/details/129186566">
      å…¨å±€å®ä¾‹å’Œå…¨å±€ç»„ä»¶
     </a>
     ï¼ˆ ğŸ‘ˆ ç‚¹å‡»ç›´è¾¾ï¼‰
    </p>
    <h4>
     <a id="_3">
     </a>
     å¾®ä¿¡å°ç¨‹åºçš„ç™»å½•æµç¨‹
    </h4>
    <p>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/3c697e9f8bdc2322f02292272cb24b06.jpeg#pic_center"/>
    </p>
    <h4>
     <a id="_6">
     </a>
     å¾®ä¿¡å°ç¨‹åºçš„ç™»å½•
    </h4>
    <p>
     é¦–å…ˆéœ€è¦å†™ä¸€ä¸ªå¾®ä¿¡å°ç¨‹åºçš„ç™»å½•å¼¹çª—ï¼Œç™»å½•å¼¹çª—çš„ä½œç”¨å°±æ˜¯å‘èµ·ç™»å½•ï¼Œè®©ç”¨æˆ·ç‚¹å‡»æˆæƒåç™»å½•å°ç¨‹åºï¼Œè¯¥å¼¹çª—æ˜¯ä¸€ä¸ªå…¨å±€å¼¹çª—ï¼Œå› ä¸ºå°ç¨‹åºæ˜¯æœ‰åˆ†äº«åŠŸèƒ½çš„ï¼Œå¦‚æœæ–°ç”¨æˆ·æ˜¯ä»åˆ†äº«çš„é“¾æ¥è¿›æ¥çš„ï¼Œé‚£ä¹ˆä¼šå…ˆè®©æ–°ç”¨æˆ·ç™»å½•å†åšåç»­æ“ä½œã€‚
     <br/>
     æ‰€ä»¥ï¼Œç™»å½•åŠŸèƒ½å¾—æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œè€Œä¸”ï¼Œç™»å½•å¿…é¡»æ˜¯å…¨å±€å¼¹çª—ã€‚
     <br/>
     åœ¨ç™»å½•é¡µé¢çš„
     <code>
      index.json
     </code>
     æ–‡ä»¶ä¸­ï¼Œè®¾ç½®ç™»å½•å¼¹çª—ä¸ºç»„ä»¶
    </p>
    <pre><code class="prism language-js"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"component"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string-property property">"usingComponents"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
     <span class="token comment">// xxxx.....</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <blockquote>
     <p>
      ç™»å½•å¼¹çª—ä¸Šéœ€è¦æœ‰æˆæƒçš„é€‰é¡¹ï¼Œå¦‚æœæœªå‹¾é€‰æˆæƒç›´æ¥ç‚¹å‡»ç™»å½•ï¼Œéœ€è¦æç¤ºç”¨æˆ·å…ˆæˆæƒå†ç™»å½•
     </p>
    </blockquote>
    <p>
     ç”¨æˆ·å‹¾é€‰æˆæƒåï¼Œç‚¹å‡»ç™»å½•ã€‚ å°ç¨‹åºç™»å½•éœ€è¦ä½¿ç”¨
     <code>
      button
     </code>
     ç»„ä»¶ï¼Œå°†
     <code>
      button
     </code>
     ç»„ä»¶çš„
     <code>
      open-type
     </code>
     çš„å€¼è®¾ç½®ä¸º
     <code>
      getPhoneNumber
     </code>
     ï¼Œå½“ç”¨æˆ·ç‚¹å‡»å¹¶åŒæ„ä¹‹åï¼Œå¯ä»¥é€šè¿‡
     <code>
      bindgetphonenumber
     </code>
     äº‹ä»¶å›è°ƒè·å–åˆ°åŠ¨æ€ä»¤ç‰Œ
     <code>
      code
     </code>
     ï¼Œç„¶åæŠŠ
     <code>
      code
     </code>
     ä¼ åˆ°å¼€å‘è€…åå°ï¼Œå¹¶åœ¨å¼€å‘è€…åå°è°ƒç”¨å¾®ä¿¡åå°æä¾›çš„
     <code>
      phonenumber.getPhoneNumber
     </code>
     æ¥å£ï¼Œæ¶ˆè´¹
     <code>
      code
     </code>
     æ¥æ¢å–ç”¨æˆ·æ‰‹æœºå·ã€‚å¹¶ä¸”æ¯ä¸ª
     <code>
      code
     </code>
     æœ‰æ•ˆæœŸä¸º
     <code>
      5
     </code>
     åˆ†é’Ÿï¼Œä¸”åªèƒ½æ¶ˆè´¹ä¸€æ¬¡ã€‚
     <br/>
     <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/getPhoneNumber.html#%E8%BF%94%E5%9B%9E%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E" rel="nofollow">
      open-type="getPhoneNumber"ä½¿ç”¨æ–‡æ¡£
     </a>
     ï¼ˆ ğŸ‘ˆ ç‚¹å‡»ç›´è¾¾ï¼‰
    </p>
    <blockquote>
     <p>
      æ³¨ï¼š
      <code>
       getPhoneNumber
      </code>
      è¿”å›çš„
      <code>
       code
      </code>
      ä¸
      <code>
       wx.login
      </code>
      è¿”å›çš„
      <code>
       code
      </code>
      ä½œç”¨æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸èƒ½æ··ç”¨ã€‚
     </p>
    </blockquote>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">open-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getPhoneNumber<span class="token punctuation">"</span></span> <span class="token attr-name">bindgetphonenumber</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleConfirm<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <pre><code class="prism language-js">  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">show</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>     <span class="token comment">// ç™»å½•å¼¹çª—æ˜¯å¦æ˜¾ç¤º</span>
    <span class="token literal-property property">selected</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// æ˜¯å¦å‹¾é€‰æˆæƒ</span>
    <span class="token literal-property property">loginSuccess</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loginFail</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
    <span class="token comment">// ç¡®è®¤æˆæƒæ‰‹æœºå·-è¿™é‡Œå¯ä»¥åšèŠ‚æµæ“ä½œï¼Œé˜²æ­¢ç”¨æˆ·ç‚¹å‡»æ¬¡æ•°è¿‡å¤šï¼Œä¸ºäº†ä¾¿äºæ¼”ç¤ºï¼Œè¿™é‡ŒæœªåšèŠ‚æµ</span>
    <span class="token keyword">async</span> <span class="token function">handleConfirm</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>selected<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data
      <span class="token comment">// ç”¨æˆ·æœªå‹¾é€‰ï¼Œæç¤ºè¯·å‹¾é€‰</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>selected<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'è¯·åŒæ„ã€Šç”¨æˆ·éšç§åè®®ã€‹'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">'none'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// data.detail.codeå°±æ˜¯è·å–æ‰‹æœºå·çš„åŠ¨æ€ä»¤ç‰Œ</span>
      <span class="token keyword">let</span> info <span class="token operator">=</span> data<span class="token punctuation">.</span>detail
      <span class="token keyword">let</span> fail <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>loginFail
      <span class="token keyword">if</span> <span class="token punctuation">(</span>info<span class="token punctuation">.</span>code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// info.codeå°±æ˜¯æ‰‹æœºå·åŠ¨æ€ä»¤ç‰Œ</span>
        
        <span class="token comment">/**æ–°ç‰ˆæœ¬å¾®ä¿¡å°ç¨‹åºä¸éœ€è¦æå‰è°ƒç”¨wx.loginè¿›è¡Œç™»å½•ï¼Œè¿™é‡Œçš„å†™æ³•æ˜¯ä¸ºäº†å®é…è€ç‰ˆæœ¬ï¼Œåœ¨è·å–æ‰‹æœºå·æˆæƒç™»å½•ä¹‹å‰å…ˆè°ƒç”¨wx.login
           è¿™é‡Œçš„app.globalData.userInfoä¸ºå…¨å±€æŒ‚è½½çš„userInfoï¼Œå…³äºuserInfoçš„è§£é‡Šåœ¨æœ¬æ–‡ä¸‹æ–¹
        */</span>
        <span class="token comment">/* ä½¿ç”¨awiaté˜»å¡è¿›ç¨‹ */</span>
        <span class="token keyword">await</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span><span class="token function">_getLoginCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// wx.loginç™»å½•</span>
        <span class="token comment">// è°ƒç”¨äº†wx.loginåè¿›å…¥ä¸‹ä¸€æ­¥</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setPhoneInfo</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span>  <span class="token comment">// ç»‘å®šæ‰‹æœºå·-è·å–æ‰‹æœºå·æˆæƒç”¨æˆ·ç™»å½•åŠŸèƒ½</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        fail <span class="token operator">&amp;&amp;</span> <span class="token function">fail</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    

<span class="token comment">// ç»‘å®šæ‰‹æœºå·-è·å–æ‰‹æœºå·æˆæƒç”¨æˆ·ç™»å½•åŠŸèƒ½</span>
<span class="token function">setPhoneInfo</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> success <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>loginSuccess
  <span class="token keyword">let</span> fail <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>loginFail
  <span class="token comment">// data.jsCodeä¿å­˜é€šè¿‡loginè·å–çš„code</span>
  data<span class="token punctuation">.</span>jsCode <span class="token operator">=</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>code
  <span class="token comment">// æ‰‹æœºå·åŠ¨æ€ä»¤ç‰Œ</span>
  data<span class="token punctuation">.</span>phoneCode <span class="token operator">=</span> data<span class="token punctuation">.</span>code 
  <span class="token comment">// è°ƒç”¨ç”¨æˆ·ç™»å½•æ¥å£ï¼ŒremoveNullå…¶å®æ˜¯ä¸€ä¸ªå°è£…çš„æ–¹æ³•ï¼Œ ç”¨æ¥å»æ‰ç©ºæ ¼ï¼Œæœ¬è´¨å°±æ˜¯ä¼ äº†ä¸€ä¸ªdata</span>
  <span class="token function">getLoginSession</span><span class="token punctuation">(</span><span class="token function">removeNull</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// thenä¸ºç™»å½•æˆåŠŸï¼Œå­˜å…¥token</span>
    wx<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token comment">// æ‰‹æœºå·æˆæƒç®—ç™»å½•æˆåŠŸ</span>
    success <span class="token operator">&amp;&amp;</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// è®¾ç½®å…¨å±€userInfoå±æ€§,isLogin = trueï¼Œè¡¨ç¤ºç™»å½•æˆåŠŸ</span>
    app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>isLogin <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token comment">// æ¸…é™¤ç­‰å¾…åˆ—è¡¨</span>
    wx<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">asyncExe</span><span class="token punctuation">(</span><span class="token string">"login_back"</span><span class="token punctuation">)</span>
    <span class="token comment">// è°ƒç”¨å…¨å±€çš„_getUserInfoæ–¹æ³•,ä¼ å…¥'login'å‚æ•°</span>
    <span class="token keyword">await</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span><span class="token function">_getUserInfo</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span>
    <span class="token comment">// å…³é—­å¼¹æ¡†</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hideLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"å·²ç»‘å®š"</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      success <span class="token operator">&amp;&amp;</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      wx<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
      <span class="token keyword">await</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span><span class="token function">_getUserInfo</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
      fail <span class="token operator">&amp;&amp;</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å…³é—­å¼¹æ¡†</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hideLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>


<span class="token comment">// å…³é—­å¼¹æ¡†</span>
<span class="token function">hideLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// å…³é—­å¼¹æ¡†</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">show</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPopup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// æ˜¾ç¤ºtabbar()</span>
          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTabBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
    <p>
     æ—§ç‰ˆæœ¬çš„å¾®ä¿¡å°ç¨‹åºæ˜¯éœ€è¦æå‰è°ƒç”¨
     <code>
      wx.login
     </code>
     è·å–
     <code>
      code
     </code>
     æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œè€Œæ–°ç‰ˆæœ¬åˆ™ä¸éœ€è¦æå‰è°ƒç”¨
     <code>
      wx.login
     </code>
     è¿›è¡Œç™»å½•ã€‚
     <br/>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/3b569c08bc4419621b9e1c1b398de32b.png">
      <br/>
      <a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.login.html" rel="nofollow">
       wx.loginæ–‡æ¡£
      </a>
      ï¼ˆ ğŸ‘ˆ ç‚¹å‡»ç›´è¾¾ï¼‰
     </img>
    </p>
    <p>
     ä¸‹é¢æ˜¯
     <code>
      userInfo.js
     </code>
     æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ª
     <code>
      class
     </code>
     ç±»ï¼Œè¯¥ç±»ä¼šæŒ‚è½½åˆ°å…¨å±€å®ä¾‹èº«ä¸Š
    </p>
    <pre><code class="prism language-js"><span class="token comment">// userInfo.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>
  getUserInfo
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../service/user'</span>
<span class="token keyword">class</span> <span class="token class-name">UserInfo</span> <span class="token punctuation">{<!-- --></span>
  code <span class="token operator">=</span> <span class="token string">''</span> <span class="token comment">// ç”¨æˆ·æˆæƒç™»å½•æ—¶éœ€è¦ç”¨åˆ°çš„code</span>
  isLogin <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»ç™»å½•æ‹¿åˆ°token</span>
  isInfo <span class="token operator">=</span> <span class="token boolean">false</span>  <span class="token comment">// åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»ç™»å½•äº†</span>

  <span class="token comment">/**
   * è·å–ç”¨æˆ·ä¿¡æ¯
   */</span>
  <span class="token function">_getUserInfo</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
      <span class="token comment">// isInfoåˆå§‹åŒ–ä¸ºfalseï¼Œè¡¨ç¤ºæœªç™»å½•è¿‡ï¼Œå¦‚ç™»å½•è¿‡isInfo = true,å¦‚æœç™»å½•è¿‡åˆ™ç›´æ¥è·å–æœ¬åœ°çš„token</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>type<span class="token operator">==</span><span class="token string">"login"</span><span class="token operator">&amp;&amp;</span><span class="token keyword">this</span><span class="token punctuation">.</span>isInfo<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'userInfo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>isInfo <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token comment">// è°ƒç”¨è·å–ç”¨æˆ·ä¿¡æ¯çš„æ¥å£</span>
      <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// å¦‚æœè¿”å›200ï¼Œæ‹¿åˆ°tokenä»¥åï¼Œä¿å­˜ç”¨æˆ·çš„ä¿¡æ¯ï¼Œä¸»è¦æ˜¯åç§°å’Œå¤´åƒ</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°æœ¬åœ°</span>
          wx<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'userInfo'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
          <span class="token comment">// resolveè¿”å›</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// ä¸ç­‰äº200 isInfo = falseï¼Œè¡¨ç¤ºå·²ç»ç™»å½•è¿‡ï¼Œé‡æ–°è·å–å³å¯</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isInfo <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token comment">// ä¸ç­‰äº200 è¿”å›é”™è¯¯ä¿¡æ¯</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ä¸ç­‰äº200 isInfo = falseï¼Œè¡¨ç¤ºå·²ç»ç™»å½•è¿‡ï¼Œé‡æ–°è·å–å³å¯</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isInfo <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token comment">// ä¸ç­‰äº200 è¿”å›é”™è¯¯ä¿¡æ¯</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * é€šè¿‡wx.loginè·å–code
   * ä¸å…¨å±€è°ƒç”¨ï¼Œæ¯æ¬¡æˆæƒè°ƒç”¨Loginæ–¹æ³•å‰ï¼Œéƒ½é‡æ–°è·å–ä¸€æ¬¡
   */</span>
  <span class="token keyword">async</span> <span class="token function">_getLoginCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> loginCodeRes <span class="token operator">=</span> <span class="token keyword">await</span> wx<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>loginCodeRes<span class="token punctuation">)</span>
      <span class="token comment">/**loginCodeRes.code : ç”¨æˆ·ç™»å½•å‡­è¯ï¼ˆæœ‰æ•ˆæœŸäº”åˆ†é’Ÿï¼‰ã€‚å¼€å‘è€…éœ€è¦åœ¨å¼€å‘è€…æœåŠ¡å™¨åå°è°ƒç”¨ code2Sessionï¼Œä½¿ç”¨ code æ¢å– openidã€unionidã€session_key ç­‰ä¿¡æ¯ */</span>

      <span class="token comment">// å°†è¯¥codeæŒ‚è½½åˆ°å…¨å±€çš„global.userInfoä¸­</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> loginCodeRes<span class="token punctuation">.</span>code
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token string">'get jscode error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> UserInfo
</code></pre>
    <pre><code class="prism language-js"><span class="token comment">// app.js</span>
<span class="token keyword">import</span> UserInfo <span class="token keyword">from</span> <span class="token string">'./private/UserInfo'</span>

<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">/** å°ç¨‹åºç”Ÿå‘½å‘¨æœŸï¼Œå…¨å±€è°ƒç”¨ä¸€æ¬¡onLaunch */</span>
  <span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**new UserInfo() */</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">onShow</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token literal-property property">globalData</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">userInfo</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>   <span class="token comment">/**private -&gt; UserInfoçš„å±æ€§å’Œæ–¹æ³•æŒ‚è½½åˆ°è¿™é‡Œ */</span>
    <span class="token literal-property property">show</span><span class="token operator">:</span><span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_208">
     </a>
     æµç¨‹æ€»ç»“
    </h4>
    <p>
     é€šè¿‡
     <code>
      getPhoneNumber
     </code>
     çš„æ–¹å¼ç™»å½•
    </p>
    <p>
     1ã€
     <code>
      components
     </code>
     ä¸­åˆ›å»º
     <code>
      auth
     </code>
     æ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹å°±æ˜¯å†…çš„
     <code>
      html
     </code>
     å°±æ˜¯å°ç¨‹åºçš„ç™»å½•å¼¹çª—ï¼Œ
     <code>
      auth
     </code>
     æ˜¯ä¸€ä¸ªå…¨å±€ç»„ä»¶ï¼Œåœ¨
     <code>
      app.json
     </code>
     ä¸­æŒ‚è½½
    </p>
    <p>
     2ã€åœ¨
     <code>
      private
     </code>
     æ–‡ä»¶å¤¹ä¸­å°è£…å°ç¨‹åºçš„ç™»å½•æ–¹æ³• â€”â€”&gt;
     <code>
      UserInfo.js
     </code>
     â€”â€”&gt;
     <code>
      js
     </code>
     æ–‡ä»¶å†…åˆ›å»º
     <code>
      class
     </code>
     ç±»ï¼Œåœ¨
     <code>
      class
     </code>
     ä¸­
     <code>
      å°è£…æ–¹æ³•å¹¶å¯¼å‡º
     </code>
    </p>
    <p>
     3ã€åœ¨
     <code>
      app.js
     </code>
     çš„
     <code>
      onLaunch
     </code>
     ä¸­
     <code>
      new UserInfo
     </code>
     è·å–ä¹‹å‰å°è£…å¥½çš„å°ç¨‹åºç™»å½•æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æŒ‚è½½åˆ°
     <code>
      globalData.userInfo
     </code>
     ä¸­
    </p>
    <pre><code class="prism language-js"><span class="token keyword">import</span> UserInfo <span class="token keyword">from</span> <span class="token string">'./private/UserInfo'</span>
<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     4ã€
     <code>
      auth
     </code>
     æ–‡ä»¶å¤¹ä¸ºå°ç¨‹åºçš„å…¨å±€æˆæƒç™»å½•å¼¹çª—ï¼Œä»åŸºç¡€åº“
     <code>
      2.21.2
     </code>
     å¼€å§‹ï¼Œå¯¹è·å–æ‰‹æœºå·çš„æ¥å£è¿›è¡Œäº†å®‰å…¨å‡çº§ï¼Œæ–°ç‰ˆå°ç¨‹åºéœ€è¦ç”¨æˆ·è‡ªåŠ¨è§¦å‘æ‰èƒ½è·å–æ‰‹æœºå·æ¥å£ï¼Œéœ€ç”¨
     <a href="https://developers.weixin.qq.com/miniprogram/dev/component/button.html" rel="nofollow">
      button
     </a>
     ç»„ä»¶çš„ç‚¹å‡»æ¥è§¦å‘ã€‚æ–°ç‰ˆå°ç¨‹åºä¸å†éœ€è¦æå‰è°ƒç”¨
     <code>
      wx.login
     </code>
     è¿›è¡Œç™»å½•
    </p>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">open-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getPhoneNumber<span class="token punctuation">"</span></span> <span class="token attr-name">bindgetphonenumber</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getPhoneNumber<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <pre><code class="prism language-js"><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token function">getPhoneNumber</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>code<span class="token punctuation">)</span>  <span class="token comment">// è¯¥codeå°±æ˜¯åŠ¨æ€ä»¤ç‰Œï¼Œç”¨äºæ¢å–ç”¨æˆ·æ‰‹æœºå·</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     éœ€è¦å°†
     <a href="https://developers.weixin.qq.com/miniprogram/dev/component/button.html" rel="nofollow">
      button
     </a>
     ç»„ä»¶
     <code>
      open-type
     </code>
     çš„å€¼è®¾ç½®ä¸º
     <code>
      getPhoneNumber
     </code>
     ï¼Œå½“ç”¨æˆ·ç‚¹å‡»å¹¶åŒæ„ä¹‹åï¼Œå¯ä»¥é€šè¿‡
     <code>
      bindgetphonenumber
     </code>
     äº‹ä»¶å›è°ƒè·å–åˆ°åŠ¨æ€ä»¤ç‰Œ
     <code>
      code
     </code>
     ï¼Œç„¶åæŠŠ
     <code>
      code
     </code>
     ä¼ åˆ°å¼€å‘è€…åå°ï¼Œå¹¶åœ¨å¼€å‘è€…åå°è°ƒç”¨å¾®ä¿¡åå°æä¾›çš„
     <a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/phonenumber/phonenumber.getPhoneNumber.html" rel="nofollow">
      phonenumber.getPhoneNumber
     </a>
     æ¥å£ï¼Œæ¶ˆè´¹
     <code>
      code
     </code>
     æ¥æ¢å–ç”¨æˆ·æ‰‹æœºå·ã€‚æ¯ä¸ª
     <code>
      code
     </code>
     æœ‰æ•ˆæœŸä¸º5åˆ†é’Ÿï¼Œä¸”åªèƒ½æ¶ˆè´¹ä¸€æ¬¡ã€‚
    </p>
    <blockquote>
     <p>
      æ³¨ï¼š
      <code>
       getPhoneNumber
      </code>
      è¿”å›çš„
      <code>
       code
      </code>
      ä¸
      <code>
       wx.login
      </code>
      è¿”å›çš„
      <code>
       code
      </code>
      ä½œç”¨æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸èƒ½æ··ç”¨ã€‚
     </p>
    </blockquote>
    <p>
     5ã€ç”¨æˆ·ç‚¹å‡»å¼¹æ¡†åï¼Œå…ˆè®©ç”¨æˆ·å‹¾é€‰åè®®ï¼Œå‹¾é€‰åæ‰å…è®¸ç‚¹å‡»ç™»å½•ï¼Œè°ƒç”¨ç™»å½•æ¥å£ï¼Œå°†ç™»å½•æ¥å£å•ç‹¬å°è£…èµ·æ¥ï¼Œå°†è·å–åˆ°çš„
     <code>
      code
     </code>
     æ‰‹æœºå·åŠ¨æ€ä»¤ç‰Œå½“å‚æ•°ä¼ å…¥ç™»å½•æ–¹æ³•ã€‚
    </p>
    <blockquote>
     <p>
      æ–°ç‰ˆæœ¬å¾®ä¿¡ä¸è®¸è¦æå‰è°ƒç”¨
      <code>
       login
      </code>
      æ¥è·å–
      <code>
       code
      </code>
      ç ï¼Œæ—§ç‰ˆæœ¬å¾®ä¿¡å°ç¨‹åºæ˜¯éœ€è¦æå‰è°ƒç”¨
      <code>
       login
      </code>
      è·å–
      <code>
       code
      </code>
      ç 
     </p>
     <p>
      ä¸ºäº†æ¼”ç¤ºï¼Œæ‰€ä»¥è¿™é‡Œæå‰è°ƒç”¨
      <code>
       wx.login
      </code>
      æ¥è·å–
      <code>
       code
      </code>
      ç ï¼Œå¹¶å°†è¯¥
      <code>
       code
      </code>
      ç å­˜å…¥å…¨å±€
      <code>
       app.globalData.userInfo
      </code>
      ä¸­ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥
      <code>
       code
      </code>
      ç çš„æœ‰æ•ˆæœŸæ˜¯
      <code>
       5åˆ†é’Ÿ
      </code>
     </p>
    </blockquote>
    <p>
     6ã€è°ƒç”¨ç™»å½•æ–¹æ³•ï¼Œ æºå¸¦
     <code>
      code
     </code>
     æ‰‹æœºå·åŠ¨æ€ä»¤ç‰Œå’Œæ¥å£è§„å®šçš„å¿…ä¼ å‚æ•°ï¼Œè¯·æ±‚ç™»å½•æ¥å£ï¼Œè¿”å›
     <code>
      200
     </code>
     ä¸ºç™»å½•æˆåŠŸï¼Œ
    </p>
    <pre><code class="prism language-js"><span class="token number">1</span><span class="token punctuation">)</span>ã€å°†ç™»å½•æˆåŠŸçš„tokenå­˜å…¥æœ¬åœ°
	
<span class="token number">2</span><span class="token punctuation">)</span>ã€è®¾ç½®å…¨å±€å±æ€§app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>isLogin <span class="token operator">=</span> <span class="token boolean">true</span>è¡¨ç¤ºç™»å½•æˆåŠŸ
	
<span class="token number">3</span><span class="token punctuation">)</span>ã€æ¸…é™¤ç­‰å¾…åˆ—è¡¨
</code></pre>
    <p>
     7ã€è°ƒç”¨è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£ï¼Œä¹Ÿå°±æ˜¯å…¨å±€æŒ‚è½½çš„
     <code>
      await app.globalData.userInfo._getUserInfo()
     </code>
     ï¼Œå…³é—­ç™»å½•å¼¹æ¡†
    </p>
    <pre><code class="prism language-js"><span class="token keyword">await</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span><span class="token function">_getUserInfo</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     8ã€è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£ï¼Œé€šè¿‡ä¼ å…¥çš„å‚æ•°åˆ¤æ–­æ˜¯æ˜¯å¦è¦ç™»å½•ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µï¼š
    </p>
    <pre><code class="prism language-js"><span class="token number">1</span><span class="token punctuation">)</span>ã€ç”¨æˆ·å·²ç»ç™»å½•äº†ï¼Œåªæ˜¯æƒ³é‡æ–°è·å–ä¸€ä¸‹token
	
<span class="token number">2</span><span class="token punctuation">)</span>ã€ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•ï¼Œè¦è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œä¾‹å¦‚å¤´åƒã€ç”¨æˆ·åç§°
</code></pre>
    <p>
     æ ¹æ®è¿™ä¸¤ç§æƒ…å†µï¼Œä¼ å…¥çš„å‚æ•°
     <code>
      "login"
     </code>
     å½“ç„¶æ˜¯ä¸å¤Ÿçš„ï¼Œæ‰€ä»¥éœ€è¦å†åŠ ä¸€ä¸ªçŠ¶æ€ï¼Œ
     <code>
      isInfo
     </code>
     ï¼Œ
     <code>
      isInfo
     </code>
     é»˜è®¤ä¸º
     <code>
      false
     </code>
    </p>
    <pre><code class="prism language-js">  <span class="token comment">/**
   * è·å–ç”¨æˆ·ä¿¡æ¯
   */</span>
  <span class="token function">_getUserInfo</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
      <span class="token comment">// ç”¨æˆ·ç™»å½•è¿‡</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>type<span class="token operator">==</span><span class="token string">"login"</span><span class="token operator">&amp;&amp;</span><span class="token keyword">this</span><span class="token punctuation">.</span>isInfo<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'userInfo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
      <span class="token comment">// è®¾ç½®isInfo = trueï¼Œå› ä¸ºä¸‹é¢è¦èµ°è·å–ç”¨æˆ·ä¿¡æ¯æµç¨‹ï¼Œè·å–åï¼Œç¬¬äºŒæ¬¡è°ƒç”¨_getUserInfoåˆ¤æ–­isInfo = true,ç›´æ¥returnæ‰</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>isInfo <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token comment">// è°ƒç”¨è·å–ç”¨æˆ·ä¿¡æ¯çš„æ¥å£</span>
      <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// å¦‚æœè¿”å›200ï¼Œæ‹¿åˆ°tokenä»¥åï¼Œä¿å­˜ç”¨æˆ·çš„ä¿¡æ¯ï¼Œä¸»è¦æ˜¯åç§°å’Œå¤´åƒ</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°æœ¬åœ°</span>
          wx<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'userInfo'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
          <span class="token comment">// resolveè¿”å›</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// ä¸ç­‰äº200 isInfo = falseï¼Œè¡¨ç¤ºå·²ç»ç™»å½•è¿‡ï¼Œé‡æ–°è·å–å³å¯</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isInfo <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token comment">// ä¸ç­‰äº200 è¿”å›é”™è¯¯ä¿¡æ¯</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ä¸ç­‰äº200 isInfo = falseï¼Œè¡¨ç¤ºå·²ç»ç™»å½•è¿‡ï¼Œé‡æ–°è·å–å³å¯</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isInfo <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token comment">// ä¸ç­‰äº200 è¿”å›é”™è¯¯ä¿¡æ¯</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre>
    <p>
     æœ€åé™„ä¸Š
     <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html" rel="nofollow">
      å¾®ä¿¡å®˜æ–¹å¯¹ç™»å½•çš„è¯´æ˜
     </a>
     ï¼ˆ ğŸ‘ˆ ç‚¹å‡»ç›´è¾¾ï¼‰
    </p>
    <p>
     ä»¥ä¸Šå°±æ˜¯å¾®ä¿¡å°ç¨‹åºçš„ç™»å½•æµç¨‹ï¼Œè¿™äº›æ­¥éª¤éƒ½æ˜¯æŒ‰å®é™…éœ€æ±‚ç¼–å†™çš„ï¼Œæœ‰äº›æ—¶å€™æµç¨‹çš„2ã€3ã€4ã€5ã€6éƒ½æ˜¯æ··ç€å†™çš„ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®é¡¹ç›®çš„å®é™…éœ€æ±‚åšè‡ªç”±è°ƒæ•´ã€‚
    </p>
    <hr/>
    <p>
     å¦‚æœè§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—ã€è½¬å‘å“¦~
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
</div>


