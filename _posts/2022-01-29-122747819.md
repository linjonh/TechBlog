---
layout: post
title: "C-调用-ffmpeg.exe-执行音视频混流合并"
date: 2022-01-29 21:20:04 +0800
description: "ffmpeg.exe文件可以去官网下载：FFmpeg官网似乎不提供32位dll文件的下载了，但是可以"
keywords: "c++ system函数 ffmpeg"
categories: ['多媒体文件', 'C']
tags: ['音视频', '蓝桥杯', 'Ffmpeg', 'C']
artid: "122747819"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=122747819
    alt: "C-调用-ffmpeg.exe-执行音视频混流合并"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     C++ 调用 ffmpeg.exe 执行音视频混流合并；
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     ffmpeg.exe文件可以去官网下载：
     <a href="http://ffmpeg.org/" rel="nofollow" title="FFmpeg">
      FFmpeg
     </a>
    </p>
    <p>
     官网似乎不提供32位dll文件的下载了，但是可以下载exe文件来直接调用；
    </p>
    <pre><code class="language-cpp">
#include &lt;iostream&gt;
#include &lt;io.h&gt;
#include &lt;direct.h&gt;
#include &lt;cstdlib&gt;
using namespace std;
/// &lt;summary&gt;
/// C++ 调用 ffmpeg.exe 执行音视频混流合并
/// &lt;/summary&gt;
/// 输入的命令中路径参数不需要加双引号，此方法会自动添加双引号以排除system（）路径空格的问题
/// &lt;param name="_pathVedio"&gt;视频文件路径&lt;/param&gt;
/// &lt;param name="_pathAudio"&gt;音频文件路径&lt;/param&gt;
/// &lt;param name="_pathOutput"&gt;输出目录&lt;/param&gt;
/// &lt;param name="_pathFfmpegExe"&gt;ffmpeg.exe文件路径&lt;/param&gt;
extern "C" _declspec(dllexport)
bool combineVedioAudio(string _pathVedio, string _pathAudio, string _nameOut, string _pathOutput, string _pathFfmpegExe)
{
	string outPutFilePath = _pathOutput + "\\" + _nameOut;// _最终的输出文件的完整路径
	//参数检错
	{
		if (0 != _access(_pathAudio.c_str(), 0))//音频文件不存在
			return false;
		if (0 != _access(_pathVedio.c_str(), 0))//视频文件不存在
			return false;
		if (0 != _access(_pathFfmpegExe.c_str(), 0))//ffmpeg.exe文件不存在
			return false;
		if (0 != _access(_pathOutput.c_str(), 0))//输出目录不存在，则创建目录
		{
			if (0 != _mkdir(_pathOutput.c_str()))
				return false;
		}
	}
	// 备注 -- system命令中含有空格时，会导致命令错误理解，将其视作多个目录名字，将其用引号包含起来可以解决，即：a 改为 "a"
	{
		_pathOutput = "\"" + outPutFilePath+ "\"";
		_pathAudio = "\"" + _pathAudio + "\"";
		_pathVedio = "\"" + _pathVedio + "\"";
		_pathFfmpegExe = "\"" + _pathFfmpegExe + "\"";
	}
	//组合system命令
	string command =
		_pathFfmpegExe
		+ " -i " + _pathVedio
		+ " -i " + _pathAudio
		+ " -codec copy " + _pathOutput;
	//备注：：多对双引号时，system,会去掉首尾 的双引号；所以在命令头部和尾部各自加一个双引号：
	command = "\"" + command + "\"";

	//执行命令
	// cout &lt;&lt; "\n\n" + command + "\n\n" &lt;&lt; endl;
	system(command.c_str());
	//检查执行结果
	if ( 0 != _access(outPutFilePath.c_str(),0) )
		return false;
	else
		return true;
}
</code></pre>
    <p>
     vs2019，添加头文件&lt;string&gt;的时候，使用system（）方法时出现了“system不明确”的问题，不知道是因为什么。
    </p>
    <p>
     ‘删掉该头文件后可以继续使用
    </p>
    <p>
    </p>
    <p>
     ----------------------------------------------------------------------------------------------------------------------
    </p>
    <p>
     调整了一下参数，方便移植调用
    </p>
    <pre><code class="language-cpp">#pragma once
#include &lt;iostream&gt;
#include &lt;io.h&gt;
#include &lt;direct.h&gt;
using namespace std;
/// &lt;summary&gt;
/// C++ 调用 ffmpeg.exe 执行音视频混流合并
/// &lt;/summary&gt;
/// 输入的命令中路径参数不需要加双引号，此方法会自动添加双引号以排除system（）路径空格的问题
/// &lt;param name="pathVedio"&gt;视频文件路径&lt;/param&gt;
/// &lt;param name="pathAudio"&gt;音频文件路径&lt;/param&gt;
/// &lt;param name="pathOutput"&gt;输出目录&lt;/param&gt;
/// &lt;param name="pathFfmpegExe"&gt;ffmpeg.exe文件路径&lt;/param&gt;
extern "C" _declspec(dllexport)
bool combineVedioAudio(char* pathVedio, char* pathAudio, char* nameOut, char* pathOutput, char* pathFfmpegExe)
{
	string outPutFilePath;// _最终的输出文件的完整路径
	//参数整理
	string _pathVedio(pathVedio);
	string _pathAudio(pathAudio);
	string _nameOut(nameOut);
	string _pathOutput(pathOutput);
	string _pathFfmpegExe(pathFfmpegExe);
	outPutFilePath = _pathOutput + "\\" + _nameOut;

	//参数检错
	{
		if (0 != _access(_pathAudio.c_str(), 0))//音频文件不存在
		{
			cout &lt;&lt; "音频文件不存在" &lt;&lt; endl;
			return false;
		}
		if (0 != _access(_pathVedio.c_str(), 0))//视频文件不存在
		{
			cout &lt;&lt; "视频文件不存在" &lt;&lt; endl;
			return false;
		}
		if (0 != _access(_pathFfmpegExe.c_str(), 0))//ffmpeg.exe文件不存在
		{
			cout &lt;&lt; "ffmpeg.exe文件不存在" &lt;&lt; endl;
			return false;
		}
		if (0 != _access(_pathOutput.c_str(), 0))//输出目录不存在，则创建目录
		{
			if (0 != _mkdir(_pathOutput.c_str()))
			{
				cout &lt;&lt; "输出目录不存在，且创建失败" &lt;&lt; endl;
				return false;
			}
		}
	}
	// 备注 -- system命令中含有空格时，会导致命令错误理解，将其视作多个目录名字，将其用引号包含起来可以解决，即：a 改为 "a"
	{
		_pathOutput = "\"" + outPutFilePath + "\"";
		_pathAudio = "\"" + _pathAudio + "\"";
		_pathVedio = "\"" + _pathVedio + "\"";
		_pathFfmpegExe = "\"" + _pathFfmpegExe + "\"";
	}
	//组合system命令
	string command =
		_pathFfmpegExe
		+ " -i " + _pathVedio
		+ " -i " + _pathAudio
		+ " -codec copy " + _pathOutput;
	//备注：：多对双引号时，system,会去掉首尾 的双引号；所以在命令头部和尾部各自加一个双引号：
	command = "\"" + command + "\"";

	//执行命令
	cout &lt;&lt; "\n\n" + command + "\n\n" &lt;&lt; endl;
	system(command.c_str());
	//检查执行结果
	if (0 != _access(outPutFilePath.c_str(), 0))
		return false;
	else
		return true;
}
</code></pre>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34333437323537332f:61727469636c652f64657461696c732f313232373437383139" class_="artid" style="display:none">
 </p>
</div>


