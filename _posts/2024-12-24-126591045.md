---
layout: post
title: 小程序音视频1live-pusher
date: 2024-12-24 18:00:43 +0800
description: 文章浏览阅读2.4k次。是小程序内部用于支持音视频上行能力的功能标签_live-pusher
keywords: live-pusher
categories: ['小程序']
tags: ['小程序']
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=126591045
    alt: 小程序音视频1live-pusher
artid: 126591045
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     小程序+音视频1：live-pusher
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h4>
     前言：
    </h4>
    <h4>
     小程序中实现直播功能。
    </h4>
    <blockquote>
     <p>
      <strong>
       &lt;live-pusher&gt;
      </strong>
      是小程序内部用于支持音视频上行能力的功能标签
     </p>
    </blockquote>
    <h3 id=".E7.89.88.E6.9C.AC.E6.94.AF.E6.8C.81">
     版本支持
    </h3>
    <ul>
     <li>
      微信 App iOS 最低版本要求：6.5.21。
     </li>
     <li>
      微信 App Android 最低版本要求：6.5.19。
     </li>
     <li>
      小程序基础库最低版本要求：1.7.0。
     </li>
    </ul>
    <h3 id=".E4.BD.BF.E7.94.A8.E9.99.90.E5.88.B6">
     使用限制
    </h3>
    <p>
     出于政策和合规的考虑，微信暂时没有放开所有小程序对 &lt;live-pusher&gt; 和 &lt;live-player&gt; 标签的支持：
    </p>
    <ul>
     <li>
      个人账号和企业账号的小程序暂时只开放如下表格中的类目：
      <table>
       <tbody>
        <tr>
         <th>
          主类目
         </th>
         <th>
          子类目
         </th>
         <th>
          小程序内容场景
         </th>
        </tr>
        <tr>
         <td>
          社交
         </td>
         <td>
          直播
         </td>
         <td>
          涉及娱乐性质，如明星直播、生活趣事直播和宠物直播等。选择该类目后首次提交代码审核，需经当地互联网主管机关审核确认，预计审核时长7天左右
         </td>
        </tr>
        <tr>
         <td>
          教育
         </td>
         <td>
          在线视频课程
         </td>
         <td>
          网课、在线培训、讲座等教育类直播
         </td>
        </tr>
        <tr>
         <td>
          医疗
         </td>
         <td>
          互联网医院，公立医院
         </td>
         <td>
          问诊、大型健康讲座等直播
         </td>
        </tr>
        <tr>
         <td>
          金融
         </td>
         <td>
          银行、信托、基金、证券/期货、证券、期货投资咨询、保险、征信业务、新三板信息服务平台、股票信息服务平台（港股/美股）、消费金融
         </td>
         <td>
          金融产品视频客服理赔、金融产品推广直播等
         </td>
        </tr>
        <tr>
         <td>
          汽车
         </td>
         <td>
          汽车预售服务
         </td>
         <td>
          汽车预售、推广直播
         </td>
        </tr>
        <tr>
         <td>
          政府主体帐号
         </td>
         <td>
          -
         </td>
         <td>
          政府相关工作推广直播、领导讲话直播等
         </td>
        </tr>
        <tr>
         <td>
          工具
         </td>
         <td>
          视频客服
         </td>
         <td>
          不涉及以上几类内容的一对一视频客服服务，如企业售后一对一视频服务等
         </td>
        </tr>
        <tr>
         <td>
          IT 科技
         </td>
         <td>
          多方通信；音视频设备
         </td>
         <td>
          为多方提供电话会议/视频会议等服务；智能家居场景下控制摄像头
         </td>
        </tr>
       </tbody>
      </table>
     </li>
    </ul>
    <ul>
     <li>
      符合类目要求的小程序，需要在小程序管理后台的【开发】&gt;【接口设置】中自助开通推拉流标签的使用权限，如下图所示：
     </li>
    </ul>
    <p class="img-center">
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/f1aff8721211ecdd0e362699d3808147.jpeg"/>
    </p>
    <h3 id=".E5.B1.9E.E6.80.A7.E5.AE.9A.E4.B9.89">
     属性定义
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        属性名
       </th>
       <th>
        类型
       </th>
       <th>
        默认值
       </th>
       <th>
        说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        url
       </td>
       <td>
        String
       </td>
       <td>
        -
       </td>
       <td>
        用于音视频上行的推流 URL
       </td>
      </tr>
      <tr>
       <td>
        mode
       </td>
       <td>
        String
       </td>
       <td>
        RTC
       </td>
       <td>
        SD，HD，FHD，RTC
       </td>
      </tr>
      <tr>
       <td>
        autopush
       </td>
       <td>
        Boolean
       </td>
       <td>
        false
       </td>
       <td>
        是否自动启动推流
       </td>
      </tr>
      <tr>
       <td>
        muted
       </td>
       <td>
        Boolean
       </td>
       <td>
        false
       </td>
       <td>
        是否静音
       </td>
      </tr>
      <tr>
       <td>
        enable-camera
       </td>
       <td>
        Boolean
       </td>
       <td>
        true
       </td>
       <td>
        开启\关闭摄像头
       </td>
      </tr>
      <tr>
       <td>
        auto-focus
       </td>
       <td>
        Boolean
       </td>
       <td>
        true
       </td>
       <td>
        手动\自动对焦
       </td>
      </tr>
      <tr>
       <td>
        orientation
       </td>
       <td>
        String
       </td>
       <td>
        vertical
       </td>
       <td>
        vertical，horizontal
       </td>
      </tr>
      <tr>
       <td>
        beauty
       </td>
       <td>
        Number
       </td>
       <td>
        0
       </td>
       <td>
        美颜指数，取值 0 - 9，数值越大效果越明显
       </td>
      </tr>
      <tr>
       <td>
        whiteness
       </td>
       <td>
        Number
       </td>
       <td>
        0
       </td>
       <td>
        美白指数，取值 0 - 9，数值越大效果越明显
       </td>
      </tr>
      <tr>
       <td>
        aspect
       </td>
       <td>
        String
       </td>
       <td>
        9：16
       </td>
       <td>
        3：4，9：16
       </td>
      </tr>
      <tr>
       <td>
        zoom
       </td>
       <td>
        Boolean
       </td>
       <td>
        false
       </td>
       <td>
        是否正常焦距，true 表示将摄像头放大
       </td>
      </tr>
      <tr>
       <td>
        device-position
       </td>
       <td>
        String
       </td>
       <td>
        front
       </td>
       <td>
        front 前置摄像头，back 后置摄像头
       </td>
      </tr>
      <tr>
       <td>
        min-bitrate
       </td>
       <td>
        Number
       </td>
       <td>
        200
       </td>
       <td>
        最小码率，该数值决定了画面最差的清晰度表现
       </td>
      </tr>
      <tr>
       <td>
        max-bitrate
       </td>
       <td>
        Number
       </td>
       <td>
        1000
       </td>
       <td>
        最大码率，该数值决定了画面最好的清晰度表现
       </td>
      </tr>
      <tr>
       <td>
        audio-quality
       </td>
       <td>
        String
       </td>
       <td>
        low
       </td>
       <td>
        low 适合语音通话，high 代表高音质
       </td>
      </tr>
      <tr>
       <td>
        waiting-image
       </td>
       <td>
        String
       </td>
       <td>
        -
       </td>
       <td>
        当微信切到后台时的垫片图片
       </td>
      </tr>
      <tr>
       <td>
        waiting-image-hash
       </td>
       <td>
        String
       </td>
       <td>
        -
       </td>
       <td>
        当微信切到后台时的垫片图片的校验值
       </td>
      </tr>
      <tr>
       <td>
        background-mute
       </td>
       <td>
        Boolean
       </td>
       <td>
        false
       </td>
       <td>
        当微信切到后台时是否禁用声音采集
       </td>
      </tr>
      <tr>
       <td>
        bindstatechange
       </td>
       <td>
        String
       </td>
       <td>
        -
       </td>
       <td>
        用于指定一个 javascript 函数来接收音视频事件
       </td>
      </tr>
      <tr>
       <td>
        debug
       </td>
       <td>
        Boolean
       </td>
       <td>
        false
       </td>
       <td>
        是否开启调试模式
       </td>
      </tr>
     </tbody>
    </table>
    <h3 id=".E7.A4.BA.E4.BE.8B.E4.BB.A3.E7.A0.81">
     示例代码
    </h3>
    <pre><code class="language-html">&lt;view id='video-box'&gt;  
 &lt;live-pusher
       id="pusher"
       mode="RTC"
       url="{<!-- -->{pusher.push_url}}" 
       autopush='true'
       bindstatechange="onPush"&gt;
 &lt;/live-pusher&gt;  
&lt;/view&gt;</code></pre>
    <h3 id=".E5.B1.9E.E6.80.A7.E8.AF.A6.E8.A7.A3">
     属性详解
    </h3>
    <ul>
     <li>
      <p>
       <strong>
        url
       </strong>
       <br/>
       用于音视频上行的推流 URL，以
       <code>
        rtmp://
       </code>
       协议前缀打头，腾讯云推流 URL 的获取方法见
       <a href="https://cloud.tencent.com/document/product/454/7915" rel="nofollow" title="快速获取 URL">
        快速获取 URL
       </a>
       文档。
      </p>
      <blockquote>
       <p>
        说明：
       </p>
       <p>
        小程序内部使用的 RTMP 协议是支持 UDP 加速的版本，在同样网络条件下，UDP 版本的 RTMP 会比开源版本的有更好的上行速度和抗抖动能力。
       </p>
      </blockquote>
     </li>
     <li>
      <p>
       <strong>
        mode
       </strong>
       <br/>
       SD、HD 和 FHD 主要用于直播类场景，例如赛事直播、在线教育、远程培训等等。SD、HD 和 FHD 分别对应三种默认的清晰度。该模式下，小程序会更加注重清晰度和观看的流畅性，不会过分强调低延迟，也不会为了延迟牺牲画质和流畅性。
      </p>
      <p>
       RTC 则主要用于双向视频通话或多人视频通话场景，例如金融开会、在线客服、车险定损、培训会议等。该模式下，小程序会更加注重降低点到点的时延，也会优先保证声音的质量，在必要的时候会对画面清晰度和画面的流畅性进行一定的缩水。
      </p>
     </li>
     <li>
      <p>
       <strong>
        orientation 和 aspect
       </strong>
       <br/>
       横屏（horizontal）模式还是竖屏（vertical）模式，默认是竖屏模式，即 home 键朝下。这时，小程序推出的画面的宽高比是3：4或者9：16这两种竖屏宽高比的画面，也就是宽 &lt; 高。如果改成横屏模式，小程序推出的画面宽高比即变为4：3或者16：9这种横屏宽高比的画面，也就是宽 &gt; 高。
      </p>
      <p>
       具体的宽高比是有 aspect 决定的 ，默认是9：16， 也可以支持3：4。 这是在 orientation 的属性值为 vertical 的情况下。如果 orientation 的属性值为 horizontal，那么3：4的效果等价于4：3，9：16的效果等价于16：9。
      </p>
     </li>
     <li>
      <p>
       <strong>
        min-bitrate 和 max-bitrate
       </strong>
       <br/>
       这里首先要科普一个概念 —— 视频码率，指视频编码器每秒钟输出的视频数据的多少。在视频分辨率确定的情况下，视频码率越高，即每秒钟输出的数据越多，相应的画质也就越好。
      </p>
      <p>
       所以 min-bitrate 和 max-bitrate 这两个属性，分别用于决定输出画面的最低清晰度和最高清晰度。这两个数值并非越大越好，因为用户的网络上行不是无限好的。但也不是越小越好，因为实际应用场景中，清晰与否是用户衡量产品体验的一个重要指标。具体的数值设定我们会在
       <strong>
        “参数设置”
       </strong>
       部分详细介绍。
      </p>
      <p>
       小程序内部会自动处理好分辨率和码率的关系，例如2Mbps的码率，小程序会选择720p的分辨率进行匹配，而300kbps的码率下，小程序则会选择较低的分辨率来提高编码效率。所以您只需要关注 min-bitrate 和 max-bitrate 这一对参数就可以掌控画质了。
      </p>
     </li>
     <li>
      <p>
       <strong>
        waiting-image 和 waiting-image-hash
       </strong>
       <br/>
       出于用户隐私的考虑，在微信切到后台以后，小程序希望停止摄像头的画面采集。但是对于另一端的用户而言，画面会变成黑屏或者冻屏（停留在最后一帧），这种体验是非常差的。为了解决这个问题，我们引入了 waiting-image 属性，您可以设置一张有 “稍候” 含义的图片（waiting-image 是该图片的 URL，waiting-image-hash 则是该图片对应的 md5 校验值）。当微信切到后台以后，小程序会使用该图片作为摄像头画面的替代，以极低的流量占用维持视频流3分钟时间。
      </p>
     </li>
     <li>
      <p>
       <strong>
        debug
       </strong>
       <br/>
       调试音视频相关功能，如果没有很好的工具会是一个噩梦，所以小程序为 live-pusher 标签支持了 debug 模式，开始 debug 模式之后，原本用于渲染视频画面的窗口上，会显示一个半透明的 log 窗口，用于展示各项音视频指标和事件，降低您调试相关功能的难度，具体使用方法我们在
       <a href="https://cloud.tencent.com/document/product/454/7946" rel="nofollow" title="FAQ">
        FAQ
       </a>
       中有详细说明。
      </p>
     </li>
    </ul>
    <h3 id=".E5.8F.82.E6.95.B0.E8.AE.BE.E7.BD.AE">
     参数设置
    </h3>
    <p>
     这么多参数，具体要怎样设置才比较合适呢？我们给出如下建议值：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        场景
       </th>
       <th>
        mode
       </th>
       <th>
        min-bitrate
       </th>
       <th>
        max-bitrate
       </th>
       <th>
        audio-quality
       </th>
       <th>
        说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        标清直播
       </td>
       <td>
        SD
       </td>
       <td>
        300kbps
       </td>
       <td>
        800kbps
       </td>
       <td>
        high
       </td>
       <td>
        窄带场景，例如户外或者网络不稳定的情况下适用
       </td>
      </tr>
      <tr>
       <td>
        高清直播
       </td>
       <td>
        HD
       </td>
       <td>
        600kbps
       </td>
       <td>
        1200kbps
       </td>
       <td>
        high
       </td>
       <td>
        目前主流的 App 所采用的参数设定，普通直播场景推荐使用这一档
       </td>
      </tr>
      <tr>
       <td>
        超清直播
       </td>
       <td>
        FHD
       </td>
       <td>
        600kbps
       </td>
       <td>
        1800kbps
       </td>
       <td>
        high
       </td>
       <td>
        对清晰度要求比较苛刻的场景，普通手机观看使用 HD 即可
       </td>
      </tr>
      <tr>
       <td>
        视频客服（用户）
       </td>
       <td>
        RTC
       </td>
       <td>
        200kbps
       </td>
       <td>
        500kbps
       </td>
       <td>
        high
       </td>
       <td>
        这是一种声音为主，画面为辅的场景，所以画质不要设置的太高
       </td>
      </tr>
      <tr>
       <td>
        车险定损（车主）
       </td>
       <td>
        RTC
       </td>
       <td>
        200kbps
       </td>
       <td>
        1200kbps
       </td>
       <td>
        high
       </td>
       <td>
        由于可能要看车况详情，画质上限会设置的高一些
       </td>
      </tr>
      <tr>
       <td>
        多人会议（主讲）
       </td>
       <td>
        RTC
       </td>
       <td>
        200kbps
       </td>
       <td>
        1000kbps
       </td>
       <td>
        high
       </td>
       <td>
        主讲人画质可以适当高一些，参与的质量可以设置的低一些
       </td>
      </tr>
      <tr>
       <td>
        多人会议（参与）
       </td>
       <td>
        RTC
       </td>
       <td>
        150kbps
       </td>
       <td>
        300kbps
       </td>
       <td>
        low
       </td>
       <td>
        作为会议参与者，不需要太高的画质和音质
       </td>
      </tr>
     </tbody>
    </table>
    <blockquote>
     <p>
      说明：
     </p>
     <p>
      如果不是对带宽特别没有信心的应用场景，audio-quality 选项请不要选择 low，其音质和延迟感都要会比 high 模式差很多。
     </p>
    </blockquote>
    <h3 id=".E5.AF.B9.E8.B1.A1.E6.93.8D.E4.BD.9C">
     对象操作
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        对象
       </th>
       <th>
        说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        wx.createLivePusherContext()
       </td>
       <td>
        通过 wx.createLivePusherContext() 可以将 &lt;live-pusher&gt; 标签和 javascript 对象关联起来，之后即可操作该对象
       </td>
      </tr>
      <tr>
       <td>
        start
        <a id="start_push">
        </a>
       </td>
       <td>
        开始推流，如果 &lt;live-pusher&gt; 的 autopush 属性设置为 false（默认值），那么就可以使用 start 来手动开始推流
       </td>
      </tr>
      <tr>
       <td>
        stop
       </td>
       <td>
        停止推流
       </td>
      </tr>
      <tr>
       <td>
        pause
       </td>
       <td>
        暂停推流
       </td>
      </tr>
      <tr>
       <td>
        resume
       </td>
       <td>
        恢复推流，请与 pause 操作配对使用
       </td>
      </tr>
      <tr>
       <td>
        switchCamera
       </td>
       <td>
        切换前后摄像头
       </td>
      </tr>
      <tr>
       <td>
        snapshot
       </td>
       <td>
        推流截图，截图大小跟组件的大小一致。截图成功图片的临时路径为
        <code>
         ret.tempImagePath
        </code>
       </td>
      </tr>
     </tbody>
    </table>
    <pre><code class="language-javascript">var pusher = wx.createLivePusherContext('pusher');
pusher.start({
 success: function(ret){
     console.log('start push success!')
 }
 fail: function(){
     console.log('start push failed!')
 }
 complete: function(){
     console.log('start push complete!')
 }
});</code></pre>
    <h3 id=".E5.86.85.E9.83.A8.E4.BA.8B.E4.BB.B6">
     内部事件
    </h3>
    <p>
     通过
     <strong>
      &lt;live-pusher&gt;
     </strong>
     标签的
     <strong>
      bindstatechange
     </strong>
     属性可以绑定一个事件处理函数，该函数可以监听推流模块的内部事件和异常通知。
    </p>
    <p>
     1. 常规事件
    </p>
    <table>
     <thead>
      <tr>
       <th>
        code
       </th>
       <th>
        事件定义
       </th>
       <th>
        含义说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        1001
       </td>
       <td>
        PUSH_EVT_CONNECT_SUCC
       </td>
       <td>
        已经成功连接到云端服务器
       </td>
      </tr>
      <tr>
       <td>
        1002
       </td>
       <td>
        PUSH_EVT_PUSH_BEGIN
       </td>
       <td>
        与服务器握手完毕，一切正常，准备开始上行推流
       </td>
      </tr>
      <tr>
       <td>
        1003
       </td>
       <td>
        PUSH_EVT_OPEN_CAMERA_SUCC
       </td>
       <td>
        已成功启动摄像头，摄像头被占用或者被限制权限的情况下无法打开
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     2. 严重错误
    </p>
    <table>
     <thead>
      <tr>
       <th>
        code
       </th>
       <th>
        事件定义
       </th>
       <th>
        含义说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        -1301
       </td>
       <td>
        PUSH_ERR_OPEN_CAMERA_FAIL
       </td>
       <td>
        打开摄像头失败
       </td>
      </tr>
      <tr>
       <td>
        -1302
       </td>
       <td>
        PUSH_ERR_OPEN_MIC_FAIL
       </td>
       <td>
        打开麦克风失败
       </td>
      </tr>
      <tr>
       <td>
        -1303
       </td>
       <td>
        PUSH_ERR_VIDEO_ENCODE_FAIL
       </td>
       <td>
        视频编码失败
       </td>
      </tr>
      <tr>
       <td>
        -1304
       </td>
       <td>
        PUSH_ERR_AUDIO_ENCODE_FAIL
       </td>
       <td>
        音频编码失败
       </td>
      </tr>
      <tr>
       <td>
        -1305
       </td>
       <td>
        PUSH_ERR_UNSUPPORTED_RESOLUTION
       </td>
       <td>
        不支持的视频分辨率
       </td>
      </tr>
      <tr>
       <td>
        -1306
       </td>
       <td>
        PUSH_ERR_UNSUPPORTED_SAMPLERATE
       </td>
       <td>
        不支持的音频采样率
       </td>
      </tr>
      <tr>
       <td>
        -1307
       </td>
       <td>
        PUSH_ERR_NET_DISCONNECT
       </td>
       <td>
        网络断连，且经三次重连无效，可以放弃，更多重试请
        <a href="https://cloud.tencent.com/document/product/454/12518#start_push" rel="nofollow" title="自行重启推流">
         自行重启推流
        </a>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     3. 警告事件
    </p>
    <p>
     内部警告并非不可恢复的错误，小程序内部的音视频 SDK 会启动相应的恢复措施，警告的目的主要用于提示开发者或者最终用户，例如：
    </p>
    <ul>
     <li>
      <p>
       <strong>
        PUSH_WARNING_NET_BUSY
       </strong>
       <br/>
       上行网速不给力，建议提示用户改善当前的网络环境，例如让用户离家里的路由器近一点，或者切到 Wi-Fi 环境下再使用。
      </p>
     </li>
     <li>
      <p>
       <strong>
        PUSH_WARNING_SERVER_DISCONNECT
       </strong>
       <br/>
       请求被后台拒绝了，出现这个问题一般是由于 URL 里的 txSecret 计算错了，或者是 URL 被其他人占用了（跟播放不同，一个推流 URL 同时只能有一个用户使用）。
      </p>
     </li>
     <li>
      <p>
       <strong>
        PUSH_WARNING_HANDUP_STOP
       </strong>
       <br/>
       当用户单击小程序右上角的圆圈或者返回按钮时，微信会将小程序挂起，此时 &lt;live-pusher&gt; 会抛出5000这个事件。
      </p>
     </li>
    </ul>
    <table>
     <thead>
      <tr>
       <th>
        code
       </th>
       <th>
        事件定义
       </th>
       <th>
        含义说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        1101
       </td>
       <td>
        PUSH_WARNING_NET_BUSY
       </td>
       <td>
        上行网速不够用，建议提示用户改善当前的网络环境
       </td>
      </tr>
      <tr>
       <td>
        1102
       </td>
       <td>
        PUSH_WARNING_RECONNECT
       </td>
       <td>
        网络断连，已启动重连流程（重试失败超过三次会放弃）
       </td>
      </tr>
      <tr>
       <td>
        1103
       </td>
       <td>
        PUSH_WARNING_HW_ACCELERATION_FAIL
       </td>
       <td>
        硬编码启动失败，自动切换到软编码
       </td>
      </tr>
      <tr>
       <td>
        1107
       </td>
       <td>
        PUSH_WARNING_SWITCH_SWENC
       </td>
       <td>
        由于机器性能问题，自动切换到硬件编码
       </td>
      </tr>
      <tr>
       <td>
        3001
       </td>
       <td>
        PUSH_WARNING_DNS_FAIL
       </td>
       <td>
        DNS 解析失败，启动重试流程
       </td>
      </tr>
      <tr>
       <td>
        3002
       </td>
       <td>
        PUSH_WARNING_SEVER_CONN_FAIL
       </td>
       <td>
        服务器连接失败，启动重试流程
       </td>
      </tr>
      <tr>
       <td>
        3003
       </td>
       <td>
        PUSH_WARNING_SHAKE_FAIL
       </td>
       <td>
        服务器握手失败，启动重试流程
       </td>
      </tr>
      <tr>
       <td>
        3004
       </td>
       <td>
        PUSH_WARNING_SERVER_DISCONNECT
       </td>
       <td>
        RTMP 服务器主动断开，请检查推流地址的合法性或防盗链有效期
       </td>
      </tr>
      <tr>
       <td>
        3005
       </td>
       <td>
        PUSH_WARNING_READ_WRITE_FAIL
       </td>
       <td>
        RTMP 读/写失败，将会断开连接
       </td>
      </tr>
      <tr>
       <td>
        5000
       </td>
       <td>
        PUSH_WARNING_HANDUP_STOP
       </td>
       <td>
        小程序被用户挂起，停止推流
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     4. 示例代码
    </p>
    <pre><code class="language-javascript">Page({
   onPush: function(ret) {
       if(ret.detail.code == 1002) {
         console.log('推流成功了',ret);
       }
   },

 /**
  * 生命周期函数--监听页面加载
  */
 onLoad: function (options) {
 //...
 }
})</code></pre>
    <h4>
     更多资料：
    </h4>
    <p>
     <a href="https://cloud.tencent.com/document/product/454/12518" rel="nofollow" title="直播 SDK &lt;live-pusher&gt; 标签-API 文档-文档中心-腾讯云">
      直播 SDK &lt;live-pusher&gt; 标签-API 文档-文档中心-腾讯云
     </a>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34343732373038302f:61727469636c652f64657461696c732f313236353931303435" class_="artid" style="display:none">
 </p>
</div>


