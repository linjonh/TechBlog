---
layout: post
title: "django-实现简单的搜索功能"
date: 2024-09-24 14:42:46 +0800
description: "文章浏览阅读1.9w次，点赞24次，django 实现简单的搜索功能1 年，1 月前  4849 字"
keywords: "django使用input框检索数据库里的数据"
categories: ['未分类']
tags: ['无标签']
artid: "80783711"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=80783711
    alt: "django-实现简单的搜索功能"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     django 实现简单的搜索功能
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2 class="top-gap-0" style="margin-bottom:0px;font-size:32px;color:rgb(51,51,51);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Fira Sans', 'Droid Sans', 'Hiragino Sans GB', 'Microsoft Yahei', '微软雅黑', Arial, Helvetica, STHeiti, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';background-color:rgb(255,255,255);margin-top:0px;">
     django 实现简单的搜索功能
    </h2>
    <ul class="list-inline dot-divider post-meta" style="margin-top:7px;margin-bottom:0px;list-style:none;color:rgb(51,51,51);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Fira Sans', 'Droid Sans', 'Hiragino Sans GB', 'Microsoft Yahei', '微软雅黑', Arial, Helvetica, STHeiti, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';background-color:rgb(255,255,255);">
     <li class="list-inline-item text-small text-muted" style="color:rgb(119,119,119);font-size:13.6px;">
      1 年，1 月前
     </li>
     <li class="list-inline-item text-small text-muted" style="color:rgb(119,119,119);font-size:13.6px;">
      4849 字
     </li>
     <li class="list-inline-item text-small text-muted" style="color:rgb(119,119,119);font-size:13.6px;">
      13259 阅读
     </li>
     <li class="list-inline-item text-small text-muted" style="color:rgb(119,119,119);font-size:13.6px;">
      7 评论
     </li>
    </ul>
    <div class="top-gap-big post-body" style="color:rgb(51,51,51);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Fira Sans', 'Droid Sans', 'Hiragino Sans GB', 'Microsoft Yahei', '微软雅黑', Arial, Helvetica, STHeiti, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';background-color:rgb(255,255,255);margin-top:30px;">
     <p style="margin-top:15px;margin-bottom:0px;">
      搜索是一个复杂的功能，但对于一些简单的搜索任务，我们可以使用 django model 层提供的一些内置方法来完成。本文将结合 django 模型管理器的
      <code style="background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13.6px;padding:.2em .3em;">
       filter
      </code>
      方法和
      <code style="background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13.6px;padding:.2em .3em;">
       icontains
      </code>
      查询表达式来实现一个简单的搜索功能。
     </p>
     <p style="margin-top:15px;margin-bottom:0px;">
      以博客为例，博客文章通常包含标题和正文两个部分。当用户输入某个关键词进行搜索后，我们希望为用户显示标题中含有被搜索关键词的全部文章。整个搜索的过程如下：
     </p>
     <ol style="margin-top:15px;margin-bottom:0px;padding-left:30px;">
      <li>
       用户在搜素框中输入搜索关键词，假设为 “django”，然后用户点击了搜索按钮提交其输入的结果到服务器
      </li>
      <li>
       服务器接收到用户输入的搜索关键词 “django” 后去数据库查找文章标题中含有该关键词的全部文章
      </li>
      <li>
       服务器将查询结果返回给用户
      </li>
     </ol>
     <p style="margin-top:15px;margin-bottom:0px;">
      整个过程就是这样，下面来看看 django 如何用实现这些过程。
     </p>
     <p style="margin-top:15px;margin-bottom:0px;">
      假设我们的 django 博客应用有如下的文章模型：
     </p>
     <div class="codehilite">
      <pre style="margin-top:15px;margin-bottom:0px;background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13px;line-height:1.2;padding:15px;"><span class="n">blog</span><span class="o" style="color:rgb(102,102,102);">/</span><span class="n">models</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">py</span>

<span class="k" style="color:rgb(0,112,32);font-weight:bold;">class</span> <span class="nc" style="color:rgb(14,132,181);font-weight:bold;">Post</span><span class="p">(</span><span class="n">models</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1" style="color:rgb(96,160,176);font-style:italic;"># 标题</span>
    <span class="n">title</span> <span class="o" style="color:rgb(102,102,102);">=</span> <span class="n">models</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="mi" style="color:rgb(64,160,112);">70</span><span class="p">)</span>
    <span class="c1" style="color:rgb(96,160,176);font-style:italic;"># 正文</span>
    <span class="n">body</span> <span class="o" style="color:rgb(102,102,102);">=</span> <span class="n">models</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">TextField</span><span class="p">()</span>

    <span class="c1" style="color:rgb(96,160,176);font-style:italic;"># 其他属性</span>

    <span class="k" style="color:rgb(0,112,32);font-weight:bold;">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp" style="color:rgb(0,112,32);">self</span><span class="p">):</span>
        <span class="k" style="color:rgb(0,112,32);font-weight:bold;">return</span> <span class="bp" style="color:rgb(0,112,32);">self</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">title</span>
</pre>
     </div>
     <p style="margin-top:15px;margin-bottom:0px;">
      先看到第 1 步，用户在搜索框输入搜索关键词，因此我们要在博客上为用户提供一个搜索表单，html 表单代码大概像这样：
     </p>
     <div class="codehilite">
      <pre style="margin-top:15px;margin-bottom:0px;background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13px;line-height:1.2;padding:15px;"><span class="p">&lt;</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">form</span> <span class="na" style="color:rgb(64,112,160);">method</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"get"</span> <span class="na" style="color:rgb(64,112,160);">action</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"/search/"</span><span class="p">&gt;</span>
  {% csrf_token %}
  <span class="p">&lt;</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">input</span> <span class="na" style="color:rgb(64,112,160);">type</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"search"</span> <span class="na" style="color:rgb(64,112,160);">placeholder</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"搜索"</span> <span class="na" style="color:rgb(64,112,160);">required</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">button</span> <span class="na" style="color:rgb(64,112,160);">type</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"submit"</span><span class="p">&gt;</span>搜索<span class="p">&lt;/</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">form</span><span class="p">&gt;</span>
</pre>
     </div>
     <p style="margin-top:15px;margin-bottom:0px;">
      特别注意在 form 标签下有一个
      <code style="background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13.6px;padding:.2em .3em;">
       {% csrf_token %}
      </code>
      ，这是 django 用来防御跨站请求伪造（CSRF）攻击的机制。如果不知道什么是 CSRF 的话也没有关系，只要记住在使用 django 时，前端的表单代码里一定要加上
      <code style="background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13.6px;padding:.2em .3em;">
       {% csrf_token %}
      </code>
      。
     </p>
     <p style="margin-top:15px;margin-bottom:0px;">
      用户输入了搜索关键词并点击了搜索按钮后，数据就被发送给了 django 后台服务器。表单的
      <code style="background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13.6px;padding:.2em .3em;">
       action
      </code>
      属性的值为
      <code style="background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13.6px;padding:.2em .3em;">
       /search/
      </code>
      ，表明用户提交的结果将被发送给
      <code style="background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13.6px;padding:.2em .3em;">
       /search/
      </code>
      这个 URL。我们为这个 URL 绑定一个 django 视图函数，在这个视图函数里完成前面第 2 步提到的过程。假设我们把视图函数的代码写在 blog/views.py 里：
     </p>
     <div class="codehilite">
      <pre style="margin-top:15px;margin-bottom:0px;background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13px;line-height:1.2;padding:15px;"><span class="n">blog</span><span class="o" style="color:rgb(102,102,102);">/</span><span class="n">views</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">py</span>

<span class="k" style="color:rgb(0,112,32);font-weight:bold;">def</span> <span class="nf" style="color:rgb(6,40,126);">search</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">q</span> <span class="o" style="color:rgb(102,102,102);">=</span> <span class="n">request</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">GET</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">get</span><span class="p">(</span><span class="s1" style="color:rgb(64,112,160);">'q'</span><span class="p">)</span>
    <span class="n">error_msg</span> <span class="o" style="color:rgb(102,102,102);">=</span> <span class="s1" style="color:rgb(64,112,160);">''</span>

    <span class="k" style="color:rgb(0,112,32);font-weight:bold;">if</span> <span class="ow" style="color:rgb(0,112,32);font-weight:bold;">not</span> <span class="n">q</span><span class="p">:</span>
        <span class="n">error_msg</span> <span class="o" style="color:rgb(102,102,102);">=</span> <span class="s1" style="color:rgb(64,112,160);">'请输入关键词'</span>
        <span class="k" style="color:rgb(0,112,32);font-weight:bold;">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1" style="color:rgb(64,112,160);">'blog/errors.html'</span><span class="p">,</span> <span class="p">{<!-- --></span><span class="s1" style="color:rgb(64,112,160);">'error_msg'</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">})</span>

    <span class="n">post_list</span> <span class="o" style="color:rgb(102,102,102);">=</span> <span class="n">Post</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">objects</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">filter</span><span class="p">(</span><span class="n">title__icontains</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="n">q</span><span class="p">)</span>
    <span class="k" style="color:rgb(0,112,32);font-weight:bold;">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1" style="color:rgb(64,112,160);">'blog/results.html'</span><span class="p">,</span> <span class="p">{<!-- --></span><span class="s1" style="color:rgb(64,112,160);">'error_msg'</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">,</span>
                                               <span class="s1" style="color:rgb(64,112,160);">'post_list'</span><span class="p">:</span> <span class="n">post_list</span><span class="p">})</span>
</pre>
     </div>
     <p style="margin-top:15px;margin-bottom:0px;">
      首先我们使用
      <code style="background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13.6px;padding:.2em .3em;">
       request.GET.get('q')
      </code>
      获取到用户提交的搜索关键词。用户通过表单提交的数据 django 为我们保存在
      <code style="background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13.6px;padding:.2em .3em;">
       request.GET
      </code>
      里，这是一个类似于 Python 字典的对象，所以我们使用
      <code style="background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13.6px;padding:.2em .3em;">
       get
      </code>
      方法从字典里取出键 q 对应的值，即用户的搜索关键词。这里字典的键之所以叫 q 是因为我们的表单中搜索框 input 的 name 属性的值是 q，如果修改了 name 属性的值，那么这个键的名称也要相应修改。
     </p>
     <p style="margin-top:15px;margin-bottom:0px;">
      接下来我们做了一个小小的校验，如果用户没有输入搜索关键词而提交了表单，我们就无需执行查询，而是渲染一个错误页面提示用户请输入关键词。
     </p>
     <p style="margin-top:15px;margin-bottom:0px;">
      如果用户输入了搜索关键词，我们就通过
      <code style="background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13.6px;padding:.2em .3em;">
       filter
      </code>
      方法从数据库里过滤出符合条件的所有文章。这里的过滤条件是
      <code style="background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13.6px;padding:.2em .3em;">
       title__icontains=q
      </code>
      ，即 title 中包含（contains）关键字 q，前缀 i 表示不区分大小写。这里
      <code style="background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13.6px;padding:.2em .3em;">
       icontains
      </code>
      是查询表达式（Field lookups），其用法是在模型需要筛选的属性后面跟上两个下划线。django 内置了很多查询表达式，建议过一遍 django 官方留个印象，了解每个表达式的作用，以后碰到相关的需求就可以快速定位到文档查询其用途：
      <a href="https://docs.djangoproject.com/en/1.10/ref/models/querysets/#field-lookups" rel="nofollow" style="color:rgb(38,128,217);">
       Field lookups
      </a>
     </p>
     <p style="margin-top:15px;margin-bottom:0px;">
      接下来就是渲染搜索结果页面，显示符合搜索条件的文章列表，下面是一个模板的简单示例：
     </p>
     <div class="codehilite">
      <pre style="margin-top:15px;margin-bottom:0px;background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13px;line-height:1.2;padding:15px;">results.html

{% if error_msg %}
    <span class="p">&lt;</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">p</span><span class="p">&gt;</span>{<!-- -->{ error_msg }}<span class="p">&lt;/</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">p</span><span class="p">&gt;</span>
{% endif %}

{% for post in post_list %}
  <span class="p">&lt;</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">div</span><span class="p">&gt;</span>
    在这里显示文章的相应信息
  <span class="p">&lt;/</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">div</span><span class="p">&gt;</span>
{% empty %}
  <span class="p">&lt;</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">div</span> <span class="na" style="color:rgb(64,112,160);">class</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"no-post"</span><span class="p">&gt;</span>
    没有搜索到符合条件的文章
  <span class="p">&lt;/</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">div</span><span class="p">&gt;</span>
{% endfor %}
</pre>
     </div>
     <p style="margin-top:15px;margin-bottom:0px;">
      有了视图函数后记得把视图函数映射到相应了 URL，前面我们表单数据提交的 URL 为
      <code style="background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13.6px;padding:.2em .3em;">
       /search/
      </code>
      ，因此将视图函数
      <code style="background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13.6px;padding:.2em .3em;">
       search
      </code>
      绑定到该 URL 上。
     </p>
     <div class="codehilite">
      <pre style="margin-top:15px;margin-bottom:0px;background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13px;line-height:1.2;padding:15px;"><span class="n">blog</span><span class="o" style="color:rgb(102,102,102);">/</span><span class="n">urls</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">py</span>

<span class="n">urlpatterns</span> <span class="o" style="color:rgb(102,102,102);">=</span> <span class="p">[</span>
    <span class="c1" style="color:rgb(96,160,176);font-style:italic;"># 其他 url 配置</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1" style="color:rgb(64,112,160);">'^search/$'</span><span class="p">,</span> <span class="n">views</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">search</span><span class="p">,</span> <span class="n">name</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s1" style="color:rgb(64,112,160);">'search'</span><span class="p">),</span>
<span class="p">]</span>
</pre>
     </div>
     <p style="margin-top:15px;margin-bottom:0px;">
      大功告成！
     </p>
     <hr style="margin-top:15px;margin-bottom:0px;border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);"/>
     <p style="margin-top:15px;margin-bottom:0px;">
      以上示例写的比较通用，并不是针对某个具体项目。但如果你稍微了解一点 django 的话，肯定能够看懂文章的内容，并且稍作修改就能应用于自己的项目。如果你对 django 还不是很了解，这里有一篇从零开始学习 django 的入门指南，能够帮助你找到高质量的学习教程，以最快的速度入门 django 开发：
      <a href="http://zmrenwu.com/post/15/" rel="nofollow" style="color:rgb(38,128,217);">
       django 入门学习规划与资料推荐
      </a>
      。
     </p>
     <p style="margin-top:15px;margin-bottom:0px;">
      也许你前面已经学习了
      <a href="http://zmrenwu.com/category/django-blog-tutorial/" rel="nofollow" style="color:rgb(38,128,217);">
       django 博客开发入门教程
      </a>
      ，针对这个教程里的具体项目，我们修改上述代码的一些细节，就可以在项目里顺利运行。
     </p>
     <p style="margin-top:15px;margin-bottom:0px;">
      首先是修改表单，打开 templates/base.html，在 header 标签里找到搜索表单部分的代码并修改，即添加
      <code style="background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13.6px;padding:.2em .3em;">
       {% csrf_token %}
      </code>
      模板标签、修改搜索框的 name 属性和表单的 action 属性：
     </p>
     <div class="codehilite">
      <pre style="margin-top:15px;margin-bottom:0px;background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13px;line-height:1.2;padding:15px;">templates/base.html

<span class="p">&lt;</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">header</span> <span class="na" style="color:rgb(64,112,160);">id</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"site-header"</span><span class="p">&gt;</span>
  ...
  <span class="p">&lt;</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">div</span> <span class="na" style="color:rgb(64,112,160);">id</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"header-search-box"</span><span class="p">&gt;</span>
    ...
    <span class="p">&lt;</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">form</span> <span class="na" style="color:rgb(64,112,160);">role</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"search"</span> <span class="na" style="color:rgb(64,112,160);">method</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"get"</span> <span class="na" style="color:rgb(64,112,160);">id</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"searchform"</span> <span class="na" style="color:rgb(64,112,160);">action</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"{% url 'blog:search' %}"</span><span class="p">&gt;</span>
      {% csrf_token %}
      <span class="p">&lt;</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">input</span> <span class="na" style="color:rgb(64,112,160);">type</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"search"</span> <span class="na" style="color:rgb(64,112,160);">name</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"q"</span> <span class="na" style="color:rgb(64,112,160);">placeholder</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"Search"</span> <span class="na" style="color:rgb(64,112,160);">required</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">button</span> <span class="na" style="color:rgb(64,112,160);">type</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"submit"</span><span class="p">&gt;&lt;</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">span</span> <span class="na" style="color:rgb(64,112,160);">class</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"ion-ios-search-strong"</span><span class="p">&gt;&lt;/</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">span</span><span class="p">&gt;&lt;/</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">form</span><span class="p">&gt;</span>
    ...
  <span class="p">&lt;/</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">header</span><span class="p">&gt;</span>
</pre>
     </div>
     <p style="margin-top:15px;margin-bottom:0px;">
      然后是编写视图函数：
     </p>
     <div class="codehilite">
      <pre style="margin-top:15px;margin-bottom:0px;background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13px;line-height:1.2;padding:15px;"><span class="n">blog</span><span class="o" style="color:rgb(102,102,102);">/</span><span class="n">views</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">py</span>

<span class="k" style="color:rgb(0,112,32);font-weight:bold;">def</span> <span class="nf" style="color:rgb(6,40,126);">search</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">q</span> <span class="o" style="color:rgb(102,102,102);">=</span> <span class="n">request</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">GET</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">get</span><span class="p">(</span><span class="s1" style="color:rgb(64,112,160);">'q'</span><span class="p">)</span>
    <span class="n">error_msg</span> <span class="o" style="color:rgb(102,102,102);">=</span> <span class="s1" style="color:rgb(64,112,160);">''</span>

    <span class="k" style="color:rgb(0,112,32);font-weight:bold;">if</span> <span class="ow" style="color:rgb(0,112,32);font-weight:bold;">not</span> <span class="n">q</span><span class="p">:</span>
        <span class="n">error_msg</span> <span class="o" style="color:rgb(102,102,102);">=</span> <span class="s1" style="color:rgb(64,112,160);">'请输入关键词'</span>
        <span class="k" style="color:rgb(0,112,32);font-weight:bold;">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1" style="color:rgb(64,112,160);">'blog/index.html'</span><span class="p">,</span> <span class="p">{<!-- --></span><span class="s1" style="color:rgb(64,112,160);">'error_msg'</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">})</span>

    <span class="n">post_list</span> <span class="o" style="color:rgb(102,102,102);">=</span> <span class="n">Post</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">objects</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">filter</span><span class="p">(</span><span class="n">title__icontains</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="n">q</span><span class="p">)</span>
    <span class="k" style="color:rgb(0,112,32);font-weight:bold;">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1" style="color:rgb(64,112,160);">'blog/index.html'</span><span class="p">,</span> <span class="p">{<!-- --></span><span class="s1" style="color:rgb(64,112,160);">'error_msg'</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">,</span>
                                               <span class="s1" style="color:rgb(64,112,160);">'post_list'</span><span class="p">:</span> <span class="n">post_list</span><span class="p">})</span>
</pre>
     </div>
     <p style="margin-top:15px;margin-bottom:0px;">
      这里我们直接渲染了 index.html 页面，因为这个页面就是用来显示文章列表的。我们对 index.html 稍作一点修改，让它能够显示
      <code style="background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13.6px;padding:.2em .3em;">
       error_msg
      </code>
      。
     </p>
     <div class="codehilite">
      <pre style="margin-top:15px;margin-bottom:0px;background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13px;line-height:1.2;padding:15px;">templates/blog/index.html

{% extends 'base.html' %}
{% block main %}
  {% if error_msg %}
    <span class="p">&lt;</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">p</span><span class="p">&gt;</span>{<!-- -->{ error_msg }}<span class="p">&lt;/</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">p</span><span class="p">&gt;</span>
  {% endif %}

  {% for post in post_list %}
    ...
  {% empty %}
    <span class="p">&lt;</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">div</span> <span class="na" style="color:rgb(64,112,160);">class</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s" style="color:rgb(64,112,160);">"no-post"</span><span class="p">&gt;</span>暂时还没有发布的文章！<span class="p">&lt;/</span><span class="nt" style="color:rgb(6,40,115);font-weight:bold;">div</span><span class="p">&gt;</span>
  {% endfor %}
{% endblock main %}
</pre>
     </div>
     <p style="margin-top:15px;margin-bottom:0px;">
      最后就是配置 URL：
     </p>
     <div class="codehilite">
      <pre style="margin-top:15px;margin-bottom:0px;background-color:rgb(242,242,242);font-family:Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:13px;line-height:1.2;padding:15px;"><span class="n">blog</span><span class="o" style="color:rgb(102,102,102);">/</span><span class="n">urls</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">py</span>

<span class="n">urlpatterns</span> <span class="o" style="color:rgb(102,102,102);">=</span> <span class="p">[</span>
    <span class="c1" style="color:rgb(96,160,176);font-style:italic;"># 其他 url 配置</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1" style="color:rgb(64,112,160);">'^search/$'</span><span class="p">,</span> <span class="n">views</span><span class="o" style="color:rgb(102,102,102);">.</span><span class="n">search</span><span class="p">,</span> <span class="n">name</span><span class="o" style="color:rgb(102,102,102);">=</span><span class="s1" style="color:rgb(64,112,160);">'search'</span><span class="p">),</span>
<span class="p">]</span>
</pre>
     </div>
     <hr style="margin-top:15px;margin-bottom:0px;border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);"/>
     <p style="margin-top:15px;margin-bottom:0px;">
      当然这样的搜索功能是非常简略的，难以满足一些复杂的搜索需求。编写一个搜索引擎是一个大工程，好在 django-haystack 这款第三方 app 为我们完成了全部工作。使用它我们可以实现更加复杂的搜索功能，比如全文检索、按搜索相关度排序、关键字高亮等等类似于百度搜索的功能，功能十分强大。当然其使用也会复杂一些，以后有机会我再写文章向大家介绍 django-haystack 的使用方法。
     </p>
    </div>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f67:2e6373646e2e6e65742f77656978696e5f3432353036373437:2f61727469636c652f64657461696c732f3830373833373131" class_="artid" style="display:none">
 </p>
</div>


