---
layout: post
title: "jspdf前端html生成pdf的两种办法-以及-引入中文字体"
date: 2023-04-24 15:15:48 +0800
description: "文章介绍了两种将HTML内容导出为PDF的方法。一种是通过html2canvas将HTML转为图片再"
keywords: "jspdf"
categories: ["未分类"]
tags: ["前端", "Javascript", "Html"]
artid: "130341673"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=130341673
  alt: "jspdf前端html生成pdf的两种办法-以及-引入中文字体"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【jspdf】前端html生成pdf的两种办法 以及 引入中文字体
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="pdf_0">
     </a>
     导出pdf有下面两种方法
    </h3>
    <p>
     1、使用canvas把html生成图片，然后使用jspdf生成pdf。优点：生成的pdf 样式还原度极高，缺点：图片形式的pdf无法编辑
     <br/>
     2、直接使用jspdf的html方法直接把html生成pdf。优点：可编辑，缺点：只是把文本内容搂出来生成pdf，也就是说样式基本无，而且jspdf不支持中文字体的，如果有中文字体需要一 一引入字体
    </p>
    <h3>
     <a id="pdf_4">
     </a>
     一、从图片导出pdf
    </h3>
    <h3>
     <a id="1html2canvasjspdf_6">
     </a>
     1、安装插件html2canvas、jspdf
    </h3>
    <pre><code class="prism language-javascript"> yarn add jspdf
yarn add html2canvas
</code></pre>
    <h3>
     <a id="2_13">
     </a>
     2、使用
    </h3>
    <pre><code class="prism language-html">//html使用的是Ant Design Vue框架,pdf_content为生成canvas区域
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pdf_content<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-table</span> <span class="token attr-name">:loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>loading<span class="token punctuation">"</span></span> <span class="token attr-name">:dataSource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">:columns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>columns<span class="token punctuation">"</span></span> <span class="token attr-name">:pagination</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ipagination<span class="token punctuation">"</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleTableChange<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <pre><code class="prism language-javascript"><span class="token comment">// js</span>
<span class="token keyword">import</span> html2canvas <span class="token keyword">from</span> <span class="token string">'html2canvas'</span>
<span class="token keyword">import</span> JsPDF <span class="token keyword">from</span> <span class="token string">'jspdf'</span>

</code></pre>
<pre><code class="prism language-javascript"><span class="token function">getpdf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 未分页</span>
<span class="token keyword">const</span> pdf_content <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>pdf_content
<span class="token function">html2canvas</span><span class="token punctuation">(</span>pdf_content<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">'#fff'</span><span class="token punctuation">,</span> <span class="token literal-property property">useCORS</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 获取图片</span>
<span class="token keyword">const</span> dataURL <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/png'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dataURL<span class="token punctuation">)</span> <span class="token comment">// 生成的图片</span>
<span class="token keyword">var</span> contentWidth <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width
<span class="token keyword">var</span> contentHeight <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height
<span class="token comment">// 一页 pdf 显示 html 页面生成的 canvas 高度;</span>
<span class="token keyword">var</span> pageHeight <span class="token operator">=</span> <span class="token punctuation">(</span>contentWidth <span class="token operator">/</span> <span class="token number">592.28</span><span class="token punctuation">)</span> <span class="token operator">_</span> <span class="token number">841.89</span>
<span class="token comment">// 未生成 pdf 的 html 页面高度</span>
<span class="token keyword">var</span> leftHeight <span class="token operator">=</span> contentHeight
<span class="token comment">// 页面偏移</span>
<span class="token keyword">var</span> position <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">// a4 纸的尺寸[595.28,841.89]，html 页面生成的 canvas 在 pdf 中图片的宽高</span>
<span class="token keyword">var</span> imgWidth <span class="token operator">=</span> <span class="token number">595.28</span>
<span class="token keyword">var</span> imgHeight <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">595.28</span> <span class="token operator">/</span> contentWidth<span class="token punctuation">)</span> <span class="token operator">_</span> contentHeight
<span class="token keyword">var</span> pageData <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/jpeg'</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> pdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsPDF</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'pt'</span><span class="token punctuation">,</span> <span class="token string">'a4'</span><span class="token punctuation">)</span>
<span class="token comment">// 有两个高度需要区分，一个是 html 页面的实际高度，和生成 pdf 的页面高度(841.89)</span>
<span class="token comment">// 当内容未超过 pdf 一页显示的范围，无需分页</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>leftHeight <span class="token operator">&lt;</span> pageHeight<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">// 在 pdf.addImage(pageData, 'JPEG', 左，上，宽度，高度)设置在 pdf 中显示；</span>
pdf<span class="token punctuation">.</span><span class="token function">addImage</span><span class="token punctuation">(</span>pageData<span class="token punctuation">,</span> <span class="token string">'JPEG'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> imgWidth<span class="token punctuation">,</span> imgHeight<span class="token punctuation">)</span>
<span class="token comment">// pdf.addImage(pageData, 'JPEG', 20, 40, imgWidth, imgHeight);</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">// 分页</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>leftHeight <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
pdf<span class="token punctuation">.</span><span class="token function">addImage</span><span class="token punctuation">(</span>pageData<span class="token punctuation">,</span> <span class="token string">'JPEG'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> position<span class="token punctuation">,</span> imgWidth<span class="token punctuation">,</span> imgHeight<span class="token punctuation">)</span>
leftHeight <span class="token operator">-=</span> pageHeight
position <span class="token operator">-=</span> <span class="token number">841.89</span>
<span class="token comment">// 避免添加空白页</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>leftHeight <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
pdf<span class="token punctuation">.</span><span class="token function">addPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
pdf<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">'订单列表'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>
三、可能出现的问题
<br/>
Ant Design Vue 框架的分页组件中的一个样式影响了 html2canvas，生成图片会缺失数字部分，如下图
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/24a2ef1b2344caebdf26c1540678e936.png">
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/453780ddd7e2451eb63d62391775d293.png">
<br/>
a 标签中的 display: block;样式会导致导出图片中 a 标签内的内容没有显示成功，需要手动修改样式
</img>
</img>
</p>
<pre><code class="prism language-css"><span class="token selector">/deep/ .ant-pagination-item a</span> <span class="token punctuation">{<!-- --></span>
<span class="token property">display</span><span class="token punctuation">:</span> unset<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3>
<a id="htmlhtmlpdf_82">
</a>
二、html 方法直接把 html 生成 pdf
</h3>
<h3>
<a id="1_84">
</a>
1、引入字体
</h3>
<p>
<a href="https://github.com/parallax/jsPDF">
ttf 转 js 工具
</a>
点击下载项目到本地，打开下面的文件
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2003f5072476b26d261628dd73037908.png">
<br/>
打开 fontconverter，页面如下图
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9d8356d92a7cf2b25d0ea18671febb65.png"/>
</img>
</p>
<p>
选择需要的字体的 ttf 文件，点击选择文件进行上传转换（一些字体可以在电脑本地找到地址：C:\Windows\Fonts）
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ccb7db04b82822ab1036b557f36f552d.png">
<br/>
上传后点击 Create 下载一个 js 文件，把这个文件放在项目中
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/63896e119b3f8acb8e3781fcbb4f5c4b.png">
<br/>
在页面引入字体：
<code>
require("@/utils/simhei-normal");
</code>
字体转为 js 的时候都处理好了，只需要引入就可以直接使用了
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b14c7d6baa36a90f8d85a345cedcee13.png">
<br/>
在生成 pdf 之前使用
<code>
pdf.setFont("simhei");
</code>
设置字体即可
</img>
</img>
</img>
</p>
<h3>
<a id="2pdf_99">
</a>
2、生成 pdf
</h3>
<pre><code class="prism language-javascript"> <span class="token keyword">var</span> pdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">jsPDF</span><span class="token punctuation">(</span><span class="token string">"x"</span><span class="token punctuation">,</span> <span class="token string">"pt"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">595</span><span class="token punctuation">,</span> <span class="token number">750</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pdf<span class="token punctuation">.</span><span class="token function">setFont</span><span class="token punctuation">(</span><span class="token string">"simhei"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用字体</span>
<span class="token keyword">const</span> source <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token literal-property property">pagesplit</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//设置是否自动分页</span>
<span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token string">"#FFFFFF"</span><span class="token punctuation">,</span> <span class="token comment">//如果导出的 pdf 为黑色背景，需要将导出的 html 模块内容背景 设置成白色。</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> pdf<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
<span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">pdf1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
pdf1<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">"test.pdf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pdf<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">"test.pdf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>

   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f32393138343638352f:61727469636c652f64657461696c732f313330333431363733" class_="artid" style="display:none">
 </p>
</div>
