---
layout: post
title: "前端检测当前的网络状况的方法"
date: 2024-12-05 10:34:43 +0800
description: "前端可以通过一些方法来检测当前的网络状况：1. 使用 navigator.onLine 属性；2. "
keywords: "navigator.online"
categories: ["未分类"]
tags: ["网络", "前端", "Php", "Javascript"]
artid: "141069296"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=141069296
  alt: "前端检测当前的网络状况的方法"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     前端检测当前的网络状况的方法
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     前端可以通过一些方法来检测当前的网络状况，并在网络不佳时向用户发出提醒。可以使用以下几种方法来实现这个功能：
    </p>
    <h4>
     <a id="1__navigatoronLine__2">
     </a>
     1.
     <strong>
      使用
      <code>
       navigator.onLine
      </code>
      属性
     </strong>
    </h4>
    <ul>
     <li>
      <code>
       navigator.onLine
      </code>
      是一个布尔值，表示浏览器是否连接到网络。可以通过监听
      <code>
       online
      </code>
      和
      <code>
       offline
      </code>
      事件来检测网络状态的变化。
     </li>
    </ul>
    <pre><code class="prism language-javascript"><span class="token comment">// 检测网络状态变化</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'online'</span><span class="token punctuation">,</span> updateNetworkStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'offline'</span><span class="token punctuation">,</span> updateNetworkStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">updateNetworkStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>onLine<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"网络已连接"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 网络恢复，可以隐藏提醒</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"网络断开"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 显示网络断开提醒</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"网络断开，请检查您的连接！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4>
<a id="2__21">
</a> 2.
<strong>
定期发送请求
</strong>
</h4>
<ul>
<li>
可以定期发送轻量级的请求（如
<code>
ping
</code>
请求）到服务器来检测网络状况。如果请求失败，意味着网络可能出现了问题，此时可以提醒用户刷新页面。
</li>
</ul>
<pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">checkConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/ping'</span><span class="token punctuation">)</span> <span class="token comment">// 假设有一个轻量级的 ping 接口</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Network response was not ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'网络正常'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'网络问题:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"检测到网络问题，请刷新页面！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">setInterval</span><span class="token punctuation">(</span>checkConnection<span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 每 10 秒检测一次网络</span>
</code></pre>
<h4>
<a id="3__Service_Worker_41">
</a> 3.
<strong>
使用 Service Worker
</strong>
</h4>
<ul>
<li>
如果项目中使用了 Service Worker，可以在其中监听网络请求的失败事件，并在一定时间内多次失败后提示用户网络有问题。
</li>
</ul>
<h4>
<a id="4__Network_Information_API_44">
</a> 4.
<strong>
使用
<code>
Network Information API
</code>
</strong>
</h4>
<ul>
<li>
如果需要更多关于网络状态的信息，比如带宽、连接类型等，可以使用
<code>
Network Information API
</code>
（目前支持度有限）。
</li>
</ul>
<pre><code class="prism language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'connection'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">const</span> connection <span class="token operator">=</span> navigator<span class="token punctuation">.</span>connection <span class="token operator">||</span> navigator<span class="token punctuation">.</span>mozConnection <span class="token operator">||</span> navigator<span class="token punctuation">.</span>webkitConnection<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">updateConnectionStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">网络类型: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>connection<span class="token punctuation">.</span>effectiveType<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>connection<span class="token punctuation">.</span>effectiveType <span class="token operator">===</span> <span class="token string">'2g'</span> <span class="token operator">||</span> connection<span class="token punctuation">.</span>rtt <span class="token operator">&gt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"您的网络连接速度较慢，请考虑刷新页面或切换网络。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    connection<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> updateConnectionStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">updateConnectionStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化时检查一次</span>

<span class="token punctuation">}</span>
</code></pre>

   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f43686c6f65656565656565652f:61727469636c652f64657461696c732f313431303639323936" class_="artid" style="display:none">
 </p>
</div>
