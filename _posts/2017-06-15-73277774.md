---
layout: post
title: "总结MySQL自带的性能压力测试工具mysqlslap详解"
date: 2017-06-15 11:48:55 +0800
description: "PS：今天一同事问我有木有比较靠谱的mysql压力测试工具可用。其实mysql自带就有一个叫mysq"
keywords: "mysql性能测试"
categories: ['']
tags: ['无标签']
artid: "73277774"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=73277774
    alt: "总结MySQL自带的性能压力测试工具mysqlslap详解"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     （总结）MySQL自带的性能压力测试工具mysqlslap详解
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p style="padding-top:0px; padding-bottom:0px; margin-top:1.2em; margin-bottom:1.2em; line-height:1.5em; color:rgb(0,34,0); font-family:georgia; font-size:15px">
     <span style="padding:0px; margin:0px; color:rgb(255,0,0)">
      PS：今天一同事问我有木有比较靠谱的
      <a href="http://www.ha97.com/tag/mysql" rel="nofollow noopener noreferrer" style="padding:0px; margin:0px; color:rgb(0,102,0); border-bottom:1px dashed rgb(0,102,0)" target="_blank">
       mysql
      </a>
      压力测试工具可用。其实mysql自带就有一个叫mysqlslap的压力测试工具，还是模拟的不错的。下面举例说说。mysqlslap是从5.1.4版开始的一个MySQL官方提供的压力测试工具。通过模拟多个并发客户端访问MySQL来执行压力测试，同时详细的提供了“高负荷攻击MySQL”的数据性能报告。并且能很好的对比多个存储引擎在相同环境下的并发压力性能差别。通过mysqlslap –help可以获得可用的选项，这里列一些主要的参数，更详细的说明参考
      <a href="http://dev.mysql.com/doc/refman/5.5/en/mysqlslap.html" rel="nofollow noopener noreferrer" style="padding:0px; margin:0px; color:rgb(0,102,0); border-bottom:1px dashed rgb(0,102,0)" target="_blank">
       <span style="padding:0px; margin:0px; color:rgb(255,0,0)">
        官方手册
       </span>
      </a>
      。如果是系统自带或者使用rpm包安装的mysql，安装了MySQL-client端的包就有mysqlslap这个工具。
     </span>
    </p>
    <p style="padding-top:0px; padding-bottom:0px; margin-top:1.2em; margin-bottom:1.2em; line-height:1.5em; color:rgb(0,34,0); font-family:georgia; font-size:15px">
     下图是运行mysqlslap -a -c 500 -i 10 -uroot -p123456测试时mysql的连接进程数：
     <br style="padding:0px; margin:0px"/>
     <a href="http://www.ha97.com/wp-content/uploads/2012/12/mysqlslap.jpg" rel="nofollow noopener noreferrer" style="padding:0px; margin:0px; color:rgb(0,102,0); border-bottom:1px dashed rgb(0,102,0)" target="_blank">
      <img alt="" class="alignnone size-full wp-image-5184" height="769" src="http://www.ha97.com/wp-content/uploads/2012/12/mysqlslap.jpg" style="padding:3px; margin:5px 0px; border:1px solid rgb(206,212,202)" title="mysqlslap" width="990"/>
     </a>
     <br style="padding:0px; margin:0px"/>
     <span id="more-5182" style="padding:0px; margin:0px">
     </span>
     <br style="padding:0px; margin:0px"/>
     <span style="padding:0px; margin:0px">
      使用语法如下：
     </span>
     <br style="padding:0px; margin:0px"/>
     # mysqlslap [options]
    </p>
    <p style="padding-top:0px; padding-bottom:0px; margin-top:1.2em; margin-bottom:1.2em; line-height:1.5em; color:rgb(0,34,0); font-family:georgia; font-size:15px">
     <span style="padding:0px; margin:0px">
      常用参数 [options] 详细说明：
     </span>
     <br style="padding:0px; margin:0px"/>
     <code style="padding:0px; margin:0px; font-size:12px; background-color:rgb(238,238,238)">
      <br style="padding:0px; margin:0px"/>
      --auto-generate-sql, -a 自动生成测试表和数据，表示用mysqlslap工具自己生成的SQL脚本来测试并发压力。
      <br style="padding:0px; margin:0px"/>
      --auto-generate-sql-load-type=type 测试语句的类型。代表要测试的环境是读操作还是写操作还是两者混合的。取值包括：read，key，write，update和mixed(默认)。
      <br style="padding:0px; margin:0px"/>
      --auto-generate-sql-add-auto-increment 代表对生成的表自动添加auto_increment列，从5.1.18版本开始支持。
      <br style="padding:0px; margin:0px"/>
      --number-char-cols=N, -x N 自动生成的测试表中包含多少个字符类型的列，默认1
      <br style="padding:0px; margin:0px"/>
      --number-int-cols=N, -y N 自动生成的测试表中包含多少个数字类型的列，默认1
      <br style="padding:0px; margin:0px"/>
      --number-of-queries=N 总的测试查询次数(并发客户数×每客户查询次数)
      <br style="padding:0px; margin:0px"/>
      --query=name,-q 使用自定义脚本执行测试，例如可以调用自定义的一个存储过程或者sql语句来执行测试。
      <br style="padding:0px; margin:0px"/>
      --create-schema 代表自定义的测试库名称，测试的schema，MySQL中schema也就是
      <a href="http://www.ha97.com/category/database" rel="nofollow noopener noreferrer" style="padding:0px; margin:0px; color:rgb(0,102,0); border-bottom:1px dashed rgb(0,102,0)" target="_blank">
       database
      </a>
      。
      <br style="padding:0px; margin:0px"/>
      --commint=N 多少条DML后提交一次。
      <br style="padding:0px; margin:0px"/>
      --compress, -C 如果服务器和客户端支持都压缩，则压缩信息传递。
      <br style="padding:0px; margin:0px"/>
      --concurrency=N, -c N 表示并发量，也就是模拟多少个客户端同时执行select。可指定多个值，以逗号或者--delimiter参数指定的值做为分隔符。例如：--concurrency=100,200,500。
      <br style="padding:0px; margin:0px"/>
      --engine=engine_name, -e engine_name 代表要测试的引擎，可以有多个，用分隔符隔开。例如：--engines=myisam,innodb。
      <br style="padding:0px; margin:0px"/>
      --iterations=N, -i N 测试执行的迭代次数，代表要在不同并发环境下，各自运行测试多少次。
      <br style="padding:0px; margin:0px"/>
      --only-print 只打印测试语句而不实际执行。
      <br style="padding:0px; margin:0px"/>
      --detach=N 执行N条语句后断开重连。
      <br style="padding:0px; margin:0px"/>
      --debug-info, -T 打印内存和CPU的相关信息。
      <br style="padding:0px; margin:0px"/>
     </code>
    </p>
    <p style="padding-top:0px; padding-bottom:0px; margin-top:1.2em; margin-bottom:1.2em; line-height:1.5em; color:rgb(0,34,0); font-family:georgia; font-size:15px">
     说明：
     <br style="padding:0px; margin:0px"/>
     测试的过程需要生成测试表，插入测试数据，这个mysqlslap可以自动生成，默认生成一个mysqlslap的schema，如果已经存在则先删除。可以用
     <code style="padding:0px; margin:0px; font-size:12px; background-color:rgb(238,238,238)">
      --only-print
     </code>
     来打印实际的测试过程，整个测试完成后不会在数据库中留下痕迹。
    </p>
    <p style="padding-top:0px; padding-bottom:0px; margin-top:1.2em; margin-bottom:1.2em; line-height:1.5em; color:rgb(0,34,0); font-family:georgia; font-size:15px">
     <span style="padding:0px; margin:0px">
      各种测试参数实例（-p后面跟的是mysql的root密码）：
     </span>
    </p>
    <p style="padding-top:0px; padding-bottom:0px; margin-top:1.2em; margin-bottom:1.2em; line-height:1.5em; color:rgb(0,34,0); font-family:georgia; font-size:15px">
     单线程测试。测试做了什么。
     <br style="padding:0px; margin:0px"/>
     <code style="padding:0px; margin:0px; font-size:12px; background-color:rgb(238,238,238)">
      # mysqlslap -a -uroot -p123456
     </code>
     <br style="padding:0px; margin:0px"/>
     多线程测试。使用–concurrency来模拟并发连接。
     <br style="padding:0px; margin:0px"/>
     <code style="padding:0px; margin:0px; font-size:12px; background-color:rgb(238,238,238)">
      # mysqlslap -a -c 100 -uroot -p123456
     </code>
     <br style="padding:0px; margin:0px"/>
     迭代测试。用于需要多次执行测试得到平均值。
     <br style="padding:0px; margin:0px"/>
     <code style="padding:0px; margin:0px; font-size:12px; background-color:rgb(238,238,238)">
      # mysqlslap -a -i 10 -uroot -p123456
     </code>
     <br style="padding:0px; margin:0px"/>
     <code style="padding:0px; margin:0px; font-size:12px; background-color:rgb(238,238,238)">
      <br style="padding:0px; margin:0px"/>
      # mysqlslap ---auto-generate-sql-add-autoincrement -a -uroot -p123456
      <br style="padding:0px; margin:0px"/>
      # mysqlslap -a --auto-generate-sql-load-type=read -uroot -p123456
      <br style="padding:0px; margin:0px"/>
      # mysqlslap -a --auto-generate-secondary-indexes=3 -uroot -p123456
      <br style="padding:0px; margin:0px"/>
      # mysqlslap -a --auto-generate-sql-write-number=1000 -uroot -p123456
      <br style="padding:0px; margin:0px"/>
      # mysqlslap --create-schema world -q "select count(*) from City" -uroot -p123456
      <br style="padding:0px; margin:0px"/>
      # mysqlslap -a -e innodb -uroot -p123456
      <br style="padding:0px; margin:0px"/>
      # mysqlslap -a --number-of-queries=10 -uroot -p123456
      <br style="padding:0px; margin:0px"/>
     </code>
    </p>
    <p style="padding-top:0px; padding-bottom:0px; margin-top:1.2em; margin-bottom:1.2em; line-height:1.5em; color:rgb(0,34,0); font-family:georgia; font-size:15px">
     测试同时不同的存储引擎的性能进行对比：
     <br style="padding:0px; margin:0px"/>
     <code style="padding:0px; margin:0px; font-size:12px; background-color:rgb(238,238,238)">
      # mysqlslap -a --concurrency=50,100 --number-of-queries 1000 --iterations=5 --engine=myisam,innodb --debug-info -uroot -p123456
     </code>
    </p>
    <p style="padding-top:0px; padding-bottom:0px; margin-top:1.2em; margin-bottom:1.2em; line-height:1.5em; color:rgb(0,34,0); font-family:georgia; font-size:15px">
     执行一次测试，分别50和100个并发，执行1000次总查询：
     <br style="padding:0px; margin:0px"/>
     <code style="padding:0px; margin:0px; font-size:12px; background-color:rgb(238,238,238)">
      # mysqlslap -a --concurrency=50,100 --number-of-queries 1000 --debug-info -uroot -p123456
     </code>
    </p>
    <p style="padding-top:0px; padding-bottom:0px; margin-top:1.2em; margin-bottom:1.2em; line-height:1.5em; color:rgb(0,34,0); font-family:georgia; font-size:15px">
     50和100个并发分别得到一次测试结果(Benchmark)，并发数越多，执行完所有查询的时间越长。为了准确起见，可以多迭代测试几次:
     <br style="padding:0px; margin:0px"/>
     <code style="padding:0px; margin:0px; font-size:12px; background-color:rgb(238,238,238)">
      # mysqlslap -a --concurrency=50,100 --number-of-queries 1000 --iterations=5 --debug-info -uroot -p123456
     </code>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f67:2e6373646e2e6e65742f6c696e3434333531343430376c696e:2f61727469636c652f64657461696c732f3733323737373734" class_="artid" style="display:none">
 </p>
</div>


