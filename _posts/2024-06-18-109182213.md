---
layout: post
title: "小程序上传图片wx.uploadFile用法"
date: 2024-06-18 14:31:57 +0800
description: "前言：   小程序的上传和我们开发其他项目是不一样的，这里说一说他的用法。使用步骤：1、这里默认开发"
keywords: "wx.uploadfile"
categories: ['小程序']
tags: ['Wx']
artid: "109182213"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=109182213
    alt: "小程序上传图片wx.uploadFile用法"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     小程序上传图片wx.uploadFile用法
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h4>
     前言：
    </h4>
    <h4>
     小程序的上传和我们开发其他项目是不一样的，这里说一说他的用法。
    </h4>
    <h2>
     使用步骤：
    </h2>
    <h3>
     1、这里默认开发环境，并且默认不校验https,部署好环境
     <span style="color:#f33b45;">
      设置-》项目设置-》勾选
     </span>
    </h3>
    <p>
     <img alt="" height="562" src="https://i-blog.csdnimg.cn/blog_migrate/1bf85bcae14ed7a43b6e9919afe8ba88.png" width="390"/>
    </p>
    <h3>
     2、页面添加事件方法，这里核心方法是两个，一个是
     <a href="https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.chooseImage.html" rel="nofollow">
      wx.chooseImage
     </a>
     是获取图片，一个是
     <a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/upload/wx.uploadFile.html" rel="nofollow">
      wx.uploadFile
     </a>
     是上传图片
    </h3>
    <pre><code>//选取图片
wx.chooseImage({
            count: 1,
            sizeType: ['original'],//原图
            sourceType: [ 'album','camera'],//支持选取图片
            success (res) {
                // tempFilePath可以作为img标签的src属性显示图片
                const tempFilePaths = res.tempFilePaths[0];
                //上传图片
                wx.uploadFile({

                    //请求后台的路径
                    url: 'http://192.168.35.201:8090/image',

                    //小程序本地的路径
                    filePath: tempFilePaths,

                    //后台获取我们图片的key
                    name: 'images',

                    //额外的参数formData
                    formData: {
                        'id': 'test',
                        a:{ abc:'111'},
                        b:[1,2,3]
                    },
                    success: function (res) {
                    //上传成功
                        debugger
                    },
                    fail: function (res) {
                        debugger
                    },
                })
            }
        })</code></pre>
    <h2>
     使用api:
    </h2>
    <h3>
     1、
     <a href="https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.chooseImage.html" rel="nofollow">
      wx.chooseImage
     </a>
     从本地相册选择图片或使用相机拍照。
    </h3>
    <h3 id="参数">
     参数
    </h3>
    <h4 id="Object-object">
     Object object
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        属性
       </th>
       <th>
        类型
       </th>
       <th>
        默认值
       </th>
       <th>
        必填
       </th>
       <th>
        说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        count
       </td>
       <td>
        number
       </td>
       <td>
        9
       </td>
       <td>
        否
       </td>
       <td>
        最多可以选择的图片张数
       </td>
      </tr>
      <tr>
       <td>
        sizeType
       </td>
       <td>
        Array.&lt;string&gt;
       </td>
       <td>
        ['original', 'compressed']
       </td>
       <td>
        否
       </td>
       <td>
        所选的图片的尺寸
       </td>
      </tr>
      <tr>
       <td>
        sourceType
       </td>
       <td>
        Array.&lt;string&gt;
       </td>
       <td>
        ['album', 'camera']
       </td>
       <td>
        否
       </td>
       <td>
        选择图片的来源
       </td>
      </tr>
      <tr>
       <td>
        success
       </td>
       <td>
        function
       </td>
       <td>
       </td>
       <td>
        否
       </td>
       <td>
        接口调用成功的回调函数
       </td>
      </tr>
      <tr>
       <td>
        fail
       </td>
       <td>
        function
       </td>
       <td>
       </td>
       <td>
        否
       </td>
       <td>
        接口调用失败的回调函数
       </td>
      </tr>
      <tr>
       <td>
        complete
       </td>
       <td>
        function
       </td>
       <td>
       </td>
       <td>
        否
       </td>
       <td>
        接口调用结束的回调函数（调用成功、失败都会执行）
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     <strong>
      object.sizeType 的合法值
     </strong>
    </p>
    <table>
     <thead>
      <tr>
       <th>
        值
       </th>
       <th>
        说明
       </th>
       <th>
        最低版本
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        original
       </td>
       <td>
        原图
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        compressed
       </td>
       <td>
        压缩图
       </td>
       <td>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     <strong>
      object.sourceType 的合法值
     </strong>
    </p>
    <table>
     <thead>
      <tr>
       <th>
        值
       </th>
       <th>
        说明
       </th>
       <th>
        最低版本
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        album
       </td>
       <td>
        从相册选图
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        camera
       </td>
       <td>
        使用相机
       </td>
       <td>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     object.success 回调函数
    </p>
    <p>
     参数
    </p>
    <p>
     Object res
    </p>
    <table>
     <thead>
      <tr>
       <th>
        属性
       </th>
       <th>
        类型
       </th>
       <th>
        说明
       </th>
       <th>
        最低版本
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        tempFilePaths
       </td>
       <td>
        Array.&lt;string&gt;
       </td>
       <td>
        图片的本地临时文件路径列表 (本地路径)
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        tempFiles
       </td>
       <td>
        Array.&lt;Object&gt;
       </td>
       <td>
        图片的本地临时文件列表
       </td>
       <td>
        <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html" rel="nofollow">
         1.2.0
        </a>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     <strong>
      res.tempFiles 的结构
     </strong>
    </p>
    <table>
     <thead>
      <tr>
       <th>
        属性
       </th>
       <th>
        类型
       </th>
       <th>
        说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        path
       </td>
       <td>
        string
       </td>
       <td>
        本地临时文件路径 (本地路径)
       </td>
      </tr>
      <tr>
       <td>
        size
       </td>
       <td>
        number
       </td>
       <td>
        本地临时文件大小，单位 B
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     2、
     <a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/upload/wx.uploadFile.html" rel="nofollow">
      wx.uploadFile
     </a>
    </h3>
    <p>
     将本地资源上传到服务器。客户端发起一个 HTTPS POST 请求，其中
     <code>
      content-type
     </code>
     为
     <code>
      multipart/form-data
     </code>
     。使用前请注意阅读
     <a href="https://developers.weixin.qq.com/minigame/dev/guide/base-ability/network.html" rel="nofollow">
      相关说明
     </a>
     。
    </p>
    <h3>
     参数
    </h3>
    <h4>
     Object object
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        属性
       </th>
       <th>
        类型
       </th>
       <th>
        默认值
       </th>
       <th>
        必填
       </th>
       <th>
        说明
       </th>
       <th>
        最低版本
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        url
       </td>
       <td>
        string
       </td>
       <td>
       </td>
       <td>
        是
       </td>
       <td>
        开发者服务器地址
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        filePath
       </td>
       <td>
        string
       </td>
       <td>
       </td>
       <td>
        是
       </td>
       <td>
        要上传文件资源的路径 (本地路径)
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        name
       </td>
       <td>
        string
       </td>
       <td>
       </td>
       <td>
        是
       </td>
       <td>
        文件对应的 key，开发者在服务端可以通过这个 key 获取文件的二进制内容
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        header
       </td>
       <td>
        Object
       </td>
       <td>
       </td>
       <td>
        否
       </td>
       <td>
        HTTP 请求 Header，Header 中不能设置 Referer
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        formData
       </td>
       <td>
        Object
       </td>
       <td>
       </td>
       <td>
        否
       </td>
       <td>
        HTTP 请求中其他额外的 form data
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        timeout
       </td>
       <td>
        number
       </td>
       <td>
       </td>
       <td>
        否
       </td>
       <td>
        超时时间，单位为毫秒
       </td>
       <td>
        <a href="https://developers.weixin.qq.com/minigame/dev/guide/runtime/client-lib/compatibility.html" rel="nofollow">
         2.10.0
        </a>
       </td>
      </tr>
      <tr>
       <td>
        success
       </td>
       <td>
        function
       </td>
       <td>
       </td>
       <td>
        否
       </td>
       <td>
        接口调用成功的回调函数
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        fail
       </td>
       <td>
        function
       </td>
       <td>
       </td>
       <td>
        否
       </td>
       <td>
        接口调用失败的回调函数
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        complete
       </td>
       <td>
        function
       </td>
       <td>
       </td>
       <td>
        否
       </td>
       <td>
        接口调用结束的回调函数（调用成功、失败都会执行）
       </td>
       <td>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     object.success 回调函数
    </p>
    <p>
     参数
    </p>
    <p>
     Object res
    </p>
    <table>
     <thead>
      <tr>
       <th>
        属性
       </th>
       <th>
        类型
       </th>
       <th>
        说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        data
       </td>
       <td>
        string
       </td>
       <td>
        开发者服务器返回的数据
       </td>
      </tr>
      <tr>
       <td>
        statusCode
       </td>
       <td>
        number
       </td>
       <td>
        开发者服务器返回的 HTTP 状态码
       </td>
      </tr>
     </tbody>
    </table>
    <h3 id="返回值">
     返回值
    </h3>
    <h4 id="UploadTask">
     <a href="https://developers.weixin.qq.com/minigame/dev/api/network/upload/UploadTask.html" rel="nofollow">
      UploadTask
     </a>
    </h4>
    <blockquote>
     <p>
      基础库 1.4.0 开始支持，低版本需做
      <a href="https://developers.weixin.qq.com/minigame/dev/guide/runtime/client-lib/compatibility.html" rel="nofollow">
       兼容处理
      </a>
      。
     </p>
    </blockquote>
    <p>
     一个可以监听上传进度进度变化的事件和取消上传的对象
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34313631393739362f:61727469636c652f64657461696c732f313039313832323133" class_="artid" style="display:none">
 </p>
</div>


