---
layout: post
title: "前端上传的文件,后端将如何进行存储以及回显"
date: 2023-05-22 09:14:49 +0800
description: "前端上传的文件，后端将如何进行存储以及回显_文件上传正确的后端存什么"
keywords: "文件上传正确的后端存什么"
categories: ["未分类"]
tags: ["前端", "Mybatis", "Java"]
artid: "130796008"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=130796008
  alt: "前端上传的文件,后端将如何进行存储以及回显"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     前端上传的文件，后端将如何进行存储以及回显
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     文件上传
    </h3>
    <p>
     完成文件上传这个功能需要涉及到两个部分：
    </p>
    <ol>
     <li>
      前端程序
     </li>
     <li>
      服务器程序
     </li>
    </ol>
    <h3>
     <a id="_4">
     </a>
     储存方式
    </h3>
    <p>
     文件上传后将如何进行储存
    </p>
    <ol>
     <li>
      本地磁盘储存
     </li>
     <li>
      云服务器oss储存
     </li>
    </ol>
    <h3>
     <a id="_9">
     </a>
     项目准备
    </h3>
    <p>
     ##后端项目创建
    </p>
    <ol>
     <li>
      创建springboot工程，引入对应的起步依赖（web、mybatis、mysql驱动、lombok）
     </li>
     <li>
      配置文件application.properties中引入mybatis的配置信息，准备对应的实体类
     </li>
     <li>
      准备对应的Mapper、Service(接口、实现类)、Controller基础结构
     </li>
    </ol>
    <p>
     ##前端代码准备
    </p>
    <p>
     便于测试，我们将前端程序直接放在springboot项目工程下的static（静态资 源）目录里面的"upload.html"文件中。
    </p>
    <pre><code class="prism language-java"><span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">"/upload"</span> method<span class="token operator">=</span><span class="token string">"post"</span> enctype<span class="token operator">=</span><span class="token string">"multipart/form-data"</span><span class="token operator">&gt;</span>
	姓名<span class="token operator">:</span> <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"username"</span><span class="token operator">&gt;</span><span class="token generics"><span class="token punctuation">&lt;</span>br<span class="token punctuation">&gt;</span></span>
    年龄<span class="token operator">:</span> <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"age"</span><span class="token operator">&gt;</span><span class="token generics"><span class="token punctuation">&lt;</span>br<span class="token punctuation">&gt;</span></span>
    头像<span class="token operator">:</span> <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"file"</span> name<span class="token operator">=</span><span class="token string">"image"</span><span class="token operator">&gt;</span><span class="token generics"><span class="token punctuation">&lt;</span>br<span class="token punctuation">&gt;</span></span>
    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"submit"</span> value<span class="token operator">=</span><span class="token string">"提交"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
</code></pre>
    <p>
     上传文件的原始form表单，要求表单必须具备以下三点（上传文件页面三要素）：
    </p>
    <ul>
     <li>
      <p>
       表单必须有file域，用于选择要上传的文件
      </p>
      <blockquote>
       <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre>
      </blockquote>
     </li>
     <li>
      <p>
       表单提交方式必须为POST
      </p>
      <p>
       通常上传的文件会比较大，所以需要使用 POST 提交方式
      </p>
     </li>
     <li>
      <p>
       表单的编码类型enctype必须要设置为：multipart/form-data
      </p>
      <p>
       普通默认的编码格式是不适合传输大型的二进制数据的，所以在文件上传时，表单的编码格式必须设置为multipart/form-data
      </p>
     </li>
    </ul>
    <h3>
     <a id="_42">
     </a>
     本地磁盘储存代码实现
    </h3>
    <ul>
     <li>
      首先在服务端定义一个controller类，用来进行文件上传，然后在controller当中定义一个方法来处理/upload 请求
     </li>
     <li>
      在定义的方法中接收提交过来的数据 （方法中的形参名和请求参数的名字保持一致）
      <ul>
       <li>
        用户名：String name
       </li>
       <li>
        年龄： Integer age
       </li>
       <li>
        文件： MultipartFile image（Spring中提供了一个API：MultipartFile，使用这个API就可以来接收到上传的文件）
       </li>
      </ul>
     </li>
    </ul>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/upload"</span><span class="token punctuation">)</span>
     <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> image<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//获取原始文件名</span>
         <span class="token class-name">String</span> originalFilename <span class="token operator">=</span> image<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//构建新的文件名</span>
         <span class="token class-name">String</span> eatnmae <span class="token operator">=</span> originalFilename<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>originalFilename<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//引入UUID，防止文件名相同覆盖</span>
         <span class="token class-name">String</span> newFileName <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> eatnmae<span class="token punctuation">;</span>
         <span class="token comment">//将文件储存在服务器的磁盘目录中</span>
         image<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"D:/"</span> <span class="token operator">+</span>newFileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     注意：如果表单项的名字和方法中形参名一致
    </p>
    <h3>
     <a id="_66">
     </a>
     云服务器储存代码实现（以阿里云为例）
    </h3>
    <pre><code> 文件储存我们使用的是阿里云的OSS对象存储服务。

前端发送文件上传请求——&gt;服务器接收请求并将接收到的上传文件——&gt;
上传到 oss ，由 oss 帮我们存储和管理。
</code></pre>
<ol>
<li>
<p>
如何在项目当中来使用云服务完成具体的业务功能
</p>
<p>
SDK：Software Development Kit 的缩写，软件开发工具包，包括辅助软件开发的依赖（jar 包）、代码示例等，都可以叫做 SDK。
</p>
<p>
简单说，sdk 中包含了我们使用第三方云服务时所需要的依赖，以及一些示例代码。我们可以参照 sdk 所提供的示例代码就可以完成入门程序。
</p>
</li>
<li>
<p>
阿里云 oss 对象存储服务具体的使用步骤。
</p>
</li>
</ol>
<p>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a2611a2a129441133fd1180247ad6f75.png#pic_center"/>
</p>
<ul>
<li>
注册阿里云账户（注册完成后需要实名认证）
</li>
<li>
注册完账号之后，就可以登录阿里云
</li>
</ul>
<p>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2d5e16662b2c479e6b19256d5c688bec.png#pic_center"/>
</p>
<ul>
<li>
通过控制台找到对象存储 OSS 服务（如果是第一次访问，还需要开通对象存储服务 OSS）
</li>
</ul>
<p>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/86a5f08354ec21198d1c565e5c1aabcb.png#pic_center">
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c42046f84eba8073b48f0513faf666a3.png#pic_center">
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2a5120ca3b357830405dc019b1c0817a.png#pic_center"/>
</img>
</img>
</p>
<ul>
<li>
开通 OSS 服务之后，就可以进入到阿里云对象存储的控制台
</li>
</ul>
<p>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ed903d06fcdb057c1ade8a4944ef9e2c.png#pic_center"/>
</p>
<ul>
<li>
点击左侧的 “Bucket 列表”，创建一个 Bucket
</li>
</ul>
<p>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/dffed4784e007fa750b02b3f348be9a3.png#pic_center">
<br/> 3. 参照官方所提供的 SDK 示例来编写入门程序。
</img>
</p>
<ul>
<li>
找到阿里云 OSS 提供的 SDK 示例代码
</li>
<li>
引入依赖放入项目中的 pom.xml 依赖配置文件中
</li>
</ul>
<pre><code class="prism language-java"> <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>oss<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>aliyun<span class="token operator">-</span>sdk<span class="token operator">-</span>oss<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">3.15</span><span class="token number">.1</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
<span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>jaxb<span class="token operator">-</span>api<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">2.3</span><span class="token number">.1</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
<span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>javax<span class="token punctuation">.</span>activation<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>activation<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.1</span><span class="token number">.1</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>no more than <span class="token number">2.3</span><span class="token number">.3</span><span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
<span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>glassfish<span class="token punctuation">.</span>jaxb<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>jaxb<span class="token operator">-</span>runtime<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">2.3</span><span class="token number">.3</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre>
<ul>
<li>
在项目中新建一个工具 Utils 类，根据示例代码进行改写
</li>
</ul>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliOSSUtils</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span> <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">"https://oss-cn-shanghai.aliyuncs.com"</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">"LTAI5t9MZK8iq5T2Av5GLDxX"</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">"C0IrHzKZGKqU8S7YQcevcotD3Zd5Tc"</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">"web-framework01"</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 实现上传图片到OSS
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> multipartFile<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取上传的文件的输入流</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> multipartFile<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 避免文件覆盖</span>
        <span class="token class-name">String</span> originalFilename <span class="token operator">=</span> multipartFile<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fileName <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> originalFilename<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>originalFilename<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//上传文件到 OSS</span>
        <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//文件访问路径</span>
        <span class="token class-name">String</span> url <span class="token operator">=</span> endpoint<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"//"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"//"</span> <span class="token operator">+</span> bucketName <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> endpoint<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"//"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> fileName<span class="token punctuation">;</span>

        <span class="token comment">// 关闭ossClient</span>
        ossClient<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> url<span class="token punctuation">;</span><span class="token comment">// 把上传到oss的路径返回</span>
    <span class="token punctuation">}</span>

</code></pre>
<ul>
<li>
Controller 层代码实现
</li>
</ul>
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadController</span> <span class="token punctuation">{<!-- --></span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">AliOSSUtils</span> aliOSSUtils<span class="token punctuation">;</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/upload"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> image<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">//调用阿里云 OSS 工具类，将上传上来的文件存入阿里云</span>
<span class="token class-name">String</span> url <span class="token operator">=</span> aliOSSUtils<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//将图片上传完成后的 url 返回，用于浏览器回显展示</span>
<span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre>

   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f35313939313339332f:61727469636c652f64657461696c732f313330373936303038" class_="artid" style="display:none">
 </p>
</div>
