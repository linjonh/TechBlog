---
layout: post
title: "Linux源码编译python3以及必要的依赖包libffi"
date: 2024-01-20 17:39:25 +0800
description: "本文详细描述了在Linux环境下，如何从源码下载Python3.7.3并解决`_ctypes`模块缺"
keywords: "libffi"
categories: ['Python', 'Linux']
tags: ['Python', 'Linux']
artid: "135718557"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=135718557
    alt: "Linux源码编译python3以及必要的依赖包libffi"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Linux源码编译python3（以及必要的依赖包libffi）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
    </p>
    <p>
     <strong>
      目录
     </strong>
    </p>
    <p style="margin-left:0px;">
     <a href="#1%20%E4%B8%8B%E8%BD%BDpython3%E6%BA%90%E7%A0%81" rel="nofollow">
      1 下载python3源码
     </a>
    </p>
    <p style="margin-left:0px;">
     <a href="#2%20%E8%A7%A3%E5%8E%8B%E6%BA%90%E7%A0%81%EF%BC%8C%E8%BF%9B%E5%85%A5%E8%A7%A3%E5%8E%8B%E7%9A%84%E8%B7%AF%E5%BE%84" rel="nofollow">
      2 解压源码，进入解压的路径
     </a>
    </p>
    <p style="margin-left:0px;">
     <a href="#3%20configure" rel="nofollow">
      3 configure
     </a>
    </p>
    <p style="margin-left:0px;">
     <a href="#4%20make" rel="nofollow">
      4 make
     </a>
    </p>
    <p style="margin-left:0px;">
     <a href="#5%20sudo%20make%20install" rel="nofollow">
      5 sudo make install失败
     </a>
    </p>
    <p style="margin-left:0px;">
     <a href="#6%20%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91libffi" rel="nofollow">
      6 源码编译libffi
     </a>
    </p>
    <p style="margin-left:40px;">
     <a href="#6.1%20%E4%B8%8B%E8%BD%BD%E6%BA%90%E7%A0%81" rel="nofollow">
      6.1 下载源码3.4.4
     </a>
    </p>
    <p style="margin-left:40px;">
     <a href="#6.2%20%E8%A7%A3%E5%8E%8B%EF%BC%8C%E5%B9%B6%E8%BF%9B%E5%85%A5%E8%A7%A3%E5%8E%8B%E5%90%8E%E7%9A%84%E8%B7%AF%E5%BE%84" rel="nofollow">
      6.2 解压，并进入解压后的路径
     </a>
    </p>
    <p style="margin-left:40px;">
     <a href="#6.3%20%E6%89%A7%E8%A1%8C%E5%A6%82%E4%B8%8B%E4%B8%89%E6%AD%A5%EF%BC%9A" rel="nofollow">
      6.3 执行如下三步：
     </a>
    </p>
    <p style="margin-left:40px;">
     <a href="#6.4%20ldconfig" rel="nofollow">
      6.4 ldconfig
     </a>
    </p>
    <p style="margin-left:80px;">
     <a href="#6.4.1%20%2Fetc%2Fld.so.conf" rel="nofollow">
      6.4.1 /etc/ld.so.conf
     </a>
    </p>
    <p style="margin-left:80px;">
     <a href="#6.4.2%20ldconfig" rel="nofollow">
      6.4.2 ldconfig
     </a>
    </p>
    <p style="margin-left:0px;">
     <a href="#6.5%20sudo%20make%20install" rel="nofollow">
      7 sudo make install成功安装python3
     </a>
    </p>
    <p style="margin-left:0px;">
     <a href="#6.6%20%E5%BB%BA%E7%AB%8B%E8%BD%AF%E9%93%BE%E6%8E%A5" rel="nofollow">
      8 建立软链接
     </a>
    </p>
    <p style="margin-left:40px;">
     <a href="#6.6.1%20%E5%BB%BA%E7%AB%8Bpython3%E7%9A%84%E8%BD%AF%E9%93%BE%E6%8E%A5" rel="nofollow">
      8.1 建立python3的软链接
     </a>
    </p>
    <p style="margin-left:40px;">
     <a href="#6.6.2%20%E5%BB%BA%E7%AB%8Bpip3%E7%9A%84%E8%BD%AF%E9%93%BE%E6%8E%A5" rel="nofollow">
      8.2 建立pip3的软链接
     </a>
    </p>
    <hr/>
    <p>
     本文参考了
     <a href="https://blog.csdn.net/pengjunlee/article/details/89100730" title="Linux下使用源码包安装Python_libressl 2.8.3-CSDN博客">
      Linux下使用源码包安装Python_libressl 2.8.3-CSDN博客
     </a>
    </p>
    <p>
     本文操作系统为银河麒麟虚拟机
    </p>
    <h2>
     1 下载python3源码
    </h2>
    <p>
     版本3.7.3  地址：
     <a href="https://registry.npmmirror.com/binary.html?path=python/3.7.3/" rel="nofollow" title="CNPM Binaries Mirror (npmmirror.com)">
      CNPM Binaries Mirror (npmmirror.com)
     </a>
    </p>
    <h2>
     2 解压源码，进入解压的路径
    </h2>
    <h2>
     3 configure
    </h2>
    <pre><code class="language-bash">./configure --prefix=/usr/local/python3</code></pre>
    <h2>
     4 make
    </h2>
    <h2>
     5 sudo make install失败
    </h2>
    <p>
     这一步可能出问题。下面是我遇到的问题截图：
    </p>
    <p style="text-align:center;">
     <img alt="4dfb4ce6678b41c381714d265a47a904.png" src="https://i-blog.csdnimg.cn/blog_migrate/111cdad6a1f61c6bdb973d68014c6363.png"/>
    </p>
    <p>
     根据
     <a href="https://blog.csdn.net/wuyepiaoxue789/article/details/117958240" title="ModuleNotFoundError: No module named ‘_ctypes‘解决方法_no module named '_ctypes-CSDN博客">
      ModuleNotFoundError: No module named ‘_ctypes‘解决方法_no module named '_ctypes-CSDN博客
     </a>
     的说法，解决办法是安装libffi。下面通过编译源码安装libffi
    </p>
    <h2>
     6 源码编译libffi
    </h2>
    <h3>
     6.1 下载源码3.4.4
    </h3>
    <p>
     <a href="https://sourceware.org/libffi/" rel="nofollow" title="libffi (sourceware.org)">
      libffi (sourceware.org)
     </a>
    </p>
    <p>
     版本3.4.4
    </p>
    <h3>
     6.2 解压，并进入解压后的路径
    </h3>
    <h3>
     6.3 执行如下三步：
    </h3>
    <pre><code class="language-bash">./configure
make
sudo make install</code></pre>
    <h3>
     6.4 ldconfig
    </h3>
    <p>
     安装完成后，libffi.so安装在/usr/local/lib中。这个路径下增加的so文件不会立刻起作用，而要经过如下两步才起作用：
    </p>
    <h4>
     6.4.1 /etc/ld.so.conf
    </h4>
    <p>
     确认/usr/local/lib出现在ld.so.conf中
    </p>
    <h4>
     6.4.2 ldconfig
    </h4>
    <pre><code class="language-bash">sudo ldconfig</code></pre>
    <p style="text-align:center;">
     <img alt="88d2518379154210947c0a487fb73f65.png" src="https://i-blog.csdnimg.cn/blog_migrate/26c5bb488aa0631786fdc02c6bcb3fe7.png"/>
    </p>
    <h2>
     7 sudo make install成功安装python3
    </h2>
    <p>
     回到刚才解压python3源码，并执行make和make install的路径，再次执行：
    </p>
    <pre><code class="language-bash">sudo make install</code></pre>
    <p>
     安装完成：
    </p>
    <p style="text-align:center;">
     <img alt="33800c85b7644f0fb3b5112f96137014.png" src="https://i-blog.csdnimg.cn/blog_migrate/282af45a1605504ef47c4074b8f403a1.png"/>
    </p>
    <h2>
     8 建立软链接
    </h2>
    <p>
     由于银河麒麟已经预装了python2.7，所以要把新的python与旧的区别开。
    </p>
    <h3>
     8.1 建立python3的软链接
    </h3>
    <pre><code class="language-bash">sudo ln -s /usr/local/python3/bin/python3.7 /usr/sbin/python3</code></pre>
    <p>
     完成这一步，你就可以看到python3的版本号了。
    </p>
    <p style="text-align:center;">
     <img alt="4b75c11b60d940e789de0915f955a9ee.png" src="https://i-blog.csdnimg.cn/blog_migrate/be41834e221586faf9a0070cbb8fd716.png"/>
    </p>
    <h3>
     8.2 建立pip3的软链接
    </h3>
    <pre><code class="language-bash">sudo ln -s /usr/local/python3/bin/pip3 /usr/sbin/pip3</code></pre>
    <p style="text-align:center;">
     <img alt="e1defe39acd84435943a16484ff1f07d.png" src="https://i-blog.csdnimg.cn/blog_migrate/6ad55ac003763e9a7f0cdbcae47ef2ab.png"/>
    </p>
    <p>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f6c696a695f6469676974616c2f:61727469636c652f64657461696c732f313335373138353537" class_="artid" style="display:none">
 </p>
</div>


