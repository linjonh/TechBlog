---
layout: post
title: "Pytest测试框架的基本使用"
date: 2024-12-03 15:34:27 +0800
description: "本文详细介绍了pytest测试框架的使用，包括pytest的命名约束，创建测试用例，执行测试用例，生"
keywords: "pytest使用"
categories: ["未分类"]
tags: ["开发语言", "参数化测试", "Python", "Pytest"]
artid: "140569908"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=140569908
  alt: "Pytest测试框架的基本使用"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Pytest测试框架的基本使用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p id="main-toc">
     <strong>
      目录
     </strong>
    </p>
    <p id="%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B-toc" style="margin-left:0px;">
     <a href="#%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B" rel="nofollow">
      安装教程
     </a>
    </p>
    <p id="Pytest%E5%91%BD%E5%90%8D%E7%BA%A6%E6%9D%9F-toc" style="margin-left:0px;">
     <a href="#Pytest%E5%91%BD%E5%90%8D%E7%BA%A6%E6%9D%9F" rel="nofollow">
      Pytest命名约束
     </a>
    </p>
    <p id="%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B-toc" style="margin-left:0px;">
     <a href="#%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B" rel="nofollow">
      创建测试用例
     </a>
    </p>
    <p id="%E6%89%A7%E8%A1%8C%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B-toc" style="margin-left:0px;">
     <a href="#%E6%89%A7%E8%A1%8C%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B" rel="nofollow">
      执行测试用例
     </a>
    </p>
    <p id="%E7%94%9F%E6%88%90%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A-toc" style="margin-left:0px;">
     <a href="#%E7%94%9F%E6%88%90%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A" rel="nofollow">
      生成测试报告
     </a>
    </p>
    <p id="%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95-toc" style="margin-left:0px;">
     <a href="#%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95" rel="nofollow">
      参数化测试
     </a>
    </p>
    <hr id="hr-toc"/>
    <p>
     pytest框架
    </p>
    <p>
     pytest是目前非常成熟且功能齐全的一个测试框架，能够进行简单的单元测试和复杂的功能测试。还可以结合selenium/appnium进行自动化测试，或结合requests进行接口测试等，非常灵活，强大方便。
    </p>
    <p>
     本文将讲述pyttest框架的基本使用，一些功能fixture夹具放到后一章再讲，看完本篇，你就可使用pytest进行简单的用例测试以及生成测试报告了
    </p>
    <h2 id="%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B">
     <strong>
      安装教程
     </strong>
    </h2>
    <p>
     1.windows下打开cmd，执行
    </p>
    <pre><code class="language-bash">pip install pytest</code></pre>
    <p>
     2.安装完成后，执行以下命令验证是否已成功安装
    </p>
    <pre><code class="language-bash">pytest --version #如果安装成功会出现安装的pytest版本号</code></pre>
    <p>
     3.打开pycharm（如果有，没有可以略过这一步），依次点击File-&gt;Settings,然后依次点击
    </p>
    <p>
     <img alt="" height="648" src="https://i-blog.csdnimg.cn/direct/b6839a0bb8e84c838a3668f8b7a5e277.png" width="1200"/>
    </p>
    <p>
     输入pytest，然后安装即可：
    </p>
    <p>
     <img alt="" height="828" src="https://i-blog.csdnimg.cn/direct/ee9d33660d9646f08419e7875245c36d.png" width="1139">
      这样我们就可以在pycharm中使用pytest了
     </img>
    </p>
    <h2 id="Pytest%E5%91%BD%E5%90%8D%E7%BA%A6%E6%9D%9F">
     Pytest命名约束
    </h2>
    <p>
     在使用pytest构建测试用例时，需要遵循以下的规则：
    </p>
    <p>
     对于
     <strong>
      每个
      <span style="color:#fe2c24;">
       测试文件
      </span>
     </strong>
     ：
     <strong>
      文件后缀为.py，文件名格式为：
      <span style="color:#fe2c24;">
       test_
      </span>
      fileName.py 或者fileName
      <span style="color:#fe2c24;">
       _test
      </span>
      .py
     </strong>
    </p>
    <p>
     对于每个
     <strong>
      <span style="color:#fe2c24;">
       文件中的测试类
      </span>
     </strong>
     ：
     <span style="color:#fe2c24;">
      <strong>
       需要以Test开头
      </strong>
     </span>
     ，如Test_class1,TestClass2.(注意类中不能有init方法)
    </p>
    <p>
     对于每个文件中的测试方法：
     <span style="color:#fe2c24;">
      <strong>
       需要以test_开头
      </strong>
     </span>
     ，如test_case1,test_case2
    </p>
    <p>
     此时，执行pytest时，会自动寻找
     <strong>
      当前目录以及其子目录下
     </strong>
     所符合以上命名规则的文件或代码进行执行
    </p>
    <h2 id="%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B">
     创建测试用例
    </h2>
    <p>
     首先我们创建一个.py文件，文件名为test_1.py.(名字随便，但要符合上面说的规则)
    </p>
    <p>
     然后我们导入pytest库
    </p>
    <pre><code class="language-bash">import pytest
</code></pre>
    <p>
     下一步，我们创建一个测试类，名为TestDemo，然后该类下有两个测试方法，分别为test_case1,test_case2.
    </p>
    <p>
     同时我们定义一个加法函数，返回传入的两个参数之和
    </p>
    <p>
     代码如下：
    </p>
    <pre><code class="language-python">import pytest

def sum(a,b):
return a+b
class TestDemo:
def test_case1(self):
assert sum(1,4) == 3
def test_case2(self):
assert sum(1,4) == 5</code></pre>
<p>
可以看到我们使用 assert 进行断言，判断测试用例是否正确
</p>
<p>
Python 中常用的断言有以下几种：
</p>
<pre><code class="language-python">assert xx #判断 xx 为真
assert not xx #判断 xx 不为真
assert a == b #判断 a 是否等于 b
assert a != b #判断 a 是否不等于 b
assert a in b #判断 a 是否在 b 中，即 b 是否包含 a </code></pre>
<h2 id="%E6%89%A7%E8%A1%8C%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B" style="background-color:transparent;">
执行测试用例
</h2>
<p>
测试用例写好了，接下来我们需要执行刚才写的这些测试方法
</p>
<p>
两种方式：
<strong> 1.代码         2.命令行
</strong>
</p>
<p>
<strong> 1.代码
</strong>
</p>
<p>
<strong>
我们在测试文件中加入 main 函数，然后调用 pytest 里的 main()方法即可。这样我们直接按正常执.py 文件就可以
</strong>
</p>
<pre><code class="language-python">import pytest

def sum(a,b):
return a+b
class TestDemo:
def test_case1(self):
assert sum(1,4) == 3
def test_case2(self):
assert sum(1,4) == 5

if **name** == '**main**':
pytest.main()</code></pre>
<p>
<strong> 2.命令行
</strong>
</p>
<p>
我们也可以直接在
<strong>
终端
</strong>
（cmd 窗口，或者 pycharm 自带的都可以）输入命令执行测试文件，命令格式如下：
</p>
<pre><code class="language-python">pytest 文件名</code></pre>
<p>
当然我们也可以
<strong>
只执行测试文件中的某个类，某个方法
</strong>
</p>
<pre><code class="language-python">pytest 文件名::类名::方法名</code></pre>
<p>
<strong>
如果只输入 pytest，则会默认执行当前文件夹下所有以 test\_开头（或\_test 结尾）的文件。
</strong>
</p>
<p>
然后我们在 cmd 窗口下执行我们刚才的测试文件(没有 main 方法)：
</p>
<p>
<img alt="" height="484" src="https://i-blog.csdnimg.cn/direct/7b461da31d504c94bb879a7cd7a4b873.png" width="1200"/>
</p>
<p>
可以看到测试结果已经出来了，确实是第一个设计的用例错误，也把报错信息清楚地写了出来
</p>
<p>
同时，pytest 可以带参数执行测试文件，下面是一些常见的参数：
</p>
<blockquote>
<p>
带参数执行
</p>
<p>
Pytest -v 输出用例更加详细的执行信息，比如用例所在文件和用例名称
</p>
<p>
pytest -k “key_name” 执行所有 case 中包含‘关键字’的用例
</p>
<p>
pytest -s 输出用例中的调试信息，比如 print 打印信息，如果不加参数则不输出待执行的用例
</p>
<p>
pytest -x 执行失败则停止执行，后面的用例不会被执行
</p>
<p>
pytest --maxfail=n 执行失败 n 次之后停止执行，n 是执行失败的次数
</p>
<p>
pytest --lf （last failed）重新运行上次失败的用例，若没有失败的会全部跑
</p>
<p>
pytest --ff （failed first）重新运行所有用例，但首先运行上次失败的用例
</p>
</blockquote>
<p>
<strong>
skip 跳过执行
</strong>
</p>
<p>
某些用例可能暂时没写好，或不想执行这个用例，需要跳过该用例执行，那么我们需要 skip 该用例
</p>
<p>
使用方法：在需要跳过的用例前面加上
<span style="color:#fe2c24;">
<strong>
@pytest.mark.skip
</strong>
</span>
<span style="color:#fe2c24;">
<strong>
(reason="跳过原因")
</strong>
</span>
</p>
<p>
在测试类前面加上面的 skip 语句，则会将这个类的全部测试方法跳过
</p>
<p>
在测试方法前加上上面的 skip 语句，则只会跳过该方法执行
</p>
<p>
假设我们在类前面加上 skip 语句：
</p>
<p>
<img alt="" height="449" src="https://i-blog.csdnimg.cn/direct/c65dab90e3f54d3db00cb53b0c0a8316.png" width="634"/>
</p>
<p>
然后我们使用 pytest -v 打印出测试详细信息
</p>
<p>
<img alt="" height="233" src="https://i-blog.csdnimg.cn/direct/19bbf6b5e65844c39a0f62df5bb8f60b.png" width="1200"/>
</p>
<p>
可以看到这五个用例全部跳过执行了，原因都是我设置的“暂时不执行”
</p>
<p>
当我在第 5 个测试用例前面加上那条 skip 语句：
</p>
<p>
<img alt="" height="416" src="https://i-blog.csdnimg.cn/direct/ab02ff90252c4c53ab503c17d88ba97b.png" width="557"/>
</p>
<p>
此时我们再执行，观察测试信息，发现只有第 5 条被跳过了，其它全部正常执行了
</p>
<p>
<img alt="" height="237" src="https://i-blog.csdnimg.cn/direct/643ba820088c40268856776570f704c9.png" width="1200"/>
</p>
<p>
当然如果希望只在特定条件下执行，可以使用
<strong>
@pytest.mark.skipif(condition, reason="")
</strong>
</p>
<p>
<strong>
这里便不再举例子了
</strong>
</p>
<h2 id="%E7%94%9F%E6%88%90%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A" style="background-color:transparent;">
生成测试报告
</h2>
<p>
pytest 本身是没有生成测试报告的功能，但是 pytest 中有很多插件，我们可以通过插件来生成测试报告。下面会给大家介绍一个生成报告的方式。
<strong>
生成 html 报告
</strong>
</p>
<p>
<strong>
生成 html 报告
</strong>
</p>
<p>
首先我们需要安装 pytest-html，在 cmd 窗口下，执行：
</p>
<pre><code class="language-python">pip install pytest-html</code></pre>
<p>
安装完成后，和刚才的步骤一样，在 pycharm(如果有)，在 File&gt;Settings&gt;Project&gt;Project Interpreter 界面，点击“ + ”搜索 pytest-html 即可进行安装。
</p>
<p>
安装好后，我们可以执行下面的指令，生成一份 html 报告
</p>
<pre><code class="language-python">pytest --html=report.html test_1.py</code></pre>
<p>
执行后，它会在当前目录下生成一个"report.html"文件，我们打开它：
</p>
<p>
<img alt="" height="943" src="https://i-blog.csdnimg.cn/direct/3fb5c6c2efac43c0bb79060d2fddbf8b.png" width="1200"/>
</p>
<p>
可以看到已经成功生成，数据准确
</p>
<p>
这个 html 文件会生成到当前目录，如果想
<strong>
生成到指定目录，可以在指定报告名时加入：
</strong>
</p>
<pre><code class="language-python">pytest --html=C:/Users/h/Desktop/report.html .\test_1.py</code></pre>
<p>
当然这个 css 样式是保存在本地的，如果分享给其他人这个 html 文件，会造成 css 样式丢失
</p>
<p>
我们可以使用
</p>
<pre><code class="language-python">pytest --html=report.html --self-contained-html</code></pre>
<p>
将 css 样式合并到 html 里，这样邮箱分享给其他人时也能正常显示了
</p>
<h2 id="%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95">
参数化测试
</h2>
<p>
现在我们编写的函数和测试用例是 1 对 1 的关系，也就是说，当你想测试某个功能场景的时候，你必须要去编写一个对应的测试函数。当测试的场景越来越多，测试数据越来越复杂的情况下，需要编写更多的测心率函数，而这些函数的逻辑基本上是重复的。
</p>
<p>
<img alt="" height="343" src="https://i-blog.csdnimg.cn/direct/e518cdde575d471d8dd7f4c13bd40b49.png" width="661"/>
</p>
<p>
比如我们为了测试 sum 函数，写了四个测试函数
</p>
<p>
在 pytest 当中可以使用参数化这种测试手段，简化编写用例函数的过程。我们并不需要为每一组测试数据单独去编写一个测试函数，而是采取多种数据共用一个函数的方式。如果测试操作几乎一致，可以重复使用这一个函数进行测试。
</p>
<p>
需要再
</p>
<p>
<strong>
@pytest.mark.parametrize(args_name,args_value)
</strong>
</p>
<p>
<code>
@pytest.mark.parametrize
</code>
是用于在 pytest 测试框架中参数化测试的装饰器。它允许通过不同的参数多次运行同一个测试函数，从而简化测试代码的编写和维护。
</p>
<ol>
<li>
<p>
<strong>
装饰器参数：
</strong>
</p>
<ul>
<li>
<code>
args_name
</code>
：参数名称，可以是一个字符串或者一个字符串列表，用于标识测试函数中的参数。
</li>
<li>
<code>
args_value
</code>
：参数值，可以是一个可迭代对象（如列表、元组、集合等），每个元素是一个参数组合，对应于测试函数的参数名称。
</li>
</ul>
</li>
</ol>
<p>
这么直接说可能有一些难理解，我举个例子吧
</p>
<p>
还是拿刚才所说的加法函数来说，用例格式为 a+b=expected？
</p>
<p>
这样 args_name 需要传入三个参数，第一个是第一个参数 a，第二个是 b，第三个是相加的期望结果 expected,即"a,b,expected"
</p>
<p>
args_value 与其对应，假设我们想测试 1+4=5？那么可以传入一个元组，(1,4,5)
</p>
<p>
所以我可以这样写：
</p>
<pre><code class="language-python">@pytest.mark.parametrize("a,b,expected",[
(1,4,5)
])
def test_addSum(a,b,expected):
assert sum(a,b) == expected</code></pre>
<p>
当然我们可以多加几组数据测试：
</p>
<pre><code class="language-python">@pytest.mark.parametrize("a,b,expected",[
(1,4,5),(1,4,4),
(5,5,10),(5,3,10)
])
def test_addSum(a,b,expected):
assert sum(a,b) == expected</code></pre>
<p>
这样我们再执行测试：
</p>
<p>
<img alt="" height="221" src="https://i-blog.csdnimg.cn/direct/d9751401f85b487d983b80a586615b93.png" width="614"/>
</p>
<p>
可以发现结果完美的被测试了出来
</p>
<p>
我们对比一下，不用参数化，和使用参数化
</p>
<p>
不使用参数化：
</p>
<p>
<img alt="" height="270" src="https://i-blog.csdnimg.cn/direct/7fd38a19c73b468399f0ee58e57a2a6e.png" width="501"/>
</p>
<p>
使用参数化：
</p>
<p>
<img alt="" height="118" src="https://i-blog.csdnimg.cn/direct/1fac3126ca0746dbbccba36f1f51cbb6.png" width="510"/>
</p>
<p>
可以发现简洁了不少，这也便是参数化测试的好处
</p>
<p>
到这里，关于 Pytest 测试框架的基本使用就讲完了，下一章我们讲完 fixture 夹具的使用，pytest 基本也就完成了。感谢你的阅读
</p>

   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34373235373437332f:61727469636c652f64657461696c732f313430353639393038" class_="artid" style="display:none">
 </p>
</div>
