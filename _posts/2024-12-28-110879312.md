---
layout: post
title: "通俗易懂玩QTQQuickWidget学习"
date: 2024-12-28 14:49:30 +0800
description: "通俗易懂玩QT：QQuickWidget学习因为公司的业务需求，需要用到线程来解决程序的阻塞问题，特"
keywords: "qquickwidget"
categories: ['Qt']
tags: ['Widget', 'Qt', 'Qt']
artid: "110879312"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=110879312
    alt: "通俗易懂玩QTQQuickWidget学习"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     通俗易懂玩QT：QQuickWidget学习
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="QTQQuickWidget_0">
     </a>
     通俗易懂玩QT：QQuickWidget学习
    </h2>
    <p>
     因为项目需求，需要将 qml 实现的瓦片地图嵌入 mainwindow 中，以便于实现数据库存取数据，特意学习了一下，这里分享给大家。
    </p>
    <h3>
     <a id="_QQuickWidget__QMainWindow__QML_2">
     </a>
     一、使用 QQuickWidget 在 QMainWindow 中嵌入 QML
    </h3>
    <p>
     QQuickWidget 是 QT 中专门用于将 qml 实现的窗口界面嵌入 QWidget 或 QMainWindow 的控件，使用也比较方便，这里分享两种方法将 QML 窗口嵌入 QWidget 或 QMainWindow 中。
    </p>
    <p>
     方法一：在 ui 文件中嵌入
    </p>
    <ol>
     <li>
      <p>
       打开新建工程的
       <code>
        .ui
       </code>
       文件：
       <br/>
       <img alt="新建一个包含 ui 文件的工程" src="https://i-blog.csdnimg.cn/blog_migrate/2284e3cb0258cc065a8509f315f44f60.png#pic_center"/>
      </p>
     </li>
     <li>
      <p>
       在左边的列表框中找到 Display Widget 下的
       <img alt="QQuickWidget" src="https://i-blog.csdnimg.cn/blog_migrate/c8d76b2967dae3c7e8e854664024e302.png">
        <br/>
        元素（最下面一个），将其拖入右边的窗体中：
        <br/>
        <img alt="将 QQuickWidget 拖入窗体" src="https://i-blog.csdnimg.cn/blog_migrate/29ceae82ea951a379d8d0a95e21b1742.png#pic_center"/>
       </img>
      </p>
     </li>
     <li>
      <p>
       讲一个写好的 qml 文件包含至工程中：
       <br/>
       <img alt="包含一个 qml 文件到工程中去" src="https://i-blog.csdnimg.cn/blog_migrate/45addedc33b5a58e20f7cb48e722e355.png"/>
      </p>
     </li>
     <li>
      <p>
       给 QQuickWidget 对象引入 qml 文件的地址：
       <br/>
       <img alt="引入 qml 文件的地址" src="https://i-blog.csdnimg.cn/blog_migrate/7160c06178bddcc0997f9da5edd0b905.png"/>
      </p>
     </li>
     <li>
      <p>
       点击运行会报错，原因是缺少模块，打开
       <code>
        .pro
       </code>
       文件，引入 quickwidgets 模块：
      </p>
     </li>
    </ol>
    <pre><code class="prism language-cpp"><span class="token comment">//引入前</span>
QT       <span class="token operator">+</span><span class="token operator">=</span> core gui
<span class="token comment">//引入后</span>
QT       <span class="token operator">+</span><span class="token operator">=</span> core gui quickwidgets
</code></pre>
    <ol start="6">
     <li>
      再次点击运行，效果图如下：
      <br/>
      <img alt="运行结果" src="https://i-blog.csdnimg.cn/blog_migrate/eb965bc374b65891cfc32bc53cb50392.png"/>
     </li>
    </ol>
    <p>
     方法二：使用代码嵌入
    </p>
    <ol>
     <li>
      打开
      <code>
       .pro
      </code>
      文件，引入 quickwidgets 模块：
     </li>
    </ol>
    <pre><code class="prism language-cpp">QT       <span class="token operator">+</span><span class="token operator">=</span> core gui quickwidgets
</code></pre>
    <ol start="2">
     <li>
      在头文件中引入 QQuickWidget 控件：
     </li>
    </ol>
    <pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QtQuickWidgets&gt;</span></span>
</code></pre>
    <ol start="3">
     <li>
      在 MainWindow 中新建并初始化一个 QQuickWidget 控件：
     </li>
    </ol>
    <pre><code class="prism language-cpp">QQuickWidget<span class="token operator">*</span> widget <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QQuickWidget</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ol start="4">
     <li>
      为 QQuickWidget 控件设置加载资源：
     </li>
    </ol>
    <pre><code class="prism language-cpp">widget <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token function">setSource</span><span class="token punctuation">(</span><span class="token function">QUrl</span><span class="token punctuation">(</span><span class="token string">"qrc:BDYQml.qml"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ol start="5">
     <li>
      点击运行，效果图如下：
      <br/>
      <img alt="运行效果图" src="https://i-blog.csdnimg.cn/blog_migrate/6722040746bf74d6261e7a95147d77a7.png"/>
     </li>
    </ol>
    <h3>
     <a id="_C__QML__45">
     </a>
     二、使用 C++ 与嵌入窗口中的 QML 交互数据
    </h3>
    <blockquote>
     <p>
      使用 C++ 向嵌入窗口中的 QML 传递数据
     </p>
    </blockquote>
    <pre><code class="prism language-cpp"><span class="token comment">//使用以下方式可向 qml 传递数据，在 qml 中直接使用 obj 即可</span>
widget <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token function">rootContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token function">setContextProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <blockquote>
     <p>
      使用 C++ 获取嵌入窗口中的 QML 的对象
     </p>
    </blockquote>
    <pre><code class="prism language-cpp"><span class="token comment">//使用以下方式可获取 qml 对象，并以 QQuickItem* 格式返回</span>
QQuickItem<span class="token operator">*</span> qmlItem <span class="token operator">=</span> widget <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token function">rootObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="_57">
     </a>
     三、注意事项
    </h3>
    <ol>
     <li>
      嵌入窗体的 qml 对象不能使用 QtQuick.Controls 中的 ApplicationWindow 对象，否则该 qml 无法嵌入；
     </li>
     <li>
      将要嵌入的 qml 文件放置 qrc 中，以便调用，否则大型项目有时引入使用的是绝对地址，具有比较差的移植功能；
     </li>
     <li>
      使用 QQuickWidget 控件需要在 pro 文件中引入 quickwidgets 模块；
     </li>
     <li>
      使用 C++ 向嵌入窗口中的 QML 传递数据时，需要在 setSource 之前，虽然不会影响正常运行，但是会报错。
     </li>
     <li>
      使用 C++ 获取嵌入窗口中的 QML 的对象时，需要在 setSource 之后，虽然不会影响正常运行，但是会报错（本条为推测，没有亲自测试过）。
     </li>
    </ol>
    <p>
     学习分享，一起成长！接触QT的时间不长，有不足之处，欢迎大佬指出来，我会进行更正。有问题可以发送邮件至 mjzhutianxiu@163.com ，不定时上线查收。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33363535333730372f:61727469636c652f64657461696c732f313130383739333132" class_="artid" style="display:none">
 </p>
</div>


