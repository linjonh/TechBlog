---
layout: post
title: "EasyDarwin开源流媒体云平台之语音对讲功能设计与实现"
date: 2024-06-01 09:36:46 +0800
description: "本文由EasyDarwin开源团队成员Alex贡献：http://blog.csdn.net/cai"
keywords: "开源语音对讲系统"
categories: ['Easydarwin']
tags: ['语音对讲', '开源流媒体服务器', '开源云视频平台', 'Easydarwin', 'Easycms']
artid: "52017055"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=52017055
    alt: "EasyDarwin开源流媒体云平台之语音对讲功能设计与实现"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     EasyDarwin开源流媒体云平台之语音对讲功能设计与实现
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     本文由EasyDarwin开源团队成员Alex贡献：
     <a href="http://blog.csdn.net/cai6811376/article/details/52006958">
      http://blog.csdn.net/cai6811376/article/details/52006958
     </a>
    </p>
    <p>
     EasyDarwin云平台一直在稳步的升级迭代中，近日，EasyDarwin云平台实现了语音对讲的功能。对讲功能的加入，标志着EasyDarwin云平台进一步的完善。
    </p>
    <ul>
     <li>
      <p>
       流程设计
      </p>
      <ol>
       <li>
        <p>
         客户端使用POST的方式在body中携带协议报文向云平台发送开始对讲命令；
        </p>
       </li>
       <li>
        <p>
         云平台组织协议报文向指定的设备发送；
        </p>
       </li>
       <li>
        <p>
         设备执行开始对讲命令后向云平台返回相应报文；
        </p>
       </li>
       <li>
        <p>
         云平台将响应报文返回给客户端；
        </p>
       </li>
       <li>
        <p>
         客户端请求开始对讲成功后，开始向云平台发送采集的音频数据；
        </p>
       </li>
       <li>
        <p>
         云平台将音频数据转发给设备；
        </p>
       </li>
       <li>
        <p>
         设备将音频数据播放出来；
        </p>
       </li>
       <li>
        <p>
         客户端需要停止对讲时，向云平台发送停止对讲命令；
        </p>
       </li>
       <li>
        <p>
         云平台转发给设备；
        </p>
       </li>
       <li>
        <p>
         设备执行停止对讲后返回执行结果给云平台；
        </p>
       </li>
       <li>
        <p>
         云平台将结果返回给客户端。
        </p>
       </li>
      </ol>
     </li>
    </ul>
    <p>
     <img alt="tb" src="https://img-blog.csdn.net/20160723220235057" title=""/>
    </p>
    <ul>
     <li>
      协议设计
     </li>
    </ul>
    <pre class="prettyprint"><code class="hljs cs"><span class="hljs-comment">//客户端向云平台发送对讲报文</span>
{
   <span class="hljs-string">"EasyDarwin"</span>: {
      <span class="hljs-string">"Body"</span>: {
         <span class="hljs-string">"Channel"</span>: <span class="hljs-string">"0"</span>,
         <span class="hljs-string">"Command"</span>: <span class="hljs-string">"START"</span>,
         <span class="hljs-string">"AudioType"</span>: <span class="hljs-string">"G711A"</span>,
         <span class="hljs-string">"Protocol"</span>: <span class="hljs-string">"ONVIF"</span>,
         <span class="hljs-string">"Reserve"</span>: <span class="hljs-string">"1"</span>,
         <span class="hljs-string">"Serial"</span>: <span class="hljs-string">"001001000058"</span>,
         <span class="hljs-string">"Preset"</span>: <span class="hljs-string">"3"</span>,
         <span class="hljs-string">"AudioData"</span>: <span class="hljs-string">"BASE64DATA"</span>,
         <span class="hljs-string">"Pts"</span>: <span class="hljs-string">"20"</span>
      },
      <span class="hljs-string">"Header"</span>: {
         <span class="hljs-string">"CSeq"</span>: <span class="hljs-string">"1"</span>,
         <span class="hljs-string">"MessageType"</span>: <span class="hljs-string">"MSG_CS_TALKBACK_CONTROL_REQ"</span>,
         <span class="hljs-string">"Version"</span>: <span class="hljs-string">"1.0"</span>
      }
   }
}
</code></pre>
    <blockquote>
     <p>
      格式说明：
      <br/>
      Serial：设备序列号；
      <br/>
      Channel：摄像机通道号；
      <br/>
      Protocol：指定预置位控制方式，ONVIF协议或者设备SDK；
      <br/>
      Command：对讲控制命令，包括启动对讲、停止对讲、发送对讲数据(START/STOP/SENDDATA)；
      <br/>
      AudioType：音频数据类型，包括G711A/G726；
      <br/>
      AudioData：音频数据，将音频数据通过Base64编码发送；
      <br/>
      Pts：音频时间戳，开始为0，每20ms增加20；
      <br/>
      Reserve:预留。
     </p>
    </blockquote>
    <pre class="prettyprint"><code class="hljs cs"><span class="hljs-comment">//云平台响应客户端请求</span>
{
    <span class="hljs-string">"EasyDarwin"</span>: {
        <span class="hljs-string">"Body"</span>: {
            <span class="hljs-string">"Channel"</span>: <span class="hljs-string">"0"</span>,
            <span class="hljs-string">"Protocol"</span>: <span class="hljs-string">"ONVIF"</span>,
            <span class="hljs-string">"Reserve"</span>: <span class="hljs-string">"1"</span>,
            <span class="hljs-string">"Serial"</span>: <span class="hljs-string">"001001000058"</span>
        },
        <span class="hljs-string">"Header"</span>: {
            <span class="hljs-string">"CSeq"</span>: <span class="hljs-string">"1"</span>,
            <span class="hljs-string">"ErrorNum"</span>: <span class="hljs-string">"200"</span>,
            <span class="hljs-string">"ErrorString"</span>: <span class="hljs-string">"Success OK"</span>,
            <span class="hljs-string">"MessageType"</span>: <span class="hljs-string">"MSG_SC_TALKBACK_CONTROL_ACK"</span>,
            <span class="hljs-string">"Version"</span>: <span class="hljs-string">"1.0"</span>
        }
    }
}</code></pre>
    <pre class="prettyprint"><code class="hljs cs"><span class="hljs-comment">//云平台向设备发送对讲命令</span>
{
   <span class="hljs-string">"EasyDarwin"</span>: {
      <span class="hljs-string">"Body"</span>: {
         <span class="hljs-string">"Channel"</span>: <span class="hljs-string">"0"</span>,
         <span class="hljs-string">"Command"</span>: <span class="hljs-string">"SENDDATA"</span>,
         <span class="hljs-string">"AudioType"</span>: <span class="hljs-string">"G711A"</span>,
         <span class="hljs-string">"AudioData"</span>: <span class="hljs-string">"BASE64DATA"</span>,
         <span class="hljs-string">"Pts"</span>: <span class="hljs-string">"20"</span>,
         <span class="hljs-string">"From"</span>: <span class="hljs-string">"f6a221eec46b47dea8ae1a2bd11f8d02"</span>,
         <span class="hljs-string">"Protocol"</span>: <span class="hljs-string">"ONVIF"</span>,
         <span class="hljs-string">"Reserve"</span>: <span class="hljs-string">"1"</span>,
         <span class="hljs-string">"Serial"</span>: <span class="hljs-string">"001001000058"</span>,
         <span class="hljs-string">"To"</span>: <span class="hljs-string">"245d6ec33cd247b7b7524219552db4d8"</span>,
         <span class="hljs-string">"Via"</span>: <span class="hljs-string">"27823d2e8b6b4032b453d435a16b7be8"</span>
      },
      <span class="hljs-string">"Header"</span>: {
         <span class="hljs-string">"CSeq"</span>: <span class="hljs-string">"1"</span>,
         <span class="hljs-string">"MessageType"</span>: <span class="hljs-string">"MSG_SD_CONTROL_TALKBACK_REQ"</span>,
         <span class="hljs-string">"Version"</span>: <span class="hljs-string">"1.0"</span>
      }
   }
}</code></pre>
    <blockquote>
     <p>
      格式说明：
      <br/>
      From: EasyCMS接收Client访问的SessionID；
      <br/>
      To: EasyCMS向Device发送报文的SessionID；
      <br/>
      Via: EasyCMS的ServiceID；
     </p>
    </blockquote>
    <pre class="prettyprint"><code class="hljs cs"><span class="hljs-comment">//设备向云平台响应对讲命令</span>
{
   <span class="hljs-string">"EasyDarwin"</span>: {
      <span class="hljs-string">"Body"</span>: {
         <span class="hljs-string">"Channel"</span>: <span class="hljs-string">"0"</span>,
         <span class="hljs-string">"From"</span>: <span class="hljs-string">"245d6ec33cd247b7b7524219552db4d8"</span>,
         <span class="hljs-string">"Protocol"</span>: <span class="hljs-string">"ONVIF"</span>,
         <span class="hljs-string">"Reserve"</span>: <span class="hljs-string">"1"</span>,
         <span class="hljs-string">"Serial"</span>: <span class="hljs-string">"001001000058"</span>,
         <span class="hljs-string">"To"</span>: <span class="hljs-string">"f6a221eec46b47dea8ae1a2bd11f8d02"</span>,
         <span class="hljs-string">"Via"</span>: <span class="hljs-string">"27823d2e8b6b4032b453d435a16b7be8"</span>
      },
      <span class="hljs-string">"Header"</span>: {
         <span class="hljs-string">"CSeq"</span>: <span class="hljs-string">"1"</span>,
         <span class="hljs-string">"ErrorNum"</span>: <span class="hljs-string">"200"</span>,
         <span class="hljs-string">"ErrorString"</span>: <span class="hljs-string">"Success OK"</span>,
         <span class="hljs-string">"MessageType"</span>: <span class="hljs-string">"MSG_DS_CONTROL_TALKBACK_ACK"</span>,
         <span class="hljs-string">"Version"</span>: <span class="hljs-string">"1.0"</span>
      }
   }
}</code></pre>
    <ul>
     <li>
      实现
     </li>
    </ul>
    <pre class="prettyprint"><code class="hljs cpp"><span class="hljs-comment">//EasyCMS HTTPSession.cpp execNetMsgCSTalkbackControlReq</span>
QTSS_Error HTTPSession::execNetMsgCSTalkbackControlReq(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* json)
{
    <span class="hljs-keyword">if</span> (!fAuthenticated)<span class="hljs-comment">//没有进行认证请求</span>
        <span class="hljs-keyword">return</span> httpUnAuthorized;

    EasyProtocol req(json);

    <span class="hljs-built_in">string</span> strDeviceSerial = req.GetBodyValue(EASY_TAG_SERIAL);
    <span class="hljs-built_in">string</span> strChannel = req.GetBodyValue(EASY_TAG_CHANNEL);
    <span class="hljs-built_in">string</span> strProtocol = req.GetBodyValue(EASY_TAG_PROTOCOL);
    <span class="hljs-built_in">string</span> strReserve = req.GetBodyValue(EASY_TAG_RESERVE);
    <span class="hljs-built_in">string</span> strCmd = req.GetBodyValue(EASY_TAG_CMD);
    <span class="hljs-built_in">string</span> strAudioType = req.GetBodyValue(EASY_TAG_AUDIO_TYPE);
    <span class="hljs-built_in">string</span> strAudioData = req.GetBodyValue(EASY_TAG_AUDIO_DATA);
    <span class="hljs-built_in">string</span> strPts = req.GetBodyValue(EASY_TAG_PTS);

    <span class="hljs-built_in">string</span> strCSeq = req.GetHeaderValue(EASY_TAG_CSEQ);<span class="hljs-comment">//这个是关键字</span>

    <span class="hljs-keyword">if</span> (strChannel.empty())
        strChannel = <span class="hljs-string">"0"</span>;
    <span class="hljs-keyword">if</span> (strReserve.empty())
        strReserve = <span class="hljs-string">"1"</span>;

    OSRefTableEx* deviceMap = QTSServerInterface::GetServer()-&gt;GetDeviceSessionMap();
    OSRefTableEx::OSRefEx* theDevRef = deviceMap-&gt;Resolve(strDeviceSerial);
    <span class="hljs-keyword">if</span> (theDevRef == NULL)<span class="hljs-comment">//找不到指定设备</span>
        <span class="hljs-keyword">return</span> EASY_ERROR_DEVICE_NOT_FOUND;

    OSRefReleaserEx releaser(deviceMap, strDeviceSerial);
    <span class="hljs-comment">//走到这说明存在指定设备</span>
    HTTPSession* pDevSession = <span class="hljs-keyword">static_cast</span>&lt;HTTPSession *&gt;(theDevRef-&gt;GetObjectPtr());<span class="hljs-comment">//获得当前设备回话</span>

    <span class="hljs-built_in">string</span> errNo, errString;
    <span class="hljs-keyword">if</span> (strCmd == <span class="hljs-string">"SENDDATA"</span>)
    {
        <span class="hljs-keyword">if</span> (!pDevSession-&gt;GetTalkbackSession().empty() &amp;&amp; pDevSession-&gt;GetTalkbackSession() == fSessionID)
        {
            EasyProtocolACK reqreq(MSG_SD_CONTROL_TALKBACK_REQ);
            EasyJsonValue headerheader, bodybody;

            <span class="hljs-keyword">char</span> chTemp[<span class="hljs-number">16</span>] = { <span class="hljs-number">0</span> };
            UInt32 uDevCseq = pDevSession-&gt;GetCSeq();
            <span class="hljs-built_in">sprintf</span>(chTemp, <span class="hljs-string">"%d"</span>, uDevCseq);
            headerheader[EASY_TAG_CSEQ] = <span class="hljs-built_in">string</span>(chTemp);<span class="hljs-comment">//注意这个地方不能直接将UINT32-&gt;int,因为会造成数据失真</span>
            headerheader[EASY_TAG_VERSION] = EASY_PROTOCOL_VERSION;

            bodybody[EASY_TAG_SERIAL] = strDeviceSerial;
            bodybody[EASY_TAG_CHANNEL] = strChannel;
            bodybody[EASY_TAG_PROTOCOL] = strProtocol;
            bodybody[EASY_TAG_RESERVE] = strReserve;
            bodybody[EASY_TAG_CMD] = strCmd;
            bodybody[EASY_TAG_AUDIO_TYPE] = strAudioType;
            bodybody[EASY_TAG_AUDIO_DATA] = strAudioData;
            bodybody[EASY_TAG_PTS] = strPts;
            bodybody[EASY_TAG_FROM] = fSessionID;
            bodybody[EASY_TAG_TO] = pDevSession-&gt;GetValue(EasyHTTPSessionID)-&gt;GetAsCString();
            bodybody[EASY_TAG_VIA] = QTSServerInterface::GetServer()-&gt;GetCloudServiceNodeID();

            reqreq.SetHead(headerheader);
            reqreq.SetBody(bodybody);

            <span class="hljs-built_in">string</span> buffer = reqreq.GetMsg();
            StrPtrLen theValue(<span class="hljs-keyword">const_cast</span>&lt;<span class="hljs-keyword">char</span>*&gt;(buffer.c_str()), buffer.size());
            pDevSession-&gt;SendHTTPPacket(&amp;theValue, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>);

            errNo = EASY_ERROR_SUCCESS_OK;
            errString = EasyProtocol::GetErrorString(EASY_ERROR_SUCCESS_OK);
        }
        <span class="hljs-keyword">else</span>
        {
            errNo = EASY_ERROR_CLIENT_BAD_REQUEST;
            errString = EasyProtocol::GetErrorString(EASY_ERROR_CLIENT_BAD_REQUEST);
            <span class="hljs-keyword">goto</span> ACK;
        }
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-keyword">if</span> (strCmd == <span class="hljs-string">"START"</span>)
        {
            <span class="hljs-keyword">if</span> (pDevSession-&gt;GetTalkbackSession().empty())
            {
                pDevSession-&gt;SetTalkbackSession(fSessionID);
                errNo = EASY_ERROR_SUCCESS_OK;
                errString = EasyProtocol::GetErrorString(EASY_ERROR_SUCCESS_OK);
            }
            <span class="hljs-keyword">else</span>
            {
                errNo = EASY_ERROR_CLIENT_BAD_REQUEST;
                errString = EasyProtocol::GetErrorString(EASY_ERROR_CLIENT_BAD_REQUEST);
                <span class="hljs-keyword">goto</span> ACK;
            }
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (strCmd == <span class="hljs-string">"STOP"</span>)
        {
            <span class="hljs-keyword">if</span> (pDevSession-&gt;GetTalkbackSession().empty() || pDevSession-&gt;GetTalkbackSession() != fSessionID)
            {
                errNo = EASY_ERROR_CLIENT_BAD_REQUEST;
                errString = EasyProtocol::GetErrorString(EASY_ERROR_CLIENT_BAD_REQUEST);
                <span class="hljs-keyword">goto</span> ACK;
            }
            <span class="hljs-keyword">else</span>
            {
                pDevSession-&gt;SetTalkbackSession(<span class="hljs-string">""</span>);
                errNo = EASY_ERROR_SUCCESS_OK;
                errString = EasyProtocol::GetErrorString(EASY_ERROR_SUCCESS_OK);
            }
        }


        EasyProtocolACK reqreq(MSG_SD_CONTROL_TALKBACK_REQ);
        EasyJsonValue headerheader, bodybody;

        <span class="hljs-keyword">char</span> chTemp[<span class="hljs-number">16</span>] = { <span class="hljs-number">0</span> };
        UInt32 uDevCseq = pDevSession-&gt;GetCSeq();
        <span class="hljs-built_in">sprintf</span>(chTemp, <span class="hljs-string">"%d"</span>, uDevCseq);
        headerheader[EASY_TAG_CSEQ] = <span class="hljs-built_in">string</span>(chTemp);<span class="hljs-comment">//注意这个地方不能直接将UINT32-&gt;int,因为会造成数据失真</span>
        headerheader[EASY_TAG_VERSION] = EASY_PROTOCOL_VERSION;

        bodybody[EASY_TAG_SERIAL] = strDeviceSerial;
        bodybody[EASY_TAG_CHANNEL] = strChannel;
        bodybody[EASY_TAG_PROTOCOL] = strProtocol;
        bodybody[EASY_TAG_RESERVE] = strReserve;
        bodybody[EASY_TAG_CMD] = strCmd;
        bodybody[EASY_TAG_AUDIO_TYPE] = strAudioType;
        bodybody[EASY_TAG_AUDIO_DATA] = strAudioData;
        bodybody[EASY_TAG_PTS] = strPts;
        bodybody[EASY_TAG_FROM] = fSessionID;
        bodybody[EASY_TAG_TO] = pDevSession-&gt;GetValue(EasyHTTPSessionID)-&gt;GetAsCString();
        bodybody[EASY_TAG_VIA] = QTSServerInterface::GetServer()-&gt;GetCloudServiceNodeID();

        reqreq.SetHead(headerheader);
        reqreq.SetBody(bodybody);

        <span class="hljs-built_in">string</span> buffer = reqreq.GetMsg();
        StrPtrLen theValue(<span class="hljs-keyword">const_cast</span>&lt;<span class="hljs-keyword">char</span>*&gt;(buffer.c_str()), buffer.size());
        pDevSession-&gt;SendHTTPPacket(&amp;theValue, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>);
    }

ACK:
    <span class="hljs-keyword">char</span> chTemp[<span class="hljs-number">16</span>] = { <span class="hljs-number">0</span> };
    UInt32 uDevCseq = pDevSession-&gt;GetCSeq();
    <span class="hljs-built_in">sprintf</span>(chTemp, <span class="hljs-string">"%d"</span>, uDevCseq);

    EasyProtocolACK rsp(MSG_SC_TALKBACK_CONTROL_ACK);
    EasyJsonValue header, body;
    body[EASY_TAG_SERIAL] = strDeviceSerial;
    body[EASY_TAG_CHANNEL] = strChannel;
    body[EASY_TAG_PROTOCOL] = strProtocol;
    body[EASY_TAG_RESERVE] = strReserve;

    header[EASY_TAG_VERSION] = EASY_PROTOCOL_VERSION;
    header[EASY_TAG_CSEQ] = <span class="hljs-built_in">string</span>(chTemp);;
    header[EASY_TAG_ERROR_NUM] = errNo;
    header[EASY_TAG_ERROR_STRING] = errString;

    rsp.SetHead(header);
    rsp.SetBody(body);
    <span class="hljs-built_in">string</span> msg = rsp.GetMsg();
    StrPtrLen theValueAck(<span class="hljs-keyword">const_cast</span>&lt;<span class="hljs-keyword">char</span>*&gt;(msg.c_str()), msg.size());
    <span class="hljs-keyword">this</span>-&gt;SendHTTPPacket(&amp;theValueAck, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>);

    <span class="hljs-keyword">return</span> QTSS_NoErr;
}</code></pre>
    <pre class="prettyprint"><code class="hljs lasso"><span class="hljs-comment">//EasyCamera EasyCameraSource.cpp ControlTalkback</span>
QTSS_Error EasyCameraSource<span class="hljs-tag">::ControlTalkback</span>(Easy_CameraTalkback_Params<span class="hljs-subst">*</span> <span class="hljs-keyword">params</span>)
{
    QTSS_Error result <span class="hljs-subst">=</span> QTSS_RequestFailed;

    <span class="hljs-keyword">if</span> (cameraLogin())
    {
        HI_S32 error <span class="hljs-subst">=</span> HI_SUCCESS;
        switch (<span class="hljs-keyword">params</span><span class="hljs-subst">-&gt;</span>inCommand)
        {
        <span class="hljs-keyword">case</span> EASY_TALKBACK_CMD_TYPE_START:
            {
                int <span class="hljs-keyword">type</span> <span class="hljs-subst">=</span> <span class="hljs-number">1</span>;
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">params</span><span class="hljs-subst">-&gt;</span>inType <span class="hljs-subst">==</span> EASY_TALKBACK_AUDIO_TYPE_G711A)
                    <span class="hljs-keyword">type</span> <span class="hljs-subst">=</span> <span class="hljs-number">1</span>;
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">params</span><span class="hljs-subst">-&gt;</span>inType <span class="hljs-subst">==</span> EASY_TALKBACK_AUDIO_TYPE_G726)
                    <span class="hljs-keyword">type</span> <span class="hljs-subst">=</span> <span class="hljs-number">4</span>;
                error <span class="hljs-subst">=</span> HI_NET_DEV_StartVoice(m_u32Handle, <span class="hljs-keyword">type</span>);
            }
            break;
        <span class="hljs-keyword">case</span> EASY_TALKBACK_CMD_TYPE_SENDDATA:
            {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">params</span><span class="hljs-subst">-&gt;</span>inBuff <span class="hljs-subst">==</span> <span class="hljs-built_in">NULL</span> <span class="hljs-subst">||</span> <span class="hljs-keyword">params</span><span class="hljs-subst">-&gt;</span>inBuffLen <span class="hljs-subst">==</span> <span class="hljs-number">0</span>)
                {
                    result <span class="hljs-subst">=</span> QTSS_BadArgument;
                    break;
                }
                int len <span class="hljs-subst">=</span> <span class="hljs-keyword">params</span><span class="hljs-subst">-&gt;</span>inBuffLen;
                int offset <span class="hljs-subst">=</span> <span class="hljs-number">0</span>;
                int pts <span class="hljs-subst">=</span> <span class="hljs-keyword">params</span><span class="hljs-subst">-&gt;</span>inPts;
                <span class="hljs-keyword">while</span> (len <span class="hljs-subst">&gt;=</span> BUFFLEN)
                {
                    AddHead(fTalkbackBuff, (char<span class="hljs-subst">*</span>)<span class="hljs-keyword">params</span><span class="hljs-subst">-&gt;</span>inBuff <span class="hljs-subst">+</span> offset, BUFFLEN);
                    error <span class="hljs-subst">=</span> HI_NET_DEV_SendVoiceData(m_u32Handle, fTalkbackBuff, HSBUFFLEN, pts);
                    offset <span class="hljs-subst">+=</span> BUFFLEN;
                    len <span class="hljs-subst">-=</span> BUFFLEN;
                    pts <span class="hljs-subst">+=</span> PTSPER;
                }
            }
            break;
        <span class="hljs-keyword">case</span> EASY_TALKBACK_CMD_TYPE_STOP:
            error <span class="hljs-subst">=</span> HI_NET_DEV_StopVoice(m_u32Handle);
            break;
        default:
            result <span class="hljs-subst">=</span> QTSS_RequestFailed;
            break;
        }

        <span class="hljs-keyword">if</span> (error <span class="hljs-subst">==</span> HI_SUCCESS)
        {
            result <span class="hljs-subst">=</span> QTSS_NoErr;
        }
        <span class="hljs-keyword">else</span>
        {
            result <span class="hljs-subst">=</span> QTSS_RequestFailed;
        }
    }

    <span class="hljs-keyword">return</span> result;
}</code></pre>
    <h3 id="代码与文档">
     代码与文档
    </h3>
    <p>
     EasyDarwin Github：
     <a href="https://github.com/easydarwin">
      https://github.com/easydarwin
     </a>
    </p>
    <p>
     EasyDarwin开源流媒体云平台协议文档：
     <a href="https://github.com/EasyDarwin/EasyDarwin/blob/master/Doc/EasyDarwin%20Protocol.pdf">
      https://github.com/EasyDarwin/EasyDarwin/blob/master/Doc/EasyDarwin%20Protocol.pdf
     </a>
    </p>
    <h3 id="获取更多信息">
     获取更多信息
    </h3>
    <p>
     邮件：
     <a href="mailto:support@easydarwin.org" rel="nofollow">
      support@easydarwin.org
     </a>
    </p>
    <p>
     WEB：
     <a href="http://www.easydarwin.org" rel="nofollow">
      www.EasyDarwin.org
     </a>
    </p>
    <p>
     QQ交流群：496258327
    </p>
    <p>
     Copyright © EasyDarwin.org 2012-2016
    </p>
    <p>
     <img alt="EasyDarwin" src="http://www.easydarwin.org/skin/easydarwin/images/wx_qrcode.jpg" title=""/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f7869656a6961736875:2f61727469636c652f64657461696c732f3532303137303535" class_="artid" style="display:none">
 </p>
</div>


