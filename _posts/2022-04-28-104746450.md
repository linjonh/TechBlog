---
layout: post
title: "海思Hi3559a音视频同时播放的例子"
date: 2022-04-28 20:24:02 +0800
description: "原文链接：海思Hi3559a音视频同时播放的例子在mpp/sample下新建av目录（1）编写Mak"
keywords: "海思音视频同步"
categories: ['音视频', 'Qt']
tags: ['无标签']
artid: "104746450"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=104746450
    alt: "海思Hi3559a音视频同时播放的例子"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     海思Hi3559a音视频同时播放的例子
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     原文链接：
     <a href="https://blog.csdn.net/dong_beijing/article/details/97112060">
      海思Hi3559a音视频同时播放的例子
     </a>
    </p>
    <p>
     在mpp/sample下新建av目录
    </p>
    <p>
     （1）编写Makefile，如下：
    </p>
    <h2>
     <a id="Hisilicon_Hi35xx_sample_Makefile_6">
     </a>
     Hisilicon Hi35xx sample Makefile
    </h2>
    <p>
     include …/Makefile.param
     <br/>
     SRCS := $(wildcard
     <em>
      .c)
      <br/>
      TARGET := $(SRCS:%.c=%)
      <br/>
      SRCS += $(wildcard $(PWD)/adp/
     </em>
     .c)
     <br/>
     #compile linux or HuaweiLite
     <br/>
     include
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        ( 
        
       
         P 
        
       
         W 
        
       
         D 
        
       
         ) 
        
       
         / 
        
       
         . 
        
       
         . 
        
       
         / 
        
       
      
        (PWD)/../
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mord mathdefault" style="margin-right: 0.13889em;">
          P
         </span>
         <span class="mord mathdefault" style="margin-right: 0.13889em;">
          W
         </span>
         <span class="mord mathdefault" style="margin-right: 0.02778em;">
          D
         </span>
         <span class="mclose">
          )
         </span>
         <span class="mord">
          /
         </span>
         <span class="mord">
          .
         </span>
         <span class="mord">
          .
         </span>
         <span class="mord">
          /
         </span>
        </span>
       </span>
      </span>
     </span>
     (OSTYPE).mak
     <br/>
     print:
     <br/>
     @echo “os is $(OSTYPE)”
     <br/>
     （2）把mpp/sample/audio的adp目录拷贝到新建的av目录下
    </p>
    <p>
     （3）编写sample_av.c文件，音视频同时播放的流程如下：
    </p>
    <p>
     #include &lt;stdio.h&gt;
     <br/>
     #include &lt;stdlib.h&gt;
     <br/>
     #include &lt;string.h&gt;
     <br/>
     #include &lt;sys/types.h&gt;
     <br/>
     #include &lt;sys/stat.h&gt;
     <br/>
     #include &lt;sys/ioctl.h&gt;
     <br/>
     #include &lt;sys/poll.h&gt;
     <br/>
     #include &lt;sys/time.h&gt;
     <br/>
     #include &lt;fcntl.h&gt;
     <br/>
     #include &lt;errno.h&gt;
     <br/>
     #include &lt;pthread.h&gt;
     <br/>
     #include &lt;math.h&gt;
     <br/>
     #include &lt;unistd.h&gt;
     <br/>
     #include &lt;signal.h&gt;
     <br/>
     #include &lt;sys/prctl.h&gt;
    </p>
    <p>
     #include “sample_comm.h”
     <br/>
     #include “acodec.h”
     <br/>
     #include “audio_aac_adp.h”
     <br/>
     HI_S32 main(int argc, char* argv[])
     <br/>
     {
     <!-- -->
     <br/>
     HI_S32 s32Ret = HI_SUCCESS;
     <br/>
     signal(SIGINT, SAMPLE_AUDIO_HandleSig);
     <br/>
     signal(SIGTERM, SAMPLE_AUDIO_HandleSig);
     <br/>
     s32Ret = SAMPLE_H265_VDEC_VPSS_VO();
     <br/>
     return s32Ret;
     <br/>
     }
     <br/>
     （4）在sample_av.c中，把sample_audio.c的下列函数拷贝过来
    </p>
    <p>
     SAMPLE_DBG
     <br/>
     SAMPLE_AUDIO_HandleSig
     <br/>
     SAMPLE_AUDIO_Pt2Str
     <br/>
     SAMPLE_AUDIO_OpenAdecFile
     <br/>
     SAMPLE_AUDIO_AdecAo
     <br/>
     （5）将音频播放流程整合为一个函数：
    </p>
    <p>
     HI_S32 SAMPLE_AUDIO_AdecAO_SetRun(HI_VOID)//dong add audio set and run.
     <br/>
     {
     <!-- -->
     <br/>
     HI_S32 s32Ret = HI_SUCCESS;
     <br/>
     HI_MPI_AENC_AacInit();
     <br/>
     HI_MPI_ADEC_AacInit();
     <br/>
     /* Set audio clksel, Non-required code. */
     <br/>
     AUDIO_MOD_PARAM_S stModParam;
     <br/>
     stModParam.enClkSel = AUDIO_CLKSEL_BASE;
     <br/>
     HI_MPI_AUDIO_SetModParam(&amp;stModParam);
     <br/>
     SAMPLE_AUDIO_AdecAo();
     <br/>
     return s32Ret;
     <br/>
     }
     <br/>
     (6)在sample_av.c中，把sample_vdec.c的下列函数拷贝过来
    </p>
    <p>
     SAMPLE_STREAM_PATH
     <br/>
     g_enIntfSync
     <br/>
     SAMPLE_H265_VDEC_VPSS_VO
     <br/>
     (7)将音频播放整合到视频播放函数中
    </p>
    <p>
     //SAMPLE_COMM_VDEC_CmdCtrl(u32VdecChnNum, &amp;stVdecSend[0], &amp;VdecThread[0]);
     <br/>
     SAMPLE_AUDIO_AdecAO_SetRun();
     <br/>
     //
     <br/>
     将之前的SAMPLE_COMM_VDEC_CmdCtrl函数注释掉，添加第5步编写的音频播放函数。
    </p>
    <p>
     （8）如果显示器的分辨率较低，在SAMPLE_H265_VDEC_VPSS_VO函数中可以修改为720P输出
    </p>
    <p>
     g_enIntfSync = VO_OUTPUT_720P60;
     <br/>
     if(VO_OUTPUT_3840x2160_30 == g_enIntfSync)
     <br/>
     {
     <!-- -->
     <br/>
     enDispPicSize = PIC_3840x2160;
     <br/>
     enIntfSync = VO_OUTPUT_3840x2160_30;
     <br/>
     }
     <br/>
     else
     <br/>
     {
     <!-- -->
     <br/>
     // enDispPicSize = PIC_1080P;
     <br/>
     // enIntfSync = VO_OUTPUT_1080P30;
     <br/>
     enDispPicSize = PIC_720P;
     <br/>
     enIntfSync = VO_OUTPUT_720P50;
     <br/>
     }
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34333234383132372f:61727469636c652f64657461696c732f313034373436343530" class_="artid" style="display:none">
 </p>
</div>


