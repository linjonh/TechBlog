---
layout: post
title: "基于EP3C40F780C8-FPGA-的出租车计价器"
date: 2025-01-04 15:15:02 +0800
description: "基于EP3C40F780C8 FPGA 的出租车计价器本次出租车计费系统设计最终具有以下功能：分辨率"
keywords: "verilog计程车计价方式代码"
categories: ['出租车计价器', 'Fpga']
tags: ['Verilog', 'Fpga']
artid: "117017359"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=117017359
    alt: "基于EP3C40F780C8-FPGA-的出租车计价器"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     基于EP3C40F780C8 FPGA 的出租车计价器
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="EP3C40F780C8_verilog_FPGA__2">
     </a>
     基于EP3C40F780C8 verilog语言 FPGA 的出租车计价器
    </h2>
    <blockquote>
     <p>
      本次出租车计费系统设计最终具有以下功能：
      <br/>
      分辨率为1s的误时系统，1km里程的路程模块，同时将费用通过计算显示在数码管上面可以实现，路程和时间同时计费，以及含有两个按键输入，用来判断车辆是否在行驶过程中，以及是否开始计费，计费模块每1km，往上加1.3元，每1.5min，往上加1.5元。同时，用户可以从数码管看到费用，里程等信息。数码管的前两位是里程信息，后两位是时间信息，最后四位显示的则是费用信息。费用信息是通过一个500hz的动态数码管显示的。
     </p>
    </blockquote>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#EP3C40F780C8_verilog_FPGA__2" rel="nofollow">
        基于EP3C40F780C8 verilog语言 FPGA 的出租车计价器
       </a>
      </li>
      <li>
       <a href="#_9" rel="nofollow">
        一、系统模块
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1_10" rel="nofollow">
          1.时钟分频模块
         </a>
        </li>
        <li>
         <a href="#2_38" rel="nofollow">
          2.时间模块
         </a>
        </li>
        <li>
         <a href="#3__89" rel="nofollow">
          3. 里程模块
         </a>
        </li>
        <li>
         <a href="#4_135" rel="nofollow">
          4.费用模块
         </a>
        </li>
        <li>
         <a href="#5_257" rel="nofollow">
          5.显示模块
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_313" rel="nofollow">
        二、顶层模块以及实测结果
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="_9">
     </a>
     一、系统模块
    </h2>
    <h3>
     <a id="1_10">
     </a>
     1.时钟分频模块
    </h3>
    <p>
     <font color="#999">
      代码如下（示例）：
     </font>
    </p>
    <pre><code class="prism language-c">module <span class="token function">div_clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span>fs<span class="token punctuation">,</span>clko<span class="token punctuation">)</span><span class="token punctuation">;</span>

input  				clk<span class="token punctuation">;</span>	<span class="token comment">//输入系统时钟频率clk=50M</span>
input	wire<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>	fs<span class="token punctuation">;</span>
output	reg			clko<span class="token punctuation">;</span>	<span class="token comment">//输出时钟clko </span>

parameter	N<span class="token operator">=</span><span class="token number">25</span>_000_000<span class="token punctuation">;</span>	<span class="token comment">//注意N取值是系统时钟的二分频</span>
reg<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>	Add<span class="token punctuation">;</span>

always@<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span> 
	begin 
		<span class="token keyword">if</span><span class="token punctuation">(</span>Add  <span class="token operator">&lt;</span> N<span class="token operator">/</span>fs<span class="token punctuation">)</span> 
			Add <span class="token operator">=</span> Add <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>		
		<span class="token keyword">else</span> 
			begin 		<span class="token comment">//满足累加器溢出条件</span>
				Add <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				clko <span class="token operator">=</span> <span class="token operator">!</span>clko<span class="token punctuation">;</span>	
			end
	end
	
endmodule				<span class="token comment">//这里的分频fs值为多少，则分多少频率,但是有范围1—25000000</span>
</code></pre>
    <h3>
     <a id="2_38">
     </a>
     2.时间模块
    </h3>
    <p>
     <font color="#999AAA">
      代码如下：
     </font>
    </p>
    <pre><code class="prism language-c">module timewait <span class="token punctuation">(</span>clk<span class="token punctuation">,</span>reset<span class="token punctuation">,</span>pluse_flag<span class="token punctuation">,</span>min<span class="token punctuation">,</span>time_enable<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//clk为1HZ脉冲60个脉冲为1分钟</span>

input clk<span class="token punctuation">;</span>
input reset<span class="token punctuation">;</span>
input pluse_flag<span class="token punctuation">;</span>
output <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> min<span class="token punctuation">;</span>	<span class="token comment">//输出的分</span>
output time_enable<span class="token punctuation">;</span><span class="token comment">//输出的控制计费的信号</span>

reg <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> min<span class="token punctuation">;</span>
reg <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>cnt<span class="token punctuation">;</span>

always@<span class="token punctuation">(</span>posedge clk or negedge reset<span class="token punctuation">)</span><span class="token comment">//异步复位</span>
	begin
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>reset<span class="token punctuation">)</span><span class="token comment">//低电平有效</span>
			begin<span class="token comment">//复位</span>
				min<span class="token operator">&lt;=</span><span class="token number">8</span>'H00<span class="token punctuation">;</span>
			end
		<span class="token keyword">else</span> <span class="token keyword">if</span>	<span class="token punctuation">(</span>pluse_flag <span class="token operator">==</span><span class="token number">1</span>'b1<span class="token punctuation">)</span>      
			begin
				<span class="token keyword">if</span><span class="token punctuation">(</span>cnt<span class="token operator">&gt;</span><span class="token number">8</span>'d59<span class="token punctuation">)</span><span class="token comment">//用于确定一分钟的分辨率 </span>
					begin 
						cnt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
							<span class="token keyword">if</span><span class="token punctuation">(</span>min<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">4</span>'B1001<span class="token punctuation">)</span><span class="token comment">//分的低四位是9</span>
								begin
									min<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token number">4</span>'B0000<span class="token punctuation">;</span><span class="token comment">//清零</span>
										<span class="token keyword">if</span><span class="token punctuation">(</span>min<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">4</span>'B0101<span class="token punctuation">)</span><span class="token comment">//分的高四位是5</span>
											min<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token number">4</span>'B0000<span class="token punctuation">;</span><span class="token comment">//清零</span>
										<span class="token keyword">else</span> 
											min<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span>min<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">4</span>'B0001<span class="token punctuation">;</span><span class="token comment">//分高四位非5加1</span>
								end
							<span class="token keyword">else</span> 
								min<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span>min<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">4</span>'B0001<span class="token punctuation">;</span><span class="token comment">//分的低四位不是9加一</span>
					end
				<span class="token keyword">else</span>
					begin
						cnt<span class="token operator">=</span>cnt<span class="token operator">+</span><span class="token number">1</span>'b1<span class="token punctuation">;</span> 
					end
			end
	end
			  
assign time_enable<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span>min<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">8</span><span class="token string">'b0000_0010)?1'</span>b1<span class="token punctuation">:</span><span class="token number">1</span>'b0<span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token comment">//标志位为1代表时间超过两分钟，开始计费</span>

endmodule
</code></pre>
    <blockquote>
     <p>
      由于出租车在行驶的过程中，会出现等候乘客、以及等候红绿灯的情况，这种情况仍然需要成本，按照设计要求超过两分钟，每分钟计费1.5元。clk为输入1hz信号，reset为复位按键，pluse_flag为选择等候时间计费信号，min为分的两个数据，time_enable是时间到达2分钟的标志。对于时间模块的操作则是每当来一个时钟脉冲，就开始判断pluse_flag是否为1，若为1则说明，系统开始停车，开始采用时间计费，同时，time_enable用来存储时间min是否超过2的标志位。
     </p>
    </blockquote>
    <h3>
     <a id="3__89">
     </a>
     3. 里程模块
    </h3>
    <p>
     <font color="#999AAA">
      代码如下：
     </font>
    </p>
    <pre><code class="prism language-c">module distance <span class="token punctuation">(</span>wheel<span class="token punctuation">,</span>start_flag<span class="token punctuation">,</span>reset<span class="token punctuation">,</span> distance_enable<span class="token punctuation">,</span>distance<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//端口的定义</span>

input wheel<span class="token punctuation">,</span>start_flag<span class="token punctuation">,</span>reset<span class="token punctuation">;</span>
output distance_enable<span class="token punctuation">;</span>
output <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>distance<span class="token punctuation">;</span>

reg <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>distance<span class="token punctuation">;</span>
reg <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>cnt<span class="token punctuation">;</span> 

always @<span class="token punctuation">(</span> posedge wheel or negedge reset<span class="token punctuation">)</span><span class="token comment">//车轮脉冲和异步复位配合按键决定是否开始计算里程</span>
	begin
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>reset<span class="token punctuation">)</span><span class="token comment">//低电平复位</span>
			begin
				distance<span class="token operator">&lt;=</span><span class="token number">8</span>'H00<span class="token punctuation">;</span>
			end
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>start_flag<span class="token operator">==</span><span class="token number">1</span>'b1<span class="token punctuation">)</span>
			begin 
				<span class="token keyword">if</span><span class="token punctuation">(</span>cnt<span class="token operator">&gt;</span><span class="token number">9</span>'d500<span class="token punctuation">)</span><span class="token comment">//用于确定distance分辨率 </span>
					begin 
						cnt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
							<span class="token keyword">if</span><span class="token punctuation">(</span>distance<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">4</span>'B1001<span class="token punctuation">)</span><span class="token comment">//判断distance的低四位计到了9没有</span>
								begin
									distance<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token number">4</span>'B0000<span class="token punctuation">;</span><span class="token comment">//计到9清零</span>
										<span class="token keyword">if</span><span class="token punctuation">(</span>distance<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">4</span>'B1001<span class="token punctuation">)</span><span class="token comment">//判断distance的高四位计到了9没有</span>
											distance<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token number">4</span>'B0000<span class="token punctuation">;</span><span class="token comment">//计到9清零</span>
										<span class="token keyword">else</span>  
											distance<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span> distance<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">4</span>'B0001<span class="token punctuation">;</span><span class="token comment">//distance的高四位没有计到9的时候加一</span>
								end   
							<span class="token keyword">else</span> 
									distance<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span>distance<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">4</span>'B0001<span class="token punctuation">;</span><span class="token comment">//distance的低四位没有计到9的时候加一</span>
					end				 
				<span class="token keyword">else</span>
					begin 
						cnt<span class="token operator">=</span>cnt<span class="token operator">+</span><span class="token number">1</span>'b1<span class="token punctuation">;</span> 
					end
			end         
	end   
 
assign distance_enable<span class="token operator">=</span><span class="token punctuation">(</span> distance <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">8</span><span class="token string">'b0000_0011)?1'</span>b1<span class="token punctuation">:</span><span class="token number">1</span>'b0<span class="token punctuation">;</span><span class="token comment">//标志位为1代表里程超过三公里，开始按照第二种方案计费    </span>
	
endmodule
</code></pre>
    <blockquote>
     <p>
      由于硬件实物的板子内存有限，乘除运算会占用大量内存，因此本设计假设车轮20m给一个脉冲信号wheel,于是500个脉冲是1km，在3km之内是起步价，当公里数超过3km之后，按照1km收取1.3元的计算。本模块中cnt在1hz的触发下计数，1hz加一次，当加满500次时，distance加1，实现行程加1km，行程超过3km以上，1km收取1.3元。wheel为车轮脉冲信号，start_flag是开始整体计费模块，reset为复位， distance是输出的行程，distance_enable是三公里到达的标志。
     </p>
    </blockquote>
    <h3>
     <a id="4_135">
     </a>
     4.费用模块
    </h3>
    <p>
     费用模块在本次设计中其实是分为三个模块的，首先介绍的是时间费用模块：时间费用模块便是根据时间模块的输出量time_enable和clk脉冲信号进行计算的，先由系统判断是否是误时计费状态，如果是，那就对feepay_time进行自加15操作，来对应实际操作中的每分钟15元。时间费用模块框图如u5所示，与时间费用模块类似的是里程费用模块，里程模块框图如u4所示：
     <img alt="-图" src="https://i-blog.csdnimg.cn/blog_migrate/6a2e43675d5c7caf295a05c343ac4c39.png#pic_center">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9181ebbd1d6cb3fafbeee3e64cd7aab7.png#pic_center">
       <br/>
       <font color="#999AAA">
        代码如下：
       </font>
      </img>
     </img>
    </p>
    <pre><code class="prism language-c">module feepay_time <span class="token punctuation">(</span> reset<span class="token punctuation">,</span>fee_time<span class="token punctuation">,</span> clk<span class="token punctuation">,</span>pluse_flag<span class="token punctuation">,</span> time_enable<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//时间计费模块1hz脉冲，60个为一分钟</span>
input reset<span class="token punctuation">;</span>
input clk<span class="token punctuation">;</span>
input time_enable<span class="token punctuation">;</span>
input pluse_flag<span class="token punctuation">;</span>
output<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fee_time<span class="token punctuation">;</span> 
reg <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fee_time<span class="token punctuation">;</span>
reg <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cnt<span class="token punctuation">;</span>

always@<span class="token punctuation">(</span>posedge clk or negedge reset<span class="token punctuation">)</span>
	begin
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>reset<span class="token punctuation">)</span>
			fee_time<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cnt <span class="token operator">&gt;=</span> <span class="token number">60</span><span class="token punctuation">)</span> 
			begin 
				cnt<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span> time_enable<span class="token operator">&gt;=</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> pluse_flag <span class="token punctuation">)</span>
						begin
							<span class="token keyword">if</span><span class="token punctuation">(</span> fee_time<span class="token operator">&gt;=</span><span class="token number">9999</span> <span class="token punctuation">)</span>
								begin
									fee_time<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">;</span>
								end
							<span class="token keyword">else</span>
								fee_time<span class="token operator">&lt;=</span>fee_time<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">;</span>
						end
					<span class="token keyword">else</span> 
						fee_time<span class="token operator">&lt;=</span>fee_time<span class="token punctuation">;</span>
			end
				<span class="token keyword">else</span>
					cnt<span class="token operator">=</span>cnt<span class="token operator">+</span><span class="token number">1</span>'b1<span class="token punctuation">;</span>
end

endmodule <span class="token comment">//结束时间计费模块</span>

<span class="token comment">///</span>
module feepay <span class="token punctuation">(</span> reset<span class="token punctuation">,</span>fee<span class="token punctuation">,</span> wheel<span class="token punctuation">,</span> distance_enable<span class="token punctuation">,</span>pluse_flag<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//里程费用模块</span>
input reset<span class="token punctuation">;</span>
input wheel<span class="token punctuation">;</span>
input distance_enable<span class="token punctuation">;</span>
input pluse_flag<span class="token punctuation">;</span>
output<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fee<span class="token punctuation">;</span> 
reg <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fee<span class="token punctuation">;</span>
reg <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cnt<span class="token punctuation">;</span>

always@<span class="token punctuation">(</span>posedge wheel or negedge reset<span class="token punctuation">)</span>
	begin
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>reset<span class="token punctuation">)</span>
			fee<span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cnt <span class="token operator">&gt;=</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token comment">//38</span>
			begin 
				cnt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span> distance_enable<span class="token operator">==</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> pluse_flag <span class="token operator">==</span><span class="token number">0</span> <span class="token punctuation">)</span>
						begin
							<span class="token keyword">if</span> <span class="token punctuation">(</span> fee <span class="token operator">&gt;=</span> <span class="token number">9999</span> <span class="token punctuation">)</span>
								begin
									fee <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
								end
							<span class="token keyword">else</span>
								fee<span class="token operator">&lt;=</span>fee<span class="token operator">+</span><span class="token number">13</span><span class="token punctuation">;</span>
						end
					<span class="token keyword">else</span> 
						fee<span class="token operator">&lt;=</span> fee<span class="token punctuation">;</span>
			 end
				<span class="token keyword">else</span>
					cnt<span class="token operator">=</span>cnt<span class="token operator">+</span><span class="token number">1</span>'b1<span class="token punctuation">;</span>
	end

endmodule <span class="token comment">//里程费用模块结束</span>
<span class="token comment">/</span>

module <span class="token function">fee</span><span class="token punctuation">(</span>start_flag<span class="token punctuation">,</span>clk<span class="token punctuation">,</span> reset<span class="token punctuation">,</span>fee<span class="token punctuation">,</span>fee_time<span class="token punctuation">,</span>fee_a<span class="token punctuation">,</span>fee_b<span class="token punctuation">,</span>fee_c<span class="token punctuation">,</span>fee_d<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//整体费用模块端口的定义</span>

input clk<span class="token punctuation">,</span>reset<span class="token punctuation">,</span>start_flag<span class="token punctuation">;</span>
input <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>fee<span class="token punctuation">;</span>
input <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>fee_time<span class="token punctuation">;</span>

output <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>fee_a<span class="token punctuation">;</span>
output <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>fee_b<span class="token punctuation">;</span>
output <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>fee_c<span class="token punctuation">;</span>
output <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>fee_d<span class="token punctuation">;</span>
reg<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fee_a<span class="token punctuation">;</span>
reg<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fee_b<span class="token punctuation">;</span>
reg<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fee_c<span class="token punctuation">;</span>
reg<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fee_d<span class="token punctuation">;</span>

reg<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fee_deal<span class="token punctuation">;</span>

always@<span class="token punctuation">(</span>posedge clk or negedge reset<span class="token punctuation">)</span> 
	begin 
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>reset<span class="token punctuation">)</span>
			begin
				fee_a<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
				fee_b<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
				fee_c<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
				fee_d<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
			end
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>start_flag<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span> 
			begin
				fee_deal<span class="token operator">=</span>fee<span class="token operator">+</span>fee_time<span class="token operator">+</span><span class="token number">50</span><span class="token punctuation">;</span>
				fee_a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>fee_deal<span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">;</span>
				fee_b<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>fee_deal<span class="token operator">-</span><span class="token number">1000</span><span class="token operator">*</span>fee_a<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">;</span>
				fee_c<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>fee_deal<span class="token operator">-</span><span class="token number">1000</span><span class="token operator">*</span>fee_a<span class="token operator">-</span><span class="token number">100</span><span class="token operator">*</span>fee_b<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">;</span>
				fee_d<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>fee_deal<span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
			end
				<span class="token keyword">else</span> 
					begin 
						fee_a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span> fee_a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
						fee_b<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span> fee_b<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
						fee_c<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span> fee_c<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
						fee_d<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span> fee_d<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
					end
	end
endmodule
</code></pre>
    <h3>
     <a id="5_257">
     </a>
     5.显示模块
    </h3>
    <p>
     <font color="#999AAA">
      代码如下：
     </font>
    </p>
    <pre><code class="prism language-c">module  <span class="token function">scan_led</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span>DA<span class="token punctuation">,</span>DB<span class="token punctuation">,</span>DC<span class="token punctuation">,</span>DD<span class="token punctuation">,</span>DE<span class="token punctuation">,</span>DF<span class="token punctuation">,</span>DG<span class="token punctuation">,</span>DH<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>e<span class="token punctuation">,</span>f<span class="token punctuation">,</span>g<span class="token punctuation">,</span>p<span class="token punctuation">,</span>scan<span class="token punctuation">)</span><span class="token punctuation">;</span>  
input	clk<span class="token punctuation">;</span><span class="token comment">//数码管扫描时钟 共阴极</span>
input	<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>	DA<span class="token punctuation">,</span>DB<span class="token punctuation">,</span>DC<span class="token punctuation">,</span>DD<span class="token punctuation">,</span>DE<span class="token punctuation">,</span>DF<span class="token punctuation">,</span>DG<span class="token punctuation">,</span>DH<span class="token punctuation">;</span>
output	a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>e<span class="token punctuation">,</span>f<span class="token punctuation">,</span>g<span class="token punctuation">,</span>p<span class="token punctuation">;</span>
output	reg<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>	scan<span class="token punctuation">;</span>

reg <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>sel<span class="token punctuation">;</span>
reg <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>num<span class="token punctuation">;</span>

always@<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span>
	begin
	scan<span class="token operator">&lt;=</span>scan<span class="token operator">+</span><span class="token number">1</span>'b1<span class="token punctuation">;</span>
	<span class="token keyword">case</span><span class="token punctuation">(</span>scan<span class="token punctuation">)</span> <span class="token comment">//3-8译码器 和 数据选择器</span>
		<span class="token number">0</span><span class="token punctuation">:</span> begin  num<span class="token operator">=</span>DB<span class="token punctuation">;</span> end
		<span class="token number">1</span><span class="token punctuation">:</span> begin  num<span class="token operator">=</span>DC<span class="token punctuation">;</span> end
		<span class="token number">2</span><span class="token punctuation">:</span> begin  num<span class="token operator">=</span>DD<span class="token punctuation">;</span> end
		<span class="token number">3</span><span class="token punctuation">:</span> begin  num<span class="token operator">=</span>DE<span class="token punctuation">;</span> end
		<span class="token number">4</span><span class="token punctuation">:</span> begin  num<span class="token operator">=</span>DF<span class="token punctuation">;</span> end
		<span class="token number">5</span><span class="token punctuation">:</span> begin  num<span class="token operator">=</span>DG<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">;</span> end<span class="token comment">//要加小数点位</span>
		<span class="token number">6</span><span class="token punctuation">:</span> begin  num<span class="token operator">=</span>DH<span class="token punctuation">;</span> end
		<span class="token number">7</span><span class="token punctuation">:</span> begin  num<span class="token operator">=</span>DA<span class="token punctuation">;</span> end
	endcase
	end

assign  <span class="token punctuation">{<!-- --></span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>e<span class="token punctuation">,</span>f<span class="token punctuation">,</span>g<span class="token punctuation">,</span>p<span class="token punctuation">}</span> <span class="token operator">=</span>	<span class="token comment">//字符译码器</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span>  <span class="token number">8</span>'b11111100<span class="token punctuation">:</span>		<span class="token comment">//"0"</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span>  <span class="token number">8</span>'b01100000<span class="token punctuation">:</span>		<span class="token comment">//"1"</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span>  <span class="token number">8</span>'b11011010<span class="token punctuation">:</span>		<span class="token comment">//"2"</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span>  <span class="token number">8</span>'b11110010<span class="token punctuation">:</span>		<span class="token comment">//"3"</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span>  <span class="token number">8</span>'b01100110<span class="token punctuation">:</span>		<span class="token comment">//"4"</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span>  <span class="token number">8</span>'b10110110<span class="token punctuation">:</span>		<span class="token comment">//"5"</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span>  <span class="token number">8</span>'b10111110<span class="token punctuation">:</span>		<span class="token comment">//"6"</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span>  <span class="token number">8</span>'b11100000<span class="token punctuation">:</span>		<span class="token comment">//"7"</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span>  <span class="token number">8</span>'b11111110<span class="token punctuation">:</span>		<span class="token comment">//"8"</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span>  <span class="token number">8</span>'b11110110<span class="token punctuation">:</span>		<span class="token comment">//"9"</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token number">8</span>'b11111101<span class="token punctuation">:</span>		<span class="token comment">//"0."</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token number">8</span>'b01100001<span class="token punctuation">:</span>		<span class="token comment">//"1."</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token number">8</span>'b11011011<span class="token punctuation">:</span>		<span class="token comment">//"2."</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token number">8</span>'b11110011<span class="token punctuation">:</span>		<span class="token comment">//"3."</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token number">8</span>'b01100111<span class="token punctuation">:</span>		<span class="token comment">//"4."</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token operator">?</span>  <span class="token number">8</span>'b10110111<span class="token punctuation">:</span>		<span class="token comment">//"5."</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">?</span>  <span class="token number">8</span>'b10111111<span class="token punctuation">:</span>		<span class="token comment">//"6."</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token operator">?</span>  <span class="token number">8</span>'b11100001<span class="token punctuation">:</span>		<span class="token comment">//"7."</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token operator">?</span>  <span class="token number">8</span>'b11111111<span class="token punctuation">:</span>		<span class="token comment">//"8."</span>
	<span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token operator">?</span>  <span class="token number">8</span>'b11110111<span class="token punctuation">:</span>		<span class="token comment">//"9."</span>
	<span class="token number">8</span>'b00000000<span class="token punctuation">;</span>		<span class="token comment">//"-";	</span>

endmodule
</code></pre>
    <blockquote>
     <p>
      显示方面，由于测试的开发板内部集成有3-8译码器，所以在输出的时候只写了一个三位的scan。
     </p>
    </blockquote>
    <h2>
     <a id="_313">
     </a>
     二、顶层模块以及实测结果
    </h2>
    <p>
     <font color="#999AAA">
      顶层模块代码如下所示：
     </font>
    </p>
    <pre><code class="prism language-c">module <span class="token function">top</span><span class="token punctuation">(</span>clk_50M<span class="token punctuation">,</span> reset<span class="token punctuation">,</span>start_flag<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>e<span class="token punctuation">,</span>f<span class="token punctuation">,</span>g<span class="token punctuation">,</span>p<span class="token punctuation">,</span>scan<span class="token punctuation">,</span>wheel<span class="token punctuation">,</span>pluse_flag<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 端口的定义</span>

input clk_50M<span class="token punctuation">,</span>reset<span class="token punctuation">,</span>start_flag<span class="token punctuation">,</span>pluse_flag<span class="token punctuation">,</span>wheel<span class="token punctuation">;</span><span class="token comment">//总的时钟信号,复位信号,开始信号,等待信号</span>
output <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> scan<span class="token punctuation">;</span><span class="token comment">//数码管的输出</span>
output a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>e<span class="token punctuation">,</span>f<span class="token punctuation">,</span>g<span class="token punctuation">,</span>p<span class="token punctuation">;</span>

wire <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>distance<span class="token punctuation">;</span><span class="token comment">//公里</span>
wire <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> min<span class="token punctuation">;</span><span class="token comment">//分</span>

wire <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fee<span class="token punctuation">;</span>
wire <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fee_time<span class="token punctuation">;</span>
wire <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fee_a<span class="token punctuation">;</span>
wire <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fee_b<span class="token punctuation">;</span>
wire <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fee_c<span class="token punctuation">;</span>
wire <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fee_d<span class="token punctuation">;</span>

wire distance_enable<span class="token punctuation">;</span>    <span class="token comment">//公里控制费用的信号</span>
wire time_enable<span class="token punctuation">;</span>        <span class="token comment">//时间控制费用的信号</span>
wire time_hz<span class="token punctuation">,</span>led_hz<span class="token punctuation">;</span>
wire DA<span class="token punctuation">,</span>DB<span class="token punctuation">,</span>DC<span class="token punctuation">,</span>DD<span class="token punctuation">,</span>DE<span class="token punctuation">,</span>DF<span class="token punctuation">,</span>DG<span class="token punctuation">,</span>DH<span class="token punctuation">;</span>

div_clk     <span class="token function">u0</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk_50M<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">fs</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">clko</span><span class="token punctuation">(</span>time_hz<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//调用计数分频模块 1Hz</span>
div_clk     <span class="token function">u1</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk_50M<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">fs</span><span class="token punctuation">(</span><span class="token number">350</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">clko</span><span class="token punctuation">(</span>led_hz<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//调用数码管分频模块 350Hz</span>

distance	   <span class="token function">u2</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">wheel</span><span class="token punctuation">(</span>wheel<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">start_flag</span><span class="token punctuation">(</span>start_flag<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">distance_enable</span><span class="token punctuation">(</span>distance_enable<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">distance</span><span class="token punctuation">(</span>distance<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//调用里程模块</span>
				   
timewait    <span class="token function">u3</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>time_hz<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">pluse_flag</span><span class="token punctuation">(</span>pluse_flag<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>min<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">time_enable</span><span class="token punctuation">(</span>time_enable<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//调用计时模块</span>

feepay     <span class="token function">u4</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">fee</span><span class="token punctuation">(</span>fee<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">wheel</span><span class="token punctuation">(</span>wheel<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">distance_enable</span><span class="token punctuation">(</span>distance_enable<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">pluse_flag</span><span class="token punctuation">(</span>pluse_flag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

feepay_time <span class="token function">u5</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">fee_time</span><span class="token punctuation">(</span>fee_time<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">pluse_flag</span><span class="token punctuation">(</span>pluse_flag<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>time_hz<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">time_enable</span><span class="token punctuation">(</span>time_enable<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				   
fee        <span class="token function">u6</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">start_flag</span><span class="token punctuation">(</span>start_flag<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk_50M<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">fee</span><span class="token punctuation">(</span>fee<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">fee_time</span><span class="token punctuation">(</span>fee_time<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">fee_a</span><span class="token punctuation">(</span>fee_a<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">fee_b</span><span class="token punctuation">(</span>fee_b<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">fee_c</span><span class="token punctuation">(</span>fee_c<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">fee_d</span><span class="token punctuation">(</span>fee_d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				   
scan_led    u7
<span class="token punctuation">(</span>
	<span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>led_hz<span class="token punctuation">)</span><span class="token punctuation">,</span>  
	<span class="token punctuation">.</span><span class="token function">DA</span><span class="token punctuation">(</span>distance<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">.</span><span class="token function">DB</span><span class="token punctuation">(</span>distance<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">.</span><span class="token function">DC</span><span class="token punctuation">(</span>min<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">DD</span><span class="token punctuation">(</span>min<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">DE</span><span class="token punctuation">(</span>fee_a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">DF</span><span class="token punctuation">(</span>fee_b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">DG</span><span class="token punctuation">(</span>fee_c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">DH</span><span class="token punctuation">(</span>fee_d<span class="token punctuation">)</span><span class="token punctuation">,</span> 
	<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">c</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">g</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">p</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span>scan<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>  

endmodule
</code></pre>
    <blockquote>
     <p>
      顶层模块主要是对系统模块的调用
     </p>
    </blockquote>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/23da6940595195fcb72047ae2b63da79.png#pic_center">
      <br/>
      上图是整体的RTL级原理图
      <br/>
      下图在实测结果中总费用是5+3
      <em>
       1.3+6
      </em>
      1.5=17.9元，所以实验结果也符合预期。
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5e732135cfa26076d121890a57ffc1b0.png#pic_center"/>
     </img>
    </p>
    <p>
     <font color="#999AAA">
      主要参考文献
      <br/>
      (1)谭会生、瞿遂春，《EDA技术综合应用实例与分析》，西安电子科技大学出版社，2004
      <br/>
      (2)曹昕燕、周凤臣等，《EDA技术实验与课程设计》，清华大学出版社，2006
     </font>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f72656e6c656e692f:61727469636c652f64657461696c732f313137303137333539" class_="artid" style="display:none">
 </p>
</div>


