---
layout: post
title: 2021-08-14-俄罗斯方块C语言实现
date: 2021-08-14 17:23:26 +0800
categories: [C语言,项目]
tags: [游戏程序,c语言]
image:
  path: https://img-blog.csdnimg.cn/f3620a119f9e4ce6a758bb19be523e26.gif#pic_center?x-oss-process=image/resize,m_fixed,h_150
  alt: 俄罗斯方块C语言实现
artid: 119680671
render_with_liquid: false
---
<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     俄罗斯方块（C语言实现）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-github-gist" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#_1" rel="nofollow">
        游戏说明
       </a>
      </li>
      <li>
       <a href="#_11" rel="nofollow">
        游戏效果展示
       </a>
      </li>
      <li>
       <a href="#_13" rel="nofollow">
        游戏代码
       </a>
      </li>
      <li>
       <a href="#_534" rel="nofollow">
        游戏代码详解
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_535" rel="nofollow">
          游戏框架构建
         </a>
        </li>
        <li>
         <a href="#_571" rel="nofollow">
          隐藏光标
         </a>
        </li>
        <li>
         <a href="#_588" rel="nofollow">
          光标跳转
         </a>
        </li>
        <li>
         <a href="#_605" rel="nofollow">
          初始化界面
         </a>
        </li>
        <li>
         <a href="#_676" rel="nofollow">
          初始化方块信息
         </a>
        </li>
        <li>
         <a href="#_746" rel="nofollow">
          颜色设置
         </a>
        </li>
        <li>
         <a href="#_782" rel="nofollow">
          画出方块
         </a>
        </li>
        <li>
         <a href="#_803" rel="nofollow">
          空格覆盖
         </a>
        </li>
        <li>
         <a href="#_824" rel="nofollow">
          合法性判断
         </a>
        </li>
        <li>
         <a href="#_844" rel="nofollow">
          判断得分与结束
         </a>
        </li>
        <li>
         <a href="#_955" rel="nofollow">
          游戏主体逻辑函数
         </a>
        </li>
        <li>
         <a href="#_1075" rel="nofollow">
          从文件读取最高分
         </a>
        </li>
        <li>
         <a href="#_1093" rel="nofollow">
          更新最高分到文件
         </a>
        </li>
        <li>
         <a href="#_1110" rel="nofollow">
          主函数
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="_1">
     </a>
     游戏说明
    </h2>
    <p>
     俄罗斯方块相信大家都知道，这里就不再介绍什么游戏背景了，我这里对本代码实现的俄罗斯方块作一些
     <strong>
      说明
     </strong>
     ：
    </p>
    <ol>
     <li>
      按方向键的左右键可实现方块的左右移动。
     </li>
     <li>
      按方向键的下键可实现方块的加速下落。
     </li>
     <li>
      按空格键可实现方块的顺时针旋转。
     </li>
     <li>
      按Esc键可退出游戏。
     </li>
     <li>
      按S键可暂停游戏，暂停游戏后按任意键继续游戏。
     </li>
     <li>
      按R键可重新开始游戏。
     </li>
    </ol>
    <p>
     除此之外，本游戏还拥有计分系统，可保存玩家的历史最高记录。
    </p>
    <h2>
     <a id="_11">
     </a>
     游戏效果展示
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d8ca9e4c911a07a42de9d7d8dd663ae0.gif#pic_center"/>
    </p>
    <h2>
     <a id="_13">
     </a>
     游戏代码
    </h2>
    <p>
     博友们可以将以下代码复制到自己的编译器当中运行：
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;conio.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ROW</span> <span class="token expression"><span class="token number">29</span> </span><span class="token comment">//游戏区行数</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COL</span> <span class="token expression"><span class="token number">20</span> </span><span class="token comment">//游戏区列数</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DOWN</span> <span class="token expression"><span class="token number">80</span> </span><span class="token comment">//方向键：下</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LEFT</span> <span class="token expression"><span class="token number">75</span> </span><span class="token comment">//方向键：左</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">RIGHT</span> <span class="token expression"><span class="token number">77</span> </span><span class="token comment">//方向键：右</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SPACE</span> <span class="token expression"><span class="token number">32</span> </span><span class="token comment">//空格键</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ESC</span> <span class="token expression"><span class="token number">27</span> </span><span class="token comment">//Esc键</span></span>

<span class="token keyword">struct</span> <span class="token class-name">Face</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> data<span class="token punctuation">[</span>ROW<span class="token punctuation">]</span><span class="token punctuation">[</span>COL <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//用于标记指定位置是否有方块（1为有，0为无）</span>
	<span class="token keyword">int</span> color<span class="token punctuation">[</span>ROW<span class="token punctuation">]</span><span class="token punctuation">[</span>COL <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//用于记录指定位置的方块颜色编码</span>
<span class="token punctuation">}</span>face<span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">Block</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> space<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>block<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//用于存储7种基本形状方块的各自的4种形态的信息，共28种</span>

<span class="token comment">//隐藏光标</span>
<span class="token keyword">void</span> <span class="token function">HideCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//光标跳转</span>
<span class="token keyword">void</span> <span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//初始化界面</span>
<span class="token keyword">void</span> <span class="token function">InitInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//初始化方块信息</span>
<span class="token keyword">void</span> <span class="token function">InitBlockInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//颜色设置</span>
<span class="token keyword">void</span> <span class="token function">color</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//画出方块</span>
<span class="token keyword">void</span> <span class="token function">DrawBlock</span><span class="token punctuation">(</span><span class="token keyword">int</span> shape<span class="token punctuation">,</span> <span class="token keyword">int</span> form<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//空格覆盖</span>
<span class="token keyword">void</span> <span class="token function">DrawSpace</span><span class="token punctuation">(</span><span class="token keyword">int</span> shape<span class="token punctuation">,</span> <span class="token keyword">int</span> form<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//合法性判断</span>
<span class="token keyword">int</span> <span class="token function">IsLegal</span><span class="token punctuation">(</span><span class="token keyword">int</span> shape<span class="token punctuation">,</span> <span class="token keyword">int</span> form<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//判断得分与结束</span>
<span class="token keyword">int</span> <span class="token function">JudeFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//游戏主体逻辑函数</span>
<span class="token keyword">void</span> <span class="token function">StartGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//从文件读取最高分</span>
<span class="token keyword">void</span> <span class="token function">ReadGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//更新最高分到文件</span>
<span class="token keyword">void</span> <span class="token function">WriteGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> max<span class="token punctuation">,</span> grade<span class="token punctuation">;</span> <span class="token comment">//全局变量</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">warning</span> <span class="token punctuation">(</span>disable<span class="token operator">:</span><span class="token number">4996</span><span class="token punctuation">)</span> </span><span class="token comment">//消除警告</span></span>
	max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> grade <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//初始化变量</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"title 俄罗斯方块"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置cmd窗口的名字</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"mode con lines=29 cols=60"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置cmd窗口的大小</span>
	<span class="token function">HideCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//隐藏光标</span>
	<span class="token function">ReadGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//从文件读取最高分到max变量	</span>
	<span class="token function">InitInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始化界面</span>
	<span class="token function">InitBlockInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始化方块信息</span>
	<span class="token function">srand</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置随机数生成的起点</span>
	<span class="token function">StartGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//开始游戏</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//隐藏光标</span>
<span class="token keyword">void</span> <span class="token function">HideCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	CONSOLE_CURSOR_INFO curInfo<span class="token punctuation">;</span> <span class="token comment">//定义光标信息的结构体变量</span>
	curInfo<span class="token punctuation">.</span>dwSize <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//如果没赋值的话，隐藏光标无效</span>
	curInfo<span class="token punctuation">.</span>bVisible <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token comment">//将光标设置为不可见</span>
	HANDLE handle <span class="token operator">=</span> <span class="token function">GetStdHandle</span><span class="token punctuation">(</span>STD_OUTPUT_HANDLE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取控制台句柄</span>
	<span class="token function">SetConsoleCursorInfo</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token operator">&amp;</span>curInfo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置光标信息</span>
<span class="token punctuation">}</span>
<span class="token comment">//光标跳转</span>
<span class="token keyword">void</span> <span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	COORD pos<span class="token punctuation">;</span> <span class="token comment">//定义光标位置的结构体变量</span>
	pos<span class="token punctuation">.</span>X <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token comment">//横坐标设置</span>
	pos<span class="token punctuation">.</span>Y <span class="token operator">=</span> y<span class="token punctuation">;</span> <span class="token comment">//纵坐标设置</span>
	HANDLE handle <span class="token operator">=</span> <span class="token function">GetStdHandle</span><span class="token punctuation">(</span>STD_OUTPUT_HANDLE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取控制台句柄</span>
	<span class="token function">SetConsoleCursorPosition</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置光标位置</span>
<span class="token punctuation">}</span>
<span class="token comment">//初始化界面</span>
<span class="token keyword">void</span> <span class="token function">InitInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">color</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//颜色设置为白色</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ROW<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> COL <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> j <span class="token operator">==</span> COL <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">||</span> j <span class="token operator">==</span> COL <span class="token operator">+</span> <span class="token number">9</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//标记该位置有方块</span>
				<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> j<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"■"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> ROW <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//标记该位置有方块</span>
				<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> j<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"■"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
				face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//标记该位置无方块</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> COL<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> COL <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		face<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//标记该位置有方块</span>
		<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> i<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"■"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"下一个方块："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"左移：←"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"右移：→"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"加速：↓"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"旋转：空格"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"暂停: S"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"退出: Esc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"重新开始:R"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"最高纪录:%d"</span><span class="token punctuation">,</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"当前分数：%d"</span><span class="token punctuation">,</span> grade<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//初始化方块信息</span>
<span class="token keyword">void</span> <span class="token function">InitBlockInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//“T”形</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		block<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	block<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token comment">//“L”形</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		block<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	block<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token comment">//“J”形</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		block<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	block<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//“Z”形</span>
		block<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		block<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token comment">//“S”形</span>
		block<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		block<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token comment">//“O”形</span>
		block<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		block<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//“I”形</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		block<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> temp<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> shape <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> shape <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> shape<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//7种形状</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> form <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> form <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> form<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//4种形态（已经有了一种，这里每个还需增加3种）</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//获取第form种形态</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					temp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> block<span class="token punctuation">[</span>shape<span class="token punctuation">]</span><span class="token punctuation">[</span>form<span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token comment">//将第form种形态顺时针旋转，得到第form+1种形态</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					block<span class="token punctuation">[</span>shape<span class="token punctuation">]</span><span class="token punctuation">[</span>form <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">-</span> j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//颜色设置</span>
<span class="token keyword">void</span> <span class="token function">color</span><span class="token punctuation">(</span><span class="token keyword">int</span> c<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>c<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
		c <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span> <span class="token comment">//“T”形方块设置为紫色</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
	<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
		c <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span> <span class="token comment">//“L”形和“J”形方块设置为红色</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
	<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
		c <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">//“Z”形和“S”形方块设置为绿色</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span>
		c <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">;</span> <span class="token comment">//“O”形方块设置为黄色</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span>
		c <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span> <span class="token comment">//“I”形方块设置为浅蓝色</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">default</span><span class="token operator">:</span>
		c <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token comment">//其他默认设置为白色</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">SetConsoleTextAttribute</span><span class="token punctuation">(</span><span class="token function">GetStdHandle</span><span class="token punctuation">(</span>STD_OUTPUT_HANDLE<span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//颜色设置</span>
	<span class="token comment">//注：SetConsoleTextAttribute是一个API（应用程序编程接口）</span>
<span class="token punctuation">}</span>
<span class="token comment">//画出方块</span>
<span class="token keyword">void</span> <span class="token function">DrawBlock</span><span class="token punctuation">(</span><span class="token keyword">int</span> shape<span class="token punctuation">,</span> <span class="token keyword">int</span> form<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>block<span class="token punctuation">[</span>shape<span class="token punctuation">]</span><span class="token punctuation">[</span>form<span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//如果该位置有方块</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> y <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//光标跳转到指定位置</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"■"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//输出方块</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//空格覆盖</span>
<span class="token keyword">void</span> <span class="token function">DrawSpace</span><span class="token punctuation">(</span><span class="token keyword">int</span> shape<span class="token punctuation">,</span> <span class="token keyword">int</span> form<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>block<span class="token punctuation">[</span>shape<span class="token punctuation">]</span><span class="token punctuation">[</span>form<span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//如果该位置有方块</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> y <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//光标跳转到指定位置</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//打印空格覆盖（两个空格）</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//合法性判断</span>
<span class="token keyword">int</span> <span class="token function">IsLegal</span><span class="token punctuation">(</span><span class="token keyword">int</span> shape<span class="token punctuation">,</span> <span class="token keyword">int</span> form<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//如果方块落下的位置本来就已经有方块了，则不合法</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>block<span class="token punctuation">[</span>shape<span class="token punctuation">]</span><span class="token punctuation">[</span>form<span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>y <span class="token operator">+</span> i<span class="token punctuation">]</span><span class="token punctuation">[</span>x <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//不合法</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//合法</span>
<span class="token punctuation">}</span>
<span class="token comment">//判断得分与结束</span>
<span class="token keyword">int</span> <span class="token function">JudeFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//判断是否得分</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> ROW <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//记录第i行的方块个数</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> COL <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			sum <span class="token operator">+=</span> face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//统计第i行的方块个数</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//该行没有方块，无需再判断其上的层次（无需再继续判断是否得分）</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//跳出循环</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">==</span> COL <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">//该行全是方块，可得分</span>
		<span class="token punctuation">{<!-- --></span>
			grade <span class="token operator">+=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">//满一行加10分</span>
			<span class="token function">color</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//颜色设置为白色</span>
			<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//光标跳转到显示当前分数的位置</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"当前分数：%d"</span><span class="token punctuation">,</span> grade<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//更新当前分数</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> COL <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//清除得分行的方块信息</span>
			<span class="token punctuation">{<!-- --></span>
				face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//该位置得分后被清除，标记为无方块</span>
				<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> j<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//光标跳转到该位置</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//打印空格覆盖（两个空格）</span>
			<span class="token punctuation">}</span>
			<span class="token comment">//把被清除行上面的行整体向下挪一格</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> m <span class="token operator">=</span> i<span class="token punctuation">;</span> m <span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">;</span> m<span class="token operator">--</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//记录上一行的方块个数</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> COL <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					sum <span class="token operator">+=</span> face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//统计上一行的方块个数</span>
					face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//将上一行方块的标识移到下一行</span>
					face<span class="token punctuation">.</span>color<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> face<span class="token punctuation">.</span>color<span class="token punctuation">[</span>m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//将上一行方块的颜色编号移到下一行</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//上一行移下来的是方块，打印方块</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//光标跳转到该位置</span>
						<span class="token function">color</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span>color<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//颜色设置为还方块的颜色</span>
						<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"■"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//打印方块</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span> <span class="token comment">//上一行移下来的是空格，打印空格</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//光标跳转到该位置</span>
						<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//打印空格（两个空格）</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//上一行移下来的全是空格，无需再将上层的方块向下移动（移动结束）</span>
					<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//返回1，表示还需调用该函数进行判断（移动下来的可能还有满行）</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//判断游戏是否结束</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> COL <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>face<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//顶层有方块存在（以第1行为顶层，不是第0行）</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//留给玩家反应时间</span>
			<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//清空屏幕</span>
			<span class="token function">color</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//颜色设置为白色</span>
			<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>COL <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ROW <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>grade<span class="token operator">&gt;</span>max<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"恭喜你打破最高记录，最高记录更新为%d"</span><span class="token punctuation">,</span> grade<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">WriteGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>grade <span class="token operator">==</span> max<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"与最高记录持平，加油再创佳绩"</span><span class="token punctuation">,</span> grade<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"请继续加油，当前与最高记录相差%d"</span><span class="token punctuation">,</span> max <span class="token operator">-</span> grade<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>COL <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ROW <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"GAME OVER"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">char</span> ch<span class="token punctuation">;</span>
				<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>COL <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ROW <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"再来一局?(y/n):"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">==</span> <span class="token char">'y'</span> <span class="token operator">||</span> ch <span class="token operator">==</span> <span class="token char">'Y'</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">==</span> <span class="token char">'n'</span> <span class="token operator">||</span> ch <span class="token operator">==</span> <span class="token char">'N'</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>COL <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ROW <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>COL <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ROW <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"选择错误，请再次选择"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//判断结束，无需再调用该函数进行判断</span>
<span class="token punctuation">}</span>
<span class="token comment">//游戏主体逻辑函数</span>
<span class="token keyword">void</span> <span class="token function">StartGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> shape <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">7</span><span class="token punctuation">,</span> form <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">//随机获取方块的形状和形态</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> nextShape <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">7</span><span class="token punctuation">,</span> nextForm <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">//随机获取下一个方块的形状和形态</span>
		<span class="token keyword">int</span> x <span class="token operator">=</span> COL <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//方块初始下落位置的横纵坐标</span>
		<span class="token function">color</span><span class="token punctuation">(</span>nextShape<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//颜色设置为下一个方块的颜色</span>
		<span class="token function">DrawBlock</span><span class="token punctuation">(</span>nextShape<span class="token punctuation">,</span> nextForm<span class="token punctuation">,</span> COL <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将下一个方块显示在右上角</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">color</span><span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//颜色设置为当前正在下落的方块</span>
			<span class="token function">DrawBlock</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将该方块显示在初始下落位置</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				t <span class="token operator">=</span> <span class="token number">15000</span><span class="token punctuation">;</span> <span class="token comment">//这里t越小，方块下落越快（可以根据此设置游戏难度）</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>t<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">kbhit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//若键盘被敲击，则退出循环</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//键盘未被敲击</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsLegal</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//方块再下落就不合法了（已经到达底部）</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token comment">//将当前方块的信息录入face当中</span>
					<span class="token comment">//face:记录界面的每个位置是否有方块，若有方块还需记录该位置方块的颜色。</span>
					<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
						<span class="token punctuation">{<!-- --></span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>block<span class="token punctuation">[</span>shape<span class="token punctuation">]</span><span class="token punctuation">[</span>form<span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
							<span class="token punctuation">{<!-- --></span>
								face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>y <span class="token operator">+</span> i<span class="token punctuation">]</span><span class="token punctuation">[</span>x <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//将该位置标记为有方块</span>
								face<span class="token punctuation">.</span>color<span class="token punctuation">[</span>y <span class="token operator">+</span> i<span class="token punctuation">]</span><span class="token punctuation">[</span>x <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> shape<span class="token punctuation">;</span> <span class="token comment">//记录该方块的颜色数值</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">JudeFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//判断此次方块下落是否得分以及游戏是否结束</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//跳出当前死循环，准备进行下一个方块的下落</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span> <span class="token comment">//未到底部</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">DrawSpace</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用空格覆盖当前方块所在位置</span>
					y<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//纵坐标自增（下一次显示方块时就相当于下落了一格了）</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token comment">//键盘被敲击</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token function">getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//读取keycode</span>
				<span class="token keyword">switch</span> <span class="token punctuation">(</span>ch<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">case</span> DOWN<span class="token operator">:</span> <span class="token comment">//方向键：下</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsLegal</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//判断方块向下移动一位后是否合法</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token comment">//方块下落后合法才进行以下操作</span>
						<span class="token function">DrawSpace</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用空格覆盖当前方块所在位置</span>
						y<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//纵坐标自增（下一次显示方块时就相当于下落了一格了）</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> LEFT<span class="token operator">:</span> <span class="token comment">//方向键：左</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsLegal</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//判断方块向左移动一位后是否合法</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token comment">//方块左移后合法才进行以下操作</span>
						<span class="token function">DrawSpace</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用空格覆盖当前方块所在位置</span>
						x<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token comment">//横坐标自减（下一次显示方块时就相当于左移了一格了）</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> RIGHT<span class="token operator">:</span> <span class="token comment">//方向键：右</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsLegal</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//判断方块向右移动一位后是否合法</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token comment">//方块右移后合法才进行以下操作</span>
						<span class="token function">DrawSpace</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用空格覆盖当前方块所在位置</span>
						x<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//横坐标自增（下一次显示方块时就相当于右移了一格了）</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> SPACE<span class="token operator">:</span> <span class="token comment">//空格键</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsLegal</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> <span class="token punctuation">(</span>form <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//判断方块旋转后是否合法</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token comment">//方块旋转后合法才进行以下操作</span>
						<span class="token function">DrawSpace</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用空格覆盖当前方块所在位置</span>
						y<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//纵坐标自增（总不能原地旋转吧）</span>
						form <span class="token operator">=</span> <span class="token punctuation">(</span>form <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">//方块的形态自增（下一次显示方块时就相当于旋转了）</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> ESC<span class="token operator">:</span> <span class="token comment">//Esc键</span>
					<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//清空屏幕</span>
					<span class="token function">color</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">CursorJump</span><span class="token punctuation">(</span>COL<span class="token punctuation">,</span> ROW <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  游戏结束  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">CursorJump</span><span class="token punctuation">(</span>COL<span class="token punctuation">,</span> ROW <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//结束程序</span>
				<span class="token keyword">case</span> <span class="token char">'s'</span><span class="token operator">:</span>
				<span class="token keyword">case</span> <span class="token char">'S'</span><span class="token operator">:</span>  <span class="token comment">//暂停</span>
					<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause&gt;nul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//暂停（按任意键继续）</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token char">'r'</span><span class="token operator">:</span>
				<span class="token keyword">case</span> <span class="token char">'R'</span><span class="token operator">:</span> <span class="token comment">//重新开始</span>
					<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//清空屏幕</span>
					<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//重新执行主函数</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		shape <span class="token operator">=</span> nextShape<span class="token punctuation">,</span> form <span class="token operator">=</span> nextForm<span class="token punctuation">;</span> <span class="token comment">//获取下一个方块的信息</span>
		<span class="token function">DrawSpace</span><span class="token punctuation">(</span>nextShape<span class="token punctuation">,</span> nextForm<span class="token punctuation">,</span> COL <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将右上角的方块信息用空格覆盖</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//从文件读取最高分</span>
<span class="token keyword">void</span> <span class="token function">ReadGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	FILE<span class="token operator">*</span> pf <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"俄罗斯方块最高得分记录.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//以只读方式打开文件</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pf <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">//打开文件失败</span>
	<span class="token punctuation">{<!-- --></span>
		pf <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"俄罗斯方块最高得分记录.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//以只写方式打开文件（文件不存在可以自动创建该文件）</span>
		<span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>grade<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> pf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将max写入文件（此时max为0），即将最高历史得分初始化为0</span>
	<span class="token punctuation">}</span>
	<span class="token function">fseek</span><span class="token punctuation">(</span>pf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//使文件指针pf指向文件开头</span>
	<span class="token function">fread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>max<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> pf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//读取文件中的最高历史得分到max当中</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>pf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//关闭文件</span>
	pf <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">//文件指针及时置空</span>
<span class="token punctuation">}</span>
<span class="token comment">//更新最高分到文件</span>
<span class="token keyword">void</span> <span class="token function">WriteGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	FILE<span class="token operator">*</span> pf <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"俄罗斯方块最高得分记录.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//以只写方式打开文件</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pf <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">//打开文件失败</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"保存最高得分记录失败\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>grade<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> pf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将本局游戏得分写入文件当中（更新最高历史得分）</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>pf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//关闭文件</span>
	pf <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">//文件指针及时置空</span>
<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="_534">
     </a>
     游戏代码详解
    </h2>
    <h3>
     <a id="_535">
     </a>
     游戏框架构建
    </h3>
    <p>
     首先我们定义一下界面的大小，我们这里定义游戏区的行数和列数。
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ROW</span> <span class="token expression"><span class="token number">29</span> </span><span class="token comment">//游戏区行数</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COL</span> <span class="token expression"><span class="token number">20</span> </span><span class="token comment">//游戏区列数</span></span>
</code></pre>
    <p>
     我这里将方块堆积的区域称为游戏区，将按键提示以及方块提示的区域称为提示区。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/226dc39113bd380ca99bae27d37fccf9.png">
      <br/>
      我们还需要一个结构体，该结构体记录界面的每个位置是否有方块，若有方块还需记录该位置方块的颜色。
     </img>
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">struct</span> <span class="token class-name">Face</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> data<span class="token punctuation">[</span>ROW<span class="token punctuation">]</span><span class="token punctuation">[</span>COL <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//用于标记指定位置是否有方块（1为有，0为无）</span>
	<span class="token keyword">int</span> color<span class="token punctuation">[</span>ROW<span class="token punctuation">]</span><span class="token punctuation">[</span>COL <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//用于记录指定位置的方块颜色编码</span>
<span class="token punctuation">}</span>face<span class="token punctuation">;</span>
</code></pre>
    <p>
     其次，我们还需要一个结构体，该结构体当中存储着一个4行4列的二维数组，这个二维数组就用于存储单个方块的基本信息。（众所周知，4行4列的二维数组可以容纳下游戏当中的每一种方块）
    </p>
    <p>
     而俄罗斯方块当中有7种基本形状的方块，而每种方块通过旋转后又可以得到3种方块，共28种。
    </p>
    <p>
     因此，我们可以用该结构体定义一个7行4列的二维数组存储这28个方块的信息。
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">struct</span> <span class="token class-name">Block</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> space<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>block<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//用于存储7种基本形状方块的各自的4种形态的信息，共28种</span>
</code></pre>
    <p>
     做到这里框架已经基本构建好了，为了提高代码的可读性，我们再根据需要用到的按键的键码值对其进行宏定义。
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DOWN</span> <span class="token expression"><span class="token number">80</span> </span><span class="token comment">//方向键：下</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LEFT</span> <span class="token expression"><span class="token number">75</span> </span><span class="token comment">//方向键：左</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">RIGHT</span> <span class="token expression"><span class="token number">77</span> </span><span class="token comment">//方向键：右</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SPACE</span> <span class="token expression"><span class="token number">32</span> </span><span class="token comment">//空格键</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ESC</span> <span class="token expression"><span class="token number">27</span> </span><span class="token comment">//Esc键</span></span>
</code></pre>
    <h3>
     <a id="_571">
     </a>
     隐藏光标
    </h3>
    <p>
     光标的作用在于提醒使用者，你接下来的输入将会在该位置出现。但在进行游戏时我们并不需要用到光标，光标在那里一闪一闪的显然是不行的，这时我们需要将光标隐藏。
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">//隐藏光标</span>
<span class="token keyword">void</span> <span class="token function">HideCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	CONSOLE_CURSOR_INFO curInfo<span class="token punctuation">;</span> <span class="token comment">//定义光标信息的结构体变量</span>
	curInfo<span class="token punctuation">.</span>dwSize <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//如果没赋值的话，隐藏光标无效</span>
	curInfo<span class="token punctuation">.</span>bVisible <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token comment">//将光标设置为不可见</span>
	HANDLE handle <span class="token operator">=</span> <span class="token function">GetStdHandle</span><span class="token punctuation">(</span>STD_OUTPUT_HANDLE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取控制台句柄</span>
	<span class="token function">SetConsoleCursorInfo</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token operator">&amp;</span>curInfo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置光标信息</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     其中，关键结构CONSOLE_CURSOR_INFO在其头文件当中的内容如下：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0fdc3bafd0954d772c49c064d29626c4.png#pic_center">
      <br/>
      设置光标信息函数在其头文件中的声明如下：
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/18b9590bd0c2c760d839a7a5f4b9780f.png#pic_center"/>
     </img>
    </p>
    <h3>
     <a id="_588">
     </a>
     光标跳转
    </h3>
    <p>
     在屏幕上进行输出时，我们需要光标先移动到目标位置再进行输出，因此，光标跳转函数也是必不可少的。
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">//光标跳转</span>
<span class="token keyword">void</span> <span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	COORD pos<span class="token punctuation">;</span> <span class="token comment">//定义光标位置的结构体变量</span>
	pos<span class="token punctuation">.</span>X <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token comment">//横坐标设置</span>
	pos<span class="token punctuation">.</span>Y <span class="token operator">=</span> y<span class="token punctuation">;</span> <span class="token comment">//纵坐标设置</span>
	HANDLE handle <span class="token operator">=</span> <span class="token function">GetStdHandle</span><span class="token punctuation">(</span>STD_OUTPUT_HANDLE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取控制台句柄</span>
	<span class="token function">SetConsoleCursorPosition</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置光标位置</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     其中，关键结构COORD在其头文件当中的内容如下：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4551539d54036a3f57ebc6c8954fb94f.png#pic_center">
      <br/>
      设置光标位置函数在其头文件中的声明如下：
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d9103112f28c3a5652bf0a09cb74afe0.png#pic_center"/>
     </img>
    </p>
    <h3>
     <a id="_605">
     </a>
     初始化界面
    </h3>
    <p>
     初始化界面完成基本信息的打印，包括由白色方块构成的边界和按键提示语句。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1aac7189fd96793ef4f94a9df22cfedc.png">
      <br/>
      对照最终效果图片，看着代码很好理解，但是需要
      <strong>
       注意两点
      </strong>
      ：
     </img>
    </p>
    <ol>
     <li>
      一个小方块在cmd命令窗口当中占两个单位的横坐标、一个单位的纵坐标。
     </li>
     <li>
      光标跳转函数CursorJump接收的是光标将要跳至的横纵坐标。
     </li>
    </ol>
    <p>
     例如，想要将光标跳转到 i 行 j 列（这里所说的行和列都是以一个方块为单位），就等价于让光标跳转到坐标（2*j，i）处。
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">//初始化界面</span>
<span class="token keyword">void</span> <span class="token function">InitInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">color</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//颜色设置为白色</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ROW<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> COL <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> j <span class="token operator">==</span> COL <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">||</span> j <span class="token operator">==</span> COL <span class="token operator">+</span> <span class="token number">9</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//标记该位置有方块</span>
				<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> j<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"■"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> ROW <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//标记该位置有方块</span>
				<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> j<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"■"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
				face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//标记该位置无方块</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> COL<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> COL <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		face<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//标记该位置有方块</span>
		<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> i<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"■"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"下一个方块："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"左移：←"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"右移：→"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"加速：↓"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"旋转：空格"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"暂停: S"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"退出: Esc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"重新开始:R"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"最高纪录:%d"</span><span class="token punctuation">,</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"当前分数：%d"</span><span class="token punctuation">,</span> grade<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_676">
     </a>
     初始化方块信息
    </h3>
    <p>
     上面说到俄罗斯方块有7种基本形状，便是以下7种：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c08e3c034c323848eb4ebf7bbdfa2a1e.png">
      <br/>
      我们先将这7种基本形状的方块信息存储在各自的第0种形态处，如下：
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/cc94d1b1a20dd62be1f2fe85ff93f4e4.png">
       <br/>
       然后取第0种形态顺时针旋转后得到第1种形态，取第1种形态顺时针旋转后得到第2种形态，取第2种形态顺时针旋转后得到第3种形态。这7种形状都按此方法操作，最终得到全部28种方块信息，如下：
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/24da251e934ac83ec7a1a3d703a0162c.png">
        <br/>
        在旋转过程中，一个方块顺时针旋转一次后其位置变换规律如下：
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/bd17b7297fb5a73f01ba3d96e65fe373.png"/>
       </img>
      </img>
     </img>
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">//初始化方块信息</span>
<span class="token keyword">void</span> <span class="token function">InitBlockInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//“T”形</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		block<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	block<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token comment">//“L”形</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		block<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	block<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token comment">//“J”形</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		block<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	block<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//“Z”形</span>
		block<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		block<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token comment">//“S”形</span>
		block<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		block<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token comment">//“O”形</span>
		block<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		block<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//“I”形</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
		block<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> temp<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> shape <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> shape <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> shape<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//7种形状</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> form <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> form <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> form<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//4种形态（已经有了一种，这里每个还需增加3种）</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//获取第form种形态</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					temp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> block<span class="token punctuation">[</span>shape<span class="token punctuation">]</span><span class="token punctuation">[</span>form<span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token comment">//将第form种形态顺时针旋转，得到第form+1种形态</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					block<span class="token punctuation">[</span>shape<span class="token punctuation">]</span><span class="token punctuation">[</span>form <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">-</span> j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_746">
     </a>
     颜色设置
    </h3>
    <p>
     这里的颜色设置函数所接收的参数c(0~6)，代表7种形状的方块，每种方块对应自己的颜色，所对应的颜色可以自己设置。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3e9bb36a3b3a386467098e790480612d.png"/>
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">//颜色设置</span>
<span class="token keyword">void</span> <span class="token function">color</span><span class="token punctuation">(</span><span class="token keyword">int</span> c<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>c<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
		c <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span> <span class="token comment">//“T”形方块设置为紫色</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
	<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
		c <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span> <span class="token comment">//“L”形和“J”形方块设置为红色</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
	<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
		c <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">//“Z”形和“S”形方块设置为绿色</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span>
		c <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">;</span> <span class="token comment">//“O”形方块设置为黄色</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span>
		c <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span> <span class="token comment">//“I”形方块设置为浅蓝色</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">default</span><span class="token operator">:</span>
		c <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token comment">//其他默认设置为白色</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">SetConsoleTextAttribute</span><span class="token punctuation">(</span><span class="token function">GetStdHandle</span><span class="token punctuation">(</span>STD_OUTPUT_HANDLE<span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//颜色设置</span>
	<span class="token comment">//注：SetConsoleTextAttribute是一个API（应用程序编程接口）</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     设置颜色函数在其头文件中的声明如下：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7fb3c8f715989ecdc634ef1c3fd11d94.png#pic_center"/>
    </p>
    <h3>
     <a id="_782">
     </a>
     画出方块
    </h3>
    <p>
     方块的信息有了，接下来就是将方块在屏幕上显示出来。该函数的作用是，将第shape种形状的第form种形态的方块打印在屏幕的指定位置处。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2bf2cd0afcf1d8e6b9093446fd28071b.png"/>
     <br/>
     所给x和y，指的是方块信息当中第一行第一列的方块的打印位置。
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">//画出方块</span>
<span class="token keyword">void</span> <span class="token function">DrawBlock</span><span class="token punctuation">(</span><span class="token keyword">int</span> shape<span class="token punctuation">,</span> <span class="token keyword">int</span> form<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>block<span class="token punctuation">[</span>shape<span class="token punctuation">]</span><span class="token punctuation">[</span>form<span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//如果该位置有方块</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> y <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//光标跳转到指定位置</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"■"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//输出方块</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_803">
     </a>
     空格覆盖
    </h3>
    <p>
     无论是游戏区方块的移动，还是提示区右上角下一个方块的显示，都需要方块位置的变换，而在变化之前肯定是要先将之前打印的方块用空格进行覆盖，然后再打印变化后的方块。
    </p>
    <p>
     在覆盖方块时特别需要注意的是，要覆盖一个小方块需要用两个空格。
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">//空格覆盖</span>
<span class="token keyword">void</span> <span class="token function">DrawSpace</span><span class="token punctuation">(</span><span class="token keyword">int</span> shape<span class="token punctuation">,</span> <span class="token keyword">int</span> form<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>block<span class="token punctuation">[</span>shape<span class="token punctuation">]</span><span class="token punctuation">[</span>form<span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//如果该位置有方块</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> y <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//光标跳转到指定位置</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//打印空格覆盖（两个空格）</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_824">
     </a>
     合法性判断
    </h3>
    <p>
     其实在方块移动过程中，无时无刻都在判断方块下一次变化后的位置是否合法，只有合法才会允许该变化的进行。
    </p>
    <p>
     所谓非法，就是指该方块进行了该变化后落在了本来就有方块的位置。
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">//合法性判断</span>
<span class="token keyword">int</span> <span class="token function">IsLegal</span><span class="token punctuation">(</span><span class="token keyword">int</span> shape<span class="token punctuation">,</span> <span class="token keyword">int</span> form<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//如果方块落下的位置本来就已经有方块了，则不合法</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>block<span class="token punctuation">[</span>shape<span class="token punctuation">]</span><span class="token punctuation">[</span>form<span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>y <span class="token operator">+</span> i<span class="token punctuation">]</span><span class="token punctuation">[</span>x <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//不合法</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//合法</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_844">
     </a>
     判断得分与结束
    </h3>
    <p>
     <strong>
      判断得分：
     </strong>
     <br/>
     从下往上判断，若某一行方块全满，则将改行方块数据清空，并将该行上方的方块全部下移，下移结束后返回1，表示还需再次调用该函数进行判断，因为被下移的行并没有进行判断，可能还存在满行。
    </p>
    <p>
     <strong>
      判断结束：
     </strong>
    </p>
    <ol>
     <li>
      直接判断游戏区最上面的一行当中是否有方块存在，若存在方块，则游戏结束。
     </li>
     <li>
      游戏结束后，除了给出游戏结束提示语之外，如果玩家本局游戏分数大于历史最高记录，则需要更新最高分到文件当中。
     </li>
     <li>
      游戏结束后询问玩家是否再来一局。
     </li>
    </ol>
    <pre><code class="prism language-cpp"><span class="token comment">//判断得分与结束</span>
<span class="token keyword">int</span> <span class="token function">JudeFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//判断是否得分</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> ROW <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//记录第i行的方块个数</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> COL <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			sum <span class="token operator">+=</span> face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//统计第i行的方块个数</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//该行没有方块，无需再判断其上的层次（无需再继续判断是否得分）</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//跳出循环</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">==</span> COL <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">//该行全是方块，可得分</span>
		<span class="token punctuation">{<!-- --></span>
			grade <span class="token operator">+=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">//满一行加10分</span>
			<span class="token function">color</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//颜色设置为白色</span>
			<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> COL <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> ROW <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//光标跳转到显示当前分数的位置</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"当前分数：%d"</span><span class="token punctuation">,</span> grade<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//更新当前分数</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> COL <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//清除得分行的方块信息</span>
			<span class="token punctuation">{<!-- --></span>
				face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//该位置得分后被清除，标记为无方块</span>
				<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> j<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//光标跳转到该位置</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//打印空格覆盖（两个空格）</span>
			<span class="token punctuation">}</span>
			<span class="token comment">//把被清除行上面的行整体向下挪一格</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> m <span class="token operator">=</span> i<span class="token punctuation">;</span> m <span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">;</span> m<span class="token operator">--</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//记录上一行的方块个数</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> COL <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					sum <span class="token operator">+=</span> face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//统计上一行的方块个数</span>
					face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//将上一行方块的标识移到下一行</span>
					face<span class="token punctuation">.</span>color<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> face<span class="token punctuation">.</span>color<span class="token punctuation">[</span>m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//将上一行方块的颜色编号移到下一行</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//上一行移下来的是方块，打印方块</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//光标跳转到该位置</span>
						<span class="token function">color</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span>color<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//颜色设置为还方块的颜色</span>
						<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"■"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//打印方块</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span> <span class="token comment">//上一行移下来的是空格，打印空格</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//光标跳转到该位置</span>
						<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//打印空格（两个空格）</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//上一行移下来的全是空格，无需再将上层的方块向下移动（移动结束）</span>
					<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//返回1，表示还需调用该函数进行判断（移动下来的可能还有满行）</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//判断游戏是否结束</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> COL <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>face<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//顶层有方块存在（以第1行为顶层，不是第0行）</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//留给玩家反应时间</span>
			<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//清空屏幕</span>
			<span class="token function">color</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//颜色设置为白色</span>
			<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>COL <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ROW <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>grade<span class="token operator">&gt;</span>max<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"恭喜你打破最高记录，最高记录更新为%d"</span><span class="token punctuation">,</span> grade<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">WriteGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>grade <span class="token operator">==</span> max<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"与最高记录持平，加油再创佳绩"</span><span class="token punctuation">,</span> grade<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"请继续加油，当前与最高记录相差%d"</span><span class="token punctuation">,</span> max <span class="token operator">-</span> grade<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>COL <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ROW <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"GAME OVER"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">char</span> ch<span class="token punctuation">;</span>
				<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>COL <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ROW <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"再来一局?(y/n):"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">==</span> <span class="token char">'y'</span> <span class="token operator">||</span> ch <span class="token operator">==</span> <span class="token char">'Y'</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">==</span> <span class="token char">'n'</span> <span class="token operator">||</span> ch <span class="token operator">==</span> <span class="token char">'N'</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>COL <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ROW <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">CursorJump</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>COL <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ROW <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"选择错误，请再次选择"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//判断结束，无需再调用该函数进行判断</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_955">
     </a>
     游戏主体逻辑函数
    </h3>
    <p>
     <strong>
      主体逻辑：
     </strong>
    </p>
    <ol>
     <li>
      在打印当前下落的方块前，先随机获取下一次将要下落的方块，并打印到提示区的右上角。
     </li>
     <li>
      将当前下落的方块首先打印到游戏区顶部，给定一定的时间间隔，若在该时间内键盘未被敲击，则方块下落一格，方块下落前需先判断下落后的合法性。
     </li>
     <li>
      若在给定时间间隔内键盘被敲击，则根据所敲击的按键给出相应反馈。
     </li>
     <li>
      若方块落到底部，则调用“判断得分与结束”函数进行判断。
     </li>
     <li>
      若游戏未结束，则循环进行以上步骤。
     </li>
    </ol>
    <pre><code class="prism language-cpp"><span class="token comment">//游戏主体逻辑函数</span>
<span class="token keyword">void</span> <span class="token function">StartGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>	
	<span class="token keyword">int</span> shape <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">7</span><span class="token punctuation">,</span> form <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">//随机获取方块的形状和形态</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> nextShape <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">7</span><span class="token punctuation">,</span> nextForm <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">//随机获取下一个方块的形状和形态</span>
		<span class="token keyword">int</span> x <span class="token operator">=</span> COL <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//方块初始下落位置的横纵坐标</span>
		<span class="token function">color</span><span class="token punctuation">(</span>nextShape<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//颜色设置为下一个方块的颜色</span>
		<span class="token function">DrawBlock</span><span class="token punctuation">(</span>nextShape<span class="token punctuation">,</span> nextForm<span class="token punctuation">,</span> COL <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将下一个方块显示在右上角</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">color</span><span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//颜色设置为当前正在下落的方块</span>
			<span class="token function">DrawBlock</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将该方块显示在初始下落位置</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				t <span class="token operator">=</span> <span class="token number">15000</span><span class="token punctuation">;</span> <span class="token comment">//这里t越小，方块下落越快（可以根据此设置游戏难度）</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>t<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">kbhit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//若键盘被敲击，则退出循环</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//键盘未被敲击</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsLegal</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//方块再下落就不合法了（已经到达底部）</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token comment">//将当前方块的信息录入face当中</span>
					<span class="token comment">//face:记录界面的每个位置是否有方块，若有方块还需记录该位置方块的颜色。</span>
					<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
						<span class="token punctuation">{<!-- --></span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>block<span class="token punctuation">[</span>shape<span class="token punctuation">]</span><span class="token punctuation">[</span>form<span class="token punctuation">]</span><span class="token punctuation">.</span>space<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
							<span class="token punctuation">{<!-- --></span>
								face<span class="token punctuation">.</span>data<span class="token punctuation">[</span>y <span class="token operator">+</span> i<span class="token punctuation">]</span><span class="token punctuation">[</span>x <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//将该位置标记为有方块</span>
								face<span class="token punctuation">.</span>color<span class="token punctuation">[</span>y <span class="token operator">+</span> i<span class="token punctuation">]</span><span class="token punctuation">[</span>x <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> shape<span class="token punctuation">;</span> <span class="token comment">//记录该方块的颜色数值</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">JudeFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//判断此次方块下落是否得分以及游戏是否结束</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//跳出当前死循环，准备进行下一个方块的下落</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span> <span class="token comment">//未到底部</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">DrawSpace</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用空格覆盖当前方块所在位置</span>
					y<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//纵坐标自增（下一次显示方块时就相当于下落了一格了）</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token comment">//键盘被敲击</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token function">getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//读取keycode</span>
				<span class="token keyword">switch</span> <span class="token punctuation">(</span>ch<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">case</span> DOWN<span class="token operator">:</span> <span class="token comment">//方向键：下</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsLegal</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//判断方块向下移动一位后是否合法</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token comment">//方块下落后合法才进行以下操作</span>
						<span class="token function">DrawSpace</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用空格覆盖当前方块所在位置</span>
						y<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//纵坐标自增（下一次显示方块时就相当于下落了一格了）</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> LEFT<span class="token operator">:</span> <span class="token comment">//方向键：左</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsLegal</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//判断方块向左移动一位后是否合法</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token comment">//方块左移后合法才进行以下操作</span>
						<span class="token function">DrawSpace</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用空格覆盖当前方块所在位置</span>
						x<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token comment">//横坐标自减（下一次显示方块时就相当于左移了一格了）</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> RIGHT<span class="token operator">:</span> <span class="token comment">//方向键：右</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsLegal</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//判断方块向右移动一位后是否合法</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token comment">//方块右移后合法才进行以下操作</span>
						<span class="token function">DrawSpace</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用空格覆盖当前方块所在位置</span>
						x<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//横坐标自增（下一次显示方块时就相当于右移了一格了）</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> SPACE<span class="token operator">:</span> <span class="token comment">//空格键</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsLegal</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> <span class="token punctuation">(</span>form <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//判断方块旋转后是否合法</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token comment">//方块旋转后合法才进行以下操作</span>
						<span class="token function">DrawSpace</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> form<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用空格覆盖当前方块所在位置</span>
						y<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//纵坐标自增（总不能原地旋转吧）</span>
						form <span class="token operator">=</span> <span class="token punctuation">(</span>form <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">//方块的形态自增（下一次显示方块时就相当于旋转了）</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> ESC<span class="token operator">:</span> <span class="token comment">//Esc键</span>
					<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//清空屏幕</span>
					<span class="token function">color</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">CursorJump</span><span class="token punctuation">(</span>COL<span class="token punctuation">,</span> ROW <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  游戏结束  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">CursorJump</span><span class="token punctuation">(</span>COL<span class="token punctuation">,</span> ROW <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//结束程序</span>
				<span class="token keyword">case</span> <span class="token char">'s'</span><span class="token operator">:</span>
				<span class="token keyword">case</span> <span class="token char">'S'</span><span class="token operator">:</span>  <span class="token comment">//暂停</span>
					<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause&gt;nul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//暂停（按任意键继续）</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token char">'r'</span><span class="token operator">:</span>
				<span class="token keyword">case</span> <span class="token char">'R'</span><span class="token operator">:</span> <span class="token comment">//重新开始</span>
					<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//清空屏幕</span>
					<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//重新执行主函数</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		shape <span class="token operator">=</span> nextShape<span class="token punctuation">,</span> form <span class="token operator">=</span> nextForm<span class="token punctuation">;</span> <span class="token comment">//获取下一个方块的信息</span>
		<span class="token function">DrawSpace</span><span class="token punctuation">(</span>nextShape<span class="token punctuation">,</span> nextForm<span class="token punctuation">,</span> COL <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将右上角的方块信息用空格覆盖</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      注意：
     </strong>
     这里只是概括性的说明了俄罗斯方块的主体逻辑，代码当中还有大量注释以供大家理解。
    </p>
    <h3>
     <a id="_1075">
     </a>
     从文件读取最高分
    </h3>
    <p>
     首先需要使用fopen函数打开“俄罗斯方块最高记录.txt”文件，若是第一次运行该代码，则会自动创建该文件，并将历史最高记录设置为0，之后读取文件当中的历史最高记录存储在max变量当中，并关闭文件即可。
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">//从文件读取最高分</span>
<span class="token keyword">void</span> <span class="token function">ReadGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	FILE<span class="token operator">*</span> pf <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"俄罗斯方块最高得分记录.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//以只读方式打开文件</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pf <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">//打开文件失败</span>
	<span class="token punctuation">{<!-- --></span>
		pf <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"俄罗斯方块最高得分记录.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//以只写方式打开文件（文件不存在可以自动创建该文件）</span>
		<span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>grade<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> pf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将max写入文件（此时max为0），即将最高历史得分初始化为0</span>
	<span class="token punctuation">}</span>
	<span class="token function">fseek</span><span class="token punctuation">(</span>pf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//使文件指针pf指向文件开头</span>
	<span class="token function">fread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>max<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> pf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//读取文件中的最高历史得分到max当中</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>pf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//关闭文件</span>
	pf <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">//文件指针及时置空</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_1093">
     </a>
     更新最高分到文件
    </h3>
    <p>
     首先使用fopen函数打开“俄罗斯方块最高记录.txt”，然后将本局游戏的分数grade写入文件当中即可（覆盖式）。
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">//更新最高分到文件</span>
<span class="token keyword">void</span> <span class="token function">WriteGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	FILE<span class="token operator">*</span> pf <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"俄罗斯方块最高得分记录.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//以只写方式打开文件</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pf <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">//打开文件失败</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"保存最高得分记录失败\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>grade<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> pf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将本局游戏得分写入文件当中（更新最高历史得分）</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>pf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//关闭文件</span>
	pf <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">//文件指针及时置空</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_1110">
     </a>
     主函数
    </h3>
    <p>
     主函数里面就是依次调用以上函数，但有
     <strong>
      三点需要说明
     </strong>
     ：
    </p>
    <ol>
     <li>
      全局变量grade需要在主函数内初始化为0，不能在全局范围初始化为0，因为当玩家按下R键进行重玩时我们需要将当前分数grade重新设置为0。
     </li>
     <li>
      随机数的生成起点建议设置在主函数当中。
     </li>
     <li>
      主函数当中的#pragma语句是用于消除类似以下警告的：
     </li>
    </ol>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/cc13e1f2452b3e056baaa2fe952c3ccc.png"/>
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">int</span> max<span class="token punctuation">,</span> grade<span class="token punctuation">;</span> <span class="token comment">//全局变量</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">warning</span> <span class="token punctuation">(</span>disable<span class="token operator">:</span><span class="token number">4996</span><span class="token punctuation">)</span> </span><span class="token comment">//消除警告</span></span>
	max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> grade <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//初始化变量</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"title 俄罗斯方块"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置cmd窗口的名字</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"mode con lines=29 cols=60"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置cmd窗口的大小</span>
	<span class="token function">HideCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//隐藏光标</span>
	<span class="token function">ReadGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//从文件读取最高分到max变量	</span>
	<span class="token function">InitInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始化界面</span>
	<span class="token function">InitBlockInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始化方块信息</span>
	<span class="token function">srand</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置随机数生成的起点</span>
	<span class="token function">StartGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//开始游戏</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
</div>


<p class="artid" style="display:none">68747470733a2f2f626c:6f672e6373646e2e6e65742f6368656e6c6f6e675f6378792f:61727469636c652f64657461696c732f313139363830363731</p>
