---
layout: post
title: "Python爬取微博热搜榜,将数据存入数据库"
date: 2024-08-02 17:01:43 +0800
description: "一直想学习用Python来进行数据的爬取，也一直想知道Python连接数据库的操作，今天刚好看到的这"
keywords: "爬取微博热搜榜"
categories: ['爬虫']
tags: ['爬虫', '数据库', '微博', 'Python', 'Bat']
artid: "79806089"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=79806089
    alt: "Python爬取微博热搜榜,将数据存入数据库"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Python爬取微博热搜榜，将数据存入数据库
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     一直想学习用Python来进行数据的爬取，也一直想知道Python连接数据库的操作，今天刚好看到的这篇文章满足了这两个条件，我试着爬了下微博，并成功将数据添加到数据库中，颇为欢喜。作者写的很简单，有些过程省略掉了，因此我尝试了好几次才成功，接下来记录自己的成功操作。
    </p>
    <h3>
     一、选择需要爬取的网页
    </h3>
    <p>
     这里是用来爬取微博热搜榜的数据，网页地址为
     <a href="http://s.weibo.com/top/summary" rel="nofollow">
      http://s.weibo.com/top/summary
     </a>
     ，打开网页并按下F12进入开发者模式，找到&lt;td class = "td_05"&gt;...&lt;/td&gt;里的内容，如图所示：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/a75bb3f688cb49c79697433e6d908162.png">
      <br/>
     </img>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6f6b58c80653144cca0b4e192142c308.png">
      <br/>
     </img>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/d114801ff1a6914cecf007d45dac4c85.png">
      <br/>
     </img>
    </p>
    <p>
     href后面的内容即为对应的中文编码的源码，其中很多25应该是干扰字符，后面删掉解析就可以发现是微博热搜的标题。我数了下，一共有27个，刚好第一个标题为“比伯愿为赛琳娜捐肾”九个字，一个汉字占三个字符，一共27个。
    </p>
    <p>
     我用的是Python3.6.0，开发工具为PyCharm2017.2.3，数据库为MySql。
    </p>
    <h3>
     二、下面是完整代码
    </h3>
    <p>
    </p>
    <pre style="background-color:#404040;color:#9bc28e;font-family:Consolas;font-size:11.3pt;"><span style="color:#ff6666;">#-*-coding:utf-8-*-
</span><span style="color:#cc9900;"><strong>import </strong></span>urllib, pymysql, requests, re
<span style="color:#ff6666;"># </span><span style="color:#ff6666;font-family:'宋体';">配置数据库
</span>config <span style="color:#ffffff;"><strong>= </strong></span><span style="color:#d8f69c;"><strong>{
</strong></span><span style="color:#d8f69c;"><strong>    </strong></span><span style="color:#00b580;"><strong>'host'</strong></span><span style="color:#ffffff;"><strong>: </strong></span><span style="color:#00b580;"><strong>'127.0.0.1'</strong></span>,
    <span style="color:#00b580;"><strong>'port'</strong></span><span style="color:#ffffff;"><strong>: </strong></span><span style="color:#f971bb;">3306</span>,
    <span style="color:#00b580;"><strong>'user'</strong></span><span style="color:#ffffff;"><strong>: </strong></span><span style="color:#00b580;"><strong>'root'</strong></span>,
    <span style="color:#00b580;"><strong>'password'</strong></span><span style="color:#ffffff;"><strong>: </strong></span><span style="color:#00b580;"><strong>'******'</strong></span>,
    <span style="color:#00b580;"><strong>'db'</strong></span><span style="color:#ffffff;"><strong>: </strong></span><span style="color:#00b580;"><strong>'weibo'</strong></span>,
    <span style="color:#00b580;"><strong>'charset'</strong></span><span style="color:#ffffff;"><strong>: </strong></span><span style="color:#00b580;"><strong>'utf8'</strong></span>,
<span style="color:#d8f69c;"><strong>}
</strong></span><span style="color:#ff6666;"># </span><span style="color:#ff6666;font-family:'宋体';">链接数据库
</span>conn <span style="color:#ffffff;"><strong>= </strong></span>pymysql.connect<span style="font-weight:bold;">(</span><span style="color:#ffffff;"><strong>**</strong></span>config<span style="font-weight:bold;">)
</span>cursor <span style="color:#ffffff;"><strong>= </strong></span>conn.cursor<span style="font-weight:bold;">()
</span><span style="color:#ff6666;"># </span><span style="color:#ff6666;font-family:'宋体';">获取热搜源码
</span>weiboHotFile <span style="color:#ffffff;"><strong>= </strong></span>requests.get<span style="font-weight:bold;">(</span><span style="color:#00b580;"><strong>'http://s.weibo.com/top/summary'</strong></span><span style="font-weight:bold;">)
</span>weiboHotHtml <span style="color:#ffffff;"><strong>= </strong></span>weiboHotFile.text
<span style="color:#ff6666;"># </span><span style="color:#ff6666;font-family:'宋体';">正则表达式匹配</span><span style="color:#ff6666;">URL</span><span style="color:#ff6666;font-family:'宋体';">，找到</span><span style="color:#ff6666;">title
</span>hotKey <span style="color:#ffffff;"><strong>= </strong></span>re.compile<span style="font-weight:bold;">(</span><span style="color:#00b580;"><strong>r'td class=\\"td_05\\"&gt;&lt;a href=\\"\\/weibo\\/(.*?)&amp;Refer=top\\"'</strong></span><span style="font-weight:bold;">)
</span>hotKeyListBe <span style="color:#ffffff;"><strong>= </strong></span>hotKey.findall<span style="font-weight:bold;">(</span>weiboHotHtml<span style="font-weight:bold;">)
</span>rank <span style="color:#ffffff;"><strong>= </strong></span><span style="color:#f971bb;">1
</span><span style="color:#ff6666;"># </span><span style="color:#ff6666;font-family:'宋体';">遍历获取的</span><span style="color:#ff6666;">title</span><span style="color:#ff6666;font-family:'宋体';">列表
</span><span style="color:#cc9900;"><strong>for </strong></span>title <span style="color:#cc9900;"><strong>in </strong></span>hotKeyListBe<span style="color:#ffffff;"><strong>:
</strong></span><span style="color:#ffffff;"><strong>    </strong></span><span style="color:#ff6666;"># </span><span style="color:#ff6666;font-family:'宋体';">去除干扰数字
</span><span style="color:#ff6666;font-family:'宋体';">    </span>title <span style="color:#ffffff;"><strong>= </strong></span>title.replace<span style="font-weight:bold;">(</span><span style="color:#00b580;"><strong>'25'</strong></span>, <span style="color:#00b580;"><strong>''</strong></span><span style="font-weight:bold;">)
</span><span style="font-weight:bold;">    </span>url <span style="color:#ffffff;"><strong>= </strong></span><span style="color:#00b580;"><strong>'http://s.weibo.com/weibo/' </strong></span><span style="color:#ffffff;"><strong>+ </strong></span>title
    title <span style="color:#ffffff;"><strong>= </strong></span>urllib.parse.unquote<span style="font-weight:bold;">(</span>title<span style="font-weight:bold;">)
</span><span style="font-weight:bold;">    </span><span style="color:#00cccc;">print</span><span style="font-weight:bold;">(</span><span style="color:#00cccc;">str</span><span style="font-weight:bold;">(</span>rank<span style="font-weight:bold;">)</span><span style="color:#ffffff;"><strong>+</strong></span><span style="color:#00b580;"><strong>' '</strong></span><span style="color:#ffffff;"><strong>+</strong></span>title <span style="color:#ffffff;"><strong>+ </strong></span><span style="color:#00b580;"><strong>' '</strong></span><span style="color:#ffffff;"><strong>+</strong></span><span style="color:#00b580;"><strong>' '</strong></span><span style="color:#ffffff;"><strong>+</strong></span>url<span style="color:#ffffff;"><strong>+</strong></span><span style="color:#00b580;"><strong>'</strong></span><span style="color:#00ff00;"><strong>\n</strong></span><span style="color:#00b580;"><strong>'</strong></span><span style="font-weight:bold;">)
</span><span style="font-weight:bold;">    </span><span style="color:#ff6666;"># </span><span style="color:#ff6666;font-family:'宋体';">执行数据语句
</span><span style="color:#ff6666;font-family:'宋体';">    </span>sql <span style="color:#ffffff;"><strong>= </strong></span><span style="color:#00b580;"><strong>'insert into hotsearch (rank, daydate, mindate, title, url) values (%s, curdate(), curtime(), %s, %s)'
</strong></span><span style="color:#00b580;"><strong>    </strong></span>cursor.execute<span style="font-weight:bold;">(</span>sql, <span style="font-weight:bold;">(</span>rank, title, url<span style="font-weight:bold;">))
</span><span style="font-weight:bold;">    </span>rank <span style="color:#ffffff;"><strong>+= </strong></span><span style="color:#f971bb;">1
</span><span style="color:#f971bb;">    </span>conn.commit<span style="font-weight:bold;">()
</span>cursor.close<span style="font-weight:bold;">()
</span>conn.close<span style="font-weight:bold;">()</span></pre>
    <p>
     <br/>
    </p>
    <h3>
     三、注意事项
    </h3>
    <p>
     这里要说明一下，数据库的连接，db是数据库的名称weibo（这个可以自己取名字），charset表示字符集为utf8，表的名称为hotsearch，里面有rank，daydate，mindate，title，url为表中的字段，作者未说明这些字段的定义，我自己定义如下：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/3c2f6a7dab6ad430bbc283688d592635.png">
      <br/>
     </img>
    </p>
    <p>
     对于varchar的类型，如果默认，则其编码模式为latin1，我刚开始不知道，运行py文件一直报错，然后网上搜索了一下，需要将latin1改为utf8，这样就对了。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/c589fb150afe2156fd68ab7996d3867c.png">
      <br/>
     </img>
    </p>
    <p>
     最终可在数据库中查看导入成功的数据。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/0d3cc804852a2086f86590170e355ffc.png">
      <br/>
     </img>
    </p>
    <h3>
     四、利用bat脚本运行py文件
    </h3>
    <p>
     当然，作者还写了利用bat直接运行py文件，这样更快些，我在网上查了下，也学会了：
    </p>
    <p>
     1、找到.py对应所在的文件目录并记录下来，比如我的就是E:\***\pythonprojects\BlogSpider
    </p>
    <p>
     2、创建一个txt文件，在文件中写入如下内容：
    </p>
    <p>
     @echo off
     <br/>
     cd E:\***\pythonprojects\BlogSpider
     <br/>
    </p>
    <p>
     start python CrawlerBlog01.py
    </p>
    <p>
     3、将txt文件改为bat后缀，然后双击运行即可。
    </p>
    <p>
     <br/>
    </p>
    <h3>
     五、参考链接：
    </h3>
    <p>
     <a href="https://blog.csdn.net/weixin_41407399/article/details/79775900">
      https://blog.csdn.net/weixin_41407399/article/details/79775900
     </a>
     <br/>
    </p>
    <p>
     <a href="https://blog.csdn.net/weixin_41407399/article/details/79775900">
      https://www.cnblogs.com/yingdiblog/p/7244228.html
     </a>
     <br/>
    </p>
    <p>
     <a href="http://s.weibo.com/top/summary" rel="nofollow">
      http://s.weibo.com/top/summary
     </a>
     <br/>
    </p>
    <p>
     <br/>
    </p>
    <p>
     <br/>
    </p>
    <p>
     <br/>
    </p>
    <p>
     <br/>
    </p>
    <p>
     <br/>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f75303130343936383537:2f61727469636c652f64657461696c732f3739383036303839" class_="artid" style="display:none">
 </p>
</div>


