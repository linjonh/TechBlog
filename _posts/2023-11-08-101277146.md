---
layout: post
title: "验证输入的字符串长度是否超过数据库字段的长度"
date: 2023-11-08 12:55:15 +0800
description: "由于一个汉字占两个字节，所以不能很简单的通过str.Length和数据库表字段的长度来比较。当然，数"
keywords: "java判断一段文字长度是否超过数据库长度"
categories: ['未分类']
tags: ['数据库', 'Java', 'C']
artid: "101277146"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=101277146
  alt: "验证输入的字符串长度是否超过数据库字段的长度"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     验证输入的字符串长度是否超过数据库字段的长度
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <div class="blogpost-body" id="cnblogs_post_body">
     <p>
      由于一个汉字占两个字节，所以不能很简单的通过str.Length和数据库表字段的长度来比较。
     </p>
     <p>
      当然，数据库(SQL SERVER)表字段的类型也是需要考虑的。CHAR/VARCHAR和NCHAR/NVARCHAR所能存储的汉字也会不一样。CHAR/VARCHAR类型的字段，一个汉字的长度为2，NCHAR/NVARCHAR类型的字段，一个汉字的长度为1。
     </p>
     <p>
      代码如下：
     </p>
     <div class="cnblogs_code">
      <pre><span style="color:#0000ff;">string</span> str = <span style="color:#800000;">"</span><span style="color:#800000;">abc程序员</span><span style="color:#800000;">"</span><span style="color:#000000;">;
</span><span style="color:#0000ff;">int</span> dataTableFieldDataLength = <span style="color:#800080;">100</span><span style="color:#000000;">;

</span><span style="color:#0000ff;">switch</span><span style="color:#000000;">(dataTableFieldDataType)
{
</span><span style="color:#0000ff;">case</span> <span style="color:#800000;">"</span><span style="color:#800000;">CHAR</span><span style="color:#800000;">"</span><span style="color:#000000;">:
</span><span style="color:#0000ff;">case</span> <span style="color:#800000;">"</span><span style="color:#800000;">VARCHAR</span><span style="color:#800000;">"</span><span style="color:#000000;">:
{
</span><span style="color:#0000ff;">int</span> length =<span style="color:#000000;"> System.Text.Encoding.Default.GetByteCount(str);
</span><span style="color:#0000ff;">if</span>(length &gt;<span style="color:#000000;"> dataTableFieldDataLength)
{
</span><span style="color:#008000;">//</span><span style="color:#008000;">超过字段允许的长度(一个汉字长度为 2)</span>
<span style="color:#000000;"> }
}
</span><span style="color:#0000ff;">case</span> <span style="color:#800000;">"</span><span style="color:#800000;">NCHAR</span><span style="color:#800000;">"</span><span style="color:#000000;">:
</span><span style="color:#0000ff;">case</span> <span style="color:#800000;">"</span><span style="color:#800000;">NVARCHAR</span><span style="color:#800000;">"</span><span style="color:#000000;">:
{
</span><span style="color:#0000ff;">int</span> length =<span style="color:#000000;"> str.Length;
</span><span style="color:#0000ff;">if</span>(length &gt;<span style="color:#000000;"> dataTableFieldDataLength)
{
</span><span style="color:#008000;">//</span><span style="color:#008000;">超过字段允许的长度(一个汉字长度为 1)</span>
<span style="color:#000000;"> }
}
} </span></pre>
</div>
<p>
</p>
<p>
其中，获取某个表的表字段的类型和长度的 SQL 如下：
</p>
<div class="cnblogs_code">
<pre><span style="color:#0000ff;">SELECT</span>
<span style="color:#ff00ff;">UPPER</span>(C.NAME) <span style="color:#0000ff;">AS</span><span style="color:#000000;"> COLNAME,
</span><span style="color:#ff00ff;">UPPER</span>(T.NAME) <span style="color:#0000ff;">AS</span><span style="color:#000000;"> COLTYPE,
</span><span style="color:#ff00ff;">UPPER</span>(C.MAX_LENGTH) <span style="color:#0000ff;">AS</span><span style="color:#000000;"> MAXLENGTH,
C.IS_NULLABLE </span><span style="color:#0000ff;">AS</span><span style="color:#000000;"> NULLABLE
</span><span style="color:#0000ff;">FROM</span><span style="color:#000000;"> SYS.COLUMNS C
</span><span style="color:#0000ff;">INNER</span> <span style="color:#808080;">JOIN</span> SYS.SYSTYPES T <span style="color:#0000ff;">ON</span> C.SYSTEM_TYPE_ID <span style="color:#808080;">=</span><span style="color:#000000;"> T.XUSERTYPE
</span><span style="color:#0000ff;">WHERE</span> C.<span style="color:#ff00ff;">OBJECT_ID</span> <span style="color:#808080;">=</span> <span style="color:#ff00ff;">OBJECT_ID</span>(<span style="color:#ff0000;">'</span><span style="color:#ff0000;">[TableName]</span><span style="color:#ff0000;">'</span>)</pre>
</div>
<p>
</p>
</div>
<p>
转载于:https://www.cnblogs.com/herohh/p/8477915.html
</p>

   </div>
  </div>
  <div id="recommendDown">
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f61696a6979616e383930352f:61727469636c652f64657461696c732f313031323737313436" class_="artid" style="display:none">
 </p>
</div>
