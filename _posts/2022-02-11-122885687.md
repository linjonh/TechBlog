---
layout: post
title: "C编写上位机连接华为云平台IoTDA"
date: 2022-02-11 18:49:20 +0800
description: "设备端（C#编写的上位机）通过MQTTS/MQTT协议接入平台，通过平台接口实现“数据上报”、“命令"
keywords: "c#可以开发云服务器吗"
categories: ['程序设计', 'C']
tags: ['物联网', '服务器', '华为云', 'Mqtt', 'C']
artid: "122885687"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=122885687
    alt: "C编写上位机连接华为云平台IoTDA"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     C#编写上位机连接华为云平台IoTDA
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night-eighties" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      C#连接华为云平台IoTDA
     </h4>
     <ul>
      <li>
       <a href="#_1" rel="nofollow">
        需求
       </a>
      </li>
      <li>
       <a href="#_3" rel="nofollow">
        前期准备
       </a>
      </li>
      <li>
       <a href="#_6" rel="nofollow">
        具体设计
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_7" rel="nofollow">
          代码目录简述：
         </a>
        </li>
        <li>
         <a href="#_16" rel="nofollow">
          工程配置参数
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_26" rel="nofollow">
        具体程序
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#Appconfig_27" rel="nofollow">
          App.config
         </a>
        </li>
        <li>
         <a href="#_49" rel="nofollow">
          主程序
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#_50" rel="nofollow">
            连接服务器
           </a>
          </li>
          <li>
           <a href="#_148" rel="nofollow">
            接收到消息
           </a>
          </li>
          <li>
           <a href="#_171" rel="nofollow">
            消息发布回调
           </a>
          </li>
          <li>
           <a href="#_201" rel="nofollow">
            服务器连接成功
           </a>
          </li>
          <li>
           <a href="#_218" rel="nofollow">
            断开服务器连接
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#_271" rel="nofollow">
          格式
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_292" rel="nofollow">
        运行界面
       </a>
      </li>
      <li>
       <a href="#_311" rel="nofollow">
        后续
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="_1">
     </a>
     需求
    </h2>
    <p>
     我们在平时的物联网开发中，往往需要用到云平台来收发数据。而光有云平台往往是不行的，我们还需要有上位机。那么怎样通过上位机连接到云平台，并且收发数据呢？本文将介绍如何通过C#编写的上位机和华为云平台通过物联网最常用MQTT协议进行连接并收发数据。介绍设备通MQTTS/MQTT协议接入平台，通过平台接口实现“数据上报”、“命令下发”的功能。
    </p>
    <h2>
     <a id="_3">
     </a>
     前期准备
    </h2>
    <ol>
     <li>
      <a href="https://download.csdn.net/download/qq_44629109/12288993">
       VS2019
      </a>
     </li>
     <li>
      华为云平台
     </li>
    </ol>
    <h2>
     <a id="_6">
     </a>
     具体设计
    </h2>
    <h3>
     <a id="_7">
     </a>
     代码目录简述：
    </h3>
    <ol>
     <li>
      App.config：Server地址和设备信息配置文件
     </li>
     <li>
      C#：项目C#代码；
     </li>
     <li>
      EncryptUtil.cs：设备密钥加密辅助类；
     </li>
     <li>
      FrmMqttDemo.cs：窗体界面；
     </li>
     <li>
      Program.cs：Demo程序启动入口。
     </li>
     <li>
      dll：项目中使用到了第三方库
     </li>
     <li>
      MQTTnet：v3.0.11，是一个基于 MQTT 通信的高性能 .NET 开源库，它同时支持MQTT 服务器端和客户端，引用库文件包含MQTTnet.dll。
     </li>
     <li>
      MQTTnet.Extensions.ManagedClient：v3.0.11，这是一个扩展库，它使用MQTTnet为托管MQTT客户机提供附加功能。
     </li>
    </ol>
    <h3>
     <a id="_16">
     </a>
     工程配置参数
    </h3>
    <p>
     App.config：需要配置服务器地址、设备ID和设备密钥，用于启动Demo程序的时
     <br/>
     候，程序将此信息自动写到Demo主界面。
    </p>
    <pre><code class="prism language-cpp"><span class="token operator">&lt;</span>add key<span class="token operator">=</span><span class="token string">"serverUri"</span> value<span class="token operator">=</span><span class="token string">"serveruri"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>add key<span class="token operator">=</span><span class="token string">"deviceId"</span> value<span class="token operator">=</span><span class="token string">"deviceid"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>add key<span class="token operator">=</span><span class="token string">"deviceSecret"</span> value<span class="token operator">=</span><span class="token string">"secret"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>add key<span class="token operator">=</span><span class="token string">"PortIsSsl"</span> value<span class="token operator">=</span><span class="token string">"8883"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>add key<span class="token operator">=</span><span class="token string">"PortNotSsl"</span> value<span class="token operator">=</span><span class="token string">"1883"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre>
    <h2>
     <a id="_26">
     </a>
     具体程序
    </h2>
    <h3>
     <a id="Appconfig_27">
     </a>
     App.config
    </h3>
    <p>
     本文件中存放的是Server地址和设备信息配置文件，我们每个人的程序主要的不同就是这个文件，虽然后面也可以在运行的时候改，但最好提前写入。
    </p>
    <pre><code class="prism language-cpp"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>configSections<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>configSections<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>startup<span class="token operator">&gt;</span> 
        <span class="token operator">&lt;</span>supportedRuntime version<span class="token operator">=</span><span class="token string">"v4.0"</span> sku<span class="token operator">=</span><span class="token string">".NETFramework,Version=v4.5.2"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>startup<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>appSettings<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>add key<span class="token operator">=</span><span class="token string">"serverUri"</span> value<span class="token operator">=</span><span class="token string">"iot-mqtts.cn-north-4.myhuaweicloud.com"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>add key<span class="token operator">=</span><span class="token string">"deviceId"</span> value<span class="token operator">=</span><span class="token string">"自己的设备ID"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>add key<span class="token operator">=</span><span class="token string">"deviceSecret"</span> value<span class="token operator">=</span><span class="token string">"自己的设备密钥"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>add key<span class="token operator">=</span><span class="token string">"portIsSsl"</span> value<span class="token operator">=</span><span class="token string">"8883"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>add key<span class="token operator">=</span><span class="token string">"portNotSsl"</span> value<span class="token operator">=</span><span class="token string">"1883"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>add key<span class="token operator">=</span><span class="token string">"language"</span> value<span class="token operator">=</span><span class="token string">"zh-CN"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>appSettings<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>

</code></pre>
    <p>
     我们将自己的自己的设备ID和自己的设备密钥填入其中，选择相应的语言，最好填中文，毕竟看的方便。
    </p>
    <h3>
     <a id="_49">
     </a>
     主程序
    </h3>
    <h4>
     <a id="_50">
     </a>
     连接服务器
    </h4>
    <pre><code class="prism language-csharp">				<span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name"><span class="token keyword">int</span></span> portIsSsl <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>AppSettings<span class="token punctuation">[</span><span class="token string">"portIsSsl"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">int</span></span> portNotSsl <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>AppSettings<span class="token punctuation">[</span><span class="token string">"portNotSsl"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>client <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MqttFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">CreateManagedMqttClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token class-name"><span class="token keyword">string</span></span> timestamp <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"yyyyMMddHH"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">string</span></span> clientID <span class="token operator">=</span> txtDeviceId<span class="token punctuation">.</span>Text <span class="token operator">+</span> <span class="token string">"_0_0_"</span> <span class="token operator">+</span> timestamp<span class="token punctuation">;</span>

                <span class="token comment">// 对密码进行HmacSHA256加密</span>
                <span class="token class-name"><span class="token keyword">string</span></span> secret <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>txtDeviceSecret<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    secret <span class="token operator">=</span> EncryptUtil<span class="token punctuation">.</span><span class="token function">HmacSHA256</span><span class="token punctuation">(</span>txtDeviceSecret<span class="token punctuation">.</span>Text<span class="token punctuation">,</span> timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// 判断是否为安全连接</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cbSSLConnect<span class="token punctuation">.</span>Checked<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ManagedMqttClientOptionsBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">WithAutoReconnectDelay</span><span class="token punctuation">(</span>TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span>RECONNECT_TIME<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">WithClientOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">MqttClientOptionsBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">WithTcpServer</span><span class="token punctuation">(</span>txtServerUri<span class="token punctuation">.</span>Text<span class="token punctuation">,</span> portNotSsl<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">WithCommunicationTimeout</span><span class="token punctuation">(</span>TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span>DEFAULT_CONNECT_TIMEOUT<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">WithCredentials</span><span class="token punctuation">(</span>txtDeviceId<span class="token punctuation">.</span>Text<span class="token punctuation">,</span> secret<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">WithClientId</span><span class="token punctuation">(</span>clientID<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">WithKeepAlivePeriod</span><span class="token punctuation">(</span>TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span>DEFAULT_KEEPLIVE<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">WithCleanSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">WithProtocolVersion</span><span class="token punctuation">(</span>MqttProtocolVersion<span class="token punctuation">.</span>V311<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name"><span class="token keyword">string</span></span> caCertPath <span class="token operator">=</span> Environment<span class="token punctuation">.</span>CurrentDirectory <span class="token operator">+</span> <span class="token string">@"\certificate\rootcert.pem"</span><span class="token punctuation">;</span>
                    <span class="token class-name">X509Certificate2</span> crt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">X509Certificate2</span><span class="token punctuation">(</span>caCertPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ManagedMqttClientOptionsBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">WithAutoReconnectDelay</span><span class="token punctuation">(</span>TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span>RECONNECT_TIME<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">WithClientOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">MqttClientOptionsBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">WithTcpServer</span><span class="token punctuation">(</span>txtServerUri<span class="token punctuation">.</span>Text<span class="token punctuation">,</span> portIsSsl<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">WithCommunicationTimeout</span><span class="token punctuation">(</span>TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span>DEFAULT_CONNECT_TIMEOUT<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">WithCredentials</span><span class="token punctuation">(</span>txtDeviceId<span class="token punctuation">.</span>Text<span class="token punctuation">,</span> secret<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">WithClientId</span><span class="token punctuation">(</span>clientID<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">WithKeepAlivePeriod</span><span class="token punctuation">(</span>TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span>DEFAULT_KEEPLIVE<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">WithCleanSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">WithTls</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">MqttClientOptionsBuilderTlsParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{<!-- --></span>
                            AllowUntrustedCertificates <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                            UseTls <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                            Certificates <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>X509Certificate<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span> crt <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            CertificateValidationHandler <span class="token operator">=</span> <span class="token keyword">delegate</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            IgnoreCertificateChainErrors <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                            IgnoreCertificateRevocationErrors <span class="token operator">=</span> <span class="token boolean">false</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">WithProtocolVersion</span><span class="token punctuation">(</span>MqttProtocolVersion<span class="token punctuation">.</span>V311<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">ShowLogs</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp"><span class="token string">"try to connect to server "</span> <span class="token operator">+</span> txtServerUri<span class="token punctuation">.</span>Text</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>IsStarted<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">StopAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// 注册事件</span>
                client<span class="token punctuation">.</span>ApplicationMessageProcessedHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ApplicationMessageProcessedHandlerDelegate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action<span class="token punctuation">&lt;</span>ApplicationMessageProcessedEventArgs<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>ApplicationMessageProcessedHandlerMethod<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 消息发布回调</span>

                client<span class="token punctuation">.</span>ApplicationMessageReceivedHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MqttApplicationMessageReceivedHandlerDelegate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action<span class="token punctuation">&lt;</span>MqttApplicationMessageReceivedEventArgs<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>MqttApplicationMessageReceived<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 命令下发回调</span>

                client<span class="token punctuation">.</span>ConnectedHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MqttClientConnectedHandlerDelegate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action<span class="token punctuation">&lt;</span>MqttClientConnectedEventArgs<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>OnMqttClientConnected<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 连接成功回调</span>

                client<span class="token punctuation">.</span>DisconnectedHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MqttClientDisconnectedHandlerDelegate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action<span class="token punctuation">&lt;</span>MqttClientDisconnectedEventArgs<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>OnMqttClientDisconnected<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 连接断开回调</span>

                <span class="token comment">// 连接平台设备</span>
                <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">StartAsync</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">ShowLogs</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"connect to mqtt server fail"</span></span> <span class="token operator">+</span> Environment<span class="token punctuation">.</span>NewLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_148">
     </a>
     接收到消息
    </h4>
    <pre><code class="prism language-csharp"><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token function">ShowLogs</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"received message is </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>ApplicationMessage<span class="token punctuation">.</span>Payload<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name"><span class="token keyword">string</span></span> msg <span class="token operator">=</span> <span class="token string">"{\"result_code\": 0,\"response_name\": \"COMMAND_RESPONSE\",\"paras\": {\"result\": \"success\"}}"</span><span class="token punctuation">;</span>

                <span class="token class-name"><span class="token keyword">string</span></span> topic <span class="token operator">=</span> <span class="token string">"$oc/devices/"</span> <span class="token operator">+</span> txtDeviceId<span class="token punctuation">.</span>Text <span class="token operator">+</span> <span class="token string">"/sys/commands/response/request_id="</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>ApplicationMessage<span class="token punctuation">.</span>Topic<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string character">'='</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

                <span class="token function">ShowLogs</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp"><span class="token string">"response message msg = "</span> <span class="token operator">+</span> msg</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token class-name"><span class="token keyword">var</span></span> appMsg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MqttApplicationMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                appMsg<span class="token punctuation">.</span>Payload <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                appMsg<span class="token punctuation">.</span>Topic <span class="token operator">=</span> topic<span class="token punctuation">;</span>
                appMsg<span class="token punctuation">.</span>QualityOfServiceLevel <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>cbOosSelect<span class="token punctuation">.</span>SelectedValue<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">?</span> MqttQualityOfServiceLevel<span class="token punctuation">.</span>AtMostOnce <span class="token punctuation">:</span> MqttQualityOfServiceLevel<span class="token punctuation">.</span>AtLeastOnce<span class="token punctuation">;</span>
                appMsg<span class="token punctuation">.</span>Retain <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

                <span class="token comment">// 上行响应</span>
                client<span class="token punctuation">.</span><span class="token function">PublishAsync</span><span class="token punctuation">(</span>appMsg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="_171">
     </a>
     消息发布回调
    </h4>
    <pre><code class="prism language-csharp"> <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>HasFailed<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token function">ShowLogs</span><span class="token punctuation">(</span><span class="token string">"publish messageId is "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>ApplicationMessage<span class="token punctuation">.</span>Id <span class="token operator">+</span> <span class="token string">", topic: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>ApplicationMessage<span class="token punctuation">.</span>ApplicationMessage<span class="token punctuation">.</span>Topic <span class="token operator">+</span> <span class="token string">", payload: "</span> <span class="token operator">+</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>ApplicationMessage<span class="token punctuation">.</span>ApplicationMessage<span class="token punctuation">.</span>Payload<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" is published fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>HasSucceeded<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token function">ShowLogs</span><span class="token punctuation">(</span><span class="token string">"publish messageId "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>ApplicationMessage<span class="token punctuation">.</span>Id <span class="token operator">+</span> <span class="token string">", topic: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>ApplicationMessage<span class="token punctuation">.</span>ApplicationMessage<span class="token punctuation">.</span>Topic <span class="token operator">+</span> <span class="token string">", payload: "</span> <span class="token operator">+</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>ApplicationMessage<span class="token punctuation">.</span>ApplicationMessage<span class="token punctuation">.</span>Payload<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" is published success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">ShowLogs</span><span class="token punctuation">(</span><span class="token string">"mqtt demo message publish error: "</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span>Message <span class="token operator">+</span> Environment<span class="token punctuation">.</span>NewLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_201">
     </a>
     服务器连接成功
    </h4>
    <pre><code class="prism language-csharp">        <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">ShowLogs</span><span class="token punctuation">(</span><span class="token string">"connect to mqtt server success, deviceId is "</span> <span class="token operator">+</span> txtDeviceId<span class="token punctuation">.</span>Text <span class="token operator">+</span> Environment<span class="token punctuation">.</span>NewLine<span class="token punctuation">)</span><span class="token punctuation">;</span>

            btnConnect<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            btnDisconnect<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            btnPublish<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            btnSubscribe<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="_218">
     </a>
     断开服务器连接
    </h4>
    <pre><code class="prism language-csharp">        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token function">ShowLogs</span><span class="token punctuation">(</span><span class="token string">"mqtt server is disconnected"</span> <span class="token operator">+</span> Environment<span class="token punctuation">.</span>NewLine<span class="token punctuation">)</span><span class="token punctuation">;</span>

                txtSubTopic<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                btnConnect<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                btnDisconnect<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                btnPublish<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                btnSubscribe<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cbReconnect<span class="token punctuation">.</span>Checked<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">ShowLogs</span><span class="token punctuation">(</span><span class="token string">"reconnect is starting"</span> <span class="token operator">+</span> Environment<span class="token punctuation">.</span>NewLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//退避重连</span>
                <span class="token class-name"><span class="token keyword">int</span></span> lowBound <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>defaultBackoff <span class="token operator">*</span> <span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">int</span></span> highBound <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>defaultBackoff <span class="token operator">*</span> <span class="token number">1.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">long</span></span> randomBackOff <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>highBound <span class="token operator">-</span> lowBound<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">long</span></span> backOffWithJitter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">Pow</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> retryTimes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>randomBackOff <span class="token operator">+</span> lowBound<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">long</span></span> waitTImeUtilNextRetry <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>minBackoff <span class="token operator">+</span> backOffWithJitter<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token class-name">maxBackoff <span class="token punctuation">?</span></span> maxBackoff <span class="token punctuation">:</span> <span class="token punctuation">(</span>minBackoff <span class="token operator">+</span> backOffWithJitter<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">ShowLogs</span><span class="token punctuation">(</span><span class="token string">"next retry time: "</span> <span class="token operator">+</span> waitTImeUtilNextRetry <span class="token operator">+</span> Environment<span class="token punctuation">.</span>NewLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>waitTImeUtilNextRetry<span class="token punctuation">)</span><span class="token punctuation">;</span>

                retryTimes<span class="token operator">++</span><span class="token punctuation">;</span>

                Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">await</span> <span class="token function">ConnectMqttServerAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token function">ShowLogs</span><span class="token punctuation">(</span><span class="token string">"mqtt demo error: "</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span>Message <span class="token operator">+</span> Environment<span class="token punctuation">.</span>NewLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_271">
     </a>
     格式
    </h3>
    <p>
     设备端上传到云平台
     <br/>
     Topic：$oc/devices/{device_id}/sys/properties/report
     <br/>
     数据格式：
    </p>
    <pre><code class="prism language-csharp">数据格式：  
<span class="token punctuation">{<!-- --></span>
    <span class="token string">"services"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">"service_id"</span><span class="token punctuation">:</span> <span class="token string">"Temperature"</span><span class="token punctuation">,</span>
            <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"smoke"</span><span class="token punctuation">:</span> <span class="token number">57</span><span class="token punctuation">,</span>
                <span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
                <span class="token string">"humidity"</span><span class="token punctuation">:</span><span class="token number">78.37673</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"event_time"</span><span class="token punctuation">:</span> <span class="token string">"20151212T121212Z"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre>
    <h2>
     <a id="_292">
     </a>
     运行界面
    </h2>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/2f3882176589346a343438a439fc8c97.png#pic_center">
      <br/>
      当我发送如下数据时：
     </img>
    </p>
    <pre><code class="prism language-csharp"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"services"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">"service_id"</span><span class="token punctuation">:</span> <span class="token string">"BS"</span><span class="token punctuation">,</span>
            <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"smoke"</span><span class="token punctuation">:</span> <span class="token number">57</span><span class="token punctuation">,</span>
                <span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
                <span class="token string">"humidity"</span><span class="token punctuation">:</span><span class="token number">78.37673</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"event_time"</span><span class="token punctuation">:</span> <span class="token string">"20151212T121212Z"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/ae06f616cd7b5251097d38a3886d244b.png#pic_center"/>
    </p>
    <h2>
     <a id="_311">
     </a>
     后续
    </h2>
    <p>
     欢迎关注我的
     <a href="https://blog.csdn.net/qq_44629109/category_11627212.html">
      毕业设计专栏
     </a>
     。
     <br/>
     关注微信公众号，发送“C#连接华为云平台”获取源码。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/098f41d3a3b6340e1913a05e4bb644fe.jpeg#pic_center"/>
    </p>
    <p>
     编写不易，感谢支持。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34343632393130392f:61727469636c652f64657461696c732f313232383835363837" class_="artid" style="display:none">
 </p>
</div>


