---
layout: post
title: "Jenkins配置前端自动打包部署若依项目"
date: 2025-01-06 20:39:06 +0800
description: "前提说明：三台服务器： gitlab 一台     jenkins一台     项目服务器。_jen"
keywords: "jenkins前端打包"
categories: ["未分类"]
tags: ["运维", "前端", "Jenkins"]
artid: "137717426"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=137717426
  alt: "Jenkins配置前端自动打包部署若依项目"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Jenkins配置前端自动打包部署（若依项目）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h4>
     <img alt="" height="324" src="https://i-blog.csdnimg.cn/blog_migrate/d10c7e23d308cd32e7d31b94197f1686.png" width="568">
      <img alt="" height="355" src="https://i-blog.csdnimg.cn/blog_migrate/75ffef14d0c95522b748fbe8497e0088.png" width="842"/>
     </img>
    </h4>
    <p>
     前提说明：三台服务器： gitlab 一台     jenkins一台     项目服务器
    </p>
    <h2>
     一、新建项目
    </h2>
    <p>
     创建一个
     <strong>
      <code>
       Freestyle Project
      </code>
     </strong>
    </p>
    <p>
     <img alt="" height="462" src="https://i-blog.csdnimg.cn/blog_migrate/e346aaf36ae7994707fe021b4a1c9d05.png" width="1200"/>
    </p>
    <h2>
     二、拉取 github 代码
    </h2>
    <p>
     点击
     <strong>
      新建 Item
     </strong>
     创建一个
     <code>
      Freestyle Project
     </code>
     <img alt="" height="895" src="https://i-blog.csdnimg.cn/blog_migrate/4c1b650ef0bc283eb4e34ba5e71e5148.png" width="1200"/>
    </p>
    <p>
    </p>
    <p>
     在配置页面--&gt;General,勾选[丢弃旧的构建]，填写保存的构建天数和构建的最大个数
    </p>
    <p>
     <img alt="" height="832" src="https://i-blog.csdnimg.cn/blog_migrate/83b58924efc8539a752a76384a5987e1.png" width="1200"/>
    </p>
    <p>
     <img alt="" height="448" src="https://i-blog.csdnimg.cn/blog_migrate/48d2510a9ebe967294455b50c34e8c90.png" width="1200"/>
    </p>
    <p>
     在
     <strong>
      源码管理
     </strong>
     处选择 git ，输入仓库地址，点击添加。
     <img alt="" height="850" src="https://i-blog.csdnimg.cn/blog_migrate/6a2250810618d8a46aa084ac6145c1ed.png" width="1200"/>
    </p>
    <h2>
     三、build 打包
    </h2>
    <p>
     <img alt="" height="307" src="https://i-blog.csdnimg.cn/blog_migrate/ce90e4a39340a38bf3198e3a63b06224.png" width="1200"/>
     <code>
      Execute shell
     </code>
     里写脚本,对前端代码进行打包压缩具体代码如下:
    </p>
    <pre><code class="language-bash">

# 安装 npm 依赖并构建项目

npm --registry https://registry.npmmirror.com install

# 构建测试环境

npm run build:stage</code></pre>
<p>
<span style="color:#fe2c24;">
脚本解释与写法总结：
</span>
</p>
<p> 1.我看很多博客 这里写很多，对于初学者 ，可能摸不到头脑，我该怎么写，才能自动构建到测试环境。
</p>
<p>
2.buid steps：构建步骤，也就是构建环境配置、打包进行处理。
</p>
<p>
首先前端打包问题。
</p>
<p>
<span style="color:#fe2c24;">
Q：jenkins 从 gitlab 服务拉取的代码在哪里打包呐？
</span>
</p>
<p>
A:拉取的代码在这目录下
<span style="color:#fe2c24;">
/var/lib/jenkins/workspace/
</span>
<img alt="" height="429" src="https://i-blog.csdnimg.cn/blog_migrate/e2f0b0c4b8fc4db300ac07b2a194ffb1.png" width="1102"/>
</p>
<p>
在 jenkins 控制台查看
<img alt="" height="433" src="https://i-blog.csdnimg.cn/blog_migrate/d02a936ea33833d80216e12c2b26e4b3.png" width="1200"/>
</p>
<p>
，代码有了，jenkins 打包，但你得安装 nodejs 吧   安装 npm  安装依赖吧，比如你的写下面这写
</p>
<pre><code class="language-bash"> 安装依赖
npm install

# 建议不要直接使用 cnpm 安装依赖，会有各种诡异的 bug。可以通过如下操作解决 npm 下载速度慢的问题

npm install --registry=https://registry.npmmirror.com
</code></pre>
<pre>然后打包，构建测试环境。使用下面命令</pre>
<pre><code class="language-bash"># 构建测试环境
npm run build:stage</code></pre>
<p>
前端打包完，会生成一个 dist 文件夹
<img alt="" height="589" src="https://i-blog.csdnimg.cn/blog_migrate/156983e6b8aca0b7d298c13740193684.png" width="1200"/>
</p>
<p>
好了。这就打包好了。也相当于 buid 好了。
</p>
<p>
接下来，我的把这个 dist 文件夹发送到另一台测试环境服务器。
</p>
<h4>
</h4>
<h2>
四、部署到测试服务器
</h2>
<blockquote>
<p>
在真实的开发场景中，
<code>
Jenkins
</code>
几乎不会和前端资源放到一个服务器。大多数情况下
<code>
Jenkins
</code>
所处的服务器环境就是一个工具用的服务器，放置了一些公司中常用的工具。因此构建到指定的服务器也至关重要。
</p>
</blockquote>
<p>
<span style="color:#956fe7;">
<strong>
1、安装发送到远程插件
</strong>
</span>
</p>
<p>
<strong>
系统管理 -&gt; 插件管理
</strong>
搜索
<code>
Publish Over SSH
</code>
进行安装。
<img alt="" height="694" src="https://i-blog.csdnimg.cn/blog_migrate/9e448332882ad99fe53b2b0584881e7e.png" width="1200"/>
</p>
<p>
</p>
<p>
<strong>
Send build artifacts over SSH
</strong>
<img alt="" height="649" src="https://i-blog.csdnimg.cn/blog_migrate/33f06456e807a9e3b35c4ca7d30965a1.png" width="1200"/>
</p>
<p>
</p>
<p>
<span style="color:#956fe7;">
<code>
选项解释：
</code>
</span>
</p>
<ul>
<li>
<code>
Source files
</code>
：
<span style="color:#fe2c24;">
要上传到目标服务器的文件。它是一个相对路径，相对于 Jenkins 的工作目录 由于上面的 build 打包后  ，在工作目录中生成一个 dist 文件夹，所以这里写相对路径    **/dist/**
</span>
<table border="1" cellpadding="1" cellspacing="1" style="width:500px;">
<tbody>
<tr>
<td>
写法
</td>
<td>
说明
</td>
</tr>
<tr>
<td>
<span style="color:#fe2c24;">
/dist/*
</span>
</td>
<td>
一个*代表 匹配 dist 文件夹所以文件，但是 dist 文件夹下面的 static 文件夹不会部署到测试服务器（不这样写）
</td>
</tr>
<tr>
<td>
<span style="color:#fe2c24;">
/dist/**
</span>
</td>
<td>
2 个\* 能把 dist 文件夹下的所有文件夹和文件都能部署到测试服务器（我这样写的）
</td>
</tr>
</tbody>
</table>
</li>
<li>
<code>
Remove prefix
</code>
：移除的路径，这里移除 dist 路径
<table border="1" cellpadding="1" cellspacing="1" style="width:500px;">
<tbody>
<tr>
<td>
比如：这里写     dist/    表示：我只部署 dist 文件夹中 static 部分内容，我肯定要把 dist 文件夹去掉，只在测试服务器显示 static 文件，这就用到这个选项了。
</td>
</tr>
</tbody>
</table>
<p>
</p>
</li>
<li>
<code>
Remote directory
</code>
：发送到的服务端路径（这里填目标服务器发送文件夹的目标路径）
<table border="1" cellpadding="1" cellspacing="1" style="width:500px;">
<tbody>
<tr>
<td>
<p> 1.这里不填：
</p>
</td>
<td>
<p>
表示你在系统设置中，也有这个插件，已经设置过了。
</p>
<p>
</p>
</td>
</tr>
<tr>
<td>
</td>
<td>
<p>
例如：我在系统设置中设置了 /opt/ruoyi        这里就不要设置了。
</p>
<p>
你如果在设置目标路径，会重复，也就是把 dist 发送到 /opt/ruoyi/opt/ruoyi/dist  子文件家中了，纯属套娃了。
</p>
</td>
</tr>
</tbody>
</table>
</li>
<li>
<code>
Exec command
</code>
：发送成功后执行的命令（选填）
<code>
</code>
</li>
</ul>
<p>
<img alt="" height="230" src="https://i-blog.csdnimg.cn/blog_migrate/75a4b66c36294b9384a7d306fb9fbb39.png" width="1200"/>
</p>
<p>
<span style="color:#956fe7;">
部署方式：（我就测试 2 种写法）
</span>
</p>
<p>
<strong> 1.把整个前端 dist 文件夹都部署上传到测试服务器   。
<span style="color:#fe2c24;">
我这样写 ：就把整个 dist 源文件夹发送到测试服务器就行，其他不写。
</span>
</strong>
<img alt="" height="649" src="https://i-blog.csdnimg.cn/blog_migrate/33f06456e807a9e3b35c4ca7d30965a1.png" width="1200"/>
</p>
<p> 2.
<strong>
把部分前端 dist 文件夹中 static 文件和其他文件部署上传到测试服务器   。（比较实用）
</strong>
</p>
<p>
<img alt="" height="738" src="https://i-blog.csdnimg.cn/blog_migrate/b17de78e9a22252f3abced217cc4699a.png" width="1200"/>
</p>
<p>
如图：
<img alt="" height="397" src="https://i-blog.csdnimg.cn/blog_migrate/22461c28d09dd35ae6a2f0e5e0d149f7.png" width="601"/>
</p>
<p>
<span style="color:#956fe7;">
说明：
</span>
</p>
<p>
<code>
Source files 写法规则介绍
</code>
：
<a href="http://www.cs.uccs.edu/~cs526/jwsdp/docs/ant/manual/dirtasks.html" rel="nofollow" title="Ant User Manual">
Ant User Manual
</a>
<a href="https://ant.apache.org/manual/dirtasks.html#patterns" rel="nofollow" title="Directory-based Tasks">
Directory-based Tasks
</a>
</p>
<blockquote>
<p>
<span style="color:#000000;">
为了使事情更加灵活，我们添加了一个额外的功能，这使得匹配多个目录级别成为可能。这可用于匹配完整的目录树，或目录树中任何位置的文件。
</span>
</p>
<p>
<span style="color:#000000;">
为此，
<code>
**
</code>
必须将用作目录的名称。
</span>
</p>
<p>
<span style="color:#000000;">
当
<code>
**
</code>
在模式中将用作目录的名称时，它将匹配零个或多个目录。
</span>
</p>
<p>
<span style="color:#000000;">
例如：
<code>
/test/**
</code>
匹配 下的所有文件/目录
<code>
/test/
</code>
，例如
<code>
/test/x.java
</code>
、 或
<code>
/test/foo/bar/xyz.html
</code>
，但不匹配
<code>
/xyz.xml
</code>
。
</span>
</p>
<p>
<span style="color:#000000;">
有一种“简写”——如果模式以
<code>
/
</code>
或结尾
<code>
\
 </code>
，则
<code>
**
</code>
附加 。
</span>
</p>
<p>
<span style="color:#000000;">
例如，
<code>
mypackage/test/
</code>
被解释为
<code>
mypackage/test/**
</code>
</span>
</p>
</blockquote>
<p>
<img alt="" height="691" src="https://i-blog.csdnimg.cn/blog_migrate/7db57e8d6e30f648e5c9491c5ae8abd7.png" width="649"/>
</p>
<p>
</p>
<h2>
五、控制台看构建是否成功
</h2>
<p>
<img alt="" height="536" src="https://i-blog.csdnimg.cn/blog_migrate/c81c0168f14f475017547bbc9a7f8e2e.png" width="778"/>
</p>
<p>
<img alt="" height="832" src="https://i-blog.csdnimg.cn/blog_migrate/66e7381cc7fcff790aab2d12d0bf7a57.png" width="1098"/>
</p>
<p>
</p>
<p>
</p>
<p>
</p>
<h3>
</h3>

   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34353837353235392f:61727469636c652f64657461696c732f313337373137343236" class_="artid" style="display:none">
 </p>
</div>
