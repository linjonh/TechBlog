---
layout: post
title: "说说如何借助webpack来优化前端性能"
date: 2025-01-13 10:19:12 +0800
description: "文章详细介绍了如何通过Webpack对前端项目进行性能优化，包括JS代码压缩（Terser）、CSS"
keywords: "webpack优化前端性能"
categories: ["未分类"]
tags: ["微信小程序", "前端框架", "前端", "Webpack", "Vue", "Node", "Javascript"]
artid: "135773952"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=135773952
  alt: "说说如何借助webpack来优化前端性能"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     说说如何借助webpack来优化前端性能？
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/69a5475beecf14a61cc4c95745427986.png"/>
    </p>
    <hr/>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#_8" rel="nofollow">
        一、背景
       </a>
      </li>
      <li>
       <a href="#_17" rel="nofollow">
        二、如何优化
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#JS_29" rel="nofollow">
          JS代码压缩
         </a>
        </li>
        <li>
         <a href="#CSS_60" rel="nofollow">
          CSS代码压缩
         </a>
        </li>
        <li>
         <a href="#Html_84" rel="nofollow">
          Html文件代码压缩
         </a>
        </li>
        <li>
         <a href="#_105" rel="nofollow">
          文件大小压缩
         </a>
        </li>
        <li>
         <a href="#_120" rel="nofollow">
          图片压缩
         </a>
        </li>
        <li>
         <a href="#Tree_Shaking_170" rel="nofollow">
          Tree Shaking
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#usedExports_180" rel="nofollow">
            usedExports
           </a>
          </li>
          <li>
           <a href="#sideEffects_195" rel="nofollow">
            sideEffects
           </a>
          </li>
          <li>
           <a href="#css_tree_shaking_211" rel="nofollow">
            css tree shaking
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#_237" rel="nofollow">
          代码分离
         </a>
        </li>
        <li>
         <a href="#chunk_265" rel="nofollow">
          内联chunk
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_280" rel="nofollow">
        三、总结
       </a>
      </li>
      <li>
       <a href="#_285" rel="nofollow">
        参考文献
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <hr/>
    <h2>
     <a id="_8">
     </a>
     一、背景
    </h2>
    <p>
     随着前端的项目逐渐扩大，必然会带来的一个问题就是性能
    </p>
    <p>
     尤其在大型复杂的项目中，前端业务可能因为一个小小的数据依赖，导致整个页面卡顿甚至奔溃
    </p>
    <p>
     一般项目在完成后，会通过webpack进行打包，利用webpack对前端项目性能优化是一个十分重要的环节
    </p>
    <hr/>
    <h2>
     <a id="_17">
     </a>
     二、如何优化
    </h2>
    <p>
     通过webpack优化前端的手段有：
    </p>
    <ul>
     <li>
      JS代码压缩
     </li>
     <li>
      CSS代码压缩
     </li>
     <li>
      Html文件代码压缩
     </li>
     <li>
      文件大小压缩
     </li>
     <li>
      图片压缩
     </li>
     <li>
      Tree Shaking
     </li>
     <li>
      代码分离
     </li>
     <li>
      内联 chunk
     </li>
    </ul>
    <h3>
     <a id="JS_29">
     </a>
     JS代码压缩
    </h3>
    <p>
     terser是一个JavaScript的解释、绞肉机、压缩机的工具集，可以帮助我们压缩、丑化我们的代码，让bundle更小
    </p>
    <p>
     在production模式下，webpack 默认就是使用 TerserPlugin 来处理我们的代码的。如果想要自定义配置它，配置方法如下：
    </p>
    <pre><code class="prism language-bash">const TerserPlugin <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span>
module.exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">..</span>.
    optimization: <span class="token punctuation">{<!-- --></span>
        minimize: true,
        minimizer: <span class="token punctuation">[</span>
            new TerserPlugin<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                parallel: <span class="token boolean">true</span> // 电脑cpu核数-1
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     属性介绍如下：
    </p>
    <ul>
     <li>
      extractComments：默认值为true，表示会将注释抽取到一个单独的文件中，开发阶段，我们可设置为 false ，不保留注释
     </li>
     <li>
      parallel：使用多进程并发运行提高构建的速度，默认值是true，并发运行的默认数量： os.cpus().length - 1
     </li>
     <li>
      terserOptions：设置我们的terser相关的配置：
     </li>
     <li>
      compress：设置压缩相关的选项，mangle：设置丑化相关的选项，可以直接设置为true
     </li>
     <li>
      mangle：设置丑化相关的选项，可以直接设置为true
     </li>
     <li>
      toplevel：底层变量是否进行转换
     </li>
     <li>
      keep_classnames：保留类的名称
     </li>
     <li>
      keep_fnames：保留函数的名称
     </li>
    </ul>
    <h3>
     <a id="CSS_60">
     </a>
     CSS代码压缩
    </h3>
    <p>
     CSS压缩通常是去除无用的空格等，因为很难去修改选择器、属性的名称、值等
    </p>
    <p>
     CSS的压缩我们可以使用另外一个插件：css-minimizer-webpack-plugin
    </p>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> css-minimizer-webpack-plugin <span class="token parameter variable">-D</span>
</code></pre>
    <p>
     配置方法如下：
    </p>
    <pre><code class="prism language-bash">const CssMinimizerPlugin <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'css-minimizer-webpack-plugin'</span><span class="token punctuation">)</span>
module.exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    // <span class="token punctuation">..</span>.
    optimization: <span class="token punctuation">{<!-- --></span>
        minimize: true,
        minimizer: <span class="token punctuation">[</span>
            new CssMinimizerPlugin<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                parallel: <span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="Html_84">
     </a>
     Html文件代码压缩
    </h3>
    <p>
     使用HtmlWebpackPlugin插件来生成HTML的模板时候，通过配置属性minify进行html优化
    </p>
    <pre><code class="prism language-bash">module.exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">..</span>.
    plugin:<span class="token punctuation">[</span>
        new HtmlwebpackPlugin<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token punctuation">..</span>.
            minify:<span class="token punctuation">{<!-- --></span>
                minifyCSS:false, // 是否压缩css
                collapseWhitespace:false, // 是否折叠空格
                removeComments:true // 是否移除注释
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     设置了minify，实际会使用另一个插件html-minifier-terser
    </p>
    <h3>
     <a id="_105">
     </a>
     文件大小压缩
    </h3>
    <p>
     对文件的大小进行压缩，减少http传输过程中宽带的损耗
    </p>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> compression-webpack-plugin <span class="token parameter variable">-D</span>
</code></pre>
    <pre><code class="prism language-bash">new ComepressionPlugin<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    test:/<span class="token punctuation">\</span>.<span class="token punctuation">(</span>css<span class="token operator">|</span>js<span class="token punctuation">)</span>$/,  // 哪些文件需要压缩
    threshold:500, // 设置文件多大开始压缩
    minRatio:0.7, // 至少压缩的比例
    algorithm:<span class="token string">"gzip"</span>, // 采用的压缩算法
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_120">
     </a>
     图片压缩
    </h3>
    <p>
     一般来说在打包之后，一些图片文件的大小是远远要比 js 或者 css 文件要来的大，所以图片压缩较为重要
    </p>
    <p>
     配置方法如下：
    </p>
    <pre><code class="prism language-bash">module: <span class="token punctuation">{<!-- --></span>
  rules: <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      test: /<span class="token punctuation">\</span>.<span class="token punctuation">(</span>png<span class="token operator">|</span>jpg<span class="token operator">|</span>gif<span class="token punctuation">)</span>$/,
      use: <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          loader: <span class="token string">'file-loader'</span>,
          options: <span class="token punctuation">{<!-- --></span>
            name: <span class="token string">'[name]_[hash].[ext]'</span>,
            outputPath: <span class="token string">'images/'</span>,
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token punctuation">{<!-- --></span>
          loader: <span class="token string">'image-webpack-loader'</span>,
          options: <span class="token punctuation">{<!-- --></span>
            // 压缩 jpeg 的配置
            mozjpeg: <span class="token punctuation">{<!-- --></span>
              progressive: true,
              quality: <span class="token number">65</span>
            <span class="token punctuation">}</span>,
            // 使用 imagemin**-optipng 压缩 png，enable: <span class="token boolean">false</span> 为关闭
            optipng: <span class="token punctuation">{<!-- --></span>
              enabled: false,
            <span class="token punctuation">}</span>,
            // 使用 imagemin-pngquant 压缩 png
            pngquant: <span class="token punctuation">{<!-- --></span>
              quality: <span class="token string">'65-90'</span>,
              speed: <span class="token number">4</span>
            <span class="token punctuation">}</span>,
            // 压缩 gif 的配置
            gifsicle: <span class="token punctuation">{<!-- --></span>
              interlaced: false,
            <span class="token punctuation">}</span>,
            // 开启 webp，会把 jpg 和 png 图片压缩为 webp 格式
            webp: <span class="token punctuation">{<!-- --></span>
              quality: <span class="token number">75</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>,
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span> 
</code></pre>
    <h3>
     <a id="Tree_Shaking_170">
     </a>
     Tree Shaking
    </h3>
    <p>
     Tree Shaking 是一个术语，在计算机中表示消除死代码，依赖于ES Module的静态语法分析（不执行任何的代码，可以明确知道模块的依赖关系）
    </p>
    <p>
     在webpack实现Trss shaking有两种不同的方案：
    </p>
    <ul>
     <li>
      usedExports：通过标记某些函数是否被使用，之后通过Terser来进行优化的
     </li>
     <li>
      sideEffects：跳过整个模块/文件，直接查看该文件是否有副作用
     </li>
    </ul>
    <p>
     两种不同的配置方案， 有不同的效果
    </p>
    <h4>
     <a id="usedExports_180">
     </a>
     usedExports
    </h4>
    <p>
     配置方法也很简单，只需要将usedExports设为true
    </p>
    <pre><code class="prism language-bash">module.exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">..</span>.
    optimization:<span class="token punctuation">{<!-- --></span>
        usedExports
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     使用之后，没被用上的代码在webpack打包中会加入unused harmony export mul注释，用来告知 Terser 在优化时，可以删除掉这段代码
    </p>
    <p>
     如下面sum函数没被用到，webpack打包会添加注释，terser在优化时，则将该函数去掉
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/93aa31c501b35b0d8678d3e89b91607a.png"/>
    </p>
    <h4>
     <a id="sideEffects_195">
     </a>
     sideEffects
    </h4>
    <p>
     sideEffects用于告知webpack compiler哪些模块时有副作用，配置方法是在package.json中设置sideEffects属性
    </p>
    <p>
     如果sideEffects设置为false，就是告知webpack可以安全的删除未用到的exports
    </p>
    <p>
     如果有些文件需要保留，可以设置为数组的形式
    </p>
    <pre><code class="prism language-bash"><span class="token string">"sideEffecis"</span>:<span class="token punctuation">[</span>
    <span class="token string">"./src/util/format.js"</span>,
    <span class="token string">"*.css"</span> // 所有的css文件
<span class="token punctuation">]</span>

</code></pre>
<p>
上述都是关于 javascript 的 tree shaking，css 同样也能够实现 tree shaking
</p>
<h4>
<a id="css_tree_shaking_211">
</a>
css tree shaking
</h4>
<p>
css 进行 tree shaking 优化可以安装 PurgeCss 插件
</p>
<pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> purgecss-plugin-webpack <span class="token parameter variable">-D</span>
</code></pre>
<pre><code class="prism language-bash">const PurgeCssPlugin <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'purgecss-webpack-plugin'</span><span class="token punctuation">)</span>
module.exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">..</span>.
plugins:<span class="token punctuation">[</span>
new PurgeCssPlugin<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
path:glob.sync<span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>$<span class="token punctuation">{<!-- --></span>path.resolve<span class="token punctuation">(</span><span class="token string">'./src'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>/**/*<span class="token variable">`</span></span><span class="token punctuation">)</span>, <span class="token punctuation">{<!-- --></span>nodir:true<span class="token punctuation">}</span>// src 里面的所有文件
satelist:<span class="token function-name function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token builtin class-name">return</span> <span class="token punctuation">{<!-- --></span>
standard:<span class="token punctuation">[</span><span class="token string">"html"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>
paths：表示要检测哪些目录下的内容需要被分析，配合使用 glob
</li>
<li>
默认情况下，Purgecss 会将我们的 html 标签的样式移除掉，如果我们希望保留，可以添加一个 safelist 的属性
</li>
</ul>
<h3>
<a id="_237">
</a>
代码分离
</h3>
<p>
将代码分离到不同的 bundle 中，之后我们可以按需加载，或者并行加载这些文件
</p>
<p>
默认情况下，所有的 JavaScript 代码（业务代码、第三方依赖、暂时没有用到的模块）在首页全部都加载，就会影响首页的加载速度
</p>
<p>
代码分离可以分出出更小的 bundle，以及控制资源加载优先级，提供代码的加载性能
</p>
<p>
这里通过 splitChunksPlugin 来实现，该插件 webpack 已经默认安装和集成，只需要配置即可
</p>
<p>
默认配置中，chunks 仅仅针对于异步（async）请求，我们可以设置为 initial 或者 all
</p>
<pre><code class="prism language-bash">module.exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">..</span>.
optimization:<span class="token punctuation">{<!-- --></span>
splitChunks:<span class="token punctuation">{<!-- --></span>
chunks:<span class="token string">"all"</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>
splitChunks 主要属性有如下：
</p>
<ul>
<li>
Chunks，对同步代码还是异步代码进行处理
</li>
<li>
minSize： 拆分包的大小, 至少为 minSize，如何包的大小不超过 minSize，这个包不会拆分
</li>
<li>
maxSize： 将大于 maxSize 的包，拆分为不小于 minSize 的包
</li>
<li>
minChunks：被引入的次数，默认是 1
</li>
</ul>
<h3>
<a id="chunk_265">
</a>
内联 chunk
</h3>
<p>
可以通过 InlineChunkHtmlPlugin 插件将一些 chunk 的模块内联到 html，如 runtime 的代码（对模块进行解析、加载、模块信息相关的代码），代码量并不大，但是必须加载的
</p>
<pre><code class="prism language-bash">const InlineChunkHtmlPlugin <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'react-dev-utils/InlineChunkHtmlPlugin'</span><span class="token punctuation">)</span>
const HtmlWebpackPlugin <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
module.exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">..</span>.
plugin:<span class="token punctuation">[</span>
new InlineChunkHtmlPlugin<span class="token punctuation">(</span>HtmlWebpackPlugin,<span class="token punctuation">[</span>/runtime.+<span class="token punctuation">\</span>.js/<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<hr/>
<h2>
<a id="_280">
</a>
三、总结
</h2>
<p>
关于 webpack 对前端性能的优化，可以通过文件体积大小入手，其次还可通过分包的形式、减少 http 请求次数等方式，实现对前端性能的优化
</p>
<hr/>
<h2>
<a id="_285">
</a>
参考文献
</h2>
<ul>
<li>
https://zhuanlan.zhihu.com/p/139498741
</li>
<li>
https://vue3js.cn/interview/
</li>
</ul>
<hr/>
<p>
希望本文能够对您有所帮助！如果您有任何问题或建议，请随时在评论区留言联系
<strong>
<a href="https://blog.csdn.net/weixin_69422396">
章挨踢（章 IT）
</a>
</strong>
<br/>
谢谢阅读！
</p>

   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f36393432323339362f:61727469636c652f64657461696c732f313335373733393532" class_="artid" style="display:none">
 </p>
</div>
