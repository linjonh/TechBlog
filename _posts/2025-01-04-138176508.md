---
layout: post
title: "Modbus通信协议"
date: 2025-01-04 15:44:39 +0800
description: "Modbus是一种常用的通信协议，用于在不同设备之间进行数据传输。它是一种简单而有效的通信协议，广泛"
keywords: "modbus通讯协议"
categories: ['未分类']
tags: ['网络协议', '网络', '信息与通信']
artid: "138176508"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=138176508
  alt: "Modbus通信协议"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Modbus通信协议
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="Modbus_0">
     </a>
     Modbus通信协议
    </h2>
    <h3>
     <a id="Modbus__2">
     </a>
     一、Modbus 协议简介
    </h3>
    <p>
     Modbus是一种常用的通信协议，用于在不同设备之间进行数据传输。它是一种简单而有效的通信协议，广泛应用于工业自动化领域。Modbus协议可以通过Modbus网络进行传输，也可以在其他类型网络上进行传输。在Modbus通信中，存在查询-回应的周期。
    </p>
    <h3>
     <a id="_5">
     </a>
     二、两种传输方式
    </h3>
    <p>
     Modbus协议支持两种传输方式：ASCII模式和RTU模式。
    </p>
    <ol>
     <li>
      <p>
       ASCII模式：在ASCII模式下，数据以ASCII字符形式传输。每个数据字节都被转换为两个ASCII字符，其中一个字符表示高4位，另一个字符表示低4位。ASCII模式相对较为可读，但传输效率较低。
      </p>
     </li>
     <li>
      <p>
       RTU模式：在RTU模式下，数据以二进制形式传输。每个数据字节都以二进制形式传输，没有转换成字符。RTU模式传输效率较高，但不易读取。
      </p>
     </li>
    </ol>
    <h3>
     <a id="Modbus_12">
     </a>
     三、Modbus消息帧
    </h3>
    <p>
     Modbus消息帧是Modbus协议中的基本数据单元，用于在设备之间传输数据。根据传输方式的不同，Modbus消息帧分为ASCII帧和RTU帧。
    </p>
    <ol>
     <li>
      <p>
       ASCII帧：ASCII帧由起始符号、设备地址、功能码、数据和校验字段组成。起始符号是一个冒号（:），用于表示帧的开始。设备地址指示消息发送或接收的设备。功能码表示要执行的操作类型。数据字段包含要传输的数据。校验字段用于检测数据的完整性。
      </p>
     </li>
     <li>
      <p>
       RTU帧：RTU帧由设备地址、功能码、数据、校验字段组成。设备地址、功能码和校验字段的格式在RTU模式下与ASCII模式略有不同。
      </p>
     </li>
     <li>
      <p>
       地址域：地址域用于指示特定设备在通信中的地址。
      </p>
     </li>
     <li>
      <p>
       如何处理功能域：功能域用于指示执行的操作类型，如读取、写入等。
      </p>
     </li>
     <li>
      <p>
       数据域：数据域包含要传输的具体数据。
      </p>
     </li>
     <li>
      <p>
       错误检测域：错误检测域用于检测数据传输过程中是否存在错误。
      </p>
     </li>
    </ol>
    <h3>
     <a id="_27">
     </a>
     四、错误检测方法
    </h3>
    <p>
     Modbus协议使用不同的错误检测方法来确保数据传输的准确性。
    </p>
    <ol>
     <li>
      <p>
       奇偶校验：奇偶校验是一种简单的错误检测方法，通过检查数据中1的个数来确定奇偶性。如果数据中1的个数为奇数，校验位设置为0，如果为偶数，校验位设置为1。
      </p>
     </li>
     <li>
      <p>
       LRC检测：LRC（Longitudinal Redundancy Check）是一种更可靠的错误检测方法，通过对数据进行异或运算来计算校验值。发送方将计算得到的校验值附加到数据帧中，接收方通过重新进行异或运算来验证数据的完整性。
      </p>
     </li>
     <li>
      <p>
       CRC检测：CRC（Cyclic Redundancy Check）是一种常用的错误检测方法，通过对数据进行多项式除法运算来计算校验值。发送方将计算得到的校验值附加到数据帧中，接收方通过进行同样的多项式除法运算来验证数据的完整性。
      </p>
     </li>
    </ol>
    <h3>
     <a id="MODBUS_36">
     </a>
     五、MODBUS通讯协议及编程
    </h3>
    <ol>
     <li>
      <p>
       Modbus-RTU协议
       <br/>
       1.1. 帧结构：Modbus-RTU协议的帧结构与前面提到的RTU帧相同，包括设备地址、功能码、数据和校验字段。
      </p>
      <p>
       1.2. 常用功能码：Modbus-RTU协议定义了一系列常用的功能码，用于执行不同的操作，如读取保持寄存器、写入单个寄存器、写入多个寄存器等。
      </p>
      <p>
       1.3. 常用功能码使用举例分析：
       <br/>
       1.3.1 功能码-0x03读保持寄存器：该功能码用于从设备中读取一个或多个保持寄存器的值。
       <br/>
       1.3.2 功能码-0x06写单个寄存器：该功能码用于向设备中写入一个保持寄存器的值。
       <br/>
       1.3.3 功能码-0x10写多个寄存器：该功能码用于向设备中写入多个连续的保持寄存器的值。
      </p>
     </li>
     <li>
      <p>
       Modbus-ASCII
       <br/>
       2.1 Modbus-ASCII简介：Modbus-ASCII是一种基于ASCII码的Modbus通信协议。数据以ASCII字符形式传输，每个字节由两个ASCII字符表示。
      </p>
      <p>
       2.2. 帧形式：Modbus-ASCII的帧形式与前面提到的ASCII帧相同，包括起始符号、设备地址、功能码、数据和校验字段。
      </p>
     </li>
     <li>
      <p>
       Modbus-TCP
       <br/>
       3.1 Modbus-TCP帧形式：Modbus-TCP是基于TCP/IP协议的Modbus通信协议。数据以二进制形式通过TCP/IP网络传输。
      </p>
      <p>
       3.2. Modbus-TCP使用举例分析：在Modbus-TCP通信中，使用TCP/IP套接字进行通信。客户端通过建立TCP连接向服务器发送Modbus请求，服务器接收请求并返回相应的数据。
      </p>
     </li>
    </ol>
    <p>
     以上是关于Modbus通信协议的详细解析。通过了解Modbus协议的帧结构、传输方式和错误检测方法，可以更好地理解和应用Modbus通信协议及相关编程。
    </p>
    <p>
     <strong>
      以下是一些常见的示例，涵盖了使用Modbus协议进行数据读取和写入的情况:
     </strong>
    </p>
    <ol>
     <li>
      使用Modbus-RTU进行数据读取：
     </li>
    </ol>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">Modbus<span class="token punctuation">.</span>Device</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>Ports</span><span class="token punctuation">;</span>

<span class="token comment">// 创建串口连接</span>
<span class="token class-name">SerialPort</span> serialPort <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SerialPort</span><span class="token punctuation">(</span><span class="token string">"COM1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
serialPort<span class="token punctuation">.</span>BaudRate <span class="token operator">=</span> <span class="token number">9600</span><span class="token punctuation">;</span>
serialPort<span class="token punctuation">.</span>DataBits <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
serialPort<span class="token punctuation">.</span>Parity <span class="token operator">=</span> Parity<span class="token punctuation">.</span>None<span class="token punctuation">;</span>
serialPort<span class="token punctuation">.</span>StopBits <span class="token operator">=</span> StopBits<span class="token punctuation">.</span>One<span class="token punctuation">;</span>
serialPort<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建 Modbus Master</span>
<span class="token class-name">IModbusSerialMaster</span> modbusMaster <span class="token operator">=</span> ModbusSerialMaster<span class="token punctuation">.</span><span class="token function">CreateRtu</span><span class="token punctuation">(</span>serialPort<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 读取保持寄存器的值</span>
<span class="token class-name"><span class="token keyword">ushort</span></span> startAddress <span class="token operator">=</span> <span class="token number">0x0000</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">ushort</span></span> numRegisters <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">ushort</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> registers <span class="token operator">=</span> modbusMaster<span class="token punctuation">.</span><span class="token function">ReadHoldingRegisters</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> startAddress<span class="token punctuation">,</span> numRegisters<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 打印读取的结果</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numRegisters<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Register </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">startAddress <span class="token operator">+</span> i</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">registers<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 关闭串口连接</span>
serialPort<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ol start="2">
<li>
使用 Modbus-RTU 进行数据写入：
</li>
</ol>
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">Modbus<span class="token punctuation">.</span>Device</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>Ports</span><span class="token punctuation">;</span>

<span class="token comment">// 创建串口连接</span>
<span class="token class-name">SerialPort</span> serialPort <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SerialPort</span><span class="token punctuation">(</span><span class="token string">"COM1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
serialPort<span class="token punctuation">.</span>BaudRate <span class="token operator">=</span> <span class="token number">9600</span><span class="token punctuation">;</span>
serialPort<span class="token punctuation">.</span>DataBits <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
serialPort<span class="token punctuation">.</span>Parity <span class="token operator">=</span> Parity<span class="token punctuation">.</span>None<span class="token punctuation">;</span>
serialPort<span class="token punctuation">.</span>StopBits <span class="token operator">=</span> StopBits<span class="token punctuation">.</span>One<span class="token punctuation">;</span>
serialPort<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建 Modbus Master</span>
<span class="token class-name">IModbusSerialMaster</span> modbusMaster <span class="token operator">=</span> ModbusSerialMaster<span class="token punctuation">.</span><span class="token function">CreateRtu</span><span class="token punctuation">(</span>serialPort<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 写入单个保持寄存器的值</span>
<span class="token class-name"><span class="token keyword">ushort</span></span> registerAddress <span class="token operator">=</span> <span class="token number">0x0000</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">ushort</span></span> <span class="token keyword">value</span> <span class="token operator">=</span> <span class="token number">12345</span><span class="token punctuation">;</span>
modbusMaster<span class="token punctuation">.</span><span class="token function">WriteSingleRegister</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> registerAddress<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Write operation completed."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 关闭串口连接</span>
serialPort<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre><code class="prism language-csharp"><span class="token number">3</span><span class="token punctuation">.</span> 使用 Modbus<span class="token operator">-</span>TCP 进行数据读取：

<span class="token keyword">using</span> <span class="token namespace">Modbus<span class="token punctuation">.</span>Device</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Sockets</span><span class="token punctuation">;</span>

<span class="token comment">// 创建 TCP 连接</span>
<span class="token class-name">TcpClient</span> tcpClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TcpClient</span><span class="token punctuation">(</span><span class="token string">"192.168.1.1"</span><span class="token punctuation">,</span> <span class="token number">502</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建 Modbus Master</span>
<span class="token class-name">IModbusMaster</span> modbusMaster <span class="token operator">=</span> ModbusIpMaster<span class="token punctuation">.</span><span class="token function">CreateIp</span><span class="token punctuation">(</span>tcpClient<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 读取保持寄存器的值</span>
<span class="token class-name"><span class="token keyword">ushort</span></span> startAddress <span class="token operator">=</span> <span class="token number">0x0000</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">ushort</span></span> numRegisters <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">ushort</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> registers <span class="token operator">=</span> modbusMaster<span class="token punctuation">.</span><span class="token function">ReadHoldingRegisters</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> startAddress<span class="token punctuation">,</span> numRegisters<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 打印读取的结果</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numRegisters<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Register </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">startAddress <span class="token operator">+</span> i</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">registers<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 关闭 TCP 连接</span>
tcpClient<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>
这些示例代码演示了使用 C#与 Modbus 设备进行通信的基本操作，包括数据读取和写入。您可以根据实际需求进行修改和扩展，以适应您的应用场景和设备要求。请确保根据实际情况配置正确的串口或 TCP 连接参数，并根据设备的寄存器地址和功能码进行相应的读写操作。
</p>

   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f6a717272676d76746b2f:61727469636c652f64657461696c732f313338313736353038" class_="artid" style="display:none">
 </p>
</div>
