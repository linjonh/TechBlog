---
layout: post
title: "如何基于-ZEGO-SDK-实现-Android-一对一音视频聊天应用"
date: 2022-04-01 19:59:09 +0800
description: "疫情期间，很多线下活动转为线上举行，实时音视频的需求剧增，在视频会议，在线教育，电商购物等众多场景成"
keywords: "如何基于 ZEGO SDK 实现 Android 一对一音视频聊天应用"
categories: ['']
tags: ['音视频', '实时音视频', 'Android']
artid: "123899090"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=123899090
    alt: "如何基于-ZEGO-SDK-实现-Android-一对一音视频聊天应用"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     如何基于 ZEGO SDK 实现 Android 一对一音视频聊天应用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <br/>
    <p>
     疫情期间，很多线下活动转为线上举行，实时音视频的需求剧增，在视频会议，在线教育，电商购物等众多场景成了“生活新常态”。
    </p>
    <p>
     本文将教你如何通过即构ZEGO sdk在Android端搭建视频通话能力。即构SDK提供100+种行业解决方案，每月赠送10000分钟免费时长，提供免费接入体验。
    </p>
    <p>
     <strong>
      接下来我们看看完整的实现流程。
     </strong>
     <br/>
     <br/>
    </p>
    <h5>
     <a id="1__10">
     </a>
     1 准备环境
    </h5>
    <p>
     在开始集成 ZEGO Express SDK 前，请确保开发环境满足以下要求：
     <br/>
     Android Studio 2020.3.1 或以上版本。
     <br/>
     Android SDK 25、Android SDK Build-Tools 25.0.2、Android SDK Platform-Tools 25.x.x 或以上版本。
     <br/>
     Android 4.4 或以上版本，且支持音视频的 Android 设备。
     <br/>
     Android 设备已经连接到 Internet。
     <br/>
     <br/>
    </p>
    <h5>
     <a id="2__18">
     </a>
     2 项目准备
    </h5>
    <h6>
     <a id="21__19">
     </a>
     2.1 创建项目
    </h6>
    <p>
     进入
     <a href="https://zegoguanwang.datasink.sensorsdata.cn/t/cs" rel="nofollow">
      即构官网
     </a>
     注册帐号后登录，在
     <a href="https://zegoguanwang.datasink.sensorsdata.cn/t/cs" rel="nofollow">
      【ZEGO控制台】
     </a>
     创建项目，找到左侧导航栏单击“概览”，按如下场景操作：
    </p>
    <ul>
     <li>
      首次创建：单击“我的项目”栏目中的“创建第一个项目，免费试用”。
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1b99d8262b2f09bc78b4ae64f052e29c.png"/>
     </li>
     <li>
      非首次创建：在“我的项目”栏目中，单击右上角的“创建项目”。
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b48d0d17a68d039c7beef4345e1d9751.png"/>
     </li>
    </ul>
    <p>
     整个项目创建预计只需3～5分钟，创建过程同时也获取了App ID，这一步很关键，可用于SDK的集成和配置；
    </p>
    <p>
     完成项目创建后，可以在该项目下“查看”的相关信息，包括基本信息、配置信息和辅助工具。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b19a5b8a3e6cbaa8fc2817bb7d310c5a.png"/>
    </p>
    <h6>
     <a id="22_Token__35">
     </a>
     2.2 Token 鉴权
    </h6>
    <p>
     登录房间时必须 使用 Token 鉴权 ，可参考
     <a href="https://doc-zh.zego.im/article/10360" rel="nofollow">
      Token 鉴权教程
     </a>
     。
    </p>
    <p>
     为了方便开发阶段的调试，开发者可直接在 ZEGO 控制台获取临时 Token（有效期为 24 小时） 来使用，详情请参考
     <a href="https://doc-zh.zego.im/article/12107" rel="nofollow">
      控制台（新版） - 项目管理
     </a>
     中的 “项目信息”。
     <br/>
     <br/>
    </p>
    <p>
     音视频临时 Token：开发者在登录房间时必须带上 Token 参数，来验证用户的合法性，为方便您体验和测试，可在控制台直接获取临时 Token 来使用。
    </p>
    <ol>
     <li>
      单击“点击生成”。
     </li>
     <li>
      在弹出的“生成临时 Token”窗口中输入 “RoomId” 和 “UserId” 后，单击“生成”即可快速生成临时 Token，方便开发阶段进行调试。
     </li>
    </ol>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c6ee9d018339d27e8bff83e43abbf3a7.png"/>
    </p>
    <h5>
     <a id="3__51">
     </a>
     3 集成
    </h5>
    <h6>
     <a id="31__52">
     </a>
     3.1 项目设置
    </h6>
    <p>
     开始集成前，可参考如下步骤设置你的项目；
     <br/>
     如已有项目，本步骤可忽略。
     <br/>
     如需新建项目，可按照以下步骤创建你的新项目：
    </p>
    <p>
     1.打开 Android Studio，选择 “File &gt; New &gt; New Project” 菜单。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7f81e71b3955326426f5209972983e3d.png#pic_center">
      <br/>
      2.填写项目名及项目存储路径。
     </img>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c8b753e550fb7570e665867ba86f6d2b.png#pic_center"/>
    </p>
    <p>
     3.其它按照默认设置，单击 “Next”，最后单击 “Finish” 完成新工程创建。
     <br/>
     <br/>
    </p>
    <h6>
     <a id="32__SDK_66">
     </a>
     3.2 导入 SDK
    </h6>
    <p>
     目前支持的平台架构包括：armeabi-v7a、arm64-v8a、x86、x86_64。
    </p>
    <p>
     在实现基本的实时音视频功能之前，需确保获取的sdk为最新版本，保证音视频功能体验为最优；
    </p>
    <ul>
     <li>
      使用 JitPack 自动集成 SDK
     </li>
    </ul>
    <p>
     进入项目根目录，打开 “build.gradle” 文件，在 “allprojects” 中加入如下代码。
    </p>
    <pre><code class="prism language-java"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
allprojects <span class="token punctuation">{<!-- --></span>
    repositories <span class="token punctuation">{<!-- --></span>
        maven <span class="token punctuation">{<!-- --></span> url 'https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>jitpack<span class="token punctuation">.</span>io' <span class="token punctuation">}</span>
        <span class="token function">google</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">jcenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     进入 “app” 目录，打开 “build.gradle” 文件，在 “dependencies” 中添加 implementation ‘com.github.zegolibrary:express-video:2.+’，这样能获取到最新的版本。
    </p>
    <pre><code class="prism language-java"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
dependencies <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    implementation 'com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>zegolibrary<span class="token operator">:</span>express<span class="token operator">-</span>video<span class="token operator">:</span><span class="token number">2.</span><span class="token operator">+</span>'
<span class="token punctuation">}</span>
</code></pre>
    <br/>
    <h5>
     <a id="4__98">
     </a>
     4 设置权限
    </h5>
    <p>
     以上步骤集成已完成，为保证SDK运行效果更佳，需要在应用中设置所需的权限，步骤如下：
    </p>
    <p>
     进入 “app/src/main” 目录，打开 “AndroidManifest.xml” 文件，添加权限。
     <br/>
     <br/>
    </p>
    <pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> SDK 必须使用的权限 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.ACCESS_WIFI_STATE"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.RECORD_AUDIO"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.INTERNET"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.ACCESS_NETWORK_STATE"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.CAMERA"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.BLUETOOTH"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.MODIFY_AUDIO_SETTINGS"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.WRITE_EXTERNAL_STORAGE"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token class-name">App</span> 需要使用的部分权限 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.READ_PHONE_STATE"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.WAKE_LOCK"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>feature
    android<span class="token operator">:</span>glEsVersion<span class="token operator">=</span><span class="token string">"0x00020000"</span>
    android<span class="token operator">:</span>required<span class="token operator">=</span><span class="token string">"true"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>feature android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.hardware.camera"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>feature android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.hardware.camera.autofocus"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre>
    <p>
     因为 Android 6.0 在一些比较重要的权限上要求必须申请动态权限，不能只通过 “AndroidMainfest.xml” 文件申请静态权限。因此还需要参考执行如下代码，其中 “requestPermissions” 是 “Activity” 的方法。
     <br/>
     <br/>
    </p>
    <pre><code class="prism language-java"><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> permissionNeeded <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"android.permission.CAMERA"</span><span class="token punctuation">,</span>
    <span class="token string">"android.permission.RECORD_AUDIO"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> <span class="token class-name">Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>M</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ContextCompat</span><span class="token punctuation">.</span><span class="token function">checkSelfPermission</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"android.permission.CAMERA"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span>PERMISSION_GRANTED <span class="token operator">||</span>
        <span class="token class-name">ContextCompat</span><span class="token punctuation">.</span><span class="token function">checkSelfPermission</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"android.permission.RECORD_AUDIO"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span>PERMISSION_GRANTED<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">requestPermissions</span><span class="token punctuation">(</span>permissionNeeded<span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     具体的权限说明如下：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f9b9e4c6fe16dadf5e48e5b5ed3d3ecc.png#pic_center"/>
    </p>
    <br/>
    <p>
     其中非必要权限 “android.permission.READ_PHONE_STATE” 仅用于实现 SDK 的打断事件处理，因此只需在 AndroidMainfest.xml 文件中进行声明即可，不需要动态申请（业务方有需求则另外处理）。
    </p>
    <br/>
    <h5>
     <a id="5__152">
     </a>
     5 防止混淆代码
    </h5>
    <p>
     在 “proguard-rules.pro” 文件中，为 SDK 添加 -keep 类的配置，防止混淆 SDK 公共类名称。
    </p>
    <pre><code class="prism language-java"><span class="token operator">-</span>keep <span class="token keyword">class</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">.</span>zego<span class="token punctuation">.</span>*<span class="token operator">*</span><span class="token punctuation">{<!-- --></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre>
    <p>
     至此，我们已经完成了ZEGO Android SDK的自动集成，已实现了音视频的基础能力。接下来可在此基础上实现在线KTV，云健身，线上剧本杀等当下热门玩法。
    </p>
    <p>
     接下来的内容，我将给大家分享音视频的常用功能，如Token 鉴权，创建房间，一对一视频通话等；
    </p>
    <br/>
    <h5>
     <a id="6__166">
     </a>
     6 实现流程
    </h5>
    <p>
     用户通过 ZEGO Express SDK 进行视频通话的基本流程为：
     <br/>
     用户 A、B 加入房间，用户 B 预览并将音视频流推送到 ZEGO 云服务（推流），用户 A 收到用户 B 推送音视频流的通知之后，在通知中播放用户 B 的音视频流（拉流）。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e5916a8b62eed17e4fa2d2d55ed1cd78.png#pic_center"/>
     <br/>
     <br/>
    </p>
    <p>
     整个音视频通话推拉流过程的 API 调用时序如下图：
     <br/>
     <br/>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/41151d4a0cec844e2a72966614f6bb0a.png#pic_center"/>
     <br/>
     <br/>
    </p>
    <h5>
     <a id="61__180">
     </a>
     6.1 初始化
    </h5>
    <h6>
     <a id="1__182">
     </a>
     1. 创建界面
    </h6>
    <p>
     根据场景需要，为你的项目创建视频通话的用户界面。我们推荐你在项目中添加如下元素：
    </p>
    <ul>
     <li>
      本地视频窗口
     </li>
     <li>
      远端视频窗口
     </li>
     <li>
      结束通话按钮
     </li>
    </ul>
    <br/>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a26fa6d7d28b76ad967a752f70d0f346.png#pic_center"/>
     <br/>
     <br/>
    </p>
    <p>
     界面代码示例：
     <br/>
     <br/>
    </p>
    <pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token class-name">RelativeLayout</span> xmlns<span class="token operator">:</span>android<span class="token operator">=</span><span class="token string">"http://schemas.android.com/apk/res/android"</span>
    xmlns<span class="token operator">:</span>tools<span class="token operator">=</span><span class="token string">"http://schemas.android.com/tools"</span>
    android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"match_parent"</span>
    android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"match_parent"</span>
    tools<span class="token operator">:</span>context<span class="token operator">=</span><span class="token string">".Playing"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">TextureView</span>
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/logView"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"match_parent"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"50dp"</span>
        android<span class="token operator">:</span>layout_alignParentTop<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">TextureView</span>
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/previewView"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"match_parent"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"match_parent"</span>
        android<span class="token operator">:</span>layout_below<span class="token operator">=</span><span class="token string">"@id/logView"</span>
        android<span class="token operator">:</span>layout_alignParentBottom<span class="token operator">=</span><span class="token string">"true"</span>
        android<span class="token operator">:</span>layout_alignParentLeft<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">TextView</span>
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/roomIDTextView"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>text<span class="token operator">=</span><span class="token string">""</span>
        android<span class="token operator">:</span>layout_margin<span class="token operator">=</span><span class="token string">"10dp"</span>
        android<span class="token operator">:</span>textColor<span class="token operator">=</span><span class="token string">"@color/black"</span>
        android<span class="token operator">:</span>textSize<span class="token operator">=</span><span class="token string">"12sp"</span>
        android<span class="token operator">:</span>layout_below<span class="token operator">=</span><span class="token string">"@+id/logView"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">TextView</span>
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/userIDTextView"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>text<span class="token operator">=</span><span class="token string">""</span>
        android<span class="token operator">:</span>layout_margin<span class="token operator">=</span><span class="token string">"5dp"</span>
        android<span class="token operator">:</span>textColor<span class="token operator">=</span><span class="token string">"@color/black"</span>
        android<span class="token operator">:</span>textSize<span class="token operator">=</span><span class="token string">"12sp"</span>
        android<span class="token operator">:</span>layout_below<span class="token operator">=</span><span class="token string">"@+id/roomIDTextView"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">TextView</span>
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/publishStreamIDTextView"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>text<span class="token operator">=</span><span class="token string">""</span>
        android<span class="token operator">:</span>layout_margin<span class="token operator">=</span><span class="token string">"5dp"</span>
        android<span class="token operator">:</span>textColor<span class="token operator">=</span><span class="token string">"@color/black"</span>
        android<span class="token operator">:</span>textSize<span class="token operator">=</span><span class="token string">"12sp"</span>
        android<span class="token operator">:</span>layout_below<span class="token operator">=</span><span class="token string">"@+id/userIDTextView"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Button</span>
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/stopButton"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>text<span class="token operator">=</span><span class="token string">"Stop"</span>
        android<span class="token operator">:</span>textSize<span class="token operator">=</span><span class="token string">"15sp"</span>
        android<span class="token operator">:</span>layout_alignParentBottom<span class="token operator">=</span><span class="token string">"true"</span>
        android<span class="token operator">:</span>layout_marginBottom<span class="token operator">=</span><span class="token string">"30dp"</span>
        android<span class="token operator">:</span>layout_centerHorizontal<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token class-name">TextureView</span>
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/playView"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"108dp"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"192dp"</span>
        android<span class="token operator">:</span>layout_below<span class="token operator">=</span><span class="token string">"@id/logView"</span>
        android<span class="token operator">:</span>layout_alignParentRight<span class="token operator">=</span><span class="token string">"true"</span>
        android<span class="token operator">:</span>layout_margin<span class="token operator">=</span><span class="token string">"10dp"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token class-name">RelativeLayout</span><span class="token operator">&gt;</span>
</code></pre>
    <br/>
    <h6>
     <a id="2__263">
     </a>
     2. 创建引擎
    </h6>
    <p>
     调用 createEngine 接口，将申请到的 AppID 传入参数 “appID” ，创建引擎单例对象。
     <br/>
     注册回调，可将实现了 IZegoEventHandler 的对象（例如 “self”）传入参数 “eventHandler”。
    </p>
    <pre><code class="prism language-java"><span class="token comment">// 创建引擎，通用场景接入，并注册 self 为 eventHandler 回调</span>
<span class="token comment">// 不需要注册回调的话，eventHandler 参数可以传 null，后续可调用 "setEventHandler:" 方法设置回调</span>
<span class="token class-name">ZegoEngineProfile</span> profile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZegoEngineProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
profile<span class="token punctuation">.</span>appID <span class="token operator">=</span> <span class="token punctuation">;</span>  <span class="token comment">// 请通过官网注册获取，格式为：1234567890L</span>
profile<span class="token punctuation">.</span>scenario <span class="token operator">=</span> <span class="token class-name">ZegoScenario</span><span class="token punctuation">.</span>GENERAL<span class="token punctuation">;</span>  <span class="token comment">// 通用场景接入</span>
profile<span class="token punctuation">.</span>application <span class="token operator">=</span> <span class="token function">getApplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
engine <span class="token operator">=</span> <span class="token class-name">ZegoExpressEngine</span><span class="token punctuation">.</span><span class="token function">createEngine</span><span class="token punctuation">(</span>profile<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <br/>
    <h5>
     <a id="62__279">
     </a>
     6.2 登录房间
    </h5>
    <ul>
     <li>
      <p>
       登录房间时必须 使用
       <a href="https://doc-zh.zego.im/article/10360" rel="nofollow">
        Token 鉴权
       </a>
       ，否则会登录失败。
      </p>
     </li>
     <li>
      <p>
       为了方便开发阶段的调试，开发者可直接在 ZEGO 控制台获取临时 Token（有效期为 24 小时）
       <br/>
       来使用，详情请参考
       <a href="https://doc-zh.zego.im/article/12107" rel="nofollow">
        控制台（新版） - 项目管理
       </a>
       中的 “项目信息”。
      </p>
     </li>
    </ul>
    <p>
     你可以调用 loginRoom 接口登录房间。roomID 和 user 的参数由您本地生成，但是需要满足以下条件：
    </p>
    <ul>
     <li>
      同一个 AppID 内，需保证 “roomID” 全局唯一。
     </li>
     <li>
      同一个 AppID 内，需保证 “userID” 全局唯一，建议开发者将 “userID” 与自己业务的账号系统进行关联。
      <br/>
      <br/>
     </li>
    </ul>
    <pre><code class="prism language-java"><span class="token comment">// ZegoUser 的构造方法 public ZegoUser(String userID) 会将 “userName” 设为与传的参数 “userID” 一样。“userID” 与 “userName” 不能为 “null” 否则会导致登录房间失败。 </span>
<span class="token class-name">ZegoUser</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZegoUser</span><span class="token punctuation">(</span><span class="token string">"user1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 只有传入 “isUserStatusNotify” 参数取值为 “true” 的 ZegoRoomConfig，才能收到 onRoomUserUpdate 回调。</span>
<span class="token class-name">ZegoRoomConfig</span> roomConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZegoRoomConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//token 由用户自己的服务端生成，为了更快跑通流程，也可以通过即构控制台获取临时的音视频 token</span>
roomConfig<span class="token punctuation">.</span>token <span class="token operator">=</span> <span class="token string">"xxxx"</span><span class="token punctuation">;</span>
roomConfig<span class="token punctuation">.</span>isUserStatusNotify <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// 登录房间</span>
engine<span class="token punctuation">.</span><span class="token function">loginRoom</span><span class="token punctuation">(</span><span class="token string">"room1"</span><span class="token punctuation">,</span> user<span class="token punctuation">,</span> roomConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <br/>
    <h5>
     <a id="_305">
     </a>
     登录状态（房间连接状态）回调
    </h5>
    <p>
     调用登录房间接口之后，您可通过监听 onRoomStateUpdate 回调实时监控自己在本房间内的连接状态。
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRoomStateUpdate</span><span class="token punctuation">(</span><span class="token class-name">String</span> roomID<span class="token punctuation">,</span> <span class="token class-name">ZegoRoomState</span> state<span class="token punctuation">,</span> <span class="token keyword">int</span> errorCode<span class="token punctuation">,</span> <span class="token class-name">JSONObject</span> extendedData<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onRoomStateUpdate</span><span class="token punctuation">(</span>roomID<span class="token punctuation">,</span> state<span class="token punctuation">,</span> errorCode<span class="token punctuation">,</span> extendedData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token class-name">ZegoRoomState</span><span class="token punctuation">.</span>CONNECTED<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
       <span class="token comment">//房间连接成功</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token class-name">ZegoRoomState</span><span class="token punctuation">.</span>CONNECTING<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
       <span class="token comment">//房间连接中</span>
    <span class="token punctuation">}</span>  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token class-name">ZegoRoomState</span><span class="token punctuation">.</span>DISCONNECTED<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
       <span class="token comment">//未连接或房间连接断开</span>
    <span class="token punctuation">}</span>        
<span class="token punctuation">}</span>
</code></pre>
    <br/>
    <h6>
     <a id="63__ZEGO__324">
     </a>
     6.3 预览自己的画面，并推送到 ZEGO 音视频云
    </h6>
    <h6>
     <a id="1__325">
     </a>
     1. 预览自己的画面
    </h6>
    <p>
     如果希望看到本端的画面，可调用 startPreview 接口设置预览视图，并启动本地预览。
    </p>
    <pre><code class="prism language-java"><span class="token comment">// 设置本地预览视图并启动预览，视图模式采用 SDK 默认的模式，等比缩放填充整个 View</span>
<span class="token class-name">ZegoCanvas</span> previewCanvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZegoCanvas</span><span class="token punctuation">(</span>previewView<span class="token punctuation">)</span><span class="token punctuation">;</span>
engine<span class="token punctuation">.</span><span class="token function">startPreview</span><span class="token punctuation">(</span>previewCanvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <br/>
    <h6>
     <a id="2__ZEGO__335">
     </a>
     2. 将自己的音视频流推送到 ZEGO 音视频云
    </h6>
    <p>
     在用户调用 loginRoom 接口后，可以直接调用 startPublishingStream 接口，传入 “streamID”，将自己的音视频流推送到 ZEGO 音视频云。您可通过监听 onPublisherStateUpdate 回调知晓推流是否成功。
     <br/>
     “streamID” 由您本地生成，但是需要保证：
     <br/>
     同一个 AppID 下，“streamID” 全局唯一。如果同一个 AppID 下，不同用户各推了一条 “streamID” 相同的流，后推流的用户推流失败。
     <br/>
     此处示例在调用 loginRoom 接口后立即进行推流。在实现具体业务时，您可选择其他时机进行推流，只要保证先调用 loginRoom 即可。
    </p>
    <pre><code class="prism language-java"><span class="token comment">// 用户调用 loginRoom 之后再调用此接口进行推流</span>
<span class="token comment">// 在同一个 AppID 下，开发者需要保证“streamID” 全局唯一，如果不同用户各推了一条 “streamID” 相同的流，后推流的用户会推流失败。 </span>
engine<span class="token punctuation">.</span><span class="token function">startPublishingStream</span><span class="token punctuation">(</span><span class="token string">"stream1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <br/>
    <h6>
     <a id="64__348">
     </a>
     6.4 拉取其他用户的音视频
    </h6>
    <p>
     进行视频通话时，我们需要拉取到其他用户的音视频。
    </p>
    <p>
     在同一房间内的其他用户将音视频流推送到 ZEGO 音视频云时，我们会在 onRoomStreamUpdate 回调中收到音视频流新增的通知，并可以通过 ZegoStream 获取到某条流的 “streamID”。
    </p>
    <p>
     我们可以在该回调中，调用 startPlayingStream，传入 “streamID” 拉取拉取播放该用户的音视频。您可通过监听 onPlayerStateUpdate 回调知晓是否成功拉取音视频。
    </p>
    <pre><code class="prism language-java"><span class="token comment">// 房间内其他用户推流/停止推流时，我们会在这里收到相应流增减的通知</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRoomStreamUpdate</span><span class="token punctuation">(</span><span class="token class-name">String</span> roomID<span class="token punctuation">,</span> <span class="token class-name">ZegoUpdateType</span> updateType<span class="token punctuation">,</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ZegoStream</span><span class="token punctuation">&gt;</span></span> streamList<span class="token punctuation">,</span> <span class="token class-name">JSONObject</span> extendedData<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onRoomStreamUpdate</span><span class="token punctuation">(</span>roomID<span class="token punctuation">,</span> updateType<span class="token punctuation">,</span> streamList<span class="token punctuation">,</span> extendedData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//当 updateType 为 ZegoUpdateType.ADD 时，代表有音视频流新增，此时我们可以调用 startPlayingStream 接口拉取播放该音视频流</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>updateType <span class="token operator">==</span> <span class="token class-name">ZegoUpdateType</span><span class="token punctuation">.</span>ADD<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
         <span class="token comment">// 开始拉流，设置远端拉流渲染视图，视图模式采用 SDK 默认的模式，等比缩放填充整个             View</span>
        <span class="token comment">// 如下 playView 为 UI 界面上 View.这里为了使示例代码更加简洁，我们只拉取新增的音视频流列表中第的第一条流，在实际的业务中，建议开发者循环遍历 streamList ，拉取每一条音视频流 </span>
        <span class="token class-name">ZegoStream</span> stream <span class="token operator">=</span> streamList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        playStreamID <span class="token operator">=</span> stream<span class="token punctuation">.</span>streamID<span class="token punctuation">;</span>
        <span class="token class-name">ZegoCanvas</span> playCanvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZegoCanvas</span><span class="token punctuation">(</span>playView<span class="token punctuation">)</span><span class="token punctuation">;</span>
        engine<span class="token punctuation">.</span><span class="token function">startPlayingStream</span><span class="token punctuation">(</span>playStreamID<span class="token punctuation">,</span> playCanvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <br/>
    <h5>
     <a id="7__372">
     </a>
     7 运行效果
    </h5>
    <p>
     音视频的基础功能已完成，接下来我们运行下效果，1步快速检验成果。
    </p>
    <p>
     step1.
     <strong>
      与好友一起安装编译好的App，在手机上可以看到对方并进行通话互动。
     </strong>
     <br/>
     完成以上，说明你成功啦！
    </p>
    <p>
     Enjoy与好友的欢乐时光!
     <br/>
     <br/>
    </p>
    <h5>
     <a id="Demo_382">
     </a>
     获取更多文档、Demo、技术帮助
    </h5>
    <ul>
     <li>
      获取 SDK 开发文档、demo，可访问
      <a href="https://zegoguanwang.datasink.sensorsdata.cn/t/hs" rel="nofollow">
       即构文档中心
      </a>
      ；
     </li>
     <li>
      获取更多商务活动热门产品，可提交
      <a href="https://zegoguanwang.datasink.sensorsdata.cn/t/Rs" rel="nofollow">
       信息联系商务
      </a>
      ；
     </li>
     <li>
      <a href="https://zegoguanwang.datasink.sensorsdata.cn/t/SF" rel="nofollow">
       注册即构ZEGO开发者帐号
      </a>
      ，快速开始；
     </li>
    </ul>
    <p>
     <strong>
      在即构ZEGO SDK集成中，有任何技术问题、建议、想法，欢迎扫码进群与我们交流；
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/bd25544b48627034c5c46fe82b4f47b8.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f5a45474f3132332f:61727469636c652f64657461696c732f313233383939303930" class_="artid" style="display:none">
 </p>
</div>


