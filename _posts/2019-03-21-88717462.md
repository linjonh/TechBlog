---
layout: post
title: "微信小程序使用wx.getBackgroundAudioManager写音频播放,ios和安卓真机测试,暂停再播放结果从头播的bug已解决"
date: 2019-03-21 15:55:14 +0800
description: "话不多说，遇到的坑解决办法如下：解决暂停再播放不能从头播的问题。（准备好更新进度、获取单个课程播放进"
keywords: "小程序开发backgroundaudio怎么去掉图标"
categories: ['小程序']
tags: ['音频播放', '背景音频', '微信小程序']
artid: "88717462"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=88717462
    alt: "微信小程序使用wx.getBackgroundAudioManager写音频播放,ios和安卓真机测试,暂停再播放结果从头播的bug已解决"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微信小程序使用wx.getBackgroundAudioManager()写音频播放，ios和安卓真机测试，暂停再播放结果从头播的bug【已解决】
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/35c524cb1a44a0336022c6e1cd3e96fa.png"/>
    </p>
    <h3>
     <a id="_1">
     </a>
     话不多说，遇到的坑解决办法如下：
    </h3>
    <h4>
     <a id="_2">
     </a>
     解决暂停再播放不能从头播的问题。（准备好更新进度、获取单个课程播放进度的接口）
    </h4>
    <p>
     <mark>
      1.当音频暂停、进度条拖动（音频暂停状态）、快进快退（音频暂停状态）、页面卸载时调用更新接口；
     </mark>
     <br/>
     <mark>
      2.再次播放时调用获取接口；
     </mark>
     <br/>
     <mark>
      3.微信小程序的BackgroundAudioManager.currentTime并不能获取到上次暂停时的时间，这时候需要我们用seek()方法跳转到获取接口返回的时间
     </mark>
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">//更新音频、视频的观看时长</span>
  updateViewTime<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> openId <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'openid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
      id<span class="token punctuation">:</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>course_id<span class="token punctuation">,</span>
      viewing_time<span class="token punctuation">:</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>offset<span class="token punctuation">,</span>
      openid<span class="token punctuation">:</span> openId
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    util<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'Product/viewRecord'</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">//获取当前音频/视频播放时长</span>
  getMediaCurTime<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> openId <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'openid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
      openid<span class="token punctuation">:</span> openId<span class="token punctuation">,</span>
      id<span class="token punctuation">:</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>course_id
    <span class="token punctuation">}</span>
    util<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'user/getCourseViewRecord'</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          viewing_time<span class="token punctuation">:</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>viewing_time<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
<span class="token comment">//当前音频时间发生变化时</span>
  currentTimeChange<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    bgMusic<span class="token punctuation">.</span><span class="token function">onTimeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">let</span> offset <span class="token operator">=</span> bgMusic<span class="token punctuation">.</span>currentTime<span class="token punctuation">;</span>
      <span class="token keyword">let</span> currentTime <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> duration <span class="token operator">=</span> bgMusic<span class="token punctuation">.</span>duration<span class="token punctuation">;</span>
      <span class="token keyword">let</span> min <span class="token operator">=</span> <span class="token string">"0"</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>currentTime <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> max <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>bgMusic<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> sec <span class="token operator">=</span> currentTime <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>sec <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        sec <span class="token operator">=</span> <span class="token string">"0"</span> <span class="token operator">+</span> sec<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> starttime <span class="token operator">=</span> min <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> sec<span class="token punctuation">;</span>
      self<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        offset<span class="token punctuation">:</span> currentTime<span class="token punctuation">,</span>
        starttime<span class="token punctuation">:</span> starttime<span class="token punctuation">,</span>
        max<span class="token punctuation">:</span> max<span class="token punctuation">,</span>
        is_updateTime<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
    <h4>
     <a id="_64">
     </a>
     点击开始播放要做如下操作：
    </h4>
    <pre><code class="prism language-javascript"><span class="token comment">//开始按钮</span>
  listenerButtonPlay<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> bgMusic <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getBackgroundAudioManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//音乐播放实例</span>
    <span class="token comment">//bug ios 播放时必须加title 不然会报错导致音乐不播放</span>
    bgMusic<span class="token punctuation">.</span>title <span class="token operator">=</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>courseInfo<span class="token punctuation">.</span>course_name<span class="token punctuation">;</span>
    bgMusic<span class="token punctuation">.</span>epname <span class="token operator">=</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>courseInfo<span class="token punctuation">.</span>course_name<span class="token punctuation">;</span>
    bgMusic<span class="token punctuation">.</span>src <span class="token operator">=</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>src<span class="token punctuation">;</span>
        
        <span class="token comment">//获取当前音频/视频播放时长 由于声明提前造成viewing_time不是我们想要的，而是上次点击存的(注意：这里也是个坑)</span>
        that<span class="token punctuation">.</span><span class="token function">getMediaCurTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          <span class="token keyword">let</span> viewing_time <span class="token operator">=</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>viewing_time<span class="token punctuation">;</span>
          bgMusic<span class="token punctuation">.</span><span class="token function">onTimeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">//判断当前时间是不是0，如果是0就不需要跳转直接更新进度</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>viewing_time <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
             <span class="token comment">//跳转到暂停时存储的时间</span>
              bgMusic<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>viewing_time<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">//更新进度</span>
              that<span class="token punctuation">.</span><span class="token function">currentTimeChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//更新进度</span>
              that<span class="token punctuation">.</span><span class="token function">currentTimeChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">)</span>
        
        <span class="token comment">//开始播放</span>
        bgMusic<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          isOpen<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//播放结束</span>
    bgMusic<span class="token punctuation">.</span><span class="token function">onEnded</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        starttime<span class="token punctuation">:</span> <span class="token string">'00:00'</span><span class="token punctuation">,</span>
        isOpen<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        offset<span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">//播放自然结束时更新进度</span>
      that<span class="token punctuation">.</span><span class="token function">updateViewTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
    <h4>
     <a id="_111">
     </a>
     点击暂停操作如下：
    </h4>
    <pre><code class="prism language-javascript"><span class="token comment">//暂停</span>
listenerButtonPause<span class="token punctuation">:</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> bgMusic <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getBackgroundAudioManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//音乐播放实例</span>
  <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
  bgMusic<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    isOpen<span class="token punctuation">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//更新进度</span>
  that<span class="token punctuation">.</span><span class="token function">updateViewTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
    <h4>
     <a id="_125">
     </a>
     进度条拖动时的操作:
    </h4>
    <pre><code class="prism language-javascript"><span class="token comment">// 音频进度条拖拽</span>
  sliderChange<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> bgMusic <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getBackgroundAudioManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//音乐播放实例</span>
    <span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>isOpen<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//播放状态</span>
        bgMusic<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//进度条拖动，音乐进度也要改变</span>
        bgMusic<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//更新进度</span>
        that<span class="token punctuation">.</span><span class="token function">updateViewTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//暂停状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          bgMusic<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            offset<span class="token punctuation">:</span> offset
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token comment">//更新进度</span>
          that<span class="token punctuation">.</span><span class="token function">updateViewTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
          util<span class="token punctuation">.</span><span class="token function">showSuccess</span><span class="token punctuation">(</span><span class="token string">"请观看后操作"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
    <h4>
     <a id="_155">
     </a>
     初始化数据如下：
    </h4>
    <pre><code class="prism language-javascript">
data<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  audioCover<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//音频播放的遮罩</span>
  course_id<span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">,</span>
  isOpen<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">//播放开关</span>
  is_updateTime<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//判断有没有观看</span>
  starttime<span class="token punctuation">:</span> <span class="token string">'00:00'</span><span class="token punctuation">,</span> <span class="token comment">//正在播放时长</span>
  src<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token comment">//音频链接</span>
  offset<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//当前播放时间</span>
  viewing_time<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//接口返回的课程播放到的时间</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
    <h4>
     <a id="wxml_169">
     </a>
     wxml
    </h4>
    <pre><code class="prism language-html"><span class="token comment">&lt;!-- 音频start --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>audioBox {<!-- -->{selected1||courseInfo.course_carrier == 2?<span class="token punctuation">'</span>show<span class="token punctuation">'</span>:<span class="token punctuation">'</span>hidden<span class="token punctuation">'</span>}}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{courseInfo.course_carrier == 2 || courseInfo.course_carrier == 4}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 音频图片和标题 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>top<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>{<!-- -->{courseInfo.course_pictures}}<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>top_title<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{courseInfo.course_name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>price<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>￥{<!-- -->{courseInfo.course_price}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>bottom<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- 进度条 --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>progress<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slider</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>slider<span class="token punctuation">'</span></span>
              <span class="token attr-name">bindchange</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sliderChange<span class="token punctuation">"</span></span> 
              <span class="token attr-name">activeColor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>red<span class="token punctuation">'</span></span> 
              <span class="token attr-name">block-size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>12<span class="token punctuation">"</span></span> 
              <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{max}}<span class="token punctuation">"</span></span>
              <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>{<!-- -->{offset}}<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>time<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>{<!-- -->{starttime}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>{<!-- -->{courseInfo.duration}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- 音频控制 --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>control<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>icon</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>leftBtn iconfont iconai10<span class="token punctuation">'</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>prev<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>icon</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>stateBtn<span class="token punctuation">'</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{!isOpen}}<span class="token punctuation">"</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>listenerButtonPlay<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>audioCover<span class="token punctuation">'</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{audioCover}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>icon</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>startBtn iconfont iconbofang2<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>icon</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>stateBtn<span class="token punctuation">'</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{isOpen}}<span class="token punctuation">"</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>listenerButtonPause<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>icon</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>iconfont iconstop<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>icon</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>icon</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>rightBtn iconfont iconai09<span class="token punctuation">'</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>next<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>icon</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 音频end --&gt;</span>
</code></pre>
    <h4>
     <a id="wxss_209">
     </a>
     wxss
    </h4>
    <pre><code class="prism language-Css">/* 音频start */
.audioBox{}
.audioBox&gt;.top{
  text-align: center;
}
.audioBox&gt;.top&gt;image{
  width: 220rpx;
  height: 297rpx;
  border-radius: 8rpx;
  box-shadow: 2rpx 2rpx 4rpx 2rpx #D4D4D4;
}
.audioBox&gt;.top&gt;.top_title{
  font-size: 32rpx;
  font-weight: bold;
  margin: 36rpx 0 12rpx;
}
.audioBox&gt;.top&gt;.price{
  font-size: 26rpx;
  color: #a0a0a0;
}
.progress{
  margin-top: 53rpx;
}
.progress&gt;.time {
  display: flex;
  justify-content: space-between;
  margin: 0 20rpx;
}
.progress&gt;.time&gt;text{
  font-size: 26rpx;
  color: #a0a0a0;
}
.control{
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 20rpx 0 56rpx;
}
.control&gt;icon{
  font-size: 53rpx;
  color: #ff3f61;
}
.control&gt;.stateBtn {
  position: relative;
  width: 94rpx;
  height: 94rpx;
  border-radius: 50%;
  background-color: #ff3f61;
  text-align: center;
  margin: 0 60rpx;
}
.control&gt;.stateBtn&gt;icon{
  line-height: 93rpx;
  font-size: 43rpx;
  color: white;
}
.audioBox&gt;.bottom {
  
}
.audioCover {
  position: absolute;
  width: 94rpx;
  height: 94rpx;
  top: 0;
  left: 0;
  background-color: transparent;
  z-index: 9998;
}
/* 音频end */
</code></pre>
    <h4>
     <a id="14_282">
     </a>
     到这里差不多了，我的还有个快进快退14秒功能，也介绍下吧：
    </h4>
    <pre><code class="prism language-javascript"><span class="token comment">//后退14秒</span>
  prev<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> bgMusic <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getBackgroundAudioManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//音乐播放实例</span>
    
      <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>isOpen<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//播放状态</span>
        bgMusic<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>bgMusic<span class="token punctuation">.</span>currentTime <span class="token operator">-</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        that<span class="token punctuation">.</span><span class="token function">currentTimeChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        that<span class="token punctuation">.</span><span class="token function">updateViewTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//暂停状态</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>offset<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          bgMusic<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>bgMusic<span class="token punctuation">.</span>currentTime <span class="token operator">-</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            offset<span class="token punctuation">:</span> bgMusic<span class="token punctuation">.</span>currentTime <span class="token operator">-</span> <span class="token number">14</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> currentTime <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>bgMusic<span class="token punctuation">.</span>currentTime <span class="token operator">-</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> min <span class="token operator">=</span> <span class="token string">"0"</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>currentTime <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> sec <span class="token operator">=</span> currentTime <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>sec <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            sec <span class="token operator">=</span> <span class="token string">"0"</span> <span class="token operator">+</span> sec<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> starttime <span class="token operator">=</span> min <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> sec<span class="token punctuation">;</span>
          that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            starttime<span class="token punctuation">:</span> starttime
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          that<span class="token punctuation">.</span><span class="token function">updateViewTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          that<span class="token punctuation">.</span><span class="token function">currentTimeChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
          util<span class="token punctuation">.</span><span class="token function">showSuccess</span><span class="token punctuation">(</span><span class="token string">"请观看后操作"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//前进14秒</span>
  next<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> bgMusic <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getBackgroundAudioManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//音乐播放实例</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>isOpen<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//播放状态</span>
        bgMusic<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>bgMusic<span class="token punctuation">.</span>currentTime <span class="token operator">+</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        that<span class="token punctuation">.</span><span class="token function">updateViewTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//暂停状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>offset<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          bgMusic<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>bgMusic<span class="token punctuation">.</span>currentTime <span class="token operator">+</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            offset<span class="token punctuation">:</span> bgMusic<span class="token punctuation">.</span>currentTime <span class="token operator">+</span> <span class="token number">14</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> currentTime <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>bgMusic<span class="token punctuation">.</span>currentTime <span class="token operator">+</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> min <span class="token operator">=</span> <span class="token string">"0"</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>currentTime <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> sec <span class="token operator">=</span> currentTime <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>sec <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            sec <span class="token operator">=</span> <span class="token string">"0"</span> <span class="token operator">+</span> sec<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> starttime <span class="token operator">=</span> min <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> sec<span class="token punctuation">;</span>
          that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            starttime<span class="token punctuation">:</span> starttime
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          that<span class="token punctuation">.</span><span class="token function">updateViewTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
          util<span class="token punctuation">.</span><span class="token function">showSuccess</span><span class="token punctuation">(</span><span class="token string">"请观看后操作"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f71715f3433313139323035:2f61727469636c652f64657461696c732f3838373137343632" class_="artid" style="display:none">
 </p>
</div>


