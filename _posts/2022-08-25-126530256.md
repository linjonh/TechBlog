---
layout: post
title: "小程序解决图片分享裁剪54问题"
date: 2022-08-25 18:31:39 +0800
description: "在获取完图片后调用 function cutshareImf(url){} url:为需要处理的图片"
keywords: "小程序分享图片默认尺寸"
categories: ["未分类"]
tags: ["开发语言", "小程序", "Javascript"]
artid: "126530256"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=126530256
  alt: "小程序解决图片分享裁剪54问题"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     小程序解决图片分享裁剪5:4问题
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     1、解决小程序中分享默认比率5：4导致图片被裁剪；
    </p>
    <p>
     为保持图片完整性使用下列方法：
    </p>
    <p>
     在获取完图片后调用 function cutshareImf(url){} url:为需要处理的图片地址；
    </p>
    <p>
     wx.js
    </p>
    <pre><code class="language-javascript">//传入图片地址
cutShareImg(doctorImg){
    let that=this;
    wx.getImageInfo({
      src: doctorImg,  // 这里填写网络图片路径 
      success: (res) =&gt; {
        var data = res
        console.log(res)
        wx.createSelectorQuery()
        .select('#myCanvas') // 在 WXML 中填入的 id
        .fields({ node: true, size: true })
        .exec((res) =&gt; {
           // Canvas 对象
           console.log(res)
          const canvas = res[0].node
          // 渲染上下文
          const ctx = canvas.getContext('2d')
          let {width, path, height} = data
          // Canvas 画布的实际绘制宽高
          var widths = height*5/4
          const dpr = wx.getWindowInfo().pixelRatio
          var w = (widths-width)/2
          canvas.width = widths * dpr
          canvas.height = height * dpr
          ctx.scale(dpr, dpr)
          ctx.clearRect(0, 0, widths, height)
          // 图片对象
          const image = canvas.createImage()
          console.log(image)
          image.onload = () =&gt; {
            // 将图片绘制到 canvas 上
            ctx.drawImage(image, w, 0)
            wx.canvasToTempFilePath({
                canvas,
                success: res =&gt; {
                    // 生成的图片临时文件路径
                    const tempFilePath = res.tempFilePath
                    that.setData({shareimg: tempFilePath})
                },
              })
          }
          image.onerror = (err) =&gt; {
                console.log(err)
            }
          image.src= path
          // 生成图片
         
        })
      }
    });
  },</code></pre>
    <p>
     video.wxml
    </p>
    <pre><code class="hljs">&lt;canvas style="position: absolute; top: -1000px; left: -1000px; width: 640px; height: 640px; background: #000;" type='2d' id="myCanvas"&gt;&lt;/canvas&gt;</code></pre>
    <p>
     分享时调用
     <strong>
      <span style="color:#38d8f0;">
       shareimg
      </span>
     </strong>
     为分享图片的地址
    </p>
    <p>
     注意：
     <strong>
      <span style="color:#fe2c24;">
       图片过大的时候导致界面画布加载过长导致微信小程序卡死情况；
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#fe2c24;">
       可以对下载的图片进行等比缩放使他画布大小变小
      </span>
     </strong>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f35393931303535342f:61727469636c652f64657461696c732f313236353330323536" class_="artid" style="display:none">
 </p>
</div>
