---
layout: post
title: "微信小程序-阿里云部署"
date: 2023-09-06 15:10:03 +0800
description: "3.  在新建的Python文件中新增以下内容，并将代码中的accessKeyId、accessSe"
keywords: "微信小程序部署到阿里云"
categories: ['未分类']
tags: ['微信小程序', '小程序']
artid: "132412542"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=132412542
  alt: "微信小程序-阿里云部署"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微信小程序-阿里云部署
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     参考 ：
     <a href="https://help.aliyun.com/?spm=a2c4g.438630.0.0.3a493ed2il3LDO" rel="nofollow" title="阿里云文档_文档中心_云计算文档-阿里云帮助中心">
      阿里云文档_文档中心_云计算文档-阿里云帮助中心
     </a>
    </h2>
    <h2>
     <a href="https://developer.aliyun.com/" rel="nofollow" title="阿里云开发者社区-云计算社区-阿里云">
      阿里云开发者社区-云计算社区-阿里云
     </a>
    </h2>
    <h2>
     下载
    </h2>
    <p>
     <a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html" rel="nofollow" title="微信开发者工具下载地址与更新日志 | 微信开放文档">
      微信开发者工具下载地址与更新日志 | 微信开放文档
     </a>
    </p>
    <div>
     <h2 style="text-align:left;">
      <span style="color:#111111;">
       <span style="background-color:#ffffff;">
        <span style="color:#3d3d3d;">
         一. 申请账号
        </span>
       </span>
      </span>
     </h2>
    </div>
    <div>
     <h3 style="text-align:left;">
      <span style="color:#111111;">
       <span style="background-color:#ffffff;">
        <span style="color:#3d3d3d;">
         申请账号
        </span>
       </span>
      </span>
     </h3>
     <p style="margin-left:0;">
      <span style="color:#111111;">
       <span style="background-color:#ffffff;">
        <span style="color:#000000;">
         1.  进入
         <a href="https://mp.weixin.qq.com/" rel="nofollow" title="小程序注册页">
          小程序注册页
         </a>
         根据指引填写信息和提交相应的资料，完成账号申请。
        </span>
       </span>
      </span>
     </p>
     <p style="margin-left:0;">
      <span style="color:#111111;">
       <span style="background-color:#ffffff;">
        <span style="color:#000000;">
         <strong>
          <span style="color:#ff0000;">
           说明：
          </span>
         </strong>
         如果跳转后页面出现错误，请刷新访问。
        </span>
       </span>
      </span>
     </p>
     <p style="margin-left:0;">
     </p>
     <p class="img-center">
      <img alt="" height="869" src="https://i-blog.csdnimg.cn/blog_migrate/5e1a2fd62f12818701169174df8400f3.png" width="1200"/>
     </p>
     <p style="margin-left:0;">
      <span style="color:#111111;">
       <span style="background-color:#ffffff;">
        <span style="color:#000000;">
         2.  使用申请的微信公众平台账号登录
         <a href="https://mp.weixin.qq.com/" rel="nofollow" title="小程序后台">
          小程序后台
         </a>
         ，单击
         <strong>
          开发
         </strong>
         &gt;
         <strong>
          开发设置
         </strong>
         ，可以看到小程序的AppID，请记录AppID，后续操作中需要使用。
        </span>
       </span>
      </span>
     </p>
     <p style="margin-left:0;">
     </p>
     <p class="img-center">
      <img alt="" height="850" src="https://i-blog.csdnimg.cn/blog_migrate/95907c8a991fe971d6b533494e4fa672.png" width="1200"/>
     </p>
     <p style="margin-left:0;">
      <span style="color:#111111;">
       <span style="background-color:#ffffff;">
        <span style="color:#000000;">
         3.  在
         <strong>
          开发设置
         </strong>
         &gt;
         <strong>
          服务器域名
         </strong>
         &gt;
         <strong>
          request合法域名
         </strong>
         中填入您的已备案域名。
        </span>
       </span>
      </span>
     </p>
     <p style="margin-left:0;">
     </p>
     <p style="margin-left:0;">
     </p>
     <p>
      2. 安装小程序开发环境并创建项目
     </p>
     <h3>
      二，安装小程序开发环境并创建项目
     </h3>
     <p>
      1.  安装Node.js开发环境，请到
      <a href="https://nodejs.org/zh-cn/" rel="nofollow" title="Node.js">
       Node.js
      </a>
      页面下载并安装Node.js环境。
     </p>
     <p>
      2.  下载并安装微信小程序开发工具。详细信息请参见
      <a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html" rel="nofollow" title="开发工具下载">
       开发工具下载
      </a>
      。
     </p>
     <p>
      3.  打开小程序开发工具，然后使用微信扫码登录。
     </p>
     <p>
      4.  单击加号创建微信小程序示例项目。
     </p>
     <p>
     </p>
     <p class="img-center">
      <img alt="" height="542" src="https://i-blog.csdnimg.cn/blog_migrate/a1008352f29f27e56c3478dd5488b545.png" width="808"/>
     </p>
     <p>
      5.  参考以下填写项目信息，最后单击
      <strong>
       新建
      </strong>
      。
     </p>
     <p>
     </p>
     <ul>
      <li>
       项目名称：例如ECSAssistant。
      </li>
      <li>
       目录：例如D:\workspace\wechat\ECSAssistant。
      </li>
      <li>
       AppID：小程序的唯一标识，从小程序控制台获取，参见步骤一。
      </li>
      <li>
       开发模式：小程序。
      </li>
      <li>
       后端服务：不使用云服务。
      </li>
     </ul>
     <p class="img-center">
      <img alt="" height="552" src="https://i-blog.csdnimg.cn/blog_migrate/140dfc960207f8540f468ec2a06a7f35.png" width="814"/>
     </p>
     <p>
      3. 初识小程序项目结构
     </p>
     <h3>
      三，初识小程序项目结构
     </h3>
     <p>
      生成的的小程序示例项目结构如下。
     </p>
     <pre><code>ECSAssistant
├── app.js
├── app.json
├── app.wxss
├── pages
│   ├── index
│   │   ├── index.js
│   │   ├── index.json
│   │   ├── index.wxml
│   │   └── index.wxss
│   └── logs
│       ├── logs.js
│       ├── logs.json
│       ├── logs.wxml
│       └── logs.wxss
├── project.config.json
├── sitemap.json
└── utils
    └── util.js</code></pre>
     <p>
      可以看到小程序的项目结构中有三种前缀为app的文件，它们定义了小程序的一些全局配置。
     </p>
     <ul>
      <li>
       app.json 是小程序的全局配置，用于配置小程序的页面列表、默认窗口标题、导航栏背景色等。更多请参见
       <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/config.html#%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE" rel="nofollow" title="全局配置">
        全局配置
       </a>
       。
      </li>
      <li>
       app.acss 定义了全局样式，作用于当前小程序的所有页面。
      </li>
      <li>
       app.js 用于注册小程序应用，可配置小程序的生命周期，声明全局数据，调用丰富的 API。
      </li>
     </ul>
     <p>
      小程序所有的页面文件都在
      <em>
       pages/
      </em>
      路径下，页面文件有四种文件类型，分别是
      <em>
       .js
      </em>
      、
      <em>
       .wxml
      </em>
      、
      <em>
       .wcss
      </em>
      、和
      <em>
       .json
      </em>
      后缀的文件。相比全局配置文件，页面配置文件只对当前页面生效。其中
      <em>
       .wxml
      </em>
      文件定义了当前页面的页面结构。小程序中的所有页面都需要在
      <em>
       app.json
      </em>
      文件中声明。更多请参见
      <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/quickstart/code.html#JSON-%E9%85%8D%E7%BD%AE" rel="nofollow" title="代码构成">
       代码构成
      </a>
      。
     </p>
     <p>
      此外，项目顶层还有开发工具配置文件
      <a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html" rel="nofollow" title="project.config.json">
       project.config.json
      </a>
      和爬虫索引文件
      <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/sitemap.html" rel="nofollow" title="sitemap.json">
       sitemap.json
      </a>
      。
     </p>
     <p>
     </p>
     <div>
      <h2 style="text-align:left;">
       <span style="color:#111111;">
        <span style="background-color:#ffffff;">
         <span style="color:#3d3d3d;">
          四. 开发小程序
         </span>
        </span>
       </span>
      </h2>
     </div>
     <div>
      <p style="margin-left:0;">
       <span style="color:#111111;">
        <span style="background-color:#ffffff;">
         <span style="color:#000000;">
          1.  编辑
          <em>
           app.json
          </em>
          文件，将小程序页面Title修改为ECS小助手，修改后的
          <em>
           app.json
          </em>
          文件内容如下。
         </span>
        </span>
       </span>
      </p>
      <div style="margin-left:0;">
       <pre><span style="color:#111111;"><span style="background-color:#ffffff;"><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code>{
  "pages":[
    "pages/index/index",
    "pages/logs/logs"
  ],
  "window":{
    "backgroundTextStyle":"light",
    "navigationBarBackgroundColor": "#fff",
    "navigationBarTitleText": "ECS小助手",
    "navigationBarTextStyle":"black"
  },
  "style": "v2",
  "sitemapLocation": "sitemap.json"
}</code></span></span></span></span></pre>
      </div>
      <p style="margin-left:0;">
       <span style="color:#111111;">
        <span style="background-color:#ffffff;">
         <span style="color:#000000;">
          2.  编辑
          <em>
           pages/index/index.wxml
          </em>
          文件，定义index页面的页面结构，修改后的
          <em>
           index.wxml
          </em>
          文件内容如下。
         </span>
        </span>
       </span>
      </p>
      <div style="margin-left:0;">
       <pre><span style="color:#111111;"><span style="background-color:#ffffff;"><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code>&lt;view class='container'&gt;
  &lt;input placeholder='请输入你的ECS实例ID' class='search-input' value='{<!-- -->{ inputValue }}' bindblur='bindblur'&gt;&lt;/input&gt;
  &lt;view class='resultView' hidden='{<!-- -->{ showView }}'&gt;
    &lt;text class='result'&gt;CPU数：{<!-- -->{queryResult.Cpu}} 核&lt;/text&gt;
    &lt;text class='result'&gt;内存大小：{<!-- -->{queryResult.Memory}} MB&lt;/text&gt;
    &lt;text class='result'&gt;操作系统：{<!-- -->{queryResult.OSName}}&lt;/text&gt;
    &lt;text class='result'&gt;实例规格：{<!-- -->{queryResult.InstanceType}}&lt;/text&gt;
    &lt;text class='result'&gt;公网IP地址：{<!-- -->{queryResult.IpAddress}}&lt;/text&gt;
    &lt;text class='result'&gt;网络带宽：{<!-- -->{queryResult.InternetMaxBandwidthOut}} MB/s&lt;/text&gt;
    &lt;text class='result'&gt;在线状态：{<!-- -->{queryResult.instanceStatus == 'Running' ? '运行中':'已关机'}}&lt;/text&gt;
  &lt;/view&gt;
&lt;/view&gt;</code></span></span></span></span></pre>
      </div>
      <p style="margin-left:0;">
       <span style="color:#111111;">
        <span style="background-color:#ffffff;">
         <span style="color:#000000;">
          3.  编辑
          <em>
           pages/index/index.wxss文件
          </em>
          ，定义index的页面样式，修改后的
          <em>
           index.wxss
          </em>
          文件内容如下。
         </span>
        </span>
       </span>
      </p>
      <div style="margin-left:0;">
       <pre><span style="color:#111111;"><span style="background-color:#ffffff;"><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code>.search-input {
  position: relative;
  margin-bottom: 50rpx;
  padding-left:80rpx;
  line-height: 70rpx;
  height: 80rpx;
  box-sizing: border-box;
  border: 2px solid #ff8f0e;
  border-radius: 100rpx;
  overflow: hidden;
  text-overflow: ellipsis;
  transition: border 0.2s;
}

.resultView {
margin-top: 70rpx;
}
.result {
position: relative;
left: 30rpx;
display: list-item;
font-size: small;
}</code></span></span></span></span></pre>
</div>
<p style="margin-left:0;">
<span style="color:#111111;">
<span style="background-color:#ffffff;">
<span style="color:#000000;">
4.  编辑 pages/index/index.js 文件，定义搜索框的失去焦点事件，修改后的 index.js 文件内容如下。
</span>
</span>
</span>
</p>
<div style="margin-left:0;">
<pre><span style="color:#111111;"><span style="background-color:#ffffff;"><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code>Page({
data: {
queryResult: null,
showView: 'false',
},

bindblur: function(e) {
let that = this;
wx.request({
url: 'http://127.0.0.1:5000/ecs/getServerInfo',
method: 'GET',
data: {
instanceId: e.detail.value
},
success(res) {
if(res.statusCode == 200){
that.setData({
queryResult: res.data,
showView: !that.data.showView,
});
}else{
that.setData({
showView: 'false',
});
wx.showToast({
title: '请输入正确的实例 ID',
duration: 1500,
icon: 'none',
mask: true
})
}
}

    })

}
})</code></span></span></span></span></pre>
</div>
<p style="margin-left:0;">
<span style="color:#111111;">
<span style="background-color:#ffffff;">
<span style="color:#000000;">
<strong>
<span style="color:#ff0000;">
说明：
</span>
</strong>
微信小程序提供了丰富的前端 API 和服务端 API，您可以基于这些 API 来实现您的小程序功能，更多请参见
<a href="https://developers.weixin.qq.com/miniprogram/dev/api/" rel="nofollow" title="小程序 API 使用说明">
小程序 API 使用说明
</a>
。
</span>
</span>
</span>
</p>
<p style="margin-left:0;">
</p>
<p style="margin-left:0;">
</p>
<div>
<h2 style="text-align:left;">
<span style="color:#3d3d3d;">
五，. 安装 Python 开发环境并创建项目
</span>
</h2>
</div>
<div>
<p style="margin-left:0;">
<span style="color:#000000;">
1.  下载安装
<a href="https://www.python.org/ftp/python/3.8.5/python-3.8.5.exe" rel="nofollow" title="Python开发包">
Python 开发包
</a>
。
</span>
</p>
<p style="margin-left:0;">
<span style="color:#000000;">
2.  打开本地命令行终端，使用 pip 安装以下依赖。
</span>
</p>
<p style="margin-left:0;">
<span style="color:#000000;">
<strong>
<span style="color:#ff0000;">
说明：
</span>
</strong>
按下快捷键 win+r，在运行窗口输入 powershell 后回车可打开命令行终端。
</span>
</p>
<div style="margin-left:0;">
<pre><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code># 阿里云 SDK 核心库
pip install aliyun-python-sdk-core

# 阿里云 ECS SDK

pip install aliyun-python-sdk-ecs

# 轻量级 Web 框架 flask

pip install flask</code></span></span></pre>
</div>
<p style="margin-left:0;">
<span style="color:#000000;">
3.  下载安装 Python 开发的集成环境
<a href="https://www.jetbrains.com/pycharm/download/" rel="nofollow" title="Pycharm">
Pycharm
</a>
。
</span>
</p>
<p style="margin-left:0;">
<span style="color:#000000;">
4.  打开 PyCharm。
</span>
</p>
<p style="margin-left:0;">
<span style="color:#000000;">
5.  单击
<strong>
Create New Project
</strong>
。
</span>
</p>
<p style="margin-left:0;">
</p>
<p class="img-center">
<img alt="" height="478" src="https://i-blog.csdnimg.cn/blog_migrate/cc5e9bb4bf5e20a0232e00efe3a2fdcb.png" width="769"/>
</p>
<p style="margin-left:0;">
<span style="color:#000000;">
6.  选择项目路径，然后单击
<strong>
Create
</strong>
完成项目创建。
</span>
</p>
<div>
<div style="text-align:left;">
</div>
</div>
<div>
<h2 style="text-align:left;">
<span style="color:#111111;">
<span style="background-color:#ffffff;">
<span style="color:#3d3d3d;">
六，开发后端服务
</span>
</span>
</span>
</h2>
<p style="margin-left:0;">
<span style="color:#111111;">
<span style="background-color:#ffffff;">
<span style="color:#000000;">
1.  右键单击 PyCharm 项目根目录，依次选择
<strong>
New
</strong>
&gt;
<strong>
Python File
</strong>
。
</span>
</span>
</span>
</p>
<p style="margin-left:0;">
<span style="color:#111111;">
<span style="background-color:#ffffff;">
<span style="color:#000000;">
2.  输入 Python File 文件名，例如：GetServerInfo，然后选择
<strong>
Python File
</strong>
完成文件创建。
</span>
</span>
</span>
</p>
<p style="margin-left:0;">
<span style="color:#111111;">
<span style="background-color:#ffffff;">
<span style="color:#000000;">
3.  在新建的 Python 文件中新增以下内容，并将代码中的 accessKeyId、accessSecret 修改为您自己的 AK 信息。
</span>
</span>
</span>
</p>
<div style="margin-left:0;">
<pre><span style="color:#111111;"><span style="background-color:#ffffff;"><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code># -_- coding: utf-8 -_-
from flask import Flask, jsonify, request
from aliyunsdkcore.client import AcsClient
import json
from aliyunsdkecs.request.v20140526 import DescribeInstancesRequest, DescribeInstanceStatusRequest

app = Flask(**name**)

accessKeyId = 'LTAI4G4dnpbmKBCgug4**\***'
accessSecret = 'gBivN1nYujUGTBgM448Nt5xex**\***'
region = 'cn-shenzhen'
client = AcsClient(accessKeyId, accessSecret, region)

# 在 app.route 装饰器中声明响应的 URL 和请求方法

@app.route('/ecs/getServerInfo', methods=['GET'])
def getServerInfo(): # GET 方式获取请求参数
instanceId = request.args.get("instanceId")
if instanceId is None:  
 return "Invalid Parameter" # 查询实例信息
describeInstancesRequest = DescribeInstancesRequest.DescribeInstancesRequest()
describeInstancesRequest.set_InstanceIds([instanceId])
describeInstancesResponse = client.do_action_with_exception(describeInstancesRequest) # 返回数据为 bytes 类型，需要将 bytes 类型转换为 str 然后反序列化为 json 对象
describeInstancesResponse = json.loads(str(describeInstancesResponse, 'utf-8'))
instanceInfo = describeInstancesResponse['Instances']['Instance'][0]

    # 查询实例状态
    describeInstanceStatusRequest = DescribeInstanceStatusRequest.DescribeInstanceStatusRequest()
    describeInstanceStatusRequest.set_InstanceIds([instanceId])
    describeInstanceStatusResponse = client.do_action_with_exception(describeInstanceStatusRequest)
    describeInstanceStatusResponse = json.loads(str(describeInstanceStatusResponse, 'utf-8'))
    instanceStatus = describeInstanceStatusResponse['InstanceStatuses']['InstanceStatus'][0]['Status']

    # 封装结果
    result = {
        # cpu数
        'Cpu': instanceInfo['Cpu'],
        # 内存大小
        'Memory': instanceInfo['Memory'],
        # 操作系统名称
        'OSName': instanceInfo['OSName'],
        # 实例规格
        'InstanceType': instanceInfo['InstanceType'],
        # 实例公网IP地址
        'IpAddress': instanceInfo['PublicIpAddress']['IpAddress'][0],
        # 公网出带宽最大值
        'InternetMaxBandwidthOut': instanceInfo['InternetMaxBandwidthOut'],
        # 实例状态
        'instanceStatus': instanceStatus
    }
    return jsonify(result)

if **name** == "**main**":
app.run()</code></span></span></span></span></pre>
</div>
<p style="margin-left:0;">
<span style="color:#111111;">
<span style="background-color:#ffffff;">
<span style="color:#000000;">
<strong>
<span style="color:#ff0000;">
说明：
</span>
</strong>
您可以访问
<a href="https://ram.console.aliyun.com/manage/ak" rel="nofollow" title="AccessKey 管理">
AccessKey 管理
</a>
创建和查看您的 AccessKey。代码中涉及到的 API 的更多参数说明请参见
<a href="https://help.aliyun.com/document_detail/25506.html" rel="nofollow" title="DescribeInstances">
DescribeInstances
</a>
和
<a href="https://help.aliyun.com/document_detail/25505.html" rel="nofollow" title="DescribeInstanceStatus">
DescribeInstanceStatus
</a>
。
</span>
</span>
</span>
</p>
<h2>
七，本地调试
</h2>
<p>
1.  本地运行后端服务。在
<em>
GetServerInfo.py
</em>
文件空白处右键单击选择
<strong>
Run 'GetServerInfo'
</strong>
，或者使用快捷键 Ctrl+Shift+F10 快速运行 Python 文件。
</p>
<p>
2.  关闭小程序开发者工具的 HTTPS 安全性校验。
<br/>
a. 单击工具栏
<strong>
设置
</strong>
&gt;
<strong>
项目设置
</strong>
&gt;
<strong>
本地设置
</strong>
。
</p>
<p>
b. 在
<strong>
本地设置
</strong>
中勾选
<strong>
不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书
</strong>
。
</p>
<p>
3.  接下来您可以调用本地后端服务进行小程序的调试。
</p>
<div>
<div style="text-align:left;">
<br/>
<span style="color:#3d3d3d;"> 8. 部署 uWSGI Server
</span>
</div>
</div>
<div>
<h3 style="text-align:left;">
<span style="color:#3d3d3d;">
八，部署 uWSGI Server
</span>
</h3>
<p style="margin-left:0;">
<span style="color:#000000;">
本教程使用的服务器操作系统版本为 Ubuntu Server 18.04 LTS，该版本内置了 Python3 环境。如果您在使用其他版本的操作系统，例如 CentOS6.x、CentOS7.x，需要您自行配置 Python3 环境。
</span>
</p>
<p style="margin-left:0;">
<span style="color:#000000;">
1.  在终端中输入命令 ssh -V。
</span>
</p>
<p style="margin-left:0;">
<span style="color:#000000;">
如果显示 SSH 版本则表示已安装，如下图所示。
</span>
</p>
<p style="margin-left:0;">
</p>
<p class="img-center">
<img alt="" height="34" src="https://i-blog.csdnimg.cn/blog_migrate/503d3eb7355ac09ebb5081f7ed759e48.png" width="306"/>
</p>
<p style="margin-left:0;">
<span style="color:#000000;">
如果未安装，请下载安装
<a href="https://www.mls-software.com/files/setupssh-8.2p1-1.exe?spm=a2c6h.13858378.0.0.31035950NqmJWD&amp;file=setupssh-8.2p1-1.exe" rel="nofollow" title="OpenSSH">
OpenSSH
</a>
工具。
</span>
</p>
<p style="margin-left:0;">
<span style="color:#000000;">
2.  在终端中输入命令以下命令，将服务端程序上传到服务器上。
</span>
</p>
<div style="margin-left:0;">
<pre><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code>scp D:\workspace\python\ECSAssistant\GetServerInfo.py root@123.123.123.123:/root/</code></span></span></pre>
</div>
<p style="margin-left:0;">
<span style="color:#000000;">
<strong>
<span style="color:#ff0000;">
说明：
</span>
</strong>
</span>
</p>
<p style="margin-left:0;">
<span style="color:#000000;">
scp 命令的第一个参数为源文件路径，此处为本地文件路径；第二个参数分为三部分，分别是远程服务器的认证用户名、IP 地址和要上传到的远程目录。
</span>
</p>
<p style="margin-left:0;">
<span style="color:#000000;">
3.  输入以下命令连接服务器，然后根据提示输入您的服务器密码。
</span>
</p>
<div style="margin-left:0;">
<pre><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code>ssh root@123.123.123.123
</code></span></span></pre>
</div>
<p style="margin-left:0;">
<span style="color:#000000;">
登录成功后会显示如下信息。
</span>
</p>
<p style="margin-left:0;">
</p>
<p class="img-center">
<img alt="" height="157" src="https://i-blog.csdnimg.cn/blog_migrate/2d8db7ebfc2fc75722b6f3c2e1116dff.png" width="516"/>
</p>
<p style="margin-left:0;">
<span style="color:#000000;">
4.  执行以下命令安装 Python 依赖。
</span>
</p>
<div style="margin-left:0;">
<pre><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code># 阿里云 SDK 核心库
pip3 install aliyun-python-sdk-core

# 阿里云 ECS SDK

pip3 install aliyun-python-sdk-ecs

# 轻量级 Web 框架 flask

pip3 install flask

# Web Server

pip3 install uwsgi</code></span></span></pre>
</div>
<p style="margin-left:0;">
<span style="color:#000000;">
5.  新建 uwsgi 配置文件。
</span>
</p>
<div style="margin-left:0;">
<pre><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code>mkdir /data&amp;&amp;cd /data &amp;&amp;vim uwsgi.ini
</code></span></span></pre>
</div>
<p style="margin-left:0;">
<span style="color:#000000;">
按下 i 键进入编辑模式，新增以下内容。
</span>
</p>
<div style="margin-left:0;">
<pre><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code>[uwsgi]
#uwsgi 启动时所使用的地址和端口
socket=127.0.0.1:5000 #指向网站目录
chdir=/data

#python 启动程序文件
wsgi-file=GetServerInfo.py
#python 程序内用以启动的 application 变量名
callable=app

#处理器数
processes=4

#线程数
threads=2

#状态检测地址
stats=127.0.0.1:9191

#保存启动之后主进程的 pid
pidfile=uwsgi.pid

#设置 uwsgi 后台运行，uwsgi.log 保存日志信息 自动生成
daemonize=uwsgi.log</code></span></span></pre>
</div>
<p style="margin-left:0;">
<span style="color:#000000;">
编辑完成后按 Esc 键退出编辑模式，然后输入
<code>
:wq
</code>
退出编辑器。
</span>
</p>
<p style="margin-left:0;">
<span style="color:#000000;">
6.  运行 uwsgi server。
</span>
</p>
<div style="margin-left:0;">
<pre><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code>mv /root/GetServerInfo.py /data
uwsgi uwsgi.ini</code></span></span></pre>
</div>
<p style="margin-left:0;">
<span style="color:#000000;">
7.  执行以下命令验证 HTTPS 服务部署情况。
</span>
</p>
<span style="color:#ff0000;">
<strong>
说明：
</strong>
</span>
<span style="color:#ff0000;">
</span>
<p style="margin-left:0;">
<span style="color:#000000;">
请将 api.aliyuntest.com 改为您的服务器域名。
</span>
</p>
<div style="margin-left:0;">
<pre><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code>curl https://api.aliyuntest.com/ecs/getServerInfo
</code></span></span></pre>
</div>
<p style="margin-left:0;">
<span style="color:#000000;">
命令执行结果如下表示 HTTPS 服务部署成功。
</span>
</p>
<p style="margin-left:0;">
</p>
<p class="img-center">
<img alt="" height="42" src="https://i-blog.csdnimg.cn/blog_migrate/f67aa90994cdfc5f73075050559524ed.png" width="748"/>
</p>
<div>
<h2 style="text-align:left;">
<span style="color:#111111;">
<span style="background-color:#ffffff;">
<span style="color:#3d3d3d;">
九. 部署 Nginx 并配置 HTTPS
</span>
</span>
</span>
</h2>
</div>
<div>
<p style="margin-left:0;">
<span style="color:#111111;">
<span style="background-color:#ffffff;">
<span style="color:#000000;">
1.  支付宝小程序要求正式环境中小程序与服务端通信必须使用 HTTPS，所以您需要申请一个 SSL 证书。阿里云为个人开发者提供免费的 SSL 证书分发服务，请参考文档
<a href="https://help.aliyun.com/document_detail/156645.html" rel="nofollow" title="申请免费DV证书">
申请免费 DV 证书
</a>
，申请一个 SSL 证书并进行域名验证。
</span>
</span>
</span>
</p>
<p style="margin-left:0;">
<span style="color:#111111;">
<span style="background-color:#ffffff;">
<span style="color:#000000;">
2.  SSL 证书申请审核通过后，将证书上传到您的服务器上，证书文件包括一个
<em>
.pem
</em>
和一个
<em>
.key
</em>
文件。文件上传命令请参见步骤 9.2。
</span>
</span>
</span>
</p>
<p style="margin-left:0;">
<span style="color:#111111;">
<span style="background-color:#ffffff;">
<span style="color:#000000;">
3.  在服务器上执行以下命令安装 Nginx。
</span>
</span>
</span>
</p>
<div style="margin-left:0;">
<pre><span style="color:#111111;"><span style="background-color:#ffffff;"><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code>apt-get update
apt-get -y install nginx</code></span></span></span></span></pre>
</div>
<p style="margin-left:0;">
<span style="color:#111111;">
<span style="background-color:#ffffff;">
<span style="color:#000000;">
4.  新建 Nginx 配置文件。
</span>
</span>
</span>
</p>
<div style="margin-left:0;">
<pre><span style="color:#111111;"><span style="background-color:#ffffff;"><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code>vim /etc/nginx/sites-available/app.example.com
</code></span></span></span></span></pre>
</div>
<p style="margin-left:0;">
<span style="color:#111111;">
<span style="background-color:#ffffff;">
<span style="color:#000000;">
您可以将文件名修改为自己的域名。在文件中新增以下内容。
</span>
</span>
</span>
</p>
<p style="margin-left:0;">
<span style="color:#111111;">
<span style="background-color:#ffffff;">
<span style="color:#000000;">
<strong>
<span style="color:#ff0000;">
注意：
</span>
</strong>
请替换下面文件内容中的域名和证书存放地址。
</span>
</span>
</span>
</p>
<div style="margin-left:0;">
<pre><span style="color:#111111;"><span style="background-color:#ffffff;"><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code>server { # ssl 证书使用 443
listen 443 ssl default_server; # listen [::]:443 ssl default_server; # 后面是域名
server_name app.example.com;

    # 证书.pem的存放地址
    ssl_certificate   /data/ssl/1752675_app.example.com.pem;
    # 证书.key的存放地址
    ssl_certificate_key  /data/ssl/1752675_app.example.com.key;
    ssl_session_timeout  5m;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;

    root /var/www/html;

    # Add index.php to the list if you are using PHP
    index index.html index.htm index.nginx-debian.html;

    server_name _;

    location / {
        # 转发端口
        uwsgi_pass  127.0.0.1:5000;
        include uwsgi_params;
    }

}</code></span></span></span></span></pre>
</div>
<p style="margin-left:0;">
<span style="color:#111111;">
<span style="background-color:#ffffff;">
<span style="color:#000000;">
5.  将配置文件拷贝到/etc/nginx/sites-enabled/目录下。
</span>
</span>
</span>
</p>
<div style="margin-left:0;">
<pre><span style="color:#111111;"><span style="background-color:#ffffff;"><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code>ln -s /etc/nginx/sites-available/app.example.com /etc/nginx/sites-enabled/app.example.com
</code></span></span></span></span></pre>
</div>
<p style="margin-left:0;">
<span style="color:#111111;">
<span style="background-color:#ffffff;">
<span style="color:#000000;">
6.  启动 Nginx。
</span>
</span>
</span>
</p>
<div style="margin-left:0;">
<pre><span style="color:#111111;"><span style="background-color:#ffffff;"><span style="background-color:rgba(217,217,217,.3);"><span style="color:#000000;"><code>service nginx start</code></span></span></span></span></pre>
<p>
</p>
<h3>
十，上线小程序
</h3>
<p>
1.  请将小程序
<em>
pages/index/index.js
</em>
代码中的本地后端服务地址改为您的后端服务器域名，通信协议改为 HTTPS，例如：
</p>
<pre><code>https://api.aliyuntest.com/ecs/getServiceInfo</code></pre>
<p>
</p>
<p class="img-center">
<img alt="" height="196" src="https://i-blog.csdnimg.cn/blog_migrate/2aa11320a06825d849dc01707c5dc1bc.png" width="418"/>
</p>
<p>
2.  单击右上角工具栏上传，然后在弹出的对话框中单击上传，根据提示输入上传版本号并完成上传。
</p>
<p>
</p>
<p class="img-center">
<img alt="" height="201" src="https://i-blog.csdnimg.cn/blog_migrate/249ca09bfc8ee9c55eb6715692859089.png" width="594"/>
</p>
<p>
上传成功后会弹出如下提示。
</p>
<p>
</p>
<p class="img-center">
<img alt="" height="66" src="https://i-blog.csdnimg.cn/blog_migrate/e109190849d021171f04566f674488b4.png" width="203"/>
</p>
<p>
3.  在微信开放平台中，单击
<strong>
开发服务
</strong>
&gt;
<strong>
版本管理
</strong>
，查看已上传的开发版本。
</p>
<p>
</p>
<p class="img-center">
<img alt="" height="200" src="https://i-blog.csdnimg.cn/blog_migrate/a48e033548d2520ae87144eef4982b00.png" width="1200"/>
</p>
<p>
4.  单击
<strong>
提交审核
</strong>
，填写审核信息。
</p>
<p>
5.  审核通过后，管理员的微信中会收到小程序通过审核的通知。在审核版本右边单击
<strong>
上线
</strong>
，就可以在微信客户端中查看小程序了。 上架之后即为线上版本。有关小程序生命周期的更多信息请参见
<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/quickstart/release.html#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%89%88%E6%9C%AC" rel="nofollow" title="小程序协同工作和发布">
小程序协同工作和发布
</a>
。
</p>
</div>
</div>
</div>
</div>
</div>
</div>
<p>
</p>
</div>

   </div>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f6461697a696b75692f:61727469636c652f64657461696c732f313332343132353432" class_="artid" style="display:none">
 </p>
</div>
