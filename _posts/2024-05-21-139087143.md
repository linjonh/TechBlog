---
layout: post
title: "HarmonyOS-实现数据的持久化存储"
date: 2024-05-21 11:15:31 +0800
description: "利用数据库可以对大量数据进行持久化的储存，保证数据存储的完整性。_鸿蒙os开发数据库拿到的数据存入数"
keywords: "鸿蒙os开发数据库拿到的数据存入数组使用"
categories: ['Harmonyos']
tags: ['鸿蒙', '数据库', 'Harmonyos']
artid: "139087143"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=139087143
    alt: "HarmonyOS-实现数据的持久化存储"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     HarmonyOS-实现数据的持久化存储
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p id="main-toc">
     <strong>
      目录
     </strong>
    </p>
    <p id="-toc" style="margin-left:0px;">
    </p>
    <p id="%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93-toc" style="margin-left:0px;">
     <a href="#%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93" rel="nofollow">
      关系型数据库
     </a>
    </p>
    <p id="%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93-toc" style="margin-left:40px;">
     <a href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93" rel="nofollow">
      初始化数据库
     </a>
    </p>
    <p id="%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%85%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E9%80%BB%E8%BE%91-toc" style="margin-left:40px;">
     <a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%85%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E9%80%BB%E8%BE%91" rel="nofollow">
      数据库内的增删改逻辑
     </a>
    </p>
    <p id="%E6%96%B0%E5%A2%9E-toc" style="margin-left:80px;">
     <a href="#%E6%96%B0%E5%A2%9E" rel="nofollow">
      新增
     </a>
    </p>
    <p id="%E4%BF%AE%E6%94%B9-toc" style="margin-left:80px;">
     <a href="#%E4%BF%AE%E6%94%B9" rel="nofollow">
      修改
     </a>
    </p>
    <p id="%E5%88%A0%E9%99%A4-toc" style="margin-left:80px;">
     <a href="#%E5%88%A0%E9%99%A4" rel="nofollow">
      删除
     </a>
    </p>
    <p id="%E6%9F%A5%E8%AF%A2-toc" style="margin-left:80px;">
     <a href="#%E6%9F%A5%E8%AF%A2" rel="nofollow">
      查询
     </a>
    </p>
    <p id="%E5%A4%96%E9%83%A8%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9B%E8%A1%8C%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5-toc" style="margin-left:0px;">
     <a href="#%E5%A4%96%E9%83%A8%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9B%E8%A1%8C%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5" rel="nofollow">
      外部对数据库进行增删改查
     </a>
    </p>
    <p id="%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93-toc" style="margin-left:40px;">
     <a href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93" rel="nofollow">
      初始化数据库
     </a>
    </p>
    <p id="%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C-toc" style="margin-left:40px;">
     <a href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C" rel="nofollow">
      查询数据操作
     </a>
    </p>
    <p id="%E6%96%B0%E5%A2%9E%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C-toc" style="margin-left:40px;">
     <a href="#%E6%96%B0%E5%A2%9E%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C" rel="nofollow">
      新增数据操作
     </a>
    </p>
    <p id="%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C-toc" style="margin-left:40px;">
     <a href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C" rel="nofollow">
      更新数据操作
     </a>
    </p>
    <p id="%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C-toc" style="margin-left:40px;">
     <a href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C" rel="nofollow">
      删除数据操作
     </a>
    </p>
    <p id="%E4%BD%95%E6%97%B6%E5%88%9B%E5%BB%BA%E8%A1%A8-toc" style="margin-left:0px;">
     <a href="#%E4%BD%95%E6%97%B6%E5%88%9B%E5%BB%BA%E8%A1%A8" rel="nofollow">
      何时创建表
     </a>
    </p>
    <p id="%E5%89%8D%E6%8F%90-toc" style="margin-left:40px;">
     <a href="#%E5%89%8D%E6%8F%90" rel="nofollow">
      前提
     </a>
    </p>
    <p id="%E6%80%BB%E7%BB%93-toc" style="margin-left:0px;">
     <a href="#%E6%80%BB%E7%BB%93" rel="nofollow">
      总结
     </a>
    </p>
    <hr id="hr-toc"/>
    <p>
    </p>
    <h2 id="%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93">
     关系型数据库
    </h2>
    <h3 id="%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93">
     初始化数据库
    </h3>
    <p style="text-align:center;">
    </p>
    <p>
     <img alt="" height="384" src="https://i-blog.csdnimg.cn/blog_migrate/96f290ced18d1a3f47bbb8db3fe4e7b6.png" width="636"/>
    </p>
    <h3 id="%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%85%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E9%80%BB%E8%BE%91">
     数据库内的增删改逻辑
    </h3>
    <h4 id="%E6%96%B0%E5%A2%9E">
     新增
    </h4>
    <p>
     <img alt="" height="185" src="https://i-blog.csdnimg.cn/blog_migrate/b2fa3111633d329f71ea8fbca26bf29d.png" width="681"/>
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     rdbStore库中提供的insert方法用来新增数据操作
    </p>
    <h4 id="%E4%BF%AE%E6%94%B9" style="margin-left:.0001pt;text-align:justify;">
     修改
    </h4>
    <p>
     <img alt="" height="201" src="https://i-blog.csdnimg.cn/blog_migrate/c7191957d698d9879319635e1c00b6d0.png" width="692"/>
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     Predicates可以理解为where，修改数据的条件
    </p>
    <h4 id="%E5%88%A0%E9%99%A4" style="margin-left:.0001pt;text-align:justify;">
     删除
    </h4>
    <p>
     <img alt="" height="145" src="https://i-blog.csdnimg.cn/blog_migrate/28b5f2cc89852b69eccde9ec148ffdf4.png" width="692"/>
    </p>
    <h4 id="%E6%9F%A5%E8%AF%A2">
     查询
    </h4>
    <p style="margin-left:.0001pt;text-align:justify;">
     第一步构建查询条件
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     第二步解析查询结果
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     this.tableName为直接指定表名
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     <img alt="" height="130" src="https://i-blog.csdnimg.cn/blog_migrate/91db79b4acacd426473f39cbdf5bfe83.png" width="692"/>
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     query：是查询的方法
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     注：
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     (1).查询到的结果是一个promise，因为查询需要耗时，是一个异步方法，如果需要立刻拿到结果，需要在前面加上await来等待查询结果
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     (2).拿到的数据，是一个结果集，需要解析
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     (3).需要定义一个数组，来遍历分解这个结果集
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     <img alt="" height="284" src="https://i-blog.csdnimg.cn/blog_migrate/5b4eb866088ce90f747df232ac41afb9.png" width="692"/>
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     4).getLong方法用来获取id数据，因为是一个整数，getString方法来获取name，因为name是一个字符串，getColumnIndex（‘ID’）用来获取这一列的数据ID数据，然后将这一行结果封装到一个结果集tasks.push({id,name})返回给数组
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     5).拿到的表，实际上存在一个-1行，因此需要goToNextRow走到下一行来读取数据
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     6).事实上是不存在这张表的，数据全都存在于一个黑盒中，我们看不到
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     <img alt="" height="209" src="https://i-blog.csdnimg.cn/blog_migrate/10a575e304b18ba88ecd99602f9aef16.png" width="361"/>
    </p>
    <h2 id="%E5%A4%96%E9%83%A8%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9B%E8%A1%8C%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5" style="margin-left:.0001pt;text-align:justify;">
     外部对数据库进行增删改查
    </h2>
    <p style="margin-left:.0001pt;text-align:justify;">
     结构：数据的增删改查代码都要放到ets目录下的model文件中，新建一个ets文件，该文件内容如下：在一个class类中包含以下方法，初始化数据库（初始化表），查询表，新增表，更新表，删除表，最后将这个表的对象创建出来，然后做一个导出
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     <img alt="" height="106" src="https://i-blog.csdnimg.cn/blog_migrate/e1542ec373d79f43d0dc6968157742a8.png" width="381"/>
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     首先把关系型数据库的包导入
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     <img alt="" height="27" src="https://i-blog.csdnimg.cn/blog_migrate/810d22808e32d4a1b723fdbb59563f78.png" width="551"/>
    </p>
    <h3 style="margin-left:.0001pt;text-align:justify;">
     初始化数据库
    </h3>
    <p style="margin-left:.0001pt;text-align:justify;">
     ①初始化数据库方法里定义一个const config文件，一个是name（rdb数据库对应的文件名），另一个是安全级别securityLevel的一个枚举，securityLevel：relationStore.SecurityLevel.S1
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     ②sql语句：建表语句const sql = ‘sql语句’
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     ③获取rdb：传进三个参数，上下文context，工具类中的config，一个回调（由于可能出现异常，第三个参数写成(err,rdbStore)）
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     由于接下来的增删改查操作不会再重写一遍以上操作，所以把rdbStore记录到成员变量的位置，方便下面的直接引用
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     <img alt="" height="42" src="https://i-blog.csdnimg.cn/blog_migrate/18e464ff60c29b1577d304cd743e444e.png" width="430"/>
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     <img alt="" height="344" src="https://i-blog.csdnimg.cn/blog_migrate/22adf385f67231e19445939ec5ef36bf.png" width="692"/>
    </p>
    <h3 id="%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C" style="margin-left:.0001pt;text-align:justify;">
     查询数据操作
    </h3>
    <p style="margin-left:.0001pt;text-align:justify;">
     ①构建查询条件
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     直接指定一个成员变量，值为这张表TASK
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     <img alt="" height="42" src="https://i-blog.csdnimg.cn/blog_migrate/8330c9159897dbd7094e5d239733fa6e.png" width="331"/>
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     <img alt="" height="60" src="https://i-blog.csdnimg.cn/blog_migrate/37b3de6c239592699b8202c29de18a82.png" width="637"/>
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     ②查询
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     <img alt="" height="54" src="https://i-blog.csdnimg.cn/blog_migrate/e827f207a812195e369e0e02099fcdd7.png" width="692"/>
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     ③解析查询结果
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     <img alt="" height="363" src="https://i-blog.csdnimg.cn/blog_migrate/fca57e0f42d83d93ed687c880b7d0595.png" width="692"/>
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     总体代码：
    </p>
    <p>
     <img alt="" height="498" src="https://i-blog.csdnimg.cn/blog_migrate/d2c38474e0a03fc03cc1400ffa2c4ca3.png" width="692"/>
    </p>
    <h3 id="%E6%96%B0%E5%A2%9E%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C">
     新增数据操作
    </h3>
    <p>
     <img alt="" height="91" src="https://i-blog.csdnimg.cn/blog_migrate/88293296f1228aead1b20f367ec831fd.png" width="692"/>
    </p>
    <h3 id="%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C">
     更新数据操作
    </h3>
    <p>
     <img alt="" height="255" src="https://i-blog.csdnimg.cn/blog_migrate/cd6bf4318e17306c80eb49b81aa5276a.png" width="659"/>
    </p>
    <h3 id="%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C">
     删除数据操作
    </h3>
    <p>
     <img alt="" height="194" src="https://i-blog.csdnimg.cn/blog_migrate/38a574d6beb860a1f81841e33d2e1d23.png" width="664"/>
    </p>
    <h2 id="%E4%BD%95%E6%97%B6%E5%88%9B%E5%BB%BA%E8%A1%A8">
     何时创建表
    </h2>
    <h3 id="%E5%89%8D%E6%8F%90">
     前提
    </h3>
    <p style="margin-left:.0001pt;text-align:justify;">
     先导包，TaskModel包
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     <img alt="" height="27" src="https://i-blog.csdnimg.cn/blog_migrate/24681d270417e90d061bd984a8bbb3ce.png" width="412"/>
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     在页面刚启动时就要创建数据库建表，因此在EntryAbility入口文件里，onCreate方法中调用initTaskDB方法初始化表
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     <img alt="" height="66" src="https://i-blog.csdnimg.cn/blog_migrate/937f76bcdcc75ef2e95e16f024a08669.png" width="336"/>
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     接下来就要进到TaskList页面，对数据库列表执行增删改查操作
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     下面是查询操作
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     <img alt="" height="285" src="https://i-blog.csdnimg.cn/blog_migrate/9def11b47c9ff26ba5f6ad5e8d0bbb8a.png" width="475"/>
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     查询完数据，拿到数据后，调用handleTaskChange函数对数据库表的数据更新操作
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     <img alt="" height="171" src="https://i-blog.csdnimg.cn/blog_migrate/eabc5cb6a9859a528db0603dbac17882.png" width="672"/>
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     查询完后就新增数据：
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     <img alt="" height="440" src="https://i-blog.csdnimg.cn/blog_migrate/ac2e440bf679f267e276614c1e3a3804.png" width="659"/>
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     改查操作与以上是相同的步骤.
    </p>
    <h2 id="%E6%80%BB%E7%BB%93" style="margin-left:.0001pt;text-align:justify;">
     总结
    </h2>
    <p style="margin-left:.0001pt;text-align:justify;">
     利用数据库可以对大量数据进行持久化的储存，保证数据存储的完整性
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     谢谢老爷们的观看，我会持续更新，共同进步!为鸿蒙的建设贡献自己绵薄的力量，鸿蒙千帆起！
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f37333932383430312f:61727469636c652f64657461696c732f313339303837313433" class_="artid" style="display:none">
 </p>
</div>


