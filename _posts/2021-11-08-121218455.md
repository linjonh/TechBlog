---
layout: post
title: "MultipartException-Failed-to-parse-multipart-servlet-request-nested-exception-is-java.lang.Runtime"
date: 2021-11-08 23:05:14 +0800
description: "1、错误日志org.springframework.web.multipart.MultipartE"
keywords: "failed to parse multipart servlet request; nested exception is java.lang.run"
categories: ['']
tags: ['开发语言', '后端', 'Java']
artid: "121218455"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=121218455
    alt: "MultipartException-Failed-to-parse-multipart-servlet-request-nested-exception-is-java.lang.Runtime"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     MultipartException: Failed to parse multipart servlet request； nested exception is java.lang.Runtime
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="1_0">
     </a>
     1、错误日志
    </h3>
    <pre><code>org.springframework.web.multipart.MultipartException: Failed to parse multipart servlet request; nested exception is java.lang.RuntimeException: java.nio.file.NoSuchFileException: /tmp/undertow.8081.6091954911906268442/undertow2435234810596519507upload
        at org.springframework.web.multipart.support.StandardMultipartHttpServletRequest.handleParseFailure(StandardMultipartHttpServletRequest.java:124)
        at org.springframework.web.multipart.support.StandardMultipartHttpServletRequest.parseRequest(StandardMultipartHttpServletRequest.java:115)
        at org.springframework.web.multipart.support.StandardMultipartHttpServletRequest.&lt;init&gt;(StandardMultipartHttpServletRequest.java:88)
        at org.springframework.web.multipart.support.StandardServletMultipartResolver.resolveMultipart(StandardServletMultipartResolver.java:87)
        at org.springframework.web.servlet.DispatcherServlet.checkMultipart(DispatcherServlet.java:1178)
        at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1012)
        at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:943)
        at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006)
        at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:909)

</code></pre>
    <h3>
     <a id="2_16">
     </a>
     2、问题缘由
    </h3>
    <p>
     查阅了博客知道问题的原因：
     <br/>
     在 Linux 系统中，Spring Boot 应用以 java -jar 命令启动时，会在操作系统的 /tmp 目录下生成一个 tomcat（或 undertow ）临时目录，上传的文件先要转换成临时文件保存在这个文件夹下面。由于临时 /tmp 目录下的文件，在长时间（10天）没有使用的情况下，系统执行了 tmp 目录清理服务（systemd-tmpfiles-clean.service）,导致 /tmp/undertow…8090 文件被清理，然而在上传的时候，undertow 服务器需要创建/tmp/undertow…8090/undertow…upload 临时文件，但是调用 Files.createFile(…) 的时候就会发现找不到父目录，才导致了以上的错误。
    </p>
    <h3>
     <a id="3_21">
     </a>
     3、解决方案
    </h3>
    <p>
     1）重启
     <br/>
     无法一劳永逸
     <br/>
     2）配置文件指定目录
     <br/>
     需要在服务器手动创建文件夹
     <br/>
     mkdir -p /data/tmp
    </p>
    <pre><code>spring:
  servlet:
      multipart:
          location: /data/tmp
</code></pre>
    <p>
     3)添加启动参数 -java.tmp.dir=/path/to/application/temp/
    </p>
    <p>
     <strong>
      记录下后续遇到同样问题方便解决
     </strong>
    </p>
    <p>
     参考博客：
     <br/>
     https://blog.csdn.net/daixiantong/article/details/108239009
     <br/>
     https://blog.csdn.net/weixin_30468137/article/details/97497705
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34313634353233322f:61727469636c652f64657461696c732f313231323138343535" class_="artid" style="display:none">
 </p>
</div>


