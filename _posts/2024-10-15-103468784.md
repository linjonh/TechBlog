---
layout: post
title: "如何将图片存到数据库"
date: 2024-10-15 15:26:55 +0800
description: "通常对用户上传的图片需要保存到数据库中。解决方法一般有两种：一种是将图片保存的路径存储到数据库；另一"
keywords: "数据库怎么存放图片"
categories: ['Web', 'Java']
tags: ['无标签']
artid: "103468784"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=103468784
    alt: "如何将图片存到数据库"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     如何将图片存到数据库
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     通常对用户上传的图片需要保存到数据库中。解决方法一般有两种：一种是将图片保存的路径存储到数据库；另一种是将图片以二进制数据流的形式直接写入数据库字段中。以下为具体方法：
     <br/>
     一、保存图片的上传路径到数据库：
     <br/>
     string uppath="";//用于保存图片上传路径
     <br/>
     //获取上传图片的文件名
     <br/>
     string fileFullname = this.FileUpload1.FileName;
     <br/>
     //获取图片上传的时间，以时间作为图片的名字可以防止图片重名
     <br/>
     string dataName = DateTime.Now.ToString(“yyyyMMddhhmmss”);
     <br/>
     //获取图片的文件名（不含扩展名）
     <br/>
     string fileName = fileFullname.Substring(fileFullname.LastIndexOf("\") + 1);
     <br/>
     //获取图片扩展名
     <br/>
     string type = fileFullname.Substring(fileFullname.LastIndexOf(".") + 1);
     <br/>
     //判断是否为要求的格式
     <br/>
     if (type == “bmp” || type == “jpg” || type == “jpeg” || type == “gif” || type == “JPG” || type == “JPEG” || type == “BMP” || type == “GIF”)
     <br/>
     {
     <!-- -->
     <br/>
     //将图片上传到指定路径的文件夹
     <br/>
     this.FileUpload1.SaveAs(Server.MapPath("~/upload") + “\” + dataName + “.” + type);
     <br/>
     //将路径保存到变量，将该变量的值保存到数据库相应字段即可
     <br/>
     uppath = “~/upload/” + dataName + “.” + type;
     <br/>
     }
     <br/>
     二、将图片以二进制数据流直接保存到数据库：
     <br/>
     引用如下命名空间：
     <br/>
     using System.Drawing;
     <br/>
     using System.IO;
     <br/>
     using System.Data.SqlClient;
     <br/>
     设计数据库时，表中相应的字段类型为iamge
     <br/>
     保存：
     <br/>
     //图片路径
     <br/>
     string strPath = this.FileUpload1.PostedFile.FileName.ToString ();
     <br/>
     //读取图片
     <br/>
     FileStream fs = new System.IO.FileStream(strPath, FileMode.Open, FileAccess.Read);
     <br/>
     BinaryReader br = new BinaryReader(fs);
     <br/>
     byte[] photo = br.ReadBytes((int)fs.Length);
     <br/>
     br.Close();
     <br/>
     fs.Close();
     <br/>
     //存入
     <br/>
     SqlConnection myConn = new SqlConnection(“Data Source=.;Initial Catalog=stumanage;User ID=sa;Password=123”);
     <br/>
     string strComm = " INSERT INTO stuInfo(stuid,stuimage) VALUES(107,@photoBinary )";//操作数据库语句根据需要修改
     <br/>
     SqlCommand myComm = new SqlCommand(strComm, myConn);
     <br/>
     myComm.Parameters.Add("@photoBinary", SqlDbType.Binary, photo.Length);
     <br/>
     myComm.Parameters["@photoBinary"].Value = photo;
     <br/>
     myConn.Open();
     <br/>
     if (myComm.ExecuteNonQuery() &gt; 0)
     <br/>
     {
     <!-- -->
     <br/>
     this.Label1.Text = “ok”;
     <br/>
     }
     <br/>
     myConn.Close();
     <br/>
     读取：
     <br/>
     …连接数据库字符串省略
     <br/>
     mycon.Open();
     <br/>
     SqlCommand command = new
     <br/>
     SqlCommand(“select stuimage from stuInfo where stuid=107”, mycon);//查询语句根据需要修改
     <br/>
     byte[] image = (byte[])command.ExecuteScalar ();
     <br/>
     //指定从数据库读取出来的图片的保存路径及名字
     <br/>
     string strPath = “~/Upload/zhangsan.JPG”;
     <br/>
     string strPhotoPath = Server.MapPath(strPath);
     <br/>
     //按上面的路径与名字保存图片文件
     <br/>
     BinaryWriter bw = new BinaryWriter(File.Open(strPhotoPath,FileMode.OpenOrCreate));
     <br/>
     bw.Write(image);
     <br/>
     bw.Close();
     <br/>
     //显示图片
     <br/>
     this.Image1.ImageUrl = strPath;
     <br/>
     采用俩种方式可以根据实际需求灵活选择。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33303334373133332f:61727469636c652f64657461696c732f313033343638373834" class_="artid" style="display:none">
 </p>
</div>


