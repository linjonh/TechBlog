---
layout: post
title: Nim游戏和SG函数
date: 2024-12-14 12:03:09 +0800
categories: ['数论与组合数学']
tags: ['无标签']
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=38775419
    alt: Nim游戏和SG函数
artid: 38775419
render_with_liquid: false
---
<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Nim游戏和SG函数
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h3>
     一、
     <span style="font-family:Arial">
      Nim
     </span>
     <span style="font-family:黑体">
      游戏
     </span>
    </h3>
    <p>
     重点结论：对于一个
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      游戏的局面
     </span>
     <span style="font-family:Times New Roman">
      (a1,a2,...,an)
     </span>
     <span style="font-family:宋体">
      ，它是
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      当且仅当
     </span>
     <span style="font-family:Times New Roman">
      a1^a2^...^an=0
     </span>
     <span style="font-family:宋体">
      ，其中
     </span>
     <span style="font-family:Times New Roman">
      ^
     </span>
     <span style="font-family:宋体">
      表示位异或
     </span>
     <span style="font-family:Times New Roman">
      (xor)
     </span>
     <span style="font-family:宋体">
      运算
     </span>
     。
    </p>
    <p>
    </p>
    <p>
     Nim
     <span style="font-family:宋体">
      游戏是博弈论中最经典的模型（之一？），它又有着十分简单的规则和无比优美的结论，由这个游戏开始了解博弈论恐怕是最合适不过了。
     </span>
    </p>
    <p>
    </p>
    <p>
     Nim
     <span style="font-family:宋体">
      游戏是组合游戏
     </span>
     <span style="font-family:Times New Roman">
      (Combinatorial Games)
     </span>
     <span style="font-family:宋体">
      的一种，准确来说，属于
     </span>
     <span style="font-family:Times New Roman">
      “Impartial Combinatorial Games”
     </span>
     <span style="font-family:宋体">
      （以下简称
     </span>
     <span style="font-family:Times New Roman">
      ICG
     </span>
     <span style="font-family:宋体">
      ）。满足以下条件的游戏是
     </span>
     <span style="font-family:Times New Roman">
      ICG
     </span>
     <span style="font-family:宋体">
      （可能不太严谨）：
     </span>
     <span style="font-family:Times New Roman">
      1
     </span>
     <span style="font-family:宋体">
      、有两名选手；
     </span>
     <span style="font-family:Times New Roman">
      2
     </span>
     <span style="font-family:宋体">
      、两名选手交替对游戏进行移动
     </span>
     <span style="font-family:Times New Roman">
      (move)
     </span>
     <span style="font-family:宋体">
      ，每次一 步，选手可以在（一般而言）有限的合法移动集合中任选一种进行移动；
     </span>
     <span style="font-family:Times New Roman">
      3
     </span>
     <span style="font-family:宋体">
      、对于游戏的任何一种可能的局面，合法的移动集合只取决于这个局面本身，不取决于轮 到哪名选手操作、以前的任何操作、骰子的点数或者其它什么因素；
     </span>
     <span style="font-family:Times New Roman">
      4
     </span>
     <span style="font-family:宋体">
      、如果轮到某名选手移动，且这个局面的合法的移动集合为空（也就是说此时无法进行移动），则这名选手负。根据这个定义，很多日常的游戏并非
     </span>
     <span style="font-family:Times New Roman">
      ICG
     </span>
     <span style="font-family:宋体">
      。例如 象棋就不满足条件
     </span>
     <span style="font-family:Times New Roman">
      3
     </span>
     <span style="font-family:宋体">
      ，因为红方只能移动红子，黑方只能移动黑子，合法的移动集合取决于轮到哪名选手操作。
     </span>
    </p>
    <p>
    </p>
    <p>
     通常的
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      游戏的定义是这样的：有若干堆石子，每堆石子的数量都是有限的，合法的移动是
     </span>
     <span style="font-family:Times New Roman">
      “
     </span>
     <span style="font-family:宋体">
      选择一堆石子并拿走若干颗（不能不拿）
     </span>
     <span style="font-family:Times New Roman">
      ”
     </span>
     <span style="font-family:宋体">
      ，如果轮到某个人时所有的石子堆都已经被拿空了，则判负（因为他此刻没有任何合法的移动）。
     </span>
    </p>
    <p>
     这 游戏看上去有点复杂，先从简单情况开始研究吧。如果轮到你的时候，只剩下一堆石子，那么此时的必胜策略肯定是把这堆石子全部拿完一颗也不给对手剩，然后对 手就输了。如果剩下两堆不相等的石子，必胜策略是通过取多的一堆的石子将两堆石子变得相等，以后如果对手在某一堆里拿若干颗，你就可以在另一堆中拿同样多 的颗数，直至胜利。如果你面对的是两堆相等的石子，那么此时你是没有任何必胜策略的，反而对手可以遵循上面的策略保证必胜。如果是三堆石子
     <span style="font-family:Times New Roman">
      ……
     </span>
     <span style="font-family:宋体">
      好像已经很 难分析了，看来我们必须要借助一些其它好用的（最好是程式化的）分析方法了，或者说，我们最好能够设计出一种在有必胜策略时就能找到必胜策略的算法。
     </span>
    </p>
    <p>
    </p>
    <p>
     定 义
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      和
     </span>
     <span style="font-family:Times New Roman">
      N-position
     </span>
     <span style="font-family:宋体">
      ，其中
     </span>
     <span style="font-family:Times New Roman">
      P
     </span>
     <span style="font-family:宋体">
      代表
     </span>
     <span style="font-family:Times New Roman">
      Previous
     </span>
     <span style="font-family:宋体">
      ，
     </span>
     <span style="font-family:Times New Roman">
      N
     </span>
     <span style="font-family:宋体">
      代表
     </span>
     <span style="font-family:Times New Roman">
      Next
     </span>
     <span style="font-family:宋体">
      。直观的说，上一次
     </span>
     <span style="font-family:Times New Roman">
      move
     </span>
     <span style="font-family:宋体">
      的人有必胜策略的局面是
     </span>
     <span style="font-family:Times New Roman">
      P- position
     </span>
     <span style="font-family:宋体">
      ，也就是
     </span>
     <span style="font-family:Times New Roman">
      “
     </span>
     <span style="font-family:宋体">
      后手可保证必胜
     </span>
     <span style="font-family:Times New Roman">
      ”
     </span>
     <span style="font-family:宋体">
      或者
     </span>
     <span style="font-family:Times New Roman">
      “
     </span>
     <span style="font-family:宋体">
      先手必败
     </span>
     <span style="font-family:Times New Roman">
      ”
     </span>
     <span style="font-family:宋体">
      ，现在轮到
     </span>
     <span style="font-family:Times New Roman">
      move
     </span>
     <span style="font-family:宋体">
      的人有必胜策略的局面是
     </span>
     <span style="font-family:Times New Roman">
      N-position
     </span>
     <span style="font-family:宋体">
      ，也就是
     </span>
     <span style="font-family:Times New Roman">
      “
     </span>
     <span style="font-family:宋体">
      先手可保证必胜
     </span>
     <span style="font-family:Times New Roman">
      ”
     </span>
     <span style="font-family:宋体">
      。更严谨的定义是：
     </span>
     <span style="font-family:Times New Roman">
      1.
     </span>
     <span style="font-family:宋体">
      无法进行任何移动的局面（也就是
     </span>
     <span style="font-family:Times New Roman">
      terminal position
     </span>
     <span style="font-family:宋体">
      ）是
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      ；
     </span>
     <span style="font-family:Times New Roman">
      2.
     </span>
     <span style="font-family:宋体">
      可以移动到
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      的局面是
     </span>
     <span style="font-family:Times New Roman">
      N-position
     </span>
     <span style="font-family:宋体">
      ；
     </span>
     <span style="font-family:Times New Roman">
      3.
     </span>
     <span style="font-family:宋体">
      所有移动都导致
     </span>
     <span style="font-family:Times New Roman">
      N-position
     </span>
     <span style="font-family:宋体">
      的局面是
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      。
     </span>
    </p>
    <p>
    </p>
    <p>
     按照这个定义，如果局面不可能重现，或者说
     <span style="font-family:Times New Roman">
      positions
     </span>
     <span style="font-family:宋体">
      的集合可以进行拓扑排序，那么每个
     </span>
     <span style="font-family:Times New Roman">
      position
     </span>
     <span style="font-family:宋体">
      或者是
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      或者是
     </span>
     <span style="font-family:Times New Roman">
      N-position
     </span>
     <span style="font-family:宋体">
      ，而且可以通过定义计算出来。
     </span>
    </p>
    <p>
    </p>
    <p>
     以
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      游戏为例来进行一下计算。比如说我刚才说当只有两堆石子且两堆石子数量相等时后手有必胜策略，也就是这是一个
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      ，下面我们依靠定 义证明一下
     </span>
     <span style="font-family:Times New Roman">
      (3,3)
     </span>
     <span style="font-family:宋体">
      是一个
     </span>
     <span style="font-family:Times New Roman">
      P
     </span>
     <span style="font-family:宋体">
      是一个
     </span>
     <span style="font-family:Times New Roman">
      P
     </span>
     <span style="font-family:宋体">
      是一个
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      。首先
     </span>
     <span style="font-family:Times New Roman">
      (3,3)
     </span>
     <span style="font-family:宋体">
      的子局面（也就是通过合法移动可以导致的局面）有
     </span>
     <span style="font-family:Times New Roman">
      (0,3)(1,3) (2,3)
     </span>
     <span style="font-family:宋体">
      （显然交换石子堆的位置不影响其性质，所以把
     </span>
     <span style="font-family:Times New Roman">
      (x,y)
     </span>
     <span style="font-family:宋体">
      和
     </span>
     <span style="font-family:Times New Roman">
      (y,x)
     </span>
     <span style="font-family:宋体">
      看成同一种局面），只需要计算出这三种局面的性质就可以了。
     </span>
     <span style="font-family:Times New Roman">
      (0,3)
     </span>
     <span style="font-family:宋体">
      的子局面有
     </span>
     <span style="font-family:Times New Roman">
      (0,0)
     </span>
     <span style="font-family:宋体">
      、
     </span>
     <span style="font-family:Times New Roman">
      (0,1)
     </span>
     <span style="font-family:宋体">
      、
     </span>
     <span style="font-family:Times New Roman">
      (0,2)
     </span>
     <span style="font-family:宋体">
      ，其中
     </span>
     <span style="font-family:Times New Roman">
      (0,0)
     </span>
     <span style="font-family:宋体">
      显然是
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      ，所以
     </span>
     <span style="font-family:Times New Roman">
      (0,3)
     </span>
     <span style="font-family:宋体">
      是
     </span>
     <span style="font-family:Times New Roman">
      N-position
     </span>
     <span style="font-family:宋体">
      （只要找到 一个是
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      的子局面就能说明是
     </span>
     <span style="font-family:Times New Roman">
      N-position
     </span>
     <span style="font-family:宋体">
      ）。
     </span>
     <span style="font-family:Times New Roman">
      (1,3)
     </span>
     <span style="font-family:宋体">
      的后继中
     </span>
     <span style="font-family:Times New Roman">
      (1,1)
     </span>
     <span style="font-family:宋体">
      是
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      （因为
     </span>
     <span style="font-family:Times New Roman">
      (1,1)
     </span>
     <span style="font-family:宋体">
      的唯一子局 面
     </span>
     <span style="font-family:Times New Roman">
      (0,1)
     </span>
     <span style="font-family:宋体">
      是
     </span>
     <span style="font-family:Times New Roman">
      N-position
     </span>
     <span style="font-family:宋体">
      ），所以
     </span>
     <span style="font-family:Times New Roman">
      (1,3)
     </span>
     <span style="font-family:宋体">
      也是
     </span>
     <span style="font-family:Times New Roman">
      N-position
     </span>
     <span style="font-family:宋体">
      。同样可以证明
     </span>
     <span style="font-family:Times New Roman">
      (2,3)
     </span>
     <span style="font-family:宋体">
      是
     </span>
     <span style="font-family:Times New Roman">
      N-position
     </span>
     <span style="font-family:宋体">
      。所以
     </span>
     <span style="font-family:Times New Roman">
      (3,3)
     </span>
     <span style="font-family:宋体">
      的所有 子局面都是
     </span>
     <span style="font-family:Times New Roman">
      N-position
     </span>
     <span style="font-family:宋体">
      ，它就是
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      。通过一点简单的数学归纳，可以严格的证明
     </span>
     <span style="font-family:Times New Roman">
      “
     </span>
     <span style="font-family:宋体">
      有两堆石子时的局面是
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      当且 仅当这两堆石子的数目相等
     </span>
     <span style="font-family:Times New Roman">
      ”
     </span>
     <span style="font-family:宋体">
      。
     </span>
    </p>
    <p>
    </p>
    <p>
     根据上面这个过程，可以得到一个递归的算法
     <span style="font-family:Times New Roman">
      ——
     </span>
     <span style="font-family:宋体">
      对于当前的局面，递归计算它的所有子局面的性质，如果存在某 个子局面是
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      ，那么向这个子局面的移动就是必胜策略。当然，可能你已经敏锐地看出有大量的重叠子问题，所以可以用
     </span>
     <span style="font-family:Times New Roman">
      DP
     </span>
     <span style="font-family:宋体">
      或者记忆化搜索的 方法以提高效率（简单的博弈问题想到这一步就可以了）。但问题是，利用这个算法，对于某个
     </span>
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      游戏的局面
     </span>
     <span style="font-family:Times New Roman">
      (a1,a2,...,an)
     </span>
     <span style="font-family:宋体">
      来说，要想判断它 的性质以及找出必胜策略，需要计算
     </span>
     <span style="font-family:Times New Roman">
      O(a1*a2*...*an)
     </span>
     <span style="font-family:宋体">
      个局面的性质，不管怎样记忆化都无法降低这个时间复杂度。所以我们需要更高效的判断
     </span>
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      游戏的局面的性质的方法。
     </span>
    </p>
    <p>
    </p>
    <p>
     直接说结论好了。
     <span style="font-family:Times New Roman">
      (Bouton's Theorem)
     </span>
     <span style="font-family:宋体">
      对于一个
     </span>
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      游戏的局面
     </span>
     <span style="font-family:Times New Roman">
      (a1,a2,...,an)
     </span>
     <span style="font-family:宋体">
      ，它是
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      当且仅当
     </span>
     <span style="font-family:Times New Roman">
      a1^a2^...^an=0
     </span>
     <span style="font-family:宋体">
      ，其中
     </span>
     <span style="font-family:Times New Roman">
      ^
     </span>
     <span style="font-family:宋体">
      表示异 或
     </span>
     <span style="font-family:Times New Roman">
      (xor)
     </span>
     <span style="font-family:宋体">
      运算。怎么样，是不是很神奇？我看到它的时候也觉得很神奇，完全没有道理的和异或运算扯上了关系。但这个定理的证明却也不复杂，基本上就是按 照两种
     </span>
     <span style="font-family:Times New Roman">
      position
     </span>
     <span style="font-family:宋体">
      的证明来的。
     </span>
    </p>
    <p>
    </p>
    <p>
     根据定义，证明一种判断
     <span style="font-family:Times New Roman">
      position
     </span>
     <span style="font-family:宋体">
      的性质的方法的正确性，只需证明三个命题：
     </span>
     <span style="font-family:Times New Roman">
      1
     </span>
     <span style="font-family:宋体">
      、这个判断将所有
     </span>
     <span style="font-family:Times New Roman">
      terminal position
     </span>
     <span style="font-family:宋体">
      判为
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      ；
     </span>
     <span style="font-family:Times New Roman">
      2
     </span>
     <span style="font-family:宋体">
      、根据这个判断被判为
     </span>
     <span style="font-family:Times New Roman">
      N-position
     </span>
     <span style="font-family:宋体">
      的局面一定可以移动到某个
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      ；
     </span>
     <span style="font-family:Times New Roman">
      3
     </span>
     <span style="font-family:宋体">
      、根据这个判 断被判为
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      的局面无法移动到某个
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      。
     </span>
    </p>
    <p>
    </p>
    <p>
     第一个命题显然，
     <span style="font-family:Times New Roman">
      terminal position
     </span>
     <span style="font-family:宋体">
      只有一个，就是全
     </span>
     <span style="font-family:Times New Roman">
      0
     </span>
     <span style="font-family:宋体">
      ，异或仍然是
     </span>
     <span style="font-family:Times New Roman">
      0
     </span>
     <span style="font-family:宋体">
      。
     </span>
    </p>
    <p>
    </p>
    <p>
     第 二个命题，对于某个局面
     <span style="font-family:Times New Roman">
      (a1,a2,...,an)
     </span>
     <span style="font-family:宋体">
      ，若
     </span>
     <span style="font-family:Times New Roman">
      a1^a2^...^an!=0
     </span>
     <span style="font-family:宋体">
      ，一定存在某个合法的移动，将
     </span>
     <span style="font-family:Times New Roman">
      ai
     </span>
     <span style="font-family:宋体">
      改变成
     </span>
     <span style="font-family:Times New Roman">
      ai'
     </span>
     <span style="font-family:宋体">
      后满足
     </span>
     <span style="font-family:Times New Roman">
      a1^a2^...^ai'^...^an=0
     </span>
     <span style="font-family:宋体">
      。不妨设
     </span>
     <span style="font-family:Times New Roman">
      a1^a2^...^an=k
     </span>
     <span style="font-family:宋体">
      ，则一定存在某个
     </span>
     <span style="font-family:Times New Roman">
      ai
     </span>
     <span style="font-family:宋体">
      ，它的二进制表示在
     </span>
     <span style="font-family:Times New Roman">
      k
     </span>
     <span style="font-family:宋体">
      的最高位上是
     </span>
     <span style="font-family:Times New Roman">
      1
     </span>
     <span style="font-family:宋体">
      （否则
     </span>
     <span style="font-family:Times New Roman">
      k
     </span>
     <span style="font-family:宋体">
      的 最高位那个
     </span>
     <span style="font-family:Times New Roman">
      1
     </span>
     <span style="font-family:宋体">
      是怎么得到的）。这时
     </span>
     <span style="font-family:Times New Roman">
      ai^k&lt;ai
     </span>
     <span style="font-family:宋体">
      一定成立。则我们可以将
     </span>
     <span style="font-family:Times New Roman">
      ai
     </span>
     <span style="font-family:宋体">
      改变成
     </span>
     <span style="font-family:Times New Roman">
      ai'=ai^k
     </span>
     <span style="font-family:宋体">
      ，此时
     </span>
     <span style="font-family:Times New Roman">
      a1^a2^...^ai'^...^an=a1^a2^...^an^k=0
     </span>
     <span style="font-family:宋体">
      。
     </span>
    </p>
    <p>
    </p>
    <p>
     第三个命题，对于某个局面
     <span style="font-family:Times New Roman">
      (a1,a2,...,an)
     </span>
     <span style="font-family:宋体">
      ，若
     </span>
     <span style="font-family:Times New Roman">
      a1^a2^...^an=0
     </span>
     <span style="font-family:宋体">
      ，一定不存在某个合法的移动，将
     </span>
     <span style="font-family:Times New Roman">
      ai
     </span>
     <span style="font-family:宋体">
      改变成
     </span>
     <span style="font-family:Times New Roman">
      ai'
     </span>
     <span style="font-family:宋体">
      后满足
     </span>
     <span style="font-family:Times New Roman">
      a1^a2^...^ai'^...^an=0
     </span>
     <span style="font-family:宋体">
      。因为异或运算满足消去率，由
     </span>
     <span style="font-family:Times New Roman">
      a1^a2^...^an=a1^a2^...^ai'^...^an
     </span>
     <span style="font-family:宋体">
      可以得 到
     </span>
     <span style="font-family:Times New Roman">
      ai=ai'
     </span>
     <span style="font-family:宋体">
      。所以将
     </span>
     <span style="font-family:Times New Roman">
      ai
     </span>
     <span style="font-family:宋体">
      改变成
     </span>
     <span style="font-family:Times New Roman">
      ai'
     </span>
     <span style="font-family:宋体">
      不是一个合法的移动。证毕。
     </span>
    </p>
    <p>
    </p>
    <p>
     根据这个定理，我们可以在
     <span style="font-family:Times New Roman">
      O(n)
     </span>
     <span style="font-family:宋体">
      的时间内判断一个
     </span>
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      的局面的性质，且如果它是
     </span>
     <span style="font-family:Times New Roman">
      N-position
     </span>
     <span style="font-family:宋体">
      ，也可以在
     </span>
     <span style="font-family:Times New Roman">
      O(n)
     </span>
     <span style="font-family:宋体">
      的时间内找到所有的必胜策略。
     </span>
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      问题就这样基本上完美的解决了。
     </span>
    </p>
    <p>
    </p>
    <p>
    </p>
    <h3>
     二、Sprague-Grundy
     <span style="font-family:黑体">
      函数
     </span>
    </h3>
    <p>
     上一期的文章里我们仔细研究了
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      游戏，并且了解了找出必胜策略的方法。但如果把
     </span>
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      的规则略加改变，你还能很快找出必胜策略吗？比如说：有
     </span>
     <span style="font-family:Times New Roman">
      n
     </span>
     <span style="font-family:宋体">
      堆石子， 每次可以从第
     </span>
     <span style="font-family:Times New Roman">
      1
     </span>
     <span style="font-family:宋体">
      堆石子里取
     </span>
     <span style="font-family:Times New Roman">
      1
     </span>
     <span style="font-family:宋体">
      颗、
     </span>
     <span style="font-family:Times New Roman">
      2
     </span>
     <span style="font-family:宋体">
      颗或
     </span>
     <span style="font-family:Times New Roman">
      3
     </span>
     <span style="font-family:宋体">
      颗，可以从第
     </span>
     <span style="font-family:Times New Roman">
      2
     </span>
     <span style="font-family:宋体">
      堆石子里取奇数颗，可以从第
     </span>
     <span style="font-family:Times New Roman">
      3
     </span>
     <span style="font-family:宋体">
      堆及以后石子里取任意颗
     </span>
     <span style="font-family:Times New Roman">
      ……
     </span>
     <span style="font-family:宋体">
      这时看上去问题复杂了很多，但相信你如果 掌握了本节的内容，类似的千变万化的问题都是不成问题的。
     </span>
    </p>
    <p>
    </p>
    <p>
     现在我们来研究一个看上去似乎更为一般的游戏：给定一个有向无环图和一个起始顶 点上的一枚棋子，两名选手交替的将这枚棋子沿有向边进行移动，无法移动者判负。事实上，这个游戏可以认为是所有
     <span style="font-family:Times New Roman">
      Impartial Combinatorial Games
     </span>
     <span style="font-family:宋体">
      的抽象模型。也就是说，任何一个
     </span>
     <span style="font-family:Times New Roman">
      ICG
     </span>
     <span style="font-family:宋体">
      都可以通过把每个局面看成一个顶点，对每个局面和它的子局面连一条有向边来抽象成这个
     </span>
     <span style="font-family:Times New Roman">
      “
     </span>
     <span style="font-family:宋体">
      有向图游戏
     </span>
     <span style="font-family:Times New Roman">
      ”
     </span>
     <span style="font-family:宋体">
      。下 面我们就在有向无环图的顶点上定义
     </span>
     <span style="font-family:Times New Roman">
      Sprague-Garundy
     </span>
     <span style="font-family:宋体">
      函数。
     </span>
    </p>
    <p>
    </p>
    <p>
     首先定义
     <span style="font-family:Times New Roman">
      mex(minimal excludant)
     </span>
     <span style="font-family:宋体">
      运算，这是施加于一个集合的运算，表示最小的不属于这个集合的非负整数。例如
     </span>
     <span style="font-family:Times New Roman">
      mex{0,1,2,4}=3
     </span>
     <span style="font-family:宋体">
      、
     </span>
     <span style="font-family:Times New Roman">
      mex{2,3,5}=0
     </span>
     <span style="font-family:宋体">
      、
     </span>
     <span style="font-family:Times New Roman">
      mex{}=0
     </span>
     <span style="font-family:宋体">
      。
     </span>
    </p>
    <p>
    </p>
    <p>
     对于一个给定的有向无环图，定义关于图的每个顶点的
     <span style="font-family:Times New Roman">
      Sprague-Garundy
     </span>
     <span style="font-family:宋体">
      函数
     </span>
     <span style="font-family:Times New Roman">
      g
     </span>
     <span style="font-family:宋体">
      如下：
     </span>
     <span style="font-family:Times New Roman">
      g(x)=mex{ g(y) | y
     </span>
     <span style="font-family:宋体">
      是
     </span>
     <span style="font-family:Times New Roman">
      x
     </span>
     <span style="font-family:宋体">
      的后继
     </span>
     <span style="font-family:Times New Roman">
      }
     </span>
     <span style="font-family:宋体">
      。
     </span>
    </p>
    <p>
    </p>
    <p>
     来 看一下
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      函数的性质。首先，所有的
     </span>
     <span style="font-family:Times New Roman">
      terminal position
     </span>
     <span style="font-family:宋体">
      所对应的顶点，也就是没有出边的顶点，其
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      值为
     </span>
     <span style="font-family:Times New Roman">
      0
     </span>
     <span style="font-family:宋体">
      ，因为它的后继集合是空集。然后对于一个
     </span>
     <span style="font-family:Times New Roman">
      g(x)=0
     </span>
     <span style="font-family:宋体">
      的顶点
     </span>
     <span style="font-family:Times New Roman">
      x
     </span>
     <span style="font-family:宋体">
      ，它的所有后继
     </span>
     <span style="font-family:Times New Roman">
      y
     </span>
     <span style="font-family:宋体">
      都满足
     </span>
     <span style="font-family:Times New Roman">
      g(y)!=0
     </span>
     <span style="font-family:宋体">
      。对于一个
     </span>
     <span style="font-family:Times New Roman">
      g(x)!=0
     </span>
     <span style="font-family:宋体">
      的顶点，必定存在一个后继
     </span>
     <span style="font-family:Times New Roman">
      y
     </span>
     <span style="font-family:宋体">
      满足
     </span>
     <span style="font-family:Times New Roman">
      g(y)=0
     </span>
     <span style="font-family:宋体">
      。
     </span>
    </p>
    <p>
    </p>
    <p>
     以上这三句话表明，顶点
     <span style="font-family:Times New Roman">
      x
     </span>
     <span style="font-family:宋体">
      所代表的
     </span>
     <span style="font-family:Times New Roman">
      postion
     </span>
     <span style="font-family:宋体">
      是
     </span>
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      当且仅当
     </span>
     <span style="font-family:Times New Roman">
      g(x)=0
     </span>
     <span style="font-family:宋体">
      （跟
     </span>
     <span style="font-family:Times New Roman">
      P-positioin/N-position
     </span>
     <span style="font-family:宋体">
      的定义的那三句话是完全对应的）。我们通过计算有向无环图 的每个顶点的
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      值，就可以对每种局面找到必胜策略了。但
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      函数的用途远没有这样简单。如果将有向图游戏变复杂一点，比如说，有向图上并不是只有一枚棋 子，而是有
     </span>
     <span style="font-family:Times New Roman">
      n
     </span>
     <span style="font-family:宋体">
      枚棋子，每次可以任选一颗进行移动，这时，怎样找到必胜策略呢？
     </span>
    </p>
    <p>
    </p>
    <p>
     让我们再来考虑一下顶点的
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      值的意义。当
     </span>
     <span style="font-family:Times New Roman">
      g(x)=k
     </span>
     <span style="font-family:宋体">
      时， 表明对于任意一个
     </span>
     <span style="font-family:Times New Roman">
      0&lt;=i&lt;k
     </span>
     <span style="font-family:宋体">
      ，都存在
     </span>
     <span style="font-family:Times New Roman">
      x
     </span>
     <span style="font-family:宋体">
      的一个后继
     </span>
     <span style="font-family:Times New Roman">
      y
     </span>
     <span style="font-family:宋体">
      满足
     </span>
     <span style="font-family:Times New Roman">
      g(y)=i
     </span>
     <span style="font-family:宋体">
      。也就是说，当某枚棋子的
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      值是
     </span>
     <span style="font-family:Times New Roman">
      k
     </span>
     <span style="font-family:宋体">
      时，我们可以把它变成
     </span>
     <span style="font-family:Times New Roman">
      0
     </span>
     <span style="font-family:宋体">
      、变成
     </span>
     <span style="font-family:Times New Roman">
      1
     </span>
     <span style="font-family:宋体">
      、
     </span>
     <span style="font-family:Times New Roman">
      ……
     </span>
     <span style="font-family:宋体">
      、变成
     </span>
     <span style="font-family:Times New Roman">
      k-1
     </span>
     <span style="font-family:宋体">
      ，但绝对不能保持
     </span>
     <span style="font-family:Times New Roman">
      k
     </span>
     <span style="font-family:宋体">
      不变。不知道你能不能根据这个联想到
     </span>
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      游戏，
     </span>
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      游戏的规则就是：每次选择一堆数量为
     </span>
     <span style="font-family:Times New Roman">
      k
     </span>
     <span style="font-family:宋体">
      的石子，可以把它变 成
     </span>
     <span style="font-family:Times New Roman">
      0
     </span>
     <span style="font-family:宋体">
      、变成
     </span>
     <span style="font-family:Times New Roman">
      1
     </span>
     <span style="font-family:宋体">
      、
     </span>
     <span style="font-family:Times New Roman">
      ……
     </span>
     <span style="font-family:宋体">
      、变成
     </span>
     <span style="font-family:Times New Roman">
      k-1
     </span>
     <span style="font-family:宋体">
      ，但绝对不能保持
     </span>
     <span style="font-family:Times New Roman">
      k
     </span>
     <span style="font-family:宋体">
      不变。这表明，如果将
     </span>
     <span style="font-family:Times New Roman">
      n
     </span>
     <span style="font-family:宋体">
      枚棋子所在的顶点的
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      值看作
     </span>
     <span style="font-family:Times New Roman">
      n
     </span>
     <span style="font-family:宋体">
      堆相应数量的石子，那么这个
     </span>
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      游戏的每个必 胜策略都对应于原来这
     </span>
     <span style="font-family:Times New Roman">
      n
     </span>
     <span style="font-family:宋体">
      枚棋子的必胜策略
     </span>
     。
    </p>
    <p>
    </p>
    <p>
     对于
     <span style="font-family:Times New Roman">
      n
     </span>
     <span style="font-family:宋体">
      个棋子，设它们对应的顶点的
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      值分别为
     </span>
     <span style="font-family:Times New Roman">
      (a1,a2,…,an)
     </span>
     <span style="font-family:宋体">
      ，再设局面
     </span>
     <span style="font-family:Times New Roman">
      (a1,a2,…,an)
     </span>
     <span style="font-family:宋体">
      时的
     </span>
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      游戏的一种必胜策略是把
     </span>
     <span style="font-family:Times New Roman">
      ai
     </span>
     <span style="font-family:宋体">
      变成
     </span>
     <span style="font-family:Times New Roman">
      k
     </span>
     <span style="font-family:宋体">
      ，那么原游戏的一种必胜策略就是把第
     </span>
     <span style="font-family:Times New Roman">
      i
     </span>
     <span style="font-family:宋体">
      枚棋子移动到一个
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      值为
     </span>
     <span style="font-family:Times New Roman">
      k
     </span>
     <span style="font-family:宋体">
      的顶点。这听上去 有点过于神奇
     </span>
     <span style="font-family:Times New Roman">
      ——
     </span>
     <span style="font-family:宋体">
      怎么绕了一圈又回到
     </span>
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      游戏上了。
     </span>
    </p>
    <p>
    </p>
    <p>
     其实我们还是只要证明这种多棋子的有向图游戏的局面是
     <span style="font-family:Times New Roman">
      P-position
     </span>
     <span style="font-family:宋体">
      当且仅当所有棋子所在的位置的
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      函数的异或为
     </span>
     <span style="font-family:Times New Roman">
      0
     </span>
     <span style="font-family:宋体">
      。这个证明与上节的
     </span>
     <span style="font-family:Times New Roman">
      Bouton’s Theorem
     </span>
     <span style="font-family:宋体">
      几乎是完全相同的，只需要适当的改几个名词就行了。
     </span>
    </p>
    <p>
    </p>
    <p>
     刚才，我为了使问题看上去更容易一些，认为
     <span style="font-family:Times New Roman">
      n
     </span>
     <span style="font-family:宋体">
      枚棋子是在一个有向图上移动。但如果不是在一个有向图上，而是每个棋子在一个有向图上，每次可以任选一个棋子（也就是任选一个有向图）进行移动，这样也不会给结论带来任何变化。
     </span>
    </p>
    <p>
    </p>
    <p>
     所 以我们可以定义有向图游戏的和
     <span style="font-family:Times New Roman">
      (Sum of Graph Games)
     </span>
     <span style="font-family:宋体">
      ：设
     </span>
     <span style="font-family:Times New Roman">
      G1
     </span>
     <span style="font-family:宋体">
      、
     </span>
     <span style="font-family:Times New Roman">
      G2
     </span>
     <span style="font-family:宋体">
      、
     </span>
     <span style="font-family:Times New Roman">
      ……
     </span>
     <span style="font-family:宋体">
      、
     </span>
     <span style="font-family:Times New Roman">
      Gn
     </span>
     <span style="font-family:宋体">
      是
     </span>
     <span style="font-family:Times New Roman">
      n
     </span>
     <span style="font-family:宋体">
      个有向图游戏，定义游戏
     </span>
     <span style="font-family:Times New Roman">
      G
     </span>
     <span style="font-family:宋体">
      是
     </span>
     <span style="font-family:Times New Roman">
      G1
     </span>
     <span style="font-family:宋体">
      、
     </span>
     <span style="font-family:Times New Roman">
      G2
     </span>
     <span style="font-family:宋体">
      、
     </span>
     <span style="font-family:Times New Roman">
      ……
     </span>
     <span style="font-family:宋体">
      、
     </span>
     <span style="font-family:Times New Roman">
      Gn
     </span>
     <span style="font-family:宋体">
      的和
     </span>
     <span style="font-family:Times New Roman">
      (Sum)
     </span>
     <span style="font-family:宋体">
      ，游戏
     </span>
     <span style="font-family:Times New Roman">
      G
     </span>
     <span style="font-family:宋体">
      的移动规则是：任选一个子游戏
     </span>
     <span style="font-family:Times New Roman">
      Gi
     </span>
     <span style="font-family:宋体">
      并移动上面的棋子。
     </span>
     <span style="font-family:Times New Roman">
      Sprague-Grundy Theorem
     </span>
     <span style="font-family:宋体">
      就是：
     </span>
     <span style="font-family:Times New Roman">
      g(G)=g(G1)^g(G2)^…^g(Gn)
     </span>
     <span style="font-family:宋体">
      。也就是说，游戏的和的
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      函数值是它的所有子游戏的
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      函数值的异或。
     </span>
    </p>
    <p>
    </p>
    <p>
     再考虑在本文一开头的一句话：任何一个
     <span style="font-family:Times New Roman">
      ICG
     </span>
     <span style="font-family:宋体">
      都可以抽象成一个有向图游戏。所以
     </span>
     <span style="font-family:Times New Roman">
      “SG
     </span>
     <span style="font-family:宋体">
      函数
     </span>
     <span style="font-family:Times New Roman">
      ”
     </span>
     <span style="font-family:宋体">
      和
     </span>
     <span style="font-family:Times New Roman">
      “
     </span>
     <span style="font-family:宋体">
      游戏的和
     </span>
     <span style="font-family:Times New Roman">
      ”
     </span>
     <span style="font-family:宋体">
      的概念就不是局限于有向图游戏。我们给每个
     </span>
     <span style="font-family:Times New Roman">
      ICG
     </span>
     <span style="font-family:宋体">
      的每个
     </span>
     <span style="font-family:Times New Roman">
      position
     </span>
     <span style="font-family:宋体">
      定义
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      值，也可以定义
     </span>
     <span style="font-family:Times New Roman">
      n
     </span>
     <span style="font-family:宋体">
      个
     </span>
     <span style="font-family:Times New Roman">
      ICG
     </span>
     <span style="font-family:宋体">
      的和。所以说当我们面对由
     </span>
     <span style="font-family:Times New Roman">
      n
     </span>
     <span style="font-family:宋体">
      个游戏组合成的一个游戏时，只需对于每个游戏找出求它的每个局面的
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      值的方法，就可以把这些
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      值全部看成
     </span>
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      的石子堆，然后依照找
     </span>
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      的必胜策略的方法来找这个游戏的必胜策略了！
     </span>
    </p>
    <p>
    </p>
    <p>
     回到本文开头的 问题。有
     <span style="font-family:Times New Roman">
      n
     </span>
     <span style="font-family:宋体">
      堆石子，每次可以从第
     </span>
     <span style="font-family:Times New Roman">
      1
     </span>
     <span style="font-family:宋体">
      堆石子里取
     </span>
     <span style="font-family:Times New Roman">
      1
     </span>
     <span style="font-family:宋体">
      颗、
     </span>
     <span style="font-family:Times New Roman">
      2
     </span>
     <span style="font-family:宋体">
      颗或
     </span>
     <span style="font-family:Times New Roman">
      3
     </span>
     <span style="font-family:宋体">
      颗，可以从第
     </span>
     <span style="font-family:Times New Roman">
      2
     </span>
     <span style="font-family:宋体">
      堆石子里取奇数颗，可以从第
     </span>
     <span style="font-family:Times New Roman">
      3
     </span>
     <span style="font-family:宋体">
      堆及以后石子里取任意颗
     </span>
     <span style="font-family:Times New Roman">
      ……
     </span>
     <span style="font-family:宋体">
      我们可以把它看作
     </span>
     <span style="font-family:Times New Roman">
      3
     </span>
     <span style="font-family:宋体">
      个 子游戏，第
     </span>
     <span style="font-family:Times New Roman">
      1
     </span>
     <span style="font-family:宋体">
      个子游戏只有一堆石子，每次可以取
     </span>
     <span style="font-family:Times New Roman">
      1
     </span>
     <span style="font-family:宋体">
      、
     </span>
     <span style="font-family:Times New Roman">
      2
     </span>
     <span style="font-family:宋体">
      、
     </span>
     <span style="font-family:Times New Roman">
      3
     </span>
     <span style="font-family:宋体">
      颗，很容易看出
     </span>
     <span style="font-family:Times New Roman">
      x
     </span>
     <span style="font-family:宋体">
      颗石子的局面的
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      值是
     </span>
     <span style="font-family:Times New Roman">
      x%4
     </span>
     <span style="font-family:宋体">
      。第
     </span>
     <span style="font-family:Times New Roman">
      2
     </span>
     <span style="font-family:宋体">
      个子游戏也是只有一堆石子，每次可以取奇数 颗，经过简单的画图可以知道这个游戏有
     </span>
     <span style="font-family:Times New Roman">
      x
     </span>
     <span style="font-family:宋体">
      颗石子时的
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      值是
     </span>
     <span style="font-family:Times New Roman">
      x%2
     </span>
     <span style="font-family:宋体">
      。第
     </span>
     <span style="font-family:Times New Roman">
      3
     </span>
     <span style="font-family:宋体">
      个游戏有
     </span>
     <span style="font-family:Times New Roman">
      n-2
     </span>
     <span style="font-family:宋体">
      堆石子，就是一个
     </span>
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      游戏。对于原游戏的每个局面，把三个子游戏 的
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      值异或一下就得到了整个游戏的
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      值，然后就可以根据这个
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      值判断是否有必胜策略以及做出决策了。其实看作
     </span>
     <span style="font-family:Times New Roman">
      3
     </span>
     <span style="font-family:宋体">
      个子游戏还是保守了些，干脆看作
     </span>
     <span style="font-family:Times New Roman">
      n
     </span>
     <span style="font-family:宋体">
      个 子游戏，其中第
     </span>
     <span style="font-family:Times New Roman">
      1
     </span>
     <span style="font-family:宋体">
      、
     </span>
     <span style="font-family:Times New Roman">
      2
     </span>
     <span style="font-family:宋体">
      个子游戏如上所述，第
     </span>
     <span style="font-family:Times New Roman">
      3
     </span>
     <span style="font-family:宋体">
      个及以后的子游戏都是
     </span>
     <span style="font-family:Times New Roman">
      “1
     </span>
     <span style="font-family:宋体">
      堆石子，每次取几颗都可以
     </span>
     <span style="font-family:Times New Roman">
      ”
     </span>
     <span style="font-family:宋体">
      ，称为
     </span>
     <span style="font-family:Times New Roman">
      “
     </span>
     <span style="font-family:宋体">
      任取石子游戏
     </span>
     <span style="font-family:Times New Roman">
      ”
     </span>
     <span style="font-family:宋体">
      ，这个超简单的游戏有
     </span>
     <span style="font-family:Times New Roman">
      x
     </span>
     <span style="font-family:宋体">
      颗石子的
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      值显然就是
     </span>
     <span style="font-family:Times New Roman">
      x
     </span>
     <span style="font-family:宋体">
      。其实，
     </span>
     <span style="font-family:Times New Roman">
      n
     </span>
     <span style="font-family:宋体">
      堆石子的
     </span>
     <span style="font-family:Times New Roman">
      Nim
     </span>
     <span style="font-family:宋体">
      游戏本身不就是
     </span>
     <span style="font-family:Times New Roman">
      n
     </span>
     <span style="font-family:宋体">
      个
     </span>
     <span style="font-family:Times New Roman">
      “
     </span>
     <span style="font-family:宋体">
      任取石子游戏
     </span>
     <span style="font-family:Times New Roman">
      ”
     </span>
     <span style="font-family:宋体">
      的和吗？
     </span>
    </p>
    <p>
    </p>
    <p>
     所以，对于我们来说，
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      函数与
     </span>
     <span style="font-family:Times New Roman">
      “
     </span>
     <span style="font-family:宋体">
      游戏的和
     </span>
     <span style="font-family:Times New Roman">
      ”
     </span>
     <span style="font-family:宋体">
      的概念不是让我们去组合、制造稀奇古怪的游戏，而是把遇到的看上去有些复杂的游戏试图分成若干个子游戏，对于每个比原游戏简化很多的子游戏找出它的
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      函数，然后全部异或起来就得到了原游戏的
     </span>
     <span style="font-family:Times New Roman">
      SG
     </span>
     <span style="font-family:宋体">
      函数，就可以解决原游戏了。
     </span>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
</div>


