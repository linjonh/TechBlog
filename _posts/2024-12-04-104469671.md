---
layout: post
title: "生成中间带个人头像的微信小程序码,小程序码携带参数"
date: 2024-12-04 21:12:10 +0800
description: "1、场景：经常看到微信别人分享邀请的各种海报，海报上有小程序码，特别是小程序码，中间是分享人的头像，"
keywords: "生成中间带个人头像的微信小程序码,小程序码携带参数"
categories: ['']
tags: ['无标签']
artid: "104469671"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=104469671
    alt: "生成中间带个人头像的微信小程序码,小程序码携带参数"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     生成中间带个人头像的微信小程序码，小程序码携带参数
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3555536d99dcd0d0494c56cc000c89bc.png"/>
    </p>
    <h3>
     <a id="1_1">
     </a>
     1、场景：
    </h3>
    <p>
     经常看到微信别人分享邀请的各种海报，海报上有小程序码，特别是小程序码，中间是分享人的头像，并不是默认的平台logo。这样设计在UI视觉上更有特色，再则，用头像就能区分是来自不同人分享的，一目了然。
    </p>
    <h3>
     <a id="2_7">
     </a>
     2、微信接口文档：
    </h3>
    <p>
     HTTPS 调用
    </p>
    <p>
     方式：POST
    </p>
    <p>
     请求地址：
    </p>
    <p>
     https://api.weixin.qq.com/wxa/getwxacodeunlimit?access_token=ACCESS_TOKEN
    </p>
    <p>
     请求参数
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2f9588b864129d67467ba1cc22ec8f1c.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0dd6a5bafa5a7a4dbc85626455b832e0.png">
       <br/>
       具体文档地址为：
      </img>
     </img>
    </p>
    <p>
     https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/qr-code/wxacode.getUnlimited.html
    </p>
    <h3>
     <a id="3_24">
     </a>
     3、实现代码
    </h3>
    <p>
     参数实体
    </p>
    <pre><code class="prism language-java">
<span class="token comment">/**
 * @author
 * @date 2019/7/5 上午11:03
 * @description
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QrCodeVo</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 用户头像
     */</span>
    <span class="token keyword">private</span> String avatarImage<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 域名
     */</span>
    <span class="token keyword">private</span> String domainName<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 小程序appId
     */</span>
    <span class="token keyword">private</span> String appId<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 小程序appSecrect
     */</span>
    <span class="token keyword">private</span> String appSecrect<span class="token punctuation">;</span>
    <span class="token comment">/**
     *
     */</span>
    <span class="token keyword">private</span> String model<span class="token punctuation">;</span>
    <span class="token comment">/**
     *
     */</span>
    <span class="token keyword">private</span> String field<span class="token punctuation">;</span>

    <span class="token comment">//前端传的参数</span>
    <span class="token comment">/**
     * 用户id
     */</span>
    <span class="token keyword">private</span> String mobileUserId<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 小程序模块id
     */</span>
    <span class="token keyword">private</span> String objectId<span class="token punctuation">;</span>
    <span class="token comment">/**
     *  其他参数
     */</span>
    <span class="token keyword">private</span> String otherId<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 扫码进入的页面
     */</span>
    <span class="token keyword">private</span> String page<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     用户方形头像换成圆形头像
    </p>
    <pre><code class="prism language-java"><span class="token comment">/**
 * @author
 * @date 2019/5/20 上午11:00
 * @description
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomQrCodeUtil</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> Logger LOGGER <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>CustomQrCodeUtil<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> String UPLOAD_PATH <span class="token operator">=</span> <span class="token string">"/data/tomcat/webapps/img"</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 用户方形头像换成圆形头像
     * @param headImage 用户方形头像
     * @param model
     * @param field
     * @return
     * @throws MalformedURLException
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">circularHeadImage</span><span class="token punctuation">(</span>String headImage<span class="token punctuation">,</span>String model<span class="token punctuation">,</span>String field<span class="token punctuation">,</span>String domainName<span class="token punctuation">)</span> <span class="token keyword">throws</span> MalformedURLException <span class="token punctuation">{<!-- --></span>
        BufferedImage avatarImage<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            avatarImage <span class="token operator">=</span> ImageIO<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>headImage<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span>
            BufferedImage formatAvatarImage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedImage</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> width<span class="token punctuation">,</span> BufferedImage<span class="token punctuation">.</span>TYPE_4BYTE_ABGR<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Graphics2D graphics <span class="token operator">=</span> formatAvatarImage<span class="token punctuation">.</span><span class="token function">createGraphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            graphics<span class="token punctuation">.</span><span class="token function">setRenderingHint</span><span class="token punctuation">(</span>RenderingHints<span class="token punctuation">.</span>KEY_ANTIALIASING<span class="token punctuation">,</span> RenderingHints<span class="token punctuation">.</span>VALUE_ANTIALIAS_ON<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> border <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            Ellipse2D<span class="token punctuation">.</span>Double shape <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ellipse2D<span class="token punctuation">.</span>Double</span><span class="token punctuation">(</span>border<span class="token punctuation">,</span> border<span class="token punctuation">,</span> width <span class="token operator">-</span> border <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> width <span class="token operator">-</span> border <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            graphics<span class="token punctuation">.</span><span class="token function">setClip</span><span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">;</span>
            graphics<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>avatarImage<span class="token punctuation">,</span> border<span class="token punctuation">,</span> border<span class="token punctuation">,</span> width <span class="token operator">-</span> border <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> width <span class="token operator">-</span> border <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
            graphics<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            graphics <span class="token operator">=</span> formatAvatarImage<span class="token punctuation">.</span><span class="token function">createGraphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            graphics<span class="token punctuation">.</span><span class="token function">setRenderingHint</span><span class="token punctuation">(</span>RenderingHints<span class="token punctuation">.</span>KEY_ANTIALIASING<span class="token punctuation">,</span> RenderingHints<span class="token punctuation">.</span>VALUE_ANTIALIAS_ON<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> border1 <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
            Stroke s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicStroke</span><span class="token punctuation">(</span><span class="token number">4.5F</span><span class="token punctuation">,</span> BasicStroke<span class="token punctuation">.</span>CAP_ROUND<span class="token punctuation">,</span> BasicStroke<span class="token punctuation">.</span>JOIN_ROUND<span class="token punctuation">)</span><span class="token punctuation">;</span>
            graphics<span class="token punctuation">.</span><span class="token function">setStroke</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
            graphics<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            graphics<span class="token punctuation">.</span><span class="token function">drawOval</span><span class="token punctuation">(</span>border1<span class="token punctuation">,</span> border1<span class="token punctuation">,</span> width <span class="token operator">-</span> border1 <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> width <span class="token operator">-</span> border1 <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            graphics<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String pathFileStr <span class="token operator">=</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> model <span class="token operator">+</span> File<span class="token punctuation">.</span>separator  <span class="token operator">+</span> field <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> DateUtils<span class="token punctuation">.</span><span class="token function">getCurrentDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            IPUtils<span class="token punctuation">.</span><span class="token function">createFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>UPLOAD_PATH <span class="token operator">+</span> pathFileStr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String imageId <span class="token operator">=</span> UuidUtils<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String fileName <span class="token operator">=</span> imageId <span class="token operator">+</span> <span class="token string">".png"</span><span class="token punctuation">;</span>
            String destPath <span class="token operator">=</span> UPLOAD_PATH <span class="token operator">+</span> pathFileStr <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> fileName<span class="token punctuation">;</span>
            ImageIO<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>formatAvatarImage<span class="token punctuation">,</span> <span class="token string">"png"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>destPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            LOGGER<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"调用用户方形头像换成圆形头像接口==="</span><span class="token operator">+</span>domainName <span class="token operator">+</span> <span class="token string">"/img"</span><span class="token operator">+</span>pathFileStr <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> domainName <span class="token operator">+</span> <span class="token string">"/img"</span><span class="token operator">+</span>pathFileStr <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> fileName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            LOGGER<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"调用用户方形头像换成圆形头像接口异常"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     生成小程序码
    </p>
    <pre><code class="prism language-java"><span class="token comment">/**
 * @author
 * @date 2019/7/5 上午10:20
 * @description
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WxQrcode</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 生成小程序码
     * @param vo
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">qrCode</span><span class="token punctuation">(</span>QrCodeVo vo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        String qrCodeUrl <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">{<!-- --></span>
            String circularHeadImage <span class="token operator">=</span> CustomQrCodeUtil<span class="token punctuation">.</span><span class="token function">circularHeadImage</span><span class="token punctuation">(</span>vo<span class="token punctuation">.</span><span class="token function">getAvatarImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>vo<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>vo<span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>vo<span class="token punctuation">.</span><span class="token function">getDomainName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String accessToken <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String scene <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getMobileUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span> vo<span class="token punctuation">.</span><span class="token function">getObjectId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>vo<span class="token punctuation">.</span><span class="token function">getOtherId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                scene <span class="token operator">=</span> scene <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span> vo<span class="token punctuation">.</span><span class="token function">getOtherId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"scene : "</span> <span class="token operator">+</span> scene<span class="token punctuation">)</span><span class="token punctuation">;</span>
            params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"scene"</span><span class="token punctuation">,</span> scene<span class="token punctuation">)</span><span class="token punctuation">;</span>
            params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">,</span> vo<span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null <span class="token operator">?</span> vo<span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span><span class="token string">"pages/index/index"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"width"</span><span class="token punctuation">,</span> <span class="token number">430</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            CloseableHttpClient httpClient <span class="token operator">=</span> HttpClientBuilder<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            HttpPost httpPost <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpPost</span><span class="token punctuation">(</span>WeixinUrl<span class="token punctuation">.</span>WXACODE_UNLIMIT <span class="token operator">+</span> accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
            httpPost<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span>HTTP<span class="token punctuation">.</span>CONTENT_TYPE<span class="token punctuation">,</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            StringEntity entity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringEntity</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            entity<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"image/png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            httpPost<span class="token punctuation">.</span><span class="token function">setEntity</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            InputStream inputStream <span class="token operator">=</span> httpClient<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>httpPost<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String pathFileStr <span class="token operator">=</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> vo<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> File<span class="token punctuation">.</span>separator  <span class="token operator">+</span> vo<span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> DateUtils<span class="token punctuation">.</span><span class="token function">getCurrentDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            IPUtils<span class="token punctuation">.</span><span class="token function">createFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>CustomQrCodeUtil<span class="token punctuation">.</span>UPLOAD_PATH <span class="token operator">+</span> pathFileStr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String imageId <span class="token operator">=</span> UuidUtils<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String fileName <span class="token operator">=</span> imageId <span class="token operator">+</span> <span class="token string">".png"</span><span class="token punctuation">;</span>
            String destPath <span class="token operator">=</span> CustomQrCodeUtil<span class="token punctuation">.</span>UPLOAD_PATH <span class="token operator">+</span> pathFileStr <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> fileName<span class="token punctuation">;</span>
            String imageUrl <span class="token operator">=</span> pathFileStr <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> fileName<span class="token punctuation">;</span>
            FileOutputStream out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>destPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">8192</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> bytesRead <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>bytesRead <span class="token operator">=</span> inputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8192</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytesRead<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            BufferedImage b1 <span class="token operator">=</span> ImageIO<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>vo<span class="token punctuation">.</span><span class="token function">getDomainName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"/img"</span><span class="token operator">+</span>imageUrl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//将用户头像覆盖小程序码中间的logo</span>
            BufferedImage b2 <span class="token operator">=</span> ImageIO<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>circularHeadImage<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>b1 <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//Graphics2D绘图</span>
                Graphics2D g <span class="token operator">=</span> b1<span class="token punctuation">.</span><span class="token function">createGraphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                g<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>b2<span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">195</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
                g<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                String pathFileStr2 <span class="token operator">=</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> vo<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> File<span class="token punctuation">.</span>separator  <span class="token operator">+</span> vo<span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> DateUtils<span class="token punctuation">.</span><span class="token function">getCurrentDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                IPUtils<span class="token punctuation">.</span><span class="token function">createFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>CustomQrCodeUtil<span class="token punctuation">.</span>UPLOAD_PATH <span class="token operator">+</span> pathFileStr2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                String uuId <span class="token operator">=</span> UuidUtils<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                String fileName2 <span class="token operator">=</span> uuId <span class="token operator">+</span> <span class="token string">".png"</span><span class="token punctuation">;</span>
                String destPath2 <span class="token operator">=</span> CustomQrCodeUtil<span class="token punctuation">.</span>UPLOAD_PATH <span class="token operator">+</span> pathFileStr2 <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> fileName2<span class="token punctuation">;</span>
                ImageIO<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>b1<span class="token punctuation">,</span> <span class="token string">"png"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>destPath2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                qrCodeUrl <span class="token operator">=</span> pathFileStr2 <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> fileName2<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MalformedURLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> qrCodeUrl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="4_216">
     </a>
     4、注意
    </h3>
    <p>
     POST 参数需要转成 JSON 字符串，不支持 form 表单提交。
    </p>
    <p>
     接口只能生成已发布的小程序的二维码**（不是已发布的小程序调用接口会生成损坏的图片，所以小程序要先审核通过一版才可以调试。传入的page必须是已经发布的小程序存在的页面，根路径前不要添加 /，否则也会生成损坏的图片）**
    </p>
    <p>
     调用分钟频率受限（5000次/分钟），如需大量小程序码，建议预生成。
    </p>
    <h3>
     <a id="5_224">
     </a>
     5、效果
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1bd06c8b10485e09494aad829aeb0b2d.png">
      <br/>
      扫描关注公众号互相学习
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/63a5e3a2ff3f1f3e6250420ac58171a7.png"/>
     </img>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f4c697541757374696e2f:61727469636c652f64657461696c732f313034343639363731" class_="artid" style="display:none">
 </p>
</div>


