---
layout: post
title: "Python-使用轻量级-Flask-框架搭建-Web-服务器详细教程基础篇"
date: 2022-01-03 17:19:57 +0800
description: "代理实际上指的就是代理服务器，英文叫作 proxy server，它的功能是代理网络用户去取得网络信"
keywords: "flask搭建web服务器"
categories: ['Python']
tags: ['网络', 'Python', 'Flask']
artid: "122289200"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=122289200
    alt: "Python-使用轻量级-Flask-框架搭建-Web-服务器详细教程基础篇"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Python 使用轻量级 Flask 框架搭建 Web 服务器详细教程（基础篇）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="01Flask_0">
     </a>
     01、Flask框架服务器
    </h3>
    <p>
     <strong>
      render_template模板页面传参
     </strong>
    </p>
    <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/index'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'username'</span><span class="token punctuation">:</span><span class="token string">'duke'</span><span class="token punctuation">}</span>
    <span class="token comment">#将需要展示的数据传递给模板进行显示</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span>title<span class="token operator">=</span><span class="token string">'我的'</span><span class="token punctuation">,</span>user<span class="token operator">=</span>user<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>{<!-- -->{ title }} - 博客<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span> Hello ,{<!-- -->{ user.username }} !<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     <strong>
      session机制的介绍：
     </strong>
    </p>
    <pre><code>RuntimeError: The session is unavailable because no secret key was set.  Set the secret_key on the application to something unique and secret. 

运行错误：会话不可用，因为没有设置密钥。将应用程序上的secret_key设置为一些独特且秘密的内容。
</code></pre>
    <pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> session

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">"wristwaking"</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    session<span class="token punctuation">[</span><span class="token string">"login_user"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"唤醒手腕"</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"login_user"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"index"</span>
</code></pre>
    <p>
     <strong>
      request的基本用途介绍
     </strong>
    </p>
    <pre><code>TypeError: The view function for 'index' did not return a valid response. The function either returned None or ended without a return statement.
错误类型：“索引”的视图函数没有返回有效的响应。函数返回None或没有rerun语句。
</code></pre>
    <p>
     这是因为没有在URL参数中找到
     <code>
      infor
     </code>
     ，所以
     <code>
      request.args.get('infor')
     </code>
     返回Python内置的None，而Flask不允许返回None。
    </p>
    <p>
     解决方法很简单，我们先判断下它是不是None：
    </p>
    <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'infor'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> data<span class="token operator">==</span><span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token comment"># do something</span>
        <span class="token keyword">return</span> <span class="token string">''</span>
    <span class="token keyword">return</span> data
	<span class="token comment"># 第二种方案，就是设置初始值</span>
	<span class="token comment"># data = request.args.get("infor") # 设置默认值</span>
</code></pre>
    <p>
     还记得上面有一次请求是这样的吗？
     <code>
      http://127.0.0.1:5000?infor=1&amp;infor=2
     </code>
     ，仔细看下，infor有两个值。
    </p>
    <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>getlist<span class="token punctuation">(</span><span class="token string">'infor'</span><span class="token punctuation">)</span>  <span class="token comment"># 返回一个list</span>
    <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
</code></pre>
    <p>
     在request请求中，解析POST数据
    </p>
    <pre><code class="prism language-python"><span class="token comment"># username = wristwaking  password = 5201314</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/form"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">form</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">)</span>
    <span class="token comment"># Immutable Multi Dict 不可改变的多个字典</span>
    <span class="token comment"># ImmutableMultiDict([('username', 'wristwaking'), ('password', '5201314')])</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>stream<span class="token punctuation">)</span>
    <span class="token comment"># &lt;werkzeug.wsgi.LimitedStream object at 0x000002A9AF2CE4F0&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">)</span>
    <span class="token comment"># ImmutableMultiDict([])</span>
    <span class="token keyword">return</span> <span class="token string">"success"</span>
</code></pre>
    <p>
     我们要想办法把我们要的username、password提取出来，怎么做呢？自己写？不用，Flask已经内置了解析器
     <code>
      request.form
     </code>
    </p>
    <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/form"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">form</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># b'username=wristwaking&amp;password=5201314'</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># b'' 说明流只读取到一遍了</span>
    <span class="token keyword">return</span> <span class="token string">"success"</span>
</code></pre>
    <p>
     解释原因：
     <code>
      request.stream.read()
     </code>
     读取到的是字节流，我们进行解码，规则是
     <code>
      utf-8
     </code>
     ，结果如下所示：
    </p>
    <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/form"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">form</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> request<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token comment"># username=wristwaking&amp;password=5201314</span>
    <span class="token keyword">return</span> <span class="token string">"success"</span>
</code></pre>
    <pre><code class="prism language-python">
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>
    <span class="token comment"># print(request.stream.read()) # 不要用，否则下面的form取不到数据</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>getlist<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'nickname'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'唤醒手腕'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'welcome'</span>
</code></pre>
    <p>
     响应JSON时，除了要把响应体改成JSON格式，响应头的
     <code>
      Content-Type
     </code>
     也要设置为
     <code>
      application/json
     </code>
    </p>
    <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/add'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'sum'</span><span class="token punctuation">:</span> request<span class="token punctuation">.</span>json<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>json<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> Response<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span>  mimetype<span class="token operator">=</span><span class="token string">'application/json'</span><span class="token punctuation">)</span>

<span class="token comment"># 使用 jsonify 工具函数即可</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/add'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'sum'</span><span class="token punctuation">:</span> request<span class="token punctuation">.</span>json<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>json<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      Flask中
      <code>
       app
      </code>
      和
      <code>
       current_app
      </code>
      的理解
     </strong>
    </p>
    <p>
     在Flask内部维护者两个线程隔离的栈，
     <code>
      current_app
     </code>
     指向了
     <code>
      AppContext
     </code>
     (应用上下文)中的栈顶。
    </p>
    <p>
     线程有个叫做
     <code>
      ThreadLocal
     </code>
     的类，也就是通常实现线程隔离的类。而
     <code>
      werkzeug
     </code>
     自己实现了它的线程隔离类：werkzeug.local.Local，LocalStack就是用Local实现的。
    </p>
    <p>
     LocalStack是flask定义的线程隔离的栈存储对象，分别用来保存应用和请求上下文。它是线程隔离的意思就是说，对于不同的线程，它们访问这两个对象看到的结果是不一样的、完全隔离的。这是根据
     <code>
      pid
     </code>
     的不同实现的，类似于门牌号。
    </p>
    <p>
     而每个传给flask对象的请求，都是在不同的线程中处理，而且同一时刻每个线程只处理一个请求。所以对于每个请求来说，它们完全不用担心自己上下文中的数据被别的请求所修改。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/166a3a58f814734638f96640a60b258b.png">
      <br/>
      <code>
       request
      </code>
      指向了
      <code>
       RequestContext
      </code>
      (请求上下文)栈顶，当请求进入的时候，Request对象被压入栈，从而request有了指向处理请求，接下来会判断AppContext栈顶是否为空，若为空则向栈中压入一个AppContext对象，即
      <code>
       app
      </code>
     </img>
    </p>
    <p>
     从而
     <code>
      current_app
     </code>
     就有了指向，所以我们在项目中使用是没有报错的，而我们上面的代码不是在请求中实现的，所以AppContext栈顶为空，current_app并没有指向一个
     <code>
      AppContext
     </code>
     对象。
    </p>
    <h3>
     <a id="02Flask_147">
     </a>
     02、Flask文件传输
    </h3>
    <pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request
 
<span class="token keyword">from</span> werkzeug<span class="token punctuation">.</span>utils <span class="token keyword">import</span> secure_filename
<span class="token keyword">import</span> os
 
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
 
<span class="token comment"># 文件上传目录</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'static/uploads/'</span>
<span class="token comment"># 支持的文件格式</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'ALLOWED_EXTENSIONS'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'png'</span><span class="token punctuation">,</span> <span class="token string">'jpg'</span><span class="token punctuation">,</span> <span class="token string">'jpeg'</span><span class="token punctuation">,</span> <span class="token string">'gif'</span><span class="token punctuation">}</span>  <span class="token comment"># 集合类型</span>
 
 
<span class="token comment"># 判断文件名是否是我们支持的格式</span>
<span class="token keyword">def</span> <span class="token function">allowed_file</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'.'</span> <span class="token keyword">in</span> filename <span class="token keyword">and</span> \
           filename<span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">in</span> app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'ALLOWED_EXTENSIONS'</span><span class="token punctuation">]</span>
 
 
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'hello world'</span>
 
 
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    upload_file <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> upload_file <span class="token keyword">and</span> allowed_file<span class="token punctuation">(</span>upload_file<span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
        filename <span class="token operator">=</span> secure_filename<span class="token punctuation">(</span>upload_file<span class="token punctuation">.</span>filename<span class="token punctuation">)</span>
        <span class="token comment"># 将文件保存到 static/uploads 目录，文件名同上传时使用的文件名</span>
        upload_file<span class="token punctuation">.</span>save<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>app<span class="token punctuation">.</span>root_path<span class="token punctuation">,</span> app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string">'info is '</span><span class="token operator">+</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'. success'</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'failed'</span>
 
 
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <code>
      app.config
     </code>
     中的config是字典的子类，可以用来设置自有的配置信息，也可以设置自己的配置信息。函数
     <code>
      allowed_file(filename)
     </code>
     用来判断filename是否有后缀以及后缀是否在
     <code>
      app.config['ALLOWED_EXTENSIONS']
     </code>
     中。
    </p>
    <p>
     客户端上传的图片必须以
     <code>
      image
     </code>
     标识。upload_file是上传文件对应的对象。
    </p>
    <ol>
     <li>
      <p>
       <code>
        app.root_path
       </code>
       获取server.py所在目录在文件系统中的绝对路径。
      </p>
     </li>
     <li>
      <p>
       <code>
        upload_file.save(path)
       </code>
       用来将upload_file保存在服务器的文件系统中，参数最好是绝对路径，否则会报错（网上很多代码都是使用相对路径，但是笔者在使用相对路径时总是报错，说找不到路径）
      </p>
     </li>
     <li>
      <p>
       <code>
        os.path.join()
       </code>
       用来将使用合适的路径分隔符将路径组合起来。
      </p>
     </li>
    </ol>
    <p>
     我们用python客户端测试下：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> requests
 
file_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'image'</span><span class="token punctuation">:</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'Lenna.jpg'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
 
user_info <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'info'</span><span class="token punctuation">:</span> <span class="token string">'Lenna'</span><span class="token punctuation">}</span>
 
resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"http://127.0.0.1:5000/upload"</span><span class="token punctuation">,</span> data<span class="token operator">=</span>user_info<span class="token punctuation">,</span> files<span class="token operator">=</span>file_data<span class="token punctuation">)</span>
 
<span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</code></pre>
    <p>
     要控制上产文件的大小，可以设置请求实体的大小，例如：
    </p>
    <pre><code class="prism language-python">app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'MAX_CONTENT_LENGTH'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token comment"># 16MB</span>
</code></pre>
    <p>
     不过，在处理上传文件时候，需要使用
     <code>
      try:... except:...
     </code>
    </p>
    <p>
     如果要获取上传文件的内容可以：
    </p>
    <pre><code class="prism language-python">file_content <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>stream<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="03Flask_224">
     </a>
     03、Flask后端鉴权方案
    </h3>
    <p>
     Cookie是存储在客户端的记录访问者状态的数据。具体原理，请见
     <code>
      http://zh.wikipedia.org/wiki/Cookie
     </code>
     ，常用的用于记录用户登录状态的session大多是基于cookie实现的。
    </p>
    <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/add'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    resp <span class="token operator">=</span> Response<span class="token punctuation">(</span><span class="token string">'add cookies'</span><span class="token punctuation">)</span>
    resp<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token string">'name'</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">'唤醒手腕'</span><span class="token punctuation">,</span> expires<span class="token operator">=</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">6</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> resp

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/show'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/delete'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">del_cookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    resp <span class="token operator">=</span> Response<span class="token punctuation">(</span><span class="token string">'delete cookies'</span><span class="token punctuation">)</span>
    resp<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> expires<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> resp
</code></pre>
    <p>
     由上可以看到，可以使用
     <code>
      Response.set_cookie
     </code>
     添加和删除cookie，expires参数用来设置cookie有效时间，它的值可以是datetime对象或者unix时间戳，笔者使用的是unix时间戳。
    </p>
    <pre><code class="prism language-python">res<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token string">'name'</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">'letian'</span><span class="token punctuation">,</span> expires<span class="token operator">=</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">6</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation">)</span>
<span class="token comment"># 上面的expire参数的值表示cookie在从现在开始的6分钟内都是有效的。</span>
</code></pre>
    <h3>
     <a id="04IP_249">
     </a>
     04、代理IP的原理
    </h3>
    <p>
     当我们对某些网站进行爬取的时候，我们经常会换IP来避免爬虫程序被封锁。这些代理IP地址是如何获取的呢？其实很简单，目前网络上有很多IP代理商，例如神龙，天启，芝麻等等，这些代理商一般都会提供透明代理，匿名代理，高匿代理。本文就讲讲各种代理 IP 背后的原理
    </p>
    <p>
     <strong>
      代理IP的介绍
     </strong>
    </p>
    <p>
     代理实际上指的就是代理服务器，英文叫作 proxy server，它的功能是代理网络用户去取得网络信息。
    </p>
    <p>
     形象地说，它是网络信息的中转站。在我们正常请求一个网站时，是发送了请求给 Web 服务器，Web 服务器把响应传回给我们。
    </p>
    <p>
     如果设置了代理服务器，实际上就是在本机和服务器之间搭建了一个桥，此时本机不是直接向 Web 服务器发起请求，而是向代理服务器发出请求，请求会发送给代理服务器，然后由代理服务器再发送给 Web 服务器，接着由代理服务器再把 Web 服务器返回的响应转发给本机。
    </p>
    <p>
     这样我们同样可以正常访问网页，但这个过程中 Web 服务器识别出的真实 IP 就不再是我们本机的 IP 了，就成功实现了 IP 伪装，这就是代理的基本原理。
    </p>
    <p>
     <strong>
      代理类型：高匿 &gt; 混淆 &gt; 匿名 &gt; 透明
     </strong>
    </p>
    <p>
     代理IP一共可以分成4种类型，除了前面提到过的透明代理IP，匿名代理IP，高匿名代理IP，还有一种就是混淆代理IP。从基础的安全程度来说呢，他们的排列顺序是高匿 &gt; 混淆 &gt; 匿名 &gt; 透明。
    </p>
    <p>
     <strong>
      代理原理
     </strong>
    </p>
    <p>
     代理类型主要取决于代理服务器端的配置，不同配置会形成不同的代理类型。在配置中，这三个变量REMOTE_ADDR，HTTP_VIA，HTTP_X_FORWARDED_FOR 是决定性因素。
    </p>
    <p>
     （一）
     <code>
      REMOTE_ADDR
     </code>
    </p>
    <p>
     REMOTE_ADDR 表示客户端的 IP，但是它的值不是由客户端提供的，而是服务器根据客户端的 IP 指定的。
    </p>
    <p>
     如果使用浏览器直接访问某个网站，那么网站的 web 服务器（Nginx、Apache等）就会把 REMOTE_ADDR 设为客户端的 IP 地址。
    </p>
    <p>
     如果我们给浏览器设置代理，我们访问目标网站的请求会先经过代理服务器，然后由代理服务器将请求转化到目标网站。那么网站的 web 代理服务器就会把 REMOTE_ADDR 设为代理服务器的 IP。
    </p>
    <p>
     （二）
     <code>
      X-Forwarded-For（XFF）
     </code>
    </p>
    <p>
     X-Forwarded-For 是一个 HTTP 扩展头部，用来表示 HTTP 请求端真实 IP。当客户端使用了代理时，web 代理服务器就不知道客户端的真实 IP 地址。为了避免这个情况，代理服务器通常会增加一个 X-Forwarded-For 的头信息，把客户端的 IP 添加到头信息里面。
    </p>
    <p>
     X-Forwarded-For 请求头格式如下：
    </p>
    <pre><code>X-Forwarded-For: client, proxy1, proxy2
</code></pre>
    <p>
     client 表示客户端的 IP 地址；proxy1 是离服务端最远的设备 IP; proxy2 是次级代理设备的 IP；从格式中，可以看出从 client 到 server 是可以有多层代理的。
    </p>
    <p>
     如果一个 HTTP 请求到达服务器之前，经过了三个代理 Proxy1、Proxy2、Proxy3，IP 分别为 IP1、IP2、IP3，用户真实 IP 为 IP0，那么按照 XFF 标准，服务端最终会收到以下信息：
    </p>
    <pre><code>X-Forwarded-For: IP0, IP1, IP2
</code></pre>
    <p>
     Proxy3 直连服务器，它会给 XFF 追加 IP2，表示它是在帮 Proxy2 转发请求。列表中并没有 IP3，IP3 可以在服务端通过 Remote Address 字段获得。我们知道 HTTP 连接基于 TCP 连接，HTTP 协议中没有 IP 的概念，Remote Address 来自 TCP 连接，表示与服务端建立 TCP 连接的设备 IP，在这个例子里就是 IP3。
    </p>
    <p>
     （三）
     <code>
      HTTP_VIA
     </code>
    </p>
    <p>
     via 是 HTTP 协议里面的一个header，记录了一次 HTTP 请求所经过的代理和网关，经过1个代理服务器，就添加一个代理服务器的信息，经过2个就添加2个。
    </p>
    <p>
     <strong>
      正向代理 和 反向代理：
     </strong>
     原理介绍
    </p>
    <p>
     <code>
      反向代理
     </code>
    </p>
    <p>
     1、用户发送请求到服务器（访问的其实是反向代理服务器，但用户不知道）
    </p>
    <p>
     2、反向代理服务器发送请求到真正的服务器
    </p>
    <p>
     3、真正的服务器将数据返回给反向代理服务器
    </p>
    <p>
     4、反向代理服务器再将数据返回给用户
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4b8d1889f738ff6a04107823dc138379.png">
      <br/>
      反向代理有什么用为什么要这么做：
     </img>
    </p>
    <blockquote>
     <p>
      作用：用户请求过多，服务器会有一个处理的极限。所以使用反向代理服务器接受请求，再用均衡负载将请求分布给多个真实的服务器。既能提高效率还有一定的安全性。
     </p>
    </blockquote>
    <blockquote>
     <p>
      用途：如果不采用代理，用户的IP、端口号直接暴露在Internet（尽管地址转换NAT），外部主机依然可以根据IP、端口号来开采主机安全漏洞，所以在企业网，一般都是采用代理服务器访问互联网。
     </p>
    </blockquote>
    <p>
     正向代理与反向代理最简单的区别：
    </p>
    <p>
     正向代理隐藏的是用户，反向代理隐藏的是服务器
    </p>
    <h3>
     <a id="05_327">
     </a>
     05、正向代理服务器
    </h3>
    <p>
     <strong>
      vue proxy 原理介绍
     </strong>
    </p>
    <p>
     浏览器会因为同源策略跨域，但服务端不禁止，npm run dev 本来就是运行了服务器，所有利用服务器发送请求即可（将所有请求转发到自己的node服务器然后发送请求，即
     <code>
      代理
     </code>
     ）
    </p>
    <p>
     使用Node开发http正向代理服务器：
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"http"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 会建立一个http服务器，并监听 8080 端口：</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"start request:"</span><span class="token punctuation">,</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">var</span> option <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    option<span class="token punctuation">.</span>headers <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">;</span>
 
 	<span class="token comment">// 当接收到请求信息时，从请求头发获取信息并进行转发：</span>
    <span class="token keyword">var</span> proxyRequest <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">proxyResponse</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
 
 		<span class="token comment">// 其余就是对信息输出，以方便我们了解到代理是否生效、代理内容如何等：</span>
        proxyResponse<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"proxyResponse length"</span><span class="token punctuation">,</span>chunk<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxyResponse<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"end"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"proxyed request ended"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
 
        res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span>proxyResponse<span class="token punctuation">.</span>statusCode<span class="token punctuation">,</span>proxyResponse<span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"in request length:"</span><span class="token punctuation">,</span>chunk<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxyRequest<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span><span class="token string">"binary"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
 
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"end"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"original request ended"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxyRequest<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="06Flaskpy_374">
     </a>
     06、Flask.py底层
    </h3>
    <p>
     个人总结吧，以前学东西总是不喜欢看源码，主要是英语不行，后来才知道源码的重要性，学会看源码才能真正的去探究底层的实现，况且现在很多第三方库都把源码的注释写的很清楚。
    </p>
    <p>
     <strong>
      Flask.py文件相关底层的介绍
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0b14103c4f8e48c275fcdcf07ebca16a.png">
      <br/>
      源码中Flask类进行继承了Scaffold类（脚手架），关于Scaffold类的
      <code>
       __init__
      </code>
      展示：
     </img>
    </p>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>
        self<span class="token punctuation">,</span>
        import_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> 
        <span class="token comment">#: The name of the package or module that this object belongs</span>
        static_folder<span class="token punctuation">:</span> t<span class="token punctuation">.</span>Optional<span class="token punctuation">[</span>t<span class="token punctuation">.</span>Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>PathLike<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        static_url_path<span class="token punctuation">:</span> t<span class="token punctuation">.</span>Optional<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        template_folder<span class="token punctuation">:</span> t<span class="token punctuation">.</span>Optional<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        <span class="token comment">#: The path to the templates folder, relative to ···</span>
        root_path<span class="token punctuation">:</span> t<span class="token punctuation">.</span>Optional<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre>
    <p>
     :attr:
     <code>
      root_path
     </code>
     , to add to the template loader.
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c10b58fd40c00e9065131da0928e0ad3.png">
      <br/>
      Flask对象实现了一个WSGI应用程序，并作为中心对象。它被传递给应用程序的模块或软件包的名称。一旦创建了它，它将作为视图函数、URL规则、模板配置等的中心注册表。
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/242141d46d95d25a222a09e686a9cb4d.png">
       <br/>
       <strong>
        装饰器@route，装饰视图函数
       </strong>
       ：
      </img>
     </img>
    </p>
    <p>
     底层原理：
     <code>
      @app.route("/") def index():
     </code>
     -&gt;
     <code>
      app.add_url_rule("/", view_func=index)
     </code>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ff5f02a3b453df9b7ce5adf8040d00e6.png">
      <br/>
      <strong>
       项目启动app.run()，源码介绍
      </strong>
     </img>
    </p>
    <pre><code class="prism language-python"> <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>
        self<span class="token punctuation">,</span>
        host<span class="token punctuation">:</span> t<span class="token punctuation">.</span>Optional<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        <span class="token comment"># host: the hostname to listen on. Set this to ``'0.0.0.0'`` to have the server available externally as well.</span>
        <span class="token comment"># 要收听的主机名。将其设置为``‘0.0.0.0’``，以使服务器在外部也可用。</span>
        port<span class="token punctuation">:</span> t<span class="token punctuation">.</span>Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        <span class="token comment"># the port of the webserver. Defaults to ``5000`` or the port defined in the ``SERVER_NAME`` config variable if present.</span>
        <span class="token comment"># webserver的端口。默认为``5000``或在``SERVER_NAME``配置变量中定义的端口。</span>
        debug<span class="token punctuation">:</span> t<span class="token punctuation">.</span>Optional<span class="token punctuation">[</span><span class="token builtin">bool</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        <span class="token comment"># ebug: if given, enable or disable debug mode. See :attr:`debug`.</span>
        load_dotenv<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
        <span class="token comment"># Load the nearest :file:`.env` and :file:`.flaskenv` files to set environment variables. Will also change the working directory to the directory containing the first file found.</span>
        <span class="token comment"># 加载最接近的：file：`.env`和：file：`.flaskenv`文件，以设置环境变量。还将将该工作目录更改为包含找到的第一个文件的目录。</span>
        <span class="token operator">**</span>options<span class="token punctuation">:</span> t<span class="token punctuation">.</span>Any<span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
</code></pre>
    <h3>
     <a id="07apptesting_420">
     </a>
     07、app.testing底层
    </h3>
    <p>
     Note that if you are testing for assertions or exceptions in your application code, you must set
     <code>
      app.testing = True
     </code>
     in order for the exceptions to propagate to the test client.
    </p>
    <p>
     请注意，如果您正在测试应用程序代码中的断言或异常，则必须设置
     <code>
      app.testing = True
     </code>
     ，以便将异常传播到测试客户端。
    </p>
    <p>
     Otherwise, the exception will be handled by the application (not visible to the test client) and the only indication of an AssertionError or other exception will be a 500 status code response to the test client. See the :attr:
     <code>
      testing
     </code>
     attribute. For example::
    </p>
    <pre><code class="prism language-python">app<span class="token punctuation">.</span>testing <span class="token operator">=</span> <span class="token boolean">True</span>
client <span class="token operator">=</span> app<span class="token punctuation">.</span>test_client<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     The test client can be used in a
     <code>
      with
     </code>
     block to defer the closing down of the context until the end of the
     <code>
      with
     </code>
     block. This is useful if you want to access the context locals for testing::
    </p>
    <p>
     测试客户端可以在带有
     <code>
      with
     </code>
     中使用，以将上下文的关闭推迟到带有
     <code>
      with
     </code>
     结束为止。如果您想访问上下文本地语言进行测试，这一点非常有用：：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">with</span> app<span class="token punctuation">.</span>test_client<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> c<span class="token punctuation">:</span>
	rv <span class="token operator">=</span> c<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'/?vodka=42'</span><span class="token punctuation">)</span>
	<span class="token keyword">assert</span> request<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token string">'vodka'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'42'</span>
</code></pre>
    <p>
     Additionally, you may pass optional keyword arguments that will then be passed to the application’s :attr:
     <code>
      test_client_class
     </code>
     constructor. For example::
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> flask<span class="token punctuation">.</span>testing <span class="token keyword">import</span> FlaskClient

<span class="token keyword">class</span> <span class="token class-name">CustomClient</span><span class="token punctuation">(</span>FlaskClient<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_authentication <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"authentication"</span><span class="token punctuation">)</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>CustomClient<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

app<span class="token punctuation">.</span>test_client_class <span class="token operator">=</span> CustomClient
client <span class="token operator">=</span> app<span class="token punctuation">.</span>test_client<span class="token punctuation">(</span>authentication<span class="token operator">=</span><span class="token string">'Basic ....'</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="08env_452">
     </a>
     08、env环境变量
    </h3>
    <p>
     os.getenv(key, default=None) 函数介绍：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e30f66aba743e5658f46e78f8709857d.png">
      <br/>
      如果环境变量的字典集没有存在对应的KEY，会读取默认值：“唤醒手腕”
     </img>
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"CONF"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">"唤醒手腕"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="09Flask_460">
     </a>
     09、Flask线程底层
    </h3>
    <p>
     Flask 默认是单进程，单线程阻塞的任务模式，在项目上线的时候可以通过nginx+gunicorn 的方式部署flask任务
    </p>
    <p>
     但是在开发的过程中如果想通过延迟的方式测试高并发怎么实现呢，其实非常简单：
    </p>
    <p>
     app.run()中可以接受两个参数，分别是threaded和processes，用于开启线程支持和进程支持。
    </p>
    <p>
     <strong>
      Flask 单线程阻塞的任务模式 测试
     </strong>
     ：同时打开三个浏览器访问
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/index"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'start : '</span><span class="token punctuation">,</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># 模拟阻塞</span>
    <span class="token triple-quoted-string string">"""
    Flask 默认是单进程，单线程阻塞的任务模式
    """</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'end: : '</span><span class="token punctuation">,</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"hello world"</span>



<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>load_dotenv<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     运行结果：总共需要的时间是30多秒，说明是单线程阻塞的模式
    </p>
    <pre><code class="prism language-python">start <span class="token punctuation">:</span>  <span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">14</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">:</span><span class="token number">42.714942</span>
end<span class="token punctuation">:</span> <span class="token punctuation">:</span>  <span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">14</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">:</span><span class="token number">52.728294</span>
start <span class="token punctuation">:</span>  <span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">14</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">:</span><span class="token number">52.730206</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">-</span> <span class="token operator">-</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">/</span>Feb<span class="token operator">/</span><span class="token number">2022</span> <span class="token number">14</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">:</span><span class="token number">52</span><span class="token punctuation">]</span> <span class="token string">"GET /index HTTP/1.1"</span> <span class="token number">200</span> <span class="token operator">-</span>
end<span class="token punctuation">:</span> <span class="token punctuation">:</span>  <span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">14</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">02.730972</span>
start <span class="token punctuation">:</span>  <span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">14</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">02.733863</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">-</span> <span class="token operator">-</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">/</span>Feb<span class="token operator">/</span><span class="token number">2022</span> <span class="token number">14</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">]</span> <span class="token string">"GET /index HTTP/1.1"</span> <span class="token number">200</span> <span class="token operator">-</span>
end<span class="token punctuation">:</span> <span class="token punctuation">:</span>  <span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">14</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">12.745196</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">-</span> <span class="token operator">-</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">/</span>Feb<span class="token operator">/</span><span class="token number">2022</span> <span class="token number">14</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token string">"GET /index HTTP/1.1"</span> <span class="token number">200</span> <span class="token operator">-</span>
</code></pre>
    <p>
     源码写的太明白了，原来是ThreadingMixIn的实例以多线程的方式去处理每一个请求，这样对开发者来说，只有在启动app时将threaded参数设定为True,flask才会真正以多线程的方式去处理每一个请求。
    </p>
    <ol>
     <li>
      threaded : 多线程支持，默认为False，即不开启多线程;
     </li>
     <li>
      processes：进程数量，默认为1.
     </li>
    </ol>
    <p>
     <strong>
      开启方式：
     </strong>
    </p>
    <pre><code class="prism language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>load_dotenv<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> threaded<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="10Flask_512">
     </a>
     10、Flask数据库案例
    </h3>
    <p>
     这个案例是进行与数据库的连接，启动Flask服务器应用，构建视图函数映射到响应的地址目录，并且建立pymysql的连接对象，进行数据库的操作，这边就是添加单词的相应的操作。
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> time

<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> redirect

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token keyword">import</span> pymysql

app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'mysql'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>
    host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>  <span class="token comment"># 连接名称，默认127.0.0.1</span>
    user<span class="token operator">=</span><span class="token string">'pythondb'</span><span class="token punctuation">,</span>  <span class="token comment"># 用户名</span>
    passwd<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span>  <span class="token comment"># 密码</span>
    port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>  <span class="token comment"># 端口，默认为3306</span>
    db<span class="token operator">=</span><span class="token string">'pythondb'</span><span class="token punctuation">,</span>  <span class="token comment"># 数据库名称</span>
    charset<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">,</span>  <span class="token comment"># 字符编码</span>
<span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">Login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        html <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> html


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/data'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">ShowData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    english <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token string">'english'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
    chinese <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token string">'chinese'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
    sentence_eng <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token string">'sentence_eng'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
    sentence_chi <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token string">'sentence_chi'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
    cursor <span class="token operator">=</span> app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'mysql'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM word ORDER BY id DESC limit 1"</span>
    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span>
    sql <span class="token operator">=</span> <span class="token string">"insert into word values(%s,%s,%s,%s,%s)"</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span> english<span class="token punctuation">,</span> chinese<span class="token punctuation">,</span> sentence_eng<span class="token punctuation">,</span> sentence_chi<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'mysql'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"http://localhost:8080/"</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8080</span><span class="token punctuation">,</span> load_dotenv<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     对应的前端页面代码展示，其实就是简单构造一个表单进行提交的操作：
    </p>
    <pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://localhost:8080/data<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>english<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Word:<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chinese<span class="token punctuation">"</span></span>  <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Chinese:<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sentence_eng<span class="token punctuation">"</span></span>  <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sentence_eng:<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sentence_chi<span class="token punctuation">"</span></span>  <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sentence_chi:<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">input</span><span class="token punctuation">{<!-- --></span> <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 40px <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h3>
     <a id="11Flask_587">
     </a>
     11、Flask服务器部署
    </h3>
    <p>
     Gunicorn 是一个被广泛使用的高性能的 Python WSGI UNIX HTTP 服务组件 (WSGI: Web Server Gateway Interface)，移植自 Ruby 的独角兽（Unicorn ）项目，具有使用非常简单、轻量级的资源消耗、高性能等特点。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9577f47da3597d8e86837ebc7883de42.png"/>
    </p>
    <p>
     在项目中 Gunicorn 和 Flask 框架一同使用, 能够开启服务，处理请求，因其高性能的特点能够有效减少服务丢包率。
    </p>
    <p>
     <strong>
      使用 pip 安装 gunicorn
     </strong>
    </p>
    <pre><code class="prism language-javascript">pip install gunicorn
</code></pre>
    <p>
     <strong>
      启动 Flask 项目
     </strong>
    </p>
    <pre><code class="prism language-javascript"><span class="token punctuation">(</span>base<span class="token punctuation">)</span> <span class="token punctuation">[</span>root@ server<span class="token punctuation">]</span># gunicorn <span class="token operator">-</span>w <span class="token number">1</span> <span class="token operator">-</span>b <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token number">5000</span> <span class="token literal-property property">app</span><span class="token operator">:</span>app
<span class="token punctuation">[</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token number">15</span> <span class="token operator">+</span><span class="token number">0800</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">6266</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token constant">INFO</span><span class="token punctuation">]</span> Starting gunicorn <span class="token number">20.0</span><span class="token number">.4</span>
<span class="token punctuation">[</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token number">15</span> <span class="token operator">+</span><span class="token number">0800</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">6266</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token constant">INFO</span><span class="token punctuation">]</span> Listening at<span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token number">5000</span> <span class="token punctuation">(</span><span class="token number">6266</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token number">15</span> <span class="token operator">+</span><span class="token number">0800</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">6266</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token constant">INFO</span><span class="token punctuation">]</span> Using worker<span class="token operator">:</span> sync
<span class="token punctuation">[</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token number">15</span> <span class="token operator">+</span><span class="token number">0800</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">6269</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token constant">INFO</span><span class="token punctuation">]</span> Booting worker <span class="token keyword">with</span> <span class="token literal-property property">pid</span><span class="token operator">:</span> <span class="token number">6269</span>
</code></pre>
    <p>
     <strong>
      启动 Flask 项目 + SSL 证书
     </strong>
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token operator">:</span>
    context <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'./word.willwaking.com_bundle.crt'</span><span class="token punctuation">,</span> <span class="token string">'./word.willwaking.com.key'</span><span class="token punctuation">)</span>  
    app<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">,</span> ssl_context<span class="token operator">=</span>context<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-javascript">gunicorn <span class="token operator">--</span>certfile<span class="token operator">=</span><span class="token string">'/home/word_willwaking_com_2024/word.willwaking.com_bundle.crt'</span>  <span class="token operator">--</span>keyfile<span class="token operator">=</span><span class="token string">'/home/word_willwaking_com_2024/word.willwaking.com.key'</span> <span class="token operator">-</span>w <span class="token number">4</span> <span class="token operator">-</span>b <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token number">5000</span> <span class="token literal-property property">app</span><span class="token operator">:</span>app
</code></pre>
    <p>
     <strong>
      gunicorn 如何实现高并发的？
     </strong>
    </p>
    <p>
     对于 gunicorn 而言，当启动时就已经把 worker 进程预先 fork 出来了。当多个请求到来的时候，会轮流复用这些 worker 进程，从而能提高服务器的并发负载能力。对于 worker 数的配置，一般推荐2CPU数 + 1。这样一来，在任何时间，都有大概一般的 worker 是在做 I/O，剩下一般才是需要 CPU 的。
    </p>
    <p>
     如果在开多进程的同时，也开多线程（也就是选择 gthread 类型的 worker），那么配置总的并发数（worker 进程数线程数），仍然建议 2CPU 数 + 1。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34373435323830372f:61727469636c652f64657461696c732f313232323839323030" class_="artid" style="display:none">
 </p>
</div>


