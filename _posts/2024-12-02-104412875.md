---
layout: post
title: "微信小程序http127.0.0.1-不在以下-request-合法域名列表中解决方案"
date: 2024-12-02 21:51:13 +0800
description: "问题描述问题分析每个微信小程序需要事先设置通讯域名，小程序只可以跟指定的域名进行网络通信。包括普通 "
keywords: "微信小程序 127.0.0.1"
categories: ["未分类"]
tags: ["服务器域名", "微信小程序"]
artid: "104412875"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=104412875
  alt: "微信小程序http127.0.0.1-不在以下-request-合法域名列表中解决方案"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微信小程序——[http://127.0.0.1 不在以下 request 合法域名列表中]解决方案
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     问题描述
    </h2>
    <p style="text-align:center;">
     <img alt="" height="198" src="https://i-blog.csdnimg.cn/blog_migrate/4bd39b9717d229d58818e61ae6747bca.png" width="664"/>
    </p>
    <h2>
     问题分析
    </h2>
    <p style="text-indent:33px;">
     每个微信小程序需要事先设置通讯域名，小程序
     <strong>
      只可以跟指定的域名进行网络通信
     </strong>
     。包括普通 HTTPS 请求（
     <a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html" rel="nofollow">
      wx.request
     </a>
     ）、上传文件（
     <a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/upload/wx.uploadFile.html" rel="nofollow">
      wx.uploadFile
     </a>
     ）、下载文件（
     <a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/download/wx.downloadFile.html" rel="nofollow">
      wx.downloadFile
     </a>
     ) 和 WebSocket 通信（
     <a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/websocket/wx.connectSocket.html" rel="nofollow">
      wx.connectSocket
     </a>
     ）。
    </p>
    <p style="text-indent:33px;">
     允许与局域网 IP 通信，但要注意
     <strong>
      不允许与本机 IP 通信
     </strong>
     。
    </p>
    <p style="text-indent:33px;">
     <strong>
      小程序必须使用 HTTPS/WSS 发起网络请求
     </strong>
     。请求时系统会对服务器域名使用的 HTTPS 证书进行校验，如果校验失败，则请求不能成功发起。
    </p>
    <h2>
     官方文档
    </h2>
    <blockquote>
     <p style="text-indent:33px;">
      <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html" rel="nofollow">
       https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html
      </a>
     </p>
    </blockquote>
    <h2>
     解决方案
    </h2>
    <h3 style="text-indent:33px;">
     <strong>
      开发
     </strong>
    </h3>
    <p style="text-indent:33px;">
     <strong>
      跳过域名校验
     </strong>
    </p>
    <p style="text-indent:33px;">
     在微信开发者工具中，可以临时开启
     <strong>
      <span style="color:#f33b45;">
       <code>
        开发环境不校验请求域名、TLS版本及HTTPS证书
       </code>
      </span>
     </strong>
     选项，跳过服务器域名的校验。此时，在微信开发者工具中及手机开启调试模式时，不会进行服务器域名的校验。
    </p>
    <blockquote>
     <p style="text-indent:33px;">
      <strong>
       在服务器域名配置成功后，建议开发者关闭此选项进行开发，并在各平台下进行测试，以确认服务器域名配置正确。
      </strong>
     </p>
    </blockquote>
    <p style="text-align:center;">
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/75e27a0cf539c2e8c1c348c0cbc47133.png"/>
    </p>
    <h3 style="text-indent:33px;">
     发布
    </h3>
    <p style="text-indent:33px;">
     在
     <strong>
      「小程序后台-开发-开发设置-服务器域名」
     </strong>
     中配置服务器域名
    </p>
    <p style="text-align:center;">
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/119d294dc91395a32845b969fcb0d68e.png"/>
    </p>
    <blockquote>
     <p style="text-indent:33px;">
      <strong>
       配置流程
      </strong>
     </p>
     <p style="text-indent:33px;">
      服务器域名请在 「小程序后台-开发-开发设置-服务器域名」 中进行配置，配置时需要注意：
     </p>
     <ul>
      <li>
       域名只支持
       <code>
        https
       </code>
       (
       <a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html" rel="nofollow">
        wx.request
       </a>
       、
       <a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/upload/wx.uploadFile.html" rel="nofollow">
        wx.uploadFile
       </a>
       、
       <a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/download/wx.downloadFile.html" rel="nofollow">
        wx.downloadFile
       </a>
       ) 和
       <code>
        wss
       </code>
       (
       <a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/websocket/wx.connectSocket.html" rel="nofollow">
        wx.connectSocket
       </a>
       ) 协议；
      </li>
      <li>
       域名不能使用 IP 地址（小程序的
       <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/ability/mDNS.html" rel="nofollow">
        局域网
       </a>
       IP 除外）或 localhost；
      </li>
      <li>
       可以配置端口，如 https://myserver.com:8080，但是配置后只能向 https://myserver.com:8080 发起请求。如果向 https://myserver.com、https://myserver.com:9091 等 URL 请求则会失败。
      </li>
      <li>
       如果不配置端口。如 https://myserver.com，那么请求的 URL 中也不能包含端口，甚至是默认的 443 端口也不可以。如果向 https://myserver.com:443 请求则会失败。
      </li>
      <li>
       域名必须经过 ICP 备案；
      </li>
      <li>
       <strong>
        出于安全考虑，
        <code>
         api.weixin.qq.com
        </code>
        不能被配置为服务器域名，相关API也不能在小程序内调用。
       </strong>
       开发者应将 AppSecret 保存到后台服务器中，通过服务器使用
       <code>
        getAccessToken
       </code>
       接口获取
       <code>
        access_token
       </code>
       ，并调用相关 API；
      </li>
      <li>
       对于每个接口，分别可以配置最多 20 个域名。
      </li>
      <li>
       每个月只能修改五次服务器域名配置
      </li>
     </ul>
    </blockquote>
    <h2>
     参考文章
    </h2>
    <p style="text-indent:33px;">
     <a href="https://blog.csdn.net/qq_31965515/article/details/84326573">
      https://blog.csdn.net/qq_31965515/article/details/84326573
     </a>
    </p>
    <p style="text-indent:33px;">
     <a href="http://www.4u4v.net/pei-zhi-ben-di-fu-wu-qi-diao-shi-kai-fa-wei-xin-xiao-cheng-xu.html" rel="nofollow">
      http://www.4u4v.net/pei-zhi-ben-di-fu-wu-qi-diao-shi-kai-fa-wei-xin-xiao-cheng-xu.html
     </a>
    </p>
    <p>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34333237323738312f:61727469636c652f64657461696c732f313034343132383735" class_="artid" style="display:none">
 </p>
</div>
