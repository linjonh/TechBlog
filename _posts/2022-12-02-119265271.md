---
layout: post
title: "搭建邮箱服务器-垃圾邮件,如何让你服务器发出的邮件不被其它邮箱拒收"
date: 2022-12-02 10:07:18 +0800
description: "本文介绍了如何优化邮件服务器设置以避免被标记为垃圾邮件，包括邮件内容的注意事项、SPF记录的设置、M"
keywords: "自己搭建的邮件服务器,对方拒绝接收"
categories: ['未分类']
tags: ['搭建邮箱服务器', '垃圾邮件']
artid: "119265271"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=119265271
  alt: "搭建邮箱服务器-垃圾邮件,如何让你服务器发出的邮件不被其它邮箱拒收"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     搭建邮箱服务器 垃圾邮件,如何让你服务器发出的邮件不被其它邮箱拒收
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <div style="font-size:16px;">
     <p>
      最近看着Tao的服务器cPanel用的如此欢畅，邮件账号一分钟就可以建立起来……但是却被巨硬邮箱列为垃圾邮件，这让他很尴尬……
     </p>
     <p>
      进入邮件测试网站
     </p>
     <p>
      (大中国局域网第一次进去较慢，请耐心等待……)
     </p>
     <p>
      进去之后把邮件发送到指定邮箱，点击查看你的邮件得分，它会自动搜寻你发的邮件并作出评估，满分10分。
     </p>
     <p>
      下面我根据网站建议，列出邮件服务器的一些设置注意点。
     </p>
     <p>
      邮件内容
     </p>
     <p>
      邮件里面不要有任何不需要的危险内容，例如JavaScript、iFrame等等。
     </p>
     <p>
      邮件里面不要有死链和缩短的网址。
     </p>
     <p>
      邮件里面不应当只有图片。
     </p>
     <p>
      SPF设置
     </p>
     <p>
      邮件域名必须要有SPF反垃圾记录(TXT记录)。
     </p>
     <p>
      记录头：v=spf1
     </p>
     <p>
      记录头声明了该TXT记录是SPF记录并且版本为1。
     </p>
     <p>
      记录字段(IPv4地址)：ip4:xxx.xxx.xxx.xxx
     </p>
     <p>
      该记录字段表明许可邮件服务器的IPv4地址，支持IP段。
     </p>
     <p>
      记录字段(IPv6地址)：ip6:xxxx.xxxx.xxxx.xxxx
     </p>
     <p>
      该记录字段表明许可邮件服务器的IPv6地址，支持IP段。
     </p>
     <p>
      记录字段(all)：-all ; ~all ; +all
     </p>
     <p>
      第一个字段指禁止服务器邮件(其它)，第二个指软拒绝服务器邮件(其它)(不拒收但是会标记)，第三个是接受所有的邮件(不反垃圾)
     </p>
     <p>
      记录字段(A记录)：a ; a:domain.xxx
     </p>
     <p>
      直接使用代表指定当前A记录，可和域名连用表示其它域名的记录。
     </p>
     <p>
      记录字段(MX记录)：mx ; mx:domain.xxx
     </p>
     <p>
      直接使用代表指定当前MX记录，可和域名连用表示其它域名的记录。
     </p>
     <p>
      记录字段(include)：include:domain.xxx
     </p>
     <p>
      包括指定域名的SPF记录。
     </p>
     <p>
      推荐记录示例：v=spf1 ip4:xxx.xxx.xxx.xxx a mx ~all
     </p>
     <p>
      可根据上面的介绍自行修改。
     </p>
     <p>
      MX服务器指定
     </p>
     <p>
      设置MX服务器到你的邮件服务器(接收邮件)，即使不收邮件也最好设置下。
     </p>
     <p>
      反向DNS解析
     </p>
     <p>
      设置邮件服务器的反向DNS解析，可以有效防止其它邮件服务器的拦截，这个向你的主机商申请就行了。
     </p>
     <p>
      DKIM签名
     </p>
     <p>
      这个不详细介绍，就是使用签发证书来发送邮件，可选必需……。
     </p>
     <p>
      下面以CentOS+Postfix为例，演示开启DKIM密钥验证。
     </p>
     <p>
      下载OpenDKIM
     </p>
     <p>
      yum install opendkim -y
     </p>
     <p>
      配置OpenDKIM
     </p>
     <p>
      vi /etc/opendkim.conf
     </p>
     <p>
      填入以下内容(配置可自行修改)
     </p>
     <p>
      AutoRestart Yes
     </p>
     <p>
      AutoRestartRate 10/1h
     </p>
     <p>
      LogWhy Yes
     </p>
     <p>
      Syslog Yes
     </p>
     <p>
      SyslogSuccess Yes
     </p>
     <p>
      Mode sv
     </p>
     <p>
      Canonicalization relaxed/simple
     </p>
     <p>
      ExternalIgnoreList refile:/etc/opendkim/TrustedHosts
     </p>
     <p>
      InternalHosts refile:/etc/opendkim/TrustedHosts
     </p>
     <p>
      KeyTable refile:/etc/opendkim/KeyTable
     </p>
     <p>
      SigningTable refile:/etc/opendkim/SigningTable
     </p>
     <p>
      SignatureAlgorithm rsa-sha256
     </p>
     <p>
      Socket inet:8891@localhost
     </p>
     <p>
      PidFile /var/run/opendkim/opendkim.pid
     </p>
     <p>
      UMask 022
     </p>
     <p>
      UserID opendkim:opendkim
     </p>
     <p>
      TemporaryDirectory /var/tmp
     </p>
     <p>
      创建密钥
     </p>
     <p>
      (记得把yourdomain.ltd换成自己域名，下同)
     </p>
     <p>
      mkdir /etc/opendkim/keys/yourdomain.ltd
     </p>
     <p>
      opendkim-genkey -D /etc/opendkim/keys/yourdomain.ltd/ -d yourdomain.ltd -s default
     </p>
     <p>
      添加到密钥表
     </p>
     <p>
      vi /etc/opendkim/KeyTable
     </p>
     <p>
      填入以下内容
     </p>
     <p>
      default._domainkey.yourdomain.ltd yourdomain.ltd:default:/etc/opendkim/keys/yourdomain.ltd/default.private
     </p>
     <p>
      然后
     </p>
     <p>
      vi /etc/opendkim/SigningTable
     </p>
     <p>
      填入以下内容
     </p>
     <p>
      *@yourdomain.ltd default._domainkey.yourdomain.ltd
     </p>
     <p>
      添加授权签名主机到白名单
     </p>
     <p>
      vi /etc/opendkim/TrustedHosts
     </p>
     <p>
      填入127.0.0.1(本机)和你的其它主机
     </p>
     <p>
      更新权限(重要)
     </p>
     <p>
      chown -R opendkim: /etc/opendkim/keys/yourdomain.ltd
     </p>
     <p>
      域名DNS记录更新
     </p>
     <p>
      vi /etc/opendkim/keys/yourdomain.ltd/default.txt
     </p>
     <p>
      复制引号里面的内容(开头v=DKIM1;k=rsa;p=*一大长串*)，然后打开你的域名DNS解析管理面板，添加
     </p>
     <p>
      主机记录 default._domainkey
     </p>
     <p>
      记录值 *刚才你复制的内容*
     </p>
     <p>
      然后等几分钟在https://dkimcore.org/tools/检测密钥的合理性(Check a published DKIM Core Key)，Selector填default，Domain name填你的域名
     </p>
     <p>
      编辑Postfix配置
     </p>
     <p>
      vi /etc/postfix/main.cf
     </p>
     <p>
      填入以下内容
     </p>
     <p>
      smtpd_milters = inet:127.0.0.1:8891
     </p>
     <p>
      non_smtpd_milters = inet:127.0.0.1:8891
     </p>
     <p>
      milter_protocol = 2
     </p>
     <p>
      milter_default_action = accept
     </p>
     <p>
      启动服务
     </p>
     <p>
      service opendkim start
     </p>
     <p>
      service postfix reload
     </p>
     <p>
      添加自启动
     </p>
     <p>
      chkconfig opendkim on
     </p>
     <p>
      服务器IP是否有发送垃圾邮件的前科
     </p>
     <p>
      这个可以说是唯一一个自己不能解决的问题，除非换IP地址。
     </p>
     <p>
      若是这个IP以前发过垃圾邮件，被一些邮件服务器黑名单收进去了，那基本就没什么希望了。
     </p>
     <p>
      最后更新于 2018-06-05 11:48:37 并被添加「服务器 邮件」标签，已有 6841 人阅读过。
     </p>
     <p>
      本文距离最后一次更新已超过180天，部分内容可能会随着时间的推移变更或失效。
     </p>
     <p>
      相关文章
     </p>
    </div>
   </div>
  </div>
  <div id="recommendDown">
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f33353835303636392f:61727469636c652f64657461696c732f313139323635323731" class_="artid" style="display:none">
 </p>
</div>
