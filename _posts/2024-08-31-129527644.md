---
layout: post
title: "在-windows-平台上为-neovim-添加-python-支持"
date: 2024-08-31 08:31:11 +0800
description: "在 windows 平台上为 neovim 添加 python3 支持，并提供一些细节错误的解决方法"
keywords: "no python executable found that can `import neovim`"
categories: ['未分类']
tags: ['Windows', 'Vim', 'Python']
artid: "129527644"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=129527644
  alt: "在-windows-平台上为-neovim-添加-python-支持"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     在 windows 平台上为 neovim 添加 python 支持
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="1__windows__neovim__python3__1">
     </a>
     1. 在 windows 平台上为 neovim 添加 python3 支持
    </h2>
    <p>
     运行
     <code>
      checkhealth
     </code>
     检查支持：
    </p>
    <pre><code class="prism language-md">## Python 3 provider (optional)
  - WARNING: No Python executable found that can `import neovim`. Using the first available executable for diagnostics.
  - WARNING: Could not load Python 3:
    python3 not found in search path or not executable.
    python3.10 not found in search path or not executable.
    python3.9 not found in search path or not executable.
    python3.8 not found in search path or not executable.
    python3.7 not found in search path or not executable.
    python not found in search path or not executable.
    - ADVICE:
      - See :help |provider-python| for more information.
      - You may disable this provider (and warning) by adding `let g:loaded_python3_provider = 0` to your init.vim
  - INFO: Executable: Not found
</code></pre>
    <p>
     说明在 windows 中缺少 python 支持
    </p>
    <h3>
     <a id="1__python_23">
     </a>
     1. 安装
     <code>
      python
     </code>
    </h3>
    <p>
     利用 Microsoft Store 可以快捷下载 python 运行环境：
    </p>
    <p>
     在商店中搜索，或者在终端中输入
     <code>
      python
     </code>
     即可可安装
     <code>
      python
     </code>
     。
    </p>
    <p>
     安装之后通过这篇文章中的步骤找到
     <code>
      python
     </code>
     路径：
    </p>
    <p>
     <a href="https://blog.csdn.net/weixin_30129025/article/details/113687817#:~:text=1.%E6%89%93%E5%BC%80%E8%BF%99%E5%8F%B0%E7%94%B5%E8%84%91%EF%BC%8C%E8%BE%93%E5%85%A5%E7%94%B5%E8%84%91%E7%9A%84c%E7%9B%98%EF%BC%8C%E5%B0%86%E9%A1%B6%E9%83%A8%E7%9A%84%E6%A0%87%E7%AD%BE%E5%88%87%E6%8D%A2%E5%88%B0%E2%80%9C%E6%9F%A5%E7%9C%8B%E2%80%9D%EF%BC%8C%E7%84%B6%E5%90%8E%E9%80%89%E4%B8%AD%E2%80%9C%E9%9A%90%E8%97%8F%E9%A1%B9%E7%9B%AE%E2%80%9D%E3%80%82%202.%E8%BF%9B%E5%85%A5%E7%A8%8B%E5%BA%8F%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%EF%BC%8C%E6%89%93%E5%BC%80%E2%80%9C%E7%AA%97%E5%8F%A3%E2%80%9D%E6%96%87%E4%BB%B6%E5%A4%B9%203.%E5%9C%A8C%3A,%E7%A8%8B%E5%BA%8F%E6%96%87%E4%BB%B6%20Windows%20Apps%E7%9A%84%E8%B7%AF%E5%BE%84%E4%B8%8B%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E5%BA%94%E7%94%A8%E5%95%86%E5%BA%97%E7%9A%84%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95%E3%80%82">
      win10商店下载位置_手把手教您win10应用商店安装目录在哪的详尽处理门径_Super Jasper的博客-CSDN博客
     </a>
    </p>
    <p>
     然后将
     <code>
      python
     </code>
     安装位置添加到
     <code>
      Path
     </code>
     系统环境变量中。
    </p>
    <h3>
     <a id="2__neovim__python__34">
     </a>
     2. 为 neovim 添加 python 支持
    </h3>
    <p>
     在终端中执行如下命令：
    </p>
    <pre><code class="prism language-powershell">python3 <span class="token operator">-</span>m pip install <span class="token operator">--</span>user <span class="token operator">--</span>upgrade pynvim
</code></pre>
    <p>
     需要注意的是原本的
     <code>
      neovim
     </code>
     包被更名为
     <code>
      python
     </code>
     ，所以在网上的文章中安装
     <code>
      neovim
     </code>
     包的需要注意。
    </p>
    <p>
     <strong>
      说明：
     </strong>
     <a href="https://github.com/neovim/neovim/wiki/Following-HEAD#20181118">
      Following HEAD · neovimneovim Wiki · GitHub
     </a>
    </p>
    <p>
     执行
     <code>
      pip3 list
     </code>
     查看
     <code>
      pynvim
     </code>
     包是否安装成功：
    </p>
    <pre><code class="prism language-powershell">Package  Version
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
greenlet 2<span class="token punctuation">.</span>0<span class="token punctuation">.</span>2
msgpack  1<span class="token punctuation">.</span>0<span class="token punctuation">.</span>5
neovim   0<span class="token punctuation">.</span>3<span class="token punctuation">.</span>1
pip      23<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1
pynvim   0<span class="token punctuation">.</span>4<span class="token punctuation">.</span>3
</code></pre>
    <p>
     如此则安装成功。
    </p>
    <h3>
     <a id="3___PYTHON_PROVIDER_59">
     </a>
     3. 设置
     <code>
      PYTHON PROVIDER
     </code>
    </h3>
    <p>
     上述工作完成之后还需设置
     <code>
      g:python3_host_prog
     </code>
     变量才能完成 python 对 neovim 的支持，在 neovim 的配置文件中添加下列语句：
    </p>
    <pre><code class="prism language-vim">let g:python3_host_prog = '/path/to/python3'
</code></pre>
    <p>
     其中的
     <code>
      '/path/to/python3'
     </code>
     就是
     <code>
      python
     </code>
     的路径，注意路径中一定要带上
     <code>
      python3
     </code>
     。
    </p>
    <p>
     重启 nvim 再次
     <code>
      checkhealth
     </code>
     检查：
    </p>
    <pre><code class="prism language-md">## Python 3 provider (optional)
  - INFO: Using: g:python3_host_prog = "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.10_3.10.2800.0_x64__qbz5n2kfra8p0\python3.10"
  - INFO: Executable: C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.10_3.10.2800.0_x64__qbz5n2kfra8p0\python3.10.EXE
  - INFO: Python version: 3.10.10
  - INFO: pynvim version: 0.4.3
  - OK: Latest pynvim is installed.
</code></pre>
    <p>
     如果不想添加 python 支持，又想让
     <code>
      checkhealth
     </code>
     不检查，只要把把对应模块的 prog＝0就不会检测了。
    </p>
    <pre><code class="prism language-viml">let g:loaded_python3_provider = 0
</code></pre>
    <h3>
     <a id="error_86">
     </a>
     error
    </h3>
    <h4>
     <a id="1__ERROR_Failed_to_run_healthcheck_for_provider_plugin_Exception_88">
     </a>
     1.
     <code>
      ERROR: Failed to run healthcheck for "provider" plugin. Exception:
     </code>
    </h4>
    <pre><code class="prism language-md">provider: health#provider#check
========================================================================
  - ERROR: Failed to run healthcheck for "provider" plugin. Exception:
    function health#check[20]..health#provider#check[2]..&lt;SNR&gt;37_check_python[135]..&lt;SNR&gt;37_version_info[2]..&lt;SNR&gt;37_system, line 11
    Vim(let):E903: Process failed to start: operation not permitted: "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.10_3.10.2800.0_x64__qbz5n2kfra8p0\python.EXE"
</code></pre>
    <p>
     <strong>
      配置文件：
     </strong>
    </p>
    <pre><code class="prism language-lua">vim<span class="token punctuation">.</span><span class="token function">cmd</span><span class="token punctuation">(</span><span class="token string">[[
	let g:python3_host_prog = 'C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.10_3.10.2800.0_x64__qbz5n2kfra8p0\python'
]]</span><span class="token punctuation">,</span>
<span class="token keyword">false</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     将其中的
     <code>
      python
     </code>
     改为
     <code>
      python3.10
     </code>
    </p>
    <pre><code class="prism language-lua">vim<span class="token punctuation">.</span><span class="token function">cmd</span><span class="token punctuation">(</span><span class="token string">[[
	let g:python3_host_prog = 'C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.10_3.10.2800.0_x64__qbz5n2kfra8p0\python3.10'
]]</span><span class="token punctuation">,</span>
<span class="token keyword">false</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="2_WARNING_Could_not_contact_PyPI_to_get_latest_version_116">
     </a>
     2.
     <code>
      WARNING: Could not contact PyPI to get latest version
     </code>
    </h4>
    <pre><code class="prism language-md">## Python 3 provider (optional)
  - INFO: Using: g:python3_host_prog = "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.10_3.10.2800.0_x64__qbz5n2kfra8p0\python3.10"
  - INFO: Executable: C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.10_3.10.2800.0_x64__qbz5n2kfra8p0\python3.10.EXE
  - INFO: Python version: 3.10.10
  - INFO: pynvim version: 0.4.3
  - WARNING: Could not contact PyPI to get latest version.
  - ERROR: HTTP request failed: error: curl error with https://pypi.python.org/pypi/pynvim/json: 35
</code></pre>
    <p>
     在终端中执行：
    </p>
    <pre><code class="prism language-powershell">pip3 install <span class="token operator">--</span>user pynvim
</code></pre>
    <p>
     在用户中安装即可。
    </p>
    <hr/>
    <ol>
     <li>
      <a href="https://neovim.io/doc/user/provider.html" rel="nofollow">
       Provider - Neovim docs
      </a>
     </li>
     <li>
      Neovim on Windows can’t find python provider - Stack Overflow
     </li>
     <li>
      python - How to get a build of Neovim with python3 support for windows - Stack Overflow
     </li>
    </ol>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f47726f776c522f:61727469636c652f64657461696c732f313239353237363434" class_="artid" style="display:none">
 </p>
</div>
