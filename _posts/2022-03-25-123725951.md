---
layout: post
title: "Java如何查看java应用加载了哪些类"
date: 2022-03-25 02:00:41 +0800
description: "查看java应用加载了哪些类，查看这些类放在什么路径下，属于哪个j"
keywords: "查看jvm加载了哪些类"
categories: ['Java']
tags: ['Jmap', 'Jcmd', 'Java']
artid: "123725951"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=123725951
    alt: "Java如何查看java应用加载了哪些类"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Java：如何查看java应用加载了哪些类？
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     先直接给出结论：
    </p>
    <p>
     #1
    </p>
    <blockquote>
     <p>
      jcmd &lt;pid&gt; GC.class_histogram
     </p>
    </blockquote>
    <p>
     或 #2
    </p>
    <blockquote>
     <p>
      jmap -histo &lt;pid&gt;
     </p>
    </blockquote>
    <p>
     或 #3
    </p>
    <blockquote>
     <p>
      jmap -histo:live &lt;pid&gt;
     </p>
    </blockquote>
    <p>
     执行结果如下所示：
    </p>
    <blockquote>
     <p>
      num     #instances         #bytes  class name (module)
      <br/>
      -------------------------------------------------------
      <br/>
      1:        476831       43623368  [B (java.base@16.0.1)
      <br/>
      2:        176012       21862544  [C (java.base@16.0.1)
      <br/>
      3:        571102       18275264  java.util.HashMap$Node (java.base@16.0.1)
      <br/>
      4:        666997       16007928  java.lang.String (java.base@16.0.1)
      <br/>
      5:        151332       11937928  [I (java.base@16.0.1)
      <br/>
      6:        117792        9024648  [Ljava.util.HashMap$Node; (java.base@16.0.1)
      <br/>
      7:        140910        8463264  [Ljava.lang.Object; (java.base@16.0.1)
      <br/>
      8:         68296        6286424  [J (java.base@16.0.1)
      <br/>
      9:         92323        4431504  java.util.HashMap (java.base@16.0.1)
      <br/>
      10:         87662        3506480  java.util.LinkedHashMap$Entry (java.base@16.0.1)
      <br/>
      11:         25716        3158832  java.lang.Class (java.base@16.0.1)
      <br/>
      12:         58626        2739904  [Ljava.lang.String; (java.base@16.0.1)
      <br/>
      13:        104695        2512680  java.util.ArrayList (java.base@16.0.1)
      <br/>
      14:         25001        2400096  org.apache.maven.model.Dependency
      <br/>
      15:         66238        2119616  java.util.Collections$UnmodifiableMap (java.base@16.0.1)
      <br/>
      16:         35971        2014376  java.util.LinkedHashMap (java.base@16.0.1)
      <br/>
      17:         27768        1999296  org.eclipse.emf.ecore.util.EContentsEList$FeatureIteratorImpl
      <br/>
      18:         53012        1696384  org.apache.maven.model.InputLocation
      <br/>
      19:         16823        1586224  [[C (java.base@16.0.1)
      <br/>
      20:         34742        1389680  org.eclipse.aether.artifact.DefaultArtifact
      <br/>
      21:         42643        1364576  java.util.concurrent.ConcurrentHashMap$Node (java.base@16.0.1)
      <br/>
      22:         48042        1153008  org.eclipse.emf.ecore.util.EcoreUtil$ProperContentIterator
      <br/>
      23:         34663        1109216  org.eclipse.aether.graph.Dependency
      <br/>
      24:         33835        1082720  jdk.internal.jimage.ImageReader$Resource
      <br/>
      25:         43937        1054488  java.lang.StringBuilder (java.base@16.0.1)
      <br/>
      26:         25816        1032640  java.util.WeakHashMap$Entry (java.base@16.0.1)
      <br/>
      27:         29809         953888  jdk.internal.jimage.ImageReader$Resource
      <br/>
      28:         39024         936576  org.eclipse.emf.ecore.impl.BasicEObjectImpl$3
      <br/>
      29:         10551         928488  java.lang.reflect.Method (java.base@16.0.1)
      <br/>
      30:         33835         812040  jdk.internal.jimage.ImageLocation
      <br/>
      31:         29809         715416  jdk.internal.jimage.ImageLocation
      <br/>
      32:          1597         675072  [Ljava.util.concurrent.ConcurrentHashMap$Node; (java.base@16.0.1)
      <br/>
      33:         16695         667800  org.eclipse.emf.ecore.util.EcoreEMap$DelegateEObjectContainmentEList
      <br/>
      34:         27768         666432  org.eclipse.emf.ecore.util.EContentsEList
      <br/>
      35:         19935         637920  org.eclipse.emf.common.util.AbstractEList$EIterator
      <br/>
      36:         15468         618720  org.eclipse.emf.common.util.AbstractEList$NonResolvingEListIterator
      <br/>
      37:         15359         614360  org.eclipse.emf.ecore.util.EcoreEMap
      <br/>
      38:         17879         572128  java.util.Hashtable$Entry (java.base@16.0.1)
      <br/>
      39:         16014         512448  org.eclipse.emf.common.util.URI$LazyFragmentInitializer
      <br/>
      40:         15363         491616  org.eclipse.emf.common.util.BasicEMap$View
      <br/>
      41:         11795         471800  org.codehaus.plexus.util.xml.Xpp3Dom
      <br/>
      42:         11673         466920  org.eclipse.equinox.internal.p2.metadata.RequiredCapability
      <br/>
      43:            13         426192  [Ljava.util.concurrent.ForkJoinTask; (java.base@16.0.1)
      <br/>
      44:          1160         417440  [[Ljava.lang.Object; (java.base@16.0.1)
      <br/>
      45:         17894         405280  [Ljava.lang.Class; (java.base@16.0.1)
      <br/>
      46:         24815         397040  org.eclipse.jdt.internal.ui.text.spelling.engine.AbstractSpellDictionary$ByteArrayWrapper
      <br/>
      47:         16022         384528  org.eclipse.emf.common.util.URI$Fragment
      <br/>
      48:         16014         384336  org.eclipse.emf.ecore.impl.MinimalEObjectImpl$1ArrayDelegatingAdapterList
      <br/>
      49:         11738         375616  org.eclipse.osgi.container.ModuleCapability
      <br/>
      50:          4177         375112  [S (java.base@16.0.1)
     </p>
    </blockquote>
    <p>
     它会根据占用内存的大小进行排序。
    </p>
    <p>
     其中#2和#3的区别是，#3会先做一次FullGC，然后把存活下来的对象打印出来
    </p>
    <p>
     如果还需要知道是否加载了某些类，可以再加上grep，比如想知道是否用到了log4j
    </p>
    <blockquote>
     <p>
      jmap -histo &lt;pid&gt; | grep log4j
     </p>
    </blockquote>
    <p>
     其实jcmd和jmap还有很多参数，可以用来获取java应用的信息，这些参数基本可以做到望文生义：
    </p>
    <blockquote>
     <p>
      C:\Java\jdk1.8.0_261\bin&gt;jcmd help
      <br/>
      Error parsing arguments: No command specified
     </p>
     <p>
      Usage: jcmd &lt;pid | main class&gt; &lt;command ...|PerfCounter.print|-f file&gt;
      <br/>
      or: jcmd -l
      <br/>
      or: jcmd -h
     </p>
     <p>
      command must be a valid jcmd command for the selected jvm.
      <br/>
      Use the command "help" to see which commands are available.
      <br/>
      If the pid is 0, commands will be sent to all Java processes.
      <br/>
      The main class argument will be used to match (either partially
      <br/>
      or fully) the class used to start Java.
      <br/>
      If no options are given, lists Java processes (same as -p).
     </p>
     <p>
      PerfCounter.print display the counters exposed by this process
      <br/>
      -f  read and execute commands from the file
      <br/>
      -l  list JVM processes on the local machine
      <br/>
      -h  this help
     </p>
    </blockquote>
    <p>
     7140是一个java应用的进程编号
    </p>
    <blockquote>
     <p>
      C:\Java\jdk1.8.0_261\bin&gt;jcmd 7140 help
      <br/>
      7140:
      <br/>
      The following commands are available:
      <br/>
      Compiler.CodeHeap_Analytics
      <br/>
      Compiler.codecache
      <br/>
      Compiler.codelist
      <br/>
      Compiler.directives_add
      <br/>
      Compiler.directives_clear
      <br/>
      Compiler.directives_print
      <br/>
      Compiler.directives_remove
      <br/>
      Compiler.queue
      <br/>
      GC.class_histogram
      <br/>
      GC.finalizer_info
      <br/>
      GC.heap_dump
      <br/>
      GC.heap_info
      <br/>
      GC.run
      <br/>
      GC.run_finalization
      <br/>
      JFR.check
      <br/>
      JFR.configure
      <br/>
      JFR.dump
      <br/>
      JFR.start
      <br/>
      JFR.stop
      <br/>
      JVMTI.agent_load
      <br/>
      JVMTI.data_dump
      <br/>
      ManagementAgent.start
      <br/>
      ManagementAgent.start_local
      <br/>
      ManagementAgent.status
      <br/>
      ManagementAgent.stop
      <br/>
      Thread.print
      <br/>
      VM.class_hierarchy
      <br/>
      VM.classloader_stats
      <br/>
      VM.classloaders
      <br/>
      VM.command_line
      <br/>
      VM.dynlibs
      <br/>
      VM.events
      <br/>
      VM.flags
      <br/>
      VM.info
      <br/>
      VM.log
      <br/>
      VM.metaspace
      <br/>
      VM.native_memory
      <br/>
      VM.print_touched_methods
      <br/>
      VM.set_flag
      <br/>
      VM.stringtable
      <br/>
      VM.symboltable
      <br/>
      VM.system_properties
      <br/>
      VM.systemdictionary
      <br/>
      VM.uptime
      <br/>
      VM.version
      <br/>
      help
     </p>
     <p>
      For more information about a specific command use 'help &lt;command&gt;'.
     </p>
    </blockquote>
    <blockquote>
     <p>
      C:\Java\jdk1.8.0_261\bin&gt;jmap -h
      <br/>
      Usage:
      <br/>
      jmap [option] &lt;pid&gt;
      <br/>
      (to connect to running process)
      <br/>
      jmap [option] &lt;executable &lt;core&gt;
      <br/>
      (to connect to a core file)
      <br/>
      jmap [option] [server_id@]&lt;remote server IP or hostname&gt;
      <br/>
      (to connect to remote debug server)
     </p>
     <p>
      where &lt;option&gt; is one of:
      <br/>
      &lt;none&gt;               to print same info as Solaris pmap
      <br/>
      -heap                to print java heap summary
      <br/>
      -histo[:live]        to print histogram of java object heap; if the "live"
      <br/>
      suboption is specified, only count live objects
      <br/>
      -clstats             to print class loader statistics
      <br/>
      -finalizerinfo       to print information on objects awaiting finalization
      <br/>
      -dump:&lt;dump-options&gt; to dump java heap in hprof binary format
      <br/>
      dump-options:
      <br/>
      live         dump only live objects; if not specified,
      <br/>
      all objects in the heap are dumped.
      <br/>
      format=b     binary format
      <br/>
      file=&lt;file&gt;  dump heap to &lt;file&gt;
      <br/>
      Example: jmap -dump:live,format=b,file=heap.bin &lt;pid&gt;
      <br/>
      -F                   force. Use with -dump:&lt;dump-options&gt; &lt;pid&gt; or -histo
      <br/>
      to force a heap dump or histogram when &lt;pid&gt; does not
      <br/>
      respond. The "live" suboption is not supported
      <br/>
      in this mode.
      <br/>
      -h | -help           to print this help message
      <br/>
      -J&lt;flag&gt;             to pass &lt;flag&gt; directly to the runtime system
     </p>
    </blockquote>
    <p>
     虽然知道了JVM中加载的哪些类，怎么知道这些类属于什么jar呢？
    </p>
    <blockquote>
     <p>
      java &lt;app_name&gt; -verbose:class
     </p>
    </blockquote>
    <p>
     从JDK9开始，可以使用如下参数：
    </p>
    <blockquote>
     <p>
      java &lt;app_name&gt; -Xlog:class+load=info:classloaded.txt
     </p>
    </blockquote>
    <p>
     这些参数都需要在进程启动中添加。
    </p>
    <p>
    </p>
    <p>
     参考文档
    </p>
    <p>
     Java Platform, Standard Edition Troubleshooting Guide
     <br/>
     <a class="link-info" href="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/toc.html" rel="nofollow" title="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/toc.html">
      https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/toc.html
     </a>
    </p>
    <p>
     The jmap Utility
     <br/>
     <a class="link-info" href="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr014.html#class_loader_statistics" rel="nofollow" title="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr014.html#class_loader_statistics">
      https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr014.html#class_loader_statistics
     </a>
    </p>
    <p>
     The jcmd Utility
     <br/>
     <a class="link-info" href="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr006.html#BABEHABG" rel="nofollow" title="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr006.html#BABEHABG">
      https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr006.html#BABEHABG
     </a>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f6e657479656178692f:61727469636c652f64657461696c732f313233373235393531" class_="artid" style="display:none">
 </p>
</div>


