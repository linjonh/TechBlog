---
layout: post
title: "CentOS-7-搭建rsyslog日志服务器"
date: 2025-01-07 09:43:12 +0800
description: "搭建rsyslog日志服务器是在Linux系统上集中收集和管理日志的常见方法。#发送自定义的一段内容"
keywords: "日志服务器搭建及配置"
categories: ['']
tags: ['服务器', 'Linux', 'Centos']
artid: "140104698"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=140104698
    alt: "CentOS-7-搭建rsyslog日志服务器"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     CentOS 7 搭建rsyslog日志服务器
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      CentOS 7 搭建rsyslog日志服务器
     </h4>
     <ul>
      <li>
       <a href="#_1" rel="nofollow">
        前言
       </a>
      </li>
      <li>
       <a href="#IP_4" rel="nofollow">
        一、IP地址及主机名称规划
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1_7" rel="nofollow">
          1.修改主机名
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#rsyslog_16" rel="nofollow">
        二、配置rsyslog日志服务器
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1rsyslog_17" rel="nofollow">
          1.安装rsyslog服务
         </a>
        </li>
        <li>
         <a href="#2etcrsyslogconf__24" rel="nofollow">
          2.编辑/etc/rsyslog.conf 文件
         </a>
        </li>
        <li>
         <a href="#3rsyslog_37" rel="nofollow">
          3.启动并启用rsyslog服务
         </a>
        </li>
        <li>
         <a href="#4_53" rel="nofollow">
          4.验证端口是否侦听
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#rsyslogfirewalld_60" rel="nofollow">
        三、在rsyslog日志服务器上配置firewalld防火墙
       </a>
      </li>
      <li>
       <a href="#rsyslog_84" rel="nofollow">
        四、配置rsyslog日志客户端
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1etcrsyslogconf_85" rel="nofollow">
          1.编辑/etc/rsyslog.conf文件
         </a>
        </li>
        <li>
         <a href="#2rsyslog_95" rel="nofollow">
          2.重启客户端的rsyslog服务
         </a>
        </li>
        <li>
         <a href="#3ping_100" rel="nofollow">
          3.服务端和客户端相互ping一下
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_102" rel="nofollow">
        五、验证日志服务器配置是否生效
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1tail_104" rel="nofollow">
          1.在服务端tail日志文件
         </a>
        </li>
        <li>
         <a href="#2logger_111" rel="nofollow">
          2.在客户端logger一段自定义内容
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_119" rel="nofollow">
        六、配置日志存到指定位置文件
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1IP_121" rel="nofollow">
          1.IP地址及主机名称规划
         </a>
        </li>
        <li>
         <a href="#2_123" rel="nofollow">
          2.修改两个客户端主机名
         </a>
        </li>
        <li>
         <a href="#3etcrsyslogconf__133" rel="nofollow">
          3.在服务端编辑/etc/rsyslog.conf 文件
         </a>
        </li>
        <li>
         <a href="#4__148" rel="nofollow">
          4. 在服务端创建对应的目录并设置权限
         </a>
        </li>
        <li>
         <a href="#3rsyslog_159" rel="nofollow">
          3.重启服务端的rsyslog服务
         </a>
        </li>
        <li>
         <a href="#4_165" rel="nofollow">
          4.再次验证日志服务器配置是否生效
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#11_logger_166" rel="nofollow">
            1）在客户端1 logger一段自定义内容
           </a>
          </li>
          <li>
           <a href="#22_logger_172" rel="nofollow">
            2）在客户端2 logger一段自定义内容
           </a>
          </li>
          <li>
           <a href="#3tail_179" rel="nofollow">
            3）在服务端分别tail两个日志文件
           </a>
          </li>
         </ul>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="_1">
     </a>
     前言
    </h2>
    <p>
     搭建rsyslog日志服务器是在Linux系统上集中收集和管理日志的常见方法。
    </p>
    <h2>
     <a id="IP_4">
     </a>
     一、IP地址及主机名称规划
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c2bb46fc8b6bdb7a5576ebf5fe285686.jpeg#pic_center"/>
    </p>
    <h3>
     <a id="1_7">
     </a>
     1.修改主机名
    </h3>
    <pre><code>hostnamectl set-hostname serverlog
bash

hostnamectl set-hostname clientlog
bash
</code></pre>
    <h2>
     <a id="rsyslog_16">
     </a>
     二、配置rsyslog日志服务器
    </h2>
    <h3>
     <a id="1rsyslog_17">
     </a>
     1.安装rsyslog服务
    </h3>
    <p>
     Centos 7默认是安装了rsyslog服务的，如果没有，可以使用以下命令进行安装：
    </p>
    <pre><code>yum update
yum install rsyslog -y
</code></pre>
    <h3>
     <a id="2etcrsyslogconf__24">
     </a>
     2.编辑/etc/rsyslog.conf 文件
    </h3>
    <pre><code>编辑rsyslog配置文件：
nano /etc/rsyslog.conf
</code></pre>
    <p>
     将以下内容取消注释，去掉行首的#
    </p>
    <pre><code>$ModLoad imudp
$UDPServerRun 514
$ModLoad imtcp
$InputTCPServerRun 514
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/8269f70c743147afa93072296825034a.jpeg#pic_center"/>
    </p>
    <h3>
     <a id="3rsyslog_37">
     </a>
     3.启动并启用rsyslog服务
    </h3>
    <pre><code>#启动rsyslog服务
systemctl start rsyslog

#开机自启动rsyslog服务
systemctl enable rsyslog

#重新启动rsyslog服务
systemctl restart rsyslog

#查看rsyslog服务
systemctl status rsyslog
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e2065bc8a8f902eda90dfc78df2f04b7.jpeg#pic_center"/>
    </p>
    <h3>
     <a id="4_53">
     </a>
     4.验证端口是否侦听
    </h3>
    <pre><code>netstat -tunlp | grep "514"
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/10205035b4d44fe08185522643367ae6.jpeg#pic_center"/>
    </p>
    <h2>
     <a id="rsyslogfirewalld_60">
     </a>
     三、在rsyslog日志服务器上配置firewalld防火墙
    </h2>
    <pre><code>#查看默认区域
firewall-cmd --get-default-zone

#允许icmp
firewall-cmd --permanent - --add-protocol=icmp

#允许tcp514端口
firewall-cmd --permanent  --add-port=514/tcp

#允许udp514端口
firewall-cmd --permanent  --add-port=514/udp

#使配置生效
sudo firewall-cmd --reload

#查看防火墙规则
firewall-cmd --list-all
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3655cec5b780ccf1923106eabd901ccc.jpeg#pic_center"/>
    </p>
    <h2>
     <a id="rsyslog_84">
     </a>
     四、配置rsyslog日志客户端
    </h2>
    <h3>
     <a id="1etcrsyslogconf_85">
     </a>
     1.编辑/etc/rsyslog.conf文件
    </h3>
    <pre><code>nano /etc/rsyslog.conf

*.* @10.10.10.10:514
*.* @@10.10.10.10:514
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f069f3996e6435f4d0ae71cef6e36212.jpeg#pic_center"/>
    </p>
    <h3>
     <a id="2rsyslog_95">
     </a>
     2.重启客户端的rsyslog服务
    </h3>
    <pre><code>systemctl restart rsyslog
</code></pre>
    <h3>
     <a id="3ping_100">
     </a>
     3.服务端和客户端相互ping一下
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f321667e7da603ce2bff59dce90bcb8b.jpeg#pic_center"/>
    </p>
    <h2>
     <a id="_102">
     </a>
     五、验证日志服务器配置是否生效
    </h2>
    <h3>
     <a id="1tail_104">
     </a>
     1.在服务端tail日志文件
    </h3>
    <pre><code>tail -f /var/log/messages 
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4fcdd56bb6c24f590485cec06616eac6.jpeg#pic_center"/>
    </p>
    <h3>
     <a id="2logger_111">
     </a>
     2.在客户端logger一段自定义内容
    </h3>
    <pre><code>#发送自定义的一段内容，验证配置是否生效
logger chen789789
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a2b36ab2ea2c127497f3e6b7328acd30.jpeg#pic_center"/>
    </p>
    <h2>
     <a id="_119">
     </a>
     六、配置日志存到指定位置文件
    </h2>
    <p>
     为什么要指定位置，当前试验环境下，只有一个服务端，一个客户端，当有多个客户端的时候，我们如何区分不同的客户端的日志信息，我觉得最好的方法就是，将其存储在不同的日志文件中。
    </p>
    <h3>
     <a id="1IP_121">
     </a>
     1.IP地址及主机名称规划
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5805a883e303d2227d7925c6a7e5c6fd.jpeg#pic_center"/>
    </p>
    <h3>
     <a id="2_123">
     </a>
     2.修改两个客户端主机名
    </h3>
    <pre><code>hostnamectl set-hostname clientlog1
bash

hostnamectl set-hostname clientlog2
bash
</code></pre>
    <h3>
     <a id="3etcrsyslogconf__133">
     </a>
     3.在服务端编辑/etc/rsyslog.conf 文件
    </h3>
    <p>
     实现来自不同客户端的日志，存储在不同的日志文件中
    </p>
    <pre><code>nano /etc/rsyslog.conf 

if ($fromhost-ip == '10.10.10.20') then /var/log/client_logs/10.10.10.20.log
&amp; stop

if ($fromhost-ip == '10.10.10.22') then /var/log/client_logs/10.10.10.22.log
&amp; stop

</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e69416e76129d66a5c06d197026bfae2.jpeg#pic_center"/>
    </p>
    <h3>
     <a id="4__148">
     </a>
     4. 在服务端创建对应的目录并设置权限
    </h3>
    <pre><code> mkdir -p /var/log/client_logs

chmod -R 755 /var/log/client_logs

ls -ldi /var/log/client_logs
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/41f2a4871da42be8f7def6bdc72e9039.jpeg#pic_center"/>
    </p>
    <h3>
     <a id="3rsyslog_159">
     </a>
     3.重启服务端的rsyslog服务
    </h3>
    <pre><code>systemctl restart rsyslog
</code></pre>
    <h3>
     <a id="4_165">
     </a>
     4.再次验证日志服务器配置是否生效
    </h3>
    <h4>
     <a id="11_logger_166">
     </a>
     1）在客户端1 logger一段自定义内容
    </h4>
    <pre><code>logger client1_chen1111
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/43825555a8e93e15c1771d632fdf0750.jpeg#pic_center"/>
    </p>
    <h4>
     <a id="22_logger_172">
     </a>
     2）在客户端2 logger一段自定义内容
    </h4>
    <pre><code>logger client2_chen2222
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/210e49a0669ae7ad559fffa45b709f1e.jpeg#pic_center"/>
    </p>
    <h4>
     <a id="3tail_179">
     </a>
     3）在服务端分别tail两个日志文件
    </h4>
    <pre><code>tail -f /var/log/client_logs/10.10.10.20.log 
tail -f /var/log/client_logs/10.10.10.22.log 
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a704c5fc1d689c64b478ba3028739149.jpeg#pic_center"/>
    </p>
    <p>
     end
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34333436353735322f:61727469636c652f64657461696c732f313430313034363938" class_="artid" style="display:none">
 </p>
</div>


