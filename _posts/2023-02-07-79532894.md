---
layout: post
title: "3Windows平台下caffe的python接口配置及测试"
date: 2023-02-07 11:04:18 +0800
description: "一、前言在博文(1) Windows 10 + VS2013（cpuonly）安装 caffe 教程"
keywords: "验证pycaffe"
categories: ['Caffe', 'Caffe']
tags: ['Caffe']
artid: "79532894"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=79532894
    alt: "3Windows平台下caffe的python接口配置及测试"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     （3）Windows平台下caffe的python接口配置及测试
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2 id="一前言">
     一、前言
    </h2>
    <p>
     在博文
     <a href="http://blog.csdn.net/liuweiyuxiang/article/details/79520800">
      (1) Windows 10 + VS2013（cpuonly）安装 caffe 教程
     </a>
     中我介绍了怎样在windows上安装微软封装的caffe。但是为了避免出现问题，安装的时候我们是将PythonSupport设置为false。python使我们机器学习和深度学习爱好者最常使用的语言，我们经常需要在python中使用caffe。在这篇博客中，我们就来学习怎样在python中配置caffe。在这里还是要使用到安装caffe时使用的caffe-master和VS2013。
    </p>
    <h2 id="二配置python接口">
     二、配置python接口
    </h2>
    <h3 id="21-修改配置文件">
     2.1 修改配置文件
    </h3>
    <p>
     修改配置文件CommonSettings.props，这里有两处需要修改。首先是修改PythonSupport为true，然后在PythonDir设置python.exe（注意是python2）所在的位置。完成后保存。
     <br/>
     <img alt="这里写图片描述" src="https://img-blog.csdn.net/20180312203000308?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1d2VpeXV4aWFuZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" title="">
      <br/>
      <img alt="这里写图片描述" src="https://img-blog.csdn.net/20180312203009205?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1d2VpeXV4aWFuZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" title=""/>
     </img>
    </p>
    <h3 id="22-安装需要的python库">
     2.2 安装需要的python库
    </h3>
    <pre class="prettyprint"><code class="hljs cmake">activate py2 <span class="hljs-comment">#启动配置caffe的python虚拟环境</span>
conda <span class="hljs-keyword">install</span> numpy <span class="hljs-comment">#安装numpy库</span>
conda <span class="hljs-keyword">install</span> protobuf <span class="hljs-comment">#安装protobuf</span></code></pre>
    <p>
     不安装numpy和protobuf编译可能会出现错误。
    </p>
    <h3 id="23-编译和使用pycaffe">
     2.3 编译和使用pycaffe
    </h3>
    <p>
     选择解决方案caffe下的pycaffe，然后生成Release版本pycaffe。
     <br/>
     <img alt="这里写图片描述" src="https://img-blog.csdn.net/20180312203310674?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1d2VpeXV4aWFuZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" title="">
      <br/>
      生成成功后在caffe-master\Build\x64\Release\pycaffe文件夹下会生成caffe文件夹和一些文件。
      <br/>
      <img alt="这里写图片描述" src="https://img-blog.csdn.net/2018031220345738?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1d2VpeXV4aWFuZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" title="">
       <br/>
       直接将生成的caffe文件夹拷贝到python安装的根目录下的Lib\site-packages文件夹下即可。到此就将caffe配置在python中了。
       <br/>
       <img alt="这里写图片描述" src="https://img-blog.csdn.net/20180312203729927?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1d2VpeXV4aWFuZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" title=""/>
      </img>
     </img>
    </p>
    <h2 id="三测试python中的caffe配置">
     三、测试python中的caffe配置
    </h2>
    <h3 id="31-在python中导入caffe模块测试">
     3.1 在python中导入caffe模块测试
    </h3>
    <p>
     在cmd中进入python，然后导入caffe模块。可能会提示缺少某些module，只需要根据提示把缺少的module安装上即可。
     <br/>
     <img alt="这里写图片描述" src="https://img-blog.csdn.net/20180312204443682?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1d2VpeXV4aWFuZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" title="">
      <br/>
      还可能会出现
      <em>
       ImportError: No module named google.protobuf.internal
      </em>
      ，只需要输入如下命令安装protobuf 模块即可。
     </img>
    </p>
    <pre class="prettyprint"><code class="language-cmd hljs cmake">conda <span class="hljs-keyword">install</span> protobuf  </code></pre>
    <p>
     安装完所有依赖的包之后再导入caffe将不会再出现异常。
    </p>
    <h3 id="32-训练模型测试">
     3.2 训练模型测试
    </h3>
    <p>
     还是使用上一篇博客
     <a href="http://blog.csdn.net/liuweiyuxiang/article/details/79532073">
      Windows下caffe安装成功测试
     </a>
     中使用的mnist数据集。数据处理部分已将在上一篇博客中介绍，不再介绍。进入caffe-master文件夹，新建demo.py，并将如下代码拷贝到其中。
    </p>
    <pre class="prettyprint"><code class="language-python hljs"><span class="hljs-keyword">import</span> caffe
caffe.set_mode_cpu()
solver = caffe.SGDSolver(<span class="hljs-string">'examples/mnist/lenet_solver.prototxt'</span>)
solver.solve()</code></pre>
    <p>
     然后进入cmd输入python demo.py，执行python脚本。开始训练模型。
     <br/>
     <img alt="这里写图片描述" src="https://img-blog.csdn.net/2018031220560129?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1d2VpeXV4aWFuZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" title="">
      <br/>
      训练过程中会输出一些信息。输出Optimization Done. 表示训练结束。并且会输出训练好的模型。
      <br/>
      <img alt="这里写图片描述" src="https://img-blog.csdn.net/20180312205952402?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1d2VpeXV4aWFuZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" title=""/>
     </img>
    </p>
    <h2 id="四后记">
     四、后记
    </h2>
    <p>
     在配置好python接口后，我在使用的过程中，发现C++接口又不好使了。使用命令行
     <code>
      caffe.exe train --solver=''
     </code>
     进行训练，弹出
     <code>
      应用程序无法正常启动0xc000007b
     </code>
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f07324750c25608d43e5d63f6aee0980.png" title="">
      <br/>
      此时我想到，之前还是好用的，我除了打开python接口重新编译了pycaffe，其他什么都没有更改。所以我把python接口关闭，重新编译整个解决方案，提示成功编译16个项目。此时C++接口 caffe.exe可以正常工作。由于之前pycaffe下的caffe已经拷贝进python的环境下，此时python接口也是正常的。至此caffe-windows配置结束。
     </img>
    </p>
    <h2 id="五参考">
     五、参考
    </h2>
    <ol>
     <li>
      <a href="http://blog.csdn.net/zb1165048017/article/details/52980102">
       【caffe-Windows】微软官方caffe之 Python接口配置及图片生成实例
      </a>
     </li>
     <li>
      <a href="http://www.cnblogs.com/linyuanzhou/p/6012231.html" rel="nofollow">
       使用caffe提供的python接口训练mnist例子
      </a>
     </li>
    </ol>
    <h2 id="六更多">
     六、更多
    </h2>
    <ol>
     <li>
      <a href="http://blog.csdn.net/liuweiyuxiang/article/details/79520800">
       Windows 10 + VS2013（cpuonly）安装 caffe 教程
      </a>
     </li>
     <li>
      <a href="http://blog.csdn.net/liuweiyuxiang/article/details/79532073">
       Windows下caffe安装成功测试
      </a>
     </li>
    </ol>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f6c697577656979757869616e67:2f61727469636c652f64657461696c732f3739353332383934" class_="artid" style="display:none">
 </p>
</div>


