---
layout: post
title: "nbiot电信云北向开发-基于LiteNAdemo_https例程"
date: 2023-01-07 23:10:00 +0800
description: "本文将借助于官方的例程实现nbiot的定位功能。一.功能分析1.数据上报当bc20上报数据时，电信云"
keywords: "电信nbiot云平台 c#开发"
categories: ['智慧安全社区云服务器搭建']
tags: ['电信Iot', '北向开发', 'Nbiot', 'Bc']
artid: "88615114"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=88615114
    alt: "nbiot电信云北向开发-基于LiteNAdemo_https例程"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     nbiot电信云北向开发---基于LiteNAdemo_https例程
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     本文将借助于官方的例程实现nbiot的定位功能。
    </p>
    <p>
    </p>
    <p>
     一.功能分析
    </p>
    <p>
     1.数据上报
    </p>
    <p>
     当bc20上报数据时，电信云平台能够将数据自动推送到后台服务器。（目前暂时由后台服务器发送请求，自动推送需要ca证书）
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     （1）鉴权
    </p>
    <p>
     电信云采用token来保障安全。使用对应的appid和secret获取token。调用其他接口时需要附上token。
    </p>
    <p>
     请求示例：
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p33599791">
     Method: POST
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p33962670">
     request:
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p37228582">
     https://server:port/iocm/app/sec/v1.1.0/login
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p66621782">
     Content-Type:application/x-www-form-urlencoded
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p62725128">
     Body:
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p27655246">
     {
     <!-- -->
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p1196424515411">
     appId=******,
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p47570623">
     secret=******
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p25482430">
     }
    </p>
    <p>
     响应示例：
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p645224205917">
     response:
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p12936536125812">
     Status Code: 200 OK
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p79365369583">
     Content-Type: application/json
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p1793693665812">
     Body:
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p1193633635816">
     {
     <!-- -->
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p119361336165820">
     "scope": "default",
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p193616365581">
     "tokenType": "bearer",
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p5937183675814">
     "expiresIn": "*******",
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p1493719365581">
     "accessToken": "*******",
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p169372369581">
     "refreshToken": "*******"
    </p>
    <p id="ZH-CN_TOPIC_0121226293__zh-cn_topic_0118048080_p73501125115912">
     }
    </p>
    <p>
     使用官方例程，修改对应的appid和secret，运行，得到如下结果
    </p>
    <p>
     <img alt="" class="has" height="563" src="https://i-blog.csdnimg.cn/blog_migrate/f26325578c389246bd69796eb66cb394.png" width="1000"/>
    </p>
    <p>
    </p>
    <p>
     （2)后台服务器向电信云平台请求数据
    </p>
    <p>
     请求示例：
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p52718851">
     Method: GET
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p154113401384">
     request:
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p4707611">
     https://server:port/iocm/app/dm/v1.4.0/devices/{deviceId}?select=imsi
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p42368504">
     Header:
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p45772217">
     "app_key: **"
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p9296777">
     "Authorization:Bearer**"
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p16562136">
     Content-Type:application/json
    </p>
    <p>
     响应示例：
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p66464672">
     response:
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p61311138">
     Status Code: 200 OK
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p14929336">
     Content-Type: application/json
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p11850125">
     Body:
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p39542265">
     {
     <!-- -->
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p20336069">
     "deviceId": "xxxxx",
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p48806898">
     "gatewayId": "xxxxx",
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p36608906">
     "nodeType": "xxxxx",
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p61044700">
     "deviceInfo": {
     <!-- -->
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p12531395">
     "name": "Sensor_12",
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p45673695">
     "manufacturerName": "wulian",
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p8410073">
     "deviceType": "gateway",
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p8581794">
     "model": "90",
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p10127283">
     "mac": "C7EA1904004B1204",
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p24036685">
     "swVersion": "th",
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p15003577">
     "fwVersion": "seu",
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p814473">
     "hwVersion": "sru",
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p7330261">
     "protocolType": "zigbee",
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p65972349">
     "description": "smockdetector",
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p56880236">
     "imsi": "xxxxx"
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p42160082">
     },
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p43896424">
     "services": [
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p59523504">
     {
     <!-- -->
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p65949489">
     "serviceType": "air_conditioner",
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p56674494">
     "serviceId": "1",
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p40308398">
     "data"{
     <!-- -->
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p27231268">
     "battery_low": 1
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p43754824">
     }
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p58249099">
     },
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p54479846">
     {
     <!-- -->
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p20556570">
     "serviceType": "air_conditioner",
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p50791409">
     "serviceId": "jkh",
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p54469498">
     "data": {
     <!-- -->
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p20463440">
     "battery_low": "jhj"
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p49953235">
     }
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p46925932">
     }
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p19680204">
     ]
    </p>
    <p id="ZH-CN_TOPIC_0121226352__zh-cn_topic_0118048077_p42904108">
     }
    </p>
    <p>
     修改例程的相关参数，运行结果如下
    </p>
    <p>
     <img alt="" class="has" height="563" src="https://i-blog.csdnimg.cn/blog_migrate/324b94e5f7ba041b077621a5002a9990.png" width="1000"/>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     2.命令下发
    </p>
    <p>
     后台服务器可以将命令下发到bc20设备，当设备不在线的时候命令缓存在电信云平台。
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p33146540">
     Method: POST
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p515245">
     request: https://server:port/iocm/app/cmd/v1.4.0/deviceCommands
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p33975136">
     Header:
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p37340768">
     "app_key: ******"
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p522599">
     "Authorization:Bearer******"
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p4703397">
     Content-Type:application/json
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p24443932">
     Body:
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p18668796">
     {
     <!-- -->
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p33801439">
     "deviceId": "********",
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p35777503">
     "command": {
     <!-- -->
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p53562076">
     "serviceId": "********",
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p12296639">
     "method": "********",
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p43560889">
     "paras": {
     <!-- -->
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p56503683">
     "paraName1": "paraValue1",
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p38771102">
     "paraName2": "paraValue2"
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p13395604">
     }
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p53451572">
     },
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p11302105">
     "callbackUrl": "http://127.0.0.1:9999/cmd/callbackUrl",
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p117588461216">
     "maxRetransmit":******,
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p34610082">
     }
    </p>
    <p>
     响应示例
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p51953297">
     response:
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p64926497">
     Status Code: 201 OK
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p47467561">
     Content-Type:application/json
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p19667217">
     Body:
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p42787226">
     {
     <!-- -->
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p49540721">
     "commandId": "********",
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p43213310">
     "appId": "********",
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p53375474">
     "deviceId": "********",
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p10617222">
     "command": {
     <!-- -->
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p28446139">
     "serviceId": "********",
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p54688667">
     "method": "********",
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p22435957">
     "paras": {
     <!-- -->
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p597028">
     "paraName1": "paraValue1",
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p5373256">
     "paraName2": "paraValue2"
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p48359306">
     }
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p32580571">
     },
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p24789684">
     "callbackUrl": "http://127.0.0.1:9999/cmd/callbackUrl",
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p21780566">
     "expireTime": null,
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p61807370">
     "status": "PENDDING",
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p40341110">
     "creationTime": "20170222T164000Z",
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p27525670">
     "executeTime": null,
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p46404445">
     "platformIssuedTime": null,
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p14986827">
     "deliveredTime": null,
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p663721">
     "issuedTimes": null,
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p196317599402">
     "maxRetransmit":******
    </p>
    <p id="ZH-CN_TOPIC_0121226346__zh-cn_topic_0118048098_p5973497">
     }
    </p>
    <p>
     修改相关参数，运行结果如下
    </p>
    <p>
     <img alt="" class="has" height="563" src="https://i-blog.csdnimg.cn/blog_migrate/0b5624a4ab15866f13f7fffa13e6117c.png" width="1000"/>
    </p>
    <p>
     设备接收到相关信息
    </p>
    <p>
     <img alt="" class="has" height="563" src="https://i-blog.csdnimg.cn/blog_migrate/7ca559f7b605f129fe20b764684f7a4a.png" width="1000"/>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     3.可以通过后台服务器在电信云平台注册设备
    </p>
    <p>
     当需要添加新设备的时候，可以通过后台服务器向电信云平台注册。
    </p>
    <p>
    </p>
    <p>
     请求示例
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p38679968">
     Method: POST
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p12575398">
     request:
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p46069724">
     https://server:port/iocm/app/reg/v1.1.0/deviceCredentials?appId=*********
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p11974340">
     Header:
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p40660197">
     "app_key: ******"
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p30397458">
     "Authorization:Bearer ******"
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p5141666">
     Content-Type:application/json
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p5907718">
     Body:
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p53169463">
     {
     <!-- -->
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p8763120">
     "endUserId": "***********",
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p11759218">
     "verifyCode": "****************",
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p38724102">
     "nodeId": "****************",
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p12972606">
     "psk": "********************************",
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p49644594">
     "timeout": 300,
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p45850157">
     }
    </p>
    <p>
     响应示例
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p11371424">
     response:
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p35233952">
     Status Code: 200 OK
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p48670112">
     Content-Type: application/json
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p35377825">
     Body:
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p49964972">
     {
     <!-- -->
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p47031571">
     "deviceId": "*******",
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p20630957">
     "verifyCode": "*******",
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p51460893">
     "psk": "*********",
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p60494859">
     "timeout": 300
    </p>
    <p id="ZH-CN_TOPIC_0121226296__zh-cn_topic_0118048091_p7582824">
     }
    </p>
    <p>
     <img alt="" class="has" height="563" src="https://i-blog.csdnimg.cn/blog_migrate/d98784552cb75ab174f7c92951343347.png" width="1000"/>
    </p>
    <p>
     最上一行的设备就是刚才注册的。
    </p>
    <p>
     <img alt="" class="has" height="563" src="https://i-blog.csdnimg.cn/blog_migrate/3dd7f29943765e4a23b251891d54f693.png" width="1000"/>
    </p>
    <p>
    </p>
    <p>
     也可以删除设备
    </p>
    <p>
     <img alt="" class="has" height="563" src="https://i-blog.csdnimg.cn/blog_migrate/8040fd26ef4d33f50d51a27785e69e57.png" width="1000"/>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f67:2e6373646e2e6e65742f77656978696e5f3432313835353533:2f61727469636c652f64657461696c732f3838363135313134" class_="artid" style="display:none">
 </p>
</div>


