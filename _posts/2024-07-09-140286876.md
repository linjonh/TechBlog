---
layout: post
title: "PyTorch复现PointNet模型训练可视化测试显示"
date: 2024-07-09 16:26:08 +0800
description: "PointNet源码调试（模型训练+可视化测试显示）_pointnet复现"
keywords: "pointnet复现"
categories: ['3D点云学习']
tags: ['Pointnet']
artid: "140286876"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=140286876
    alt: "PyTorch复现PointNet模型训练可视化测试显示"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     PyTorch复现PointNet——模型训练+可视化测试显示
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     因为项目涉及到3D点云项目，故学习下PointNet这个用来处理点云的神经网络
     <br/>
     论文的话，大致都看了下，网络结构有了一定的了解，本博文主要为了下载调试PointNet网络源码，训练和测试调通而已。
    </p>
    <p>
     我是在Anaconda下创建一个新的虚拟环境空间部署项目测试
     <br/>
     大概用到的就这些了，后面调试项目时候缺少安装啥就行了
    </p>
    <pre><code class="prism language-python">torch                     <span class="token number">2.0</span><span class="token number">.0</span><span class="token operator">+</span>cu117
torchvision               <span class="token number">0.15</span><span class="token number">.0</span><span class="token operator">+</span>cu117
python                    <span class="token number">3.8</span><span class="token number">.19</span>
numpy                     <span class="token number">1.24</span><span class="token number">.3</span>
matplotlib                <span class="token number">3.7</span><span class="token number">.5</span>
opencv<span class="token operator">-</span>python             <span class="token number">4.10</span><span class="token number">.0</span><span class="token number">.84</span>
</code></pre>
    <h2>
     <a id="_14">
     </a>
     一、下载源码和数据集
    </h2>
    <p>
     论文：
     <a href="https://arxiv.org/abs/1612.00593" rel="nofollow">
      《PointNet: Deep Learning on Point Sets for 3D Classification and Segmentation》
     </a>
     <br/>
     GitHub源码：
     <a href="https://github.com/fxia22/pointnet.pytorch">
      pointnet.pytorch
     </a>
     <br/>
     数据集下载：
     <a href="https://shapenet.cs.stanford.edu/ericyi/shapenetcore_partanno_segmentation_benchmark_v0.zip" rel="nofollow">
      shapenetcore_partanno_segmentation_benchmark_v0.zip
     </a>
     <br/>
     若上面的数据集没法下载，可以走网盘：
     <a href="https://pan.baidu.com/s/1e1EmaB6p7ELjtGNJkN-RHg?pwd=f546" rel="nofollow">
      shapenetcore_partanno_segmentation_benchmark_v0.zip
     </a>
    </p>
    <p>
     大致的源码结构如下：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a15725b7768a482abd83574bedfea643.png"/>
    </p>
    <h2>
     <a id="PyCharm_22">
     </a>
     二、PyCharm打开项目
    </h2>
    <p>
     拿到项目，第一件事是要看下
     <strong>
      README.md
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ce3838eac1ad44a19836f55d66a4d941.png">
      <br/>
      没啥高级词汇，大概能看出来啥意思就行
     </img>
    </p>
    <h2>
     <a id="_26">
     </a>
     三、下载数据集
    </h2>
    <p>
     <code>
      .sh
     </code>
     文件是Linux下的脚本文件夹，我这是Windows操作系统，先打开看看这里面都写了啥
     <br/>
     可视化工具在
     <code>
      build.sh
     </code>
     文件中，数据集在
     <code>
      download.sh
     </code>
     中，我这边就只用到必须的数据集
    </p>
    <p>
     看下
     <code>
      download.sh
     </code>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2e1624570d4946128f296d776fac49ea.png">
      <br/>
      知道了数据集下载的链接
      <br/>
      数据集下载：https://shapenet.cs.stanford.edu/ericyi/shapenetcore_partanno_segmentation_benchmark_v0.zip
      <br/>
      也就是第一部分中提到的数据集下载链接
     </img>
    </p>
    <h2>
     <a id="_36">
     </a>
     四、分类任务
    </h2>
    <p>
     训练的话，通过
     <strong>
      README.md
     </strong>
     可以看出有两种，一种是分类任务，一种是分割任务
    </p>
    <pre><code class="prism language-python">cd utils
python train_classification<span class="token punctuation">.</span>py <span class="token operator">-</span><span class="token operator">-</span>dataset <span class="token operator">&lt;</span>dataset path<span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token operator">-</span>nepoch<span class="token operator">=</span><span class="token operator">&lt;</span>number epochs<span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token operator">-</span>dataset_type <span class="token operator">&lt;</span>modelnet40 <span class="token operator">|</span> shapenet<span class="token operator">&gt;</span>
</code></pre>
    <h3>
     <a id="41_train_classificationpy_42">
     </a>
     4.1 分类模型训练：train_classification.py
    </h3>
    <h4>
     <a id="1utils_43">
     </a>
     1，文件在
     <code>
      utils
     </code>
     文件夹下
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2b2eb80d674e45708a239ebf39abbea3.png"/>
    </p>
    <h4>
     <a id="2READMEmd_45">
     </a>
     2，
     <strong>
      README.md
     </strong>
     也说明了要配置的参数
    </h4>
    <p>
     <code>
      python train_classification.py --dataset &lt;dataset path&gt; --nepoch=&lt;number epochs&gt; --dataset_type &lt;modelnet40 | shapenet&gt;
     </code>
    </p>
    <p>
     我把要配置的参数给整理到一块了，方便进行修改测试，其他的参数根据情况去修改即可
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/26b9c47090ce49b7a0333a34dba7532e.png"/>
    </p>
    <h4>
     <a id="3Ctrl__Shift__F10_50">
     </a>
     3，右击运行（Ctrl + Shift + F10），报错
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7ece2036874a4877a60ba0123003e3a6.png">
      <br/>
      修改进程数为0，
      <code>
       parser.add_argument('--workers', type=int, help='number of data loading workers', default=0)
      </code>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/00b9d56abc5e4010a45e7a6948f19952.png"/>
     </img>
    </p>
    <h4>
     <a id="4Ctrl__Shift__F10_54">
     </a>
     4，再次右击运行（Ctrl + Shift + F10）报错
    </h4>
    <pre><code class="prism language-python">OMP<span class="token punctuation">:</span> Error <span class="token comment">#15: Initializing libiomp5md.dll, but found libiomp5md.dll already initialized.</span>
OMP<span class="token punctuation">:</span> Hint This means that multiple copies of the OpenMP runtime have been linked into the program<span class="token punctuation">.</span> That <span class="token keyword">is</span> dangerous<span class="token punctuation">,</span> since it can degrade performance <span class="token keyword">or</span> cause incorrect results<span class="token punctuation">.</span> The best thing to do <span class="token keyword">is</span> to ensure that only a single OpenMP runtime <span class="token keyword">is</span> linked into the process<span class="token punctuation">,</span> e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> by avoiding static linking of the OpenMP runtime <span class="token keyword">in</span> <span class="token builtin">any</span> library<span class="token punctuation">.</span> As an unsafe<span class="token punctuation">,</span> unsupported<span class="token punctuation">,</span> undocumented workaround you can <span class="token builtin">set</span> the environment variable KMP_DUPLICATE_LIB_OK<span class="token operator">=</span>TRUE to allow the program to <span class="token keyword">continue</span> to execute<span class="token punctuation">,</span> but that may cause crashes <span class="token keyword">or</span> silently produce incorrect results<span class="token punctuation">.</span> For more information<span class="token punctuation">,</span> please see http<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>intel<span class="token punctuation">.</span>com<span class="token operator">/</span>software<span class="token operator">/</span>products<span class="token operator">/</span>support<span class="token operator">/</span><span class="token punctuation">.</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/b59ccb5ab2f44e759818c0ca08b8415f.png">
      <br/>
      按要求加入，
      <code>
       os.environ["KMP_DUPLICATE_LIB_OK"]="TRUE"
      </code>
      ，允许程序在存在多个 libiomp5md.dll 副本的情况下继续执行，但这可能会导致不稳定的行为，包括程序崩溃或产生不正确的结果，所以它只是一个临时的解决方案
     </img>
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> os                                  
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"KMP_DUPLICATE_LIB_OK"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"TRUE"</span>  
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a45874d4238944a987eb5abd972d6cf5.png"/>
    </p>
    <h4>
     <a id="5Ctrl__Shift__F10_69">
     </a>
     5，再次右击运行（Ctrl + Shift + F10），开始训练
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2debc5d89a424f1c8c102731c51b6613.png"/>
     <br/>
     让它跑着吧先~~也就5个epoch
    </p>
    <h4>
     <a id="6epoch5epoch_74">
     </a>
     6，因为这里训练的epoch为5，每个epoch都会存下来一个模型
    </h4>
    <p>
     可以看到在utils下的cls文件下有五个模型
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e0c5706e776b402596e44502a44a3179.png"/>
    </p>
    <h3>
     <a id="42_show_clspy_77">
     </a>
     4.2 分类模型测试：show_cls.py
    </h3>
    <h4>
     <a id="1utilsshow_clspy_78">
     </a>
     1，utils文件夹下的
     <strong>
      show_cls.py
     </strong>
     文件用于分类模型测试
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/935ea72c512d46548e726ac16c177769.png"/>
    </p>
    <h4>
     <a id="2_80">
     </a>
     2，指定两个参数即可
    </h4>
    <p>
     模型路径：
     <code>
      parser.add_argument('--model', type=str, default = './cls/cls_model_4.pth', help='model path')
     </code>
     <br/>
     数据集的路径：
     <code>
      root='../dataset/shapenetcore_partanno_segmentation_benchmark_v0'
     </code>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4f58ec8e32584248917ee42078374b7c.png"/>
    </p>
    <h4>
     <a id="3Ctrl__Shift__F10_84">
     </a>
     3，右击运行（Ctrl + Shift + F10），测试成功
    </h4>
    <p>
     可以看到测试的损失和准确率，目前作者没有提供可视化结果展示
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/acbb0d3623bf47ed881d01fa41ae5ad0.png"/>
    </p>
    <h2>
     <a id="_88">
     </a>
     五、分割任务
    </h2>
    <p>
     能把分类任务跑通，分割任务都是类似的
    </p>
    <h3>
     <a id="51_train_segmentationpy_90">
     </a>
     5.1 分割模型训练：train_segmentation.py
    </h3>
    <p>
     <code>
      python train_segmentation.py --dataset &lt;dataset path&gt; --nepoch=&lt;number epochs&gt;
     </code>
    </p>
    <h4>
     <a id="1utils_92">
     </a>
     1，文件在utils文件夹下
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/b0627514db114ebd9d0b695f01400951.png"/>
    </p>
    <h4>
     <a id="2READMEmd_95">
     </a>
     2，看README.md指定配置参数
    </h4>
    <p>
     <code>
      python train_segmentation.py --dataset &lt;dataset path&gt; --nepoch=&lt;number epochs&gt;
     </code>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1970395af5e34ffc9c27247381a76b8e.png"/>
    </p>
    <h4>
     <a id="3Ctrl__Shift__F10_99">
     </a>
     3，右击运行（Ctrl + Shift + F10），开始训练
    </h4>
    <p>
     开始训练
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/94fa75c1c43b4192bc594292e54af9b5.png"/>
     <br/>
     epoch为25
    </p>
    <h4>
     <a id="4epoch2525_104">
     </a>
     4，epoch为25，会保存25个模型
    </h4>
    <p>
     可以看到在utils下的seg文件下有二十五个模型
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a9e6ed17d4bd47d09883b1b49240292c.png"/>
    </p>
    <h3>
     <a id="52_show_segpy_107">
     </a>
     5.2 分割任务测试：show_seg.py
    </h3>
    <h4>
     <a id="1utilsshow_segpy_108">
     </a>
     1，utils文件夹下的
     <strong>
      show_seg.py
     </strong>
     文件用于分割模型测试
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/44b12d6858494a46ad72ced3a87741cc.png"/>
    </p>
    <h4>
     <a id="2Ctrl__Shift__F10_110">
     </a>
     2，右击运行（Ctrl + Shift + F10），报错
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4482151c2f974ebc930249285e59250e.png"/>
     <br/>
     找了一下原因，
     <code>
      show_seg.py
     </code>
     用到了
     <code>
      show3d_balls.py
     </code>
     里面的
     <code>
      showpoints函数
     </code>
     <br/>
     <code>
      show3d_balls.py
     </code>
     又用到了一个dll文件，
     <code>
      dll = np.ctypeslib.load_library('render_balls_so', '.')
     </code>
     而这个是
     <code>
      .so
     </code>
     不是
     <code>
      .dll
     </code>
     （原文是在Linux下跑的）
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e27e880d909c4733946f9332cee9722d.png"/>
     <br/>
     故需要转换一下，通过Visual Studio创建一个动态链接库(DLL)项目，生成
     <code>
      render_balls_so.dll
     </code>
     放到utils文件下即可
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/0703b9ea29dc4e79bcd4a1655ceef5fe.png"/>
     <br/>
     我这边就不搞了，抓紧时间学习下PointNet++
     <br/>
     参考博客：https://blog.csdn.net/qq_45369294/article/details/121041403
    </p>
    <h4>
     <a id="3_119">
     </a>
     3，直接拿来用
    </h4>
    <p>
     <a href="https://pan.baidu.com/s/1gOiE5yhYG5lqDdoQvtZbxA?pwd=3m4a" rel="nofollow">
      render_balls_so.dll免费下载
     </a>
     <br/>
     下载是一个压缩包，里面是一个完整的Visual Studio项目，但是用不到，咱们就用到了里面的一个dll文件
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9b4daa896155412e96a7c80183143146.png"/>
    </p>
    <h4>
     <a id="4Ctrl__Shift__F10_123">
     </a>
     4，再次右击运行（Ctrl + Shift + F10），报错
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/b4c2785e2ae7448897686a39049c884b.png"/>
     <br/>
     还是之前遇到的问题，导入
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> os
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"KMP_DUPLICATE_LIB_OK"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"TRUE"</span>
</code></pre>
    <p>
     和分类任务一样，进行简单配置即可
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/3671ff9225a04d5489285ccc3b7329e9.png"/>
    </p>
    <h4>
     <a id="5Ctrl__Shift__F10_132">
     </a>
     5，再次右击运行（Ctrl + Shift + F10），测试成功
    </h4>
    <p>
     对Airplane进行分割，效果展示
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/78e847abf64b487881fd2b6d24ce5e29.png"/>
    </p>
    <h2>
     <a id="_135">
     </a>
     六、完结
    </h2>
    <p>
     目前只是实现了代码的跑通，后续还得认真学习原理以及去修改模型架构适配自己的工作任务。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34313236343035352f:61727469636c652f64657461696c732f313430323836383736" class_="artid" style="display:none">
 </p>
</div>


