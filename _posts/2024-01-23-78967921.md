---
layout: post
title: "通用权限管理设计-之-数据权限"
date: 2024-01-23 10:16:33 +0800
description: "前言 前一篇文章《通用权限管理设计 之 数据库设计方案》介绍了【主体】- 【领域】 - 【权限】( "
keywords: "数据权限规则"
categories: ["未分类"]
tags: ["无标签"]
artid: "78967921"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=78967921
  alt: "通用权限管理设计-之-数据权限"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     通用权限管理设计 之 数据权限
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h3 style="background-color:rgb(127,143,177); color:white; padding:3px 3px 3px 8px; font-size:21px; line-height:1.5; margin:10px 0px; font-family:verdana">
     前言
    </h3>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      前一篇文章《
      <a href="http://www.cnblogs.com/leoxie2011/archive/2011/05/19/2050626.html" rel="nofollow noopener noreferrer" style="color:rgb(91,157,202); text-decoration:none; padding:1px 2px" target="_blank">
       通用权限管理设计 之 数据库设计方案
      </a>
      》介绍了【主体】- 【领域】 - 【权限】( who、what、how问题原型 ) 的设计思想
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      本文将对这种设计思想作进一步的扩展，介绍数据权限的设计方案。
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      权限控制可以理解，分为这几种 ：
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      <span style="color:rgb(255,0,0)">
       【功能权限】：
      </span>
      能做什么的问题，如增加产品。
     </span>
     <br/>
     <span style="font-size:13px">
      <span style="color:rgb(255,0,0)">
       【数据权限】：
      </span>
      能看到哪些数据的问题，如查看本人的所有订单。
      <br/>
      <span style="color:rgb(255,0,0)">
       【字段权限】：
      </span>
      能看到哪些信息的问题，如供应商账户，看不到角色、 部门等信息。
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      上面提到的那种设计就是【功能权限】，这种设计有一定的局限性，对于主体，只能明确地指定。对于不明确的，在这里可能就没办法处理。比如下面这几种情况：
     </span>
    </p>
    <blockquote style="background:none rgb(252,254,197); border:1px solid rgb(187,187,187); padding:5px 10px 5px 20px; margin:10px 0px; line-height:1.3; word-wrap:break-word; font-family:verdana; font-size:14px">
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:13px">
       数据仅当前部门及上级可见
      </span>
      <br/>
      <span style="font-size:13px">
       数据仅当前用户(本人)可见
      </span>
     </p>
    </blockquote>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      类似这样的就需要用到上面提的数据权限。
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px; color:rgb(255,0,0)">
      上一篇文章我用一个表五个字段完成了【功能权限】的设计思路
     </span>
     <br/>
     <span style="font-size:13px; color:rgb(255,0,0)">
      本文我将介绍如何利用一个表两个字段完成这个【数据权限】的设计思路
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <a name="label2" style="color:rgb(91,157,202); padding:1px 2px" target="_blank">
     </a>
    </p>
    <h3 style="background-color:rgb(127,143,177); color:white; padding:3px 3px 3px 8px; font-size:21px; line-height:1.5; margin:10px 0px; font-family:verdana">
     初步分析
    </h3>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      【数据权限】是在【功能权限】的基础上面进一步的扩展，比如可以查看订单属于【功能权限】的范围，但是可以查看哪些订单就是【数据权限】的工作了。
     </span>
    </p>
    <blockquote style="background:none rgb(252,254,197); border:1px solid rgb(187,187,187); padding:5px 10px 5px 20px; margin:10px 0px; line-height:1.3; word-wrap:break-word; font-family:verdana; font-size:14px">
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:13px">
       在设计中，我们规定好如果没有设置了数据权限规则，那么视为允许查看全部的数据。
      </span>
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:13px">
       <strong>
        几个概念
       </strong>
       <br/>
       【资源】：数据权限的控制对象，业务系统中的各种资源。比如订单单据、销售单等。属于上面提到的【领域】中的一种
       <br/>
       【主体】：用户、部门、角色等。
       <br/>
       【条件规则】：用于检索数据的条件定义
       <br/>
       【数据规则】：用于【数据权限】的条件规则
      </span>
     </p>
    </blockquote>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <br/>
     <span style="font-size:13px">
      <strong>
       应用场景
      </strong>
     </span>
     <br/>
     <span style="font-size:13px">
      1，订单，可以由本人查看
     </span>
     <br/>
     <span style="font-size:13px">
      2，销售单，可以由本人或上级领导查看
     </span>
     <br/>
     <span style="font-size:13px">
      3，销售单，销售人员可以查看自己的，销售经理只查看 销售金额大于100,000的。
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      我们能想到直接的方法，在访问数据的入口加入SQL Where条件来实现，组织sql语句：
     </span>
    </p>
    <div class="cnblogs_code" style='word-wrap:break-word; background:none; border:none; padding:0px; overflow:auto; margin:0px; font-family:"Courier New"!important'>
     <pre style='margin-top:1em; margin-bottom:1em; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(245,245,245); border:1px dashed rgb(204,204,204); padding:7px; font-family:"Courier New"!important'><span style="color:rgb(128,0,0); line-height:1.5!important"><strong>1</strong></span>，<span style="color:rgb(0,0,255); line-height:1.5!important">where</span> UserID <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> {CurrentUserID}
<span style="color:rgb(128,0,0); line-height:1.5!important"><strong>2</strong></span>，<span style="color:rgb(0,0,255); line-height:1.5!important">where</span> UserID <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> {CurrentUserID}  <span style="color:rgb(128,128,128); line-height:1.5!important">or</span> {CurrentUserID} <span style="color:rgb(128,128,128); line-height:1.5!important">in</span> (领导)
<span style="color:rgb(128,0,0); line-height:1.5!important"><strong>3</strong></span>，<span style="color:rgb(0,0,255); line-height:1.5!important">where</span> UserID <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> {CurrentUserID}  <span style="color:rgb(128,128,128); line-height:1.5!important">or</span> ({CurrentUserID} <span style="color:rgb(128,128,128); line-height:1.5!important">in</span> (销售经理)  <span style="color:rgb(128,128,128); line-height:1.5!important">and</span> 销售金额 <span style="color:rgb(128,128,128); line-height:1.5!important">&gt;</span> <span style="color:rgb(128,0,0); line-height:1.5!important"><strong>100000</strong></span>)</pre>
    </div>
    <blockquote style="background:none rgb(252,254,197); border:1px solid rgb(187,187,187); padding:5px 10px 5px 20px; margin:10px 0px; line-height:1.3; word-wrap:break-word; font-family:verdana; font-size:14px">
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:13px">
       这些一个一个的"条件"，本文简单理解为一个【数据规则】，通常会与原来我们前台的业务过滤条件合并再检索出数据。
       <br/>
      </span>
     </p>
    </blockquote>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      这是一种最直接的实现方式，在【资源】上面加一个【数据规则】（比如上面的三点）。这样设计就是
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      <span style="color:rgb(255,0,0)">
       【资源】 - 【数据规则】
      </span>
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      我又觉得不同的人应该对应不同的规则，那么也可以理解为，一个用户对应不同的角色，每一个角色有不一样的【数据规则】，那么设计就变成
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px; color:rgb(255,0,0)">
      【资源】 - 【主体】 - 【数据规则】
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      根据提供者的不同，准备不同的权限应对策略。
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      这里可以简单地介绍一下，
     </span>
     <span style="font-size:13px">
      这个方案至少需要2张表，一个是  【资源，主体，规则关系表】、一个是【数据规则表】
     </span>
    </p>
    <blockquote style="background:none rgb(252,254,197); border:1px solid rgb(187,187,187); padding:5px 10px 5px 20px; margin:10px 0px; line-height:1.3; word-wrap:break-word; font-family:verdana; font-size:14px">
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      关系表不能直接保存角色，因为你不确定什么时候业务需要按照【部门】或者【分公司】来定义数据规则
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      于是可以用  Master、MasterKey  类似这样的两个字段来确定一个【主体】
     </p>
    </blockquote>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      用XML方式的话是这样配置的(放在数据库也类似)：
     </span>
    </p>
    <div class="cnblogs_code" style='word-wrap:break-word; background:none; border:none; padding:0px; overflow:auto; margin:0px; font-family:"Courier New"!important'>
     <pre style='margin-top:1em; margin-bottom:1em; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(245,245,245); border:1px dashed rgb(204,204,204); padding:7px; font-family:"Courier New"!important'><span style="color:rgb(0,0,255); line-height:1.5!important">&lt;?</span><span style="color:rgb(255,0,255); line-height:1.5!important">xml version="1.0" encoding="utf-8"</span><span style="color:rgb(0,0,255); line-height:1.5!important">?&gt;</span>
<span style="color:rgb(0,0,255); line-height:1.5!important">&lt;</span><span style="color:rgb(128,0,0); line-height:1.5!important">settings</span><span style="color:rgb(0,0,255); line-height:1.5!important">&gt;</span>
  <span style="color:rgb(0,0,255); line-height:1.5!important">&lt;</span><span style="color:rgb(128,0,0); line-height:1.5!important">rule </span><span style="color:rgb(255,0,0); line-height:1.5!important">view</span><span style="color:rgb(0,0,255); line-height:1.5!important">="订单"</span><span style="color:rgb(255,0,0); line-height:1.5!important"> role</span><span style="color:rgb(0,0,255); line-height:1.5!important">="销售人员"</span><span style="color:rgb(0,0,255); line-height:1.5!important">&gt;</span>
      销售员 = {CurrentUserID}
  <span style="color:rgb(0,0,255); line-height:1.5!important">&lt;/</span><span style="color:rgb(128,0,0); line-height:1.5!important">rule</span><span style="color:rgb(0,0,255); line-height:1.5!important">&gt;</span>
  <span style="color:rgb(0,0,255); line-height:1.5!important">&lt;</span><span style="color:rgb(128,0,0); line-height:1.5!important">rule </span><span style="color:rgb(255,0,0); line-height:1.5!important">view</span><span style="color:rgb(0,0,255); line-height:1.5!important">="订单"</span><span style="color:rgb(255,0,0); line-height:1.5!important"> role</span><span style="color:rgb(0,0,255); line-height:1.5!important">="总销售经理"</span><span style="color:rgb(0,0,255); line-height:1.5!important">&gt;</span>
     销售金额 &gt; 100000
  <span style="color:rgb(0,0,255); line-height:1.5!important">&lt;/</span><span style="color:rgb(128,0,0); line-height:1.5!important">rule</span><span style="color:rgb(0,0,255); line-height:1.5!important">&gt;</span>
  <span style="color:rgb(0,0,255); line-height:1.5!important">&lt;</span><span style="color:rgb(128,0,0); line-height:1.5!important">rule </span><span style="color:rgb(255,0,0); line-height:1.5!important">view</span><span style="color:rgb(0,0,255); line-height:1.5!important">="订单"</span><span style="color:rgb(255,0,0); line-height:1.5!important"> role</span><span style="color:rgb(0,0,255); line-height:1.5!important">="区域销售经理"</span><span style="color:rgb(0,0,255); line-height:1.5!important">&gt;</span>
    销售金额 &gt; 100000  and 区域 = {当前用户所属区域}
  <span style="color:rgb(0,0,255); line-height:1.5!important">&lt;/</span><span style="color:rgb(128,0,0); line-height:1.5!important">rule</span><span style="color:rgb(0,0,255); line-height:1.5!important">&gt;</span>
<span style="color:rgb(0,0,255); line-height:1.5!important">&lt;/</span><span style="color:rgb(128,0,0); line-height:1.5!important">settings</span><span style="color:rgb(0,0,255); line-height:1.5!important">&gt;</span></pre>
    </div>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      对于这种方式有兴趣的朋友也可以试一下，两种方式的【数据规则】是一样的，但是
     </span>
     <span style="font-size:13px">
      本文没有采用第二种设计方式，因为它多了一层处理逻辑，我以为应该设计越简单越好，
     </span>
     <span style="font-size:13px">
      就采用第一种方式：
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px; color:rgb(255,0,0)">
      【资源】 - 【数据规则】
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      当然，上面是用SQL的方式来确定条件规则的，我们当然不会这么做。SQL虽然灵活，但是我们很难去维护，也不知道SQL在我们的界面UI上面如何体现。难不成直接用一个文本框来显示。这样对应一个开发人员来说不是问题，可是对应系统管理员，很容易出问题。
      <span style="color:rgb(255,0,0)">
       所以我们需要有另一方式来确定这一规则，并最终可以转换成我们的SQL语句。
      </span>
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      <span style="color:rgb(255,0,0)">
       我们的设计关键在于如何规范好这些【数据规则】
      </span>
      ，这个规则必须是对前端友好的，而且是对后台友好的，JSON显然是很好的方式。
     </span>
    </p>
    <blockquote style="background:none rgb(252,254,197); border:1px solid rgb(187,187,187); padding:5px 10px 5px 20px; margin:10px 0px; line-height:1.3; word-wrap:break-word; font-family:verdana; font-size:14px">
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      规则说明：
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      1，数据权限规则总是：｛属性 条件 允许值｝
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      2，数据权限规则可以合并。比如 （ {当前用户 属于 销售人员} and {订单销售员 等于  当前用户} )   Or {当前用户  属于 销售经理}
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="color:rgb(255,0,0)">
       3，最终我们会用JSON格式
      </span>
     </p>
    </blockquote>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      在检索数据时会先判断有没有注册了某某【资源】的【条件规则】，如果有，那么加载这个【条件规则】并合并到我们前台的【搜索条件】（你的业务界面应该有一个搜索框吧）
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      如下图定义了客户信息的搜索框，我们搜索客户ID包括AN，我们组织成的规则将会是：
     </span>
    </p>
    <blockquote style="background:none rgb(252,254,197); border:1px solid rgb(187,187,187); padding:5px 10px 5px 20px; margin:10px 0px; line-height:1.3; word-wrap:break-word; font-family:verdana; font-size:14px">
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      {"rules":[{"field":"CustomerID","op":"like","value":"AN","type":"string"}],"op":"and"}
     </p>
    </blockquote>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/3eb21c7ee295d45509ca853833b5a599.png" style="border:1px solid rgb(170,170,170); max-width:900px; padding:6px"/>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      为了更好地理解【数据规则】，这里介绍一下【通用查询机制】
     </span>
    </p>
    <h3 style="background-color:rgb(127,143,177); color:white; padding:3px 3px 3px 8px; font-size:21px; line-height:1.5; margin:10px 0px; font-family:verdana">
     <span style="font-size:13px">
      <a name="label3" style="color:rgb(91,157,202); padding:1px 2px" target="_blank">
      </a>
      【通用查询机制】
     </span>
    </h3>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      权限控制总离不开一些条件的限制(比如查看当前部门的单据)，如果没有完善的通用查询规则机制，那么在做权限条件过滤的时候你会觉得很别扭。这里介绍一个通用查询方案，然后再介绍如何实现【数据规则】。
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      早些时候我写过一篇关于ligerGrid结合.net设计通用处理类的文章《
      <a href="http://www.cnblogs.com/leoxie2011/archive/2011/05/28/2061406.html" rel="nofollow noopener noreferrer" style="color:rgb(91,157,202); text-decoration:none; padding:1px 2px" target="_blank">
       jQuery liger ui ligerGrid 打造通用的分页排序查询表格(提供下载)
      </a>
      》。里面提到的过滤信息是直接的SQL语句。这是不可靠，而且不安全的。
     </span>
     <br/>
     <span style="font-size:13px">
      在前端传输给后台的过滤信息不应该是直接的SQL，而应该是一组过滤规则。在ligerui V1.1.8 已经加入了一个条件过滤器插件，这个插件组成的规则数据才是我受推荐的：
     </span>
     <br/>
     <span style="font-size:13px">
      比如如下
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
    </p>
    <blockquote style="background:none rgb(252,254,197); border:1px solid rgb(187,187,187); padding:5px 10px 5px 20px; margin:10px 0px; line-height:1.3; word-wrap:break-word; font-family:verdana; font-size:14px">
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:10px">
       {"rules":
       <br/>
       [
       <br/>
       {"field":"OrderDate","op":"less","value":"2012-01-01"},
       <br/>
       {"field":"CustomerID","op":"equal","value":"VINET"}
       <br/>
       ]
       <br/>
       ,"op":"and"}
       <br/>
      </span>
     </p>
    </blockquote>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
    </p>
    <blockquote style="background:none rgb(252,254,197); border:1px solid rgb(187,187,187); padding:5px 10px 5px 20px; margin:10px 0px; line-height:1.3; word-wrap:break-word; font-family:verdana; font-size:14px">
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:10px">
       规则描述：
       <br/>
       查找顾客VINET所有订单时间小于2011-01-01的单据
      </span>
     </p>
    </blockquote>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <br/>
     <span style="font-size:13px">
      这样的数据是安全的，而且是通用的(你甚至可以再加一个OR子查询)。无论是在前端还是后台，无论你使用什么样的组件，都可以很好地利用。
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      通用后台的翻译，就可以生成这样SQL的参数：
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
    </p>
    <div class="cnblogs_code" style='word-wrap:break-word; background:none; border:none; padding:0px; overflow:auto; margin:0px; font-family:"Courier New"!important'>
     <pre style='margin-top:1em; margin-bottom:1em; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(245,245,245); border:1px dashed rgb(204,204,204); padding:7px; font-family:"Courier New"!important'><span style="color:rgb(0,0,255); line-height:1.5!important">Text</span>:
(<span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">OrderDate</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(128,128,128); line-height:1.5!important">&lt;</span> <span style="color:rgb(0,128,0); line-height:1.5!important">@p1</span> <span style="color:rgb(128,128,128); line-height:1.5!important">and</span> <span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">CustomerID</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> <span style="color:rgb(0,128,0); line-height:1.5!important">@p2</span>)
Parameters:
p1:<span style="color:rgb(128,0,0); line-height:1.5!important"><strong>2012</strong></span><span style="color:rgb(128,128,128); line-height:1.5!important">-</span><span style="color:rgb(128,0,0); line-height:1.5!important"><strong>01</strong></span><span style="color:rgb(128,128,128); line-height:1.5!important">-</span><span style="color:rgb(128,0,0); line-height:1.5!important"><strong>01</strong></span>
p2:VINET</pre>
    </div>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      下面来点复杂的：查找 顾客VINET或者TOMSP，所有订单时间小于2011-01-01的单据
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
    </p>
    <blockquote style="background:none rgb(252,254,197); border:1px solid rgb(187,187,187); padding:5px 10px 5px 20px; margin:10px 0px; line-height:1.3; word-wrap:break-word; font-family:verdana; font-size:14px">
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:10px">
       {
       <!-- -->
       <br/>
       "rules":[{"field":"OrderDate","op":"less","value":"2012-01-01"}],
       <br/>
       "groups":[
       <br/>
       {"rules":[{"field":"CustomerID","op":"equal","value":"VINET"}, {"field":"CustomerID","op":"equal","value":"TOMSP"}],"op":"or"}
       <br/>
       ],
       <br/>
       "op":"and"
       <br/>
       }
       <br/>
      </span>
     </p>
    </blockquote>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      翻译结果：
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
    </p>
    <div class="cnblogs_code" style='word-wrap:break-word; background:none; border:none; padding:0px; overflow:auto; margin:0px; font-family:"Courier New"!important'>
     <pre style='margin-top:1em; margin-bottom:1em; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(245,245,245); border:1px dashed rgb(204,204,204); padding:7px; font-family:"Courier New"!important'><span style="color:rgb(0,0,255); line-height:1.5!important">Text</span>:(<span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">OrderDate</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(128,128,128); line-height:1.5!important">&lt;</span> <span style="color:rgb(0,128,0); line-height:1.5!important">@p1</span> <span style="color:rgb(128,128,128); line-height:1.5!important">and</span> (<span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">CustomerID</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> <span style="color:rgb(0,128,0); line-height:1.5!important">@p2</span> <span style="color:rgb(128,128,128); line-height:1.5!important">or</span> <span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">CustomerID</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> <span style="color:rgb(0,128,0); line-height:1.5!important">@p3</span>))
Parameters:
p1:<span style="color:rgb(128,0,0); line-height:1.5!important"><strong>2012</strong></span><span style="color:rgb(128,128,128); line-height:1.5!important">-</span><span style="color:rgb(128,0,0); line-height:1.5!important"><strong>01</strong></span><span style="color:rgb(128,128,128); line-height:1.5!important">-</span><span style="color:rgb(128,0,0); line-height:1.5!important"><strong>01</strong></span>
p2:VINET
p3:TOMSP</pre>
    </div>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      <span style="color:rgb(255,0,0)">
       这个过滤规则分为三个部分：【分组】、【规则】(字段、值、操作符)、【操作符】(and or)
      </span>
      ，而自身就是一个分组。
     </span>
     <br/>
     <span style="font-size:13px">
      这种简单的结构就可以满足全部的情况。
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      当然，上面提到的这些条件都是在前台定义(可能是用户在搜索框自己输入的)的，而在后台，我们可能会定义一下【隐藏条件】，比如说 【员工只能查看自己的】，要怎么做呢，其实很简单，只需要在后台接收到这个过滤条件(前台toJSON，后台解析JSON)以后，再加上一个过滤规则(隐藏条件)：
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
    </p>
    <blockquote style="background:none rgb(252,254,197); border:1px solid rgb(187,187,187); padding:5px 10px 5px 20px; margin:10px 0px; line-height:1.3; word-wrap:break-word; font-family:verdana; font-size:14px">
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:10px">
       {field:'EmployeeID',op:'equal',value:5}
       <br/>
      </span>
     </p>
    </blockquote>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      可以将原来的过滤规则当做一个分组加入进行：
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
    </p>
    <blockquote style="background:none rgb(252,254,197); border:1px solid rgb(187,187,187); padding:5px 10px 5px 20px; margin:10px 0px; line-height:1.3; word-wrap:break-word; font-family:verdana; font-size:14px">
     <p style="margin:10px auto; line-height:18px; font-size:12px">
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      {op:'and',groups:[
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      {"rules":[{"field":"OrderDate","op":"less","value":"2012-01-01"}],
      <br/>
      "groups":[
      <br/>
      {"rules":[{"field":"CustomerID","op":"equal","value":"VINET"},{"field":"CustomerID","op":"equal","value":"TOMSP"}],"op":"or"}
      <br/>
      ],"op":"and"}
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      ],rules:[{field:'EmployeeID',op:'equal',value:5}]
      <br/>
      }
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:10px">
       <br/>
      </span>
     </p>
    </blockquote>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      翻译如下：
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
    </p>
    <div class="cnblogs_code" style='word-wrap:break-word; background:none; border:none; padding:0px; overflow:auto; margin:0px; font-family:"Courier New"!important'>
     <pre style='margin-top:1em; margin-bottom:1em; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(245,245,245); border:1px dashed rgb(204,204,204); padding:7px; font-family:"Courier New"!important'><span style="color:rgb(0,0,255); line-height:1.5!important">Text</span>:
(<span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">EmployeeID</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> <span style="color:rgb(0,128,0); line-height:1.5!important">@p1</span> <span style="color:rgb(128,128,128); line-height:1.5!important">and</span> (<span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">OrderDate</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(128,128,128); line-height:1.5!important">&lt;</span> <span style="color:rgb(0,128,0); line-height:1.5!important">@p2</span> <span style="color:rgb(128,128,128); line-height:1.5!important">and</span> (<span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">CustomerID</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> <span style="color:rgb(0,128,0); line-height:1.5!important">@p3</span> <span style="color:rgb(128,128,128); line-height:1.5!important">or</span> <span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">CustomerID</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> <span style="color:rgb(0,128,0); line-height:1.5!important">@p4</span>)))
Parameters:
p1:<span style="color:rgb(128,0,0); line-height:1.5!important"><strong>5</strong></span>
p2:<span style="color:rgb(128,0,0); line-height:1.5!important"><strong>2012</strong></span><span style="color:rgb(128,128,128); line-height:1.5!important">-</span><span style="color:rgb(128,0,0); line-height:1.5!important"><strong>01</strong></span><span style="color:rgb(128,128,128); line-height:1.5!important">-</span><span style="color:rgb(128,0,0); line-height:1.5!important"><strong>01</strong></span>
p3:VINET
p4:TOMSP</pre>
    </div>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      <br/>
      <br/>
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      这样的【条件规则】才是我们想要的，不仅在前端可以很好地解析，
     </span>
     <span style="font-size:13px">
      也可以在后台进行处理。在后台我们会定义跟这种数据结构对应的类，那么再定义一个翻译成SQL的类：
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/30f9b293642891186a83af917a3536b0.png" style="border:1px solid rgb(170,170,170); max-width:900px; padding:6px"/>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      <br/>
     </span>
    </p>
    <h3 style="background-color:rgb(127,143,177); color:white; padding:3px 3px 3px 8px; font-size:21px; line-height:1.5; margin:10px 0px; font-family:verdana">
     <a name="label4" style="color:rgb(91,157,202); padding:1px 2px" target="_blank">
     </a>
     数据权限规则
    </h3>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      说了这些，可以开始介绍如何实现【数据规则】了：
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      上面提到的【隐藏条件】，就是我介绍的【数据规则】
     </span>
     <br/>
     <span style="font-size:13px">
      试想一些，这样 前台的过滤规则，再加上我们之间定义好的 【数据权限】控制 过滤条件。不就达到目的了吗。
     </span>
     <br/>
     <span style="font-size:13px">
      先看看我们在数据库里保存的这些【数据规则】：
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/bbcbd264136c8f543a6cde1274a310e9.png" style="border:1px solid rgb(170,170,170); max-width:900px; padding:12px"/>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     看不明白？那来个清楚一点的：
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/2c9917716c900ff7530db03c913e88cf.png" style="border:1px solid rgb(170,170,170); max-width:900px; padding:6px"/>
    </p>
    <blockquote style="background:none rgb(252,254,197); border:1px solid rgb(187,187,187); padding:5px 10px 5px 20px; margin:10px 0px; line-height:1.3; word-wrap:break-word; font-family:verdana; font-size:14px">
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:10px">
       规则描述
      </span>
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:10px">
       订单：【订单管理员和演示角色可以查看所有的】，【订单查看员】只能查看自己的
      </span>
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:10px">
       产品：【基础信息录入员和演示角色可以查看所有的】，【供应商】只能查看自己的
      </span>
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:10px">
       {CurrentEmployeeID}表示当前的员工。
      </span>
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:10px">
       实质上，我们还可以根据当前用户信息定义需要的参数，比如：
      </span>
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:10px">
       {CurrentUserID} 当前用户Id ，对应表【CF_User】
      </span>
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:10px">
       {CurrentRoleID} 当前角色Id ，对应表 【CF_Role】
      </span>
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:10px">
       {CurrentDeptID} 当前用户部门Id，对应表【CF_Department】
      </span>
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:10px">
       {CurrentEmployeeID} 当前用户员工Id，对应表【Employees】(CF_User.EmployeeID)
      </span>
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:10px">
       {CurrentSupplierID} 当前用户供应商Id，对应表【Suppliers】(CF_User.SupplierID)
      </span>
     </p>
    </blockquote>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     在数据库中我们直接保存这些用户参数，在“翻译”规则成为SQL时，会替换掉：
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/ecef1888e5de623687f062767af05be1.png" style="border:1px solid rgb(170,170,170); max-width:900px; padding:6px"/>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      比如查看订单，我们得到的SQL，可能是这样的：
     </span>
    </p>
    <div class="cnblogs_code" style='word-wrap:break-word; background:none; border:none; padding:0px; overflow:auto; margin:0px; font-family:"Courier New"!important'>
     <pre style='margin-top:1em; margin-bottom:1em; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(245,245,245); border:1px dashed rgb(204,204,204); padding:7px; font-family:"Courier New"!important'><span style="color:rgb(0,0,255); line-height:1.5!important">Text</span>:     <span style="color:rgb(0,0,255); line-height:1.5!important">SELECT</span> <span style="color:rgb(128,128,128); line-height:1.5!important">*</span> <span style="color:rgb(0,0,255); line-height:1.5!important">FROM</span> (<span style="color:rgb(0,0,255); line-height:1.5!important">SELECT</span> <span style="color:rgb(0,0,255); line-height:1.5!important">TOP</span> <span style="color:rgb(128,0,0); line-height:1.5!important"><strong>20</strong></span> <span style="color:rgb(128,128,128); line-height:1.5!important">*</span> <span style="color:rgb(0,0,255); line-height:1.5!important">FROM</span> (<span style="color:rgb(0,0,255); line-height:1.5!important">SELECT</span> <span style="color:rgb(0,0,255); line-height:1.5!important">TOP</span> <span style="color:rgb(128,0,0); line-height:1.5!important"><strong>40</strong></span> <span style="color:rgb(128,128,128); line-height:1.5!important">*</span> <span style="color:rgb(0,0,255); line-height:1.5!important">FROM</span> <span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">Orders</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(0,0,255); line-height:1.5!important">WHERE</span> ( <span style="color:rgb(128,0,0); line-height:1.5!important"><strong>1</strong></span><span style="color:rgb(128,128,128); line-height:1.5!important">=</span><span style="color:rgb(128,0,0); line-height:1.5!important"><strong>1</strong></span>  <span style="color:rgb(128,128,128); line-height:1.5!important">and</span> ((<span style="color:rgb(0,128,0); line-height:1.5!important">@p1</span> <span style="color:rgb(128,128,128); line-height:1.5!important">in</span> (<span style="color:rgb(0,128,0); line-height:1.5!important">@p2</span>,<span style="color:rgb(0,128,0); line-height:1.5!important">@p3</span>)) <span style="color:rgb(128,128,128); line-height:1.5!important">or</span> (<span style="color:rgb(0,128,0); line-height:1.5!important">@p4</span> <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> <span style="color:rgb(0,128,0); line-height:1.5!important">@p5</span> <span style="color:rgb(128,128,128); line-height:1.5!important">and</span> <span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">EmployeeID</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> <span style="color:rgb(0,128,0); line-height:1.5!important">@p6</span>))) <span style="color:rgb(0,0,255); line-height:1.5!important">ORDER</span> <span style="color:rgb(0,0,255); line-height:1.5!important">BY</span> OrderID <span style="color:rgb(0,0,255); line-height:1.5!important">ASC</span>) <span style="color:rgb(0,0,255); line-height:1.5!important">AS</span> tmptableinner <span style="color:rgb(0,0,255); line-height:1.5!important">ORDER</span> <span style="color:rgb(0,0,255); line-height:1.5!important">BY</span> OrderID <span style="color:rgb(0,0,255); line-height:1.5!important">DESC</span>) <span style="color:rgb(0,0,255); line-height:1.5!important">AS</span> tmptableouter <span style="color:rgb(0,0,255); line-height:1.5!important">ORDER</span> <span style="color:rgb(0,0,255); line-height:1.5!important">BY</span> OrderID <span style="color:rgb(0,0,255); line-height:1.5!important">ASC</span>     
Parameters:
<span style="color:rgb(0,128,0); line-height:1.5!important">@p1</span><span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">Int32</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> <span style="color:rgb(128,0,0); line-height:1.5!important"><strong>7</strong></span>
<span style="color:rgb(0,128,0); line-height:1.5!important">@p2</span><span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">Int32</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> <span style="color:rgb(128,0,0); line-height:1.5!important"><strong>2</strong></span>
<span style="color:rgb(0,128,0); line-height:1.5!important">@p3</span><span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">Int32</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> <span style="color:rgb(128,0,0); line-height:1.5!important"><strong>6</strong></span>
<span style="color:rgb(0,128,0); line-height:1.5!important">@p4</span><span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">Int32</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> <span style="color:rgb(128,0,0); line-height:1.5!important"><strong>7</strong></span>
<span style="color:rgb(0,128,0); line-height:1.5!important">@p5</span><span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">Int32</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> <span style="color:rgb(128,0,0); line-height:1.5!important"><strong>7</strong></span>
<span style="color:rgb(0,128,0); line-height:1.5!important">@p6</span><span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">Int32</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> <span style="color:rgb(128,0,0); line-height:1.5!important"><strong>1</strong></span></pre>
    </div>
    <blockquote style="background:none rgb(252,254,197); border:1px solid rgb(187,187,187); padding:5px 10px 5px 20px; margin:10px 0px; line-height:1.3; word-wrap:break-word; font-family:verdana; font-size:14px">
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:13px">
       {CurrentRuleID} 替换为 7
      </span>
     </p>
     <p style="margin:10px auto; line-height:18px; font-size:12px">
      <span style="font-size:10px">
       {CurrentEmployeeID} 替换为1
      </span>
     </p>
    </blockquote>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      下图是我们设计【数据权限】的界面，可以选择所有的字段，包括几个用户信息：
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/4a342cb339d31961722eba0b127012cd.png" style="border:1px solid rgb(170,170,170); max-width:900px; padding:6px"/>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      这些字段不仅仅只是在文本框中输入值，那么可以自定义数据来源：
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
    </p>
    <div class="cnblogs_code" style='word-wrap:break-word; background:none; border:none; padding:0px; overflow:auto; margin:0px; font-family:"Courier New"!important'>
     <pre style='margin-top:1em; margin-bottom:1em; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(245,245,245); border:1px dashed rgb(204,204,204); padding:7px; font-family:"Courier New"!important'><span style="color:rgb(255,0,255); line-height:1.5!important">var</span> fieldEditors <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> {};
fieldEditors<span style="color:rgb(255,0,0); line-height:1.5!important">[</span><span style="color:rgb(255,0,0); line-height:1.5!important">'Orders'</span><span style="color:rgb(255,0,0); line-height:1.5!important">]</span> <span style="color:rgb(128,128,128); line-height:1.5!important">=</span> {
    <span style="color:rgb(255,0,0); line-height:1.5!important">'</span><span style="color:rgb(255,0,0); line-height:1.5!important">ShipCity</span><span style="color:rgb(255,0,0); line-height:1.5!important">'</span>: { type: <span style="color:rgb(255,0,0); line-height:1.5!important">'</span><span style="color:rgb(255,0,0); line-height:1.5!important">combobox</span><span style="color:rgb(255,0,0); line-height:1.5!important">'</span>, 
        options: {
            width: <span style="color:rgb(128,0,0); line-height:1.5!important"><strong>200</strong></span>,
            url: "..<span style="color:rgb(128,128,128); line-height:1.5!important">/</span>handler<span style="color:rgb(128,128,128); line-height:1.5!important">/</span><span style="color:rgb(0,0,255); line-height:1.5!important">select</span>.ashx?<span style="color:rgb(0,0,255); line-height:1.5!important">view</span><span style="color:rgb(128,128,128); line-height:1.5!important">=</span>Orders<span style="color:rgb(128,128,128); line-height:1.5!important">&amp;</span>idfield<span style="color:rgb(128,128,128); line-height:1.5!important">=</span>ShipCity<span style="color:rgb(128,128,128); line-height:1.5!important">&amp;</span>textfield<span style="color:rgb(128,128,128); line-height:1.5!important">=</span>ShipCity<span style="color:rgb(128,128,128); line-height:1.5!important">&amp;</span><span style="color:rgb(0,0,255); line-height:1.5!important">distinct</span><span style="color:rgb(128,128,128); line-height:1.5!important">=</span>true"
        }
    }
};</pre>
    </div>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      效果界面：
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/8cfed97f54e04b18e5044abf7d151d5c.png" style="border:1px solid rgb(170,170,170); max-width:900px; padding:6px"/>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      <br/>
     </span>
    </p>
    <h3 style="background-color:rgb(127,143,177); color:white; padding:3px 3px 3px 8px; font-size:21px; line-height:1.5; margin:10px 0px; font-family:verdana">
     <a name="label5" style="color:rgb(91,157,202); padding:1px 2px" target="_blank">
     </a>
     实际应用
    </h3>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      既然是数据权限控制，如果有一个统一的数据接收入口，我们倒是可以利用这个入口做一些工作。
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      比如【
      <a href="http://www.cnblogs.com/leoxie2011/archive/2012/03/18/2400367.html" rel="nofollow noopener noreferrer" style="color:rgb(91,157,202); text-decoration:none; padding:1px 2px" target="_blank">
       ligerRM权限管理系统
      </a>
      】统一使用 grid.ashx 这个数据处理程序作为列表数据的接收入口。
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      有了统一的接口，方便做权限的控制，使用过 ligerGrid Javascript表格，或者类似插件的朋友，应该比较清楚服务器的交互原理。
     </span>
     <br/>
     <span style="font-size:13px">
      在grid.ashx中，我们会通过
     </span>
     <br/>
     <span style="font-size:13px; color:rgb(255,0,0)">
      【视图/表名 】、 【排序信息】、【分页信息】、【过滤信息】
     </span>
     <br/>
     <span style="font-size:13px">
      这几个指标来获取指定的数据。
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <br/>
     <span style="font-size:13px">
      而在实际的业务中，可能会引入权限的控制。比如某某【资源】，只能由当前用户自身才能查看，或者只能由当前用户部门及上级部门才能查看。对于这些控制，我们采用对这些可能做权限控制的【资源】注册一组【条件规则】的方式来进行。
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/06c30c297c4e7f6e919a1ff16631becb.png" style="border:1px solid rgb(170,170,170); max-width:900px; padding:6px"/>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:10px">
      我们将找到view定义好的【数据权限规则】，然后和用户在前台搜索框输入的【搜索规则】合并：
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/2641373bd4a3966d9500b33905366282.png" style="border:1px solid rgb(170,170,170); max-width:900px; padding:6px"/>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <span style="font-size:13px">
      上面的代码就是数据条件合并的例子，这样便得到了我们最终需要的 过滤规则。
     </span>
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     <a name="label6" style="color:rgb(91,157,202); padding:1px 2px" target="_blank">
     </a>
    </p>
    <h3 style="background-color:rgb(127,143,177); color:white; padding:3px 3px 3px 8px; font-size:21px; line-height:1.5; margin:10px 0px; font-family:verdana">
     结语
    </h3>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     本文提出了数据权限的一种实现思路，只是本人在做一个web应用时构思的方案，谈不上规范，欢迎提出你的建议意见。
    </p>
    <p style="margin:10px auto; line-height:18px; font-family:verdana">
     可以在
     <a href="http://case.ligerui.com/" rel="nofollow noopener noreferrer" style="color:rgb(91,157,202); text-decoration:none; padding:1px 2px" target="_blank">
      http://case.ligerui.com
     </a>
     体验实际的应用效果。
    </p>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f776f746135303337:2f61727469636c652f64657461696c732f3738393637393231" class_="artid" style="display:none">
 </p>
</div>
