---
layout: post
title: "微信小程序群功能开发-前端篇"
date: 2025-01-12 16:36:34 +0800
description: "我们在一些微信群中看到过这样的小程序分享卡片：当你点进去后，会看到一个列表，里面有其他群成员的头像和"
keywords: "小程序 群聊"
categories: ['微信小程序']
tags: ['无标签']
artid: "79724201"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=79724201
    alt: "微信小程序群功能开发-前端篇"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微信小程序群功能开发-前端篇
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     我们在一些微信群中看到过这样的
     <a class="wrap external" href="https://link.zhihu.com/?target=http%3A//www.wxapp-union.com/" rel="nofollow" style="color:inherit;border-bottom:1px solid rgba(68,68,68,.721569);">
      小程序
     </a>
     分享卡片：当你点进去后，会看到一个列表，里面有其他群成员的头像和相关信息。比如《王者荣耀群排行》，但是段位信息是腾讯私有的接口，我们只能拿到头像和昵称等基础信息。
    </p>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     下面我将实现小程序端的从转发到用户点击卡片后获取信息的这个过程。
    </p>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/fc45bba187c2b760f68eab64bbdba297.png">
      <br/>
     </img>
    </p>
    基本思路
    <h3 style="margin-top:1em;margin-bottom:1em;font-size:18px;line-height:inherit;font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;color:rgb(26,26,26);white-space:pre-wrap;background-color:rgb(255,255,255);">
     开启
    </h3>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     首先我们要调用wx.showShareMenu进行设置，来开启是否使用带shareTicket的转发，这个shareTicket是开发群功能的关键:
    </p>
    <div class="highlight" style="color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     <pre style="margin-top:1em;margin-bottom:1em;padding:10px;font-family:Menlo, Monaco, Consolas, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:14px;background:rgb(246,246,246);"><code class="language-text" style="margin:0px;font-family:Menlo, Monaco, Consolas, 'Andale Mono', 'lucida console', 'Courier New', monospace;background-color:rgb(246,246,246);">wx.showShareMenu({
   withShareTicket: true,
})
</code></pre>
    </div>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     我一般将其放在页面onShow中。
    </p>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     <br/>
    </p>
    <h3 style="margin-top:1em;margin-bottom:1em;font-size:18px;line-height:inherit;font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;color:rgb(26,26,26);white-space:pre-wrap;background-color:rgb(255,255,255);">
     触发转发事件
    </h3>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     如果要自定义转发按钮而不是有默认右上角的转发按钮，需要在页面中放置一个open-type="share"的button组件:
    </p>
    <div class="highlight" style="color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     <pre style="margin-top:1em;margin-bottom:1em;padding:10px;font-family:Menlo, Monaco, Consolas, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:14px;background:rgb(246,246,246);"><code class="language-text" style="margin:0px;font-family:Menlo, Monaco, Consolas, 'Andale Mono', 'lucida console', 'Courier New', monospace;background-color:rgb(246,246,246);">&lt;button open-type="share"&gt;share&lt;/button&gt;
</code></pre>
    </div>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     <br/>
    </p>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     接下来在页面中设置分享函数onShareAppMessage:
    </p>
    <div class="highlight" style="color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     <pre style="margin-top:1em;margin-bottom:1em;padding:10px;font-family:Menlo, Monaco, Consolas, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:14px;background:rgb(246,246,246);"><code class="language-text" style="margin:0px;font-family:Menlo, Monaco, Consolas, 'Andale Mono', 'lucida console', 'Courier New', monospace;background-color:rgb(246,246,246);">onShareAppMessage: function (res) {
if (res.from === 'button') {
// 来自页面内转发按钮
       console.log(res.target)
}
return {
       title: '自定义转发标题',
       path: '/pages/test/test?id=123',
       success: function (res) {
// 转发成功
           console.log(res)
// 只有转发到群聊中打开才可以获取到 shareTickets 返回值，单聊没有 shareTickets
if (res.shareTickets &amp;&amp; res.shareTickets.length&gt;0) {
               app.getShareInfo(res.shareTickets[0])
}
},
       fail: function (res) {
// 转发失败
           console.log(res)
}
}
}
</code></pre>
    </div>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     现在就可以进行转发了，在群聊中将会看到此次分享的小程序消息卡片。每个shareTicket对应每个群并且单聊不会有该值。这里只选择一个转发，所以直接取第一个。至于app.getShareInfo是用来获取群id(openGId)的函数，我们放到后面介绍。
    </p>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     <br/>
    </p>
    <h3 style="margin-top:1em;margin-bottom:1em;font-size:18px;line-height:inherit;font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;color:rgb(26,26,26);white-space:pre-wrap;background-color:rgb(255,255,255);">
     群成员点消息卡片
    </h3>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     当群成员点消息卡片进入小程序后，在app.js的onShow/onLaunch的options中可以获取到shareTicket，shareTicket每次都是不一样的，比分你分享的时候获取到的跟这里获取到的不是同一个，但是会对应同一个openGId。
    </p>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     <br/>
    </p>
    <h3 style="margin-top:1em;margin-bottom:1em;font-size:18px;line-height:inherit;font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;color:rgb(26,26,26);white-space:pre-wrap;background-color:rgb(255,255,255);">
     app.js:
    </h3>
    <div class="highlight" style="color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     <pre style="margin-top:1em;margin-bottom:1em;padding:10px;font-family:Menlo, Monaco, Consolas, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:14px;background:rgb(246,246,246);"><code class="language-text" style="margin:0px;font-family:Menlo, Monaco, Consolas, 'Andale Mono', 'lucida console', 'Courier New', monospace;background-color:rgb(246,246,246);">// 在onShow中获取转发信息shareTicket
onShow: function (options) {
   console.log(options)
let scene = options.scene

// 场景值是1044，带 shareTicket 的小程序消息卡片
if(scene == 1044) {
let shareTicket = options.shareTicket
// 这里的id根据自己的具体需求进行操作，也可以设置其他的
let id = options.query.id
this.getShareInfo(shareTicket)
}
},

// 获取加密信息encryptedData, iv
getShareInfo: function (shareTicket) {
const z = this
   wx.getShareInfo({
       shareTicket: shareTicket,
       success: function (res) {
           console.log(res)
let {encryptedData, iv} = res

if(encryptedData &amp;&amp; iv) {
               z.getDecodeEncryptedData(encryptedData, iv)
}
},
       fail: function (res) {
           console.log(res)
}
})
},

// 获取解密后的信息
getDecodeEncryptedData: function (encryptedData, iv) {
// 发送到后台解析
   wx.login({
       success: function(res) {
let code = res.code

// 下面只是演示代码
// post({
//     url:'https://www.example.com/controller/getDecodeEncryptedData'
//     data:{
//         code,
//         encryptedData,
//         iv,
//     }
// })
}
})
},
</code></pre>
    </div>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     <br/>
    </p>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     首先，我们通过wx.getShareInfo获取encryptedData和iv，然后将其传给后台进行解析。
    </p>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     在getDecodeEncryptedData中，当后台解析成功后，就会返回一个openGId。
    </p>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     此时就可以将群openGId与用户openid进行绑定了，这个绑定信息也是要保存到后台的。如果后台没有保存过头像昵称信息，此时也可以将用户头像和昵称一起保存到后台。
    </p>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     类似于下面这样的一个接口:
    </p>
    <div class="highlight" style="color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     <pre style="margin-top:1em;margin-bottom:1em;padding:10px;font-family:Menlo, Monaco, Consolas, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:14px;background:rgb(246,246,246);"><code class="language-text" style="margin:0px;font-family:Menlo, Monaco, Consolas, 'Andale Mono', 'lucida console', 'Courier New', monospace;background-color:rgb(246,246,246);">// 下面只是演示代码
post({
  url:'https://www.example.com/controller/bindGroupAndUser'
  data:{
      code,
      openGId
}
})
</code></pre>
    </div>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     其中的code调用wx.login获得，后台根据这个code能获取到openid。然后进行绑定。
    </p>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     然后根据自己的需求，可能还要一个保存用户基础信息和拉取群成员信息列表的接口。
    </p>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     基本思路就是这样，我将在另一篇文章中描述后端的相关处理。
    </p>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     <br/>
    </p>
    <h3 style="margin-top:1em;margin-bottom:1em;font-size:18px;line-height:inherit;font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;color:rgb(26,26,26);white-space:pre-wrap;background-color:rgb(255,255,255);">
     参考
    </h3>
    <ul style="padding-left:2em;margin-top:1em;margin-bottom:1em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     <li style="list-style-position:outside;">
      <a class="wrap external" href="https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fdebug%252Fwxadoc%252Fdev%252Fapi%252Fshare.html" rel="nofollow" style="color:inherit;border-bottom:1px solid rgba(68,68,68,.721569);">
       小程序开发文档-转发
      </a>
     </li>
     <li style="list-style-position:outside;">
      <a class="wrap external" href="https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fdebug%252Fwxadoc%252Fdev%252Fapi%252Fapi-login.html%2523wxchecksessionobject" rel="nofollow" style="color:inherit;border-bottom:1px solid rgba(68,68,68,.721569);">
       小程序登录
      </a>
     </li>
     <li style="list-style-position:outside;">
      <a class="wrap external" href="https://link.zhihu.com/?target=https%3A//link.jianshu.com/%3Ft%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fdebug%252Fwxadoc%252Fdev%252Fapi%252Fsignature.html" rel="nofollow" style="color:inherit;border-bottom:1px solid rgba(68,68,68,.721569);">
       用户数据的签名验证和加解密
      </a>
     </li>
    </ul>
    <p style="margin-bottom:.72em;color:rgb(26,26,26);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     <br/>
    </p>
    <blockquote style="padding-left:1em;margin-top:1em;margin-bottom:1em;color:rgb(133,144,166);border-left:4px solid rgb(211,211,211);font-family:'-apple-system', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space:pre-wrap;background-color:rgb(255,255,255);">
     <em>
      作者：tomfriwel
     </em>
     <br/>
     <em>
      链接：
      <a class="wrap external" href="https://link.zhihu.com/?target=http%3A//www.wxapp-union.com/portal.php%3Fmod%3Dview%26aid%3D3834" rel="nofollow" style="color:inherit;border-color:rgba(133,144,166,.721569) rgba(133,144,166,.721569) rgba(68,68,68,.721569);border-bottom-width:1px;border-bottom-style:solid;">
       微信小程序群功能开发-前端篇-实战教程-小程序社区-微信小程序-微信小程序开发社区-小程序开发论坛-微信小程序联盟
      </a>
     </em>
     <br/>
     <em>
      著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。
     </em>
    </blockquote>
   </div>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f726f6c616e31393933:2f61727469636c652f64657461696c732f3739373234323031" class_="artid" style="display:none">
 </p>
</div>


