---
layout: post
title: "uniapp对接腾讯云IM音视频音视频含UI集成"
date: 2023-03-14 17:14:03 +0800
description: "文章浏览阅读4.6k次，点赞9次，收藏33次。uniapp对接腾讯云IM+音视频集成到android"
keywords: "uniapp 腾讯音视频"
categories: ['App']
tags: ['音视频', '腾讯云', 'App']
artid: "129529465"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=129529465
    alt: "uniapp对接腾讯云IM音视频音视频含UI集成"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     uniapp对接腾讯云IM+音视频。音视频含UI集成
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="uniappIM_0">
     </a>
     uniapp对接腾讯云IM+音视频
    </h2>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#uniappIM_0" rel="nofollow">
        uniapp对接腾讯云IM+音视频
       </a>
      </li>
      <li>
       <a href="#_6" rel="nofollow">
        前言
       </a>
      </li>
      <li>
       <a href="#_12" rel="nofollow">
        一、准备工作
       </a>
      </li>
      <li>
       <a href="#_20" rel="nofollow">
        二、使用步骤
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1Appvue_21" rel="nofollow">
          1.App.vue配置
         </a>
        </li>
        <li>
         <a href="#2_loginvue_180" rel="nofollow">
          2.登录时操作 login.vue
         </a>
        </li>
        <li>
         <a href="#3_227" rel="nofollow">
          3.使用方法
         </a>
        </li>
        <li>
         <a href="#_228" rel="nofollow">
          一、音视频
         </a>
        </li>
        <li>
         <a href="#api__httpsextdcloudnetcnpluginid9035_262" rel="nofollow">
          `还有更多api请查看插件地址: ` [插件地址](https://ext.dcloud.net.cn/plugin?id=9035)
         </a>
        </li>
        <li>
         <a href="#IM_265" rel="nofollow">
          二、IM
         </a>
        </li>
        <li>
         <a href="#api_httpswebsdkqcloudcomimdoczhcnSDKhtml_378" rel="nofollow">
          `更多api：` [文档地址](https://web.sdk.qcloud.com/im/doc/zh-cn/SDK.html)
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_381" rel="nofollow">
        总结
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_383" rel="nofollow">
          `如有疑问，或者困难可在下方留言.如本文对你有所帮助，给个点赞、收藏再走吧。`
         </a>
        </li>
        <li>
         <a href="#_385" rel="nofollow">
          `本文原创,转载请注明出处！！！`
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <hr/>
    <h2>
     <a id="_6">
     </a>
     前言
    </h2>
    <p>
     <code>
      提示：作者已经实现uniapp集成腾讯云IM+音视频到android和ios平台，如有疑问可在下方留言。音视频为含ui集成
     </code>
    </p>
    <hr/>
    <h2>
     <a id="_12">
     </a>
     一、准备工作
    </h2>
    <ul>
     <li>
      <a href="https://ext.dcloud.net.cn/plugin?id=9035" rel="nofollow">
       uniapp腾讯云音视频插件地址
      </a>
      <code>
       官方插件显示的ios版本为9-15，本人ios版本号为16.1,亲测可行
      </code>
     </li>
     <li>
      <a href="https://cloud.tencent.com/document/product/647/78732" rel="nofollow">
       uniapp 腾讯云音视频文档
      </a>
     </li>
     <li>
      <a href="https://cloud.tencent.com/document/product/269/64507" rel="nofollow">
       uniapp 腾讯云IM文档
      </a>
      <code>
       注意这个是uni的v3+ts版本,如果是v2版本腾讯云没有直接的sdk，可以参考腾讯云IM中web的sdk可以查看这个文档:
      </code>
      <a href="https://web.sdk.qcloud.com/im/doc/zh-cn/SDK.html" rel="nofollow">
       web对接腾讯云IM文档
      </a>
     </li>
     <li>
      <code>
       需要文件,用于后续生成userSig,下载地址:
      </code>
      <a href="https://download.csdn.net/download/qq_44860866/87576713">
       用于生成userSig
      </a>
     </li>
     <li>
      <code>
       请认真阅读插件的使用步骤
      </code>
     </li>
     <li>
      <code>
       缺少依赖的自行安装npm i xx
      </code>
     </li>
    </ul>
    <h2>
     <a id="_20">
     </a>
     二、使用步骤
    </h2>
    <h3>
     <a id="1Appvue_21">
     </a>
     1.App.vue配置
    </h3>
    <blockquote>
     <p>
      代码如下（示例）：
     </p>
    </blockquote>
    <pre><code class="prism language-c"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
import TIM from <span class="token char">'tim-js-sdk'</span><span class="token punctuation">;</span>
import <span class="token punctuation">{<!-- --></span> genTestUserSig <span class="token punctuation">}</span> from <span class="token char">'@/debug/GenerateTestUserSig.js'</span><span class="token punctuation">;</span> <span class="token comment">// 准备工作第四步,下载解压到项目根目录并引入。注意修改GenerateTestUserSig.js中的SDKAPPID和SECRETKEY</span>
<span class="token keyword">const</span> TUICallKit <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">requireNativePlugin</span><span class="token punctuation">(</span><span class="token char">'TencentCloud-TUICallKit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> TUICallKitEvent <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">requireNativePlugin</span><span class="token punctuation">(</span><span class="token char">'globalEvent'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> TUICallEngine <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">requireNativePlugin</span><span class="token punctuation">(</span>'TencentCloud<span class="token operator">-</span>TUICallKit<span class="token operator">-</span>TUICallEngine'<span class="token punctuation">)</span><span class="token punctuation">;</span>

export <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
	globalData<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		SDKAppID<span class="token operator">:</span> <span class="token function">genTestUserSig</span><span class="token punctuation">(</span><span class="token char">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sdkAppID<span class="token punctuation">,</span> <span class="token comment">// 修改GenerateTestUserSig.js中的SDKAPPID</span>
		userID<span class="token operator">:</span> <span class="token char">''</span><span class="token punctuation">,</span> <span class="token comment">// 用户id,登录接口返回的用户id,也可以任意指定,但不要重复</span>
		userSig<span class="token operator">:</span> <span class="token char">''</span><span class="token punctuation">,</span> <span class="token comment">// 登录时生成</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 登录成功后存储的userID和userSig</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token char">'USERID'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			this<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userID <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token char">'USERID'</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token char">'USERSIG'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			this<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userSig <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token char">'USERSIG'</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 重点注意： 为了 uni-app 更好地接入使用 tim，快速定位和解决问题，请勿修改 uni.$TUIKit 命名。</span>
		<span class="token comment">// 如果您已经接入 tim ，请将 uni.tim 修改为 uni.$TUIKit。</span>
		uni<span class="token punctuation">.</span>$TUIKit <span class="token operator">=</span> TIM<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
			SDKAppID<span class="token operator">:</span> this<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>SDKAppID
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		uni<span class="token punctuation">.</span>$TIM <span class="token operator">=</span> TIM<span class="token punctuation">;</span>
		<span class="token comment">// 将原生插件挂载在 uni 上</span>
		uni<span class="token punctuation">.</span>$TUICallKit <span class="token operator">=</span> TUICallKit<span class="token punctuation">;</span>
		uni<span class="token punctuation">.</span>$TUICallKitEvent <span class="token operator">=</span> TUICallKitEvent<span class="token punctuation">;</span>
		uni<span class="token punctuation">.</span>$TUICallEngine <span class="token operator">=</span> TUICallEngine<span class="token punctuation">;</span>
		<span class="token comment">// 添加监听事件</span>
		<span class="token comment">// 通话状态监听</span>
		TUICallKitEvent<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token char">'onError'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
		  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'onError'</span><span class="token punctuation">,</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		TUICallKitEvent<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token char">'onCallReceived'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
		  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'onCallReceived'</span><span class="token punctuation">,</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		TUICallKitEvent<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token char">'onCallCancelled'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
		  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'onCallCancelled'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		TUICallKitEvent<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token char">'onCallBegin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
		  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'onCallBegin'</span><span class="token punctuation">,</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		TUICallKitEvent<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token char">'onCallEnd'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
		  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'onCallEnd'</span><span class="token punctuation">,</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// IM监听</span>
		uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>TIM<span class="token punctuation">.</span>EVENT<span class="token punctuation">.</span>ERROR<span class="token punctuation">,</span> <span class="token function">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span><span class="token char">'收到 SDK 发生错误通知'</span><span class="token punctuation">)</span>
		  <span class="token comment">// 收到 SDK 发生错误通知，可以获取错误码和错误信息</span>
		  <span class="token comment">// event.name - TIM.EVENT.ERROR</span>
		  <span class="token comment">// event.data.code - 错误码</span>
		  <span class="token comment">// event.data.message - 错误信息</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>TIM<span class="token punctuation">.</span>EVENT<span class="token punctuation">.</span>SDK_NOT_READY<span class="token punctuation">,</span> <span class="token function">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span><span class="token char">'收到 SDK 进入 not ready 状态通知'</span><span class="token punctuation">)</span>
		  <span class="token comment">// 收到 SDK 进入 not ready 状态通知，此时 SDK 无法正常工作</span>
		  <span class="token comment">// event.name - TIM.EVENT.SDK_NOT_READY</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		
		uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>TIM<span class="token punctuation">.</span>EVENT<span class="token punctuation">.</span>NET_STATE_CHANGE<span class="token punctuation">,</span> <span class="token function">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span><span class="token char">'网络状态发生改变'</span><span class="token punctuation">)</span>
		  <span class="token comment">// 网络状态发生改变（v2.5.0 起支持）</span>
		  <span class="token comment">// event.name - TIM.EVENT.NET_STATE_CHANGE</span>
		  <span class="token comment">// event.data.state 当前网络状态，枚举值及说明如下：</span>
		  <span class="token comment">//   - TIM.TYPES.NET_STATE_CONNECTED - 已接入网络</span>
		  <span class="token comment">//   - TIM.TYPES.NET_STATE_CONNECTING - 连接中。很可能遇到网络抖动，SDK 在重试。接入侧可根据此状态提示“当前网络不稳定”或“连接中”</span>
		  <span class="token comment">//   - TIM.TYPES.NET_STATE_DISCONNECTED - 未接入网络。接入侧可根据此状态提示“当前网络不可用”。SDK 仍会继续重试，若用户网络恢复，SDK 会自动同步消息</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>TIM<span class="token punctuation">.</span>EVENT<span class="token punctuation">.</span>CONVERSATION_LIST_UPDATED<span class="token punctuation">,</span> <span class="token function">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			let badge <span class="token operator">=</span> <span class="token number">0</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span>let i in event<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				badge <span class="token operator">+=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>unreadCount
			<span class="token punctuation">}</span>
			<span class="token comment">// badeg为未读消息总数,可用于设置角标...</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span><span class="token char">'收到会话列表更新通知'</span><span class="token punctuation">)</span>
		  <span class="token comment">// 收到会话列表更新通知，可通过遍历 event.data 获取会话列表数据并渲染到页面</span>
		  <span class="token comment">// event.name - TIM.EVENT.CONVERSATION_LIST_UPDATED</span>
		  <span class="token comment">// event.data - 存储 Conversation 对象的数组 - [Conversation]</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 监听事件，如：</span>
		uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>TIM<span class="token punctuation">.</span>EVENT<span class="token punctuation">.</span>SDK_READY<span class="token punctuation">,</span> <span class="token function">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span><span class="token char">' 收到离线消息和会话列表同步完毕通知'</span><span class="token punctuation">)</span>
		  <span class="token comment">// 收到离线消息和会话列表同步完毕通知，接入侧可以调用 sendMessage 等需要鉴权的接口</span>
		  <span class="token comment">// event.name - TIM.EVENT.SDK_READY</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>TIM<span class="token punctuation">.</span>EVENT<span class="token punctuation">.</span>MESSAGE_RECEIVED<span class="token punctuation">,</span> this<span class="token punctuation">.</span>onReceiveMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 收到推送的单聊、群聊、群提示、群系统通知的新消息，可通过遍历 event.data 获取消息列表数据并渲染到页面</span>
		<span class="token comment">// event.name - TIM.EVENT.MESSAGE_RECEIVED</span>
		<span class="token comment">// event.data - 存储 Message 对象的数组 - [Message]</span>
		<span class="token comment">// 如果已登录并且能获取到用户id</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token char">'token'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> this<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userID<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token char">'token'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> this<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userID<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 登录腾讯IM</span>
			uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				userID<span class="token operator">:</span> this<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userID<span class="token punctuation">,</span>
				userSig<span class="token operator">:</span> this<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userSig<span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			uni<span class="token punctuation">.</span>$TUICallKit<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				SDKAppID<span class="token operator">:</span> this<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>SDKAppID<span class="token punctuation">,</span>
				userID<span class="token operator">:</span> this<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userID<span class="token punctuation">,</span>
				userSig<span class="token operator">:</span> this<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userSig<span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span><span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token comment">// 开启悬浮窗</span>
					uni<span class="token punctuation">.</span>$TUICallKit<span class="token punctuation">.</span><span class="token function">enableFloatWindow</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
					console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token char">'login failed, failed message = '</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 如果设置的是手动关闭启动图则打开下方注释</span>
			<span class="token comment">// plus.navigator.closeSplashscreen()</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
			uni<span class="token punctuation">.</span><span class="token function">reLaunch</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				url<span class="token operator">:</span> <span class="token char">'/pages/login/login'</span><span class="token punctuation">,</span>
				success<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
					<span class="token comment">// 如果设置的是手动关闭启动图则打开下方注释</span>
					<span class="token comment">// plus.navigator.closeSplashscreen()</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">onShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'App Show'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">onHide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'App Hide'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	methods<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">onReceiveMessage</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 设置已读</span>
			var pages <span class="token operator">=</span> <span class="token function">getCurrentPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			let route <span class="token operator">=</span> pages<span class="token punctuation">[</span>pages<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>route
			<span class="token comment">// 如果当前是在聊天页面,则直接设置该消息已读</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>route <span class="token operator">==</span> <span class="token char">'pages/news/chatRoom/chatRoom'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 因为返回的是数组,虽然是一条为了保险起见写成循环(万一是多条呢!!!)</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span>let i in event<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">setMessageRead</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>conversationID<span class="token operator">:</span> event<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>conversationID<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
<span class="token comment">/*每个页面公共css */</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
</code></pre>
    <h3>
     <a id="2_loginvue_180">
     </a>
     2.登录时操作 login.vue
    </h3>
    <p>
     <code>
      下面操作，需要在登录接口执行后再执行
     </code>
    </p>
    <p>
     代码如下（示例）：
    </p>
    <pre><code class="prism language-c"><span class="token comment">//login页面需引入 import { genTestUserSig } from '@/debug/GenerateTestUserSig.js';</span>
<span class="token comment">// 下方代码放到登录接口的回调中</span>
<span class="token keyword">const</span> userID <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token char">'userID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// userID必须要字符串类型,后台登录接口返回		</span>
<span class="token keyword">const</span> userSig <span class="token operator">=</span> <span class="token function">genTestUserSig</span><span class="token punctuation">(</span>userID<span class="token punctuation">)</span><span class="token punctuation">.</span>userSig<span class="token punctuation">;</span> <span class="token comment">// 引入上方js并调用,生成userSig</span>
uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	userID<span class="token operator">:</span> userID<span class="token punctuation">,</span>
	userSig<span class="token operator">:</span> userSig
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
	let onSdkReady <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 更新用户昵称及头像</span>
		uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">updateMyProfile</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
			nick<span class="token operator">:</span> <span class="token char">''</span><span class="token punctuation">,</span> <span class="token comment">// 接口返回的用户昵称</span>
			avatar<span class="token operator">:</span> <span class="token char">''</span><span class="token punctuation">,</span> <span class="token comment">// 接口返回的用户头像</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> err <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 监听事件，如：</span>
	uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>uni<span class="token punctuation">.</span>$TIM<span class="token punctuation">.</span>EVENT<span class="token punctuation">.</span>SDK_READY<span class="token punctuation">,</span> onSdkReady<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
uni<span class="token punctuation">.</span>$TUICallKit<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	SDKAppID<span class="token operator">:</span> <span class="token function">genTestUserSig</span><span class="token punctuation">(</span><span class="token char">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sdkAppID<span class="token punctuation">,</span>
	userID<span class="token operator">:</span> userID<span class="token punctuation">,</span>
	userSig<span class="token operator">:</span> userSig<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span><span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 开启悬浮窗</span>
		uni<span class="token punctuation">.</span>$TUICallKit<span class="token punctuation">.</span><span class="token function">enableFloatWindow</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 登录成功后进入首页</span>
		uni<span class="token punctuation">.</span><span class="token function">switchTab</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
			url<span class="token operator">:</span> <span class="token char">'/pages/index/index'</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token char">'login failed, failed message = '</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 可以把userID和userSig缓存到本地,用于持久登录</span>
uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token char">'USERID'</span><span class="token punctuation">,</span>userID<span class="token punctuation">)</span>
uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token char">'USERSIG'</span><span class="token punctuation">,</span>userSig<span class="token punctuation">)</span>
<span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userID <span class="token operator">=</span> userID<span class="token punctuation">;</span>
<span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userSig <span class="token operator">=</span> userSig<span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="3_227">
     </a>
     3.使用方法
    </h3>
    <h3>
     <a id="_228">
     </a>
     一、音视频
    </h3>
    <p>
     <code>
      腾讯云音视频插件只需要执行拨打方法即可,收到来电请求后，TUICallKit 组件会自动唤起来电提醒的接听界面。
     </code>
    </p>
    <ul>
     <li>
      音视频1V1
     </li>
    </ul>
    <pre><code class="prism language-c">uni<span class="token punctuation">.</span>$TUICallKit<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	userID<span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token char">'userID'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 对方的userID</span>
	callMediaType<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 语音通话(callMediaType = 1)、视频通话(callMediaType = 2)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span><span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
			user_id<span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span>this<span class="token punctuation">.</span>userID<span class="token punctuation">)</span><span class="token punctuation">,</span>
			content<span class="token operator">:</span> `<span class="token punctuation">[</span>$<span class="token punctuation">{<!-- --></span>this<span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>common<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>nickname<span class="token punctuation">}</span><span class="token punctuation">]</span>向您发起了$<span class="token punctuation">{<!-- --></span>type <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token char">'语音通话'</span> <span class="token operator">:</span> <span class="token char">'视频通话'</span><span class="token punctuation">}</span>`
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'call success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`call failed<span class="token punctuation">,</span> error message <span class="token operator">=</span> $<span class="token punctuation">{<!-- --></span>res<span class="token punctuation">.</span>msg<span class="token punctuation">}</span>`<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      音视频1VN
     </li>
    </ul>
    <pre><code class="prism language-c">uni<span class="token punctuation">.</span>$TUICallKit<span class="token punctuation">.</span><span class="token function">groupCall</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	groupID<span class="token operator">:</span> <span class="token char">'myGroup'</span><span class="token punctuation">,</span>
 	userIDList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token char">'mike'</span><span class="token punctuation">,</span> <span class="token char">'tom'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  	callMediaType<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 语音通话(callMediaType = 1)、视频通话(callMediaType = 2)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span><span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'groupCall success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`groupCall failed<span class="token punctuation">,</span> error message <span class="token operator">=</span> $<span class="token punctuation">{<!-- --></span>res<span class="token punctuation">.</span>msg<span class="token punctuation">}</span>`<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="api__httpsextdcloudnetcnpluginid9035_262">
     </a>
     <code>
      还有更多api请查看插件地址:
     </code>
     <a href="https://ext.dcloud.net.cn/plugin?id=9035" rel="nofollow">
      插件地址
     </a>
    </h3>
    <hr/>
    <h3>
     <a id="IM_265">
     </a>
     二、IM
    </h3>
    <p>
     <code>
      监听会话列表&amp;设置消息已读方法在App.vue中已经实现.
     </code>
    </p>
    <ul>
     <li>
      获取会话列表
     </li>
    </ul>
    <pre><code class="prism language-c">uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">getConversationList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>conversationList<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      删除会话
     </li>
    </ul>
    <pre><code class="prism language-c">let promise <span class="token operator">=</span> uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">deleteConversation</span><span class="token punctuation">(</span><span class="token char">'conversationID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 删除会话成功</span>
	<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> conversationID <span class="token punctuation">}</span> <span class="token operator">=</span> imResponse<span class="token punctuation">.</span>data<span class="token punctuation">;</span> <span class="token comment">// 被删除的会话 ID</span>
	uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
		title<span class="token operator">:</span> <span class="token char">'删除成功'</span><span class="token punctuation">,</span>
		icon<span class="token operator">:</span> <span class="token string">"none"</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span>imError<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token char">'deleteConversation error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 删除会话失败的相关信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      创建文字/图片消息并发送
     </li>
    </ul>
    <pre><code class="prism language-c">let message <span class="token operator">=</span> uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">createTextMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	to<span class="token operator">:</span> <span class="token char">'userID'</span><span class="token punctuation">,</span> <span class="token comment">// 对方用户id</span>
	conversationType<span class="token operator">:</span> uni<span class="token punctuation">.</span>$TIM<span class="token punctuation">.</span>TYPES<span class="token punctuation">.</span>CONV_C2C<span class="token punctuation">,</span> <span class="token comment">// 消息类型</span>
	<span class="token comment">// 消息优先级，用于群聊（v2.4.2起支持）。如果某个群的消息超过了频率限制，后台会优先下发高优先级的消息，详细请参考：https://cloud.tencent.com/document/product/269/3663#.E6.B6.88.E6.81.AF.E4.BC.98.E5.85.88.E7.BA.A7.E4.B8.8E.E9.A2.91.E7.8E.87.E6.8E.A7.E5.88.B6)</span>
	<span class="token comment">// 支持的枚举值：TIM.TYPES.MSG_PRIORITY_HIGH, TIM.TYPES.MSG_PRIORITY_NORMAL（默认）, TIM.TYPES.MSG_PRIORITY_LOW, TIM.TYPES.MSG_PRIORITY_LOWEST</span>
	<span class="token comment">// priority: TIM.TYPES.MSG_PRIORITY_NORMAL,</span>
	payload<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		text<span class="token operator">:</span> <span class="token char">'hello world !!!'</span><span class="token punctuation">,</span> <span class="token comment">// 文字内容</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// v2.20.0起支持C2C消息已读回执功能，如果您发消息需要已读回执，需购买旗舰版套餐，并且创建消息时将 needReadReceipt 设置为 true</span>
	needReadReceipt<span class="token operator">:</span> true
	<span class="token comment">// 消息自定义数据（云端保存，会发送到对端，程序卸载重装后还能拉取到，v2.10.2起支持）</span>
	<span class="token comment">// cloudCustomData: 'your cloud custom data'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 图片消息</span>
<span class="token comment">// message = uni.$TUIKit.createImageMessage({<!-- --></span>
<span class="token comment">//     to: 'userID',</span>
<span class="token comment">//     conversationType: uni.$TIM.TYPES.CONV_C2C,</span>
<span class="token comment">//     payload: { file: [] }, // uni.chooseImage返回的本地文件,直接把数组拿过来,参考下方发送视频消息</span>
<span class="token comment">//     onProgress: function(event) { console.log('file uploading:', event) }</span>
<span class="token comment">// });</span>
let promise <span class="token operator">=</span> uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 发送成功</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span>imError<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 发送失败</span>
	console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token char">'sendMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      创建视频消息并发送
     </li>
    </ul>
    <pre><code class="prism language-c">uni<span class="token punctuation">.</span><span class="token function">chooseVideo</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	mediaType<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token char">'video'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 视频</span>
	count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	compressed<span class="token operator">:</span> false<span class="token punctuation">,</span>
	sourceType<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token char">'camera'</span><span class="token punctuation">,</span> <span class="token char">'album'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// album 从相册选视频，camera 使用相机拍摄，默认为：['album', 'camera']</span>
	maxDuration<span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token comment">// 设置最长时间60s</span>
	camera<span class="token operator">:</span> <span class="token char">'back'</span><span class="token punctuation">,</span> <span class="token comment">// 后置摄像头</span>
	success<span class="token operator">:</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
		let message <span class="token operator">=</span> uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">createVideoMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
			to<span class="token operator">:</span> <span class="token char">'userID'</span><span class="token punctuation">,</span>
			conversationType<span class="token operator">:</span> uni<span class="token punctuation">.</span>$TIM<span class="token punctuation">.</span>TYPES<span class="token punctuation">.</span>CONV_C2C<span class="token punctuation">,</span>
			payload<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> file<span class="token operator">:</span> res <span class="token punctuation">}</span><span class="token punctuation">,</span>
			onProgress<span class="token operator">:</span> <span class="token function">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'file uploading:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span> <span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 2. 发送消息</span>
		let promise <span class="token operator">=</span> uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
		promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 发送成功</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span>imError<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 发送失败</span>
			console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token char">'sendMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      创建语音消息并发送
      <code>
       语音消息走的是自定义消息，参考文档上的创建语音消息并没有实现会有报错
      </code>
     </li>
    </ul>
    <pre><code class="prism language-c">let message <span class="token operator">=</span> uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">createCustomMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	to<span class="token operator">:</span> <span class="token char">'userID'</span><span class="token punctuation">,</span>
	conversationType<span class="token operator">:</span> uni<span class="token punctuation">.</span>$TIM<span class="token punctuation">.</span>TYPES<span class="token punctuation">.</span>CONV_C2C<span class="token punctuation">,</span>
	<span class="token comment">// 消息优先级，用于群聊（v2.4.2起支持）。如果某个群的消息超过了频率限制，后台会优先下发高优先级的消息，详细请参考：https://cloud.tencent.com/document/product/269/3663#.E6.B6.88.E6.81.AF.E4.BC.98.E5.85.88.E7.BA.A7.E4.B8.8E.E9.A2.91.E7.8E.87.E6.8E.A7.E5.88.B6)</span>
	<span class="token comment">// 支持的枚举值：TIM.TYPES.MSG_PRIORITY_HIGH, TIM.TYPES.MSG_PRIORITY_NORMAL（默认）, TIM.TYPES.MSG_PRIORITY_LOW, TIM.TYPES.MSG_PRIORITY_LOWEST</span>
	<span class="token comment">// priority: TIM.TYPES.MSG_PRIORITY_HIGH,</span>
	<span class="token comment">// 注意，这三个参数我这边因为没有其他需求所以直接把三个参数分别使用了。如果有其他的自定义消息,可以把参数设置为JSON对象,定义好自己的规范</span>
	payload<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		data<span class="token operator">:</span> <span class="token char">''</span><span class="token punctuation">,</span> <span class="token comment">// 语音地址</span>
		description<span class="token operator">:</span> <span class="token char">'voice'</span><span class="token punctuation">,</span> <span class="token comment">// 语音类型</span>
		extension<span class="token operator">:</span> <span class="token char">''</span><span class="token punctuation">,</span> <span class="token comment">// 语音时长</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 3. 发送消息</span>
let promise <span class="token operator">=</span> uni<span class="token punctuation">.</span>$TUIKit<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 发送成功</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span>imError<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 发送失败</span>
	console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token char">'sendMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="api_httpswebsdkqcloudcomimdoczhcnSDKhtml_378">
     </a>
     <code>
      更多api：
     </code>
     <a href="https://web.sdk.qcloud.com/im/doc/zh-cn/SDK.html" rel="nofollow">
      文档地址
     </a>
    </h3>
    <hr/>
    <h2>
     <a id="_381">
     </a>
     总结
    </h2>
    <h3>
     <a id="_383">
     </a>
     <code>
      如有疑问，或者困难可在下方留言.如本文对你有所帮助，给个点赞、收藏再走吧。
     </code>
    </h3>
    <h3>
     <a id="_385">
     </a>
     <code>
      本文原创,转载请注明出处！！！
     </code>
    </h3>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34343836303836362f:61727469636c652f64657461696c732f313239353239343635" class_="artid" style="display:none">
 </p>
</div>


