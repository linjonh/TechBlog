---
layout: post
title: "QT-Cå®è·µè¶…è¯¦ç»†æ•°æ®åº“çš„è¿æ¥å’Œå¢åˆ æ”¹æŸ¥æ“ä½œé™„æºç "
date: 2024-02-28 17:16:55 +0800
description: "æ–‡ç« æµè§ˆé˜…è¯»4.1kæ¬¡ï¼Œç‚¹èµ30æ¬¡ï¼ŒğŸª§ä»€ä¹ˆæƒ…å†µéœ€è¦æ•°æ®åº“?å¦‚æœä¸æ˜¯ä¸Šé¢çš„åŸå› åŒ–ï¼ŒğŸª§äºŒè€…åŒºåˆ«åœ¨äºï¼Œå‰è€…"
keywords: "c++è¿æ¥mysqlæ•°æ®åº“å¢åˆ æ”¹æŸ¥"
categories: ['Qt']
tags: ['æ•°æ®åº“', 'Qt', 'C']
artid: "136326235"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=136326235
    alt: "QT-Cå®è·µè¶…è¯¦ç»†æ•°æ®åº“çš„è¿æ¥å’Œå¢åˆ æ”¹æŸ¥æ“ä½œé™„æºç "
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     QT C++å®è·µ|è¶…è¯¦ç»†æ•°æ®åº“çš„è¿æ¥å’Œå¢åˆ æ”¹æŸ¥æ“ä½œ|é™„æºç 
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-dracula" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="0_0">
     </a>
     0ï¼šå‰è¨€
    </h2>
    <p>
     ğŸª§
     <b>
      <font color="#6ab04c">
       ä»€ä¹ˆæƒ…å†µéœ€è¦æ•°æ®åº“?
      </font>
     </b>
    </p>
    <ul>
     <li>
      1 å¤§è§„æ¨¡çš„æ•°æ®éœ€è¦å¤„ç†ï¼ˆæ¯”å¦‚ä¸Šåƒä¸Šä¸‡çš„æ•°æ®é‡ï¼‰
     </li>
     <li>
      2 éœ€è¦æŠŠæ•°æ®ä¿¡æ¯å­˜å‚¨èµ·æ¥ï¼Œæ— è®ºæ˜¯æœ¬åœ°è¿˜æ˜¯æœåŠ¡ä¸Šï¼Œè€Œä¸æ˜¯æ–­ç”µåæ•°æ®ä¿¡æ¯å°±æ¶ˆå¤±äº†ã€‚
     </li>
    </ul>
    <p>
     å¦‚æœä¸æ˜¯ä¸Šé¢çš„åŸå› åŒ–ï¼Œä¸€èˆ¬å¯ä»¥ä½¿ç”¨æ•°ç»„æ¥å¤„ç†ã€‚
    </p>
    <p>
     ğŸª§ä¸€èˆ¬å¸¸ä½¿ç”¨çš„æ•°æ®åº“é©±åŠ¨æ˜¯
     <strong>
      MYSQL
     </strong>
     å’Œ
     <strong>
      QSQLITE
     </strong>
     ã€‚äºŒè€…åŒºåˆ«åœ¨äºï¼Œå‰è€…ç”¨äºæœåŠ¡å™¨å­˜å‚¨ä¿¡æ¯ï¼Œåè€…ç”¨äºæœ¬åœ°å­˜å‚¨ä¿¡æ¯ã€‚å¹¶ä¸”QSQLITEä¸»è¦ç”¨äºåµŒå…¥å¼ï¼Œå ç”¨èµ„æºéå¸¸ä½ï¼Œå ç”¨å†…å­˜å°ï¼Œé€šå¸¸å‡ ç™¾kå°±æå®šã€‚â€™
    </p>
    <blockquote>
     <p>
      è¿™é‡Œåšä¸»å› ä¸ºå¯¹
      <code>
       MySQL
      </code>
      ç†Ÿæ‚‰ä¸€äº›ï¼Œå°±ä½¿ç”¨
      <code>
       MySQL
      </code>
      æ¥è¿›è¡Œæ•°æ®åº“çš„è¿æ¥
     </p>
    </blockquote>
    <h2>
     <a id="Mysql_9">
     </a>
     ä¸€ã€Mysqlçš„å®‰è£…
    </h2>
    <p>
     å› ä¸ºæˆ‘ä»¬é¡¹ç›®çš„æ–¹æ¡ˆæ˜¯ç¨‹åºçš„è¿è¡Œä»¥åŠç›¸å…³æ•°æ®çš„å­˜å‚¨éƒ½åœ¨ä¸€å°ä¸»æœºä¸Šï¼Œæ‰€ä»¥ä¸è®ºæ‰“ä¸æ‰“åŒ…ã€‚é¦–å…ˆè¦åœ¨ä¸»æœºä¸Šå®‰è£…
     <code>
      Mysql
     </code>
     çš„ã€‚
     <code>
      Mysql
     </code>
     çš„å®‰è£…æ•™ç¨‹æˆ‘å‚è€ƒçš„æ˜¯è¿™ä¸ªï¼š
     <a href="https://zhuanlan.zhihu.com/p/654087404" rel="nofollow">
      MySQLå®‰è£…å’Œé…ç½®æ•™ç¨‹ï¼ˆè¶…è¯¦ç»†ç‰ˆæœ¬ï¼‰
     </a>
    </p>
    <p>
     å®‰è£…å¥½åï¼Œåˆ©ç”¨å‘½ä»¤è¡Œæˆ–å…¶ä»–å·¥å…·åœ¨MySQLä¸­åˆ›å»ºä¸€ä¸ªå­˜å‚¨é¡¹ç›®æ•°æ®çš„æ•°æ®åº“ï¼Œæ–¹ä¾¿ä¹‹åä½¿ç”¨QTç”¨ä»£ç å¯¹æ•°æ®åº“è¿›è¡Œè¿æ¥ã€å»ºè¡¨å’Œå¢åˆ æ”¹æŸ¥çš„æ“ä½œï¼š
    </p>
    <ul>
     <li>
      <code>
       Win+r
      </code>
      æ‰“å¼€cmdï¼šè¾“å…¥å‘½ä»¤â€œmysql -u root -pâ€ï¼ŒæŒ‰ä¸‹å›è½¦é”®
     </li>
     <li>
      è¾“å…¥MySQLå¯†ç ï¼ŒæŒ‰ä¸‹å›è½¦é”®
     </li>
     <li>
      åˆ›å»ºæ•°æ®åº“
     </li>
    </ul>
    <pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">database</span> <span class="token punctuation">[</span><span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span><span class="token punctuation">]</span> æ•°æ®åº“å <span class="token punctuation">[</span><span class="token keyword">default</span> <span class="token keyword">charset</span> å­—ç¬¦é›†<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">collate</span> æ’åºè§„åˆ™<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
    <blockquote>
     <p>
      æ³¨æ„ï¼šä¸è¦å¿˜è®°æœ«å°¾çš„åˆ†å·
     </p>
    </blockquote>
    <h2>
     <a id="ODBCMySQL_22">
     </a>
     äºŒã€é€šè¿‡ODBCè¿æ¥MySQLæ•°æ®åº“
    </h2>
    <p>
     å®˜æ–¹è§£é‡Š:
     <br/>
     ODBCï¼ˆOpen Database Connectivityï¼Œå¼€æ”¾æ•°æ®åº“äº’è¿ï¼‰æä¾›äº†ä¸€ç§æ ‡å‡†çš„APIï¼ˆåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼‰æ–¹æ³•æ¥è®¿é—®æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰ã€‚è¿™äº›APIåˆ©ç”¨SQLæ¥å®Œæˆå…¶å¤§éƒ¨åˆ†ä»»åŠ¡ã€‚ODBCæœ¬èº«ä¹Ÿæä¾›äº†å¯¹SQLè¯­è¨€çš„æ”¯æŒï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥å°†SQLè¯­å¥é€ç»™ODBCã€‚ODBCçš„è®¾è®¡è€…ä»¬åŠªåŠ›ä½¿å®ƒå…·æœ‰æœ€å¤§çš„ç‹¬ç«‹æ€§å’Œå¼€æ”¾æ€§ï¼šä¸å…·ä½“çš„ç¼–ç¨‹è¯­è¨€æ— å…³ï¼Œä¸å…·ä½“çš„æ•°æ®åº“ç³»ç»Ÿæ— å…³ï¼Œä¸å…·ä½“çš„æ“ä½œç³»ç»Ÿæ— å…³ã€‚
     <br/>
     ç®€å•çš„è¯´å°±æ˜¯æˆ‘çš„qtä¸­å«æœ‰ODBCçš„é©±åŠ¨ï¼š
     <br/>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/6183365bcea5b3d21ff316c18632b9df.png">
      <br/>
      æ‰€ä»¥åˆ©ç”¨ODBCå»ä½¿ç”¨MySQLçš„æ•°æ®åº“
     </img>
    </p>
    <h3>
     <a id="21ODBC_29">
     </a>
     2.1ï¼šä¸‹è½½ODBC
    </h3>
    <p>
     <a href="https://dev.mysql.com/downloads/connector/odbc/" rel="nofollow">
      å®˜ç½‘
     </a>
    </p>
    <p>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/4edd13a0af9c444d48c36ba0b976bbe7.png"/>
    </p>
    <blockquote>
     <p>
      é€‰æ‹©å’Œqtç¼–è¯‘å™¨ç›¸åŒçš„å­—èŠ‚æ¯”å¦‚æˆ‘çš„qtä½¿ç”¨çš„æ˜¯64å­—èŠ‚çš„
     </p>
    </blockquote>
    <p>
     ä¸‹è½½å®Œæˆåï¼Œç‚¹å¡ä¸‹è½½ä¸‹æ¥çš„
     <code>
      .msi
     </code>
     æ–‡ä»¶å¹¶è¿è¡Œï¼š
    </p>
    <p>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/bc5b29092d5d8f0f809c4500431e4c29.png">
      <br/>
      ä¸‹è½½ä¸€ç›´ç‚¹å‡»
      <code>
       next
      </code>
      ï¼š
      <br/>
      <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/680afba31875409819f234978a55aea4.png"/>
     </img>
    </p>
    <p>
     é€‰æ‹©
     <code>
      custom
     </code>
     ,è¡¨ç¤ºè‡ªå®šä¹‰å®‰è£…ï¼ˆä»¥ä¾¿ä¿®æ”¹å®‰è£…ä½ç½®ï¼‰
    </p>
    <p>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/c0efc6a051cff19e8706dd97eb72182d.png">
      <br/>
      <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/3af118316d47692ec28ce531c27e21ca.png"/>
     </img>
    </p>
    <p>
     æœ€åä¸€ç›´ç‚¹å‡»
     <code>
      next
     </code>
     ç„¶åå†
     <code>
      install
     </code>
     å³å¯ï¼Œç­‰å¾…å®‰è£…å¥½åå³å¯ã€‚
    </p>
    <p>
     å®‰è£…å¥½ä¹‹åï¼Œå…³é—­çª—å£ï¼Œæœç´¢
     <code>
      ODBC
     </code>
     ,å¹¶è¿è¡Œç¨‹åºï¼š
     <br/>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/796a98b8518b1094bc6f511ad8155bdb.png"/>
    </p>
    <h3>
     <a id="22ODBCMySQL_50">
     </a>
     2.2ï¼šä½¿ç”¨ODBCè¿æ¥MySQLæ•°æ®åº“
    </h3>
    <p>
     æ·»åŠ MySQLçš„DSN
    </p>
    <p>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/4bde30100e848277db26e14206876fd3.png"/>
    </p>
    <p>
     çº¢è‰²çš„å¯ä»¥éšä¾¿å¡«,æ˜¯è‡ªå·±å¯¹äºODBCé©±åŠ¨çš„æè¿°,ç²‰è‰²çš„æ˜¯MySQLçš„ç”¨æˆ·åå’Œå¯†ç ,æ•°æ®åº“é€‰æ‹©ä½ åœ¨MySQLä¸­åˆ›å»ºçš„æ•°æ®åº“åå­—å³å¯ï¼š
     <br/>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/64bd94efb5544bb4c827047a74bd494a.png"/>
    </p>
    <p>
     ç‚¹å‡»
     <code>
      Test
     </code>
     ï¼Œæµ‹è¯•æ˜¯å¦èƒ½å¤ŸæˆåŠŸè¿æ¥ï¼›å¦‚æœå‡ºç°ä¸‹å›¾è¯´æ˜è¿æ¥æˆåŠŸ
    </p>
    <p>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/a0b9191bbb5cf0a2973442a939535f34.png"/>
    </p>
    <p>
     ç„¶åç‚¹å‡»
     <code>
      åº”ç”¨
     </code>
     å’Œ
     <code>
      ç¡®å®š
     </code>
     è¿›è¡Œæ·»åŠ ï¼š
     <br/>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/5f6904874b87d80068425855122cd9cc.png"/>
    </p>
    <h3>
     <a id="23qtODBCMySQL_65">
     </a>
     2.3ï¼šqté€šè¿‡ODBCè¿æ¥MySQL
    </h3>
    <p>
     ç°åœ¨
     <code>
      main.cpp
     </code>
     ä¸­åŠ å…¥ä¸‹é¢ä»£ç æµ‹è¯•ä¸€ä¸‹èƒ½ä¸èƒ½åœ¨qtä¸­è¿æ¥æˆåŠŸï¼š
    </p>
    <pre><code class="prism language-cpp">QSqlDatabase db <span class="token operator">=</span> <span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">addDatabase</span><span class="token punctuation">(</span><span class="token string">"QODBC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db<span class="token punctuation">.</span><span class="token function">setHostName</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">3306</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db<span class="token punctuation">.</span><span class="token function">setDatabaseName</span><span class="token punctuation">(</span><span class="token string">"æ˜¯ä½ åœ¨ODBCä¸­åˆ›å»ºçš„Dataã€€sourceã€€ï½ï½ï½ï½…"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·å"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"å¯†ç "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">bool</span> ok <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ok<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"infor"</span><span class="token punctuation">,</span> <span class="token string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"infor"</span><span class="token punctuation">,</span> <span class="token string">"open failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"error open database because"</span><span class="token operator">&lt;&lt;</span>db<span class="token punctuation">.</span><span class="token function">lastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre>
    <p>
     Tips:è¿™é‡Œå¯èƒ½ä¼šæŠ¥é”™ï¼šVS2019 C1083 æ— æ³•æ‰“å¼€åŒ…æ‹¬æ–‡ä»¶: â€œQSqlDatabaseâ€
    </p>
    <p>
     æ˜¯vsé‡Œé¢é¡¹ç›®é…ç½®çš„é—®é¢˜ã€‚
     <br/>
     çœ‹åˆ°è¿™ä¸ªé”™è¯¯åº”è¯¥æ˜¯æ²¡æœ‰dllï¼Œç„¶åsqlå¾ˆå®¹æ˜“æƒ³åˆ°æ•°æ®åº“ï¼Œæ‰€ä»¥åœ¨qtæ¨¡å—é‡Œæ·»åŠ ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚
     <br/>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/64646509d6dff35c680e7b5aae339ccf.png"/>
     <br/>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/a834a6dbadb2f1e66f8ddcfe19006e54.png"/>
    </p>
    <p>
     ä¸å‡ºæ„å¤–è¿è¡Œç¨‹åºå¯ä»¥æˆåŠŸè¿æ¥ï¼š
     <br/>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/40c136332a61f703a239bf9eadd94f8c.png"/>
    </p>
    <blockquote>
     <p>
      ä¹‹ååœ¨ä¸»æœºè¿›è¡Œå®‰è£…æ—¶ï¼Œé™¤äº†æ‰“åŒ…ç¨‹åºï¼Œåº”è¯¥è¿˜éœ€è¦å®‰è£…å¯¹åº”çš„Mysqlå’ŒODBC
     </p>
    </blockquote>
    <h3>
     <a id="24qtODBC_97">
     </a>
     2.4ï¼šqté€šè¿‡ODBCæ“ä½œæ•°æ®åº“
    </h3>
    <p>
     è¿æ¥ä¸Šæ•°æ®åº“ä¸€èˆ¬å°±æ˜¯ä½¿ç”¨æ•°æ®åº“ï¼Œè¿›è¡Œå¯¹æ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥ã€‚
     <br/>
     è¿™é‡Œæœ‰ä¸‰ç§æ–¹æ³•ã€‚
    </p>
    <h4>
     <a id="240_101">
     </a>
     2.4.0ï¼šå‰è¨€
    </h4>
    <p>
     ğŸª§
     <b>
      é¦–å…ˆå•ç‹¬å»ºç«‹ä¸€ä¸ªå¤´æ–‡ä»¶æ¥å¤„ç†æ•°æ®åº“è¿æ¥ï¼Œå¦‚å»ºç«‹å¤´æ–‡ä»¶
      <code>
       connection.h
      </code>
      :
     </b>
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">CONNECTION_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CONNECTION_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QMessageBox&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlDatabase&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlQuery&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QDebug&gt;</span></span>

<span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//è¿æ¥ç¬¬ä¸€ä¸ªæ•°æ®åº“</span>
    <span class="token comment">//QMYSQL</span>
    QSqlDatabase db <span class="token operator">=</span> <span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">addDatabase</span><span class="token punctuation">(</span><span class="token string">"QMYSQL"</span><span class="token punctuation">,</span> <span class="token string">"connection1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//éœ€è¦ä½¿ç”¨çš„æ•°æ®åº“é©±åŠ¨å’Œè”æ£€å»ºç«‹çš„åç§°ï¼ˆæ–¹ä¾¿å»ºç«‹å¤šä¸ªæ•°æ®åº“è¿æ¥ã€ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“æ—¶ã€‘åŒºåˆ†ï¼‰</span>
    db<span class="token punctuation">.</span><span class="token function">setHostName</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿æ¥åœ°å€</span>
    db<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ•°æ®åº“è´¦æˆ·</span>
    db<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¯†ç </span>
    db<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">8889</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç«¯å£</span>
    <span class="token comment">//test_majiang.db</span>
    db<span class="token punctuation">.</span><span class="token function">setDatabaseName</span><span class="token punctuation">(</span><span class="token string">"test_majiang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//éœ€è¦ç”¨åˆ°çš„æ•°æ®åº“</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>db<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//å¦‚æœæ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œåˆ™å¼¹å‡º</span>
        <span class="token comment">//critical(QWidget *parent, const QString &amp;title,</span>
        <span class="token comment">//const QString &amp;text,</span>
        <span class="token comment">//QMessageBox::StandardButtons buttons = Ok,</span>
        <span class="token comment">//QMessageBox::StandardButton defaultButton = NoButton)</span>
           <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">critical</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Cannot open database"</span><span class="token punctuation">,</span>
                                 <span class="token string">"Unable to establish a database connection"</span><span class="token punctuation">,</span> QMessageBox<span class="token double-colon punctuation">::</span>Cancel<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// CONNECTION_H</span></span>
</code></pre>
    <p>
     å¦‚æœéœ€è¦ç§»é™¤ä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œå¯ä»¥ä½¿ç”¨:
    </p>
    <pre><code class="prism language-cpp"> <span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å…³é—­æ•°æ®åº“</span>
 <span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">removeDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç§»é™¤è¯¥è¿æ¥</span>
</code></pre>
    <p>
     åœ¨ Qt ä¸­ï¼ŒQSqlDatabase::close() å’Œ QSqlDatabase::removeDatabase() æ˜¯ç”¨æ¥å…³é—­å’Œç§»é™¤æ•°æ®åº“è¿æ¥çš„ã€‚è¿™ä¸¤ä¸ªå‡½æ•°é€šå¸¸ä¸€èµ·ä½¿ç”¨ï¼Œé¦–å…ˆå…³é—­æ•°æ®åº“è¿æ¥ï¼Œç„¶åç§»é™¤è¯¥è¿æ¥ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿èµ„æºè¢«æ­£ç¡®åœ°é‡Šæ”¾ã€‚
     <br/>
     ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨è¿™ä¸¤ä¸ªå‡½æ•°ï¼š
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlDatabase&gt;</span></span>

<span class="token comment">// å‡è®¾ä½ å·²ç»åˆ›å»ºäº†ä¸€ä¸ªåä¸º "MyDbConnection" çš„æ•°æ®åº“è¿æ¥</span>

<span class="token comment">// é¦–å…ˆï¼Œå…³é—­æ•°æ®åº“è¿æ¥</span>
QSqlDatabase db <span class="token operator">=</span> <span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token string">"MyDbConnection"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>db<span class="token punctuation">.</span><span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç„¶åï¼Œä»è¿æ¥æ± ä¸­ç§»é™¤è¯¥è¿æ¥</span>
<span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">removeDatabase</span><span class="token punctuation">(</span><span class="token string">"MyDbConnection"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œä½ åº”è¯¥åªåœ¨ç¡®ä¿
     <strong>
      æ²¡æœ‰å…¶ä»– QSqlDatabase å¯¹è±¡ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥åæ—¶æ‰ç§»é™¤è¯¥æ•°æ®åº“è¿æ¥
     </strong>
     ã€‚è¿™æ˜¯å› ä¸º QSqlDatabase ä½¿ç”¨çš„æ˜¯
     <strong>
      å…±äº«è¿æ¥
     </strong>
     ï¼Œå³å¦‚æœä½ æœ‰å¤šä¸ª QSqlDatabase å¯¹è±¡ä½¿ç”¨ç›¸åŒçš„è¿æ¥åï¼Œå®ƒä»¬å®é™…ä¸Šæ˜¯åœ¨ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ã€‚
     <strong>
      å½“æœ€åä¸€ä¸ªä½¿ç”¨è¯¥è¿æ¥çš„ QSqlDatabase å¯¹è±¡è¢«é”€æ¯æˆ–å…³é—­æ—¶ï¼Œè¿æ¥æ‰ä¼šè¢«çœŸæ­£å…³é—­
     </strong>
     ã€‚æ‰€ä»¥åœ¨è°ƒç”¨ removeDatabase() å‰è¦ç¡®ä¿æ‰€æœ‰çš„ QSqlDatabase å¯¹è±¡éƒ½å·²ç»ä¸å†éœ€è¦è¿™ä¸ªè¿æ¥äº†
    </p>
    <h4>
     <a id="241QSqlQuery_165">
     </a>
     2.4.1ï¼šä½¿ç”¨QSqlQuery
    </h4>
    <p>
     å¤´æ–‡ä»¶
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"connection.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QVariant&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlDriver&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlRecord&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlField&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlError&gt;</span></span>
</code></pre>
    <ul>
     <li>
      <b>
       <i>
        <font color="#ff4757">
         ä½¿ç”¨æ•°æ®åº“å‰çš„å‡†å¤‡ï¼š
        </font>
       </i>
      </b>
     </li>
    </ul>
    <pre><code class="prism language-cpp">    <span class="token comment">//åˆ›å»ºæ•°æ®åº“è¿æ¥</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//è¿”å›æƒ…å†µå¯ä»¥æ›¿æ¢ï¼Œè§†ä¸åŒæƒ…å†µè€Œå®š</span>
	<span class="token comment">//æŒ‡å®šæŸä¸ªæ•°æ®åº“è¿æ¥</span>
    QSqlDatabase db2 <span class="token operator">=</span> <span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token string">"connection1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      <b>
       <i>
        <font color="#ff4757">
         å¼€å§‹å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼š
         <br/>
         é¦–å…ˆåˆ›å»ºQSqlQuery å¯¹è±¡ï¼Œç„¶åè¿›è¡Œæ“ä½œã€‚
        </font>
       </i>
      </b>
     </li>
    </ul>
    <pre><code class="prism language-cpp">    QSqlQuery <span class="token function">query2</span><span class="token punctuation">(</span>db2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      <b>
       <i>
        <font color="#ff4757">
         è¿›è¡Œåˆ›è¡¨å’Œæ’å…¥å€¼ï¼š
        </font>
       </i>
      </b>
     </li>
    </ul>
    <pre><code class="prism language-cpp">   <span class="token comment">// qDebug() &lt;&lt; "connection2:";</span>
   <span class="token comment">//åˆ›å»ºè¡¨ï¼Œå¹¶æ’å…¥å€¼</span>
       query2<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"create table student (id int primary key,"</span>
               <span class="token string">"name varchar(20))"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    query2<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"insert into student values(0, 'Mike')"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    query2<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"insert into student values(1, 'Lili')"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    query2<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"insert into student values(2, 'Jame')"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      <b>
       <i>
        <font color="#ff4757">
         whereæ¡ä»¶æ›´æ–°
        </font>
       </i>
      </b>
     </li>
    </ul>
    <pre><code class="prism language-cpp"> <span class="token comment">//åˆ›å»ºæ•°æ®åº“è¿æ¥(å°†ç»“æœå†™å…¥æ•°æ®åº“ï¼‰</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
   <span class="token comment">//æŒ‡å®šæŸä¸ªæ•°æ®åº“è¿æ¥</span>
   QSqlDatabase db <span class="token operator">=</span> <span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token string">"connection1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   QSqlQuery <span class="token function">query</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span>
   query<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">"UPDATE floor SET ActNutCnt = :ActNutCnt WHERE floorID = :floorID AND wtID = :wtID"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   query<span class="token punctuation">.</span><span class="token function">bindValue</span><span class="token punctuation">(</span><span class="token string">":ActNutCnt"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   query<span class="token punctuation">.</span><span class="token function">bindValue</span><span class="token punctuation">(</span><span class="token string">":floorID"</span><span class="token punctuation">,</span> <span class="token string">"F001"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   query<span class="token punctuation">.</span><span class="token function">bindValue</span><span class="token punctuation">(</span><span class="token string">":wtID"</span><span class="token punctuation">,</span> <span class="token string">"W001"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
       <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Update successful"</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
       <span class="token comment">// æŸ¥è¯¢æ‰§è¡Œå¤±è´¥</span>
       QSqlError error <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">lastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       QString errorMessage <span class="token operator">=</span> error<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">about</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"æ•°æ®åº“é”™è¯¯"</span><span class="token punctuation">,</span> <span class="token string">"æ£€æµ‹ç»“æœå†™å…¥å¤±è´¥ï¼š"</span> <span class="token operator">+</span> errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token comment">// å…³é—­æ•°æ®åº“è¿æ¥</span>
   db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre>
    <ul>
     <li>
      <b>
       <i>
        <font color="#ff4757">
         æ‰¹é‡å¤„ç†
         <br/>
         ä¸Šé¢çš„å•æ¡æ’å…¥è¯­å¥æ˜æ˜¾æ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥ä½¿ç”¨æ‰¹é‡æ’å…¥æ•°æ®ï¼š
        </font>
       </i>
      </b>
     </li>
    </ul>
    <pre><code class="prism language-cpp">    query2<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"insert into student(id,name) values(3,'Qinsong')"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å•æŒ‘æ“ä½œ</span>

    <span class="token comment">//åç§°ç»‘å®š</span>
    query2<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">"insert into student(id, name) values(:id, :name)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> idValue <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    QString nameValue <span class="token operator">=</span> <span class="token string">"Songjiang"</span><span class="token punctuation">;</span>
    query2<span class="token punctuation">.</span><span class="token function">bindValue</span><span class="token punctuation">(</span><span class="token string">":id"</span><span class="token punctuation">,</span> idValue<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»‘å®šæ•°æ®</span>
    query2<span class="token punctuation">.</span><span class="token function">bindValue</span><span class="token punctuation">(</span><span class="token string">":name"</span><span class="token punctuation">,</span> nameValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    query2<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰§è¡Œ</span>

    <span class="token comment">//ä½ç½®ç»‘å®š</span>
    query2<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">"insert into student(id, name) values(?, ?)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> idValue2 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    QString nameValue2 <span class="token operator">=</span> <span class="token string">"LingChong"</span><span class="token punctuation">;</span>
    query2<span class="token punctuation">.</span><span class="token function">addBindValue</span><span class="token punctuation">(</span>idValue2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»‘å®šæ•°æ®</span>
    query2<span class="token punctuation">.</span><span class="token function">addBindValue</span><span class="token punctuation">(</span>nameValue2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>query2<span class="token punctuation">.</span><span class="token function">execBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span><span class="token string">"ä½ç½®ç»‘å®šï¼š"</span> <span class="token operator">&lt;&lt;</span>query2<span class="token punctuation">.</span><span class="token function">lastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span><span class="token comment">//å¦‚æœæ‰§è¡Œä¸æˆåŠŸæ‰§è¡Œ</span>

    <span class="token comment">//æ‰¹é‡å¤„ç†</span>
    query2<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">"insert into student(id, name) values(?,?)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QVariantList ids<span class="token punctuation">;</span>
    ids <span class="token operator">&lt;&lt;</span> <span class="token number">6</span> <span class="token operator">&lt;&lt;</span> <span class="token number">7</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span>
    query2<span class="token punctuation">.</span><span class="token function">addBindValue</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QVariantList names<span class="token punctuation">;</span>
    names <span class="token operator">&lt;&lt;</span> <span class="token string">"Qinghua"</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Nanda"</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Zhongkeda"</span><span class="token punctuation">;</span>
    query2<span class="token punctuation">.</span><span class="token function">addBindValue</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>query2<span class="token punctuation">.</span><span class="token function">execBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> query2<span class="token punctuation">.</span><span class="token function">lastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

</code></pre>
    <ul>
     <li>
      <b>
       <i>
        <font color="#ff4757">
         è¿›è¡ŒæŸ¥è¯¢å¹¶è¾“å‡ºæŸ¥è¯¢ç»“æœï¼š
        </font>
       </i>
      </b>
     </li>
    </ul>
    <pre><code class="prism language-cpp">    query2<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"select * from student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰§è¡Œsqlè¯­å¥</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>query2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span> query2<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> query2<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlQuery&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlError&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QVariant&gt;</span></span>

<span class="token comment">// ...</span>

QSqlQuery query<span class="token punctuation">;</span>
<span class="token comment">// ä»¥SELECTè¯­å¥ä¸ºä¾‹ï¼ŒæŸ¥è¯¢ä½ æ„Ÿå…´è¶£çš„è¡¨å’Œå­—æ®µ</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"SELECT column1, column2 FROM your_table"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ä½¿ç”¨value()æ–¹æ³•è·å–å­—æ®µå€¼</span>
        QVariant column1 <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0 æ˜¯ column1 çš„ç´¢å¼•</span>
        QVariant column2 <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 æ˜¯ column2 çš„ç´¢å¼•</span>

        <span class="token comment">// ä½ å¯ä»¥ä½¿ç”¨QVariantçš„è½¬æ¢å‡½æ•°ï¼Œä¾‹å¦‚toInt(), toString()ç­‰æ¥è·å–å…·ä½“çš„ç±»å‹</span>
        <span class="token keyword">int</span> intValue <span class="token operator">=</span> column1<span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        QString stringValue <span class="token operator">=</span> column2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ ¹æ®ä½ çš„éœ€è¦å¤„ç†è¿™äº›æ•°æ®</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// æŸ¥è¯¢å¤±è´¥ï¼Œä½ å¯ä»¥è·å–å¹¶å¤„ç†é”™è¯¯ä¿¡æ¯</span>
    QSqlError error <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">lastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å¤„ç†é”™è¯¯ï¼Œä¾‹å¦‚æ‰“å°é”™è¯¯æ¶ˆæ¯</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Query failed:"</span> <span class="token operator">&lt;&lt;</span> error<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <b>
       <i>
        <font color="#ff4757">
         æŸ¥çœ‹æ•°æ®é©±åŠ¨æ”¯æŒç‰¹æ€§
         <br/>
         æŸ¥çœ‹å½“å‰æ•°æ®åº“æ˜¯å¦æ˜¯æ”¯æŒæŸç‰¹æ€§ï¼Œæ¯”å¦‚å½“å‰è®°å½•çš„ç´¢å¼•æ•°ï¼ˆå³ç»“æœæ¡æ•°ï¼‰ï¼š
        </font>
       </i>
      </b>
     </li>
    </ul>
    <pre><code class="prism language-cpp">    <span class="token keyword">int</span> numRows<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>db2<span class="token punctuation">.</span><span class="token function">driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">hasFeature</span><span class="token punctuation">(</span>QSqlDriver<span class="token double-colon punctuation">::</span>QuerySize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//æ˜¯å¦è¯¥ç‰¹æ€§</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span> <span class="token string">"has feature:query size"</span><span class="token punctuation">;</span>
        numRows <span class="token operator">=</span> query2<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"no feature:query size"</span><span class="token punctuation">;</span>
        query2<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        numRows <span class="token operator">=</span> query2<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//ä½¿ç”¨atï¼Œéœ€è¦ä¹‹å‰ä½¿ç”¨quey2.next()éå†æ‰€æœ‰selectæœç´¢åçš„ç»“æœ,è€Œä½¿ç”¨query2.size()åˆ™ä¸éœ€è¦</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//æ­¤å¤„æ‰§è¡Œä¸Šé¢çš„æŸ¥è¯¢æ“ä½œï¼Œä¸‹é¢çš„æ“ä½œæ‰æœ‰æ„ä¹‰</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"row number: "</span> <span class="token operator">&lt;&lt;</span> numRows<span class="token punctuation">;</span>
    <span class="token comment">//æŒ‡å‘ç´¢å¼•ä¸º1çš„è®°å½•ï¼Œå³ç¬¬äºŒæ¡è®°å½•</span>
    query2<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è¿”å›å½“å‰ç´¢å¼•å€¼</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"current index:"</span> <span class="token operator">&lt;&lt;</span> query2<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è·å¾—å½“å‰è¡Œçš„è®°å½•</span>
    QSqlRecord record <span class="token operator">=</span> query2<span class="token punctuation">.</span><span class="token function">record</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//è·å¾—è®°å½•ä¸­"id"å’Œ"name"ä¸¤ä¸ªå­—æ®µçš„å€¼</span>
    <span class="token keyword">int</span> id <span class="token operator">=</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QString name <span class="token operator">=</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span><span class="token string">"id"</span> <span class="token operator">&lt;&lt;</span> id <span class="token operator">&lt;&lt;</span> <span class="token string">"name:"</span> <span class="token operator">&lt;&lt;</span>name<span class="token punctuation">;</span>

    <span class="token comment">//è·å¾—ç´¢å¼•ä¸º1çš„å­—æ®µï¼Œå³ç¬¬äºŒä¸ªå­—æ®µ</span>
    QSqlField field <span class="token operator">=</span> record<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//è¾“å‡ºå­—æ®µåå’Œå­—æ®µå€¼ï¼Œç»“æœä¸º"name"å’Œ"MaLiang"</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"second field:"</span> <span class="token operator">&lt;&lt;</span> field<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
             <span class="token operator">&lt;&lt;</span> <span class="token string">"field value:"</span> <span class="token operator">&lt;&lt;</span> field<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre>
    <ul>
     <li>
      <b>
       <i>
        <font color="#ff4757">
         äº‹åŠ¡ï¼ˆä½¿æ•°æ®æ“ä½œå˜ä¸ºåŸå­æ€§ï¼‰
         <br/>
         å¦‚æœä¸­é—´æœ‰ä¸€æ­¥sqlæ“ä½œæ‰§è¡Œå‡ºé”™ï¼Œåˆ™å…¨éƒ¨sqlæ“ä½œéƒ½ä¸æ‰§è¡Œã€‚
        </font>
       </i>
      </b>
     </li>
    </ul>
    <pre><code class="prism language-cpp">    QSqlDatabase db2 <span class="token operator">=</span> <span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token string">"connection2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¼€å§‹ï¼ˆç±»ä¼¼äºmutexçº¿ç¨‹é”ï¼‰</span>
    QSqlQuery <span class="token function">query</span><span class="token punctuation">(</span>db2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ­¤è¯­å¥å¿…é¡»åœ¨ä¸Šé¢ä¸€æ¡è¯­å¥çš„åé¢</span>
    <span class="token comment">//æ‰§è¡Œsqlæ“ä½œ</span>
    <span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»“æŸ</span>
</code></pre>
    <h4>
     <a id="242QSqlQueryModel_349">
     </a>
     2.4.2ï¼šä½¿ç”¨QSqlQueryModelæŸ¥è¯¢æ¨¡å‹
    </h4>
    <p>
     ä¼˜åŠ¿ï¼š
    </p>
    <ul>
     <li>
      è¿™æ˜¯åŸºäºsqlæŸ¥è¯¢çš„åªè¯»æ¨¡å‹ï¼Œç¼–å†™sqlè¯­å¥å˜å¾—å®¹æ˜“ã€‚
     </li>
    </ul>
    <p>
     æ–‡ä»¶å¤´ï¼š
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlQueryModel&gt;</span></span>
</code></pre>
    <p>
     æ ¸å¿ƒä»£ç ï¼š
    </p>
    <pre><code class="prism language-cpp">  QSqlDatabase db <span class="token operator">=</span> <span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token string">"connection1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    QSqlQueryModel <span class="token operator">*</span>model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QSqlQueryModel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    model<span class="token operator">-&gt;</span><span class="token function">setQuery</span><span class="token punctuation">(</span><span class="token string">"select * from student"</span><span class="token punctuation">,</span> db<span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token operator">-&gt;</span><span class="token function">setHeaderData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>Horizontal<span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"å­¦å·"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token operator">-&gt;</span><span class="token function">setHeaderData</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>Horizontal<span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"å§“å"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token operator">-&gt;</span><span class="token function">setHeaderData</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>Horizontal<span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"è¯¾ç¨‹"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    QTableView <span class="token operator">*</span>view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QTableView</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    view<span class="token operator">-&gt;</span><span class="token function">setModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">setCentralWidget</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="243QSqlTableModel_377">
     </a>
     2.4.3ï¼šä½¿ç”¨QSqlTableModelè¡¨æ ¼æ¨¡å‹â­
    </h4>
    <p>
     å…ˆä¸Šç»“æœ
     <br/>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/7769c31db24143f7feffb6ac0881166b.png"/>
    </p>
    <p>
     <strong>
      ä¼˜åŠ¿ï¼š
     </strong>
    </p>
    <ul>
     <li>
      <p>
       ç¼–è¯‘çš„ä»£ç å¾ˆå®¹æ˜“é€‚åº”å…¶ä»–çš„æ•°æ®æºï¼Œä¾‹å¦‚åé¢å¦‚æœè¦ä½¿ç”¨xmlæ–‡ä»¶æ¥å­˜å‚¨æ•°æ®ï¼Œåªéœ€è¦æ›´æ¢æ•°æ®æ¨¡å‹ã€‚
      </p>
     </li>
     <li>
      <p>
       æä¾›äº†ä¸€æ¬¡åªèƒ½æ“ä½œä¸€ä¸ªsqlè¡¨çš„è¯»/å†™æ¨¡å‹ï¼Œå¯ä»¥æµè§ˆå’Œä¿®æ”¹ç‹¬ç«‹çš„sqlè¡¨ï¼Œå¹¶ä¸”åªéœ€ç¼–å†™å¾ˆå°‘çš„ä»£ç ï¼Œæ— éœ€äº†è§£sqlè¯­å¥ã€‚
      </p>
     </li>
     <li>
      <p>
       <b>
        <i>
         <font color="#ff4757">
          1 å‡†å¤‡
          <br/>
          å¤´æ–‡ä»¶ï¼š
         </font>
        </i>
       </b>
      </p>
     </li>
    </ul>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlTableModel&gt;</span></span>
</code></pre>
    <pre><code class="prism language-cpp">    QSqlTableModel<span class="token operator">*</span> model<span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºå¯¹è±¡æŒ‡é’ˆ</span>
</code></pre>
    <ul>
     <li>
      <b>
       <i>
        <font color="#ff4757">
         2 è¿›è¡Œæ“ä½œï¼š
        </font>
       </i>
      </b>
     </li>
    </ul>
    <pre><code class="prism language-cpp">    QSqlDatabase db <span class="token operator">=</span> <span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token string">"connection1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QSqlTableModel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> db<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç”±äºåœ¨çª—å£çš„ç±»ä¸­åˆ›å»ºå¯¹è±¡ï¼Œå› æ­¤å®ä¾‹åŒ–å¯¹è±¡æ—¶ï¼Œä½¿ç”¨thisæŒ‡é’ˆï¼ˆæŒ‡å‘æ“ä½œå‡½æ•°çš„æŒ‡é’ˆï¼‰ä½œä¸ºçˆ¶å¯¹è±¡</span>

    model<span class="token operator">-&gt;</span><span class="token function">setTable</span><span class="token punctuation">(</span><span class="token string">"student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰§è¡Œ</span>
    <span class="token comment">//è®¾ç½®ç¼–è¾‘ç­–ç•¥</span>
    model<span class="token operator">-&gt;</span><span class="token function">setEditStrategy</span><span class="token punctuation">(</span>QSqlTableModel<span class="token double-colon punctuation">::</span>OnManualSubmit<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¯¹æ‰€æœ‰æ¨¡å‹æ”¹å˜ç«‹å³ç”¨åˆ°æ•°æ®åº“</span>
    ui<span class="token operator">-&gt;</span>tableView<span class="token operator">-&gt;</span><span class="token function">setModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      <p>
       <b>
        <i>
         <font color="#ff4757">
          UIè®¾è®¡ï¼š
          <br/>
          <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/5f601beabc25dcb500a41930c144f9ae.png"/>
         </font>
        </i>
       </b>
      </p>
     </li>
     <li>
      <p>
       <b>
        <i>
         <font color="#ff4757">
          å¯¹åº”æ§½å‡½æ•°ï¼š
         </font>
        </i>
       </b>
      </p>
     </li>
    </ul>
    <pre><code class="prism language-cpp"><span class="token comment">// æäº¤ä¿®æ”¹æŒ‰é’®</span>
<span class="token keyword">void</span> <span class="token class-name">MainWindow</span><span class="token double-colon punctuation">::</span><span class="token function">on_pushButton_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// å¼€å§‹äº‹åŠ¡æ“ä½œ</span>
    model<span class="token operator">-&gt;</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>model<span class="token operator">-&gt;</span><span class="token function">submitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>model<span class="token operator">-&gt;</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// æäº¤</span>
            <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"tableModel"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                     <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®ä¿®æ”¹æˆåŠŸï¼"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        model<span class="token operator">-&gt;</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å›æ»š</span>
        <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"tableModel"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                             <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®åº“é”™è¯¯: %1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>model<span class="token operator">-&gt;</span><span class="token function">lastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                             QMessageBox<span class="token double-colon punctuation">::</span>Ok<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// æ’¤é”€ä¿®æ”¹æŒ‰é’®</span>
<span class="token keyword">void</span> <span class="token class-name">MainWindow</span><span class="token double-colon punctuation">::</span><span class="token function">on_pushButton_2_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    model<span class="token operator">-&gt;</span><span class="token function">revertAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æŸ¥è¯¢æŒ‰é’®ï¼Œè¿›è¡Œç­›é€‰</span>
<span class="token keyword">void</span> <span class="token class-name">MainWindow</span><span class="token double-colon punctuation">::</span><span class="token function">on_pushButton_5_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    QString name <span class="token operator">=</span> ui<span class="token operator">-&gt;</span>lineEdit<span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ ¹æ®å§“åè¿›è¡Œç­›é€‰ï¼Œä¸€å®šè¦ä½¿ç”¨å•å¼•å·</span>
    model<span class="token operator">-&gt;</span><span class="token function">setFilter</span><span class="token punctuation">(</span><span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"name = '%1'"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æ˜¾ç¤ºå…¨è¡¨æŒ‰é’®</span>
<span class="token keyword">void</span> <span class="token class-name">MainWindow</span><span class="token double-colon punctuation">::</span><span class="token function">on_pushButton_6_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    model<span class="token operator">-&gt;</span><span class="token function">setTable</span><span class="token punctuation">(</span><span class="token string">"student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æŒ‰idå‡åºæ’åˆ—æŒ‰é’®</span>
<span class="token keyword">void</span> <span class="token class-name">MainWindow</span><span class="token double-colon punctuation">::</span><span class="token function">on_pushButton_7_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//idå­—æ®µï¼Œå³ç¬¬0åˆ—ï¼Œå‡åºæ’åˆ—</span>
    model<span class="token operator">-&gt;</span><span class="token function">setSort</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>AscendingOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token comment">// æŒ‰idé™åºæ’åˆ—æŒ‰é’®</span>
<span class="token keyword">void</span> <span class="token class-name">MainWindow</span><span class="token double-colon punctuation">::</span><span class="token function">on_pushButton_8_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    model<span class="token operator">-&gt;</span><span class="token function">setSort</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>DescendingOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token comment">// åˆ é™¤é€‰ä¸­è¡ŒæŒ‰é’®</span>
<span class="token keyword">void</span> <span class="token class-name">MainWindow</span><span class="token double-colon punctuation">::</span><span class="token function">on_pushButton_4_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// è·å–é€‰ä¸­çš„è¡Œ</span>
    <span class="token keyword">int</span> curRow <span class="token operator">=</span> ui<span class="token operator">-&gt;</span>tableView<span class="token operator">-&gt;</span><span class="token function">currentIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// åˆ é™¤è¯¥è¡Œ</span>
    model<span class="token operator">-&gt;</span><span class="token function">removeRow</span><span class="token punctuation">(</span>curRow<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> ok <span class="token operator">=</span> <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"åˆ é™¤å½“å‰è¡Œ!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"ä½ ç¡®å®šåˆ é™¤å½“å‰è¡Œå—ï¼Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> QMessageBox<span class="token double-colon punctuation">::</span>Yes<span class="token punctuation">,</span> QMessageBox<span class="token double-colon punctuation">::</span>No<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ok <span class="token operator">==</span> QMessageBox<span class="token double-colon punctuation">::</span>No<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span> <span class="token comment">// å¦‚æœä¸åˆ é™¤ï¼Œåˆ™æ’¤é”€</span>
        model<span class="token operator">-&gt;</span><span class="token function">revertAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// å¦åˆ™æäº¤ï¼Œåœ¨æ•°æ®åº“ä¸­åˆ é™¤è¯¥è¡Œ</span>
        model<span class="token operator">-&gt;</span><span class="token function">submitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token comment">// æ·»åŠ è®°å½•æŒ‰é’®</span>
<span class="token keyword">void</span> <span class="token class-name">MainWindow</span><span class="token double-colon punctuation">::</span><span class="token function">on_pushButton_3_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// è·å¾—è¡¨çš„è¡Œæ•°</span>
    <span class="token keyword">int</span> rowNum <span class="token operator">=</span> model<span class="token operator">-&gt;</span><span class="token function">rowCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> id <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token comment">// æ·»åŠ ä¸€è¡Œ</span>
    model<span class="token operator">-&gt;</span><span class="token function">insertRow</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token operator">-&gt;</span><span class="token function">setData</span><span class="token punctuation">(</span>model<span class="token operator">-&gt;</span><span class="token function">index</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// å¯ä»¥ç›´æ¥æäº¤</span>
    <span class="token comment">//model-&gt;submitAll();</span>
<span class="token punctuation">}</span>


</code></pre>
    <h2>
     <a id="_504">
     </a>
     ä¸‰ã€é¡¹ç›®å®æˆ˜
    </h2>
    <p>
     <code>
      connection.h
     </code>
     æ˜¯è´Ÿè´£è¿æ¥æ•°æ®åº“å’Œåˆ›å»ºè¡¨çš„å¤´æ–‡ä»¶ï¼š
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">CONNECTION_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CONNECTION_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QMessageBox&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlDatabase&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlQuery&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QDebug&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">execution_character_set</span><span class="token punctuation">(</span></span><span class="token string">"utf-8"</span><span class="token expression"><span class="token punctuation">)</span><span class="token punctuation">;</span> </span></span>

<span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//è¿æ¥ç¬¬ä¸€ä¸ªæ•°æ®åº“</span>
    <span class="token comment">//QMYSQL</span>
    QSqlDatabase db <span class="token operator">=</span> <span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">addDatabase</span><span class="token punctuation">(</span><span class="token string">"QODBC"</span><span class="token punctuation">,</span> <span class="token string">"connection1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//éœ€è¦ä½¿ç”¨çš„æ•°æ®åº“é©±åŠ¨å’Œè”æ£€å»ºç«‹çš„åç§°ï¼ˆæ–¹ä¾¿å»ºç«‹å¤šä¸ªæ•°æ®åº“è¿æ¥ã€ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“æ—¶ã€‘åŒºåˆ†ï¼‰</span>
    db<span class="token punctuation">.</span><span class="token function">setHostName</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿æ¥åœ°å€</span>
    db<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ•°æ®åº“è´¦æˆ·</span>
    db<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"55667788"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¯†ç </span>
    db<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">3306</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç«¯å£</span>
    <span class="token comment">//test.db</span>
    db<span class="token punctuation">.</span><span class="token function">setDatabaseName</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//éœ€è¦ç”¨åˆ°çš„æ•°æ®åº“</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>db<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//å¦‚æœæ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œåˆ™å¼¹å‡º</span>
        <span class="token comment">//critical(QWidget *parent, const QString &amp;title,</span>
        <span class="token comment">//const QString &amp;text,</span>
        <span class="token comment">//QMessageBox::StandardButtons buttons = Ok,</span>
        <span class="token comment">//QMessageBox::StandardButton defaultButton = NoButton)</span>
        <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">critical</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Cannot open database"</span><span class="token punctuation">,</span>
            <span class="token string">"Unable to establish a database connection"</span><span class="token punctuation">,</span> QMessageBox<span class="token double-colon punctuation">::</span>Cancel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"infor"</span><span class="token punctuation">,</span> <span class="token string">"link success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//ä¸‹é¢æ¥åˆ›å»ºè¡¨</span>
    <span class="token comment">//å¦‚æœMySQLæ•°æ®åº“ä¸­å·²ç»å­˜åœ¨åŒåçš„è¡¨ï¼Œåˆ™ä¸‹é¢ä»£ç ä¸ä¼šæ‰§è¡Œ</span>
    QSqlQuery <span class="token function">query2</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
   
    <span class="token comment">// qDebug() &lt;&lt; "connection2:";</span>
<span class="token comment">//åˆ›å»ºè¡¨ï¼Œå¹¶æ’å…¥å€¼</span>
    query2<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"create table student (id int primary key,"</span>
        <span class="token string">"name varchar(20))"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    query2<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"insert into student values(0, 'Mike')"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    query2<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"insert into student values(1, 'Lili')"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    query2<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"insert into student values(2, 'Jame')"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// CONNECTION_H</span></span>
</code></pre>
    <p>
     <code>
      Admin
     </code>
     æ˜¯æ“ä½œæ•°æ®åº“çš„ç®¡ç†ç•Œé¢ï¼š
     <br/>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/24a4e8efcefa6c27bac8a04139210151.png"/>
     <br/>
     <code>
      Admin.h
     </code>
     :
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QMainWindow&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ui_Admin.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlTableModel&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">execution_character_set</span><span class="token punctuation">(</span></span><span class="token string">"utf-8"</span><span class="token expression"><span class="token punctuation">)</span><span class="token punctuation">;</span> </span></span>

<span class="token keyword">class</span> <span class="token class-name">Admin</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QMainWindow</span></span>
<span class="token punctuation">{<!-- --></span>
	Q_OBJECT

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Admin</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">~</span><span class="token function">Admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	QSqlTableModel<span class="token operator">*</span> model<span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºå¯¹è±¡æŒ‡é’ˆ</span>


<span class="token keyword">private</span><span class="token operator">:</span>
	Ui<span class="token double-colon punctuation">::</span>AdminClass ui<span class="token punctuation">;</span>

<span class="token keyword">private</span> slots<span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">on_add_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">on_modify_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">on_del_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">on_rollback_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">on_show_all_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre>
    <p>
     <code>
      Admin.cpp
     </code>
     :
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Admin.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;qmessagebox.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlDatabase&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QMessageBox&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;qsqlerror.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"connection.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlTableModel&gt;</span></span>

<span class="token class-name">Admin</span><span class="token double-colon punctuation">::</span><span class="token function">Admin</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent<span class="token punctuation">)</span>
	<span class="token operator">:</span> <span class="token function">QMainWindow</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	ui<span class="token punctuation">.</span><span class="token function">setupUi</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    QSqlDatabase db <span class="token operator">=</span> <span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token string">"connection1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QSqlTableModel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> db<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç”±äºåœ¨çª—å£çš„ç±»ä¸­åˆ›å»ºå¯¹è±¡ï¼Œå› æ­¤å®ä¾‹åŒ–å¯¹è±¡æ—¶ï¼Œä½¿ç”¨thisæŒ‡é’ˆï¼ˆæŒ‡å‘æ“ä½œå‡½æ•°çš„æŒ‡é’ˆï¼‰ä½œä¸ºçˆ¶å¯¹è±¡</span>

    model<span class="token operator">-&gt;</span><span class="token function">setTable</span><span class="token punctuation">(</span><span class="token string">"student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰§è¡Œ</span>
    QTableView<span class="token operator">*</span> view <span class="token operator">=</span> <span class="token keyword">new</span> QTableView<span class="token punctuation">;</span>
    view<span class="token operator">-&gt;</span><span class="token function">setModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ä½ å¯ä»¥æ ¹æ®ä½ æ•°æ®åº“è¡¨çš„å®é™…åˆ—åè¿›è¡Œè®¾ç½®</span>
    QHeaderView<span class="token operator">*</span> header <span class="token operator">=</span> view<span class="token operator">-&gt;</span><span class="token function">horizontalHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    header<span class="token operator">-&gt;</span><span class="token function">setModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    header<span class="token operator">-&gt;</span><span class="token function">setSectionResizeMode</span><span class="token punctuation">(</span>QHeaderView<span class="token double-colon punctuation">::</span>Stretch<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è®¾ç½®æ˜¾ç¤ºåç§°ï¼Œä»0å¼€å§‹è®¡æ•°</span>
    model<span class="token operator">-&gt;</span><span class="token function">setHeaderData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>Horizontal<span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"åˆ—å1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token operator">-&gt;</span><span class="token function">setHeaderData</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>Horizontal<span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"åˆ—å2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token operator">-&gt;</span><span class="token function">setHeaderData</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>Horizontal<span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"åˆ—å3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è®¾ç½®ç¼–è¾‘ç­–ç•¥</span>
    model<span class="token operator">-&gt;</span><span class="token function">setEditStrategy</span><span class="token punctuation">(</span>QSqlTableModel<span class="token double-colon punctuation">::</span>OnManualSubmit<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¯¹æ‰€æœ‰æ¨¡å‹æ”¹å˜ç«‹å³ç”¨åˆ°æ•°æ®åº“</span>
    ui<span class="token punctuation">.</span>tableView<span class="token operator">-&gt;</span><span class="token function">setModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token punctuation">}</span>

<span class="token class-name">Admin</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token comment">// æ·»åŠ è®°å½•æŒ‰é’®</span>
<span class="token keyword">void</span> <span class="token class-name">Admin</span><span class="token double-colon punctuation">::</span><span class="token function">on_add_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// è·å¾—è¡¨çš„è¡Œæ•°</span>
    <span class="token keyword">int</span> rowNum <span class="token operator">=</span> model<span class="token operator">-&gt;</span><span class="token function">rowCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> id <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token comment">// æ·»åŠ ä¸€è¡Œ</span>
    model<span class="token operator">-&gt;</span><span class="token function">insertRow</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token operator">-&gt;</span><span class="token function">setData</span><span class="token punctuation">(</span>model<span class="token operator">-&gt;</span><span class="token function">index</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// å¯ä»¥ç›´æ¥æäº¤</span>
    <span class="token comment">//model-&gt;submitAll();</span>
<span class="token punctuation">}</span>

<span class="token comment">// åˆ é™¤é€‰ä¸­è¡ŒæŒ‰é’®</span>
<span class="token keyword">void</span> <span class="token class-name">Admin</span><span class="token double-colon punctuation">::</span><span class="token function">on_del_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// è·å–é€‰ä¸­çš„è¡Œ</span>
    <span class="token keyword">int</span> curRow <span class="token operator">=</span> ui<span class="token punctuation">.</span>tableView<span class="token operator">-&gt;</span><span class="token function">currentIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// åˆ é™¤è¯¥è¡Œ</span>
    model<span class="token operator">-&gt;</span><span class="token function">removeRow</span><span class="token punctuation">(</span>curRow<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> ok <span class="token operator">=</span> <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"åˆ é™¤å½“å‰è¡Œ!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"ä½ ç¡®å®šåˆ é™¤å½“å‰è¡Œå—ï¼Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> QMessageBox<span class="token double-colon punctuation">::</span>Yes<span class="token punctuation">,</span> QMessageBox<span class="token double-colon punctuation">::</span>No<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ok <span class="token operator">==</span> QMessageBox<span class="token double-colon punctuation">::</span>No<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span> <span class="token comment">// å¦‚æœä¸åˆ é™¤ï¼Œåˆ™æ’¤é”€</span>
        model<span class="token operator">-&gt;</span><span class="token function">revertAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// å¦åˆ™æäº¤ï¼Œåœ¨æ•°æ®åº“ä¸­åˆ é™¤è¯¥è¡Œ</span>
        model<span class="token operator">-&gt;</span><span class="token function">submitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token comment">// æ’¤é”€ä¿®æ”¹æŒ‰é’®</span>
<span class="token keyword">void</span> <span class="token class-name">Admin</span><span class="token double-colon punctuation">::</span><span class="token function">on_rollback_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    model<span class="token operator">-&gt;</span><span class="token function">revertAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æäº¤ä¿®æ”¹æŒ‰é’®</span>
<span class="token keyword">void</span> <span class="token class-name">Admin</span><span class="token double-colon punctuation">::</span><span class="token function">on_modify_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// å¼€å§‹äº‹åŠ¡æ“ä½œ</span>
    model<span class="token operator">-&gt;</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>model<span class="token operator">-&gt;</span><span class="token function">submitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>model<span class="token operator">-&gt;</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// æäº¤</span>
            <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"tableModel"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®ä¿®æ”¹æˆåŠŸï¼"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        model<span class="token operator">-&gt;</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å›æ»š</span>
        <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"tableModel"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®åº“é”™è¯¯: %1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>model<span class="token operator">-&gt;</span><span class="token function">lastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            QMessageBox<span class="token double-colon punctuation">::</span>Ok<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// æ˜¾ç¤ºå…¨è¡¨æŒ‰é’®</span>
<span class="token keyword">void</span> <span class="token class-name">Admin</span><span class="token double-colon punctuation">::</span><span class="token function">on_show_all_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    model<span class="token operator">-&gt;</span><span class="token function">setTable</span><span class="token punctuation">(</span><span class="token string">"student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     åŠŸèƒ½æ­£å¸¸ï¼š
     <br/>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/c563894fd0bef5cb30f2a5a31d59cfa4.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f59616f79616f323032342f:61727469636c652f64657461696c732f313336333236323335" class_="artid" style="display:none">
 </p>
</div>


