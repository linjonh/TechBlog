---
layout: post
title: "后端技术-cors实现请求跨域"
date: 2024-12-21 14:27:02 +0800
description: "简介CORS：全称\"跨域资源共享\"（Cross-origin resource sharing）。C"
keywords: "js cors 后端是不是也要开跨域"
categories: ['']
tags: ['Python']
artid: "104327581"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=104327581
    alt: "后端技术-cors实现请求跨域"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     后端技术-cors实现请求跨域
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-dracula" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <div class="article_content clearfix" id="article_content">
     <div class="htmledit_views" id="content_views">
      <h3>
       简介
      </h3>
     </div>
    </div>
    <p>
     CORS：全称"跨域资源共享"（Cross-origin resource sharing）。
    </p>
    <p>
     CORS需要浏览器和服务器同时支持，才可以实现跨域请求，目前几乎所有浏览器都支持CORS，IE则不能低于IE10。CORS的整个过程都由浏览器自动完成，前端无需做任何设置，跟平时发送ajax请求并无差异。so，实现CORS的关键在于服务器，只要服务器实现CORS接口，就可以实现跨域通信。
    </p>
    <h3>
     请求类型：
    </h3>
    <p>
     CORS分为简单请求和非简单请求(需预检请求)两类
    </p>
    <p>
     <strong>
      符合以下条件的，为简单请求
     </strong>
    </p>
    <pre class="has"><code class="hljs vbnet"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     请求方式使用下列方法之一：
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">GET</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     HEAD
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     POST
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line"> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     Content-Type 的值仅限于下列三者之一：
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">text</span>/plain
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     multipart/form-data
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     application/x-www-form-urlencoded
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button signin"></div></pre>
    <p>
     对于简单请求，浏览器会直接发送CORS请求，具体说来就是在header中加入origin请求头字段。同样，在响应头中，返回服务器设置的相关CORS头部字段，Access-Control-Allow-Origin字段为允许跨域请求的源。请求时浏览器在请求头的Origin中说明请求的源，服务器收到后发现允许该源跨域请求，则会成功返回，具体如下：
    </p>
    <p>
     <img alt="" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/6d38e177c485d04e9ce46c395b1b1ffd.png"/>
    </p>
    <p>
     在这里，http://localhost:3001为我们当前发送请求的源，如果服务器发现请求在指定的源范围内，则会返回响应的请求结果， 否则会在控制台报错，如下图所示，在这里需要注意的是，尽管请求失败，但返回的状态码依然可能为200。所以在做处理时需要格外注意。
    </p>
    <p>
     <img alt="" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/9826294aee9645fac3ba1a894cc6b94a.png"/>
    </p>
    <p>
     <strong>
      非简单请求(预检请求)
     </strong>
    </p>
    <pre class="has"><code class="hljs sql"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     使用了下面任一 HTTP 方法：
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     PUT
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">DELETE</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">CONNECT</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     OPTIONS
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">TRACE</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">PATCH</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line"> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">Content</span>-
     
     <span class="hljs-keyword">Type</span> 的值不属于下列之一:
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     application/x-www-
     
     <span class="hljs-keyword">form</span>-urlencoded
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     multipart/
     
     <span class="hljs-keyword">form</span>-
     
     <span class="hljs-keyword">data</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-built_in">text</span>/plain
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button signin"></div></pre>
    <p>
     当发生符合非简单请求（预检请求）的条件时，浏览器会自动先发送一个options请求，如果发现服务器支持该请求，则会将真正的请求发送到后端，反之，如果浏览器发现服务端并不支持该请求，则会在控制台抛出错误，如下：
    </p>
    <p>
     <img alt="" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/08f4b017a572dc4da126e8a9edeab934.png"/>
    </p>
    <p>
     如果非简单请求（预检请求）发送成功，则会在头部多返回以下字段
    </p>
    <pre><code class="hljs java"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     Access-Control-Allow-Origin: 
     
     <a href="http://api.bob.com/" rel="nofollow">http:<span class="hljs-comment">//</span></a>
     
     <span class="hljs-comment">localhost:3001  //该字段表明可供那个源跨域</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     Access-Control-Allow-Methods: GET, POST, PUT        
     
     <span class="hljs-comment">// 该字段表明服务端支持的请求方法</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     Access-Control-Allow-Headers: X-Custom-Header       
     
     <span class="hljs-comment">// 实际请求将携带的自定义请求首部字段</span>
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button signin"></div></pre>
    <p>
     下图为一个预检请求实例：
    </p>
    <p>
     <img alt="" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/70529b4fdd12d39a80c0966602d62333.png"/>
    </p>
    <p>
     红框标注的为预检请求发送的查询，服务端支持我们的请求后，将会发送我们真正的请求，图中绿框所示。可以看到，真正的请求响应头字段多处蓝框中所圈字段。这为服务器所支持cors请求类型和允许的自定义请求首部字段，以及支持跨域的源。
    </p>
    <h3>
     <strong>
      实例代码
     </strong>
    </h3>
    <p>
     前端代码与发送普通请求没有差异，我们只需在服务端设置即可，以node为例：
    </p>
    <pre class="has"><code class="language-javascript hljs"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">var</span> express = 
     
     <span class="hljs-built_in">require</span>(
     
     <span class="hljs-string">'express'</span>);
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">var</span> app = express();
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">var</span> allowCrossDomain = 
     
     <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) </span>{
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
       res.header(
     
     <span class="hljs-string">'Access-Control-Allow-Origin'</span>, 
     
     <span class="hljs-string">'http://localhost:3001'</span>);
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
       res.header(
     
     <span class="hljs-string">'Access-Control-Allow-Methods'</span>, 
     
     <span class="hljs-string">'GET,PUT,POST,DELETE'</span>);
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
       res.header(
     
     <span class="hljs-string">'Access-Control-Allow-Headers'</span>, 
     
     <span class="hljs-string">'Content-Type'</span>);
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
       next();
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     }
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     app.use(allowCrossDomain);
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button signin"></div></pre>
    <p>
     接下来，http://localhost:3001下的GET,PUT,POST,DELETE请求，自定义首部字段为Content-Type的非简单请求则会被正常访问，当然，你也可以将Access-control-Allow-Methods和Access-Control-Allow-Headers这两个配置删掉，删掉之后，将仅支持简单请求进行跨域。
    </p>
    <h3>
     CORS字段介绍：
    </h3>
    <p>
     <strong>
      （1）Access-Control-Allow-Methods
     </strong>
    </p>
    <p>
     该字段必需，它的值是逗号分隔的一个字符串，表明服务器支持的所有跨域请求的方法。注意，返回的是所有支持的方法，而不单是浏览器请求的那个方法。这是为了避免多次"预检"请求。
    </p>
    <p>
     <strong>
      （2）Access-Control-Allow-Headers
     </strong>
    </p>
    <p>
     如果浏览器请求包括
     <code>
      Access-Control-Request-Headers
     </code>
     字段，则
     <code>
      Access-Control-Allow-Headers
     </code>
     字段是必需的。它也是一个逗号分隔的字符串，表明服务器支持的所有头信息字段，不限于浏览器在"预检"中请求的字段。
    </p>
    <p>
     <strong>
      （3）Access-Control-Allow-Credentials
     </strong>
    </p>
    <p>
     该字段与简单请求时的含义相同。
    </p>
    <p>
     <strong>
      （4）Access-Control-Max-Age
     </strong>
    </p>
    <p>
     该字段可选，用来指定本次预检请求的有效期，单位为秒。上面结果中，有效期是20天（1728000秒），即允许缓存该条回应1728000秒（即20天），在此期间，不用发出另一条预检请求。
    </p>
    <h3>
     总结：
    </h3>
    <p>
     总的来说，使用CORS简单请求，非常容易，对于前端来说无需做任何配置，与发送普通ajax请求无异。唯一需要注意的是，需要携带cookie信息时，需要将withCredentials设置为true即可。CORS的配置，完全在后端设置，配置起来也比较容易，目前对于大部分浏览器兼容性也比较好。CORS优势也比较明显，可以实现任何类型的请求，相较于JSONP跨域只能使用get请求来说，也更加的便于我们使用。关于jsonp跨域请求的实现，可以参照我另外一篇文章
     <a href="https://blog.csdn.net/badmoonc/article/details/82289252">
      jsonp跨域原理
     </a>
    </p>
    <div class="more-toolbox">
     <div class="left-toolbox">
      <ul class="toolbox-list">
       <li>
        <pre><code>                    &lt;li class="tool-item tool-active is-like "&gt;&lt;a href="javascript:;"&gt;&lt;svg class="icon" aria-hidden="true"&gt;
                        &lt;use xlink:href="#csdnc-thumbsup"&gt;&lt;/use&gt;
                    &lt;/svg&gt;&lt;span class="name"&gt;点赞&lt;/span&gt;
                    &lt;span class="count"&gt;3&lt;/span&gt;
                    &lt;/a&gt;&lt;/li&gt;
                    &lt;li class="tool-item tool-active is-collection "&gt;&lt;a href="javascript:;" data-report-click="{&amp;quot;mod&amp;quot;:&amp;quot;popu_824&amp;quot;}"&gt;&lt;svg class="icon" aria-hidden="true"&gt;
                        &lt;use xlink:href="#icon-csdnc-Collection-G"&gt;&lt;/use&gt;
                    &lt;/svg&gt;&lt;span class="name"&gt;收藏&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
                    &lt;li class="tool-item tool-active is-share"&gt;&lt;a href="javascript:;"&gt;&lt;svg class="icon" aria-hidden="true"&gt;
                        &lt;use xlink:href="#icon-csdnc-fenxiang"&gt;&lt;/use&gt;
                    &lt;/svg&gt;分享&lt;/a&gt;&lt;/li&gt;
                    &lt;!--打赏开始--&gt;
                                            &lt;!--打赏结束--&gt;
                                            &lt;li class="tool-item tool-more"&gt;
                        &lt;a&gt;
                        &lt;svg t="1575545411852" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5717" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"&gt;&lt;defs&gt;&lt;style type="text/css"&gt;&lt;/style&gt;&lt;/defs&gt;&lt;path d="M179.176 499.222m-113.245 0a113.245 113.245 0 1 0 226.49 0 113.245 113.245 0 1 0-226.49 0Z" p-id="5718"&gt;&lt;/path&gt;&lt;path d="M509.684 499.222m-113.245 0a113.245 113.245 0 1 0 226.49 0 113.245 113.245 0 1 0-226.49 0Z" p-id="5719"&gt;&lt;/path&gt;&lt;path d="M846.175 499.222m-113.245 0a113.245 113.245 0 1 0 226.49 0 113.245 113.245 0 1 0-226.49 0Z" p-id="5720"&gt;&lt;/path&gt;&lt;/svg&gt;
                        &lt;/a&gt;
                        &lt;ul class="more-box"&gt;
                            &lt;li class="item"&gt;&lt;a class="article-report"&gt;文章举报&lt;/a&gt;&lt;/li&gt;
                        &lt;/ul&gt;
                    &lt;/li&gt;
                                        &lt;/ul&gt;
            &lt;/div&gt;
                        &lt;/div&gt;
        &lt;div class="person-messagebox"&gt;
            &lt;div class="left-message"&gt;&lt;a href="https://blog.csdn.net/badmoonc"&gt;
                &lt;img src="https://profile.csdnimg.cn/C/C/1/3_badmoonc" class="avatar_pic" username="badmoonc"&gt;
                                        &lt;img src="https://g.csdnimg.cn/static/user-reg-year/2x/2.png" class="user-years"&gt;
                                &lt;/a&gt;&lt;/div&gt;
            &lt;div class="middle-message"&gt;
                                    &lt;div class="title"&gt;&lt;span class="tit"&gt;&lt;a href="https://blog.csdn.net/badmoonc" data-report-click="{&amp;quot;mod&amp;quot;:&amp;quot;popu_379&amp;quot;}" target="_blank"&gt;姓赵的赵先生&lt;/a&gt;&lt;/span&gt;
                                        &lt;/div&gt;
                &lt;div class="text"&gt;&lt;span&gt;发布了40 篇原创文章&lt;/span&gt; · &lt;span&gt;获赞 60&lt;/span&gt; · &lt;span&gt;访问量 16万+&lt;/span&gt;&lt;/div&gt;
            &lt;/div&gt;
                            &lt;div class="right-message"&gt;
                                        &lt;a href="https://im.csdn.net/im/main.html?userName=badmoonc" target="_blank" class="btn btn-sm btn-red-hollow bt-button personal-letter"&gt;私信
                    &lt;/a&gt;
                                                        &lt;a class="btn btn-sm  bt-button personal-watch" data-report-click="{&amp;quot;mod&amp;quot;:&amp;quot;popu_379&amp;quot;}"&gt;关注&lt;/a&gt;
                                &lt;/div&gt;
                        &lt;/div&gt;
                &lt;/div&gt;
</code></pre>
       </li>
      </ul>
     </div>
    </div>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34343633333935312f:61727469636c652f64657461696c732f313034333237353831" class_="artid" style="display:none">
 </p>
</div>


