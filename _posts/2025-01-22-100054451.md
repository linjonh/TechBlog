---
layout: post
title: "kNN算法调参-超参数和网格搜索"
date: 2025-01-22 22:35:42 +0800
description: "调参 - 超参数和网格搜索提升机器学习预测准确率的方式搞数据(特征工程)增加样本数据行数（样本数量）"
keywords: "knn调参"
categories: ['大数据']
tags: ['监督学习', '机器学习', 'Knn']
artid: "100054451"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=100054451
    alt: "kNN算法调参-超参数和网格搜索"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     kNN算法调参--超参数和网格搜索
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-github-gist" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="___1">
     </a>
     调参 - 超参数和网格搜索
    </h2>
    <hr/>
    <p>
     提升机器学习预测准确率的方式
    </p>
    <ul>
     <li>
      搞数据(特征工程)
      <ul>
       <li>
        增加样本数据行数（样本数量）
       </li>
       <li>
        增加样本数据列数（特征）
       </li>
      </ul>
     </li>
     <li>
      搞算法
      <ul>
       <li>
        调包
       </li>
       <li>
        调参
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <ul>
     <li>
      超参数：算法运行前需要决定的参数
     </li>
     <li>
      模型参数：算法训练中学习到的参数
      <ul>
       <li>
        y = a * x + b
       </li>
      </ul>
     </li>
    </ul>
    <p>
     例如：决策树算法中，max_depth分支最大深度就是超参数；而分支阈值就是模型参数
    </p>
    <p>
     要寻找既不过拟合，预测准确率又高的超参数需要：（既便宜又好，互相矛盾，取一个中间值，性价比最高）
    </p>
    <ul>
     <li>
      领域知识：了解业务
     </li>
     <li>
      经验数值：默认值
     </li>
     <li>
      遍历搜索：遍历运行并比较大量超参数，挑出最优值
      <ul>
       <li>
        网格搜索
       </li>
      </ul>
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
</code></pre>
    <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets

<span class="token comment"># 手写数字数据集</span>
digits <span class="token operator">=</span> datasets<span class="token punctuation">.</span>load_digits<span class="token punctuation">(</span><span class="token punctuation">)</span>
digits
</code></pre>
    <pre><code>{'data': array([[ 0.,  0.,  5., ...,  0.,  0.,  0.],
        [ 0.,  0.,  0., ..., 10.,  0.,  0.],
        [ 0.,  0.,  0., ..., 16.,  9.,  0.],
        ...,
        [ 0.,  0.,  1., ...,  6.,  0.,  0.],
        [ 0.,  0.,  2., ..., 12.,  0.,  0.],
        [ 0.,  0., 10., ..., 12.,  1.,  0.]]),
 'target': array([0, 1, 2, ..., 8, 9, 8]),
 'target_names': array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9]),
 'images': array([[[ 0.,  0.,  5., ...,  1.,  0.,  0.],
         [ 0.,  0., 13., ..., 15.,  5.,  0.],
         [ 0.,  3., 15., ..., 11.,  8.,  0.],
         ...,
         [ 0.,  4., 11., ..., 12.,  7.,  0.],
         [ 0.,  2., 14., ..., 12.,  0.,  0.],
         [ 0.,  0.,  6., ...,  0.,  0.,  0.]],
 
        [[ 0.,  0.,  0., ...,  5.,  0.,  0.],
         [ 0.,  0.,  0., ...,  9.,  0.,  0.],
         [ 0.,  0.,  3., ...,  6.,  0.,  0.],
         ...,
         [ 0.,  0.,  1., ...,  6.,  0.,  0.],
         [ 0.,  0.,  1., ...,  6.,  0.,  0.],
         [ 0.,  0.,  0., ..., 10.,  0.,  0.]],
 
        [[ 0.,  0.,  0., ..., 12.,  0.,  0.],
         [ 0.,  0.,  3., ..., 14.,  0.,  0.],
         [ 0.,  0.,  8., ..., 16.,  0.,  0.],
         ...,
         [ 0.,  9., 16., ...,  0.,  0.,  0.],
         [ 0.,  3., 13., ..., 11.,  5.,  0.],
         [ 0.,  0.,  0., ..., 16.,  9.,  0.]],
 
        ...,
 
        [[ 0.,  0.,  1., ...,  1.,  0.,  0.],
         [ 0.,  0., 13., ...,  2.,  1.,  0.],
         [ 0.,  0., 16., ..., 16.,  5.,  0.],
         ...,
         [ 0.,  0., 16., ..., 15.,  0.,  0.],
         [ 0.,  0., 15., ..., 16.,  0.,  0.],
         [ 0.,  0.,  2., ...,  6.,  0.,  0.]],
 
        [[ 0.,  0.,  2., ...,  0.,  0.,  0.],
         [ 0.,  0., 14., ..., 15.,  1.,  0.],
         [ 0.,  4., 16., ..., 16.,  7.,  0.],
         ...,
         [ 0.,  0.,  0., ..., 16.,  2.,  0.],
         [ 0.,  0.,  4., ..., 16.,  2.,  0.],
         [ 0.,  0.,  5., ..., 12.,  0.,  0.]],
 
        [[ 0.,  0., 10., ...,  1.,  0.,  0.],
         [ 0.,  2., 16., ...,  1.,  0.,  0.],
         [ 0.,  0., 15., ..., 15.,  0.,  0.],
         ...,
         [ 0.,  4., 16., ..., 16.,  6.,  0.],
         [ 0.,  8., 16., ..., 16.,  8.,  0.],
         [ 0.,  1.,  8., ..., 12.,  1.,  0.]]]),
 'DESCR': ".. _digits_dataset:\n\nOptical recognition of handwritten digits dataset\n--------------------------------------------------\n\n**Data Set Characteristics:**\n\n    :Number of Instances: 5620\n    :Number of Attributes: 64\n    :Attribute Information: 8x8 image of integer pixels in the range 0..16.\n    :Missing Attribute Values: None\n    :Creator: E. Alpaydin (alpaydin '@' boun.edu.tr)\n    :Date: July; 1998\n\nThis is a copy of the test set of the UCI ML hand-written digits datasets\nhttps://archive.ics.uci.edu/ml/datasets/Optical+Recognition+of+Handwritten+Digits\n\nThe data set contains images of hand-written digits: 10 classes where\neach class refers to a digit.\n\nPreprocessing programs made available by NIST were used to extract\nnormalized bitmaps of handwritten digits from a preprinted form. From a\ntotal of 43 people, 30 contributed to the training set and different 13\nto the test set. 32x32 bitmaps are divided into nonoverlapping blocks of\n4x4 and the number of on pixels are counted in each block. This generates\nan input matrix of 8x8 where each element is an integer in the range\n0..16. This reduces dimensionality and gives invariance to small\ndistortions.\n\nFor info on NIST preprocessing routines, see M. D. Garris, J. L. Blue, G.\nT. Candela, D. L. Dimmick, J. Geist, P. J. Grother, S. A. Janet, and C.\nL. Wilson, NIST Form-Based Handprint Recognition System, NISTIR 5469,\n1994.\n\n.. topic:: References\n\n  - C. Kaynak (1995) Methods of Combining Multiple Classifiers and Their\n    Applications to Handwritten Digit Recognition, MSc Thesis, Institute of\n    Graduate Studies in Science and Engineering, Bogazici University.\n  - E. Alpaydin, C. Kaynak (1998) Cascading Classifiers, Kybernetika.\n  - Ken Tang and Ponnuthurai N. Suganthan and Xi Yao and A. Kai Qin.\n    Linear dimensionalityreduction using relevance weighted LDA. School of\n    Electrical and Electronic Engineering Nanyang Technological University.\n    2005.\n  - Claudio Gentile. A New Approximate Maximal Margin Classification\n    Algorithm. NIPS. 2000."}
</code></pre>
    <pre><code class="prism language-python">digits<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code>dict_keys(['data', 'target', 'target_names', 'images', 'DESCR'])
</code></pre>
    <p>
     特征：64个像素
    </p>
    <pre><code class="prism language-python">digits<span class="token punctuation">.</span>data
</code></pre>
    <pre><code>array([[ 0.,  0.,  5., ...,  0.,  0.,  0.],
       [ 0.,  0.,  0., ..., 10.,  0.,  0.],
       [ 0.,  0.,  0., ..., 16.,  9.,  0.],
       ...,
       [ 0.,  0.,  1., ...,  6.,  0.,  0.],
       [ 0.,  0.,  2., ..., 12.,  0.,  0.],
       [ 0.,  0., 10., ..., 12.,  1.,  0.]])
</code></pre>
    <pre><code class="prism language-python">X <span class="token operator">=</span> digits<span class="token punctuation">.</span>data
y <span class="token operator">=</span> digits<span class="token punctuation">.</span>target
X<span class="token punctuation">,</span>X<span class="token punctuation">.</span>shape
</code></pre>
    <pre><code>(array([[ 0.,  0.,  5., ...,  0.,  0.,  0.],
        [ 0.,  0.,  0., ..., 10.,  0.,  0.],
        [ 0.,  0.,  0., ..., 16.,  9.,  0.],
        ...,
        [ 0.,  0.,  1., ...,  6.,  0.,  0.],
        [ 0.,  0.,  2., ..., 12.,  0.,  0.],
        [ 0.,  0., 10., ..., 12.,  1.,  0.]]), (1797, 64))
</code></pre>
    <pre><code class="prism language-python">y<span class="token punctuation">,</span>y<span class="token punctuation">.</span>shape
</code></pre>
    <pre><code>(array([0, 1, 2, ..., 8, 9, 8]), (1797,))
</code></pre>
    <pre><code class="prism language-python">X<span class="token punctuation">[</span><span class="token number">666</span><span class="token punctuation">]</span>
</code></pre>
    <pre><code>array([ 0.,  0.,  5., 15., 14.,  3.,  0.,  0.,  0.,  0., 13., 15.,  9.,
       15.,  2.,  0.,  0.,  4., 16., 12.,  0., 10.,  6.,  0.,  0.,  8.,
       16.,  9.,  0.,  8., 10.,  0.,  0.,  7., 15.,  5.,  0., 12., 11.,
        0.,  0.,  7., 13.,  0.,  5., 16.,  6.,  0.,  0.,  0., 16., 12.,
       15., 13.,  1.,  0.,  0.,  0.,  6., 16., 12.,  2.,  0.,  0.])
</code></pre>
    <pre><code class="prism language-python"><span class="token comment"># 转回本来的二维数组（灰度图像）</span>
X<span class="token punctuation">[</span><span class="token number">666</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code>array([[ 0.,  0.,  5., 15., 14.,  3.,  0.,  0.],
       [ 0.,  0., 13., 15.,  9., 15.,  2.,  0.],
       [ 0.,  4., 16., 12.,  0., 10.,  6.,  0.],
       [ 0.,  8., 16.,  9.,  0.,  8., 10.,  0.],
       [ 0.,  7., 15.,  5.,  0., 12., 11.,  0.],
       [ 0.,  7., 13.,  0.,  5., 16.,  6.,  0.],
       [ 0.,  0., 16., 12., 15., 13.,  1.,  0.],
       [ 0.,  0.,  6., 16., 12.,  2.,  0.,  0.]])
</code></pre>
    <pre><code class="prism language-python">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>
    X<span class="token punctuation">[</span><span class="token number">666</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">,</span>
    interpolation<span class="token operator">=</span><span class="token string">'lanczos'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre>
    <pre><code>&lt;matplotlib.image.AxesImage at 0xf77b7b8&gt;
</code></pre>
    <p>
     [外链图片转存失败(img-udkcAhgB-1566636361510)(output_10_1.png)]
    </p>
    <h3>
     <a id="kNN_232">
     </a>
     kNN训练和预测
    </h3>
    <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">666</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> KNeighborsClassifier

knn_clf <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span>n_neighbors<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># 创建空分类器，默认超参数k值为5</span>
knn_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>  <span class="token comment"># 训练</span>
knn_clf<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span>  <span class="token comment"># 查看准确率</span>
</code></pre>
    <pre><code>0.9888888888888889
</code></pre>
    <h3>
     <a id="k_256">
     </a>
     调参，寻找最佳k值
    </h3>
    <pre><code class="prism language-python">best_r <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 最高准确率</span>
best_k <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 最佳k值</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment">#     print(i)</span>
    knn_clf <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span>n_neighbors<span class="token operator">=</span>i<span class="token punctuation">)</span>  <span class="token comment"># 创建空分类器，默认超参数k值为5</span>
    knn_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>  <span class="token comment"># 训练</span>
    re <span class="token operator">=</span> knn_clf<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span> <span class="token comment"># 查看准确率</span>
<span class="token comment">#     print(re)</span>
    
    <span class="token keyword">if</span> re <span class="token operator">&gt;</span> best_r<span class="token punctuation">:</span>
        best_r <span class="token operator">=</span> re
        best_k <span class="token operator">=</span> i

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'最佳准确率为：'</span><span class="token punctuation">,</span> best_r<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'最佳k值为：'</span><span class="token punctuation">,</span> best_k<span class="token punctuation">)</span>
</code></pre>
    <pre><code>最佳准确率为： 0.9916666666666667
最佳k值为： 4
</code></pre>
    <h3>
     <a id="kNN_282">
     </a>
     kNN另一个超参数
    </h3>
    <pre><code>weights:uniform/distance
# uniform默认，统一只计算距离，权重一样
# distance,增加权重考虑
</code></pre>
    <p>
     距离的权重：一般将距离的倒数作为权重，加入运算
    </p>
    <p>
     例：设一个未知点距离最近的3个点
    </p>
    <pre><code>红点a，距离为1
蓝点b，距离为3
蓝点c，距离为4
</code></pre>
    <ul>
     <li>
      根据投票原则，预测未知点为蓝色
     </li>
     <li>
      但红点离未知点最近，应该加权（距离倒数），计算权重后的预测值为：
      <ul>
       <li>
        红色：1
       </li>
       <li>
        蓝色：1/3 + 1/4 = 7/12
       </li>
       <li>
        预测未知点为红色
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="_302">
     </a>
     增加一重超参数遍历，距离权重
    </h4>
    <pre><code class="prism language-python">best_score <span class="token operator">=</span> <span class="token number">0.0</span>  <span class="token comment"># 最高准确率</span>
best_k <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token comment"># 最佳k值</span>
best_weight <span class="token operator">=</span> <span class="token string">''</span>  <span class="token comment"># 距离或权重</span>

<span class="token keyword">for</span> j <span class="token keyword">in</span>  <span class="token punctuation">[</span><span class="token string">'uniform'</span><span class="token punctuation">,</span> <span class="token string">'distance'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#     print(i)</span>
        knn_clf <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span>n_neighbors<span class="token operator">=</span>i<span class="token punctuation">,</span> weights<span class="token operator">=</span>j<span class="token punctuation">)</span>  <span class="token comment"># 创建空分类器，默认超参数k值为5</span>
        knn_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>  <span class="token comment"># 训练</span>
        re <span class="token operator">=</span> knn_clf<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span> <span class="token comment"># 查看准确率</span>
    <span class="token comment">#     print(re)</span>

        <span class="token keyword">if</span> re <span class="token operator">&gt;</span> best_score<span class="token punctuation">:</span>
            best_score <span class="token operator">=</span> re
            best_k <span class="token operator">=</span> i
            best_weight <span class="token operator">=</span> j

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'best_score = {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>best_score<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'best_k = {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>best_k<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'best_weight = {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>best_weight<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code>best_score = 0.9916666666666667
best_k = 4
best_weight = uniform
</code></pre>
    <p>
     不使用uniform预测，考虑权重的准确率
    </p>
    <pre><code class="prism language-python">knn_clf <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span>n_neighbors<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> weights<span class="token operator">=</span><span class="token string">'distance'</span><span class="token punctuation">)</span>  <span class="token comment"># 创建空分类器，超参数k值为4</span>
knn_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>  <span class="token comment"># 训练</span>
score <span class="token operator">=</span> knn_clf<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span>  <span class="token comment"># 查看准确率</span>
score
</code></pre>
    <pre><code>0.9888888888888889
</code></pre>
    <ol>
     <li>
      欧式距离：
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         d 
          
         
           12 
          
         
        
          = 
         
         
          
           
           
             ∑ 
            
            
            
              k 
             
            
              = 
             
            
              1 
             
            
           
             n 
            
           
           
            
            
              ( 
             
             
             
               x 
              
              
              
                1 
               
              
                k 
               
              
             
            
              − 
             
             
             
               x 
              
              
              
                2 
               
              
                k 
               
              
             
            
              ) 
             
            
           
             2 
            
           
          
         
        
       
         d_{12}=\sqrt{\sum_{k=1}^{n}\left(x_{1 k}-x_{2 k}\right)^{2}}
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.84444em; vertical-align: -0.15em;">
          </span>
          <span class="mord">
           <span class="mord mathit">
            d
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.301108em;">
               <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mtight">
                   1
                  </span>
                  <span class="mord mtight">
                   2
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.277778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.277778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1.84em; vertical-align: -0.527851em;">
          </span>
          <span class="mord sqrt">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 1.31215em;">
              <span class="svg-align" style="top: -3.8em;">
               <span class="pstrut" style="height: 3.8em;">
               </span>
               <span class="mord" style="padding-left: 1em;">
                <span class="mop">
                 <span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">
                  ∑
                 </span>
                 <span class="msupsub">
                  <span class="vlist-t vlist-t2">
                   <span class="vlist-r">
                    <span class="vlist" style="height: 0.804292em;">
                     <span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;">
                      <span class="pstrut" style="height: 2.7em;">
                      </span>
                      <span class="sizing reset-size6 size3 mtight">
                       <span class="mord mtight">
                        <span class="mord mathit mtight" style="margin-right: 0.03148em;">
                         k
                        </span>
                        <span class="mrel mtight">
                         =
                        </span>
                        <span class="mord mtight">
                         1
                        </span>
                       </span>
                      </span>
                     </span>
                     <span class="" style="top: -3.2029em; margin-right: 0.05em;">
                      <span class="pstrut" style="height: 2.7em;">
                      </span>
                      <span class="sizing reset-size6 size3 mtight">
                       <span class="mord mtight">
                        <span class="mord mathit mtight">
                         n
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                    <span class="vlist-s">
                     ​
                    </span>
                   </span>
                   <span class="vlist-r">
                    <span class="vlist" style="height: 0.29971em;">
                     <span class="">
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
                <span class="mspace" style="margin-right: 0.166667em;">
                </span>
                <span class="minner">
                 <span class="minner">
                  <span class="mopen delimcenter" style="top: 0em;">
                   (
                  </span>
                  <span class="mord">
                   <span class="mord mathit">
                    x
                   </span>
                   <span class="msupsub">
                    <span class="vlist-t vlist-t2">
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.336108em;">
                       <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                        <span class="pstrut" style="height: 2.7em;">
                        </span>
                        <span class="sizing reset-size6 size3 mtight">
                         <span class="mord mtight">
                          <span class="mord mtight">
                           1
                          </span>
                          <span class="mord mathit mtight" style="margin-right: 0.03148em;">
                           k
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="vlist-s">
                       ​
                      </span>
                     </span>
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.15em;">
                       <span class="">
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="mspace" style="margin-right: 0.222222em;">
                  </span>
                  <span class="mbin">
                   −
                  </span>
                  <span class="mspace" style="margin-right: 0.222222em;">
                  </span>
                  <span class="mord">
                   <span class="mord mathit">
                    x
                   </span>
                   <span class="msupsub">
                    <span class="vlist-t vlist-t2">
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.336108em;">
                       <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                        <span class="pstrut" style="height: 2.7em;">
                        </span>
                        <span class="sizing reset-size6 size3 mtight">
                         <span class="mord mtight">
                          <span class="mord mtight">
                           2
                          </span>
                          <span class="mord mathit mtight" style="margin-right: 0.03148em;">
                           k
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="vlist-s">
                       ​
                      </span>
                     </span>
                     <span class="vlist-r">
                      <span class="vlist" style="height: 0.15em;">
                       <span class="">
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="mclose delimcenter" style="top: 0em;">
                   )
                  </span>
                 </span>
                 <span class="msupsub">
                  <span class="vlist-t">
                   <span class="vlist-r">
                    <span class="vlist" style="height: 0.954008em;">
                     <span class="" style="top: -3.2029em; margin-right: 0.05em;">
                      <span class="pstrut" style="height: 2.7em;">
                      </span>
                      <span class="sizing reset-size6 size3 mtight">
                       <span class="mord mtight">
                        <span class="mord mtight">
                         2
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="" style="top: -3.27215em;">
               <span class="pstrut" style="height: 3.8em;">
               </span>
               <span class="hide-tail" style="min-width: 1.02em; height: 1.88em;">
                <svg height="1.8800000000000001em" preserveaspectratio="xMinYMin slice" viewbox="0 0 400000 1944" width="400em">
                 <path d="M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z">
                 </path>
                </svg>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.527851em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </li>
     <li>
      曼哈顿距离：
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         d 
          
         
           12 
          
         
        
          = 
         
         
         
           ∑ 
          
          
          
            k 
           
          
            = 
           
          
            1 
           
          
         
           n 
          
         
         
         
           ∣ 
          
          
          
            x 
           
           
           
             1 
            
           
             k 
            
           
          
         
           − 
          
          
          
            x 
           
           
           
             2 
            
           
             k 
            
           
          
         
           ∣ 
          
         
        
       
         \mathrm{d}_{12}=\sum_{k=1}^{n}\left|\mathrm{x}_{1 k}-x_{2 k}\right|
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.84444em; vertical-align: -0.15em;">
          </span>
          <span class="mord">
           <span class="mord">
            <span class="mord mathrm">
             d
            </span>
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.301108em;">
               <span class="" style="top: -2.55em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mtight">
                   1
                  </span>
                  <span class="mord mtight">
                   2
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.277778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.277778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1.104em; vertical-align: -0.29971em;">
          </span>
          <span class="mop">
           <span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">
            ∑
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.804292em;">
               <span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathit mtight" style="margin-right: 0.03148em;">
                   k
                  </span>
                  <span class="mrel mtight">
                   =
                  </span>
                  <span class="mord mtight">
                   1
                  </span>
                 </span>
                </span>
               </span>
               <span class="" style="top: -3.2029em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathit mtight">
                   n
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.29971em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.166667em;">
          </span>
          <span class="minner">
           <span class="mopen delimcenter" style="top: 0em;">
            ∣
           </span>
           <span class="mord">
            <span class="mord">
             <span class="mord mathrm">
              x
             </span>
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.336108em;">
                <span class="" style="top: -2.55em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mtight">
                   <span class="mord mtight">
                    1
                   </span>
                   <span class="mord mathit mtight" style="margin-right: 0.03148em;">
                    k
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.15em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mspace" style="margin-right: 0.222222em;">
           </span>
           <span class="mbin">
            −
           </span>
           <span class="mspace" style="margin-right: 0.222222em;">
           </span>
           <span class="mord">
            <span class="mord mathit">
             x
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.336108em;">
                <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mtight">
                   <span class="mord mtight">
                    2
                   </span>
                   <span class="mord mathit mtight" style="margin-right: 0.03148em;">
                    k
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.15em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mclose delimcenter" style="top: 0em;">
            ∣
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </li>
     <li>
      明可夫斯基距离(闵氏距离)：
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         ( 
           
           
           
             ∑ 
            
            
            
              i 
             
            
              = 
             
            
              1 
             
            
           
             n 
            
           
           
            
            
              ∣ 
             
             
             
               x 
              
             
               i 
              
             
            
              − 
             
             
             
               y 
              
             
               i 
              
             
            
              ∣ 
             
            
           
             p 
            
           
          
            ) 
           
          
          
          
            1 
           
          
            / 
           
          
            p 
           
          
         
        
       
         \left(\sum_{i=1}^{n}\left|x_{i}-y_{i}\right|^{p}\right)^{1 / p}
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1.3819em; vertical-align: -0.29971em;">
          </span>
          <span class="minner">
           <span class="minner">
            <span class="mopen delimcenter" style="top: 0em;">
             (
            </span>
            <span class="mop">
             <span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">
              ∑
             </span>
             <span class="msupsub">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.804292em;">
                 <span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mord mtight">
                    <span class="mord mathit mtight">
                     i
                    </span>
                    <span class="mrel mtight">
                     =
                    </span>
                    <span class="mord mtight">
                     1
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="" style="top: -3.2029em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mord mtight">
                    <span class="mord mathit mtight">
                     n
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 0.29971em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.166667em;">
            </span>
            <span class="minner">
             <span class="minner">
              <span class="mopen delimcenter" style="top: 0em;">
               ∣
              </span>
              <span class="mord">
               <span class="mord mathit">
                x
               </span>
               <span class="msupsub">
                <span class="vlist-t vlist-t2">
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.311664em;">
                   <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                    <span class="pstrut" style="height: 2.7em;">
                    </span>
                    <span class="sizing reset-size6 size3 mtight">
                     <span class="mord mtight">
                      <span class="mord mathit mtight">
                       i
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="vlist-s">
                   ​
                  </span>
                 </span>
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.15em;">
                   <span class="">
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="mspace" style="margin-right: 0.222222em;">
              </span>
              <span class="mbin">
               −
              </span>
              <span class="mspace" style="margin-right: 0.222222em;">
              </span>
              <span class="mord">
               <span class="mord mathit" style="margin-right: 0.03588em;">
                y
               </span>
               <span class="msupsub">
                <span class="vlist-t vlist-t2">
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.311664em;">
                   <span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;">
                    <span class="pstrut" style="height: 2.7em;">
                    </span>
                    <span class="sizing reset-size6 size3 mtight">
                     <span class="mord mtight">
                      <span class="mord mathit mtight">
                       i
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="vlist-s">
                   ​
                  </span>
                 </span>
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.15em;">
                   <span class="">
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="mclose delimcenter" style="top: 0em;">
               ∣
              </span>
             </span>
             <span class="msupsub">
              <span class="vlist-t">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.804292em;">
                 <span class="" style="top: -3.2029em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mord mtight">
                    <span class="mord mathit mtight">
                     p
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mclose delimcenter" style="top: 0em;">
             )
            </span>
           </span>
           <span class="msupsub">
            <span class="vlist-t">
             <span class="vlist-r">
              <span class="vlist" style="height: 1.08219em;">
               <span class="" style="top: -3.25719em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mtight">
                   1
                  </span>
                  <span class="mord mtight">
                   /
                  </span>
                  <span class="mord mathit mtight">
                   p
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </li>
    </ol>
    <hr/>
    <p>
     明可夫斯基距离包含下面两种
    </p>
    <ul>
     <li>
      p=1：曼哈顿距离
     </li>
     <li>
      p=2：欧氏距离
     </li>
     <li>
      p趋于无穷大：切比雪夫距离
     </li>
    </ul>
    <h4>
     <a id="_364">
     </a>
     继续增加超参数：搜索不同距离计算方式
    </h4>
    <pre><code>p=2/1/...
# p=2默认为欧拉距离，p=1为曼哈顿距离，其他值为相应距离类型
</code></pre>
    <p>
     超参数之间可能有相互依赖关系，如参数p只有在weight=distance考虑权重时才有效
    </p>
    <pre><code class="prism language-python">best_score <span class="token operator">=</span> <span class="token number">0.0</span>
best_k <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
best_weight <span class="token operator">=</span> <span class="token string">'distance'</span>
best_p <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># p值</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 如果最大k值为最优，需要继续更大的k值循环</span>
    <span class="token comment">#     print(i)</span>
        knn_clf <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span>n_neighbors<span class="token operator">=</span>i<span class="token punctuation">,</span> weights<span class="token operator">=</span>best_weight<span class="token punctuation">,</span> p<span class="token operator">=</span>j<span class="token punctuation">)</span>  <span class="token comment"># 创建空分类器</span>
        knn_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>  <span class="token comment"># 训练</span>
        score <span class="token operator">=</span> knn_clf<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span>  <span class="token comment"># 查看准确率</span>

        <span class="token keyword">if</span> best_score <span class="token operator">&lt;</span> score<span class="token punctuation">:</span>
            best_score <span class="token operator">=</span> score
            best_k <span class="token operator">=</span> i
            best_p <span class="token operator">=</span> j

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'best_weight = {} 的条件下：'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>best_weight<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'best_score = {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>best_score<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'best_k = {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>best_k<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'best_p = {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>best_p<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code>best_weight = distance 的条件下：
best_score = 0.9888888888888889
best_k = 5
best_p = 1
</code></pre>
    <p>
     上面手动实现的网格搜索方式，可用sklearn内置方法实现
    </p>
    <h3>
     <a id="sklearnGrid_Search_405">
     </a>
     sklearn内封装好的网格搜索方式：Grid Search
    </h3>
    <pre><code class="prism language-python"><span class="token comment">###############################################################</span>
<span class="token comment"># 首先定义要搜索的参数</span>
<span class="token comment"># 二维数组内嵌套字典</span>
<span class="token comment"># 每个字典内都是一组网格搜索，标明每个参数的取值范围</span>
<span class="token comment"># 注意：p值只有在weights=distance时才有意义</span>

param_grid <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>  <span class="token comment"># 需遍历10次</span>
        <span class="token string">'weights'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'uniform'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment"># 参数取值范围</span>
        <span class="token string">'n_neighbors'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment"># 使用其他方式如np.arange()也可以</span>
        <span class="token comment"># 这里没有p参数</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>  <span class="token comment"># 需遍历50次</span>
        <span class="token string">'weights'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'distance'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'n_neighbors'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'p'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment"># 共需遍历60次</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
    <pre><code>[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
</code></pre>
    <pre><code class="prism language-python">knn_clf <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 默认参数，创建空分类器</span>

<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV  <span class="token comment"># CV，使用交叉验证方式获得模型正确率</span>
grid_search <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>knn_clf<span class="token punctuation">,</span> param_grid<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># 网格搜索参数</span>

grid_search<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>  <span class="token comment"># 网格搜索训练模型，比较耗时，约4分钟</span>
</code></pre>
    <pre><code>GridSearchCV(cv=5, error_score='raise-deprecating',
             estimator=KNeighborsClassifier(algorithm='auto', leaf_size=30,
                                            metric='minkowski',
                                            metric_params=None, n_jobs=None,
                                            n_neighbors=5, p=2,
                                            weights='uniform'),
             iid='warn', n_jobs=None,
             param_grid=[{'n_neighbors': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                          'weights': ['uniform']},
                         {'n_neighbors': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                          'p': [1, 2, 3, 4, 5], 'weights': ['distance']}],
             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,
             scoring=None, verbose=0)
</code></pre>
    <p>
     下面这类最后加下划线的方法，都是标识：非用户传入参数而是根据用户传入参数计算出来的参数
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 网格搜索到的最佳分类器参数</span>
grid_search<span class="token punctuation">.</span>best_estimator_
</code></pre>
    <pre><code>KNeighborsClassifier(algorithm='auto', leaf_size=30, metric='minkowski',
                     metric_params=None, n_jobs=None, n_neighbors=1, p=2,
                     weights='uniform')
</code></pre>
    <pre><code class="prism language-python"><span class="token comment"># 输出指定过的最佳参数</span>
grid_search<span class="token punctuation">.</span>best_params_
</code></pre>
    <pre><code>{'n_neighbors': 1, 'weights': 'uniform'}
</code></pre>
    <p>
     上面网格搜索到的最佳参数相比之前手动完成的网格搜索得到的参数不同，因为sklearn使用的时CV方式（交叉验证）评价精确度，
    </p>
    <p>
     虽然测试准确率降低，但避免了过拟合，更好
    </p>
    <pre><code class="prism language-python">grid_search<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span>  <span class="token comment"># 网格搜索参数模型的准确率</span>
</code></pre>
    <pre><code>0.9833333333333333
</code></pre>
    <pre><code class="prism language-python"><span class="token comment"># 将网格搜索训练好的模型赋值给对象，可以和其他训练好的模型一样使用</span>
knn_clf <span class="token operator">=</span> grid_search<span class="token punctuation">.</span>best_estimator_
knn_clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>  <span class="token comment"># 直接预测结果</span>
knn_clf<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span>  <span class="token comment"># 准确率</span>
</code></pre>
    <pre><code>0.9833333333333333
</code></pre>
    <p>
     一般工作时人工调参和网格搜索结合，参数区间比较大时人工调参，区间小就网格搜索，宗旨就是减少模型训练量，提高调参速度
    </p>
    <p>
     网格搜索耗时很久，verbose参数可以在执行过程中输出一些信息供用户参考，值越大输出信息越多
    </p>
    <p>
     注意：执行时间很久，如果使用并行运算占用全部cpu（n_jobs=-1）内核会导致系统卡死，只用部分内核运算就行
    </p>
    <ul>
     <li>
      量化交易：矿工
     </li>
     <li>
      程序员：码农
     </li>
     <li>
      机器学习：调包侠，调参侠
     </li>
    </ul>
    <pre><code class="prism language-python">grid_search <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>knn_clf<span class="token punctuation">,</span> param_grid<span class="token punctuation">,</span> n_jobs<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
grid_search<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

<span class="token comment"># 供需要搜索60组参数，uniform10组，distance50组</span>
</code></pre>
    <pre><code>Fitting 5 folds for each of 60 candidates, totalling 300 fits


[Parallel(n_jobs=2)]: Using backend LokyBackend with 2 concurrent workers.
[Parallel(n_jobs=2)]: Done  53 tasks      | elapsed:    3.2s
[Parallel(n_jobs=2)]: Done 210 tasks      | elapsed:   34.7s
[Parallel(n_jobs=2)]: Done 300 out of 300 | elapsed:   55.9s finished





GridSearchCV(cv=5, error_score='raise-deprecating',
             estimator=KNeighborsClassifier(algorithm='auto', leaf_size=30,
                                            metric='minkowski',
                                            metric_params=None, n_jobs=None,
                                            n_neighbors=1, p=2,
                                            weights='uniform'),
             iid='warn', n_jobs=2,
             param_grid=[{'n_neighbors': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                          'weights': ['uniform']},
                         {'n_neighbors': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                          'p': [1, 2, 3, 4, 5], 'weights': ['distance']}],
             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,
             scoring=None, verbose=2)
</code></pre>
    <pre><code class="prism language-python">grid_search<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span>  <span class="token comment"># 网格搜索参数模型的准确率</span>
</code></pre>
    <pre><code>0.9833333333333333
</code></pre>
    <pre><code class="prism language-python">
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f7371736c74722f:61727469636c652f64657461696c732f313030303534343531" class_="artid" style="display:none">
 </p>
</div>


