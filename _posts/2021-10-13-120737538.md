---
layout: post
title: "记录uniapp微信小程序通过高德api获取当前详细的地理位置信息"
date: 2021-10-13 10:23:20 +0800
description: "概述由于当前业务需要在使用小程序的时候获取当前所在的详细地理位置信息，所以我们采用高德地图的api来"
keywords: "uniapp使用高德获取当前地址"
categories: ['微信小程序']
tags: ['微信', '小程序', 'Javascript']
artid: "120737538"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=120737538
    alt: "记录uniapp微信小程序通过高德api获取当前详细的地理位置信息"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     记录：uniapp微信小程序通过高德api获取当前详细的地理位置信息
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h4>
     <a id="_0">
     </a>
     概述
    </h4>
    <p>
     由于当前业务需要在使用小程序的时候获取当前所在的详细地理位置信息，所以我们采用高德地图的api来获取当前位置的中文描述+区域编码。
    </p>
    <h4>
     <a id="_2">
     </a>
     使用
    </h4>
    <h5>
     <a id="key_3">
     </a>
     获取key
    </h5>
    <p>
     注：可打开
     <a href="https://lbs.amap.com/api/wx/gettingstarted" rel="nofollow">
      高德官网链接
     </a>
     按照步骤获取key，或通过如下步骤获取
     <br/>
     1、进入
     <a href="https://lbs.amap.com/" rel="nofollow">
      高德开放平台
     </a>
     <br/>
     2、没有账号进行注册｜有账号直接登录
     <br/>
     3、点击右上角 控制台 -&gt; 应用管理 -&gt; 我的应用 -&gt; 创建应用
     <br/>
     4、点击当前创建的应用下的添加按钮
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/245dcadbf6d8eeeaa87a05ba347d6b7e.png">
      <br/>
      5、提交之后即可得到高德api的key
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/442191e5c4303a51f6b624e592be2ec7.png"/>
     </img>
    </p>
    <h5>
     <a id="jsamapwxjs_12">
     </a>
     获取并使用高德微信小程序js依赖文件amap-wx.js
    </h5>
    <p>
     1、
     <a href="https://lbs.amap.com/api/wx/download" rel="nofollow">
      高德相关下载
     </a>
     ：进入官网进行下载解压后即可得到
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/09ffedf42ed927e6aa785262e4970ee7.png">
      <br/>
      2、将amap-wx.js放在你的项目静态工具文件夹中
      <br/>
      3、在需要使用到api的页面引入，我们当前在uniapp中使用
     </img>
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> amap <span class="token keyword">from</span> <span class="token string">'../../static/utils/amap-wx.130.js'</span>

<span class="token keyword">const</span> amapObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">amap<span class="token punctuation">.</span>AMapWX</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'your key'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
amapObject<span class="token punctuation">.</span><span class="token function">getRegeo</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>regeocodeData<span class="token punctuation">.</span>formatted_address<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <font color="#dd0000">
      注意1：
     </font>
     由于当前获取位置是在小程序内部，所以必须添加小程序所需的permission用于小程序获取用户地理位置授权。
     <br/>
     原生微信小程序开发：在appjson中进行配置
    </p>
    <pre><code class="prism language-javascript"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"pages"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"pages/index/index"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">"permission"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"scope.userLocation"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"desc"</span><span class="token operator">:</span> <span class="token string">"你的位置信息将用于小程序位置接口的效果展示"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     uniapp开发：在manifest.json下 -&gt; 微信小程序配置 -&gt; 微信小程序权限配置 -&gt; 位置接口 -&gt; 描述：你的位置信息将用于小程序位置接口的效果展示
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7086801fee0cf357fad871c5ea868407.png">
      <br/>
      <font color="#dd0000">
       注意2：
      </font>
      若是报错https://restapi.amap.com未配置在request合法域名中，则是由于amap api调用了当前域名下接口但是微信公众平台上没有进行配置导致，将当前域名配置在微信小程序request合法域名即可。
      <br/>
      路径：微信公众平台 -&gt; 小程序 -&gt; 开发管理 -&gt; 开发设置 -&gt; 服务器域名
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1609ae89d180e0694a533220d7329c05.png"/>
     </img>
    </p>
    <h5>
     <a id="_48">
     </a>
     运行程序得到输出
    </h5>
    <p>
     1、会首先获取地理位置信息授权
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f845c70614867527a7cffa33aaa4c40e.png">
      <br/>
      2、确定：在调用api之后，success callback输出结果
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9eab4af3611dd22d75a5376dfdbe1505.png">
       <br/>
       3、取消：在调用api之后，fail callback输出结果
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c7a168db2b4a92f394373a438ac533fa.png"/>
      </img>
     </img>
    </p>
    <h4>
     <a id="_55">
     </a>
     备注
    </h4>
    <p>
     记录供后续翻阅
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34343430323639342f:61727469636c652f64657461696c732f313230373337353338" class_="artid" style="display:none">
 </p>
</div>


