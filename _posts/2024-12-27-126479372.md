---
layout: post
title: "GBase-8s数据库常用操作指南"
date: 2024-12-27 17:34:20 +0800
description: "文章浏览阅读2.GBase 8s数据库日常管理包括数据库模式的切换，监控主要分为两个方面，一方面是系"
keywords: "gbase8s 建表"
categories: ['未分类']
tags: ['服务器', '数据库', 'Servlet']
artid: "126479372"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=126479372
    alt: "GBase-8s数据库常用操作指南"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     GBase 8s数据库常用操作指南
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <strong>
      简介
     </strong>
    </p>
    <p>
    </p>
    <p>
     GBase 8s数据库日常管理包括数据库模式的切换，以及服务器的监控。监控主要分为两个方面，一方面是系统级别的监控，主要包括对系统cpu的监控，以及内存的占用情况；另一方面是数据库级别的监控，包括对磁盘空间大小的监控，对逻辑日志物理日志的监控，对数据表中数据量的监控，以及表中索引层数，顺序扫描次数等等。我们可以通过命令或者sql语句的方式，完成对数据库的监控。
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     <strong>
      语法
     </strong>
    </p>
    <p>
     1.启动数据库服务：
    </p>
    <p>
     oninit -vy
    </p>
    <p>
     2.关闭数据库服务:
    </p>
    <p>
     onmode -ky
    </p>
    <p>
     3.监控系统cpu和内存使用情况：
    </p>
    <p>
     top
    </p>
    <p>
    </p>
    <p>
     4.查看数据库版本和运行模式：
    </p>
    <p>
     onstat -
    </p>
    <p>
     5.监控数据库磁盘空间大小
    </p>
    <p>
     <strong>
      onstat -d
     </strong>
    </p>
    <p>
     6.监控逻辑日志，物理日志信息
    </p>
    <p>
     <strong>
      onstat -l
     </strong>
    </p>
    <p>
     7.监控GBase 8s占用系统内存大小：
    </p>
    <p>
     <strong>
      onstat -g seg
     </strong>
    </p>
    <p>
     8.监控实例整体运行情况
    </p>
    <p>
     onstat -p
    </p>
    <p>
     9.查看实例运行日志最后20行信息
    </p>
    <p>
     onstat -m
    </p>
    <p>
     10.查看数据库进程状态
    </p>
    <p>
     onstat -g glo
    </p>
    <p>
     11.查看数据库会话状态
    </p>
    <p>
     onstat -g ses
    </p>
    <p>
     12.从离线模式向静态模式转换：
    </p>
    <p>
     <strong>
      oninit -s
     </strong>
    </p>
    <p>
     13.从离线模式向管理员模式转换：
    </p>
    <p>
     <strong>
      oninit -j
     </strong>
    </p>
    <p>
     14.从管理员模式，静态模式向在线模式转换：
    </p>
    <p>
     <strong>
      onmode -m
     </strong>
    </p>
    <p>
     15.从在线模式向管理员模式转换:
    </p>
    <p>
     <strong>
      onmode -j
     </strong>
    </p>
    <p>
     16.从在线模式向静态模式转换:
    </p>
    <p>
     <strong>
      onmode -s；onmode -u
     </strong>
    </p>
    <p>
     17.根据错误号查询错误信息:
    </p>
    <p>
     <strong>
      finderr 951
     </strong>
    </p>
    <p>
    </p>
    <h3>
     2
    </h3>
    <p>
     <strong>
      SQL指南
     </strong>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     语法简介：
    </p>
    <p>
     创建数据库对象的语法都是使用
     <strong>
      CREATE +“数据库对象类型”+“数据库对象名”
     </strong>
     的方式开头，然后再定义其中具体的细节。这类语法属于DDL（Data Definition Language）数据库定义语言。
    </p>
    <p>
     在GBase 8s中，有四种日志类型的数据库，分别是无日志模式，缓冲式日志模式，无缓冲式日志模式和ANSI模式。
    </p>
    <p>
     <strong>
      无日志模式
     </strong>
     ，数据库性能好，但是不支持逻辑恢复操作；
    </p>
    <p>
     <strong>
      缓冲式日志模式
     </strong>
     ，既支持数据库逻辑恢复的功能，同时又能避免频繁的I/O操作，是生产系统中常见的日志类型；
    </p>
    <p>
     <strong>
      无缓冲式日志模式
     </strong>
     ，会有频繁的I/O操作，优点是一旦数据库宕机，损失较小。
    </p>
    <p>
     <strong>
      ANSI模式
     </strong>
     ，是一种特殊的无缓冲式日志模式，要符合额外的ANSI规则。
    </p>
    <p>
    </p>
    <p>
     1.创建库语法
    </p>
    <p>
     <strong>
      create database “数据库名” in
     </strong>
     <strong>
      “
     </strong>
     <strong>
      dbspace名
     </strong>
     <strong>
      ”
     </strong>
     <strong>
     </strong>
    </p>
    <p>
     <strong>
      [ with buffered log | with log | with log mode ansi]
     </strong>
    </p>
    <p>
     2.创建表语法
    </p>
    <p>
     <strong>
      create [ tmp | row ] table
     </strong>
     <strong>
      “
     </strong>
     <strong>
      表名
     </strong>
     <strong>
      ”
     </strong>
     <strong>
      (
     </strong>
     <strong>
      “
     </strong>
     <strong>
      列名
     </strong>
     <strong>
      ””
     </strong>
     <strong>
      数据类型
     </strong>
     <strong>
      ”
     </strong>
     <strong>
     </strong>
     <strong>
      “
     </strong>
     <strong>
      列级约束
     </strong>
     <strong>
      ”
     </strong>
     <strong>
      , ... ... ,
     </strong>
    </p>
    <p>
     <strong>
      [ 表级约束 ] ) [ in
     </strong>
     <strong>
      “
     </strong>
     <strong>
      表的存放路径
     </strong>
     <strong>
      ”
     </strong>
     <strong>
      ]
     </strong>
    </p>
    <p>
     3.修改表语法
    </p>
    <p>
     <strong>
      alter table
     </strong>
     <strong>
      “
     </strong>
     <strong>
      表名
     </strong>
     <strong>
      ”
     </strong>
     <strong>
      add“列名”“数据类型”| modify“列名”“数据类型”
     </strong>
     <strong>
      |drop column“列名”
     </strong>
    </p>
    <p>
     4.删除表语法
    </p>
    <p>
     <strong>
      drop table
     </strong>
     <strong>
      “
     </strong>
     <strong>
      表名
     </strong>
     <strong>
      ”
     </strong>
    </p>
    <p>
     5.查询数据语法
    </p>
    <p>
     <strong>
      select  [ all | distinct ]  “列表达式”,   ......   from  ”表名“, ......
     </strong>
    </p>
    <p>
     <strong>
      [ where  ”条件表达式“ ]
     </strong>
    </p>
    <p>
     <strong>
      [ group by “列名”, ...... [ having  ”条件表达式“ ] ]
     </strong>
    </p>
    <p>
     <strong>
      [ order by ”列名“ [ asc | desc ], ...... ] ;
     </strong>
    </p>
    <p>
     6.插入数据语法
    </p>
    <p>
     <strong>
      insert into “表名”[ ( 列1, 列2, 列3, ...... ) ] values ( 值1, 值2 , 值3 , ...... )
     </strong>
    </p>
    <p>
     7.更新数据语法
    </p>
    <p>
     <strong>
      update “表名”set 列1=值1, ...... [ where “条件表达式” ]
     </strong>
    </p>
    <p>
     8.删除数据语法
    </p>
    <p>
     <strong>
      delete from “表名”[ where “条件表达式” ]
     </strong>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     简单示例：
    </p>
    <p>
     创建缓冲式日志模式数据库testdb，test表，以及insertdata存储过程 ：
    </p>
    <p>
     切换到8s的linux操作用户，并生效当前实例对应的环境变量文件：
    </p>
    <p>
     <strong>
      su - gbasedbt
     </strong>
    </p>
    <p>
     <strong>
      . .bash_profile
     </strong>
    </p>
    <p>
     进入sql编辑器dbaccess，执行SQL语句：
    </p>
    <p>
     <strong>
      dbaccess - -
     </strong>
    </p>
    <p>
     &gt;
     <strong>
      create database testdb in datadbs1 with buffered log;
     </strong>
    </p>
    <p>
     <strong>
      -- 创建库testdb
     </strong>
    </p>
    <p>
     &gt;
     <strong>
      create table test (id int , name char(20) );
     </strong>
    </p>
    <p>
     <strong>
      -- 创建test表
     </strong>
    </p>
    <p>
     <strong>
      &gt;
     </strong>
     <strong>
      create procedure insertdata()
     </strong>
    </p>
    <p>
     <strong>
      &gt;
     </strong>
     <strong>
      define i int;
     </strong>
    </p>
    <p>
     <strong>
      &gt;
     </strong>
     <strong>
      for i in (1 to 100)
     </strong>
    </p>
    <p>
     <strong>
      &gt;
     </strong>
     <strong>
      insert into test values(i,'GBase 8s');
     </strong>
    </p>
    <p>
     <strong>
      &gt;
     </strong>
     <strong>
      end for;
     </strong>
    </p>
    <p>
     <strong>
      &gt;
     </strong>
     <strong>
      end procedure;
     </strong>
    </p>
    <p>
     <strong>
      -- 创建insertdata()存储过程，向test表中插入100条数据
     </strong>
    </p>
    <p>
     &gt;
     <strong>
      execute procedure insertdata();
     </strong>
    </p>
    <p>
     <strong>
      -- 执行insertdata()存储过程
     </strong>
    </p>
    <p>
     &gt;
     <strong>
      select  a.cf_original, DBINFO('dbname') dbname,user from
     </strong>
    </p>
    <p>
     &gt;
     <strong>
      sysmaster:sysconfig a where cf_name = 'testdb';
     </strong>
    </p>
    <p>
     <strong>
      -- 查看实例名,数据库名,用户名
     </strong>
    </p>
    <p>
     &gt;
     <strong>
      select  name  from sysmaster:sysdatabases;
     </strong>
     <strong>
     </strong>
    </p>
    <p>
     <strong>
      -- 查看实例中所有数据库名
     </strong>
    </p>
    <p>
     &gt;
     <strong>
      select  dbsname,tabname from sysmaster:systabnames where
     </strong>
     <strong>
     </strong>
    </p>
    <p>
     &gt;
     <strong>
      dbsname='testdb';
     </strong>
     <strong>
     </strong>
    </p>
    <p>
     <strong>
      -- 查看数据库中所有表名
     </strong>
    </p>
    <p>
    </p>
    <h3>
     3
    </h3>
    <p>
     <strong>
      数据装载与卸载指南
     </strong>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     语法简介：
    </p>
    <p>
     GBase 8s根据装载卸载粒度的不同，有不同的装载卸载工具。
    </p>
    <p>
     1.
     <strong>
      load/unload
     </strong>
     ：装卸载粒度表级，SQL命令，输出结果为明文.
    </p>
    <p>
     <strong>
      unload to‘filename’  [DELIMITER ‘delimiter’] select Statement;
     </strong>
    </p>
    <p>
     <strong>
      load from‘filename’ [DELIMITER ‘delimiter’] insert into
     </strong>
    </p>
    <p>
     <strong>
     </strong>
     <strong>
      Table Name | Synonym Name| View Name [(column)];
     </strong>
    </p>
    <p>
     <strong>
      2.onunload/onload 工具
     </strong>
     ：装卸载粒度为数据库级或表级，输出结果为二进制文件。
    </p>
    <p>
     <strong>
     </strong>
     <strong>
      onunload [-l] [-t &lt;tape device&gt;] &lt;database&gt;[:[&lt;owner&gt;.]&lt;table&gt;]
     </strong>
    </p>
    <p>
     <strong>
     </strong>
     <strong>
      onload [-l] [-t &lt;tape device&gt;]  [-d &lt;DBspace&gt;] &lt;database&gt;[:[&lt;owner&gt;.]&lt;table&gt;]
     </strong>
    </p>
    <p>
     <strong>
      3.dbload 工具：
     </strong>
     装载粒度为表级，功能比load方式强大，使用起来也相对复杂。
    </p>
    <p>
     <strong>
      dbload [-d dbname] [-c cfilname] [-l logfile] [-e errnum] [-n nnum]
     </strong>
    </p>
    <p>
     <strong>
      4.dbexport/dbimport 工具：
     </strong>
     装卸载粒度为数据库级，输出结果为明文。
    </p>
    <p>
     <strong>
     </strong>
     <strong>
      dbexport &lt;database&gt; [-ss] [{ -o &lt;directory&gt; | -t &lt;tapedevice&gt; }]
     </strong>
    </p>
    <p>
     <strong>
     </strong>
     <strong>
      dbimport &lt;database&gt; [-d &lt;dbspace&gt;]  [-l [{ buffered }] [-ansi]] [-ci] [-nv] [-D][{ -i &lt;dir&gt; | -t &lt;tapedev&gt; }]
     </strong>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     <strong>
      简单实例
     </strong>
    </p>
    <p>
    </p>
    <p>
     （1）通过
     <strong>
      unload
     </strong>
     将test表数据卸载到test.db文件，用竖线做列的分隔符
    </p>
    <p>
     <strong>
      &gt;unload to /tmp/test.db select * from test;
     </strong>
    </p>
    <p>
     <strong>
     </strong>
     通过
     <strong>
      load
     </strong>
     将test.db中的数据装载到test表中
    </p>
    <p>
     <strong>
      &gt;load fr
     </strong>
     <strong>
      om /tmp/test.db insert into test;
     </strong>
    </p>
    <p>
     （2）通过
     <strong>
      dbload
     </strong>
     工具将test.db中的数据装载到test表中
    </p>
    <p>
     先建立命令文件：例如/tmp/test.ctl  在文件中 写入以下命令
    </p>
    <p>
     <strong>
      vi /tmp/test.ctl
     </strong>
     (添加如下两行内容)
    </p>
    <p>
     FILE /tmp/test.db delimiter "|" 2;
    </p>
    <p>
     <strong>
     </strong>
     insert into test;
    </p>
    <p>
     <strong>
     </strong>
     <strong>
     </strong>
     (/tmp/test.ctl 是数据文件，2代表有两个字段)
    </p>
    <p>
     然后用dbload命令导入数据：
    </p>
    <p>
     <strong>
      dbload -d testdb -c /tmp/test.ctl -l error.log
     </strong>
    </p>
    <p>
     （3）使用
     <strong>
      dbexport/dbimport
     </strong>
     迁移数据库
    </p>
    <p>
     使用dbexport将testdb数据库导出 -ss生成服务器特定的语法
    </p>
    <p>
     <strong>
      dbexport testdb -ss
     </strong>
    </p>
    <p>
     <strong>
     </strong>
     删除testdb数据库
    </p>
    <p>
     <strong>
      dbaccess - -
     </strong>
    </p>
    <p>
     <strong>
     </strong>
     <strong>
      &gt;drop database testdb;
     </strong>
    </p>
    <p>
     <strong>
     </strong>
     使用dbimport重新导入testdb数据库,数据库创建在datadbs1数据库空间中。导入过程使用缓冲日志模式
    </p>
    <p>
     <strong>
      dbimport testdb -d datadbs1 -l buffered
     </strong>
    </p>
    <h3>
     4
    </h3>
    <p>
     <strong>
      备份与恢复操作指南
     </strong>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     <strong>
      语法简介
     </strong>
    </p>
    <p>
     GBase 8s数据库中，备份与恢复分为三个级别，分别是0级备份，1级备份，以及2级备份。0级备份指的是备份数据库中所有的数据；1级备份是在0级备份基础上，备份被修改过的数据页；2级备份是在1级备份基础上，备份被修改过的数据页。主要的备份命令有两个，分别是ontape和onbar 。其中，onbar命令功能强大，可以恢复到具体时间点，可以选择具体存储空间，可以并行执行备份操作，但是相对配置比较复杂。ontape命令简单易用，虽然没有onbar功能强大，但是使用ontape命令在备份的同时，可以更改数据库日志模式，这也是比较实用的功能。
    </p>
    <p>
     1.ontape语法：
    </p>
    <p>
     ontape  -a [-d]
    </p>
    <p>
     //备份逻辑日志
    </p>
    <p>
     ontape -s [[-L archive_level]] [-A database_list] [-B database_list]
    </p>
    <p>
     [-N database_list] [-U database_list] [-t tape_device_path ]
    </p>
    <p>
     //备份数据库
    </p>
    <p>
     ontape -p
    </p>
    <p>
     //恢复数据库
    </p>
    <p>
    </p>
    <p>
     2.onbar 语法：
    </p>
    <p>
     onbar -b -l [-c | -C | -s] [-O]
     <strong>
     </strong>
    </p>
    <p>
     //备份逻辑日志
    </p>
    <p>
     onbar -b  [-L &lt;level&gt;] [-w | -f &lt;filename&gt; | &lt;spaces&gt;] [-O]
    </p>
    <p>
     //备份数据库
    </p>
    <p>
     onbar -r -l [ -t "&lt;time&gt;" | -n &lt;log&gt;]
    </p>
    <p>
     //恢复逻辑日志
    </p>
    <p>
     onbar -r  [-t "&lt;time&gt;" | -n &lt;log&gt;] [-f &lt;filename&gt; | &lt;spaces&gt;]
     <strong>
     </strong>
    </p>
    <p>
     //恢复数据库
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     <strong>
      简单示例
     </strong>
    </p>
    <p>
     （1）使用
     <strong>
      ontape
     </strong>
     命令执行零级数据库备份
    </p>
    <p>
     <strong>
     </strong>
     ontape -s -L 0
    </p>
    <p>
     通过onstat -m命令查看日志中备份信息。
    </p>
    <p>
     通过onstat -g arc命令查看数据库近期备份情况。
    </p>
    <p>
     （2）使用
     <strong>
      ontape
     </strong>
     命令恢复数据库
    </p>
    <p>
     关闭实例：
    </p>
    <p>
     <strong>
     </strong>
     onmode -ky
    </p>
    <p>
     执行ontape命令
    </p>
    <p>
     <strong>
     </strong>
     <strong>
     </strong>
     ontape -r
     <strong>
     </strong>
     <strong>
      //从离线模式到静态模式
     </strong>
    </p>
    <p>
     <strong>
     </strong>
     onmode -m
     <strong>
     </strong>
     <strong>
     </strong>
     <strong>
      //转换到在线模式
     </strong>
     <strong>
     </strong>
    </p>
    <p>
    </p>
    <p>
     熟练以上操作，快速掌握GBase 8s产品，玩转日常运维!
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33333830303637322f:61727469636c652f64657461696c732f313236343739333732" class_="artid" style="display:none">
 </p>
</div>


