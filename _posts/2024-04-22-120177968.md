---
layout: post
title: "使用树莓派读取游戏手柄数据"
date: 2024-04-22 09:58:54 +0800
description: "本文详述如何在树莓派上使用python3读取USB游戏手柄数据，通过安装joystick软件，创建虚"
keywords: "树莓派 获取 蓝牙手柄 数据"
categories: ['机器人技术']
tags: ['Python', 'Linux']
artid: "120177968"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=120177968
    alt: "使用树莓派读取游戏手柄数据"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     使用树莓派读取游戏手柄数据
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      使用树莓派读取游戏手柄数据
     </h4>
    </div>
    <p>
    </p>
    <p>
     本教程使用树莓派读取游戏手柄数据，python3版本，可将数据读取为list。
     <br/>
     大致思路是使用joystick软件，解析出手柄的数据，保存在文件中，再读文件数据。考虑到sd卡读写次数有限，将上述临时文件放在内存当中。
     <br/>
     一、在shell环境下先安装手柄的操作软件
     <br/>
     #1.更新包信息
     <br/>
     sudo apt-get update
     <br/>
     #2.安装手柄软件
     <br/>
     sudo apt-get install joystick
     <br/>
     二、测试软件是否正常工作
     <br/>
     插上手柄，在shell中输入
     <br/>
     cat /dev/input/js0 | hexdump
     <br/>
     正常应该出现一堆数字，而且数字会随着手柄按键活动变化。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ae596c157644e0ea613ddadd3fd9fc40.png">
      <br/>
      三、增加虚拟硬盘文件
     </img>
    </p>
    <p>
     在文件：/etc/fatab末尾增加：
    </p>
    <pre><code class="prism language-bash">tmpfs /var/jstestRes tmpfs defaults,noatime,nosuid,mode<span class="token operator">=</span>0777,size<span class="token operator">=</span>1m <span class="token number">0</span> <span class="token number">0</span>
</code></pre>
    <p>
     重启树莓派后检查是否出现文件夹：/var/jstestRes
     <br/>
     四、运行python文件：
     <br/>
     https://download.csdn.net/download/lianqingde/22031214
     <br/>
     该文件在子进程中调用文件：/home/pi/app/starter，该地址可自行确定。按照本文目录设定，应该如下：
     <br/>
     <img alt="必须具备starter文件和joyStick.py文件" src="https://i-blog.csdnimg.cn/blog_migrate/46c353ba7455dd4454516136de0eb480.png">
      必须具备starter文件和joyStick.py文件。
     </img>
    </p>
    <p>
     文件为脚本：
    </p>
    <pre><code class="prism language-bash"> <span class="token comment">#!/bin/bash</span>
jstest /dev/input/js0 <span class="token operator">&gt;</span> /var/jstestRes/res.txt
</code></pre>
    <p>
     五、运行：python3 joyStick.py
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ad8659738b454641f9c76bbda50ad3d4.png"/>
    </p>
    <p>
     六、部分代码如下：
     <br/>
     初始化：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>process <span class="token operator">=</span>subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span><span class="token string">"/home/pi/app/starter"</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/var/jstestRes/res.txt'</span><span class="token punctuation">,</span> <span class="token string">'w+'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>CleanBufFile<span class="token punctuation">(</span>）
</code></pre>
    <p>
     读数据：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">ReadStcick</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>Buf <span class="token operator">=</span> self<span class="token punctuation">.</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>Buf <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">:</span>
            <span class="token comment"># print(self.Buf)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>AnsisStickData<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>CleanBufFile<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     得到手柄数据位于list:StickAxes, StickBtn当中
    </p>
    <pre><code class="prism language-python"> <span class="token keyword">def</span> <span class="token function">AnsisStickData</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        StickAxes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
        StickBtn <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>

        tmp <span class="token operator">=</span> self<span class="token punctuation">.</span>Buf<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"Buttons:"</span><span class="token punctuation">)</span>
        StickAxesData <span class="token operator">=</span> tmp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>
        StickBtnsData <span class="token operator">=</span> tmp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        StickAxesData <span class="token operator">=</span> StickAxesData<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"Axes:"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        StickAxesData <span class="token operator">=</span> StickAxesData<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>StickAxes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            StickAxes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>GetData<span class="token punctuation">(</span>StickAxesData<span class="token punctuation">,</span> i<span class="token punctuation">)</span>

        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>StickBtn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            StickBtn<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>GetData<span class="token punctuation">(</span>StickBtnsData<span class="token punctuation">,</span> i<span class="token punctuation">)</span>

        <span class="token keyword">return</span> StickAxes<span class="token punctuation">,</span> StickBtn
        <span class="token keyword">pass</span>
</code></pre>
    <p>
     手柄就是普通的usb手柄，我买的时候特意在淘宝上找了一家自称可以兼容树莓派的，实测可用，20一个。链接如下：
    </p>
    <pre><code class="prism language-bash">https://item.taobao.com/item.htm?spm<span class="token operator">=</span>a1z09.2.0.0.475b2e8dA84SaS<span class="token operator">&amp;</span><span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token number">546529614303</span><span class="token operator">&amp;</span><span class="token assign-left variable">_u</span><span class="token operator">=</span>82113089bc4
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d0d8d4b4193a5e8ca34e79cb940ca05a.png">
      <br/>
      附上代码链接：https://download.csdn.net/download/lianqingde/22031214
     </img>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f6c69616e71696e6764652f:61727469636c652f64657461696c732f313230313737393638" class_="artid" style="display:none">
 </p>
</div>


