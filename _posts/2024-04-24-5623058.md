---
layout: post
title: "音视频解码模块阅读笔记一"
date: 2024-04-24 08:45:32 +0800
description: " 在我们的系统中， 一直觉得音视频解码是较为神秘的模块之一，不理解该模块的工作原理，基本上对整个系统"
keywords: "海思 最大的视频缓存池个数"
categories: ['Hismall']
tags: ['工作', 'Video', 'Vb', 'Input', 'Exchange', 'Bt']
artid: "5623058"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=5623058
    alt: "音视频解码模块阅读笔记一"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     音视频解码模块阅读笔记（一）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     在我们的系统中， 一直觉得音视频解码是较为神秘的模块之一，不理解该模块的工作原理，基本上对整个系统的把握就谈不下掌握了。
     <br/>
     今天是第一次写该阅读笔记，个人重点想要了解和学习的地方是音频和视频是如何输出的。
     <br/>
     最近社会风气不好，去年的曾哥，今天的著姐。越来越看不懂这个社会，哎，著姐，你就干脆点，自宫得了吧。想练自功，必先自宫。
     <br/>
     回到整个系统中来，所谓音视频解码，大多数所做的工作便是对海思音视频解码库api的调用。想要完整的解出音视频数据吗，行，老老实
     <br/>
     实的调用海思提供的api函数。
     <br/>
     说了半天的白话，/：-）。
     <br/>
     <br/>
     <br/>
     一， 在进行音视频解码前，首行我们得进行平台初始化工作。
     <br/>
     InitPlatform（）
     <br/>
     ｛
     <br/>
     .......
     <br/>
     ｝
     <br/>
     该函数主要完成如下工作。
     <br/>
     先清空系统控制信息，视频缓冲区的信息
     <br/>
     HI_MPI_SYS_Exit（）
     <br/>
     HI_MPI_VB_Exit（）
     <br/>
     <br/>
     接下来设置视频缓冲区
     <br/>
     先配置几个视频缓冲区的大小
     <br/>
     stVbConf.astCommPool[0].u32BlkSize = 720 * 576 * 2;/*D1*/
     <br/>
     stVbConf.astCommPool[0].u32BlkCnt  = 10;
     <br/>
     stVbConf.astCommPool[1].u32BlkSize = 704 * 576 * 2;/*D1*/
     <br/>
     stVbConf.astCommPool[1].u32BlkCnt  = 52;
     <br/>
     stVbConf.astCommPool[2].u32BlkSize = 384 * 576 * 2;/*2CIF*/
     <br/>
     stVbConf.astCommPool[2].u32BlkCnt = 64;
     <br/>
     stVbConf.astCommPool[3].u32BlkSize = 384 * 288 * 2;/*CIF*/
     <br/>
     stVbConf.astCommPool[3].u32BlkCnt  = 20;
     <br/>
     <br/>
     设置系统中使用图像的字节对齐数,开发文档推荐配置成16 or 64就可以了，此时不是很明白，得去问问罗罗了。
     <br/>
     <br/>
     stSysConf.u32AlignWidth = 64;
     <br/>
     HI_MPI_VB_SetConf（&amp;stVbConf）
     <br/>
     视频缓冲区初始化。
     <br/>
     HI_MPI_VB_Init
     <br/>
     <br/>
     二， 完成了系统平台的初始化，接下来该进行音视频的输入处理。
     <br/>
     在视频输入处理中有一个概念必要要明确，vi设备端口，hi3520有4个vi设备端口,最大同进支持16ch视频输入，也就是说1个vi设备端口对应4个视频输入设备。
     <br/>
     视频输入的初始化得完成以下几个工作。
     <br/>
     <br/>
     设置vi设备端口的属性 HI_MPI_VI_SetPubAttr
     <br/>
     |
     <br/>
     |
     <br/>
     |
     <br/>
     V
     <br/>
     vi设备使能 HI_MPI_VI_Enable(ViDev)
     <br/>
     |
     <br/>
     |
     <br/>
     设置vi设备端口接入各个vi通道的属性
     <br/>
     <br/>
     <br/>
     <br/>
     在hi3520系统中，3520芯片外的数据是通过ITU-R BT656/601/1120 接口或digital camera 接口，存入芯片外的内存区域的，
     <br/>
     当数据接口为ITU-R BT656 时， 一个vi设备能支持多个通道，最多支持4个，我们称之为ViChn0、ViChn1、ViChn2、ViChn3。
     <br/>
     <br/>
     1 设置vi设备端口的属性
     <br/>
     <br/>
     设置属性接口函数，VI_DEV ViDevId vi输入设备端口。pstPubAttr 设置属性值。
     <br/>
     <br/>
     HI_S32 HI_MPI_VI_SetPubAttr(VI_DEV ViDevId,const VI_PUB_ATTR_S *pstPubAttr);
    </p>
    <p>
     typedef struct hiVI_PUB_ATTR_S
     <br/>
     {
     <!-- -->
     <br/>
     VI_INPUT_MODE_E enInputMode;  /* video input mode */
     <br/>
     <br/>
     VI_WORK_MODE_E  enWorkMode;   /* work mode(only for ITU-R.BT656) */
     <br/>
     VIDEO_NORM_E  enViNorm;    /* video input normal(only for BT.601) */
     <br/>
     HI_BOOL         bIsChromaChn;       /* whethe this device capture chroma data (only for BT.1120) */
     <br/>
     HI_BOOL         bChromaSwap;        /* whethe exchange U/V of chroma channle  (only for BT.1120) */
     <br/>
     } VI_PUB_ATTR_S;
     <br/>
     <br/>
     HI_MPI_VI_Enable(ViDev);
     <br/>
     <br/>
     2 设置完视频输入设备，接下来该设置视频输入通道。
     <br/>
     一个视频输入设备对应4个通道。
     <br/>
     <br/>
     和视频输入设备设置一个样，先设置通道属性
     <br/>
     s32Ret = HI_MPI_VI_SetChnAttr(ViDev, ViChn, pstViChnAttr);
     <br/>
     再接下来使能通道
     <br/>
     s32Ret = HI_MPI_VI_EnableChn(ViDev, ViChn);
     <br/>
     设置通道的每秒的帧数，N制下为30，pal制为25帧。
     <br/>
     s32Ret = HI_MPI_VI_SetSrcFrameRate(ViDev, ViChn, u32SrcFrmRate);
     <br/>
     <br/>
     今天就写到这里了吧， 下次继续。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f6c696e75787379737465:6d2f61727469636c652f64657461696c732f35363233303538" class_="artid" style="display:none">
 </p>
</div>


