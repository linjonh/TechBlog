---
layout: post
title: "达梦数据库分区表的使用"
date: 2024-12-27 07:00:00 +0800
description: "本文深入探讨了达梦数据库中的分区技术，包括范围分区、列表分区和哈希分区，详细介绍了创建、管理和操作分"
keywords: "达梦数据库分库分表"
categories: ['达梦数据库']
tags: ['无标签']
artid: "104366645"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=104366645
    alt: "达梦数据库分区表的使用"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     达梦数据库分区表的使用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     前言
    </h2>
    <blockquote>
     <p>
      在大型的企业应用或企业级的数据库应用中，要处理的数据量通常达到TB级，对于这样的大型表执行全表扫描或者DML操作时，效率是非常低的。
      <br/>
      为了提高数据库在大数据量读写操作和查询时的效率，达梦数据库提供了对表和索引进行分区的技术，把表和索引等数据库对象中的数据分割成小的单位，分别存放在一个个单独的段中，用户对表的访问转化为对较小段的访问，以改善大型应用系统的性能。
     </p>
    </blockquote>
    <p>
     达梦数据库分区表主要包括范围分区、哈希分区和列表分区三种方式， 企业可以使用合适的分区方法，如日期（范围）、区域（列表），对大量数据进行分区。由于达梦数据库划分的分区是相互独立且可以存储于不同的存储介质上的，完全可满足企业高可用性、 均衡IO、降低维护成本、提高查询性能的要求。今天我们主要讨论水平分区
    </p>
    <h2>
     <a id="__5">
     </a>
     一 创建分区表
    </h2>
    <h3>
     <a id="1_6">
     </a>
     1.创建范围分区表
    </h3>
    <pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> r_t1 <span class="token punctuation">(</span>pid <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">,</span>id <span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token keyword">partition</span> <span class="token keyword">by</span> range <span class="token punctuation">(</span>pid<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">partition</span> p1 <span class="token keyword">values</span> less than <span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">partition</span> p2 <span class="token keyword">values</span> less than <span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/df503d8c0de4cf1327e0555e8d7b32ee.png"/>
    </p>
    <p>
     将1-200的值录入到t_r1中。
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">begin</span>
<span class="token keyword">for</span> i <span class="token operator">in</span> <span class="token number">1.</span><span class="token number">.200</span> <span class="token keyword">loop</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> r_t1 <span class="token keyword">values</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span> <span class="token keyword">loop</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/bc1f41f545f1a3ba8dc1ecbaa9907a70.png">
      <br/>
      查看表r_t1的类型，显示为分区表。
     </img>
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">select</span> table_name<span class="token punctuation">,</span>PARTITIONED <span class="token keyword">from</span> dba_tables <span class="token keyword">where</span> table_name<span class="token operator">=</span><span class="token string">'R_T1'</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/df0a63933d0b89e3d3fb8eeadaf278da.png">
      <br/>
      查看分区表的分区，显示为二个分区p1和p2。
     </img>
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">select</span> table_name<span class="token punctuation">,</span>partition_name <span class="token keyword">from</span> dba_tab_partitions <span class="token keyword">where</span> table_name<span class="token operator">=</span><span class="token string">'R_T1'</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/dd53bbc83b470dd3aebfc8767f60c247.png">
      <br/>
      查询分区表中的记录数。
     </img>
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> r_t1 <span class="token keyword">partition</span> <span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/84e0e04cb3fea27b2114c95437a9acf8.png">
      <br/>
      这样一个范围分区就建立好了。
     </img>
    </p>
    <h3>
     <a id="2_44">
     </a>
     2.创建列表分区
    </h3>
    <pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> l_t1 <span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span>name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">partition</span> <span class="token keyword">by</span> list <span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">partition</span> p1 <span class="token keyword">values</span>  <span class="token punctuation">(</span><span class="token string">'湖北'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">partition</span> p2 <span class="token keyword">values</span>  <span class="token punctuation">(</span><span class="token string">'湖南'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">partition</span> p3 <span class="token keyword">values</span>  <span class="token punctuation">(</span><span class="token string">'安徽'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b4793e1091c40ef4fec0211f57d2244c.png">
      <br/>
      查看分区表的分区，显示为三个分区p1，p2，p3
     </img>
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span><span class="token keyword">select</span> table_name<span class="token punctuation">,</span>partition_name <span class="token keyword">from</span> dba_tab_partitions <span class="token keyword">where</span> table_name<span class="token operator">=</span><span class="token string">'L_T1'</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/554db7875e3101c91113030a599f37ae.png"/>
    </p>
    <h3>
     <a id="3_61">
     </a>
     3.创建哈希分区
    </h3>
    <pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> sales01<span class="token punctuation">(</span>sales_id <span class="token keyword">INT</span><span class="token punctuation">,</span> saleman <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
saledate <span class="token keyword">DATETIME</span><span class="token punctuation">,</span> city  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token keyword">HASH</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">PARTITION</span> p1<span class="token punctuation">,</span>
<span class="token keyword">PARTITION</span> p2<span class="token punctuation">,</span>
<span class="token keyword">PARTITION</span> p3<span class="token punctuation">,</span>
<span class="token keyword">PARTITION</span> p4 <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ab57a7f6f5e010ecde3321194de65fa1.png">
      <br/>
      如果不需指定分区表名，可以通过指定哈希分区个数来建立哈希分区表。
     </img>
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> sales02<span class="token punctuation">(</span>sales_id <span class="token keyword">int</span><span class="token punctuation">,</span> saleman <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
saledate <span class="token keyword">DATETIME</span><span class="token punctuation">,</span> city  <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">PARTITION</span> BYHASH<span class="token punctuation">(</span>city<span class="token punctuation">)</span>
PARTITIONS <span class="token number">4</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f483642210378858ef7295f60054ecc6.png">
      <br/>
      PARTITIONS后的数字表示哈希分区的分区数，STORE IN 子句中指定了哈希分区依 次使用的表空间。使用这种方式建立的哈希分区表分区名是匿名的，DM7 统一使用 DMHASHPART+分区号（从 0 开始）作为分区名。例如，需要查询 sales02第一个分区的数据，可执行以下语句：
     </img>
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span><span class="token keyword">SELECT</span><span class="token operator">*</span> <span class="token keyword">FROM</span> sales02 <span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>DMHASHPART1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/29912d638761b3825d09eddee3e70cc9.png"/>
    </p>
    <h2>
     <a id="__86">
     </a>
     二 增加分区
    </h2>
    <pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> r_t1 <span class="token keyword">add</span> <span class="token keyword">partition</span> p3 <span class="token keyword">values</span> less than<span class="token punctuation">(</span><span class="token number">301</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/295d7e35b06367930180aa9147ec4cff.png"/>
     <br/>
     查看分区数，可以看到新增了一个分区p3
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ae31858aabeeae18898bbeb9b589575d.png"/>
    </p>
    <h2>
     <a id="__95">
     </a>
     三 删除分区
    </h2>
    <pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> r_t1 <span class="token keyword">drop</span> <span class="token keyword">partition</span> p3<span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/23e3ec330f4dc45c9727022ca70389ca.png"/>
     <br/>
     可以看到，新增的分区P3被删除了。
    </p>
    <h2>
     <a id="__102">
     </a>
     四 合并分区
    </h2>
    <pre><code class="prism language-sql"><span class="token keyword">Sql</span><span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> r_t1 <span class="token keyword">merge</span> partitions p1<span class="token punctuation">,</span>p2 <span class="token keyword">into</span> <span class="token keyword">partition</span> p1_2<span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2a9dc2562c13a405ee8114533afd0099.png"/>
    </p>
    <h2>
     <a id="__109">
     </a>
     五 拆分分区
    </h2>
    <pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> r_t1 split <span class="token keyword">partition</span> p1_2 at <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">into</span> <span class="token punctuation">(</span><span class="token keyword">partition</span> p1<span class="token punctuation">,</span><span class="token keyword">partition</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/eeb7a2510c38c7c94f1ed304fda16b58.png"/>
    </p>
    <h2>
     <a id="__116">
     </a>
     六 水平分区表的限制
    </h2>
    <ol>
     <li>
      分区列类型必须是数值型、字符型或日期型，不支持BLOB、CLOB、IMAGE、TEXT、 LONGVARCHAR、BIT、BINARY、VARBINARY、LONGVARBINARY、时间间隔类型和用户自定义类型为分区列。
     </li>
     <li>
      范围分区和哈希分区的分区键可以多个，最多不超过16列；LIST分区的分区键 必须唯一。
     </li>
     <li>
      水平分区表指定主键和唯一约束时，分区键必须都包含在主键和唯一约束中。
     </li>
     <li>
      水平分区表不支持临时表。
     </li>
     <li>
      不能在水平分区表上建立自引用约束。
     </li>
     <li>
      普通环境中，水平分区表的各级分区数的总和上限是 65535；MPP 环境下，水平 分区表的各级分区总数上限取决于INI参数MAX_EP_SITES，上限为2 ^( 16 - log2MAX_EP_SITES)。比如：当MAX_EP_SITES为默认值64时，分区总数上 限为1024。
     </li>
     <li>
      不允许对分区子表执行任何DDL操作。
     </li>
     <li>
      哈希分区支持重命名、删除约束、设置触发器是否启用的修改操作。
     </li>
     <li>
      范围分区支持分区合并、拆分、增加、删除、交换、重命名、删除约束、设置触发 器是否生效操作。
     </li>
     <li>
      LIST分区支持分区增加、删除、交换、重命名、删除约束、设置触发器是否生效操作。
     </li>
     <li>
      LIST分区范围值不能为NULL。
     </li>
    </ol>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f66656e677869616f7a68656e6a61792f:61727469636c652f64657461696c732f313034333636363435" class_="artid" style="display:none">
 </p>
</div>


