---
layout: post
title: "Redis-select选择数据库"
date: 2025-01-07 10:41:15 +0800
description: "Redis的功能真是强大，可以做数据库，可以做缓存。今天发现Redis支持分隔操作空间，使得空间与空"
keywords: "redisson选择数据库"
categories: ['Redis']
tags: ['Select', 'Redis']
artid: "80638948"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=80638948
    alt: "Redis-select选择数据库"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Redis select选择数据库
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     Redis的功能真是强大，可以做数据库，可以做缓存。
    </p>
    <p>
     今天发现Redis支持分隔操作空间，使得空间与空间之间互不影响。
    </p>
    <p>
     <strong>
      SELECT index
     </strong>
     <br/>
     切换到指定的数据库，数据库索引号 index 用数字值指定，以 0 作为起始索引值。
     <br/>
     默认使用 0 号数据库。
    </p>
    <p>
     <strong>
      可用版本：
     </strong>
     <br/>
     &gt;= 1.0.0
     <br/>
     <strong>
      时间复杂度：
     </strong>
     <br/>
     O(1)
     <br/>
     <strong>
      返回值：
     </strong>
     <br/>
     OK
    </p>
    <pre class="prettyprint"><code class="hljs vbnet">redis&gt; <span class="hljs-keyword">SET</span> number <span class="hljs-number">0</span>         <span class="hljs-preprocessor"># 默认使用 0 号数据库</span>
OK

redis&gt; <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>                <span class="hljs-preprocessor"># 使用 1 号数据库</span>
OK

redis[<span class="hljs-number">1</span>]&gt; <span class="hljs-keyword">GET</span> number        <span class="hljs-preprocessor"># 已经切换到 1 号数据库，注意 Redis 现在的命令提示符多了个 [1]</span>
(nil)

redis[<span class="hljs-number">1</span>]&gt; <span class="hljs-keyword">SET</span> number <span class="hljs-number">1</span>
OK

redis[<span class="hljs-number">1</span>]&gt; <span class="hljs-keyword">GET</span> number
<span class="hljs-string">"1"</span>

redis[<span class="hljs-number">1</span>]&gt; <span class="hljs-keyword">SELECT</span> <span class="hljs-number">3</span>             <span class="hljs-preprocessor"># 再切换到 3 号数据库</span>
OK

redis[<span class="hljs-number">3</span>]&gt;                      <span class="hljs-preprocessor"># 提示符从 [1] 改变成了 [3]</span></code></pre>
    <p>
     select index操作可以选择数据库，如果不选择，则默认是db 0。每个连接建立后，如果不select，默认是对db 0操作。
    </p>
    <h3 id="example1">
     Example1
    </h3>
    <p>
     以下代码，建立一个连接，进行select操作，选择db 3，然后关闭。接着再分别建立两个连接进行sadd操作。从输出结果可以看到，两次sadd的操作都是对db 0操作的。
    </p>
    <pre class="prettyprint"><code class="hljs vbscript">package main

import (
    <span class="hljs-string">"log"</span>

    <span class="hljs-string">"github.com/garyburd/redigo/redis"</span>
)

<span class="hljs-keyword">const</span> (


    redisServer = <span class="hljs-string">"10.194.80.35:6379"</span>

)

func main() {

    selectDB(<span class="hljs-number">3</span>)
    batchSADD()
    batchSADD2()

}


func selectDB(num <span class="hljs-built_in">int</span>){


    <span class="hljs-keyword">option</span> := redis.DialPassword(<span class="hljs-string">"123456"</span>)
    c, <span class="hljs-built_in">err</span> := redis.Dial(<span class="hljs-string">"tcp"</span>, redisServer, <span class="hljs-keyword">option</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">err</span> != nil {
        <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"connect server failed:"</span>, <span class="hljs-built_in">err</span>)
        return
    }

    defer c.Close()

    v, <span class="hljs-built_in">err</span> := redis.<span class="hljs-built_in">String</span>(c.<span class="hljs-keyword">Do</span>(<span class="hljs-string">"SELECT"</span>, num))
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">err</span> != nil {
        <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"select failed:"</span>, <span class="hljs-built_in">err</span>)
        return
    }


    <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"select:"</span>,v)

}

func batchSADD(){
    <span class="hljs-keyword">option</span> := redis.DialPassword(<span class="hljs-string">"123456"</span>)
    c, <span class="hljs-built_in">err</span> := redis.Dial(<span class="hljs-string">"tcp"</span>, redisServer, <span class="hljs-keyword">option</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">err</span> != nil {
        <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"connect server failed:"</span>, <span class="hljs-built_in">err</span>)
        return
    }

    defer c.Close()

    setKey := <span class="hljs-string">"myset"</span>
    args := []interface{}{setKey}
    args = append(args, <span class="hljs-string">"10.1"</span>)
    args = append(args, <span class="hljs-string">"10.2"</span>)
    v, <span class="hljs-built_in">err</span> := redis.Int64(c.<span class="hljs-keyword">Do</span>(<span class="hljs-string">"SADD"</span>, args...))
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">err</span> != nil {
        <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"SADD failed:"</span>, <span class="hljs-built_in">err</span>)
        return
    }

    <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"sadd:"</span>,v)
}


func batchSADD2(){
    <span class="hljs-keyword">option</span> := redis.DialPassword(<span class="hljs-string">"123456"</span>)
    c, <span class="hljs-built_in">err</span> := redis.Dial(<span class="hljs-string">"tcp"</span>, redisServer, <span class="hljs-keyword">option</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">err</span> != nil {
        <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"connect server failed:"</span>, <span class="hljs-built_in">err</span>)
        return
    }

    defer c.Close()

    setKey := <span class="hljs-string">"myset"</span>
    args := []interface{}{setKey}
    args = append(args, <span class="hljs-string">"10.3"</span>)
    args = append(args, <span class="hljs-string">"10.4"</span>)
    v, <span class="hljs-built_in">err</span> := redis.Int64(c.<span class="hljs-keyword">Do</span>(<span class="hljs-string">"SADD"</span>, args...))
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">err</span> != nil {
        <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"SADD failed:"</span>, <span class="hljs-built_in">err</span>)
        return
    }

    <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"sadd:"</span>,v)
}</code></pre>
    <p>
     /*
    </p>
    <p>
     select db 3
    </p>
    <p>
     first sadd to db 0
     <br/>
     second sadd to db 0
    </p>
    <p>
     */
    </p>
    <p>
     output结果：
    </p>
    <blockquote>
     <p>
      127.0.0.1:6379&gt; SMEMBERS myset
      <br/>
      1) “10.1”
      <br/>
      2) “10.4”
      <br/>
      3) “10.2”
      <br/>
      4) “10.3”
      <br/>
      127.0.0.1:6379&gt;
      <br/>
      127.0.0.1:6379&gt;
      <br/>
      127.0.0.1:6379&gt; select 3
      <br/>
      OK
      <br/>
      127.0.0.1:6379[3]&gt; SMEMBERS myset
      <br/>
      (empty list or set)
      <br/>
      127.0.0.1:6379[3]&gt;
     </p>
    </blockquote>
    <h3 id="example2">
     Example2
    </h3>
    <p>
     建立连接，select 3选择db 3，然后sadd，再建立一个连接，直接sadd。从结果可以看到，第一次sadd操作对db 3操作，第二次sadd对db 0操作的。
    </p>
    <pre class="prettyprint"><code class="hljs vbscript">package main

import (
    <span class="hljs-string">"log"</span>

    <span class="hljs-string">"github.com/garyburd/redigo/redis"</span>
)

<span class="hljs-keyword">const</span> (


    redisServer = <span class="hljs-string">"10.194.80.35:6379"</span>

)

func main() {

    batchSADD()
    batchSADD2()

}


func selectDB(num <span class="hljs-built_in">int</span>){


    <span class="hljs-keyword">option</span> := redis.DialPassword(<span class="hljs-string">"123456"</span>)
    c, <span class="hljs-built_in">err</span> := redis.Dial(<span class="hljs-string">"tcp"</span>, redisServer, <span class="hljs-keyword">option</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">err</span> != nil {
        <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"connect server failed:"</span>, <span class="hljs-built_in">err</span>)
        return
    }

    defer c.Close()

    v, <span class="hljs-built_in">err</span> := redis.<span class="hljs-built_in">String</span>(c.<span class="hljs-keyword">Do</span>(<span class="hljs-string">"SELECT"</span>, num))
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">err</span> != nil {
        <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"select failed:"</span>, <span class="hljs-built_in">err</span>)
        return
    }


    <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"select:"</span>,v)

}

func batchSADD(){
    <span class="hljs-keyword">option</span> := redis.DialPassword(<span class="hljs-string">"123456"</span>)
    c, <span class="hljs-built_in">err</span> := redis.Dial(<span class="hljs-string">"tcp"</span>, redisServer, <span class="hljs-keyword">option</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">err</span> != nil {
        <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"connect server failed:"</span>, <span class="hljs-built_in">err</span>)
        return
    }

    defer c.Close()

    ret, <span class="hljs-built_in">err</span> := redis.<span class="hljs-built_in">String</span>(c.<span class="hljs-keyword">Do</span>(<span class="hljs-string">"SELECT"</span>, <span class="hljs-number">3</span>))
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">err</span> != nil {
        <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"select failed:"</span>, <span class="hljs-built_in">err</span>)
        return
    }

    <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"select:"</span>,ret)

    setKey := <span class="hljs-string">"myset"</span>
    args := []interface{}{setKey}
    args = append(args, <span class="hljs-string">"10.1"</span>)
    args = append(args, <span class="hljs-string">"10.2"</span>)
    v, <span class="hljs-built_in">err</span> := redis.Int64(c.<span class="hljs-keyword">Do</span>(<span class="hljs-string">"SADD"</span>, args...))
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">err</span> != nil {
        <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"SADD failed:"</span>, <span class="hljs-built_in">err</span>)
        return
    }

    <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"sadd:"</span>,v)
}


func batchSADD2(){
    <span class="hljs-keyword">option</span> := redis.DialPassword(<span class="hljs-string">"123456"</span>)
    c, <span class="hljs-built_in">err</span> := redis.Dial(<span class="hljs-string">"tcp"</span>, redisServer, <span class="hljs-keyword">option</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">err</span> != nil {
        <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"connect server failed:"</span>, <span class="hljs-built_in">err</span>)
        return
    }

    defer c.Close()

    setKey := <span class="hljs-string">"myset"</span>
    args := []interface{}{setKey}
    args = append(args, <span class="hljs-string">"10.5"</span>)
    args = append(args, <span class="hljs-string">"10.6"</span>)
    v, <span class="hljs-built_in">err</span> := redis.Int64(c.<span class="hljs-keyword">Do</span>(<span class="hljs-string">"SADD"</span>, args...))
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">err</span> != nil {
        <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"SADD failed:"</span>, <span class="hljs-built_in">err</span>)
        return
    }

    <span class="hljs-built_in">log</span>.Println(<span class="hljs-string">"sadd:"</span>,v)
}</code></pre>
    <p>
     /*
     <br/>
     firt sadd to db 3
    </p>
    <p>
     second sadd to db 0
    </p>
    <p>
     */
    </p>
    <p>
     output结果：
    </p>
    <blockquote>
     <p>
      127.0.0.1:6379&gt; SMEMBERS myset
      <br/>
      1) “10.6”
      <br/>
      2) “10.1”
      <br/>
      3) “10.5”
      <br/>
      4) “10.4”
      <br/>
      5) “10.2”
      <br/>
      6) “10.3”
      <br/>
      127.0.0.1:6379&gt; select 3
      <br/>
      OK
      <br/>
      127.0.0.1:6379[3]&gt; SMEMBERS myset
      <br/>
      1) “10.1”
      <br/>
      2) “10.2”
      <br/>
      127.0.0.1:6379[3]&gt;
     </p>
    </blockquote>
    <h3 id="参考">
     参考
    </h3>
    <p>
     <a href="http://redisdoc.com/connection/select.html" rel="nofollow">
      http://redisdoc.com/connection/select.html
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f6c616e79616e67313233343536:2f61727469636c652f64657461696c732f3830363338393438" class_="artid" style="display:none">
 </p>
</div>


