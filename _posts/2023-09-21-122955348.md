---
layout: post
title: "Cè¿›ç¨‹è°ƒç”¨FFmpegæ“ä½œéŸ³è§†é¢‘"
date: 2023-09-21 03:48:09 +0800
description: "é¡¹ç›®èƒŒæ™¯ã€€ã€€å› ä¸ºå…¬å¸éœ€è¦å¯¹éŸ³è§†é¢‘åšä¸€äº›æ“ä½œï¼Œæ¯”å¦‚è¯´å¯¹ç³»ç»Ÿç”¨æˆ·çš„å‘éŸ³å’ŒèƒŒæ™¯è§†é¢‘è¿›è¡Œåˆæˆï¼Œä»¥åŠå¯¹å¤šä¸ªéŸ³è§†"
keywords: "c# ffmpeg"
categories: ['']
tags: ['Python', 'Linux', 'Java', 'Ffmpeg', 'C']
artid: "122955348"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=122955348
    alt: "Cè¿›ç¨‹è°ƒç”¨FFmpegæ“ä½œéŸ³è§†é¢‘"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     C#è¿›ç¨‹è°ƒç”¨FFmpegæ“ä½œéŸ³è§†é¢‘
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <div id="js_content">
     <h3>
      é¡¹ç›®èƒŒæ™¯
     </h3>
     <p style="text-align:left;">
      å› ä¸ºå…¬å¸éœ€è¦å¯¹éŸ³è§†é¢‘åšä¸€äº›æ“ä½œï¼Œæ¯”å¦‚è¯´å¯¹ç³»ç»Ÿç”¨æˆ·çš„å‘éŸ³å’ŒèƒŒæ™¯è§†é¢‘è¿›è¡Œåˆæˆï¼Œä»¥åŠå¯¹å¤šä¸ªéŸ³è§†é¢‘ä¹‹é—´è¿›è¡Œåˆæˆï¼Œè¿˜æœ‰å°±æ˜¯åœ¨æŒ‡å®šçš„æºèƒŒæ™¯éŸ³é¢‘ä¸­æŒ‰ç…§å¯¹åº”çš„è§„åˆ™åœ¨è§†é¢‘çš„å¤šå°‘ç§’é’Ÿå†…æ’å…¥ä¸€æ®µå®¢æˆ·å‘éŸ³ç­‰ä¸€äº›å¤æ‚çš„éŸ³è§†é¢‘æ“ä½œã€‚æœ¬ç¯‡æ–‡ç« ä¸»è¦è®²è§£çš„æ˜¯ä½¿ç”¨C#è¿›ç¨‹ï¼ˆProcessï¼‰è°ƒç”¨FFmpeg.exeè¿›è¡Œè§†é¢‘åˆå¹¶ï¼ŒéŸ³é¢‘åˆå¹¶ï¼ŒéŸ³é¢‘ä¸è§†é¢‘åˆå¹¶æˆè§†é¢‘è¿™å‡ ä¸ªç®€å•çš„éŸ³è§†é¢‘æ“ä½œï¼Œè¿˜æœ‰äº›å¤æ‚çš„éŸ³è§†é¢‘æ“ä½œåç»­æœ‰æ—¶é—´æ…¢æ…¢è¡¥ä¸Šã€‚
     </p>
     <p>
      <strong>
       ğŸš€å›åˆ°é¡¶éƒ¨
      </strong>
     </p>
     <h3>
      FFmpegä»‹ç»
     </h3>
     <blockquote>
      <p>
       æ¥æºç™¾åº¦ç™¾ç§‘ğŸ‘‰
      </p>
     </blockquote>
     <p style="text-align:left;">
      FFmpegæ˜¯ä¸€å¥—å¯ä»¥ç”¨æ¥è®°å½•ã€è½¬æ¢æ•°å­—éŸ³é¢‘ã€è§†é¢‘ï¼Œå¹¶èƒ½å°†å…¶è½¬åŒ–ä¸ºæµçš„å¼€æºè®¡ç®—æœºç¨‹åºã€‚é‡‡ç”¨LGPLæˆ–GPLè®¸å¯è¯ã€‚å®ƒæä¾›äº†å½•åˆ¶ã€è½¬æ¢ä»¥åŠæµåŒ–éŸ³è§†é¢‘çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚å®ƒåŒ…å«äº†éå¸¸å…ˆè¿›çš„éŸ³é¢‘/è§†é¢‘ç¼–è§£ç åº“libavcodecï¼Œä¸ºäº†ä¿è¯é«˜å¯ç§»æ¤æ€§å’Œç¼–è§£ç è´¨é‡ï¼Œlibavcodecé‡Œå¾ˆå¤šcodeéƒ½æ˜¯ä»å¤´å¼€å‘çš„ã€‚
     </p>
     <p style="text-align:left;">
      FFmpegåœ¨Linuxå¹³å°ä¸‹å¼€å‘ï¼Œä½†å®ƒåŒæ ·ä¹Ÿå¯ä»¥åœ¨å…¶å®ƒæ“ä½œç³»ç»Ÿç¯å¢ƒä¸­ç¼–è¯‘è¿è¡Œï¼ŒåŒ…æ‹¬Windowsã€Macç­‰å¤šå¹³å°ã€‚è¿™ä¸ªé¡¹ç›®æœ€æ—©ç”±Fabrice Bellardå‘èµ·ï¼Œ2004å¹´è‡³2015å¹´é—´ç”±Michael Niedermayerä¸»è¦è´Ÿè´£ç»´æŠ¤ã€‚è®¸å¤šFFmpegçš„å¼€å‘äººå‘˜éƒ½æ¥è‡ªMPlayeré¡¹ç›®ï¼Œè€Œä¸”å½“å‰FFmpegä¹Ÿæ˜¯æ”¾åœ¨MPlayeré¡¹ç›®ç»„çš„æœåŠ¡å™¨ä¸Šã€‚é¡¹ç›®çš„åç§°æ¥è‡ªMPEGè§†é¢‘ç¼–ç æ ‡å‡†ï¼Œå‰é¢çš„"FF"ä»£è¡¨"Fast Forward"ã€‚FFmpegç¼–ç åº“å¯ä»¥ä½¿ç”¨GPUåŠ é€Ÿã€‚
     </p>
     <p>
      <strong>
       ğŸš€å›åˆ°é¡¶éƒ¨
      </strong>
     </p>
     <h3>
      FFmpegç›¸å…³æ•™ç¨‹
     </h3>
     <blockquote>
      <p>
       å¼€å§‹ä¹‹åˆä½ é¦–å…ˆè¦äº†è§£FFmpegæ˜¯ä»€ä¹ˆï¼Œæœ‰å“ªäº›å¸¸ç”¨çš„å‘½ä»¤å’Œå®ç”¨çš„åŠŸèƒ½ã€‚
      </p>
     </blockquote>
     <ul>
      <li>
       <p>
        FFmpegå®˜ç½‘æ–‡æ¡£
       </p>
      </li>
      <li>
       <p>
        FFmpegæœ€å…¨æ•™ç¨‹
       </p>
      </li>
      <li>
       <p>
        FFmpeg è§†é¢‘å¤„ç†å…¥é—¨æ•™ç¨‹
       </p>
      </li>
      <li>
       <p>
        FFMPEGå‘½ä»¤å…¥é—¨åˆ°æé«˜ï¼Œä¸€ç¯‡æ–‡ç« å°±å¤Ÿäº†
       </p>
      </li>
     </ul>
     <p>
      <strong>
       ğŸš€å›åˆ°é¡¶éƒ¨
      </strong>
     </p>
     <h3>
      åšå®¢ç¤ºä¾‹æºç 
     </h3>
     <blockquote>
      <p>
       https://github.com/YSGStudyHards/FFmpegAudioAndVideoMergeğŸ‘‰
      </p>
     </blockquote>
     <p>
      <strong>
       ğŸš€å›åˆ°é¡¶éƒ¨
      </strong>
     </p>
     <h3>
      ä¸‹è½½FFmpeg.exeå®‰è£…åŒ…
     </h3>
     <p style="text-align:left;">
      é¦–å…ˆæŠŠä¸‹è½½ä¸‹æ¥çš„FFmpeg.exeæ”¾åœ¨ä½ æŒ‡å®šçš„ç›®å½•æ–‡ä»¶å¤¹ä¸­ï¼Œæ–¹ä¾¿C#è¿›ç¨‹è°ƒç”¨ã€‚
     </p>
     <blockquote>
      <p>
       ffmpeg.exe å®‰è£…åŒ…ï¼šhttps://www.gyan.dev/ffmpeg/builds/ffmpeg-release-essentials.zipğŸ‘‰Â (74MB)
      </p>
     </blockquote>
     <p>
      <strong>
       ğŸš€å›åˆ°é¡¶éƒ¨
      </strong>
     </p>
     <h3>
      C#è¿›ç¨‹è°ƒç”¨FFmpegæ“ä½œéŸ³è§†é¢‘
     </h3>
     <pre class="has"><code class="language-cs">namespace FFmpegAudioAndVideoMerge
{
    class Program
    {
        static void Main(string[] args)
        {
            var physicalPath = "E:\\FFmpegAudioAndVideoMerge\\FFmpegAudioAndVideoMerge\\files\\";


            //è§†é¢‘åˆå¹¶
            VideoCombine(physicalPath + "video1.mp4", physicalPath + "video2.mp4", physicalPath + "merageVideoyy.mp4");


            //éŸ³é¢‘åˆå¹¶
            var audioMergeList = new List&lt;string&gt;();
            audioMergeList.Add(physicalPath + "music1.mp3");
            audioMergeList.Add(physicalPath + "music2.mp3");
            audioMergeList.Add(physicalPath + "music3.mp3");
            AudioMerge(physicalPath, audioMergeList);


            //éŸ³é¢‘ä¸è§†é¢‘åˆå¹¶æˆè§†é¢‘
            AudioAndVideoMerge(physicalPath);
        }


        #region è§†é¢‘åˆå¹¶
        /// &lt;summary&gt;
        /// è§†é¢‘åˆå¹¶
        /// &lt;/summary&gt;
        /// &lt;param name="video1"&gt;åˆå¹¶è§†é¢‘1&lt;/param&gt;
        /// &lt;param name="video2"&gt;åˆå¹¶è§†é¢‘2&lt;/param&gt;
        /// &lt;param name="saveFilePath"&gt;ä¿å­˜æ–‡ä»¶å&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static void VideoCombine(string video1, string video2, string saveFilePath)
        {
            string strTmp1 = video1 + ".ts";
            string strTmp2 = video2 + ".ts";
            string strCmd1 = " -i " + video1 + " -c copy -bsf:v h264_mp4toannexb -f mpegts " + strTmp1 + " -y ";
            string strCmd2 = " -i " + video2 + " -c copy -bsf:v h264_mp4toannexb -f mpegts " + strTmp2 + " -y ";


            string videoMerge = " -i \"concat:" + strTmp1 + "|" +
                strTmp2 + "\" -c copy -bsf:a aac_adtstoasc -movflags +faststart " + saveFilePath + " -y ";


            //1ã€è½¬æ¢æ–‡ä»¶ç±»å‹ï¼Œç”±äºä¸æ˜¯æ‰€æœ‰ç±»å‹çš„è§†é¢‘æ–‡ä»¶éƒ½æ”¯æŒç›´æ¥åˆå¹¶ï¼Œéœ€è¦å…ˆè½¬æ¢æ ¼å¼
            CommandManager(strCmd1);
            CommandManager(strCmd2);


            //2ã€è§†é¢‘åˆå¹¶
            CommandManager(videoMerge);
        }
        #endregion


        #region éŸ³é¢‘åˆå¹¶
        /// &lt;summary&gt;
        /// éŸ³é¢‘åˆå¹¶
        /// &lt;/summary&gt;
        public static void AudioMerge(string physicalPath, List&lt;string&gt; mergeFile)
        {
            //å°†å¤šä¸ªéŸ³é¢‘æ··åˆæˆä¸€ä¸ªéŸ³é¢‘æ–‡ä»¶è¾“å‡º http://www.ffmpeg.org/ffmpeg-all.html#amix


            //ffmpeg -i INPUT1 -i INPUT2 -i INPUT3 -filter_complex amix=inputs=3:duration=first:dropout_transition=3 OUTPUT


            //åˆå¹¶ä¸¤ä¸ªéŸ³é¢‘
            //ffmpeg -i input1.mp3 -i input2.mp3 -filter_complex amerge -ac 2 - c:a libmp3lame -q:a 4 output.mp3


            //è·å–è§†é¢‘ä¸­çš„éŸ³é¢‘
            //ffmpeg -i input.mp4 -vn -y -acodec copy output.m4a


            //å»æ‰è§†é¢‘ä¸­çš„éŸ³é¢‘
            //ffmpeg -i input.mp4 -an output.mp4


            // https://www.cnblogs.com/simadi/p/10649345.html
            // ffmpeg -i "concat:123.mp3|124.mp3" -acodec copy output.mp3
            // è§£é‡Šï¼š-iä»£è¡¨è¾“å…¥å‚æ•°
            // contact: 123.mp3 | 124.mp3ä»£è¡¨ç€éœ€è¦è¿æ¥åˆ°ä¸€èµ·çš„éŸ³é¢‘æ–‡ä»¶ -acodec copy output.mp3 é‡æ–°ç¼–ç å¹¶å¤åˆ¶åˆ°æ–°æ–‡ä»¶ä¸­


            string mergeCommandStr = $"-i \"concat:{string.Join("|", mergeFile.ToArray())}\" -acodec copy {physicalPath}AudioMerge.mp3  -y";
            CommandManager(mergeCommandStr);
        }
        #endregion


        #region éŸ³é¢‘ä¸è§†é¢‘åˆå¹¶æˆè§†é¢‘
        /// &lt;summary&gt;
        /// éŸ³é¢‘ä¸è§†é¢‘åˆå¹¶æˆè§†é¢‘
        /// &lt;/summary&gt;
        /// &lt;param name="physicalPath"&gt;ç‰©ç†è·¯å¾„&lt;/param&gt;
        public static void AudioAndVideoMerge(string physicalPath)
        {
            //1ã€è§†é¢‘æ–‡ä»¶ä¸­æ²¡æœ‰éŸ³é¢‘ã€‚
            //ffmpeg -i video.mp4 -i audio.wav -c:v copy -c:a aac -strict experimental output.mp4
            //string mergeCommandStr = $"-i {physicalPath}video2.mp4 -i {physicalPath}music1.mp3 -c:v copy -c:a aac -strict experimental {physicalPath}output.mp4  -y";


            //video.mp4,audio.wavåˆ†åˆ«æ˜¯è¦åˆå¹¶çš„è§†é¢‘å’ŒéŸ³é¢‘ï¼Œoutput.mp4æ˜¯åˆå¹¶åè¾“å‡ºçš„éŸ³è§†é¢‘æ–‡ä»¶ã€‚
            //2ã€ä¸‹é¢çš„å‘½ä»¤æ˜¯ç”¨audioéŸ³é¢‘æ›¿æ¢videoä¸­çš„éŸ³é¢‘ ffmpeg -i video.mp4 -i audio.wav -c:v copy -c:a aac -strict experimental -map 0:v:0 -map 1:a: 0 output.mp4
            string mergeCommandStr = $"-i {physicalPath}video3.mp4 -i {physicalPath}AudioMerge.mp3 -c:v copy -c:a aac -strict experimental -map 0:v:0 -map 1:a:0 {physicalPath}AudioAndVideoMerge.mp4  -y";


            //3ã€c++éŸ³é¢‘è§†é¢‘åˆå¹¶(è§†é¢‘æ–‡ä»¶ä¸­æ²¡æœ‰éŸ³é¢‘çš„æƒ…å†µä¸‹)
            //"ffmpeg -i /tmp/mergeMp3/392118469203595327/392118469203595327.aac  -i /tmp/mergeMp3/392118469203595327/bg.mp4 -c copy -bsf:a aac_adtstoasc /tmp/mergeMp3/392118469203595327/392118469203595327.mp4 -y"
            //string mergeCommandStr3 = $"-i {physicalPath}video5.mp4  -i {physicalPath}AudioMerge.mp3 -c copy -bsf:a aac_adtstoasc {physicalPath}AudioAndVideoMerge1.mp4 -y";


            CommandManager(mergeCommandStr);
        }
        #endregion




        /// &lt;summary&gt;
        /// æ‰§è¡Œ
        /// C# Processè¿›ç¨‹è°ƒç”¨ https://docs.microsoft.com/zh-cn/dotnet/api/system.diagnostics.process?view=net-5.0
        /// &lt;/summary&gt;
        /// &lt;param name="commandStr"&gt;æ‰§è¡Œå‘½ä»¤&lt;/param&gt;
        public static void CommandManager(string commandStr)
        {
            try
            {
                using (Process process = new Process())
                {
                    process.StartInfo.FileName = "D:\\FFmpeg\\bin\\ffmpeg.exe";//è¦æ‰§è¡Œçš„ç¨‹åºåç§°(å±æ€§ï¼Œè·å–æˆ–è®¾ç½®è¦å¯åŠ¨çš„åº”ç”¨ç¨‹åºæˆ–æ–‡æ¡£ã€‚FileName å±æ€§ä¸éœ€è¦è¡¨ç¤ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚å®ƒå¯ä»¥æ˜¯å…¶æ‰©å±•åå·²ç»ä¸ç³»ç»Ÿä¸Šå®‰è£…çš„åº”ç”¨ç¨‹åºå…³è”çš„ä»»ä½•æ–‡ä»¶ç±»å‹ã€‚)
                    process.StartInfo.Arguments = " " + commandStr;//å¯åŠ¨è¯¥è¿›ç¨‹æ—¶ä¼ é€’çš„å‘½ä»¤è¡Œå‚æ•°
                    process.StartInfo.UseShellExecute = false;
                    process.StartInfo.RedirectStandardInput = false;//å¯èƒ½æ¥å—æ¥è‡ªè°ƒç”¨ç¨‹åºçš„è¾“å…¥ä¿¡æ¯  
                    process.StartInfo.RedirectStandardOutput = false;//ç”±è°ƒç”¨ç¨‹åºè·å–è¾“å‡ºä¿¡æ¯   
                    process.StartInfo.RedirectStandardError = false;//é‡å®šå‘æ ‡å‡†é”™è¯¯è¾“å‡º
                    process.StartInfo.CreateNoWindow = false;//ä¸æ˜¾ç¤ºç¨‹åºçª—å£
                    process.Start();//å¯åŠ¨ç¨‹åº
                    process.WaitForExit();//ç­‰å¾…ç¨‹åºæ‰§è¡Œå®Œé€€å‡ºè¿›ç¨‹(é¿å…è¿›ç¨‹å ç”¨æ–‡ä»¶æˆ–è€…æ˜¯åˆæˆæ–‡ä»¶è¿˜æœªç”Ÿæˆ)*
                }
            }
            catch (Exception e)
            {
                Console.WriteLine(e.Message);
            }
        }
    
}
}</code></pre>
     <blockquote>
      <p>
       æŠ€æœ¯ç¾¤ï¼šæ·»åŠ å°ç¼–å¾®ä¿¡å¹¶å¤‡æ³¨è¿›ç¾¤
      </p>
      <p>
       å°ç¼–å¾®ä¿¡ï¼šmm1552923
      </p>
      <p>
       å…¬ä¼—å·ï¼šdotNetç¼–ç¨‹å¤§å…¨
      </p>
     </blockquote>
    </div>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f7a6c733336353336352f:61727469636c652f64657461696c732f313232393535333438" class_="artid" style="display:none">
 </p>
</div>


