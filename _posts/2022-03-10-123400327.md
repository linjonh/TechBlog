---
layout: post
title: "5.Django-数据库多表查询"
date: 2022-03-10 14:13:33 +0800
description: "文章目录1. 测试环境搭建1.1 创建项目1.2 解决问题1.3 数据库配置1.4 Pycharm连"
keywords: "django數據庫多表查詢"
categories: ['Mysql', 'Django']
tags: ['数据库', 'Mysql', 'Django']
artid: "123400327"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=123400327
    alt: "5.Django-数据库多表查询"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     5.Django 数据库多表查询
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <ul>
        <li>
         <ul>
          <li>
           <a href="#1__1" rel="nofollow">
            1. 测试环境搭建
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#11__3" rel="nofollow">
              1.1 创建项目
             </a>
            </li>
            <li>
             <a href="#12__7" rel="nofollow">
              1.2 解决问题
             </a>
            </li>
            <li>
             <a href="#13__13" rel="nofollow">
              1.3 数据库配置
             </a>
            </li>
            <li>
             <a href="#14_Pycharm_54" rel="nofollow">
              1.4 Pycharm连接数据库
             </a>
            </li>
            <li>
             <a href="#15__64" rel="nofollow">
              1.5 测试脚本
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#2__87" rel="nofollow">
            2. 单表操作
           </a>
          </li>
          <li>
           <ul>
            <li>
             <ul>
              <li>
               <a href="#21__89" rel="nofollow">
                2.1 创建表单
               </a>
              </li>
              <li>
               <a href="#22__116" rel="nofollow">
                2.2 数据库迁移
               </a>
              </li>
              <li>
               <a href="#23__127" rel="nofollow">
                2.3 增加数据
               </a>
              </li>
              <li>
               <a href="#24__150" rel="nofollow">
                2.4 删除数据
               </a>
              </li>
              <li>
               <a href="#25__177" rel="nofollow">
                2.5 修改值
               </a>
              </li>
             </ul>
            </li>
           </ul>
          </li>
          <li>
           <a href="#3_SQL_204" rel="nofollow">
            3. 展示SQL语句
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#31__206" rel="nofollow">
              3.1 方法查看
             </a>
            </li>
            <li>
             <a href="#32__224" rel="nofollow">
              3.2 配置文件
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#4__objects__252" rel="nofollow">
            4. objects 方法
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#41_objects_301" rel="nofollow">
              4.1 objects对象
             </a>
            </li>
            <li>
             <a href="#42__314" rel="nofollow">
              4.2 获取数据对象
             </a>
            </li>
            <li>
             <a href="#43__341" rel="nofollow">
              4.3 过滤条件
             </a>
            </li>
            <li>
             <a href="#44__378" rel="nofollow">
              4.4 头尾的值
             </a>
            </li>
            <li>
             <a href="#45__405" rel="nofollow">
              4.5 获取值
             </a>
            </li>
            <li>
             <a href="#46__454" rel="nofollow">
              4.6 去重
             </a>
            </li>
            <li>
             <a href="#47__505" rel="nofollow">
              4.7 排序
             </a>
            </li>
            <li>
             <a href="#47__556" rel="nofollow">
              4.7 倒序
             </a>
            </li>
            <li>
             <a href="#48__578" rel="nofollow">
              4.8 统计
             </a>
            </li>
            <li>
             <a href="#49__594" rel="nofollow">
              4.9 排除
             </a>
            </li>
            <li>
             <a href="#410__617" rel="nofollow">
              4.10 判断值是否存在
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#5___633" rel="nofollow">
            5. 字段方法
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#51__635" rel="nofollow">
              5.1 双向方法
             </a>
            </li>
            <li>
             <a href="#52__655" rel="nofollow">
              5.2 练习
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#6__844" rel="nofollow">
            6. 多表操作之增删改
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#61__851" rel="nofollow">
              6.1 表数据
             </a>
            </li>
            <li>
             <a href="#62__880" rel="nofollow">
              6.2 建立基础表
             </a>
            </li>
            <li>
             <a href="#63__923" rel="nofollow">
              6.3 外键字段
             </a>
            </li>
            <li>
             <a href="#64__1047" rel="nofollow">
              6.4 数据库迁移
             </a>
            </li>
            <li>
             <a href="#65__1056" rel="nofollow">
              6.5 录数据
             </a>
            </li>
            <li>
             <ul>
              <li>
               <a href="#1__1062" rel="nofollow">
                1. 作者详情表
               </a>
              </li>
              <li>
               <a href="#2_1080" rel="nofollow">
                2.作者表
               </a>
              </li>
              <li>
               <a href="#3__1098" rel="nofollow">
                3. 出版社表
               </a>
              </li>
              <li>
               <a href="#4_1114" rel="nofollow">
                4.数据表
               </a>
              </li>
             </ul>
            </li>
            <li>
             <a href="#66___1134" rel="nofollow">
              6.6 一对多外键操作
             </a>
            </li>
            <li>
             <ul>
              <li>
               <a href="#1__1152" rel="nofollow">
                1. 增
               </a>
              </li>
              <li>
               <a href="#2__1184" rel="nofollow">
                2. 删
               </a>
              </li>
              <li>
               <a href="#3__1206" rel="nofollow">
                3. 修改
               </a>
              </li>
             </ul>
            </li>
            <li>
             <a href="#67__1229" rel="nofollow">
              6.7 多对多外键操作
             </a>
            </li>
            <li>
             <ul>
              <li>
               <a href="#1__1237" rel="nofollow">
                1. 增
               </a>
              </li>
              <li>
               <a href="#2__1282" rel="nofollow">
                2. 删
               </a>
              </li>
              <li>
               <a href="#3__1323" rel="nofollow">
                3. 修改
               </a>
              </li>
              <li>
               <a href="#4__1359" rel="nofollow">
                4. 清空
               </a>
              </li>
             </ul>
            </li>
           </ul>
          </li>
          <li>
           <a href="#7___1373" rel="nofollow">
            7. 跨表查询
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#71__1375" rel="nofollow">
              7.1 正反向的概念
             </a>
            </li>
            <li>
             <a href="#62__1392" rel="nofollow">
              6.2 子查询
             </a>
            </li>
            <li>
             <a href="#73__1475" rel="nofollow">
              7.3 联表查询
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#8__1583" rel="nofollow">
            8. 双下方式查询
           </a>
          </li>
          <li>
           <ul>
            <li>
             <ul>
              <li>
               <a href="#81__1600" rel="nofollow">
                8.1 正向查询
               </a>
              </li>
              <li>
               <a href="#82__1695" rel="nofollow">
                8.2 反向查询
               </a>
              </li>
             </ul>
            </li>
           </ul>
          </li>
          <li>
           <a href="#9__1770" rel="nofollow">
            9. 聚合查询
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#91__1785" rel="nofollow">
              9.1 直接使用
             </a>
            </li>
            <li>
             <a href="#92__1849" rel="nofollow">
              9.2 分组查询
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#10_F_1955" rel="nofollow">
            10. F查询
           </a>
          </li>
          <li>
           <a href="#11_Q_2064" rel="nofollow">
            11. Q查询
           </a>
          </li>
          <li>
           <a href="#12_Django_2112" rel="nofollow">
            12. Django中开启事务
           </a>
          </li>
          <li>
           <a href="#13_ORM__2140" rel="nofollow">
            13. ORM 字段&amp;参数
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#131__2142" rel="nofollow">
              13.1 内置字段
             </a>
            </li>
            <li>
             <a href="#132__2215" rel="nofollow">
              13.2 自定义字段
             </a>
            </li>
            <li>
             <a href="#132_choices_2236" rel="nofollow">
              13.2 choices参数
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#14__2302" rel="nofollow">
            14. 多对多创建方式
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#141__2304" rel="nofollow">
              14.1 全自动
             </a>
            </li>
            <li>
             <a href="#142__2324" rel="nofollow">
              14.2 纯手动
             </a>
            </li>
            <li>
             <a href="#143__2348" rel="nofollow">
              14.3 半自动
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#15__2498" rel="nofollow">
            15. 数据库的查询优化
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#151__2511" rel="nofollow">
              15.1 惰性查询
             </a>
            </li>
            <li>
             <a href="#152_only_2536" rel="nofollow">
              15.2 only
             </a>
            </li>
            <li>
             <a href="#153_defer_2581" rel="nofollow">
              15.3 defer
             </a>
            </li>
            <li>
             <a href="#154_select_related_2614" rel="nofollow">
              15.4 select_related
             </a>
            </li>
            <li>
             <a href="#155_prefetch_related_2640" rel="nofollow">
              15.5 prefetch_related
             </a>
            </li>
           </ul>
          </li>
         </ul>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h4>
     <a id="1__1">
     </a>
     1. 测试环境搭建
    </h4>
    <h5>
     <a id="11__3">
     </a>
     1.1 创建项目
    </h5>
    <p>
     <img alt="image-20220307192312533" src="https://i-blog.csdnimg.cn/blog_migrate/c324ad94b1db2796049fb1f0cac65e5d.png"/>
    </p>
    <h5>
     <a id="12__7">
     </a>
     1.2 解决问题
    </h5>
    <pre><code class="prism language-handlebars"><span class="token number">0.</span> <span class="token variable">解决templates</span> <span class="token variable">路径拼接问题</span>
<span class="token number">1.</span> <span class="token variable">注释csrf中间键</span>
</code></pre>
    <h5>
     <a id="13__13">
     </a>
     1.3 数据库配置
    </h5>
    <pre><code class="prism language-handlebars"><span class="token punctuation">*</span> <span class="token variable">连接以及存在的MySQL数据库</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token number">0.</span> <span class="token variable">Navicat</span> <span class="token variable">中创建</span> <span class="token variable">一个</span> <span class="token variable">OMR</span> <span class="token variable">库</span><span class="token punctuation">.</span>
<span class="token number">1.</span> <span class="token variable">settings</span> <span class="token variable">配置文件中第</span><span class="token number">75</span><span class="token variable">行中</span> <span class="token variable">设置</span> <span class="token variable">mysql数据的连接信息</span>
<span class="token number">2.</span> <span class="token variable">导入pymysql模块</span><span class="token punctuation">,</span> <span class="token variable">设置pymysql</span> <span class="token variable">连接</span> <span class="token variable">mysql</span><span class="token punctuation">.</span>
</code></pre>
    <p>
     <img alt="image-20220307193444021" src="https://i-blog.csdnimg.cn/blog_migrate/8689b17427974013dc12169c7456743d.png"/>
    </p>
    <pre><code class="prism language-python">DATABASES <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment"># 0. 连接mysql数据库</span>
        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.mysql'</span><span class="token punctuation">,</span>
        <span class="token comment"># 1. 连接的数据库中的库</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'ORM'</span><span class="token punctuation">,</span>
        <span class="token comment"># 2. IP</span>
        <span class="token string">'HOST'</span><span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
        <span class="token comment"># 3. 端口</span>
        <span class="token string">'POST'</span><span class="token punctuation">:</span> <span class="token string">'3306'</span><span class="token punctuation">,</span>
        <span class="token comment"># 4. 用户名</span>
        <span class="token string">'USER'</span><span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
        <span class="token comment"># 5. 用户密码</span>
        <span class="token string">'PASSWORD'</span><span class="token punctuation">:</span> <span class="token string">'123'</span><span class="token punctuation">,</span>
        <span class="token comment"># 6. 数据的编码格式</span>
        <span class="token string">'CHARSET'</span><span class="token punctuation">:</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token comment"># app01 应用下的__init__.py</span>
<span class="token keyword">import</span> pymysql
pymysql<span class="token punctuation">.</span>install_as_MySQLdb<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="14_Pycharm_54">
     </a>
     1.4 Pycharm连接数据库
    </h5>
    <p>
     <img alt="image-20220307195142494" src="https://i-blog.csdnimg.cn/blog_migrate/485b6c1d3dcf7e9e1917441d01dba816.png"/>
    </p>
    <pre><code class="prism language-handlebars"><span class="token variable">先测试成功在连接</span><span class="token punctuation">.</span>
</code></pre>
    <p>
     <img alt="image-20220307195331297" src="https://i-blog.csdnimg.cn/blog_migrate/462e8aac43b045d0fa86c58318b4cf23.png"/>
    </p>
    <h5>
     <a id="15__64">
     </a>
     1.5 测试脚本
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">将下面代码复制到app01</span> <span class="token variable">应用下的tests</span><span class="token punctuation">.</span><span class="token variable">py</span> <span class="token variable">文件中</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">"DJANGO_SETTINGS_MODULE"</span><span class="token punctuation">,</span> <span class="token string">"day64.settings"</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 在这个代码会下面就可以测试django里面的单个py文件</span>
    <span class="token comment"># 所有代码必须等待环境准备完毕之后才能书写</span>
    <span class="token keyword">from</span> app01 <span class="token keyword">import</span> models  <span class="token comment"># 这行代码是不允许在配置文件外面</span>
</code></pre>
    <h4>
     <a id="2__87">
     </a>
     2. 单表操作
    </h4>
    <h6>
     <a id="21__89">
     </a>
     2.1 创建表单
    </h6>
    <pre><code class="prism language-handlebars"><span class="token variable">在app01下的model</span><span class="token punctuation">.</span><span class="token variable">py创建User表。</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">models</span><span class="token punctuation">.</span><span class="token variable">DateField</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token variable">日期字段</span> <span class="token variable">年月日</span>
<span class="token variable">register_time</span> <span class="token punctuation">=</span> <span class="token variable">models</span><span class="token punctuation">.</span><span class="token variable">DateTimeField</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token punctuation">#</span> <span class="token variable">日期字段</span> <span class="token variable">年月日</span> <span class="token variable">时分秒</span>

<span class="token variable">时间字段参数</span><span class="token punctuation">:</span>
<span class="token variable">auto_now</span><span class="token punctuation">:</span> <span class="token variable">每次操作数据的时候</span><span class="token punctuation">,</span><span class="token variable">该字段会自动将当前的时间更新</span><span class="token punctuation">,</span><span class="token variable">操作数据的时间</span><span class="token punctuation">.</span>
<span class="token variable">auto_now_add：创建数据的时候会自动将创建的时间记录下来</span><span class="token punctuation">,</span><span class="token variable">不认为修改就不会改变</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token comment"># 0. 用户表</span>
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. id字段 自动增加</span>
    <span class="token comment"># 2. 用户名</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'用户名'</span><span class="token punctuation">)</span>
    <span class="token comment"># 3. 年龄</span>
    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 4. 注册时间 不给register_time字段设置值的时候会自动获取当前时间</span>
    register_time <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>
    <h6>
     <a id="22__116">
     </a>
     2.2 数据库迁移
    </h6>
    <pre><code class="prism language-handlebars"><span class="token variable">在终端输入：</span>

<span class="token variable">python</span> <span class="token variable">manage</span><span class="token punctuation">.</span><span class="token variable">py</span> <span class="token variable">makemigrations</span>
<span class="token variable">python</span> <span class="token variable">manage</span><span class="token punctuation">.</span><span class="token variable">py</span> <span class="token variable">migrate</span>
</code></pre>
    <p>
     <img alt="image-20220307222746258" src="https://i-blog.csdnimg.cn/blog_migrate/90308d6c2d68db06eadc56f04d8146b3.png"/>
    </p>
    <h6>
     <a id="23__127">
     </a>
     2.3 增加数据
    </h6>
    <pre><code class="prism language-handlebars"><span class="token variable">在测试文件tests</span><span class="token punctuation">.</span><span class="token variable">py</span> <span class="token variable">中写</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># 方式1：</span>
    res1 <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'kid'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>

    <span class="token comment"># res1 返回值就是对象本身。</span>
</code></pre>
    <p>
     <img alt="image-20220307223759555" src="https://i-blog.csdnimg.cn/blog_migrate/539db929bb4ddd148718197118037cd0.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 方式2</span>
    <span class="token keyword">import</span> datetime
    ctime <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'qz'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> register_time<span class="token operator">=</span>ctime<span class="token punctuation">)</span>
    user_obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h6>
     <a id="24__150">
     </a>
     2.4 删除数据
    </h6>
    <pre><code class="prism language-handlebars"><span class="token variable">一般使用主键作为查询依据。</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># 方式1 直接按id字段查找</span>
    res2 <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 返回值 res3  是当前影响的行数</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># 方式1 pk 查询</span>
    res3 <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">pk会自动查找当前表的主键字段</span><span class="token punctuation">,</span><span class="token variable">不需要指代当前表的主键字段到底叫什么</span> <span class="token variable">uid</span> <span class="token variable">pid</span> <span class="token variable">sid</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># 方式2</span>
    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    user_obj<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h6>
     <a id="25__177">
     </a>
     2.5 修改值
    </h6>
    <pre><code class="prism language-python">    <span class="token comment"># 方式1</span>
    models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'qaz'</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># 方式2</span>
    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
    user_obj<span class="token punctuation">.</span>update<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'qqq'</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># get取值</span>
    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span>
    user_obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'xxxx'</span>
    user_onj<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">filter</span>    <span class="token variable">取不存在的值为空</span><span class="token punctuation">,</span><span class="token variable">不会报错</span>
<span class="token variable">get</span>       <span class="token variable">取不存在的值会报错</span> <span class="token variable">用户匹配查询不存在。</span>
		 <span class="token variable">app</span><span class="token punctuation">.</span><span class="token variable">models</span><span class="token punctuation">.</span><span class="token variable">DoesNotExist</span><span class="token punctuation">:</span> <span class="token variable">User</span> <span class="token variable">matching</span> <span class="token variable">query</span> <span class="token variable">does</span> <span class="token variable">not</span> <span class="token variable">exist</span><span class="token punctuation">.</span>
</code></pre>
    <h4>
     <a id="3_SQL_204">
     </a>
     3. 展示SQL语句
    </h4>
    <h5>
     <a id="31__206">
     </a>
     3.1 方法查看
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">QuerySet对象内部封装的sql语句。</span>
<span class="token variable">querset对象</span><span class="token punctuation">.</span><span class="token variable">query</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token comment"># 方式1 只有QuerySet对象才能query查看内部sql语句</span>

res1 <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res1<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># &lt;QuerySet [&lt;User: User object&gt;]&gt; &lt;class 'django.db.models.query.QuerySet'&gt;</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>res1<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
<span class="token comment"># SELECT `app01_user`.`id`, `app01_user`.`name`, `app01_user`.`age`, `app01_user`.`register_time` FROM `app01_user`</span>
</code></pre>
    <h5>
     <a id="32__224">
     </a>
     3.2 配置文件
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">将下面代码复制到settings</span><span class="token punctuation">.</span><span class="token variable">py配置文件中。随便找个位置放。</span>
<span class="token variable">所有的ORM语句都能自动触发打印sql语句。</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token comment"># 方式二 </span>
LOGGING <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'version'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">'disable_existing_loggers'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
    <span class="token string">'handlers'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'console'</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">'level'</span><span class="token punctuation">:</span><span class="token string">'DEBUG'</span><span class="token punctuation">,</span>
            <span class="token string">'class'</span><span class="token punctuation">:</span><span class="token string">'logging.StreamHandler'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'loggers'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'django.db.backends'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'handlers'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'console'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'propagate'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
            <span class="token string">'level'</span><span class="token punctuation">:</span><span class="token string">'DEBUG'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="4__objects__252">
     </a>
     4. objects 方法
    </h4>
    <pre><code class="prism language-handlebars"><span class="token number">0.</span> <span class="token variable">objects是Manager类型的对象</span><span class="token punctuation">,</span><span class="token variable">是Model和数据库进行查询的接口</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token number">1.</span> <span class="token variable">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token variable">查询所有数据</span><span class="token punctuation">,</span> <span class="token variable">结果是queryset对象</span><span class="token punctuation">,</span><span class="token variable">列表套套字典</span><span class="token punctuation">.</span>
<span class="token number">2.</span> <span class="token variable">get_queryset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">获取所有queryset对象数据</span><span class="token punctuation">,</span><span class="token variable">结果是queryset对象</span><span class="token punctuation">,</span><span class="token variable">列表套套元组</span><span class="token punctuation">.</span>
<span class="token punctuation">*</span> <span class="token variable">结果一样的</span> 
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token number">3.</span> <span class="token variable">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token variable">过滤条件查询</span><span class="token punctuation">,</span><span class="token variable">结果是queryset对象</span><span class="token punctuation">,</span><span class="token variable">列表套数据对象</span><span class="token punctuation">.</span>
<span class="token number">4.</span> <span class="token variable">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token variable">直接拿数据对象</span><span class="token punctuation">,</span><span class="token variable">但是条件不存在直接报错</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token number">5.</span> <span class="token variable">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token variable">表中第一条数据</span><span class="token punctuation">,</span><span class="token variable">结果是一个queryset对象</span><span class="token punctuation">.</span>
<span class="token number">6.</span> <span class="token variable">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token variable">表中最后一个数据</span><span class="token punctuation">,</span><span class="token variable">结果是一个queryset对象</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token number">7.</span> <span class="token variable">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token variable">指定获取的字段</span><span class="token punctuation">,</span><span class="token variable">返回该字段所有的值</span><span class="token punctuation">,</span><span class="token variable">结果是列表套字典</span><span class="token punctuation">.</span> 
<span class="token number">8.</span> <span class="token variable">valuce_list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token variable">指定获取的字段</span><span class="token punctuation">,</span><span class="token variable">返回该字段所有的值</span><span class="token punctuation">,</span><span class="token variable">是列表套元组</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token number">9.</span> <span class="token variable">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token variable">去重</span>
<span class="token number">10.</span> <span class="token variable">order_by</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token variable">排序</span>
<span class="token number">11.</span> <span class="token variable">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token variable">倒序</span>
<span class="token number">12.</span> <span class="token variable">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token variable">统计</span>
<span class="token number">13.</span> <span class="token variable">exclude</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token variable">排除</span>
<span class="token number">14.</span> <span class="token variable">excsts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token variable">判断值是否存在</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token comment"># 在models.py中User类中添加__str__ 方法</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 打印User实例化对象时展示 name age register_time 的信息</span>
        <span class="token keyword">return</span> <span class="token string">'%s %s %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>age<span class="token punctuation">,</span> self<span class="token punctuation">.</span>register_time<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">为表添加几条数据用于测试</span><span class="token punctuation">.</span>
</code></pre>
    <p>
     <img alt="image-20220307232201511" src="https://i-blog.csdnimg.cn/blog_migrate/f1d2b65393d1445ecc75ad0523e96317.png"/>
    </p>
    <h5>
     <a id="41_objects_301">
     </a>
     4.1 objects对象
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">objects是Manager类型的对象</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># app01.User.objects &lt;class 'django.db.models.manager.Manager'&gt;</span>
    <span class="token comment"># 不查询表不执行SQl语句</span>
</code></pre>
    <h5>
     <a id="42__314">
     </a>
     4.2 获取数据对象
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">get_queryset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token variable">查询所有数据</span><span class="token punctuation">,</span> <span class="token variable">结果是列表套queryset对象</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [&lt;User: kid 18 2022-03-07 23:18:44+00:00&gt;, ...'&gt; &lt;class 'django.db.models.query.QuerySet'&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get_queryset<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [&lt;User: kid 18 2022-03-07 23:18:44+00:00&gt;, ...'&gt; &lt;class 'django.db.models.query.QuerySet'&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="43__341">
     </a>
     4.3 过滤条件
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token variable">过滤条件查询</span><span class="token punctuation">,</span><span class="token variable">结果是queryset</span><span class="token punctuation">.</span>
<span class="token variable">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token variable">直接拿数据对象</span><span class="token punctuation">,</span><span class="token variable">但是条件不存在直接报错</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [&lt;User: kid 18 2022-03-07 23:18:44+00:00&gt;, ...'&gt; &lt;class 'django.db.models.query.QuerySet'&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [&lt;User: ww 20 2022-03-27 23:21:04+00:00&gt;]&gt; &lt;class 'django.db.models.query.QuerySet'&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token number">5</span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment"># ww 20 2022-03-27 23:21:04+00:00 &lt;class 'app01.models.User'&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="44__378">
     </a>
     4.4 头尾的值
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token variable">表单中第一条数据</span><span class="token punctuation">,</span><span class="token variable">元素queryset对象的值</span><span class="token punctuation">,</span> <span class="token variable">结果是表的数据对象</span><span class="token punctuation">.</span>
<span class="token variable">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token variable">表单中最后一个元素</span><span class="token punctuation">,</span> <span class="token variable">结果是表的数据对象</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># kid 18 2022-03-07 23:18:44+00:00 &lt;class 'app01.models.User'&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">ASC</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>last<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># qq 22 2022-03-07 23:21:29+00:00 &lt;class 'app01.models.User'&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="45__405">
     </a>
     4.5 获取值
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token variable">指定获取的字段</span><span class="token punctuation">,</span><span class="token variable">返回该字段所有的值</span><span class="token punctuation">,</span><span class="token variable">结果是列表套字典</span><span class="token punctuation">.</span> 
<span class="token variable">values_list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token variable">指定获取的字段</span><span class="token punctuation">,</span><span class="token variable">返回该字段所有的值</span><span class="token punctuation">,</span><span class="token variable">是列表套元组</span><span class="token punctuation">.</span>
<span class="token punctuation">*</span> <span class="token variable">不指定字段获取所有字段的数据</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [{'name': 'kid'}, {'name': 'qq'}, {'name': 'ww'}, {'name': 'qq'}]&gt; &lt;class 'django.db.models.query.QuerySet'&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [('kid', 18), ('qq', 19), ('ww', 20), ('qq', 22)]&gt; &lt;class 'django.db.models.query.QuerySet'&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token punctuation">*</span> <span class="token variable">不指定字段获取所有字段的数据</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [{'id': 3, 'name': 'kid', 'age': 18, 'register_time': datetime.datetime(2022, 3, 7, 23, 18, 44, tzinfo=&lt;UTC&gt;)}, ...]&gt;</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [(3, 'kid', 18, datetime.datetime(2022, 3, 7, 23, 18, 44, tzinfo=&lt;UTC&gt;)), (4, 'qq', 19, datetime.datetime(2022, 3, 7, 23, 19, 44, tzinfo=&lt;UTC&gt;)), ...]&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token comment"># 上面两个的代码的SQL语句一样的.</span>
<span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="46__454">
     </a>
     4.6 去重
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">先准备下相同的数据</span><span class="token punctuation">,</span><span class="token variable">id不要设置成一样的</span><span class="token punctuation">,</span><span class="token variable">这张表的id是唯一的</span><span class="token punctuation">.</span>
<span class="token variable">id</span> <span class="token variable">name</span>  <span class="token variable">age</span> <span class="token variable">register_time</span>
<span class="token number">7</span>   <span class="token variable">kid</span>   <span class="token number">18</span>  <span class="token number">2021</span><span class="token variable">-</span><span class="token number">08</span><span class="token variable">-</span><span class="token number">16</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00.000000</span>
<span class="token number">8</span>   <span class="token variable">kid</span>   <span class="token number">18</span>  <span class="token number">2021</span><span class="token variable">-</span><span class="token number">08</span><span class="token variable">-</span><span class="token number">16</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00.000000</span>
</code></pre>
    <p>
     <img alt="image-20220308005524469" src="https://i-blog.csdnimg.cn/blog_migrate/586c97ea9bf9d47e0b1e24a04ccef2e9.png"/>
    </p>
    <pre><code class="prism language-handlebars"><span class="token variable">去重一定要是一模一样的数据</span><span class="token punctuation">,</span>
<span class="token variable">如果带有主键那么肯定是不一样的</span><span class="token punctuation">,</span><span class="token variable">在查询中注意主键。</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># values不添加添加默认获取所有值</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [{'id': 3, 'name': 'kid', 'age': 18, 'register_time': datetime.datetime(2022, 3, 7, 23, 18, 44, tzinfo=&lt;UTC&gt;)}, ...}]&gt; &lt;class 'django.db.models.query.QuerySe</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [{'name': 'kid'}, {'name': 'qq'}, {'name': 'ww'}, {'name': 'zz'}]&gt; &lt;class 'django.db.models.query.QuerySet'&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [{'name': 'kid', 'age': 18}, {'name': 'qq', 'age': 19}, {'name': 'ww', 'age': 20}, {'name': 'qq', 'age': 22}, {'name': 'zz', 'age': 18}]&gt; &lt;class 'django.db.models.query.QuerySet'&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">如果id不是唯一的可以这样测试下</span><span class="token punctuation">.</span>
<span class="token variable">models</span><span class="token punctuation">.</span><span class="token variable">User</span><span class="token punctuation">.</span><span class="token variable">objects</span><span class="token punctuation">.</span><span class="token variable">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="47__505">
     </a>
     4.7 排序
    </h5>
    <pre><code class="prism language-handlebars"><span class="token punctuation">.</span><span class="token variable">order_by</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">指定排序的字典</span> <span class="token variable">不指定就以主键</span>
<span class="token variable">默认为升序</span>
<span class="token variable">降序</span> <span class="token variable">在字段前面加上-负号</span>

<span class="token variable">数字按从小到大排序</span>
<span class="token variable">字符按子母表排序</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># 升序</span>
    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token punctuation">&lt;</span><span class="token variable">QuerySet</span> <span class="token punctuation">[</span><span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">kid</span> <span class="token number">18</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
            <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">zz</span> <span class="token number">18</span> <span class="token number">2021</span><span class="token variable">-</span><span class="token number">08</span><span class="token variable">-</span><span class="token number">16</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
            <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">zz</span> <span class="token number">18</span> <span class="token number">2021</span><span class="token variable">-</span><span class="token number">08</span><span class="token variable">-</span><span class="token number">16</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
            <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">qq</span> <span class="token number">19</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">ww</span> <span class="token number">20</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">27</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
            <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">qq</span> <span class="token number">22</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span>
<span class="token punctuation">&lt;</span><span class="token variable">class</span> <span class="token string">'django.db.models.query.QuerySet'</span><span class="token punctuation">&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token keyword">ASC</span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># 降序 在字段前面加上-负号</span>
    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'-age'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token punctuation">&lt;</span><span class="token variable">QuerySet</span> <span class="token punctuation">[</span><span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">qq</span> <span class="token number">22</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">ww</span> <span class="token number">20</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">27</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">qq</span> <span class="token number">19</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">kid</span> <span class="token number">18</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">zz</span> <span class="token number">18</span> <span class="token number">2021</span><span class="token variable">-</span><span class="token number">08</span><span class="token variable">-</span><span class="token number">16</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">zz</span> <span class="token number">18</span> <span class="token number">2021</span><span class="token variable">-</span><span class="token number">08</span><span class="token variable">-</span><span class="token number">16</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span> 
<span class="token punctuation">&lt;</span><span class="token variable">class</span> <span class="token string">'django.db.models.query.QuerySet'</span><span class="token punctuation">&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="47__556">
     </a>
     4.7 倒序
    </h5>
    <pre><code class="prism language-handlebars"><span class="token punctuation">.</span><span class="token variable">order_by</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token variable">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token variable">数据必须是排过序的。</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># 先排序在倒序</span>
    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token punctuation">&lt;</span><span class="token variable">QuerySet</span> <span class="token punctuation">[</span><span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">qq</span> <span class="token number">22</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">ww</span> <span class="token number">20</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">27</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">qq</span> <span class="token number">19</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">kid</span> <span class="token number">18</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">zz</span> <span class="token number">18</span> <span class="token number">2021</span><span class="token variable">-</span><span class="token number">08</span><span class="token variable">-</span><span class="token number">16</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">zz</span> <span class="token number">18</span> <span class="token number">2021</span><span class="token variable">-</span><span class="token number">08</span><span class="token variable">-</span><span class="token number">16</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span> 
<span class="token punctuation">&lt;</span><span class="token variable">class</span> <span class="token string">'django.db.models.query.QuerySet'</span><span class="token punctuation">&gt;</span>
</code></pre>
    <h5>
     <a id="48__578">
     </a>
     4.8 统计
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token variable">统计当前数据的个数。</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span>
    <span class="token comment"># 6 </span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>__count<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="49__594">
     </a>
     4.9 排除
    </h5>
    <pre><code class="prism language-handlebars"><span class="token punctuation">.</span><span class="token variable">exclude</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token variable">排除指定的条件</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>exclude<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'kid'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars">    <span class="token punctuation">#</span> <span class="token punctuation">&lt;</span><span class="token variable">QuerySet</span> <span class="token punctuation">[</span><span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">qq</span> <span class="token number">19</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">ww</span> <span class="token number">20</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">27</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">qq</span> <span class="token number">22</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">zz</span> <span class="token number">18</span> <span class="token number">2021</span><span class="token variable">-</span><span class="token number">08</span><span class="token variable">-</span><span class="token number">16</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">zz</span> <span class="token number">18</span> <span class="token number">2021</span><span class="token variable">-</span><span class="token number">08</span><span class="token variable">-</span><span class="token number">16</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> <span class="token operator">NOT</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token string">'kid'</span><span class="token punctuation">)</span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'kid'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="410__617">
     </a>
     4.10 判断值是否存在
    </h5>
    <pre><code class="prism language-handlebars"><span class="token punctuation">.</span><span class="token variable">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token variable">返回值为布尔值。</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'kid'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span>
    <span class="token comment"># True</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token string">'kid'</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'kid'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="5___633">
     </a>
     5. 字段方法
    </h4>
    <h5>
     <a id="51__635">
     </a>
     5.1 双向方法
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">搭配字段使用</span> <span class="token variable">字段__xx</span>
<span class="token number">1.</span> <span class="token variable">__gt</span>             <span class="token variable">大于</span>
<span class="token number">2.</span> <span class="token variable">——lt</span>             <span class="token variable">小于</span>
<span class="token number">3.</span> <span class="token variable">__gte</span>            <span class="token variable">大于等于</span>
<span class="token number">4.</span> <span class="token variable">__lte</span>            <span class="token variable">小于等于</span>
<span class="token number">5.</span> <span class="token variable">__in</span><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">x1, x2</span><span class="token punctuation">]</span></span>     <span class="token variable">查询多个值x1</span> <span class="token variable">和x2</span>
<span class="token number">6.</span> <span class="token variable">——range</span><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">x1, x9</span><span class="token punctuation">]</span></span>  <span class="token variable">查询x1</span> <span class="token variable">-</span> <span class="token variable">x9</span> <span class="token variable">之间所有值</span>
<span class="token number">7.</span> <span class="token variable">__contains</span><span class="token punctuation">=</span><span class="token string">' '</span>   <span class="token variable">模糊查询</span><span class="token punctuation">,</span><span class="token variable">区分大小写</span>
<span class="token number">8.</span> <span class="token variable">__icontains</span><span class="token punctuation">=</span><span class="token string">' '</span>  <span class="token variable">模糊查询</span><span class="token punctuation">,</span><span class="token variable">不区分大小写</span>
<span class="token number">9.</span> <span class="token variable">__starswith</span><span class="token punctuation">=</span><span class="token string">' '</span>  <span class="token variable">以什么开头</span>
<span class="token number">10.</span> <span class="token variable">__endwith</span><span class="token punctuation">=</span><span class="token string">' '</span>   <span class="token variable">以什么结尾</span>
<span class="token number">11.</span> <span class="token variable">__day</span><span class="token punctuation">=</span>          <span class="token variable">天</span>
<span class="token number">12.</span> <span class="token variable">__month</span><span class="token punctuation">=</span>        <span class="token variable">月</span>
<span class="token number">13.</span> <span class="token variable">__year</span><span class="token punctuation">=</span>         <span class="token variable">年</span>
<span class="token number">14.</span> <span class="token variable">__week_day</span><span class="token punctuation">=</span>     <span class="token variable">星期几</span>
</code></pre>
    <h5>
     <a id="52__655">
     </a>
     5.2 练习
    </h5>
    <p>
     <img alt="image-20220310130013938" src="https://i-blog.csdnimg.cn/blog_migrate/80c0b65aa649de107c91164e8e461e36.png"/>
    </p>
    <pre><code class="prism language-handlebars"> <span class="token number">1.</span> <span class="token variable">查询年龄大于</span><span class="token number">20</span><span class="token variable">岁的数据</span>
</code></pre>
    <pre><code class="prism language-python"> 	user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>age__gt<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [&lt;User: qq 22 2022-03-07 23:21:29+00:00&gt;]&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token operator">&gt;</span> <span class="token number">20</span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">2.</span> <span class="token variable">查询年龄小于</span><span class="token number">20</span><span class="token variable">岁的数据</span>
</code></pre>
    <pre><code class="prism language-python">	user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>age__lt<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars">    <span class="token punctuation">&lt;</span><span class="token variable">QuerySet</span> <span class="token punctuation">[</span><span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">kid</span> <span class="token number">18</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">qq</span> <span class="token number">19</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">zz</span> <span class="token number">18</span> <span class="token number">2021</span><span class="token variable">-</span><span class="token number">08</span><span class="token variable">-</span><span class="token number">16</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">zz</span> <span class="token number">18</span> <span class="token number">2021</span><span class="token variable">-</span><span class="token number">08</span><span class="token variable">-</span><span class="token number">16</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">3.</span> <span class="token variable">查询年龄在</span><span class="token number">18</span><span class="token variable">、</span><span class="token number">20</span><span class="token variable">岁的数据</span>
</code></pre>
    <pre><code class="prism language-python">	user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>age__in<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars">    <span class="token punctuation">&lt;</span><span class="token variable">QuerySet</span> <span class="token punctuation">[</span><span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">kid</span> <span class="token number">18</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">ww</span> <span class="token number">20</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">27</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">zz</span> <span class="token number">18</span> <span class="token number">2021</span><span class="token variable">-</span><span class="token number">08</span><span class="token variable">-</span><span class="token number">16</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">zz</span> <span class="token number">18</span> <span class="token number">2021</span><span class="token variable">-</span><span class="token number">08</span><span class="token variable">-</span><span class="token number">16</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">4.</span> <span class="token variable">查询</span><span class="token number">18</span><span class="token variable">岁到</span><span class="token number">22</span><span class="token variable">岁的数据</span>
</code></pre>
    <pre><code class="prism language-python">	user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>age__range<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars">    <span class="token punctuation">&lt;</span><span class="token variable">QuerySet</span> <span class="token punctuation">[</span><span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">kid</span> <span class="token number">18</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">qq</span> <span class="token number">19</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">ww</span> <span class="token number">20</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">27</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">qq</span> <span class="token number">22</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">zz</span> <span class="token number">18</span> <span class="token number">2021</span><span class="token variable">-</span><span class="token number">08</span><span class="token variable">-</span><span class="token number">16</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">zz</span> <span class="token number">18</span> <span class="token number">2021</span><span class="token variable">-</span><span class="token number">08</span><span class="token variable">-</span><span class="token number">16</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token operator">BETWEEN</span> <span class="token number">18</span> <span class="token operator">AND</span> <span class="token number">22</span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span> 
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">5.</span> <span class="token variable">查询名字中有k的数据</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name__contains<span class="token operator">=</span><span class="token string">'k'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [&lt;User: kid 18 2022-03-07 23:18:44+00:00&gt;]&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.008</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token operator">LIKE</span> <span class="token keyword">BINARY</span> <span class="token string">'%k%'</span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'%k%'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">6.</span> <span class="token variable">查询名字中有k的数据</span><span class="token punctuation">(</span><span class="token variable">忽略大小写</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name__icontains<span class="token operator">=</span><span class="token string">'K'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span>
	<span class="token comment"># &lt;QuerySet [&lt;User: kid 18 2022-03-07 23:18:44+00:00&gt;]&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token operator">LIKE</span> <span class="token string">'%K%'</span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'%K%'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">7.</span> <span class="token variable">查询注册时间是</span><span class="token number">2022</span><span class="token variable">年的数据</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>register_time__year<span class="token operator">=</span><span class="token number">2022</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span>
    <span class="token comment"># 数据是字符串类型</span>
    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>register_time__year<span class="token operator">=</span><span class="token string">'2022'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars">    <span class="token punctuation">&lt;</span><span class="token variable">QuerySet</span> <span class="token punctuation">[</span><span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">kid</span> <span class="token number">18</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">qq</span> <span class="token number">19</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">ww</span> <span class="token number">20</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">27</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">qq</span> <span class="token number">22</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">+</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> SELECT `app01_user`<span class="token punctuation">.</span>`<span class="token builtin">id</span>`<span class="token punctuation">,</span> `app01_user`<span class="token punctuation">.</span>`name`<span class="token punctuation">,</span> `app01_user`<span class="token punctuation">.</span>`age`<span class="token punctuation">,</span> `app01_user`<span class="token punctuation">.</span>`register_time` FROM `app01_user` WHERE `app01_user`<span class="token punctuation">.</span>`register_time` BETWEEN <span class="token string">'2022-01-01 00:00:00'</span> AND <span class="token string">'2022-12-31 23:59:59.999999'</span> LIMIT <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'2022-01-01 00:00:00'</span><span class="token punctuation">,</span> <span class="token string">'2022-12-31 23:59:59.999999'</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">8.</span> <span class="token variable">查询注册时间是</span><span class="token number">3</span><span class="token variable">月的数据</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>register_time__month<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars">    <span class="token punctuation">&lt;</span><span class="token variable">QuerySet</span> <span class="token punctuation">[</span><span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">kid</span> <span class="token number">18</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">qq</span> <span class="token number">19</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">ww</span> <span class="token number">20</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">27</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
    <span class="token punctuation">&lt;</span><span class="token variable">User</span><span class="token punctuation">:</span> <span class="token variable">qq</span> <span class="token number">22</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">07</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> EXTRACT<span class="token punctuation">(</span><span class="token keyword">MONTH</span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">如果查不出来直接在setting</span><span class="token punctuation">.</span><span class="token variable">py文件中设置：USE_TZ</span> <span class="token punctuation">=</span> <span class="token variable">False</span>
</code></pre>
    <p>
     <img alt="image-20220308201015413" src="https://i-blog.csdnimg.cn/blog_migrate/ae41aaac513718d1f489e499414a5358.png"/>
    </p>
    <pre><code class="prism language-handlebars"> <span class="token number">9.</span> <span class="token variable">查询注册时间是</span><span class="token number">27</span><span class="token variable">号的数据</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>register_time__day<span class="token operator">=</span><span class="token number">27</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span>
	<span class="token comment"># &lt;QuerySet [&lt;User: ww 20 2022-03-27 00:00:00&gt;]&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> EXTRACT<span class="token punctuation">(</span><span class="token keyword">DAY</span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">27</span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">27</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">10.</span><span class="token variable">查询注册时间是星期天的数据</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">星期天是</span><span class="token number">1</span>  <span class="token variable">星期一是</span><span class="token number">2</span>
</code></pre>
    <pre><code class="prism language-python">    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>register_time__week_day<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user_obj<span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [&lt;User: ww 20 2022-03-27 00:00:00&gt;]&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> DAYOFWEEK<span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>app01_user<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>register_time<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="6__844">
     </a>
     6. 多表操作之增删改
    </h4>
    <pre><code class="prism language-handlebars"><span class="token punctuation">*</span> <span class="token variable">一对多</span><span class="token punctuation">,</span><span class="token variable">一对一</span> <span class="token variable">和普通一张表的增删改是一样的</span>
<span class="token punctuation">*</span> <span class="token variable">多对多</span><span class="token punctuation">,</span><span class="token variable">通过虚拟字段使用</span> <span class="token punctuation">.</span><span class="token variable">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token variable">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token variable">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token variable">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">这几个方法</span>
</code></pre>
    <h5>
     <a id="61__851">
     </a>
     6.1 表数据
    </h5>
    <pre><code class="prism language-handlebars"><span class="token number">1.</span><span class="token variable">书籍表</span><span class="token punctuation">:</span>
<span class="token variable">id</span>  <span class="token variable">title</span>      <span class="token variable">price</span>   <span class="token variable">publish_date</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token number">2.</span><span class="token variable">出版社表：</span>
<span class="token variable">id</span>     <span class="token variable">name</span>        <span class="token variable">addr</span>  <span class="token variable">email</span>
<span class="token number">1</span>    <span class="token variable">上海出版社</span>    <span class="token variable">上海</span>  <span class="token number">123</span><span class="token punctuation">@</span><span class="token variable">qq</span><span class="token punctuation">.</span><span class="token variable">com</span>
<span class="token number">2</span>    <span class="token variable">北京出版社</span>    <span class="token variable">北京</span>  <span class="token number">456</span><span class="token punctuation">@</span><span class="token variable">qq</span><span class="token punctuation">.</span><span class="token variable">com</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>


<span class="token number">3.</span><span class="token variable">作者表</span>
<span class="token variable">id</span>  <span class="token variable">name</span>  <span class="token variable">age</span>   <span class="token variable">author_datail_id</span>
<span class="token number">1</span>   <span class="token variable">kid</span>   <span class="token number">18</span>      <span class="token number">1</span>
<span class="token number">2</span>   <span class="token variable">qq</span>	  <span class="token number">19</span>      <span class="token number">2</span>
<span class="token number">3</span>   <span class="token variable">qaq</span>	  <span class="token number">20</span>      <span class="token number">3</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token number">4.</span><span class="token variable">作者详情表：</span>
<span class="token variable">id</span> <span class="token variable">phone</span> <span class="token variable">a</span>  <span class="token variable">ddr</span>
<span class="token number">1</span>   <span class="token number">110</span>	    <span class="token variable">北京</span>
<span class="token number">2</span>   <span class="token number">112</span>     <span class="token variable">上海</span>		
<span class="token number">3</span>   <span class="token number">119</span>     <span class="token variable">深圳</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre>
    <h5>
     <a id="62__880">
     </a>
     6.2 建立基础表
    </h5>
    <pre><code class="prism language-python"><span class="token comment"># 1. 书籍表</span>
<span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. id 字段 自动添加</span>
    <span class="token comment"># 2. 书名字段</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'书名'</span><span class="token punctuation">)</span>
    <span class="token comment"># 3. 价格 共八位 小数占两位</span>
    price <span class="token operator">=</span> models<span class="token punctuation">.</span>DecimalField<span class="token punctuation">(</span>max_digits<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> decimal_places<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'价格'</span><span class="token punctuation">)</span>
    <span class="token comment"># 4. 出版时间</span>
    publish_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'出版时间'</span><span class="token punctuation">)</span>
    

<span class="token comment"># 2. 出版社表</span>
<span class="token keyword">class</span> <span class="token class-name">Publish</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. id 字段 自动添加</span>
    <span class="token comment"># 2. 出版社名字</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'出版社名字'</span><span class="token punctuation">)</span>
    <span class="token comment"># 3. 地址</span>
    addr <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'出版社地址'</span><span class="token punctuation">)</span>
    <span class="token comment"># 4. 邮箱</span>
    email <span class="token operator">=</span> models<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">'邮箱'</span><span class="token punctuation">)</span>


<span class="token comment"># 3. 作者表</span>
<span class="token keyword">class</span> <span class="token class-name">Author</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. id 字段 自动添加</span>
    <span class="token comment"># 2. 作者名字</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'作者名字'</span><span class="token punctuation">)</span>
    <span class="token comment"># 3. 作者姓名</span>
    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">'作者年龄'</span><span class="token punctuation">)</span>


<span class="token comment"># 4. 作者详情表</span>
<span class="token keyword">class</span> <span class="token class-name">AuthorDetail</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. id 字段 自动添加</span>
    <span class="token comment"># 2. 手机</span>
    phone <span class="token operator">=</span> models<span class="token punctuation">.</span>BigIntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 地址</span>
    addr <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'作者地址'</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="63__923">
     </a>
     6.3 外键字段
    </h5>
    <pre><code class="prism language-handlebars"><span class="token punctuation">*</span> <span class="token variable">创建的字段会自动加_id</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token comment"># 1. 书籍表</span>
<span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. id 字段 自动添加</span>
    <span class="token comment"># 2. 书名字段</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'书名'</span><span class="token punctuation">)</span>
    <span class="token comment"># 3. 价格 共八位 小数占两位</span>
    price <span class="token operator">=</span> models<span class="token punctuation">.</span>DecimalField<span class="token punctuation">(</span>max_digits<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> decimal_places<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'价格'</span><span class="token punctuation">)</span>
    <span class="token comment"># 4. 出版时间</span>
    publish_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'出版时间'</span><span class="token punctuation">)</span>
    <span class="token comment"># 5. 外键字段</span>
    <span class="token comment"># 5.1 出版社一对多书籍表, 外键建立在多的一方 </span>
    publish <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Publish'</span><span class="token punctuation">)</span>
    <span class="token comment"># 5.2 作者表多对多书籍表, 虚拟字典在查询频率高的一方</span>
    author <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Author'</span><span class="token punctuation">)</span>


<span class="token comment"># 2. 出版社表</span>
<span class="token keyword">class</span> <span class="token class-name">Publish</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. id 字段 自动添加</span>
    <span class="token comment"># 2. 出版社名字</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'出版社名字'</span><span class="token punctuation">)</span>
    <span class="token comment"># 3. 地址</span>
    addr <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'出版社地址'</span><span class="token punctuation">)</span>
    <span class="token comment"># 4. 邮箱</span>
    email <span class="token operator">=</span> models<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">'邮箱'</span><span class="token punctuation">)</span>


<span class="token comment"># 3. 作者表</span>
<span class="token keyword">class</span> <span class="token class-name">Author</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. id 字段 自动添加</span>
    <span class="token comment"># 2. 作者名字</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'作者名字'</span><span class="token punctuation">)</span>
    <span class="token comment"># 3. 作者姓名</span>
    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">'作者年龄'</span><span class="token punctuation">)</span>
    <span class="token comment"># 4. 外键 作者表一对一作者详情表</span>
    author_detail_id <span class="token operator">=</span> models<span class="token punctuation">.</span>OneToOneField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'AuthorDetail'</span><span class="token punctuation">)</span>


<span class="token comment"># 4. 作者详情表</span>
<span class="token keyword">class</span> <span class="token class-name">AuthorDetail</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. id 字段 自动添加</span>
    <span class="token comment"># 2. 手机</span>
    phone <span class="token operator">=</span> models<span class="token punctuation">.</span>BigIntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 3. 地址</span>
    addr <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'作者地址'</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220308222756031" src="https://i-blog.csdnimg.cn/blog_migrate/3c73f21d9ecb265df819008d01b21ba9.png"/>
    </p>
    <pre><code class="prism language-handlebars"><span class="token variable">为每个表设置__str__</span> <span class="token variable">方法</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token comment"># 1. 书籍表</span>
<span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. id 字段 自动添加</span>
    <span class="token comment"># 2. 书名字段</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'书名'</span><span class="token punctuation">)</span>
    <span class="token comment"># 3. 价格 共八位 小数占两位</span>
    price <span class="token operator">=</span> models<span class="token punctuation">.</span>DecimalField<span class="token punctuation">(</span>max_digits<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> decimal_places<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'价格'</span><span class="token punctuation">)</span>
    <span class="token comment"># 4. 出版时间</span>
    publish_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'出版时间'</span><span class="token punctuation">)</span>
    <span class="token comment"># 5. 外键字段</span>
    <span class="token comment"># 5.1 出版社一对多书籍表, 外键建立在多的一方</span>
    publish <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Publish'</span><span class="token punctuation">)</span>
    <span class="token comment"># 5.2 作者表多对多书籍表, 虚拟字典在查询频率高的一方</span>
    author <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Author'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 打印Book实例化对象时展示所有字段的信息</span>
        <span class="token keyword">return</span> <span class="token string">'%s %s %s %s %s %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>title<span class="token punctuation">,</span> self<span class="token punctuation">.</span>price<span class="token punctuation">,</span> self<span class="token punctuation">.</span>publish_date<span class="token punctuation">,</span> self<span class="token punctuation">.</span>publish<span class="token punctuation">,</span> self<span class="token punctuation">.</span>author<span class="token punctuation">)</span>


<span class="token comment"># 2. 出版社表</span>
<span class="token keyword">class</span> <span class="token class-name">Publish</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. id 字段 自动添加</span>
    <span class="token comment"># 2. 出版社名字</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'出版社名字'</span><span class="token punctuation">)</span>
    <span class="token comment"># 3. 地址</span>
    addr <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'出版社地址'</span><span class="token punctuation">)</span>
    <span class="token comment"># 4. 邮箱</span>
    email <span class="token operator">=</span> models<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">'邮箱'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 打印Publish表实例化对象时展示所有字段的信息</span>
        <span class="token keyword">return</span> <span class="token string">'%s %s %s %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>addr<span class="token punctuation">,</span> self<span class="token punctuation">.</span>email<span class="token punctuation">)</span>


<span class="token comment"># 3. 作者表</span>
<span class="token keyword">class</span> <span class="token class-name">Author</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. id 字段 自动添加</span>
    <span class="token comment"># 2. 作者名字</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'作者名字'</span><span class="token punctuation">)</span>
    <span class="token comment"># 3. 作者姓名</span>
    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">'作者年龄'</span><span class="token punctuation">)</span>
    <span class="token comment"># 4. 外键 作者表一对一作者详情表</span>
    author_detail <span class="token operator">=</span> models<span class="token punctuation">.</span>OneToOneField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'AuthorDetail'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 打印Author表实例化对象时展示所有字段的信息</span>
        <span class="token keyword">return</span> <span class="token string">'%s %s %s %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>age<span class="token punctuation">,</span> self<span class="token punctuation">.</span>author_detail<span class="token punctuation">)</span>


<span class="token comment"># 4. 作者详情表</span>
<span class="token keyword">class</span> <span class="token class-name">AuthorDetail</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. id 字段 自动添加</span>
    <span class="token comment"># 2. 手机</span>
    phone <span class="token operator">=</span> models<span class="token punctuation">.</span>BigIntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 3. 地址</span>
    addr <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'作者地址'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 打印AuthorDetail表实例化对象时展示所有字段的信息</span>
        <span class="token keyword">return</span> <span class="token string">'%s %s %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>phone<span class="token punctuation">,</span> self<span class="token punctuation">.</span>addr<span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="64__1047">
     </a>
     6.4 数据库迁移
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">python</span> <span class="token variable">manage</span><span class="token punctuation">.</span><span class="token variable">py</span> <span class="token variable">makemigrations</span>
<span class="token variable">python</span> <span class="token variable">manage</span><span class="token punctuation">.</span><span class="token variable">py</span> <span class="token variable">migrate</span>
</code></pre>
    <p>
     <img alt="image-20220308220027992" src="https://i-blog.csdnimg.cn/blog_migrate/387102f365504966b1bf2fa965497476.png"/>
    </p>
    <h5>
     <a id="65__1056">
     </a>
     6.5 录数据
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">在tests</span><span class="token punctuation">.</span><span class="token variable">py</span>  <span class="token variable">中录数据</span>
</code></pre>
    <h6>
     <a id="1__1062">
     </a>
     1. 作者详情表
    </h6>
    <pre><code class="prism language-handlebars"><span class="token number">4.</span><span class="token variable">作者详情表：</span>
<span class="token variable">id</span> <span class="token variable">phone</span>    <span class="token variable">addr</span>
<span class="token number">1</span>   <span class="token number">110</span>	    <span class="token variable">北京</span>
<span class="token number">2</span>   <span class="token number">112</span>     <span class="token variable">上海</span>		
<span class="token number">3</span>   <span class="token number">119</span>     <span class="token variable">深圳</span>
</code></pre>
    <pre><code class="prism language-handlebars">	<span class="token variable">models</span><span class="token punctuation">.</span><span class="token variable">AuthorDetail</span><span class="token punctuation">.</span><span class="token variable">objects</span><span class="token punctuation">.</span><span class="token variable">create</span><span class="token punctuation">(</span><span class="token variable">phone</span><span class="token punctuation">=</span><span class="token number">110</span><span class="token punctuation">,</span> <span class="token variable">addr</span><span class="token punctuation">=</span><span class="token string">'北京'</span><span class="token punctuation">)</span>
	<span class="token variable">models</span><span class="token punctuation">.</span><span class="token variable">AuthorDetail</span><span class="token punctuation">.</span><span class="token variable">objects</span><span class="token punctuation">.</span><span class="token variable">create</span><span class="token punctuation">(</span><span class="token variable">phone</span><span class="token punctuation">=</span><span class="token number">112</span><span class="token punctuation">,</span> <span class="token variable">addr</span><span class="token punctuation">=</span><span class="token string">'上海'</span><span class="token punctuation">)</span>
	<span class="token variable">models</span><span class="token punctuation">.</span><span class="token variable">AuthorDetail</span><span class="token punctuation">.</span><span class="token variable">objects</span><span class="token punctuation">.</span><span class="token variable">create</span><span class="token punctuation">(</span><span class="token variable">phone</span><span class="token punctuation">=</span><span class="token number">119</span><span class="token punctuation">,</span> <span class="token variable">addr</span><span class="token punctuation">=</span><span class="token string">'深圳'</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220308221852159" src="https://i-blog.csdnimg.cn/blog_migrate/b51c9b9504aa866e674a1aac5346e827.png"/>
    </p>
    <h6>
     <a id="2_1080">
     </a>
     2.作者表
    </h6>
    <pre><code class="prism language-handlebars"><span class="token number">3.</span><span class="token variable">作者表</span>
<span class="token variable">id</span>  <span class="token variable">name</span>  <span class="token variable">age</span>   <span class="token variable">author_detail_id</span>
<span class="token number">1</span>   <span class="token variable">kid</span>   <span class="token number">18</span>      <span class="token number">1</span>
<span class="token number">2</span>   <span class="token variable">qq</span>	  <span class="token number">19</span>      <span class="token number">2</span>
<span class="token number">3</span>   <span class="token variable">qaq</span>	  <span class="token number">20</span>      <span class="token number">3</span>
</code></pre>
    <pre><code class="prism language-python">    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'kid'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> author_detail_id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'qq'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">19</span><span class="token punctuation">,</span> author_detail_id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'qaq'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> author_detail_id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220308222936430" src="https://i-blog.csdnimg.cn/blog_migrate/6e25fdf6a7f87865dadc1aa092a10de5.png"/>
    </p>
    <h6>
     <a id="3__1098">
     </a>
     3. 出版社表
    </h6>
    <pre><code class="prism language-handlebars"><span class="token number">2.</span><span class="token variable">出版社表：</span>
<span class="token variable">id</span>     <span class="token variable">name</span>        <span class="token variable">addr</span>  <span class="token variable">email</span>
<span class="token number">1</span>    <span class="token variable">上海出版社</span>    <span class="token variable">上海</span>  <span class="token number">123</span><span class="token punctuation">@</span><span class="token variable">qq</span><span class="token punctuation">.</span><span class="token variable">com</span>
<span class="token number">2</span>    <span class="token variable">北京出版社</span>    <span class="token variable">北京</span>  <span class="token number">456</span><span class="token punctuation">@</span><span class="token variable">qq</span><span class="token punctuation">.</span><span class="token variable">com</span>
</code></pre>
    <pre><code class="prism language-python">    models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'上海出版社'</span><span class="token punctuation">,</span> addr<span class="token operator">=</span><span class="token string">'上海'</span><span class="token punctuation">,</span> email<span class="token operator">=</span><span class="token string">'123@qq.com'</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'北京出版社'</span><span class="token punctuation">,</span> addr<span class="token operator">=</span><span class="token string">'北京'</span><span class="token punctuation">,</span> email<span class="token operator">=</span><span class="token string">'456@qq.com'</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220308223414790" src="https://i-blog.csdnimg.cn/blog_migrate/3b53a22676dd1d4ba15dc2c3f6a37ebb.png"/>
    </p>
    <h6>
     <a id="4_1114">
     </a>
     4.数据表
    </h6>
    <pre><code class="prism language-handlebars"><span class="token number">1.</span><span class="token variable">书籍表</span><span class="token punctuation">:</span>
<span class="token variable">id</span>  <span class="token variable">title</span>             <span class="token variable">price</span>   <span class="token variable">publish_deta</span>        <span class="token variable">publish_id</span>
<span class="token number">1</span>   <span class="token variable">开局签到荒古圣体</span>   <span class="token number">123.33</span>  <span class="token variable">创建表的时候自动添加</span>    <span class="token number">1</span>
<span class="token number">2</span>   <span class="token variable">洪荒之至尊通天</span>     <span class="token number">123.33</span>                        <span class="token number">1</span>
<span class="token number">3</span>   <span class="token variable">重生之都市仙尊</span>     <span class="token number">123.33</span>                        <span class="token number">2</span>
<span class="token number">4</span>   <span class="token variable">穿越诸天万界</span>       <span class="token number">123.33</span>                        <span class="token number">2</span>
</code></pre>
    <pre><code class="prism language-python">    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'开局签到荒古圣体'</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token number">123.33</span><span class="token punctuation">,</span> publish_id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'洪荒之至尊通天'</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token number">123.33</span><span class="token punctuation">,</span> publish_id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'重生之都市仙尊'</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token number">123.33</span><span class="token punctuation">,</span> publish_id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'穿越诸天万界'</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token number">123.33</span><span class="token punctuation">,</span> publish_id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220308224435733" src="https://i-blog.csdnimg.cn/blog_migrate/d51ee538011a7b96a115f796759528fc.png"/>
    </p>
    <h5>
     <a id="66___1134">
     </a>
     6.6 一对多外键操作
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">一对一</span> <span class="token variable">与</span> <span class="token variable">一对多的操作和普通的表操作是一样的。</span>
<span class="token variable">查</span> <span class="token variable">objects</span><span class="token punctuation">.</span><span class="token variable">各种方法</span>
<span class="token variable">增</span> <span class="token variable">objects</span><span class="token punctuation">.</span><span class="token variable">create</span><span class="token punctuation">(</span><span class="token variable">字段</span><span class="token punctuation">=</span><span class="token variable">值</span><span class="token punctuation">)</span>
<span class="token variable">删</span> <span class="token variable">object</span><span class="token punctuation">.</span><span class="token variable">各种方法</span><span class="token punctuation">.</span><span class="token variable">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token variable">改</span> <span class="token variable">objects</span><span class="token punctuation">.</span><span class="token variable">各种方法</span><span class="token punctuation">.</span><span class="token variable">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token variable">objects</span><span class="token punctuation">.</span><span class="token variable">filter查的结果是一个queryset对象</span> <span class="token variable">是一个列表套字典</span> <span class="token punctuation">,</span><span class="token variable">字典中是一个数据对象</span><span class="token punctuation">.</span>
<span class="token variable">objects</span><span class="token punctuation">.</span><span class="token variable">filter</span><span class="token punctuation">.</span><span class="token variable">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token variable">将这个数据对象取出来</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">外键字段不带_id</span> <span class="token variable">它的值可以是一个对象</span><span class="token punctuation">,</span> <span class="token variable">也可以是一个表的之间值</span><span class="token punctuation">.</span>
<span class="token variable">外键字段带_id</span><span class="token punctuation">=</span> <span class="token variable">表的主键值</span><span class="token punctuation">,</span> <span class="token variable">publish不带_id</span> <span class="token variable">它的值不能就是表的主键值</span><span class="token punctuation">.</span>
</code></pre>
    <h6>
     <a id="1__1152">
     </a>
     1. 增
    </h6>
    <pre><code class="prism language-handlebars"><span class="token variable">添加书籍数据</span>  <span class="token variable">并设置外键</span> <span class="token variable">绑定出版社</span><span class="token punctuation">.</span>
</code></pre>
    <p>
     <img alt="image-20220308231108560" src="https://i-blog.csdnimg.cn/blog_migrate/cfc2fc06feb5c9c976b85113c6742f94.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 方式1： 书籍表  对应出版社的外键绑定出版社的id</span>
	models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'现在开始梁山我说了算'</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token number">555.05</span><span class="token punctuation">,</span> publish_id<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220308231154356" src="https://i-blog.csdnimg.cn/blog_migrate/7337ee696ec569073d9bc7039e0943a7.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 方式二： 书籍表  对应出版社的外键绑定出版社的数据值</span>
    <span class="token comment"># 1. 获取出版社的数据对象</span>
    publish_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>publish_obj<span class="token punctuation">)</span>  <span class="token comment"># 1 上海出版社 上海 123@qq.com</span>

    <span class="token comment"># 2. 为书籍表添加数据                                              publish 外键字段</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'带着仓库到大明'</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token string">'666.06'</span><span class="token punctuation">,</span> publish<span class="token operator">=</span>publish_obj<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">publish</span><span class="token punctuation">=</span><span class="token variable">publish_obj</span> <span class="token variable">publish不带_id</span> <span class="token variable">它的值可以是一个对象</span><span class="token punctuation">,</span> <span class="token variable">也可以是一个表的之间值</span><span class="token punctuation">.</span>
<span class="token variable">publish_id</span> <span class="token punctuation">=</span> <span class="token variable">表的主键值</span><span class="token punctuation">,</span> <span class="token variable">publish不带_id</span> <span class="token variable">它的值不能就是表的主键值</span><span class="token punctuation">.</span>
</code></pre>
    <p>
     <img alt="image-20220308232434623" src="https://i-blog.csdnimg.cn/blog_migrate/6bd7f3c137cff9c7fc4367fe907b06c2.png"/>
    </p>
    <h6>
     <a id="2__1184">
     </a>
     2. 删
    </h6>
    <pre><code class="prism language-handlebars"><span class="token punctuation">*</span> <span class="token variable">默认是级联更新和级联删除的</span> 
<span class="token variable">删除</span> <span class="token variable">书籍表的数据</span>
</code></pre>
    <pre><code class="prism language-python">   <span class="token comment"># 方式一: 查询直接删除</span>
   models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220308232911051" src="https://i-blog.csdnimg.cn/blog_migrate/2fc40fe665232e9de138f992ea45d575.png"/>
    </p>
    <pre><code class="prism language-python">	<span class="token comment"># 方式二: 获取QuerySet对象在删除</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
	book_obj<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220308233032710" src="https://i-blog.csdnimg.cn/blog_migrate/d2e4e1f2dc8d3eb13a86bf501f040a49.png"/>
    </p>
    <h6>
     <a id="3__1206">
     </a>
     3. 修改
    </h6>
    <pre><code class="prism language-handlebars"><span class="token variable">方式</span><span class="token number">1</span> <span class="token variable">将书籍表id为</span><span class="token number">1</span><span class="token variable">的出版社信息改为</span> <span class="token variable">北京出版社的</span>   
<span class="token variable">方式</span><span class="token number">2</span> <span class="token variable">在改回上海出版社</span> 
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># 方式1 查询后直接修改</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>publish<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220308234134922" src="https://i-blog.csdnimg.cn/blog_migrate/20c1001734fb1f19af9542203fb09003.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 1. 先获取出版社的数据对象</span>
    publish_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 2. 为数据表修改数据</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>publish<span class="token operator">=</span>publish_obj<span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220308234712857" src="https://i-blog.csdnimg.cn/blog_migrate/d17351ac6a65ac89c2b2f2afbdb3b5da.png"/>
    </p>
    <h5>
     <a id="67__1229">
     </a>
     6.7 多对多外键操作
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">多对多的操作就是对第三张虚拟表进行操作。</span>
</code></pre>
    <p>
     <img alt="image-20220308235406909" src="https://i-blog.csdnimg.cn/blog_migrate/d0f6c9eab0269f01ecf3d6133a1b172f.png"/>
    </p>
    <h6>
     <a id="1__1237">
     </a>
     1. 增
    </h6>
    <pre><code class="prism language-handlebars"><span class="token punctuation">.</span><span class="token variable">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token variable">给第三张关系表添加数据</span>
<span class="token variable">虚拟字段</span><span class="token punctuation">.</span><span class="token variable">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token variable">括号内既可以传入数字也可以传入对象</span><span class="token punctuation">,</span><span class="token variable">并且都支持多个。</span>
<span class="token variable">数字则是被关联表的id之间</span><span class="token punctuation">,</span> <span class="token variable">对象是被关联表的数据对象</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># 方式1：  id为1的书籍绑定一个主键为1的作者</span>
    <span class="token comment"># 先获取数据表的数据对象</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 为数据对象的虚拟字段 author 添加 author_id</span>
    book_obj<span class="token punctuation">.</span>author<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220309000044054" src="https://i-blog.csdnimg.cn/blog_migrate/5b22de2f6d3ebb25de116477499adcf1.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># id为2的书籍绑定一个主键分别为 1,2 的作者</span>
    <span class="token comment"># 先获取数据表的数据对象</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 为数据对象的虚拟字段 author 添加 author_id</span>
    book_obj<span class="token punctuation">.</span>author<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220309000239970" src="https://i-blog.csdnimg.cn/blog_migrate/8a0febc6a01e317067f87145ba127394.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># id为3的书籍绑定一个主键分别为 1,2 的作者</span>
    <span class="token comment"># 先获取书籍表的数据对象</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 获取id为1的作者数据对象</span>
    author_obj_1 <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 获取id为2的作者数据对象</span>
    author_obj_2 <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 为书籍表对象绑定值</span>
    book_obj<span class="token punctuation">.</span>author<span class="token punctuation">.</span>add<span class="token punctuation">(</span>author_obj_1<span class="token punctuation">,</span> author_obj_2<span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220309000934421" src="https://i-blog.csdnimg.cn/blog_migrate/910e5f2323bac429939539bfba5959bf.png"/>
    </p>
    <h6>
     <a id="2__1282">
     </a>
     2. 删
    </h6>
    <pre><code class="prism language-handlebars"> <span class="token punctuation">.</span><span class="token variable">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token variable">给第三张关系表删除数据。</span>
 <span class="token variable">虚拟字段</span><span class="token punctuation">.</span><span class="token variable">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token variable">括号内既可以传入数字也可以传入对象</span><span class="token punctuation">,</span><span class="token variable">并且都支持多个。</span>
 <span class="token variable">数字则是被关联表的id之间</span><span class="token punctuation">,</span> <span class="token variable">对象是被关联表的数据对象</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># id为1的书籍绑 删除 主键分1的作者</span>
    <span class="token comment"># 方式1</span>
    <span class="token comment"># 先获取数据对象</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>author<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment"># remove移除绑定关系</span>
    book_obj<span class="token punctuation">.</span>author<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">book_obj</span> <span class="token punctuation">=</span> <span class="token variable">models</span><span class="token punctuation">.</span><span class="token variable">Book</span><span class="token punctuation">.</span><span class="token variable">objects</span><span class="token punctuation">.</span><span class="token variable">filter</span><span class="token punctuation">(</span><span class="token variable">pk</span><span class="token punctuation">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token variable">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token variable">author</span><span class="token punctuation">.</span><span class="token variable">remove</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token variable">可以一步完成推荐写两步</span><span class="token punctuation">.</span>
</code></pre>
    <p>
     <img alt="image-20220309002107552" src="https://i-blog.csdnimg.cn/blog_migrate/d12b5526d786bb8a729f3908c51d740d.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 方式2：</span>
	<span class="token comment"># 先获取数据对象</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 获取id为1的作者数据对象</span>
    author_obj_1 <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 获取id为2的作者数据对象</span>
    author_obj_2 <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>

    book_obj<span class="token punctuation">.</span>author<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>author_obj_1<span class="token punctuation">,</span> author_obj_2<span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220309002720519" src="https://i-blog.csdnimg.cn/blog_migrate/e02717b99305dc11e8a35b8d8421a0ba.png"/>
    </p>
    <h6>
     <a id="3__1323">
     </a>
     3. 修改
    </h6>
    <pre><code class="prism language-handlebars"><span class="token punctuation">.</span><span class="token variable">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token variable">括号内必须传可迭代对象。</span>
<span class="token variable">虚拟字段</span><span class="token punctuation">.</span><span class="token variable">add</span><span class="token punctuation">.</span><span class="token variable">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token variable">该对象内既可以是数字也可以是对象并且都支持多个。</span>
<span class="token variable">数字则是被关联表的id之间</span><span class="token punctuation">,</span> <span class="token variable">对象是被关联表的数据对象</span><span class="token punctuation">.</span>
<span class="token variable">先删除在新增。id值会变。</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># 方式1：  id为3的书籍 修改为值绑定一个主键为 1 的作者</span>
    <span class="token comment"># 先获取数据对象</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 修改值</span>
    book_obj<span class="token punctuation">.</span>author<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220309003510092" src="https://i-blog.csdnimg.cn/blog_migrate/9b841c1eac84fbb1048ffcde0e66d2d7.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 方式2：</span>
	    <span class="token comment"># 先获取数据对象</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 获取id为1的作者数据对象</span>
    author_obj_1 <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 获取id为2的作者数据对象</span>
    author_obj_2 <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>

    book_obj<span class="token punctuation">.</span>author<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>author_obj_1<span class="token punctuation">,</span> author_obj_2<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220309003819645" src="https://i-blog.csdnimg.cn/blog_migrate/f5d5046b58c07ee55202627bc5edf52e.png"/>
    </p>
    <h6>
     <a id="4__1359">
     </a>
     4. 清空
    </h6>
    <pre><code class="prism language-handlebars"><span class="token variable">在第三张表中清空某个书籍与作者的绑定关系。</span>
<span class="token punctuation">.</span><span class="token variable">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token variable">括号内不要加任何参数。</span>
<span class="token variable">虚拟字段</span><span class="token punctuation">.</span><span class="token variable">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># 清楚第三张表的所有数据</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    book_obj<span class="token punctuation">.</span>author<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="7___1373">
     </a>
     7. 跨表查询
    </h4>
    <h5>
     <a id="71__1375">
     </a>
     7.1 正反向的概念
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">正向查询：</span> <span class="token variable">通过外键去查询外键所关联的表</span><span class="token punctuation">.</span>
<span class="token variable">反向查询</span><span class="token punctuation">:</span>  <span class="token variable">被一个外键关联的表</span><span class="token punctuation">,</span><span class="token variable">去查询绑定绑定这个外键的表</span><span class="token punctuation">.</span>


<span class="token variable">例：出版社表一对多书籍表</span><span class="token punctuation">,</span><span class="token variable">外键字段建多的一方书籍表中</span><span class="token punctuation">.</span>
<span class="token variable">通过</span> <span class="token variable">书籍表</span> <span class="token variable">--</span><span class="token punctuation">&gt;</span> <span class="token variable">查找</span> <span class="token variable">出版社</span><span class="token punctuation">,</span><span class="token variable">就是正向。</span>
<span class="token variable">通过</span> <span class="token variable">出版社</span> <span class="token variable">--</span><span class="token punctuation">&gt;</span> <span class="token variable">查找</span> <span class="token variable">书籍表</span> <span class="token variable">就是反向向。</span>
<span class="token variable">一对一</span><span class="token punctuation">,</span><span class="token variable">多对多也是同样判断的。</span>

<span class="token variable">正向查询</span> <span class="token variable">数据对象按</span><span class="token punctuation">.</span><span class="token variable">外键字段</span>
<span class="token variable">反向查询</span> <span class="token variable">数据对象</span><span class="token punctuation">.</span><span class="token variable">表名小写_set</span>
<span class="token variable">查询结果是数据对象</span><span class="token punctuation">.</span>
</code></pre>
    <h5>
     <a id="62__1392">
     </a>
     6.2 子查询
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">子查询</span> <span class="token variable">--</span><span class="token punctuation">&gt;</span> <span class="token variable">基于数据对象跨表查询。只能正向查询</span><span class="token punctuation">,</span><span class="token variable">不支持反向查询</span><span class="token punctuation">,</span>

<span class="token variable">ORM子查询方法</span><span class="token punctuation">:</span>
	<span class="token variable">数据对象</span><span class="token punctuation">.</span><span class="token variable">外键字段</span> <span class="token variable">获取被关联的数据对象</span>  <span class="token variable">数据对象</span><span class="token punctuation">.</span><span class="token variable">字段</span>  <span class="token variable">获取值</span>
	<span class="token variable">数据对象</span><span class="token punctuation">.</span><span class="token variable">虚拟字段</span> <span class="token variable">获取被关联的数据对象</span>  <span class="token variable">数据对象</span><span class="token punctuation">.</span><span class="token variable">字段</span>  <span class="token variable">获取值</span>
<span class="token variable">在书写ORM语句的时候跟写sql语句是一样的</span><span class="token punctuation">,</span><span class="token variable">如果语句复杂可以分段写。</span>

<span class="token punctuation">*</span> <span class="token variable">要分清楚查询的结果是一个值还是多个值</span><span class="token punctuation">.</span>
<span class="token variable">是一个则值直接数据对象。</span>
<span class="token variable">结果有多个值的时候就需要加上</span><span class="token punctuation">.</span><span class="token variable">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token variable">来获取值</span><span class="token punctuation">,</span> <span class="token variable">不加获取不到数据</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token number">1.</span> <span class="token variable">查询书籍主键为</span><span class="token number">1</span><span class="token variable">的出版社名称</span>
</code></pre>
    <p>
     <img alt="image-20220309134935981" src="https://i-blog.csdnimg.cn/blog_migrate/a1acecbec80181491580c67e8703aaa0.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment">#  1. 先获取id为1的 书籍对象</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token punctuation">*</span> <span class="token variable">关联信息直接被查出来</span><span class="token punctuation">.</span><span class="token variable">app01</span><span class="token punctuation">.</span><span class="token variable">xxx</span><span class="token punctuation">.</span><span class="token variable">None</span> <span class="token variable">表示后面没有关联的表了</span>
<span class="token punctuation">*</span> <span class="token variable">app01</span><span class="token punctuation">.</span><span class="token variable">xxx</span><span class="token punctuation">.</span><span class="token variable">None</span> <span class="token variable">只会出现在外键关联的表中</span><span class="token punctuation">.</span> <span class="token variable">一对一被关联表也不会出现</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token number">1</span> <span class="token variable">开局签到荒古圣体</span> <span class="token number">123.33</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">08</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">43</span><span class="token punctuation">:</span><span class="token number">50</span> <span class="token number">1</span> <span class="token variable">上海出版社</span> <span class="token variable">上海</span> <span class="token number">123</span><span class="token punctuation">@</span><span class="token variable">qq</span><span class="token punctuation">.</span><span class="token variable">com</span> <span class="token variable">app01</span><span class="token punctuation">.</span><span class="token variable">Author</span><span class="token punctuation">.</span><span class="token variable">None</span>
</code></pre>
    <pre><code class="prism language-python">	<span class="token comment"># 2. 通过外键字段获取被外键关联的数据</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>publish<span class="token punctuation">)</span>  <span class="token comment"># 1 上海出版社 上海 123@qq.com</span>

    <span class="token comment"># 3. 对象点属性的方式取值</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>publish<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">2.</span> <span class="token variable">查询书籍主键为</span><span class="token number">3</span><span class="token variable">的作者名字</span>
</code></pre>
    <p>
     <img alt="image-20220309141621165" src="https://i-blog.csdnimg.cn/blog_migrate/193c5e64ddef03c19349f549c36b7cdf.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment">#  1. 先获取id为3的 书籍对象</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 2. 通过虚拟字段获取被关联表的数据 (不显示第三张表的数据)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>author<span class="token punctuation">)</span>  <span class="token comment"># 2 app01.Author.None  获取不到数据</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>author<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
    <span class="token comment"># &lt;QuerySet [&lt;Author: 1 kid 18 1 110 北京&gt;, &lt;Author: 2 qq 19 2 112 上海&gt;]&gt;</span>

    <span class="token comment"># 3.获取数据对象的名字</span>
    data_obj <span class="token operator">=</span> book_obj<span class="token punctuation">.</span>author<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> obj <span class="token keyword">in</span> data_obj<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># kid qq</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">3.</span> <span class="token variable">拿到作者kid的电话号码</span>
</code></pre>
    <p>
     <img alt="image-20220309143318919" src="https://i-blog.csdnimg.cn/blog_migrate/a666787d5d78bf21d7d94cb1be06c5bf.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment">#  1. 先获取作者kid的数据对象</span>
    author_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'kid'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_obj<span class="token punctuation">)</span>  <span class="token comment"># 1 kid 18 1 110 北京  一对一中不会有 app01.xxx.None </span>

    <span class="token comment"># 2. 通过外键字段获取作者详情表的数据对象</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_obj<span class="token punctuation">.</span>author_detail<span class="token punctuation">)</span>  <span class="token comment"># 1 110 北京</span>
    
    <span class="token comment"># 3.数据对象点属性的方式取值</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_obj<span class="token punctuation">.</span>author_detail<span class="token punctuation">.</span>phone<span class="token punctuation">)</span>  <span class="token comment"># 110</span>
</code></pre>
    <h5>
     <a id="73__1475">
     </a>
     7.3 联表查询
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">联表查询</span> <span class="token variable">--</span><span class="token punctuation">&gt;</span> <span class="token variable">基于数据对象</span><span class="token punctuation">.</span><span class="token variable">表名_set跨表查询。</span>
<span class="token punctuation">(</span><span class="token variable">表名指定的表中</span> <span class="token variable">外键需要绑定这个数据对象的某个字段</span><span class="token punctuation">)</span>


<span class="token variable">ORM反向查询：</span>
	<span class="token variable">数据对象</span><span class="token punctuation">.</span><span class="token variable">表名_set</span>        <span class="token variable">结果是单个值</span>
	<span class="token variable">数据对象</span><span class="token punctuation">.</span><span class="token variable">表名_set</span><span class="token punctuation">.</span><span class="token variable">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token variable">结果是多个值</span>
	<span class="token punctuation">*</span> <span class="token variable">一对一就直接</span><span class="token punctuation">.</span><span class="token variable">表名</span> <span class="token variable">不需要_set</span>
<span class="token variable">在书写ORM语句的时候跟写sql语句是一样的</span><span class="token punctuation">,</span><span class="token variable">如果语句复杂可以分段写。</span>

<span class="token punctuation">*</span> <span class="token variable">要分清楚查询的结果是一个值还是多个值</span><span class="token punctuation">.</span>
<span class="token variable">是一个则值直接数据对象。</span>
<span class="token variable">结果有多个值的时候就需要加上_set</span><span class="token punctuation">.</span><span class="token variable">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token variable">来获取值</span><span class="token punctuation">,</span> <span class="token variable">不加获取不到数据</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token number">1.</span> <span class="token variable">查询北京出版社出版的书</span>
</code></pre>
    <p>
     <img alt="image-20220309144852967" src="https://i-blog.csdnimg.cn/blog_migrate/88fcf00c1c6d0a6c4fc01d5fa93b2c16.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment">#  1. 先获取出版社的数据对象</span>
    publish_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'北京出版社'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>publish_obj<span class="token punctuation">)</span>  <span class="token comment"># 2 北京出版社 北京 456@qq.com</span>

    <span class="token comment"># 2.使用_set.all() 反向查询</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>publish_obj<span class="token punctuation">.</span>book_set<span class="token punctuation">)</span>  <span class="token comment"># app01.Book.None 获取不到数据</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>publish_obj<span class="token punctuation">.</span>book_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token punctuation">&lt;</span><span class="token variable">QuerySet</span> <span class="token punctuation">[</span><span class="token punctuation">&lt;</span><span class="token variable">Book</span><span class="token punctuation">:</span> <span class="token number">3</span> <span class="token variable">重生之都市仙尊</span> <span class="token number">123.33</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">08</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">:</span><span class="token number">11.726676</span> <span class="token number">2</span> <span class="token variable">北京出版社</span> <span class="token variable">北京</span> <span class="token number">456</span><span class="token punctuation">@</span><span class="token variable">qq</span><span class="token punctuation">.</span><span class="token variable">com</span> <span class="token variable">app01</span><span class="token punctuation">.</span><span class="token variable">Author</span><span class="token punctuation">.</span><span class="token variable">None</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> 
<span class="token punctuation">&lt;</span><span class="token variable">Book</span><span class="token punctuation">:</span> <span class="token number">4</span> <span class="token variable">穿越诸天万界</span> <span class="token number">123.33</span> <span class="token number">2022</span><span class="token variable">-</span><span class="token number">03</span><span class="token variable">-</span><span class="token number">08</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">:</span><span class="token number">11.728670</span> <span class="token number">2</span> <span class="token variable">北京出版社</span> <span class="token variable">北京</span> <span class="token number">456</span><span class="token punctuation">@</span><span class="token variable">qq</span><span class="token punctuation">.</span><span class="token variable">com</span> <span class="token variable">app01</span><span class="token punctuation">.</span><span class="token variable">Author</span><span class="token punctuation">.</span><span class="token variable">None</span><span class="token punctuation">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># 3. 获取数据</span>
    book_obj <span class="token operator">=</span> publish_obj<span class="token punctuation">.</span>book_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> obj <span class="token keyword">in</span> book_obj<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>title<span class="token punctuation">)</span>  <span class="token comment"># 重生之都市仙尊 穿越诸天万界</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">2.</span> <span class="token variable">查询作者kid写的书</span>
</code></pre>
    <p>
     <img alt="image-20220309151359036" src="https://i-blog.csdnimg.cn/blog_migrate/85f3d4983f8e0618262d4b898524c9aa.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment">#  1. 先获取作者的数据对象</span>
    author_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'kid'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_obj<span class="token punctuation">)</span>  <span class="token comment"># 1 kid 18 1 110 北京</span>

    <span class="token comment"># 2. 直接查书籍表的数据会展示 外键字段连接的数据</span>
    book_msg <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'重生之都市仙尊'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_msg<span class="token punctuation">)</span>
    <span class="token comment"># 3 重生之都市仙尊 123.33 2022-03-08 22:44:11.726676 2 北京出版社 北京 456@qq.com app01.Author.None</span>

    <span class="token comment"># 3. _set反向查询  会将外键字典的值一起展示出来</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_obj<span class="token punctuation">.</span>book_set<span class="token punctuation">)</span>  <span class="token comment"># app01.Book.None</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_obj<span class="token punctuation">.</span>book_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [&lt;Book: 3 重生之都市仙尊 123.33 2022-03-08 22:44:11.726676 2 北京出版社 北京 456@qq.com app01.Author.None&gt;]&gt;</span>

    <span class="token comment"># 4.获取值 两种方式</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_obj<span class="token punctuation">.</span>book_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span>

    book_obj <span class="token operator">=</span> author_obj<span class="token punctuation">.</span>book_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> obj <span class="token keyword">in</span> book_obj<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>title<span class="token punctuation">)</span>  <span class="token comment"># 重生之都市仙尊</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">3.</span><span class="token variable">查询手机号是</span><span class="token number">110</span><span class="token variable">的作者名字。</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token punctuation">*</span> <span class="token variable">一对一就直接</span><span class="token punctuation">.</span><span class="token variable">表名</span> <span class="token variable">不需要_set</span>
</code></pre>
    <p>
     <img alt="image-20220309153442815" src="https://i-blog.csdnimg.cn/blog_migrate/dae26e1a152facc42dbe009bc72dc4a0.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 1. 先获取作者详情的数据对象</span>
    authordetail_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>AuthorDetail<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>phone<span class="token operator">=</span><span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>authordetail_obj<span class="token punctuation">)</span>  <span class="token comment"># 1 110 北京</span>

    <span class="token comment"># 2. 反向查询 一对一就直接.表名 不需要_set</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>authordetail_obj<span class="token punctuation">.</span>author<span class="token punctuation">)</span>  <span class="token comment"># 1 kid 18 1 110 北京</span>

    <span class="token comment"># 3. 获取数据</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>authordetail_obj<span class="token punctuation">.</span>author<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># kid</span>

    <span class="token comment"># 一对一就直接.表名._set 直接报错</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>authordetail_obj<span class="token punctuation">.</span>author_set<span class="token punctuation">)</span>
    <span class="token comment"># AttributeError：“AuthorDetail”对象没有属性“author_set”</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">子查询和联表查询的QuerySet对象中是列表套数据对象</span> <span class="token variable">通过点取值</span>
<span class="token punctuation">&lt;</span><span class="token variable">QuerySet</span> <span class="token brackets"><span class="token punctuation">[</span><span class="token variable">&lt;表名:数据对象&gt;,....</span><span class="token punctuation">]</span></span>
<span class="token variable">双下方法查询的QuerySet对象中是列表套字典</span><span class="token punctuation">,</span> <span class="token variable">字典的取值方式取值</span>
<span class="token punctuation">&lt;</span><span class="token variable">QuerySet</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'字段'</span><span class="token punctuation">:</span> <span class="token number">110</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre>
    <h4>
     <a id="8__1583">
     </a>
     8. 双下方式查询
    </h4>
    <pre><code class="prism language-handlebars"><span class="token variable">跨表的时候可以使用双下方式便捷查询</span><span class="token punctuation">.</span>

<span class="token variable">直接通过</span> <span class="token variable">queryset对象</span><span class="token punctuation">.</span><span class="token variable">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">获取指定字段的值</span> 

<span class="token variable">正向查询</span>
    <span class="token variable">queryset对象</span><span class="token punctuation">.</span><span class="token variable">values</span><span class="token punctuation">(</span><span class="token string">'外键__字段'</span><span class="token punctuation">)</span> 
<span class="token variable">反向查询</span>
    <span class="token variable">queryset对象</span><span class="token punctuation">.</span><span class="token variable">values</span><span class="token punctuation">(</span><span class="token string">'表名__字段'</span><span class="token punctuation">)</span>

<span class="token variable">获取的数据格式是queryset对象列表套字典</span><span class="token punctuation">,</span><span class="token variable">字典的键是values中指定的参数</span><span class="token punctuation">,</span><span class="token variable">值是匹配出来的值</span><span class="token punctuation">.</span>

<span class="token variable">queryset对象列表中的字典键可以重复出现</span><span class="token punctuation">.</span>
</code></pre>
    <h6>
     <a id="81__1600">
     </a>
     8.1 正向查询
    </h6>
    <pre><code class="prism language-handlebars"> <span class="token number">1.</span><span class="token variable">查询kid的手机号</span>
</code></pre>
    <p>
     <img alt="image-20220309161351200" src="https://i-blog.csdnimg.cn/blog_migrate/8b08facba663170330cd980270226d1b.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 1. 子查询方式  数据对象.外键字典</span>
    author_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'kid'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_obj<span class="token punctuation">)</span>  <span class="token comment"># 1 kid 18 1 110 北京</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_obj<span class="token punctuation">.</span>author_detail<span class="token punctuation">)</span>  <span class="token comment"># 1 110 北京</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_obj<span class="token punctuation">.</span>author_detail<span class="token punctuation">.</span>phone<span class="token punctuation">)</span>  <span class="token comment"># 110</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># 2. __方式查询</span>
    phone_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'kid'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'author_detail__phone'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>phone_obj<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'author_detail__phone': 110}]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>phone_obj<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># {'author_detail__phone': 110}</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">2.</span><span class="token variable">查询书籍主键为</span><span class="token number">1</span><span class="token variable">的书名和出版社名字</span>
</code></pre>
    <p>
     <img alt="image-20220309161741300" src="https://i-blog.csdnimg.cn/blog_migrate/f24b3de73b429a4aa77f4510e134263e.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 1. 子查询方式</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">)</span>  <span class="token comment"># 1 开局签到荒古圣体 123.33 2022-03-08 22:43:50.303320 1 上海出版社 上海 123@qq.com app01.Author.None</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>title<span class="token punctuation">)</span>  <span class="token comment"># 开局签到荒古圣体</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>publish<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># 上海出版社</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># __方式查询</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'publish__name'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'title': '开局签到荒古圣体', 'publish__name': '上海出版社'}]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># {'title': '开局签到荒古圣体', 'publish__name': '上海出版社'}</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">3.</span><span class="token variable">查询书籍主键为</span><span class="token number">3</span><span class="token variable">的作者姓名</span>
</code></pre>
    <p>
     <img alt="image-20220309194330717" src="https://i-blog.csdnimg.cn/blog_migrate/6bedc9d0b72711a39f9916e15d0ebdaf.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 子查询方式</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">)</span>
    <span class="token comment"># 3 重生之都市仙尊 123.33 2022-03-08 22:44:11.726676 2 北京出版社 北京 456@qq.com app01.Author.None</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>author<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
    <span class="token comment"># &lt;QuerySet [&lt;Author: 1 kid 18 1 110 北京&gt;, &lt;Author: 2 qq 19 2 112 上海&gt;]&gt;</span>
    author_obj <span class="token operator">=</span> book_obj<span class="token punctuation">.</span>author<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> obj <span class="token keyword">in</span> author_obj<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># kid  qq</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># __方式查询</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'author__name'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'author__name': 'kid'}, {'author__name': 'qq'}]&gt;</span>
    <span class="token keyword">for</span> obj <span class="token keyword">in</span> book_obj<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'author__name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># kid qq</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">4.</span><span class="token variable">查询书籍主键是</span><span class="token number">3</span><span class="token variable">的作者的手机号</span>
</code></pre>
    <p>
     <img alt="image-20220309194415610" src="https://i-blog.csdnimg.cn/blog_migrate/ab860e90b4661b6d1f39b10ae860d160.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 子查询方式</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>author<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [&lt;Author: 1 kid 18 1 110 北京&gt;, &lt;Author: 2 qq 19 2 112 上海&gt;]&gt;</span>
    author_obj <span class="token operator">=</span> book_obj<span class="token punctuation">.</span>author<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> obj <span class="token keyword">in</span> author_obj<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>  <span class="token comment"># -                   1 kid 18 1 110 北京   2 qq 19 2 112 上海</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>author_detail<span class="token punctuation">)</span>  <span class="token comment"># -     1 110 北京            2 112 上海</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>author_detail<span class="token punctuation">.</span>phone<span class="token punctuation">)</span>  <span class="token comment"># 110                   112</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># __方式查询</span>
    phone_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'author__author_detail__phone'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>phone_obj<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'author__author_detail__phone': 110}, {'author__author_detail__phone': 112}]&gt;</span>
    <span class="token keyword">for</span> obj <span class="token keyword">in</span> phone_obj<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'author__author_detail__phone'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 110 112</span>
</code></pre>
    <h6>
     <a id="82__1695">
     </a>
     8.2 反向查询
    </h6>
    <pre><code class="prism language-handlebars"><span class="token number">1.</span><span class="token variable">查询手机号</span><span class="token number">110</span><span class="token variable">的作者姓名</span>
</code></pre>
    <p>
     <img alt="image-20220309181634326" src="https://i-blog.csdnimg.cn/blog_migrate/29c083ce2ec1d46478ff4ddae3c29406.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 反向查询 一对一不需要_set</span>
    author_detail_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>AuthorDetail<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>phone<span class="token operator">=</span><span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_detail_obj<span class="token punctuation">)</span>  <span class="token comment"># 1 110 北京</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_detail_obj<span class="token punctuation">.</span>author<span class="token punctuation">)</span>  <span class="token comment"># 1 kid 18 1 110 北京</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_detail_obj<span class="token punctuation">.</span>author<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># kid</span>
</code></pre>
    <pre><code class="prism language-python">	<span class="token comment"># __方式查询</span>
    author_detail_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>AuthorDetail<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>phone<span class="token operator">=</span><span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'author__name'</span><span class="token punctuation">,</span> <span class="token string">'phone'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_detail_obj<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'author__name': 'kid', 'phone': 110}]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_detail_obj<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># {'author__name': 'kid', 'phone': 110}</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token number">2.</span><span class="token variable">查询上海出版社出版的书</span>
</code></pre>
    <p>
     <img alt="image-20220309184239858" src="https://i-blog.csdnimg.cn/blog_migrate/8cd80e7b66ead5f8ee90cf0cd9a3d411.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 反向查询 _set 方式</span>
    publish_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'上海出版社'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>publish_obj<span class="token punctuation">)</span>  <span class="token comment"># 1 上海出版社 上海 123@qq.com</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>publish_obj<span class="token punctuation">.</span>book_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [&lt;Book: 1 开局签到荒古圣体 123.33 2022-03-08 22:43:50.303320 1 上海出版社 上海 123@qq.com app01.Author.None&gt;, &lt;Book: 2 洪荒之至尊通天 123.33 2022-03-08 22:44:11.715622 1 上海出版社 上海 123@qq.com app01.Author.None&gt;]&gt;</span>

    book_obj <span class="token operator">=</span> publish_obj<span class="token punctuation">.</span>book_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> obj <span class="token keyword">in</span> book_obj<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>title<span class="token punctuation">)</span>  <span class="token comment"># 开局签到荒古圣体 洪荒之至尊通天</span>

</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># __方式查询</span>
    publish_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'上海出版社'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'book__title'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>publish_obj<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'book__title': '开局签到荒古圣体'}, {'book__title': '洪荒之至尊通天'}]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>publish_obj<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># {'book__title': '开局签到荒古圣体'}</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">3.</span><span class="token variable">查询kid写的书</span>
</code></pre>
    <p>
     <img alt="image-20220309190036010" src="https://i-blog.csdnimg.cn/blog_migrate/3effb4c2a782d0ffb7f30747d085386a.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 反向查询</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'kid'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">)</span>  <span class="token comment"># 1 kid 18 1 110 北京</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>book_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [&lt;Book: 3 重生之都市仙尊 123.33 2022-03-08 22:44:11.726676 2 北京出版社 北京 456@qq.com app01.Author.None&gt;]&gt;</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>book_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 3 重生之都市仙尊 123.33 2022-03-08 22:44:11.726676 2 北京出版社 北京 456@qq.com app01.Author.None</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>book_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span>
    <span class="token comment"># 重生之都市仙尊</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># __方式查询</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'kid'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'book__title'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'book__title': '重生之都市仙尊'}]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># {'book__title': '重生之都市仙尊'}</span>
</code></pre>
    <h4>
     <a id="9__1770">
     </a>
     9. 聚合查询
    </h4>
    <pre><code class="prism language-handlebars"><span class="token variable">聚合查询通常都是配合分组一起使用的。</span>
<span class="token variable">需要导入导入模块</span><span class="token punctuation">,</span><span class="token variable">只要更数据相关的模块基本上都在django</span><span class="token punctuation">.</span><span class="token variable">dbmodels或者django</span><span class="token punctuation">.</span><span class="token variable">db中。</span>
<span class="token variable">from</span> <span class="token variable">django</span><span class="token punctuation">.</span><span class="token variable">db</span><span class="token punctuation">.</span><span class="token variable">models</span> <span class="token variable">import</span> <span class="token variable">Max</span><span class="token punctuation">,</span> <span class="token variable">Min</span><span class="token punctuation">,</span> <span class="token variable">Sum</span><span class="token punctuation">,</span><span class="token variable">Count</span><span class="token punctuation">,</span> <span class="token variable">Avg</span>

<span class="token variable">聚合查询直接使用需要在aggregate方法中使用</span><span class="token punctuation">.</span>
<span class="token variable">objects</span><span class="token punctuation">.</span><span class="token variable">aggregate</span><span class="token punctuation">(</span><span class="token variable">聚合函数</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 

<span class="token variable">聚合查询的结果是一个字典</span>
<span class="token variable">键的名字是聚合函数中写的参数</span><span class="token punctuation">+</span><span class="token variable">聚合函数的名称</span>
<span class="token punctuation">{<!-- --></span><span class="token string">'参数__聚合函数'</span><span class="token punctuation">:</span> <span class="token variable">xx</span><span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="91__1785">
     </a>
     9.1 直接使用
    </h5>
    <pre><code class="prism language-handlebars"><span class="token punctuation">*</span> <span class="token variable">先手动修改一个价格</span>
</code></pre>
    <p>
     <img alt="image-20220309195321180" src="https://i-blog.csdnimg.cn/blog_migrate/dc3ddeb1ec4ed5d14a684c26416666ad.png"/>
    </p>
    <pre><code class="prism language-handlebars"><span class="token number">1.</span><span class="token variable">获取图书的平均价格</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Max<span class="token punctuation">,</span> Min<span class="token punctuation">,</span> Sum<span class="token punctuation">,</span> Count<span class="token punctuation">,</span> Avg
    price__avg <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span>Avg<span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>price__avg<span class="token punctuation">)</span>  
    <span class="token comment"># {'price__avg': 250.0}</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token number">2.</span><span class="token variable">最贵的书</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Max<span class="token punctuation">,</span> Min<span class="token punctuation">,</span> Sum<span class="token punctuation">,</span> Count<span class="token punctuation">,</span> Avg
    price__max <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span>Max<span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>price__max<span class="token punctuation">)</span>  
    <span class="token comment"># {'price__max': Decimal('400.00')}</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token number">3.</span><span class="token variable">最便宜的书</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Max<span class="token punctuation">,</span> Min<span class="token punctuation">,</span> Sum<span class="token punctuation">,</span> Count<span class="token punctuation">,</span> Avg
    price__min <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span>Min<span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>price__min<span class="token punctuation">)</span>  
    <span class="token comment"># {'price__min': Decimal('100.00')}</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token number">4.</span><span class="token variable">所有书籍的价格</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Max<span class="token punctuation">,</span> Min<span class="token punctuation">,</span> Sum<span class="token punctuation">,</span> Count<span class="token punctuation">,</span> Avg
    price__sum <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span>Sum<span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>price__sum<span class="token punctuation">)</span>
    <span class="token comment"># {'price__sum': Decimal('1000.00')}</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token number">5.</span><span class="token variable">数图的数量</span>
<span class="token variable">写pk自动找主键</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Max<span class="token punctuation">,</span> Min<span class="token punctuation">,</span> Sum<span class="token punctuation">,</span> Count<span class="token punctuation">,</span> Avg
    price__count <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span>Count<span class="token punctuation">(</span><span class="token string">'pk'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>price__count<span class="token punctuation">)</span>
    <span class="token comment"># {'pk__count': 4}</span>
</code></pre>
    <h5>
     <a id="92__1849">
     </a>
     9.2 分组查询
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">MySQL分组查询特点</span><span class="token punctuation">:</span>
<span class="token variable">分组之后</span><span class="token punctuation">,</span><span class="token variable">开了严格模式组内其他字段都无法直接获取了</span><span class="token punctuation">,</span><span class="token variable">只能获取分组的依据</span><span class="token punctuation">.</span>
<span class="token variable">ORM所有字段都可以获取</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">ORM</span> <span class="token variable">的</span> <span class="token variable">分组关键字</span> <span class="token variable">annotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">括号内写聚合函数</span>
<span class="token variable">annotate</span><span class="token punctuation">(</span><span class="token string">'别名'</span><span class="token punctuation">=</span><span class="token variable">聚合函数</span><span class="token punctuation">(</span><span class="token variable">操作的字段</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token variable">values</span><span class="token punctuation">(</span><span class="token string">'别名'</span><span class="token punctuation">)</span>
<span class="token variable">操作的字段可以</span> <span class="token variable">表名__字段</span> <span class="token variable">跨表正反向查询</span><span class="token punctuation">.</span>

<span class="token punctuation">.</span><span class="token variable">values</span><span class="token punctuation">(</span><span class="token variable">写需要展示的字段</span><span class="token punctuation">,</span> <span class="token variable">select</span> <span class="token variable">要展示的字段</span><span class="token punctuation">)</span>
<span class="token variable">xxx表</span><span class="token punctuation">.</span><span class="token variable">objects</span><span class="token punctuation">.</span><span class="token variable">annotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">就以这个xxx表的主键作为分组的依据</span><span class="token punctuation">.</span>

<span class="token variable">在跨表操作的时候会自动拼接表</span><span class="token punctuation">.</span>
<span class="token variable">一般都会为聚合函数的结果起一个别名</span><span class="token punctuation">.</span><span class="token variable">在配合values</span><span class="token punctuation">(</span><span class="token string">'别名'</span><span class="token punctuation">)</span><span class="token variable">使用</span><span class="token punctuation">.</span>

<span class="token variable">聚合函数操作的字段是一个表的主键的话可以只写表名</span><span class="token punctuation">,</span>
<span class="token variable">xxx表__id</span> <span class="token variable">省略__id</span> <span class="token variable">就写xxx表</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">1.</span><span class="token variable">统计每一本书的作者个数</span>
 <span class="token variable">以book_id最为依据</span><span class="token punctuation">,</span><span class="token variable">去统计</span> <span class="token variable">author_id</span> <span class="token variable">的数量</span>
</code></pre>
    <p>
     <img alt="image-20220309210100416" src="https://i-blog.csdnimg.cn/blog_migrate/c1c8e84b82239885fc540760ce74d2c1.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># Count('author') 实际为Count('author__id')  可以省略不写</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>Count_num<span class="token operator">=</span>Count<span class="token punctuation">(</span><span class="token string">'author'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'Count_num'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token punctuation">&lt;</span><span class="token variable">QuerySet</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'开局签到荒古圣体'</span><span class="token punctuation">,</span> <span class="token string">'Count_num'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'洪荒之至尊通天'</span><span class="token punctuation">,</span> <span class="token string">'Count_num'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'重生之都市仙尊'</span><span class="token punctuation">,</span> <span class="token string">'Count_num'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'穿越诸天万界'</span><span class="token punctuation">,</span> <span class="token string">'Count_num'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_book<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>title<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>app01_book_author<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>author_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>Count_num<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_book<span class="token punctuation">`</span></span> <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> <span class="token identifier"><span class="token punctuation">`</span>app01_book_author<span class="token punctuation">`</span></span> <span class="token keyword">ON</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>app01_book<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token identifier"><span class="token punctuation">`</span>app01_book_author<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>book_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token identifier"><span class="token punctuation">`</span>app01_book<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token boolean">NULL</span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">2.</span><span class="token variable">统计每个出版社卖的最便宜的书的价格</span>
 <span class="token variable">以出版社的id为依据</span><span class="token punctuation">,</span><span class="token variable">求最低的价格</span>
</code></pre>
    <p>
     <img alt="image-20220309210928680" src="https://i-blog.csdnimg.cn/blog_migrate/942956687c8fa3e9b03cabe4ebd26801.png"/>
    </p>
    <pre><code class="prism language-python">	publish_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>min_price<span class="token operator">=</span>Min<span class="token punctuation">(</span><span class="token string">'book__price'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'min_price'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>publish_obj<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-sql">    <span class="token comment"># &lt;QuerySet [{'name': '上海出版社', 'min_price': Decimal('100.00')}, {'name': '北京出版社', 'min_price': Decimal('300.00')}]&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_publish<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token function">MIN</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>app01_book<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>price<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>price__min<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_publish<span class="token punctuation">`</span></span> <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> <span class="token identifier"><span class="token punctuation">`</span>app01_book<span class="token punctuation">`</span></span> <span class="token keyword">ON</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>app01_publish<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token identifier"><span class="token punctuation">`</span>app01_book<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>publish_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token identifier"><span class="token punctuation">`</span>app01_publish<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token boolean">NULL</span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token number">3.</span> <span class="token variable">统计书籍作者不为</span><span class="token number">1</span><span class="token variable">的数量</span>
<span class="token variable">先按图书表的主键分组</span><span class="token punctuation">,</span><span class="token variable">在统计每本书的作者数量</span><span class="token punctuation">,</span><span class="token variable">最后过滤一个作者的图书</span>
</code></pre>
    <pre><code class="prism language-python">	<span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Max<span class="token punctuation">,</span> Min<span class="token punctuation">,</span> Sum<span class="token punctuation">,</span> Count<span class="token punctuation">,</span> Avg
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>author_count<span class="token operator">=</span>Count<span class="token punctuation">(</span><span class="token string">'author__id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>author_count__gt<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'author_count'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">)</span>  
    <span class="token comment"># &lt;QuerySet [{'title': '重生之都市仙尊', 'author_count': 2}]&gt;</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">只要ORM语句得出的结果还是一个queryset对象</span><span class="token punctuation">,</span><span class="token variable">那么就可以继续无限制的点queryset对象封装的方法。</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_book<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>title<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>app01_book_author<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>author_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>author_count<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_book<span class="token punctuation">`</span></span> <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> <span class="token identifier"><span class="token punctuation">`</span>app01_book_author<span class="token punctuation">`</span></span> <span class="token keyword">ON</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>app01_book<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token identifier"><span class="token punctuation">`</span>app01_book_author<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>book_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token identifier"><span class="token punctuation">`</span>app01_book<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>app01_book_author<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>author_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token boolean">NULL</span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span>	
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">4.</span><span class="token variable">查询每个作者出的书的总价格</span>
 <span class="token variable">先按作者id分组</span><span class="token punctuation">,</span><span class="token variable">在统计所有书籍的价格</span>
</code></pre>
    <p>
     <img alt="image-20220309212928851" src="https://i-blog.csdnimg.cn/blog_migrate/2aeb4bc9872861d3b5194821fe971522.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Max<span class="token punctuation">,</span> Min<span class="token punctuation">,</span> Sum<span class="token punctuation">,</span> Count<span class="token punctuation">,</span> Avg

    author_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>count_sum<span class="token operator">=</span>Sum<span class="token punctuation">(</span><span class="token string">'book__price'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'count_sum'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_obj<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars">    <span class="token punctuation">#</span> <span class="token punctuation">&lt;</span><span class="token variable">QuerySet</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'kid'</span><span class="token punctuation">,</span> <span class="token string">'count_sum'</span><span class="token punctuation">:</span> <span class="token variable">Decimal</span><span class="token punctuation">(</span><span class="token string">'300.00'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'qq'</span><span class="token punctuation">,</span> <span class="token string">'count_sum'</span><span class="token punctuation">:</span> <span class="token variable">Decimal</span><span class="token punctuation">(</span><span class="token string">'300.00'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'qaq'</span><span class="token punctuation">,</span> <span class="token string">'count_sum'</span><span class="token punctuation">:</span> <span class="token variable">None</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span>
</code></pre>
    <pre><code class="prism language-sql"><span class="token punctuation">(</span><span class="token number">0.000</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>app01_author<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>app01_book<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>price<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>count_sum<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>app01_author<span class="token punctuation">`</span></span> <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> <span class="token identifier"><span class="token punctuation">`</span>app01_book_author<span class="token punctuation">`</span></span> <span class="token keyword">ON</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>app01_author<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token identifier"><span class="token punctuation">`</span>app01_book_author<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>author_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> <span class="token identifier"><span class="token punctuation">`</span>app01_book<span class="token punctuation">`</span></span> <span class="token keyword">ON</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>app01_book_author<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>book_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token identifier"><span class="token punctuation">`</span>app01_book<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token identifier"><span class="token punctuation">`</span>app01_author<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token boolean">NULL</span> <span class="token keyword">LIMIT</span> <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="10_F_1955">
     </a>
     10. F查询
    </h4>
    <pre><code class="prism language-handlebars"><span class="token variable">F</span> <span class="token variable">查询可以取到表中某个字段对应的值</span><span class="token punctuation">,</span><span class="token variable">当作筛选条件</span><span class="token punctuation">,</span><span class="token variable">还支持一般的数学运算</span><span class="token punctuation">.</span>
<span class="token variable">导入模块</span> <span class="token variable">from</span> <span class="token variable">django</span><span class="token punctuation">.</span><span class="token variable">db</span><span class="token punctuation">.</span><span class="token variable">models</span> <span class="token variable">import</span> <span class="token variable">F</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">先为书表添加字段</span>
<span class="token variable">库存的字段</span>  <span class="token variable">stock</span>
<span class="token variable">卖出的字段</span>  <span class="token variable">market</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
······
    <span class="token comment"># 库存的字段</span>
    stock <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token comment"># 卖出的字段</span>
    market <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 打印Book实例化对象时展示所有字段的信息</span>
        <span class="token keyword">return</span> <span class="token string">'%s %s %s %s %s %s %s %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>
            self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>title<span class="token punctuation">,</span> self<span class="token punctuation">.</span>price<span class="token punctuation">,</span> self<span class="token punctuation">.</span>publish_date<span class="token punctuation">,</span> self<span class="token punctuation">.</span>publish<span class="token punctuation">,</span> self<span class="token punctuation">.</span>author<span class="token punctuation">,</span> self<span class="token punctuation">.</span>stock<span class="token punctuation">,</span> self<span class="token punctuation">.</span>market<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">执行数据库迁移命令</span><span class="token punctuation">:</span>
<span class="token variable">python</span>  <span class="token variable">manage</span><span class="token punctuation">.</span><span class="token variable">py</span> <span class="token variable">makemigrations</span>
<span class="token variable">python</span> <span class="token variable">manage</span><span class="token punctuation">.</span><span class="token variable">py</span> <span class="token variable">migrate</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token variable">再修改数据（数据不够用自己多添加几个）</span>
</code></pre>
    <p>
     <img alt="image-20220309224643407" src="https://i-blog.csdnimg.cn/blog_migrate/f89b31a8427c9e10127701873c20d946.png"/>
    </p>
    <pre><code class="prism language-handlebars"><span class="token number">1.</span><span class="token variable">查询卖出数大于库存数的书籍名称</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> F
    <span class="token comment"># -                                    卖出 大于 库存</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>market__gt<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'stock'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'market'</span><span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars">    <span class="token punctuation">&lt;</span> <span class="token variable">QuerySet</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'洪荒之至尊通天'</span><span class="token punctuation">,</span> <span class="token string">'market'</span><span class="token punctuation">:</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'重生之都市仙尊'</span><span class="token punctuation">,</span> <span class="token string">'market'</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">:</span> <span class="token number">800</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'穿越诸天万界'</span><span class="token punctuation">,</span> <span class="token string">'market'</span><span class="token punctuation">:</span> <span class="token number">1500</span><span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">&gt;</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token number">2.</span><span class="token variable">将所有书籍的价格提升</span><span class="token number">50</span><span class="token variable">块</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> F
    <span class="token comment"># 将所有书籍的价格提升50块</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>update<span class="token punctuation">(</span>price<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">50</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220309230127399" src="https://i-blog.csdnimg.cn/blog_migrate/d476cb6f22a4a12777c18d4983d70d5a.png"/>
    </p>
    <pre><code class="prism language-handlebars"><span class="token number">3.</span><span class="token variable">将所有书的名称后面加上</span> <span class="token variable">劲爆</span> <span class="token variable">两个字</span> <span class="token variable">需要Concat函数</span> <span class="token variable">和</span> <span class="token variable">Value函数</span>
<span class="token variable">Concat用于字符串的拼接操作，参数位置决定了拼接是在头部拼接还是尾部拼接，Value里面是拼接的值</span>
<span class="token variable">from</span> <span class="token variable">django</span><span class="token punctuation">.</span><span class="token variable">db</span><span class="token punctuation">.</span><span class="token variable">models</span><span class="token punctuation">.</span><span class="token variable">functions</span> <span class="token variable">import</span> <span class="token variable">Concat</span>
<span class="token variable">from</span> <span class="token variable">django</span><span class="token punctuation">.</span><span class="token variable">db</span><span class="token punctuation">.</span><span class="token variable">models</span> <span class="token variable">import</span> <span class="token variable">Value</span> 
</code></pre>
    <pre><code class="prism language-python">    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> F
    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Value
    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models<span class="token punctuation">.</span>functions <span class="token keyword">import</span> Concat

    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>update<span class="token punctuation">(</span>title<span class="token operator">=</span>Concat<span class="token punctuation">(</span>F<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Value<span class="token punctuation">(</span><span class="token string">'劲爆'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220309230853175" src="https://i-blog.csdnimg.cn/blog_migrate/476ce75a80695c93f849af4e19060b9c.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 单行修改</span>
    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> F
    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Value
    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models<span class="token punctuation">.</span>functions <span class="token keyword">import</span> Concat

    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment"># 不跨表的话F查询可以不用(title=Concat('title'), Value('xx')))</span>
    book_obj<span class="token punctuation">.</span>update<span class="token punctuation">(</span>title<span class="token operator">=</span>Concat<span class="token punctuation">(</span>F<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Value<span class="token punctuation">(</span><span class="token string">'xx'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 不 需要.save()</span>
</code></pre>
    <p>
     <img alt="image-20220309235711399" src="https://i-blog.csdnimg.cn/blog_migrate/d46a6130fb39b821c891015c653b9b9b.png"/>
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 如果要修改char字段不能使用 + </span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>update<span class="token punctuation">(</span>title<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'劲爆'</span><span class="token punctuation">)</span>  
</code></pre>
    <p>
     <img alt="image-20220309231341694" src="https://i-blog.csdnimg.cn/blog_migrate/994c981d691906dfbddc7af6976c4a2c.png"/>
    </p>
    <pre><code class="prism language-handlebars"><span class="token variable">删除后缀还不知道</span><span class="token punctuation">,</span><span class="token variable">先手改吧</span><span class="token punctuation">.</span>
</code></pre>
    <h4>
     <a id="11_Q_2064">
     </a>
     11. Q查询
    </h4>
    <pre><code class="prism language-handlebars"><span class="token variable">from</span> <span class="token variable">django</span><span class="token punctuation">.</span><span class="token variable">db</span><span class="token punctuation">.</span><span class="token variable">models</span> <span class="token variable">import</span> <span class="token variable">Q</span>
<span class="token variable">在filter（）括号中默认是and关系。</span>
<span class="token variable">导入Q模块之后可以使用</span><span class="token punctuation">|</span><span class="token punctuation">(</span><span class="token variable">or</span> <span class="token variable">运输算法</span><span class="token punctuation">)</span> <span class="token variable">和</span> <span class="token punctuation">~</span><span class="token variable">（not</span> <span class="token variable">运算符）</span>
</code></pre>
    <pre><code class="prism language-handlebars"> <span class="token number">1.</span><span class="token variable">查看卖出数大于</span><span class="token number">100</span><span class="token variable">或者价格小于</span><span class="token number">200</span><span class="token variable">的书籍</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Q

    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>Q<span class="token punctuation">(</span>stock__gt<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">|</span> Q<span class="token punctuation">(</span>price__lt<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token punctuation">&lt;</span><span class="token variable">QuerySet</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'开局签到荒古圣体xx'</span><span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">:</span> <span class="token variable">Decimal</span><span class="token punctuation">(</span><span class="token string">'150.00'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'重生之都市仙尊'</span><span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">:</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">:</span> <span class="token variable">Decimal</span><span class="token punctuation">(</span><span class="token string">'350.00'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'穿越诸天万界'</span><span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">:</span> <span class="token variable">Decimal</span><span class="token punctuation">(</span><span class="token string">'450.00'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">写成一个模板使用</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Q

    q <span class="token operator">=</span> Q<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>  <span class="token comment"># (AND: )</span>
    q<span class="token punctuation">.</span>connector <span class="token operator">=</span> <span class="token string">'or'</span>  <span class="token comment"># 修改为or</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>  <span class="token comment"># (or: )</span>

    q<span class="token punctuation">.</span>children<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'stock__gt'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>  <span class="token comment"># (or: ('stock__gt', 100))</span>
    q<span class="token punctuation">.</span>children<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'price__lt'</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>  <span class="token comment"># (or: ('stock__gt', 100), ('price__lt', 200))</span>

    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">QuerySet</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'开局签到荒古圣体xx'</span><span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">:</span> <span class="token variable">Decimal</span><span class="token punctuation">(</span><span class="token string">'150.00'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'重生之都市仙尊'</span><span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">:</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">:</span> <span class="token variable">Decimal</span><span class="token punctuation">(</span><span class="token string">'350.00'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'穿越诸天万界'</span><span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">:</span> <span class="token variable">Decimal</span><span class="token punctuation">(</span><span class="token string">'450.00'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span>
</code></pre>
    <h4>
     <a id="12_Django_2112">
     </a>
     12. Django中开启事务
    </h4>
    <pre><code class="prism language-handlebars"><span class="token variable">事务四个特性：</span>
<span class="token variable">ACID</span>
<span class="token variable">原子性：不可分割的最新单位。</span>
<span class="token variable">一致性：更原子性是相辅相成的。</span>
<span class="token variable">隔离性：事务之间互相不干扰。</span>
<span class="token variable">持久性：事务一旦确认永久生效。</span>

<span class="token variable">事务的回滚：rellback</span>
<span class="token variable">事务的确认：commit</span>
</code></pre>
    <p>
     <img alt="image-20220310004342614" src="https://i-blog.csdnimg.cn/blog_migrate/4f856c2bc5f1d6bf3e681eb99e7a5806.png"/>
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 开启事务</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> transaction
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> transaction<span class="token punctuation">.</span>atomic<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># sql 语句</span>
    <span class="token comment"># 在with代码块内书写的所有orm操作都是属于同一个事务</span>
    <span class="token keyword">pass</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="13_ORM__2140">
     </a>
     13. ORM 字段&amp;参数
    </h4>
    <h5>
     <a id="131__2142">
     </a>
     13.1 内置字段
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">verbose_name</span> <span class="token variable">字段注释</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">AutoField</span> <span class="token variable">自增</span>
	<span class="token variable">主键字段</span> <span class="token variable">必须设置</span> <span class="token variable">primary_key</span> <span class="token punctuation">=</span> <span class="token variable">True</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">null</span>  <span class="token variable">字段可以为</span> <span class="token variable">空</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">IntegerField</span>     <span class="token variable">int整型</span>
<span class="token variable">BigInegerField</span>   <span class="token variable">bigint</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">DecimalField</span>           <span class="token variable">十进制字段</span> 
	<span class="token variable">max_digits</span><span class="token punctuation">=</span><span class="token number">8</span>       <span class="token variable">共</span><span class="token number">8</span><span class="token variable">位</span>
	<span class="token variable">decimal_places</span><span class="token punctuation">=</span><span class="token number">2</span>   <span class="token variable">小数部分</span><span class="token number">2</span><span class="token variable">位</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">CharField</span> <span class="token variable">字符</span> <span class="token variable">--</span><span class="token punctuation">&gt;</span>　<span class="token variable">对应数据库中的varchar</span>
	<span class="token variable">max_length</span> <span class="token variable">长度</span> <span class="token variable">必须设置</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">EmailFiled</span>  <span class="token variable">--</span><span class="token punctuation">&gt;</span> <span class="token variable">varchar</span><span class="token punctuation">(</span><span class="token number">254</span><span class="token punctuation">)</span> <span class="token variable">邮件</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">DateFiled</span>       <span class="token variable">日期格式</span>
	<span class="token variable">date</span>
<span class="token variable">DateTimeFiled</span>
	<span class="token variable">auto_now</span><span class="token punctuation">:</span>    <span class="token variable">auto_now</span><span class="token punctuation">=</span><span class="token variable">True每次修改数据的时候都会自动跟新当前时间。</span>
	<span class="token variable">auto_now_add</span><span class="token punctuation">:</span> <span class="token variable">auto_now_add</span><span class="token punctuation">=</span><span class="token variable">True之在创建数据的时候记录创建的时候</span><span class="token punctuation">,</span><span class="token variable">后续不会自动更改。</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">BooleanField</span>   <span class="token variable">布尔值</span>
<span class="token variable">该字段存布尔值（False</span><span class="token punctuation">/</span><span class="token variable">True）</span> <span class="token variable">数据库中存</span><span class="token number">0</span><span class="token punctuation">/</span><span class="token number">1</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">TextField</span>   <span class="token variable">文本类型</span>  
	<span class="token variable">存大段文本内容</span><span class="token punctuation">,</span><span class="token variable">没有字数限制</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">FileField</span>
	<span class="token variable">upload</span> <span class="token punctuation">=</span> <span class="token string">'/date一个路径'</span>
	<span class="token variable">该字段传一个文件对象</span><span class="token punctuation">,</span><span class="token variable">会自动将文件保存到</span><span class="token punctuation">/</span><span class="token variable">date目录下然后将文件路径保存到数据库中</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">ForeignKey</span><span class="token punctuation">(</span><span class="token variable">unique</span><span class="token punctuation">=</span><span class="token variable">True</span><span class="token punctuation">)</span> <span class="token variable">等价于</span> <span class="token variable">OneToOneField</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token variable">一对多</span>  <span class="token variable">与</span> <span class="token variable">一对一的区别就在与unique</span><span class="token punctuation">=</span><span class="token variable">True</span>
<span class="token variable">使用ForeignKey</span><span class="token punctuation">(</span><span class="token variable">unique</span><span class="token punctuation">=</span><span class="token variable">True</span><span class="token punctuation">)</span><span class="token variable">创建一对一是可以的但是不推荐这样去使用</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">to</span> <span class="token variable">设置要关联的表</span>
<span class="token variable">to_field</span> <span class="token variable">设置要关联的字段</span> <span class="token variable">不写默认为主键字段</span><span class="token punctuation">,</span><span class="token variable">一般不写</span><span class="token punctuation">.</span>

<span class="token variable">on_delere</span> <span class="token variable">当删除表中的数据时</span><span class="token punctuation">,</span><span class="token variable">当前表与起关联的行的行为。</span>
<span class="token variable">django2</span><span class="token punctuation">.</span><span class="token variable">x以上版本需要自己指定外键字段的级联更新级联删除。</span>
</code></pre>
    <h5>
     <a id="132__2215">
     </a>
     13.2 自定义字段
    </h5>
    <pre><code class="prism language-python"><span class="token comment"># app 应用下的 models.py </span>
<span class="token keyword">class</span> <span class="token class-name">MyCharField</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Field<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> max_length<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>max_length<span class="token operator">=</span> max_length<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">db_type</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 返回字段和约束</span>
        <span class="token keyword">return</span> <span class="token string">'char(%s)'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>max_length
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># tests.py中使用</span>
    my_char <span class="token operator">=</span> models<span class="token punctuation">.</span>MyCharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'自定义的字段'</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220310012253527" src="https://i-blog.csdnimg.cn/blog_migrate/3b2e055a068b30c6b1fe267e60ab1ed9.png"/>
    </p>
    <p>
     <img alt="image-20220310012405823" src="https://i-blog.csdnimg.cn/blog_migrate/00b0e3972742ca9f8580acd8d2608f65.png"/>
    </p>
    <h5>
     <a id="132_choices_2236">
     </a>
     13.2 choices参数
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">存储一个可枚举的字段。</span>
<span class="token variable">xx字段</span> <span class="token punctuation">=</span> <span class="token variable">models</span><span class="token punctuation">.</span><span class="token variable">InergerField</span><span class="token punctuation">(</span><span class="token variable">choice</span><span class="token punctuation">=</span><span class="token variable">一个列表或元组</span><span class="token punctuation">)</span>
<span class="token variable">字段存储的是Integer类型</span><span class="token punctuation">,</span><span class="token variable">但是可以通过数字获取对应的真正信息</span><span class="token punctuation">.</span>
<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">其中元素的值相对应</span>
<span class="token variable">保证字段类型跟列举出来的元组的第一个数据类型一致即可</span>

<span class="token variable">使用choices</span> <span class="token variable">参数的字段取值的对应信息</span> <span class="token variable">搭配固定的语法</span> <span class="token variable">get_字段名_display</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token variable">如果没有对应关系，直接展示字段的值。</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token comment"># 5. 用户表2</span>
<span class="token keyword">class</span> <span class="token class-name">UserTwo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. id字段自动增加</span>
    <span class="token comment"># 2. 用户名</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'用户名'</span><span class="token punctuation">)</span>
    <span class="token comment"># 3. 年龄</span>
    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">'年龄'</span><span class="token punctuation">)</span>
    <span class="token comment"># 4. 性别列举信息</span>
    gender_tuple <span class="token operator">=</span> <span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'保密'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># 5. 性别字段</span>
    gender <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>choices<span class="token operator">=</span>gender_tuple<span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'性别'</span><span class="token punctuation">)</span>

    <span class="token comment"># 6. 成绩列表  有对应关系   没有对应关系</span>
    score_tuple <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'优秀'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 7. 成绩字段</span>
    score <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>choices<span class="token operator">=</span>score_tuple<span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'成绩'</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">执行数据库迁移命令。</span>
</code></pre>
    <p>
     <img alt="image-20220312224136424" src="https://i-blog.csdnimg.cn/blog_migrate/e0f89b897ca15ad3db2f6d9880aa752c.png"/>
    </p>
    <pre><code class="prism language-python">	<span class="token comment"># app01应用下tests.py </span>
	<span class="token comment"># 增加数据</span>
    models<span class="token punctuation">.</span>User2<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'kid1'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> gender<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> score<span class="token operator">=</span><span class="token string">'A'</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>User2<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'kid2'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">19</span><span class="token punctuation">,</span> gender<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> score<span class="token operator">=</span><span class="token string">'B'</span><span class="token punctuation">)</span>
    <span class="token comment"># 存一个不存在的                                   5不存在对应的数据</span>
    models<span class="token punctuation">.</span>User2<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'kid1'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> gender<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> score<span class="token operator">=</span><span class="token string">'A'</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-python">	<span class="token comment"># app01下 tests.py 中查看值</span>
	user2_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User2<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> obj <span class="token keyword">in</span> user2_obj<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>get_gender_display<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>get_score_display<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">男</span> <span class="token variable">优秀</span>
<span class="token variable">女</span> <span class="token variable">None</span>
<span class="token number">5</span> <span class="token variable">优秀</span> 
<span class="token variable">↑</span> <span class="token number">5</span><span class="token variable">没有对应的值</span><span class="token punctuation">,</span><span class="token variable">就直接显示</span><span class="token number">5</span>
</code></pre>
    <h4>
     <a id="14__2302">
     </a>
     14. 多对多创建方式
    </h4>
    <h5>
     <a id="141__2304">
     </a>
     14.1 全自动
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">orm自动创建第三张表</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
    author <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Author'</span><span class="token punctuation">)</span>
    
<span class="token keyword">class</span> <span class="token class-name">Author</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">优点：自动，支持orm操作第三表的方法，add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">···正方向查询···</span>
<span class="token variable">缺点：第三张拓展性差，没法添加额外的字段。</span>
</code></pre>
    <h5>
     <a id="142__2324">
     </a>
     14.2 纯手动
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">几乎不会去使用</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Author</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>

    <span class="token comment"># 手动创建第三张表</span>
<span class="token keyword">class</span> <span class="token class-name">BookToAuthor</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    book_id <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Book'</span><span class="token punctuation">)</span>
    author_id <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Author'</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">优点：第三表完全可以自己拓展。</span>
<span class="token variable">缺点：add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">···正方向查询···不能用。</span>
</code></pre>
    <h5>
     <a id="143__2348">
     </a>
     14.3 半自动
    </h5>
    <pre><code class="prism language-handlebars"><span class="token number">0.</span> <span class="token variable">写法与全自动一样</span><span class="token punctuation">,</span><span class="token variable">不需要ORM自动创建第三张表</span><span class="token punctuation">,</span><span class="token variable">而是自己创建</span><span class="token punctuation">.</span>
<span class="token number">1.</span> <span class="token variable">through指定第三张表的名字</span><span class="token punctuation">,</span><span class="token variable">through_fields指定关联的字端</span><span class="token punctuation">.</span><span class="token variable">经过这一步之后可以使用正方向查询</span><span class="token punctuation">.</span>
<span class="token number">2.</span> <span class="token variable">through_fields的第一个参数</span><span class="token punctuation">,</span><span class="token variable">写当前表的表名</span><span class="token punctuation">,</span><span class="token variable">会自动加_id</span><span class="token punctuation">.</span>
<span class="token punctuation">*</span> <span class="token variable">第三张表的字段是普通的字段</span><span class="token punctuation">,</span><span class="token variable">直接操作第三张</span><span class="token punctuation">.</span><span class="token variable">字段</span> <span class="token variable">无法到另一张表中去</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token comment"># 6.书籍表</span>
<span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 6.1 id 字段自动增加</span>
    <span class="token comment"># 6.2 书名</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
    <span class="token comment"># 6.3 虚拟字段                   多对多 作者表</span>
    author <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Author'</span><span class="token punctuation">,</span>
                                    <span class="token comment"># 指定第三张表</span>
                                    through<span class="token operator">=</span><span class="token string">'BookToAuthor'</span><span class="token punctuation">,</span>
                                    <span class="token comment"># 表中关联的字段  _id自动添加</span>
                                    through_fields<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'book'</span><span class="token punctuation">,</span> <span class="token string">'author'</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">)</span>


<span class="token comment"># 7.作者表</span>
<span class="token keyword">class</span> <span class="token class-name">Author</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 7.1 id字段自动添加</span>
    <span class="token comment"># 7.2 姓名</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>


<span class="token comment"># 8 第三张表 分别一对多书籍表与作者表</span>
<span class="token keyword">class</span> <span class="token class-name">BookToAuthor</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 8.1 id字段自动增加</span>
    <span class="token comment"># 8.2 图数的id   _id自动加的</span>
    book <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Book'</span><span class="token punctuation">)</span>
    <span class="token comment"># 8.3 作者id    _id自动增加</span>
    author <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Author'</span><span class="token punctuation">)</span>
    <span class="token comment"># 8.4 绑定时间  半自动的意义 可以拓展 其他字段</span>
    binding_time <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 写入数据的时间自动获取当前时间</span>
</code></pre>
    <p>
     <img alt="image-20220313024124846" src="https://i-blog.csdnimg.cn/blog_migrate/a39fecaa78a9df88fdd6c6950909672f.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># app01应用下 tests.py</span>
    <span class="token comment"># 为书籍表添加数据</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'Python'</span><span class="token punctuation">)</span>

    <span class="token comment"># 为作者添加数据</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'kid'</span><span class="token punctuation">)</span>

    <span class="token comment"># 为第三张表添加数据</span>
    models<span class="token punctuation">.</span>BookToAuthor<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>book_id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> author_id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220313024617264" src="https://i-blog.csdnimg.cn/blog_migrate/a63fde23099af1d51e8e658a0b90a268.png"/>
    </p>
    <pre><code class="prism language-handlebars"><span class="token variable">可是使用</span> <span class="token variable">正方向查询，不能使用：add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">···</span>
<span class="token variable">拓展性高</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">为每个表添加__str__</span> <span class="token variable">方法在打印对象时触发</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token comment"># 6.书籍表</span>
<span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 6.1 id 字段自动增加</span>
    <span class="token comment"># 6.2 书名</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
    <span class="token comment"># 6.3 外键字段                   多对多 作者表</span>
    author <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Author'</span><span class="token punctuation">,</span>
                                    <span class="token comment"># 指定第三张表</span>
                                    through<span class="token operator">=</span><span class="token string">'BookToAuthor'</span><span class="token punctuation">,</span>
                                    <span class="token comment"># 表在关联的字段</span>
                                    through_fields<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'book'</span><span class="token punctuation">,</span> <span class="token string">'author'</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">)</span>

    <span class="token comment"># 6.4 打印对象时自动触发</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>pk<span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>title<span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>author<span class="token punctuation">}</span></span><span class="token string">'</span></span>

    <span class="token comment"># 7.作者表</span>


<span class="token keyword">class</span> <span class="token class-name">Author</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 7.1 id字段自动添加</span>
    <span class="token comment"># 7.2 姓名</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>

    <span class="token comment"># 7.3 打印对象时自动触发</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>pk<span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">'</span></span>


<span class="token comment"># 8 第三张表 分别一对多书籍表与作者表</span>
<span class="token keyword">class</span> <span class="token class-name">BookToAuthor</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 8.1 id字段自动增加</span>
    <span class="token comment"># 8.2 图数的id   _id自动加的</span>
    book <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Book'</span><span class="token punctuation">)</span>
    <span class="token comment"># 8.3 作者id    _id自动增加</span>
    author <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Author'</span><span class="token punctuation">)</span>
    <span class="token comment"># 8.4 绑定时间  半自动的意义 可以拓展 其他字段</span>
    binding_time <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 写入数据的时间自动获取当前时间</span>

    <span class="token comment"># 8.4 打印对象时自动触发</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>pk<span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>book_id<span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>author_id<span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>binding_time<span class="token punctuation">}</span></span><span class="token string">'</span></span>

</code></pre>
    <p>
     <img alt="image-20220313033138010" src="https://i-blog.csdnimg.cn/blog_migrate/ecdc05e8dae7255288cee0868f5c469f.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token comment"># 正向查询</span>
    <span class="token comment"># 获取书籍数据对象</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>author<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [&lt;Author: 1 kid&gt;]&gt;</span>

    <span class="token comment"># 反向到 第三张表</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>booktoauthor_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [&lt;BookToAuthor: 1 1 1 2022-03-13 02:45:20.064068&gt;]&gt;</span>

    <span class="token comment"># 反向查询</span>
    <span class="token comment"># 获取作者数据对象</span>
    author_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_obj<span class="token punctuation">.</span>book_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [&lt;Book: 1 Python app01.Author.None&gt;]&gt;</span>

    <span class="token comment"># 反向到第三张表</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_obj<span class="token punctuation">.</span>booktoauthor_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [&lt;BookToAuthor: 1 1 1 2022-03-13 02:45:20.064068&gt;]&gt;</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># 获取第三张的queryset对象</span>
    book_author_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>BookToAuthor<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_author_obj<span class="token punctuation">)</span>
    <span class="token comment"># queryset对象.values('外键__字段')</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_author_obj<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'book_id__pk'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 数据对象</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_author_obj<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 1 1 1 2022-03-13 02:45:20.064068</span>
    <span class="token comment"># 数据对象.字段  获取外键指定的数据对象 book_id现在获取的是一个值,那它就不是外键,是一个普通的字段</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_author_obj<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>book_id<span class="token punctuation">)</span>  <span class="token comment"># 1</span>

</code></pre>
    <h4>
     <a id="15__2498">
     </a>
     15. 数据库的查询优化
    </h4>
    <pre><code class="prism language-handlebars"><span class="token variable">研究对象查询数据的时候</span><span class="token punctuation">,</span><span class="token variable">还需不需要走数据库去查询</span><span class="token punctuation">.</span>
<span class="token variable">优化</span><span class="token punctuation">:</span> <span class="token variable">走的少</span><span class="token punctuation">,</span><span class="token variable">或者不走</span><span class="token punctuation">,</span><span class="token variable">数据库</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">将应用下的models</span><span class="token punctuation">.</span><span class="token variable">py</span> <span class="token variable">中</span> <span class="token variable">book类的__str__</span> <span class="token variable">方法注释</span><span class="token punctuation">.</span>
</code></pre>
    <p>
     <img alt="image-20220310022053422" src="https://i-blog.csdnimg.cn/blog_migrate/6642bc5cc9f4decc3a9c3f3ca1a606cb.png"/>
    </p>
    <h5>
     <a id="151__2511">
     </a>
     15.1 惰性查询
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">orm语句的特点：</span>
<span class="token variable">惰性查询：</span>
	<span class="token variable">仅仅只是书写orm语句</span><span class="token punctuation">,</span><span class="token variable">后面根本没有使用到该语句查询出来的参数</span><span class="token punctuation">,</span>
	<span class="token variable">那么orm会自动识别到</span><span class="token punctuation">,</span><span class="token variable">不用就直接不执行。</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># 在设置中打开打开LOGGING现在SQL语句</span>
    boolk_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   
    <span class="token comment"># 没有没有使用res 直接不执行,终端都不打印sql语句。</span>
</code></pre>
    <p>
     <img alt="image-20220310012733803" src="https://i-blog.csdnimg.cn/blog_migrate/00445eda5d397317659157fd65d45d95.png"/>
    </p>
    <pre><code class="prism language-python">    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">)</span>
    <span class="token comment"># 使用数据 才执行。终端都打印sql语句。</span>
</code></pre>
    <p>
     <img alt="image-20220310012821858" src="https://i-blog.csdnimg.cn/blog_migrate/5789eb0f7cea22b5d7ec1b689776e563.png"/>
    </p>
    <h5>
     <a id="152_only_2536">
     </a>
     15.2 only
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token variable">拿表中所有的数据</span>
<span class="token variable">only</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token variable">拿指定字段的数据</span>
</code></pre>
    <pre><code class="prism language-python">    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">)</span>
    <span class="token keyword">for</span> obj <span class="token keyword">in</span> book_obj<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
        
    <span class="token keyword">for</span> obj <span class="token keyword">in</span> book_obj<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>price<span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220310020949464" src="https://i-blog.csdnimg.cn/blog_migrate/850169a4ee339b4281ca3cb51c919e92.png"/>
    </p>
    <pre><code class="prism language-python">    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">)</span>
    <span class="token keyword">for</span> obj <span class="token keyword">in</span> book_obj<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220310021323167" src="https://i-blog.csdnimg.cn/blog_migrate/9970a1592ad38559e601511f8087d594.png"/>
    </p>
    <pre><code class="prism language-python">    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>only<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">)</span>
    <span class="token keyword">for</span> obj <span class="token keyword">in</span> book_obj<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220310021820466" src="https://i-blog.csdnimg.cn/blog_migrate/5cbfdaa0692fc25039050f124d527a9e.png"/>
    </p>
    <pre><code class="prism language-python">    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>only<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220310021952701" src="https://i-blog.csdnimg.cn/blog_migrate/f28e19b3f875391adcf900f302f8698d.png"/>
    </p>
    <h5>
     <a id="153_defer_2581">
     </a>
     15.3 defer
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">defer与only相反</span>
<span class="token variable">defer查询指定字段外的字段</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-python">    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>defer<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token keyword">for</span> obj <span class="token keyword">in</span> book_obj<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">查询没有被查出来的字段需要重新走数据库</span>
</code></pre>
    <p>
     <img alt="image-20220310014903059" src="https://i-blog.csdnimg.cn/blog_migrate/6df0095d315a39498100761b8532d9ea.png"/>
    </p>
    <pre><code class="prism language-python">    <span class="token keyword">for</span> obj <span class="token keyword">in</span> book_obj<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>price<span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">而查询查出来的的字段则不需要走数据库。</span>
</code></pre>
    <p>
     <img alt="image-20220310015029326" src="https://i-blog.csdnimg.cn/blog_migrate/35a577b9fe9096728e454657659691c2.png"/>
    </p>
    <h5>
     <a id="154_select_related_2614">
     </a>
     15.4 select_related
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">联表查询</span>
<span class="token variable">select_related内部直接先将关联表与被关联表连接起来</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token variable">拼表操作</span><span class="token punctuation">)</span>
<span class="token variable">select_related</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token variable">括号内只能放</span> <span class="token variable">一对多</span>  <span class="token variable">一对一</span> <span class="token variable">外键字段</span> <span class="token variable">。</span>

<span class="token variable">拼接后的表中所有数据全部封装给查询出来的对象。</span>

<span class="token variable">这个时候对象无论点击关联表的数据还是被关联表的数据都无需在走数据库查询。</span>
</code></pre>
    <pre><code class="prism language-handlebars"><span class="token variable">给了多对多的虚拟字段会报错</span>
<span class="token variable">django</span><span class="token punctuation">.</span><span class="token variable">core</span><span class="token punctuation">.</span><span class="token variable">exceptions</span><span class="token punctuation">.</span><span class="token variable">FieldError：select_related</span> <span class="token variable">中给出的字段名称无效</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># book 表拼接 通过外键 拼接 出版社表</span>
    book_publish_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token string">'publish'</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> obj <span class="token keyword">in</span> book_publish_obj<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>title<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>price<span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220310015743880" src="https://i-blog.csdnimg.cn/blog_migrate/c946e7944ea957e8e2dbb1126ef43688.png"/>
    </p>
    <h5>
     <a id="155_prefetch_related_2640">
     </a>
     15.5 prefetch_related
    </h5>
    <pre><code class="prism language-handlebars"><span class="token variable">子查询</span>
<span class="token variable">将子查询出来的所有结果封装到对象中</span><span class="token punctuation">.</span>
</code></pre>
    <pre><code class="prism language-python">    <span class="token comment"># book 表拼接 通过外键 拼接 出版社表</span>
    book_publish_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>prefetch_related<span class="token punctuation">(</span><span class="token string">'publish'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> obj <span class="token keyword">in</span> book_publish_obj<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>title<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>price<span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220310020140346" src="https://i-blog.csdnimg.cn/blog_migrate/0374a4a1bfc5131e772c661fe0ed20b8.png"/>
    </p>
    <pre><code class="prism language-handlebars"><span class="token variable">select_related</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token variable">只能为一对一</span> <span class="token variable">和</span> <span class="token variable">一对多</span> <span class="token variable">使用</span>
<span class="token variable">多对多使用</span><span class="token punctuation">,</span><span class="token variable">拼接虚拟表没有数据</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token variable">Book类中的__str__方法打开</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20220310135155086" src="https://i-blog.csdnimg.cn/blog_migrate/734b343bf4be76914751f5a8391b629b.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34363133373332342f:61727469636c652f64657461696c732f313233343030333237" class_="artid" style="display:none">
 </p>
</div>


