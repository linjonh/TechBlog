---
layout: post
title: "微信小程序-音频播放-wx.createInnerAudioContext-每次都是重复播放同一条录音"
date: 2025-01-14 12:07:59 +0800
description: "转载于https://blog.csdn.net/a600849155/article/detail"
keywords: "小程序 inneraudiocontext src重复设置"
categories: ['Html']
tags: ['无标签']
artid: "82919360"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=82919360
    alt: "微信小程序-音频播放-wx.createInnerAudioContext-每次都是重复播放同一条录音"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微信小程序-音频播放-wx.createInnerAudioContext() 每次都是重复播放同一条录音
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <blockquote>
     <p>
      <span style="color:#f33b45;">
       每个项目产品都会让你加埋点，你是愿意花几天一个个加，还是愿意几分钟一个小时加完去喝茶聊天？来试试这520web工具, 高效加埋点，目前我们公司100号前端都在用，因为很好用，所以很自然普及开来了，推荐给大家吧
      </span>
     </p>
     <p>
      <a href="http://www.520webtool.com/" rel="nofollow">
       http://www.520webtool.com/
      </a>
     </p>
     <p>
      自己开发所以免费，埋点越多越能节约时间，点两下埋点就加上了，还不会犯错，里面有使用视频，反正免费 😄
     </p>
     <p>
      <a href="http://www.520webtool.com/" rel="nofollow">
       http://www.520qiubite.com
      </a>
     </p>
    </blockquote>
    <h3>
     转载于
     <a href="https://blog.csdn.net/a600849155/article/details/81356576">
      https://blog.csdn.net/a600849155/article/details/81356576
     </a>
    </h3>
    <h3>
     前言
    </h3>
    <p>
     在调试微信小程序音频播放时，刚开始我也是直接复制官方文档的实例：
    </p>
    <pre><code class="language-html hljs"> </code></pre>
    <ol>
     <li>
      <p>
       <code>
        const innerAudioContext = wx.createInnerAudioContext()
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.autoplay = true
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.src = 'http://ws.stream.qqmusic.qq.com/M500001VfvsJ21xFqb.mp3?guid=ffffffff82def4af4b12b3cd9337d5e7&amp;uin=346897220&amp;vkey=6292F51E1E384E061FF02C31F716658E5C81F5594D561F2E88B854E81CAAB7806D5E4F103E55D33C16F3FAC506D1AB172DE8600B37E43FAD&amp;fromtag=46'
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.onPlay(() =&gt; {
        <!-- -->
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        console.log('开始播放')
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        })
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.onError((res) =&gt; {
        <!-- -->
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        console.log(res.errMsg)
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        console.log(res.errCode)
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        })
       </code>
      </p>
     </li>
    </ol>
    <p>
     然而此时就出现了，无论按多少下都是重复播放同一条语音的情况！
    </p>
    <p>
     从
     <a href="https://blog.csdn.net/qq_39364032/article/details/79742120">
      https://blog.csdn.net/qq_39364032/article/details/79742120
     </a>
     得知，wx.createInnerAudioContext()这个api新建了一个实例之后，需要销毁实例，才能重新new一个实例。所以，我做了以下改动：
    </p>
    <pre><code class="language-html hljs"> </code></pre>
    <ol>
     <li>
      <p>
       <code>
        const innerAudioContext = wx.createInnerAudioContext()
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.autoplay = true
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.src = res.tempFilePath
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.onPlay(() =&gt; {
        <!-- -->
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        console.log('开始播放')
       </code>
      </p>
     </li>
     <li>
     </li>
     <li>
      <p>
       <code>
        })
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.onStop(() =&gt; {
        <!-- -->
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        console.log('i am onStop')
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.stop()
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        //播放停止，销毁该实例
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.destroy()
       </code>
      </p>
     </li>
     <li>
     </li>
     <li>
      <p>
       <code>
        })
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.onEnded(() =&gt; {
        <!-- -->
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        console.log('i am onEnded')
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        //播放结束，销毁该实例
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.destroy()
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        console.log('已执行destory()')
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        })
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.onError((res) =&gt; {
        <!-- -->
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        console.log(res.errMsg)
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        console.log(res.errCode)
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.destroy()
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        })
       </code>
      </p>
     </li>
    </ol>
    <h3>
     <a name="t1">
     </a>
     最终解决方案
    </h3>
    <p>
     然而！无论我执行多少次，还是播放第一条语音！从我的后台来看，每次返回的语音文件都是不同的，甚至我把服务器上的文件下载到本地，也是不同的！于是我就怀疑它下载过一次这个地址就不再下载了。所以我又换一种写法，在上面加上wx.downloadFile这个api。
    </p>
    <pre><code class="language-html hljs"> </code></pre>
    <ol>
     <li>
      <p>
       <code>
        wx.downloadFile({
        <!-- -->
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        url: 'http://47.106.74.22:8081/voice/download_audio', //仅为示例，并非真实的资源
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        success: function (res) {
        <!-- -->
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        // 只要服务器有响应数据，就会把响应内容写入文件并进入 success 回调，业务需要自行判断是否下载到了想要的内容
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        if (res.statusCode === 200) {
        <!-- -->
       </code>
      </p>
     </li>
     <li>
     </li>
     <li>
      <p>
       <code>
        const innerAudioContext = wx.createInnerAudioContext()
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.autoplay = true
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.src = res.tempFilePath
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.onPlay(() =&gt; {
        <!-- -->
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        console.log('开始播放')
       </code>
      </p>
     </li>
     <li>
     </li>
     <li>
      <p>
       <code>
        })
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.onStop(() =&gt; {
        <!-- -->
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        console.log('i am onStop')
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.stop()
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        //播放停止，销毁该实例
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.destroy()
       </code>
      </p>
     </li>
     <li>
     </li>
     <li>
      <p>
       <code>
        })
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.onEnded(() =&gt; {
        <!-- -->
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        console.log('i am onEnded')
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        //播放结束，销毁该实例
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.destroy()
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        console.log('已执行destory()')
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        })
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.onError((res) =&gt; {
        <!-- -->
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        console.log(res.errMsg)
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        console.log(res.errCode)
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        innerAudioContext.destroy()
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        })
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        }
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        }
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        })
       </code>
      </p>
     </li>
    </ol>
    <p>
     到这里，终于解决这个问题
    </p>
    <p>
     注意的是，wx.createInnerAudioContext()无法播放wav文件，于是这里我用的是MP3文件。而wx.playVoice(OBJECT)也无法播放mp3文件。
    </p>
    <p>
     --------------------- 本文来自 Himhin 的CSDN 博客 ，全文地址请点击：https://blog.csdn.net/a600849155/article/details/81356576?utm_source=copy
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f73643139383731313232:2f61727469636c652f64657461696c732f3832393139333630" class_="artid" style="display:none">
 </p>
</div>


