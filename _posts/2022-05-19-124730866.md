---
layout: post
title: "数据库实验九-OpenGauss使用JDBC连接数据库"
date: 2022-05-19 15:08:27 +0800
description: "这篇博客介绍了如何使用JDBC连接openGauss数据库，包括创建数据库和表、配置客户端接入认证、"
keywords: "数据库实验九--OpenGauss（使用JDBC连接数据库)"
categories: ['数据库']
tags: ['数据库', 'Postgresql', 'Java']
artid: "124730866"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=124730866
    alt: "数据库实验九-OpenGauss使用JDBC连接数据库"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     数据库实验九--OpenGauss（使用JDBC连接数据库)
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-dracula" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     实验要求
    </h2>
    <p>
     了解如何使用JDBC连接数据库。JDBC（Java Database Connectivity，Java数据库连接）是一种用于执行SQL语句的Java API，可以为多种关系数据库提供统一访问接口，应用程序可基于它操作数据。openGauss库提供了对JDBC 4.0特性的支持，需要使用JDK1.8版本编译程序代码。
     <br/>
     完成以下内容：
    </p>
    <ol>
     <li>
      在openGauss中创建数据库、表；
     </li>
     <li>
      使用jdbc连接到新创建的数据库；
     </li>
     <li>
      在java程序中改变数据库中的值或者输出数据库中的值；
     </li>
     <li>
      请参考华为提供的实验手册：openGauss场景化综合应用实验。
     </li>
    </ol>
    <h2>
     <a id="JDBC_7">
     </a>
     使用JDBC连接数据库
    </h2>
    <p>
     在OpenGauss中创建数据库、表请参考之前的实验。
    </p>
    <p>
     本实验选用JDBC为1.1.0版本
    </p>
    <p>
     解压后，把
     <code>
      postgresql.jar
     </code>
     导入到我们要编写的java项目里。（
     <code>
      ctrl+alt+shift+s
     </code>
     导入jar包）
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2fc81987f5e3569556905f69a346233b.png">
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/87f7322032063600e42bf3058fc56102.png">
       lib为在实验九项目下新建的目录，导入后完整项目结构如上图。
      </img>
     </img>
    </p>
    <p>
     注意：远程登录不允许使用omm用户
     <br/>
     我们需要重新新建一个用户。同时需要授予新用户权限：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ab18d615e66a3f84bda1eb0cda5e083a.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0e395d0dd8751186374f4a70e032a60f.png">
       <br/>
       接着我们要配置客户端接入认证，运行远程连接(这步要退出openGauss，在命令行执行)
       <br/>
       例如，下面示例中配置允许IP地址为10.10.0.30的客户端访问本机。
      </img>
     </img>
    </p>
    <pre><code class="prism language-sql">    gs_guc <span class="token keyword">set</span> <span class="token operator">-</span>N <span class="token keyword">all</span> <span class="token operator">-</span>I <span class="token keyword">all</span> <span class="token operator">-</span>h <span class="token string">"host all shiyanjiu 10.10.0.30/32 sha256"</span>
</code></pre>
    <p>
     本机ip是指物理机ip，在自己的windows上打开cmd输入
     <code>
      ipconfig
     </code>
     查看ipv4地址。这一步是为了让自己的物理机能够连接到虚拟机中的数据库。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5c1f9ffb5b948c474b3f124215e428a0.png"/>
    </p>
    <p>
     另外，我们还需修改
     <code>
      postgresql.conf
     </code>
     和
     <code>
      pg_hba.conf
     </code>
     文件。
    </p>
    <p>
     此文件位于
     <code>
      postgresql
     </code>
     数据文件目录中，默认为
     <code>
      /var/lib/pgsql/data/
     </code>
     。将
     <code>
      postgresql.conf
     </code>
     修改如下：
     <code>
      listen_addresses = '*'
     </code>
     。
    </p>
    <p>
     <code>
      pg_hba.conf
     </code>
     中增加需要连接该数据库主机的ip地址。如下所示，增加对主机
     <code>
      0.0.0.0
     </code>
     的信任。
    </p>
    <pre><code>host    all             all             0.0.0.0/0         sha256
</code></pre>
    <p>
     先使用find命令查找文件地址(不连接数据库，登陆root账户，并且用
     <code>
      cd /
     </code>
     返回根目录）
    </p>
    <pre><code class="prism language-shell"><span class="token function">find</span> -name postgresql.conf
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ca06c6440df8b31570cb4fa51f6fab20.png">
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4e8c814f94f62acbd94a985514c1d4b0.png">
       <br/>
       用vi修改：
      </img>
     </img>
    </p>
    <pre><code class="prism language-shell"><span class="token function">vi</span> postgresql.conf
</code></pre>
    <p>
     进入vi后先按i进入插入模式，找到
     <code>
      listen_addresses
     </code>
     ，修改
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4c13efb3373d60f5926610018f0e1154.png">
      <br/>
      按
      <code>
       esc
      </code>
      ，之后按
      <code>
       :wq
      </code>
      保存退出
     </img>
    </p>
    <p>
     这样第一个文件就修改完了。
     <br/>
     同样的方法修改第二个文件
     <code>
      pg_hba.conf
     </code>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/530472dd0f44fdca357426c3469722bb.png"/>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6b1a4e9a85ebd62c0209166a96285adc.png"/>
     <br/>
     运行java代码：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">opengauss</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> connectsql <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//以下代码将获取数据库连接操作封装为一个接口，可通过给定用户名和密码来连接数据库。</span>
    <span class="token keyword">public</span>  <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnect</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> passwd<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//驱动类。</span>
        <span class="token class-name">String</span> driver <span class="token operator">=</span> <span class="token string">"org.postgresql.Driver"</span><span class="token punctuation">;</span>
        <span class="token comment">//数据库连接描述符。</span>
        <span class="token class-name">String</span> sourceURL <span class="token operator">=</span> <span class="token string">"jdbc:postgresql://192.168.56.124:26000/postgres"</span><span class="token punctuation">;</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//加载驱动。</span>
            <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span><span class="token punctuation">(</span> <span class="token class-name">Exception</span> e <span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//创建连接。</span>
            conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>sourceURL<span class="token punctuation">,</span> username<span class="token punctuation">,</span> passwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Connection succeed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> conn<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// TODO 自动生成的方法存根</span>
        <span class="token keyword">new</span> <span class="token function">connectsql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connectsql<span class="token punctuation">.</span><span class="token function">getConnect</span><span class="token punctuation">(</span><span class="token string">"shiyanjiu"</span><span class="token punctuation">,</span><span class="token string">"openGauss@123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
    <p>
     连接成功
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7d936f3cc9f6953ad23ed120aa5a6254.png"/>
    </p>
    <h2>
     <a id="_116">
     </a>
     执行查询
    </h2>
    <p>
     我们现在来查询sc表，首先要把sc表的权限给
     <code>
      shiyanjiu
     </code>
     用户
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c983315dc97e987f0420a5ac49bfec7a.png"/>
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">PRIVILEGES</span> <span class="token keyword">ON</span> sc <span class="token keyword">TO</span> shiyanjiu<span class="token punctuation">;</span>
</code></pre>
    <p>
     之后修改java代码
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">opengauss</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> connectsql <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//以下代码将获取数据库连接操作封装为一个接口，可通过给定用户名和密码来连接数据库。</span>
    <span class="token keyword">public</span>  <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnect</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> passwd<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//驱动类。</span>
        <span class="token class-name">String</span> driver <span class="token operator">=</span> <span class="token string">"org.postgresql.Driver"</span><span class="token punctuation">;</span>
        <span class="token comment">//数据库连接描述符。</span>
        <span class="token class-name">String</span> sourceURL <span class="token operator">=</span> <span class="token string">"jdbc:postgresql://192.168.56.124:26000/db_cc"</span><span class="token punctuation">;</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//加载驱动。</span>
            <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span><span class="token punctuation">(</span> <span class="token class-name">Exception</span> e <span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//创建连接。</span>
            conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>sourceURL<span class="token punctuation">,</span> username<span class="token punctuation">,</span> passwd<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Statement</span> stmt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token comment">// 执行查询</span>
            stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> sql<span class="token punctuation">;</span>
            sql <span class="token operator">=</span> <span class="token string">"select * from SC;"</span><span class="token punctuation">;</span>
            <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 展开结果集数据库</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 通过字段检索</span>
                <span class="token class-name">String</span> sno <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"sno"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> cno <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"cno"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> grade <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"grade"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 输出数据</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"sno: "</span> <span class="token operator">+</span> sno<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"cno: "</span> <span class="token operator">+</span> cno<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"grade: "</span> <span class="token operator">+</span> grade<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 完成后关闭</span>
            rs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Connection succeed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> conn<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// TODO 自动生成的方法存根</span>
        <span class="token keyword">new</span> <span class="token function">connectsql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connectsql<span class="token punctuation">.</span><span class="token function">getConnect</span><span class="token punctuation">(</span><span class="token string">"shiyanjiu"</span><span class="token punctuation">,</span><span class="token string">"openGauss@123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
    <p>
     运行：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/345b36b5b8e15c3b935f16b3dab987f1.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f35313539343637362f:61727469636c652f64657461696c732f313234373330383636" class_="artid" style="display:none">
 </p>
</div>


