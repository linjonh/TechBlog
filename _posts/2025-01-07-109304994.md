---
layout: post
title: "单元测试之MockitoJunit使用和总结完整"
date: 2025-01-07 16:28:44 +0800
description: "一、什么是MOCK测试Mock 测试就是在测试过程中，对于某些不容易构造（如 HttpServlet"
keywords: "junit mockito"
categories: ['软件测试']
tags: ['Mockito']
artid: "109304994"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=109304994
    alt: "单元测试之MockitoJunit使用和总结完整"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     单元测试之Mockito+Junit使用和总结（完整）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="MOCK_0">
     </a>
     一、什么是MOCK测试
    </h3>
    <p>
     Mock 测试就是在测试过程中，对于某些不容易构造（如 HttpServletRequest 必须在Servlet 容器中才能构造出来）或者不容易获取比较复杂的对象（如 JDBC 中的ResultSet 对象），用一个虚拟的对象（Mock 对象）来创建以便测试的测试方法。
     <br/>
     Mock 最大的功能是帮你把单元测试的耦合分解开，如果你的代码对另一个类或者接口有依赖，它能够帮你模拟这些依赖，并帮你验证所调用的依赖的行为。
    </p>
    <p>
     <strong>
      mock中的必知概念：
     </strong>
    </p>
    <ul>
     <li>
      <p>
       桩函数(stub)：桩函数实际上是白盒测试中的概念，意思是使用一些自己定义的测试函数来替换当前需要测试的函数。被替换的函数可能是目前还没写完的，这样能够加速开发，或更好的找错误源。
      </p>
     </li>
     <li>
      <p>
       打桩（存根）：模拟要调用的函数（打桩对象），给它提供桩函数，给桩函数返回一个值。简单的说自定义输入输出，不打桩默认返回null。
      </p>
     </li>
     <li>
      <p>
       mock和stub：
       <br/>
       相同点：Stub和Mock对象都是用来模拟外部依赖，使我们能控制。
       <br/>
       不同点：而stub完全是模拟一个外部依赖，用来提供测试时所需要的测试数据。而mock对象用来判断测试是否能通过，也就是用来验证测试中依赖对象间的交互能否达到预期。在mocking框架中mock对象可以同时作为stub和mock对象使用，两者并没有严格区别。
      </p>
     </li>
    </ul>
    <p>
     如果不了解Junit，也可以参考我个人总结：
     <a href="https://blog.csdn.net/weixin_43909848/article/details/106859240">
      Junit单元测试学习以及使用
     </a>
    </p>
    <h3>
     <a id="Mockito_15">
     </a>
     二、Mockito使用
    </h3>
    <p>
     本文用maven作例子，导入jar包
    </p>
    <pre><code class="prism language-java">
    <span class="token generics function"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">&gt;</span></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> junit <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token generics function"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>junit<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>junit<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">4.8</span><span class="token number">.2</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mvnrepository<span class="token punctuation">.</span>com<span class="token operator">/</span>artifact<span class="token operator">/</span>org<span class="token punctuation">.</span>mockito<span class="token operator">/</span>mockito<span class="token operator">-</span>core <span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
                <span class="token generics function"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>mockito<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
                <span class="token generics function"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>mockito<span class="token operator">-</span>core<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
                <span class="token generics function"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">2.23</span><span class="token number">.4</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
                <span class="token generics function"><span class="token punctuation">&lt;</span>scope<span class="token punctuation">&gt;</span></span>test<span class="token operator">&lt;</span><span class="token operator">/</span>scope<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/75a379ae9e44a6b926533da43d4279f6.png#pic_center"/>
    </p>
    <p>
     <strong>
      1.声明mockito对象
     </strong>
    </p>
    <p>
     有两种方式，但首先都得导入import static org.mockito.Mockito.*; 最好用静态导入，可以直接调用方法
    </p>
    <ul>
     <li>
      通过@Mock注解声明mock对象。MockitoJUnitRunner（或者Mockito.initMocks(this)）为@mock，@spy等注解提供了初始化作用，所以用到注解时，一般都要使用它。
      <br/>
      @Mock: 创建一个Mock.
      <br/>
      @InjectMocks: 创建一个实例，简单的说是这个Mock可以调用真实代码的方法，其余用@Mock（或@Spy）注解创建的mock将被注入到用该实例中。可以调用类中的真实方法。
     </li>
    </ul>
    <pre><code class="prism language-java"><span class="token comment">//让注解生效的第一种方法</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>MockitoJUnitRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestMocks</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//@Mock注解会自动mock一个list对象</span>
    <span class="token annotation punctuation">@Mock</span>
    List mock<span class="token punctuation">;</span>
    
	<span class="token comment">//让注解生效的第二种方法，二选一即可</span>
 	<span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        MockitoAnnotations<span class="token punctuation">.</span><span class="token function">initMocks</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    mock<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"firstTime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mock<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"secondTime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      直接声明mock对象
     </li>
    </ul>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestMock</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//声明一个List的mock对象</span>
    List mock<span class="token operator">=</span><span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    mock<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"firstTime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mock<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"secondTime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      2.mock对象的when存根方法
     </strong>
    </p>
    <p>
     就是前面提到的打桩，一般用于给mock对象的函数指定自己需要的输入输出值，示例：
    </p>
    <pre><code class="prism language-java"> List mock<span class="token operator">=</span><span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    mock<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"firstTime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mock<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"secondTime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//打桩</span>
    <span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//如果是没有返回值的void方法，直接</span>
    <span class="token function">when</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <p>
     表示mock.get(0)返回值为1，这个地方的0也可以替换成anyInt()函数，代表获取任意数字返回都为0，不打桩默认返回为null。
     <br/>
     注意：对于 static 和 final 方法， Mockito 无法对其 when(…).thenReturn(…) 操作。
    </p>
    <p>
     <strong>
      3.mock的doNothing方法
     </strong>
    </p>
    <p>
     不做任何返回
    </p>
    <pre><code class="prism language-java"> List mock<span class="token operator">=</span><span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//打桩，返回值为1</span>
        <span class="token function">doNothing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      4.mock的verify方法
     </strong>
    </p>
    <p>
     一般用于检查是否调用了某些指定的方法。简单来说, 它可以验证一次测试中发生的某些行为。在测试代​​码的底部使用它来确保调用定义的方法。同时也可以测试方法的调用次数，当不使用times函数试，默认为检查一次，times(num)，num为调用检查的次数。
    </p>
    <pre><code class="prism language-java"> List mock<span class="token operator">=</span><span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//打桩，返回值为1</span>
        <span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//此处调用了mock.get(0)方法一次</span>
        <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"测试一下"</span><span class="token punctuation">,</span>mock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//验证是否调用一次</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//加上times(num)函数，检查是否调用num次</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>mock<span class="token punctuation">,</span><span class="token function">times</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <p>
     mock除了times(num)方法以外，还提供了几种更加方便的方法：
     <br/>
     never() 没有被调用，相当于 times(0)
     <br/>
     atLeast(N) 至少被调用 N 次
     <br/>
     atLeastOnce() 相当于 atLeast(1)
     <br/>
     atMost(N) 最多被调用 N 次
    </p>
    <p>
     随后我们可以使用verifyNoMoreInteractions方法来验证是否该mock对象所有的交互都得到验证
    </p>
    <pre><code class="prism language-java"><span class="token function">verifyNoMoreInteractions</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     如果有哪一次的调用没有验证，会报错提示
    </p>
    <p>
     <strong>
      5.mock的thenThrow方法
     </strong>
    </p>
    <p>
     用于存根void方法以引发异常时使用。它为每个方法调用创建一个新的异常实例。
    </p>
    <pre><code class="prism language-java"> List mock<span class="token operator">=</span><span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//打桩，返回值为1</span>
        <span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用get(0)时自定义异常</span>
        <span class="token function">doThrow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"出错啦"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      注意：
     </strong>
     thenThrow和doThrow作用都是抛出异常，用 doThrow 可以让返回void的函数抛出异常，而thenThrow不可以，因为when的参数是非void，doThrow语法：
    </p>
    <pre><code class="prism language-java">  <span class="token function">doThrow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"异常"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      6.mock的spy函数
     </strong>
    </p>
    <p>
     spy 的意思是你可以修改某个真实对象的某些方法的行为特征。
    </p>
    <pre><code class="prism language-java">List list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
List spy <span class="token operator">=</span> <span class="token function">spy</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
<span class="token comment">//optionally, you can stub out some methods:  </span>
<span class="token function">when</span><span class="token punctuation">(</span>spy<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   
<span class="token comment">//using the spy calls &lt;b&gt;real&lt;/b&gt; methods  </span>
spy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
spy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"two"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   
<span class="token comment">//prints "one" - the first element of a list  </span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>spy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   
<span class="token comment">//size() method was stubbed - 100 is printed  </span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>spy<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   
<span class="token comment">//optionally, you can verify  </span>
<span class="token function">verify</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token function">verify</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"two"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre>
    <p>
     这里改掉了list的size方法，如果我们再声明对象spy后添加when(spy.get(0)).thenReturn(“foo”); 就会抛出空指针异常，因为用spy之后，在我们的原始对象中，list.get(0)是没有值的，不能直接存根，所以使用spy的时候打桩我们尽量使用doReturn方法，如果用mock的话，都是虚假函数，不会执行真正的函数部分。
    </p>
    <p>
     <strong>
      7.mock的thenAnswer函数
     </strong>
    </p>
    <p>
     虽然doReturn函数可以帮助我们返回想要的值，但是有时候根据业务逻辑，我们需要对参数进行判断，返回不同的值，怎么办呢。这时候就可以用thenAnswer函数。此接口允许通过InvocationOnMock参数与参数进行交互.此外,answer方法的返回值将是模拟方法的返回值。
    </p>
    <pre><code class="prism language-java">  List mock<span class="token operator">=</span><span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token function">anyInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAnswer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Answer</span><span class="token generics function"><span class="token punctuation">&lt;</span>Object<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">public</span> Object <span class="token function">answer</span><span class="token punctuation">(</span>InvocationOnMock invocationOnMock<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//获取参数值</span>
                Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> invocationOnMock<span class="token punctuation">.</span><span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Integer a<span class="token operator">=</span> <span class="token punctuation">(</span>Integer<span class="token punctuation">)</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token comment">//根据参数值返回不同的数值</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">return</span> <span class="token number">99</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      注意：
     </strong>
     thenAnswer和doAnswer作用是一样的，只是使用方法（语法）不同，doAnswer语法：
    </p>
    <pre><code class="prism language-java"> <span class="token function">doAnswer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Answer<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span><span class="token comment">//方法和上面一样).when(mock).method();</span>
</code></pre>
    <p>
     <strong>
      8.mock的doCallRealMethod方法
     </strong>
    </p>
    <p>
     thenCallRealMethod 可以用来重置 spy 对象的特定方法特定参数调用。例如我们声明了一个spy对象，但是spy对象调用的是函数的真实的方法，如果我们给spy对象赋了新的值，但是我们又想要原来对象真实的值，这时候用doCallRealMethod方法重置spy对象，恢复真实值。示例：
     <br/>
     调用类：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestClass</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span><span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     测试方法：
    </p>
    <pre><code class="prism language-java">    <span class="token annotation punctuation">@Spy</span>
    TestClass test<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//让注解生效</span>
        MockitoAnnotations<span class="token punctuation">.</span><span class="token function">initMocks</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 	<span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>test<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//给1+2赋值为100</span>
    <span class="token function">when</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//调用真实值</span>
    <span class="token function">doCallRealMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <p>
     输出结果：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7d78bd7a01d23a936cac3621b644714a.png#pic_center">
      <br/>
      <strong>
       注意：
      </strong>
      ：和thenCallMethod用法一样，只不过语法有不同：
     </img>
    </p>
    <pre><code class="prism language-java"><span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenCallMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      9.mock的reset方法
     </strong>
    </p>
    <p>
     使用 reset 方法，可以重置之前自定义的返回值和异常。
     <br/>
     用法：reset(对象)
     <br/>
     例子：
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        List list<span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">// mock 对象方法的默认返回值是返回类型的默认值,默认值为null</span>
        <span class="token function">assertEquals</span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置让 list.get(0)返回 100</span>
        <span class="token comment">// 重置 mock 对象，list.get(0)返回 null</span>
        <span class="token function">reset</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertEquals</span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <p>
     这里注意，如果reset(spy对象)的话，其实和doCallRealMethod方法有异曲同工之妙，最后都会调用真实的方法，即重置spy对象。
    </p>
    <h3>
     <a id="_282">
     </a>
     三、总结
    </h3>
    <p>
     通过以上使用，我们大致可以了解到mock对我们测试的具体帮助是什么，还有它的基本使用，当然它还有其它方法，只了解了一些最常用的测试方法，需要更深入了解还需要我们在写代码的过程中去探索，mock大大简化了我们写单元测试的复杂度，一些难引用的对象都可以通过mock来模拟。
    </p>
    <p>
     <strong>
      小结：mock中doMethod和thenMethod区别，例如doThrow和thenThrow(当然这两个不止语法有区别，用法也有点区别，详情看上面的doThrow，其它方法基本就是语法上的差异比如doReturn和thenReturn等)：
     </strong>
     <br/>
     语法：
    </p>
    <pre><code class="prism language-java">List list<span class="token operator">=</span><span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">when</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenThrow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//等同于(这两个稍有区别)</span>
<span class="token function">doThrow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34333930393834382f:61727469636c652f64657461696c732f313039333034393934" class_="artid" style="display:none">
 </p>
</div>


