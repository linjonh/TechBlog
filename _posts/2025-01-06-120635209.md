---
layout: post
title: "嵌入式开发阿里云物联网平台在线升级OTA"
date: 2025-01-06 13:20:30 +0800
description: "本文详细介绍了如何利用阿里云的OTA（Over-the-Air）服务对嵌入式设备进行固件升级。首先，"
keywords: "ota在线升级平台"
categories: ['Stm', 'Gprs']
tags: ['阿里云', '物联网', 'Ota', 'Cat']
artid: "120635209"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=120635209
    alt: "嵌入式开发阿里云物联网平台在线升级OTA"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     嵌入式开发|阿里云物联网平台在线升级OTA
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h3>
     前言
    </h3>
    <p>
     OTA功能是产品的必备功能，但是如果又不想自己搭建平台，可以选择了阿里云的平台，基于阿里云对自己的设备进行版本管理。
    </p>
    <h3>
     硬件准备
    </h3>
    <p>
     1.广和通L610模组(opencpu,二次开发)
    </p>
    <h3>
     代码实现
    </h3>
    <p>
     1.升级流程图
    </p>
    <p style="text-align:center;">
     <img alt="æµç¨" src="https://i-blog.csdnimg.cn/blog_migrate/afe07d7e67f4e07262f0f64d1478d2f1.jpeg"/>
    </p>
    <p>
     2.设备上报版本信息，如果有新版本会下发升级信息
    </p>
    <p id="p-ki9-tke-7te">
     设备端通过MQTT协议推送当前设备OTA模块版本号到Topic：
     <code id="codeph-wyt-too-4rj">
      /ota/device/inform/${YourProductKey}/${YourDeviceName}
     </code>
     。消息格式如下：
    </p>
    <pre id="codeblock-fp1-y07-2fd"><code>{
  "id": "123",
  "params": {
    "version": "1.0.1",
    "module": "MCU"
  }
}</code></pre>
    <table id="table-gtr-wrp-c5q">
     <thead id="d6e68">
      <tr id="d6e69">
       <th id="concept-sgj-yts-zdb-d6e70">
        参数
       </th>
       <th id="concept-sgj-yts-zdb-d6e72">
        类型
       </th>
       <th id="concept-sgj-yts-zdb-d6e74">
        说明
       </th>
      </tr>
     </thead>
     <tbody id="d6e76">
      <tr id="d6e77">
       <td id="d6e78">
        id
       </td>
       <td id="d6e81">
        String
       </td>
       <td id="d6e83">
        消息ID号。String类型的数字，取值范围0~4294967295，且每个消息ID在当前设备中具有唯一性。
       </td>
      </tr>
      <tr id="d6e85">
       <td id="d6e86">
        version
       </td>
       <td id="d6e89">
        String
       </td>
       <td id="d6e91">
        OTA模块版本。
       </td>
      </tr>
      <tr id="d6e93">
       <td id="d6e94">
        module
       </td>
       <td id="d6e97">
        String
       </td>
       <td id="d6e99">
        OTA模块名。
        <strong>
         说明
        </strong>
        <ul id="d6e102">
         <li id="d6e103">
          上报默认（default）模块的版本号时，可以不上报module参数。
         </li>
         <li id="d6e108">
          设备的默认（default）模块的版本号代表整个设备的固件版本号。
         </li>
        </ul>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     3.设备下发升级包信息
    </p>
    <p id="p-5lt-rbd-1bh">
     设备端订阅Topic：
     <code id="codeph-cu6-qdi-a8g">
      /ota/device/upgrade/${YourProductKey}/${YourDeviceName}
     </code>
     。物联网平台对设备发起OTA升级请求后，设备端会通过该Topic收到升级包的存储地址URL。
    </p>
    <p id="p-t3t-4ms-ecm">
     消息格式如下：
    </p>
    <ul id="ul-7ow-i65-yv6">
     <li id="d6e501">
      单个文件的OTA升级包信息：
      <pre id="d6e503"><code>{
  "id": "123",
  "code": 200,
  "data": {
    "size": 93796291,
    "sign": "f8d85b250d4d787a9f483d89a974****",
    "version": "1.0.1.9.20171112.1432",
    "isDiff": 1,
    "url": "https://the_firmware_url",
    "signMethod": "MD5",
    "md5": "f8d85b250d4d787a9f483d89a9747348",
    "module": "MCU",
    "extData":{
        "key1":"value1",
        "key2":"value2",
        "_package_udi":"{"ota_notice":"升级底层摄像头驱动，解决视频图像模糊的问题。"}"
     }
  }
}</code></pre>
     </li>
    </ul>
    <table id="table-gct-qse-hvv">
     <thead id="d6e138">
      <tr id="d6e139">
       <th id="concept-sgj-yts-zdb-d6e140">
        参数
       </th>
       <th id="concept-sgj-yts-zdb-d6e142">
        类型
       </th>
       <th id="concept-sgj-yts-zdb-d6e144">
        说明
       </th>
      </tr>
     </thead>
     <tbody id="d6e146">
      <tr id="d6e147">
       <td id="d6e148">
        id
       </td>
       <td id="d6e151">
        Long
       </td>
       <td id="d6e155">
        消息ID号。每个消息ID在当前设备中具有唯一性。
       </td>
      </tr>
      <tr id="d6e157">
       <td id="d6e158">
        message
       </td>
       <td id="d6e161">
        String
       </td>
       <td id="d6e163">
        结果信息。
       </td>
      </tr>
      <tr id="d6e165">
       <td id="d6e166">
        code
       </td>
       <td id="d6e169">
        String
       </td>
       <td id="d6e171">
        状态码。
       </td>
      </tr>
      <tr id="d6e173">
       <td id="d6e174">
        version
       </td>
       <td id="d6e177">
        String
       </td>
       <td id="d6e179">
        设备升级包的版本信息。
       </td>
      </tr>
      <tr id="d6e181">
       <td id="d6e182">
        size
       </td>
       <td id="d6e185">
        Long
       </td>
       <td id="d6e187">
        升级包文件大小，单位：字节。
        <p id="d6e189">
         OTA升级包中仅有一个升级包文件时，包含该参数。
        </p>
       </td>
      </tr>
      <tr id="d6e191">
       <td id="d6e192">
        url
       </td>
       <td id="d6e195">
        String
       </td>
       <td id="d6e197">
        升级包在对象存储（OSS）上的存储地址。
        <p id="d6e199">
         OTA升级包中仅有一个升级包文件时，包含该参数。
        </p>
       </td>
      </tr>
      <tr id="d6e201">
       <td id="d6e202">
        isDiff
       </td>
       <td id="d6e205">
        Long
       </td>
       <td id="d6e207">
        仅当升级包类型为差分时，消息包含此参数。
        <p id="d6e212">
         取值为1，表示仅包含新版本升级包与之前版本的差异部分，需要设备进行差分还原。
        </p>
       </td>
      </tr>
      <tr id="d6e214">
       <td id="d6e215">
        sign
       </td>
       <td id="d6e218">
        String
       </td>
       <td id="d6e220">
        升级包签名。
        <p id="d6e222">
         OTA升级包中仅有一个升级包文件时，包含该参数。
        </p>
       </td>
      </tr>
      <tr id="d6e224">
       <td id="d6e225">
        signMethod
       </td>
       <td id="d6e228">
        String
       </td>
       <td id="d6e230">
        签名方法。取值：
        <ul id="d6e232">
         <li id="d6e233">
          SHA256
         </li>
         <li id="d6e235">
          MD5
         </li>
        </ul>
        对于Android差分升级包类型，仅支持MD5签名方法。
       </td>
      </tr>
      <tr id="d6e238">
       <td id="d6e239">
        md5
       </td>
       <td id="d6e242">
        String
       </td>
       <td id="d6e244">
        当签名方法为MD5时，除了会给sign赋值外还会给md5赋值。
        <p id="d6e252">
         OTA升级包中仅有一个升级包文件时，包含该参数。
        </p>
       </td>
      </tr>
      <tr id="d6e254">
       <td id="d6e255">
        module
       </td>
       <td id="d6e258">
        String
       </td>
       <td id="d6e260">
        升级包所属的模块名。
        <p>
         <strong>
          说明
         </strong>
         模块名为default时，物联网平台不下发module参数。
        </p>
       </td>
      </tr>
      <tr id="d6e268">
       <td id="d6e269">
        extData
       </td>
       <td id="d6e272">
        Object
       </td>
       <td id="d6e274">
        升级批次标签列表和推送给设备的自定义信息。
        <p id="d6e276">
         _package_udi表示自定义信息的字段。
        </p>
        <p id="d6e280">
         单个标签格式：
         <code id="d6e282">
          "key":"value"
         </code>
         。
        </p>
       </td>
      </tr>
      <tr id="d6e285">
       <td id="d6e286">
        files
       </td>
       <td id="d6e289">
        Array
       </td>
       <td id="d6e291">
        多个升级包文件的信息列表。
        <p id="d6e293">
         OTA升级包中有多个升级包文件时，包含该参数。
        </p>
        <p id="d6e295">
         单个升级包文件信息为：
        </p>
        <ul id="d6e297">
         <li id="d6e298">
          fileSize：升级包文件大小。
         </li>
         <li id="d6e302">
          fileName：升级包文件的名称。
         </li>
         <li id="d6e306">
          fileUrl、fileMd5、fileSign：含义与url、md5、sign相同。
         </li>
        </ul>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
    </p>
    <p>
     4.设备上报升级进度(可选)
    </p>
    <p id="p-0ft-hy7-zqm">
     Topic：
     <code id="codeph-8kz-ese-mq7">
      /ota/device/progress/${YourProductKey}/${YourDeviceName}
     </code>
     。
    </p>
    <pre id="codeblock-eew-1cz-3my"><code>{
  "id": "123",
  "params": {
    "step": "-1",
    "desc": "OTA升级失败，请求不到升级包信息。",
    "module": "MCU"
  }
}</code></pre>
    <table id="table-qau-pl7-2t7">
     <thead id="d6e348">
      <tr id="d6e349">
       <th id="concept-sgj-yts-zdb-d6e350">
        参数
       </th>
       <th id="concept-sgj-yts-zdb-d6e352">
        类型
       </th>
       <th id="concept-sgj-yts-zdb-d6e354">
        说明
       </th>
      </tr>
     </thead>
     <tbody id="d6e356">
      <tr id="d6e357">
       <td id="d6e358">
        id
       </td>
       <td id="d6e361">
        String
       </td>
       <td id="d6e363">
        消息ID号。String类型的数字，取值范围0~4294967295，且每个消息ID在当前设备中具有唯一性。
       </td>
      </tr>
      <tr id="d6e365">
       <td id="d6e366">
        step
       </td>
       <td id="d6e369">
        String
       </td>
       <td id="d6e371">
        <p id="d6e372">
         OTA升级进度。
        </p>
        取值范围：
        <ul id="d6e376">
         <li id="d6e377">
          1~100的整数：升级进度百分比。
         </li>
         <li id="d6e379">
          -1：升级失败。
         </li>
         <li id="d6e381">
          -2：下载失败。
         </li>
         <li id="d6e383">
          -3：校验失败。
         </li>
         <li id="d6e385">
          -4：烧写失败。
         </li>
        </ul>
        <p id="d6e387">
         设备上报的进度值及其描述信息，可根据设备实际升级场景在设备端配置。设备端配置方法，请参见
         <a href="https://help.aliyun.com/document_detail/264692.htm#task-2089279" rel="nofollow" title="设备端Link SDK的OTA升级">
          设备端Link SDK的OTA升级
         </a>
         。
        </p>
       </td>
      </tr>
      <tr id="d6e392">
       <td id="d6e393">
        desc
       </td>
       <td id="d6e396">
        String
       </td>
       <td id="d6e398">
        当前步骤的描述信息，长度不超过128个字符。如果发生异常，此字段可承载错误信息。
       </td>
      </tr>
      <tr id="d6e400">
       <td id="d6e401">
        module
       </td>
       <td id="d6e404">
        String
       </td>
       <td id="d6e406">
        升级包所属的模块名。模块的更多信息，请参见
        <a href="https://help.aliyun.com/document_detail/202664.htm#task-2038962" rel="nofollow" title="添加升级包">
         添加升级包
        </a>
        。
        <p>
         <strong>
          说明
         </strong>
         上报默认（default）模块的OTA升级进度时，可以不上报module参数。
        </p>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     5.设备端完成OTA升级后，推送最新的版本信息到Topic：
     <code id="codeph-gce-7i9-c4t">
      /ota/device/inform/${YourProductKey}/${YourDeviceName}
     </code>
     。如果上报的版本与OTA服务要求的版本一致就认为升级成功，反之失败。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f7a697169353534332f:61727469636c652f64657461696c732f313230363335323039" class_="artid" style="display:none">
 </p>
</div>


