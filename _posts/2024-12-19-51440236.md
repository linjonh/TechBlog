---
layout: post
title: "linux-shell编程学习-循环流程while,for,until命令"
date: 2024-12-19 23:41:21 +0800
description: "作为一种编程语言，流程控制命令是不可缺少的。 本文简单介绍了bash shell的循环流程控制命令，"
keywords: "shell 计数循环出循环后0"
categories: ['Linux']
tags: ['流程控制', 'While', 'Until', 'Shell', 'Linux', 'For']
artid: "51440236"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=51440236
    alt: "linux-shell编程学习-循环流程while,for,until命令"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     linux shell编程学习--循环流程while，for，until命令
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     作为一种编程语言，流程控制命令是不可缺少的。
     <br/>
     bash shell可以使用while，until，for命令实现循环结构。下面逐一介绍。
    </p>
    <h4 id="while命令">
     while命令
    </h4>
    <p>
     while命令语言，语法如下：
    </p>
    <pre class="prettyprint"><code class="language-bash hljs"><span class="hljs-keyword">while</span> test_commod ;<span class="hljs-keyword">do</span>
    user_commods;
<span class="hljs-keyword">done</span></code></pre>
    <p>
     只要test_commod命令返回0，则执行user_commods命令块；
     <br/>
     while循环结束后，整个命令块的返回值，为user_commods命令最后一个命令的返回值，如果user_commods命令块没有执行，则整个返回值为0
    </p>
    <p>
     while命令的常见用法，就是和read一起按行读取文件，然后对每行数据做些处理
    </p>
    <pre class="prettyprint"><code class="language-bash hljs">shuanghu@shuanghu:tmp$ cat word.txt 
four
one
three
two
shuanghu@shuanghu:tmp$ cat test_while.sh 
<span class="hljs-shebang">#!/bin/bash</span>
<span class="hljs-comment">#while command</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line;<span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$line</span>
<span class="hljs-keyword">done</span>
shuanghu@shuanghu:tmp$ cat word.txt |./test_while.sh 
four
one
three
two</code></pre>
    <h4 id="for命令">
     for命令
    </h4>
    <p>
     for命令有两种语法
     <br/>
     语法一，如下：
    </p>
    <pre class="prettyprint"><code class="language-bash hljs"><span class="hljs-keyword">for</span> 变量 [<span class="hljs-keyword">in</span> 列表];<span class="hljs-keyword">do</span>
    命令块
<span class="hljs-keyword">done</span></code></pre>
    <p>
     for这种命令语法，有个常见场景就是遍历目录。如遍历统计目录里子目录的大小。
    </p>
    <pre class="prettyprint"><code class="language-bash hljs">shuanghu@shuanghu:tmp$ cat test_<span class="hljs-keyword">for</span>1.sh 
<span class="hljs-shebang">#!/bin/bash
</span>
<span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> `ls`;
<span class="hljs-keyword">do</span> 
    du -sh <span class="hljs-variable">$name</span>; 
<span class="hljs-keyword">done</span>
shuanghu@shuanghu:tmp$./test_<span class="hljs-keyword">for</span>1.sh
<span class="hljs-number">8.0</span>K    path1
<span class="hljs-number">20</span>K path2
<span class="hljs-number">4.0</span>K    path3</code></pre>
    <p>
     for命令，还有另外一种语法，如下：
    </p>
    <pre class="prettyprint"><code class="hljs bash"><span class="hljs-keyword">for</span> (( 表达式<span class="hljs-number">1</span>;表达式<span class="hljs-number">2</span>;表达式<span class="hljs-number">3</span>));<span class="hljs-keyword">do</span>
    命令块
<span class="hljs-keyword">done</span></code></pre>
    <p>
     for命令的第二种语法，常用场景就是进行已知计数的循环，比如循环输出5个随机数字。
     <br/>
     例子如下：
    </p>
    <pre class="prettyprint"><code class="hljs bash">shuanghu@shuanghu:tmp$ cat ./test_<span class="hljs-keyword">for</span>2.sh 
<span class="hljs-shebang">#!/bin/bash</span>
<span class="hljs-comment">#for commod example</span>
<span class="hljs-keyword">for</span> (( i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">5</span>; ++i));<span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-operator">-e</span> <span class="hljs-variable">$RANDOM</span>
<span class="hljs-keyword">done</span>
shuanghu@shuanghu:tmp$ ./test_<span class="hljs-keyword">for</span>2.sh 
<span class="hljs-number">27698</span>
<span class="hljs-number">28901</span>
<span class="hljs-number">22017</span>
<span class="hljs-number">27993</span>
<span class="hljs-number">10015</span></code></pre>
    <h4 id="until命令">
     until命令
    </h4>
    <p>
     until命令语法如下：
    </p>
    <pre class="prettyprint"><code class="language-bash hljs">until condition;
<span class="hljs-keyword">do</span> 
    命令块;
<span class="hljs-keyword">done</span></code></pre>
    <p>
     如果condition命令返回非0，则执行命令块;如果condition命令返回0，则退出循环。
     <br/>
     until命令的使用场景比较少，但也是有适用场景的，等待某个条件满足，不满足则循环等待。比如，循环监控文件，如果文件大小满足一定条件，则进行备份，否则循环等待。
    </p>
    <pre class="prettyprint"><code class="language-bash hljs">shuanghu@shuanghu:tmp<span class="hljs-variable">$cat</span> test_until.sh
<span class="hljs-shebang">#!/bin/bash
</span>
<span class="hljs-comment">#until command</span>

file=logfile
until [ $(ls <span class="hljs-operator">-l</span> <span class="hljs-variable">$file</span> | awk <span class="hljs-string">'{print $5}'</span>) <span class="hljs-operator">-gt</span> <span class="hljs-number">2000</span> ]
<span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"等待5秒，再判断是否满足大小"</span>
    sleep <span class="hljs-number">5</span>
<span class="hljs-keyword">done</span>
date=`date +%s`
cp <span class="hljs-variable">$file</span> <span class="hljs-string">"<span class="hljs-variable">$file</span>-"</span><span class="hljs-variable">$date</span>.bak
<span class="hljs-built_in">echo</span> <span class="hljs-string">"备份完成"</span>

shuanghu@shuanghu:tmp$./test_until.sh 
等待<span class="hljs-number">5</span>秒，再判断是否满足大小
等待<span class="hljs-number">5</span>秒，再判断是否满足大小
等待<span class="hljs-number">5</span>秒，再判断是否满足大小
备份完成
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f736875616e6768756a75736869:2f61727469636c652f64657461696c732f3531343430323336" class_="artid" style="display:none">
 </p>
</div>


