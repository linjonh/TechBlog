---
layout: post
title: "Cmake-Android音视频创建支持ffmpeg3.4的项目"
date: 2025-01-22 19:30:00 +0800
description: "[Cmake-Android音视频]创建支持ffmpeg的项目AndroidStudio版本3.21"
keywords: "ffmpeg 3.4 android 编译"
categories: ['Android']
tags: ['音视频', 'Ffmpeg', 'Cmake', 'Android']
artid: "90477243"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=90477243
    alt: "Cmake-Android音视频创建支持ffmpeg3.4的项目"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     [Cmake-Android音视频]创建支持ffmpeg3.4的项目
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-github-gist" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <strong>
      [Cmake-Android]音视频总结：
     </strong>
    </p>
    <ul>
     <li>
      <a href="https://blog.csdn.net/adolph_lu/article/details/90315151">
       [Cmake-Android音视频]SDK，NDK基本介绍
      </a>
     </li>
     <li>
      <a href="https://blog.csdn.net/adolph_lu/article/details/90384620">
       [Cmake-Android音视频]NDK-r14b编译ffmpeg3.4支持neon,硬解码
      </a>
     </li>
     <li>
      <a href="https://blog.csdn.net/adolph_lu/article/details/90477243">
       [Cmake-Android音视频]创建支持ffmpeg3.4的项目
      </a>
     </li>
     <li>
      <a href="https://blog.csdn.net/adolph_lu/article/details/90708620">
       [Cmake-Android音视频]ffmpeg3.4实现解封装
      </a>
     </li>
     <li>
      <a href="https://blog.csdn.net/adolph_lu/article/details/91348324">
       [Cmake-Android音视频]ffmpeg3.4软硬解码和多线程解码
      </a>
     </li>
     <li>
      <a href="https://blog.csdn.net/adolph_lu/article/details/91997478">
       [Cmake-Android音视频]ffmpeg3.4视频格式转换和显示
      </a>
     </li>
     <li>
      <a href="https://blog.csdn.net/adolph_lu/article/details/92795081">
       [Cmake-Android音视频]ffmpeg3.4音频重采样
      </a>
     </li>
     <li>
      <a href="https://blog.csdn.net/adolph_lu/article/details/93349809">
       [Cmake-Android音视频]OpenSLES音频播放
      </a>
     </li>
    </ul>
    <p>
     <font color="red">
      AndroidStudio版本3.2
     </font>
    </p>
    <h6>
     <a id="1Android_13">
     </a>
     1.创建Android项目
    </h6>
    <h6>
     <a id="11AndroidStudioFirstFfmpegChttpsimgblogcsdnimgcn20190523112829898pngxossprocessimagewatermarktype_ZmFuZ3poZW5naGVpdGkshadow_10text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Fkb2xwaF9sdQsize_16color_FFFFFFt_70_15">
     </a>
     1.1打开AndroidStudio,创建一个名为FirstFfmpeg的项目，勾选C++支持
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f5823b218ea9fd19f0d0c00198654d53.png"/>
    </h6>
    <h6>
     <a id="12_minimun_SDK504041httpsimgblogcsdnimgcn20190523112915501pngxossprocessimagewatermarktype_ZmFuZ3poZW5naGVpdGkshadow_10text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Fkb2xwaF9sdQsize_16color_FFFFFFt_70_17">
     </a>
     1.2 minimun SDK选择5.0，4.0或者4.1都可以，根据自身项目需求
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/82909c61c6feedd72025ff8fd9ded38d.png"/>
    </h6>
    <h6>
     <a id="13_C_Standard_C11httpsimgblogcsdnimgcn20190523112935605pngxossprocessimagewatermarktype_ZmFuZ3poZW5naGVpdGkshadow_10text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Fkb2xwaF9sdQsize_16color_FFFFFFt_70_21">
     </a>
     1.3 C++ Standard 选择C++11
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2b32c218fef003c70a20c1b8f4944be0.png"/>
    </h6>
    <h6>
     <a id="14Android_23">
     </a>
     1.4等待Android项目创建完成
    </h6>
    <p>
     <font color="red">
      为了方便查看Android文件目录，可以将Android视图结构切换为Project
     </font>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/71dde95c04693d9725d1691ab01a656b.png"/>
    </p>
    <h6>
     <a id="2ffmpeg_27">
     </a>
     2.导入已经编译好的ffmpeg头文件和库文件
    </h6>
    <h6>
     <a id="21ffmpegffmpegapphttpsimgblogcsdnimgcn20190523113019655pngxossprocessimagewatermarktype_ZmFuZ3poZW5naGVpdGkshadow_10text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Fkb2xwaF9sdQsize_16color_FFFFFFt_70_28">
     </a>
     2.1导入ffmpeg库头文件：复制编译好的ffmpeg的动态库中的头文件到app目录下
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d9a08f462b51bcfeee4392d73a9e289e.png"/>
    </h6>
    <h6>
     <a id="22ffmpegapplibsarmeabiv7ahttpsimgblogcsdnimgcn20190523113031126pngxossprocessimagewatermarktype_ZmFuZ3poZW5naGVpdGkshadow_10text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Fkb2xwaF9sdQsize_16color_FFFFFFt_70_29">
     </a>
     2.2导入ffmpeg动态库文件：在app/libs下新建armeabi-v7a文件夹，将动态库复制到该目录下
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9486e2beede7625d6f4c0805c398487d.png"/>
    </h6>
    <h6>
     <a id="3CMakeListstxtAndroid_30">
     </a>
     3.编写CMakeLists.txt文件，Android会默认生成这个文件，我们只需要修改即可，如下，添加的地方都有详细的注释，相信都能看得懂
    </h6>
    <pre><code># For more information about using CMake with Android Studio, read the
# documentation: https://d.android.com/studio/projects/add-native-code.html

# Sets the minimum version of CMake required to build the native library.

cmake_minimum_required(VERSION 3.4.1)

# Creates and names a library, sets it as either STATIC
# or SHARED, and provides the relative paths to its source code.
# You can define multiple libraries, and CMake builds them for you.
# Gradle automatically packages shared libraries with your APK.

#添加头文件目录，相对于CMakeLists.txt也就是本文件的路径，从目录
#结构中可以看出，CMakeLists.txt和include目录是在同一级目录
include_directories(include)

#设置ffmpeg库所在路径的变量 FF为表示路径的变量，
#CMAKE_CURRENT_SOURCE_DIR为CMake内置变量，表示CMakeLists所在的目录
#ANDROID_ABI CPU架构类型，如果gradle文件没有设置过滤，
#则会表示所有的架构，arm-v7a arm-v8a x86 x86_64
#所以FF=CMAKE_CURRENT_SOURCE_DIR/libs/armeabi-v7a
set(FF ${CMAKE_CURRENT_SOURCE_DIR}/libs/${ANDROID_ABI})

#添加avcodec SHARED表示动态库 IMPORTED表示从外部导入
add_library(avcodec SHARED IMPORTED)
set_target_properties(avcodec PROPERTIES IMPORTED_LOCATION ${FF}/libavcodec.so)

#avformat
add_library(avformat SHARED IMPORTED)
set_target_properties(avformat PROPERTIES IMPORTED_LOCATION ${FF}/libavformat.so)

add_library( # Sets the name of the library.
        native-lib

        # Sets the library as a shared library.
        SHARED

        # Provides a relative path to your source file(s).
        src/main/cpp/native-lib.cpp)

# Searches for a specified prebuilt library and stores the path as a
# variable. Because CMake includes system libraries in the search path by
# default, you only need to specify the name of the public NDK library
# you want to add. CMake verifies that the library exists before
# completing its build.

find_library( # Sets the name of the path variable.
        log-lib

        # Specifies the name of the NDK library that
        # you want CMake to locate.
        log)

# Specifies libraries CMake should link to your target library. You
# can link multiple libraries, such as libraries you define in this
# build script, prebuilt third-party libraries, or system libraries.

#将添加进来的库avcodec avformat链接到native-lib库中，
#因为我们最终只会生成一个libnative-lib.so库
#这个库如果没有指定路径，那么可以在app/build/cmake/debug/obj中找到
target_link_libraries( # Specifies the target library.
        native-lib
        avcodec avformat
        # Links the target library to the log library
        # included in the NDK.
        ${log-lib})
</code></pre>
    <h6>
     <a id="4nativelibcppavcodechavcodec_configurationffmpeg_configure_103">
     </a>
     4在native-lib.cpp中添加avcodec.h头文件，调用
     <code>
      avcodec_configuration()
     </code>
     打印ffmpeg configure参数
    </h6>
    <pre><code>#include &lt;jni.h&gt;
#include &lt;string&gt;

//ffmpeg是基于C语言的库，所以在使用ffmpeg的头文件的时候，需要用extern来标记
extern "C"
{
#include &lt;libavcodec/avcodec.h&gt;
}

extern "C" JNIEXPORT jstring JNICALL
Java_c_lucas_firstffmpeg_MainActivity_stringFromJNI(
        JNIEnv *env,
        jobject /* this */) {
    std::string hello = "Hello from C++";
    //avcodec_configuration()返回ffmpeg配置参数
    hello += avcodec_configuration();
    return env-&gt;NewStringUTF(hello.c_str());
}
</code></pre>
    <h6>
     <a id="5appbuildgradlearmeabiv7affmpeg_128">
     </a>
     5.修改app下build.gradle,主要是设置只编译armeabi-v7a架构，设置ffmpeg动态库目录
    </h6>
    <pre><code>    defaultConfig {
        applicationId "c.lucas.firstffmpeg"
        minSdkVersion 21
        targetSdkVersion 28
        versionCode 1
        versionName "1.0"
        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
        externalNativeBuild {
            cmake {
                cppFlags "-std=c++11"
            }
            //只编译armeabi-v7a架构
            ndk {
                abiFilters "armeabi-v7a"
            }
        }
        //设置ffmpeg动态库目录 相对于app下的build.gradle文件目录
        sourceSets{
            main{
                jniLibs.srcDirs=['libs']
            }
        }
    }
</code></pre>
    <h6>
     <a id="6ffmpeg_158">
     </a>
     6.最后编译运行，可以在手机屏幕上看到ffmpeg的编译配置信息。
    </h6>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3325353f7cb1deb0c4b0f535e2ba8e62.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f61646f6c70685f6c75:2f61727469636c652f64657461696c732f3930343737323433" class_="artid" style="display:none">
 </p>
</div>


